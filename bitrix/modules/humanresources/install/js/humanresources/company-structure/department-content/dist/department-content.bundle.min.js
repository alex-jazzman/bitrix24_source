this.BX=this.BX||{};this.BX.Humanresources=this.BX.Humanresources||{};(function(t,e,n,s,i,a,o,r,d,l,c,_,T,h,E,u,m,p,C,A){"use strict";const N=Object.freeze({containerDataTestId:"hr-department-content_users-tab__head-list-container",listActionButtonDataTestId:"hr-department-content_users-tab__head-list-action-button",listActonMenuDataTestId:"hr-department-content_users-tab__head-list-action-menu-container",listCounterDataTestId:"hr-department-content_users-tab__head-list-counter"});const R=Object.freeze({containerDataTestId:"hr-department-content_users-tab__employee-list-container",listActionButtonDataTestId:"hr-department-content_users-tab__employee-list-action-button",listActonMenuDataTestId:"hr-department-content_users-tab__employee-list-action-menu-container",listCounterDataTestId:"hr-department-content_users-tab__employee-list-counter"});const S={name:"emptyStateContainer",components:{RouteActionMenu:m.RouteActionMenu},props:{departmentId:{type:Number,required:true},entityType:{type:String,default:h.EntityTypes.department}},data(){return{menuVisible:false}},computed:{menu(){return new T.EmptyUsersTabActionMenu(this.departmentId,s.AnalyticsSourceType.DETAIL,null,this.entityType)},...A.mapState(C.useChartStore,["focusedNode"])},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},onClick(){if(this.entityType===h.EntityTypes.team&&this.menu.items.length===1){this.onActionMenuItemClick(this.menu.items[0].id)}else{this.menuVisible=true}},onActionMenuItemClick(t){this.menu.onActionMenuItemClick(t)}},template:`\n\t\t<div class="hr-department-detail-content__users-empty-tab-add_buttons-container">\n\t\t\t<button\n\t\t\t\tclass="hr-add-employee-empty-tab-entity-btn ui-btn ui-btn ui-btn-sm ui-btn-primary ui-btn-round"\n\t\t\t\tref="actionMenuButton"\n\t\t\t\t@click.stop="onClick"\n\t\t\t\tdata-id="hr-department-detail-content__user-empty-tab_add-user-button"\n\t\t\t>\n\t\t\t\t<span class="hr-add-employee-empty-tab-entity-btn-text">{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_EMPLOYEES_ADD_USER_ADD_BUTTON')}}</span>\n\t\t\t</button>\n\t\t\t<RouteActionMenu\n\t\t\t\tv-if="menuVisible"\n\t\t\t\t:id="'empty-state-department-detail-add-menu-' + focusedNode"\n\t\t\t\t:items="menu.items"\n\t\t\t\t:width="302"\n\t\t\t\t:bindElement="$refs['actionMenuButton']"\n\t\t\t\t@action="onActionMenuItemClick"\n\t\t\t\t@close="menuVisible = false"\n\t\t\t/>\n\t\t</div>\n\t`};const U={getPagedEmployees:(t,e,n)=>s.getData("humanresources.api.Structure.Node.Member.Employee.list",{nodeId:t,page:e,countPerPage:n}),removeUserFromDepartment:(t,e)=>s.postData("humanresources.api.Structure.Node.Member.deleteUser",{nodeId:t,userId:e}),moveUserToDepartment:(t,e,n,i)=>s.postData("humanresources.api.Structure.Node.Member.moveUser",{nodeId:t,userId:e,targetNodeId:n,roleXmlId:i}),isUserInMultipleDepartments:t=>s.getData("humanresources.api.User.isUserInMultipleDepartments",{userId:t}),getUserInfo:(t,e)=>s.getData("humanresources.api.User.getInfoByUserMember",{nodeId:t,userId:e}),fireUser:t=>s.postData("intranet.user.fire",{userId:t}),findMemberByQuery:(t,e)=>s.getData("humanresources.api.Structure.Node.Member.find",{nodeId:t,query:e}),getChatsAndChannels:t=>s.getData("humanresources.api.Structure.Node.Member.Chat.getList",{nodeId:t}),saveChats:(t,e={},n={},i=null)=>s.postData("humanresources.api.Structure.Node.Member.Chat.saveChatList",{nodeId:t,ids:e,removeIds:n,parentId:i})};const M=t=>{const e=C.useChartStore();const n=[...t];const s=new Set;const i=1e4;let a=0;while(n.length>0&&a<i){a++;const t=n.shift();if(s.has(t)){continue}s.add(t);const i=e.departments.get(t);if(!i){continue}i.chatsDetailed=null;i.channelsDetailed=null;if(i.children&&i.children.length>0){n.push(...i.children)}}};const O={moveUserToDepartment:(t,e,n,i)=>{var a;const o=C.useChartStore();const r=o.departments.get(t);const d=o.departments.get(n);if(!r||!d){return}const l=s.getMemberRoles(r.entityType);const c=s.getMemberRoles(d.entityType);const _=i===l.employee?(a=r.employees)==null?void 0:a.find((t=>t.id===e)):r.heads.find((t=>t.id===e));if(!_){return}r.userCount-=1;if(i===l.employee){r.employees=r.employees.filter((t=>t.id!==e))}else{r.heads=r.heads.filter((t=>t.id!==e))}d.userCount+=1;if(e===o.userId){o.changeCurrentDepartment(t,n)}_.role=c.employee;if(!d.employees){return}d.employees.push(_)},removeUserFromDepartment:(t,e,n)=>{const i=C.useChartStore();const a=i.departments.get(t);const o=s.getMemberRoles(a.entityType);if(!a){return}if(e===i.userId){i.changeCurrentDepartment(t)}a.userCount-=1;if(n===o.employee){a.employees=a.employees.filter((t=>t.id!==e));return}a.heads=a.heads.filter((t=>t.id!==e))},updateEmployees:(t,e)=>{const{departments:n}=C.useChartStore();const s=n.get(t);if(!s){return}n.set(t,{...s,employees:e})},updateHeads:(t,e)=>{const{departments:n}=C.useChartStore();const s=n.get(t);if(!s){return}n.set(t,{...s,heads:e})},updateEmployeeListOptions:(t,e)=>{const{departments:n}=C.useChartStore();const s=n.get(t);if(!s){return}s.employeeListOptions={...s.employeeListOptions,...e};n.set(t,s)},setChatsAndChannels:(t,e,n,s=0,i=0)=>{const a=C.useChartStore();const o=a.departments.get(t);if(!o){return}o.channelsDetailed=n;o.chatsDetailed=e;o.channelsNoAccess=i;o.chatsNoAccess=s;o.chatAndChannelsCount=e.length+n.length+s+i},removeUserFromAllDepartments:async t=>{const e=C.useChartStore();const n=e.departments;const s=[];for(const[e,i]of n){if("heads"in i&&p.Type.isArray(i.heads)&&i.heads.some((e=>e.id===t))||"employees"in i&&p.Type.isArray(i.employees)&&i.employees.some((e=>e.id===t))){s.push(e)}}return e.refreshDepartments(s)},unbindChatFromNode:(t,e)=>{const n=C.useChartStore();const s=n.departments.get(t);if(!s){return}s.channelsDetailed=s.channelsDetailed.filter((t=>t.id!==e));s.chatsDetailed=s.chatsDetailed.filter((t=>t.id!==e));s.chatAndChannelsCount--},updateChatsInChildrenNodes:t=>{const e=C.useChartStore();const n=e.departments.get(t);if(!n||!n.children){return}M(n.children)}};const P={name:"MoveUserActionPopup",components:{ConfirmationPopup:m.ConfirmationPopup},emits:["close","action"],props:{parentId:{type:Number,required:true},user:{type:Object,required:true},entityType:{type:String,required:true}},created(){this.permissionChecker=r.PermissionChecker.getInstance();if(!this.permissionChecker){return}this.action=this.isTeamEntity?r.PermissionActions.teamAddMember:r.PermissionActions.employeeAddToDepartment;this.selectedDepartmentId=0},data(){return{showMoveUserActionLoader:false,lockMoveUserActionButton:false,showUserAlreadyBelongsToDepartmentPopup:false,accessDenied:false}},mounted(){const t=this.$refs["department-selector"];this.departmentSelector=this.createTagSelector();this.departmentSelector.renderTo(t)},computed:{...A.mapState(C.useChartStore,["departments","focusedNode"]),includedNodeEntityTypesInDialog(){return this.isTeamEntity?["team"]:["department"]},getMoveUserActionPhrase(){var t,e;const n=p.Text.encode((t=this.departments.get(this.focusedNode).name)!=null?t:"");const s=p.Text.encode((e=this.user.name)!=null?e:"");let i="";if(this.isTeamEntity){i="HUMANRESOURCES_DEPARTMENT_CONTENT_TAB_USER_ACTION_MENU_MOVE_TO_ANOTHER_TEAM_REMOVE_USER_DESCRIPTION";i+=this.user.gender==="F"?"_F":"_M"}else{i="HUMANRESOURCES_DEPARTMENT_CONTENT_TAB_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_ALREADY_BELONGS_TO_DEPARTMENT_DESCRIPTION_MSGVER_1"}return this.loc(i,{"#USER_NAME#":s,"#DEPARTMENT_NAME#":n}).replace("[link]",`<a class="hr-department-detail-content__move-user-department-user-link" href="${this.user.url}">`).replace("[/link]","</a>")},getUserAlreadyBelongsToDepartmentPopupPhrase(){var t,e,n;const s=p.Text.encode((t=this.departments.get((e=this.selectedParentDepartment)!=null?e:0).name)!=null?t:"");const i=p.Text.encode((n=this.user.name)!=null?n:"");let a="";if(this.isTeamEntity){a="HUMANRESOURCES_DEPARTMENT_CONTENT_TAB_USER_ACTION_MENU_MOVE_TO_ANOTHER_TEAM_ALREADY_BELONGS_TO_TEAM_DESCRIPTION";a+=this.user.gender==="F"?"_F":"_M"}else{a="HUMANRESOURCES_DEPARTMENT_CONTENT_TAB_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_ALREADY_BELONGS_TO_DEPARTMENT_DESCRIPTION_MSGVER_1"}let o=this.loc(a,{"#USER_NAME#":i,"#DEPARTMENT_NAME#":s});o=o.replace("[link]",`<a class="hr-department-detail-content__move-user-department-user-link" href="${this.user.url}">`);o=o.replace("[/link]","</a>");return o},memberRoles(){return s.getMemberRoles(this.entityType)},isTeamEntity(){return this.entityType===h.EntityTypes.team},confirmTitle(){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_MOVE_TO_ANOTHER_TEAM_POPUP_CONFIRM_TITLE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_POPUP_CONFIRM_TITLE")},confirmDescription(){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_USER_ACTION_MENU_MOVE_TO_ANOTHER_TEAM_POPUP_ACTION_SELECT_TEAM_DESCRIPTION"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_POPUP_ACTION_SELECT_DEPARTMENT_DESCRIPTION")}},methods:{createTagSelector(){return new i.TagSelector({events:{onTagAdd:t=>{this.accessDenied=false;const{tag:e}=t.data;this.selectedParentDepartment=e.id;if(r.PermissionChecker.hasPermission(this.action,e.id)){this.lockMoveUserActionButton=false;return}this.accessDenied=true;this.lockMoveUserActionButton=true},onTagRemove:()=>{this.lockMoveUserActionButton=true}},multiple:false,dialogOptions:{width:425,height:350,dropdownMode:true,hideOnDeselect:true,entities:[{id:"structure-node",options:{selectMode:"departmentsOnly",restricted:"addMember",includedNodeEntityTypes:this.includedNodeEntityTypesInDialog,useMultipleTabs:true}}],preselectedItems:[["structure-node",this.parentId]]}})},loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},async confirmMoveUser(){var t,e,n;this.showMoveUserActionLoader=true;const s=this.focusedNode;const i=this.user.id;const a=this.selectedParentDepartment;try{await U.moveUserToDepartment(s,i,a)}catch(t){var o;this.showMoveUserActionLoader=false;const e=(o=t.code)!=null?o:0;if(e==="MEMBER_ALREADY_BELONGS_TO_NODE"){this.showUserAlreadyBelongsToDepartmentPopup=true}else{const t=this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_USER_ACTION_MENU_MOVE_TO_ANOTHER_TEAM_ERROR"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_ERROR");E.UI.Notification.Center.notify({content:t,autoHideDelay:2e3});this.$emit("close")}return}const r=p.Text.encode((t=(e=this.departments.get(a))==null?void 0:e.name)!=null?t:"");const d=this.isTeamEntity?"HUMANRESOURCES_DEPARTMENT_CONTENT_TAB_USER_ACTION_MENU_MOVE_TO_ANOTHER_TEAM_SUCCESS_MESSAGE":"HUMANRESOURCES_DEPARTMENT_CONTENT_TAB_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_SUCCESS_MESSAGE";E.UI.Notification.Center.notify({content:this.loc(d,{"#DEPARTMENT_NAME#":r}),autoHideDelay:2e3});O.moveUserToDepartment(s,i,a,(n=this.user.role)!=null?n:this.memberRoles.employee);this.$emit("action");this.showMoveUserActionLoader=false},closeAction(){this.$emit("close")},closeUserAlreadyBelongsToDepartmentPopup(){this.showUserAlreadyBelongsToDepartmentPopup=false;this.closeAction()}},template:`\n\t\t<ConfirmationPopup\n\t\t\t@action="confirmMoveUser"\n\t\t\t@close="closeAction"\n\t\t\t:showActionButtonLoader="showMoveUserActionLoader"\n\t\t\t:lockActionButton="lockMoveUserActionButton"\n\t\t\t:title="confirmTitle"\n\t\t\t:confirmBtnText = "loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_POPUP_CONFIRM_BUTTON')"\n\t\t\t:width="364"\n\t\t>\n\t\t\t<template v-slot:content>\n\t\t\t\t<div class="hr-department-detail-content__user-action-text-container">\n\t\t\t\t\t<div v-html="getMoveUserActionPhrase"/>\n\t\t\t\t\t<span>\n\t\t\t\t\t\t{{confirmDescription}}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tclass="hr-department-detail-content__move-user-department-selector"\n\t\t\t\t\tref="department-selector"\n\t\t\t\t\t:class="{ 'ui-ctl-warning': accessDenied }"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tv-if="accessDenied"\n\t\t\t\t\tclass="hr-department-detail-content__move-user-department_item-error"\n\t\t\t\t>\n\t\t\t\t\t<div class="ui-icon-set --warning"></div>\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass="hr-department-detail-content__move-user-department_item-error-message"\n\t\t\t\t\t>\n\t\t\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_PERMISSION_ERROR')}}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</ConfirmationPopup>\n\t\t<ConfirmationPopup\n\t\t\t@action="closeUserAlreadyBelongsToDepartmentPopup"\n\t\t\t@close="closeUserAlreadyBelongsToDepartmentPopup"\n\t\t\tv-if="showUserAlreadyBelongsToDepartmentPopup"\n\t\t\t:withoutTitleBar = true\n\t\t\t:onlyConfirmButtonMode = true\n\t\t\t:confirmBtnText = "loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_ALREADY_BELONGS_TO_DEPARTMENT_CLOSE_BUTTON')"\n\t\t\t:width="300"\n\t\t>\n\t\t\t<template v-slot:content>\n\t\t\t\t<div class="hr-department-detail-content__user-action-text-container">\n\t\t\t\t\t<div \n\t\t\t\t\t\tclass="hr-department-detail-content__user-belongs-to-department-text-container"\n\t\t\t\t\t\tv-html="getUserAlreadyBelongsToDepartmentPopupPhrase"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class="hr-department-detail-content__move-user-department-selector" ref="department-selector"></div>\n\t\t\t</template>\n\t\t</ConfirmationPopup>\n\t`};const D={name:"userList",props:{user:{type:Object,required:true},departmentId:{type:Number,required:true}},components:{RouteActionMenu:m.RouteActionMenu,ConfirmationPopup:m.ConfirmationPopup,MoveUserActionPopup:P},data(){return{menuVisible:{},showRemoveUserConfirmationPopup:false,showRemoveUserConfirmationActionLoader:false,showMoveUserPopup:false,showFireUserPopup:false,fireUserLoad:false}},methods:{toggleMenu(t){this.menuVisible[t]=!this.menuVisible[t]},loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},onActionMenuItemClick(t){if(t===T.MenuActions.removeUserFromDepartment){this.showRemoveUserConfirmationPopup=true}if(t===T.MenuActions.moveUserToAnotherDepartment){this.showMoveUserPopup=true}if(t===T.MenuActions.fireUserFromCompany){this.showFireUserPopup=true}},async removeUser(){var t;this.showRemoveUserConfirmationActionLoader=true;const e=this.user.id;const n=await U.isUserInMultipleDepartments(e);const s=this.focusedNode;this.showRemoveUserConfirmationActionLoader=false;this.showRemoveUserConfirmationPopup=false;try{await U.removeUserFromDepartment(s,e)}catch{const t=this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_TEAM_ERROR"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_DEPARTMENT_ERROR");E.UI.Notification.Center.notify({content:t,autoHideDelay:2e3});return}const i=this.isTeamEntity?"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_TEAM_SUCCESS":"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_DEPARTMENT_SUCCESS";const a=p.Text.encode((t=this.departments.get(this.focusedNode).name)!=null?t:"");E.UI.Notification.Center.notify({content:this.loc(i,{"#DEPARTMENT_NAME#":a}),autoHideDelay:2e3});const o=this.user.role;if(n||this.isTeamEntity){O.removeUserFromDepartment(s,e,o);return}const r=[...this.departments.values()].find((t=>t.parentId===0));if(!r){return}O.moveUserToDepartment(s,e,r.id,o)},cancelRemoveUser(){this.showRemoveUserConfirmationPopup=false},async fireUser(){this.fireUserLoad=true;const t=this.user.id;try{await U.fireUser(t)}catch(t){if(t.code!=="STRUCTURE_ACCESS_DENIED"){E.UI.Notification.Center.notify({content:this.user.isInvited?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_DELETE_ERROR"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_FIRE_ERROR"),autoHideDelay:2e3})}this.showFireUserPopup=false;this.fireUserLoad=false;return}O.removeUserFromDepartment(this.focusedNode,t,this.user.role);await O.removeUserFromAllDepartments(t);this.showFireUserPopup=false;this.fireUserLoad=false},cancelFireUser(){this.showFireUserPopup=false},handleMoveUserAction(){this.showMoveUserPopup=false},handleMoveUserClose(){this.showMoveUserPopup=false},getMemberKeyByValue(t){return Object.keys(s.memberRoles).find((e=>s.memberRoles[e]===t))||""}},created(){this.menu=new T.UserListActionMenu(this.focusedNode,this.entityType,this.user.isInvited)},computed:{...A.mapState(C.useChartStore,["focusedNode","departments"]),memberRoles(){return s.memberRoles},getFirePopupDescription(){var t,e;const n=p.Text.encode((t=this.user.name)!=null?t:"");const s=p.Text.encode((e=this.user.url)!=null?e:"");const i=this.user.gender==="F"?"_F":"_M";const a=this.user.isInvited?`HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_DELETE_POPUP_DESCRIPTION${i}`:`HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_FIRE_POPUP_DESCRIPTION${i}`;const o=this.loc(a,{"#USER_NAME#":n});return o.replace("[link]",`<a class="hr-department-detail-content__fire-user-link" href="${s}">`).replace("[/link]","</a>")},getFirePopupTitle(){return this.user.isInvited?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_DELETE_POPUP_TITLE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_FIRE_POPUP_TITLE")},getFirePopupButtonText(){return this.user.isInvited?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_DELETE_POPUP_CONFIRM_BUTTON"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_FIRE_POPUP_CONFIRM_BUTTON")},getRemovePopupTitle(){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_TEAM_POPUP_TITLE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_DEPARTMENT_POPUP_TITLE")},getRemovePopupDescription(){var t,e;const n=p.Text.encode((t=this.departments.get(this.focusedNode).name)!=null?t:"");const s=p.Text.encode((e=this.user.name)!=null?e:"");if(this.isTeamEntity){const t="HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_TEAM_POPUP_DESCRIPTION";const e=this.user.gender==="F"?"_F":"_M";return this.loc(t+e,{"#USER_NAME#":s,"#DEPARTMENT_NAME#":n}).replace("[link]",`<a class="hr-department-detail-content__move-user-department-user-link" href="${this.user.url}">`).replace("[/link]","</a>")}return this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_DEPARTMENT_POPUP_DESCRIPTION")},entityType(){var t;return(t=this.departments.get(this.focusedNode))==null?void 0:t.entityType},isTeamEntity(){return this.entityType===h.EntityTypes.team}},template:`\n\t\t<button\n\t\t\tv-if="menu.items.length"\n\t\t\tclass="ui-icon-set --more hr-department-detail-content__user-action-btn"\n\t\t\t:class="{ '--focused': menuVisible[user.id] }"\n\t\t\t@click.stop="toggleMenu(user.id)"\n\t\t\tref="actionUserButton"\n\t\t\t:data-id="'hr-department-detail-content__'+ getMemberKeyByValue(user.role) + '-list_user-' + user.id + '-action-btn'"\n\t\t/>\n\t\t<RouteActionMenu\n\t\t\tv-if="menuVisible[user.id]"\n\t\t\t:id="'tree-node-department-menu-' + user.id"\n\t\t\t:items="menu.items"\n\t\t\t:width="302"\n\t\t\t:bindElement="$refs.actionUserButton"\n\t\t\t@action="onActionMenuItemClick"\n\t\t\t@close="menuVisible[user.id] = false"\n\t\t/>\n\t\t<ConfirmationPopup\n\t\t\tref="removeUserConfirmationPopup"\n\t\t\tv-if="showRemoveUserConfirmationPopup"\n\t\t\t:showActionButtonLoader="showRemoveUserConfirmationActionLoader"\n\t\t\t:title="getRemovePopupTitle"\n\t\t\t:confirmBtnText="loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_DEPARTMENT_POPUP_CONFIRM_BUTTON')"\n\t\t\t:confirmButtonClass="isTeamEntity ? 'ui-btn-danger' : 'ui-btn-primary'"\n\t\t\t@action="removeUser"\n\t\t\t@close="cancelRemoveUser"\n\t\t\t:width="364"\n\t\t>\n\t\t\t<template v-slot:content>\n\t\t\t\t<div class="hr-department-detail-content__user-action-text-container">\n\t\t\t\t<div\n\t\t\t\t\tv-html="getRemovePopupDescription"\n\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</ConfirmationPopup>\n\t\t<ConfirmationPopup\n\t\t\tref="fireUserConfirmationPopup"\n\t\t\tv-if="showFireUserPopup"\n\t\t\t:showActionButtonLoader="fireUserLoad"\n\t\t\t:title="getFirePopupTitle"\n\t\t\t:confirmBtnText="getFirePopupButtonText"\n\t\t\t:confirmButtonClass="'ui-btn-danger'"\n\t\t\t@action="fireUser"\n\t\t\t@close="cancelFireUser"\n\t\t\t:width="364"\n\t\t>\n\t\t\t<template v-slot:content>\n\t\t\t\t<div class="hr-department-detail-content__user-action-text-container">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-html="getFirePopupDescription"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</ConfirmationPopup>\n\t\t<MoveUserActionPopup\n\t\t\tv-if="showMoveUserPopup"\n\t\t\t:parentId="focusedNode"\n\t\t\t:user="user"\n\t\t\t:entityType="entityType"\n\t\t\t@action="handleMoveUserAction"\n\t\t\t@close="handleMoveUserClose"\n\t\t/>\n\t`};const f={name:"userList",emits:["itemDragStart"],props:{user:{type:Object,required:true},selectedUserId:{type:Number,required:false,default:null},entityType:{type:String,required:true},listType:{type:String,required:true},canDrag:{type:Boolean,default:false}},components:{UserListItemActionButton:D},computed:{memberRoles(){return s.getMemberRoles(this.entityType)},defaultAvatar(){return"/bitrix/js/humanresources/company-structure/org-chart/src/images/default-user.svg"},...A.mapState(C.useChartStore,["focusedNode"])},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},handleUserClick(t){BX.SidePanel.Instance.open(t.url,{cacheable:false})},handleMouseDown(t){t.preventDefault();this.$emit("itemDragStart",{userId:this.user.id,initialListType:this.listType,event:t,element:this.$el})}},template:`\n\t\t<div \n\t\t\t:key="user.id"\n\t\t\tclass="hr-department-detail-content__user-container"\n\t\t\t:class="{ '--searched': user.id === selectedUserId }"\n\t\t\t:data-id="'hr-department-detail-content__user-' + user.id + '-item'"\n\t\t>\n\t\t\t<span v-if="canDrag"\n\t\t\t\t  @mousedown="handleMouseDown"\n\t\t\t\t  class="hr-department-detail-content__dnd-icon ui-icon-set --more-points">\n\t\t\t</span>\n\t\t\t<div class="hr-department-detail-content__user-avatar-container" @click="handleUserClick(user)">\n\t\t\t\t<img \n\t\t\t\t\tclass="hr-department-detail-content__user-avatar-img"\n\t\t\t\t\t:src="user.avatar ? encodeURI(user.avatar) : defaultAvatar"\n\t\t\t\t    alt=""\n\t\t\t\t/>\n\t\t\t\t<div v-if="user.role === memberRoles.head" class="hr-department-detail-content__user-avatar-overlay"></div>\n\t\t\t</div>\n\t\t\t<div class="hr-department-detail-content-user__text-container">\n\t\t\t\t<div class="hr-department-detail-content__user-title">\n\t\t\t\t\t<div \n\t\t\t\t\t\tclass="hr-department-detail-content__user-name" \n\t\t\t\t\t\t@click="handleUserClick(user)"\n\t\t\t\t\t\t:bx-tooltip-user-id="user.id"\n\t\t\t\t\t\tbx-tooltip-context="b24"\n\t\t\t\t\t\t:data-id="'hr-department-detail-content__user-' + user.id + '-item-name'"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ user.name }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if="user.badgeText" class="hr-department-detail-content-user__name-badge">{{ user.badgeText }}</div>\n\t\t\t\t</div>\n\t\t\t\t<div \n\t\t\t\t\tclass="hr-department-detail-content__user-subtitle" \n\t\t\t\t\t:class="{ '--without-work-position': !user.subtitle }"\n\t\t\t\t>\n\t\t\t\t\t{{ (user.subtitle?.length ?? 0) > 0 ? user.subtitle : this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_LIST_DEFAULT_WORK_POSITION') }}\n\t\t\t\t</div>\n\t\t\t\t<div v-if="user.isInvited" class="hr-department-detail-content-user__item-badge">\n\t\t\t\t\t{{ this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_LIST_INVITED_BADGE_TEXT') }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<UserListItemActionButton\n\t\t\t\t:user="user"\n\t\t\t\t:departmentId="focusedNode"\n\t\t\t/>\n\t\t</div>\n\t`};const I={name:"emptyState",props:{title:{type:String,required:false},imageClass:{type:String,required:false},description:{type:String,required:false},list:{type:Array,required:false,default:[]}},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)}},template:`\n\t\t<div class="hr-department-detail-content_tab__empty-state-container">\n\t\t\t<div v-if="imageClass" :class="['hr-department-detail-content_tab__empty-state-icon', imageClass]"/>\n\t\t\t<span v-if="title" class="hr-department-detail-content__empty-tab-entity-title">\n\t\t\t\t{{ title }}\n\t\t\t</span>\n\t\t\t<span v-if="description" class="hr-department-detail-content_tab__empty-state-description">\n\t\t\t\t{{ description }}\n\t\t\t</span>\n\t\t\t<div v-if="list.length > 0" class="hr-department-detail-content_tab__empty-state-list">\n\t\t\t\t<div class="hr-department-detail-content_tab__empty-state-list-item"  v-for="item in list">\n\t\t\t\t\t<div \n\t\t\t\t\t\tclass="ui-icon-set --circle-check hr-department-detail-content_tab__empty-state-list-item-check"\n\t\t\t\t\t\tstyle="--ui-icon-set__icon-size: 20px;"\n\t\t\t\t\t/>\n\t\t\t\t\t<div class="hr-department-detail-content_tab__empty-state-list--item-text">\n\t\t\t\t\t\t{{ item.text }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<slot name="content"/>\n\t\t</div>\n\t`};const g={name:"tabEmptyListItem",props:{title:{type:String,required:true},imageClass:{type:String,required:true},withAddPermission:{type:Boolean,required:false,default:true}},template:`\n\t\t<div :class="['hr-department-detail-content__tab-empty-list_item-wrapper', { '--with-add': withAddPermission }]">\n\t\t\t<div class="hr-department-detail-content__tab-empty-list_item-image" :class="imageClass"/>\n\t\t\t<div class="hr-department-detail-content__tab-empty-list_item-content">\n\t\t\t\t<div class="hr-department-detail-content__tab-empty-list_item-title">\n\t\t\t\t\t{{ title }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const y={name:"userListActionButton",emits:["tabListAction","close"],props:{id:{type:String,required:true},menuItems:{type:Array,required:true},dataTestIds:{type:Object,required:false,default:{}}},components:{RouteActionMenu:m.RouteActionMenu},computed:{...A.mapState(C.useChartStore,["focusedNode"])},data(){return{menuVisible:false}},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},onActionMenuItemClick(t){this.$emit("tabListAction",t)}},template:`\n\t\t<button\n\t\t\tv-if="menuItems.length"\n\t\t\tclass="hr-department-detail-content__tab-list_header-button"\n\t\t\t:class="{ '--focused': menuVisible }"\n\t\t\t:ref="id + '-route-action-menu'"\n\t\t\t@click.stop="menuVisible = true"\n\t\t\t:data-test-id="dataTestIds.buttonDataTestId"\n\t\t>\n\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_LIST_ACTION_BUTTON_TITLE') }}\n\t\t</button>\n\t\t<RouteActionMenu\n\t\t\tv-if="menuVisible"\n\t\t\t:id="id + '-route-action-menu'"\n\t\t\t:items="menuItems"\n\t\t\t:width="302"\n\t\t\t:bindElement="$refs[id + '-route-action-menu']"\n\t\t\t:containerDataTestId="dataTestIds.containerDataTestId"\n\t\t\t@action="onActionMenuItemClick"\n\t\t\t@close="menuVisible = false"\n\t\t/>\n\t`};const v={name:"tabList",components:{ListActionButton:y,EmptyListItem:g},emits:["tabListAction"],props:{id:{type:String,required:true},title:{type:String,required:true},count:{type:Number,required:false},menuItems:{type:Array,required:false,default:[]},listItems:{type:Array,required:true},emptyItemTitle:{type:String,required:false},emptyItemImageClass:{type:String,required:false},hideEmptyItem:{type:Boolean,required:false,default:false},withAddPermission:{type:Boolean,required:false,default:true},dataTestIds:{type:Object,required:false,default:{}},isDropTarget:{type:Boolean,default:false},listType:{type:String}},data(){return{placeholderIndex:null,boundHandleDragOverList:null}},computed:{needToShowCount(){return p.Type.isNumber(this.count)}},watch:{isDropTarget(t,e){if(t===e){return}const n=this.$refs.itemsWrapper;if(!n){return}if(t){this.boundHandleDragOverList=p.Runtime.throttle(this.handleDragOverList.bind(this),10);p.Event.bind(n,"mousemove",this.boundHandleDragOverList);if(this.listItems.length===0){this.placeholderIndex=0}}else{p.Event.unbind(n,"mousemove",this.boundHandleDragOverList);this.boundHandleDragOverList=null;this.placeholderIndex=null}}},methods:{onActionMenuItemClick(t){this.$emit("tabListAction",t)},handleDragOverList(t){if(!this.isDropTarget||!this.$refs.itemsWrapper){if(this.placeholderIndex!==null){this.placeholderIndex=null}return}const e=this.$refs.itemsWrapper;const n=[...e.querySelectorAll(".hr-department-detail-content__user-container:not(.--dragging)")];const s=t.clientY;if(n.length===0){if(this.placeholderIndex!==0){this.placeholderIndex=0}return}let i=n.length;for(const[t,e]of n.entries()){const n=e.getBoundingClientRect();const a=n.top+n.height/2;if(s<a){i=t;break}}if(i!==this.placeholderIndex){this.placeholderIndex=i}}},template:`\n\t\t<div\n\t\t\tclass="hr-department-detail-content__tab-list_container"\n\t\t\t :data-test-id="dataTestIds.containerDataTestId"\n\t\t>\n\t\t\t<div class="hr-department-detail-content__tab-list_header-container">\n\t\t\t\t<div class="hr-department-detail-content__tab-list_list-title">\n\t\t\t\t\t{{ title }}\n\t\t\t\t\t<span\n\t\t\t\t\t\tv-if="needToShowCount"\n\t\t\t\t\t\tclass="hr-department-detail-content__tab-list_header-count"\n\t\t\t\t\t\t:data-test-id="dataTestIds.listCounterDataTestId"\n\t\t\t\t\t>\n\t\t\t\t\t{{ count }}\n\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<ListActionButton\n\t\t\t\t\t:id="id"\n\t\t\t\t\t:menuItems="menuItems"\n\t\t\t\t\t@tabListAction="onActionMenuItemClick"\n\t\t\t\t\t:dataTestIds="{buttonDataTestId: dataTestIds.listActionButtonDataTestId, containerDataTestId: dataTestIds.listActonMenuDataTestId}"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class="hr-department-detail-content__tab_list-container" ref="itemsWrapper">\n\t\t\t\t<div\n\t\t\t\t\tv-if="placeholderIndex === 0 && isDropTarget"\n\t\t\t\t\tclass="hr-department-detail-content__drop-placeholder"\n\t\t\t\t></div>\n\t\t\t\t<template v-for="(item, index) in listItems" :key="item.id">\n\t\t\t\t\t<slot :item="item"\n\t\t\t\t\t/>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="placeholderIndex === (index + 1) && isDropTarget"\n\t\t\t\t\t\tclass="hr-department-detail-content__drop-placeholder"\n\t\t\t\t\t></div>\n\t\t\t\t</template>\n\t\t\t\t<slot name="footer" />\n\t\t\t\t<EmptyListItem v-if="emptyItemTitle && emptyItemImageClass && !listItems.length && !hideEmptyItem"\n\t\t\t\t\t:title="emptyItemTitle"\n\t\t\t\t\t:imageClass="emptyItemImageClass"\n\t\t\t\t\t:withAddPermission="withAddPermission"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`};const b={name:"searchInput",props:{value:{type:String,required:false,default:""},placeholder:{type:String,required:true},dataTestId:{type:String,required:false}},data(){return{hasFocus:false}},methods:{handleInput(t){this.$emit("inputChange",t.target.value)},handleBlur(){if(this.value.length===0){this.hasFocus=false}},clearInput(){this.hasFocus=false;this.$emit("inputChange","")}},template:`\n\t\t<div\n\t\t\tclass="hr-department-detail-content__content-search"\n\t\t\t:class="{'--focused': hasFocus}"\n\t\t>\n\t\t\t<div class="hr-department-detail-content__content-search-icon ui-icon-set --search-1"/>\n\t\t\t<input\n\t\t\t\tclass="hr-department-detail-content__content-search-input"\n\t\t\t\ttype="text"\n\t\t\t\t:placeholder="!hasFocus ?  placeholder : ''"\n\t\t\t\t:data-test-id="dataTestId"\n\t\t\t\t:value="value"\n\t\t\t\t@input="handleInput"\n\t\t\t\t@focus="hasFocus = true"\n\t\t\t\t@blur="handleBlur"\n\t\t\t>\n\t\t\t<div\n\t\t\t\tclass="hr-department-detail-content__content-search-close-button ui-icon-set --cross-circle-50"\n\t\t\t\t:class="{'--hide': !hasFocus}"\n\t\t\t\t@click="clearInput"\n\t\t\t/>\n\t\t</div>\n\t`};const L=70;const H={name:"usersTab",components:{SearchInput:b,EmptyState:I,TabList:v,EmptyTabAddButton:S,UserListItem:f,MoveEmployeeConfirmationPopup:m.MoveEmployeeConfirmationPopup},emits:["showDetailLoader","hideDetailLoader"],data(){return{searchQuery:"",selectedUserId:null,needToScroll:false,dragState:this.getInitialDragState(),showDndConfirmationPopup:false,dndPreviousState:null,dndPopupDescription:"",boundHandleDragMove:null,boundHandleDragEnd:null}},computed:{memberRoles(){return s.getMemberRoles(this.entityType)},heads(){var t;return(t=this.departments.get(this.focusedNode).heads)!=null?t:[]},headCount(){var t;return(t=this.heads.length)!=null?t:0},departmentId(){return this.focusedNode},formattedHeads(){return this.heads.map((t=>({...t,subtitle:t.workPosition,badgeText:this.getBadgeText(t.role)}))).sort(((t,e)=>{const n={[this.memberRoles.head]:1,[this.memberRoles.deputyHead]:2};const s=n[t.role]||3;const i=n[e.role]||3;return s-i}))},filteredHeads(){return this.formattedHeads.filter((t=>{var e;return t.name.toLowerCase().includes(this.searchQuery.toLowerCase())||((e=t.workPosition)==null?void 0:e.toLowerCase().includes(this.searchQuery.toLowerCase()))}))},employeeCount(){var t,e;const n=(t=this.departments.get(this.focusedNode).userCount)!=null?t:0;return n-((e=this.headCount)!=null?e:0)},formattedEmployees(){return this.employees.map((t=>({...t,subtitle:t.workPosition}))).reverse()},filteredEmployees(){return this.formattedEmployees.filter((t=>{var e;return t.name.toLowerCase().includes(this.searchQuery.toLowerCase())||((e=t.workPosition)==null?void 0:e.toLowerCase().includes(this.searchQuery.toLowerCase()))}))},memberCount(){var t;return(t=this.departments.get(this.focusedNode).userCount)!=null?t:0},...A.mapState(C.useChartStore,["focusedNode","departments","searchedUserId"]),...A.mapWritableState(C.useChartStore,["searchedUserId"]),employees(){var t,e;return(t=(e=this.departments.get(this.focusedNode))==null?void 0:e.employees)!=null?t:[]},showSearchBar(){return this.memberCount>0},showSearchEmptyState(){return this.filteredHeads.length===0&&this.filteredEmployees.length===0},canAddUsers(){const t=r.PermissionChecker.getInstance();if(!t){return false}const e=this.focusedNode;const n=this.isTeamEntity?r.PermissionActions.teamAddMember:r.PermissionActions.employeeAddToDepartment;return t.hasPermission(n,e)},headListEmptyStateTitle(){if(this.canAddUsers){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_TEAM_HEAD_EMPTY_LIST_ITEM_TITLE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_HEAD_EMPTY_LIST_ITEM_TITLE")}return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_TEAM_HEAD_EMPTY_LIST_ITEM_TITLE_WITHOUT_ADD_PERMISSION"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_HEAD_EMPTY_LIST_ITEM_TITLE_WITHOUT_ADD_PERMISSION")},employeesListEmptyStateTitle(){if(this.canAddUsers){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_TEAM_EMPLOYEE_EMPTY_LIST_ITEM_TITLE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_EMPLOYEE_EMPTY_LIST_ITEM_TITLE")}return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_TEAM_EMPLOYEE_EMPTY_LIST_ITEM_TITLE_WITHOUT_ADD_PERMISSION"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_EMPLOYEE_EMPTY_LIST_ITEM_TITLE_WITHOUT_ADD_PERMISSION")},shouldUpdateList(){var t,e;return(t=(e=this.departments.get(this.focusedNode).employeeListOptions)==null?void 0:e.shouldUpdateList)!=null?t:true},departmentUsersStatus(){const t=this.departments.get(this.focusedNode);if(t!=null&&t.heads&&t.employees){return{departmentId:this.focusedNode,loaded:true}}return{departmentId:this.focusedNode,loaded:false}},headMenu(){return new T.UsersTabActionMenu(this.focusedNode,s.AnalyticsSourceType.DETAIL,"head",this.entityType)},employeeMenu(){return new T.UsersTabActionMenu(this.focusedNode,s.AnalyticsSourceType.DETAIL,"employee",this.entityType)},isEmployeeListOptionsSet(){const t=this.departments.get(this.focusedNode)||{};return t.employeeListOptions&&Object.keys(t.employeeListOptions).length>0},employeeTitle(){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_TEAM_EMPLOYEE_LIST_TITLE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_EMPLOYEE_LIST_TITLE")},entityType(){var t;return(t=this.departments.get(this.focusedNode))==null?void 0:t.entityType},isTeamEntity(){return this.entityType===h.EntityTypes.team},emptyStateTitle(){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_EMPLOYEES_TEAM_ADD_USER_TITLE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_EMPLOYEES_ADD_USER_TITLE")},emptyStateDescription(){if(this.canAddUsers){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_EMPLOYEES_TEAM_ADD_USER_SUBTITLE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_EMPLOYEES_ADD_USER_SUBTITLE")}return this.isTeamEntity?"":this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_EMPLOYEES_ADD_USER_SUBTITLE")},isHeadListPotentialTarget(){return this.dragState.isDragging&&this.dragState.initialList==="employees"},isEmployeeListPotentialTarget(){return this.dragState.isDragging&&(this.dragState.initialList==="head"||this.dragState.initialList==="deputyHead")},dndConfirmationPopupTitle(){const t=this.dragState.targetList==="head";return t?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_DND_POPUP_CONFIRM_TITLE_TO_HEAD"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_DND_POPUP_CONFIRM_TITLE")},dndConfirmationPopupBtn(){const t=this.dragState.targetList==="head";return t?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_DND_POPUP_CONFIRM_BTN_TO_HEAD"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_DND_POPUP_CONFIRM_BTN")},showDndRoleSelect(){return this.dragState.targetList==="head"},headListTitle(){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_TEAM_HEAD_LIST_TITLE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_HEAD_LIST_TITLE")}},watch:{focusedNode(t){const e=this.departments.get(t)||{};if(!this.isEmployeeListOptionsSet){const n={page:0,shouldUpdateList:true,isListUpdated:false};O.updateEmployeeListOptions(t,n);this.departments.set(t,e)}if(e.employeeListOptions.page===0&&e.employeeListOptions.isListUpdated===false&&e.employeeListOptions.shouldUpdateList===true){this.loadEmployeesAction()}this.isDescriptionExpanded=false;this.searchQuery="";if(this.searchedUserId){this.needToFocusUserId=this.searchedUserId;this.$nextTick((()=>{this.scrollToUser()}))}},searchedUserId:{handler(t){if(!t){return}this.needToFocusUserId=t;if(this.isListUpdated){this.needToScroll=true}else{this.$nextTick((()=>{this.scrollToUser()}))}},immediate:true},async searchQuery(t){await this.searchMembers(t)},departmentUsersStatus(t,e){const{departmentId:n,loaded:s}=t;const{departmentId:i,loaded:a}=e;if(n===i&&s===a){return}if(s){this.$emit("hideDetailLoader")}else{this.$emit("showDetailLoader");this.loadEmployeesAction()}}},created(){this.loadEmployeesAction();this.clearSearchTimeout=null;this.autoscrollIntervalId=null;this.boundHandleDragMove=this.handleDragMove.bind(this);this.boundHandleDragEnd=this.handleDragEnd.bind(this)},mounted(){this.tabContainer=this.$refs["tab-container"]},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},getBadgeText(t){if(t===this.memberRoles.head){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPLOYEES_TEAM_HEAD_BADGE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPLOYEES_HEAD_BADGE")}if(t===this.memberRoles.deputyHead){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPLOYEES_TEAM_DEPUTY_HEAD_BADGE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPLOYEES_DEPUTY_HEAD_BADGE")}return null},updateList(t){const e=t.target;const n=e.scrollTop+e.clientHeight;if(e.scrollHeight-n<40){this.loadEmployeesAction()}},async loadEmployeesAction(){var t,e,n,s,i,a;const o=this.focusedNode;if(!this.departments.get(o)){return}const r=(t=this.departments.get(o).employeeListOptions)!=null?t:{};r.page=(e=r.page)!=null?e:0;r.shouldUpdateList=(n=r.shouldUpdateList)!=null?n:true;r.isListUpdated=(s=r.isListUpdated)!=null?s:false;O.updateEmployeeListOptions(o,r);if(r.isListUpdated||!r.shouldUpdateList){return}if(!r.isListUpdated&&r.page===0&&r.shouldUpdateList===true){this.$emit("showDetailLoader")}r.isListUpdated=true;r.page+=1;O.updateEmployeeListOptions(o,r);let d=await U.getPagedEmployees(o,r.page,25);if(!d){r.shouldUpdateList=false;r.isListUpdated=false;O.updateEmployeeListOptions(o,r);return}d=d.map((t=>({...t,role:this.memberRoles.employee})));const l=(i=(a=this.departments.get(o))==null?void 0:a.employees)!=null?i:[];const c=new Set(l.map((t=>t.id)));const _=d.reverse().filter((t=>!c.has(t.id)));l.unshift(..._);r.shouldUpdateList=_.length===25;r.isListUpdated=false;O.updateEmployeeListOptions(o,r);O.updateEmployees(o,l);if(this.departmentUsersStatus.loaded){this.$emit("hideDetailLoader")}if(this.needToScroll){this.scrollToUser()}},async scrollToUser(){const t=this.needToFocusUserId;this.needToFocusUserId=null;this.needToScroll=false;const e=`.hr-department-detail-content__user-container[data-id="hr-department-detail-content__user-${t}-item"]`;let n=this.tabContainer.querySelector(e);if(!n){let a=null;try{a=await U.getUserInfo(this.focusedNode,t)}catch{}const o=this.departments.get(this.focusedNode);if(!a||!o){return}if(a.role===this.memberRoles.head||a.role===this.memberRoles.deputyHead){var s;o.heads=(s=o.heads)!=null?s:[];if(!o.heads.some((t=>t.id===a.id))){return}}else{var i;o.employees=(i=o.employees)!=null?i:[];if(!o.employees.some((t=>t.id===a.id))){o.employees.push(a)}}await this.$nextTick((()=>{n=this.tabContainer.querySelector(e)}))}if(!n){return}n.scrollIntoView({behavior:"smooth",block:"center"});setTimeout((()=>{this.selectedUserId=t}),750);if(this.clearSearchTimeout){clearTimeout(this.clearSearchTimeout)}this.clearSearchTimeout=setTimeout((()=>{if(this.searchedUserId===t){this.selectedUserId=null;this.searchedUserId=null}}),4e3)},async searchMembers(t){if(t.length===0){return}this.findQueryResult=this.findQueryResult||{};this.findQueryResult[this.focusedNode]=this.findQueryResult[this.focusedNode]||{success:[],failure:[]};const e=this.findQueryResult[this.focusedNode];if(e.failure.some((e=>t.startsWith(e)))){return}if(e.success.includes(t)||e.failure.includes(t)){return}const n=await U.findMemberByQuery(this.focusedNode,t);if(n.length===0){e.failure.push(t);return}const s=this.departments.get(this.focusedNode);const i=n.filter((t=>!s.heads.some((e=>e.id===t.id))&&!s.employees.some((e=>e.id===t.id))));s.employees.push(...i);e.success.push(t)},searchUser(t){this.searchQuery=t},onHeadListActionMenuItemClick(t){this.headMenu.onActionMenuItemClick(t)},onEmployeeListActionMenuItemClick(t){this.employeeMenu.onActionMenuItemClick(t)},getHeadListDataTestIds(){return N},getEmployeeListDataTestIds(){return R},handleItemDragStart(t){if(this.dragState.isDragging){return}const{event:e,element:n,userId:s,initialListType:i}=t;e.preventDefault();this.dragState.isDragging=true;this.dragState.userId=s;this.dragState.initialList=i;this.dragState.draggedElement=n;const a=this.dragState.draggedElement.getBoundingClientRect();this.dragState.offsetX=e.clientX-a.left;this.dragState.offsetY=e.clientY-a.top;const o=this.dragState.draggedElement.cloneNode(true);p.Dom.addClass(o,"--ghost");p.Dom.style(o,"left",`${e.clientX-this.dragState.offsetX}px`);p.Dom.style(o,"top",`${e.clientY-this.dragState.offsetY}px`);p.Dom.append(o,document.body);this.dragState.ghostElement=o;p.Dom.addClass(this.dragState.draggedElement,"--dragging");p.Dom.addClass(document.body,"--user-dragging");p.Event.bind(document,"mousemove",this.boundHandleDragMove);p.Event.bind(document,"mouseup",this.boundHandleDragEnd);const r=this.formattedHeads.find((t=>t.id===s))||this.formattedEmployees.find((t=>t.id===s));c.EventEmitter.emit(T.events.HR_USER_DRAG_START,{user:r})},handleDragMove(t){var e,n;if(!this.dragState.isDragging){return}p.Dom.addClass(this.dragState.draggedElement,"--hidden");c.EventEmitter.emit(T.events.HR_USER_DRAG_MOVE,{pageX:t.pageX,pageY:t.pageY});if(this.dragState.ghostElement){p.Dom.style(this.dragState.ghostElement,"left",`${t.clientX-this.dragState.offsetX}px`);p.Dom.style(this.dragState.ghostElement,"top",`${t.clientY-this.dragState.offsetY}px`)}let s=null;if(this.isHeadListPotentialTarget&&this.isPointerOverElement(t,(e=this.$refs.headList)==null?void 0:e.$el)){s="head"}else if(this.isEmployeeListPotentialTarget&&this.isPointerOverElement(t,(n=this.$refs.employeeList)==null?void 0:n.$el)){s="employee"}this.dragState.targetList=s;this.handleAutoscrollOnDrag(t)},handleAutoscrollOnDrag(t){if(!this.isHeadListPotentialTarget){return}const e=this.$refs.scrollableContainer;if(!e){return}const n=e.getBoundingClientRect();const s=t.clientY;const i=n.top+L;if(s<i){if(this.autoscrollIntervalId!==null){return}const t=10;this.autoscrollIntervalId=setInterval((()=>{e.scrollTop-=t}),16)}else{this.stopAutoscroll()}},stopAutoscroll(){if(this.autoscrollIntervalId!==null){clearInterval(this.autoscrollIntervalId);this.autoscrollIntervalId=null}},isPointerOverElement(t,e){if(!e){return false}const n=e.getBoundingClientRect();return t.clientX>=n.left&&t.clientX<=n.right&&t.clientY>=n.top&&t.clientY<=n.bottom},async handleDragEnd(){if(!this.dragState.isDragging){return}c.EventEmitter.emit(T.events.HR_USER_DRAG_DROP);this.stopAutoscroll();const{userId:t,initialList:e,targetList:n,ghostElement:s,draggedElement:i}=this.dragState;const a=t&&n&&n!==e;let o=null;if(a){const t=n==="head"?this.$refs.headList:this.$refs.employeeList;o=t==null?void 0:t.placeholderIndex}p.Event.unbind(document,"mousemove",this.boundHandleDragMove);p.Event.unbind(document,"mouseup",this.boundHandleDragEnd);if(s){p.Dom.remove(s)}if(i){p.Dom.removeClass(i,"--dragging");p.Dom.removeClass(i,"--hidden")}p.Dom.removeClass(document.body,"--user-dragging");c.EventEmitter.emit(T.events.HR_USER_DRAG_END);if(!a||o===null){this.dragState=this.getInitialDragState();return}this.dragState.isDragging=false;this.dragState.ghostElement=null;this.dragState.draggedElement=null;this.dragState.context={targetIndex:o};this.dndPreviousState=this.moveDndUser();if(!this.dndPreviousState){this.dragState=this.getInitialDragState();return}const{context:r}=this.dragState;r.selectedRole=null;r.selectedRoleLabel="";if(n==="head"){r.selectedRole=this.memberRoles.head;r.selectedRoleLabel=this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPLOYEES_HEAD_BADGE")}await this.prepareDndPopupDescription();this.showDndConfirmationPopup=true},cancelDndUserMove(){const{heads:t,employees:e}=this.dndPreviousState;O.updateHeads(this.focusedNode,t);O.updateEmployees(this.focusedNode,e);this.dndPreviousState=null;this.dragState=this.getInitialDragState();this.showDndConfirmationPopup=false},async confirmDndUserMove(t){const{userId:n}=this.dragState;const s=t.role||this.memberRoles.employee;const i=this.departments.get(this.focusedNode);const a=i.heads.find((t=>t.id===n))||i.employees.find((t=>t.id===n));if(!a){this.dragState=this.getInitialDragState();return}const o=a.role;a.role=s;try{await e.UserManagementDialogAPI.addUsersToDepartment(this.focusedNode,[n],s);E.UI.Notification.Center.notify({content:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_DND_SUCCESS"),autoHideDelay:3e3})}catch(t){console.error(t);a.role=o;this.cancelDndUserMove()}this.showDndConfirmationPopup=false;this.dragState=this.getInitialDragState()},async prepareDndPopupDescription(){var t,e,n,s,i;const{userId:a,targetList:o}=this.dragState;const r=o==="head";const d=this.isTeamEntity;const l=this.departments.get(this.departmentId);const c=p.Text.encode((t=l==null?void 0:l.name)!=null?t:"");let _=null;try{_=await U.getUserInfo(this.departmentId,a)}catch{}const T=p.Text.encode((e=(n=_)==null?void 0:n.name)!=null?e:"");const h=(s=(i=_)==null?void 0:i.url)!=null?s:"#";let E="";if(r){E=d?"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_DND_POPUP_CONFIRM_DESC_TO_TEAM_HEAD":"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_DND_POPUP_CONFIRM_DESC_TO_HEAD"}else{var u;const t=d?"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_DND_POPUP_CONFIRM_DESC_TEAM":"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_DND_POPUP_CONFIRM_DESC";const e=((u=_)==null?void 0:u.gender)==="F"?"_F":"_M";E=t+e}this.dndPopupDescription=this.loc(E,{"#USER_NAME#":T,"#DEPARTMENT_NAME#":c}).replace("[link]",`<a class="hr-department-detail-content__move-user-department-user-link" href="${h}">`).replace("[/link]","</a>")},moveDndUser(){const{userId:t,targetList:e,context:n}=this.dragState;const{targetIndex:s}=n;const i=this.departments.get(this.focusedNode);if(!i){return null}const a={heads:[...i.heads],employees:[...i.employees]};const o=e==="head";const r=o?[...a.employees]:[...a.heads];const d=o?[...a.heads]:[...a.employees];const l=r.findIndex((e=>e.id===t));if(l===-1){return null}const[c]=r.splice(l,1);d.splice(s,0,c);if(o){O.updateHeads(this.focusedNode,d);O.updateEmployees(this.focusedNode,r)}else{O.updateHeads(this.focusedNode,r);O.updateEmployees(this.focusedNode,d)}return a},getInitialDragState(){return{isDragging:false,userId:null,initialList:null,targetList:null,ghostElement:null,draggedElement:null,offsetX:0,offsetY:0,context:null}}},template:`\n\t\t<div class="hr-department-detail-content__tab-container --users" ref="tab-container">\n\t\t\t<template v-if="memberCount > 0">\n\t\t\t\t<SearchInput\n\t\t\t\t\tv-if="showSearchBar"\n\t\t\t\t\t:placeholder="loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_SEARCH_PLACEHOLDER')"\n\t\t\t\t\t:value="searchQuery"\n\t\t\t\t\t@inputChange="searchUser"\n\t\t\t\t\tdataTestId="hr-department-detail-content_users-tab__users-search-input"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tv-if="!showSearchEmptyState"\n\t\t\t\t\tv-on="shouldUpdateList ? { scroll: updateList } : {}"\n\t\t\t\t\tclass="hr-department-detail-content__lists-container"\n\t\t\t\t\tref="scrollableContainer"\n\t\t\t\t>\n\t\t\t\t\t<TabList\n\t\t\t\t\t\tref="headList"\n\t\t\t\t\t\tid='hr-department-detail-content_chats-tab__chat-list'\n\t\t\t\t\t\t:title="headListTitle"\n\t\t\t\t\t\t:count="headCount"\n\t\t\t\t\t\t:menuItems="headMenu.items"\n\t\t\t\t\t\t:listItems="filteredHeads"\n\t\t\t\t\t\tlistType="head"\n\t\t\t\t\t\t:emptyItemTitle="headListEmptyStateTitle"\n\t\t\t\t\t\temptyItemImageClass="hr-department-detail-content__empty-user-list-item-image"\n\t\t\t\t\t\t:hideEmptyItem="searchQuery.length > 0"\n\t\t\t\t\t\t:withAddPermission="canAddUsers"\n\t\t\t\t\t\t@tabListAction="onHeadListActionMenuItemClick"\n\t\t\t\t\t\t:dataTestIds="getHeadListDataTestIds()"\n\t\t\t\t\t\t:isDropTarget="isHeadListPotentialTarget && dragState.targetList === 'head'"\n\t\t\t\t\t>\n\t\t\t\t\t\t<template v-slot="{ item }">\n\t\t\t\t\t\t\t<UserListItem\n\t\t\t\t\t\t\t\t:user="item"\n\t\t\t\t\t\t\t\tlistType="head"\n\t\t\t\t\t\t\t\t:selectedUserId="selectedUserId"\n\t\t\t\t\t\t\t\t:entityType="entityType"\n\t\t\t\t\t\t\t\t:canDrag="canAddUsers"\n\t\t\t\t\t\t\t\t@itemDragStart="handleItemDragStart"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</TabList>\n\t\t\t\t\t<TabList\n\t\t\t\t\t\tref="employeeList"\n\t\t\t\t\t\tid='hr-department-detail-content_chats-tab__channel-list'\n\t\t\t\t\t\t:title="employeeTitle"\n\t\t\t\t\t\t:count="employeeCount"\n\t\t\t\t\t\tlistType="employees"\n\t\t\t\t\t\t:menuItems="employeeMenu.items"\n\t\t\t\t\t\t:listItems="filteredEmployees"\n\t\t\t\t\t\t:emptyItemTitle="employeesListEmptyStateTitle"\n\t\t\t\t\t\temptyItemImageClass="hr-department-detail-content__empty-user-list-item-image"\n\t\t\t\t\t\t:hideEmptyItem="searchQuery.length > 0"\n\t\t\t\t\t\t:withAddPermission="canAddUsers"\n\t\t\t\t\t\t@tabListAction="onEmployeeListActionMenuItemClick"\n\t\t\t\t\t\t:dataTestIds="getEmployeeListDataTestIds()"\n\t\t\t\t\t\t:isDropTarget="isEmployeeListPotentialTarget && dragState.targetList === 'employee'"\n\t\t\t\t\t>\n\t\t\t\t\t\t<template v-slot="{ item }">\n\t\t\t\t\t\t\t<UserListItem\n\t\t\t\t\t\t\t\t:user="item"\n\t\t\t\t\t\t\t\tlistType="employees"\n\t\t\t\t\t\t\t\t:canDrag="canAddUsers"\n\t\t\t\t\t\t\t\t@itemDragStart="handleItemDragStart"\n\t\t\t\t\t\t\t\t:selectedUserId="selectedUserId"\n\t\t\t\t\t\t\t\t:entityType="entityType"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</TabList>\n\t\t\t\t</div>\n\t\t\t\t<EmptyState v-else\n\t\t\t\t\timageClass="hr-department-detail-content__empty-tab-user-not-found-icon"\n\t\t\t\t\t:title="loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_SEARCHED_EMPLOYEES_TITLE')"\n\t\t\t\t\t:description ="loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_SEARCHED_EMPLOYEES_SUBTITLE')"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<EmptyState v-else\n\t\t\t\t:imageClass="canAddUsers \n\t\t\t\t\t? 'hr-department-detail-content__empty-tab-add-user-icon' \n\t\t\t\t\t: 'hr-department-detail-content__empty-tab-cant-add-user-icon'"\n\t\t\t\t:title="emptyStateTitle"\n\t\t\t\t:description ="emptyStateDescription"\n\t\t\t>\n\t\t\t\t<template v-slot:content>\n\t\t\t\t\t<EmptyTabAddButton v-if="canAddUsers" :departmentId="departmentId" :entityType="entityType"/>\n\t\t\t\t</template>\n\t\t\t</EmptyState>\n\t\t\t<MoveEmployeeConfirmationPopup \n\t\t\t\tv-if="showDndConfirmationPopup" \n\t\t\t\t:title="dndConfirmationPopupTitle"\n\t\t\t\t:description="dndPopupDescription"\n\t\t\t\t:confirmButtonText="dndConfirmationPopupBtn"\n\t\t\t\t:showRoleSelect="showDndRoleSelect"\n\t\t\t\t:excludeEmployeeRole="true"\n\t\t\t\t:entityType="entityType"\n\t\t\t\t@confirm="confirmDndUserMove"\n\t\t\t\t@close="cancelDndUserMove"\n\t\t\t/>\n\t\t</div>\n\t`};const B=Object.freeze({withChildren:"withChildren",withoutChildren:"withoutChildren"});const Y={name:"childrenModeSelector",components:{RouteActionMenu:m.RouteActionMenu},props:{isTeamEntity:{type:Boolean,required:true},dataTestId:{type:String,required:true},hasPermission:{type:Boolean,required:true},text:{type:String,required:true}},emits:["saveChildrenMode"],data(){return{menuVisible:false,withChildren:false}},computed:{getControlButtonText(){return this.getValueText(this.withChildren)}},created(){this.menuItems=this.getMenuItems()},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},showMenu(){if(this.hasPermission){this.menuVisible=true}},onActionMenuItemClick(t){if(this.hasPermission){this.withChildren=t===B.withChildren;this.$emit("saveChildrenMode",this.withChildren)}},getMenuItems(){return[{id:B.withoutChildren,title:this.getValueText(false),itemClass:"hr-department-detail-content__children-mode-selector_menu-item"},{id:B.withChildren,title:this.getValueText(true),itemClass:"hr-department-detail-content__children-mode-selector_menu-item"}]},getValueText(t){if(this.isTeamEntity){return t?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_WITH_SUBTEAMS_LABEL"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_ONLY_TEAM_LABEL")}return t?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_WITH_SUBDEPARTMENTS_LABEL"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_ONLY_DEPARTMENT_LABEL")}},template:`\n\t\t<div class="hr-department-detail-content__change-save-mode-control-container">\n\t\t\t<span>{{ text }}</span>\n\t\t\t<a\n\t\t\t\tclass="hr-department-detail-content__change-save-mode-control-button"\n\t\t\t\t:class="{ '--focused': menuVisible, '--disabled': !hasPermission }"\n\t\t\t\t:data-test-id="dataTestId"\n\t\t\t\tref='saveChildrenModeButton'\n\t\t\t\t@click="showMenu"\n\t\t\t>\n\t\t\t\t{{ getControlButtonText }}\n\t\t\t</a>\n\t\t</div>\n\t\t<RouteActionMenu\n\t\t\tv-if="menuVisible"\n\t\t\t:id="'hr-department-detail-children-mode-selector-menu'"\n\t\t\t:items="menuItems"\n\t\t\t:delimiter="false"\n\t\t\t:width="302"\n\t\t\t:bindElement="$refs.saveChildrenModeButton"\n\t\t\t@action="onActionMenuItemClick"\n\t\t\t@close="menuVisible = false"\n\t\t/>\n\t`};const w=Object.freeze({linkChat:"linkChat",linkChannel:"linkChannel"});const k=Object.freeze({id:w.linkChat,title:p.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_LIST_LINK_BUTTON_TITLE"),description:p.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_LIST_LINK_BUTTON_DESC"),bIcon:{name:d.Main.CHAT_MESSAGE,size:20,colorTokenName:"paletteBlue50"},dataTestId:"hr-department-content_chats-tab__chat-list-action-link"});const x=Object.freeze({id:w.linkChannel,title:p.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_LIST_LINK_BUTTON_TITLE"),description:p.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_LIST_LINK_BUTTON_DESC"),bIcon:{name:d.Main.SPEAKER_MOUTHPIECE,size:20,colorTokenName:"paletteBlue50"},dataTestId:"hr-department-content_chats-tab__channel-list-action-link"});const F=Object.freeze({containerDataTestId:"hr-department-content_chats-tab__chat-list-container",listActionButtonDataTestId:"hr-department-content_chats-tab__chat-list-action-button",listActonMenuDataTestId:"hr-department-content_chats-tab__chat-list-action-menu-container",listCounterDataTestId:"hr-department-content_chats-tab__chat-list-counter"});const V=Object.freeze({containerDataTestId:"hr-department-content_chats-tab__channel-list-container",listActionButtonDataTestId:"hr-department-content_chats-tab__channel-list-action-button",listActonMenuDataTestId:"hr-department-content_chats-tab__channel-list-action-menu-container",listCounterDataTestId:"hr-department-content_chats-tab__channel-list-counter"});const $=Object.freeze({containerDataTestId:"hr-department-content_chats-tab__link-chat-container",confirmButtonDataTestId:"hr-department-content_chats-tab__link-chat-confirm-button",cancelButtonDataTestId:"hr-department-content_chats-tab__link-chat-cancel-button",closeButtonDataTestId:"hr-department-content_chats-tab__link-chat-close-button",addWithChildrenDataTestId:"hr-department-content_chats-tab__link-chat-add-with-children"});const X=Object.freeze({containerDataTestId:"hr-department-content_chats-tab__link-channel-container",confirmButtonDataTestId:"hr-department-content_chats-tab__link-channel-confirm-button",cancelButtonDataTestId:"hr-department-content_chats-tab__link-channel-cancel-button",closeButtonDataTestId:"hr-department-content_chats-tab__link-channel-close-button",addWithChildrenDataTestId:"hr-department-content_chats-tab__link-channel-add-with-children"});const q={name:"emptyStateButtons",emits:["emptyStateAddAction"],components:{RouteActionMenu:m.RouteActionMenu},data(){return{chatMenuVisible:false,channelMenuVisible:false,chatButtonId:"hr-empty-tab-chat-add-button",channelButtonId:"hr-empty-tab-chat-add-button"}},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},onChatButtonClick(){this.$emit("emptyStateAddAction",w.linkChat)},onChannelButtonClick(){this.$emit("emptyStateAddAction",w.linkChannel)}},template:`\n\t\t<div class="hr-department-detail-content__chat-empty-tab-add_buttons-container">\n\t\t\t<button\n\t\t\t\t:ref="chatButtonId"\n\t\t\t\tclass="ui-btn ui-btn-light-border ui-btn-no-caps ui-btn-round ui-btn-sm hr-department-detail-content__chat-empty-tab-add_chat-button"\n\t\t\t\t@click.stop="this.onChatButtonClick()"\n\t\t\t\tdata-test-id="hr-department-detail-content_chats-tab__empty-tab-add_chat-button"\n\t\t\t>\n\t\t\t\t<div class="ui-icon-set --chat-message hr-department-detail-content__chat-empty-tab-add_chat-button-icon"/>\n\t\t\t\t<span>\n\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_CHAT_BUTTON') }}\n\t\t\t\t</span>\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\t:ref="channelButtonId"\n\t\t\t\tclass="ui-btn ui-btn-light-border ui-btn-no-caps ui-btn-round ui-btn-sm hr-department-detail-content__chat-empty-tab-add_channel-button"\n\t\t\t\t@click.stop="onChannelButtonClick()"\n\t\t\t\tdata-test-id="hr-department-detail-content_chats-tab__empty-tab-add_channel-button"\n\t\t\t>\n\t\t\t\t<div class="ui-icon-set --speaker-mouthpiece hr-department-detail-content__chat-empty-tab-add_chat-button-icon"/>\n\t\t\t\t<span>\n\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_CHANNEL_BUTTON') }}\n\t\t\t\t</span>\n\t\t\t</button>\n\t\t</div>\n\t`};const G={name:"chatListItemActionButton",components:{RouteActionMenu:m.RouteActionMenu,ConfirmationPopup:m.ConfirmationPopup},props:{chat:{type:Object,required:true},nodeId:{type:Number,required:true}},data(){return{menuVisible:false,showUnbindChatConfirmationPopup:false,unbindChatLoader:false}},computed:{getUnbindChatTitle(){const t=this.isTeamEntity?"TEAM":"DEPARTMENT";const e=this.isChat?"CHAT":"CHANNEL";return this.loc(`HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_UNBIND_POPUP_${e}_FROM_${t}_TITLE`)},getUnbindChatDescription(){const t=this.isTeamEntity?"TEAM":"DEPARTMENT";const e=this.isChat?"CHAT":"CHANNEL";return this.loc(`HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_UNBIND_POPUP_${e}_FROM_${t}_DESCRIPTION`)},isTeamEntity(){var t;return((t=this.departments.get(this.nodeId))==null?void 0:t.entityType)===h.EntityTypes.team},isChat(){return this.chat.type===h.ChatTypes.chat},menu(){var t;const e=(t=this.departments.get(this.nodeId))==null?void 0:t.entityType;return new T.ChatListActionMenu(e,this.chat,this.nodeId)},...A.mapState(C.useChartStore,["departments"])},methods:{toggleMenu(){this.menuVisible=!this.menuVisible},loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},onActionMenuItemClick(t){if(t===T.MenuActions.openChat){u.Messenger.openChat(this.chat.dialogId)}else if(t===T.MenuActions.unbindChat){this.showUnbindChatConfirmationPopup=true}},cancelUnbindChat(){this.showUnbindChatConfirmationPopup=false},async unbindChat(){this.unbindChatLoader=true;const t=this.isTeamEntity?"TEAM":"DEPARTMENT";const e=this.isChat?"CHAT":"CHANNEL";try{await U.updateChats(this.nodeId,[],[this.chat.id])}catch(n){if(n.code!=="STRUCTURE_ACCESS_DENIED"){E.UI.Notification.Center.notify({content:this.loc(`HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_UNBIND_POPUP_${e}_FROM_${t}_ERROR`),autoHideDelay:2e3})}return}finally{this.unbindChatLoader=false;this.showUnbindChatConfirmationPopup=false}O.unbindChatFromNode(this.nodeId,this.chat.id);const n=!this.chat.originalNodeId||this.chat.originalNodeId===this.nodeId;if(n){O.updateChatsInChildrenNodes(this.nodeId)}E.UI.Notification.Center.notify({content:this.loc(`HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_UNBIND_POPUP_${e}_FROM_${t}_SUCCESS`),autoHideDelay:2e3})}},template:`\n\t\t<button\n\t\t\tv-if="menu.items.length"\n\t\t\tclass="ui-icon-set --more hr-department-detail-content__tab-list_item-action-btn --chat-item-action-btn ui-icon-set"\n\t\t\t:class="{ '--focused': menuVisible }"\n\t\t\t@click.stop="toggleMenu()"\n\t\t\tref="actionChatButton"\n\t\t\t:data-id="'hr-department-detail-content__'+ chat.type.toLowerCase() + '-list_chat-' + chat.id + '-action-btn'"\n\t\t/>\n\t\t<RouteActionMenu\n\t\t\tv-if="menuVisible"\n\t\t\t:id="'tree-node-department-menu-chat_' + this.nodeId + '_' + chat.id"\n\t\t\t:items="menu.items"\n\t\t\t:width="302"\n\t\t\t:bindElement="$refs.actionChatButton"\n\t\t\t@action="onActionMenuItemClick"\n\t\t\t@close="menuVisible = false"\n\t\t/>\n\t\t<ConfirmationPopup\n\t\t\tref="unbindChatConfirmationPopup"\n\t\t\tv-if="showUnbindChatConfirmationPopup"\n\t\t\t:showActionButtonLoader="unbindChatLoader"\n\t\t\t:title="getUnbindChatTitle"\n\t\t\t:confirmBtnText="loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_UNBIND_POPUP_CONFIRM_BUTTON')"\n\t\t\tconfirmButtonClass="ui-btn-danger"\n\t\t\t@action="unbindChat"\n\t\t\t@close="cancelUnbindChat"\n\t\t\t:width="364"\n\t\t>\n\t\t\t<template v-slot:content>\n\t\t\t\t<div class="hr-department-detail-content__user-action-text-container">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-html="getUnbindChatDescription"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</ConfirmationPopup>\n\t`};const W={name:"chatListItem",components:{ChatListItemActionButton:G,ResponsiveHint:m.ResponsiveHint},directives:{hint:m.Hint},props:{chat:{type:Object,required:true},nodeId:{type:Number,required:true}},data(){return{avatar:null}},computed:{isChat(){return this.chat.type!==h.ChatTypes.channel},originalNodeName(){var t;return(t=this.departments.get(this.chat.originalNodeId))==null?void 0:t.name},hiddenNodeName(){var t;return((t=this.structureMap.get(this.chat.originalNodeId))==null?void 0:t.entityType)===h.EntityTypes.team?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_HIDDEN_TEAM"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_HIDDEN_DEPARTMENT")},indirectChatSubtitle(){var t;if(((t=this.structureMap.get(this.chat.originalNodeId))==null?void 0:t.entityType)===h.EntityTypes.team){return this.isChat?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_OF_TEAM"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_OF_TEAM")}return this.isChat?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_OF_DEPARTMENT"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_OF_DEPARTMENT")},lockHint(){var t,e;if(!this.chat.hasAccess){return this.isChat?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_USER_HAS_NO_ACCESS_TO_CHAT_HINT"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_USER_HAS_NO_ACCESS_TO_CHANNEL_HINT")}if(((t=this.structureMap.get(this.chat.originalNodeId))==null?void 0:t.entityType)===h.EntityTypes.team){return this.isChat?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_PARENT_TEAM_CHAT_HINT"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_PARENT_TEAM_CHANNEL_HINT")}if(((e=this.structureMap.get(this.nodeId))==null?void 0:e.entityType)===h.EntityTypes.department){return this.isChat?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_PARENT_DEPARTMENT_CHAT_OF_DEPARTMENT_HINT"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_PARENT_DEPARTMENT_CHANNEL_OF_DEPARTMENT_HINT")}return this.isChat?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_PARENT_DEPARTMENT_CHAT_OF_TEAM_HINT"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_PARENT_DEPARTMENT_CHANNEL_OF_TEAM_HINT")},...A.mapState(C.useChartStore,["structureMap","departments"])},watch:{chat(){this.prepareAvatar()}},created(){this.prepareAvatar()},methods:{prepareAvatar(){if(this.chat.avatar){this.chat.color=h.getColorCode("whiteBase")}const t={size:32,userName:this.chat.title,baseColor:this.isExtranet()&&!this.chat.avatar?h.getColorCode("extranetColor"):this.chat.color,events:{click:()=>{this.onChatItemClick()}}};if(this.chat.avatar){t.userpicPath=this.chat.avatar}this.avatar=this.isChat?new _.AvatarRound(t):new _.AvatarSquare(t)},loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},onChatItemClick(){if(this.chat.hasAccess){u.Messenger.openChat(this.chat.dialogId)}},isExtranet(){return this.chat.isExtranet},locateToOriginalDepartment(){c.EventEmitter.emit(T.events.HR_ORG_CHART_LOCATE_TO_DEPARTMENT,{nodeId:this.chat.originalNodeId})}},template:`\n\t\t<div\n\t\t\t:key="chat.id"\n\t\t\tclass="hr-department-detail-content__tab-list_item-wrapper --chat"\n\t\t\t:class="{ '--isExtranet': isExtranet() }"\n\t\t\t:data-test-id="'hr-department-content_chats-tab__list_chat-item-' + chat.id"\n\t\t>\n\t\t\t<div\n\t\t\t\tclass="hr-department-detail-content__tab-list_item-avatar-container"\n\t\t\t\t:class="{ '--not-clickable': !chat.hasAccess }"\n\t\t\t\tv-html="this.avatar.getContainer().outerHTML"\n\t\t\t\t@click="onChatItemClick"\n\t\t\t/>\n\t\t\t<div class="hr-department-detail-content__tab-list_item-text-container">\n\t\t\t\t<div class="hr-department-detail-content__tab-list_item-title-container --chat-item">\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass="hr-department-detail-content__tab-list_item-title"\n\t\t\t\t\t\t:class="{ '--not-clickable': !chat.hasAccess }"\n\t\t\t\t\t\t:data-test-id="'hr-department-content_chats-tab__list_chat-item-' + chat.id + '-title'"\n\t\t\t\t\t\t@click="onChatItemClick"\n\t\t\t\t\t>{{ chat.title }}</span>\n\t\t\t\t\t<ResponsiveHint \n\t\t\t\t\t\tv-if="!chat.hasAccess || chat.originalNodeId" \n\t\t\t\t\t\t:content="lockHint" \n\t\t\t\t\t\t:extraClasses="{ 'hr-department-detail-content__tab-list_hint-container': true }"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span class="ui-icon-set --lock hr-department-detail-content__tab-list_lock-icon"></span>\n\t\t\t\t\t</ResponsiveHint>\n\t\t\t\t</div>\n\t\t\t\t<div v-if="chat.originalNodeId && originalNodeName" class="hr-department-detail-content__tab-list_item-subtitle --chat-item">\n\t\t\t\t\t{{ indirectChatSubtitle }}\n\t\t\t\t\t<ResponsiveHint \n\t\t\t\t\t\t:content="originalNodeName" \n\t\t\t\t\t\tdefaultClass="hr-department-detail-content__tab-list_orig-node-name"\n\t\t\t\t\t\t:checkScrollWidth="true"\n\t\t\t\t\t\t:width="null"\n\t\t\t\t\t\t@click="locateToOriginalDepartment"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ originalNodeName }}\n\t\t\t\t\t</ResponsiveHint>\n\t\t\t\t</div>\n\t\t\t\t<div v-else-if="chat.originalNodeId" class="hr-department-detail-content__tab-list_item-subtitle --chat-item">\n\t\t\t\t\t{{ indirectChatSubtitle }}\n\t\t\t\t\t<span class="hr-department-detail-content__tab-list_orig-node-hidden-name">\n\t\t\t\t\t\t{{ hiddenNodeName }}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div v-else class="hr-department-detail-content__tab-list_item-subtitle">\n\t\t\t\t\t{{ chat.subtitle }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<ChatListItemActionButton\n\t\t\t\t:chat="chat"\n\t\t\t\t:nodeId="nodeId"\n\t\t\t/>\n\t\t</div>\n\t`};const Q={name:"chatsTab",components:{SearchInput:b,TabList:v,EmptyState:I,EmptyTabAddButtons:q,ChatListItem:W,ManagementDialog:m.ManagementDialog,ChildrenModeSelector:Y},data(){return{isChatLinkActive:false,chatLinkDialogVisible:false,isChannelLinkActive:false,channelLinkDialogVisible:false,isLoading:false,searchQuery:"",addChatsWithChildren:false,addChannelsWithChildren:false}},created(){this.loadChatAction()},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},locPlural(t,e){return p.Loc.getMessagePlural(t,e,{"#COUNT#":e})},searchChatOrChannel(t){this.searchQuery=t},async loadChatAction(t){var e,n,s,i;if(this.isLoading){return null}const a=this.focusedNode;const o=this.departments.get(a);if(!o){return null}if(!t&&p.Type.isArray(o.chatsDetailed)&&p.Type.isArray(o.channelsDetailed)){return{chats:o.chatsDetailed,channels:o.channelsDetailed,chatsNoAccess:o.chatsNoAccess,channelsNoAccess:o.channelsNoAccess}}this.isLoading=true;this.$emit("showDetailLoader");const r=await U.getChatsAndChannels(a);O.setChatsAndChannels(a,(e=r.chats)!=null?e:[],(n=r.channels)!=null?n:[],(s=r.chatsNoAccess)!=null?s:0,(i=r.channelsNoAccess)!=null?i:0);this.$emit("hideDetailLoader");this.isLoading=false;return r},getChatListMenuItems(){return this.canEdit?[k]:[]},getChannelListMenuItems(){return this.canEdit?[x]:[]},onActionMenuItemClick(t){if(t===w.linkChat){this.chatLinkDialogVisible=true}if(t===w.linkChannel){this.channelLinkDialogVisible=true}},getAddEmptyStateList(){let t=[];if(this.isTeamEntity){t=[this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_TEAM_LIST_ITEM_1_MSGVER_1"),this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_LIST_ITEM_2"),this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_TEAM_LIST_ITEM_3")]}else{t=[this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_LIST_ITEM_1_MSGVER_1"),this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_LIST_ITEM_2"),this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_LIST_ITEM_3")]}return t.map((t=>({text:t})))},getChatListDataTestIds(){return F},getChannelListDataTestIds(){return V},getChatLinkDialogEntities(){const t=m.getChatDialogEntity();t.options.excludeIds=this.chats.map((t=>t.id));return[t]},getChannelLinkDialogEntities(){const t=m.getChannelDialogEntity();t.options.excludeIds=this.channels.map((t=>t.id));return[t]},getChatLinkRecentTabOptions(){return m.getCommunicationsRecentTabOptions(this.teamEntity,m.CommunicationsTypeDict.chat)},getChannelLinkRecentTabOptions(){return m.getCommunicationsRecentTabOptions(this.teamEntity,m.CommunicationsTypeDict.channel)},async linkChats(t){this.isChatLinkActive=true;const e=t.map((t=>Number(t.id.replace("chat",""))));const n=this.focusedNode;const s={chat:e,withChildren:this.addChatsWithChildren};try{await U.saveChats(n,s);const t=await this.loadChatAction(true);if(this.addChatsWithChildren&&t){const s=t.chats.filter((t=>e.includes(t.id)));if(s.length>0){O.updateChatsInChildrenNodes(n)}}}catch{}this.isChatLinkActive=false;this.chatLinkDialogVisible=false;this.addChatsWithChildren=false},async linkChannel(t){this.isChannelLinkActive=true;const e=t.map((t=>Number(t.id.replace("chat",""))));const n=this.focusedNode;const s={channel:e,withChildren:this.addChannelsWithChildren};try{await U.saveChats(n,s);const t=await this.loadChatAction(true);if(this.addChannelsWithChildren&&t){const s=t.channels.filter((t=>e.includes(t.id)));if(s.length>0){O.updateChatsInChildrenNodes(n)}}}catch{}this.isChannelLinkActive=false;this.channelLinkDialogVisible=false;this.addChannelsWithChildren=false},getChatLinkDialogDataTestIds(){return $},getChannelLinkDialogDataTestIds(){return X}},computed:{chats(){var t,e;return(t=(e=this.departments.get(this.focusedNode))==null?void 0:e.chatsDetailed)!=null?t:[]},channels(){var t,e;return(t=(e=this.departments.get(this.focusedNode))==null?void 0:e.channelsDetailed)!=null?t:[]},chatsNoAccess(){var t,e;return(t=(e=this.departments.get(this.focusedNode))==null?void 0:e.chatsNoAccess)!=null?t:0},channelsNoAccess(){var t,e;return(t=(e=this.departments.get(this.focusedNode))==null?void 0:e.channelsNoAccess)!=null?t:0},chatsNoAccessText(){const t=this.chats.length>0?"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_CHAT_LIST_ITEM_MORE_HIDDEN_TEXT":"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_CHAT_LIST_ITEM_EMPTY_HIDDEN_TEXT";return this.locPlural(t,this.chatsNoAccess)},channelsNoAccessText(){const t=this.channels.length>0?"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_CHANNEL_LIST_ITEM_MORE_HIDDEN_TEXT":"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_CHANNEL_LIST_ITEM_EMPTY_HIDDEN_TEXT";return this.locPlural(t,this.channelsNoAccess)},filteredChats(){return this.chats.filter((t=>t.title.toLowerCase().includes(this.searchQuery.toLowerCase())))},filteredChannels(){return this.channels.filter((t=>t.title.toLowerCase().includes(this.searchQuery.toLowerCase())))},showAddEmptyState(){return this.chats.length===0&&this.channels.length===0&&this.chatsNoAccess===0&&this.channelsNoAccess===0},showSearchEmptyState(){return(this.chats.length>0||this.channels.length>0)&&this.filteredChats.length===0&&this.filteredChannels.length===0},getLinkedChatIds(){return this.chats.map((t=>`chat${t.id}`))},getLinkedChannelIds(){return this.channels.map((t=>`chat${t.id}`))},isChatsLoaded(){const t=this.departments.get(this.focusedNode);return Boolean(p.Type.isArray(t.chatsDetailed)&&p.Type.isArray(t.channelsDetailed))},teamEntity(){var t;return(t=this.departments.get(this.focusedNode))==null?void 0:t.entityType},isTeamEntity(){return this.teamEntity===h.EntityTypes.team},getAddEmptyStateTitle(){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_TEAM_TITLE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_TITLE")},getAddChatDescription(){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_LINK_DIALOG_TEAM_DESC"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_LINK_DIALOG_DESC")},getAddChannelDescription(){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_LINK_DIALOG_TEAM_DESC"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_LINK_DIALOG_DESC")},chatMenuItems(){return this.getChatListMenuItems()},channelMenuItems(){return this.getChannelListMenuItems()},emptyChatTitle(){if(this.canEdit){return this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_CHAT_LIST_ITEM_TEXT_MSGVER_1")}return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_CHAT_LIST_ITEM_NO_TEAM_TEXT_MSGVER_1"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_CHAT_LIST_ITEM_NO_DEPARTMENT_TEXT_MSGVER_1")},emptyChannelTitle(){if(this.canEdit){return this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_CHANNEL_LIST_ITEM_TEXT_MSGVER_1")}return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_CHANNEL_LIST_ITEM_NO_TEAM_TEXT_MSGVER_1"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_CHANNEL_LIST_ITEM_NO_DEPARTMENT_TEXT_MSGVER_1")},canEdit(){const t=r.PermissionChecker.getInstance();return this.isTeamEntity?t.hasPermission(r.PermissionActions.teamCommunicationEdit,this.focusedNode):t.hasPermission(r.PermissionActions.departmentCommunicationEdit,this.focusedNode)},getDialogExtraSubtitleLabel(){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_WITH_SUBTEAMS_LABEL"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_WITH_SUBDEPARTMENTS_LABEL")},canAddWithChildren(){const t=r.PermissionChecker.getInstance();if(this.isTeamEntity){const e={TEAM:r.PermissionLevels.selfAndSub};const n={DEPARTMENT:r.PermissionLevels.selfAndSub};const s=r.PermissionActions.teamCommunicationEdit;return t.hasPermission(s,this.focusedNode,e)||t.hasPermission(s,this.focusedNode,n)}const e=r.PermissionActions.departmentCommunicationEdit;return t.hasPermission(e,this.focusedNode,r.PermissionLevels.selfAndSub)},hideEmptyChatItem(){return this.searchQuery.length>0||this.chatsNoAccess>0},hideEmptyChannelItem(){return this.searchQuery.length>0||this.channelsNoAccess>0},...A.mapState(C.useChartStore,["focusedNode","departments"])},watch:{isChatsLoaded(t){if(t===false){this.loadChatAction()}}},template:`\n\t\t<div class="hr-department-detail-content__tab-container --chat">\n\t\t\t<template v-if="!showAddEmptyState">\n\t\t\t\t<SearchInput\n\t\t\t\t\t:placeholder="loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_SEARCH_INPUT_PLACEHOLDER')"\n\t\t\t\t\t:value="searchQuery"\n\t\t\t\t\t@inputChange="searchChatOrChannel"\n\t\t\t\t\tdataTestId="hr-department-detail-content_chats-tab__chats-and-channels-search-input"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tv-if="!showSearchEmptyState"\n\t\t\t\t\tclass="hr-department-detail-content__lists-container"\n\t\t\t\t>\n\t\t\t\t\t<TabList\n\t\t\t\t\t\tid='hr-department-detail-content_chats-tab__chat-list'\n\t\t\t\t\t\t:title="loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_LIST_TITLE')"\n\t\t\t\t\t\t:count="chats.length + chatsNoAccess"\n\t\t\t\t\t\t:menuItems="chatMenuItems"\n\t\t\t\t\t\t:listItems="filteredChats"\n\t\t\t\t\t\t:emptyItemTitle="emptyChatTitle"\n\t\t\t\t\t\temptyItemImageClass="hr-department-detail-content__chat-empty-tab-list-item_tab-icon"\n\t\t\t\t\t\t:hideEmptyItem="hideEmptyChatItem"\n\t\t\t\t\t\t:withAddPermission="canEdit"\n\t\t\t\t\t\t@tabListAction="onActionMenuItemClick"\n\t\t\t\t\t\t:dataTestIds="getChatListDataTestIds()"\n\t\t\t\t\t>\n\t\t\t\t\t\t<template v-slot="{ item }">\n\t\t\t\t\t\t\t<ChatListItem :chat="item" :nodeId="focusedNode"/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-if="chatsNoAccess > 0" v-slot:footer>\n\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\tclass="hr-department-detail-content__tab-list_communications-hidden"\n\t\t\t\t\t\t\t\tdata-test-id="hr-department-content_chats-tab__list_chat-hidden-text"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{{ chatsNoAccessText }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</TabList>\n\t\t\t\t\t<TabList\n\t\t\t\t\t\tid='hr-department-detail-content_chats-tab__channel-list'\n\t\t\t\t\t\t:title="loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_LIST_TITLE')"\n\t\t\t\t\t\t:count="channels.length + channelsNoAccess"\n\t\t\t\t\t\t:menuItems="channelMenuItems"\n\t\t\t\t\t\t:listItems="filteredChannels"\n\t\t\t\t\t\t:emptyItemTitle="emptyChannelTitle"\n\t\t\t\t\t\temptyItemImageClass="hr-department-detail-content__chat-empty-tab-list-item_tab-icon"\n\t\t\t\t\t\t:hideEmptyItem="hideEmptyChannelItem"\n\t\t\t\t\t\t:withAddPermission="canEdit"\n\t\t\t\t\t\t@tabListAction="onActionMenuItemClick"\n\t\t\t\t\t\t:dataTestIds="getChannelListDataTestIds()"\n\t\t\t\t\t>\n\t\t\t\t\t\t<template v-slot="{ item }">\n\t\t\t\t\t\t\t<ChatListItem :chat="item" :nodeId="focusedNode"/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-if="channelsNoAccess > 0" v-slot:footer>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass="hr-department-detail-content__tab-list_communications-hidden"\n\t\t\t\t\t\t\t\tdata-test-id="hr-department-content_chats-tab__list_channel-hidden-text"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{{ channelsNoAccessText }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</TabList>\n\t\t\t\t</div>\n\t\t\t\t<EmptyState \n\t\t\t\t\tv-else\n\t\t\t\t\timageClass="hr-department-detail-content__chat-empty-tab-search_tab-icon"\n\t\t\t\t\t:title="loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_SEARCHED_EMPLOYEES_TITLE')"\n\t\t\t\t\t:description ="loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_SEARCHED_EMPLOYEES_SUBTITLE')"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<EmptyState \n\t\t\t\tv-else\n\t\t\t\timageClass="hr-department-detail-content__chat-empty-tab-add_tab-icon"\n\t\t\t\t:title="getAddEmptyStateTitle"\n\t\t\t\t:list="getAddEmptyStateList()"\n\t\t\t>\n\t\t\t\t<template v-slot:content>\n\t\t\t\t\t<EmptyTabAddButtons\n\t\t\t\t\t\t@emptyStateAddAction="onActionMenuItemClick"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t</EmptyState>\n\t\t\t<ManagementDialog\n\t\t\t\tv-if="chatLinkDialogVisible"\n\t\t\t\tid="hr-department-detail-content-chats-tab-chat-link-dialog"\n\t\t\t\t:entities="getChatLinkDialogEntities()"\n\t\t\t\t:recentTabOptions="getChatLinkRecentTabOptions()"\n\t\t\t\t:hiddenItemsIds="getLinkedChatIds"\n\t\t\t\t:title="loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_LINK_DIALOG_TITLE')"\n\t\t\t\t:description="getAddChatDescription"\n\t\t\t\t:isActive="isChatLinkActive"\n\t\t\t\t@managementDialogAction="linkChats"\n\t\t\t\t@close="chatLinkDialogVisible = false"\n\t\t\t\t:dataTestIds="getChatLinkDialogDataTestIds()"\n\t\t\t>\n\t\t\t\t<template v-slot:extra-subtitle>\n\t\t\t\t\t<ChildrenModeSelector\n\t\t\t\t\t\t:isTeamEntity="isTeamEntity"\n\t\t\t\t\t\t:data-test-id="getChatLinkDialogDataTestIds().addWithChildrenDataTestId"\n\t\t\t\t\t\t:hasPermission="canAddWithChildren"\n\t\t\t\t\t\t:text="loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_MODE_CHATS_TEXT')"\n\t\t\t\t\t\t@saveChildrenMode="addChatsWithChildren = $event"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t</ManagementDialog>\n\t\t\t<ManagementDialog\n\t\t\t\tv-if="channelLinkDialogVisible"\n\t\t\t\tid="hr-department-detail-content-chats-tab-channel-link-dialog"\n\t\t\t\t:entities="getChannelLinkDialogEntities()"\n\t\t\t\t:recentTabOptions="getChannelLinkRecentTabOptions()"\n\t\t\t\t:hiddenItemsIds="getLinkedChannelIds"\n\t\t\t\t:title="loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_LINK_DIALOG_TITLE')"\n\t\t\t\t:description="getAddChannelDescription"\n\t\t\t\t:isActive="isChannelLinkActive"\n\t\t\t\t@managementDialogAction="linkChannel"\n\t\t\t\t@close="channelLinkDialogVisible = false"\n\t\t\t\t:dataTestIds="getChannelLinkDialogDataTestIds()"\n\t\t\t>\n\t\t\t\t<template v-slot:extra-subtitle>\n\t\t\t\t\t<ChildrenModeSelector\n\t\t\t\t\t\t:isTeamEntity="isTeamEntity"\n\t\t\t\t\t\t:data-test-id="getChatLinkDialogDataTestIds().addWithChildrenDataTestId"\n\t\t\t\t\t\t:hasPermission="canAddWithChildren"\n\t\t\t\t\t\t:text="loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_MODE_CHANNELS_TEXT')"\n\t\t\t\t\t\t@saveChildrenMode="addChannelsWithChildren = $event"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t</ManagementDialog>\n\t\t</div>\n\t`};const j={name:"departmentContent",components:{UsersTab:H,ChatsTab:Q},props:{isCollapsed:Boolean},emits:["showDetailLoader","hideDetailLoader","editEmployee"],data(){return{activeTab:"usersTab",tabs:[{name:"usersTab",component:"UsersTab",id:"users-tab"},{name:"chatsTab",component:"ChatsTab",id:"chats-tab"}],isDescriptionOverflowed:false,isDescriptionExpanded:false}},computed:{...A.mapState(C.useChartStore,["focusedNode","departments"]),activeTabComponent(){const t=this.tabs.find((t=>t.name===this.activeTab));return t?t.component:null},usersCount(){var t,e;return(t=(e=this.departments.get(this.focusedNode))==null?void 0:e.userCount)!=null?t:0},chatAndChannelsCount(){var t,e;return(t=(e=this.departments.get(this.focusedNode))==null?void 0:e.chatAndChannelsCount)!=null?t:null},tabArray(){return this.tabs.map((t=>{if(t.name==="usersTab"){return{...t,count:this.usersCount}}if(t.name==="chatsTab"){return{...t,count:this.chatAndChannelsCount}}return t}))},description(){const t=this.departments.get(this.focusedNode);if(!t.description){return null}return t.description},isTeamEntity(){var t;return((t=this.departments.get(this.focusedNode))==null?void 0:t.entityType)===h.EntityTypes.team}},watch:{description(){this.$nextTick((()=>{this.isDescriptionOverflowed=this.checkDescriptionOverflowed()}))},focusedNode(){this.isDescriptionExpanded=false;this.selectTab("usersTab")},isCollapsed(){this.$nextTick((()=>{this.isDescriptionOverflowed=this.checkDescriptionOverflowed()}))}},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},selectTab(t){if(this.isTabDisabled(t)){return}this.activeTab=t},getTabLabel(t){if(t==="usersTab"){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_TEAM_USERS_TITLE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_TITLE")}if(t==="chatsTab"){return this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_TITLE")}return""},toggleDescriptionExpand(){this.isDescriptionExpanded=!this.isDescriptionExpanded},checkDescriptionOverflowed(){var t;const e=(t=this.$refs.descriptionContainer)!=null?t:null;if(e){return e.scrollHeight>e.clientHeight}return false},hideDetailLoader(){this.$emit("hideDetailLoader");this.$nextTick((()=>{this.isDescriptionOverflowed=this.checkDescriptionOverflowed()}))},isTabDisabled(t){if(t==="chatsTab"&&this.tabArray.find((e=>e.name===t)).count===0){const t=r.PermissionChecker.getInstance();const e=this.isTeamEntity?t.hasPermission(r.PermissionActions.teamCommunicationEdit,this.focusedNode):t.hasPermission(r.PermissionActions.departmentCommunicationEdit,this.focusedNode);if(!e){return true}}return false}},template:`\n\t\t<div class="hr-department-detail-content hr-department-detail-content__scope">\n\t\t\t<div\n\t\t\t\tref="descriptionContainer"\n\t\t\t\tv-show="description"\n\t\t\t\t:class="[\n\t\t\t\t\t'hr-department-detail-content-description',\n\t\t\t\t\t{ '--expanded': isDescriptionExpanded },\n\t\t\t\t\t{ '--overflowed': isDescriptionOverflowed},\n\t\t\t\t]"\n\t\t\t\tv-on="isDescriptionOverflowed ? { click: toggleDescriptionExpand } : {}"\n\t\t\t>\n\t\t\t\t{{ description }}\n\t\t\t</div>\n\t\t\t<div class="hr-department-detail-content__tab-list">\n\t\t\t\t<button\n\t\t\t\t\tv-for="tab in tabArray"\n\t\t\t\t\t:key="tab.name"\n\t\t\t\t\tclass="hr-department-detail-content__tab-item"\n\t\t\t\t\t:class="[{'--active-tab' : activeTab === tab.name, '--disabled-tab': isTabDisabled(tab.name)}]"\n\t\t\t\t\t@click="selectTab(tab.name)"\n\t\t\t\t\t:data-id="tab.id ? 'hr-department-detail-content__' + tab.id + '_button' : null"\n\t\t\t\t>\n\t\t\t\t\t{{ this.getTabLabel(tab.name) }}\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass="hr-department-detail-content__tab-count"\n\t\t\t\t\t\t:data-id="tab.id ? 'hr-department-detail-content__' + tab.id + '_counter' : null"\n\t\t\t\t\t>{{ tab.count }}\n\t\t\t\t\t</span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t<UsersTab\n\t\t\t\tv-show="activeTab === 'usersTab'"\n\t\t\t\t@showDetailLoader="$emit('showDetailLoader')"\n\t\t\t\t@hideDetailLoader="hideDetailLoader"\n\t\t\t/>\n\t\t\t<ChatsTab\n\t\t\t\tv-show="activeTab === 'chatsTab'"\n\t\t\t\t:is="activeTabComponent"\n\t\t\t\t@showDetailLoader="$emit('showDetailLoader')"\n\t\t\t\t@hideDetailLoader="hideDetailLoader"\n\t\t\t/>\n\t\t</div>\n\t`};t.DepartmentContent=j;t.DepartmentContentActions=O})(this.BX.Humanresources.CompanyStructure=this.BX.Humanresources.CompanyStructure||{},BX.Humanresources.CompanyStructure,BX,BX.Humanresources.CompanyStructure,BX.UI.EntitySelector,BX.UI,BX.UI,BX.Humanresources.CompanyStructure,BX.UI.IconSet,BX,BX.Event,BX.UI,BX.Humanresources.CompanyStructure,BX.Humanresources.CompanyStructure,BX,BX.Messenger.v2.Lib,BX.Humanresources.CompanyStructure,BX,BX.Humanresources.CompanyStructure,BX.Vue3.Pinia);
//# sourceMappingURL=department-content.bundle.map.js