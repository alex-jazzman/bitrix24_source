this.BX=this.BX||{};this.BX.Humanresources=this.BX.Humanresources||{};(function(t,e,n,i,s,a,o,r,d,l,T,c,_,E,h,m,u,C,A){"use strict";const p=Object.freeze({containerDataTestId:"hr-department-content_users-tab__head-list-container",listActionButtonDataTestId:"hr-department-content_users-tab__head-list-action-button",listActonMenuDataTestId:"hr-department-content_users-tab__head-list-action-menu-container",listCounterDataTestId:"hr-department-content_users-tab__head-list-counter"});const N=Object.freeze({containerDataTestId:"hr-department-content_users-tab__employee-list-container",listActionButtonDataTestId:"hr-department-content_users-tab__employee-list-action-button",listActonMenuDataTestId:"hr-department-content_users-tab__employee-list-action-menu-container",listCounterDataTestId:"hr-department-content_users-tab__employee-list-counter"});const R={name:"emptyStateContainer",components:{RouteActionMenu:u.RouteActionMenu},props:{departmentId:{type:Number,required:true},entityType:{type:String,default:E.EntityTypes.department}},data(){return{menuVisible:false}},computed:{menu(){return new T.EmptyUsersTabActionMenu(this.departmentId,i.AnalyticsSourceType.DETAIL,null,this.entityType)},...A.mapState(C.useChartStore,["focusedNode"])},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},onClick(){if(this.entityType===E.EntityTypes.team&&this.menu.items.length===1){this.onActionMenuItemClick(this.menu.items[0].id)}else{this.menuVisible=true}},onActionMenuItemClick(t){this.menu.onActionMenuItemClick(t)}},template:`\n\t\t<div class="hr-department-detail-content__users-empty-tab-add_buttons-container">\n\t\t\t<button\n\t\t\t\tclass="hr-add-employee-empty-tab-entity-btn ui-btn ui-btn ui-btn-sm ui-btn-primary ui-btn-round"\n\t\t\t\tref="actionMenuButton"\n\t\t\t\t@click.stop="onClick"\n\t\t\t\tdata-id="hr-department-detail-content__user-empty-tab_add-user-button"\n\t\t\t>\n\t\t\t\t<span class="hr-add-employee-empty-tab-entity-btn-text">{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_EMPLOYEES_ADD_USER_ADD_BUTTON')}}</span>\n\t\t\t</button>\n\t\t\t<RouteActionMenu\n\t\t\t\tv-if="menuVisible"\n\t\t\t\t:id="'empty-state-department-detail-add-menu-' + focusedNode"\n\t\t\t\t:items="menu.items"\n\t\t\t\t:width="302"\n\t\t\t\t:bindElement="$refs['actionMenuButton']"\n\t\t\t\t@action="onActionMenuItemClick"\n\t\t\t\t@close="menuVisible = false"\n\t\t\t/>\n\t\t</div>\n\t`};const S={getPagedEmployees:(t,e,n)=>i.getData("humanresources.api.Structure.Node.Member.Employee.list",{nodeId:t,page:e,countPerPage:n}),removeUserFromDepartment:(t,e)=>i.postData("humanresources.api.Structure.Node.Member.deleteUser",{nodeId:t,userId:e}),moveUserToDepartment:(t,e,n,s)=>i.postData("humanresources.api.Structure.Node.Member.moveUser",{nodeId:t,userId:e,targetNodeId:n,roleXmlId:s}),isUserInMultipleDepartments:t=>i.getData("humanresources.api.User.isUserInMultipleDepartments",{userId:t}),getUserInfo:(t,e)=>i.getData("humanresources.api.User.getInfoByUserMember",{nodeId:t,userId:e}),fireUser:t=>i.postData("intranet.user.fire",{userId:t}),findMemberByQuery:(t,e)=>i.getData("humanresources.api.Structure.Node.Member.find",{nodeId:t,query:e}),getChatsAndChannels:t=>i.getData("humanresources.api.Structure.Node.Member.Chat.getList",{nodeId:t}),saveChats:(t,e,n,s=0)=>i.postData("humanresources.api.Structure.Node.Member.Chat.saveChatList",{nodeId:t,ids:e,removeIds:n,withChildren:s}),saveChannel:(t,e,n,s=0)=>i.postData("humanresources.api.Structure.Node.Member.Chat.saveChannelList",{nodeId:t,ids:e,removeIds:n,withChildren:s}),saveCollab:(t,e,n,s=0)=>i.postData("humanresources.api.Structure.Node.Member.Chat.saveCollabList",{nodeId:t,ids:e,removeIds:n,withChildren:s})};const M={name:"userList",props:{user:{type:Object,required:true},departmentId:{type:Number,required:true}},components:{RouteActionMenu:u.RouteActionMenu,ConfirmationPopup:u.ConfirmationPopup,MoveUserPopup:u.MoveUserPopup},data(){return{menuVisible:{},showRemoveUserConfirmationPopup:false,showRemoveUserConfirmationActionLoader:false,showMoveUserPopup:false,showMoveUserPopupOnlyMoveMode:false,showFireUserPopup:false,fireUserLoad:false}},methods:{toggleMenu(t){this.menuVisible[t]=!this.menuVisible[t]},loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},onActionMenuItemClick(t){if(t===T.MenuActions.removeUserFromDepartment){if(this.isTeamEntity){this.showRemoveUserConfirmationPopup=true}else{this.showMoveUserPopupOnlyMoveMode=false;this.showMoveUserPopup=true}}if(t===T.MenuActions.moveUserToAnotherDepartment){this.showMoveUserPopupOnlyMoveMode=true;this.showMoveUserPopup=true}if(t===T.MenuActions.fireUserFromCompany){this.showFireUserPopup=true}},async removeUser(){var t;this.showRemoveUserConfirmationActionLoader=true;const e=this.user.id;const n=await S.isUserInMultipleDepartments(e);const i=this.focusedNode;this.showRemoveUserConfirmationActionLoader=false;this.showRemoveUserConfirmationPopup=false;this.showMoveUserPopup=false;try{await S.removeUserFromDepartment(i,e)}catch{const t=this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_TEAM_ERROR"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_DEPARTMENT_ERROR");c.UI.Notification.Center.notify({content:t,autoHideDelay:2e3});return}const s=this.isTeamEntity?"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_TEAM_SUCCESS":"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_DEPARTMENT_SUCCESS";const a=m.Text.encode((t=this.departments.get(this.focusedNode).name)!=null?t:"");c.UI.Notification.Center.notify({content:this.loc(s,{"#DEPARTMENT_NAME#":a}),autoHideDelay:2e3});const o=this.user.role;if(n||this.isTeamEntity){C.UserService.removeUserFromEntity(i,e,o);return}const r=[...this.departments.values()].find((t=>t.parentId===0));if(!r){return}C.UserService.moveUserToEntity(i,e,r.id,o)},cancelRemoveUser(){this.showRemoveUserConfirmationPopup=false},async fireUser(){this.fireUserLoad=true;const t=this.user.id;try{await S.fireUser(t)}catch(t){if(t.code!=="STRUCTURE_ACCESS_DENIED"){c.UI.Notification.Center.notify({content:this.user.isInvited?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_DELETE_ERROR"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_FIRE_ERROR"),autoHideDelay:2e3})}this.showFireUserPopup=false;this.fireUserLoad=false;return}C.UserService.removeUserFromEntity(this.focusedNode,t,this.user.role);await C.UserService.removeUserFromAllEntities(t);this.showFireUserPopup=false;this.fireUserLoad=false},cancelFireUser(){this.showFireUserPopup=false},handleMoveUserAction(){this.showMoveUserPopup=false},handleMoveUserClose(){this.showMoveUserPopup=false},getMemberKeyByValue(t){return Object.keys(i.memberRoles).find((e=>i.memberRoles[e]===t))||""}},created(){this.menu=new T.UserListActionMenu(this.focusedNode,this.entityType,this.user.isInvited)},computed:{...A.mapState(C.useChartStore,["focusedNode","departments"]),memberRoles(){return i.memberRoles},getFirePopupDescription(){var t,e;const n=m.Text.encode((t=this.user.name)!=null?t:"");const i=m.Text.encode((e=this.user.url)!=null?e:"");const s=this.user.gender==="F"?"_F":"_M";const a=this.user.isInvited?`HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_DELETE_POPUP_DESCRIPTION${s}`:`HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_FIRE_POPUP_DESCRIPTION${s}`;const o=this.loc(a,{"#USER_NAME#":n});return o.replace("[link]",`<a class="hr-department-detail-content__fire-user-link" href="${i}">`).replace("[/link]","</a>")},getFirePopupTitle(){return this.user.isInvited?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_DELETE_POPUP_TITLE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_FIRE_POPUP_TITLE")},getFirePopupButtonText(){return this.user.isInvited?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_DELETE_POPUP_CONFIRM_BUTTON"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_FIRE_POPUP_CONFIRM_BUTTON")},getRemovePopupTitle(){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_TEAM_POPUP_TITLE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_DEPARTMENT_POPUP_TITLE")},getRemovePopupDescription(){var t,e;const n=m.Text.encode((t=this.departments.get(this.focusedNode).name)!=null?t:"");const i=m.Text.encode((e=this.user.name)!=null?e:"");if(this.isTeamEntity){const t="HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_TEAM_POPUP_DESCRIPTION";const e=this.user.gender==="F"?"_F":"_M";return this.loc(t+e,{"#USER_NAME#":i,"#DEPARTMENT_NAME#":n}).replace("[link]",`<a class="hr-department-detail-content__move-user-department-user-link" href="${this.user.url}">`).replace("[/link]","</a>")}return this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_DEPARTMENT_POPUP_DESCRIPTION")},entityType(){var t;return(t=this.departments.get(this.focusedNode))==null?void 0:t.entityType},isTeamEntity(){return this.entityType===E.EntityTypes.team}},template:`\n\t\t<button\n\t\t\tv-if="menu.items.length"\n\t\t\tclass="ui-icon-set --more hr-department-detail-content__user-action-btn"\n\t\t\t:class="{ '--focused': menuVisible[user.id] }"\n\t\t\t@click.stop="toggleMenu(user.id)"\n\t\t\tref="actionUserButton"\n\t\t\t:data-id="'hr-department-detail-content__'+ getMemberKeyByValue(user.role) + '-list_user-' + user.id + '-action-btn'"\n\t\t/>\n\t\t<RouteActionMenu\n\t\t\tv-if="menuVisible[user.id]"\n\t\t\t:id="'tree-node-department-menu-' + user.id"\n\t\t\t:items="menu.items"\n\t\t\t:width="302"\n\t\t\t:bindElement="$refs.actionUserButton"\n\t\t\t@action="onActionMenuItemClick"\n\t\t\t@close="menuVisible[user.id] = false"\n\t\t/>\n\t\t<ConfirmationPopup\n\t\t\tref="removeUserConfirmationPopup"\n\t\t\tv-if="showRemoveUserConfirmationPopup"\n\t\t\t:showActionButtonLoader="showRemoveUserConfirmationActionLoader"\n\t\t\t:title="getRemovePopupTitle"\n\t\t\t:confirmBtnText="loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_DEPARTMENT_POPUP_CONFIRM_BUTTON')"\n\t\t\t:confirmButtonClass="isTeamEntity ? 'ui-btn-danger' : 'ui-btn-primary'"\n\t\t\t@action="removeUser"\n\t\t\t@close="cancelRemoveUser"\n\t\t\t:width="364"\n\t\t>\n\t\t\t<template v-slot:content>\n\t\t\t\t<div class="hr-department-detail-content__user-action-text-container">\n\t\t\t\t<div\n\t\t\t\t\tv-html="getRemovePopupDescription"\n\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</ConfirmationPopup>\n\t\t<ConfirmationPopup\n\t\t\tref="fireUserConfirmationPopup"\n\t\t\tv-if="showFireUserPopup"\n\t\t\t:showActionButtonLoader="fireUserLoad"\n\t\t\t:title="getFirePopupTitle"\n\t\t\t:confirmBtnText="getFirePopupButtonText"\n\t\t\t:confirmButtonClass="'ui-btn-danger'"\n\t\t\t@action="fireUser"\n\t\t\t@close="cancelFireUser"\n\t\t\t:width="364"\n\t\t>\n\t\t\t<template v-slot:content>\n\t\t\t\t<div class="hr-department-detail-content__user-action-text-container">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-html="getFirePopupDescription"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</ConfirmationPopup>\n\t\t<MoveUserPopup\n\t\t\tv-if="showMoveUserPopup"\n\t\t\t:originalNodeId="focusedNode"\n\t\t\t:user="user"\n\t\t\t:entityType="entityType"\n\t\t\t:onlyMove="showMoveUserPopupOnlyMoveMode"\n\t\t\t@action="handleMoveUserAction"\n\t\t\t@close="handleMoveUserClose"\n\t\t\t@remove="removeUser"\n\t\t/>\n\t`};const U={name:"userList",emits:["itemDragStart"],props:{user:{type:Object,required:true},selectedUserId:{type:Number,required:false,default:null},entityType:{type:String,required:true},listType:{type:String,required:true},canDrag:{type:Boolean,default:false}},components:{UserListItemActionButton:M},computed:{memberRoles(){return i.getMemberRoles(this.entityType)},defaultAvatar(){return"/bitrix/js/humanresources/company-structure/org-chart/src/images/default-user.svg"},...A.mapState(C.useChartStore,["focusedNode"])},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},handleUserClick(t){BX.SidePanel.Instance.open(t.url,{cacheable:false})},handleMouseDown(t){t.preventDefault();this.$emit("itemDragStart",{userId:this.user.id,initialListType:this.listType,event:t,element:this.$el})}},template:`\n\t\t<div \n\t\t\t:key="user.id"\n\t\t\tclass="hr-department-detail-content__user-container"\n\t\t\t:class="{ '--searched': user.id === selectedUserId }"\n\t\t\t:data-id="'hr-department-detail-content__user-' + user.id + '-item'"\n\t\t>\n\t\t\t<span v-if="canDrag"\n\t\t\t\t  @mousedown="handleMouseDown"\n\t\t\t\t  class="hr-department-detail-content__dnd-icon ui-icon-set --more-points">\n\t\t\t</span>\n\t\t\t<div class="hr-department-detail-content__user-avatar-container" @click="handleUserClick(user)">\n\t\t\t\t<img \n\t\t\t\t\tclass="hr-department-detail-content__user-avatar-img"\n\t\t\t\t\t:src="user.avatar ? encodeURI(user.avatar) : defaultAvatar"\n\t\t\t\t    alt=""\n\t\t\t\t/>\n\t\t\t\t<div v-if="user.role === memberRoles.head" class="hr-department-detail-content__user-avatar-overlay"></div>\n\t\t\t</div>\n\t\t\t<div class="hr-department-detail-content-user__text-container">\n\t\t\t\t<div class="hr-department-detail-content__user-title">\n\t\t\t\t\t<div \n\t\t\t\t\t\tclass="hr-department-detail-content__user-name" \n\t\t\t\t\t\t@click="handleUserClick(user)"\n\t\t\t\t\t\t:bx-tooltip-user-id="user.id"\n\t\t\t\t\t\tbx-tooltip-context="b24"\n\t\t\t\t\t\t:data-id="'hr-department-detail-content__user-' + user.id + '-item-name'"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ user.name }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if="user.badgeText" class="hr-department-detail-content-user__name-badge">{{ user.badgeText }}</div>\n\t\t\t\t</div>\n\t\t\t\t<div \n\t\t\t\t\tclass="hr-department-detail-content__user-subtitle" \n\t\t\t\t\t:class="{ '--without-work-position': !user.subtitle }"\n\t\t\t\t>\n\t\t\t\t\t{{ (user.subtitle?.length ?? 0) > 0 ? user.subtitle : this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_LIST_DEFAULT_WORK_POSITION') }}\n\t\t\t\t</div>\n\t\t\t\t<div v-if="user.isInvited" class="hr-department-detail-content-user__item-badge">\n\t\t\t\t\t{{ this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_LIST_INVITED_BADGE_TEXT') }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<UserListItemActionButton\n\t\t\t\t:user="user"\n\t\t\t\t:departmentId="focusedNode"\n\t\t\t/>\n\t\t</div>\n\t`};const O={name:"emptyState",props:{title:{type:String,required:false},imageClass:{type:String,required:false},description:{type:String,required:false},list:{type:Array,required:false,default:[]}},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)}},template:`\n\t\t<div class="hr-department-detail-content_tab__empty-state-container">\n\t\t\t<div v-if="imageClass" :class="['hr-department-detail-content_tab__empty-state-icon', imageClass]"/>\n\t\t\t<span v-if="title" class="hr-department-detail-content__empty-tab-entity-title">\n\t\t\t\t{{ title }}\n\t\t\t</span>\n\t\t\t<span v-if="description" class="hr-department-detail-content_tab__empty-state-description">\n\t\t\t\t{{ description }}\n\t\t\t</span>\n\t\t\t<div v-if="list.length > 0" class="hr-department-detail-content_tab__empty-state-list">\n\t\t\t\t<div class="hr-department-detail-content_tab__empty-state-list-item"  v-for="item in list">\n\t\t\t\t\t<div \n\t\t\t\t\t\tclass="ui-icon-set --circle-check hr-department-detail-content_tab__empty-state-list-item-check"\n\t\t\t\t\t\tstyle="--ui-icon-set__icon-size: 24px;"\n\t\t\t\t\t/>\n\t\t\t\t\t<div class="hr-department-detail-content_tab__empty-state-list--item-text">\n\t\t\t\t\t\t{{ item.text }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<slot name="content"/>\n\t\t</div>\n\t`};const P={name:"tabEmptyListItem",props:{title:{type:String,required:true},imageClass:{type:String,required:true},withAddPermission:{type:Boolean,required:false,default:true}},template:`\n\t\t<div :class="['hr-department-detail-content__tab-empty-list_item-wrapper', { '--with-add': withAddPermission }]">\n\t\t\t<div class="hr-department-detail-content__tab-empty-list_item-image" :class="imageClass"/>\n\t\t\t<div class="hr-department-detail-content__tab-empty-list_item-content">\n\t\t\t\t<div class="hr-department-detail-content__tab-empty-list_item-title">\n\t\t\t\t\t{{ title }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const D={name:"userListActionButton",emits:["tabListAction","close"],props:{id:{type:String,required:true},menuItems:{type:Array,required:true},dataTestIds:{type:Object,required:false,default:{}}},components:{RouteActionMenu:u.RouteActionMenu},computed:{...A.mapState(C.useChartStore,["focusedNode"])},data(){return{menuVisible:false}},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},onActionMenuItemClick(t){this.$emit("tabListAction",t)}},template:`\n\t\t<button\n\t\t\tv-if="menuItems.length"\n\t\t\tclass="hr-department-detail-content__tab-list_header-button"\n\t\t\t:class="{ '--focused': menuVisible }"\n\t\t\t:ref="id + '-route-action-menu'"\n\t\t\t@click.stop="menuVisible = true"\n\t\t\t:data-test-id="dataTestIds.buttonDataTestId"\n\t\t>\n\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_LIST_ACTION_BUTTON_TITLE') }}\n\t\t</button>\n\t\t<RouteActionMenu\n\t\t\tv-if="menuVisible"\n\t\t\t:id="id + '-route-action-menu'"\n\t\t\t:items="menuItems"\n\t\t\t:width="302"\n\t\t\t:bindElement="$refs[id + '-route-action-menu']"\n\t\t\t:containerDataTestId="dataTestIds.containerDataTestId"\n\t\t\t@action="onActionMenuItemClick"\n\t\t\t@close="menuVisible = false"\n\t\t/>\n\t`};const I={name:"tabList",components:{ListActionButton:D,EmptyListItem:P},emits:["tabListAction"],props:{id:{type:String,required:true},title:{type:String,required:true},count:{type:Number,required:false},menuItems:{type:Array,required:false,default:[]},listItems:{type:Array,required:true},emptyItemTitle:{type:String,required:false},emptyItemImageClass:{type:String,required:false},hideEmptyItem:{type:Boolean,required:false,default:false},withAddPermission:{type:Boolean,required:false,default:true},dataTestIds:{type:Object,required:false,default:{}},isDropTarget:{type:Boolean,default:false},listType:{type:String}},data(){return{placeholderIndex:null,boundHandleDragOverList:null}},computed:{needToShowCount(){return m.Type.isNumber(this.count)}},watch:{isDropTarget(t,e){if(t===e){return}const n=this.$refs.itemsWrapper;if(!n){return}if(t){this.boundHandleDragOverList=m.Runtime.throttle(this.handleDragOverList.bind(this),10);m.Event.bind(n,"mousemove",this.boundHandleDragOverList);if(this.listItems.length===0){this.placeholderIndex=0}}else{m.Event.unbind(n,"mousemove",this.boundHandleDragOverList);this.boundHandleDragOverList=null;this.placeholderIndex=null}}},methods:{onActionMenuItemClick(t){this.$emit("tabListAction",t)},handleDragOverList(t){if(!this.isDropTarget||!this.$refs.itemsWrapper){if(this.placeholderIndex!==null){this.placeholderIndex=null}return}const e=this.$refs.itemsWrapper;const n=[...e.querySelectorAll(".hr-department-detail-content__user-container:not(.--dragging)")];const i=t.clientY;if(n.length===0){if(this.placeholderIndex!==0){this.placeholderIndex=0}return}let s=n.length;for(const[t,e]of n.entries()){const n=e.getBoundingClientRect();const a=n.top+n.height/2;if(i<a){s=t;break}}if(s!==this.placeholderIndex){this.placeholderIndex=s}}},template:`\n\t\t<div\n\t\t\tclass="hr-department-detail-content__tab-list_container"\n\t\t\t :data-test-id="dataTestIds.containerDataTestId"\n\t\t>\n\t\t\t<div class="hr-department-detail-content__tab-list_header-container">\n\t\t\t\t<div class="hr-department-detail-content__tab-list_list-title">\n\t\t\t\t\t{{ title }}\n\t\t\t\t\t<span\n\t\t\t\t\t\tv-if="needToShowCount"\n\t\t\t\t\t\tclass="hr-department-detail-content__tab-list_header-count"\n\t\t\t\t\t\t:data-test-id="dataTestIds.listCounterDataTestId"\n\t\t\t\t\t>\n\t\t\t\t\t{{ count }}\n\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<ListActionButton\n\t\t\t\t\t:id="id"\n\t\t\t\t\t:menuItems="menuItems"\n\t\t\t\t\t@tabListAction="onActionMenuItemClick"\n\t\t\t\t\t:dataTestIds="{buttonDataTestId: dataTestIds.listActionButtonDataTestId, containerDataTestId: dataTestIds.listActonMenuDataTestId}"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class="hr-department-detail-content__tab_list-container" ref="itemsWrapper">\n\t\t\t\t<div\n\t\t\t\t\tv-if="placeholderIndex === 0 && isDropTarget"\n\t\t\t\t\tclass="hr-department-detail-content__drop-placeholder"\n\t\t\t\t></div>\n\t\t\t\t<template v-for="(item, index) in listItems" :key="item.id">\n\t\t\t\t\t<slot :item="item"\n\t\t\t\t\t/>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="placeholderIndex === (index + 1) && isDropTarget"\n\t\t\t\t\t\tclass="hr-department-detail-content__drop-placeholder"\n\t\t\t\t\t></div>\n\t\t\t\t</template>\n\t\t\t\t<slot name="footer" />\n\t\t\t\t<EmptyListItem v-if="emptyItemTitle && emptyItemImageClass && !listItems.length && !hideEmptyItem"\n\t\t\t\t\t:title="emptyItemTitle"\n\t\t\t\t\t:imageClass="emptyItemImageClass"\n\t\t\t\t\t:withAddPermission="withAddPermission"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`};const y={name:"searchInput",props:{value:{type:String,required:false,default:""},placeholder:{type:String,required:true},dataTestId:{type:String,required:false}},data(){return{hasFocus:false}},methods:{handleInput(t){this.$emit("inputChange",t.target.value)},handleBlur(){if(this.value.length===0){this.hasFocus=false}},clearInput(){this.hasFocus=false;this.$emit("inputChange","")}},template:`\n\t\t<div\n\t\t\tclass="hr-department-detail-content__content-search"\n\t\t\t:class="{'--focused': hasFocus}"\n\t\t>\n\t\t\t<div class="hr-department-detail-content__content-search-icon ui-icon-set --search-1"/>\n\t\t\t<input\n\t\t\t\tclass="hr-department-detail-content__content-search-input"\n\t\t\t\ttype="text"\n\t\t\t\t:placeholder="!hasFocus ?  placeholder : ''"\n\t\t\t\t:data-test-id="dataTestId"\n\t\t\t\t:value="value"\n\t\t\t\t@input="handleInput"\n\t\t\t\t@focus="hasFocus = true"\n\t\t\t\t@blur="handleBlur"\n\t\t\t>\n\t\t\t<div\n\t\t\t\tclass="hr-department-detail-content__content-search-close-button ui-icon-set --cross-circle-50"\n\t\t\t\t:class="{'--hide': !hasFocus}"\n\t\t\t\t@click="clearInput"\n\t\t\t/>\n\t\t</div>\n\t`};const f={updateEmployees:(t,e)=>{const{departments:n}=C.useChartStore();const i=n.get(t);if(!i){return}n.set(t,{...i,employees:e})},updateHeads:(t,e)=>{const{departments:n}=C.useChartStore();const i=n.get(t);if(!i){return}n.set(t,{...i,heads:e})},updateEmployeeListOptions:(t,e)=>{const{departments:n}=C.useChartStore();const i=n.get(t);if(!i){return}i.employeeListOptions={...i.employeeListOptions,...e};n.set(t,i)},setChatsAndChannels:(t,e,n,i,s=0,a=0,o=0)=>{const r=C.useChartStore();const d=r.departments.get(t);if(!d){return}d.channelsDetailed=n;d.chatsDetailed=e;d.collabsDetailed=i;d.channelsNoAccess=a;d.chatsNoAccess=s;d.collabsNoAccess=o;d.communicationsCount=e.length+n.length+i.length+s+a+o},unbindChatFromNode:(t,e,n)=>{const i=C.useChartStore();const s=i.departments.get(t);if(!s){return}if(n===E.ChatTypes.collab){s.collabsDetailed=s.collabsDetailed.filter((t=>t.id!==e))}else{s.channelsDetailed=s.channelsDetailed.filter((t=>t.id!==e));s.chatsDetailed=s.chatsDetailed.filter((t=>t.id!==e))}s.communicationsCount--}};const b=70;const g={name:"usersTab",components:{SearchInput:y,EmptyState:O,TabList:I,EmptyTabAddButton:R,UserListItem:U,MoveEmployeeConfirmationPopup:u.MoveEmployeeConfirmationPopup},emits:["showDetailLoader","hideDetailLoader"],data(){return{searchQuery:"",selectedUserId:null,needToScroll:false,dragState:this.getInitialDragState(),showDndConfirmationPopup:false,dndPreviousState:null,dndPopupDescription:"",boundHandleDragMove:null,boundHandleDragEnd:null}},computed:{memberRoles(){return i.getMemberRoles(this.entityType)},heads(){var t;return(t=this.departments.get(this.focusedNode).heads)!=null?t:[]},headCount(){var t;return(t=this.heads.length)!=null?t:0},departmentId(){return this.focusedNode},formattedHeads(){return this.heads.map((t=>({...t,subtitle:t.workPosition,badgeText:this.getBadgeText(t.role)}))).sort(((t,e)=>{const n={[this.memberRoles.head]:1,[this.memberRoles.deputyHead]:2};const i=n[t.role]||3;const s=n[e.role]||3;return i-s}))},filteredHeads(){return this.formattedHeads.filter((t=>{var e;return t.name.toLowerCase().includes(this.searchQuery.toLowerCase())||((e=t.workPosition)==null?void 0:e.toLowerCase().includes(this.searchQuery.toLowerCase()))}))},employeeCount(){var t,e;const n=(t=this.departments.get(this.focusedNode).userCount)!=null?t:0;return n-((e=this.headCount)!=null?e:0)},formattedEmployees(){return this.employees.map((t=>({...t,subtitle:t.workPosition}))).reverse()},filteredEmployees(){return this.formattedEmployees.filter((t=>{var e;return t.name.toLowerCase().includes(this.searchQuery.toLowerCase())||((e=t.workPosition)==null?void 0:e.toLowerCase().includes(this.searchQuery.toLowerCase()))}))},memberCount(){var t;return(t=this.departments.get(this.focusedNode).userCount)!=null?t:0},...A.mapState(C.useChartStore,["focusedNode","departments","searchedUserId"]),...A.mapWritableState(C.useChartStore,["searchedUserId"]),employees(){var t,e;return(t=(e=this.departments.get(this.focusedNode))==null?void 0:e.employees)!=null?t:[]},showSearchBar(){return this.memberCount>0},showSearchEmptyState(){return this.filteredHeads.length===0&&this.filteredEmployees.length===0},canAddUsers(){const t=o.PermissionChecker.getInstance();if(!t){return false}const e=this.focusedNode;const n=this.isTeamEntity?o.PermissionActions.teamAddMember:o.PermissionActions.employeeAddToDepartment;return t.hasPermission(n,e)},headListEmptyStateTitle(){if(this.canAddUsers){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_TEAM_HEAD_EMPTY_LIST_ITEM_TITLE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_HEAD_EMPTY_LIST_ITEM_TITLE")}return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_TEAM_HEAD_EMPTY_LIST_ITEM_TITLE_WITHOUT_ADD_PERMISSION"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_HEAD_EMPTY_LIST_ITEM_TITLE_WITHOUT_ADD_PERMISSION")},employeesListEmptyStateTitle(){if(this.canAddUsers){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_TEAM_EMPLOYEE_EMPTY_LIST_ITEM_TITLE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_EMPLOYEE_EMPTY_LIST_ITEM_TITLE")}return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_TEAM_EMPLOYEE_EMPTY_LIST_ITEM_TITLE_WITHOUT_ADD_PERMISSION"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_EMPLOYEE_EMPTY_LIST_ITEM_TITLE_WITHOUT_ADD_PERMISSION")},shouldUpdateList(){var t,e;return(t=(e=this.departments.get(this.focusedNode).employeeListOptions)==null?void 0:e.shouldUpdateList)!=null?t:true},departmentUsersStatus(){const t=this.departments.get(this.focusedNode);if(t!=null&&t.heads&&t.employees){return{departmentId:this.focusedNode,loaded:true}}return{departmentId:this.focusedNode,loaded:false}},headMenu(){return new T.UsersTabActionMenu(this.focusedNode,i.AnalyticsSourceType.DETAIL,"head",this.entityType)},employeeMenu(){return new T.UsersTabActionMenu(this.focusedNode,i.AnalyticsSourceType.DETAIL,"employee",this.entityType)},isEmployeeListOptionsSet(){const t=this.departments.get(this.focusedNode)||{};return t.employeeListOptions&&Object.keys(t.employeeListOptions).length>0},employeeTitle(){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_TEAM_EMPLOYEE_LIST_TITLE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_EMPLOYEE_LIST_TITLE")},entityType(){var t;return(t=this.departments.get(this.focusedNode))==null?void 0:t.entityType},isTeamEntity(){return this.entityType===E.EntityTypes.team},emptyStateTitle(){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_EMPLOYEES_TEAM_ADD_USER_TITLE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_EMPLOYEES_ADD_USER_TITLE")},emptyStateDescription(){if(this.canAddUsers){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_EMPLOYEES_TEAM_ADD_USER_SUBTITLE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_EMPLOYEES_ADD_USER_SUBTITLE")}return this.isTeamEntity?"":this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_EMPLOYEES_ADD_USER_SUBTITLE")},isHeadListPotentialTarget(){return this.dragState.isDragging&&this.dragState.initialList==="employees"},isEmployeeListPotentialTarget(){return this.dragState.isDragging&&(this.dragState.initialList==="head"||this.dragState.initialList==="deputyHead")},dndConfirmationPopupTitle(){const t=this.dragState.targetList==="head";return t?undefined:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_DND_POPUP_CONFIRM_TITLE")},dndConfirmationPopupBtn(){const t=this.dragState.targetList==="head";return t?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_DND_POPUP_CONFIRM_BTN_TO_HEAD"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_DND_POPUP_CONFIRM_BTN")},showDndRoleSelect(){return this.dragState.targetList==="head"},headListTitle(){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_TEAM_HEAD_LIST_TITLE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_HEAD_LIST_TITLE")}},watch:{focusedNode(t){const e=this.departments.get(t)||{};if(!this.isEmployeeListOptionsSet){const n={page:0,shouldUpdateList:true,isListUpdated:false};f.updateEmployeeListOptions(t,n);this.departments.set(t,e)}if(e.employeeListOptions.page===0&&e.employeeListOptions.isListUpdated===false&&e.employeeListOptions.shouldUpdateList===true){this.loadEmployeesAction()}this.isDescriptionExpanded=false;this.searchQuery="";if(this.searchedUserId){this.needToFocusUserId=this.searchedUserId;this.$nextTick((()=>{this.scrollToUser()}))}},searchedUserId:{handler(t){if(!t){return}this.needToFocusUserId=t;if(this.isListUpdated){this.needToScroll=true}else{this.$nextTick((()=>{this.scrollToUser()}))}},immediate:true},async searchQuery(t){await this.searchMembers(t)},departmentUsersStatus(t,e){const{departmentId:n,loaded:i}=t;const{departmentId:s,loaded:a}=e;if(n===s&&i===a){return}if(i){this.$emit("hideDetailLoader")}else{this.$emit("showDetailLoader");this.loadEmployeesAction()}}},created(){this.loadEmployeesAction();this.clearSearchTimeout=null;this.autoscrollIntervalId=null;this.boundHandleDragMove=this.handleDragMove.bind(this);this.boundHandleDragEnd=this.handleDragEnd.bind(this)},mounted(){this.tabContainer=this.$refs["tab-container"]},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},getBadgeText(t){if(t===this.memberRoles.head){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPLOYEES_TEAM_HEAD_BADGE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPLOYEES_HEAD_BADGE")}if(t===this.memberRoles.deputyHead){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPLOYEES_TEAM_DEPUTY_HEAD_BADGE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPLOYEES_DEPUTY_HEAD_BADGE")}return null},updateList(t){const e=t.target;const n=e.scrollTop+e.clientHeight;if(e.scrollHeight-n<40){this.loadEmployeesAction()}},async loadEmployeesAction(){var t,e,n,i,s,a;const o=this.focusedNode;if(!this.departments.get(o)){return}const r=(t=this.departments.get(o).employeeListOptions)!=null?t:{};r.page=(e=r.page)!=null?e:0;r.shouldUpdateList=(n=r.shouldUpdateList)!=null?n:true;r.isListUpdated=(i=r.isListUpdated)!=null?i:false;f.updateEmployeeListOptions(o,r);if(r.isListUpdated||!r.shouldUpdateList){return}if(!r.isListUpdated&&r.page===0&&r.shouldUpdateList===true){this.$emit("showDetailLoader")}r.isListUpdated=true;r.page+=1;f.updateEmployeeListOptions(o,r);let d=await S.getPagedEmployees(o,r.page,25);if(!d){r.shouldUpdateList=false;r.isListUpdated=false;f.updateEmployeeListOptions(o,r);return}d=d.map((t=>({...t,role:this.memberRoles.employee})));const l=(s=(a=this.departments.get(o))==null?void 0:a.employees)!=null?s:[];const T=new Set(l.map((t=>t.id)));const c=d.reverse().filter((t=>!T.has(t.id)));l.unshift(...c);r.shouldUpdateList=c.length===25;r.isListUpdated=false;f.updateEmployeeListOptions(o,r);f.updateEmployees(o,l);if(this.departmentUsersStatus.loaded){this.$emit("hideDetailLoader")}if(this.needToScroll){this.scrollToUser()}},async scrollToUser(){const t=this.needToFocusUserId;this.needToFocusUserId=null;this.needToScroll=false;const e=`.hr-department-detail-content__user-container[data-id="hr-department-detail-content__user-${t}-item"]`;let n=this.tabContainer.querySelector(e);if(!n){let a=null;try{a=await S.getUserInfo(this.focusedNode,t)}catch{}const o=this.departments.get(this.focusedNode);if(!a||!o){return}if(a.role===this.memberRoles.head||a.role===this.memberRoles.deputyHead){var i;o.heads=(i=o.heads)!=null?i:[];if(!o.heads.some((t=>t.id===a.id))){return}}else{var s;o.employees=(s=o.employees)!=null?s:[];if(!o.employees.some((t=>t.id===a.id))){o.employees.push(a)}}await this.$nextTick((()=>{n=this.tabContainer.querySelector(e)}))}if(!n){return}n.scrollIntoView({behavior:"smooth",block:"center"});setTimeout((()=>{this.selectedUserId=t}),750);if(this.clearSearchTimeout){clearTimeout(this.clearSearchTimeout)}this.clearSearchTimeout=setTimeout((()=>{if(this.searchedUserId===t){this.selectedUserId=null;this.searchedUserId=null}}),4e3)},async searchMembers(t){if(t.length===0){return}this.findQueryResult=this.findQueryResult||{};this.findQueryResult[this.focusedNode]=this.findQueryResult[this.focusedNode]||{success:[],failure:[]};const e=this.findQueryResult[this.focusedNode];if(e.failure.some((e=>t.startsWith(e)))){return}if(e.success.includes(t)||e.failure.includes(t)){return}const n=await S.findMemberByQuery(this.focusedNode,t);if(n.length===0){e.failure.push(t);return}const i=this.departments.get(this.focusedNode);const s=n.filter((t=>!i.heads.some((e=>e.id===t.id))&&!i.employees.some((e=>e.id===t.id))));i.employees.push(...s);e.success.push(t)},searchUser(t){this.searchQuery=t},onHeadListActionMenuItemClick(t){this.headMenu.onActionMenuItemClick(t)},onEmployeeListActionMenuItemClick(t){this.employeeMenu.onActionMenuItemClick(t)},getHeadListDataTestIds(){return p},getEmployeeListDataTestIds(){return N},handleItemDragStart(t){if(this.dragState.isDragging){return}const{event:e,element:n,userId:i,initialListType:s}=t;e.preventDefault();this.dragState.isDragging=true;this.dragState.userId=i;this.dragState.initialList=s;this.dragState.draggedElement=n;const a=this.dragState.draggedElement.getBoundingClientRect();this.dragState.offsetX=e.clientX-a.left;this.dragState.offsetY=e.clientY-a.top;const o=this.dragState.draggedElement.cloneNode(true);m.Dom.addClass(o,"--ghost");m.Dom.style(o,"left",`${e.clientX-this.dragState.offsetX}px`);m.Dom.style(o,"top",`${e.clientY-this.dragState.offsetY}px`);m.Dom.append(o,document.body);this.dragState.ghostElement=o;m.Dom.addClass(this.dragState.draggedElement,"--dragging");m.Dom.addClass(document.body,"--user-dragging");m.Event.bind(document,"mousemove",this.boundHandleDragMove);m.Event.bind(document,"mouseup",this.boundHandleDragEnd);const r=this.formattedHeads.find((t=>t.id===i))||this.formattedEmployees.find((t=>t.id===i));l.EventEmitter.emit(T.events.HR_USER_DRAG_START,{user:r})},handleDragMove(t){var e,n;if(!this.dragState.isDragging){return}m.Dom.addClass(this.dragState.draggedElement,"--hidden");l.EventEmitter.emit(T.events.HR_USER_DRAG_MOVE,{pageX:t.pageX,pageY:t.pageY});if(this.dragState.ghostElement){m.Dom.style(this.dragState.ghostElement,"left",`${t.clientX-this.dragState.offsetX}px`);m.Dom.style(this.dragState.ghostElement,"top",`${t.clientY-this.dragState.offsetY}px`)}let i=null;if(this.isHeadListPotentialTarget&&this.isPointerOverElement(t,(e=this.$refs.headList)==null?void 0:e.$el)){i="head"}else if(this.isEmployeeListPotentialTarget&&this.isPointerOverElement(t,(n=this.$refs.employeeList)==null?void 0:n.$el)){i="employee"}this.dragState.targetList=i;this.handleAutoscrollOnDrag(t)},handleAutoscrollOnDrag(t){if(!this.isHeadListPotentialTarget){return}const e=this.$refs.scrollableContainer;if(!e){return}const n=e.getBoundingClientRect();const i=t.clientY;const s=n.top+b;if(i<s){if(this.autoscrollIntervalId!==null){return}const t=10;this.autoscrollIntervalId=setInterval((()=>{e.scrollTop-=t}),16)}else{this.stopAutoscroll()}},stopAutoscroll(){if(this.autoscrollIntervalId!==null){clearInterval(this.autoscrollIntervalId);this.autoscrollIntervalId=null}},isPointerOverElement(t,e){if(!e){return false}const n=e.getBoundingClientRect();return t.clientX>=n.left&&t.clientX<=n.right&&t.clientY>=n.top&&t.clientY<=n.bottom},async handleDragEnd(){if(!this.dragState.isDragging){return}l.EventEmitter.emit(T.events.HR_USER_DRAG_DROP);this.stopAutoscroll();const{userId:t,initialList:e,targetList:n,ghostElement:i,draggedElement:s}=this.dragState;const a=t&&n&&n!==e;let o=null;if(a){const t=n==="head"?this.$refs.headList:this.$refs.employeeList;o=t==null?void 0:t.placeholderIndex}m.Event.unbind(document,"mousemove",this.boundHandleDragMove);m.Event.unbind(document,"mouseup",this.boundHandleDragEnd);if(i){m.Dom.remove(i)}if(s){m.Dom.removeClass(s,"--dragging");m.Dom.removeClass(s,"--hidden")}m.Dom.removeClass(document.body,"--user-dragging");l.EventEmitter.emit(T.events.HR_USER_DRAG_END);if(!a||o===null){this.dragState=this.getInitialDragState();return}this.dragState.isDragging=false;this.dragState.ghostElement=null;this.dragState.draggedElement=null;this.dragState.context={targetIndex:o};this.dndPreviousState=this.moveDndUser();if(!this.dndPreviousState){this.dragState=this.getInitialDragState();return}const{context:r}=this.dragState;r.selectedRole=null;r.selectedRoleLabel="";if(n==="head"){r.selectedRole=this.memberRoles.head;r.selectedRoleLabel=this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPLOYEES_HEAD_BADGE")}await this.prepareDndPopupDescription();this.showDndConfirmationPopup=true},cancelDndUserMove(){const{heads:t,employees:e}=this.dndPreviousState;f.updateHeads(this.focusedNode,t);f.updateEmployees(this.focusedNode,e);this.dndPreviousState=null;this.dragState=this.getInitialDragState();this.showDndConfirmationPopup=false},async confirmDndUserMove(t){const{userId:n}=this.dragState;const i=t.role||this.memberRoles.employee;const s=this.departments.get(this.focusedNode);const a=s.heads.find((t=>t.id===n))||s.employees.find((t=>t.id===n));if(!a){this.dragState=this.getInitialDragState();return}const o=a.role;a.role=i;try{await e.UserManagementDialogAPI.addUsersToDepartment(this.focusedNode,[n],i);c.UI.Notification.Center.notify({content:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_DND_SUCCEED"),autoHideDelay:3e3})}catch(t){console.error(t);a.role=o;this.cancelDndUserMove()}this.showDndConfirmationPopup=false;this.dragState=this.getInitialDragState()},async prepareDndPopupDescription(){var t,e,n,i,s;const{userId:a,targetList:o}=this.dragState;const r=o==="head";const d=this.isTeamEntity;const l=this.departments.get(this.departmentId);const T=m.Text.encode((t=l==null?void 0:l.name)!=null?t:"");let c=null;try{c=await S.getUserInfo(this.departmentId,a)}catch{}const _=m.Text.encode((e=(n=c)==null?void 0:n.name)!=null?e:"");const E=(i=(s=c)==null?void 0:s.url)!=null?i:"#";let h="";if(r){h=d?"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_DND_POPUP_CONFIRM_DESC_TEAM_HEAD":"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_DND_POPUP_CONFIRM_DESC_HEAD"}else{var u;const t=d?"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_DND_POPUP_CONFIRM_DESC_TEAM":"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_DND_POPUP_CONFIRM_DESC";const e=((u=c)==null?void 0:u.gender)==="F"?"_F":"_M";h=t+e}this.dndPopupDescription=this.loc(h,{"#USER_NAME#":_,"#DEPARTMENT_NAME#":T}).replace("[link]",`<a class="hr-department-detail-content__move-user-department-user-link" href="${E}">`).replace("[/link]","</a>")},moveDndUser(){const{userId:t,targetList:e,context:n}=this.dragState;const{targetIndex:i}=n;const s=this.departments.get(this.focusedNode);if(!s){return null}const a={heads:[...s.heads],employees:[...s.employees]};const o=e==="head";const r=o?[...a.employees]:[...a.heads];const d=o?[...a.heads]:[...a.employees];const l=r.findIndex((e=>e.id===t));if(l===-1){return null}const[T]=r.splice(l,1);d.splice(i,0,T);if(o){f.updateHeads(this.focusedNode,d);f.updateEmployees(this.focusedNode,r)}else{f.updateHeads(this.focusedNode,r);f.updateEmployees(this.focusedNode,d)}return a},getInitialDragState(){return{isDragging:false,userId:null,initialList:null,targetList:null,ghostElement:null,draggedElement:null,offsetX:0,offsetY:0,context:null}}},template:`\n\t\t<div class="hr-department-detail-content__tab-container --users" ref="tab-container">\n\t\t\t<template v-if="memberCount > 0">\n\t\t\t\t<SearchInput\n\t\t\t\t\tv-if="showSearchBar"\n\t\t\t\t\t:placeholder="loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_SEARCH_PLACEHOLDER')"\n\t\t\t\t\t:value="searchQuery"\n\t\t\t\t\t@inputChange="searchUser"\n\t\t\t\t\tdataTestId="hr-department-detail-content_users-tab__users-search-input"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tv-if="!showSearchEmptyState"\n\t\t\t\t\tv-on="shouldUpdateList ? { scroll: updateList } : {}"\n\t\t\t\t\tclass="hr-department-detail-content__lists-container"\n\t\t\t\t\tref="scrollableContainer"\n\t\t\t\t>\n\t\t\t\t\t<TabList\n\t\t\t\t\t\tref="headList"\n\t\t\t\t\t\tid='hr-department-detail-content_chats-tab__chat-list'\n\t\t\t\t\t\t:title="headListTitle"\n\t\t\t\t\t\t:count="headCount"\n\t\t\t\t\t\t:menuItems="headMenu.items"\n\t\t\t\t\t\t:listItems="filteredHeads"\n\t\t\t\t\t\tlistType="head"\n\t\t\t\t\t\t:emptyItemTitle="headListEmptyStateTitle"\n\t\t\t\t\t\temptyItemImageClass="hr-department-detail-content__empty-user-list-item-image"\n\t\t\t\t\t\t:hideEmptyItem="searchQuery.length > 0"\n\t\t\t\t\t\t:withAddPermission="canAddUsers"\n\t\t\t\t\t\t@tabListAction="onHeadListActionMenuItemClick"\n\t\t\t\t\t\t:dataTestIds="getHeadListDataTestIds()"\n\t\t\t\t\t\t:isDropTarget="isHeadListPotentialTarget && dragState.targetList === 'head'"\n\t\t\t\t\t>\n\t\t\t\t\t\t<template v-slot="{ item }">\n\t\t\t\t\t\t\t<UserListItem\n\t\t\t\t\t\t\t\t:user="item"\n\t\t\t\t\t\t\t\tlistType="head"\n\t\t\t\t\t\t\t\t:selectedUserId="selectedUserId"\n\t\t\t\t\t\t\t\t:entityType="entityType"\n\t\t\t\t\t\t\t\t:canDrag="canAddUsers"\n\t\t\t\t\t\t\t\t@itemDragStart="handleItemDragStart"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</TabList>\n\t\t\t\t\t<TabList\n\t\t\t\t\t\tref="employeeList"\n\t\t\t\t\t\tid='hr-department-detail-content_chats-tab__channel-list'\n\t\t\t\t\t\t:title="employeeTitle"\n\t\t\t\t\t\t:count="employeeCount"\n\t\t\t\t\t\tlistType="employees"\n\t\t\t\t\t\t:menuItems="employeeMenu.items"\n\t\t\t\t\t\t:listItems="filteredEmployees"\n\t\t\t\t\t\t:emptyItemTitle="employeesListEmptyStateTitle"\n\t\t\t\t\t\temptyItemImageClass="hr-department-detail-content__empty-user-list-item-image"\n\t\t\t\t\t\t:hideEmptyItem="searchQuery.length > 0"\n\t\t\t\t\t\t:withAddPermission="canAddUsers"\n\t\t\t\t\t\t@tabListAction="onEmployeeListActionMenuItemClick"\n\t\t\t\t\t\t:dataTestIds="getEmployeeListDataTestIds()"\n\t\t\t\t\t\t:isDropTarget="isEmployeeListPotentialTarget && dragState.targetList === 'employee'"\n\t\t\t\t\t>\n\t\t\t\t\t\t<template v-slot="{ item }">\n\t\t\t\t\t\t\t<UserListItem\n\t\t\t\t\t\t\t\t:user="item"\n\t\t\t\t\t\t\t\tlistType="employees"\n\t\t\t\t\t\t\t\t:canDrag="canAddUsers"\n\t\t\t\t\t\t\t\t@itemDragStart="handleItemDragStart"\n\t\t\t\t\t\t\t\t:selectedUserId="selectedUserId"\n\t\t\t\t\t\t\t\t:entityType="entityType"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</TabList>\n\t\t\t\t</div>\n\t\t\t\t<EmptyState v-else\n\t\t\t\t\timageClass="hr-department-detail-content__empty-tab-user-not-found-icon"\n\t\t\t\t\t:title="loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_SEARCHED_EMPLOYEES_TITLE')"\n\t\t\t\t\t:description ="loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_SEARCHED_EMPLOYEES_SUBTITLE')"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<EmptyState v-else\n\t\t\t\t:imageClass="canAddUsers \n\t\t\t\t\t? 'hr-department-detail-content__empty-tab-add-user-icon' \n\t\t\t\t\t: 'hr-department-detail-content__empty-tab-cant-add-user-icon'"\n\t\t\t\t:title="emptyStateTitle"\n\t\t\t\t:description ="emptyStateDescription"\n\t\t\t>\n\t\t\t\t<template v-slot:content>\n\t\t\t\t\t<EmptyTabAddButton v-if="canAddUsers" :departmentId="departmentId" :entityType="entityType"/>\n\t\t\t\t</template>\n\t\t\t</EmptyState>\n\t\t\t<MoveEmployeeConfirmationPopup \n\t\t\t\tv-if="showDndConfirmationPopup" \n\t\t\t\t:title="dndConfirmationPopupTitle"\n\t\t\t\t:description="dndPopupDescription"\n\t\t\t\t:confirmButtonText="dndConfirmationPopupBtn"\n\t\t\t\t:showRoleSelect="showDndRoleSelect"\n\t\t\t\t:excludeEmployeeRole="true"\n\t\t\t\t:targetType="entityType"\n\t\t\t\t@confirm="confirmDndUserMove"\n\t\t\t\t@close="cancelDndUserMove"\n\t\t\t/>\n\t\t</div>\n\t`};const L=Object.freeze({linkChat:"linkChat",linkChannel:"linkChannel",linkCollab:"linkCollab"});const v=Object.freeze({id:L.linkChat,title:m.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_LIST_LINK_BUTTON_TITLE"),description:m.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_LIST_LINK_BUTTON_DESC"),bIcon:{name:r.Main.CHAT_MESSAGE,size:20,colorTokenName:"paletteBlue50"},dataTestId:"hr-department-content_chats-tab__chat-list-action-link"});const H=Object.freeze({id:L.linkChannel,title:m.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_LIST_LINK_BUTTON_TITLE"),description:m.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_LIST_LINK_BUTTON_DESC"),bIcon:{name:r.Main.SPEAKER_MOUTHPIECE,size:20,colorTokenName:"paletteBlue50"},dataTestId:"hr-department-content_chats-tab__channel-list-action-link"});const B=Object.freeze({id:L.linkCollab,title:m.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_COLLAB_LIST_LINK_BUTTON_TITLE"),description:m.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_COLLAB_LIST_LINK_BUTTON_DESC"),bIcon:{name:r.Main.COLLAB,size:20,colorTokenName:"paletteBlue50"},dataTestId:"hr-department-content_chats-tab__collab-list-action-link"});const Y=Object.freeze({containerDataTestId:"hr-department-content_chats-tab__chat-list-container",listActionButtonDataTestId:"hr-department-content_chats-tab__chat-list-action-button",listActonMenuDataTestId:"hr-department-content_chats-tab__chat-list-action-menu-container",listCounterDataTestId:"hr-department-content_chats-tab__chat-list-counter"});const k=Object.freeze({containerDataTestId:"hr-department-content_chats-tab__channel-list-container",listActionButtonDataTestId:"hr-department-content_chats-tab__channel-list-action-button",listActonMenuDataTestId:"hr-department-content_chats-tab__channel-list-action-menu-container",listCounterDataTestId:"hr-department-content_chats-tab__channel-list-counter"});const w=Object.freeze({containerDataTestId:"hr-department-content_chats-tab__collab-list-container",listActionButtonDataTestId:"hr-department-content_chats-tab__collab-list-action-button",listActonMenuDataTestId:"hr-department-content_chats-tab__collab-list-action-menu-container",listCounterDataTestId:"hr-department-content_chats-tab__collab-list-counter"});const x=Object.freeze({containerDataTestId:"hr-department-content_chats-tab__link-chat-container",confirmButtonDataTestId:"hr-department-content_chats-tab__link-chat-confirm-button",cancelButtonDataTestId:"hr-department-content_chats-tab__link-chat-cancel-button",closeButtonDataTestId:"hr-department-content_chats-tab__link-chat-close-button",addWithChildrenDataTestId:"hr-department-content_chats-tab__link-chat-add-with-children"});const F=Object.freeze({containerDataTestId:"hr-department-content_chats-tab__link-channel-container",confirmButtonDataTestId:"hr-department-content_chats-tab__link-channel-confirm-button",cancelButtonDataTestId:"hr-department-content_chats-tab__link-channel-cancel-button",closeButtonDataTestId:"hr-department-content_chats-tab__link-channel-close-button",addWithChildrenDataTestId:"hr-department-content_chats-tab__link-channel-add-with-children"});const V=Object.freeze({containerDataTestId:"hr-department-content_chats-tab__link-collab-container",confirmButtonDataTestId:"hr-department-content_chats-tab__link-collab-confirm-button",cancelButtonDataTestId:"hr-department-content_chats-tab__link-collab-cancel-button",closeButtonDataTestId:"hr-department-content_chats-tab__link-collab-close-button",addWithChildrenDataTestId:"hr-department-content_chats-tab__link-collab-add-with-children"});const $={name:"emptyStateButtons",components:{RouteActionMenu:u.RouteActionMenu},props:{canEditChat:{type:Boolean,required:true},canEditChannel:{type:Boolean,required:true},canEditCollab:{type:Boolean,required:true},isTeamEntity:{type:Boolean,required:true}},emits:["emptyStateAddAction"],data(){return{menuVisible:false}},computed:{menu(){const t=[];if(this.canEditCollab){t.push(B)}if(this.canEditChannel){t.push(H)}if(this.canEditChat){t.push(v)}return t},...A.mapState(C.useChartStore,["focusedNode"])},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},onClick(){this.menuVisible=true},onActionMenuItemClick(t){this.$emit("emptyStateAddAction",t)}},template:`\n\t\t<div class="hr-department-detail-content__users-empty-tab-add_buttons-container">\n\t\t\t<button\n\t\t\t\tclass="hr-add-communications-empty-tab-entity-btn ui-btn ui-btn ui-btn-sm ui-btn-primary ui-btn-round"\n\t\t\t\tref="actionMenuButton"\n\t\t\t\t@click.stop="onClick"\n\t\t\t\tdata-id="hr-department-detail-content__user-empty-tab_add-user-button"\n\t\t\t>\n\t\t\t\t<span class="hr-add-communications-empty-tab-entity-btn-text">\n\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_ADD_BUTTON')}}\n\t\t\t\t</span>\n\t\t\t</button>\n\t\t\t<RouteActionMenu\n\t\t\t\tv-if="menuVisible"\n\t\t\t\t:id="'empty-state-department-detail-add-communications-menu-' + focusedNode"\n\t\t\t\t:items="menu"\n\t\t\t\t:delimiter="false"\n\t\t\t\t:width="302"\n\t\t\t\t:bindElement="$refs.actionMenuButton"\n\t\t\t\t:containerDataTestId="'empty-state-department-detail-add-communications-menu'"\n\t\t\t\t@action="onActionMenuItemClick"\n\t\t\t\t@close="menuVisible = false"\n\t\t\t/>\n\t\t</div>\n\t`};const q=Object.freeze({chat:{team:{title:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_UNBIND_POPUP_CHAT_FROM_TEAM_TITLE",description:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_UNBIND_POPUP_CHAT_FROM_TEAM_DESCRIPTION",error:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_UNBIND_POPUP_CHAT_FROM_TEAM_ERROR",success:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_UNBIND_POPUP_CHAT_FROM_TEAM_SUCCESS"},department:{title:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_UNBIND_POPUP_CHAT_FROM_DEPARTMENT_TITLE",description:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_UNBIND_POPUP_CHAT_FROM_DEPARTMENT_DESCRIPTION",error:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_UNBIND_POPUP_CHAT_FROM_DEPARTMENT_ERROR",success:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_UNBIND_POPUP_CHAT_FROM_DEPARTMENT_SUCCESS"}},channel:{team:{title:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_UNBIND_POPUP_CHANNEL_FROM_TEAM_TITLE",description:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_UNBIND_POPUP_CHANNEL_FROM_TEAM_DESCRIPTION",error:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_UNBIND_POPUP_CHANNEL_FROM_TEAM_ERROR",success:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_UNBIND_POPUP_CHANNEL_FROM_TEAM_SUCCESS"},department:{title:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_UNBIND_POPUP_CHANNEL_FROM_DEPARTMENT_TITLE",description:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_UNBIND_POPUP_CHANNEL_FROM_DEPARTMENT_DESCRIPTION",error:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_UNBIND_POPUP_CHANNEL_FROM_DEPARTMENT_ERROR",success:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_UNBIND_POPUP_CHANNEL_FROM_DEPARTMENT_SUCCESS"}},collab:{team:{title:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_UNBIND_POPUP_COLLAB_FROM_TEAM_TITLE",description:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_UNBIND_POPUP_COLLAB_FROM_TEAM_DESCRIPTION",error:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_UNBIND_POPUP_COLLAB_FROM_TEAM_ERROR",success:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_UNBIND_POPUP_COLLAB_FROM_TEAM_SUCCESS"},department:{title:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_UNBIND_POPUP_COLLAB_FROM_DEPARTMENT_TITLE",description:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_UNBIND_POPUP_COLLAB_FROM_DEPARTMENT_DESCRIPTION",error:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_UNBIND_POPUP_COLLAB_FROM_DEPARTMENT_ERROR",success:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_UNBIND_POPUP_COLLAB_FROM_DEPARTMENT_SUCCESS"}}});const X={name:"communicationListItemActionButton",components:{RouteActionMenu:u.RouteActionMenu,ConfirmationPopup:u.ConfirmationPopup},props:{communication:{type:Object,required:true},nodeId:{type:Number,required:true}},data(){return{isMenuVisible:false,showUnbindConfirmationPopup:false,unbindLoader:false,dictionary:{}}},computed:{entityType(){var t;return(t=this.departments.get(this.nodeId))==null?void 0:t.entityType},isTeamEntity(){var t;return((t=this.departments.get(this.nodeId))==null?void 0:t.entityType)===E.EntityTypes.team},menu(){var t;const e=(t=this.departments.get(this.nodeId))==null?void 0:t.entityType;return new T.ChatListActionMenu(e,this.communication,this.nodeId)},buttonDataId(){const t=this.communication.type.toLowerCase();return`hr-department-detail-content__${t}-list_chat-${this.communication.id}-action-btn`},...A.mapState(C.useChartStore,["departments"])},created(){this.dictionary=q[this.communication.type.toLowerCase()]&&q[this.communication.type.toLowerCase()][this.entityType.toLowerCase()]||{}},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},toggleMenu(){this.isMenuVisible=!this.isMenuVisible},onActionMenuItemClick(t){if(t===T.MenuActions.openChat){_.Messenger.openChat(this.communication.dialogId)}else if(t===T.MenuActions.unbindChat){this.showUnbindConfirmationPopup=true}},cancelUnbind(){this.showUnbindConfirmationPopup=false},async unbind(){this.unbindLoader=true;try{switch(this.communication.type){case E.ChatTypes.chat:await S.saveChats(this.nodeId,[],[this.communication.id]);break;case E.ChatTypes.channel:await S.saveChannel(this.nodeId,[],[this.communication.id]);break;case E.ChatTypes.collab:await S.saveCollab(this.nodeId,[],[this.communication.id]);break;default:break}}catch(t){if(t.code!=="STRUCTURE_ACCESS_DENIED"){c.UI.Notification.Center.notify({content:this.loc(this.dictionary.error),autoHideDelay:2e3})}return}finally{this.unbindLoader=false;this.showUnbindConfirmationPopup=false}f.unbindChatFromNode(this.nodeId,this.communication.id,this.communication.type);const t=!this.communication.originalNodeId||this.communication.originalNodeId===this.nodeId;if(t){const t=C.useChartStore();t.updateChatsInChildrenNodes(this.nodeId)}c.UI.Notification.Center.notify({content:this.loc(this.dictionary.success),autoHideDelay:2e3})}},template:`\n\t\t<button\n\t\t\tv-if="menu.items.length"\n\t\t\tclass="ui-icon-set --more hr-department-detail-content__tab-list_item-action-btn --chat-item-action-btn ui-icon-set"\n\t\t\t:class="{ '--focused': isMenuVisible }"\n\t\t\t@click.stop="toggleMenu()"\n\t\t\tref="actionCommunicationButton"\n\t\t\t:data-id="buttonDataId"\n\t\t/>\n\t\t<RouteActionMenu\n\t\t\tv-if="isMenuVisible"\n\t\t\t:id="'tree-node-department-menu-chat_' + this.nodeId + '_' + communication.id"\n\t\t\t:items="menu.items"\n\t\t\t:width="302"\n\t\t\t:bindElement="$refs.actionCommunicationButton"\n\t\t\t@action="onActionMenuItemClick"\n\t\t\t@close="isMenuVisible = false"\n\t\t/>\n\t\t<ConfirmationPopup\n\t\t\tref="unbindConfirmationPopup"\n\t\t\tv-if="showUnbindConfirmationPopup"\n\t\t\t:showActionButtonLoader="unbindLoader"\n\t\t\t:title="loc(dictionary.title)"\n\t\t\t:confirmBtnText="loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_UNBIND_POPUP_CONFIRM_BUTTON')"\n\t\t\tconfirmButtonClass="ui-btn-danger"\n\t\t\t@action="unbind"\n\t\t\t@close="cancelUnbind"\n\t\t\t:width="364"\n\t\t>\n\t\t\t<template v-slot:content>\n\t\t\t\t<div class="hr-department-detail-content__user-action-text-container">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-html="loc(dictionary.description)"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</ConfirmationPopup>\n\t`};const W=Object.freeze({[E.ChatTypes.chat]:{parentTeamHint:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_PARENT_TEAM_CHAT_HINT",subtitleForTeam:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_OF_TEAM_MSGVER_2",parentDepartmentOfDepartmentHint:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_PARENT_DEPARTMENT_CHAT_OF_DEPARTMENT_HINT",parentDepartmentOfTeamHint:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_PARENT_DEPARTMENT_CHAT_OF_TEAM_HINT",subtitleForDepartment:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_OF_DEPARTMENT_MSGVER_2",getAvatar:t=>new h.AvatarRound(t),dataTestIdPrefix:"hr-department-content_chats-tab__list_chat-item-"},[E.ChatTypes.channel]:{parentTeamHint:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_PARENT_TEAM_CHANNEL_HINT",subtitleForTeam:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_OF_TEAM_MSGVER_2",parentDepartmentOfDepartmentHint:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_PARENT_DEPARTMENT_CHANNEL_OF_DEPARTMENT_HINT",parentDepartmentOfTeamHint:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_PARENT_DEPARTMENT_CHANNEL_OF_TEAM_HINT",subtitleForDepartment:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_OF_DEPARTMENT_MSGVER_2",getAvatar:t=>new h.AvatarSquare(t),dataTestIdPrefix:"hr-department-content_chats-tab__list_chat-item-"},[E.ChatTypes.collab]:{parentTeamHint:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_PARENT_TEAM_COLLAB_HINT",subtitleForTeam:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_COLLAB_OF_TEAM_MSGVER_2",parentDepartmentOfDepartmentHint:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_PARENT_DEPARTMENT_COLLAB_OF_DEPARTMENT_HINT",parentDepartmentOfTeamHint:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_PARENT_DEPARTMENT_COLLAB_OF_TEAM_HINT",subtitleForDepartment:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_COLLAB_OF_DEPARTMENT_MSGVER_2",getAvatar:t=>new h.AvatarHexagonGuest(t),dataTestIdPrefix:"hr-department-content_chats-tab__list_collab-item-"}});const G={name:"communicationListItem",components:{ChatListItemActionButton:X,ResponsiveHint:u.ResponsiveHint},directives:{hint:u.Hint},props:{communication:{type:Object,required:true},nodeId:{type:Number,required:true}},data(){return{avatar:null}},computed:{dictionary(){return W[this.communication.type]||W[E.ChatTypes.channel]},originalNodeName(){var t;return(t=this.departments.get(this.communication.originalNodeId))==null?void 0:t.name},hiddenNodeName(){var t;return((t=this.structureMap.get(this.communication.originalNodeId))==null?void 0:t.entityType)===E.EntityTypes.team?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_HIDDEN_TEAM"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_HIDDEN_DEPARTMENT")},preparedIndirectSubtitle(){var t;let e="";if(((t=this.structureMap.get(this.communication.originalNodeId))==null?void 0:t.entityType)===E.EntityTypes.team){e=this.loc(this.dictionary.subtitleForTeam)}else{e=this.loc(this.dictionary.subtitleForDepartment)}const n=e.split("#NAME#");return{beforeText:n[0]||null,afterText:n[1]||null}},lockHint(){var t,e;if(((t=this.structureMap.get(this.communication.originalNodeId))==null?void 0:t.entityType)===E.EntityTypes.team){return this.loc(this.dictionary.parentTeamHint)}if(((e=this.structureMap.get(this.nodeId))==null?void 0:e.entityType)===E.EntityTypes.department){return this.loc(this.dictionary.parentDepartmentOfDepartmentHint)}return this.loc(this.dictionary.parentDepartmentOfTeamHint)},...A.mapState(C.useChartStore,["structureMap","departments"])},watch:{communication(){this.prepareAvatar()}},created(){this.prepareAvatar()},methods:{prepareAvatar(){if(this.communication.avatar){this.communication.color=E.getColorCode("whiteBase")}const t={size:32,userName:this.communication.title,baseColor:this.isExtranet()&&!this.communication.avatar?E.getColorCode("extranetColor"):this.communication.color,events:{click:()=>{this.onChatItemClick()}}};if(this.communication.avatar){t.userpicPath=this.communication.avatar}this.avatar=this.dictionary.getAvatar(t)},loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},onChatItemClick(){if(this.communication.hasAccess){_.Messenger.openChat(this.communication.dialogId)}},isExtranet(){return this.communication.isExtranet},locateToOriginalDepartment(){l.EventEmitter.emit(T.events.HR_ORG_CHART_LOCATE_TO_DEPARTMENT,{nodeId:this.communication.originalNodeId})}},template:`\n\t\t<div\n\t\t\t:key="communication.id"\n\t\t\tclass="hr-department-detail-content__tab-list_item-wrapper --chat"\n\t\t\t:class="{ '--isExtranet': isExtranet() }"\n\t\t\t:data-test-id="dictionary.dataTestIdPrefix + communication.id"\n\t\t>\n\t\t\t<div\n\t\t\t\tclass="hr-department-detail-content__tab-list_item-avatar-container"\n\t\t\t\t:class="{ '--not-clickable': !communication.hasAccess }"\n\t\t\t\tv-html="this.avatar.getContainer().outerHTML"\n\t\t\t\t@click="onChatItemClick"\n\t\t\t/>\n\t\t\t<div class="hr-department-detail-content__tab-list_item-text-container">\n\t\t\t\t<div class="hr-department-detail-content__tab-list_item-title-container --chat-item">\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass="hr-department-detail-content__tab-list_item-title"\n\t\t\t\t\t\t:class="{ '--not-clickable': !communication.hasAccess }"\n\t\t\t\t\t\t:data-test-id="'hr-department-content_chats-tab__list_chat-item-' + communication.id + '-title'"\n\t\t\t\t\t\t@click="onChatItemClick"\n\t\t\t\t\t>{{ communication.title }}</span>\n\t\t\t\t\t<ResponsiveHint\n\t\t\t\t\t\tv-if="communication.originalNodeId"\n\t\t\t\t\t\t:content="lockHint"\n\t\t\t\t\t\t:extraClasses="{ 'hr-department-detail-content__tab-list_hint-container': true }"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span class="ui-icon-set --lock hr-department-detail-content__tab-list_lock-icon"></span>\n\t\t\t\t\t</ResponsiveHint>\n\t\t\t\t</div>\n\t\t\t\t<div v-if="communication.originalNodeId && originalNodeName"\n\t\t\t\t\t class="hr-department-detail-content__tab-list_item-subtitle --chat-item">\n\t\t\t\t\t<span class="hr-department-detail-content__tab-list_item-subtitle_before">\n\t\t\t\t\t\t{{ preparedIndirectSubtitle.beforeText }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<ResponsiveHint\n\t\t\t\t\t\t:content="originalNodeName"\n\t\t\t\t\t\tdefaultClass="hr-department-detail-content__tab-list_orig-node-name"\n\t\t\t\t\t\t:checkScrollWidth="true"\n\t\t\t\t\t\t:width="null"\n\t\t\t\t\t\t@click="locateToOriginalDepartment"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ originalNodeName }}\n\t\t\t\t\t</ResponsiveHint>\n\t\t\t\t\t<span class="hr-department-detail-content__tab-list_item-subtitle_after">\n\t\t\t\t\t\t{{ preparedIndirectSubtitle.afterText }}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div v-else-if="communication.originalNodeId"\n\t\t\t\t\t class="hr-department-detail-content__tab-list_item-subtitle --chat-item">\n\t\t\t\t\t<span class="hr-department-detail-content__tab-list_item-subtitle_before">\n\t\t\t\t\t\t{{ preparedIndirectSubtitle.beforeText }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class="hr-department-detail-content__tab-list_orig-node-hidden-name">\n\t\t\t\t\t\t{{ hiddenNodeName }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class="hr-department-detail-content__tab-list_item-subtitle_after">\n\t\t\t\t\t\t{{ preparedIndirectSubtitle.afterText }}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div v-else class="hr-department-detail-content__tab-list_item-subtitle">\n\t\t\t\t\t{{ communication.subtitle }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<ChatListItemActionButton\n\t\t\t\t:communication="communication"\n\t\t\t\t:nodeId="nodeId"\n\t\t\t/>\n\t\t</div>\n\t`};const Q=Object.freeze({chat:{tabListId:"hr-department-detail-content_chats-tab__chat-list",footerDataTestId:"hr-department-content_chats-tab__list_chat-hidden-text",listTitle:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_LIST_TITLE",emptyItemTitle:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_CHAT_LIST_ITEM_TEXT_MSGVER_1",noTeamText:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_CHAT_LIST_ITEM_NO_TEAM_TEXT_MSGVER_1",noDepartmentText:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_CHAT_LIST_ITEM_NO_DEPARTMENT_TEXT_MSGVER_1",moreHiddenText:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_CHAT_LIST_ITEM_MORE_HIDDEN_TEXT",emptyHiddenText:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_CHAT_LIST_ITEM_EMPTY_HIDDEN_TEXT",menuItems:[v]},channel:{tabListId:"hr-department-detail-content_chats-tab__channel-list",footerDataTestId:"hr-department-content_chats-tab__list_channel-hidden-text",listTitle:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_LIST_TITLE",emptyItemTitle:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_CHANNEL_LIST_ITEM_TEXT_MSGVER_1",noTeamText:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_CHANNEL_LIST_ITEM_NO_TEAM_TEXT_MSGVER_1",noDepartmentText:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_CHANNEL_LIST_ITEM_NO_DEPARTMENT_TEXT_MSGVER_1",moreHiddenText:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_CHANNEL_LIST_ITEM_MORE_HIDDEN_TEXT",emptyHiddenText:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_CHANNEL_LIST_ITEM_EMPTY_HIDDEN_TEXT",menuItems:[H]},collab:{tabListId:"hr-department-detail-content_chats-tab__collab-list",footerDataTestId:"hr-department-content_chats-tab__list_collab-hidden-text",listTitle:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_COLLAB_LIST_TITLE",emptyItemTitle:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_COLLAB_LIST_ITEM_TEXT",noTeamText:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_COLLAB_LIST_ITEM_NO_TEAM_TEXT",noDepartmentText:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_COLLAB_LIST_ITEM_NO_DEPARTMENT_TEXT",moreHiddenText:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_COLLAB_LIST_ITEM_MORE_HIDDEN_TEXT",emptyHiddenText:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_COLLAB_LIST_ITEM_EMPTY_HIDDEN_TEXT",menuItems:[B]}});const j={name:"communicationList",components:{TabList:I,CommunicationListItem:G},props:{communications:{type:Array,required:true},communicationsNoAccess:{type:Number,required:true},filteredCommunications:{type:Array,required:true},isTeamEntity:{type:Boolean,required:true},canEdit:{type:Boolean,required:true},searchQuery:{type:String,required:true},focusedNode:{type:[String,Number],required:true},communicationType:{type:String,required:true,validator:t=>Object.values(u.CommunicationsTypeDict).includes(t)},dataTestId:{type:Object,required:true}},data(){return{dictionary:{}}},computed:{communicationMenuItems(){return this.canEdit?this.dictionary.menuItems:[]},communicationsNoAccessText(){const t=this.communications.length>0?this.dictionary.moreHiddenText:this.dictionary.emptyHiddenText;return this.locPlural(t,this.communicationsNoAccess)},emptyCommunicationTitle(){if(this.canEdit){return this.loc(this.dictionary.emptyItemTitle)}return this.isTeamEntity?this.loc(this.dictionary.noTeamText):this.loc(this.dictionary.noDepartmentText)},hideEmptyCommunicationItem(){return this.searchQuery.length>0||this.communicationsNoAccess>0}},created(){this.dictionary=Q[this.communicationType]||{}},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},locPlural(t,e){return m.Loc.getMessagePlural(t,e,{"#COUNT#":e})},onActionMenuItemClick(...t){this.$emit("tabListAction",...t)}},template:`\n\t\t<TabList\n\t\t\t:id='dictionary.tabListId'\n\t\t\t:title="loc(dictionary.listTitle)"\n\t\t\t:count="communications.length + communicationsNoAccess"\n\t\t\t:menuItems="communicationMenuItems"\n\t\t\t:listItems="filteredCommunications"\n\t\t\t:emptyItemTitle="emptyCommunicationTitle"\n\t\t\temptyItemImageClass="hr-department-detail-content__chat-empty-tab-list-item_tab-icon"\n\t\t\t:hideEmptyItem="hideEmptyCommunicationItem"\n\t\t\t:withAddPermission="canEdit"\n\t\t\t@tabListAction="onActionMenuItemClick"\n\t\t\t:dataTestIds="dataTestId"\n\t\t>\n\t\t\t<template v-slot="{ item }">\n\t\t\t\t<CommunicationListItem :communication="item" :nodeId="focusedNode"/>\n\t\t\t</template>\n\t\t\t<template v-if="communicationsNoAccess > 0" v-slot:footer>\n\t\t\t\t<div\n\t\t\t\t\tclass="hr-department-detail-content__tab-list_communications-hidden"\n\t\t\t\t\t:data-test-id="dictionary.footerDataTestId"\n\t\t\t\t>\n\t\t\t\t\t{{ communicationsNoAccessText }}\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</TabList>\n\t`};const z=Object.freeze({withChildren:"withChildren",withoutChildren:"withoutChildren"});const K={name:"childrenModeSelector",components:{RouteActionMenu:u.RouteActionMenu},props:{isTeamEntity:{type:Boolean,required:true},dataTestId:{type:String,required:true},hasPermission:{type:Boolean,required:true},text:{type:String,required:true}},emits:["saveChildrenMode"],data(){return{menuVisible:false,withChildren:false}},computed:{getControlButtonText(){return this.getValueText(this.withChildren)}},created(){this.menuItems=this.getMenuItems()},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},showMenu(){if(this.hasPermission){this.menuVisible=true}},onActionMenuItemClick(t){if(this.hasPermission){this.withChildren=t===z.withChildren;this.$emit("saveChildrenMode",this.withChildren)}},getMenuItems(){return[{id:z.withoutChildren,title:this.getValueText(false),itemClass:"hr-department-detail-content__children-mode-selector_menu-item",dataTestId:"hr-chat-children-mode-selector_menu-item-without"},{id:z.withChildren,title:this.getValueText(true),itemClass:"hr-department-detail-content__children-mode-selector_menu-item",dataTestId:"hr-chat-children-mode-selector_menu-item-with"}]},getValueText(t){if(this.isTeamEntity){return t?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_WITH_SUBTEAMS_LABEL"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_ONLY_TEAM_LABEL")}return t?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_WITH_SUBDEPARTMENTS_LABEL"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_ONLY_DEPARTMENT_LABEL")}},template:`\n\t\t<div class="hr-department-detail-content__change-save-mode-control-container">\n\t\t\t<span>{{ text }}</span>\n\t\t\t<a\n\t\t\t\tclass="hr-department-detail-content__change-save-mode-control-button"\n\t\t\t\t:class="{ '--focused': menuVisible, '--disabled': !hasPermission }"\n\t\t\t\t:dataTestId="dataTestId"\n\t\t\t\tref='saveChildrenModeButton'\n\t\t\t\t@click="showMenu"\n\t\t\t>\n\t\t\t\t{{ getControlButtonText }}\n\t\t\t</a>\n\t\t</div>\n\t\t<RouteActionMenu\n\t\t\tv-if="menuVisible"\n\t\t\t:id="'hr-department-detail-children-mode-selector-menu'"\n\t\t\t:items="menuItems"\n\t\t\t:delimiter="false"\n\t\t\t:width="302"\n\t\t\t:bindElement="$refs.saveChildrenModeButton"\n\t\t\t@action="onActionMenuItemClick"\n\t\t\t@close="menuVisible = false"\n\t\t/>\n\t`};const J=Object.freeze({chat:{dialogId:"hr-department-detail-content-chats-tab-chat-link-dialog",title:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_LINK_DIALOG_TITLE",description:{team:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_LINK_DIALOG_TEAM_DESC",default:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_LINK_DIALOG_DESC"},childrenModeText:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_MODE_CHATS_TEXT",dataTestIds:x,getDialogEntity:()=>u.getChatDialogEntity(),getDialogIdFromId:t=>`chat${t.id}`,getIdFromDialogId:t=>{var e;return Number((e=t.id)==null?void 0:e.replace("chat",""))}},channel:{dialogId:"hr-department-detail-content-chats-tab-channel-link-dialog",title:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_LINK_DIALOG_TITLE",description:{team:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_LINK_DIALOG_TEAM_DESC",default:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_LINK_DIALOG_DESC"},childrenModeText:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_MODE_CHANNELS_TEXT",dataTestIds:F,getDialogEntity:()=>u.getChannelDialogEntity(),getDialogIdFromId:t=>`chat${t.id}`,getIdFromDialogId:t=>{var e;return Number((e=t.id)==null?void 0:e.replace("chat",""))}},collab:{dialogId:"hr-department-detail-content-chats-tab-channel-link-dialog",title:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_COLLAB_LINK_DIALOG_TITLE",description:{team:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_COLLAB_LINK_DIALOG_TEAM_DESC",default:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_COLLAB_LINK_DIALOG_DESC"},childrenModeText:"HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_MODE_COLLABS_TEXT",dataTestIds:V,getDialogEntity:()=>u.getCollabDialogEntity(),getDialogIdFromId:t=>Number(t.id),getIdFromDialogId:t=>Number(t.id)}});const Z={name:"LinkDialog",components:{ManagementDialog:u.ManagementDialog,ChildrenModeSelector:K},props:{communications:{type:Array,required:true},communicationType:{type:String,required:true,validator:t=>Object.values(u.CommunicationsTypeDict).includes(t)},focusedNode:{type:[String,Number],required:true},isTeamEntity:{type:Boolean,required:true},entityType:{type:String,required:true},isVisible:{type:Boolean,required:true},canAddWithChildren:{type:Boolean,required:true}},emits:["close","reloadList"],data(){return{isLinkActive:false,addWithChildren:false,dictionary:{}}},computed:{dialogEntities(){const t=this.dictionary.getDialogEntity();t.options.excludeIds=this.communications.map((t=>t.id));return[t]},dialogRecentTabOptions(){return u.getCommunicationsRecentTabOptions(this.entityType,this.communicationType)},linkedIds(){return this.communications.map((t=>this.dictionary.getDialogIdFromId(t)))},addDescription(){return this.isTeamEntity?this.loc(this.dictionary.description.team):this.loc(this.dictionary.description.default)}},created(){this.dictionary=J[this.communicationType]||{}},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},async linkEntities(t){this.isLinkActive=true;const e=t.map((t=>this.dictionary.getIdFromDialogId(t)));try{const t=this.focusedNode;const n=Number(this.addWithChildren);switch(this.communicationType){case u.CommunicationsTypeDict.chat:await S.saveChats(t,e,[],n);break;case u.CommunicationsTypeDict.channel:await S.saveChannel(t,e,[],n);break;case u.CommunicationsTypeDict.collab:await S.saveCollab(t,e,[],n);break;default:break}this.$emit("reloadList");if(this.addWithChildren){const e=C.useChartStore();e.updateChatsInChildrenNodes(t)}}catch{}this.addWithChildren=false;this.isLinkActive=false;this.$emit("close")}},template:`\n\t\t<ManagementDialog\n\t\t\tv-if="isVisible"\n\t\t\t:id="dictionary.dialogId"\n\t\t\t:entities="dialogEntities"\n\t\t\t:recentTabOptions="dialogRecentTabOptions"\n\t\t\t:hiddenItemsIds="linkedIds"\n\t\t\t:title="loc(dictionary.title)"\n\t\t\t:description="addDescription"\n\t\t\t:isActive="isLinkActive"\n\t\t\t@managementDialogAction="linkEntities"\n\t\t\t@close="$emit('close')"\n\t\t\t:dataTestIds="dictionary.dataTestIds"\n\t\t>\n\t\t\t<template v-slot:extra-subtitle>\n\t\t\t\t<ChildrenModeSelector\n\t\t\t\t\t:isTeamEntity="isTeamEntity"\n\t\t\t\t\t:dataTestId="dictionary.dataTestIds.addWithChildrenDataTestId"\n\t\t\t\t\t:hasPermission="canAddWithChildren"\n\t\t\t\t\t:text="loc(dictionary.childrenModeText)"\n\t\t\t\t\t@saveChildrenMode="addWithChildren = $event"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t</ManagementDialog>\n\t`};const tt={name:"chatsTab",components:{SearchInput:y,EmptyState:O,EmptyTabAddButtons:$,CommunicationList:j,LinkDialog:Z},data(){return{chatLinkDialogVisible:false,channelLinkDialogVisible:false,collabLinkDialogVisible:false,isLoading:false,searchQuery:"",permissionChecker:null}},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},locPlural(t,e){return m.Loc.getMessagePlural(t,e,{"#COUNT#":e})},searchChatOrChannel(t){this.searchQuery=t},async loadChatAction(t){var e,n,i,s,a,o;if(this.isLoading){return null}const r=this.focusedNode;const d=this.departments.get(r);if(!d){return null}if(!t&&m.Type.isArray(d.chatsDetailed)&&m.Type.isArray(d.channelsDetailed)&&m.Type.isArray(d.collabsDetailed)){return{chats:d.chatsDetailed,channels:d.channelsDetailed,collabs:d.collabsDetailed,chatsNoAccess:d.chatsNoAccess,channelsNoAccess:d.channelsNoAccess,collabsNoAccess:d.collabsNoAccess}}this.isLoading=true;this.$emit("showDetailLoader");const l=await S.getChatsAndChannels(r);f.setChatsAndChannels(r,(e=l.chats)!=null?e:[],(n=l.channels)!=null?n:[],(i=l.collabs)!=null?i:[],(s=l.chatsNoAccess)!=null?s:0,(a=l.channelsNoAccess)!=null?a:0,(o=l.collabsNoAccess)!=null?o:0);this.$emit("hideDetailLoader");this.isLoading=false;return l},onActionMenuItemClick(t){switch(t){case L.linkChat:this.chatLinkDialogVisible=true;break;case L.linkChannel:this.channelLinkDialogVisible=true;break;case L.linkCollab:this.collabLinkDialogVisible=true;break;default:break}},getAddEmptyStateList(){let t=[];if(this.isCollabsAvailable&&this.isTeamEntity){t=[this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_TEAM_LIST_W_COLLABS_ITEM_1"),this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_LIST_W_COLLABS_ITEM_2"),this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_TEAM_LIST_W_COLLABS_ITEM_3")]}else if(this.isCollabsAvailable){t=[this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_LIST_W_COLLABS_ITEM_1"),this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_LIST_W_COLLABS_ITEM_2"),this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_LIST_W_COLLABS_ITEM_3")]}else if(this.isTeamEntity){t=[this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_TEAM_LIST_ITEM_1_MSGVER_1"),this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_LIST_ITEM_2"),this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_TEAM_LIST_ITEM_3")]}else{t=[this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_LIST_ITEM_1_MSGVER_1"),this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_LIST_ITEM_2"),this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_LIST_ITEM_3")]}return t.map((t=>({text:t})))}},computed:{isCollabsAvailable(){return o.PermissionChecker.getInstance().isCollabsAvailable},communicationTypes(){return u.CommunicationsTypeDict},chats(){var t,e;return(t=(e=this.departments.get(this.focusedNode))==null?void 0:e.chatsDetailed)!=null?t:[]},channels(){var t,e;return(t=(e=this.departments.get(this.focusedNode))==null?void 0:e.channelsDetailed)!=null?t:[]},collabs(){var t,e;return(t=(e=this.departments.get(this.focusedNode))==null?void 0:e.collabsDetailed)!=null?t:[]},chatsNoAccess(){var t,e;return(t=(e=this.departments.get(this.focusedNode))==null?void 0:e.chatsNoAccess)!=null?t:0},channelsNoAccess(){var t,e;return(t=(e=this.departments.get(this.focusedNode))==null?void 0:e.channelsNoAccess)!=null?t:0},collabsNoAccess(){var t,e;return(t=(e=this.departments.get(this.focusedNode))==null?void 0:e.collabsNoAccess)!=null?t:0},filteredChats(){return this.chats.filter((t=>t.title.toLowerCase().includes(this.searchQuery.toLowerCase())))},filteredChannels(){return this.channels.filter((t=>t.title.toLowerCase().includes(this.searchQuery.toLowerCase())))},filteredCollabs(){return this.collabs.filter((t=>t.title.toLowerCase().includes(this.searchQuery.toLowerCase())))},showAddEmptyState(){return this.chats.length===0&&this.channels.length===0&&this.collabs.length===0&&this.chatsNoAccess===0&&this.channelsNoAccess===0&&this.collabsNoAccess===0},showSearchEmptyState(){return(this.chats.length>0||this.channels.length>0||this.collabs.length>0)&&this.filteredChats.length===0&&this.filteredChannels.length===0&&this.filteredCollabs.length===0},areChatsLoaded(){const t=this.departments.get(this.focusedNode);return Boolean(m.Type.isArray(t.chatsDetailed)&&m.Type.isArray(t.channelsDetailed)&&m.Type.isArray(t.collabsDetailed))},entityType(){var t;return(t=this.departments.get(this.focusedNode))==null?void 0:t.entityType},isTeamEntity(){return this.entityType===E.EntityTypes.team},getAddEmptyStateTitle(){if(this.isCollabsAvailable){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_TEAM_TITLE_W_COLLABS"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_TITLE_W_COLLABS")}return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_TEAM_TITLE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_TITLE")},canEditChat(){return this.isTeamEntity?this.permissionChecker.hasPermission(o.PermissionActions.teamChatEdit,this.focusedNode):this.permissionChecker.hasPermission(o.PermissionActions.departmentChatEdit,this.focusedNode)},canEditChannel(){return this.isTeamEntity?this.permissionChecker.hasPermission(o.PermissionActions.teamChannelEdit,this.focusedNode):this.permissionChecker.hasPermission(o.PermissionActions.departmentChannelEdit,this.focusedNode)},canEditCollab(){return this.isTeamEntity?this.permissionChecker.hasPermission(o.PermissionActions.teamCollabEdit,this.focusedNode):this.permissionChecker.hasPermission(o.PermissionActions.departmentCollabEdit,this.focusedNode)},canAddChatWithChildren(){if(this.isTeamEntity){return this.permissionChecker.hasPermission(o.PermissionActions.teamChatEdit,this.focusedNode,{TEAM:o.PermissionLevels.selfAndSub})||this.permissionChecker.hasPermission(o.PermissionActions.teamChatEdit,this.focusedNode,{DEPARTMENT:o.PermissionLevels.selfAndSub})}return this.permissionChecker.hasPermission(o.PermissionActions.departmentChatEdit,this.focusedNode,o.PermissionLevels.selfAndSub)},canAddChannelWithChildren(){if(this.isTeamEntity){return this.permissionChecker.hasPermission(o.PermissionActions.teamChannelEdit,this.focusedNode,{TEAM:o.PermissionLevels.selfAndSub})||this.permissionChecker.hasPermission(o.PermissionActions.teamChannelEdit,this.focusedNode,{DEPARTMENT:o.PermissionLevels.selfAndSub})}return this.permissionChecker.hasPermission(o.PermissionActions.departmentChannelEdit,this.focusedNode,o.PermissionLevels.selfAndSub)},canAddCollabWithChildren(){if(this.isTeamEntity){return this.permissionChecker.hasPermission(o.PermissionActions.teamCollabEdit,this.focusedNode,{TEAM:o.PermissionLevels.selfAndSub})||this.permissionChecker.hasPermission(o.PermissionActions.teamCollabEdit,this.focusedNode,{DEPARTMENT:o.PermissionLevels.selfAndSub})}return this.permissionChecker.hasPermission(o.PermissionActions.departmentCollabEdit,this.focusedNode,o.PermissionLevels.selfAndSub)},hideEmptyChatItem(){return this.searchQuery.length>0||this.chatsNoAccess>0},hideEmptyChannelItem(){return this.searchQuery.length>0||this.channelsNoAccess>0},getChatListDataTestIds(){return Y},getChannelListDataTestIds(){return k},getCollabListDataTestIds(){return w},...A.mapState(C.useChartStore,["focusedNode","departments"])},watch:{areChatsLoaded(t){if(t===false){this.loadChatAction()}}},created(){this.permissionChecker=o.PermissionChecker.getInstance();this.loadChatAction()},template:`\n\t\t<div class="hr-department-detail-content__tab-container --chat">\n\t\t\t<template v-if="!showAddEmptyState">\n\t\t\t\t<SearchInput\n\t\t\t\t\t:placeholder="loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_SEARCH_INPUT_PLACEHOLDER')"\n\t\t\t\t\t:value="searchQuery"\n\t\t\t\t\t@inputChange="searchChatOrChannel"\n\t\t\t\t\tdataTestId="hr-department-detail-content_chats-tab__chats-and-channels-search-input"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tv-if="!showSearchEmptyState"\n\t\t\t\t\tclass="hr-department-detail-content__lists-container"\n\t\t\t\t>\n\t\t\t\t\t<CommunicationList\n\t\t\t\t\t\tv-if="isCollabsAvailable"\n\t\t\t\t\t\t:communications="collabs"\n\t\t\t\t\t\t:filteredCommunications="filteredCollabs"\n\t\t\t\t\t\t:communicationsNoAccess="collabsNoAccess"\n\t\t\t\t\t\t:canEdit="canEditCollab"\n\t\t\t\t\t\t:searchQuery="searchQuery"\n\t\t\t\t\t\t:focusedNode="focusedNode"\n\t\t\t\t\t\t:communicationType="communicationTypes.collab"\n\t\t\t\t\t\t:isTeamEntity="isTeamEntity"\n\t\t\t\t\t\t:dataTestId="getCollabListDataTestIds"\n\t\t\t\t\t\t@tabListAction="onActionMenuItemClick"\n\t\t\t\t\t/>\n\t\t\t\t\t<CommunicationList\n\t\t\t\t\t\t:communications="channels"\n\t\t\t\t\t\t:filteredCommunications="filteredChannels"\n\t\t\t\t\t\t:communicationsNoAccess="channelsNoAccess"\n\t\t\t\t\t\t:canEdit="canEditChannel"\n\t\t\t\t\t\t:searchQuery="searchQuery"\n\t\t\t\t\t\t:focusedNode="focusedNode"\n\t\t\t\t\t\t:communicationType="communicationTypes.channel"\n\t\t\t\t\t\t:isTeamEntity="isTeamEntity"\n\t\t\t\t\t\t:dataTestId="getChannelListDataTestIds"\n\t\t\t\t\t\t@tabListAction="onActionMenuItemClick"\n\t\t\t\t\t/>\n\t\t\t\t\t<CommunicationList\n\t\t\t\t\t\t:communications="chats"\n\t\t\t\t\t\t:filteredCommunications="filteredChats"\n\t\t\t\t\t\t:communicationsNoAccess="chatsNoAccess"\n\t\t\t\t\t\t:canEdit="canEditChat"\n\t\t\t\t\t\t:searchQuery="searchQuery"\n\t\t\t\t\t\t:focusedNode="focusedNode"\n\t\t\t\t\t\t:communicationType="communicationTypes.chat"\n\t\t\t\t\t\t:isTeamEntity="isTeamEntity"\n\t\t\t\t\t\t:dataTestId="getChatListDataTestIds"\n\t\t\t\t\t\t@tabListAction="onActionMenuItemClick"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<EmptyState \n\t\t\t\t\tv-else\n\t\t\t\t\timageClass="hr-department-detail-content__chat-empty-tab-search_tab-icon"\n\t\t\t\t\t:title="loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_SEARCHED_EMPLOYEES_TITLE')"\n\t\t\t\t\t:description ="loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_SEARCHED_EMPLOYEES_SUBTITLE')"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<EmptyState \n\t\t\t\tv-else\n\t\t\t\timageClass="hr-department-detail-content__chat-empty-tab-add_tab-icon"\n\t\t\t\t:title="getAddEmptyStateTitle"\n\t\t\t\t:list="getAddEmptyStateList()"\n\t\t\t>\n\t\t\t\t<template v-slot:content>\n\t\t\t\t\t<EmptyTabAddButtons\n\t\t\t\t\t\t:isTeamEntity="isTeamEntity"\n\t\t\t\t\t\t:canEditChat="canEditChat"\n\t\t\t\t\t\t:canEditChannel="canEditChannel"\n\t\t\t\t\t\t:canEditCollab="canEditCollab"\n\t\t\t\t\t\t@emptyStateAddAction="onActionMenuItemClick"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t</EmptyState>\n\t\t\t<LinkDialog\n\t\t\t\tv-if="isCollabsAvailable"\n\t\t\t\t:communications="collabs"\n\t\t\t\t:communicationType="communicationTypes.collab"\n\t\t\t\t:focusedNode="focusedNode"\n\t\t\t\t:isTeamEntity="isTeamEntity"\n\t\t\t\t:entityType="entityType"\n\t\t\t\t:isVisible="collabLinkDialogVisible"\n\t\t\t\t:canAddWithChildren="canAddCollabWithChildren"\n\t\t\t\t@close="collabLinkDialogVisible = false"\n\t\t\t\t@reloadList="loadChatAction(true)"\n\t\t\t/>\n\t\t\t<LinkDialog\n\t\t\t\t:communications="channels"\n\t\t\t\t:communicationType="communicationTypes.channel"\n\t\t\t\t:focusedNode="focusedNode"\n\t\t\t\t:isTeamEntity="isTeamEntity"\n\t\t\t\t:entityType="entityType"\n\t\t\t\t:isVisible="channelLinkDialogVisible"\n\t\t\t\t:canAddWithChildren="canAddChannelWithChildren"\n\t\t\t\t@close="channelLinkDialogVisible = false"\n\t\t\t\t@reloadList="loadChatAction(true)"\n\t\t\t/>\n\t\t\t<LinkDialog\n\t\t\t\t:communications="chats"\n\t\t\t\t:communicationType="communicationTypes.chat"\n\t\t\t\t:focusedNode="focusedNode"\n\t\t\t\t:isTeamEntity="isTeamEntity"\n\t\t\t\t:entityType="entityType"\n\t\t\t\t:isVisible="chatLinkDialogVisible"\n\t\t\t\t:canAddWithChildren="canAddChatWithChildren"\n\t\t\t\t@close="chatLinkDialogVisible = false"\n\t\t\t\t@reloadList="loadChatAction(true)"\n\t\t\t/>\n\t\t</div>\n\t`};const et={name:"departmentContent",components:{UsersTab:g,ChatsTab:tt},props:{isCollapsed:Boolean},emits:["showDetailLoader","hideDetailLoader","editEmployee"],data(){return{activeTab:"usersTab",tabs:[{name:"usersTab",component:"UsersTab",id:"users-tab"},{name:"chatsTab",component:"ChatsTab",id:"chats-tab"}],isDescriptionOverflowed:false,isDescriptionExpanded:false}},computed:{isCollabsAvailable(){return o.PermissionChecker.getInstance().isCollabsAvailable},activeTabComponent(){const t=this.tabs.find((t=>t.name===this.activeTab));return t?t.component:null},usersCount(){var t,e;return(t=(e=this.departments.get(this.focusedNode))==null?void 0:e.userCount)!=null?t:0},communicationsCount(){var t,e;return(t=(e=this.departments.get(this.focusedNode))==null?void 0:e.communicationsCount)!=null?t:null},tabArray(){return this.tabs.map((t=>{if(t.name==="usersTab"){return{...t,count:this.usersCount}}if(t.name==="chatsTab"){return{...t,count:this.communicationsCount}}return t}))},description(){const t=this.departments.get(this.focusedNode);if(!t.description){return null}return t.description},isTeamEntity(){var t;return((t=this.departments.get(this.focusedNode))==null?void 0:t.entityType)===E.EntityTypes.team},...A.mapState(C.useChartStore,["focusedNode","departments"])},watch:{description(){this.$nextTick((()=>{this.isDescriptionOverflowed=this.checkDescriptionOverflowed()}))},focusedNode(){this.isDescriptionExpanded=false;this.selectTab("usersTab")},isCollapsed(){this.$nextTick((()=>{this.isDescriptionOverflowed=this.checkDescriptionOverflowed()}))}},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},selectTab(t){if(this.isTabDisabled(t)){return}this.activeTab=t},getTabLabel(t){if(t==="usersTab"){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_TEAM_USERS_TITLE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_TITLE")}if(t==="chatsTab"){return this.isCollabsAvailable?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_TITLE_W_COLLABS"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_TITLE")}return""},toggleDescriptionExpand(){this.isDescriptionExpanded=!this.isDescriptionExpanded},checkDescriptionOverflowed(){var t;const e=(t=this.$refs.descriptionContainer)!=null?t:null;if(e){return e.scrollHeight>e.clientHeight}return false},hideDetailLoader(){this.$emit("hideDetailLoader");this.$nextTick((()=>{this.isDescriptionOverflowed=this.checkDescriptionOverflowed()}))},isTabDisabled(t){if(t==="chatsTab"&&this.tabArray.find((e=>e.name===t)).count===0){const t=o.PermissionChecker.getInstance();const e=this.isTeamEntity?t.hasPermission(o.PermissionActions.teamChatEdit,this.focusedNode)||t.hasPermission(o.PermissionActions.teamChannelEdit,this.focusedNode)||t.hasPermission(o.PermissionActions.teamCollabEdit,this.focusedNode):t.hasPermission(o.PermissionActions.departmentChatEdit,this.focusedNode)||t.hasPermission(o.PermissionActions.departmentChannelEdit,this.focusedNode)||t.hasPermission(o.PermissionActions.departmentCollabEdit,this.focusedNode);if(!e){return true}}return false}},template:`\n\t\t<div class="hr-department-detail-content hr-department-detail-content__scope">\n\t\t\t<div\n\t\t\t\tref="descriptionContainer"\n\t\t\t\tv-show="description"\n\t\t\t\t:class="[\n\t\t\t\t\t'hr-department-detail-content-description',\n\t\t\t\t\t{ '--expanded': isDescriptionExpanded },\n\t\t\t\t\t{ '--overflowed': isDescriptionOverflowed},\n\t\t\t\t]"\n\t\t\t\tv-on="isDescriptionOverflowed ? { click: toggleDescriptionExpand } : {}"\n\t\t\t>\n\t\t\t\t{{ description }}\n\t\t\t</div>\n\t\t\t<div class="hr-department-detail-content__tab-list">\n\t\t\t\t<button\n\t\t\t\t\tv-for="tab in tabArray"\n\t\t\t\t\t:key="tab.name"\n\t\t\t\t\tclass="hr-department-detail-content__tab-item"\n\t\t\t\t\t:class="[{'--active-tab' : activeTab === tab.name, '--disabled-tab': isTabDisabled(tab.name)}]"\n\t\t\t\t\t@click="selectTab(tab.name)"\n\t\t\t\t\t:data-id="tab.id ? 'hr-department-detail-content__' + tab.id + '_button' : null"\n\t\t\t\t>\n\t\t\t\t\t{{ this.getTabLabel(tab.name) }}\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass="hr-department-detail-content__tab-count"\n\t\t\t\t\t\t:data-id="tab.id ? 'hr-department-detail-content__' + tab.id + '_counter' : null"\n\t\t\t\t\t>{{ tab.count }}\n\t\t\t\t\t</span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t<UsersTab\n\t\t\t\tv-show="activeTab === 'usersTab'"\n\t\t\t\t@showDetailLoader="$emit('showDetailLoader')"\n\t\t\t\t@hideDetailLoader="hideDetailLoader"\n\t\t\t/>\n\t\t\t<ChatsTab\n\t\t\t\tv-show="activeTab === 'chatsTab'"\n\t\t\t\t:is="activeTabComponent"\n\t\t\t\t@showDetailLoader="$emit('showDetailLoader')"\n\t\t\t\t@hideDetailLoader="hideDetailLoader"\n\t\t\t/>\n\t\t</div>\n\t`};t.DepartmentContent=et;t.DepartmentContentActions=f})(this.BX.Humanresources.CompanyStructure=this.BX.Humanresources.CompanyStructure||{},BX.Humanresources.CompanyStructure,BX,BX.Humanresources.CompanyStructure,BX.UI,BX.UI,BX.Humanresources.CompanyStructure,BX.UI.IconSet,BX,BX.Event,BX.Humanresources.CompanyStructure,BX,BX.Messenger.v2.Lib,BX.Humanresources.CompanyStructure,BX.UI,BX,BX.Humanresources.CompanyStructure,BX.Humanresources.CompanyStructure,BX.Vue3.Pinia);
//# sourceMappingURL=department-content.bundle.map.js