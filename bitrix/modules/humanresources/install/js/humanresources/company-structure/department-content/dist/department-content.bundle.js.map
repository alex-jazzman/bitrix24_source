{"version":3,"file":"department-content.bundle.js","sources":["../src/components/users/consts.js","../src/components/users/empty-tab-add-button.js","../src/api.js","../src/actions.js","../src/components/users/item/move-user-action-popup.js","../src/components/users/item/action-button.js","../src/components/users/item/item.js","../src/components/base-components/empty-state/empty-state.js","../src/components/base-components/list/empty-list-item.js","../src/components/base-components/list/list-action-button.js","../src/components/base-components/list/list.js","../src/components/base-components/search/search-input.js","../src/components/users/tab.js","../src/components/chats/children-mode-selector.js","../src/components/chats/consts.js","../src/components/chats/empty-tab-add-buttons.js","../src/components/chats/action-button.js","../src/components/chats/list-item.js","../src/components/chats/tab.js","../src/components/department-content.js"],"sourcesContent":["export const HeadListDataTestIds = Object.freeze({\n\tcontainerDataTestId: 'hr-department-content_users-tab__head-list-container',\n\tlistActionButtonDataTestId: 'hr-department-content_users-tab__head-list-action-button',\n\tlistActonMenuDataTestId: 'hr-department-content_users-tab__head-list-action-menu-container',\n\tlistCounterDataTestId: 'hr-department-content_users-tab__head-list-counter',\n});\n\nexport const EmployeeListDataTestIds = Object.freeze({\n\tcontainerDataTestId: 'hr-department-content_users-tab__employee-list-container',\n\tlistActionButtonDataTestId: 'hr-department-content_users-tab__employee-list-action-button',\n\tlistActonMenuDataTestId: 'hr-department-content_users-tab__employee-list-action-menu-container',\n\tlistCounterDataTestId: 'hr-department-content_users-tab__employee-list-counter',\n});\n","import { AnalyticsSourceType } from 'humanresources.company-structure.api';\nimport { EmptyUsersTabActionMenu } from 'humanresources.company-structure.org-chart';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\nimport { mapState } from 'ui.vue3.pinia';\nimport { RouteActionMenu } from 'humanresources.company-structure.structure-components';\n\nimport 'ui.icon-set.crm';\nimport 'ui.icon-set.main';\nimport './styles/empty-tab-add-buttons.css';\n\nexport const EmptyTabAddButton = {\n\tname: 'emptyStateContainer',\n\n\tcomponents: { RouteActionMenu },\n\n\tprops: {\n\t\tdepartmentId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tentityType: {\n\t\t\ttype: String,\n\t\t\tdefault: EntityTypes.department,\n\t\t},\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tmenuVisible: false,\n\t\t};\n\t},\n\n\tcomputed: {\n\t\tmenu(): EmptyUsersTabActionMenu\n\t\t{\n\t\t\treturn new EmptyUsersTabActionMenu(this.departmentId, AnalyticsSourceType.DETAIL, null, this.entityType);\n\t\t},\n\t\t...mapState(useChartStore, ['focusedNode']),\n\t},\n\n\tmethods:\n\t{\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tonClick(): void\n\t\t{\n\t\t\tif ((this.entityType === EntityTypes.team) && (this.menu.items.length === 1))\n\t\t\t{\n\t\t\t\t// for teams for now there can be only one item, so we invoke action right away\n\t\t\t\tthis.onActionMenuItemClick(this.menu.items[0].id);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.menuVisible = true;\n\t\t\t}\n\t\t},\n\t\tonActionMenuItemClick(actionId: string): void\n\t\t{\n\t\t\tthis.menu.onActionMenuItemClick(actionId);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"hr-department-detail-content__users-empty-tab-add_buttons-container\">\n\t\t\t<button\n\t\t\t\tclass=\"hr-add-employee-empty-tab-entity-btn ui-btn ui-btn ui-btn-sm ui-btn-primary ui-btn-round\"\n\t\t\t\tref=\"actionMenuButton\"\n\t\t\t\t@click.stop=\"onClick\"\n\t\t\t\tdata-id=\"hr-department-detail-content__user-empty-tab_add-user-button\"\n\t\t\t>\n\t\t\t\t<span class=\"hr-add-employee-empty-tab-entity-btn-text\">{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_EMPLOYEES_ADD_USER_ADD_BUTTON')}}</span>\n\t\t\t</button>\n\t\t\t<RouteActionMenu\n\t\t\t\tv-if=\"menuVisible\"\n\t\t\t\t:id=\"'empty-state-department-detail-add-menu-' + focusedNode\"\n\t\t\t\t:items=\"menu.items\"\n\t\t\t\t:width=\"302\"\n\t\t\t\t:bindElement=\"$refs['actionMenuButton']\"\n\t\t\t\t@action=\"onActionMenuItemClick\"\n\t\t\t\t@close=\"menuVisible = false\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { getData, postData } from 'humanresources.company-structure.api';\nimport type { ChatListResponse } from 'humanresources.company-structure.utils';\n\nexport const DepartmentAPI = {\n\tgetPagedEmployees: (id: Number, page: Number, countPerPage: Number) => {\n\t\treturn getData('humanresources.api.Structure.Node.Member.Employee.list', { nodeId: id, page, countPerPage });\n\t},\n\tremoveUserFromDepartment: (nodeId: number, userId: number): Promise<void> => {\n\t\treturn postData('humanresources.api.Structure.Node.Member.deleteUser', {\n\t\t\tnodeId,\n\t\t\tuserId,\n\t\t});\n\t},\n\tmoveUserToDepartment: (nodeId: number, userId: number, targetNodeId: number, role: string): Promise<void> => {\n\t\treturn postData('humanresources.api.Structure.Node.Member.moveUser', {\n\t\t\tnodeId,\n\t\t\tuserId,\n\t\t\ttargetNodeId,\n\t\t\troleXmlId: role,\n\t\t});\n\t},\n\tisUserInMultipleDepartments: (userId: number): Promise<void> => {\n\t\treturn getData('humanresources.api.User.isUserInMultipleDepartments', {\n\t\t\tuserId,\n\t\t});\n\t},\n\tgetUserInfo: (nodeId: number, userId: number): Promise<void> => {\n\t\treturn getData('humanresources.api.User.getInfoByUserMember', {\n\t\t\tnodeId,\n\t\t\tuserId,\n\t\t});\n\t},\n\tfireUser: (userId: number): Promise<void> => {\n\t\treturn postData('intranet.user.fire', {\n\t\t\tuserId,\n\t\t});\n\t},\n\tfindMemberByQuery: (nodeId: number, query: string): Promise<void> => {\n\t\treturn getData('humanresources.api.Structure.Node.Member.find', {\n\t\t\tnodeId,\n\t\t\tquery,\n\t\t});\n\t},\n\tgetChatsAndChannels: (nodeId: number): Promise<ChatListResponse> => {\n\t\treturn getData('humanresources.api.Structure.Node.Member.Chat.getList', {\n\t\t\tnodeId,\n\t\t});\n\t},\n\tsaveChats: (\n\t\tnodeId: number,\n\t\tids: { chat: number[], channel: number[], collab: number[], withChildren: boolean } = {},\n\t\tremoveIds: { chat?: number[], channel?: number[], collab?: number[] } = {},\n\t\tparentId: ?number = null,\n\t): Promise<Array> => {\n\t\treturn postData('humanresources.api.Structure.Node.Member.Chat.saveChatList', {\n\t\t\tnodeId,\n\t\t\tids,\n\t\t\tremoveIds,\n\t\t\tparentId,\n\t\t});\n\t},\n};\n","import { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { getMemberRoles } from 'humanresources.company-structure.api';\nimport { Type } from 'main.core';\nimport type { ChatOrChannelDetailed } from 'humanresources.company-structure.utils';\nimport { DepartmentAPI } from './api';\n\nconst markDescendantsForChatReload = (childrenIds: Array<number>) => {\n\tconst store = useChartStore();\n\tconst queue = [...childrenIds];\n\tconst visited = new Set();\n\tconst maxIterations = 10000;\n\tlet iterations = 0;\n\n\twhile (queue.length > 0 && iterations < maxIterations)\n\t{\n\t\titerations++;\n\t\tconst childId = queue.shift();\n\n\t\tif (visited.has(childId))\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\t\tvisited.add(childId);\n\n\t\tconst childDepartment = store.departments.get(childId);\n\t\tif (!childDepartment)\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\n\t\tchildDepartment.chatsDetailed = null;\n\t\tchildDepartment.channelsDetailed = null;\n\n\t\tif (childDepartment.children && childDepartment.children.length > 0)\n\t\t{\n\t\t\tqueue.push(...childDepartment.children);\n\t\t}\n\t}\n};\n\nexport const DepartmentContentActions = {\n\tmoveUserToDepartment: (departmentId, userId, targetDepartmentId, role): void => {\n\t\tconst store = useChartStore();\n\t\tconst department = store.departments.get(departmentId);\n\t\tconst targetDepartment = store.departments.get(targetDepartmentId);\n\n\t\tif (!department || !targetDepartment)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst oldMemberRoles = getMemberRoles(department.entityType);\n\t\tconst targetMemberRoles = getMemberRoles(targetDepartment.entityType);\n\t\tconst user = role === oldMemberRoles.employee\n\t\t\t? department.employees?.find((employee) => employee.id === userId)\n\t\t\t: department.heads.find((head) => head.id === userId)\n\t\t;\n\t\tif (!user)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tdepartment.userCount -= 1;\n\t\tif (role === oldMemberRoles.employee)\n\t\t{\n\t\t\tdepartment.employees = department.employees.filter((employee) => employee.id !== userId);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdepartment.heads = department.heads.filter((head) => head.id !== userId);\n\t\t}\n\n\t\ttargetDepartment.userCount += 1;\n\t\tif (userId === store.userId)\n\t\t{\n\t\t\tstore.changeCurrentDepartment(departmentId, targetDepartmentId);\n\t\t}\n\n\t\tuser.role = targetMemberRoles.employee;\n\t\tif (!targetDepartment.employees)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\ttargetDepartment.employees.push(user);\n\t},\n\tremoveUserFromDepartment: (departmentId, userId, role): void => {\n\t\tconst store = useChartStore();\n\t\tconst department = store.departments.get(departmentId);\n\t\tconst oldMemberRoles = getMemberRoles(department.entityType);\n\t\tif (!department)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (userId === store.userId)\n\t\t{\n\t\t\tstore.changeCurrentDepartment(departmentId);\n\t\t}\n\n\t\tdepartment.userCount -= 1;\n\t\tif (role === oldMemberRoles.employee)\n\t\t{\n\t\t\tdepartment.employees = department.employees.filter((employee) => employee.id !== userId);\n\n\t\t\treturn;\n\t\t}\n\n\t\tdepartment.heads = department.heads.filter((head) => head.id !== userId);\n\t},\n\tupdateEmployees: (departmentId: number, employees: Array): void => {\n\t\tconst { departments } = useChartStore();\n\t\tconst department = departments.get(departmentId);\n\n\t\tif (!department)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tdepartments.set(departmentId, { ...department, employees });\n\t},\n\tupdateHeads: (departmentId: number, heads: Array): void => {\n\t\tconst { departments } = useChartStore();\n\t\tconst department = departments.get(departmentId);\n\n\t\tif (!department)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tdepartments.set(departmentId, { ...department, heads });\n\t},\n\tupdateEmployeeListOptions: (\n\t\tdepartmentId: number,\n\t\toptions: { page?: number, shouldUpdateList?: boolean, isListUpdated?: boolean },\n\t): void => {\n\t\tconst { departments } = useChartStore();\n\t\tconst department = departments.get(departmentId);\n\n\t\tif (!department)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tdepartment.employeeListOptions = {\n\t\t\t...department.employeeListOptions,\n\t\t\t...options,\n\t\t};\n\n\t\tdepartments.set(departmentId, department);\n\t},\n\tsetChatsAndChannels: (\n\t\tnodeId: number,\n\t\tchats: Array<ChatOrChannelDetailed>,\n\t\tchannels: Array<ChatOrChannelDetailed>,\n\t\tchatsNoAccess: number = 0,\n\t\tchannelsNoAccess: number = 0,\n\t): void => {\n\t\tconst store = useChartStore();\n\t\tconst department = store.departments.get(nodeId);\n\t\tif (!department)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tdepartment.channelsDetailed = channels;\n\t\tdepartment.chatsDetailed = chats;\n\t\tdepartment.channelsNoAccess = channelsNoAccess;\n\t\tdepartment.chatsNoAccess = chatsNoAccess;\n\t\tdepartment.chatAndChannelsCount = chats.length + channels.length + chatsNoAccess + channelsNoAccess;\n\t},\n\tremoveUserFromAllDepartments: async (userId): Promise<void> => {\n\t\tconst store = useChartStore();\n\t\tconst departments = store.departments;\n\t\tconst departmentsToUpdate = [];\n\n\t\tfor (const [key, department] of departments)\n\t\t{\n\t\t\tif (\n\t\t\t\t(\n\t\t\t\t\t'heads' in department\n\t\t\t\t\t&& Type.isArray(department.heads)\n\t\t\t\t\t&& department.heads.some((employee) => employee.id === userId)\n\t\t\t\t)\n\t\t\t\t|| (\n\t\t\t\t\t'employees' in department\n\t\t\t\t\t&& Type.isArray(department.employees)\n\t\t\t\t\t&& department.employees.some((employee) => employee.id === userId)\n\t\t\t\t)\n\t\t\t)\n\t\t\t{\n\t\t\t\tdepartmentsToUpdate.push(key);\n\t\t\t}\n\t\t}\n\n\t\treturn store.refreshDepartments(departmentsToUpdate);\n\t},\n\tunbindChatFromNode: (nodeId: number, chatId: number): void => {\n\t\tconst store = useChartStore();\n\t\tconst department = store.departments.get(nodeId);\n\t\tif (!department)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tdepartment.channelsDetailed = department.channelsDetailed.filter((chat) => chat.id !== chatId);\n\t\tdepartment.chatsDetailed = department.chatsDetailed.filter((chat) => chat.id !== chatId);\n\t\tdepartment.chatAndChannelsCount--;\n\t},\n\tupdateChatsInChildrenNodes: (parentNodeId: number): void => {\n\t\tconst store = useChartStore();\n\t\tconst parentDepartment = store.departments.get(parentNodeId);\n\n\t\tif (!parentDepartment || !parentDepartment.children)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tmarkDescendantsForChatReload(parentDepartment.children);\n\t},\n};\n","import { getMemberRoles, type MemberRolesType } from 'humanresources.company-structure.api';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { PermissionActions, PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport { ConfirmationPopup } from 'humanresources.company-structure.structure-components';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\nimport { Text } from 'main.core';\nimport { type BaseEvent } from 'main.core.events';\nimport { TagSelector } from 'ui.entity-selector';\nimport { UI } from 'ui.notification';\nimport { mapState } from 'ui.vue3.pinia';\nimport { DepartmentContentActions } from '../../../actions';\nimport { DepartmentAPI } from '../../../api';\n\nimport './styles/move-user-action-popup.css';\n\n// @vue/component\nexport const MoveUserActionPopup = {\n\tname: 'MoveUserActionPopup',\n\tcomponents: { ConfirmationPopup },\n\temits: ['close', 'action'],\n\n\tprops: {\n\t\tparentId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tuser: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tentityType: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.permissionChecker = PermissionChecker.getInstance();\n\n\t\tif (!this.permissionChecker)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.action = this.isTeamEntity\n\t\t\t? PermissionActions.teamAddMember\n\t\t\t: PermissionActions.employeeAddToDepartment\n\t\t;\n\t\tthis.selectedDepartmentId = 0;\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tshowMoveUserActionLoader: false,\n\t\t\tlockMoveUserActionButton: false,\n\t\t\tshowUserAlreadyBelongsToDepartmentPopup: false,\n\t\t\taccessDenied: false,\n\t\t};\n\t},\n\n\tmounted(): void\n\t{\n\t\tconst departmentContainer = this.$refs['department-selector'];\n\t\tthis.departmentSelector = this.createTagSelector();\n\t\tthis.departmentSelector.renderTo(departmentContainer);\n\t},\n\n\tcomputed: {\n\t\t...mapState(useChartStore, ['departments', 'focusedNode']),\n\t\tincludedNodeEntityTypesInDialog(): string[]\n\t\t{\n\t\t\treturn this.isTeamEntity ? ['team'] : ['department'];\n\t\t},\n\t\tgetMoveUserActionPhrase(): string\n\t\t{\n\t\t\tconst departmentName = Text.encode(this.departments.get(this.focusedNode).name ?? '');\n\t\t\tconst userName = Text.encode(this.user.name ?? '');\n\n\t\t\tlet phraseCode = '';\n\t\t\tif (this.isTeamEntity)\n\t\t\t{\n\t\t\t\tphraseCode = 'HUMANRESOURCES_DEPARTMENT_CONTENT_TAB_USER_ACTION_MENU_MOVE_TO_ANOTHER_TEAM_REMOVE_USER_DESCRIPTION';\n\t\t\t\tphraseCode += this.user.gender === 'F' ? '_F' : '_M';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tphraseCode = 'HUMANRESOURCES_DEPARTMENT_CONTENT_TAB_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_ALREADY_BELONGS_TO_DEPARTMENT_DESCRIPTION_MSGVER_1';\n\t\t\t}\n\n\t\t\treturn this.loc(\n\t\t\t\tphraseCode,\n\t\t\t\t{\n\t\t\t\t\t'#USER_NAME#': userName,\n\t\t\t\t\t'#DEPARTMENT_NAME#': departmentName,\n\t\t\t\t},\n\t\t\t)\n\t\t\t\t.replace(\n\t\t\t\t\t'[link]',\n\t\t\t\t\t`<a class=\"hr-department-detail-content__move-user-department-user-link\" href=\"${this.user.url}\">`,\n\t\t\t\t)\n\t\t\t\t.replace('[/link]', '</a>')\n\t\t\t;\n\t\t},\n\t\tgetUserAlreadyBelongsToDepartmentPopupPhrase(): string\n\t\t{\n\t\t\tconst departmentName = Text.encode(this.departments.get(this.selectedParentDepartment ?? 0).name ?? '');\n\t\t\tconst userName = Text.encode(this.user.name ?? '');\n\n\t\t\tlet phraseCode = '';\n\t\t\tif (this.isTeamEntity)\n\t\t\t{\n\t\t\t\tphraseCode = 'HUMANRESOURCES_DEPARTMENT_CONTENT_TAB_USER_ACTION_MENU_MOVE_TO_ANOTHER_TEAM_ALREADY_BELONGS_TO_TEAM_DESCRIPTION';\n\t\t\t\tphraseCode += this.user.gender === 'F' ? '_F' : '_M';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tphraseCode = 'HUMANRESOURCES_DEPARTMENT_CONTENT_TAB_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_ALREADY_BELONGS_TO_DEPARTMENT_DESCRIPTION_MSGVER_1';\n\t\t\t}\n\n\t\t\tlet phrase = this.loc(\n\t\t\t\tphraseCode,\n\t\t\t\t{\n\t\t\t\t\t'#USER_NAME#': userName,\n\t\t\t\t\t'#DEPARTMENT_NAME#': departmentName,\n\t\t\t\t},\n\t\t\t);\n\t\t\tphrase = phrase.replace('[link]', `<a class=\"hr-department-detail-content__move-user-department-user-link\" href=\"${this.user.url}\">`);\n\t\t\tphrase = phrase.replace('[/link]', '</a>');\n\n\t\t\treturn phrase;\n\t\t},\n\t\tmemberRoles(): MemberRolesType\n\t\t{\n\t\t\treturn getMemberRoles(this.entityType);\n\t\t},\n\t\tisTeamEntity(): boolean\n\t\t{\n\t\t\treturn this.entityType === EntityTypes.team;\n\t\t},\n\t\tconfirmTitle(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_MOVE_TO_ANOTHER_TEAM_POPUP_CONFIRM_TITLE')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_POPUP_CONFIRM_TITLE')\n\t\t\t;\n\t\t},\n\t\tconfirmDescription(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_USER_ACTION_MENU_MOVE_TO_ANOTHER_TEAM_POPUP_ACTION_SELECT_TEAM_DESCRIPTION')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_POPUP_ACTION_SELECT_DEPARTMENT_DESCRIPTION')\n\t\t\t;\n\t\t},\n\t},\n\n\tmethods: {\n\t\tcreateTagSelector(): TagSelector\n\t\t{\n\t\t\treturn new TagSelector({\n\t\t\t\tevents: {\n\t\t\t\t\tonTagAdd: (event: BaseEvent) => {\n\t\t\t\t\t\tthis.accessDenied = false;\n\t\t\t\t\t\tconst { tag } = event.data;\n\t\t\t\t\t\tthis.selectedParentDepartment = tag.id;\n\t\t\t\t\t\tif (PermissionChecker.hasPermission(this.action, tag.id))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.lockMoveUserActionButton = false;\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.accessDenied = true;\n\t\t\t\t\t\tthis.lockMoveUserActionButton = true;\n\t\t\t\t\t},\n\t\t\t\t\tonTagRemove: () => {\n\t\t\t\t\t\tthis.lockMoveUserActionButton = true;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tmultiple: false,\n\t\t\t\tdialogOptions: {\n\t\t\t\t\twidth: 425,\n\t\t\t\t\theight: 350,\n\t\t\t\t\tdropdownMode: true,\n\t\t\t\t\thideOnDeselect: true,\n\t\t\t\t\tentities: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'structure-node',\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tselectMode: 'departmentsOnly',\n\t\t\t\t\t\t\t\trestricted: 'addMember',\n\t\t\t\t\t\t\t\tincludedNodeEntityTypes: this.includedNodeEntityTypesInDialog,\n\t\t\t\t\t\t\t\tuseMultipleTabs: true,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tpreselectedItems: [['structure-node', this.parentId]],\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tasync confirmMoveUser(): Promise<void>\n\t\t{\n\t\t\tthis.showMoveUserActionLoader = true;\n\t\t\tconst departmentId = this.focusedNode;\n\t\t\tconst userId = this.user.id;\n\t\t\tconst targetNodeId = this.selectedParentDepartment;\n\n\t\t\ttry\n\t\t\t{\n\t\t\t\tawait DepartmentAPI.moveUserToDepartment(\n\t\t\t\t\tdepartmentId,\n\t\t\t\t\tuserId,\n\t\t\t\t\ttargetNodeId,\n\t\t\t\t);\n\t\t\t}\n\t\t\tcatch (error)\n\t\t\t{\n\t\t\t\tthis.showMoveUserActionLoader = false;\n\n\t\t\t\tconst code = error.code ?? 0;\n\n\t\t\t\tif (code === 'MEMBER_ALREADY_BELONGS_TO_NODE')\n\t\t\t\t{\n\t\t\t\t\tthis.showUserAlreadyBelongsToDepartmentPopup = true;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tconst phraseCode = this.isTeamEntity\n\t\t\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_USER_ACTION_MENU_MOVE_TO_ANOTHER_TEAM_ERROR')\n\t\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_ERROR')\n\t\t\t\t\t;\n\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: phraseCode,\n\t\t\t\t\t\tautoHideDelay: 2000,\n\t\t\t\t\t});\n\t\t\t\t\tthis.$emit('close');\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst departmentName = Text.encode(this.departments.get(targetNodeId)?.name ?? '');\n\t\t\tconst phraseCode = this.isTeamEntity\n\t\t\t\t? 'HUMANRESOURCES_DEPARTMENT_CONTENT_TAB_USER_ACTION_MENU_MOVE_TO_ANOTHER_TEAM_SUCCESS_MESSAGE'\n\t\t\t\t: 'HUMANRESOURCES_DEPARTMENT_CONTENT_TAB_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_SUCCESS_MESSAGE'\n\t\t\t;\n\t\t\tUI.Notification.Center.notify({\n\t\t\t\tcontent: this.loc(\n\t\t\t\t\tphraseCode,\n\t\t\t\t\t{\n\t\t\t\t\t\t'#DEPARTMENT_NAME#': departmentName,\n\t\t\t\t\t},\n\t\t\t\t),\n\t\t\t\tautoHideDelay: 2000,\n\t\t\t});\n\n\t\t\tDepartmentContentActions.moveUserToDepartment(\n\t\t\t\tdepartmentId,\n\t\t\t\tuserId,\n\t\t\t\ttargetNodeId,\n\t\t\t\tthis.user.role ?? this.memberRoles.employee,\n\t\t\t);\n\n\t\t\tthis.$emit('action');\n\t\t\tthis.showMoveUserActionLoader = false;\n\t\t},\n\t\tcloseAction(): void\n\t\t{\n\t\t\tthis.$emit('close');\n\t\t},\n\t\tcloseUserAlreadyBelongsToDepartmentPopup(): void\n\t\t{\n\t\t\tthis.showUserAlreadyBelongsToDepartmentPopup = false;\n\t\t\tthis.closeAction();\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<ConfirmationPopup\n\t\t\t@action=\"confirmMoveUser\"\n\t\t\t@close=\"closeAction\"\n\t\t\t:showActionButtonLoader=\"showMoveUserActionLoader\"\n\t\t\t:lockActionButton=\"lockMoveUserActionButton\"\n\t\t\t:title=\"confirmTitle\"\n\t\t\t:confirmBtnText = \"loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_POPUP_CONFIRM_BUTTON')\"\n\t\t\t:width=\"364\"\n\t\t>\n\t\t\t<template v-slot:content>\n\t\t\t\t<div class=\"hr-department-detail-content__user-action-text-container\">\n\t\t\t\t\t<div v-html=\"getMoveUserActionPhrase\"/>\n\t\t\t\t\t<span>\n\t\t\t\t\t\t{{confirmDescription}}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tclass=\"hr-department-detail-content__move-user-department-selector\"\n\t\t\t\t\tref=\"department-selector\"\n\t\t\t\t\t:class=\"{ 'ui-ctl-warning': accessDenied }\"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"accessDenied\"\n\t\t\t\t\tclass=\"hr-department-detail-content__move-user-department_item-error\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"ui-icon-set --warning\"></div>\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass=\"hr-department-detail-content__move-user-department_item-error-message\"\n\t\t\t\t\t>\n\t\t\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_PERMISSION_ERROR')}}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</ConfirmationPopup>\n\t\t<ConfirmationPopup\n\t\t\t@action=\"closeUserAlreadyBelongsToDepartmentPopup\"\n\t\t\t@close=\"closeUserAlreadyBelongsToDepartmentPopup\"\n\t\t\tv-if=\"showUserAlreadyBelongsToDepartmentPopup\"\n\t\t\t:withoutTitleBar = true\n\t\t\t:onlyConfirmButtonMode = true\n\t\t\t:confirmBtnText = \"loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_ALREADY_BELONGS_TO_DEPARTMENT_CLOSE_BUTTON')\"\n\t\t\t:width=\"300\"\n\t\t>\n\t\t\t<template v-slot:content>\n\t\t\t\t<div class=\"hr-department-detail-content__user-action-text-container\">\n\t\t\t\t\t<div \n\t\t\t\t\t\tclass=\"hr-department-detail-content__user-belongs-to-department-text-container\"\n\t\t\t\t\t\tv-html=\"getUserAlreadyBelongsToDepartmentPopupPhrase\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"hr-department-detail-content__move-user-department-selector\" ref=\"department-selector\"></div>\n\t\t\t</template>\n\t\t</ConfirmationPopup>\n\t`,\n};\n","import { RouteActionMenu, ConfirmationPopup } from 'humanresources.company-structure.structure-components';\nimport { Text } from 'main.core';\nimport { UserListActionMenu, MenuActions } from 'humanresources.company-structure.org-chart';\nimport { DepartmentAPI } from '../../../api';\nimport { DepartmentContentActions } from '../../../actions';\nimport { memberRoles } from 'humanresources.company-structure.api';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { mapState } from 'ui.vue3.pinia';\nimport { MoveUserActionPopup } from './move-user-action-popup';\nimport { UI } from 'ui.notification';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\n\nimport './styles/action-button.css';\n\nexport const UserListItemActionButton = {\n\tname: 'userList',\n\n\tprops: {\n\t\tuser: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tdepartmentId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tcomponents: {\n\t\tRouteActionMenu,\n\t\tConfirmationPopup,\n\t\tMoveUserActionPopup,\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tmenuVisible: {},\n\t\t\tshowRemoveUserConfirmationPopup: false,\n\t\t\tshowRemoveUserConfirmationActionLoader: false,\n\t\t\tshowMoveUserPopup: false,\n\t\t\tshowFireUserPopup: false,\n\t\t\tfireUserLoad: false,\n\t\t};\n\t},\n\n\tmethods: {\n\t\ttoggleMenu(userId)\n\t\t{\n\t\t\tthis.menuVisible[userId] = !this.menuVisible[userId];\n\t\t},\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tonActionMenuItemClick(actionId: string): void\n\t\t{\n\t\t\tif (actionId === MenuActions.removeUserFromDepartment)\n\t\t\t{\n\t\t\t\tthis.showRemoveUserConfirmationPopup = true;\n\t\t\t}\n\n\t\t\tif (actionId === MenuActions.moveUserToAnotherDepartment)\n\t\t\t{\n\t\t\t\tthis.showMoveUserPopup = true;\n\t\t\t}\n\n\t\t\tif (actionId === MenuActions.fireUserFromCompany)\n\t\t\t{\n\t\t\t\tthis.showFireUserPopup = true;\n\t\t\t}\n\t\t},\n\t\tasync removeUser(): Promise<void>\n\t\t{\n\t\t\tthis.showRemoveUserConfirmationActionLoader = true;\n\t\t\tconst userId = this.user.id;\n\t\t\tconst isUserInMultipleDepartments = await DepartmentAPI.isUserInMultipleDepartments(userId);\n\t\t\tconst departmentId = this.focusedNode;\n\t\t\tthis.showRemoveUserConfirmationActionLoader = false;\n\t\t\tthis.showRemoveUserConfirmationPopup = false;\n\n\t\t\ttry\n\t\t\t{\n\t\t\t\tawait DepartmentAPI.removeUserFromDepartment(departmentId, userId);\n\t\t\t}\n\t\t\tcatch\n\t\t\t{\n\t\t\t\tconst phraseCode = this.isTeamEntity\n\t\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_TEAM_ERROR')\n\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_DEPARTMENT_ERROR')\n\t\t\t\t;\n\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\tcontent: phraseCode,\n\t\t\t\t\tautoHideDelay: 2000,\n\t\t\t\t});\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst phraseCode = this.isTeamEntity\n\t\t\t\t? 'HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_TEAM_SUCCESS'\n\t\t\t\t: 'HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_DEPARTMENT_SUCCESS';\n\t\t\tconst departmentName = Text.encode(this.departments.get(this.focusedNode).name ?? '');\n\t\t\tUI.Notification.Center.notify({\n\t\t\t\tcontent: this.loc(phraseCode, { '#DEPARTMENT_NAME#': departmentName }),\n\t\t\t\tautoHideDelay: 2000,\n\t\t\t});\n\n\t\t\tconst role = this.user.role;\n\t\t\tif (isUserInMultipleDepartments || this.isTeamEntity)\n\t\t\t{\n\t\t\t\tDepartmentContentActions.removeUserFromDepartment(departmentId, userId, role);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst rootDepartment = [...this.departments.values()].find((department) => department.parentId === 0);\n\t\t\tif (!rootDepartment)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tDepartmentContentActions.moveUserToDepartment(\n\t\t\t\tdepartmentId,\n\t\t\t\tuserId,\n\t\t\t\trootDepartment.id,\n\t\t\t\trole,\n\t\t\t);\n\t\t},\n\t\tcancelRemoveUser(): void\n\t\t{\n\t\t\tthis.showRemoveUserConfirmationPopup = false;\n\t\t},\n\t\tasync fireUser(): void\n\t\t{\n\t\t\tthis.fireUserLoad = true;\n\n\t\t\tconst userId = this.user.id;\n\n\t\t\ttry\n\t\t\t{\n\t\t\t\tawait DepartmentAPI.fireUser(userId);\n\t\t\t}\n\t\t\tcatch (error)\n\t\t\t{\n\t\t\t\tif (error.code !== 'STRUCTURE_ACCESS_DENIED')\n\t\t\t\t{\n\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: this.user.isInvited\n\t\t\t\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_DELETE_ERROR')\n\t\t\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_FIRE_ERROR'),\n\t\t\t\t\t\tautoHideDelay: 2000,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tthis.showFireUserPopup = false;\n\t\t\t\tthis.fireUserLoad = false;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tDepartmentContentActions.removeUserFromDepartment(this.focusedNode, userId, this.user.role);\n\t\t\tawait DepartmentContentActions.removeUserFromAllDepartments(userId);\n\t\t\tthis.showFireUserPopup = false;\n\t\t\tthis.fireUserLoad = false;\n\t\t},\n\t\tcancelFireUser(): void\n\t\t{\n\t\t\tthis.showFireUserPopup = false;\n\t\t},\n\t\thandleMoveUserAction(): void\n\t\t{\n\t\t\tthis.showMoveUserPopup = false;\n\t\t},\n\t\thandleMoveUserClose(): void\n\t\t{\n\t\t\tthis.showMoveUserPopup = false;\n\t\t},\n\t\tgetMemberKeyByValue(value: string): string\n\t\t{\n\t\t\treturn Object.keys(memberRoles).find((key) => memberRoles[key] === value) || '';\n\t\t},\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.menu = new UserListActionMenu(this.focusedNode, this.entityType, this.user.isInvited);\n\t},\n\n\tcomputed: {\n\t\t...mapState(useChartStore, ['focusedNode', 'departments']),\n\t\tmemberRoles(): typeof memberRoles\n\t\t{\n\t\t\treturn memberRoles;\n\t\t},\n\t\tgetFirePopupDescription(): string\n\t\t{\n\t\t\tconst userName = Text.encode(this.user.name ?? '');\n\t\t\tconst userUrl = Text.encode(this.user.url ?? '');\n\t\t\tconst genderSuffix = this.user.gender === 'F' ? '_F' : '_M';\n\n\t\t\tconst phrase = this.user.isInvited\n\t\t\t\t? `HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_DELETE_POPUP_DESCRIPTION${genderSuffix}`\n\t\t\t\t: `HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_FIRE_POPUP_DESCRIPTION${genderSuffix}`\n\t\t\t;\n\n\t\t\tconst description = this.loc(phrase, {\n\t\t\t\t'#USER_NAME#': userName,\n\t\t\t});\n\n\t\t\treturn description.replace('[link]', `<a class=\"hr-department-detail-content__fire-user-link\" href=\"${userUrl}\">`)\n\t\t\t\t.replace('[/link]', '</a>')\n\t\t\t;\n\t\t},\n\t\tgetFirePopupTitle(): string\n\t\t{\n\t\t\treturn this.user.isInvited\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_DELETE_POPUP_TITLE')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_FIRE_POPUP_TITLE');\n\t\t},\n\t\tgetFirePopupButtonText(): string\n\t\t{\n\t\t\treturn this.user.isInvited\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_DELETE_POPUP_CONFIRM_BUTTON')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_FIRE_POPUP_CONFIRM_BUTTON');\n\t\t},\n\t\tgetRemovePopupTitle(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_TEAM_POPUP_TITLE')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_DEPARTMENT_POPUP_TITLE');\n\t\t},\n\t\tgetRemovePopupDescription(): string\n\t\t{\n\t\t\tconst departmentName = Text.encode(this.departments.get(this.focusedNode).name ?? '');\n\t\t\tconst userName = Text.encode(this.user.name ?? '');\n\n\t\t\tif (this.isTeamEntity)\n\t\t\t{\n\t\t\t\tconst phraseCode = 'HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_TEAM_POPUP_DESCRIPTION';\n\t\t\t\tconst genderSuffix = this.user.gender === 'F' ? '_F' : '_M';\n\n\t\t\t\treturn this.loc(\n\t\t\t\t\tphraseCode + genderSuffix,\n\t\t\t\t\t{\n\t\t\t\t\t\t'#USER_NAME#': userName,\n\t\t\t\t\t\t'#DEPARTMENT_NAME#': departmentName,\n\t\t\t\t\t},\n\t\t\t\t)\n\t\t\t\t\t.replace(\n\t\t\t\t\t\t'[link]',\n\t\t\t\t\t\t`<a class=\"hr-department-detail-content__move-user-department-user-link\" href=\"${this.user.url}\">`,\n\t\t\t\t\t)\n\t\t\t\t\t.replace('[/link]', '</a>')\n\t\t\t\t;\n\t\t\t}\n\n\t\t\treturn this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_DEPARTMENT_POPUP_DESCRIPTION');\n\t\t},\n\t\tentityType(): string\n\t\t{\n\t\t\treturn this.departments.get(this.focusedNode)?.entityType;\n\t\t},\n\t\tisTeamEntity(): boolean\n\t\t{\n\t\t\treturn this.entityType === EntityTypes.team;\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<button\n\t\t\tv-if=\"menu.items.length\"\n\t\t\tclass=\"ui-icon-set --more hr-department-detail-content__user-action-btn\"\n\t\t\t:class=\"{ '--focused': menuVisible[user.id] }\"\n\t\t\t@click.stop=\"toggleMenu(user.id)\"\n\t\t\tref=\"actionUserButton\"\n\t\t\t:data-id=\"'hr-department-detail-content__'+ getMemberKeyByValue(user.role) + '-list_user-' + user.id + '-action-btn'\"\n\t\t/>\n\t\t<RouteActionMenu\n\t\t\tv-if=\"menuVisible[user.id]\"\n\t\t\t:id=\"'tree-node-department-menu-' + user.id\"\n\t\t\t:items=\"menu.items\"\n\t\t\t:width=\"302\"\n\t\t\t:bindElement=\"$refs.actionUserButton\"\n\t\t\t@action=\"onActionMenuItemClick\"\n\t\t\t@close=\"menuVisible[user.id] = false\"\n\t\t/>\n\t\t<ConfirmationPopup\n\t\t\tref=\"removeUserConfirmationPopup\"\n\t\t\tv-if=\"showRemoveUserConfirmationPopup\"\n\t\t\t:showActionButtonLoader=\"showRemoveUserConfirmationActionLoader\"\n\t\t\t:title=\"getRemovePopupTitle\"\n\t\t\t:confirmBtnText=\"loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_DEPARTMENT_POPUP_CONFIRM_BUTTON')\"\n\t\t\t:confirmButtonClass=\"isTeamEntity ? 'ui-btn-danger' : 'ui-btn-primary'\"\n\t\t\t@action=\"removeUser\"\n\t\t\t@close=\"cancelRemoveUser\"\n\t\t\t:width=\"364\"\n\t\t>\n\t\t\t<template v-slot:content>\n\t\t\t\t<div class=\"hr-department-detail-content__user-action-text-container\">\n\t\t\t\t<div\n\t\t\t\t\tv-html=\"getRemovePopupDescription\"\n\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</ConfirmationPopup>\n\t\t<ConfirmationPopup\n\t\t\tref=\"fireUserConfirmationPopup\"\n\t\t\tv-if=\"showFireUserPopup\"\n\t\t\t:showActionButtonLoader=\"fireUserLoad\"\n\t\t\t:title=\"getFirePopupTitle\"\n\t\t\t:confirmBtnText=\"getFirePopupButtonText\"\n\t\t\t:confirmButtonClass=\"'ui-btn-danger'\"\n\t\t\t@action=\"fireUser\"\n\t\t\t@close=\"cancelFireUser\"\n\t\t\t:width=\"364\"\n\t\t>\n\t\t\t<template v-slot:content>\n\t\t\t\t<div class=\"hr-department-detail-content__user-action-text-container\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-html=\"getFirePopupDescription\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</ConfirmationPopup>\n\t\t<MoveUserActionPopup\n\t\t\tv-if=\"showMoveUserPopup\"\n\t\t\t:parentId=\"focusedNode\"\n\t\t\t:user=\"user\"\n\t\t\t:entityType=\"entityType\"\n\t\t\t@action=\"handleMoveUserAction\"\n\t\t\t@close=\"handleMoveUserClose\"\n\t\t/>\n\t`,\n};\n","import { mapState } from 'ui.vue3.pinia';\n\nimport { getMemberRoles, type MemberRolesType } from 'humanresources.company-structure.api';\nimport { UserListItemActionButton } from './action-button';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\n\nimport 'ui.tooltip';\nimport './styles/item.css';\n\nexport const UserListItem = {\n\tname: 'userList',\n\temits: ['itemDragStart'],\n\tprops: {\n\t\tuser: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tselectedUserId: {\n\t\t\ttype: Number,\n\t\t\trequired: false,\n\t\t\tdefault: null,\n\t\t},\n\t\tentityType: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tlistType: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tcanDrag: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\n\tcomponents: { UserListItemActionButton },\n\n\tcomputed: {\n\t\tmemberRoles(): MemberRolesType\n\t\t{\n\t\t\treturn getMemberRoles(this.entityType);\n\t\t},\n\t\tdefaultAvatar(): string\n\t\t{\n\t\t\treturn '/bitrix/js/humanresources/company-structure/org-chart/src/images/default-user.svg';\n\t\t},\n\t\t...mapState(useChartStore, ['focusedNode']),\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\thandleUserClick(item): void\n\t\t{\n\t\t\tBX.SidePanel.Instance.open(item.url, {\n\t\t\t\tcacheable: false,\n\t\t\t});\n\t\t},\n\t\thandleMouseDown(event: MouseEvent): void\n\t\t{\n\t\t\tevent.preventDefault();\n\n\t\t\tthis.$emit('itemDragStart', {\n\t\t\t\tuserId: this.user.id,\n\t\t\t\tinitialListType: this.listType,\n\t\t\t\tevent,\n\t\t\t\telement: this.$el,\n\t\t\t});\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div \n\t\t\t:key=\"user.id\"\n\t\t\tclass=\"hr-department-detail-content__user-container\"\n\t\t\t:class=\"{ '--searched': user.id === selectedUserId }\"\n\t\t\t:data-id=\"'hr-department-detail-content__user-' + user.id + '-item'\"\n\t\t>\n\t\t\t<span v-if=\"canDrag\"\n\t\t\t\t  @mousedown=\"handleMouseDown\"\n\t\t\t\t  class=\"hr-department-detail-content__dnd-icon ui-icon-set --more-points\">\n\t\t\t</span>\n\t\t\t<div class=\"hr-department-detail-content__user-avatar-container\" @click=\"handleUserClick(user)\">\n\t\t\t\t<img \n\t\t\t\t\tclass=\"hr-department-detail-content__user-avatar-img\"\n\t\t\t\t\t:src=\"user.avatar ? encodeURI(user.avatar) : defaultAvatar\"\n\t\t\t\t    alt=\"\"\n\t\t\t\t/>\n\t\t\t\t<div v-if=\"user.role === memberRoles.head\" class=\"hr-department-detail-content__user-avatar-overlay\"></div>\n\t\t\t</div>\n\t\t\t<div class=\"hr-department-detail-content-user__text-container\">\n\t\t\t\t<div class=\"hr-department-detail-content__user-title\">\n\t\t\t\t\t<div \n\t\t\t\t\t\tclass=\"hr-department-detail-content__user-name\" \n\t\t\t\t\t\t@click=\"handleUserClick(user)\"\n\t\t\t\t\t\t:bx-tooltip-user-id=\"user.id\"\n\t\t\t\t\t\tbx-tooltip-context=\"b24\"\n\t\t\t\t\t\t:data-id=\"'hr-department-detail-content__user-' + user.id + '-item-name'\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ user.name }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if=\"user.badgeText\" class=\"hr-department-detail-content-user__name-badge\">{{ user.badgeText }}</div>\n\t\t\t\t</div>\n\t\t\t\t<div \n\t\t\t\t\tclass=\"hr-department-detail-content__user-subtitle\" \n\t\t\t\t\t:class=\"{ '--without-work-position': !user.subtitle }\"\n\t\t\t\t>\n\t\t\t\t\t{{ (user.subtitle?.length ?? 0) > 0 ? user.subtitle : this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_LIST_DEFAULT_WORK_POSITION') }}\n\t\t\t\t</div>\n\t\t\t\t<div v-if=\"user.isInvited\" class=\"hr-department-detail-content-user__item-badge\">\n\t\t\t\t\t{{ this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_LIST_INVITED_BADGE_TEXT') }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<UserListItemActionButton\n\t\t\t\t:user=\"user\"\n\t\t\t\t:departmentId=\"focusedNode\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import 'ui.icon-set.main';\nimport './empty-state.css';\n\nexport const EmptyState = {\n\tname: 'emptyState',\n\n\tprops: {\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t},\n\t\timageClass: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t},\n\t\tdescription: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t},\n\t\tlist: {\n\t\t\ttype: Array,\n\t\t\trequired: false,\n\t\t\tdefault: [],\n\t\t},\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"hr-department-detail-content_tab__empty-state-container\">\n\t\t\t<div v-if=\"imageClass\" :class=\"['hr-department-detail-content_tab__empty-state-icon', imageClass]\"/>\n\t\t\t<span v-if=\"title\" class=\"hr-department-detail-content__empty-tab-entity-title\">\n\t\t\t\t{{ title }}\n\t\t\t</span>\n\t\t\t<span v-if=\"description\" class=\"hr-department-detail-content_tab__empty-state-description\">\n\t\t\t\t{{ description }}\n\t\t\t</span>\n\t\t\t<div v-if=\"list.length > 0\" class=\"hr-department-detail-content_tab__empty-state-list\">\n\t\t\t\t<div class=\"hr-department-detail-content_tab__empty-state-list-item\"  v-for=\"item in list\">\n\t\t\t\t\t<div \n\t\t\t\t\t\tclass=\"ui-icon-set --circle-check hr-department-detail-content_tab__empty-state-list-item-check\"\n\t\t\t\t\t\tstyle=\"--ui-icon-set__icon-size: 20px;\"\n\t\t\t\t\t/>\n\t\t\t\t\t<div class=\"hr-department-detail-content_tab__empty-state-list--item-text\">\n\t\t\t\t\t\t{{ item.text }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<slot name=\"content\"/>\n\t\t</div>\n\t`,\n};\n","import './styles/empty-list-item.css';\n\nexport const EmptyListItem = {\n\tname: 'tabEmptyListItem',\n\n\tprops: {\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\timageClass: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\twithAddPermission: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t\tdefault: true,\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div :class=\"['hr-department-detail-content__tab-empty-list_item-wrapper', { '--with-add': withAddPermission }]\">\n\t\t\t<div class=\"hr-department-detail-content__tab-empty-list_item-image\" :class=\"imageClass\"/>\n\t\t\t<div class=\"hr-department-detail-content__tab-empty-list_item-content\">\n\t\t\t\t<div class=\"hr-department-detail-content__tab-empty-list_item-title\">\n\t\t\t\t\t{{ title }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};","import { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { mapState } from 'ui.vue3.pinia';\nimport { RouteActionMenu } from 'humanresources.company-structure.structure-components';\nimport './styles/list-action-button.css';\n\nexport const ListActionButton = {\n\tname: 'userListActionButton',\n\temits: ['tabListAction', 'close'],\n\n\tprops:\n\t\t{\n\t\t\tid: {\n\t\t\t\ttype: String,\n\t\t\t\trequired: true,\n\t\t\t},\n\t\t\tmenuItems: {\n\t\t\t\ttype: Array,\n\t\t\t\trequired: true,\n\t\t\t},\n\t\t\tdataTestIds: {\n\t\t\t\ttype: Object,\n\t\t\t\trequired: false,\n\t\t\t\tdefault: {},\n\t\t\t},\n\t\t},\n\n\tcomponents:\n\t{\n\t\tRouteActionMenu,\n\t},\n\n\tcomputed:\n\t{\n\t\t...mapState(useChartStore, ['focusedNode']),\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tmenuVisible: false,\n\t\t};\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tonActionMenuItemClick(itemId: string): void\n\t\t{\n\t\t\tthis.$emit('tabListAction', itemId);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<button\n\t\t\tv-if=\"menuItems.length\"\n\t\t\tclass=\"hr-department-detail-content__tab-list_header-button\"\n\t\t\t:class=\"{ '--focused': menuVisible }\"\n\t\t\t:ref=\"id + '-route-action-menu'\"\n\t\t\t@click.stop=\"menuVisible = true\"\n\t\t\t:data-test-id=\"dataTestIds.buttonDataTestId\"\n\t\t>\n\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_LIST_ACTION_BUTTON_TITLE') }}\n\t\t</button>\n\t\t<RouteActionMenu\n\t\t\tv-if=\"menuVisible\"\n\t\t\t:id=\"id + '-route-action-menu'\"\n\t\t\t:items=\"menuItems\"\n\t\t\t:width=\"302\"\n\t\t\t:bindElement=\"$refs[id + '-route-action-menu']\"\n\t\t\t:containerDataTestId=\"dataTestIds.containerDataTestId\"\n\t\t\t@action=\"onActionMenuItemClick\"\n\t\t\t@close=\"menuVisible = false\"\n\t\t/>\n\t`,\n};\n","import { Event, Runtime, Type } from 'main.core';\nimport { EmptyListItem } from './empty-list-item';\nimport { ListActionButton } from './list-action-button';\n\n// eslint-disable-next-line no-unused-vars\nimport type { TabListDataTestIds } from './types';\nimport './styles/list.css';\n\nexport const TabList = {\n\tname: 'tabList',\n\tcomponents: { ListActionButton, EmptyListItem },\n\temits: ['tabListAction'],\n\n\tprops: {\n\t\tid: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tcount: {\n\t\t\ttype: Number,\n\t\t\trequired: false,\n\t\t},\n\t\tmenuItems: {\n\t\t\ttype: Array,\n\t\t\trequired: false,\n\t\t\tdefault: [],\n\t\t},\n\t\tlistItems: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\temptyItemTitle: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t},\n\t\temptyItemImageClass: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t},\n\t\thideEmptyItem: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t\tdefault: false,\n\t\t},\n\t\twithAddPermission: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t\tdefault: true,\n\t\t},\n\t\t/** @var { TabListDataTestIds } dataTestIds */\n\t\tdataTestIds: {\n\t\t\ttype: Object,\n\t\t\trequired: false,\n\t\t\tdefault: {},\n\t\t},\n\t\tisDropTarget: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tlistType: {\n\t\t\ttype: String,\n\t\t},\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tplaceholderIndex: null,\n\t\t\tboundHandleDragOverList: null,\n\t\t};\n\t},\n\n\tcomputed: {\n\t\tneedToShowCount(): boolean\n\t\t{\n\t\t\treturn Type.isNumber(this.count);\n\t\t},\n\t},\n\n\twatch: {\n\t\tisDropTarget(newValue, oldValue): void\n\t\t{\n\t\t\tif (newValue === oldValue)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst itemsWrapper = this.$refs.itemsWrapper;\n\t\t\tif (!itemsWrapper)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (newValue)\n\t\t\t{\n\t\t\t\tthis.boundHandleDragOverList = Runtime.throttle(this.handleDragOverList.bind(this), 10);\n\t\t\t\tEvent.bind(itemsWrapper, 'mousemove', this.boundHandleDragOverList);\n\n\t\t\t\tif (this.listItems.length === 0)\n\t\t\t\t{\n\t\t\t\t\tthis.placeholderIndex = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tEvent.unbind(itemsWrapper, 'mousemove', this.boundHandleDragOverList);\n\t\t\t\tthis.boundHandleDragOverList = null;\n\t\t\t\tthis.placeholderIndex = null;\n\t\t\t}\n\t\t},\n\t},\n\n\tmethods: {\n\t\tonActionMenuItemClick(actionId: string): void\n\t\t{\n\t\t\tthis.$emit('tabListAction', actionId);\n\t\t},\n\t\thandleDragOverList(event: MouseEvent): void\n\t\t{\n\t\t\tif (!this.isDropTarget || !this.$refs.itemsWrapper)\n\t\t\t{\n\t\t\t\tif (this.placeholderIndex !== null)\n\t\t\t\t{\n\t\t\t\t\tthis.placeholderIndex = null;\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst itemsWrapper = this.$refs.itemsWrapper;\n\t\t\tconst children = [...itemsWrapper.querySelectorAll('.hr-department-detail-content__user-container:not(.--dragging)')];\n\t\t\tconst mouseY = event.clientY;\n\n\t\t\tif (children.length === 0)\n\t\t\t{\n\t\t\t\tif (this.placeholderIndex !== 0)\n\t\t\t\t{\n\t\t\t\t\tthis.placeholderIndex = 0;\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet newIndex = children.length;\n\n\t\t\tfor (const [i, child] of children.entries())\n\t\t\t{\n\t\t\t\tconst rect = child.getBoundingClientRect();\n\t\t\t\tconst childMidpointY = rect.top + rect.height / 2;\n\n\t\t\t\tif (mouseY < childMidpointY)\n\t\t\t\t{\n\t\t\t\t\tnewIndex = i;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (newIndex !== this.placeholderIndex)\n\t\t\t{\n\t\t\t\tthis.placeholderIndex = newIndex;\n\t\t\t}\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"hr-department-detail-content__tab-list_container\"\n\t\t\t :data-test-id=\"dataTestIds.containerDataTestId\"\n\t\t>\n\t\t\t<div class=\"hr-department-detail-content__tab-list_header-container\">\n\t\t\t\t<div class=\"hr-department-detail-content__tab-list_list-title\">\n\t\t\t\t\t{{ title }}\n\t\t\t\t\t<span\n\t\t\t\t\t\tv-if=\"needToShowCount\"\n\t\t\t\t\t\tclass=\"hr-department-detail-content__tab-list_header-count\"\n\t\t\t\t\t\t:data-test-id=\"dataTestIds.listCounterDataTestId\"\n\t\t\t\t\t>\n\t\t\t\t\t{{ count }}\n\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<ListActionButton\n\t\t\t\t\t:id=\"id\"\n\t\t\t\t\t:menuItems=\"menuItems\"\n\t\t\t\t\t@tabListAction=\"onActionMenuItemClick\"\n\t\t\t\t\t:dataTestIds=\"{buttonDataTestId: dataTestIds.listActionButtonDataTestId, containerDataTestId: dataTestIds.listActonMenuDataTestId}\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class=\"hr-department-detail-content__tab_list-container\" ref=\"itemsWrapper\">\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"placeholderIndex === 0 && isDropTarget\"\n\t\t\t\t\tclass=\"hr-department-detail-content__drop-placeholder\"\n\t\t\t\t></div>\n\t\t\t\t<template v-for=\"(item, index) in listItems\" :key=\"item.id\">\n\t\t\t\t\t<slot :item=\"item\"\n\t\t\t\t\t/>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"placeholderIndex === (index + 1) && isDropTarget\"\n\t\t\t\t\t\tclass=\"hr-department-detail-content__drop-placeholder\"\n\t\t\t\t\t></div>\n\t\t\t\t</template>\n\t\t\t\t<slot name=\"footer\" />\n\t\t\t\t<EmptyListItem v-if=\"emptyItemTitle && emptyItemImageClass && !listItems.length && !hideEmptyItem\"\n\t\t\t\t\t:title=\"emptyItemTitle\"\n\t\t\t\t\t:imageClass=\"emptyItemImageClass\"\n\t\t\t\t\t:withAddPermission=\"withAddPermission\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import 'ui.icon-set.main';\nimport './search-input.css';\n\nexport const SearchInput = {\n\tname: 'searchInput',\n\tprops: {\n\t\tvalue: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: '',\n\t\t},\n\t\tplaceholder: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tdataTestId: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t},\n\t},\n\n\tdata(): {hasFocus: boolean}\n\t{\n\t\treturn {\n\t\t\thasFocus: false,\n\t\t};\n\t},\n\n\tmethods: {\n\t\thandleInput(event: InputEvent): void\n\t\t{\n\t\t\tthis.$emit('inputChange', event.target.value);\n\t\t},\n\t\thandleBlur(): void\n\t\t{\n\t\t\tif (this.value.length === 0)\n\t\t\t{\n\t\t\t\tthis.hasFocus = false;\n\t\t\t}\n\t\t},\n\t\tclearInput(): void\n\t\t{\n\t\t\tthis.hasFocus = false;\n\t\t\tthis.$emit('inputChange', '');\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"hr-department-detail-content__content-search\"\n\t\t\t:class=\"{'--focused': hasFocus}\"\n\t\t>\n\t\t\t<div class=\"hr-department-detail-content__content-search-icon ui-icon-set --search-1\"/>\n\t\t\t<input\n\t\t\t\tclass=\"hr-department-detail-content__content-search-input\"\n\t\t\t\ttype=\"text\"\n\t\t\t\t:placeholder=\"!hasFocus ?  placeholder : ''\"\n\t\t\t\t:data-test-id=\"dataTestId\"\n\t\t\t\t:value=\"value\"\n\t\t\t\t@input=\"handleInput\"\n\t\t\t\t@focus=\"hasFocus = true\"\n\t\t\t\t@blur=\"handleBlur\"\n\t\t\t>\n\t\t\t<div\n\t\t\t\tclass=\"hr-department-detail-content__content-search-close-button ui-icon-set --cross-circle-50\"\n\t\t\t\t:class=\"{'--hide': !hasFocus}\"\n\t\t\t\t@click=\"clearInput\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { EntityTypes } from 'humanresources.company-structure.utils';\nimport { Dom, Event, Text } from 'main.core';\nimport { UI } from 'ui.notification';\nimport { EventEmitter } from 'main.core.events';\nimport { mapState, mapWritableState } from 'ui.vue3.pinia';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { getMemberRoles, MemberRolesType, AnalyticsSourceType } from 'humanresources.company-structure.api';\nimport { UserManagementDialogAPI } from 'humanresources.company-structure.user-management-dialog';\nimport { PermissionActions, PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport { UsersTabActionMenu, events } from 'humanresources.company-structure.org-chart';\nimport { MoveEmployeeConfirmationPopup } from 'humanresources.company-structure.structure-components';\nimport { HeadListDataTestIds, EmployeeListDataTestIds } from './consts';\nimport { EmptyTabAddButton } from './empty-tab-add-button';\nimport { UserListItem } from './item/item';\nimport { EmptyState } from '../base-components/empty-state/empty-state';\nimport { TabList } from '../base-components/list/list';\nimport { SearchInput } from '../base-components/search/search-input';\nimport { DepartmentAPI } from '../../api';\nimport { DepartmentContentActions } from '../../actions';\n\nimport type { TabListDataTestIds } from '../base-components/list/types';\n\nimport 'ui.buttons';\nimport './styles/tab.css';\n\ntype DepartmentUsersStatus = {\n\tdepartmentId: number;\n\tloaded: boolean;\n};\n\nconst AUTOSCROLL_AREA_SIZE = 70;\n\n// @vue/component\nexport const UsersTab = {\n\tname: 'usersTab',\n\n\tcomponents: {\n\t\tSearchInput,\n\t\tEmptyState,\n\t\tTabList,\n\t\tEmptyTabAddButton,\n\t\tUserListItem,\n\t\tMoveEmployeeConfirmationPopup,\n\t},\n\n\temits: ['showDetailLoader', 'hideDetailLoader'],\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tsearchQuery: '',\n\t\t\tselectedUserId: null,\n\t\t\tneedToScroll: false,\n\t\t\tdragState: this.getInitialDragState(),\n\t\t\tshowDndConfirmationPopup: false,\n\t\t\tdndPreviousState: null,\n\t\t\tdndPopupDescription: '',\n\t\t\tboundHandleDragMove: null,\n\t\t\tboundHandleDragEnd: null,\n\t\t};\n\t},\n\n\tcomputed: {\n\t\tmemberRoles(): MemberRolesType\n\t\t{\n\t\t\treturn getMemberRoles(this.entityType);\n\t\t},\n\t\theads(): Array\n\t\t{\n\t\t\treturn this.departments.get(this.focusedNode).heads ?? [];\n\t\t},\n\t\theadCount(): number\n\t\t{\n\t\t\treturn this.heads.length ?? 0;\n\t\t},\n\t\tdepartmentId(): number\n\t\t{\n\t\t\treturn this.focusedNode;\n\t\t},\n\t\tformattedHeads(): Array\n\t\t{\n\t\t\treturn this.heads.map((head) => ({\n\t\t\t\t...head,\n\t\t\t\tsubtitle: head.workPosition,\n\t\t\t\tbadgeText: this.getBadgeText(head.role),\n\t\t\t})).sort((a, b) => {\n\t\t\t\tconst roleOrder = {\n\t\t\t\t\t[this.memberRoles.head]: 1,\n\t\t\t\t\t[this.memberRoles.deputyHead]: 2,\n\t\t\t\t};\n\n\t\t\t\tconst roleA = roleOrder[a.role] || 3;\n\t\t\t\tconst roleB = roleOrder[b.role] || 3;\n\n\t\t\t\treturn roleA - roleB;\n\t\t\t});\n\t\t},\n\t\tfilteredHeads(): Array\n\t\t{\n\t\t\treturn this.formattedHeads.filter(\n\t\t\t\t(head) => head.name.toLowerCase().includes(this.searchQuery.toLowerCase())\n\t\t\t\t\t|| head.workPosition?.toLowerCase().includes(this.searchQuery.toLowerCase()),\n\t\t\t);\n\t\t},\n\t\temployeeCount(): number\n\t\t{\n\t\t\tconst memberCount = this.departments.get(this.focusedNode).userCount ?? 0;\n\n\t\t\treturn memberCount - (this.headCount ?? 0);\n\t\t},\n\t\tformattedEmployees(): Array\n\t\t{\n\t\t\treturn this.employees.map((employee) => ({\n\t\t\t\t...employee,\n\t\t\t\tsubtitle: employee.workPosition,\n\t\t\t})).reverse();\n\t\t},\n\t\tfilteredEmployees(): Array\n\t\t{\n\t\t\treturn this.formattedEmployees.filter(\n\t\t\t\t(employee) => employee.name.toLowerCase().includes(this.searchQuery.toLowerCase())\n\t\t\t\t\t|| employee.workPosition?.toLowerCase().includes(this.searchQuery.toLowerCase()),\n\t\t\t);\n\t\t},\n\t\tmemberCount(): number\n\t\t{\n\t\t\treturn this.departments.get(this.focusedNode).userCount ?? 0;\n\t\t},\n\t\t...mapState(useChartStore, ['focusedNode', 'departments', 'searchedUserId']),\n\t\t...mapWritableState(useChartStore, ['searchedUserId']),\n\t\temployees(): Array\n\t\t{\n\t\t\treturn this.departments.get(this.focusedNode)?.employees ?? [];\n\t\t},\n\t\tshowSearchBar(): boolean\n\t\t{\n\t\t\treturn this.memberCount > 0;\n\t\t},\n\t\tshowSearchEmptyState(): boolean\n\t\t{\n\t\t\treturn this.filteredHeads.length === 0 && this.filteredEmployees.length === 0;\n\t\t},\n\t\tcanAddUsers(): boolean\n\t\t{\n\t\t\tconst permissionChecker = PermissionChecker.getInstance();\n\t\t\tif (!permissionChecker)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst nodeId = this.focusedNode;\n\t\t\tconst permission = this.isTeamEntity\n\t\t\t\t? PermissionActions.teamAddMember\n\t\t\t\t: PermissionActions.employeeAddToDepartment\n\t\t\t;\n\n\t\t\treturn permissionChecker.hasPermission(permission, nodeId);\n\t\t},\n\t\theadListEmptyStateTitle(): string\n\t\t{\n\t\t\tif (this.canAddUsers)\n\t\t\t{\n\t\t\t\treturn this.isTeamEntity\n\t\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_TEAM_HEAD_EMPTY_LIST_ITEM_TITLE')\n\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_HEAD_EMPTY_LIST_ITEM_TITLE');\n\t\t\t}\n\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_TEAM_HEAD_EMPTY_LIST_ITEM_TITLE_WITHOUT_ADD_PERMISSION')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_HEAD_EMPTY_LIST_ITEM_TITLE_WITHOUT_ADD_PERMISSION');\n\t\t},\n\t\temployeesListEmptyStateTitle(): string\n\t\t{\n\t\t\tif (this.canAddUsers)\n\t\t\t{\n\t\t\t\treturn this.isTeamEntity\n\t\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_TEAM_EMPLOYEE_EMPTY_LIST_ITEM_TITLE')\n\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_EMPLOYEE_EMPTY_LIST_ITEM_TITLE');\n\t\t\t}\n\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_TEAM_EMPLOYEE_EMPTY_LIST_ITEM_TITLE_WITHOUT_ADD_PERMISSION')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_EMPLOYEE_EMPTY_LIST_ITEM_TITLE_WITHOUT_ADD_PERMISSION');\n\t\t},\n\t\tshouldUpdateList(): boolean\n\t\t{\n\t\t\treturn this.departments.get(this.focusedNode).employeeListOptions?.shouldUpdateList ?? true;\n\t\t},\n\t\tdepartmentUsersStatus(): DepartmentUsersStatus\n\t\t{\n\t\t\tconst department = this.departments.get(this.focusedNode);\n\t\t\tif (department?.heads && department.employees)\n\t\t\t{\n\t\t\t\treturn { departmentId: this.focusedNode, loaded: true };\n\t\t\t}\n\n\t\t\treturn { departmentId: this.focusedNode, loaded: false };\n\t\t},\n\t\theadMenu(): UsersTabActionMenu\n\t\t{\n\t\t\treturn new UsersTabActionMenu(\n\t\t\t\tthis.focusedNode,\n\t\t\t\tAnalyticsSourceType.DETAIL,\n\t\t\t\t'head',\n\t\t\t\tthis.entityType,\n\t\t\t);\n\t\t},\n\t\temployeeMenu(): UsersTabActionMenu\n\t\t{\n\t\t\treturn new UsersTabActionMenu(\n\t\t\t\tthis.focusedNode,\n\t\t\t\tAnalyticsSourceType.DETAIL,\n\t\t\t\t'employee',\n\t\t\t\tthis.entityType,\n\t\t\t);\n\t\t},\n\t\tisEmployeeListOptionsSet(): boolean\n\t\t{\n\t\t\tconst department = this.departments.get(this.focusedNode) || {};\n\n\t\t\treturn department.employeeListOptions && Object.keys(department.employeeListOptions).length > 0;\n\t\t},\n\t\temployeeTitle(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_TEAM_EMPLOYEE_LIST_TITLE')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_EMPLOYEE_LIST_TITLE');\n\t\t},\n\t\tentityType(): string\n\t\t{\n\t\t\treturn this.departments.get(this.focusedNode)?.entityType;\n\t\t},\n\t\tisTeamEntity(): boolean\n\t\t{\n\t\t\treturn this.entityType === EntityTypes.team;\n\t\t},\n\t\temptyStateTitle(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_EMPLOYEES_TEAM_ADD_USER_TITLE')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_EMPLOYEES_ADD_USER_TITLE');\n\t\t},\n\t\temptyStateDescription(): string\n\t\t{\n\t\t\tif (this.canAddUsers)\n\t\t\t{\n\t\t\t\treturn this.isTeamEntity\n\t\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_EMPLOYEES_TEAM_ADD_USER_SUBTITLE')\n\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_EMPLOYEES_ADD_USER_SUBTITLE');\n\t\t\t}\n\n\t\t\t// text is in progress\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? ''\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_EMPLOYEES_ADD_USER_SUBTITLE');\n\t\t},\n\t\tisHeadListPotentialTarget(): boolean\n\t\t{\n\t\t\treturn this.dragState.isDragging\n\t\t\t\t&& this.dragState.initialList === 'employees'\n\t\t\t;\n\t\t},\n\t\tisEmployeeListPotentialTarget(): boolean\n\t\t{\n\t\t\treturn this.dragState.isDragging\n\t\t\t\t&& (this.dragState.initialList === 'head' || this.dragState.initialList === 'deputyHead')\n\t\t\t;\n\t\t},\n\t\tdndConfirmationPopupTitle(): string\n\t\t{\n\t\t\tconst toHead = this.dragState.targetList === 'head';\n\n\t\t\treturn toHead\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_DND_POPUP_CONFIRM_TITLE_TO_HEAD')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_DND_POPUP_CONFIRM_TITLE');\n\t\t},\n\t\tdndConfirmationPopupBtn(): string\n\t\t{\n\t\t\tconst toHead = this.dragState.targetList === 'head';\n\n\t\t\treturn toHead\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_DND_POPUP_CONFIRM_BTN_TO_HEAD')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_DND_POPUP_CONFIRM_BTN');\n\t\t},\n\t\tshowDndRoleSelect(): boolean\n\t\t{\n\t\t\treturn this.dragState.targetList === 'head';\n\t\t},\n\t\theadListTitle(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_TEAM_HEAD_LIST_TITLE')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_HEAD_LIST_TITLE')\n\t\t\t;\n\t\t},\n\t},\n\n\twatch: {\n\t\tfocusedNode(newId: number): void\n\t\t{\n\t\t\tconst department = this.departments.get(newId) || {};\n\t\t\tif (!this.isEmployeeListOptionsSet)\n\t\t\t{\n\t\t\t\tconst employeeListOptions = {\n\t\t\t\t\tpage: 0,\n\t\t\t\t\tshouldUpdateList: true,\n\t\t\t\t\tisListUpdated: false,\n\t\t\t\t};\n\t\t\t\tDepartmentContentActions.updateEmployeeListOptions(newId, employeeListOptions);\n\t\t\t\tthis.departments.set(newId, department);\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tdepartment.employeeListOptions.page === 0\n\t\t\t\t&& department.employeeListOptions.isListUpdated === false\n\t\t\t\t&& department.employeeListOptions.shouldUpdateList === true\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.loadEmployeesAction();\n\t\t\t}\n\n\t\t\tthis.isDescriptionExpanded = false;\n\t\t\tthis.searchQuery = '';\n\n\t\t\tif (this.searchedUserId)\n\t\t\t{\n\t\t\t\tthis.needToFocusUserId = this.searchedUserId;\n\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\tthis.scrollToUser();\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tsearchedUserId: {\n\t\t\thandler(userId: number): void\n\t\t\t{\n\t\t\t\tif (!userId)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.needToFocusUserId = userId;\n\t\t\t\tif (this.isListUpdated)\n\t\t\t\t{\n\t\t\t\t\tthis.needToScroll = true;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\t\tthis.scrollToUser();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\timmediate: true,\n\t\t},\n\t\tasync searchQuery(newQuery: string): Promise<void>\n\t\t{\n\t\t\tawait this.searchMembers(newQuery);\n\t\t},\n\t\tdepartmentUsersStatus(usersStatus: DepartmentUsersStatus, prevUsersStatus: DepartmentUsersStatus): void\n\t\t{\n\t\t\tconst { departmentId, loaded } = usersStatus;\n\t\t\tconst { departmentId: prevDepartmentId, loaded: prevLoaded } = prevUsersStatus;\n\t\t\tif (departmentId === prevDepartmentId && loaded === prevLoaded)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (loaded)\n\t\t\t{\n\t\t\t\tthis.$emit('hideDetailLoader');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.$emit('showDetailLoader');\n\t\t\t\tthis.loadEmployeesAction();\n\t\t\t}\n\t\t},\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.loadEmployeesAction();\n\t\tthis.clearSearchTimeout = null;\n\t\tthis.autoscrollIntervalId = null;\n\n\t\tthis.boundHandleDragMove = this.handleDragMove.bind(this);\n\t\tthis.boundHandleDragEnd = this.handleDragEnd.bind(this);\n\t},\n\n\tmounted(): void\n\t{\n\t\tthis.tabContainer = this.$refs['tab-container'];\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode, replacements = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tgetBadgeText(role): ?string\n\t\t{\n\t\t\tif (role === this.memberRoles.head)\n\t\t\t{\n\t\t\t\treturn this.isTeamEntity\n\t\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPLOYEES_TEAM_HEAD_BADGE')\n\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPLOYEES_HEAD_BADGE')\n\t\t\t\t;\n\t\t\t}\n\n\t\t\tif (role === this.memberRoles.deputyHead)\n\t\t\t{\n\t\t\t\treturn this.isTeamEntity\n\t\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPLOYEES_TEAM_DEPUTY_HEAD_BADGE')\n\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPLOYEES_DEPUTY_HEAD_BADGE')\n\t\t\t\t;\n\t\t\t}\n\n\t\t\treturn null;\n\t\t},\n\t\tupdateList(event): void\n\t\t{\n\t\t\tconst employeesList = event.target;\n\t\t\tconst scrollPosition = employeesList.scrollTop + employeesList.clientHeight;\n\n\t\t\tif (employeesList.scrollHeight - scrollPosition < 40)\n\t\t\t{\n\t\t\t\tthis.loadEmployeesAction();\n\t\t\t}\n\t\t},\n\t\tasync loadEmployeesAction(): void\n\t\t{\n\t\t\tconst nodeId = this.focusedNode;\n\n\t\t\tif (!this.departments.get(nodeId))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst employeeListOptions = this.departments.get(nodeId).employeeListOptions ?? {};\n\n\t\t\temployeeListOptions.page = employeeListOptions.page ?? 0;\n\t\t\temployeeListOptions.shouldUpdateList = employeeListOptions.shouldUpdateList ?? true;\n\t\t\temployeeListOptions.isListUpdated = employeeListOptions.isListUpdated ?? false;\n\t\t\tDepartmentContentActions.updateEmployeeListOptions(nodeId, employeeListOptions);\n\t\t\tif (employeeListOptions.isListUpdated || !employeeListOptions.shouldUpdateList)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t!employeeListOptions.isListUpdated\n\t\t\t\t&& employeeListOptions.page === 0\n\t\t\t\t&& employeeListOptions.shouldUpdateList === true\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.$emit('showDetailLoader');\n\t\t\t}\n\n\t\t\temployeeListOptions.isListUpdated = true;\n\t\t\temployeeListOptions.page += 1;\n\t\t\tDepartmentContentActions.updateEmployeeListOptions(nodeId, employeeListOptions);\n\n\t\t\tlet loadedEmployees = await DepartmentAPI.getPagedEmployees(nodeId, employeeListOptions.page, 25);\n\n\t\t\tif (!loadedEmployees)\n\t\t\t{\n\t\t\t\temployeeListOptions.shouldUpdateList = false;\n\t\t\t\temployeeListOptions.isListUpdated = false;\n\t\t\t\tDepartmentContentActions.updateEmployeeListOptions(nodeId, employeeListOptions);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tloadedEmployees = loadedEmployees.map((user) => {\n\t\t\t\treturn { ...user, role: this.memberRoles.employee };\n\t\t\t});\n\n\t\t\tconst employees = this.departments.get(nodeId)?.employees ?? [];\n\t\t\tconst employeeIds = new Set(employees.map((employee) => employee.id));\n\n\t\t\tconst newEmployees = loadedEmployees.reverse().filter((employee) => !employeeIds.has(employee.id));\n\t\t\temployees.unshift(...newEmployees);\n\t\t\temployeeListOptions.shouldUpdateList = newEmployees.length === 25;\n\t\t\temployeeListOptions.isListUpdated = false;\n\n\t\t\tDepartmentContentActions.updateEmployeeListOptions(nodeId, employeeListOptions);\n\t\t\tDepartmentContentActions.updateEmployees(nodeId, employees);\n\t\t\tif (this.departmentUsersStatus.loaded)\n\t\t\t{\n\t\t\t\tthis.$emit('hideDetailLoader');\n\t\t\t}\n\n\t\t\tif (this.needToScroll)\n\t\t\t{\n\t\t\t\tthis.scrollToUser();\n\t\t\t}\n\t\t},\n\t\tasync scrollToUser(): void\n\t\t{\n\t\t\tconst userId = this.needToFocusUserId;\n\t\t\tthis.needToFocusUserId = null;\n\t\t\tthis.needToScroll = false;\n\t\t\tconst selectors = `.hr-department-detail-content__user-container[data-id=\"hr-department-detail-content__user-${userId}-item\"]`;\n\t\t\tlet element = this.tabContainer.querySelector(selectors);\n\n\t\t\tif (!element)\n\t\t\t{\n\t\t\t\tlet user = null;\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tuser = await DepartmentAPI.getUserInfo(this.focusedNode, userId);\n\t\t\t\t}\n\t\t\t\tcatch\n\t\t\t\t{ /* empty */ }\n\n\t\t\t\tconst department = this.departments.get(this.focusedNode);\n\t\t\t\tif (!user || !department)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (user.role === this.memberRoles.head || user.role === this.memberRoles.deputyHead)\n\t\t\t\t{\n\t\t\t\t\tdepartment.heads = department.heads ?? [];\n\t\t\t\t\tif (!department.heads.some((head) => head.id === user.id))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tdepartment.employees = department.employees ?? [];\n\t\t\t\t\tif (!department.employees.some((employee) => employee.id === user.id))\n\t\t\t\t\t{\n\t\t\t\t\t\tdepartment.employees.push(user);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// eslint-disable-next-line vue/valid-next-tick\n\t\t\t\tawait this.$nextTick(() => {\n\t\t\t\t\telement = this.tabContainer.querySelector(selectors);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (!element)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\telement.scrollIntoView({ behavior: 'smooth', block: 'center' });\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.selectedUserId = userId;\n\t\t\t}, 750);\n\n\t\t\tif (this.clearSearchTimeout)\n\t\t\t{\n\t\t\t\tclearTimeout(this.clearSearchTimeout);\n\t\t\t}\n\n\t\t\tthis.clearSearchTimeout = setTimeout(() => {\n\t\t\t\tif (this.searchedUserId === userId)\n\t\t\t\t{\n\t\t\t\t\tthis.selectedUserId = null;\n\t\t\t\t\tthis.searchedUserId = null;\n\t\t\t\t}\n\t\t\t}, 4000);\n\t\t},\n\t\tasync searchMembers(query)\n\t\t{\n\t\t\tif (query.length === 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.findQueryResult = this.findQueryResult || {};\n\t\t\tthis.findQueryResult[this.focusedNode] = this.findQueryResult[this.focusedNode] || {\n\t\t\t\tsuccess: [],\n\t\t\t\tfailure: [],\n\t\t\t};\n\n\t\t\tconst nodeResults = this.findQueryResult[this.focusedNode];\n\n\t\t\tif (nodeResults.failure.some((failedQuery) => query.startsWith(failedQuery)))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (nodeResults.success.includes(query) || nodeResults.failure.includes(query))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst founded = await DepartmentAPI.findMemberByQuery(this.focusedNode, query);\n\n\t\t\tif (founded.length === 0)\n\t\t\t{\n\t\t\t\tnodeResults.failure.push(query);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst department = this.departments.get(this.focusedNode);\n\t\t\tconst newMembers = founded.filter((found) => !department.heads.some((head) => head.id === found.id)\n\t\t\t\t&& !department.employees.some((employee) => employee.id === found.id));\n\n\t\t\tdepartment.employees.push(...newMembers);\n\t\t\tnodeResults.success.push(query);\n\t\t},\n\t\tsearchUser(searchQuery: string): void\n\t\t{\n\t\t\tthis.searchQuery = searchQuery;\n\t\t},\n\t\tonHeadListActionMenuItemClick(actionId: string): void\n\t\t{\n\t\t\tthis.headMenu.onActionMenuItemClick(actionId);\n\t\t},\n\t\tonEmployeeListActionMenuItemClick(actionId: string): void\n\t\t{\n\t\t\tthis.employeeMenu.onActionMenuItemClick(actionId);\n\t\t},\n\t\tgetHeadListDataTestIds(): TabListDataTestIds\n\t\t{\n\t\t\treturn HeadListDataTestIds;\n\t\t},\n\t\tgetEmployeeListDataTestIds(): TabListDataTestIds\n\t\t{\n\t\t\treturn EmployeeListDataTestIds;\n\t\t},\n\t\thandleItemDragStart(payload): void\n\t\t{\n\t\t\tif (this.dragState.isDragging)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { event, element, userId, initialListType } = payload;\n\n\t\t\tevent.preventDefault();\n\t\t\tthis.dragState.isDragging = true;\n\t\t\tthis.dragState.userId = userId;\n\t\t\tthis.dragState.initialList = initialListType;\n\t\t\tthis.dragState.draggedElement = element;\n\n\t\t\tconst rect = this.dragState.draggedElement.getBoundingClientRect();\n\t\t\tthis.dragState.offsetX = event.clientX - rect.left;\n\t\t\tthis.dragState.offsetY = event.clientY - rect.top;\n\n\t\t\tconst ghost = this.dragState.draggedElement.cloneNode(true);\n\t\t\tDom.addClass(ghost, '--ghost');\n\t\t\tDom.style(ghost, 'left', `${event.clientX - this.dragState.offsetX}px`);\n\t\t\tDom.style(ghost, 'top', `${event.clientY - this.dragState.offsetY}px`);\n\n\t\t\tDom.append(ghost, document.body);\n\t\t\tthis.dragState.ghostElement = ghost;\n\n\t\t\tDom.addClass(this.dragState.draggedElement, '--dragging');\n\t\t\tDom.addClass(document.body, '--user-dragging');\n\n\t\t\tEvent.bind(document, 'mousemove', this.boundHandleDragMove);\n\t\t\tEvent.bind(document, 'mouseup', this.boundHandleDragEnd);\n\n\t\t\t// user to computed?\n\t\t\tconst user = this.formattedHeads.find((u) => u.id === userId)\n\t\t\t\t|| this.formattedEmployees.find((u) => u.id === userId);\n\t\t\tEventEmitter.emit(events.HR_USER_DRAG_START, { user });\n\t\t},\n\t\thandleDragMove(event: MouseEvent): void\n\t\t{\n\t\t\tif (!this.dragState.isDragging)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tDom.addClass(this.dragState.draggedElement, '--hidden');\n\n\t\t\tEventEmitter.emit(events.HR_USER_DRAG_MOVE, {\n\t\t\t\tpageX: event.pageX,\n\t\t\t\tpageY: event.pageY,\n\t\t\t});\n\n\t\t\tif (this.dragState.ghostElement)\n\t\t\t{\n\t\t\t\tDom.style(this.dragState.ghostElement, 'left', `${event.clientX - this.dragState.offsetX}px`);\n\t\t\t\tDom.style(this.dragState.ghostElement, 'top', `${event.clientY - this.dragState.offsetY}px`);\n\t\t\t}\n\n\t\t\tlet potentialTarget = null;\n\t\t\tif (this.isHeadListPotentialTarget && this.isPointerOverElement(event, this.$refs.headList?.$el))\n\t\t\t{\n\t\t\t\tpotentialTarget = 'head';\n\t\t\t}\n\t\t\telse if (this.isEmployeeListPotentialTarget && this.isPointerOverElement(event, this.$refs.employeeList?.$el))\n\t\t\t{\n\t\t\t\tpotentialTarget = 'employee';\n\t\t\t}\n\t\t\tthis.dragState.targetList = potentialTarget;\n\n\t\t\tthis.handleAutoscrollOnDrag(event);\n\t\t},\n\t\thandleAutoscrollOnDrag(event: MouseEvent): void\n\t\t{\n\t\t\tif (!this.isHeadListPotentialTarget)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst scrollableContainer = this.$refs.scrollableContainer;\n\t\t\tif (!scrollableContainer)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst rect = scrollableContainer.getBoundingClientRect();\n\t\t\tconst mouseY = event.clientY;\n\n\t\t\tconst topTriggerZone = rect.top + AUTOSCROLL_AREA_SIZE;\n\n\t\t\tif (mouseY < topTriggerZone)\n\t\t\t{\n\t\t\t\tif (this.autoscrollIntervalId !== null)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst scrollSpeed = 10;\n\t\t\t\tthis.autoscrollIntervalId = setInterval(() => {\n\t\t\t\t\tscrollableContainer.scrollTop -= scrollSpeed;\n\t\t\t\t}, 16);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.stopAutoscroll();\n\t\t\t}\n\t\t},\n\t\tstopAutoscroll(): void\n\t\t{\n\t\t\tif (this.autoscrollIntervalId !== null)\n\t\t\t{\n\t\t\t\tclearInterval(this.autoscrollIntervalId);\n\t\t\t\tthis.autoscrollIntervalId = null;\n\t\t\t}\n\t\t},\n\t\tisPointerOverElement(event: MouseEvent, element: HTMLElement): boolean\n\t\t{\n\t\t\tif (!element)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tconst rect = element.getBoundingClientRect();\n\n\t\t\treturn (\n\t\t\t\tevent.clientX >= rect.left && event.clientX <= rect.right\n\t\t\t\t&& event.clientY >= rect.top && event.clientY <= rect.bottom\n\t\t\t);\n\t\t},\n\t\tasync handleDragEnd(): void\n\t\t{\n\t\t\tif (!this.dragState.isDragging)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tEventEmitter.emit(events.HR_USER_DRAG_DROP);\n\t\t\tthis.stopAutoscroll();\n\n\t\t\tconst { userId, initialList, targetList, ghostElement, draggedElement } = this.dragState;\n\n\t\t\tconst isValidDrop = userId && targetList && targetList !== initialList;\n\t\t\tlet targetIndex = null;\n\t\t\tif (isValidDrop)\n\t\t\t{\n\t\t\t\tconst listRef = targetList === 'head' ? this.$refs.headList : this.$refs.employeeList;\n\t\t\t\ttargetIndex = listRef?.placeholderIndex;\n\t\t\t}\n\n\t\t\tEvent.unbind(document, 'mousemove', this.boundHandleDragMove);\n\t\t\tEvent.unbind(document, 'mouseup', this.boundHandleDragEnd);\n\t\t\tif (ghostElement)\n\t\t\t{\n\t\t\t\tDom.remove(ghostElement);\n\t\t\t}\n\n\t\t\tif (draggedElement)\n\t\t\t{\n\t\t\t\tDom.removeClass(draggedElement, '--dragging');\n\t\t\t\tDom.removeClass(draggedElement, '--hidden');\n\t\t\t}\n\t\t\tDom.removeClass(document.body, '--user-dragging');\n\n\t\t\tEventEmitter.emit(events.HR_USER_DRAG_END);\n\t\t\tif (!isValidDrop || targetIndex === null)\n\t\t\t{\n\t\t\t\tthis.dragState = this.getInitialDragState();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.dragState.isDragging = false;\n\t\t\tthis.dragState.ghostElement = null;\n\t\t\tthis.dragState.draggedElement = null;\n\t\t\tthis.dragState.context = { targetIndex };\n\n\t\t\tthis.dndPreviousState = this.moveDndUser();\n\t\t\tif (!this.dndPreviousState)\n\t\t\t{\n\t\t\t\tthis.dragState = this.getInitialDragState();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { context } = this.dragState;\n\t\t\tcontext.selectedRole = null;\n\t\t\tcontext.selectedRoleLabel = '';\n\n\t\t\tif (targetList === 'head')\n\t\t\t{\n\t\t\t\tcontext.selectedRole = this.memberRoles.head;\n\t\t\t\tcontext.selectedRoleLabel = this.loc(\n\t\t\t\t\t'HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPLOYEES_HEAD_BADGE',\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tawait this.prepareDndPopupDescription();\n\t\t\tthis.showDndConfirmationPopup = true;\n\t\t},\n\t\tcancelDndUserMove(): void\n\t\t{\n\t\t\tconst { heads, employees } = this.dndPreviousState;\n\t\t\tDepartmentContentActions.updateHeads(this.focusedNode, heads);\n\t\t\tDepartmentContentActions.updateEmployees(this.focusedNode, employees);\n\n\t\t\tthis.dndPreviousState = null;\n\t\t\tthis.dragState = this.getInitialDragState();\n\t\t\tthis.showDndConfirmationPopup = false;\n\t\t},\n\t\tasync confirmDndUserMove(payload): Promise<void>\n\t\t{\n\t\t\tconst { userId } = this.dragState;\n\t\t\tconst targetRole = payload.role || this.memberRoles.employee;\n\n\t\t\tconst department = this.departments.get(this.focusedNode);\n\t\t\tconst user = department.heads.find((u) => u.id === userId) || department.employees.find((u) => u.id === userId);\n\n\t\t\tif (!user)\n\t\t\t{\n\t\t\t\tthis.dragState = this.getInitialDragState();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst previousRole = user.role;\n\t\t\tuser.role = targetRole;\n\n\t\t\ttry\n\t\t\t{\n\t\t\t\tawait UserManagementDialogAPI.addUsersToDepartment(this.focusedNode, [userId], targetRole);\n\n\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\tcontent: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_DND_SUCCESS'),\n\t\t\t\t\tautoHideDelay: 3000,\n\t\t\t\t});\n\t\t\t}\n\t\t\tcatch (error)\n\t\t\t{\n\t\t\t\tconsole.error(error);\n\t\t\t\tuser.role = previousRole;\n\t\t\t\tthis.cancelDndUserMove();\n\t\t\t}\n\n\t\t\tthis.showDndConfirmationPopup = false;\n\t\t\tthis.dragState = this.getInitialDragState();\n\t\t},\n\t\tasync prepareDndPopupDescription(): Promise<string>\n\t\t{\n\t\t\tconst { userId, targetList } = this.dragState;\n\n\t\t\tconst toHead = targetList === 'head';\n\t\t\tconst isTeam = this.isTeamEntity;\n\t\t\tconst department = this.departments.get(this.departmentId);\n\t\t\tconst departmentName = Text.encode(department?.name ?? '');\n\n\t\t\tlet user = null;\n\t\t\ttry\n\t\t\t{\n\t\t\t\tuser = await DepartmentAPI.getUserInfo(this.departmentId, userId);\n\t\t\t}\n\t\t\tcatch\n\t\t\t{ /* empty */ }\n\n\t\t\tconst userName = Text.encode(user?.name ?? '');\n\t\t\tconst userUrl = user?.url ?? '#';\n\t\t\tlet phraseCode = '';\n\n\t\t\tif (toHead)\n\t\t\t{\n\t\t\t\tphraseCode = isTeam\n\t\t\t\t\t? 'HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_DND_POPUP_CONFIRM_DESC_TO_TEAM_HEAD'\n\t\t\t\t\t: 'HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_DND_POPUP_CONFIRM_DESC_TO_HEAD';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst basePhrase = isTeam\n\t\t\t\t\t? 'HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_DND_POPUP_CONFIRM_DESC_TEAM'\n\t\t\t\t\t: 'HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_DND_POPUP_CONFIRM_DESC';\n\n\t\t\t\tconst genderSuffix = user?.gender === 'F' ? '_F' : '_M';\n\t\t\t\tphraseCode = basePhrase + genderSuffix;\n\t\t\t}\n\n\t\t\tthis.dndPopupDescription = this.loc(phraseCode, {\n\t\t\t\t'#USER_NAME#': userName,\n\t\t\t\t'#DEPARTMENT_NAME#': departmentName,\n\t\t\t})\n\t\t\t\t.replace(\n\t\t\t\t\t'[link]',\n\t\t\t\t\t`<a class=\"hr-department-detail-content__move-user-department-user-link\" href=\"${userUrl}\">`,\n\t\t\t\t)\n\t\t\t\t.replace('[/link]', '</a>');\n\t\t},\n\t\tmoveDndUser(): Object | null\n\t\t{\n\t\t\tconst { userId, targetList, context } = this.dragState;\n\t\t\tconst { targetIndex } = context;\n\t\t\tconst department = this.departments.get(this.focusedNode);\n\t\t\tif (!department)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst previousState = { heads: [...department.heads], employees: [...department.employees] };\n\t\t\tconst isMovingToHeads = targetList === 'head';\n\t\t\tconst sourceList = isMovingToHeads ? [...previousState.employees] : [...previousState.heads];\n\t\t\tconst targetListForMove = isMovingToHeads ? [...previousState.heads] : [...previousState.employees];\n\n\t\t\tconst userIndex = sourceList.findIndex((user) => user.id === userId);\n\t\t\tif (userIndex === -1)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst [userToMove] = sourceList.splice(userIndex, 1);\n\t\t\ttargetListForMove.splice(targetIndex, 0, userToMove);\n\n\t\t\tif (isMovingToHeads)\n\t\t\t{\n\t\t\t\tDepartmentContentActions.updateHeads(this.focusedNode, targetListForMove);\n\t\t\t\tDepartmentContentActions.updateEmployees(this.focusedNode, sourceList);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDepartmentContentActions.updateHeads(this.focusedNode, sourceList);\n\t\t\t\tDepartmentContentActions.updateEmployees(this.focusedNode, targetListForMove);\n\t\t\t}\n\n\t\t\treturn previousState;\n\t\t},\n\t\tgetInitialDragState(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\tisDragging: false,\n\t\t\t\tuserId: null,\n\t\t\t\tinitialList: null,\n\t\t\t\ttargetList: null,\n\t\t\t\tghostElement: null,\n\t\t\t\tdraggedElement: null,\n\t\t\t\toffsetX: 0,\n\t\t\t\toffsetY: 0,\n\t\t\t\tcontext: null,\n\t\t\t};\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"hr-department-detail-content__tab-container --users\" ref=\"tab-container\">\n\t\t\t<template v-if=\"memberCount > 0\">\n\t\t\t\t<SearchInput\n\t\t\t\t\tv-if=\"showSearchBar\"\n\t\t\t\t\t:placeholder=\"loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_SEARCH_PLACEHOLDER')\"\n\t\t\t\t\t:value=\"searchQuery\"\n\t\t\t\t\t@inputChange=\"searchUser\"\n\t\t\t\t\tdataTestId=\"hr-department-detail-content_users-tab__users-search-input\"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"!showSearchEmptyState\"\n\t\t\t\t\tv-on=\"shouldUpdateList ? { scroll: updateList } : {}\"\n\t\t\t\t\tclass=\"hr-department-detail-content__lists-container\"\n\t\t\t\t\tref=\"scrollableContainer\"\n\t\t\t\t>\n\t\t\t\t\t<TabList\n\t\t\t\t\t\tref=\"headList\"\n\t\t\t\t\t\tid='hr-department-detail-content_chats-tab__chat-list'\n\t\t\t\t\t\t:title=\"headListTitle\"\n\t\t\t\t\t\t:count=\"headCount\"\n\t\t\t\t\t\t:menuItems=\"headMenu.items\"\n\t\t\t\t\t\t:listItems=\"filteredHeads\"\n\t\t\t\t\t\tlistType=\"head\"\n\t\t\t\t\t\t:emptyItemTitle=\"headListEmptyStateTitle\"\n\t\t\t\t\t\temptyItemImageClass=\"hr-department-detail-content__empty-user-list-item-image\"\n\t\t\t\t\t\t:hideEmptyItem=\"searchQuery.length > 0\"\n\t\t\t\t\t\t:withAddPermission=\"canAddUsers\"\n\t\t\t\t\t\t@tabListAction=\"onHeadListActionMenuItemClick\"\n\t\t\t\t\t\t:dataTestIds=\"getHeadListDataTestIds()\"\n\t\t\t\t\t\t:isDropTarget=\"isHeadListPotentialTarget && dragState.targetList === 'head'\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<template v-slot=\"{ item }\">\n\t\t\t\t\t\t\t<UserListItem\n\t\t\t\t\t\t\t\t:user=\"item\"\n\t\t\t\t\t\t\t\tlistType=\"head\"\n\t\t\t\t\t\t\t\t:selectedUserId=\"selectedUserId\"\n\t\t\t\t\t\t\t\t:entityType=\"entityType\"\n\t\t\t\t\t\t\t\t:canDrag=\"canAddUsers\"\n\t\t\t\t\t\t\t\t@itemDragStart=\"handleItemDragStart\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</TabList>\n\t\t\t\t\t<TabList\n\t\t\t\t\t\tref=\"employeeList\"\n\t\t\t\t\t\tid='hr-department-detail-content_chats-tab__channel-list'\n\t\t\t\t\t\t:title=\"employeeTitle\"\n\t\t\t\t\t\t:count=\"employeeCount\"\n\t\t\t\t\t\tlistType=\"employees\"\n\t\t\t\t\t\t:menuItems=\"employeeMenu.items\"\n\t\t\t\t\t\t:listItems=\"filteredEmployees\"\n\t\t\t\t\t\t:emptyItemTitle=\"employeesListEmptyStateTitle\"\n\t\t\t\t\t\temptyItemImageClass=\"hr-department-detail-content__empty-user-list-item-image\"\n\t\t\t\t\t\t:hideEmptyItem=\"searchQuery.length > 0\"\n\t\t\t\t\t\t:withAddPermission=\"canAddUsers\"\n\t\t\t\t\t\t@tabListAction=\"onEmployeeListActionMenuItemClick\"\n\t\t\t\t\t\t:dataTestIds=\"getEmployeeListDataTestIds()\"\n\t\t\t\t\t\t:isDropTarget=\"isEmployeeListPotentialTarget && dragState.targetList === 'employee'\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<template v-slot=\"{ item }\">\n\t\t\t\t\t\t\t<UserListItem\n\t\t\t\t\t\t\t\t:user=\"item\"\n\t\t\t\t\t\t\t\tlistType=\"employees\"\n\t\t\t\t\t\t\t\t:canDrag=\"canAddUsers\"\n\t\t\t\t\t\t\t\t@itemDragStart=\"handleItemDragStart\"\n\t\t\t\t\t\t\t\t:selectedUserId=\"selectedUserId\"\n\t\t\t\t\t\t\t\t:entityType=\"entityType\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</TabList>\n\t\t\t\t</div>\n\t\t\t\t<EmptyState v-else\n\t\t\t\t\timageClass=\"hr-department-detail-content__empty-tab-user-not-found-icon\"\n\t\t\t\t\t:title=\"loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_SEARCHED_EMPLOYEES_TITLE')\"\n\t\t\t\t\t:description =\"loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_SEARCHED_EMPLOYEES_SUBTITLE')\"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<EmptyState v-else\n\t\t\t\t:imageClass=\"canAddUsers \n\t\t\t\t\t? 'hr-department-detail-content__empty-tab-add-user-icon' \n\t\t\t\t\t: 'hr-department-detail-content__empty-tab-cant-add-user-icon'\"\n\t\t\t\t:title=\"emptyStateTitle\"\n\t\t\t\t:description =\"emptyStateDescription\"\n\t\t\t>\n\t\t\t\t<template v-slot:content>\n\t\t\t\t\t<EmptyTabAddButton v-if=\"canAddUsers\" :departmentId=\"departmentId\" :entityType=\"entityType\"/>\n\t\t\t\t</template>\n\t\t\t</EmptyState>\n\t\t\t<MoveEmployeeConfirmationPopup \n\t\t\t\tv-if=\"showDndConfirmationPopup\" \n\t\t\t\t:title=\"dndConfirmationPopupTitle\"\n\t\t\t\t:description=\"dndPopupDescription\"\n\t\t\t\t:confirmButtonText=\"dndConfirmationPopupBtn\"\n\t\t\t\t:showRoleSelect=\"showDndRoleSelect\"\n\t\t\t\t:excludeEmployeeRole=\"true\"\n\t\t\t\t:entityType=\"entityType\"\n\t\t\t\t@confirm=\"confirmDndUserMove\"\n\t\t\t\t@close=\"cancelDndUserMove\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { RouteActionMenu } from 'humanresources.company-structure.structure-components';\n\nconst MenuOption = Object.freeze({\n\twithChildren: 'withChildren',\n\twithoutChildren: 'withoutChildren',\n});\n\n// @vue/component\nexport const ChildrenModeSelector = {\n\tname: 'childrenModeSelector',\n\n\tcomponents: { RouteActionMenu },\n\n\tprops:\n\t{\n\t\tisTeamEntity: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tdataTestId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\thasPermission: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\ttext: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\temits: ['saveChildrenMode'],\n\n\tdata(): { menuVisible: boolean; withChildren: boolean }\n\t{\n\t\treturn {\n\t\t\tmenuVisible: false,\n\t\t\twithChildren: false,\n\t\t};\n\t},\n\n\tcomputed:\n\t{\n\t\tgetControlButtonText(): string\n\t\t{\n\t\t\treturn this.getValueText(this.withChildren);\n\t\t},\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.menuItems = this.getMenuItems();\n\t},\n\n\tmethods:\n\t{\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tshowMenu(): void\n\t\t{\n\t\t\tif (this.hasPermission)\n\t\t\t{\n\t\t\t\tthis.menuVisible = true;\n\t\t\t}\n\t\t},\n\t\tonActionMenuItemClick(actionId: number): void\n\t\t{\n\t\t\tif (this.hasPermission)\n\t\t\t{\n\t\t\t\tthis.withChildren = actionId === MenuOption.withChildren;\n\t\t\t\tthis.$emit('saveChildrenMode', this.withChildren);\n\t\t\t}\n\t\t},\n\t\tgetMenuItems(): Array\n\t\t{\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\tid: MenuOption.withoutChildren,\n\t\t\t\t\ttitle: this.getValueText(false),\n\t\t\t\t\titemClass: 'hr-department-detail-content__children-mode-selector_menu-item',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: MenuOption.withChildren,\n\t\t\t\t\ttitle: this.getValueText(true),\n\t\t\t\t\titemClass: 'hr-department-detail-content__children-mode-selector_menu-item',\n\t\t\t\t},\n\t\t\t];\n\t\t},\n\t\tgetValueText(value: boolean): string\n\t\t{\n\t\t\tif (this.isTeamEntity)\n\t\t\t{\n\t\t\t\treturn value\n\t\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_WITH_SUBTEAMS_LABEL')\n\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_ONLY_TEAM_LABEL')\n\t\t\t\t;\n\t\t\t}\n\n\t\t\treturn value\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_WITH_SUBDEPARTMENTS_LABEL')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_ONLY_DEPARTMENT_LABEL')\n\t\t\t;\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"hr-department-detail-content__change-save-mode-control-container\">\n\t\t\t<span>{{ text }}</span>\n\t\t\t<a\n\t\t\t\tclass=\"hr-department-detail-content__change-save-mode-control-button\"\n\t\t\t\t:class=\"{ '--focused': menuVisible, '--disabled': !hasPermission }\"\n\t\t\t\t:data-test-id=\"dataTestId\"\n\t\t\t\tref='saveChildrenModeButton'\n\t\t\t\t@click=\"showMenu\"\n\t\t\t>\n\t\t\t\t{{ getControlButtonText }}\n\t\t\t</a>\n\t\t</div>\n\t\t<RouteActionMenu\n\t\t\tv-if=\"menuVisible\"\n\t\t\t:id=\"'hr-department-detail-children-mode-selector-menu'\"\n\t\t\t:items=\"menuItems\"\n\t\t\t:delimiter=\"false\"\n\t\t\t:width=\"302\"\n\t\t\t:bindElement=\"$refs.saveChildrenModeButton\"\n\t\t\t@action=\"onActionMenuItemClick\"\n\t\t\t@close=\"menuVisible = false\"\n\t\t/>\n\t`,\n};\n","import { Main } from 'ui.icon-set.api.core';\nimport { Loc } from 'main.core';\n\nexport const ChatsMenuOption = Object.freeze({\n\tlinkChat: 'linkChat',\n\tlinkChannel: 'linkChannel',\n});\n\nexport const ChatsMenuLinkChat = Object.freeze({\n\tid: ChatsMenuOption.linkChat,\n\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_LIST_LINK_BUTTON_TITLE'),\n\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_LIST_LINK_BUTTON_DESC'),\n\tbIcon: {\n\t\tname: Main.CHAT_MESSAGE,\n\t\tsize: 20,\n\t\tcolorTokenName: 'paletteBlue50',\n\t},\n\tdataTestId: 'hr-department-content_chats-tab__chat-list-action-link',\n});\n\nexport const ChatsMenuLinkChannel = Object.freeze({\n\tid: ChatsMenuOption.linkChannel,\n\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_LIST_LINK_BUTTON_TITLE'),\n\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_LIST_LINK_BUTTON_DESC'),\n\tbIcon: {\n\t\tname: Main.SPEAKER_MOUTHPIECE,\n\t\tsize: 20,\n\t\tcolorTokenName: 'paletteBlue50',\n\t},\n\tdataTestId: 'hr-department-content_chats-tab__channel-list-action-link',\n});\n\nexport const ChatListDataTestIds = Object.freeze({\n\tcontainerDataTestId: 'hr-department-content_chats-tab__chat-list-container',\n\tlistActionButtonDataTestId: 'hr-department-content_chats-tab__chat-list-action-button',\n\tlistActonMenuDataTestId: 'hr-department-content_chats-tab__chat-list-action-menu-container',\n\tlistCounterDataTestId: 'hr-department-content_chats-tab__chat-list-counter',\n});\n\nexport const ChannelListDataTestIds = Object.freeze({\n\tcontainerDataTestId: 'hr-department-content_chats-tab__channel-list-container',\n\tlistActionButtonDataTestId: 'hr-department-content_chats-tab__channel-list-action-button',\n\tlistActonMenuDataTestId: 'hr-department-content_chats-tab__channel-list-action-menu-container',\n\tlistCounterDataTestId: 'hr-department-content_chats-tab__channel-list-counter',\n});\n\nexport const ChatLinkDialogDataTestIds = Object.freeze({\n\tcontainerDataTestId: 'hr-department-content_chats-tab__link-chat-container',\n\tconfirmButtonDataTestId: 'hr-department-content_chats-tab__link-chat-confirm-button',\n\tcancelButtonDataTestId: 'hr-department-content_chats-tab__link-chat-cancel-button',\n\tcloseButtonDataTestId: 'hr-department-content_chats-tab__link-chat-close-button',\n\taddWithChildrenDataTestId: 'hr-department-content_chats-tab__link-chat-add-with-children',\n});\n\nexport const ChannelLinkDialogDataTestIds = Object.freeze({\n\tcontainerDataTestId: 'hr-department-content_chats-tab__link-channel-container',\n\tconfirmButtonDataTestId: 'hr-department-content_chats-tab__link-channel-confirm-button',\n\tcancelButtonDataTestId: 'hr-department-content_chats-tab__link-channel-cancel-button',\n\tcloseButtonDataTestId: 'hr-department-content_chats-tab__link-channel-close-button',\n\taddWithChildrenDataTestId: 'hr-department-content_chats-tab__link-channel-add-with-children',\n});\n","import { RouteActionMenu } from 'humanresources.company-structure.structure-components';\nimport './styles/empty-tab-add-buttons.css';\nimport { ChatsMenuOption } from './consts';\nimport 'ui.icon-set.main';\n\nexport const EmptyTabAddButtons = {\n\tname: 'emptyStateButtons',\n\temits: ['emptyStateAddAction'],\n\tcomponents: { RouteActionMenu },\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tchatMenuVisible: false,\n\t\t\tchannelMenuVisible: false,\n\t\t\tchatButtonId: 'hr-empty-tab-chat-add-button',\n\t\t\tchannelButtonId: 'hr-empty-tab-chat-add-button',\n\t\t};\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tonChatButtonClick(): void\n\t\t{\n\t\t\tthis.$emit('emptyStateAddAction', ChatsMenuOption.linkChat);\n\t\t},\n\t\tonChannelButtonClick(): void\n\t\t{\n\t\t\tthis.$emit('emptyStateAddAction', ChatsMenuOption.linkChannel);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"hr-department-detail-content__chat-empty-tab-add_buttons-container\">\n\t\t\t<button\n\t\t\t\t:ref=\"chatButtonId\"\n\t\t\t\tclass=\"ui-btn ui-btn-light-border ui-btn-no-caps ui-btn-round ui-btn-sm hr-department-detail-content__chat-empty-tab-add_chat-button\"\n\t\t\t\t@click.stop=\"this.onChatButtonClick()\"\n\t\t\t\tdata-test-id=\"hr-department-detail-content_chats-tab__empty-tab-add_chat-button\"\n\t\t\t>\n\t\t\t\t<div class=\"ui-icon-set --chat-message hr-department-detail-content__chat-empty-tab-add_chat-button-icon\"/>\n\t\t\t\t<span>\n\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_CHAT_BUTTON') }}\n\t\t\t\t</span>\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\t:ref=\"channelButtonId\"\n\t\t\t\tclass=\"ui-btn ui-btn-light-border ui-btn-no-caps ui-btn-round ui-btn-sm hr-department-detail-content__chat-empty-tab-add_channel-button\"\n\t\t\t\t@click.stop=\"onChannelButtonClick()\"\n\t\t\t\tdata-test-id=\"hr-department-detail-content_chats-tab__empty-tab-add_channel-button\"\n\t\t\t>\n\t\t\t\t<div class=\"ui-icon-set --speaker-mouthpiece hr-department-detail-content__chat-empty-tab-add_chat-button-icon\"/>\n\t\t\t\t<span>\n\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_CHANNEL_BUTTON') }}\n\t\t\t\t</span>\n\t\t\t</button>\n\t\t</div>\n\t`,\n};\n","import { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { ChatListActionMenu, MenuActions } from 'humanresources.company-structure.org-chart';\nimport { ConfirmationPopup, RouteActionMenu } from 'humanresources.company-structure.structure-components';\nimport { ChatTypes, EntityTypes } from 'humanresources.company-structure.utils';\nimport { UI } from 'ui.notification';\nimport { mapState } from 'ui.vue3.pinia';\nimport { DepartmentContentActions } from '../../actions';\nimport { DepartmentAPI } from '../../api';\nimport { Messenger } from 'im.public.iframe';\n\n// @vue/component\nexport const ChatListItemActionButton = {\n\tname: 'chatListItemActionButton',\n\n\tcomponents: {\n\t\tRouteActionMenu,\n\t\tConfirmationPopup,\n\t},\n\n\tprops: {\n\t\t/** @type ChatOrChannelDetailed */\n\t\tchat: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tnodeId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tmenuVisible: false,\n\t\t\tshowUnbindChatConfirmationPopup: false,\n\t\t\tunbindChatLoader: false,\n\t\t};\n\t},\n\n\tcomputed: {\n\t\tgetUnbindChatTitle(): string\n\t\t{\n\t\t\tconst entityType = this.isTeamEntity ? 'TEAM' : 'DEPARTMENT';\n\t\t\tconst chatType = this.isChat ? 'CHAT' : 'CHANNEL';\n\n\t\t\treturn this.loc(`HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_UNBIND_POPUP_${chatType}_FROM_${entityType}_TITLE`);\n\t\t},\n\t\tgetUnbindChatDescription(): string\n\t\t{\n\t\t\tconst entityType = this.isTeamEntity ? 'TEAM' : 'DEPARTMENT';\n\t\t\tconst chatType = this.isChat ? 'CHAT' : 'CHANNEL';\n\n\t\t\treturn this.loc(`HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_UNBIND_POPUP_${chatType}_FROM_${entityType}_DESCRIPTION`);\n\t\t},\n\t\tisTeamEntity(): boolean\n\t\t{\n\t\t\treturn this.departments.get(this.nodeId)?.entityType === EntityTypes.team;\n\t\t},\n\t\tisChat(): boolean\n\t\t{\n\t\t\treturn this.chat.type === ChatTypes.chat;\n\t\t},\n\t\tmenu(): ChatListActionMenu\n\t\t{\n\t\t\tconst entityType = this.departments.get(this.nodeId)?.entityType;\n\n\t\t\treturn new ChatListActionMenu(entityType, this.chat, this.nodeId);\n\t\t},\n\t\t...mapState(useChartStore, ['departments']),\n\t},\n\n\tmethods:\n\t{\n\t\ttoggleMenu(): void\n\t\t{\n\t\t\tthis.menuVisible = !this.menuVisible;\n\t\t},\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tonActionMenuItemClick(actionId: string): void\n\t\t{\n\t\t\tif (actionId === MenuActions.openChat)\n\t\t\t{\n\t\t\t\tMessenger.openChat(this.chat.dialogId);\n\t\t\t}\n\t\t\telse if (actionId === MenuActions.unbindChat)\n\t\t\t{\n\t\t\t\tthis.showUnbindChatConfirmationPopup = true;\n\t\t\t}\n\t\t},\n\t\tcancelUnbindChat(): void\n\t\t{\n\t\t\tthis.showUnbindChatConfirmationPopup = false;\n\t\t},\n\t\tasync unbindChat(): Promise<void>\n\t\t{\n\t\t\tthis.unbindChatLoader = true;\n\t\t\tconst entityType = this.isTeamEntity ? 'TEAM' : 'DEPARTMENT';\n\t\t\tconst chatType = this.isChat ? 'CHAT' : 'CHANNEL';\n\n\t\t\ttry\n\t\t\t{\n\t\t\t\tawait DepartmentAPI.updateChats(this.nodeId, [], [this.chat.id]);\n\t\t\t}\n\t\t\tcatch (error)\n\t\t\t{\n\t\t\t\tif (error.code !== 'STRUCTURE_ACCESS_DENIED')\n\t\t\t\t{\n\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: this.loc(`HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_UNBIND_POPUP_${chatType}_FROM_${entityType}_ERROR`),\n\t\t\t\t\t\tautoHideDelay: 2000,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfinally\n\t\t\t{\n\t\t\t\tthis.unbindChatLoader = false;\n\t\t\t\tthis.showUnbindChatConfirmationPopup = false;\n\t\t\t}\n\n\t\t\tDepartmentContentActions.unbindChatFromNode(this.nodeId, this.chat.id);\n\n\t\t\tconst isOwnChat = !this.chat.originalNodeId || this.chat.originalNodeId === this.nodeId;\n\n\t\t\tif (isOwnChat)\n\t\t\t{\n\t\t\t\tDepartmentContentActions.updateChatsInChildrenNodes(\n\t\t\t\t\tthis.nodeId,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tUI.Notification.Center.notify({\n\t\t\t\tcontent: this.loc(`HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_UNBIND_POPUP_${chatType}_FROM_${entityType}_SUCCESS`),\n\t\t\t\tautoHideDelay: 2000,\n\t\t\t});\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<button\n\t\t\tv-if=\"menu.items.length\"\n\t\t\tclass=\"ui-icon-set --more hr-department-detail-content__tab-list_item-action-btn --chat-item-action-btn ui-icon-set\"\n\t\t\t:class=\"{ '--focused': menuVisible }\"\n\t\t\t@click.stop=\"toggleMenu()\"\n\t\t\tref=\"actionChatButton\"\n\t\t\t:data-id=\"'hr-department-detail-content__'+ chat.type.toLowerCase() + '-list_chat-' + chat.id + '-action-btn'\"\n\t\t/>\n\t\t<RouteActionMenu\n\t\t\tv-if=\"menuVisible\"\n\t\t\t:id=\"'tree-node-department-menu-chat_' + this.nodeId + '_' + chat.id\"\n\t\t\t:items=\"menu.items\"\n\t\t\t:width=\"302\"\n\t\t\t:bindElement=\"$refs.actionChatButton\"\n\t\t\t@action=\"onActionMenuItemClick\"\n\t\t\t@close=\"menuVisible = false\"\n\t\t/>\n\t\t<ConfirmationPopup\n\t\t\tref=\"unbindChatConfirmationPopup\"\n\t\t\tv-if=\"showUnbindChatConfirmationPopup\"\n\t\t\t:showActionButtonLoader=\"unbindChatLoader\"\n\t\t\t:title=\"getUnbindChatTitle\"\n\t\t\t:confirmBtnText=\"loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_UNBIND_POPUP_CONFIRM_BUTTON')\"\n\t\t\tconfirmButtonClass=\"ui-btn-danger\"\n\t\t\t@action=\"unbindChat\"\n\t\t\t@close=\"cancelUnbindChat\"\n\t\t\t:width=\"364\"\n\t\t>\n\t\t\t<template v-slot:content>\n\t\t\t\t<div class=\"hr-department-detail-content__user-action-text-container\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-html=\"getUnbindChatDescription\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</ConfirmationPopup>\n\t`,\n};\n","import { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { events } from 'humanresources.company-structure.org-chart';\nimport { EventEmitter } from 'main.core.events';\nimport { AvatarRound, AvatarSquare } from 'ui.avatar';\nimport { Messenger } from 'im.public.iframe';\nimport { EntityTypes, getColorCode, ChatTypes } from 'humanresources.company-structure.utils';\nimport { mapState } from 'ui.vue3.pinia';\nimport { ChatListItemActionButton } from './action-button';\nimport { Hint, ResponsiveHint } from 'humanresources.company-structure.structure-components';\n\n// @vue/component\nexport const ChatListItem = {\n\tname: 'chatListItem',\n\n\tcomponents: { ChatListItemActionButton, ResponsiveHint },\n\n\tdirectives: { hint: Hint },\n\n\tprops: {\n\t\t/** @type ChatOrChannelDetailed */\n\t\tchat: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tnodeId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tavatar: null,\n\t\t};\n\t},\n\n\tcomputed: {\n\t\tisChat(): boolean\n\t\t{\n\t\t\treturn this.chat.type !== ChatTypes.channel;\n\t\t},\n\t\toriginalNodeName(): string\n\t\t{\n\t\t\treturn this.departments.get(this.chat.originalNodeId)?.name;\n\t\t},\n\t\thiddenNodeName(): string\n\t\t{\n\t\t\treturn this.structureMap.get(this.chat.originalNodeId)?.entityType === EntityTypes.team\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_HIDDEN_TEAM')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_HIDDEN_DEPARTMENT')\n\t\t\t;\n\t\t},\n\t\tindirectChatSubtitle(): string\n\t\t{\n\t\t\tif (this.structureMap.get(this.chat.originalNodeId)?.entityType === EntityTypes.team)\n\t\t\t{\n\t\t\t\treturn this.isChat\n\t\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_OF_TEAM')\n\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_OF_TEAM')\n\t\t\t\t;\n\t\t\t}\n\n\t\t\treturn this.isChat\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_OF_DEPARTMENT')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_OF_DEPARTMENT')\n\t\t\t;\n\t\t},\n\t\tlockHint(): string\n\t\t{\n\t\t\tif (!this.chat.hasAccess)\n\t\t\t{\n\t\t\t\treturn this.isChat\n\t\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_USER_HAS_NO_ACCESS_TO_CHAT_HINT')\n\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_USER_HAS_NO_ACCESS_TO_CHANNEL_HINT')\n\t\t\t\t;\n\t\t\t}\n\n\t\t\t// parent node is a team so child node must be a team too\n\t\t\tif (this.structureMap.get(this.chat.originalNodeId)?.entityType === EntityTypes.team)\n\t\t\t{\n\t\t\t\treturn this.isChat\n\t\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_PARENT_TEAM_CHAT_HINT')\n\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_PARENT_TEAM_CHANNEL_HINT')\n\t\t\t\t;\n\t\t\t}\n\n\t\t\t// parent node is a department so we check if child node is a department too\n\t\t\tif (this.structureMap.get(this.nodeId)?.entityType === EntityTypes.department)\n\t\t\t{\n\t\t\t\treturn this.isChat\n\t\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_PARENT_DEPARTMENT_CHAT_OF_DEPARTMENT_HINT')\n\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_PARENT_DEPARTMENT_CHANNEL_OF_DEPARTMENT_HINT')\n\t\t\t\t;\n\t\t\t}\n\n\t\t\t// parent node is a department but child node is a team\n\t\t\treturn this.isChat\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_PARENT_DEPARTMENT_CHAT_OF_TEAM_HINT')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_PARENT_DEPARTMENT_CHANNEL_OF_TEAM_HINT')\n\t\t\t;\n\t\t},\n\t\t...mapState(useChartStore, ['structureMap', 'departments']),\n\t},\n\n\twatch: {\n\t\tchat(): void\n\t\t{\n\t\t\tthis.prepareAvatar();\n\t\t},\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.prepareAvatar();\n\t},\n\n\tmethods: {\n\t\tprepareAvatar(): void\n\t\t{\n\t\t\tif (this.chat.avatar)\n\t\t\t{\n\t\t\t\tthis.chat.color = getColorCode('whiteBase');\n\t\t\t}\n\n\t\t\tconst avatarOptions = {\n\t\t\t\tsize: 32,\n\t\t\t\tuserName: this.chat.title,\n\t\t\t\tbaseColor: this.isExtranet() && !this.chat.avatar ? getColorCode('extranetColor') : this.chat.color,\n\t\t\t\tevents: {\n\t\t\t\t\tclick: () => {\n\t\t\t\t\t\tthis.onChatItemClick();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tif (this.chat.avatar)\n\t\t\t{\n\t\t\t\tavatarOptions.userpicPath = this.chat.avatar;\n\t\t\t}\n\n\t\t\tthis.avatar = this.isChat ? new AvatarRound(avatarOptions) : new AvatarSquare(avatarOptions);\n\t\t},\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tonChatItemClick(): void\n\t\t{\n\t\t\tif (this.chat.hasAccess)\n\t\t\t{\n\t\t\t\tMessenger.openChat(this.chat.dialogId);\n\t\t\t}\n\t\t},\n\t\tisExtranet(): boolean\n\t\t{\n\t\t\treturn this.chat.isExtranet;\n\t\t},\n\t\tlocateToOriginalDepartment(): void\n\t\t{\n\t\t\tEventEmitter.emit(events.HR_ORG_CHART_LOCATE_TO_DEPARTMENT, { nodeId: this.chat.originalNodeId });\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\t:key=\"chat.id\"\n\t\t\tclass=\"hr-department-detail-content__tab-list_item-wrapper --chat\"\n\t\t\t:class=\"{ '--isExtranet': isExtranet() }\"\n\t\t\t:data-test-id=\"'hr-department-content_chats-tab__list_chat-item-' + chat.id\"\n\t\t>\n\t\t\t<div\n\t\t\t\tclass=\"hr-department-detail-content__tab-list_item-avatar-container\"\n\t\t\t\t:class=\"{ '--not-clickable': !chat.hasAccess }\"\n\t\t\t\tv-html=\"this.avatar.getContainer().outerHTML\"\n\t\t\t\t@click=\"onChatItemClick\"\n\t\t\t/>\n\t\t\t<div class=\"hr-department-detail-content__tab-list_item-text-container\">\n\t\t\t\t<div class=\"hr-department-detail-content__tab-list_item-title-container --chat-item\">\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass=\"hr-department-detail-content__tab-list_item-title\"\n\t\t\t\t\t\t:class=\"{ '--not-clickable': !chat.hasAccess }\"\n\t\t\t\t\t\t:data-test-id=\"'hr-department-content_chats-tab__list_chat-item-' + chat.id + '-title'\"\n\t\t\t\t\t\t@click=\"onChatItemClick\"\n\t\t\t\t\t>{{ chat.title }}</span>\n\t\t\t\t\t<ResponsiveHint \n\t\t\t\t\t\tv-if=\"!chat.hasAccess || chat.originalNodeId\" \n\t\t\t\t\t\t:content=\"lockHint\" \n\t\t\t\t\t\t:extraClasses=\"{ 'hr-department-detail-content__tab-list_hint-container': true }\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span class=\"ui-icon-set --lock hr-department-detail-content__tab-list_lock-icon\"></span>\n\t\t\t\t\t</ResponsiveHint>\n\t\t\t\t</div>\n\t\t\t\t<div v-if=\"chat.originalNodeId && originalNodeName\" class=\"hr-department-detail-content__tab-list_item-subtitle --chat-item\">\n\t\t\t\t\t{{ indirectChatSubtitle }}\n\t\t\t\t\t<ResponsiveHint \n\t\t\t\t\t\t:content=\"originalNodeName\" \n\t\t\t\t\t\tdefaultClass=\"hr-department-detail-content__tab-list_orig-node-name\"\n\t\t\t\t\t\t:checkScrollWidth=\"true\"\n\t\t\t\t\t\t:width=\"null\"\n\t\t\t\t\t\t@click=\"locateToOriginalDepartment\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ originalNodeName }}\n\t\t\t\t\t</ResponsiveHint>\n\t\t\t\t</div>\n\t\t\t\t<div v-else-if=\"chat.originalNodeId\" class=\"hr-department-detail-content__tab-list_item-subtitle --chat-item\">\n\t\t\t\t\t{{ indirectChatSubtitle }}\n\t\t\t\t\t<span class=\"hr-department-detail-content__tab-list_orig-node-hidden-name\">\n\t\t\t\t\t\t{{ hiddenNodeName }}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div v-else class=\"hr-department-detail-content__tab-list_item-subtitle\">\n\t\t\t\t\t{{ chat.subtitle }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<ChatListItemActionButton\n\t\t\t\t:chat=\"chat\"\n\t\t\t\t:nodeId=\"nodeId\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import {\n\tPermissionActions,\n\tPermissionChecker,\n\tPermissionLevels,\n} from 'humanresources.company-structure.permission-checker';\nimport { EntityTypes, type ChatListResponse } from 'humanresources.company-structure.utils';\nimport { DepartmentContentActions } from '../../actions';\nimport { DepartmentAPI } from '../../api';\nimport { SearchInput } from '../base-components/search/search-input';\nimport { TabList } from '../base-components/list/list';\nimport { EmptyState } from '../base-components/empty-state/empty-state';\nimport { ChildrenModeSelector } from './children-mode-selector';\nimport { EmptyTabAddButtons } from './empty-tab-add-buttons';\nimport { ChatListItem } from './list-item';\nimport {\n\tChatsMenuOption,\n\tChatsMenuLinkChat,\n\tChatsMenuLinkChannel,\n\tChatListDataTestIds,\n\tChannelListDataTestIds,\n\tChatLinkDialogDataTestIds,\n\tChannelLinkDialogDataTestIds,\n} from './consts';\nimport {\n\tgetChatDialogEntity,\n\tgetChannelDialogEntity,\n\tCommunicationsTypeDict,\n\tgetCommunicationsRecentTabOptions,\n\tManagementDialog,\n\ttype ManagementDialogDataTestIds,\n} from 'humanresources.company-structure.structure-components';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { mapState } from 'ui.vue3.pinia';\nimport { Loc, Type } from 'main.core';\nimport type { TabOptions } from 'ui.entity-selector';\nimport type { ChatOrChannelDetailed } from 'humanresources.company-structure.utils';\n\nimport './styles/tab.css';\n\nexport const ChatsTab = {\n\tname: 'chatsTab',\n\n\tcomponents: {\n\t\tSearchInput,\n\t\tTabList,\n\t\tEmptyState,\n\t\tEmptyTabAddButtons,\n\t\tChatListItem,\n\t\tManagementDialog,\n\t\tChildrenModeSelector,\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tisChatLinkActive: false,\n\t\t\tchatLinkDialogVisible: false,\n\t\t\tisChannelLinkActive: false,\n\t\t\tchannelLinkDialogVisible: false,\n\t\t\tisLoading: false,\n\t\t\tsearchQuery: '',\n\t\t\taddChatsWithChildren: false,\n\t\t\taddChannelsWithChildren: false,\n\t\t};\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.loadChatAction();\n\t},\n\n\tmethods:\n\t{\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tlocPlural(phraseCode: string, count: number): string\n\t\t{\n\t\t\treturn Loc.getMessagePlural(phraseCode, count, { '#COUNT#': count });\n\t\t},\n\t\tsearchChatOrChannel(searchQuery: string): void\n\t\t{\n\t\t\tthis.searchQuery = searchQuery;\n\t\t},\n\t\tasync loadChatAction(force: boolean): ?Promise<ChatListResponse>\n\t\t{\n\t\t\tif (this.isLoading)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst nodeId = this.focusedNode;\n\t\t\tconst department = this.departments.get(nodeId);\n\n\t\t\tif (!department)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (!force && Type.isArray(department.chatsDetailed) && Type.isArray(department.channelsDetailed))\n\t\t\t{\n\t\t\t\treturn {\n\t\t\t\t\tchats: department.chatsDetailed,\n\t\t\t\t\tchannels: department.channelsDetailed,\n\t\t\t\t\tchatsNoAccess: department.chatsNoAccess,\n\t\t\t\t\tchannelsNoAccess: department.channelsNoAccess,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tthis.isLoading = true;\n\n\t\t\tthis.$emit('showDetailLoader');\n\t\t\tconst loadedChatsAndChannels = await DepartmentAPI.getChatsAndChannels(nodeId);\n\t\t\tDepartmentContentActions.setChatsAndChannels(\n\t\t\t\tnodeId,\n\t\t\t\tloadedChatsAndChannels.chats ?? [],\n\t\t\t\tloadedChatsAndChannels.channels ?? [],\n\t\t\t\tloadedChatsAndChannels.chatsNoAccess ?? 0,\n\t\t\t\tloadedChatsAndChannels.channelsNoAccess ?? 0,\n\t\t\t);\n\t\t\tthis.$emit('hideDetailLoader');\n\t\t\tthis.isLoading = false;\n\n\t\t\treturn loadedChatsAndChannels;\n\t\t},\n\t\tgetChatListMenuItems(): Array\n\t\t{\n\t\t\treturn this.canEdit ? [ChatsMenuLinkChat] : [];\n\t\t},\n\t\tgetChannelListMenuItems(): Array\n\t\t{\n\t\t\treturn this.canEdit ? [ChatsMenuLinkChannel] : [];\n\t\t},\n\t\tonActionMenuItemClick(actionId: string): void\n\t\t{\n\t\t\tif (actionId === ChatsMenuOption.linkChat)\n\t\t\t{\n\t\t\t\tthis.chatLinkDialogVisible = true;\n\t\t\t}\n\n\t\t\tif (actionId === ChatsMenuOption.linkChannel)\n\t\t\t{\n\t\t\t\tthis.channelLinkDialogVisible = true;\n\t\t\t}\n\t\t},\n\t\tgetAddEmptyStateList(): { text: string }[]\n\t\t{\n\t\t\tlet stateArray = [];\n\n\t\t\tif (this.isTeamEntity)\n\t\t\t{\n\t\t\t\tstateArray = [\n\t\t\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_TEAM_LIST_ITEM_1_MSGVER_1'),\n\t\t\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_LIST_ITEM_2'),\n\t\t\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_TEAM_LIST_ITEM_3'),\n\t\t\t\t];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tstateArray = [\n\t\t\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_LIST_ITEM_1_MSGVER_1'),\n\t\t\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_LIST_ITEM_2'),\n\t\t\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_LIST_ITEM_3'),\n\t\t\t\t];\n\t\t\t}\n\n\t\t\treturn stateArray.map((item) => ({ text: item }));\n\t\t},\n\t\tgetChatListDataTestIds(): Object\n\t\t{\n\t\t\treturn ChatListDataTestIds;\n\t\t},\n\t\tgetChannelListDataTestIds(): Object\n\t\t{\n\t\t\treturn ChannelListDataTestIds;\n\t\t},\n\t\tgetChatLinkDialogEntities(): Array\n\t\t{\n\t\t\tconst entity = getChatDialogEntity();\n\t\t\tentity.options.excludeIds = this.chats.map((item) => item.id);\n\n\t\t\treturn [entity];\n\t\t},\n\t\tgetChannelLinkDialogEntities(): Array\n\t\t{\n\t\t\tconst entity = getChannelDialogEntity();\n\t\t\tentity.options.excludeIds = this.channels.map((item) => item.id);\n\n\t\t\treturn [entity];\n\t\t},\n\t\tgetChatLinkRecentTabOptions(): TabOptions\n\t\t{\n\t\t\treturn getCommunicationsRecentTabOptions(this.teamEntity, CommunicationsTypeDict.chat);\n\t\t},\n\t\tgetChannelLinkRecentTabOptions(): TabOptions\n\t\t{\n\t\t\treturn getCommunicationsRecentTabOptions(this.teamEntity, CommunicationsTypeDict.channel);\n\t\t},\n\t\tasync linkChats(chatsItems: Array): void\n\t\t{\n\t\t\tthis.isChatLinkActive = true;\n\t\t\tconst chats = (chatsItems).map((chatItem) => Number(chatItem.id.replace('chat', '')));\n\t\t\tconst nodeId = this.focusedNode;\n\t\t\tconst ids = { chat: chats, withChildren: this.addChatsWithChildren };\n\t\t\ttry\n\t\t\t{\n\t\t\t\tawait DepartmentAPI.saveChats(nodeId, ids);\n\t\t\t\tconst loadedChatsAndChannels = await this.loadChatAction(true);\n\n\t\t\t\tif (this.addChatsWithChildren && loadedChatsAndChannels)\n\t\t\t\t{\n\t\t\t\t\tconst newChats = loadedChatsAndChannels.chats.filter((chat) => chats.includes(chat.id));\n\n\t\t\t\t\tif (newChats.length > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tDepartmentContentActions.updateChatsInChildrenNodes(nodeId);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tcatch\n\t\t\t{ /* empty */ }\n\t\t\tthis.isChatLinkActive = false;\n\t\t\tthis.chatLinkDialogVisible = false;\n\t\t\tthis.addChatsWithChildren = false;\n\t\t},\n\t\tasync linkChannel(chatsItems: Array): void\n\t\t{\n\t\t\tthis.isChannelLinkActive = true;\n\t\t\tconst channels = (chatsItems).map((chatItem) => Number(chatItem.id.replace('chat', '')));\n\t\t\tconst nodeId = this.focusedNode;\n\t\t\tconst ids = { channel: channels, withChildren: this.addChannelsWithChildren };\n\t\t\ttry\n\t\t\t{\n\t\t\t\tawait DepartmentAPI.saveChats(nodeId, ids);\n\t\t\t\tconst loadedChatsAndChannels = await this.loadChatAction(true);\n\n\t\t\t\tif (this.addChannelsWithChildren && loadedChatsAndChannels)\n\t\t\t\t{\n\t\t\t\t\tconst newChannels = loadedChatsAndChannels.channels.filter((channel) => channels.includes(channel.id));\n\n\t\t\t\t\tif (newChannels.length > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tDepartmentContentActions.updateChatsInChildrenNodes(\n\t\t\t\t\t\t\tnodeId,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tcatch\n\t\t\t{ /* empty */ }\n\t\t\tthis.isChannelLinkActive = false;\n\t\t\tthis.channelLinkDialogVisible = false;\n\t\t\tthis.addChannelsWithChildren = false;\n\t\t},\n\t\tgetChatLinkDialogDataTestIds(): { ...ManagementDialogDataTestIds, addWithChildrenDataTestId: string }\n\t\t{\n\t\t\treturn ChatLinkDialogDataTestIds;\n\t\t},\n\t\tgetChannelLinkDialogDataTestIds(): { ...ManagementDialogDataTestIds, addWithChildrenDataTestId: string }\n\t\t{\n\t\t\treturn ChannelLinkDialogDataTestIds;\n\t\t},\n\t},\n\n\tcomputed:\n\t{\n\t\tchats(): Array<ChatOrChannelDetailed>\n\t\t{\n\t\t\treturn this.departments.get(this.focusedNode)?.chatsDetailed ?? [];\n\t\t},\n\t\tchannels(): Array<ChatOrChannelDetailed>\n\t\t{\n\t\t\treturn this.departments.get(this.focusedNode)?.channelsDetailed ?? [];\n\t\t},\n\t\tchatsNoAccess(): number\n\t\t{\n\t\t\treturn this.departments.get(this.focusedNode)?.chatsNoAccess ?? 0;\n\t\t},\n\t\tchannelsNoAccess(): number\n\t\t{\n\t\t\treturn this.departments.get(this.focusedNode)?.channelsNoAccess ?? 0;\n\t\t},\n\t\tchatsNoAccessText(): string\n\t\t{\n\t\t\tconst phrase = this.chats.length > 0\n\t\t\t\t? 'HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_CHAT_LIST_ITEM_MORE_HIDDEN_TEXT'\n\t\t\t\t: 'HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_CHAT_LIST_ITEM_EMPTY_HIDDEN_TEXT'\n\t\t\t;\n\n\t\t\treturn this.locPlural(phrase, this.chatsNoAccess);\n\t\t},\n\t\tchannelsNoAccessText(): string\n\t\t{\n\t\t\tconst phrase = this.channels.length > 0\n\t\t\t\t? 'HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_CHANNEL_LIST_ITEM_MORE_HIDDEN_TEXT'\n\t\t\t\t: 'HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_CHANNEL_LIST_ITEM_EMPTY_HIDDEN_TEXT'\n\t\t\t;\n\n\t\t\treturn this.locPlural(phrase, this.channelsNoAccess);\n\t\t},\n\t\tfilteredChats(): Array<ChatOrChannelDetailed>\n\t\t{\n\t\t\treturn this.chats.filter(\n\t\t\t\t(chat) => chat.title.toLowerCase().includes(this.searchQuery.toLowerCase()),\n\t\t\t);\n\t\t},\n\t\tfilteredChannels(): Array<ChatOrChannelDetailed>\n\t\t{\n\t\t\treturn this.channels.filter(\n\t\t\t\t(channel) => channel.title.toLowerCase().includes(this.searchQuery.toLowerCase()),\n\t\t\t);\n\t\t},\n\t\tshowAddEmptyState(): boolean\n\t\t{\n\t\t\treturn this.chats.length === 0\n\t\t\t\t&& this.channels.length === 0\n\t\t\t\t&& this.chatsNoAccess === 0\n\t\t\t\t&& this.channelsNoAccess === 0\n\t\t\t;\n\t\t},\n\t\tshowSearchEmptyState(): boolean\n\t\t{\n\t\t\treturn (this.chats.length > 0 || this.channels.length > 0)\n\t\t\t\t&& this.filteredChats.length === 0\n\t\t\t\t&& this.filteredChannels.length === 0\n\t\t\t;\n\t\t},\n\t\tgetLinkedChatIds(): Array<string>\n\t\t{\n\t\t\treturn (this.chats).map((chatItem) => `chat${chatItem.id}`);\n\t\t},\n\t\tgetLinkedChannelIds(): Array<string>\n\t\t{\n\t\t\treturn (this.channels).map((channelItem) => `chat${channelItem.id}`);\n\t\t},\n\t\tisChatsLoaded(): Boolean\n\t\t{\n\t\t\tconst department = this.departments.get(this.focusedNode);\n\n\t\t\treturn Boolean(Type.isArray(department.chatsDetailed) && Type.isArray(department.channelsDetailed));\n\t\t},\n\t\tteamEntity(): boolean\n\t\t{\n\t\t\treturn this.departments.get(this.focusedNode)?.entityType;\n\t\t},\n\t\tisTeamEntity(): boolean\n\t\t{\n\t\t\treturn this.teamEntity === EntityTypes.team;\n\t\t},\n\t\tgetAddEmptyStateTitle(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_TEAM_TITLE')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_TITLE')\n\t\t\t;\n\t\t},\n\t\tgetAddChatDescription(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_LINK_DIALOG_TEAM_DESC')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_LINK_DIALOG_DESC')\n\t\t\t;\n\t\t},\n\t\tgetAddChannelDescription(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_LINK_DIALOG_TEAM_DESC')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_LINK_DIALOG_DESC')\n\t\t\t;\n\t\t},\n\t\tchatMenuItems(): boolean\n\t\t{\n\t\t\treturn this.getChatListMenuItems();\n\t\t},\n\t\tchannelMenuItems(): boolean\n\t\t{\n\t\t\treturn this.getChannelListMenuItems();\n\t\t},\n\t\temptyChatTitle(): string\n\t\t{\n\t\t\tif (this.canEdit)\n\t\t\t{\n\t\t\t\treturn this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_CHAT_LIST_ITEM_TEXT_MSGVER_1');\n\t\t\t}\n\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_CHAT_LIST_ITEM_NO_TEAM_TEXT_MSGVER_1')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_CHAT_LIST_ITEM_NO_DEPARTMENT_TEXT_MSGVER_1')\n\t\t\t;\n\t\t},\n\t\temptyChannelTitle(): string\n\t\t{\n\t\t\tif (this.canEdit)\n\t\t\t{\n\t\t\t\treturn this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_CHANNEL_LIST_ITEM_TEXT_MSGVER_1');\n\t\t\t}\n\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_CHANNEL_LIST_ITEM_NO_TEAM_TEXT_MSGVER_1')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_CHANNEL_LIST_ITEM_NO_DEPARTMENT_TEXT_MSGVER_1')\n\t\t\t;\n\t\t},\n\t\tcanEdit(): boolean\n\t\t{\n\t\t\tconst permissionChecker = PermissionChecker.getInstance();\n\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? permissionChecker.hasPermission(PermissionActions.teamCommunicationEdit, this.focusedNode)\n\t\t\t\t: permissionChecker.hasPermission(PermissionActions.departmentCommunicationEdit, this.focusedNode)\n\t\t\t;\n\t\t},\n\t\tgetDialogExtraSubtitleLabel(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_WITH_SUBTEAMS_LABEL')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_WITH_SUBDEPARTMENTS_LABEL')\n\t\t\t;\n\t\t},\n\t\tcanAddWithChildren(): boolean\n\t\t{\n\t\t\tconst permissionChecker = PermissionChecker.getInstance();\n\t\t\tif (this.isTeamEntity)\n\t\t\t{\n\t\t\t\tconst teamTeamMinValue = { TEAM: PermissionLevels.selfAndSub };\n\t\t\t\tconst teamDepartmentMinValue = { DEPARTMENT: PermissionLevels.selfAndSub };\n\t\t\t\tconst teamAction = PermissionActions.teamCommunicationEdit;\n\n\t\t\t\treturn permissionChecker.hasPermission(teamAction, this.focusedNode, teamTeamMinValue)\n\t\t\t\t\t|| permissionChecker.hasPermission(teamAction, this.focusedNode, teamDepartmentMinValue)\n\t\t\t\t;\n\t\t\t}\n\n\t\t\tconst departmentAction = PermissionActions.departmentCommunicationEdit;\n\n\t\t\treturn permissionChecker.hasPermission(departmentAction, this.focusedNode, PermissionLevels.selfAndSub);\n\t\t},\n\t\thideEmptyChatItem(): boolean\n\t\t{\n\t\t\treturn this.searchQuery.length > 0 || this.chatsNoAccess > 0;\n\t\t},\n\t\thideEmptyChannelItem(): boolean\n\t\t{\n\t\t\treturn this.searchQuery.length > 0 || this.channelsNoAccess > 0;\n\t\t},\n\t\t...mapState(useChartStore, ['focusedNode', 'departments']),\n\t},\n\n\twatch:\n\t{\n\t\tisChatsLoaded(isChatsLoaded): void\n\t\t{\n\t\t\tif (isChatsLoaded === false)\n\t\t\t{\n\t\t\t\tthis.loadChatAction();\n\t\t\t}\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"hr-department-detail-content__tab-container --chat\">\n\t\t\t<template v-if=\"!showAddEmptyState\">\n\t\t\t\t<SearchInput\n\t\t\t\t\t:placeholder=\"loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_SEARCH_INPUT_PLACEHOLDER')\"\n\t\t\t\t\t:value=\"searchQuery\"\n\t\t\t\t\t@inputChange=\"searchChatOrChannel\"\n\t\t\t\t\tdataTestId=\"hr-department-detail-content_chats-tab__chats-and-channels-search-input\"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"!showSearchEmptyState\"\n\t\t\t\t\tclass=\"hr-department-detail-content__lists-container\"\n\t\t\t\t>\n\t\t\t\t\t<TabList\n\t\t\t\t\t\tid='hr-department-detail-content_chats-tab__chat-list'\n\t\t\t\t\t\t:title=\"loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_LIST_TITLE')\"\n\t\t\t\t\t\t:count=\"chats.length + chatsNoAccess\"\n\t\t\t\t\t\t:menuItems=\"chatMenuItems\"\n\t\t\t\t\t\t:listItems=\"filteredChats\"\n\t\t\t\t\t\t:emptyItemTitle=\"emptyChatTitle\"\n\t\t\t\t\t\temptyItemImageClass=\"hr-department-detail-content__chat-empty-tab-list-item_tab-icon\"\n\t\t\t\t\t\t:hideEmptyItem=\"hideEmptyChatItem\"\n\t\t\t\t\t\t:withAddPermission=\"canEdit\"\n\t\t\t\t\t\t@tabListAction=\"onActionMenuItemClick\"\n\t\t\t\t\t\t:dataTestIds=\"getChatListDataTestIds()\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<template v-slot=\"{ item }\">\n\t\t\t\t\t\t\t<ChatListItem :chat=\"item\" :nodeId=\"focusedNode\"/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-if=\"chatsNoAccess > 0\" v-slot:footer>\n\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\tclass=\"hr-department-detail-content__tab-list_communications-hidden\"\n\t\t\t\t\t\t\t\tdata-test-id=\"hr-department-content_chats-tab__list_chat-hidden-text\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{{ chatsNoAccessText }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</TabList>\n\t\t\t\t\t<TabList\n\t\t\t\t\t\tid='hr-department-detail-content_chats-tab__channel-list'\n\t\t\t\t\t\t:title=\"loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_LIST_TITLE')\"\n\t\t\t\t\t\t:count=\"channels.length + channelsNoAccess\"\n\t\t\t\t\t\t:menuItems=\"channelMenuItems\"\n\t\t\t\t\t\t:listItems=\"filteredChannels\"\n\t\t\t\t\t\t:emptyItemTitle=\"emptyChannelTitle\"\n\t\t\t\t\t\temptyItemImageClass=\"hr-department-detail-content__chat-empty-tab-list-item_tab-icon\"\n\t\t\t\t\t\t:hideEmptyItem=\"hideEmptyChannelItem\"\n\t\t\t\t\t\t:withAddPermission=\"canEdit\"\n\t\t\t\t\t\t@tabListAction=\"onActionMenuItemClick\"\n\t\t\t\t\t\t:dataTestIds=\"getChannelListDataTestIds()\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<template v-slot=\"{ item }\">\n\t\t\t\t\t\t\t<ChatListItem :chat=\"item\" :nodeId=\"focusedNode\"/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-if=\"channelsNoAccess > 0\" v-slot:footer>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"hr-department-detail-content__tab-list_communications-hidden\"\n\t\t\t\t\t\t\t\tdata-test-id=\"hr-department-content_chats-tab__list_channel-hidden-text\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{{ channelsNoAccessText }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</TabList>\n\t\t\t\t</div>\n\t\t\t\t<EmptyState \n\t\t\t\t\tv-else\n\t\t\t\t\timageClass=\"hr-department-detail-content__chat-empty-tab-search_tab-icon\"\n\t\t\t\t\t:title=\"loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_SEARCHED_EMPLOYEES_TITLE')\"\n\t\t\t\t\t:description =\"loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_SEARCHED_EMPLOYEES_SUBTITLE')\"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<EmptyState \n\t\t\t\tv-else\n\t\t\t\timageClass=\"hr-department-detail-content__chat-empty-tab-add_tab-icon\"\n\t\t\t\t:title=\"getAddEmptyStateTitle\"\n\t\t\t\t:list=\"getAddEmptyStateList()\"\n\t\t\t>\n\t\t\t\t<template v-slot:content>\n\t\t\t\t\t<EmptyTabAddButtons\n\t\t\t\t\t\t@emptyStateAddAction=\"onActionMenuItemClick\"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t</EmptyState>\n\t\t\t<ManagementDialog\n\t\t\t\tv-if=\"chatLinkDialogVisible\"\n\t\t\t\tid=\"hr-department-detail-content-chats-tab-chat-link-dialog\"\n\t\t\t\t:entities=\"getChatLinkDialogEntities()\"\n\t\t\t\t:recentTabOptions=\"getChatLinkRecentTabOptions()\"\n\t\t\t\t:hiddenItemsIds=\"getLinkedChatIds\"\n\t\t\t\t:title=\"loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_LINK_DIALOG_TITLE')\"\n\t\t\t\t:description=\"getAddChatDescription\"\n\t\t\t\t:isActive=\"isChatLinkActive\"\n\t\t\t\t@managementDialogAction=\"linkChats\"\n\t\t\t\t@close=\"chatLinkDialogVisible = false\"\n\t\t\t\t:dataTestIds=\"getChatLinkDialogDataTestIds()\"\n\t\t\t>\n\t\t\t\t<template v-slot:extra-subtitle>\n\t\t\t\t\t<ChildrenModeSelector\n\t\t\t\t\t\t:isTeamEntity=\"isTeamEntity\"\n\t\t\t\t\t\t:data-test-id=\"getChatLinkDialogDataTestIds().addWithChildrenDataTestId\"\n\t\t\t\t\t\t:hasPermission=\"canAddWithChildren\"\n\t\t\t\t\t\t:text=\"loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_MODE_CHATS_TEXT')\"\n\t\t\t\t\t\t@saveChildrenMode=\"addChatsWithChildren = $event\"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t</ManagementDialog>\n\t\t\t<ManagementDialog\n\t\t\t\tv-if=\"channelLinkDialogVisible\"\n\t\t\t\tid=\"hr-department-detail-content-chats-tab-channel-link-dialog\"\n\t\t\t\t:entities=\"getChannelLinkDialogEntities()\"\n\t\t\t\t:recentTabOptions=\"getChannelLinkRecentTabOptions()\"\n\t\t\t\t:hiddenItemsIds=\"getLinkedChannelIds\"\n\t\t\t\t:title=\"loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_LINK_DIALOG_TITLE')\"\n\t\t\t\t:description=\"getAddChannelDescription\"\n\t\t\t\t:isActive=\"isChannelLinkActive\"\n\t\t\t\t@managementDialogAction=\"linkChannel\"\n\t\t\t\t@close=\"channelLinkDialogVisible = false\"\n\t\t\t\t:dataTestIds=\"getChannelLinkDialogDataTestIds()\"\n\t\t\t>\n\t\t\t\t<template v-slot:extra-subtitle>\n\t\t\t\t\t<ChildrenModeSelector\n\t\t\t\t\t\t:isTeamEntity=\"isTeamEntity\"\n\t\t\t\t\t\t:data-test-id=\"getChatLinkDialogDataTestIds().addWithChildrenDataTestId\"\n\t\t\t\t\t\t:hasPermission=\"canAddWithChildren\"\n\t\t\t\t\t\t:text=\"loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_MODE_CHANNELS_TEXT')\"\n\t\t\t\t\t\t@saveChildrenMode=\"addChannelsWithChildren = $event\"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t</ManagementDialog>\n\t\t</div>\n\t`,\n};\n","import { PermissionActions, PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\nimport { UsersTab } from './users/tab';\nimport { ChatsTab } from './chats/tab';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { mapState } from 'ui.vue3.pinia';\n\nimport '../style.css';\n\n// @vue/component\nexport const DepartmentContent = {\n\tname: 'departmentContent',\n\n\tcomponents: { UsersTab, ChatsTab },\n\n\tprops: {\n\t\tisCollapsed: Boolean,\n\t},\n\n\temits: ['showDetailLoader', 'hideDetailLoader', 'editEmployee'],\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tactiveTab: 'usersTab',\n\t\t\ttabs: [\n\t\t\t\t{ name: 'usersTab', component: 'UsersTab', id: 'users-tab' },\n\t\t\t\t{ name: 'chatsTab', component: 'ChatsTab', id: 'chats-tab' },\n\t\t\t],\n\t\t\tisDescriptionOverflowed: false,\n\t\t\tisDescriptionExpanded: false,\n\t\t};\n\t},\n\n\tcomputed: {\n\t\t...mapState(useChartStore, ['focusedNode', 'departments']),\n\t\tactiveTabComponent(): UsersTab | ChatsTab | null\n\t\t{\n\t\t\tconst activeTab = this.tabs.find((tab) => tab.name === this.activeTab);\n\n\t\t\treturn activeTab ? activeTab.component : null;\n\t\t},\n\t\tusersCount(): Number\n\t\t{\n\t\t\treturn this.departments.get(this.focusedNode)?.userCount ?? 0;\n\t\t},\n\t\tchatAndChannelsCount(): Number\n\t\t{\n\t\t\treturn this.departments.get(this.focusedNode)?.chatAndChannelsCount ?? null;\n\t\t},\n\t\ttabArray(): Array\n\t\t{\n\t\t\treturn this.tabs.map((tab) => {\n\t\t\t\tif (tab.name === 'usersTab')\n\t\t\t\t{\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...tab,\n\t\t\t\t\t\tcount: this.usersCount,\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tif (tab.name === 'chatsTab')\n\t\t\t\t{\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...tab,\n\t\t\t\t\t\tcount: this.chatAndChannelsCount,\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\treturn tab;\n\t\t\t});\n\t\t},\n\t\tdescription(): ?string\n\t\t{\n\t\t\tconst department = this.departments.get(this.focusedNode);\n\t\t\tif (!department.description)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn department.description;\n\t\t},\n\t\tisTeamEntity(): boolean\n\t\t{\n\t\t\treturn this.departments.get(this.focusedNode)?.entityType === EntityTypes.team;\n\t\t},\n\t},\n\n\twatch: {\n\t\tdescription(): void\n\t\t{\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.isDescriptionOverflowed = this.checkDescriptionOverflowed();\n\t\t\t});\n\t\t},\n\t\tfocusedNode(): void\n\t\t{\n\t\t\tthis.isDescriptionExpanded = false;\n\t\t\tthis.selectTab('usersTab');\n\t\t},\n\t\tisCollapsed(): void\n\t\t{\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.isDescriptionOverflowed = this.checkDescriptionOverflowed();\n\t\t\t});\n\t\t},\n\t},\n\n\tmethods:\n\t{\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tselectTab(tabName): void\n\t\t{\n\t\t\tif (this.isTabDisabled(tabName))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.activeTab = tabName;\n\t\t},\n\t\tgetTabLabel(name: string): string\n\t\t{\n\t\t\tif (name === 'usersTab')\n\t\t\t{\n\t\t\t\treturn this.isTeamEntity\n\t\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_TEAM_USERS_TITLE')\n\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_TITLE');\n\t\t\t}\n\n\t\t\tif (name === 'chatsTab')\n\t\t\t{\n\t\t\t\treturn this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_TITLE');\n\t\t\t}\n\n\t\t\treturn '';\n\t\t},\n\t\ttoggleDescriptionExpand(): void\n\t\t{\n\t\t\tthis.isDescriptionExpanded = !this.isDescriptionExpanded;\n\t\t},\n\t\tcheckDescriptionOverflowed(): boolean\n\t\t{\n\t\t\tconst descriptionContainer = this.$refs.descriptionContainer ?? null;\n\t\t\tif (descriptionContainer)\n\t\t\t{\n\t\t\t\treturn descriptionContainer.scrollHeight > descriptionContainer.clientHeight;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\t\thideDetailLoader(): void\n\t\t{\n\t\t\tthis.$emit('hideDetailLoader');\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.isDescriptionOverflowed = this.checkDescriptionOverflowed();\n\t\t\t});\n\t\t},\n\t\tisTabDisabled(tabName: string): boolean\n\t\t{\n\t\t\tif (tabName === 'chatsTab' && this.tabArray.find((tab) => tab.name === tabName).count === 0)\n\t\t\t{\n\t\t\t\tconst permissionChecker = PermissionChecker.getInstance();\n\t\t\t\tconst canEditChats = this.isTeamEntity\n\t\t\t\t\t? permissionChecker.hasPermission(PermissionActions.teamCommunicationEdit, this.focusedNode)\n\t\t\t\t\t: permissionChecker.hasPermission(PermissionActions.departmentCommunicationEdit, this.focusedNode)\n\t\t\t\t;\n\n\t\t\t\tif (!canEditChats)\n\t\t\t\t{\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"hr-department-detail-content hr-department-detail-content__scope\">\n\t\t\t<div\n\t\t\t\tref=\"descriptionContainer\"\n\t\t\t\tv-show=\"description\"\n\t\t\t\t:class=\"[\n\t\t\t\t\t'hr-department-detail-content-description',\n\t\t\t\t\t{ '--expanded': isDescriptionExpanded },\n\t\t\t\t\t{ '--overflowed': isDescriptionOverflowed},\n\t\t\t\t]\"\n\t\t\t\tv-on=\"isDescriptionOverflowed ? { click: toggleDescriptionExpand } : {}\"\n\t\t\t>\n\t\t\t\t{{ description }}\n\t\t\t</div>\n\t\t\t<div class=\"hr-department-detail-content__tab-list\">\n\t\t\t\t<button\n\t\t\t\t\tv-for=\"tab in tabArray\"\n\t\t\t\t\t:key=\"tab.name\"\n\t\t\t\t\tclass=\"hr-department-detail-content__tab-item\"\n\t\t\t\t\t:class=\"[{'--active-tab' : activeTab === tab.name, '--disabled-tab': isTabDisabled(tab.name)}]\"\n\t\t\t\t\t@click=\"selectTab(tab.name)\"\n\t\t\t\t\t:data-id=\"tab.id ? 'hr-department-detail-content__' + tab.id + '_button' : null\"\n\t\t\t\t>\n\t\t\t\t\t{{ this.getTabLabel(tab.name) }}\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass=\"hr-department-detail-content__tab-count\"\n\t\t\t\t\t\t:data-id=\"tab.id ? 'hr-department-detail-content__' + tab.id + '_counter' : null\"\n\t\t\t\t\t>{{ tab.count }}\n\t\t\t\t\t</span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t<UsersTab\n\t\t\t\tv-show=\"activeTab === 'usersTab'\"\n\t\t\t\t@showDetailLoader=\"$emit('showDetailLoader')\"\n\t\t\t\t@hideDetailLoader=\"hideDetailLoader\"\n\t\t\t/>\n\t\t\t<ChatsTab\n\t\t\t\tv-show=\"activeTab === 'chatsTab'\"\n\t\t\t\t:is=\"activeTabComponent\"\n\t\t\t\t@showDetailLoader=\"$emit('showDetailLoader')\"\n\t\t\t\t@hideDetailLoader=\"hideDetailLoader\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n"],"names":["HeadListDataTestIds","Object","freeze","containerDataTestId","listActionButtonDataTestId","listActonMenuDataTestId","listCounterDataTestId","EmployeeListDataTestIds","EmptyTabAddButton","name","components","RouteActionMenu","props","departmentId","type","Number","required","entityType","String","default","EntityTypes","department","data","menuVisible","computed","menu","EmptyUsersTabActionMenu","AnalyticsSourceType","DETAIL","mapState","useChartStore","methods","loc","phraseCode","replacements","$Bitrix","Loc","getMessage","onClick","team","items","length","onActionMenuItemClick","id","actionId","template","DepartmentAPI","getPagedEmployees","page","countPerPage","getData","nodeId","removeUserFromDepartment","userId","postData","moveUserToDepartment","targetNodeId","role","roleXmlId","isUserInMultipleDepartments","getUserInfo","fireUser","findMemberByQuery","query","getChatsAndChannels","saveChats","ids","removeIds","parentId","markDescendantsForChatReload","childrenIds","store","queue","visited","Set","maxIterations","iterations","childId","shift","has","add","childDepartment","departments","get","chatsDetailed","channelsDetailed","children","push","DepartmentContentActions","targetDepartmentId","targetDepartment","oldMemberRoles","getMemberRoles","targetMemberRoles","user","employee","employees","find","heads","head","userCount","filter","changeCurrentDepartment","updateEmployees","set","updateHeads","updateEmployeeListOptions","options","employeeListOptions","setChatsAndChannels","chats","channels","chatsNoAccess","channelsNoAccess","chatAndChannelsCount","removeUserFromAllDepartments","departmentsToUpdate","key","Type","isArray","some","refreshDepartments","unbindChatFromNode","chatId","chat","updateChatsInChildrenNodes","parentNodeId","parentDepartment","MoveUserActionPopup","ConfirmationPopup","emits","created","permissionChecker","PermissionChecker","getInstance","action","isTeamEntity","PermissionActions","teamAddMember","employeeAddToDepartment","selectedDepartmentId","showMoveUserActionLoader","lockMoveUserActionButton","showUserAlreadyBelongsToDepartmentPopup","accessDenied","mounted","departmentContainer","$refs","departmentSelector","createTagSelector","renderTo","includedNodeEntityTypesInDialog","getMoveUserActionPhrase","departmentName","Text","encode","focusedNode","userName","gender","replace","url","getUserAlreadyBelongsToDepartmentPopupPhrase","selectedParentDepartment","phrase","memberRoles","confirmTitle","confirmDescription","TagSelector","events","onTagAdd","event","tag","hasPermission","onTagRemove","multiple","dialogOptions","width","height","dropdownMode","hideOnDeselect","entities","selectMode","restricted","includedNodeEntityTypes","useMultipleTabs","preselectedItems","confirmMoveUser","error","code","UI","Notification","Center","notify","content","autoHideDelay","$emit","closeAction","closeUserAlreadyBelongsToDepartmentPopup","UserListItemActionButton","showRemoveUserConfirmationPopup","showRemoveUserConfirmationActionLoader","showMoveUserPopup","showFireUserPopup","fireUserLoad","toggleMenu","MenuActions","moveUserToAnotherDepartment","fireUserFromCompany","removeUser","rootDepartment","values","cancelRemoveUser","isInvited","cancelFireUser","handleMoveUserAction","handleMoveUserClose","getMemberKeyByValue","value","keys","UserListActionMenu","getFirePopupDescription","userUrl","genderSuffix","description","getFirePopupTitle","getFirePopupButtonText","getRemovePopupTitle","getRemovePopupDescription","UserListItem","selectedUserId","listType","canDrag","Boolean","defaultAvatar","handleUserClick","item","BX","SidePanel","Instance","open","cacheable","handleMouseDown","preventDefault","initialListType","element","$el","EmptyState","title","imageClass","list","Array","EmptyListItem","withAddPermission","ListActionButton","menuItems","dataTestIds","itemId","TabList","count","listItems","emptyItemTitle","emptyItemImageClass","hideEmptyItem","isDropTarget","placeholderIndex","boundHandleDragOverList","needToShowCount","isNumber","watch","newValue","oldValue","itemsWrapper","Runtime","throttle","handleDragOverList","bind","Event","unbind","querySelectorAll","mouseY","clientY","newIndex","i","child","entries","rect","getBoundingClientRect","childMidpointY","top","SearchInput","placeholder","dataTestId","hasFocus","handleInput","target","handleBlur","clearInput","AUTOSCROLL_AREA_SIZE","UsersTab","MoveEmployeeConfirmationPopup","searchQuery","needToScroll","dragState","getInitialDragState","showDndConfirmationPopup","dndPreviousState","dndPopupDescription","boundHandleDragMove","boundHandleDragEnd","headCount","formattedHeads","map","subtitle","workPosition","badgeText","getBadgeText","sort","a","b","roleOrder","deputyHead","roleA","roleB","filteredHeads","toLowerCase","includes","employeeCount","memberCount","formattedEmployees","reverse","filteredEmployees","mapWritableState","showSearchBar","showSearchEmptyState","canAddUsers","permission","headListEmptyStateTitle","employeesListEmptyStateTitle","shouldUpdateList","departmentUsersStatus","loaded","headMenu","UsersTabActionMenu","employeeMenu","isEmployeeListOptionsSet","employeeTitle","emptyStateTitle","emptyStateDescription","isHeadListPotentialTarget","isDragging","initialList","isEmployeeListPotentialTarget","dndConfirmationPopupTitle","toHead","targetList","dndConfirmationPopupBtn","showDndRoleSelect","headListTitle","newId","isListUpdated","loadEmployeesAction","isDescriptionExpanded","searchedUserId","needToFocusUserId","$nextTick","scrollToUser","handler","immediate","newQuery","searchMembers","usersStatus","prevUsersStatus","prevDepartmentId","prevLoaded","clearSearchTimeout","autoscrollIntervalId","handleDragMove","handleDragEnd","tabContainer","updateList","employeesList","scrollPosition","scrollTop","clientHeight","scrollHeight","loadedEmployees","employeeIds","newEmployees","unshift","selectors","querySelector","scrollIntoView","behavior","block","setTimeout","clearTimeout","findQueryResult","success","failure","nodeResults","failedQuery","startsWith","founded","newMembers","found","searchUser","onHeadListActionMenuItemClick","onEmployeeListActionMenuItemClick","getHeadListDataTestIds","getEmployeeListDataTestIds","handleItemDragStart","payload","draggedElement","offsetX","clientX","left","offsetY","ghost","cloneNode","Dom","addClass","style","append","document","body","ghostElement","u","EventEmitter","emit","HR_USER_DRAG_START","HR_USER_DRAG_MOVE","pageX","pageY","potentialTarget","isPointerOverElement","headList","employeeList","handleAutoscrollOnDrag","scrollableContainer","topTriggerZone","scrollSpeed","setInterval","stopAutoscroll","clearInterval","right","bottom","HR_USER_DRAG_DROP","isValidDrop","targetIndex","listRef","remove","removeClass","HR_USER_DRAG_END","context","moveDndUser","selectedRole","selectedRoleLabel","prepareDndPopupDescription","cancelDndUserMove","confirmDndUserMove","targetRole","previousRole","UserManagementDialogAPI","addUsersToDepartment","console","isTeam","basePhrase","previousState","isMovingToHeads","sourceList","targetListForMove","userIndex","findIndex","userToMove","splice","MenuOption","withChildren","withoutChildren","ChildrenModeSelector","text","getControlButtonText","getValueText","getMenuItems","showMenu","itemClass","ChatsMenuOption","linkChat","linkChannel","ChatsMenuLinkChat","bIcon","Main","CHAT_MESSAGE","size","colorTokenName","ChatsMenuLinkChannel","SPEAKER_MOUTHPIECE","ChatListDataTestIds","ChannelListDataTestIds","ChatLinkDialogDataTestIds","confirmButtonDataTestId","cancelButtonDataTestId","closeButtonDataTestId","addWithChildrenDataTestId","ChannelLinkDialogDataTestIds","EmptyTabAddButtons","chatMenuVisible","channelMenuVisible","chatButtonId","channelButtonId","onChatButtonClick","onChannelButtonClick","ChatListItemActionButton","showUnbindChatConfirmationPopup","unbindChatLoader","getUnbindChatTitle","chatType","isChat","getUnbindChatDescription","ChatTypes","ChatListActionMenu","openChat","Messenger","dialogId","unbindChat","cancelUnbindChat","updateChats","isOwnChat","originalNodeId","ChatListItem","ResponsiveHint","directives","hint","Hint","avatar","channel","originalNodeName","hiddenNodeName","structureMap","indirectChatSubtitle","lockHint","hasAccess","prepareAvatar","color","getColorCode","avatarOptions","baseColor","isExtranet","click","onChatItemClick","userpicPath","AvatarRound","AvatarSquare","locateToOriginalDepartment","HR_ORG_CHART_LOCATE_TO_DEPARTMENT","ChatsTab","ManagementDialog","isChatLinkActive","chatLinkDialogVisible","isChannelLinkActive","channelLinkDialogVisible","isLoading","addChatsWithChildren","addChannelsWithChildren","loadChatAction","locPlural","getMessagePlural","searchChatOrChannel","force","loadedChatsAndChannels","getChatListMenuItems","canEdit","getChannelListMenuItems","getAddEmptyStateList","stateArray","getChatListDataTestIds","getChannelListDataTestIds","getChatLinkDialogEntities","entity","getChatDialogEntity","excludeIds","getChannelLinkDialogEntities","getChannelDialogEntity","getChatLinkRecentTabOptions","getCommunicationsRecentTabOptions","teamEntity","CommunicationsTypeDict","getChannelLinkRecentTabOptions","linkChats","chatsItems","chatItem","newChats","newChannels","getChatLinkDialogDataTestIds","getChannelLinkDialogDataTestIds","chatsNoAccessText","channelsNoAccessText","filteredChats","filteredChannels","showAddEmptyState","getLinkedChatIds","getLinkedChannelIds","channelItem","isChatsLoaded","getAddEmptyStateTitle","getAddChatDescription","getAddChannelDescription","chatMenuItems","channelMenuItems","emptyChatTitle","emptyChannelTitle","teamCommunicationEdit","departmentCommunicationEdit","getDialogExtraSubtitleLabel","canAddWithChildren","teamTeamMinValue","TEAM","PermissionLevels","selfAndSub","teamDepartmentMinValue","DEPARTMENT","teamAction","departmentAction","hideEmptyChatItem","hideEmptyChannelItem","DepartmentContent","isCollapsed","activeTab","tabs","component","isDescriptionOverflowed","activeTabComponent","tab","usersCount","tabArray","checkDescriptionOverflowed","selectTab","tabName","isTabDisabled","getTabLabel","toggleDescriptionExpand","descriptionContainer","hideDetailLoader","canEditChats"],"mappings":"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"}