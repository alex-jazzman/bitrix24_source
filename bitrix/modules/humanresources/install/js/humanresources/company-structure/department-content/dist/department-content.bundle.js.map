{"version":3,"file":"department-content.bundle.js","sources":["../src/components/users/consts.js","../src/components/users/empty-tab-add-button.js","../src/api.js","../src/actions.js","../src/components/users/item/move-user-action-popup.js","../src/components/users/item/action-button.js","../src/components/users/item/item.js","../src/components/base-components/empty-state/empty-state.js","../src/components/base-components/list/empty-list-item.js","../src/components/base-components/list/list-action-button.js","../src/components/base-components/list/list.js","../src/components/base-components/search/search-input.js","../src/components/users/tab.js","../src/components/chats/consts.js","../src/components/chats/empty-tab-add-buttons.js","../src/components/chats/action-button.js","../src/components/chats/list-item.js","../src/components/chats/tab.js","../src/components/department-content.js"],"sourcesContent":["export const HeadListDataTestIds = Object.freeze({\n\tcontainerDataTestId: 'hr-department-content_users-tab__head-list-container',\n\tlistActionButtonDataTestId: 'hr-department-content_users-tab__head-list-action-button',\n\tlistActonMenuDataTestId: 'hr-department-content_users-tab__head-list-action-menu-container',\n\tlistCounterDataTestId: 'hr-department-content_users-tab__head-list-counter',\n});\n\nexport const EmployeeListDataTestIds = Object.freeze({\n\tcontainerDataTestId: 'hr-department-content_users-tab__employee-list-container',\n\tlistActionButtonDataTestId: 'hr-department-content_users-tab__employee-list-action-button',\n\tlistActonMenuDataTestId: 'hr-department-content_users-tab__employee-list-action-menu-container',\n\tlistCounterDataTestId: 'hr-department-content_users-tab__employee-list-counter',\n});","import { AnalyticsSourceType } from 'humanresources.company-structure.api';\nimport { EmptyUsersTabActionMenu } from 'humanresources.company-structure.org-chart';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\nimport { mapState } from 'ui.vue3.pinia';\nimport { RouteActionMenu } from 'humanresources.company-structure.structure-components';\n\nimport 'ui.icon-set.crm';\nimport 'ui.icon-set.main';\nimport './styles/empty-tab-add-buttons.css';\n\nexport const EmptyTabAddButton = {\n\tname: 'emptyStateContainer',\n\n\tcomponents: { RouteActionMenu },\n\n\tprops: {\n\t\tdepartmentId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tentityType: {\n\t\t\ttype: String,\n\t\t\tdefault: EntityTypes.department,\n\t\t},\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tmenuVisible: false,\n\t\t};\n\t},\n\n\tcomputed: {\n\t\tmenu(): EmptyUsersTabActionMenu\n\t\t{\n\t\t\treturn new EmptyUsersTabActionMenu(this.departmentId, AnalyticsSourceType.DETAIL, null, this.entityType);\n\t\t},\n\t\t...mapState(useChartStore, ['focusedNode']),\n\t},\n\n\tmethods:\n\t{\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tonClick(): void\n\t\t{\n\t\t\tif ((this.entityType === EntityTypes.team) && (this.menu.items.length === 1))\n\t\t\t{\n\t\t\t\t// for teams for now there can be only one item, so we invoke action right away\n\t\t\t\tthis.onActionMenuItemClick(this.menu.items[0].id);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.menuVisible = true;\n\t\t\t}\n\t\t},\n\t\tonActionMenuItemClick(actionId: string): void\n\t\t{\n\t\t\tthis.menu.onActionMenuItemClick(actionId);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"hr-department-detail-content__users-empty-tab-add_buttons-container\">\n\t\t\t<button\n\t\t\t\tclass=\"hr-add-employee-empty-tab-entity-btn ui-btn ui-btn ui-btn-sm ui-btn-primary ui-btn-round\"\n\t\t\t\tref=\"actionMenuButton\"\n\t\t\t\t@click.stop=\"onClick\"\n\t\t\t\tdata-id=\"hr-department-detail-content__user-empty-tab_add-user-button\"\n\t\t\t>\n\t\t\t\t<span class=\"hr-add-employee-empty-tab-entity-btn-text\">{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_EMPLOYEES_ADD_USER_ADD_BUTTON')}}</span>\n\t\t\t</button>\n\t\t\t<RouteActionMenu\n\t\t\t\tv-if=\"menuVisible\"\n\t\t\t\t:id=\"'empty-state-department-detail-add-menu-' + focusedNode\"\n\t\t\t\t:items=\"menu.items\"\n\t\t\t\t:width=\"302\"\n\t\t\t\t:bindElement=\"$refs['actionMenuButton']\"\n\t\t\t\t@action=\"onActionMenuItemClick\"\n\t\t\t\t@close=\"menuVisible = false\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { getData, postData } from 'humanresources.company-structure.api';\nimport type { ChatListResponse } from 'humanresources.company-structure.utils';\n\nexport const DepartmentAPI = {\n\tgetPagedEmployees: (id: Number, page: Number, countPerPage: Number) => {\n\t\treturn getData('humanresources.api.Structure.Node.Member.Employee.list', { nodeId: id, page, countPerPage });\n\t},\n\tremoveUserFromDepartment: (nodeId: number, userId: number): Promise<void> => {\n\t\treturn postData('humanresources.api.Structure.Node.Member.deleteUser', {\n\t\t\tnodeId,\n\t\t\tuserId,\n\t\t});\n\t},\n\tmoveUserToDepartment: (nodeId: number, userId: number, targetNodeId: number): Promise<void> => {\n\t\treturn postData('humanresources.api.Structure.Node.Member.moveUser', {\n\t\t\tnodeId,\n\t\t\tuserId,\n\t\t\ttargetNodeId,\n\t\t});\n\t},\n\tisUserInMultipleDepartments: (userId: number): Promise<void> => {\n\t\treturn getData('humanresources.api.User.isUserInMultipleDepartments', {\n\t\t\tuserId,\n\t\t});\n\t},\n\tgetUserInfo: (nodeId: number, userId: number): Promise<void> => {\n\t\treturn getData('humanresources.api.User.getInfoByUserMember', {\n\t\t\tnodeId,\n\t\t\tuserId,\n\t\t});\n\t},\n\tfireUser: (userId: number): Promise<void> => {\n\t\treturn postData('intranet.user.fire', {\n\t\t\tuserId,\n\t\t});\n\t},\n\tfindMemberByQuery: (nodeId: number, query: string): Promise<void> => {\n\t\treturn getData('humanresources.api.Structure.Node.Member.find', {\n\t\t\tnodeId,\n\t\t\tquery,\n\t\t});\n\t},\n\tgetChatsAndChannels: (nodeId: number): Promise<ChatListResponse> => {\n\t\treturn getData('humanresources.api.Structure.Node.Member.Chat.getList', {\n\t\t\tnodeId,\n\t\t});\n\t},\n\tsaveChats: (\n\t\tnodeId: number,\n\t\tids: number[] = [],\n\t\tremoveIds: number[] = [],\n\t\tparentId: ?number = null,\n\t): Promise<Array> => {\n\t\treturn postData('humanresources.api.Structure.Node.Member.Chat.saveChatList', {\n\t\t\tnodeId,\n\t\t\tids,\n\t\t\tremoveIds,\n\t\t\tparentId,\n\t\t});\n\t},\n};\n","import { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { getMemberRoles } from 'humanresources.company-structure.api';\nimport { Type } from 'main.core';\nimport type { ChatOrChannelDetailed } from 'humanresources.company-structure.utils';\n\nexport const DepartmentContentActions = {\n\tmoveUserToDepartment: (departmentId, userId, targetDepartmentId, role): void => {\n\t\tconst store = useChartStore();\n\t\tconst department = store.departments.get(departmentId);\n\t\tconst targetDepartment = store.departments.get(targetDepartmentId);\n\n\t\tif (!department || !targetDepartment)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst oldMemberRoles = getMemberRoles(department.entityType);\n\t\tconst targetMemberRoles = getMemberRoles(targetDepartment.entityType);\n\t\tconst user = role === oldMemberRoles.employee\n\t\t\t? department.employees?.find((employee) => employee.id === userId)\n\t\t\t: department.heads.find((head) => head.id === userId)\n\t\t;\n\t\tif (!user)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tdepartment.userCount -= 1;\n\t\tif (role === oldMemberRoles.employee)\n\t\t{\n\t\t\tdepartment.employees = department.employees.filter((employee) => employee.id !== userId);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdepartment.heads = department.heads.filter((head) => head.id !== userId);\n\t\t}\n\n\t\ttargetDepartment.userCount += 1;\n\t\tif (userId === store.userId)\n\t\t{\n\t\t\tstore.changeCurrentDepartment(departmentId, targetDepartmentId);\n\t\t}\n\n\t\tuser.role = targetMemberRoles.employee;\n\t\tif (!targetDepartment.employees)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\ttargetDepartment.employees.push(user);\n\t},\n\tremoveUserFromDepartment: (departmentId, userId, role): void => {\n\t\tconst store = useChartStore();\n\t\tconst department = store.departments.get(departmentId);\n\t\tconst oldMemberRoles = getMemberRoles(department.entityType);\n\t\tif (!department)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (userId === store.userId)\n\t\t{\n\t\t\tstore.changeCurrentDepartment(departmentId);\n\t\t}\n\n\t\tdepartment.userCount -= 1;\n\t\tif (role === oldMemberRoles.employee)\n\t\t{\n\t\t\tdepartment.employees = department.employees.filter((employee) => employee.id !== userId);\n\n\t\t\treturn;\n\t\t}\n\n\t\tdepartment.heads = department.heads.filter((head) => head.id !== userId);\n\t},\n\tupdateEmployees: (departmentId: number, employees: Array): void => {\n\t\tconst { departments } = useChartStore();\n\t\tconst department = departments.get(departmentId);\n\n\t\tif (!department)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tdepartments.set(departmentId, { ...department, employees });\n\t},\n\tupdateEmployeeListOptions: (\n\t\tdepartmentId: number,\n\t\toptions: { page?: number, shouldUpdateList?: boolean, isListUpdated?: boolean },\n\t): void => {\n\t\tconst { departments } = useChartStore();\n\t\tconst department = departments.get(departmentId);\n\n\t\tif (!department)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tdepartment.employeeListOptions = {\n\t\t\t...department.employeeListOptions,\n\t\t\t...options,\n\t\t};\n\n\t\tdepartments.set(departmentId, department);\n\t},\n\tsetChatsAndChannels: (\n\t\tnodeId: number,\n\t\tchats: Array<ChatOrChannelDetailed>,\n\t\tchannels: Array<ChatOrChannelDetailed>,\n\t): void => {\n\t\tconst store = useChartStore();\n\t\tconst department = store.departments.get(nodeId);\n\t\tif (!department)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tdepartment.channelsDetailed = channels;\n\t\tdepartment.chatsDetailed = chats;\n\t\tdepartment.chatAndChannelsCount = (chats.length + channels.length);\n\t},\n\tremoveUserFromAllDepartments: async (userId): Promise<void> => {\n\t\tconst store = useChartStore();\n\t\tconst departments = store.departments;\n\t\tconst departmentsToUpdate = [];\n\n\t\tfor (const [key, department] of departments)\n\t\t{\n\t\t\tif (\n\t\t\t\t(\n\t\t\t\t\t'heads' in department\n\t\t\t\t\t&& Type.isArray(department.heads)\n\t\t\t\t\t&& department.heads.some((employee) => employee.id === userId)\n\t\t\t\t)\n\t\t\t\t|| (\n\t\t\t\t\t'employees' in department\n\t\t\t\t\t&& Type.isArray(department.employees)\n\t\t\t\t\t&& department.employees.some((employee) => employee.id === userId)\n\t\t\t\t)\n\t\t\t)\n\t\t\t{\n\t\t\t\tdepartmentsToUpdate.push(key);\n\t\t\t}\n\t\t}\n\n\t\treturn store.refreshDepartments(departmentsToUpdate);\n\t},\n\tunbindChatFromNode: (nodeId: number, chatId: number): void => {\n\t\tconst store = useChartStore();\n\t\tconst department = store.departments.get(nodeId);\n\t\tif (!department)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tdepartment.channelsDetailed = department.channelsDetailed.filter((chat) => chat.id !== chatId);\n\t\tdepartment.chatsDetailed = department.chatsDetailed.filter((chat) => chat.id !== chatId);\n\t\tdepartment.chatAndChannelsCount--;\n\t},\n};\n","import { getMemberRoles, type MemberRolesType } from 'humanresources.company-structure.api';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { PermissionActions, PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport { ConfirmationPopup } from 'humanresources.company-structure.structure-components';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\nimport { Text } from 'main.core';\nimport { type BaseEvent } from 'main.core.events';\nimport { TagSelector } from 'ui.entity-selector';\nimport { UI } from 'ui.notification';\nimport { mapState } from 'ui.vue3.pinia';\nimport { DepartmentContentActions } from '../../../actions';\nimport { DepartmentAPI } from '../../../api';\n\nimport './styles/move-user-action-popup.css';\n\n// @vue/component\nexport const MoveUserActionPopup = {\n\tname: 'MoveUserActionPopup',\n\tcomponents: { ConfirmationPopup },\n\temits: ['close', 'action'],\n\n\tprops: {\n\t\tparentId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tuser: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tentityType: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.permissionChecker = PermissionChecker.getInstance();\n\n\t\tif (!this.permissionChecker)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.action = this.isTeamEntity\n\t\t\t? PermissionActions.teamAddMember\n\t\t\t: PermissionActions.employeeAddToDepartment\n\t\t;\n\t\tthis.selectedDepartmentId = 0;\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tshowMoveUserActionLoader: false,\n\t\t\tlockMoveUserActionButton: false,\n\t\t\tshowUserAlreadyBelongsToDepartmentPopup: false,\n\t\t\taccessDenied: false,\n\t\t};\n\t},\n\n\tmounted(): void\n\t{\n\t\tconst departmentContainer = this.$refs['department-selector'];\n\t\tthis.departmentSelector = this.createTagSelector();\n\t\tthis.departmentSelector.renderTo(departmentContainer);\n\t},\n\n\tcomputed: {\n\t\t...mapState(useChartStore, ['departments', 'focusedNode']),\n\t\tincludedNodeEntityTypesInDialog(): string[]\n\t\t{\n\t\t\treturn this.isTeamEntity ? ['team'] : ['department'];\n\t\t},\n\t\tgetMoveUserActionPhrase(): string\n\t\t{\n\t\t\tconst departmentName = Text.encode(this.departments.get(this.focusedNode).name ?? '');\n\t\t\tconst userName = Text.encode(this.user.name ?? '');\n\n\t\t\tlet phraseCode = '';\n\t\t\tif (this.isTeamEntity)\n\t\t\t{\n\t\t\t\tphraseCode = 'HUMANRESOURCES_DEPARTMENT_CONTENT_TAB_USER_ACTION_MENU_MOVE_TO_ANOTHER_TEAM_REMOVE_USER_DESCRIPTION';\n\t\t\t\tphraseCode += this.user.gender === 'F' ? '_F' : '_M';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tphraseCode = 'HUMANRESOURCES_DEPARTMENT_CONTENT_TAB_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_ALREADY_BELONGS_TO_DEPARTMENT_DESCRIPTION_MSGVER_1';\n\t\t\t}\n\n\t\t\treturn this.loc(\n\t\t\t\tphraseCode,\n\t\t\t\t{\n\t\t\t\t\t'#USER_NAME#': userName,\n\t\t\t\t\t'#DEPARTMENT_NAME#': departmentName,\n\t\t\t\t},\n\t\t\t)\n\t\t\t\t.replace(\n\t\t\t\t\t'[link]',\n\t\t\t\t\t`<a class=\"hr-department-detail-content__move-user-department-user-link\" href=\"${this.user.url}\">`,\n\t\t\t\t)\n\t\t\t\t.replace('[/link]', '</a>')\n\t\t\t;\n\t\t},\n\t\tgetUserAlreadyBelongsToDepartmentPopupPhrase(): string\n\t\t{\n\t\t\tconst departmentName = Text.encode(this.departments.get(this.selectedParentDepartment ?? 0).name ?? '');\n\t\t\tconst userName = Text.encode(this.user.name ?? '');\n\n\t\t\tlet phraseCode = '';\n\t\t\tif (this.isTeamEntity)\n\t\t\t{\n\t\t\t\tphraseCode = 'HUMANRESOURCES_DEPARTMENT_CONTENT_TAB_USER_ACTION_MENU_MOVE_TO_ANOTHER_TEAM_ALREADY_BELONGS_TO_TEAM_DESCRIPTION';\n\t\t\t\tphraseCode += this.user.gender === 'F' ? '_F' : '_M';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tphraseCode = 'HUMANRESOURCES_DEPARTMENT_CONTENT_TAB_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_ALREADY_BELONGS_TO_DEPARTMENT_DESCRIPTION_MSGVER_1';\n\t\t\t}\n\n\t\t\tlet phrase = this.loc(\n\t\t\t\tphraseCode,\n\t\t\t\t{\n\t\t\t\t\t'#USER_NAME#': userName,\n\t\t\t\t\t'#DEPARTMENT_NAME#': departmentName,\n\t\t\t\t},\n\t\t\t);\n\t\t\tphrase = phrase.replace('[link]', `<a class=\"hr-department-detail-content__move-user-department-user-link\" href=\"${this.user.url}\">`);\n\t\t\tphrase = phrase.replace('[/link]', '</a>');\n\n\t\t\treturn phrase;\n\t\t},\n\t\tmemberRoles(): MemberRolesType\n\t\t{\n\t\t\treturn getMemberRoles(this.entityType);\n\t\t},\n\t\tisTeamEntity(): boolean\n\t\t{\n\t\t\treturn this.entityType === EntityTypes.team;\n\t\t},\n\t\tconfirmTitle(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_MOVE_TO_ANOTHER_TEAM_POPUP_CONFIRM_TITLE')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_POPUP_CONFIRM_TITLE')\n\t\t\t;\n\t\t},\n\t\tconfirmDescription(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_USER_ACTION_MENU_MOVE_TO_ANOTHER_TEAM_POPUP_ACTION_SELECT_TEAM_DESCRIPTION')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_POPUP_ACTION_SELECT_DEPARTMENT_DESCRIPTION')\n\t\t\t;\n\t\t},\n\t},\n\n\tmethods: {\n\t\tcreateTagSelector(): TagSelector\n\t\t{\n\t\t\treturn new TagSelector({\n\t\t\t\tevents: {\n\t\t\t\t\tonTagAdd: (event: BaseEvent) => {\n\t\t\t\t\t\tthis.accessDenied = false;\n\t\t\t\t\t\tconst { tag } = event.data;\n\t\t\t\t\t\tthis.selectedParentDepartment = tag.id;\n\t\t\t\t\t\tif (PermissionChecker.hasPermission(this.action, tag.id))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.lockMoveUserActionButton = false;\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.accessDenied = true;\n\t\t\t\t\t\tthis.lockMoveUserActionButton = true;\n\t\t\t\t\t},\n\t\t\t\t\tonTagRemove: () => {\n\t\t\t\t\t\tthis.lockMoveUserActionButton = true;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tmultiple: false,\n\t\t\t\tdialogOptions: {\n\t\t\t\t\twidth: 425,\n\t\t\t\t\theight: 350,\n\t\t\t\t\tdropdownMode: true,\n\t\t\t\t\thideOnDeselect: true,\n\t\t\t\t\tentities: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'structure-node',\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tselectMode: 'departmentsOnly',\n\t\t\t\t\t\t\t\trestricted: 'addMember',\n\t\t\t\t\t\t\t\tincludedNodeEntityTypes: this.includedNodeEntityTypesInDialog,\n\t\t\t\t\t\t\t\tuseMultipleTabs: true,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tpreselectedItems: [['structure-node', this.parentId]],\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tasync confirmMoveUser(): Promise<void>\n\t\t{\n\t\t\tthis.showMoveUserActionLoader = true;\n\t\t\tconst departmentId = this.focusedNode;\n\t\t\tconst userId = this.user.id;\n\t\t\tconst targetNodeId = this.selectedParentDepartment;\n\n\t\t\ttry\n\t\t\t{\n\t\t\t\tawait DepartmentAPI.moveUserToDepartment(\n\t\t\t\t\tdepartmentId,\n\t\t\t\t\tuserId,\n\t\t\t\t\ttargetNodeId,\n\t\t\t\t);\n\t\t\t}\n\t\t\tcatch (error)\n\t\t\t{\n\t\t\t\tthis.showMoveUserActionLoader = false;\n\n\t\t\t\tconst code = error.code ?? 0;\n\n\t\t\t\tif (code === 'MEMBER_ALREADY_BELONGS_TO_NODE')\n\t\t\t\t{\n\t\t\t\t\tthis.showUserAlreadyBelongsToDepartmentPopup = true;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tconst phraseCode = this.isTeamEntity\n\t\t\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_USER_ACTION_MENU_MOVE_TO_ANOTHER_TEAM_ERROR')\n\t\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_ERROR')\n\t\t\t\t\t;\n\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: phraseCode,\n\t\t\t\t\t\tautoHideDelay: 2000,\n\t\t\t\t\t});\n\t\t\t\t\tthis.$emit('close');\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst departmentName = Text.encode(this.departments.get(targetNodeId)?.name ?? '');\n\t\t\tconst phraseCode = this.isTeamEntity\n\t\t\t\t? 'HUMANRESOURCES_DEPARTMENT_CONTENT_TAB_USER_ACTION_MENU_MOVE_TO_ANOTHER_TEAM_SUCCESS_MESSAGE'\n\t\t\t\t: 'HUMANRESOURCES_DEPARTMENT_CONTENT_TAB_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_SUCCESS_MESSAGE'\n\t\t\t;\n\t\t\tUI.Notification.Center.notify({\n\t\t\t\tcontent: this.loc(\n\t\t\t\t\tphraseCode,\n\t\t\t\t\t{\n\t\t\t\t\t\t'#DEPARTMENT_NAME#': departmentName,\n\t\t\t\t\t},\n\t\t\t\t),\n\t\t\t\tautoHideDelay: 2000,\n\t\t\t});\n\n\t\t\tDepartmentContentActions.moveUserToDepartment(\n\t\t\t\tdepartmentId,\n\t\t\t\tuserId,\n\t\t\t\ttargetNodeId,\n\t\t\t\tthis.user.role ?? this.memberRoles.employee,\n\t\t\t);\n\n\t\t\tthis.$emit('action');\n\t\t\tthis.showMoveUserActionLoader = false;\n\t\t},\n\t\tcloseAction(): void\n\t\t{\n\t\t\tthis.$emit('close');\n\t\t},\n\t\tcloseUserAlreadyBelongsToDepartmentPopup(): void\n\t\t{\n\t\t\tthis.showUserAlreadyBelongsToDepartmentPopup = false;\n\t\t\tthis.closeAction();\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<ConfirmationPopup\n\t\t\t@action=\"confirmMoveUser\"\n\t\t\t@close=\"closeAction\"\n\t\t\t:showActionButtonLoader=\"showMoveUserActionLoader\"\n\t\t\t:lockActionButton=\"lockMoveUserActionButton\"\n\t\t\t:title=\"confirmTitle\"\n\t\t\t:confirmBtnText = \"loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_POPUP_CONFIRM_BUTTON')\"\n\t\t\t:width=\"364\"\n\t\t>\n\t\t\t<template v-slot:content>\n\t\t\t\t<div class=\"hr-department-detail-content__user-action-text-container\">\n\t\t\t\t\t<div v-html=\"getMoveUserActionPhrase\"/>\n\t\t\t\t\t<span>\n\t\t\t\t\t\t{{confirmDescription}}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tclass=\"hr-department-detail-content__move-user-department-selector\"\n\t\t\t\t\tref=\"department-selector\"\n\t\t\t\t\t:class=\"{ 'ui-ctl-warning': accessDenied }\"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"accessDenied\"\n\t\t\t\t\tclass=\"hr-department-detail-content__move-user-department_item-error\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"ui-icon-set --warning\"></div>\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass=\"hr-department-detail-content__move-user-department_item-error-message\"\n\t\t\t\t\t>\n\t\t\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_PERMISSION_ERROR')}}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</ConfirmationPopup>\n\t\t<ConfirmationPopup\n\t\t\t@action=\"closeUserAlreadyBelongsToDepartmentPopup\"\n\t\t\t@close=\"closeUserAlreadyBelongsToDepartmentPopup\"\n\t\t\tv-if=\"showUserAlreadyBelongsToDepartmentPopup\"\n\t\t\t:withoutTitleBar = true\n\t\t\t:onlyConfirmButtonMode = true\n\t\t\t:confirmBtnText = \"loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_ALREADY_BELONGS_TO_DEPARTMENT_CLOSE_BUTTON')\"\n\t\t\t:width=\"300\"\n\t\t>\n\t\t\t<template v-slot:content>\n\t\t\t\t<div class=\"hr-department-detail-content__user-action-text-container\">\n\t\t\t\t\t<div \n\t\t\t\t\t\tclass=\"hr-department-detail-content__user-belongs-to-department-text-container\"\n\t\t\t\t\t\tv-html=\"getUserAlreadyBelongsToDepartmentPopupPhrase\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"hr-department-detail-content__move-user-department-selector\" ref=\"department-selector\"></div>\n\t\t\t</template>\n\t\t</ConfirmationPopup>\n\t`,\n};\n","import { RouteActionMenu, ConfirmationPopup } from 'humanresources.company-structure.structure-components';\nimport { Text } from 'main.core';\nimport { UserListActionMenu, MenuActions } from 'humanresources.company-structure.org-chart';\nimport { DepartmentAPI } from '../../../api';\nimport { DepartmentContentActions } from '../../../actions';\nimport { memberRoles } from 'humanresources.company-structure.api';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { mapState } from 'ui.vue3.pinia';\nimport { MoveUserActionPopup } from './move-user-action-popup';\nimport { UI } from 'ui.notification';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\n\nimport './styles/action-button.css';\n\nexport const UserListItemActionButton = {\n\tname: 'userList',\n\n\tprops: {\n\t\tuser: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tdepartmentId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tcomponents: {\n\t\tRouteActionMenu,\n\t\tConfirmationPopup,\n\t\tMoveUserActionPopup,\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tmenuVisible: {},\n\t\t\tshowRemoveUserConfirmationPopup: false,\n\t\t\tshowRemoveUserConfirmationActionLoader: false,\n\t\t\tshowMoveUserPopup: false,\n\t\t\tshowFireUserPopup: false,\n\t\t\tfireUserLoad: false,\n\t\t};\n\t},\n\n\tmethods: {\n\t\ttoggleMenu(userId)\n\t\t{\n\t\t\tthis.menuVisible[userId] = !this.menuVisible[userId];\n\t\t},\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tonActionMenuItemClick(actionId: string): void\n\t\t{\n\t\t\tif (actionId === MenuActions.removeUserFromDepartment)\n\t\t\t{\n\t\t\t\tthis.showRemoveUserConfirmationPopup = true;\n\t\t\t}\n\n\t\t\tif (actionId === MenuActions.moveUserToAnotherDepartment)\n\t\t\t{\n\t\t\t\tthis.showMoveUserPopup = true;\n\t\t\t}\n\n\t\t\tif (actionId === MenuActions.fireUserFromCompany)\n\t\t\t{\n\t\t\t\tthis.showFireUserPopup = true;\n\t\t\t}\n\t\t},\n\t\tasync removeUser(): Promise<void>\n\t\t{\n\t\t\tthis.showRemoveUserConfirmationActionLoader = true;\n\t\t\tconst userId = this.user.id;\n\t\t\tconst isUserInMultipleDepartments = await DepartmentAPI.isUserInMultipleDepartments(userId);\n\t\t\tconst departmentId = this.focusedNode;\n\t\t\tthis.showRemoveUserConfirmationActionLoader = false;\n\t\t\tthis.showRemoveUserConfirmationPopup = false;\n\n\t\t\ttry\n\t\t\t{\n\t\t\t\tawait DepartmentAPI.removeUserFromDepartment(departmentId, userId);\n\t\t\t}\n\t\t\tcatch\n\t\t\t{\n\t\t\t\tconst phraseCode = this.isTeamEntity\n\t\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_TEAM_ERROR')\n\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_DEPARTMENT_ERROR')\n\t\t\t\t;\n\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\tcontent: phraseCode,\n\t\t\t\t\tautoHideDelay: 2000,\n\t\t\t\t});\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst phraseCode = this.isTeamEntity\n\t\t\t\t? 'HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_TEAM_SUCCESS'\n\t\t\t\t: 'HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_DEPARTMENT_SUCCESS';\n\t\t\tconst departmentName = Text.encode(this.departments.get(this.focusedNode).name ?? '');\n\t\t\tUI.Notification.Center.notify({\n\t\t\t\tcontent: this.loc(phraseCode, { '#DEPARTMENT_NAME#': departmentName }),\n\t\t\t\tautoHideDelay: 2000,\n\t\t\t});\n\n\t\t\tconst role = this.user.role;\n\t\t\tif (isUserInMultipleDepartments || this.isTeamEntity)\n\t\t\t{\n\t\t\t\tDepartmentContentActions.removeUserFromDepartment(departmentId, userId, role);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst rootDepartment = [...this.departments.values()].find((department) => department.parentId === 0);\n\t\t\tif (!rootDepartment)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tDepartmentContentActions.moveUserToDepartment(\n\t\t\t\tdepartmentId,\n\t\t\t\tuserId,\n\t\t\t\trootDepartment.id,\n\t\t\t\trole,\n\t\t\t);\n\t\t},\n\t\tcancelRemoveUser(): void\n\t\t{\n\t\t\tthis.showRemoveUserConfirmationPopup = false;\n\t\t},\n\t\tasync fireUser(): void\n\t\t{\n\t\t\tthis.fireUserLoad = true;\n\n\t\t\tconst userId = this.user.id;\n\n\t\t\ttry\n\t\t\t{\n\t\t\t\tawait DepartmentAPI.fireUser(userId);\n\t\t\t}\n\t\t\tcatch (error)\n\t\t\t{\n\t\t\t\tif (error.code !== 'STRUCTURE_ACCESS_DENIED')\n\t\t\t\t{\n\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: this.user.isInvited\n\t\t\t\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_DELETE_ERROR')\n\t\t\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_FIRE_ERROR'),\n\t\t\t\t\t\tautoHideDelay: 2000,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tthis.showFireUserPopup = false;\n\t\t\t\tthis.fireUserLoad = false;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tDepartmentContentActions.removeUserFromDepartment(this.focusedNode, userId, this.user.role);\n\t\t\tawait DepartmentContentActions.removeUserFromAllDepartments(userId);\n\t\t\tthis.showFireUserPopup = false;\n\t\t\tthis.fireUserLoad = false;\n\t\t},\n\t\tcancelFireUser(): void\n\t\t{\n\t\t\tthis.showFireUserPopup = false;\n\t\t},\n\t\thandleMoveUserAction(): void\n\t\t{\n\t\t\tthis.showMoveUserPopup = false;\n\t\t},\n\t\thandleMoveUserClose(): void\n\t\t{\n\t\t\tthis.showMoveUserPopup = false;\n\t\t},\n\t\tgetMemberKeyByValue(value: string): string\n\t\t{\n\t\t\treturn Object.keys(memberRoles).find((key) => memberRoles[key] === value) || '';\n\t\t},\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.menu = new UserListActionMenu(this.focusedNode, this.entityType, this.user.isInvited);\n\t},\n\n\tcomputed: {\n\t\t...mapState(useChartStore, ['focusedNode', 'departments']),\n\t\tmemberRoles(): typeof memberRoles\n\t\t{\n\t\t\treturn memberRoles;\n\t\t},\n\t\tgetFirePopupDescription(): string\n\t\t{\n\t\t\tconst userName = Text.encode(this.user.name ?? '');\n\t\t\tconst userUrl = Text.encode(this.user.url ?? '');\n\t\t\tconst genderSuffix = this.user.gender === 'F' ? '_F' : '_M';\n\n\t\t\tconst phrase = this.user.isInvited\n\t\t\t\t? `HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_DELETE_POPUP_DESCRIPTION${genderSuffix}`\n\t\t\t\t: `HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_FIRE_POPUP_DESCRIPTION${genderSuffix}`\n\t\t\t;\n\n\t\t\tconst description = this.loc(phrase, {\n\t\t\t\t'#USER_NAME#': userName,\n\t\t\t});\n\n\t\t\treturn description.replace('[link]', `<a class=\"hr-department-detail-content__fire-user-link\" href=\"${userUrl}\">`)\n\t\t\t\t.replace('[/link]', '</a>')\n\t\t\t;\n\t\t},\n\t\tgetFirePopupTitle(): string\n\t\t{\n\t\t\treturn this.user.isInvited\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_DELETE_POPUP_TITLE')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_FIRE_POPUP_TITLE');\n\t\t},\n\t\tgetFirePopupButtonText(): string\n\t\t{\n\t\t\treturn this.user.isInvited\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_DELETE_POPUP_CONFIRM_BUTTON')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_FIRE_POPUP_CONFIRM_BUTTON');\n\t\t},\n\t\tgetRemovePopupTitle(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_TEAM_POPUP_TITLE')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_DEPARTMENT_POPUP_TITLE');\n\t\t},\n\t\tgetRemovePopupDescription(): string\n\t\t{\n\t\t\tconst departmentName = Text.encode(this.departments.get(this.focusedNode).name ?? '');\n\t\t\tconst userName = Text.encode(this.user.name ?? '');\n\n\t\t\tif (this.isTeamEntity)\n\t\t\t{\n\t\t\t\tconst phraseCode = 'HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_TEAM_POPUP_DESCRIPTION';\n\t\t\t\tconst genderSuffix = this.user.gender === 'F' ? '_F' : '_M';\n\n\t\t\t\treturn this.loc(\n\t\t\t\t\tphraseCode + genderSuffix,\n\t\t\t\t\t{\n\t\t\t\t\t\t'#USER_NAME#': userName,\n\t\t\t\t\t\t'#DEPARTMENT_NAME#': departmentName,\n\t\t\t\t\t},\n\t\t\t\t)\n\t\t\t\t\t.replace(\n\t\t\t\t\t\t'[link]',\n\t\t\t\t\t\t`<a class=\"hr-department-detail-content__move-user-department-user-link\" href=\"${this.user.url}\">`,\n\t\t\t\t\t)\n\t\t\t\t\t.replace('[/link]', '</a>')\n\t\t\t\t;\n\t\t\t}\n\n\t\t\treturn this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_DEPARTMENT_POPUP_DESCRIPTION');\n\t\t},\n\t\tentityType(): string\n\t\t{\n\t\t\treturn this.departments.get(this.focusedNode)?.entityType;\n\t\t},\n\t\tisTeamEntity(): boolean\n\t\t{\n\t\t\treturn this.entityType === EntityTypes.team;\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<button\n\t\t\tv-if=\"menu.items.length\"\n\t\t\tclass=\"ui-icon-set --more hr-department-detail-content__user-action-btn\"\n\t\t\t:class=\"{ '--focused': menuVisible[user.id] }\"\n\t\t\t@click.stop=\"toggleMenu(user.id)\"\n\t\t\tref=\"actionUserButton\"\n\t\t\t:data-id=\"'hr-department-detail-content__'+ getMemberKeyByValue(user.role) + '-list_user-' + user.id + '-action-btn'\"\n\t\t/>\n\t\t<RouteActionMenu\n\t\t\tv-if=\"menuVisible[user.id]\"\n\t\t\t:id=\"'tree-node-department-menu-' + user.id\"\n\t\t\t:items=\"menu.items\"\n\t\t\t:width=\"302\"\n\t\t\t:bindElement=\"$refs.actionUserButton\"\n\t\t\t@action=\"onActionMenuItemClick\"\n\t\t\t@close=\"menuVisible[user.id] = false\"\n\t\t/>\n\t\t<ConfirmationPopup\n\t\t\tref=\"removeUserConfirmationPopup\"\n\t\t\tv-if=\"showRemoveUserConfirmationPopup\"\n\t\t\t:showActionButtonLoader=\"showRemoveUserConfirmationActionLoader\"\n\t\t\t:title=\"getRemovePopupTitle\"\n\t\t\t:confirmBtnText=\"loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_USER_ACTION_MENU_REMOVE_FROM_DEPARTMENT_POPUP_CONFIRM_BUTTON')\"\n\t\t\t:confirmButtonClass=\"isTeamEntity ? 'ui-btn-danger' : 'ui-btn-primary'\"\n\t\t\t@action=\"removeUser\"\n\t\t\t@close=\"cancelRemoveUser\"\n\t\t\t:width=\"364\"\n\t\t>\n\t\t\t<template v-slot:content>\n\t\t\t\t<div class=\"hr-department-detail-content__user-action-text-container\">\n\t\t\t\t<div\n\t\t\t\t\tv-html=\"getRemovePopupDescription\"\n\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</ConfirmationPopup>\n\t\t<ConfirmationPopup\n\t\t\tref=\"fireUserConfirmationPopup\"\n\t\t\tv-if=\"showFireUserPopup\"\n\t\t\t:showActionButtonLoader=\"fireUserLoad\"\n\t\t\t:title=\"getFirePopupTitle\"\n\t\t\t:confirmBtnText=\"getFirePopupButtonText\"\n\t\t\t:confirmButtonClass=\"'ui-btn-danger'\"\n\t\t\t@action=\"fireUser\"\n\t\t\t@close=\"cancelFireUser\"\n\t\t\t:width=\"364\"\n\t\t>\n\t\t\t<template v-slot:content>\n\t\t\t\t<div class=\"hr-department-detail-content__user-action-text-container\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-html=\"getFirePopupDescription\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</ConfirmationPopup>\n\t\t<MoveUserActionPopup\n\t\t\tv-if=\"showMoveUserPopup\"\n\t\t\t:parentId=\"focusedNode\"\n\t\t\t:user=\"user\"\n\t\t\t:entityType=\"entityType\"\n\t\t\t@action=\"handleMoveUserAction\"\n\t\t\t@close=\"handleMoveUserClose\"\n\t\t/>\n\t`,\n};\n","import { getMemberRoles, type MemberRolesType } from 'humanresources.company-structure.api';\nimport { UserListItemActionButton } from './action-button';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { mapState } from 'ui.vue3.pinia';\n\nimport 'ui.tooltip';\nimport './styles/item.css';\n\nexport const UserListItem = {\n\tname: 'userList',\n\n\tprops: {\n\t\tuser: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tselectedUserId: {\n\t\t\ttype: Number,\n\t\t\trequired: false,\n\t\t\tdefault: null,\n\t\t},\n\t\tentityType: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tcomponents: { UserListItemActionButton },\n\n\tcomputed: {\n\t\tmemberRoles(): MemberRolesType\n\t\t{\n\t\t\treturn getMemberRoles(this.entityType);\n\t\t},\n\t\tdefaultAvatar(): string\n\t\t{\n\t\t\treturn '/bitrix/js/humanresources/company-structure/org-chart/src/images/default-user.svg';\n\t\t},\n\t\t...mapState(useChartStore, ['focusedNode']),\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\thandleUserClick(item): void\n\t\t{\n\t\t\tBX.SidePanel.Instance.open(item.url, {\n\t\t\t\tcacheable: false,\n\t\t\t});\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div \n\t\t\t:key=\"user.id\"\n\t\t\tclass=\"hr-department-detail-content__user-container\"\n\t\t\t:class=\"{ '--searched': user.id === selectedUserId }\"\n\t\t\t:data-id=\"'hr-department-detail-content__user-' + user.id + '-item'\"\n\t\t>\n\t\t\t<div class=\"hr-department-detail-content__user-avatar-container\" @click=\"handleUserClick(user)\">\n\t\t\t\t<img \n\t\t\t\t\tclass=\"hr-department-detail-content__user-avatar-img\"\n\t\t\t\t\t:src=\"user.avatar ? encodeURI(user.avatar) : defaultAvatar\"\n\t\t\t\t/>\n\t\t\t\t<div v-if=\"user.role === memberRoles.head\" class=\"hr-department-detail-content__user-avatar-overlay\"></div>\n\t\t\t</div>\n\t\t\t<div class=\"hr-department-detail-content-user__text-container\">\n\t\t\t\t<div class=\"hr-department-detail-content__user-title\">\n\t\t\t\t\t<div \n\t\t\t\t\t\tclass=\"hr-department-detail-content__user-name\" \n\t\t\t\t\t\t@click=\"handleUserClick(user)\"\n\t\t\t\t\t\t:bx-tooltip-user-id=\"user.id\"\n\t\t\t\t\t\tbx-tooltip-context=\"b24\"\n\t\t\t\t\t\t:data-id=\"'hr-department-detail-content__user-' + user.id + '-item-name'\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ user.name }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if=\"user.badgeText\" class=\"hr-department-detail-content-user__name-badge\">{{ user.badgeText }}</div>\n\t\t\t\t</div>\n\t\t\t\t<div \n\t\t\t\t\tclass=\"hr-department-detail-content__user-subtitle\" \n\t\t\t\t\t:class=\"{ '--without-work-position': !user.subtitle }\"\n\t\t\t\t>\n\t\t\t\t\t{{ (user.subtitle?.length ?? 0) > 0 ? user.subtitle : this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_LIST_DEFAULT_WORK_POSITION') }}\n\t\t\t\t</div>\n\t\t\t\t<div v-if=\"user.isInvited\" class=\"hr-department-detail-content-user__item-badge\">\n\t\t\t\t\t{{ this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_LIST_INVITED_BADGE_TEXT') }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<UserListItemActionButton\n\t\t\t\t:user=\"user\"\n\t\t\t\t:departmentId=\"focusedNode\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import 'ui.icon-set.main';\nimport './empty-state.css';\n\nexport const EmptyState = {\n\tname: 'emptyState',\n\n\tprops: {\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t},\n\t\timageClass: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t},\n\t\tdescription: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t},\n\t\tlist: {\n\t\t\ttype: Array,\n\t\t\trequired: false,\n\t\t\tdefault: [],\n\t\t},\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"hr-department-detail-content_tab__empty-state-container\">\n\t\t\t<div v-if=\"imageClass\" :class=\"['hr-department-detail-content_tab__empty-state-icon', imageClass]\"/>\n\t\t\t<span v-if=\"title\" class=\"hr-department-detail-content__empty-tab-entity-title\">\n\t\t\t\t{{ title }}\n\t\t\t</span>\n\t\t\t<span v-if=\"description\" class=\"hr-department-detail-content_tab__empty-state-description\">\n\t\t\t\t{{ description }}\n\t\t\t</span>\n\t\t\t<div v-if=\"list.length > 0\" class=\"hr-department-detail-content_tab__empty-state-list\">\n\t\t\t\t<div class=\"hr-department-detail-content_tab__empty-state-list-item\"  v-for=\"item in list\">\n\t\t\t\t\t<div \n\t\t\t\t\t\tclass=\"ui-icon-set --circle-check hr-department-detail-content_tab__empty-state-list-item-check\"\n\t\t\t\t\t\tstyle=\"--ui-icon-set__icon-size: 20px;\"\n\t\t\t\t\t/>\n\t\t\t\t\t<div class=\"hr-department-detail-content_tab__empty-state-list--item-text\">\n\t\t\t\t\t\t{{ item.text }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<slot name=\"content\"/>\n\t\t</div>\n\t`,\n};\n","import './styles/empty-list-item.css';\n\nexport const EmptyListItem = {\n\tname: 'tabEmptyListItem',\n\n\tprops: {\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\timageClass: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\twithAddPermission: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t\tdefault: true,\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div :class=\"['hr-department-detail-content__tab-empty-list_item-wrapper', { '--with-add': withAddPermission }]\">\n\t\t\t<div class=\"hr-department-detail-content__tab-empty-list_item-image\" :class=\"imageClass\"/>\n\t\t\t<div class=\"hr-department-detail-content__tab-empty-list_item-content\">\n\t\t\t\t<div class=\"hr-department-detail-content__tab-empty-list_item-title\">\n\t\t\t\t\t{{ title }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};","import { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { mapState } from 'ui.vue3.pinia';\nimport { RouteActionMenu } from 'humanresources.company-structure.structure-components';\nimport './styles/list-action-button.css';\n\nexport const ListActionButton = {\n\tname: 'userListActionButton',\n\temits: ['tabListAction', 'close'],\n\n\tprops:\n\t\t{\n\t\t\tid: {\n\t\t\t\ttype: String,\n\t\t\t\trequired: true,\n\t\t\t},\n\t\t\tmenuItems: {\n\t\t\t\ttype: Array,\n\t\t\t\trequired: true,\n\t\t\t},\n\t\t\tdataTestIds: {\n\t\t\t\ttype: Object,\n\t\t\t\trequired: false,\n\t\t\t\tdefault: {},\n\t\t\t},\n\t\t},\n\n\tcomponents:\n\t{\n\t\tRouteActionMenu,\n\t},\n\n\tcomputed:\n\t{\n\t\t...mapState(useChartStore, ['focusedNode']),\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tmenuVisible: false,\n\t\t};\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tonActionMenuItemClick(itemId: string): void\n\t\t{\n\t\t\tthis.$emit('tabListAction', itemId);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<button\n\t\t\tv-if=\"menuItems.length\"\n\t\t\tclass=\"hr-department-detail-content__tab-list_header-button\"\n\t\t\t:class=\"{ '--focused': menuVisible }\"\n\t\t\t:ref=\"id + '-route-action-menu'\"\n\t\t\t@click.stop=\"menuVisible = true\"\n\t\t\t:data-test-id=\"dataTestIds.buttonDataTestId\"\n\t\t>\n\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_LIST_ACTION_BUTTON_TITLE') }}\n\t\t</button>\n\t\t<RouteActionMenu\n\t\t\tv-if=\"menuVisible\"\n\t\t\t:id=\"id + '-route-action-menu'\"\n\t\t\t:items=\"menuItems\"\n\t\t\t:width=\"302\"\n\t\t\t:bindElement=\"$refs[id + '-route-action-menu']\"\n\t\t\t:containerDataTestId=\"dataTestIds.containerDataTestId\"\n\t\t\t@action=\"onActionMenuItemClick\"\n\t\t\t@close=\"menuVisible = false\"\n\t\t/>\n\t`,\n};\n","import { Type } from 'main.core';\nimport { EmptyListItem } from './empty-list-item';\nimport { ListActionButton } from './list-action-button';\n// eslint-disable-next-line no-unused-vars\nimport type { TabListDataTestIds } from './types';\nimport './styles/list.css';\n\nexport const TabList = {\n\tname: 'tabList',\n\tcomponents: { ListActionButton, EmptyListItem },\n\temits: ['tabListAction'],\n\n\tprops: {\n\t\tid: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tcount: {\n\t\t\ttype: Number,\n\t\t\trequired: false,\n\t\t},\n\t\tmenuItems: {\n\t\t\ttype: Array,\n\t\t\trequired: false,\n\t\t\tdefault: [],\n\t\t},\n\t\tlistItems: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\temptyItemTitle: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t},\n\t\temptyItemImageClass: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t},\n\t\thideEmptyItem: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t\tdefault: false,\n\t\t},\n\t\twithAddPermission: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t\tdefault: true,\n\t\t},\n\t\t/** @var { TabListDataTestIds } dataTestIds */\n\t\tdataTestIds: {\n\t\t\ttype: Object,\n\t\t\trequired: false,\n\t\t\tdefault: {},\n\t\t},\n\t},\n\n\tcomputed: {\n\t\tneedToShowCount(): boolean\n\t\t{\n\t\t\treturn Type.isNumber(this.count);\n\t\t},\n\t},\n\n\tmethods: {\n\t\tonActionMenuItemClick(actionId: string): void\n\t\t{\n\t\t\tthis.$emit('tabListAction', actionId);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"hr-department-detail-content__tab-list_container\"\n\t\t\t :data-test-id=\"dataTestIds.containerDataTestId\"\n\t\t>\n\t\t\t<div class=\"hr-department-detail-content__tab-list_header-container\">\n\t\t\t\t<div class=\"hr-department-detail-content__tab-list_list-title\">\n\t\t\t\t\t{{ title}}\n\t\t\t\t\t<span\n\t\t\t\t\t\tv-if=\"needToShowCount\"\n\t\t\t\t\t\tclass=\"hr-department-detail-content__tab-list_header-count\"\n\t\t\t\t\t\t:data-test-id=\"dataTestIds.listCounterDataTestId\"\n\t\t\t\t\t>\n\t\t\t\t\t{{ count }}\n\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<ListActionButton\n\t\t\t\t\t:id=\"id\"\n\t\t\t\t\t:menuItems=\"menuItems\"\n\t\t\t\t\t@tabListAction=\"onActionMenuItemClick\"\n\t\t\t\t\t:dataTestIds=\"{buttonDataTestId: dataTestIds.listActionButtonDataTestId, containerDataTestId: dataTestIds.listActonMenuDataTestId}\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class=\"hr-department-detail-content__tab_list-container\">\n\t\t\t\t<template v-for=\"(item) in listItems\">\n\t\t\t\t\t<slot :item=\"item\"/>\n\t\t\t\t</template>\n\t\t\t\t<EmptyListItem v-if=\"emptyItemTitle && emptyItemImageClass && !listItems.length && !hideEmptyItem\"\n\t\t\t\t\t:title=\"emptyItemTitle\"\n\t\t\t\t\t:imageClass=\"emptyItemImageClass\"\n\t\t\t\t\t:withAddPermission=\"withAddPermission\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import 'ui.icon-set.main';\nimport './search-input.css';\n\nexport const SearchInput = {\n\tname: 'searchInput',\n\tprops: {\n\t\tvalue: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: '',\n\t\t},\n\t\tplaceholder: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tdataTestId: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t},\n\t},\n\n\tdata(): {hasFocus: boolean}\n\t{\n\t\treturn {\n\t\t\thasFocus: false,\n\t\t};\n\t},\n\n\tmethods: {\n\t\thandleInput(event: InputEvent): void\n\t\t{\n\t\t\tthis.$emit('inputChange', event.target.value);\n\t\t},\n\t\thandleBlur(): void\n\t\t{\n\t\t\tif (this.value.length === 0)\n\t\t\t{\n\t\t\t\tthis.hasFocus = false;\n\t\t\t}\n\t\t},\n\t\tclearInput(): void\n\t\t{\n\t\t\tthis.hasFocus = false;\n\t\t\tthis.$emit('inputChange', '');\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"hr-department-detail-content__content-search\"\n\t\t\t:class=\"{'--focused': hasFocus}\"\n\t\t>\n\t\t\t<div class=\"hr-department-detail-content__content-search-icon ui-icon-set --search-1\"/>\n\t\t\t<input\n\t\t\t\tclass=\"hr-department-detail-content__content-search-input\"\n\t\t\t\ttype=\"text\"\n\t\t\t\t:placeholder=\"!hasFocus ?  placeholder : ''\"\n\t\t\t\t:data-test-id=\"dataTestId\"\n\t\t\t\t:value=\"value\"\n\t\t\t\t@input=\"handleInput\"\n\t\t\t\t@focus=\"hasFocus = true\"\n\t\t\t\t@blur=\"handleBlur\"\n\t\t\t>\n\t\t\t<div\n\t\t\t\tclass=\"hr-department-detail-content__content-search-close-button ui-icon-set --cross-circle-50\"\n\t\t\t\t:class=\"{'--hide': !hasFocus}\"\n\t\t\t\t@click=\"clearInput\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { EntityTypes } from 'humanresources.company-structure.utils';\nimport { mapState, mapWritableState } from 'ui.vue3.pinia';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { getMemberRoles, MemberRolesType } from 'humanresources.company-structure.api';\nimport { PermissionActions, PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport { AnalyticsSourceType } from 'humanresources.company-structure.api';\nimport { UsersTabActionMenu } from 'humanresources.company-structure.org-chart';\nimport { HeadListDataTestIds, EmployeeListDataTestIds } from './consts';\nimport { EmptyTabAddButton } from './empty-tab-add-button';\nimport { UserListItem } from './item/item';\nimport { EmptyState } from '../base-components/empty-state/empty-state';\nimport { TabList } from '../base-components/list/list';\nimport { SearchInput } from '../base-components/search/search-input';\nimport { DepartmentAPI } from '../../api';\nimport { DepartmentContentActions } from '../../actions';\nimport type { TabListDataTestIds } from '../base-components/list/types';\n\nimport 'ui.buttons';\nimport './styles/tab.css';\n\ntype DepartmentUsersStatus = {\n\tdepartmentId: number;\n\tloaded: boolean;\n};\n\n// @vue/component\nexport const UsersTab = {\n\tname: 'usersTab',\n\n\tcomponents: {\n\t\tSearchInput,\n\t\tEmptyState,\n\t\tTabList,\n\t\tEmptyTabAddButton,\n\t\tUserListItem,\n\t},\n\n\temits: ['showDetailLoader', 'hideDetailLoader'],\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tsearchQuery: '',\n\t\t\tselectedUserId: null,\n\t\t\tneedToScroll: false,\n\t\t};\n\t},\n\n\tcomputed: {\n\t\tmemberRoles(): MemberRolesType\n\t\t{\n\t\t\treturn getMemberRoles(this.entityType);\n\t\t},\n\t\theads(): Array\n\t\t{\n\t\t\treturn this.departments.get(this.focusedNode).heads ?? [];\n\t\t},\n\t\theadCount(): number\n\t\t{\n\t\t\treturn this.heads.length ?? 0;\n\t\t},\n\t\tdepartmentId(): number\n\t\t{\n\t\t\treturn this.focusedNode;\n\t\t},\n\t\tformattedHeads(): Array\n\t\t{\n\t\t\treturn this.heads.map((head) => ({\n\t\t\t\t...head,\n\t\t\t\tsubtitle: head.workPosition,\n\t\t\t\tbadgeText: this.getBadgeText(head.role),\n\t\t\t})).sort((a, b) => {\n\t\t\t\tconst roleOrder = {\n\t\t\t\t\t[this.memberRoles.head]: 1,\n\t\t\t\t\t[this.memberRoles.deputyHead]: 2,\n\t\t\t\t};\n\n\t\t\t\tconst roleA = roleOrder[a.role] || 3;\n\t\t\t\tconst roleB = roleOrder[b.role] || 3;\n\n\t\t\t\treturn roleA - roleB;\n\t\t\t});\n\t\t},\n\t\tfilteredHeads(): Array\n\t\t{\n\t\t\treturn this.formattedHeads.filter(\n\t\t\t\t(head) => head.name.toLowerCase().includes(this.searchQuery.toLowerCase())\n\t\t\t\t\t|| head.workPosition?.toLowerCase().includes(this.searchQuery.toLowerCase()),\n\t\t\t);\n\t\t},\n\t\temployeeCount(): number\n\t\t{\n\t\t\tconst memberCount = this.departments.get(this.focusedNode).userCount ?? 0;\n\n\t\t\treturn memberCount - (this.headCount ?? 0);\n\t\t},\n\t\tformattedEmployees(): Array\n\t\t{\n\t\t\treturn this.employees.map((employee) => ({\n\t\t\t\t...employee,\n\t\t\t\tsubtitle: employee.workPosition,\n\t\t\t})).reverse();\n\t\t},\n\t\tfilteredEmployees(): Array\n\t\t{\n\t\t\treturn this.formattedEmployees.filter(\n\t\t\t\t(employee) => employee.name.toLowerCase().includes(this.searchQuery.toLowerCase())\n\t\t\t\t\t|| employee.workPosition?.toLowerCase().includes(this.searchQuery.toLowerCase()),\n\t\t\t);\n\t\t},\n\t\tmemberCount(): number\n\t\t{\n\t\t\treturn this.departments.get(this.focusedNode).userCount ?? 0;\n\t\t},\n\t\t...mapState(useChartStore, ['focusedNode', 'departments', 'searchedUserId']),\n\t\t...mapWritableState(useChartStore, ['searchedUserId']),\n\t\temployees(): Array\n\t\t{\n\t\t\treturn this.departments.get(this.focusedNode)?.employees ?? [];\n\t\t},\n\t\tshowSearchBar(): boolean\n\t\t{\n\t\t\treturn this.memberCount > 0;\n\t\t},\n\t\tshowSearchEmptyState(): boolean\n\t\t{\n\t\t\treturn this.filteredHeads.length === 0 && this.filteredEmployees.length === 0;\n\t\t},\n\t\tcanAddUsers(): boolean\n\t\t{\n\t\t\tconst permissionChecker = PermissionChecker.getInstance();\n\t\t\tif (!permissionChecker)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst nodeId = this.focusedNode;\n\t\t\tconst permission = this.isTeamEntity\n\t\t\t\t? PermissionActions.teamAddMember\n\t\t\t\t: PermissionActions.employeeAddToDepartment\n\t\t\t;\n\n\t\t\treturn permissionChecker.hasPermission(permission, nodeId);\n\t\t},\n\t\theadListEmptyStateTitle(): string\n\t\t{\n\t\t\tif (this.canAddUsers)\n\t\t\t{\n\t\t\t\treturn this.isTeamEntity\n\t\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_TEAM_HEAD_EMPTY_LIST_ITEM_TITLE')\n\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_HEAD_EMPTY_LIST_ITEM_TITLE');\n\t\t\t}\n\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_TEAM_HEAD_EMPTY_LIST_ITEM_TITLE_WITHOUT_ADD_PERMISSION')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_HEAD_EMPTY_LIST_ITEM_TITLE_WITHOUT_ADD_PERMISSION');\n\t\t},\n\t\temployeesListEmptyStateTitle(): string\n\t\t{\n\t\t\tif (this.canAddUsers)\n\t\t\t{\n\t\t\t\treturn this.isTeamEntity\n\t\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_TEAM_EMPLOYEE_EMPTY_LIST_ITEM_TITLE')\n\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_EMPLOYEE_EMPTY_LIST_ITEM_TITLE');\n\t\t\t}\n\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_TEAM_EMPLOYEE_EMPTY_LIST_ITEM_TITLE_WITHOUT_ADD_PERMISSION')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_EMPLOYEE_EMPTY_LIST_ITEM_TITLE_WITHOUT_ADD_PERMISSION');\n\t\t},\n\t\tshouldUpdateList(): boolean\n\t\t{\n\t\t\treturn this.departments.get(this.focusedNode).employeeListOptions?.shouldUpdateList ?? true;\n\t\t},\n\t\tdepartmentUsersStatus(): DepartmentUsersStatus\n\t\t{\n\t\t\tconst department = this.departments.get(this.focusedNode);\n\t\t\tif (department?.heads && department.employees)\n\t\t\t{\n\t\t\t\treturn { departmentId: this.focusedNode, loaded: true };\n\t\t\t}\n\n\t\t\treturn { departmentId: this.focusedNode, loaded: false };\n\t\t},\n\t\theadMenu(): UsersTabActionMenu\n\t\t{\n\t\t\treturn new UsersTabActionMenu(\n\t\t\t\tthis.focusedNode,\n\t\t\t\tAnalyticsSourceType.DETAIL,\n\t\t\t\t'head',\n\t\t\t\tthis.entityType,\n\t\t\t);\n\t\t},\n\t\temployeeMenu(): UsersTabActionMenu\n\t\t{\n\t\t\treturn new UsersTabActionMenu(\n\t\t\t\tthis.focusedNode,\n\t\t\t\tAnalyticsSourceType.DETAIL,\n\t\t\t\t'employee',\n\t\t\t\tthis.entityType,\n\t\t\t);\n\t\t},\n\t\tisEmployeeListOptionsSet(): boolean\n\t\t{\n\t\t\tconst department = this.departments.get(this.focusedNode) || {};\n\n\t\t\treturn department.employeeListOptions && Object.keys(department.employeeListOptions).length > 0;\n\t\t},\n\t\temployeeTitle(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_TEAM_EMPLOYEE_LIST_TITLE')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_EMPLOYEE_LIST_TITLE');\n\t\t},\n\t\tentityType(): string\n\t\t{\n\t\t\treturn this.departments.get(this.focusedNode)?.entityType;\n\t\t},\n\t\tisTeamEntity(): boolean\n\t\t{\n\t\t\treturn this.entityType === EntityTypes.team;\n\t\t},\n\t\temptyStateTitle(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_EMPLOYEES_TEAM_ADD_USER_TITLE')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_EMPLOYEES_ADD_USER_TITLE');\n\t\t},\n\t\temptyStateDescription(): string\n\t\t{\n\t\t\tif (this.canAddUsers)\n\t\t\t{\n\t\t\t\treturn this.isTeamEntity\n\t\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_EMPLOYEES_TEAM_ADD_USER_SUBTITLE')\n\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_EMPLOYEES_ADD_USER_SUBTITLE');\n\t\t\t}\n\n\t\t\t// text is in progress\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? ''\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_EMPLOYEES_ADD_USER_SUBTITLE');\n\t\t},\n\t},\n\n\twatch: {\n\t\tfocusedNode(newId: number): void\n\t\t{\n\t\t\tconst department = this.departments.get(newId) || {};\n\t\t\tif (!this.isEmployeeListOptionsSet)\n\t\t\t{\n\t\t\t\tconst employeeListOptions = {\n\t\t\t\t\tpage: 0,\n\t\t\t\t\tshouldUpdateList: true,\n\t\t\t\t\tisListUpdated: false,\n\t\t\t\t};\n\t\t\t\tDepartmentContentActions.updateEmployeeListOptions(newId, employeeListOptions);\n\t\t\t\tthis.departments.set(newId, department);\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tdepartment.employeeListOptions.page === 0\n\t\t\t\t&& department.employeeListOptions.isListUpdated === false\n\t\t\t\t&& department.employeeListOptions.shouldUpdateList === true\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.loadEmployeesAction();\n\t\t\t}\n\n\t\t\tthis.isDescriptionExpanded = false;\n\t\t\tthis.searchQuery = '';\n\n\t\t\tif (this.searchedUserId)\n\t\t\t{\n\t\t\t\tthis.needToFocusUserId = this.searchedUserId;\n\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\tthis.scrollToUser();\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tsearchedUserId: {\n\t\t\thandler(userId: number): void\n\t\t\t{\n\t\t\t\tif (!userId)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.needToFocusUserId = userId;\n\t\t\t\tif (this.isListUpdated)\n\t\t\t\t{\n\t\t\t\t\tthis.needToScroll = true;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.$nextTick(() => {\n\t\t\t\t\t\tthis.scrollToUser();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\timmediate: true,\n\t\t},\n\t\tasync searchQuery(newQuery: string): Promise<void>\n\t\t{\n\t\t\tawait this.searchMembers(newQuery);\n\t\t},\n\t\tdepartmentUsersStatus(usersStatus: DepartmentUsersStatus, prevUsersStatus: DepartmentUsersStatus): void\n\t\t{\n\t\t\tconst { departmentId, loaded } = usersStatus;\n\t\t\tconst { departmentId: prevDepartmentId, loaded: prevLoaded } = prevUsersStatus;\n\t\t\tif (departmentId === prevDepartmentId && loaded === prevLoaded)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (loaded)\n\t\t\t{\n\t\t\t\tthis.$emit('hideDetailLoader');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.$emit('showDetailLoader');\n\t\t\t\tthis.loadEmployeesAction();\n\t\t\t}\n\t\t},\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.loadEmployeesAction();\n\t\tthis.clearSearchTimeout = null;\n\t},\n\n\tmounted(): void\n\t{\n\t\tthis.tabContainer = this.$refs['tab-container'];\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode, replacements = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tgetBadgeText(role): ?string\n\t\t{\n\t\t\tif (role === this.memberRoles.head)\n\t\t\t{\n\t\t\t\treturn this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPLOYEES_HEAD_BADGE');\n\t\t\t}\n\n\t\t\tif (role === this.memberRoles.deputyHead)\n\t\t\t{\n\t\t\t\treturn this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPLOYEES_DEPUTY_HEAD_BADGE');\n\t\t\t}\n\n\t\t\treturn null;\n\t\t},\n\t\tupdateList(event): void\n\t\t{\n\t\t\tconst employeesList = event.target;\n\t\t\tconst scrollPosition = employeesList.scrollTop + employeesList.clientHeight;\n\n\t\t\tif (employeesList.scrollHeight - scrollPosition < 40)\n\t\t\t{\n\t\t\t\tthis.loadEmployeesAction();\n\t\t\t}\n\t\t},\n\t\tasync loadEmployeesAction(): void\n\t\t{\n\t\t\tconst nodeId = this.focusedNode;\n\n\t\t\tif (!this.departments.get(nodeId))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst employeeListOptions = this.departments.get(nodeId).employeeListOptions ?? {};\n\n\t\t\temployeeListOptions.page = employeeListOptions.page ?? 0;\n\t\t\temployeeListOptions.shouldUpdateList = employeeListOptions.shouldUpdateList ?? true;\n\t\t\temployeeListOptions.isListUpdated = employeeListOptions.isListUpdated ?? false;\n\t\t\tDepartmentContentActions.updateEmployeeListOptions(nodeId, employeeListOptions);\n\t\t\tif (employeeListOptions.isListUpdated || !employeeListOptions.shouldUpdateList)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t!employeeListOptions.isListUpdated\n\t\t\t\t&& employeeListOptions.page === 0\n\t\t\t\t&& employeeListOptions.shouldUpdateList === true\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.$emit('showDetailLoader');\n\t\t\t}\n\n\t\t\temployeeListOptions.isListUpdated = true;\n\t\t\temployeeListOptions.page += 1;\n\t\t\tDepartmentContentActions.updateEmployeeListOptions(nodeId, employeeListOptions);\n\n\t\t\tlet loadedEmployees = await DepartmentAPI.getPagedEmployees(nodeId, employeeListOptions.page, 25);\n\n\t\t\tif (!loadedEmployees)\n\t\t\t{\n\t\t\t\temployeeListOptions.shouldUpdateList = false;\n\t\t\t\temployeeListOptions.isListUpdated = false;\n\t\t\t\tDepartmentContentActions.updateEmployeeListOptions(nodeId, employeeListOptions);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tloadedEmployees = loadedEmployees.map((user) => {\n\t\t\t\treturn { ...user, role: this.memberRoles.employee };\n\t\t\t});\n\n\t\t\tconst employees = this.departments.get(nodeId)?.employees ?? [];\n\t\t\tconst employeeIds = new Set(employees.map((employee) => employee.id));\n\n\t\t\tconst newEmployees = loadedEmployees.reverse().filter((employee) => !employeeIds.has(employee.id));\n\t\t\temployees.unshift(...newEmployees);\n\t\t\temployeeListOptions.shouldUpdateList = newEmployees.length === 25;\n\t\t\temployeeListOptions.isListUpdated = false;\n\n\t\t\tDepartmentContentActions.updateEmployeeListOptions(nodeId, employeeListOptions);\n\t\t\tDepartmentContentActions.updateEmployees(nodeId, employees);\n\t\t\tif (this.departmentUsersStatus.loaded)\n\t\t\t{\n\t\t\t\tthis.$emit('hideDetailLoader');\n\t\t\t}\n\n\t\t\tif (this.needToScroll)\n\t\t\t{\n\t\t\t\tthis.scrollToUser();\n\t\t\t}\n\t\t},\n\t\tasync scrollToUser(): void\n\t\t{\n\t\t\tconst userId = this.needToFocusUserId;\n\t\t\tthis.needToFocusUserId = null;\n\t\t\tthis.needToScroll = false;\n\t\t\tconst selectors = `.hr-department-detail-content__user-container[data-id=\"hr-department-detail-content__user-${userId}-item\"]`;\n\t\t\tlet element = this.tabContainer.querySelector(selectors);\n\n\t\t\tif (!element)\n\t\t\t{\n\t\t\t\tlet user = null;\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tuser = await DepartmentAPI.getUserInfo(this.focusedNode, userId);\n\t\t\t\t}\n\t\t\t\tcatch\n\t\t\t\t{ /* empty */ }\n\n\t\t\t\tconst department = this.departments.get(this.focusedNode);\n\t\t\t\tif (!user || !department)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (user.role === this.memberRoles.head || user.role === this.memberRoles.deputyHead)\n\t\t\t\t{\n\t\t\t\t\tdepartment.heads = department.heads ?? [];\n\t\t\t\t\tif (!department.heads.some((head) => head.id === user.id))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tdepartment.employees = department.employees ?? [];\n\t\t\t\t\tif (!department.employees.some((employee) => employee.id === user.id))\n\t\t\t\t\t{\n\t\t\t\t\t\tdepartment.employees.push(user);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// eslint-disable-next-line vue/valid-next-tick\n\t\t\t\tawait this.$nextTick(() => {\n\t\t\t\t\telement = this.tabContainer.querySelector(selectors);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (!element)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\telement.scrollIntoView({ behavior: 'smooth', block: 'center' });\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.selectedUserId = userId;\n\t\t\t}, 750);\n\n\t\t\tif (this.clearSearchTimeout)\n\t\t\t{\n\t\t\t\tclearTimeout(this.clearSearchTimeout);\n\t\t\t}\n\n\t\t\tthis.clearSearchTimeout = setTimeout(() => {\n\t\t\t\tif (this.searchedUserId === userId)\n\t\t\t\t{\n\t\t\t\t\tthis.selectedUserId = null;\n\t\t\t\t\tthis.searchedUserId = null;\n\t\t\t\t}\n\t\t\t}, 4000);\n\t\t},\n\t\tasync searchMembers(query)\n\t\t{\n\t\t\tif (query.length === 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.findQueryResult = this.findQueryResult || {};\n\t\t\tthis.findQueryResult[this.focusedNode] = this.findQueryResult[this.focusedNode] || {\n\t\t\t\tsuccess: [],\n\t\t\t\tfailure: [],\n\t\t\t};\n\n\t\t\tconst nodeResults = this.findQueryResult[this.focusedNode];\n\n\t\t\tif (nodeResults.failure.some((failedQuery) => query.startsWith(failedQuery)))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (nodeResults.success.includes(query) || nodeResults.failure.includes(query))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst founded = await DepartmentAPI.findMemberByQuery(this.focusedNode, query);\n\n\t\t\tif (founded.length === 0)\n\t\t\t{\n\t\t\t\tnodeResults.failure.push(query);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst department = this.departments.get(this.focusedNode);\n\t\t\tconst newMembers = founded.filter((found) => !department.heads.some((head) => head.id === found.id)\n\t\t\t\t&& !department.employees.some((employee) => employee.id === found.id));\n\n\t\t\tdepartment.employees.push(...newMembers);\n\t\t\tnodeResults.success.push(query);\n\t\t},\n\t\tsearchUser(searchQuery: string): void\n\t\t{\n\t\t\tthis.searchQuery = searchQuery;\n\t\t},\n\t\tonHeadListActionMenuItemClick(actionId: string): void\n\t\t{\n\t\t\tthis.headMenu.onActionMenuItemClick(actionId);\n\t\t},\n\t\tonEmployeeListActionMenuItemClick(actionId: string): void\n\t\t{\n\t\t\tthis.employeeMenu.onActionMenuItemClick(actionId);\n\t\t},\n\t\tgetHeadListDataTestIds(): TabListDataTestIds\n\t\t{\n\t\t\treturn HeadListDataTestIds;\n\t\t},\n\t\tgetEmployeeListDataTestIds(): TabListDataTestIds\n\t\t{\n\t\t\treturn EmployeeListDataTestIds;\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"hr-department-detail-content__tab-container --users\" ref=\"tab-container\">\n\t\t\t<template v-if=\"memberCount > 0\">\n\t\t\t\t<SearchInput\n\t\t\t\t\tv-if=\"showSearchBar\"\n\t\t\t\t\t:placeholder=\"loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_SEARCH_PLACEHOLDER')\"\n\t\t\t\t\t:value=\"searchQuery\"\n\t\t\t\t\t@inputChange=\"searchUser\"\n\t\t\t\t\tdataTestId=\"hr-department-detail-content_users-tab__users-search-input\"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"!showSearchEmptyState\"\n\t\t\t\t\tv-on=\"shouldUpdateList ? { scroll: updateList } : {}\"\n\t\t\t\t\tclass=\"hr-department-detail-content__lists-container\"\n\t\t\t\t>\n\t\t\t\t\t<TabList\n\t\t\t\t\t\tid='hr-department-detail-content_chats-tab__chat-list'\n\t\t\t\t\t\t:title=\"loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_HEAD_LIST_TITLE')\"\n\t\t\t\t\t\t:count=\"headCount\"\n\t\t\t\t\t\t:menuItems=\"headMenu.items\"\n\t\t\t\t\t\t:listItems=\"filteredHeads\"\n\t\t\t\t\t\t:emptyItemTitle=\"headListEmptyStateTitle\"\n\t\t\t\t\t\temptyItemImageClass=\"hr-department-detail-content__empty-user-list-item-image\"\n\t\t\t\t\t\t:hideEmptyItem=\"searchQuery.length > 0\"\n\t\t\t\t\t\t:withAddPermission=\"canAddUsers\"\n\t\t\t\t\t\t@tabListAction=\"onHeadListActionMenuItemClick\"\n\t\t\t\t\t\t:dataTestIds=\"getHeadListDataTestIds()\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<template v-slot=\"{ item }\">\n\t\t\t\t\t\t\t<UserListItem\n\t\t\t\t\t\t\t\t:user=\"item\"\n\t\t\t\t\t\t\t\t:selectedUserId=\"selectedUserId\"\n\t\t\t\t\t\t\t\t:entityType=\"entityType\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</TabList>\n\t\t\t\t\t<TabList\n\t\t\t\t\t\tid='hr-department-detail-content_chats-tab__channel-list'\n\t\t\t\t\t\t:title=\"employeeTitle\"\n\t\t\t\t\t\t:count=\"employeeCount\"\n\t\t\t\t\t\t:menuItems=\"employeeMenu.items\"\n\t\t\t\t\t\t:listItems=\"filteredEmployees\"\n\t\t\t\t\t\t:emptyItemTitle=\"employeesListEmptyStateTitle\"\n\t\t\t\t\t\temptyItemImageClass=\"hr-department-detail-content__empty-user-list-item-image\"\n\t\t\t\t\t\t:hideEmptyItem=\"searchQuery.length > 0\"\n\t\t\t\t\t\t:withAddPermission=\"canAddUsers\"\n\t\t\t\t\t\t@tabListAction=\"onEmployeeListActionMenuItemClick\"\n\t\t\t\t\t\t:dataTestIds=\"getEmployeeListDataTestIds()\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<template v-slot=\"{ item }\">\n\t\t\t\t\t\t\t<UserListItem\n\t\t\t\t\t\t\t\t:user=\"item\"\n\t\t\t\t\t\t\t\t:selectedUserId=\"selectedUserId\"\n\t\t\t\t\t\t\t\t:entityType=\"entityType\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</TabList>\n\t\t\t\t</div>\n\t\t\t\t<EmptyState v-else\n\t\t\t\t\timageClass=\"hr-department-detail-content__empty-tab-user-not-found-icon\"\n\t\t\t\t\t:title=\"loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_SEARCHED_EMPLOYEES_TITLE')\"\n\t\t\t\t\t:description =\"loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_SEARCHED_EMPLOYEES_SUBTITLE')\"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<EmptyState v-else\n\t\t\t\t:imageClass=\"canAddUsers \n\t\t\t\t\t? 'hr-department-detail-content__empty-tab-add-user-icon' \n\t\t\t\t\t: 'hr-department-detail-content__empty-tab-cant-add-user-icon'\"\n\t\t\t\t:title=\"emptyStateTitle\"\n\t\t\t\t:description =\"emptyStateDescription\"\n\t\t\t>\n\t\t\t\t<template v-slot:content>\n\t\t\t\t\t<EmptyTabAddButton v-if=\"canAddUsers\" :departmentId=\"departmentId\" :entityType=\"entityType\"/>\n\t\t\t\t</template>\n\t\t\t</EmptyState>\n\t\t</div>\n\t`,\n};\n","import { Main } from 'ui.icon-set.api.core';\nimport { Loc } from 'main.core';\n\nexport const ChatsMenuOption = Object.freeze({\n\taddChat: 'addChat',\n\tlinkChat: 'linkChat',\n\taddChannel: 'addChannel',\n\tlinkChannel: 'linkChannel',\n});\n\nexport const ChatsMenuLinkChat = Object.freeze({\n\tid: ChatsMenuOption.linkChat,\n\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_LIST_LINK_BUTTON_TITLE'),\n\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_LIST_LINK_BUTTON_DESC'),\n\tbIcon: {\n\t\tname: Main.CHAT_MESSAGE,\n\t\tsize: 20,\n\t\tcolorTokenName: 'paletteBlue50',\n\t},\n\tdataTestId: 'hr-department-content_chats-tab__chat-list-action-link',\n});\n\nexport const ChatsMenuAddChat = Object.freeze({\n\tid: ChatsMenuOption.addChat,\n\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_LIST_ADD_BUTTON_TITLE'),\n\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_LIST_ADD_BUTTON_DESC'),\n\tbIcon: {\n\t\tname: Main.ADD_CHAT,\n\t\tsize: 20,\n\t\tcolorTokenName: 'paletteBlue50',\n\t},\n\tdataTestId: 'hr-department-content_chats-tab__chat-list-action-add',\n});\n\nexport const ChatsMenuLinkChannel = Object.freeze({\n\tid: ChatsMenuOption.linkChannel,\n\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_LIST_LINK_BUTTON_TITLE'),\n\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_LIST_LINK_BUTTON_DESC'),\n\tbIcon: {\n\t\tname: Main.SPEAKER_MOUTHPIECE,\n\t\tsize: 20,\n\t\tcolorTokenName: 'paletteBlue50',\n\t},\n\tdataTestId: 'hr-department-content_chats-tab__channel-list-action-link',\n});\n\nexport const ChatsMenuAddChannel = Object.freeze({\n\tid: ChatsMenuOption.addChannel,\n\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_LIST_ADD_BUTTON_TITLE'),\n\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_LIST_ADD_BUTTON_DESC'),\n\tbIcon: {\n\t\tname: Main.SPEAKER_MOUTHPIECE_PLUS,\n\t\tsize: 20,\n\t\tcolorTokenName: 'paletteBlue50',\n\t},\n\tdataTestId: 'hr-department-content_chats-tab__channel-list-action-add',\n});\n\nexport const ChatListDataTestIds = Object.freeze({\n\tcontainerDataTestId: 'hr-department-content_chats-tab__chat-list-container',\n\tlistActionButtonDataTestId: 'hr-department-content_chats-tab__chat-list-action-button',\n\tlistActonMenuDataTestId: 'hr-department-content_chats-tab__chat-list-action-menu-container',\n\tlistCounterDataTestId: 'hr-department-content_chats-tab__chat-list-counter',\n});\n\nexport const ChannelListDataTestIds = Object.freeze({\n\tcontainerDataTestId: 'hr-department-content_chats-tab__channel-list-container',\n\tlistActionButtonDataTestId: 'hr-department-content_chats-tab__channel-list-action-button',\n\tlistActonMenuDataTestId: 'hr-department-content_chats-tab__channel-list-action-menu-container',\n\tlistCounterDataTestId: 'hr-department-content_chats-tab__channel-list-counter',\n});\n\nexport const ChatLinkDialogDataTestIds = Object.freeze({\n\tcontainerDataTestId: 'hr-department-content_chats-tab__link-chat-container',\n\tconfirmButtonDataTestId: 'hr-department-content_chats-tab__link-chat-confirm-button',\n\tcancelButtonDataTestId: 'hr-department-content_chats-tab__link-chat-cancel-button',\n\tcloseButtonDataTestId: 'hr-department-content_chats-tab__link-chat-close-button',\n});\n\nexport const ChannelLinkDialogDataTestIds = Object.freeze({\n\tcontainerDataTestId: 'hr-department-content_chats-tab__link-channel-container',\n\tconfirmButtonDataTestId: 'hr-department-content_chats-tab__link-channel-confirm-button',\n\tcancelButtonDataTestId: 'hr-department-content_chats-tab__link-channel-cancel-button',\n\tcloseButtonDataTestId: 'hr-department-content_chats-tab__link-channel-close-button',\n});\n","import { RouteActionMenu } from 'humanresources.company-structure.structure-components';\nimport './styles/empty-tab-add-buttons.css';\nimport { ChatsMenuOption } from './consts';\nimport 'ui.icon-set.main';\n\nexport const EmptyTabAddButtons = {\n\tname: 'emptyStateButtons',\n\temits: ['emptyStateAddAction'],\n\tcomponents: { RouteActionMenu },\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tchatMenuVisible: false,\n\t\t\tchannelMenuVisible: false,\n\t\t\tchatButtonId: 'hr-empty-tab-chat-add-button',\n\t\t\tchannelButtonId: 'hr-empty-tab-chat-add-button',\n\t\t};\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tonChatButtonClick(): void\n\t\t{\n\t\t\tthis.$emit('emptyStateAddAction', ChatsMenuOption.linkChat);\n\t\t},\n\t\tonChannelButtonClick(): void\n\t\t{\n\t\t\tthis.$emit('emptyStateAddAction', ChatsMenuOption.linkChannel);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"hr-department-detail-content__chat-empty-tab-add_buttons-container\">\n\t\t\t<button\n\t\t\t\t:ref=\"chatButtonId\"\n\t\t\t\tclass=\"ui-btn ui-btn-light-border ui-btn-no-caps ui-btn-round ui-btn-sm hr-department-detail-content__chat-empty-tab-add_chat-button\"\n\t\t\t\t@click.stop=\"this.onChatButtonClick()\"\n\t\t\t\tdata-test-id=\"hr-department-detail-content_chats-tab__empty-tab-add_chat-button\"\n\t\t\t>\n\t\t\t\t<div class=\"ui-icon-set --chat-message hr-department-detail-content__chat-empty-tab-add_chat-button-icon\"/>\n\t\t\t\t<span>\n\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_CHAT_BUTTON') }}\n\t\t\t\t</span>\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\t:ref=\"channelButtonId\"\n\t\t\t\tclass=\"ui-btn ui-btn-light-border ui-btn-no-caps ui-btn-round ui-btn-sm hr-department-detail-content__chat-empty-tab-add_channel-button\"\n\t\t\t\t@click.stop=\"onChannelButtonClick()\"\n\t\t\t\tdata-test-id=\"hr-department-detail-content_chats-tab__empty-tab-add_channel-button\"\n\t\t\t>\n\t\t\t\t<div class=\"ui-icon-set --speaker-mouthpiece hr-department-detail-content__chat-empty-tab-add_chat-button-icon\"/>\n\t\t\t\t<span>\n\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_CHANNEL_BUTTON') }}\n\t\t\t\t</span>\n\t\t\t</button>\n\t\t</div>\n\t`,\n};\n","import { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { ChatListActionMenu, MenuActions } from 'humanresources.company-structure.org-chart';\nimport { ConfirmationPopup, RouteActionMenu } from 'humanresources.company-structure.structure-components';\nimport { ChatTypes, EntityTypes } from 'humanresources.company-structure.utils';\nimport { UI } from 'ui.notification';\nimport { mapState } from 'ui.vue3.pinia';\nimport { DepartmentContentActions } from '../../actions';\nimport { DepartmentAPI } from '../../api';\nimport { Messenger } from 'im.public.iframe';\n\n// @vue/component\nexport const ChatListItemActionButton = {\n\tname: 'chatListItemActionButton',\n\n\tcomponents: {\n\t\tRouteActionMenu,\n\t\tConfirmationPopup,\n\t},\n\n\tprops: {\n\t\t/** @type ChatOrChannelDetailed */\n\t\tchat: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tnodeId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tmenuVisible: false,\n\t\t\tshowUnbindChatConfirmationPopup: false,\n\t\t\tunbindChatLoader: false,\n\t\t};\n\t},\n\n\tcomputed: {\n\t\tgetUnbindChatTitle(): string\n\t\t{\n\t\t\tconst entityType = this.isTeamEntity ? 'TEAM' : 'DEPARTMENT';\n\t\t\tconst chatType = this.isChat ? 'CHAT' : 'CHANNEL';\n\n\t\t\treturn this.loc(`HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_UNBIND_POPUP_${chatType}_FROM_${entityType}_TITLE`);\n\t\t},\n\t\tgetUnbindChatDescription(): string\n\t\t{\n\t\t\tconst entityType = this.isTeamEntity ? 'TEAM' : 'DEPARTMENT';\n\t\t\tconst chatType = this.isChat ? 'CHAT' : 'CHANNEL';\n\n\t\t\treturn this.loc(`HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_UNBIND_POPUP_${chatType}_FROM_${entityType}_DESCRIPTION`);\n\t\t},\n\t\tisTeamEntity(): boolean\n\t\t{\n\t\t\treturn this.departments.get(this.nodeId)?.entityType === EntityTypes.team;\n\t\t},\n\t\tisChat(): boolean\n\t\t{\n\t\t\treturn this.chat.type === ChatTypes.chat;\n\t\t},\n\t\tmenu(): ChatListActionMenu\n\t\t{\n\t\t\tconst entityType = this.departments.get(this.nodeId)?.entityType;\n\n\t\t\treturn new ChatListActionMenu(entityType, this.chat, this.nodeId);\n\t\t},\n\t\t...mapState(useChartStore, ['departments']),\n\t},\n\n\tmethods:\n\t{\n\t\ttoggleMenu(): void\n\t\t{\n\t\t\tthis.menuVisible = !this.menuVisible;\n\t\t},\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tonActionMenuItemClick(actionId: string): void\n\t\t{\n\t\t\tif (actionId === MenuActions.openChat)\n\t\t\t{\n\t\t\t\tMessenger.openChat(this.chat.dialogId);\n\t\t\t}\n\t\t\telse if (actionId === MenuActions.unbindChat)\n\t\t\t{\n\t\t\t\tthis.showUnbindChatConfirmationPopup = true;\n\t\t\t}\n\t\t},\n\t\tcancelUnbindChat(): void\n\t\t{\n\t\t\tthis.showUnbindChatConfirmationPopup = false;\n\t\t},\n\t\tasync unbindChat(): Promise<void>\n\t\t{\n\t\t\tthis.unbindChatLoader = true;\n\t\t\tconst entityType = this.isTeamEntity ? 'TEAM' : 'DEPARTMENT';\n\t\t\tconst chatType = this.isChat ? 'CHAT' : 'CHANNEL';\n\n\t\t\ttry\n\t\t\t{\n\t\t\t\tawait DepartmentAPI.saveChats(this.nodeId, [], [this.chat.id]);\n\t\t\t}\n\t\t\tcatch (error)\n\t\t\t{\n\t\t\t\tif (error.code !== 'STRUCTURE_ACCESS_DENIED')\n\t\t\t\t{\n\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: this.loc(`HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_UNBIND_POPUP_${chatType}_FROM_${entityType}_ERROR`),\n\t\t\t\t\t\tautoHideDelay: 2000,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfinally\n\t\t\t{\n\t\t\t\tthis.unbindChatLoader = false;\n\t\t\t\tthis.showUnbindChatConfirmationPopup = false;\n\t\t\t}\n\n\t\t\tDepartmentContentActions.unbindChatFromNode(this.nodeId, this.chat.id);\n\n\t\t\tUI.Notification.Center.notify({\n\t\t\t\tcontent: this.loc(`HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_UNBIND_POPUP_${chatType}_FROM_${entityType}_SUCCESS`),\n\t\t\t\tautoHideDelay: 2000,\n\t\t\t});\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<button\n\t\t\tv-if=\"menu.items.length\"\n\t\t\tclass=\"ui-icon-set --more hr-department-detail-content__tab-list_item-action-btn --chat-item-action-btn ui-icon-set\"\n\t\t\t:class=\"{ '--focused': menuVisible }\"\n\t\t\t@click.stop=\"toggleMenu()\"\n\t\t\tref=\"actionChatButton\"\n\t\t\t:data-id=\"'hr-department-detail-content__'+ chat.type.toLowerCase() + '-list_chat-' + chat.id + '-action-btn'\"\n\t\t/>\n\t\t<RouteActionMenu\n\t\t\tv-if=\"menuVisible\"\n\t\t\t:id=\"'tree-node-department-menu-chat_' + this.nodeId + '_' + chat.id\"\n\t\t\t:items=\"menu.items\"\n\t\t\t:width=\"302\"\n\t\t\t:bindElement=\"$refs.actionChatButton\"\n\t\t\t@action=\"onActionMenuItemClick\"\n\t\t\t@close=\"menuVisible = false\"\n\t\t/>\n\t\t<ConfirmationPopup\n\t\t\tref=\"unbindChatConfirmationPopup\"\n\t\t\tv-if=\"showUnbindChatConfirmationPopup\"\n\t\t\t:showActionButtonLoader=\"unbindChatLoader\"\n\t\t\t:title=\"getUnbindChatTitle\"\n\t\t\t:confirmBtnText=\"loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_UNBIND_POPUP_CONFIRM_BUTTON')\"\n\t\t\tconfirmButtonClass=\"ui-btn-danger\"\n\t\t\t@action=\"unbindChat\"\n\t\t\t@close=\"cancelUnbindChat\"\n\t\t\t:width=\"364\"\n\t\t>\n\t\t\t<template v-slot:content>\n\t\t\t\t<div class=\"hr-department-detail-content__user-action-text-container\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-html=\"getUnbindChatDescription\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</ConfirmationPopup>\n\t`,\n};\n","import { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { events } from 'humanresources.company-structure.org-chart';\nimport { EventEmitter } from 'main.core.events';\nimport { AvatarRound, AvatarSquare } from 'ui.avatar';\nimport { Messenger } from 'im.public.iframe';\nimport { EntityTypes, getColorCode, ChatTypes } from 'humanresources.company-structure.utils';\nimport { mapState } from 'ui.vue3.pinia';\nimport { ChatListItemActionButton } from './action-button';\nimport { ResponsiveHint } from 'humanresources.company-structure.structure-components';\n\n// @vue/component\nexport const ChatListItem = {\n\tname: 'chatListItem',\n\n\tcomponents: { ChatListItemActionButton, ResponsiveHint },\n\n\tprops: {\n\t\t/** @type ChatOrChannelDetailed */\n\t\tchat: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tnodeId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tavatar: null,\n\t\t};\n\t},\n\n\tcomputed: {\n\t\tisChat(): boolean\n\t\t{\n\t\t\treturn this.chat.type !== ChatTypes.channel;\n\t\t},\n\t\toriginalNodeName(): string\n\t\t{\n\t\t\treturn this.departments.get(this.chat.originalNodeId)?.name;\n\t\t},\n\t\tindirectChatSubtitle(): string\n\t\t{\n\t\t\tif (this.departments.get(this.chat.originalNodeId)?.entityType === EntityTypes.team)\n\t\t\t{\n\t\t\t\treturn this.isChat\n\t\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_OF_TEAM')\n\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_OF_TEAM')\n\t\t\t\t;\n\t\t\t}\n\n\t\t\treturn this.isChat\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_OF_DEPARTMENT')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_OF_DEPARTMENT')\n\t\t\t;\n\t\t},\n\t\tlockHint(): string\n\t\t{\n\t\t\tif (!this.chat.hasAccess)\n\t\t\t{\n\t\t\t\treturn this.isChat\n\t\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_USER_HAS_NO_ACCESS_TO_CHAT_HINT')\n\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_USER_HAS_NO_ACCESS_TO_CHANNEL_HINT')\n\t\t\t\t;\n\t\t\t}\n\n\t\t\t// parent node is a team so child node must be a team too\n\t\t\tif (this.departments.get(this.chat.originalNodeId)?.entityType === EntityTypes.team)\n\t\t\t{\n\t\t\t\treturn this.isChat\n\t\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_PARENT_TEAM_CHAT_HINT')\n\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_PARENT_TEAM_CHANNEL_HINT')\n\t\t\t\t;\n\t\t\t}\n\n\t\t\t// parent node is a department so we check if child node is a department too\n\t\t\tif (this.departments.get(this.nodeId)?.entityType === EntityTypes.department)\n\t\t\t{\n\t\t\t\treturn this.isChat\n\t\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_PARENT_DEPARTMENT_CHAT_OF_DEPARTMENT_HINT')\n\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_PARENT_DEPARTMENT_CHANNEL_OF_DEPARTMENT_HINT')\n\t\t\t\t;\n\t\t\t}\n\n\t\t\t// parent node is a department but child node is a team\n\t\t\treturn this.isChat\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_PARENT_DEPARTMENT_CHAT_OF_TEAM_HINT')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_PARENT_DEPARTMENT_CHANNEL_OF_TEAM_HINT')\n\t\t\t;\n\t\t},\n\t\t...mapState(useChartStore, ['departments']),\n\t},\n\n\twatch: {\n\t\tchat(): void\n\t\t{\n\t\t\tthis.prepareAvatar();\n\t\t},\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.prepareAvatar();\n\t},\n\n\tmethods: {\n\t\tprepareAvatar(): void\n\t\t{\n\t\t\tif (this.chat.avatar)\n\t\t\t{\n\t\t\t\tthis.chat.color = getColorCode('whiteBase');\n\t\t\t}\n\n\t\t\tconst avatarOptions = {\n\t\t\t\tsize: 32,\n\t\t\t\tuserName: this.chat.title,\n\t\t\t\tbaseColor: this.isExtranet() && !this.chat.avatar ? getColorCode('extranetColor') : this.chat.color,\n\t\t\t\tevents: {\n\t\t\t\t\tclick: () => {\n\t\t\t\t\t\tthis.onChatItemClick();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tif (this.chat.avatar)\n\t\t\t{\n\t\t\t\tavatarOptions.userpicPath = this.chat.avatar;\n\t\t\t}\n\n\t\t\tthis.avatar = this.isChat ? new AvatarRound(avatarOptions) : new AvatarSquare(avatarOptions);\n\t\t},\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tonChatItemClick(): void\n\t\t{\n\t\t\tif (this.chat.hasAccess)\n\t\t\t{\n\t\t\t\tMessenger.openChat(this.chat.dialogId);\n\t\t\t}\n\t\t},\n\t\tisExtranet(): boolean\n\t\t{\n\t\t\treturn this.chat.isExtranet;\n\t\t},\n\t\tlocateToOriginalDepartment(): void\n\t\t{\n\t\t\tEventEmitter.emit(events.HR_ORG_CHART_LOCATE_TO_DEPARTMENT, { nodeId: this.chat.originalNodeId });\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\t:key=\"chat.id\"\n\t\t\tclass=\"hr-department-detail-content__tab-list_item-wrapper --chat\"\n\t\t\t:class=\"{ '--isExtranet': isExtranet() }\"\n\t\t\t:data-test-id=\"'hr-department-content_chats-tab__list_chat-item-' + chat.id\"\n\t\t>\n\t\t\t<div\n\t\t\t\tclass=\"hr-department-detail-content__tab-list_item-avatar-container\"\n\t\t\t\t:class=\"{ '--not-clickable': !chat.hasAccess }\"\n\t\t\t\tv-html=\"this.avatar.getContainer().outerHTML\"\n\t\t\t\t@click=\"onChatItemClick\"\n\t\t\t/>\n\t\t\t<div class=\"hr-department-detail-content__tab-list_item-text-container\">\n\t\t\t\t<div class=\"hr-department-detail-content__tab-list_item-title-container --chat-item\">\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass=\"hr-department-detail-content__tab-list_item-title\"\n\t\t\t\t\t\t:class=\"{ '--not-clickable': !chat.hasAccess }\"\n\t\t\t\t\t\t:data-test-id=\"'hr-department-content_chats-tab__list_chat-item-' + chat.id + '-title'\"\n\t\t\t\t\t\t@click=\"onChatItemClick\"\n\t\t\t\t\t>{{ chat.title }}</span>\n\t\t\t\t\t<ResponsiveHint \n\t\t\t\t\t\tv-if=\"!chat.hasAccess || chat.originalNodeId\" \n\t\t\t\t\t\t:content=\"lockHint\" \n\t\t\t\t\t\t:extraClasses=\"{ 'hr-department-detail-content__tab-list_hint-container': true }\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span class=\"ui-icon-set --lock hr-department-detail-content__tab-list_lock-icon\"></span>\n\t\t\t\t\t</ResponsiveHint>\n\t\t\t\t</div>\n\t\t\t\t<div v-if=\"chat.originalNodeId && originalNodeName\" class=\"hr-department-detail-content__tab-list_item-subtitle --chat-item\">\n\t\t\t\t\t{{ indirectChatSubtitle }}\n\t\t\t\t\t<span class=\"hr-department-detail-content__tab-list_orig-node-name\" @click=\"locateToOriginalDepartment\">\n\t\t\t\t\t\t{{ originalNodeName }}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div v-else-if=\"chat.originalNodeId\" class=\"hr-department-detail-content__tab-list_item-subtitle --chat-item\">\n\t\t\t\t\t{{ indirectChatSubtitle }}\n\t\t\t\t\t<span class=\"hr-department-detail-content__tab-list_orig-node-hidden-name\">\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_HIDDEN_DEPARTMENT') }}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div v-else class=\"hr-department-detail-content__tab-list_item-subtitle\">\n\t\t\t\t\t{{ chat.subtitle }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<ChatListItemActionButton\n\t\t\t\t:chat=\"chat\"\n\t\t\t\t:nodeId=\"nodeId\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { PermissionActions, PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\nimport { DepartmentContentActions } from '../../actions';\nimport { DepartmentAPI } from '../../api';\nimport { SearchInput } from '../base-components/search/search-input';\nimport { TabList } from '../base-components/list/list';\nimport { EmptyState } from '../base-components/empty-state/empty-state';\nimport { EmptyTabAddButtons } from './empty-tab-add-buttons';\nimport { ChatListItem } from './list-item';\nimport {\n\tChatsMenuOption,\n\tChatsMenuLinkChat,\n\tChatsMenuLinkChannel,\n\tChatListDataTestIds,\n\tChannelListDataTestIds,\n\tChatLinkDialogDataTestIds,\n\tChannelLinkDialogDataTestIds,\n} from './consts';\nimport {\n\tgetChatDialogEntity,\n\tgetChannelDialogEntity,\n\tChatTypeDict,\n\tgetChatRecentTabOptions,\n\tManagementDialog,\n} from 'humanresources.company-structure.structure-components';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { mapState } from 'ui.vue3.pinia';\nimport { Type } from 'main.core';\nimport type { TabOptions } from 'ui.entity-selector';\nimport type { ChatOrChannelDetailed } from 'humanresources.company-structure.utils';\n\nimport './styles/tab.css';\n\nexport const ChatsTab = {\n\tname: 'chatsTab',\n\n\tcomponents: {\n\t\tSearchInput,\n\t\tTabList,\n\t\tEmptyState,\n\t\tEmptyTabAddButtons,\n\t\tChatListItem,\n\t\tManagementDialog,\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tisChatLinkActive: false,\n\t\t\tchatLinkDialogVisible: false,\n\t\t\tisChannelLinkActive: false,\n\t\t\tchannelLinkDialogVisible: false,\n\t\t\tisLoading: false,\n\t\t\tsearchQuery: '',\n\t\t};\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.loadChatAction();\n\t},\n\n\tmethods:\n\t{\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tsearchChatOrChannel(searchQuery: string): void\n\t\t{\n\t\t\tthis.searchQuery = searchQuery;\n\t\t},\n\t\tasync loadChatAction(force: boolean): void\n\t\t{\n\t\t\tconst nodeId = this.focusedNode;\n\t\t\tconst department = this.departments.get(nodeId);\n\t\t\tif (!department)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!force && Type.isArray(department.chatsDetailed) && Type.isArray(department.channelsDetailed))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.isLoading)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.isLoading = true;\n\n\t\t\tthis.$emit('showDetailLoader');\n\t\t\tconst loadedChatsAndChannels = await DepartmentAPI.getChatsAndChannels(nodeId);\n\t\t\tDepartmentContentActions.setChatsAndChannels(\n\t\t\t\tnodeId,\n\t\t\t\tloadedChatsAndChannels.chats ?? [],\n\t\t\t\tloadedChatsAndChannels.channels ?? [],\n\t\t\t);\n\t\t\tthis.$emit('hideDetailLoader');\n\t\t\tthis.isLoading = false;\n\t\t},\n\t\tgetChatListMenuItems(): Array\n\t\t{\n\t\t\treturn this.canEdit ? [ChatsMenuLinkChat] : [];\n\t\t},\n\t\tgetChannelListMenuItems(): Array\n\t\t{\n\t\t\treturn this.canEdit ? [ChatsMenuLinkChannel] : [];\n\t\t},\n\t\tonActionMenuItemClick(actionId: string): void\n\t\t{\n\t\t\tif (actionId === ChatsMenuOption.linkChat)\n\t\t\t{\n\t\t\t\tthis.chatLinkDialogVisible = true;\n\t\t\t}\n\n\t\t\tif (actionId === ChatsMenuOption.linkChannel)\n\t\t\t{\n\t\t\t\tthis.channelLinkDialogVisible = true;\n\t\t\t}\n\t\t},\n\t\tgetAddEmptyStateList(): { text: string }[]\n\t\t{\n\t\t\tlet stateArray = [];\n\n\t\t\tif (this.isTeamEntity)\n\t\t\t{\n\t\t\t\tstateArray = [\n\t\t\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_TEAM_LIST_ITEM_1_MSGVER_1'),\n\t\t\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_LIST_ITEM_2'),\n\t\t\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_TEAM_LIST_ITEM_3'),\n\t\t\t\t];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tstateArray = [\n\t\t\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_LIST_ITEM_1_MSGVER_1'),\n\t\t\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_LIST_ITEM_2'),\n\t\t\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_LIST_ITEM_3'),\n\t\t\t\t];\n\t\t\t}\n\n\t\t\treturn stateArray.map((item) => ({ text: item }));\n\t\t},\n\t\tgetChatListDataTestIds(): Object\n\t\t{\n\t\t\treturn ChatListDataTestIds;\n\t\t},\n\t\tgetChannelListDataTestIds(): Object\n\t\t{\n\t\t\treturn ChannelListDataTestIds;\n\t\t},\n\t\tgetChatLinkDialogEntities(): Array\n\t\t{\n\t\t\tconst entity = getChatDialogEntity();\n\t\t\tentity.options.excludeIds = this.chats.map((item) => item.id);\n\n\t\t\treturn [entity];\n\t\t},\n\t\tgetChannelLinkDialogEntities(): Array\n\t\t{\n\t\t\tconst entity = getChannelDialogEntity();\n\t\t\tentity.options.excludeIds = this.channels.map((item) => item.id);\n\n\t\t\treturn [entity];\n\t\t},\n\t\tgetChatLinkRecentTabOptions(): TabOptions\n\t\t{\n\t\t\treturn getChatRecentTabOptions(this.teamEntity, ChatTypeDict.chat);\n\t\t},\n\t\tgetChannelLinkRecentTabOptions(): TabOptions\n\t\t{\n\t\t\treturn getChatRecentTabOptions(this.teamEntity, ChatTypeDict.channel);\n\t\t},\n\t\tasync linkChats(chatsItems: Array): void\n\t\t{\n\t\t\tthis.isChatLinkActive = true;\n\t\t\tconst chats = (chatsItems).map((chatItem) => Number(chatItem.id.replace('chat', '')));\n\t\t\tconst nodeId = this.focusedNode;\n\t\t\tconst ids = { chat: chats };\n\t\t\ttry\n\t\t\t{\n\t\t\t\tawait DepartmentAPI.saveChats(nodeId, ids);\n\t\t\t}\n\t\t\tcatch\n\t\t\t{ /* empty */ }\n\t\t\tthis.isChatLinkActive = false;\n\t\t\tthis.chatLinkDialogVisible = false;\n\t\t\tthis.loadChatAction(true);\n\t\t},\n\t\tasync linkChannel(chatsItems: Array): void\n\t\t{\n\t\t\tthis.isChannelLinkActive = true;\n\t\t\tconst channels = (chatsItems).map((chatItem) => Number(chatItem.id.replace('chat', '')));\n\t\t\tconst nodeId = this.focusedNode;\n\t\t\tconst ids = { channel: channels };\n\t\t\ttry\n\t\t\t{\n\t\t\t\tawait DepartmentAPI.saveChats(nodeId, ids);\n\t\t\t}\n\t\t\tcatch\n\t\t\t{ /* empty */ }\n\t\t\tthis.isChannelLinkActive = false;\n\t\t\tthis.channelLinkDialogVisible = false;\n\t\t\tthis.loadChatAction(true);\n\t\t},\n\t\tgetChatLinkDialogDataTestIds(): Object\n\t\t{\n\t\t\treturn ChatLinkDialogDataTestIds;\n\t\t},\n\t\tgetChannelLinkDialogDataTestIds(): Object\n\t\t{\n\t\t\treturn ChannelLinkDialogDataTestIds;\n\t\t},\n\t},\n\n\tcomputed:\n\t{\n\t\tchats(): Array<ChatOrChannelDetailed>\n\t\t{\n\t\t\treturn this.departments.get(this.focusedNode)?.chatsDetailed ?? [];\n\t\t},\n\t\tchannels(): Array<ChatOrChannelDetailed>\n\t\t{\n\t\t\treturn this.departments.get(this.focusedNode)?.channelsDetailed ?? [];\n\t\t},\n\t\tfilteredChats(): Array<ChatOrChannelDetailed>\n\t\t{\n\t\t\treturn this.chats.filter(\n\t\t\t\t(chat) => chat.title.toLowerCase().includes(this.searchQuery.toLowerCase()),\n\t\t\t);\n\t\t},\n\t\tfilteredChannels(): Array<ChatOrChannelDetailed>\n\t\t{\n\t\t\treturn this.channels.filter(\n\t\t\t\t(channel) => channel.title.toLowerCase().includes(this.searchQuery.toLowerCase()),\n\t\t\t);\n\t\t},\n\t\tshowAddEmptyState(): boolean\n\t\t{\n\t\t\treturn this.chats.length === 0 && this.channels.length === 0;\n\t\t},\n\t\tshowSearchEmptyState(): boolean\n\t\t{\n\t\t\treturn this.filteredChats.length === 0 && this.filteredChannels.length === 0;\n\t\t},\n\t\tgetLinkedChatIds(): Array<string>\n\t\t{\n\t\t\treturn (this.chats).map((chatItem) => `chat${chatItem.id}`);\n\t\t},\n\t\tgetLinkedChannelIds(): Array<string>\n\t\t{\n\t\t\treturn (this.channels).map((channelItem) => `chat${channelItem.id}`);\n\t\t},\n\t\tisChatsLoaded(): Boolean\n\t\t{\n\t\t\tconst department = this.departments.get(this.focusedNode);\n\n\t\t\treturn Boolean(Type.isArray(department.chatsDetailed) && Type.isArray(department.channelsDetailed));\n\t\t},\n\t\tteamEntity(): boolean\n\t\t{\n\t\t\treturn this.departments.get(this.focusedNode)?.entityType;\n\t\t},\n\t\tisTeamEntity(): boolean\n\t\t{\n\t\t\treturn this.teamEntity === EntityTypes.team;\n\t\t},\n\t\tgetAddEmptyStateTitle(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_TEAM_TITLE')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_TAB_ADD_EMPTY_STATE_TITLE')\n\t\t\t;\n\t\t},\n\t\tgetAddChatDescription(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_LINK_DIALOG_TEAM_DESC')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_LINK_DIALOG_DESC')\n\t\t\t;\n\t\t},\n\t\tgetAddChannelDescription(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_LINK_DIALOG_TEAM_DESC')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_LINK_DIALOG_DESC')\n\t\t\t;\n\t\t},\n\t\tchatMenuItems(): boolean\n\t\t{\n\t\t\treturn this.getChatListMenuItems();\n\t\t},\n\t\tchannelMenuItems(): boolean\n\t\t{\n\t\t\treturn this.getChannelListMenuItems();\n\t\t},\n\t\temptyChatTitle(): string\n\t\t{\n\t\t\tif (this.canEdit)\n\t\t\t{\n\t\t\t\treturn this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_CHAT_LIST_ITEM_TEXT');\n\t\t\t}\n\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_CHAT_LIST_ITEM_NO_TEAM_TEXT')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_CHAT_LIST_ITEM_NO_DEPARTMENT_TEXT')\n\t\t\t;\n\t\t},\n\t\temptyChannelTitle(): string\n\t\t{\n\t\t\tif (this.canEdit)\n\t\t\t{\n\t\t\t\treturn this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_CHANNEL_LIST_ITEM_TEXT');\n\t\t\t}\n\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_CHANNEL_LIST_ITEM_NO_TEAM_TEXT')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_EMPTY_CHANNEL_LIST_ITEM_NO_DEPARTMENT_TEXT')\n\t\t\t;\n\t\t},\n\t\tcanEdit(): boolean\n\t\t{\n\t\t\tconst permissionChecker = PermissionChecker.getInstance();\n\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? permissionChecker.hasPermission(PermissionActions.teamCommunicationEdit, this.focusedNode)\n\t\t\t\t: permissionChecker.hasPermission(PermissionActions.departmentCommunicationEdit, this.focusedNode)\n\t\t\t;\n\t\t},\n\t\t...mapState(useChartStore, ['focusedNode', 'departments']),\n\t},\n\n\twatch: {\n\t\tisChatsLoaded(isChatsLoaded): void {\n\t\t\tif (isChatsLoaded === false)\n\t\t\t{\n\t\t\t\tthis.loadChatAction();\n\t\t\t}\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"hr-department-detail-content__tab-container --chat\">\n\t\t\t<template v-if=\"!showAddEmptyState\">\n\t\t\t\t<SearchInput\n\t\t\t\t\t:placeholder=\"loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_SEARCH_INPUT_PLACEHOLDER')\"\n\t\t\t\t\t:value=\"searchQuery\"\n\t\t\t\t\t@inputChange=\"searchChatOrChannel\"\n\t\t\t\t\tdataTestId=\"hr-department-detail-content_chats-tab__chats-and-channels-search-input\"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"!showSearchEmptyState\"\n\t\t\t\t\tclass=\"hr-department-detail-content__lists-container\"\n\t\t\t\t>\n\t\t\t\t\t<TabList\n\t\t\t\t\t\tid='hr-department-detail-content_chats-tab__chat-list'\n\t\t\t\t\t\t:title=\"loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_LIST_TITLE')\"\n\t\t\t\t\t\t:count=\"chats.length\"\n\t\t\t\t\t\t:menuItems=\"chatMenuItems\"\n\t\t\t\t\t\t:listItems=\"filteredChats\"\n\t\t\t\t\t\t:emptyItemTitle=\"emptyChatTitle\"\n\t\t\t\t\t\temptyItemImageClass=\"hr-department-detail-content__chat-empty-tab-list-item_tab-icon\"\n\t\t\t\t\t\t:hideEmptyItem=\"searchQuery.length > 0\"\n\t\t\t\t\t\t:withAddPermission=\"canEdit\"\n\t\t\t\t\t\t@tabListAction=\"onActionMenuItemClick\"\n\t\t\t\t\t\t:dataTestIds=\"getChatListDataTestIds()\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<template v-slot=\"{ item }\">\n\t\t\t\t\t\t\t<ChatListItem :chat=\"item\" :nodeId=\"focusedNode\"/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</TabList>\n\t\t\t\t\t<TabList\n\t\t\t\t\t\tid='hr-department-detail-content_chats-tab__channel-list'\n\t\t\t\t\t\t:title=\"loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_LIST_TITLE')\"\n\t\t\t\t\t\t:count=\"channels.length\"\n\t\t\t\t\t\t:menuItems=\"channelMenuItems\"\n\t\t\t\t\t\t:listItems=\"filteredChannels\"\n\t\t\t\t\t\t:emptyItemTitle=\"emptyChannelTitle\"\n\t\t\t\t\t\temptyItemImageClass=\"hr-department-detail-content__chat-empty-tab-list-item_tab-icon\"\n\t\t\t\t\t\t:hideEmptyItem=\"searchQuery.length > 0\"\n\t\t\t\t\t\t:withAddPermission=\"canEdit\"\n\t\t\t\t\t\t@tabListAction=\"onActionMenuItemClick\"\n\t\t\t\t\t\t:dataTestIds=\"getChannelListDataTestIds()\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<template v-slot=\"{ item }\">\n\t\t\t\t\t\t\t<ChatListItem :chat=\"item\" :nodeId=\"focusedNode\"/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</TabList>\n\t\t\t\t</div>\n\t\t\t\t<EmptyState \n\t\t\t\t\tv-else\n\t\t\t\t\timageClass=\"hr-department-detail-content__chat-empty-tab-search_tab-icon\"\n\t\t\t\t\t:title=\"loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_SEARCHED_EMPLOYEES_TITLE')\"\n\t\t\t\t\t:description =\"loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_EMPTY_SEARCHED_EMPLOYEES_SUBTITLE')\"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<EmptyState \n\t\t\t\tv-else\n\t\t\t\timageClass=\"hr-department-detail-content__chat-empty-tab-add_tab-icon\"\n\t\t\t\t:title=\"getAddEmptyStateTitle\"\n\t\t\t\t:list=\"getAddEmptyStateList()\"\n\t\t\t>\n\t\t\t\t<template v-slot:content>\n\t\t\t\t\t<EmptyTabAddButtons\n\t\t\t\t\t\t@emptyStateAddAction=\"onActionMenuItemClick\"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t</EmptyState>\n\t\t\t<ManagementDialog\n\t\t\t\tv-if=\"chatLinkDialogVisible\"\n\t\t\t\tid=\"hr-department-detail-content-chats-tab-chat-link-dialog\"\n\t\t\t\t:entities=\"getChatLinkDialogEntities()\"\n\t\t\t\t:recentTabOptions=\"getChatLinkRecentTabOptions()\"\n\t\t\t\t:hiddenItemsIds=\"getLinkedChatIds\"\n\t\t\t\t:title=\"loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHAT_LINK_DIALOG_TITLE')\"\n\t\t\t\t:description=\"getAddChatDescription\"\n\t\t\t\t:isActive=\"isChatLinkActive\"\n\t\t\t\t@managementDialogAction=\"linkChats\"\n\t\t\t\t@close=\"chatLinkDialogVisible = false\"\n\t\t\t\t:dataTestIds=\"getChatLinkDialogDataTestIds()\"\n\t\t\t/>\n\t\t\t<ManagementDialog\n\t\t\t\tv-if=\"channelLinkDialogVisible\"\n\t\t\t\tid=\"hr-department-detail-content-chats-tab-channel-link-dialog\"\n\t\t\t\t:entities=\"getChannelLinkDialogEntities()\"\n\t\t\t\t:recentTabOptions=\"getChannelLinkRecentTabOptions()\"\n\t\t\t\t:hiddenItemsIds=\"getLinkedChannelIds\"\n\t\t\t\t:title=\"loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_CHANNEL_LINK_DIALOG_TITLE')\"\n\t\t\t\t:description=\"getAddChannelDescription\"\n\t\t\t\t:isActive=\"isChannelLinkActive\"\n\t\t\t\t@managementDialogAction=\"linkChannel\"\n\t\t\t\t@close=\"channelLinkDialogVisible = false\"\n\t\t\t\t:dataTestIds=\"getChannelLinkDialogDataTestIds()\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { PermissionActions, PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\nimport { UsersTab } from './users/tab';\nimport { ChatsTab } from './chats/tab';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { mapState } from 'ui.vue3.pinia';\n\nimport '../style.css';\n\n// @vue/component\nexport const DepartmentContent = {\n\tname: 'departmentContent',\n\n\tcomponents: { UsersTab, ChatsTab },\n\n\tprops: {\n\t\tisCollapsed: Boolean,\n\t},\n\n\temits: ['showDetailLoader', 'hideDetailLoader', 'editEmployee'],\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tactiveTab: 'usersTab',\n\t\t\ttabs: [\n\t\t\t\t{ name: 'usersTab', component: 'UsersTab', id: 'users-tab' },\n\t\t\t\t{ name: 'chatsTab', component: 'ChatsTab', id: 'chats-tab' },\n\t\t\t],\n\t\t\tisDescriptionOverflowed: false,\n\t\t\tisDescriptionExpanded: false,\n\t\t};\n\t},\n\n\tcomputed: {\n\t\t...mapState(useChartStore, ['focusedNode', 'departments']),\n\t\tactiveTabComponent(): UsersTab | ChatsTab | null\n\t\t{\n\t\t\tconst activeTab = this.tabs.find((tab) => tab.name === this.activeTab);\n\n\t\t\treturn activeTab ? activeTab.component : null;\n\t\t},\n\t\tusersCount(): Number\n\t\t{\n\t\t\treturn this.departments.get(this.focusedNode)?.userCount ?? 0;\n\t\t},\n\t\tchatAndChannelsCount(): Number\n\t\t{\n\t\t\treturn this.departments.get(this.focusedNode)?.chatAndChannelsCount ?? null;\n\t\t},\n\t\ttabArray(): Array\n\t\t{\n\t\t\treturn this.tabs.map((tab) => {\n\t\t\t\tif (tab.name === 'usersTab')\n\t\t\t\t{\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...tab,\n\t\t\t\t\t\tcount: this.usersCount,\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tif (tab.name === 'chatsTab')\n\t\t\t\t{\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...tab,\n\t\t\t\t\t\tcount: this.chatAndChannelsCount,\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\treturn tab;\n\t\t\t});\n\t\t},\n\t\tdescription(): ?string\n\t\t{\n\t\t\tconst department = this.departments.get(this.focusedNode);\n\t\t\tif (!department.description)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn department.description;\n\t\t},\n\t\tisTeamEntity(): boolean\n\t\t{\n\t\t\treturn this.departments.get(this.focusedNode)?.entityType === EntityTypes.team;\n\t\t},\n\t},\n\n\twatch: {\n\t\tdescription(): void\n\t\t{\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.isDescriptionOverflowed = this.checkDescriptionOverflowed();\n\t\t\t});\n\t\t},\n\t\tfocusedNode(): void\n\t\t{\n\t\t\tthis.isDescriptionExpanded = false;\n\t\t\tthis.selectTab('usersTab');\n\t\t},\n\t\tisCollapsed(): void\n\t\t{\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.isDescriptionOverflowed = this.checkDescriptionOverflowed();\n\t\t\t});\n\t\t},\n\t},\n\n\tmethods:\n\t{\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tselectTab(tabName): void\n\t\t{\n\t\t\tif (this.isTabDisabled(tabName))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.activeTab = tabName;\n\t\t},\n\t\tgetTabLabel(name: string): string\n\t\t{\n\t\t\tif (name === 'usersTab')\n\t\t\t{\n\t\t\t\treturn this.isTeamEntity\n\t\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_TEAM_USERS_TITLE')\n\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_USERS_TITLE');\n\t\t\t}\n\n\t\t\tif (name === 'chatsTab')\n\t\t\t{\n\t\t\t\treturn this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_TAB_CHATS_TITLE');\n\t\t\t}\n\n\t\t\treturn '';\n\t\t},\n\t\ttoggleDescriptionExpand(): void\n\t\t{\n\t\t\tthis.isDescriptionExpanded = !this.isDescriptionExpanded;\n\t\t},\n\t\tcheckDescriptionOverflowed(): boolean\n\t\t{\n\t\t\tconst descriptionContainer = this.$refs.descriptionContainer ?? null;\n\t\t\tif (descriptionContainer)\n\t\t\t{\n\t\t\t\treturn descriptionContainer.scrollHeight > descriptionContainer.clientHeight;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\t\thideDetailLoader(): void\n\t\t{\n\t\t\tthis.$emit('hideDetailLoader');\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.isDescriptionOverflowed = this.checkDescriptionOverflowed();\n\t\t\t});\n\t\t},\n\t\tisTabDisabled(tabName: string): boolean\n\t\t{\n\t\t\tif (tabName === 'chatsTab' && this.tabArray.find((tab) => tab.name === tabName).count === 0)\n\t\t\t{\n\t\t\t\tconst permissionChecker = PermissionChecker.getInstance();\n\t\t\t\tconst canEditChats = this.isTeamEntity\n\t\t\t\t\t? permissionChecker.hasPermission(PermissionActions.teamCommunicationEdit, this.focusedNode)\n\t\t\t\t\t: permissionChecker.hasPermission(PermissionActions.departmentCommunicationEdit, this.focusedNode)\n\t\t\t\t;\n\n\t\t\t\tif (!canEditChats)\n\t\t\t\t{\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"hr-department-detail-content hr-department-detail-content__scope\">\n\t\t\t<div\n\t\t\t\tref=\"descriptionContainer\"\n\t\t\t\tv-show=\"description\"\n\t\t\t\t:class=\"[\n\t\t\t\t\t'hr-department-detail-content-description',\n\t\t\t\t\t{ '--expanded': isDescriptionExpanded },\n\t\t\t\t\t{ '--overflowed': isDescriptionOverflowed},\n\t\t\t\t]\"\n\t\t\t\tv-on=\"isDescriptionOverflowed ? { click: toggleDescriptionExpand } : {}\"\n\t\t\t>\n\t\t\t\t{{ description }}\n\t\t\t</div>\n\t\t\t<div class=\"hr-department-detail-content__tab-list\">\n\t\t\t\t<button\n\t\t\t\t\tv-for=\"tab in tabArray\"\n\t\t\t\t\t:key=\"tab.name\"\n\t\t\t\t\tclass=\"hr-department-detail-content__tab-item\"\n\t\t\t\t\t:class=\"[{'--active-tab' : activeTab === tab.name, '--disabled-tab': isTabDisabled(tab.name)}]\"\n\t\t\t\t\t@click=\"selectTab(tab.name)\"\n\t\t\t\t\t:data-id=\"tab.id ? 'hr-department-detail-content__' + tab.id + '_button' : null\"\n\t\t\t\t>\n\t\t\t\t\t{{ this.getTabLabel(tab.name) }}\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass=\"hr-department-detail-content__tab-count\"\n\t\t\t\t\t\t:data-id=\"tab.id ? 'hr-department-detail-content__' + tab.id + '_counter' : null\"\n\t\t\t\t\t>{{ tab.count }}\n\t\t\t\t\t</span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t<UsersTab\n\t\t\t\tv-show=\"activeTab === 'usersTab'\"\n\t\t\t\t@showDetailLoader=\"$emit('showDetailLoader')\"\n\t\t\t\t@hideDetailLoader=\"hideDetailLoader\"\n\t\t\t/>\n\t\t\t<ChatsTab\n\t\t\t\tv-show=\"activeTab === 'chatsTab'\"\n\t\t\t\t:is=\"activeTabComponent\"\n\t\t\t\t@showDetailLoader=\"$emit('showDetailLoader')\"\n\t\t\t\t@hideDetailLoader=\"hideDetailLoader\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n"],"names":["HeadListDataTestIds","Object","freeze","containerDataTestId","listActionButtonDataTestId","listActonMenuDataTestId","listCounterDataTestId","EmployeeListDataTestIds","EmptyTabAddButton","name","components","RouteActionMenu","props","departmentId","type","Number","required","entityType","String","default","EntityTypes","department","data","menuVisible","computed","menu","EmptyUsersTabActionMenu","AnalyticsSourceType","DETAIL","mapState","useChartStore","methods","loc","phraseCode","replacements","$Bitrix","Loc","getMessage","onClick","team","items","length","onActionMenuItemClick","id","actionId","template","DepartmentAPI","getPagedEmployees","page","countPerPage","getData","nodeId","removeUserFromDepartment","userId","postData","moveUserToDepartment","targetNodeId","isUserInMultipleDepartments","getUserInfo","fireUser","findMemberByQuery","query","getChatsAndChannels","saveChats","ids","removeIds","parentId","DepartmentContentActions","targetDepartmentId","role","store","departments","get","targetDepartment","oldMemberRoles","getMemberRoles","targetMemberRoles","user","employee","employees","find","heads","head","userCount","filter","changeCurrentDepartment","push","updateEmployees","set","updateEmployeeListOptions","options","employeeListOptions","setChatsAndChannels","chats","channels","channelsDetailed","chatsDetailed","chatAndChannelsCount","removeUserFromAllDepartments","departmentsToUpdate","key","Type","isArray","some","refreshDepartments","unbindChatFromNode","chatId","chat","MoveUserActionPopup","ConfirmationPopup","emits","created","permissionChecker","PermissionChecker","getInstance","action","isTeamEntity","PermissionActions","teamAddMember","employeeAddToDepartment","selectedDepartmentId","showMoveUserActionLoader","lockMoveUserActionButton","showUserAlreadyBelongsToDepartmentPopup","accessDenied","mounted","departmentContainer","$refs","departmentSelector","createTagSelector","renderTo","includedNodeEntityTypesInDialog","getMoveUserActionPhrase","departmentName","Text","encode","focusedNode","userName","gender","replace","url","getUserAlreadyBelongsToDepartmentPopupPhrase","selectedParentDepartment","phrase","memberRoles","confirmTitle","confirmDescription","TagSelector","events","onTagAdd","event","tag","hasPermission","onTagRemove","multiple","dialogOptions","width","height","dropdownMode","hideOnDeselect","entities","selectMode","restricted","includedNodeEntityTypes","useMultipleTabs","preselectedItems","confirmMoveUser","error","code","UI","Notification","Center","notify","content","autoHideDelay","$emit","closeAction","closeUserAlreadyBelongsToDepartmentPopup","UserListItemActionButton","showRemoveUserConfirmationPopup","showRemoveUserConfirmationActionLoader","showMoveUserPopup","showFireUserPopup","fireUserLoad","toggleMenu","MenuActions","moveUserToAnotherDepartment","fireUserFromCompany","removeUser","rootDepartment","values","cancelRemoveUser","isInvited","cancelFireUser","handleMoveUserAction","handleMoveUserClose","getMemberKeyByValue","value","keys","UserListActionMenu","getFirePopupDescription","userUrl","genderSuffix","description","getFirePopupTitle","getFirePopupButtonText","getRemovePopupTitle","getRemovePopupDescription","UserListItem","selectedUserId","defaultAvatar","handleUserClick","item","BX","SidePanel","Instance","open","cacheable","EmptyState","title","imageClass","list","Array","EmptyListItem","withAddPermission","Boolean","ListActionButton","menuItems","dataTestIds","itemId","TabList","count","listItems","emptyItemTitle","emptyItemImageClass","hideEmptyItem","needToShowCount","isNumber","SearchInput","placeholder","dataTestId","hasFocus","handleInput","target","handleBlur","clearInput","UsersTab","searchQuery","needToScroll","headCount","formattedHeads","map","subtitle","workPosition","badgeText","getBadgeText","sort","a","b","roleOrder","deputyHead","roleA","roleB","filteredHeads","toLowerCase","includes","employeeCount","memberCount","formattedEmployees","reverse","filteredEmployees","mapWritableState","showSearchBar","showSearchEmptyState","canAddUsers","permission","headListEmptyStateTitle","employeesListEmptyStateTitle","shouldUpdateList","departmentUsersStatus","loaded","headMenu","UsersTabActionMenu","employeeMenu","isEmployeeListOptionsSet","employeeTitle","emptyStateTitle","emptyStateDescription","watch","newId","isListUpdated","loadEmployeesAction","isDescriptionExpanded","searchedUserId","needToFocusUserId","$nextTick","scrollToUser","handler","immediate","newQuery","searchMembers","usersStatus","prevUsersStatus","prevDepartmentId","prevLoaded","clearSearchTimeout","tabContainer","updateList","employeesList","scrollPosition","scrollTop","clientHeight","scrollHeight","loadedEmployees","employeeIds","Set","newEmployees","has","unshift","selectors","element","querySelector","scrollIntoView","behavior","block","setTimeout","clearTimeout","findQueryResult","success","failure","nodeResults","failedQuery","startsWith","founded","newMembers","found","searchUser","onHeadListActionMenuItemClick","onEmployeeListActionMenuItemClick","getHeadListDataTestIds","getEmployeeListDataTestIds","ChatsMenuOption","addChat","linkChat","addChannel","linkChannel","ChatsMenuLinkChat","bIcon","Main","CHAT_MESSAGE","size","colorTokenName","ChatsMenuAddChat","ADD_CHAT","ChatsMenuLinkChannel","SPEAKER_MOUTHPIECE","ChatsMenuAddChannel","SPEAKER_MOUTHPIECE_PLUS","ChatListDataTestIds","ChannelListDataTestIds","ChatLinkDialogDataTestIds","confirmButtonDataTestId","cancelButtonDataTestId","closeButtonDataTestId","ChannelLinkDialogDataTestIds","EmptyTabAddButtons","chatMenuVisible","channelMenuVisible","chatButtonId","channelButtonId","onChatButtonClick","onChannelButtonClick","ChatListItemActionButton","showUnbindChatConfirmationPopup","unbindChatLoader","getUnbindChatTitle","chatType","isChat","getUnbindChatDescription","ChatTypes","ChatListActionMenu","openChat","Messenger","dialogId","unbindChat","cancelUnbindChat","ChatListItem","ResponsiveHint","avatar","channel","originalNodeName","originalNodeId","indirectChatSubtitle","lockHint","hasAccess","prepareAvatar","color","getColorCode","avatarOptions","baseColor","isExtranet","click","onChatItemClick","userpicPath","AvatarRound","AvatarSquare","locateToOriginalDepartment","EventEmitter","emit","HR_ORG_CHART_LOCATE_TO_DEPARTMENT","ChatsTab","ManagementDialog","isChatLinkActive","chatLinkDialogVisible","isChannelLinkActive","channelLinkDialogVisible","isLoading","loadChatAction","searchChatOrChannel","force","loadedChatsAndChannels","getChatListMenuItems","canEdit","getChannelListMenuItems","getAddEmptyStateList","stateArray","text","getChatListDataTestIds","getChannelListDataTestIds","getChatLinkDialogEntities","entity","getChatDialogEntity","excludeIds","getChannelLinkDialogEntities","getChannelDialogEntity","getChatLinkRecentTabOptions","getChatRecentTabOptions","teamEntity","ChatTypeDict","getChannelLinkRecentTabOptions","linkChats","chatsItems","chatItem","getChatLinkDialogDataTestIds","getChannelLinkDialogDataTestIds","filteredChats","filteredChannels","showAddEmptyState","getLinkedChatIds","getLinkedChannelIds","channelItem","isChatsLoaded","getAddEmptyStateTitle","getAddChatDescription","getAddChannelDescription","chatMenuItems","channelMenuItems","emptyChatTitle","emptyChannelTitle","teamCommunicationEdit","departmentCommunicationEdit","DepartmentContent","isCollapsed","activeTab","tabs","component","isDescriptionOverflowed","activeTabComponent","tab","usersCount","tabArray","checkDescriptionOverflowed","selectTab","tabName","isTabDisabled","getTabLabel","toggleDescriptionExpand","descriptionContainer","hideDetailLoader","canEditChats"],"mappings":"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"}