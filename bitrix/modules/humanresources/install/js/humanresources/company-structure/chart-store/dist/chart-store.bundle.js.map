{"version":3,"file":"chart-store.bundle.js","sources":["../src/classes/user-service.js","../src/index.js"],"sourcesContent":["import { getData, getMemberRoles } from 'humanresources.company-structure.api';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { Type } from 'main.core';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\n\nexport class UserServiceClass\n{\n\tasync addUsersToEntity(\n\t\tentityId: number,\n\t\tusers: Array, // array of user objects. Each object should contain user data such as id, name, etc\n\t\tuserCount: number,\n\t\trole: string,\n\t): void\n\t{\n\t\tconst store = useChartStore();\n\t\tconst targetEntity = store.departments.get(entityId);\n\t\tif (!targetEntity)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst memberRoles = getMemberRoles(targetEntity.entityType);\n\n\t\tconst newMemberUserIds = new Set(users.map((user) => user.id));\n\t\tif (newMemberUserIds.has(store.userId))\n\t\t{\n\t\t\tstore.changeCurrentDepartment(0, targetEntity.id);\n\t\t}\n\t\tconst heads = (targetEntity.heads ?? []).filter((user) => !newMemberUserIds.has(user.id));\n\n\t\tconst employees = (targetEntity.employees ?? []).filter((user) => !newMemberUserIds.has(user.id));\n\t\t(role === memberRoles.employee ? employees : heads).push(...users);\n\n\t\ttargetEntity.heads = heads;\n\t\ttargetEntity.employees = employees;\n\t\ttargetEntity.userCount = userCount;\n\n\t\tawait this.refreshMultipleUsers();\n\t}\n\n\tremoveUserFromEntity(entityId: number, userId: number, role: ?string): void\n\t{\n\t\tconst store = useChartStore();\n\t\tconst entity = store.departments.get(entityId);\n\t\tif (!entity)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst oldMemberRoles = getMemberRoles(entity.entityType);\n\n\t\tif (userId === store.userId)\n\t\t{\n\t\t\tstore.changeCurrentDepartment(entityId);\n\t\t}\n\n\t\tentity.userCount -= 1;\n\t\tif (role === oldMemberRoles.employee)\n\t\t{\n\t\t\tentity.employees = entity.employees.filter((employee) => employee.id !== userId);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tentity.heads = entity.heads.filter((head) => head.id !== userId);\n\t\t}\n\n\t\tconst key = String(userId);\n\t\tconst nodeIds = store.multipleUsers[key];\n\t\tif (Type.isArray(nodeIds))\n\t\t{\n\t\t\tconst filtered = nodeIds.filter((id) => Number(id) !== Number(entityId));\n\t\t\tif (filtered.length >= 2)\n\t\t\t{\n\t\t\t\tstore.multipleUsers[key] = filtered;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tdelete store.multipleUsers[key];\n\t\t\t}\n\t\t}\n\t}\n\n\tmoveUserToEntity(entityId: number, userId: number, targetEntityId: number, role: string): void\n\t{\n\t\tconst store = useChartStore();\n\t\tconst entity = store.departments.get(entityId);\n\t\tconst targetEntity = store.departments.get(targetEntityId);\n\n\t\tif (!entity || !targetEntity)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst oldMemberRoles = getMemberRoles(entity.entityType);\n\t\tconst targetMemberRoles = getMemberRoles(targetEntity.entityType);\n\t\tconst user = role === oldMemberRoles.employee\n\t\t\t? entity.employees?.find((employee) => employee.id === userId)\n\t\t\t: entity.heads.find((head) => head.id === userId)\n\t\t;\n\n\t\tif (!user)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tentity.userCount -= 1;\n\t\tif (role === oldMemberRoles.employee)\n\t\t{\n\t\t\tentity.employees = entity.employees.filter((employee) => employee.id !== userId);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tentity.heads = entity.heads.filter((head) => head.id !== userId);\n\t\t}\n\n\t\ttargetEntity.userCount += 1;\n\t\tif (userId === store.userId)\n\t\t{\n\t\t\tstore.changeCurrentDepartment(entityId, targetEntityId);\n\t\t}\n\n\t\tuser.role = targetMemberRoles.employee;\n\t\tif (!targetEntity.employees)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\ttargetEntity.employees.push(user);\n\n\t\tif (entity.entityType === EntityTypes.department)\n\t\t{\n\t\t\tconst key = String(userId);\n\t\t\tconst entityIds = store.multipleUsers[key];\n\t\t\tif (Type.isArray(entityIds))\n\t\t\t{\n\t\t\t\tconst current = new Set(entityIds.map((v) => Number(v)));\n\t\t\t\tcurrent.delete(Number(entityId));\n\t\t\t\tcurrent.add(Number(targetEntityId));\n\t\t\t\tstore.multipleUsers[key] = [...current];\n\t\t\t}\n\t\t}\n\t}\n\n\tasync moveUsersToEntity(\n\t\tentityId: number,\n\t\tusers: Array, // array of user objects. Each object should contain user data such as id, name, etc\n\t\tuserCount: number,\n\t\tupdatedDepartmentIds: number[],\n\t): void\n\t{\n\t\tconst store = useChartStore();\n\t\tconst entityDepartment = store.departments.get(entityId);\n\t\tif (!entityDepartment)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst newMemberUserIds = new Set(users.map((user) => user.id));\n\t\tconst employees = (entityDepartment.employees ?? []).filter((user) => !newMemberUserIds.has(user.id));\n\t\tconst headsUserIds = new Set(entityDepartment.heads.map((head) => head.id));\n\t\tconst newUsers = users.filter((user) => !headsUserIds.has(user.id));\n\t\temployees.push(...newUsers);\n\t\tentityDepartment.employees = employees;\n\t\tentityDepartment.userCount = userCount;\n\n\t\tusers.forEach(({ id }) => {\n\t\t\tconst key = String(id);\n\t\t\tif (Object.prototype.hasOwnProperty.call(store.multipleUsers, key))\n\t\t\t{\n\t\t\t\tdelete store.multipleUsers[key];\n\t\t\t}\n\t\t});\n\n\t\tif (updatedDepartmentIds.length > 0)\n\t\t{\n\t\t\tvoid store.refreshDepartments(updatedDepartmentIds);\n\t\t}\n\t}\n\n\tasync removeUserFromAllEntities(userId: number): Promise<void>\n\t{\n\t\tconst store = useChartStore();\n\t\tconst entities = store.departments;\n\t\tconst entitiesToUpdate = [];\n\n\t\tfor (const [key, entity] of entities)\n\t\t{\n\t\t\tif (\n\t\t\t\t(\n\t\t\t\t\t'heads' in entity\n\t\t\t\t\t&& Type.isArray(entity.heads)\n\t\t\t\t\t&& entity.heads.some((employee) => employee.id === userId)\n\t\t\t\t)\n\t\t\t\t|| (\n\t\t\t\t\t'employees' in entity\n\t\t\t\t\t&& Type.isArray(entity.employees)\n\t\t\t\t\t&& entity.employees.some((employee) => employee.id === userId)\n\t\t\t\t)\n\t\t\t)\n\t\t\t{\n\t\t\t\tentitiesToUpdate.push(key);\n\t\t\t}\n\t\t}\n\t\tdelete store.multipleUsers[String(userId)];\n\n\t\treturn store.refreshDepartments(entitiesToUpdate);\n\t}\n\n\tasync refreshMultipleUsers(): Promise<void>\n\t{\n\t\tconst store = useChartStore();\n\t\tstore.multipleUsers = await getData('humanresources.api.Structure.Node.Member.getMultipleUsersMap');\n\t}\n}\n\nexport const UserService = new UserServiceClass();\n","import { Type } from 'main.core';\nimport { defineStore } from 'ui.vue3.pinia';\nimport { getData } from 'humanresources.company-structure.api';\nimport {\n\tEntityTypes,\n\tWizardApiEntityChangedDict,\n\tNodeSettingsTypes,\n\ttype CommunicationDetailed,\n\ttype UserData,\n\ttype NodeColorSettingsType,\n} from 'humanresources.company-structure.utils';\nimport { UserService } from './classes/user-service';\n\nexport type DepartmentData = {\n\tid: number;\n\tname: string;\n\tdescription: string;\n\tparentId: number;\n\theads: Array<UserData>;\n\temployees: Array<UserData>;\n\tuserCount: number;\n\tchats: Array<number>,\n\tchatsDetailed: Array<CommunicationDetailed>,\n\tchatsNoAccess: number,\n\tchannels: Array<number>,\n\tchannelsDetailed: Array<CommunicationDetailed>,\n\tchannelsNoAccess: number,\n\tcollabsDetailed: Array<CommunicationDetailed>,\n\tcollabsNoAccess: number,\n\tcommunicationsCount?: number,\n\tchildren?: Array<number>,\n\tcreateDefaultChat: boolean,\n\tcreateDefaultChannel: boolean,\n\tteamColor: NodeColorSettingsType,\n\tsettings: {\n\t\t[NodeSettingsTypes.businessProcAuthority]: Set,\n\t\t[NodeSettingsTypes.reportsAuthority]: Set,\n\t},\n\tentityType: EntityTypes.department | EntityTypes.team | EntityTypes.company,\n\tapiEntityChanged: WizardApiEntityChangedDict.department | WizardApiEntityChangedDict.employees,\n};\n\nexport const useChartStore = defineStore('hr-org-chart', {\n\tstate: () => ({\n\t\tdepartments: new Map(), // list of all entities of structures visible to the user with detailed information\n\t\tcurrentDepartments: [],\n\t\tfocusedNode: 0,\n\t\tsearchedUserId: 0,\n\t\tuserId: 0,\n\t\t/** @var Map<number, { id: number, parentId: number, entityType: string }> */\n\t\tstructureMap: new Map(), // map of the entire structure (all entities) with minimal information\n\t\tmultipleUsers: [],\n\t}),\n\tactions: {\n\t\tasync refreshDepartments(nodeIds: number[]): Promise<void>\n\t\t{\n\t\t\tif (nodeIds.length === 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst [departments, currentDepartments] = await Promise.all([\n\t\t\t\tgetData('humanresources.api.Structure.Node.getByIds', { nodeIds }),\n\t\t\t\tgetData('humanresources.api.Structure.Node.current'),\n\t\t\t]);\n\t\t\tthis.currentDepartments = currentDepartments;\n\t\t\tObject.keys(departments).forEach((id) => {\n\t\t\t\tconst department = departments[id];\n\t\t\t\tconst existingDepartment = this.departments.get(Number(id)) || {};\n\t\t\t\tthis.departments.set(Number(id), {\n\t\t\t\t\t...existingDepartment,\n\t\t\t\t\t...department,\n\t\t\t\t\theads: department.heads,\n\t\t\t\t\tuserCount: department.userCount,\n\t\t\t\t\temployees: [],\n\t\t\t\t\temployeeListOptions: {\n\t\t\t\t\t\tpage: 0,\n\t\t\t\t\t\tshouldUpdateList: true,\n\t\t\t\t\t\tisListUpdated: false,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tchangeCurrentDepartment(oldDepartmentId: number, newDepartmentId: ?number): void\n\t\t{\n\t\t\tconst currentDepartments = this.currentDepartments.filter((departmentId) => {\n\t\t\t\treturn departmentId !== oldDepartmentId && departmentId !== newDepartmentId;\n\t\t\t});\n\n\t\t\tif (!newDepartmentId)\n\t\t\t{\n\t\t\t\tthis.currentDepartments = currentDepartments;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.currentDepartments = [\n\t\t\t\t...currentDepartments,\n\t\t\t\tnewDepartmentId,\n\t\t\t];\n\t\t},\n\t\tasync loadHeads(nodeIds: number[]): Promise<void>\n\t\t{\n\t\t\tif (nodeIds.length === 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst heads = await getData('humanresources.api.Structure.Node.getHeadsByIds', { nodeIds });\n\t\t\tnodeIds.forEach((departmentId) => {\n\t\t\t\tconst department = this.departments.get(departmentId);\n\t\t\t\tif (heads[departmentId])\n\t\t\t\t{\n\t\t\t\t\tthis.departments.set(departmentId, { ...department, heads: heads[departmentId] });\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tupdateDepartment(departmentData: DepartmentData, position: ?number): void\n\t\t{\n\t\t\tconst { id, parentId } = departmentData;\n\t\t\tconst oldData = this.departments.get(id);\n\t\t\tconst entityType = oldData.entityType;\n\t\t\tconst prevParent = this.departments.get(oldData.parentId);\n\t\t\tthis.departments.set(id, { ...oldData, ...departmentData });\n\t\t\tthis.structureMap.set(id, {\n\t\t\t\tid,\n\t\t\t\tparentId: parentId ?? oldData.parentId,\n\t\t\t\tentityType,\n\t\t\t});\n\t\t\tif (parentId !== 0 && prevParent.id !== parentId)\n\t\t\t{\n\t\t\t\tprevParent.children = prevParent.children.filter((childId) => childId !== id);\n\t\t\t\tconst newParent = this.departments.get(parentId);\n\t\t\t\tnewParent.children = newParent.children ?? [];\n\t\t\t\tif (Type.isNumber(position))\n\t\t\t\t{\n\t\t\t\t\tnewParent.children.splice(position, 0, id);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tnewParent.children.push(id);\n\t\t\t\t}\n\n\t\t\t\tthis.departments.set(id, { ...this.departments.get(id), prevParentId: prevParent.id });\n\t\t\t}\n\t\t},\n\t\tupdateChatsInChildrenNodes(parentNodeId: number): void\n\t\t{\n\t\t\tconst parentDepartment = this.departments.get(parentNodeId);\n\n\t\t\tif (!parentDepartment || !parentDepartment.children)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.markDescendantsForChatReload(parentDepartment.children);\n\t\t},\n\t\tmarkDescendantsForChatReload(childrenIds: Array<number>): void\n\t\t{\n\t\t\tconst store = useChartStore();\n\t\t\tconst queue = [...childrenIds];\n\t\t\tconst visited = new Set();\n\t\t\tconst maxIterations = 10000;\n\t\t\tlet iterations = 0;\n\n\t\t\twhile (queue.length > 0 && iterations < maxIterations)\n\t\t\t{\n\t\t\t\titerations++;\n\t\t\t\tconst childId = queue.shift();\n\n\t\t\t\tif (visited.has(childId))\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tvisited.add(childId);\n\n\t\t\t\tconst childDepartment = store.departments.get(childId);\n\t\t\t\tif (!childDepartment)\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tchildDepartment.chatsDetailed = null;\n\t\t\t\tchildDepartment.channelsDetailed = null;\n\t\t\t\tchildDepartment.collabsDetailed = null;\n\n\t\t\t\tif (childDepartment.children && childDepartment.children.length > 0)\n\t\t\t\t{\n\t\t\t\t\tqueue.push(...childDepartment.children);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t},\n});\n\nexport {\n\tUserService,\n};\n"],"names":["UserServiceClass","addUsersToEntity","entityId","users","userCount","role","store","useChartStore","targetEntity","departments","get","memberRoles","getMemberRoles","entityType","newMemberUserIds","Set","map","user","id","has","userId","changeCurrentDepartment","heads","filter","employees","employee","push","refreshMultipleUsers","removeUserFromEntity","entity","oldMemberRoles","head","key","String","nodeIds","multipleUsers","Type","isArray","filtered","Number","length","moveUserToEntity","targetEntityId","targetMemberRoles","find","EntityTypes","department","entityIds","current","v","delete","add","moveUsersToEntity","updatedDepartmentIds","entityDepartment","headsUserIds","newUsers","forEach","Object","prototype","hasOwnProperty","call","refreshDepartments","removeUserFromAllEntities","entities","entitiesToUpdate","some","getData","UserService","defineStore","state","Map","currentDepartments","focusedNode","searchedUserId","structureMap","actions","Promise","all","keys","existingDepartment","set","employeeListOptions","page","shouldUpdateList","isListUpdated","oldDepartmentId","newDepartmentId","departmentId","loadHeads","updateDepartment","departmentData","position","parentId","oldData","prevParent","children","childId","newParent","isNumber","splice","prevParentId","updateChatsInChildrenNodes","parentNodeId","parentDepartment","markDescendantsForChatReload","childrenIds","queue","visited","maxIterations","iterations","shift","childDepartment","chatsDetailed","channelsDetailed","collabsDetailed"],"mappings":"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"}