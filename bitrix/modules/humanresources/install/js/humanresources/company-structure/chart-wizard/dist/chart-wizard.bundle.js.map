{"version":3,"file":"chart-wizard.bundle.js","sources":["../src/consts.js","../src/components/tree-preview/head-users.js","../src/components/tree-preview/tree-node.js","../src/components/tree-preview/tree-preview.js","../src/components/team-color-picker/team-color-picker.js","../src/components/steps/department.js","../src/components/change-save-mode-control/change-save-mode-control.js","../src/components/steps/employees.js","../src/components/steps/steps-components/chat-selector.js","../src/components/steps/bind-chat.js","../src/components/steps/entities.js","../src/components/steps/team-rights.js","../src/components/steps/access-denied.js","../src/api.js","../src/actions.js","../src/components/wizard.js"],"sourcesContent":["import type { StepIdType } from './types';\n\nexport const SaveMode: Record<string> = Object.freeze({\n\tmoveUsers: 'moveUsers',\n\taddUsers: 'addUsers',\n});\n\nexport const StepIds: Record<StepIdType, StepIdType> = Object.freeze({\n\tentities: 'entities',\n\tdepartment: 'department',\n\temployees: 'employees',\n\tbindChat: 'bindChat',\n\tteamRights: 'teamRights',\n});\n\nexport const AuthorityTypes: Record<string> = {\n\tdepartmentHead: 'HEAD',\n\tdepartmentDeputy: 'DEPUTY_HEAD',\n\tteamHead: 'TEAM_HEAD',\n\tteamDeputy: 'TEAM_DEPUTY',\n};\n","import { UserListActionMenu } from 'humanresources.company-structure.structure-components';\nimport type { UserData } from 'humanresources.company-structure.utils';\n\nexport const HeadUsers = {\n\tname: 'headUsers',\n\n\tcomponents: {\n\t\tUserListActionMenu,\n\t},\n\n\tprops: {\n\t\tusers: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tshowPlaceholder: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t\tisTeamEntity: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tisExistingDepartment: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t\tuserType: {\n\t\t\ttype: String,\n\t\t\tdefault: 'head',\n\t\t},\n\t\tteamColor: {\n\t\t\ttype: [Object, null],\n\t\t\tdefault: null,\n\t\t},\n\t},\n\n\tdata(): { headsVisible: boolean; }\n\t{\n\t\treturn {\n\t\t\theadsVisible: false,\n\t\t};\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.userTypes = {\n\t\t\thead: 'head',\n\t\t\tdeputy: 'deputy',\n\t\t};\n\t},\n\n\tcomputed:\n\t{\n\t\theadItemsCount(): number\n\t\t{\n\t\t\treturn this.isExistingDepartment ? 1 : 2;\n\t\t},\n\t\tdefaultAvatar(): string\n\t\t{\n\t\t\treturn '/bitrix/js/humanresources/company-structure/org-chart/src/images/default-user.svg';\n\t\t},\n\t\tplaceholderAvatar(): string\n\t\t{\n\t\t\tif (!this.isTeamEntity || !this.teamColor)\n\t\t\t{\n\t\t\t\treturn '/bitrix/js/humanresources/company-structure/chart-wizard/src/components/tree-preview/images/placeholder-avatar.svg';\n\t\t\t}\n\n\t\t\treturn `/bitrix/js/humanresources/company-structure/chart-wizard/src/components/tree-preview/images/${this.teamColor.avatarImage}`;\n\t\t},\n\t\tdropdownItems(): Array<UserData>\n\t\t{\n\t\t\treturn this.users.map((user: UserData): UserData => {\n\t\t\t\tconst workPosition = user.workPosition || this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_HEAD_POSITION');\n\n\t\t\t\treturn { ...user, workPosition };\n\t\t\t});\n\t\t},\n\t\ttitleBar(): string\n\t\t{\n\t\t\treturn this.userType === this.userTypes.deputy\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_DEPUTY_TITLE')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_HEAD_TITLE')\n\t\t\t;\n\t\t},\n\t\tisDeputy(): boolean\n\t\t{\n\t\t\treturn this.userType === this.userTypes.deputy;\n\t\t},\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"chart-wizard-tree-preview__node_head\"\n\t\t\t:class=\"{ '--deputy': isDeputy }\"\n\t\t\tv-for=\"(user, index) in users.slice(0, headItemsCount)\"\n\t\t>\n\t\t\t<img\n\t\t\t\t:src=\"user.avatar || defaultAvatar\"\n\t\t\t\tclass=\"chart-wizard-tree-preview__node_head-avatar --placeholder\"\n\t\t\t\t:class=\"{ '--deputy': isDeputy, '--old': isExistingDepartment }\"\n\t\t\t/>\n\t\t\t<div class=\"chart-wizard-tree-preview__node_head-text\" :class=\"{'--deputy': isDeputy }\">\n\t\t\t\t<span\n\t\t\t\t\tclass=\"chart-wizard-tree-preview__node_head-name --crop\"\n\t\t\t\t\t:class=\"{'--old': isExistingDepartment }\"\n\t\t\t\t>\n\t\t\t\t\t{{ user.name }}\n\t\t\t\t</span>\n\t\t\t\t<span\n\t\t\t\t\tv-if=\"!isDeputy\"\n\t\t\t\t\tclass=\"chart-wizard-tree-preview__node_head-position --crop\"\n\t\t\t\t\t:class=\"{'--old': isExistingDepartment }\"\n\t\t\t\t>\n\t\t\t\t\t{{ user.workPosition || loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_HEAD_POSITION') }}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<span\n\t\t\t\tv-if=\"index === headItemsCount - 1 && users.length > headItemsCount\"\n\t\t\t\tclass=\"chart-wizard-tree-preview__node_head-rest\"\n\t\t\t\t:class=\"{ '--active': headsVisible }\"\n\t\t\t\tref=\"showMoreHeadUserWizardList\"\n\t\t\t\t:data-test-id=\"'hr-company-structure_chart-wizard-tree__preview-' + userType + '-rest'\"\n\t\t\t\t@click.stop=\"headsVisible = true\"\n\t\t\t>\n\t\t\t\t\t{{ '+' + String(users.length - headItemsCount) }}\n\t\t\t</span>\n\t\t</div>\n\t\t<div\n\t\t\tv-if=\"users.length === 0 && showPlaceholder\"\n\t\t\tclass=\"chart-wizard-tree-preview__node_head\"\n\t\t\t:class=\"{ '--deputy': isDeputy }\"\n\t\t>\n\t\t\t<img\n\t\t\t\t:src=\"placeholderAvatar\"\n\t\t\t\tclass=\"chart-wizard-tree-preview__node_head-avatar --placeholder\"\n\t\t\t\t:class=\"{'--deputy': isDeputy, '--old': isExistingDepartment  }\"\n\t\t\t/>\n\t\t\t<div class=\"chart-wizard-tree-preview__node_head-text\">\n\t\t\t\t<span\n\t\t\t\t\tclass=\"chart-wizard-tree-preview__placeholder_name\"\n\t\t\t\t\t:class=\"{'--deputy': isDeputy, '--team': isTeamEntity }\"\n\t\t\t\t\t:style=\"{ 'background-color': teamColor ? teamColor.namePlaceholder : false }\"\n\t\t\t\t></span>\n\t\t\t\t<span\n\t\t\t\t\tv-if=\"!isDeputy\"\n\t\t\t\t\tclass=\"chart-wizard-tree-preview__node_head-position --crop\"\n\t\t\t\t>\n\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_HEAD_POSITION') }}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<UserListActionMenu\n\t\t\tv-if=\"headsVisible\"\n\t\t\t:id=\"isDeputy ? 'wizard-head-list-popup-deputy' : 'wizard-head-list-popup-head' \"\n\t\t\t:items=\"dropdownItems\"\n\t\t\t:width=\"228\"\n\t\t\t:bindElement=\"$refs.showMoreHeadUserWizardList[0]\"\n\t\t\t@close=\"headsVisible = false\"\n\t\t\t:titleBar=\"titleBar\"\n\t\t/>\n\t`,\n};\n","import { mapState } from 'ui.vue3.pinia';\nimport { Loader } from 'main.loader';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { Loc } from 'main.core';\nimport { getMemberRoles } from 'humanresources.company-structure.api';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\nimport { HeadUsers } from './head-users';\nimport { PermissionActions, PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport type { DepartmentData } from '../../types';\n\nexport const TreeNode = {\n\tname: 'treeNode',\n\n\tcomponents: { HeadUsers },\n\n\tprops: {\n\t\tname: String,\n\t\theads: Array,\n\t\tuserCount: Number,\n\t\tnodeId: Number,\n\t\tentityType: {\n\t\t\ttype: String,\n\t\t\tdefault: EntityTypes.department,\n\t\t},\n\t\t/** @type NodeColorSettingsType | null */\n\t\tteamColor: {\n\t\t\ttype: [Object, null],\n\t\t\tdefault: null,\n\t\t},\n\t},\n\n\tdata(): { isShowLoader: boolean; }\n\t{\n\t\treturn { isShowLoader: false };\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.memberRoles = getMemberRoles(this.departmentData.entityType);\n\t},\n\n\twatch:\n\t{\n\t\tisShowLoader(newValue: boolean): void\n\t\t{\n\t\t\tif (!newValue)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tconst { loaderContainer } = this.$refs;\n\t\t\t\tconst loader = new Loader({ size: 30 });\n\t\t\t\tloader.show(loaderContainer);\n\t\t\t});\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tdepartmentData(): DepartmentData | { name: string, ...Partial<DepartmentData> }\n\t\t{\n\t\t\tif (this.isExistingDepartment)\n\t\t\t{\n\t\t\t\tif (!this.isHeadsLoaded)\n\t\t\t\t{\n\t\t\t\t\tthis.loadHeads([this.nodeId]);\n\t\t\t\t}\n\n\t\t\t\treturn this.departments.get(this.nodeId);\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tname: this.name,\n\t\t\t\theads: this.heads,\n\t\t\t\tuserCount: this.userCount,\n\t\t\t\tentityType: this.entityType,\n\t\t\t};\n\t\t},\n\t\tisExistingDepartment(): boolean\n\t\t{\n\t\t\treturn Boolean(this.nodeId);\n\t\t},\n\t\temployeesCount(): number\n\t\t{\n\t\t\treturn (this.userCount || 0) - (this.heads?.length || 0);\n\t\t},\n\t\theadUsers(): ?Array<DepartmentData['heads']>\n\t\t{\n\t\t\treturn this.departmentData.heads?.filter((head) => {\n\t\t\t\treturn head.role === this.memberRoles.head;\n\t\t\t});\n\t\t},\n\t\tdeputyUsers(): ?Array<DepartmentData['heads']>\n\t\t{\n\t\t\treturn this.departmentData.heads?.filter((head) => {\n\t\t\t\treturn head.role === this.memberRoles.deputyHead;\n\t\t\t});\n\t\t},\n\t\tshowInfo(): boolean\n\t\t{\n\t\t\treturn this.nodeId\n\t\t\t\t? PermissionChecker.getInstance().hasPermission(PermissionActions.structureView, this.nodeId)\n\t\t\t\t: true;\n\t\t},\n\t\tisHeadsLoaded(departmentId: number): boolean\n\t\t{\n\t\t\tconst { heads } = this.departments.get(this.nodeId);\n\n\t\t\treturn Boolean(heads);\n\t\t},\n\t\tisTeamEntity(): boolean\n\t\t{\n\t\t\treturn this.departmentData.entityType === EntityTypes.team;\n\t\t},\n\t\tdataTestIdSuffix(): string\n\t\t{\n\t\t\treturn this.isExistingDepartment ? '' : '_new';\n\t\t},\n\t\t...mapState(useChartStore, ['departments']),\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tlocPlural(phraseCode: string, count: number): string\n\t\t{\n\t\t\treturn Loc.getMessagePlural(phraseCode, count, { '#COUNT#': count });\n\t\t},\n\t\tasync loadHeads(departmentIds: number[]): Promise<void>\n\t\t{\n\t\t\tconst store = useChartStore();\n\t\t\ttry\n\t\t\t{\n\t\t\t\tthis.isShowLoader = true;\n\t\t\t\tawait store.loadHeads(departmentIds);\n\t\t\t}\n\t\t\tfinally\n\t\t\t{\n\t\t\t\tthis.isShowLoader = false;\n\t\t\t}\n\t\t},\n\t\tformatDataTestId(prefix: string): string\n\t\t{\n\t\t\treturn prefix + this.dataTestIdSuffix;\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"chart-wizard-tree-preview__node\"\n\t\t\t:class=\"{ '--new': !isExistingDepartment, '--old': isExistingDepartment,'--team': isTeamEntity }\"\n\t\t>\n\t\t\t<div \n\t\t\t\tclass=\"chart-wizard-tree-preview__node_summary\" \n\t\t\t\t:class=\"{ '--old': isExistingDepartment, '--team': isTeamEntity }\"\n\t\t\t\t:style=\"{ '--team-border-color': teamColor?.previewBorder }\"\n\t\t\t>\n\t\t\t\t<div \n\t\t\t\t\tclass=\"chart-wizard-tree-preview__node_name --crop\"\n\t\t\t\t\t:data-test-id=\"formatDataTestId('chart-wizard-tree-preview__node_name')\"\n\t\t\t\t\t:style=\"{ 'background-color': teamColor ? teamColor.headBackground : false }\"\n\t\t\t\t>\n\t\t\t\t\t<span\n\t\t\t\t\t\tv-if=\"!departmentData.name\" \n\t\t\t\t\t\tclass=\"chart-wizard-tree-preview__placeholder_node_name\"\n\t\t\t\t\t\t:class=\"{ '--team': isTeamEntity }\"\n\t\t\t\t\t\t:style=\"{ 'background-color': teamColor ? teamColor.namePlaceholder : false }\"\n\t\t\t\t\t></span>\n\t\t\t\t\t{{departmentData.name}}\n\t\t\t\t</div>\n\t\t\t\t<div \n\t\t\t\t\tclass=\"chart-wizard-tree-preview__node_content\"\n\t\t\t\t\t:data-test-id=\"formatDataTestId('chart-wizard-tree-preview__head_list')\"\n\t\t\t\t>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"chart-wizard-tree-preview__head_list\"\n\t\t\t\t\t\t:data-test-id=\"formatDataTestId('chart-wizard-tree-preview__head_list')\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<HeadUsers\n\t\t\t\t\t\t\tv-if=\"showInfo && headUsers\"\n\t\t\t\t\t\t\t:users=\"headUsers\"\n\t\t\t\t\t\t\t:showPlaceholder=\"!isExistingDepartment\"\n\t\t\t\t\t\t\t:isTeamEntity=\"isTeamEntity\"\n\t\t\t\t\t\t\t:isExistingDepartment=\"isExistingDepartment\"\n\t\t\t\t\t\t\t:teamColor=\"teamColor\"\n\t\t\t\t\t\t/> \n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if=\"isShowLoader\" ref=\"loaderContainer\"></div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"showInfo && !isExistingDepartment\"\n\t\t\t\t\t\tclass=\"chart-wizard-tree-preview__node_employees\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"chart-wizard-tree-preview__node_employees-list\"\n\t\t\t\t\t\t\t:data-test-id=\"formatDataTestId('chart-wizard-tree-preview__node_employees-list')\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<p class=\"chart-wizard-tree-preview__node_employees-title\">\n\t\t\t\t\t\t\t\t{{\n\t\t\t\t\t\t\t\t\tisTeamEntity \n\t\t\t\t\t\t\t\t\t? loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TREE_PREVIEW_TEAM_EMPLOYEES_TITLE') \n\t\t\t\t\t\t\t\t\t: loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TREE_PREVIEW_EMPLOYEES_TITLE')\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<span class=\"chart-wizard-tree-preview__node_employees_count\">\n\t\t\t\t\t\t\t\t{{locPlural('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TREE_PREVIEW_EMPLOYEES_COUNT', employeesCount)}}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div \n\t\t\t\t\t\t\tclass=\"chart-wizard-tree-preview__node_deputies\"\n\t\t\t\t\t\t\t:data-test-id=\"formatDataTestId('chart-wizard-tree-preview__node_deputies-list')\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<p class=\"chart-wizard-tree-preview__node_employees-title\">\n\t\t\t\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TREE_PREVIEW_DEPUTIES_TITLE')}}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<HeadUsers\n\t\t\t\t\t\t\t\t:users=\"deputyUsers\"\n\t\t\t\t\t\t\t\t:isTeamEntity=\"isTeamEntity\"\n\t\t\t\t\t\t\t\t:isExistingDepartment=\"isExistingDepartment\"\n\t\t\t\t\t\t\t\tuserType=\"deputy\"\n\t\t\t\t\t\t\t\t:teamColor=\"teamColor\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<slot v-if=\"isExistingDepartment\"></slot>\n\t\t</div>\n\t`,\n};\n","import { mapState } from 'ui.vue3.pinia';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { TreeNode } from './tree-node';\nimport { EntityTypes, type NodeColorSettingsType } from 'humanresources.company-structure.utils';\nimport './style.css';\n\nexport const TreePreview = {\n\tname: 'treePreview',\n\n\tcomponents: { TreeNode },\n\n\tprops: {\n\t\tparentId: {\n\t\t\ttype: [Number, null],\n\t\t\trequired: true,\n\t\t},\n\t\tname: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\theads: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tuserCount: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tentityType: {\n\t\t\ttype: String,\n\t\t\tdefault: EntityTypes.department,\n\t\t},\n\t\t/** @type NodeColorSettingsType | null */\n\t\tteamColor: {\n\t\t\ttype: [Object, null],\n\t\t\tdefault: null,\n\t\t},\n\t},\n\n\tcomputed:\n\t{\n\t\trootId(): number\n\t\t{\n\t\t\tconst parentNode = this.departments.get(this.parentId);\n\t\t\tif (parentNode)\n\t\t\t{\n\t\t\t\treturn parentNode.parentId ?? 0;\n\t\t\t}\n\n\t\t\treturn 0;\n\t\t},\n\t\tcompanyName(): string\n\t\t{\n\t\t\tconst { name } = [...this.departments.values()].find((department) => {\n\t\t\t\treturn department.parentId === 0;\n\t\t\t});\n\n\t\t\treturn name;\n\t\t},\n\t\tisTeamEntity(): boolean\n\t\t{\n\t\t\treturn this.entityType === EntityTypes.team;\n\t\t},\n\t\t...mapState(useChartStore, ['departments']),\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"chart-wizard-tree-preview\">\n\t\t\t<div class=\"chart-wizard-tree-preview__header\">\n\t\t\t\t<span class=\"chart-wizard-tree-preview__header_text\">\n\t\t\t\t\t{{\n\t\t\t\t\t\tisTeamEntity\n\t\t\t\t\t\t\t? loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TREE_PREVIEW_TEAM_TITLE')\n\t\t\t\t\t\t\t: loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TREE_PREVIEW_DEPARTMENT_TITLE')\n\t\t\t\t\t}}\n\t\t\t\t</span>\n\t\t\t\t<span class=\"chart-wizard-tree-preview__header_name\">\n\t\t\t\t\t{{ companyName }}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<TreeNode\n\t\t\t\tv-if=\"rootId\"\n\t\t\t\t:nodeId=\"rootId\"\n\t\t\t>\n\t\t\t\t<TreeNode :nodeId=\"parentId\">\n\t\t\t\t\t<TreeNode\n\t\t\t\t\t\t:name=\"name\"\n\t\t\t\t\t\t:heads=\"heads\"\n\t\t\t\t\t\t:userCount=\"userCount\"\n\t\t\t\t\t\t:entityType=\"entityType\"\n\t\t\t\t\t\t:teamColor=\"teamColor\"\n\t\t\t\t\t></TreeNode>\n\t\t\t\t</TreeNode>\n\t\t\t</TreeNode>\n\t\t\t<TreeNode\n\t\t\t\tv-else-if=\"parentId\"\n\t\t\t\t:nodeId=\"parentId\"\n\t\t\t>\n\t\t\t\t<TreeNode\n\t\t\t\t\t:name=\"name\"\n\t\t\t\t\t:heads=\"heads\"\n\t\t\t\t\t:userCount=\"userCount\"\n\t\t\t\t\t:entityType=\"entityType\"\n\t\t\t\t\t:teamColor=\"teamColor\"\n\t\t\t\t></TreeNode>\n\t\t\t</TreeNode>\n\t\t\t<TreeNode\n\t\t\t\tv-else\n\t\t\t\t:name=\"name\"\n\t\t\t\t:heads=\"heads\"\n\t\t\t\t:userCount=\"userCount\"\n\t\t\t\t:entityType=\"entityType\"\n\t\t\t\t:teamColor=\"teamColor\"\n\t\t\t></TreeNode>\n\t\t</div>\n\t`,\n};\n","import { BasePopup } from 'humanresources.company-structure.structure-components';\nimport type { PopupOptions } from 'main.popup';\nimport { NodeColorsSettingsDict } from 'humanresources.company-structure.utils';\n\n// @vue/component\nexport const TeamColorPicker = {\n\tname: 'TeamColorPicker',\n\n\tcomponents: {\n\t\tBasePopup,\n\t},\n\n\tprops: {\n\t\t/** @type NodeColorSettingsType */\n\t\tmodelValue: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tbindElement: {\n\t\t\ttype: HTMLElement,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\temits: ['action', 'close', 'update:modelValue'],\n\n\tcomputed:\n\t{\n\t\tpopupConfig(): PopupOptions\n\t\t{\n\t\t\tconst popupWidth = 164;\n\t\t\tconst pickerWidth = 41;\n\t\t\tconst initialPopupOffset = 39;\n\t\t\tconst angleWidth = 33;\n\n\t\t\treturn {\n\t\t\t\twidth: popupWidth,\n\t\t\t\theight: 116,\n\t\t\t\tbindElement: this.bindElement,\n\t\t\t\tborderRadius: 12,\n\t\t\t\tcontentNoPaddings: true,\n\t\t\t\tcontentPadding: 0,\n\t\t\t\tpadding: 0,\n\t\t\t\toffsetTop: 4,\n\t\t\t\toffsetLeft: pickerWidth / 2 - popupWidth / 2 + initialPopupOffset,\n\t\t\t\tangleOffset: popupWidth / 2 - angleWidth / 2,\n\t\t\t};\n\t\t},\n\t\tnodeColorsSettingsDict(): typeof NodeColorsSettingsDict => NodeColorsSettingsDict\n\t\t{\n\t\t\treturn NodeColorsSettingsDict;\n\t\t},\n\t},\n\n\tmethods:\n\t{\n\t\tclose(): void\n\t\t{\n\t\t\tthis.$emit('close');\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<BasePopup\n\t\t\t:config=\"popupConfig\"\n\t\t\t:id=\"'chart_wizard__department__color-picker_popup'\"\n\t\t\t@close=\"close\"\n\t\t>\n\t\t\t<div\n\t\t\t\tclass=\"chart_wizard__department__color-picker_popup-container\"\n\t\t\t\t:data-test-id=\"'wizard-department-color-picker-popup'\"\n\t\t\t>\n\t\t\t\t<div v-for=\"item in nodeColorsSettingsDict\" \n\t\t\t\t\t class=\"chart_wizard__department__color-picker_color-item\"\n\t\t\t\t\t :class=\" {'--active': item.name === modelValue.name }\"\n\t\t\t\t\t @click=\"$emit('update:modelValue', item)\"\n\t\t\t\t\t :data-test-id=\"'wizard-department-color-picker-item-'+item.name\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"chart_wizard__department__color-picker_color-item_inner\"\n\t\t\t\t\t\t :style=\"{ 'background-color': item.pickerColor }\"\n\t\t\t\t\t></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</BasePopup>\n\t`,\n};\n","import { mapState } from 'ui.vue3.pinia';\nimport { TeamColorPicker } from '../team-color-picker/team-color-picker';\nimport { PermissionActions, PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport { EntityTypes, WizardApiEntityChangedDict, type NodeColorSettingsType } from 'humanresources.company-structure.utils';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { type BaseEvent } from 'main.core.events';\nimport { TagSelector, type Item } from 'ui.entity-selector';\nimport { MemoryCache } from 'main.core.cache';\n\ntype DepartmentStepDataType = {\n\tdeniedError: boolean,\n\tshowColorPicker: boolean,\n\tteamColorValue: NodeColorSettingsType | null,\n}\n\n// @vue/component\nexport const Department = {\n\tname: 'department',\n\n\tcomponents: { TeamColorPicker },\n\n\tprops: {\n\t\tparentId: {\n\t\t\ttype: [Number, null],\n\t\t\trequired: true,\n\t\t},\n\t\tname: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tdescription: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tshouldErrorHighlight: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tisEditMode: {\n\t\t\ttype: Boolean,\n\t\t},\n\t\tentityType: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tteamColor: {\n\t\t\ttype: [Object, null],\n\t\t\tdefault: null,\n\t\t},\n\t\trefToFocus: {\n\t\t\ttype: String,\n\t\t\tdefault: null,\n\t\t},\n\t},\n\n\temits: ['applyData'],\n\n\tdata(): DepartmentStepDataType\n\t{\n\t\treturn {\n\t\t\tdeniedError: false,\n\t\t\tshowColorPicker: false,\n\t\t\tteamColorValue: this.teamColor,\n\t\t\tlocked: false,\n\t\t};\n\t},\n\n\twatch:\n\t{\n\t\tisTeamEntity(): void\n\t\t{\n\t\t\t// tag selector is not valid now\n\t\t\tthis.recreateTagSelector();\n\t\t},\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.selectedParentDepartment = this.parentId;\n\t\tthis.departmentName = this.name;\n\t\tthis.departmentDescription = this.description;\n\t\tthis.departmentSelectorCashe = new MemoryCache();\n\t\tthis.departmentsSelector = this.getOrCreateTagSelector();\n\t},\n\n\tmounted(): void\n\t{\n\t\tthis.departmentsSelector.renderTo(this.$refs['tag-selector']);\n\t},\n\n\tactivated(): void\n\t{\n\t\tthis.teamColorValue = this.teamColor;\n\t\tthis.$emit('applyData', {\n\t\t\tisDepartmentDataChanged: false,\n\t\t\tisValid:\n\t\t\t\tthis.departmentName\n\t\t\t\t&& this.departmentName?.trim() !== ''\n\t\t\t\t&& this.selectedParentDepartment !== null\n\t\t\t\t&& !this.deniedError\n\t\t\t,\n\t\t});\n\n\t\tif (this.refToFocus && this.$refs[this.refToFocus])\n\t\t{\n\t\t\tthis.$refs[this.refToFocus].focus();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.$refs.title.focus();\n\t\t}\n\t},\n\n\tmethods:\n\t{\n\t\trecreateTagSelector(): void\n\t\t{\n\t\t\tthis.$refs['tag-selector'].innerHTML = '';\n\t\t\tthis.departmentsSelector = this.getOrCreateTagSelector();\n\t\t\tthis.departmentsSelector.renderTo(this.$refs['tag-selector']);\n\t\t},\n\t\tcreateTagSelector(): TagSelector\n\t\t{\n\t\t\tthis.locked = this.isTagSelectorLocked();\n\t\t\tlet preselectedItems = this.parentId ? [['structure-node', this.parentId]] : [];\n\t\t\tif (!this.isEditMode)\n\t\t\t{\n\t\t\t\tconst permissionChecker = PermissionChecker.getInstance();\n\t\t\t\tconst permissionAction = this.isTeamEntity ? PermissionActions.teamCreate : PermissionActions.departmentCreate;\n\t\t\t\tif (\n\t\t\t\t\tpermissionChecker\n\t\t\t\t\t&& !permissionChecker.hasPermission(permissionAction, this.parentId)\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tpreselectedItems = [['structure-node', 0]];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst isTabEmpty = (tab) => tab.getRootNode().getChildren().count() === 0;\n\n\t\t\tconst selector = new TagSelector({\n\t\t\t\tevents: {\n\t\t\t\t\tonTagAdd: (event: BaseEvent) => {\n\t\t\t\t\t\tconst { tag } = event.data;\n\t\t\t\t\t\tthis.selectedParentDepartment = tag.id;\n\t\t\t\t\t},\n\t\t\t\t\tonTagRemove: () => {\n\t\t\t\t\t\tthis.selectedParentDepartment = null;\n\t\t\t\t\t\tthis.applyData();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tmultiple: false,\n\t\t\t\tlocked: this.locked,\n\t\t\t\tdialogOptions: {\n\t\t\t\t\twidth: 425,\n\t\t\t\t\theight: 350,\n\t\t\t\t\tdropdownMode: true,\n\t\t\t\t\thideOnDeselect: true,\n\t\t\t\t\tentities: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'structure-node',\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tselectMode: 'departmentsOnly',\n\t\t\t\t\t\t\t\trestricted: this.isEditMode ? 'update' : 'create',\n\t\t\t\t\t\t\t\tincludedNodeEntityTypes: this.includedNodeEntityTypesInDialog,\n\t\t\t\t\t\t\t\tuseMultipleTabs: true,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tpreselectedItems,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonLoad: (event) => {\n\t\t\t\t\t\t\tconst dialog = selector.getDialog();\n\n\t\t\t\t\t\t\tdialog.getTabs()\n\t\t\t\t\t\t\t\t.filter((tab) => isTabEmpty(tab))\n\t\t\t\t\t\t\t\t.forEach((tab) => tab.setVisible(false))\n\t\t\t\t\t\t\t;\n\n\t\t\t\t\t\t\tconst target = event.target;\n\t\t\t\t\t\t\tconst selectedItem = target.selectedItems?.values()?.next()?.value;\n\t\t\t\t\t\t\tif (this.isEditMode)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (selectedItem?.id === this.parentId && this.locked)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tselector.lock();\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst permissionChecker = PermissionChecker.getInstance();\n\t\t\t\t\t\t\tif (!permissionChecker)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst nodes = target.items.get('structure-node');\n\n\t\t\t\t\t\t\tconst permissionAction = this.isTeamEntity\n\t\t\t\t\t\t\t\t? PermissionActions.teamCreate\n\t\t\t\t\t\t\t\t: PermissionActions.departmentCreate\n\t\t\t\t\t\t\t;\n\n\t\t\t\t\t\t\tfor (const [, node] of nodes)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif \t(\n\t\t\t\t\t\t\t\t\tpermissionChecker.hasPermission(permissionAction, node.id)\n\t\t\t\t\t\t\t\t\t&& !permissionChecker.hasPermission(permissionAction, selectedItem?.id ?? 0)\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tnode.select();\n\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonLoadError: () => {\n\t\t\t\t\t\t\tthis.selectedParentDepartment = null;\n\t\t\t\t\t\t\tthis.applyData();\n\t\t\t\t\t\t},\n\t\t\t\t\t\t'Item:onSelect': (event: BaseEvent<{ item: Item }>) => {\n\t\t\t\t\t\t\tthis.deniedError = false;\n\n\t\t\t\t\t\t\tconst target = event.target;\n\t\t\t\t\t\t\tconst selectedItem = target.selectedItems?.values()?.next()?.value;\n\n\t\t\t\t\t\t\tconst permissionChecker = PermissionChecker.getInstance();\n\t\t\t\t\t\t\tif (!permissionChecker)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst item = this.departments.get(selectedItem.id);\n\t\t\t\t\t\t\tif (!item)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst isTeamItem = item?.entityType === EntityTypes.team;\n\n\t\t\t\t\t\t\tconst permissionCreateAction = this.isTeamEntity\n\t\t\t\t\t\t\t\t? PermissionActions.teamCreate\n\t\t\t\t\t\t\t\t: PermissionActions.departmentCreate\n\t\t\t\t\t\t\t;\n\n\t\t\t\t\t\t\tconst permissionEditAction = isTeamItem\n\t\t\t\t\t\t\t\t? PermissionActions.teamEdit\n\t\t\t\t\t\t\t\t: PermissionActions.departmentEdit\n\t\t\t\t\t\t\t;\n\n\t\t\t\t\t\t\tconst permissionAction = this.isEditMode\n\t\t\t\t\t\t\t\t? permissionEditAction\n\t\t\t\t\t\t\t\t: permissionCreateAction\n\t\t\t\t\t\t\t;\n\n\t\t\t\t\t\t\tif (!permissionChecker.hasPermission(permissionAction, selectedItem.id))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.deniedError = true;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.applyData();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\treturn selector;\n\t\t},\n\t\tgetOrCreateTagSelector(): TagSelector\n\t\t{\n\t\t\tconst key = String(this.isTeamEntity);\n\n\t\t\treturn this.departmentSelectorCashe.remember(key, () => this.createTagSelector());\n\t\t},\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tapplyData(): void\n\t\t{\n\t\t\tthis.$emit('applyData', {\n\t\t\t\tapiEntityChanged: WizardApiEntityChangedDict.department,\n\t\t\t\tname: this.departmentName,\n\t\t\t\tdescription: this.departmentDescription,\n\t\t\t\tparentId: this.selectedParentDepartment,\n\t\t\t\tteamColor: this.teamColorValue,\n\t\t\t\tisDepartmentDataChanged: true,\n\t\t\t\tisValid:\n\t\t\t\t\tthis.departmentName\n\t\t\t\t\t&& this.departmentName?.trim() !== ''\n\t\t\t\t\t&& this.selectedParentDepartment !== null\n\t\t\t\t\t&& !this.deniedError\n\t\t\t\t,\n\t\t\t});\n\t\t},\n\t\tisTagSelectorLocked(): boolean\n\t\t{\n\t\t\tif (!this.isEditMode)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (this.parentId === 0)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tconst parent = this.departments.get(this.parentId);\n\t\t\tif (!parent)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst permissionChecker = PermissionChecker.getInstance();\n\t\t\tif (!permissionChecker)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (parent.entityType === EntityTypes.department)\n\t\t\t{\n\t\t\t\treturn !permissionChecker.hasPermission(PermissionActions.departmentEdit, parent.id);\n\t\t\t}\n\n\t\t\tif (parent.entityType === EntityTypes.team)\n\t\t\t{\n\t\t\t\treturn !permissionChecker.hasPermission(PermissionActions.teamEdit, parent.id);\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\t},\n\n\tcomputed:\n\t{\n\t\tincludedNodeEntityTypesInDialog(): string[]\n\t\t{\n\t\t\treturn this.isTeamEntity ? ['department', 'team'] : ['department'];\n\t\t},\n\t\tisTeamEntity(): boolean\n\t\t{\n\t\t\treturn this.entityType === EntityTypes.team;\n\t\t},\n\t\tnamePlaceholder(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_NAME_PLACEHOLDER_MSGVER_1')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_NAME_PLACEHOLDER');\n\t\t},\n\t\tdescriptionPlaceholder(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_DESCR_PLACEHOLDER')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_DESCR_PLACEHOLDER');\n\t\t},\n\t\thigherLevelDepartmentContainer(): string\n\t\t{\n\t\t\t// for team entity department tag selector should be placed after name and description\n\t\t\t// to presumably encourage user to fill in the description field\n\t\t\treturn this.isTeamEntity ? '.chart-wizard__department_higher_bottom' : '.chart-wizard__department_higher_top';\n\t\t},\n\t\tshowLockedSelectorErrorText(): boolean\n\t\t{\n\t\t\treturn this.locked && this.parentId !== 0;\n\t\t},\n\t\tselectorErrorText(): string\n\t\t{\n\t\t\tif (this.deniedError)\n\t\t\t{\n\t\t\t\treturn this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ADD_TO_DEPARTMENT_DENIED_MSG_VER_1');\n\t\t\t}\n\n\t\t\tif (this.locked && this.parentId !== 0)\n\t\t\t{\n\t\t\t\treturn this.isTeamEntity\n\t\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_PARENT_TEAM_ERROR')\n\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_PARENT_DEPARTMENT_ERROR')\n\t\t\t\t;\n\t\t\t}\n\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_PARENT_ERROR')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_PARENT_ERROR')\n\t\t\t;\n\t\t},\n\t\t...mapState(useChartStore, ['departments']),\n\t},\n\n\ttemplate: `\n\t\t<div class=\"chart-wizard__department\">\n\t\t\t<div class=\"chart-wizard__form\">\n\t\t\t\t<Teleport defer :to=\"higherLevelDepartmentContainer\">\n\t\t\t\t\t<span class=\"chart-wizard__department_item-label\">\n\t\t\t\t\t\t{{\n\t\t\t\t\t\t\tisTeamEntity\n\t\t\t\t\t\t\t\t? loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_HIGHER_WITH_TEAM_LABEL')\n\t\t\t\t\t\t\t\t: loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_HIGHER_LABEL')\n\t\t\t\t\t\t}}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div\n\t\t\t\t\t\t:class=\"{ 'ui-ctl-warning': deniedError || (selectedParentDepartment === null && shouldErrorHighlight) }\"\n\t\t\t\t\t\tref=\"tag-selector\"\n\t\t\t\t\t></div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"deniedError || (selectedParentDepartment === null && shouldErrorHighlight) || showLockedSelectorErrorText\"\n\t\t\t\t\t\tclass=\"chart-wizard__department_item-error\"\n\t\t\t\t\t\t:class=\"{'--wizard-warning-item':  locked && parentId !== 0}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"ui-icon-set --warning\"\n\t\t\t\t\t\t\t:style=\"locked && !deniedError ? { '--ui-icon-set__icon-size': '17px', '--ui-icon-set__icon-color': '#FFA900' } : {}\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<span class=\"chart-wizard__department_item-error-message\">\n\t\t\t\t\t\t\t{{ selectorErrorText }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</Teleport>\n\t\t\t\t<div\n\t\t\t\t\tv-show=\"!isTeamEntity\"\n\t\t\t\t\tclass=\"chart-wizard__department_item chart-wizard__department_higher_top\">\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__department_item\">\n\t\t\t\t\t<span class=\"chart-wizard__department_item-label\">\n\t\t\t\t\t\t{{\n\t\t\t\t\t\t\tisTeamEntity\n\t\t\t\t\t\t\t\t? loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_TEAM_NAME_LABEL')\n\t\t\t\t\t\t\t\t: loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_NAME_LABEL') \n\t\t\t\t\t\t}}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div class=\"chart-wizard__department_control-wrapper\">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"ui-ctl ui-ctl-textbox\"\n\t\t\t\t\t\t\t:class=\"{ 'ui-ctl-warning': shouldErrorHighlight && departmentName === '' }\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tv-model=\"departmentName\"\n\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\tmaxlength=\"255\"\n\t\t\t\t\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\t\t\t\t\tref=\"title\"\n\t\t\t\t\t\t\t\t:placeholder=\"namePlaceholder\"\n\t\t\t\t\t\t\t\t@input=\"applyData()\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-if=\"isTeamEntity\" \n\t\t\t\t\t\t\t class=\"chart-wizard__department__color-picker\" \n\t\t\t\t\t\t\t @click=\"showColorPicker = true\"\n\t\t\t\t\t\t\t ref=\"TeamColorPicker\"\n\t\t\t\t\t\t\t :data-test-id=\"'wizard-department-color-picker'\"\n\t\t\t\t\t\t\t :class=\"{ '--active': showColorPicker }\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\"chart-wizard__department__color-picker_inner\"\n\t\t\t\t\t\t\t\t :style=\"{ 'background-color': teamColorValue?.pickerColor }\"\n\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"shouldErrorHighlight && departmentName === ''\"\n\t\t\t\t\t\tclass=\"chart-wizard__department_item-error\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"ui-icon-set --warning\"></div>\n\t\t\t\t\t\t<span class=\"chart-wizard__department_item-error-message\">\n\t\t\t\t\t\t\t{{\n\t\t\t\t\t\t\t\tisTeamEntity\n\t\t\t\t\t\t\t\t\t? loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_NAME_ERROR')\n\t\t\t\t\t\t\t\t\t: loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_NAME_ERROR')\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__department_item\">\n\t\t\t\t\t<span class=\"chart-wizard__department_item-label\">\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_DESCR_LABEL') }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textarea ui-ctl-no-resize\">\n\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\tv-model=\"departmentDescription\"\n\t\t\t\t\t\t\tmaxlength=\"255\"\n\t\t\t\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\t\t\t\tref=\"description\"\n\t\t\t\t\t\t\t:placeholder=\"descriptionPlaceholder\"\n\t\t\t\t\t\t\t@change=\"applyData()\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t</textarea>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tv-show=\"isTeamEntity\"\n\t\t\t\t\tclass=\"chart-wizard__department_item chart-wizard__department_higher_bottom\"\n\t\t\t\t></div>\n\t\t\t</div>\n\t\t\t<TeamColorPicker\n\t\t\t\tv-if=\"showColorPicker\"\n\t\t\t\t:bindElement=\"$refs.TeamColorPicker\"\n\t\t\t\tv-model=\"teamColorValue\"\n\t\t\t\t@update:model-value=\"applyData()\"\n\t\t\t\t@close=\"showColorPicker = false\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { getColorCode } from 'humanresources.company-structure.utils';\nimport { RouteActionMenu } from 'humanresources.company-structure.structure-components';\nimport { CRM, Main } from 'ui.icon-set.api.core';\nimport './style.css';\nimport 'ui.icon-set.crm';\n\nconst MenuOption = Object.freeze({\n\tmoveUsers: 'moveUsers',\n\taddUsers: 'addUsers',\n});\n\nexport const ChangeSaveModeControl = {\n\tname: 'changeSaveModeControl',\n\temits: ['saveModeChanged'],\n\n\tcomponents: {\n\t\tRouteActionMenu,\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.menuItems = this.getMenuItems();\n\t},\n\n\tdata(): { menuVisible: boolean; actionId: MenuOption.moveUsers | MenuOption.addUsers }\n\t{\n\t\treturn {\n\t\t\tmenuVisible: false,\n\t\t\tactionId: MenuOption.moveUsers,\n\t\t};\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tonActionMenuItemClick(actionId: string): void\n\t\t{\n\t\t\tthis.actionId = actionId;\n\t\t\tthis.$emit('saveModeChanged', actionId);\n\t\t},\n\t\tgetMenuItems(): Array\n\t\t{\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\tid: MenuOption.moveUsers,\n\t\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_MOVE_USERS_TITLE'),\n\t\t\t\t\tdescription: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_MOVE_USERS_DESCRIPTION'),\n\t\t\t\t\tbIcon: {\n\t\t\t\t\t\tname: Main.PERSON_ARROW_LEFT_1,\n\t\t\t\t\t\tsize: 20,\n\t\t\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: MenuOption.addUsers,\n\t\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_ADD_USERS_TITLE'),\n\t\t\t\t\tdescription: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_ADD_USERS_DESCRIPTION'),\n\t\t\t\t\tbIcon: {\n\t\t\t\t\t\tname: CRM.PERSON_PLUS_2,\n\t\t\t\t\t\tsize: 20,\n\t\t\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t];\n\t\t},\n\t},\n\n\tcomputed: {\n\t\tgetControlButtonText(): string\n\t\t{\n\t\t\tconst phraseCode = this.actionId === MenuOption.moveUsers\n\t\t\t\t? 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_MOVE_USERS_TITLE'\n\t\t\t\t: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_ADD_USERS_TITLE';\n\n\t\t\treturn this.loc(phraseCode);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"chart-wizard__change-save-mode-control-container\"\n\t\t>\n\t\t\t<span>{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_CONTROL_TEXT') }}</span>\n\t\t\t<a\n\t\t\t\tclass=\"chart-wizard__change-save-mode-control-button\"\n\t\t\t\t:class=\"{ '--focused': menuVisible }\"\n\t\t\t\tref='changeSaveModeButton'\n\t\t\t\t@click=\"menuVisible = true\"\n\t\t\t>\n\t\t\t\t{{ getControlButtonText }}\n\t\t\t</a>\n\t\t</div>\n\t\t<RouteActionMenu\n\t\t\tv-if=\"menuVisible\"\n\t\t\t:id=\"'hr-wizard-save-mode-menu'\"\n\t\t\t:items=\"menuItems\"\n\t\t\t:width=\"302\"\n\t\t\t:bindElement=\"$refs.changeSaveModeButton\"\n\t\t\t@action=\"onActionMenuItemClick\"\n\t\t\t@close=\"menuVisible = false\"\n\t\t/>\n\t`,\n};\n","import { getMemberRoles, memberRolesKeys } from 'humanresources.company-structure.api';\nimport { EntityTypes, getUserDataBySelectorItem, WizardApiEntityChangedDict } from 'humanresources.company-structure.utils';\nimport { ChangeSaveModeControl } from '../change-save-mode-control/change-save-mode-control';\nimport { TagSelector, type ItemOptions } from 'ui.entity-selector';\n\nexport const Employees = {\n\tname: 'employees',\n\n\tcomponents: { ChangeSaveModeControl },\n\n\temits: ['applyData', 'saveModeChanged'],\n\n\tprops: {\n\t\theads: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\temployeesIds: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tisEditMode: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tentityType: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.memberRoles = getMemberRoles(this.entityType);\n\t\tthis.selectedUsers = new Set();\n\t\tthis.departmentHeads = [];\n\t\tthis.departmentEmployees = [];\n\t\tthis.removedUsers = [];\n\t\tthis.headSelector = this.getUserSelector(memberRolesKeys.head);\n\t\tthis.deputySelector = this.getUserSelector(memberRolesKeys.deputyHead);\n\t\tthis.employeesSelector = this.getUserSelector(memberRolesKeys.employee);\n\t\tthis.userCount = 0;\n\n\t\t// store initial users to control applyData method in tagSelector\n\t\tthis.initialUsers = this.heads.reduce((set, item) => set.add(item.id), new Set());\n\t\tthis.employeesIds.forEach((item) => this.initialUsers.add(item));\n\t},\n\n\tmounted(): void\n\t{\n\t\tthis.headSelector.renderTo(this.$refs['head-selector']);\n\t\tthis.deputySelector.renderTo(this.$refs['deputy-selector']);\n\t\tthis.employeesSelector.renderTo(this.$refs['employees-selector']);\n\t},\n\n\tactivated(): void\n\t{\n\t\tthis.$emit('applyData', {\n\t\t\tisDepartmentDataChanged: false,\n\t\t\tisValid: true,\n\t\t});\n\t},\n\n\twatch:\n\t{\n\t\tentityType(entityType: string): void\n\t\t{\n\t\t\tconst prevMemberRoles = this.memberRoles;\n\t\t\tconst rolesKeys = Object.keys(prevMemberRoles);\n\t\t\tthis.memberRoles = getMemberRoles(entityType);\n\n\t\t\tthis.departmentHeads = this.departmentHeads.map((item) => {\n\t\t\t\tconst roleKey = rolesKeys.find((key) => prevMemberRoles[key] === item.role);\n\n\t\t\t\treturn { ...item, role: this.memberRoles[roleKey] };\n\t\t\t});\n\n\t\t\tthis.departmentEmployees = this.departmentEmployees\n\t\t\t\t.map((item) => ({ ...item, role: this.memberRoles.employee }))\n\t\t\t;\n\t\t},\n\t\temployeesIds:\n\t\t{\n\t\t\thandler(payload: number[]): void\n\t\t\t{\n\t\t\t\tthis.employeesIds.forEach((item) => this.initialUsers.add(item));\n\t\t\t\tconst preselectedEmployees = payload.map((employeeId) => ['user', employeeId]);\n\t\t\t\tconst { dialog } = this.employeesSelector;\n\t\t\t\tdialog.setPreselectedItems(preselectedEmployees);\n\t\t\t\tdialog.load();\n\t\t\t},\n\t\t},\n\t},\n\n\tmethods:\n\t{\n\t\tgetPreselectedItems(role: string): Array<number>\n\t\t{\n\t\t\tif (this.memberRoles.employee === role)\n\t\t\t{\n\t\t\t\treturn this.employeesIds.map((employeeId) => ['user', employeeId]);\n\t\t\t}\n\n\t\t\treturn this.heads.filter((head) => head.role === role).map((head) => {\n\t\t\t\treturn ['user', head.id];\n\t\t\t});\n\t\t},\n\t\tgetUserSelector(roleKey: String): TagSelector\n\t\t{\n\t\t\tconst selector = new TagSelector({\n\t\t\t\tevents: {\n\t\t\t\t\tonTagAdd: (event: BaseEvent) => {\n\t\t\t\t\t\tconst { tag } = event.getData();\n\t\t\t\t\t\tthis.selectedUsers.add(tag.id);\n\t\t\t\t\t\tthis.onSelectorToggle(tag, this.memberRoles[roleKey]);\n\n\t\t\t\t\t\tif (this.initialUsers.has(tag.id))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.initialUsers.delete(tag.id);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.applyData();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tonTagRemove: (event: BaseEvent) => {\n\t\t\t\t\t\tconst { tag } = event.getData();\n\t\t\t\t\t\tthis.selectedUsers.delete(tag.id);\n\t\t\t\t\t\tthis.onSelectorToggle(tag, this.memberRoles[roleKey]);\n\t\t\t\t\t\tthis.applyData();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tmultiple: true,\n\t\t\t\tdialogOptions: {\n\t\t\t\t\tpreselectedItems: this.getPreselectedItems(this.memberRoles[roleKey]),\n\t\t\t\t\tpopupOptions: {\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tonBeforeShow: () => {\n\t\t\t\t\t\t\t\tdialog.setHeight(250);\n\t\t\t\t\t\t\t\tif (dialog.isLoaded())\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.toggleUsers(dialog);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonShow: () => {\n\t\t\t\t\t\t\tconst { dialog } = selector;\n\t\t\t\t\t\t\tconst container = dialog.getContainer();\n\t\t\t\t\t\t\tconst { top } = container.getBoundingClientRect();\n\t\t\t\t\t\t\tconst offset = top + container.offsetHeight - document.body.offsetHeight;\n\t\t\t\t\t\t\tif (offset > 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconst margin = 5;\n\t\t\t\t\t\t\t\tdialog.setHeight(container.offsetHeight - offset - margin);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonLoad: (event) => {\n\t\t\t\t\t\t\tthis.toggleUsers(dialog);\n\t\t\t\t\t\t\tconst users = event.target.items.get('user');\n\n\t\t\t\t\t\t\tusers.forEach((user) => {\n\t\t\t\t\t\t\t\tuser.setLink('');\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},\n\t\t\t\t\t\t'SearchTab:onLoad': () => {\n\t\t\t\t\t\t\tthis.toggleUsers(dialog);\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\theight: 250,\n\t\t\t\t\twidth: 380,\n\t\t\t\t\tentities: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'user',\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tintranetUsersOnly: true,\n\t\t\t\t\t\t\t\tinviteEmployeeLink: true,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tdropdownMode: true,\n\t\t\t\t\thideOnDeselect: false,\n\t\t\t\t},\n\t\t\t});\n\t\t\tconst dialog = selector.getDialog();\n\n\t\t\treturn selector;\n\t\t},\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\ttoggleUsers(dialog): void\n\t\t{\n\t\t\tconst items = dialog.getItems();\n\t\t\titems.forEach((item) => {\n\t\t\t\tconst hidden = this.selectedUsers.has(item.id)\n\t\t\t\t\t&& !dialog.selectedItems.has(item);\n\t\t\t\titem.setHidden(hidden);\n\t\t\t});\n\t\t},\n\t\tonSelectorToggle(tag: ItemOptions, role: string): void\n\t\t{\n\t\t\tconst item = tag.selector.dialog.getItem(['user', tag.id]);\n\t\t\tconst userData = getUserDataBySelectorItem(item, role);\n\n\t\t\tconst isEmployee = role === this.memberRoles.employee;\n\t\t\tif (!tag.rendered)\n\t\t\t{\n\t\t\t\tthis.removedUsers = this.removedUsers.filter((user) => user.id !== userData.id);\n\t\t\t\tif (isEmployee)\n\t\t\t\t{\n\t\t\t\t\tthis.departmentEmployees = [...this.departmentEmployees, { ...userData }];\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.departmentHeads = [...this.departmentHeads, { ...userData }];\n\t\t\t\t}\n\n\t\t\t\tthis.userCount += 1;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { preselectedItems = [] } = tag.selector.dialog;\n\t\t\tconst parsedPreselected = preselectedItems.flat().filter((item) => item !== 'user');\n\t\t\tif (parsedPreselected.includes(userData.id))\n\t\t\t{\n\t\t\t\tthis.removedUsers = [...this.removedUsers, { ...userData, role }];\n\t\t\t}\n\n\t\t\tif (isEmployee)\n\t\t\t{\n\t\t\t\tthis.departmentEmployees = this.departmentEmployees.filter((employee) => employee.id !== tag.id);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.departmentHeads = this.departmentHeads.filter((head) => head.id !== tag.id);\n\t\t\t}\n\n\t\t\tthis.userCount -= 1;\n\t\t},\n\t\tapplyData(): void\n\t\t{\n\t\t\tthis.$emit('applyData', {\n\t\t\t\tapiEntityChanged: WizardApiEntityChangedDict.employees,\n\t\t\t\theads: this.departmentHeads,\n\t\t\t\temployees: this.departmentEmployees,\n\t\t\t\tremovedUsers: this.removedUsers,\n\t\t\t\tuserCount: this.userCount,\n\t\t\t\tisDepartmentDataChanged: true,\n\t\t\t});\n\t\t},\n\t\thandleSaveModeChangedChanged(actionId: string): void\n\t\t{\n\t\t\tthis.$emit('saveModeChanged', actionId);\n\t\t},\n\t},\n\n\tcomputed:\n\t{\n\t\tisTeamEntity(): boolean\n\t\t{\n\t\t\treturn this.entityType === EntityTypes.team;\n\t\t},\n\t\temployeeTitle(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_TEAM_EMPLOYEES_TITLE')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_EMPLOYEES_TITLE');\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"chart-wizard__employee\">\n\t\t\t<div class=\"chart-wizard__form\">\n\t\t\t\t<div class=\"chart-wizard__employee_item\">\n\t\t\t\t\t<span class=\"chart-wizard__employee_item-label\">\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_HEAD_TITLE') }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"chart-wizard__employee_selector\"\n\t\t\t\t\t\tref=\"head-selector\"\n\t\t\t\t\t\tdata-test-id=\"hr-company-structure_chart-wizard__employees-head-selector\"\n\t\t\t\t\t/>\n\t\t\t\t\t<span class=\"chart-wizard__employee_item-description\">\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_HEAD_DESCR') }}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__employee_item\">\n\t\t\t\t\t<span class=\"chart-wizard__employee_item-label\">\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_DEPUTY_TITLE') }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"chart-wizard__employee_selector\"\n\t\t\t\t\t\tref=\"deputy-selector\"\n\t\t\t\t\t\tdata-test-id=\"hr-company-structure_chart-wizard__employees-deputy-selector\"\n\t\t\t\t\t/>\n\t\t\t\t\t<span class=\"chart-wizard__employee_item-description\">\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_DEPUTY_DESCR') }}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__employee_item\">\n\t\t\t\t\t<span class=\"chart-wizard__employee_item-label\">\n\t\t\t\t\t\t{{ employeeTitle }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"chart-wizard__employee_selector\"\n\t\t\t\t\t\tref=\"employees-selector\"\n\t\t\t\t\t\tdata-test-id=\"hr-company-structure_chart-wizard__employees-employee-selector\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div v-if=\"!isTeamEntity\" class=\"chart-wizard__employee_item --change-save-mode-control\">\n\t\t\t\t\t<ChangeSaveModeControl\n\t\t\t\t\t\tv-if=\"!isEditMode\"\n\t\t\t\t\t\t@saveModeChanged=\"handleSaveModeChangedChanged\"\n\t\t\t\t\t></ChangeSaveModeControl>\n\t\t\t\t\t<div class=\"chart-wizard__change-save-mode-control-container\" v-else>\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_EDIT_WIZARD_EMPLOYEE_SAVE_MODE_TEXT') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import {\n\tgetChatDialogEntity,\n\tgetChannelDialogEntity,\n\tgetChatRecentTabOptions,\n\tChatTypeDict,\n\tDefaultHint,\n} from 'humanresources.company-structure.structure-components';\nimport type { ChatOrChannelDetailed } from 'humanresources.company-structure.utils';\nimport { Item, TagSelector } from 'ui.entity-selector';\nimport { Set as IconSet } from 'ui.icon-set.api.core';\nimport { BIcon } from 'ui.icon-set.api.vue';\n\nconst DEFAULT_TAG_ID = 'default';\n\n// Component for selecting chats or channels in the wizard. Consists of selector, default button, hint and warning\n// @vue/component\nexport const ChatSelector = {\n\tname: 'chatSelector',\n\n\tcomponents: {\n\t\tDefaultHint,\n\t\tBIcon,\n\t},\n\n\tprops: {\n\t\tname: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\theadsCreated: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tisTeamEntity: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\t/** @type ChatOrChannelDetailed[] */\n\t\tinitChats: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\t/** @type ChatTypeDict.chat | ChatTypeDict.channel */\n\t\ttype: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\temits: ['applyData'],\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tcreateDefault: false,\n\t\t};\n\t},\n\n\tcomputed:\n\t{\n\t\tisChannel(): boolean\n\t\t{\n\t\t\treturn this.type === ChatTypeDict.channel;\n\t\t},\n\t\tset(): IconSet\n\t\t{\n\t\t\treturn IconSet;\n\t\t},\n\t\thintText(): string\n\t\t{\n\t\t\tif (this.isChannel)\n\t\t\t{\n\t\t\t\treturn this.isTeamEntity\n\t\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHANNELS_ADD_CHECKBOX_HINT')\n\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHANNELS_ADD_CHECKBOX_HINT_MSGVER_1')\n\t\t\t\t;\n\t\t\t}\n\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHATS_ADD_CHECKBOX_HINT')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHATS_ADD_CHECKBOX_HINT_MSGVER_1');\n\t\t},\n\t\tcreateText(): string\n\t\t{\n\t\t\tif (this.isChannel)\n\t\t\t{\n\t\t\t\treturn this.isTeamEntity\n\t\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHANNELS_ADD_CHECKBOX_LABEL_MSGVER_1')\n\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHANNELS_ADD_CHECKBOX_LABEL_MSGVER_2')\n\t\t\t\t;\n\t\t\t}\n\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHATS_ADD_CHECKBOX_LABEL_MSGVER_1')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHATS_ADD_CHECKBOX_LABEL_MSGVER_2')\n\t\t\t;\n\t\t},\n\t\tremoveText(): string\n\t\t{\n\t\t\tif (this.isChannel)\n\t\t\t{\n\t\t\t\treturn this.isTeamEntity\n\t\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHANNELS_REMOVE_CHECKBOX_LABEL')\n\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHANNELS_REMOVE_CHECKBOX_LABEL')\n\t\t\t\t;\n\t\t\t}\n\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHATS_REMOVE_CHECKBOX_LABEL')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHATS_REMOVE_CHECKBOX_LABEL')\n\t\t\t;\n\t\t},\n\t\twarningText(): string\n\t\t{\n\t\t\tif (this.isChannel)\n\t\t\t{\n\t\t\t\treturn this.isTeamEntity\n\t\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHANNELS_ADD_CHECKBOX_WARNING')\n\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHANNELS_ADD_CHECKBOX_WARNING')\n\t\t\t\t;\n\t\t\t}\n\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHATS_ADD_CHECKBOX_WARNING')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHATS_ADD_CHECKBOX_WARNING')\n\t\t\t;\n\t\t},\n\t},\n\n\twatch:\n\t{\n\t\tcreateDefault(value): void\n\t\t{\n\t\t\tif (value)\n\t\t\t{\n\t\t\t\tthis.selector.getDialog().getItem({ id: DEFAULT_TAG_ID, entityId: DEFAULT_TAG_ID }).select();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.selector.getDialog().getItem({ id: DEFAULT_TAG_ID, entityId: DEFAULT_TAG_ID }).deselect();\n\t\t\t}\n\t\t},\n\t\tname(value): void\n\t\t{\n\t\t\tconst chatItem = this.selector.getDialog().getItem({ id: DEFAULT_TAG_ID, entityId: DEFAULT_TAG_ID });\n\t\t\tchatItem.setTitle(value);\n\n\t\t\tif (this.createDefault)\n\t\t\t{\n\t\t\t\tchatItem.deselect();\n\t\t\t\tchatItem.select();\n\t\t\t}\n\t\t},\n\t\tinitChats:\n\t\t{\n\t\t\thandler(payload: ChatOrChannelDetailed[]): void\n\t\t\t{\n\t\t\t\tpayload.forEach((chat) => this.initialChatsSet.add(`chat${chat.id}`));\n\t\t\t\tconst preselectedChats = payload.map((chat) => ['im-chat-only', `chat${chat.id}`]);\n\t\t\t\tconst { dialog } = this.selector;\n\t\t\t\tdialog.setPreselectedItems(preselectedChats);\n\t\t\t\tdialog.load();\n\t\t\t},\n\t\t},\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.chats = [];\n\t\t// store initial values to control applyData method in tagSelector\n\t\tthis.initialChatsSet = this.initChats.reduce((set, chat) => set.add(`chat${chat.id}`), new Set());\n\t\tthis.selector = this.getSelector();\n\t},\n\n\tmounted(): void\n\t{\n\t\tthis.selector.renderTo(this.$refs['chat-selector']);\n\t},\n\n\tmethods:\n\t{\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\taddChatTag(tag): void\n\t\t{\n\t\t\tif (!tag.searchable)\n\t\t\t{\n\t\t\t\tconst existingChat = this.initChats.find((chat) => chat.dialogId === tag.id);\n\n\t\t\t\tif (existingChat?.title)\n\t\t\t\t{\n\t\t\t\t\ttag.setTitle(existingChat.title);\n\t\t\t\t\tif (existingChat.hasAccess)\n\t\t\t\t\t{\n\t\t\t\t\t\ttag.setDeselectable(true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.chats.push(Number(tag.id.replace('chat', '')));\n\t\t},\n\t\tgetSelector(): TagSelector\n\t\t{\n\t\t\tconst entity = this.isChannel ? getChannelDialogEntity() : getChatDialogEntity();\n\n\t\t\tconst options = {\n\t\t\t\tmultiple: true,\n\t\t\t\tevents: {\n\t\t\t\t\tonTagAdd: (event: BaseEvent) => {\n\t\t\t\t\t\tconst { tag } = event.getData();\n\t\t\t\t\t\tif (tag.id === DEFAULT_TAG_ID)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.createDefault = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.addChatTag(tag);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.initialChatsSet.has(tag.id))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.initialChatsSet.delete(tag.id);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.applyData();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tonTagRemove: (event: BaseEvent) => {\n\t\t\t\t\t\tconst { tag } = event.getData();\n\t\t\t\t\t\tconst intId = Number(tag.id.replace('chat', ''));\n\t\t\t\t\t\tif (tag.id === DEFAULT_TAG_ID)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.createDefault = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.chats = this.chats.filter((chat) => chat !== intId);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.applyData();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tdialogOptions: {\n\t\t\t\t\tenableSearch: true,\n\t\t\t\t\theight: 250,\n\t\t\t\t\twidth: 380,\n\t\t\t\t\tdropdownMode: true,\n\t\t\t\t\trecentTabOptions: getChatRecentTabOptions(this.entityType, this.type),\n\t\t\t\t\titems: [this.getDefaultItem(entity.tagOptions?.default, entity.itemOptions?.default)],\n\t\t\t\t\tpreselectedItems: this.initChats.map((chat) => ['im-chat-only', `chat${chat.id}`]),\n\t\t\t\t\tentities: [entity],\n\t\t\t\t},\n\t\t\t};\n\n\t\t\treturn new TagSelector(options);\n\t\t},\n\t\tgetDefaultItem(tagOptions: Object = {}, itemOptions: Object = {}): Item\n\t\t{\n\t\t\treturn {\n\t\t\t\tid: DEFAULT_TAG_ID,\n\t\t\t\tentityId: DEFAULT_TAG_ID,\n\t\t\t\ttitle: this.name,\n\t\t\t\tsearchable: false,\n\t\t\t\ttagOptions,\n\t\t\t\t...itemOptions,\n\t\t\t};\n\t\t},\n\t\tapplyData(): void\n\t\t{\n\t\t\tthis.$emit('applyData', {\n\t\t\t\ttype: this.type,\n\t\t\t\tchats: this.chats,\n\t\t\t\tcreateDefault: this.createDefault,\n\t\t\t});\n\t\t},\n\t\tgetTestId(blueprint: string): string\n\t\t{\n\t\t\tif (this.isChannel)\n\t\t\t{\n\t\t\t\treturn blueprint.replace('chat', 'channel');\n\t\t\t}\n\n\t\t\treturn blueprint;\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"chart-wizard__chat_selector\"\n\t\t\tref=\"chat-selector\"\n\t\t\t:data-test-id=\"getTestId('hr-company-structure_chart-wizard__chat-selector')\"\n\t\t/>\n\t\t<div\n\t\t\tv-if=\"!createDefault\"\n\t\t\tclass=\"chart-wizard__bind-chat__item-checkbox_container\"\n\t\t>\n\t\t\t<div\n\t\t\t\t@click=\"createDefault = headsCreated\"\n\t\t\t\tclass=\"chart-wizard__bind-chat__item-create\"\n\t\t\t\t:class=\"{ '--disabled': !headsCreated }\"\n\t\t\t\t:data-test-id=\"getTestId('hr-company-structure_chart-wizard__make-default-chat-create')\"\n\t\t\t\tv-html=\"createText\"\n\t\t\t>\n\t\t\t</div>\n\t\t\t<DefaultHint :content=\"hintText\" />\n\t\t</div>\n\t\t<div v-else class=\"chart-wizard__bind-chat__item-checkbox_container\">\n\t\t\t<div class=\"ui-icon-set --o-circle-check\"></div>\n\t\t\t<div\n\t\t\t\tclass=\"chart-wizard__bind-chat__item-remove\"\n\t\t\t\t:class=\"{ '--disabled': !headsCreated }\"\n\t\t\t\t:data-test-id=\"getTestId('hr-company-structure_chart-wizard__make-default-chat-remove')\"\n\t\t\t>\n\t\t\t\t{{ removeText }}\n\t\t\t</div>\n\t\t</div>\n\t\t<div v-if=\"!headsCreated\" class=\"chart-wizard__bind-chat__item-checkbox_warning\">\n\t\t\t<BIcon\n\t\t\t\t:name=\"set.WARNING\"\n\t\t\t\tcolor=\"#FFA900\"\n\t\t\t\t:size=\"16\"\n\t\t\t></BIcon>\n\t\t\t<span>\n\t\t\t\t{{ warningText }}\n\t\t\t</span>\n\t\t</div>\n\t`,\n};\n","import { getMemberRoles } from 'humanresources.company-structure.api';\nimport { EntityTypes, WizardApiEntityChangedDict, type ChatOrChannelDetailed } from 'humanresources.company-structure.utils';\nimport { ChatSelector } from './steps-components/chat-selector';\nimport { ChatTypeDict } from 'humanresources.company-structure.structure-components';\n\n// @vue/component\nexport const BindChat = {\n\tname: 'bindChat',\n\n\tcomponents: { ChatSelector },\n\n\tprops: {\n\t\theads: {\n\t\t\ttype: Array,\n\t\t\trequired: false,\n\t\t\tdefault: () => [],\n\t\t},\n\t\tname: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tentityType: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tisEditMode: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\t/** @type ChatOrChannelDetailed[] */\n\t\tinitChats: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\t/** @type ChatOrChannelDetailed[] */\n\t\tinitChannels: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\temits: ['applyData'],\n\n\tcomputed:\n\t{\n\t\tchatHintText(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHATS_ADD_CHECKBOX_HINT')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHATS_ADD_CHECKBOX_HINT_MSGVER_1')\n\t\t\t;\n\t\t},\n\t\tchannelHintText(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHANNELS_ADD_CHECKBOX_HINT')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHANNELS_ADD_CHECKBOX_HINT_MSGVER_1')\n\t\t\t;\n\t\t},\n\t\theadsCreated(): boolean\n\t\t{\n\t\t\tconst memberRoles = getMemberRoles(this.entityType);\n\n\t\t\treturn this.heads.some((item) => item.role === memberRoles.head);\n\t\t},\n\t\tisTeamEntity(): boolean\n\t\t{\n\t\t\treturn this.entityType === EntityTypes.team;\n\t\t},\n\t\thints(): string[]\n\t\t{\n\t\t\tif (this.isTeamEntity)\n\t\t\t{\n\t\t\t\treturn [\n\t\t\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_HINT_1'),\n\t\t\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_HINT_2'),\n\t\t\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_HINT_3'),\n\t\t\t\t];\n\t\t\t}\n\n\t\t\treturn [\n\t\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_HINT_1_MSGVER_1'),\n\t\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_HINT_2_MSGVER_1'),\n\t\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_HINT_3'),\n\t\t\t];\n\t\t},\n\t\tChatTypeDict(): Record<string, string>\n\t\t{\n\t\t\treturn ChatTypeDict;\n\t\t},\n\t},\n\n\twatch:\n\t{\n\t\tinitChats(value: ChatOrChannelDetailed[]): void\n\t\t{\n\t\t\tthis.chats = value.map((item) => item.id);\n\t\t},\n\t\tinitChannels(value: ChatOrChannelDetailed[]): void\n\t\t{\n\t\t\tthis.channels = value.map((item) => item.id);\n\t\t},\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.chats = this.initChats.map((item) => item.id);\n\t\tthis.channels = this.initChannels.map((item) => item.id);\n\t\tthis.createDefaultChat = false;\n\t\tthis.createDefaultChannel = false;\n\t},\n\n\tactivated(): void\n\t{\n\t\tthis.$emit('applyData', {\n\t\t\tisDepartmentDataChanged: false,\n\t\t\tisValid: true,\n\t\t});\n\t},\n\n\tmethods:\n\t{\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tapplyData(): void\n\t\t{\n\t\t\tthis.$emit('applyData', {\n\t\t\t\tapiEntityChanged: WizardApiEntityChangedDict.bindChats,\n\t\t\t\tchats: this.chats,\n\t\t\t\tchannels: this.channels,\n\t\t\t\tcreateDefaultChat: this.createDefaultChat,\n\t\t\t\tcreateDefaultChannel: this.createDefaultChannel,\n\t\t\t\tisDepartmentDataChanged: true,\n\t\t\t});\n\t\t},\n\t\tonChatSelectorChanged(data: { type: string, chats: Array, createDefault: boolean })\n\t\t{\n\t\t\tif (data.type === ChatTypeDict.chat)\n\t\t\t{\n\t\t\t\tthis.chats = data.chats;\n\t\t\t\tthis.createDefaultChat = data.createDefault;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.channels = data.chats;\n\t\t\t\tthis.createDefaultChannel = data.createDefault;\n\t\t\t}\n\n\t\t\tthis.applyData();\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"chart-wizard__bind-chat\">\n\t\t\t<div class=\"chart-wizard__bind-chat__item\">\n\t\t\t\t<div v-if=\"!isEditMode\" class=\"chart-wizard__bind-chat__item-hint\" :class=\"{ '--team': isTeamEntity }\">\n\t\t\t\t\t<div class=\"chart-wizard__bind-chat__item-hint_logo\" :class=\"{ '--team': isTeamEntity }\"></div>\n\t\t\t\t\t<div class=\"chart-wizard__bind-chat__item-hint_text\">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"chart-wizard__bind-chat__item-hint_title\"\n\t\t\t\t\t\t\tv-html=\"\n\t\t\t\t\t\t\t\tisTeamEntity \n\t\t\t\t\t\t\t\t\t? loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_HINT_TITLE')\n\t\t\t\t\t\t\t\t\t: loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_HINT_TITLE')\n\t\t\t\t\t\t\t\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-for=\"hint in hints\"\n\t\t\t\t\t\t\t class=\"chart-wizard__bind-chat__item-hint_text-item\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"chart-wizard__bind-chat__item-hint_text-item_icon\"\n\t\t\t\t\t\t\t\t:class=\"{ '--team': isTeamEntity }\"\n\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t\t<span>{{ hint }}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__bind-chat__item-options\">\n\t\t\t\t\t<div class=\"chart-wizard__bind-chat__item-options__item-content_title\">\n\t\t\t\t\t\t<div class=\"chart-wizard__bind-chat__item-options__item-content_title-text\">\n\t\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHATS_TITLE') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<span class=\"chart-wizard__bind-chat__item-description\">\n\t\t\t\t\t\t{{\n\t\t\t\t\t\t\tisTeamEntity\n\t\t\t\t\t\t\t\t? loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHATS_DESCRIPTION')\n\t\t\t\t\t\t\t\t: loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHATS_DESCRIPTION')\n\t\t\t\t\t\t}}\n\t\t\t\t\t</span>\n\t\t\t\t\t<ChatSelector\n\t\t\t\t\t\t:name=\"name\"\n\t\t\t\t\t\t:headsCreated=\"headsCreated\"\n\t\t\t\t\t\t:initChats=\"initChats\"\n\t\t\t\t\t\t:type=\"ChatTypeDict.chat\"\n\t\t\t\t\t\t:isTeamEntity=\"isTeamEntity\"\n\t\t\t\t\t\t@applyData=\"onChatSelectorChanged\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__bind-chat__item-options\">\n\t\t\t\t\t<div class=\"chart-wizard__bind-chat__item-options__item-content_title\">\n\t\t\t\t\t\t<div class=\"chart-wizard__bind-chat__item-options__item-content_title-text\">\n\t\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHANNELS_TITLE') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<span class=\"chart-wizard__bind-chat__item-description\">\n\t\t\t\t\t\t{{\n\t\t\t\t\t\t\tisTeamEntity\n\t\t\t\t\t\t\t\t? loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHANNELS_DESCRIPTION')\n\t\t\t\t\t\t\t\t: loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHANNELS_DESCRIPTION')\n\t\t\t\t\t\t}}\n\t\t\t\t\t</span>\n\t\t\t\t\t<ChatSelector\n\t\t\t\t\t\t:name=\"name\"\n\t\t\t\t\t\t:headsCreated=\"headsCreated\"\n\t\t\t\t\t\t:initChats=\"initChannels\"\n\t\t\t\t\t\t:type=\"ChatTypeDict.channel\"\n\t\t\t\t\t\t:isTeamEntity=\"isTeamEntity\"\n\t\t\t\t\t\t@applyData=\"onChatSelectorChanged\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { PermissionActions, PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\nimport { Reflection } from 'main.core';\nimport { ResponsiveHint } from 'humanresources.company-structure.structure-components';\n\nexport const Entities = {\n\tprops: {\n\t\tparentId: {\n\t\t\ttype: [Number, null],\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tcomponents: { ResponsiveHint },\n\n\tdata(): { selectedEntityType: string; }\n\t{\n\t\treturn {\n\t\t\tselectedEntityType: EntityTypes.department,\n\t\t};\n\t},\n\n\temits: ['applyData'],\n\n\tcreated(): void\n\t{\n\t\tthis.hint = null;\n\t\tthis.hintHideTimeout = null;\n\n\t\tconst permissionChecker = PermissionChecker.getInstance();\n\n\t\tconst hasTeamCreatePermission = this.parentId === 0\n\t\t\t? permissionChecker.hasPermissionOfAction(PermissionActions.teamCreate)\n\t\t\t: permissionChecker.hasPermission(PermissionActions.teamCreate, this.parentId)\n\t\t;\n\n\t\tconst hasDepartmentCreatePermission = this.parentId === 0\n\t\t\t? permissionChecker.hasPermissionOfAction(PermissionActions.departmentCreate)\n\t\t\t: permissionChecker.hasPermission(PermissionActions.departmentCreate, this.parentId)\n\t\t;\n\n\t\tthis.entities = [\n\t\t\t{\n\t\t\t\ttype: EntityTypes.department,\n\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_DEPARTMENT_TITLE'),\n\t\t\t\tdescription: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_DEPARTMENT_DESCR'),\n\t\t\t\tisEnabled: hasDepartmentCreatePermission,\n\t\t\t\thint: !hasDepartmentCreatePermission\n\t\t\t\t\t&& this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_DEPARTMENT_NO_ACCESS_HINT'),\n\t\t\t\tisSoon: false,\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: EntityTypes.team,\n\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_FUNCTIONAL_TEAM_TITLE_MSGVER_1'),\n\t\t\t\tdescription: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_FUNCTIONAL_TEAM_DESCR'),\n\t\t\t\tisEnabled: PermissionChecker.isTeamsAvailable && hasTeamCreatePermission,\n\t\t\t\thint: PermissionChecker.isTeamsAvailable\n\t\t\t\t\t&& !hasTeamCreatePermission\n\t\t\t\t\t&& this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_FUNCTIONAL_TEAM_NO_ACCESS_HINT_MSGVER_1'),\n\t\t\t\tisSoon: !permissionChecker.isTeamsAvailable,\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: EntityTypes.company,\n\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_COMPANY_TITLE'),\n\t\t\t\tdescription: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_COMPANY_DESCR'),\n\t\t\t\tisEnabled: false,\n\t\t\t\tisSoon: true,\n\t\t\t},\n\t\t];\n\n\t\tfor (const entity of this.entities)\n\t\t{\n\t\t\tif (entity.isEnabled)\n\t\t\t{\n\t\t\t\tthis.selectedEntityType = entity.type;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tthis.applyData(this.selectedEntityType);\n\t},\n\n\tactivated(): void\n\t{\n\t\tthis.applyData(this.selectedEntityType);\n\t},\n\n\tdeactivated(): void\n\t{\n\t\tthis.hint?.hide();\n\t\tclearTimeout(this.hintHideTimeout);\n\t\tthis.hintHideTimeout = null;\n\t},\n\n\tmethods:\n\t{\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tapplyData(entityId: string): void\n\t\t{\n\t\t\tthis.selectedEntityType = entityId;\n\t\t\tthis.$emit('applyData', {\n\t\t\t\tisValid: true,\n\t\t\t\tisDepartmentDataChanged: false,\n\t\t\t\tentityType: this.selectedEntityType,\n\t\t\t});\n\t\t},\n\t\tshowHint(text: string, $event: PointerEvent): void\n\t\t{\n\t\t\tif (this.hintHideTimeout)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst width = 300;\n\t\t\tthis.hint = Reflection.getClass('BX.UI.Hint').createInstance({\n\t\t\t\tpopupParameters: {\n\t\t\t\t\twidth,\n\t\t\t\t\tbindOptions: { position: 'top' },\n\t\t\t\t\toffsetLeft: 225,\n\t\t\t\t\toffsetTop: -23,\n\t\t\t\t\tangle: { offset: width / 2 - 33 / 2 },\n\t\t\t\t},\n\t\t\t});\n\t\t\tthis.hint.show($event.target, text);\n\n\t\t\tthis.hintHideTimeout = setTimeout(() => {\n\t\t\t\tthis.hint?.hide();\n\t\t\t\tthis.hintHideTimeout = null;\n\t\t\t}, 2000);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tv-for=\"entity in entities\"\n\t\t\tclass=\"chart-wizard__entity-wrapper\"\n\t\t>\n\t\t\t<span v-if=\"entity.hint\" @click=\"showHint(entity.hint, $event)\" class=\"ui-hint chart-wizard__entity_hint-layout\"></span>\n\t\t\t<div class=\"chart-wizard__entity\"\n\t\t\t\t :class=\"{ \n\t\t\t\t\t['--' + entity.type.toLowerCase()]: true, \n\t\t\t\t\t'--selected': entity.type === selectedEntityType, \n\t\t\t\t\t'--enabled': entity.isEnabled \n\t\t\t\t}\"\n\t\t\t\t@click=\"entity.isEnabled && applyData(entity.type)\"\n\t\t\t>\n\t\t\t\t<div class=\"chart-wizard__entity_summary\">\n\t\t\t\t\t<h2\n\t\t\t\t\t\tclass=\"chart-wizard__entity_title\"\n\t\t\t\t\t\t:data-title=\"entity.isSoon ? loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_ACCESS_TITLE') : null\"\n\t\t\t\t\t\t:class=\"{ '--disabled': !entity.isEnabled, '--soon': entity.isSoon }\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{entity.title}}\n\t\t\t\t\t</h2>\n\t\t\t\t\t<p class=\"chart-wizard__entity_description\" :class=\"{ '--disabled': !entity.isEnabled}\">\n\t\t\t\t\t\t{{entity.description}}\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Text } from 'main.core';\nimport { TagSelector } from 'ui.entity-selector';\nimport { AuthorityTypes } from '../../consts';\nimport { WizardApiEntityChangedDict, NodeSettingsTypes } from 'humanresources.company-structure.utils';\n\nexport const TeamRights = {\n\tname: 'teamRights',\n\n\temits: ['applyData'],\n\n\tprops: {\n\t\tname: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\t/** @type {Record<string, Set>} */\n\t\tsettings: {\n\t\t\ttype: Object,\n\t\t\trequired: false,\n\t\t},\n\t},\n\n\tcreated()\n\t{\n\t\tthis.hints = [\n\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_HINT_1'),\n\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_HINT_2'),\n\t\t];\n\n\t\tthis.initBpValues = new Set();\n\t\tthis.businessProcSelector = this.getTagSelector(NodeSettingsTypes.businessProcAuthority, false);\n\t\tthis.reportsSelector = this.getTagSelector(NodeSettingsTypes.reportsAuthority, true);\n\t},\n\n\tmounted(): void\n\t{\n\t\tthis.businessProcSelector.renderTo(this.$refs['business-proc-selector']);\n\t\tthis.reportsSelector.renderTo(this.$refs['reports-selector']);\n\t},\n\n\tactivated(): void\n\t{\n\t\tthis.$emit('applyData', {\n\t\t\tisDepartmentDataChanged: false,\n\t\t\tisValid: true,\n\t\t});\n\t},\n\n\twatch:\n\t{\n\t\tsettings:\n\t\t\t{\n\t\t\t\thandler(payload: Record<string, Set>): void\n\t\t\t\t{\n\t\t\t\t\tif (payload[NodeSettingsTypes.businessProcAuthority])\n\t\t\t\t\t{\n\t\t\t\t\t\tconst businessProcPreselected = this.getTagItems(false)\n\t\t\t\t\t\t\t.filter((item) => payload[NodeSettingsTypes.businessProcAuthority].has(item.id))\n\t\t\t\t\t\t;\n\n\t\t\t\t\t\tbusinessProcPreselected.forEach((businessProcPreselectedItem) => {\n\t\t\t\t\t\t\tconst item = this.businessProcSelector.dialog.getItem(['head-type', businessProcPreselectedItem.id]);\n\n\t\t\t\t\t\t\tif (item)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.initBpValues.add(businessProcPreselectedItem.id);\n\t\t\t\t\t\t\t\titem.select();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t},\n\n\tmethods:\n\t{\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tapplyData(): void\n\t\t{\n\t\t\tthis.$emit('applyData', {\n\t\t\t\tapiEntityChanged: WizardApiEntityChangedDict.settings,\n\t\t\t\tsettings: this.settings,\n\t\t\t\tisDepartmentDataChanged: true,\n\t\t\t});\n\t\t},\n\t\tgetTagSelector(settingType: string, locked: boolean): TagSelector\n\t\t{\n\t\t\treturn new TagSelector({\n\t\t\t\tevents: {\n\t\t\t\t\tonTagAdd: (event: BaseEvent) => {\n\t\t\t\t\t\tconst { tag } = event.getData();\n\t\t\t\t\t\tthis.settings[settingType].add(tag.id);\n\n\t\t\t\t\t\tif (this.initBpValues.has(tag.id))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.initBpValues.delete(tag.id);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.applyData();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tonTagRemove: (event: BaseEvent) => {\n\t\t\t\t\t\tconst { tag } = event.getData();\n\t\t\t\t\t\tthis.settings[settingType].delete(tag.id);\n\t\t\t\t\t\tthis.applyData();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tmultiple: true,\n\t\t\t\tid: 'head-type-selector',\n\t\t\t\tlocked,\n\t\t\t\ttagFontWeight: '700',\n\t\t\t\tshowAddButton: !locked,\n\t\t\t\tdialogOptions: {\n\t\t\t\t\tid: 'head-type-selector',\n\t\t\t\t\tevents: {\n\t\t\t\t\t\t'Item:onBeforeSelect': (event: BaseEvent) => {\n\t\t\t\t\t\t\tconst { item } = event.getData();\n\t\t\t\t\t\t\tif (!item.getCustomData()?.get('selectable'))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\twidth: 400,\n\t\t\t\t\theight: 200,\n\t\t\t\t\tdropdownMode: true,\n\t\t\t\t\tshowAvatars: false,\n\t\t\t\t\tselectedItems: this.getTagItems(locked).filter(((item) => this.settings[settingType].has(item.id))),\n\t\t\t\t\titems: this.getTagItems(locked),\n\t\t\t\t\tundeselectedItems: [['head-type', AuthorityTypes.departmentHead]],\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t\tgetTagItems(locked: boolean): Array\n\t\t{\n\t\t\tconst lockedTagOptions = {\n\t\t\t\tbgColor: '#BDC1C6',\n\t\t\t\ttextColor: '#525C69',\n\t\t\t};\n\t\t\tconst departmentTagOptions = {\n\t\t\t\tbgColor: '#ADE7E4',\n\t\t\t\ttextColor: '#207976',\n\t\t\t};\n\t\t\tconst teamTagOptions = {\n\t\t\t\tbgColor: '#CCE3FF',\n\t\t\t\ttextColor: '#3592FF',\n\t\t\t};\n\n\t\t\tconst soonItemOptions = {\n\t\t\t\tcustomData: { selectable: false },\n\t\t\t\ttextColor: '#C9CCD0',\n\t\t\t\tbadges: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_SOON_ITEM_BADGE'),\n\t\t\t\t\t\ttextColor: '#FFFFFF',\n\t\t\t\t\t\tbgColor: '#2FC6F6',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tbadgesOptions: {\n\t\t\t\t\tjustifyContent: 'right',\n\t\t\t\t},\n\t\t\t};\n\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\tid: AuthorityTypes.departmentHead,\n\t\t\t\t\tentityId: 'head-type',\n\t\t\t\t\ttabs: 'recents',\n\t\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_DEPARTMENT_HEAD_ITEM'),\n\t\t\t\t\ttagOptions: locked ? lockedTagOptions : departmentTagOptions,\n\t\t\t\t\tcustomData: { selectable: true },\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: AuthorityTypes.teamHead,\n\t\t\t\t\tentityId: 'head-type',\n\t\t\t\t\ttabs: 'recents',\n\t\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_TEAM_HEAD_ITEM'),\n\t\t\t\t\ttagOptions: locked ? lockedTagOptions : teamTagOptions,\n\t\t\t\t\tcustomData: { selectable: true },\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: AuthorityTypes.departmentDeputy,\n\t\t\t\t\tentityId: 'head-type',\n\t\t\t\t\ttabs: 'recents',\n\t\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_DEPARTMENT_DEPUTY_ITEM'),\n\t\t\t\t\ttagOptions: locked ? lockedTagOptions : departmentTagOptions,\n\t\t\t\t\t...soonItemOptions,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: AuthorityTypes.teamDeputy,\n\t\t\t\t\tentityId: 'head-type',\n\t\t\t\t\ttabs: 'recents',\n\t\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_TEAM_DEPUTY_ITEM'),\n\t\t\t\t\ttagOptions: locked ? lockedTagOptions : teamTagOptions,\n\t\t\t\t\t...soonItemOptions,\n\t\t\t\t},\n\t\t\t];\n\t\t},\n\t\tgoToBPHelp(event): void\n\t\t{\n\t\t\tif (top.BX.Helper)\n\t\t\t{\n\t\t\t\tevent.preventDefault();\n\t\t\t\ttop.BX.Helper.show('redirect=detail&code=25455744');\n\t\t\t}\n\t\t},\n\t},\n\n\tcomputed:\n\t{\n\t\tbusinessDescription(): string\n\t\t{\n\t\t\treturn this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_BUSINESS_PROC_DESCRIPTION', {\n\t\t\t\t'#DEPARTMENT_NAME#': Text.encode(this.name),\n\t\t\t});\n\t\t},\n\t\treportsDescriptions(): string\n\t\t{\n\t\t\treturn this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_REPORTS_DESCRIPTION', {\n\t\t\t\t'#DEPARTMENT_NAME#': Text.encode(this.name),\n\t\t\t});\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"chart-wizard__team-rights\">\n\t\t\t<div class=\"chart-wizard__team-rights__item\">\n\t\t\t\t<div class=\"chart-wizard__team-rights__item-hint --team\">\n\t\t\t\t\t<div class=\"chart-wizard__team-rights__item-hint_logo --team\"></div>\n\t\t\t\t\t<div class=\"chart-wizard__team-rights__item-hint_text\">\n\t\t\t\t\t\t<div class=\"chart-wizard__team-rights__item-hint_title\">\n\t\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_HINT_TITLE') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-for=\"hint in hints\"\n\t\t\t\t\t\t\tclass=\"chart-wizard__team-rights__item-hint_text-item\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"chart-wizard__team-rights__item-hint_text-item_icon --team\"\n\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t\t<span>{{ hint }}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__team-rights__item-options\">\n\t\t\t\t\t<div class=\"chart-wizard__team-rights__item-options__item-content_title\"\n\t\t\t\t\t\t :data-title=\"loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_ACCESS_TITLE')\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"chart-wizard__team-rights__item-options__item-content_title-text\">\n\t\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_BUSINESS_PROC_TITLE') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<span class=\"ui-hint\" @click=\"goToBPHelp\">\n\t\t\t\t\t\t\t<span class=\"ui-hint-icon\"/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"chart-wizard__team-rights__item-description-container\">\n\t\t\t\t\t\t<span class=\"chart-wizard__team-rights__item-description-text\" v-html=\"businessDescription\">\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"chart-wizard__team-rights__business-proc-selector\"\n\t\t\t\t\t\tref=\"business-proc-selector\"\n\t\t\t\t\t\tdata-test-id=\"hr-company-structure__team-rights__business-proc-selector\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__team-rights__item-options\">\n\t\t\t\t\t<div class=\"chart-wizard__team-rights__item-options__item-content_title --soon\"\n\t\t\t\t\t\t :data-title=\"loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_ACCESS_TITLE')\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"chart-wizard__team-rights__item-options__item-content_title-text\">\n\t\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_REPORTS_TITLE') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<span class=\"chart-wizard__team-rights_ui-hint-disabled\">\n\t\t\t\t\t\t\t<span class=\"ui-hint-icon\"/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"chart-wizard__team-rights__item-description-container\">\n\t\t\t\t\t\t<span class=\"chart-wizard__team-rights__item-description-text --soon\" v-html=\"reportsDescriptions\">\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"chart-wizard__team-rights__reports-selector\"\n\t\t\t\t\t\tref=\"reports-selector\"\n\t\t\t\t\t\tdata-test-id=\"hr-company-structure__team-rights__reports-selector\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","// @vue/component\nexport const AccessDenied = {\n\tname: 'AccessDenied',\n\n\tmounted(): void\n\t{\n\t\t// enable 'next' button\n\t\tthis.$emit('applyData', {\n\t\t\tisDepartmentDataChanged: false,\n\t\t\tisValid: true,\n\t\t});\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"chart-wizard__access-denied\">\n\t\t\t<div class=\"chart-wizard__access-denied_icon\"></div>\n\t\t\t<div class=\"chart-wizard__access-denied_title\">\n\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ACCESS_DENIED_TITLE') }}\n\t\t\t</div>\n\t\t\t<div class=\"chart-wizard__access-denied_description\">\n\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ACCESS_DENIED_DESCRIPTION') }}\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { getData, postData } from 'humanresources.company-structure.api';\nimport type { ChatListResponse } from 'humanresources.company-structure.utils';\nimport { DepartmentUserIds } from './types';\n\nexport const WizardAPI = {\n\taddDepartment: (\n\t\tname: string,\n\t\tparentId: number,\n\t\tdescription: ?string,\n\t\tentityType: ?string,\n\t\tcolorName: ?string,\n\t): Promise<void> => {\n\t\treturn postData('humanresources.api.Structure.Node.add', {\n\t\t\tname,\n\t\t\tparentId,\n\t\t\tdescription,\n\t\t\tentityType,\n\t\t\tcolorName,\n\t\t});\n\t},\n\tgetEmployees: (nodeId: number): Promise<Array<number>> => {\n\t\treturn postData('humanresources.api.Structure.Node.Member.Employee.getIds', { nodeId });\n\t},\n\tupdateDepartment: (\n\t\tnodeId: number,\n\t\tparentId: number,\n\t\tname: string,\n\t\tdescription: ?string,\n\t\tcolorName: ?string,\n\t): Promise<void> => {\n\t\treturn postData('humanresources.api.Structure.Node.update', {\n\t\t\tnodeId,\n\t\t\tname,\n\t\t\tparentId,\n\t\t\tdescription,\n\t\t\tcolorName,\n\t\t});\n\t},\n\tsaveUsers: (nodeId: number, userIds: DepartmentUserIds, parentId: ?number): Promise<Array> => {\n\t\treturn postData('humanresources.api.Structure.Node.Member.saveUserList', {\n\t\t\tnodeId,\n\t\t\tuserIds,\n\t\t\tparentId,\n\t\t});\n\t},\n\tmoveUsers: (nodeId: number, userIds: DepartmentUserIds, parentId: ?number): Promise<Array> => {\n\t\treturn postData('humanresources.api.Structure.Node.Member.moveUserListToDepartment', {\n\t\t\tnodeId,\n\t\t\tuserIds,\n\t\t\tparentId,\n\t\t});\n\t},\n\tsaveChats: (\n\t\tnodeId: number,\n\t\tids: number[],\n\t\tcreateDefault: boolean[],\n\t\tremoveIds: number[] = [],\n\t\tparentId: ?number = null,\n\t): Promise<void> => {\n\t\treturn postData('humanresources.api.Structure.Node.Member.Chat.saveChatList', {\n\t\t\tnodeId,\n\t\t\tids,\n\t\t\tcreateDefault,\n\t\t\tremoveIds,\n\t\t\tparentId,\n\t\t});\n\t},\n\tcreateSettings: (\n\t\tnodeId: number,\n\t\tsettings: Record<string, {values: string[], replace: boolean}>,\n\t\tparentId: ?number,\n\t): Promise<void> => {\n\t\treturn postData('humanresources.api.Structure.Node.NodeSettings.create', {\n\t\t\tsettings,\n\t\t\tnodeId,\n\t\t\tparentId,\n\t\t});\n\t},\n\tupdateSettings: (\n\t\tnodeId: number,\n\t\tsettings: Record<string, {values: string[], replace: boolean}>,\n\t\tparentId: ?number,\n\t): Promise<void> => {\n\t\treturn postData('humanresources.api.Structure.Node.NodeSettings.update', {\n\t\t\tsettings,\n\t\t\tnodeId,\n\t\t\tparentId,\n\t\t});\n\t},\n\tgetSettings: (nodeId: number): Promise<Array<number>> => {\n\t\treturn postData('humanresources.api.Structure.Node.NodeSettings.get', { nodeId });\n\t},\n\tgetChatsAndChannels: (nodeId: number): Promise<ChatListResponse> => {\n\t\treturn getData('humanresources.api.Structure.Node.Member.Chat.getList', {\n\t\t\tnodeId,\n\t\t});\n\t},\n};\n","import { useChartStore } from 'humanresources.company-structure.chart-store';\nimport type { DepartmentData } from './types';\n\nexport const chartWizardActions = {\n\tcreateDepartment: (departmentData: DepartmentData): void => {\n\t\tconst { departments } = useChartStore();\n\t\tconst { id: departmentId, parentId } = departmentData;\n\t\tconst parent = departments.get(parentId);\n\t\tparent.children = [...parent.children ?? [], departmentId];\n\t\tdepartments.set(departmentId, {\n\t\t\t...departmentData,\n\t\t\tid: departmentId,\n\t\t\tchats: null,\n\t\t\tchannels: null,\n\t\t});\n\t},\n\tmoveUsersToRootDepartment: (removedUsers: number[], userMovedToRootIds: number[]): void => {\n\t\tconst { departments } = useChartStore();\n\t\tconst rootEmployees = removedUsers.filter((user) => userMovedToRootIds.includes(user.id));\n\t\tconst rootNode = [...departments.values()].find((department) => department.parentId === 0);\n\t\tdepartments.set(rootNode.id, {\n\t\t\t...rootNode,\n\t\t\temployees: [...(rootNode.employees || []), ...rootEmployees],\n\t\t\tuserCount: rootNode.userCount + rootEmployees.length,\n\t\t});\n\t},\n\trefreshDepartments: (ids: number[]): void => {\n\t\tconst store = useChartStore();\n\t\tstore.refreshDepartments(ids);\n\t},\n\ttryToAddCurrentDepartment(departmentData: DepartmentData, departmentId: number): void\n\t{\n\t\tconst store = useChartStore();\n\t\tconst { heads, employees } = departmentData;\n\t\tconst isCurrentUserAdd = [...heads, ...employees].some((user) => {\n\t\t\treturn user.id === store.userId;\n\t\t});\n\t\tif (isCurrentUserAdd)\n\t\t{\n\t\t\tstore.changeCurrentDepartment(0, departmentId);\n\t\t}\n\t},\n};\n","import { UI } from 'ui.notification';\nimport { MessageBox, MessageBoxButtons } from 'ui.dialogs.messagebox';\nimport { mapState } from 'ui.vue3.pinia';\nimport { Event } from 'main.core';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { getMemberRoles, reportedErrorTypes } from 'humanresources.company-structure.api';\nimport { SaveMode, StepIds, AuthorityTypes } from '../consts';\nimport { TreePreview } from './tree-preview/tree-preview';\nimport { Department } from './steps/department';\nimport { Employees } from './steps/employees';\nimport { BindChat } from './steps/bind-chat';\nimport { Entities } from './steps/entities';\nimport { TeamRights } from './steps/team-rights';\nimport { AccessDenied } from './steps/access-denied';\nimport { WizardAPI } from '../api';\nimport { chartWizardActions } from '../actions';\nimport { sendData as analyticsSendData } from 'ui.analytics';\nimport { PermissionActions, PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport type { WizardData, Step, DepartmentUserIds } from '../types';\nimport { EntityTypes, NodeColorsSettingsDict, WizardApiEntityChangedDict, NodeSettingsTypes } from 'humanresources.company-structure.utils';\nimport 'ui.buttons';\nimport 'ui.forms';\nimport '../style.css';\n\nexport const ChartWizard = {\n\tname: 'chartWizard',\n\n\temits: ['modifyTree', 'close'],\n\n\tcomponents: { Department, Employees, BindChat, TreePreview, Entities, TeamRights, AccessDenied },\n\n\tprops: {\n\t\tnodeId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tisEditMode: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tshowEntitySelector: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t},\n\t\t/** @type StepIdType */\n\t\tentity: {\n\t\t\ttype: String,\n\t\t},\n\t\tentityType: {\n\t\t\ttype: String,\n\t\t\tdefault: EntityTypes.department,\n\t\t},\n\t\tsource: {\n\t\t\ttype: String,\n\t\t},\n\t\trefToFocus: {\n\t\t\ttype: String,\n\t\t\tdefault: null,\n\t\t},\n\t},\n\n\tdata(): WizardData\n\t{\n\t\treturn {\n\t\t\tstepIndex: 0,\n\t\t\twaiting: false,\n\t\t\tisValidStep: false,\n\t\t\tisDepartmentDataChanged: false,\n\t\t\tdepartmentData: {\n\t\t\t\tid: 0,\n\t\t\t\tparentId: 0,\n\t\t\t\tname: '',\n\t\t\t\tdescription: '',\n\t\t\t\theads: [],\n\t\t\t\temployees: [],\n\t\t\t\tchats: [],\n\t\t\t\tchannels: [],\n\t\t\t\tuserCount: 0,\n\t\t\t\tcreateDefaultChat: false,\n\t\t\t\tcreateDefaultChannel: false,\n\t\t\t\tteamColor: NodeColorsSettingsDict.blue,\n\t\t\t\tentityType: EntityTypes.department,\n\t\t\t\tsettings: {\n\t\t\t\t\t[NodeSettingsTypes.businessProcAuthority]: new Set([AuthorityTypes.departmentHead]),\n\t\t\t\t\t[NodeSettingsTypes.reportsAuthority]: new Set([AuthorityTypes.departmentHead]),\n\t\t\t\t},\n\t\t\t},\n\t\t\tremovedUsers: [],\n\t\t\temployeesIds: [],\n\t\t\tdepartmentSettings: {\n\t\t\t\t[NodeSettingsTypes.businessProcAuthority]: new Set([AuthorityTypes.departmentHead]),\n\t\t\t\t[NodeSettingsTypes.reportsAuthority]: new Set([AuthorityTypes.departmentHead]),\n\t\t\t},\n\t\t\tinitChats: [],\n\t\t\tinitChannels: [],\n\t\t\tshouldErrorHighlight: false,\n\t\t\tsteps: [],\n\t\t\tsaveMode: SaveMode.moveUsers,\n\t\t};\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.init();\n\t},\n\n\tbeforeUnmount(): void\n\t{\n\t\tEvent.unbind(window, 'beforeunload', this.handleBeforeUnload);\n\t},\n\n\tcomputed: {\n\t\tbreadcrumbsTitle(): string\n\t\t{\n\t\t\tif (this.isEditMode)\n\t\t\t{\n\t\t\t\treturn this.isTeamEntity\n\t\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EDIT_TEAM_TITLE')\n\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EDIT_TITLE')\n\t\t\t\t;\n\t\t\t}\n\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_CREATE_TEAM_TITLE')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_CREATE_TITLE')\n\t\t\t;\n\t\t},\n\t\tcloseConfirmTitle(): string\n\t\t{\n\t\t\tif (this.isEditMode)\n\t\t\t{\n\t\t\t\treturn this.departmentData?.entityType === EntityTypes.team\n\t\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_CLOSE_EDIT_WIZARD_TEAM_TITLE')\n\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_CLOSE_EDIT_WIZARD_DEPARTMENT_TITLE')\n\t\t\t\t;\n\t\t\t}\n\n\t\t\treturn this.departmentData?.entityType === EntityTypes.team\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_CLOSE_CREATE_WIZARD_TEAM_TITLE')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_CLOSE_CREATE_WIZARD_DEPARTMENT_TITLE')\n\t\t\t;\n\t\t},\n\t\tcurrentStep(): Step\n\t\t{\n\t\t\treturn this.steps[this.stepIndex];\n\t\t},\n\t\tcomponentInfo(): { name: string, params?: Object }\n\t\t{\n\t\t\tif (!this.currentStep.isPermitted)\n\t\t\t{\n\t\t\t\treturn {\n\t\t\t\t\tname: 'AccessDenied',\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tconst {\n\t\t\t\tparentId,\n\t\t\t\tname,\n\t\t\t\tdescription,\n\t\t\t\theads,\n\t\t\t\tentityType,\n\t\t\t\tteamColor,\n\t\t\t} = this.departmentData;\n\n\t\t\tconst components = {\n\t\t\t\t[StepIds.department]: {\n\t\t\t\t\tname: 'Department',\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tparentId,\n\t\t\t\t\t\tname,\n\t\t\t\t\t\tdescription,\n\t\t\t\t\t\tentityType,\n\t\t\t\t\t\tteamColor,\n\t\t\t\t\t\trefToFocus: this.refToFocus,\n\t\t\t\t\t\tshouldErrorHighlight: this.shouldErrorHighlight,\n\t\t\t\t\t\tisEditMode: this.isEditMode,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t[StepIds.employees]: {\n\t\t\t\t\tname: 'Employees',\n\t\t\t\t\tparams: {\n\t\t\t\t\t\theads,\n\t\t\t\t\t\tentityType,\n\t\t\t\t\t\temployeesIds: this.employeesIds,\n\t\t\t\t\t\tisEditMode: this.isEditMode,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t[StepIds.bindChat]: {\n\t\t\t\t\tname: 'BindChat',\n\t\t\t\t\tparams: {\n\t\t\t\t\t\theads,\n\t\t\t\t\t\tname,\n\t\t\t\t\t\tentityType,\n\t\t\t\t\t\tisEditMode: this.isEditMode,\n\t\t\t\t\t\tinitChats: this.initChats,\n\t\t\t\t\t\tinitChannels: this.initChannels,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t[StepIds.teamRights]: {\n\t\t\t\t\tname: 'TeamRights',\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tname,\n\t\t\t\t\t\tsettings: this.departmentSettings,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t[StepIds.entities]: {\n\t\t\t\t\tname: 'Entities',\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tparentId,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t};\n\n\t\t\treturn components[this.currentStep.id];\n\t\t},\n\t\tisFirstStep(): boolean\n\t\t{\n\t\t\treturn this.currentStep.id === StepIds.entities;\n\t\t},\n\t\tbreadcrumbsSteps(): Step[]\n\t\t{\n\t\t\treturn this.steps.filter((step) => step.hasBreadcrumbs);\n\t\t},\n\t\trootId(): number\n\t\t{\n\t\t\tconst { id } = [...this.departments.values()].find((department) => {\n\t\t\t\treturn department.parentId === 0;\n\t\t\t});\n\n\t\t\treturn id;\n\t\t},\n\t\tisTeamEntity(): boolean\n\t\t{\n\t\t\treturn this.departmentData?.entityType === EntityTypes.team;\n\t\t},\n\t\tcreateButtonText(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_CREATE_TEAM_BTN')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_CREATE_BTN')\n\t\t\t;\n\t\t},\n\t\t...mapState(useChartStore, ['departments', 'userId', 'currentDepartments']),\n\t},\n\n\tmethods: {\n\t\thandleBeforeUnload(event: Event): void\n\t\t{\n\t\t\tevent.preventDefault();\n\t\t},\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tasync init(): Promise<void>\n\t\t{\n\t\t\tthis.apiEntityChanged = new Set();\n\n\t\t\t// Important: we need to call createSteps as soon as we get entityType or determine a lack of it\n\n\t\t\tEvent.bind(window, 'beforeunload', this.handleBeforeUnload);\n\t\t\tif (this.isEditMode)\n\t\t\t{\n\t\t\t\tconst {\n\t\t\t\t\tid,\n\t\t\t\t\tname,\n\t\t\t\t\tdescription,\n\t\t\t\t\tparentId,\n\t\t\t\t\theads,\n\t\t\t\t\tuserCount,\n\t\t\t\t\tchildren,\n\t\t\t\t\tentityType,\n\t\t\t\t\tteamColor,\n\t\t\t\t\temployees = [],\n\t\t\t\t} = this.departments.get(this.nodeId);\n\n\t\t\t\tthis.getMemberRoles(entityType);\n\t\t\t\tthis.createSteps(entityType, id);\n\t\t\t\tthis.stepIndex = this.steps.indexOf(this.getStepById(this.entity));\n\t\t\t\tthis.createDefaultSaveMode(entityType);\n\n\t\t\t\tthis.departmentData = {\n\t\t\t\t\t...this.departmentData,\n\t\t\t\t\tid,\n\t\t\t\t\tparentId,\n\t\t\t\t\tname,\n\t\t\t\t\tdescription,\n\t\t\t\t\theads,\n\t\t\t\t\tuserCount,\n\t\t\t\t\tchildren,\n\t\t\t\t\temployees,\n\t\t\t\t\tentityType,\n\t\t\t\t\tteamColor,\n\t\t\t\t\tcreateDefaultChat: false,\n\t\t\t\t\tcreateDefaultChannel: false,\n\t\t\t\t};\n\t\t\t\tconst rawSettings = await WizardAPI.getSettings(this.nodeId);\n\t\t\t\tthis.departmentSettings = rawSettings.reduce((acc, { settingsType, settingsValue }) => {\n\t\t\t\t\tif (!Object.hasOwn(acc, settingsType))\n\t\t\t\t\t{\n\t\t\t\t\t\tacc[settingsType] = new Set();\n\t\t\t\t\t}\n\t\t\t\t\tacc[settingsType].add(settingsValue);\n\n\t\t\t\t\treturn acc;\n\t\t\t\t}, { ...this.departmentSettings });\n\n\t\t\t\t// store directly bound chats and channels\n\t\t\t\tconst rawChatsAndChannels = await WizardAPI.getChatsAndChannels(this.nodeId);\n\t\t\t\tthis.initChats = rawChatsAndChannels.chats.filter((item) => !item.originalNodeId);\n\t\t\t\tthis.initChannels = rawChatsAndChannels.channels.filter((item) => !item.originalNodeId);\n\n\t\t\t\tthis.employeesIds = await WizardAPI.getEmployees(this.nodeId);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.entityType)\n\t\t\t{\n\t\t\t\tthis.departmentData.entityType = this.entityType;\n\t\t\t}\n\n\t\t\tthis.getMemberRoles(this.entityType);\n\t\t\tthis.createSteps(this.entityType, this.departmentData.id);\n\t\t\tthis.createDefaultSaveMode(this.entityType);\n\n\t\t\tif (this.nodeId)\n\t\t\t{\n\t\t\t\tthis.departmentData.parentId = this.nodeId;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.departmentData.parentId = 0;\n\n\t\t\tanalyticsSendData({\n\t\t\t\ttool: 'structure',\n\t\t\t\tcategory: 'structure',\n\t\t\t\tevent: 'create_wizard',\n\t\t\t\tc_element: this.source,\n\t\t\t});\n\t\t},\n\t\tgetMemberRoles(entityType): void\n\t\t{\n\t\t\tthis.memberRoles = getMemberRoles(entityType);\n\t\t},\n\t\tmove(buttonId: string = 'next'): void\n\t\t{\n\t\t\tif (buttonId === 'next' && !this.isValidStep)\n\t\t\t{\n\t\t\t\tthis.shouldErrorHighlight = true;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.stepIndex = buttonId === 'back' ? this.stepIndex - 1 : this.stepIndex + 1;\n\t\t\tthis.pickStepsAnalytics();\n\t\t},\n\t\tmoveToStep(stepId: string): void\n\t\t{\n\t\t\tif (!this.isValidStep)\n\t\t\t{\n\t\t\t\tthis.shouldErrorHighlight = true;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.stepIndex = this.steps.indexOf(this.getStepById(stepId, true));\n\t\t\tthis.pickStepsAnalytics();\n\t\t},\n\t\tgetStepById(stepId: string, force: false): Step\n\t\t{\n\t\t\tconst stepIndex = this.steps.findIndex((step) => stepId === step.id);\n\n\t\t\tif (stepIndex > -1 && (this.steps[stepIndex].isEditPermitted || force))\n\t\t\t{\n\t\t\t\treturn this.steps[stepIndex];\n\t\t\t}\n\n\t\t\treturn this.steps.find((step, index) => step.isEditPermitted && index > stepIndex)\n\t\t\t\t|| this.steps.find((step) => StepIds.department === step.id)\n\t\t\t;\n\t\t},\n\t\tclose(sendEvent: boolean = false): void\n\t\t{\n\t\t\tthis.$emit('close');\n\t\t\tif (sendEvent)\n\t\t\t{\n\t\t\t\tanalyticsSendData({\n\t\t\t\t\ttool: 'structure',\n\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\tevent: 'cancel_wizard',\n\t\t\t\t\tc_element: this.source,\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tcloseWithConfirm(): void\n\t\t{\n\t\t\tif (!this.isDepartmentDataChanged)\n\t\t\t{\n\t\t\t\tthis.close(true);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst confirmPopup = new MessageBox({\n\t\t\t\ttitle: this.closeConfirmTitle,\n\t\t\t\tmessage: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_CLOSE_WIZARD_MESSAGE'),\n\t\t\t\tyesCaption: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_CLOSE_WIZARD_OK_CAPTION'),\n\t\t\t\tnoCaption: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_CLOSE_WIZARD_NO_CAPTION'),\n\t\t\t\tonYes: () => {\n\t\t\t\t\tthis.close(true);\n\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t\tminHeight: 155,\n\t\t\t\tbuttons: MessageBoxButtons.YES_NO,\n\t\t\t\tpopupOptions: {\n\t\t\t\t\tcloseIcon: true,\n\t\t\t\t\tclassName: 'humanresources-chart-wizard__close-confirm-popup',\n\t\t\t\t},\n\t\t\t});\n\t\t\tconfirmPopup.getYesButton().setRound(true);\n\t\t\tconfirmPopup.getNoButton().setRound(true);\n\t\t\tconfirmPopup.show();\n\t\t},\n\t\tonApplyData(\n\t\t\tdata: {\n\t\t\t\tisValid?: boolean,\n\t\t\t\tisDepartmentDataChanged?: boolean,\n\t\t\t\tremovedUsers?: User, ...Partial<WizardData['departmentData']>\n\t\t\t},\n\t\t): void\n\t\t{\n\t\t\tconst prevEntityType = this.departmentData.entityType;\n\t\t\tconst {\n\t\t\t\tisValid = true,\n\t\t\t\tremovedUsers = [],\n\t\t\t\tisDepartmentDataChanged = true,\n\t\t\t\tapiEntityChanged = null,\n\t\t\t\t...departmentData\n\t\t\t} = data;\n\t\t\tthis.isValidStep = isValid;\n\t\t\tthis.isDepartmentDataChanged = this.isDepartmentDataChanged || isDepartmentDataChanged;\n\n\t\t\tif (apiEntityChanged)\n\t\t\t{\n\t\t\t\tthis.apiEntityChanged.add(apiEntityChanged);\n\t\t\t}\n\n\t\t\tif (departmentData)\n\t\t\t{\n\t\t\t\tthis.departmentData = {\n\t\t\t\t\t...this.departmentData,\n\t\t\t\t\t...departmentData,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tthis.removedUsers = removedUsers;\n\t\t\tif (isValid)\n\t\t\t{\n\t\t\t\tthis.shouldErrorHighlight = false;\n\t\t\t}\n\n\t\t\t// change steps and roles according to entityType\n\t\t\tif (prevEntityType !== this.departmentData.entityType)\n\t\t\t{\n\t\t\t\tthis.getMemberRoles(this.departmentData.entityType);\n\t\t\t\tthis.createSteps(this.departmentData.entityType, this.departmentData.id);\n\t\t\t\tthis.createDefaultSaveMode(this.departmentData.entityType);\n\n\t\t\t\tconst prevMemberRoles = getMemberRoles(prevEntityType);\n\t\t\t\tconst rolesKeys = Object.keys(prevMemberRoles);\n\t\t\t\tthis.departmentData.heads = this.departmentData.heads.map((item) => {\n\t\t\t\t\tconst roleKey = rolesKeys.find((key) => prevMemberRoles[key] === item.role);\n\n\t\t\t\t\treturn { ...item, role: this.memberRoles[roleKey] };\n\t\t\t\t});\n\n\t\t\t\tthis.departmentData.employees = this.departmentData.employees\n\t\t\t\t\t.map((item) => ({ ...item, role: this.memberRoles.employee }))\n\t\t\t\t;\n\t\t\t}\n\n\t\t\t// change NodeColorsSettingsDict according to entityType\n\t\t\tthis.departmentData.teamColor = this.isTeamEntity\n\t\t\t\t? this.departmentData.teamColor ?? NodeColorsSettingsDict.blue\n\t\t\t\t: null\n\t\t\t;\n\t\t},\n\t\tgetAllSteps(entityType: string, departmentId: number = null): Step[]\n\t\t{\n\t\t\tconst isTeamEntity = entityType === EntityTypes.team;\n\t\t\tconst permissionChecker = PermissionChecker.getInstance();\n\n\t\t\treturn {\n\t\t\t\tentity: {\n\t\t\t\t\tid: StepIds.entities,\n\t\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_SELECT_ENTITY_TITLE'),\n\t\t\t\t\thasBreadcrumbs: false,\n\t\t\t\t\thasTreePreview: false,\n\t\t\t\t\tdataTestIdPart: 'entities',\n\t\t\t\t},\n\t\t\t\tdepartment: {\n\t\t\t\t\tid: StepIds.department,\n\t\t\t\t\tbreadcrumbsTitleDepartment: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_BREADCRUMBS',\n\t\t\t\t\tbreadcrumbsTitleTeam: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_TITLE_BREADCRUMBS',\n\t\t\t\t\thasBreadcrumbs: true,\n\t\t\t\t\thasTreePreview: true,\n\t\t\t\t\tisEditPermitted: isTeamEntity\n\t\t\t\t\t\t? permissionChecker.hasPermission(PermissionActions.teamEdit, departmentId)\n\t\t\t\t\t\t: permissionChecker.hasPermission(PermissionActions.departmentEdit, departmentId),\n\t\t\t\t\tdataTestIdPart: 'department',\n\t\t\t\t},\n\t\t\t\temployees: {\n\t\t\t\t\tid: StepIds.employees,\n\t\t\t\t\tbreadcrumbsTitleDepartment: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEES_BREADCRUMBS',\n\t\t\t\t\tbreadcrumbsTitleTeam: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_EMPLOYEES_BREADCRUMBS',\n\t\t\t\t\thasBreadcrumbs: true,\n\t\t\t\t\thasTreePreview: true,\n\t\t\t\t\tisEditPermitted: isTeamEntity\n\t\t\t\t\t\t? permissionChecker.hasPermission(PermissionActions.teamAddMember, departmentId)\n\t\t\t\t\t\t: permissionChecker.hasPermission(PermissionActions.employeeAddToDepartment, departmentId),\n\t\t\t\t\tdataTestIdPart: 'employees',\n\t\t\t\t},\n\t\t\t\tbindChat: {\n\t\t\t\t\tid: StepIds.bindChat,\n\t\t\t\t\tbreadcrumbsTitleDepartment: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TITLE_BREADCRUMBS',\n\t\t\t\t\tbreadcrumbsTitleTeam: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_TITLE_BREADCRUMBS',\n\t\t\t\t\thasBreadcrumbs: true,\n\t\t\t\t\thasTreePreview: false,\n\t\t\t\t\tisEditPermitted: isTeamEntity\n\t\t\t\t\t\t? permissionChecker.hasPermission(PermissionActions.teamCommunicationEdit, departmentId)\n\t\t\t\t\t\t: permissionChecker.hasPermission(PermissionActions.departmentCommunicationEdit, departmentId),\n\t\t\t\t\tdataTestIdPart: 'bind-chat',\n\t\t\t\t},\n\t\t\t\tteamRights: {\n\t\t\t\t\tid: StepIds.teamRights,\n\t\t\t\t\tbreadcrumbsTitleTeam: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_BREADCRUMBS',\n\t\t\t\t\thasBreadcrumbs: true,\n\t\t\t\t\thasTreePreview: false,\n\t\t\t\t\tisEditPermitted: isTeamEntity\n\t\t\t\t\t\t? permissionChecker.hasPermission(PermissionActions.teamSettingsEdit, departmentId)\n\t\t\t\t\t\t: permissionChecker.hasPermission(PermissionActions.departmentEdit, departmentId),\n\t\t\t\t\tdataTestIdPart: 'team-rights',\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\tcreateSteps(entityType: string = 'DEPARTMENT', departmentId: number = null): void\n\t\t{\n\t\t\tconst { entity, department, employees, bindChat, teamRights } = this.getAllSteps(entityType, departmentId);\n\n\t\t\tconst steps: Step[] = this.showEntitySelector ? [entity] : [];\n\t\t\tsteps.push(department, employees, bindChat);\n\n\t\t\tif (entityType === EntityTypes.team)\n\t\t\t{\n\t\t\t\tsteps.push(teamRights);\n\t\t\t\tsteps.forEach((step: Step): void => {\n\t\t\t\t\tObject.assign(step, {\n\t\t\t\t\t\tbreadcrumbsTitle: step.breadcrumbsTitleTeam ? this.loc(step.breadcrumbsTitleTeam) : '',\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tsteps.forEach((step: Step): void => {\n\t\t\t\t\tObject.assign(step, {\n\t\t\t\t\t\tbreadcrumbsTitle: step.breadcrumbsTitleDepartment ? this.loc(step.breadcrumbsTitleDepartment) : '',\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (this.isEditMode)\n\t\t\t{\n\t\t\t\tsteps.forEach((step: Step): void => {\n\t\t\t\t\tObject.assign(step, {\n\t\t\t\t\t\tisPermitted: step.isEditPermitted,\n\t\t\t\t\t\thasTreePreview: step.hasTreePreview && step.isEditPermitted,\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tsteps.forEach((step: Step): void => {\n\t\t\t\t\tObject.assign(step, {\n\t\t\t\t\t\tisPermitted: true,\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.steps = steps;\n\t\t},\n\t\tgetUsersPromise(departmentId: number): Promise<void>\n\t\t{\n\t\t\tconst ids = this.calculateEmployeeIds();\n\t\t\tconst { headsIds, deputiesIds, employeesIds } = ids;\n\n\t\t\tconst departmentUserIds = {\n\t\t\t\t[this.memberRoles.head]: headsIds,\n\t\t\t\t[this.memberRoles.deputyHead]: deputiesIds,\n\t\t\t\t[this.memberRoles.employee]: employeesIds,\n\t\t\t};\n\n\t\t\treturn this.getUserMemberPromise(departmentId, departmentUserIds);\n\t\t},\n\t\tcalculateEmployeeIds(): Object\n\t\t{\n\t\t\tconst { heads, employees = [] } = this.departmentData;\n\n\t\t\treturn [...heads, ...employees].reduce((acc, user) => {\n\t\t\t\tconst { headsIds, deputiesIds, employeesIds } = acc;\n\t\t\t\tif (user.role === this.memberRoles.head)\n\t\t\t\t{\n\t\t\t\t\theadsIds.push(user.id);\n\t\t\t\t}\n\t\t\t\telse if (user.role === this.memberRoles.deputyHead)\n\t\t\t\t{\n\t\t\t\t\tdeputiesIds.push(user.id);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\temployeesIds.push(user.id);\n\t\t\t\t}\n\n\t\t\t\treturn acc;\n\t\t\t}, {\n\t\t\t\theadsIds: [],\n\t\t\t\tdeputiesIds: [],\n\t\t\t\temployeesIds: [],\n\t\t\t});\n\t\t},\n\t\tgetUserMemberPromise(departmentId: number, ids: DepartmentUserIds, role: string): Promise<void>\n\t\t{\n\t\t\tif (this.isEditMode)\n\t\t\t{\n\t\t\t\treturn WizardAPI.saveUsers(departmentId, ids);\n\t\t\t}\n\n\t\t\tconst hasUsers = Object.values(ids).some((userIds) => userIds.length > 0);\n\t\t\tif (!hasUsers)\n\t\t\t{\n\t\t\t\treturn Promise.resolve();\n\t\t\t}\n\n\t\t\tconst parentId = this.departmentData.parentId ?? null;\n\t\t\tif (this.saveMode === SaveMode.moveUsers)\n\t\t\t{\n\t\t\t\treturn WizardAPI.moveUsers(departmentId, ids, parentId);\n\t\t\t}\n\n\t\t\treturn WizardAPI.saveUsers(departmentId, ids, parentId);\n\t\t},\n\t\tasync create(): Promise<void>\n\t\t{\n\t\t\tconst {\n\t\t\t\tname,\n\t\t\t\tparentId,\n\t\t\t\tdescription,\n\t\t\t\tchats,\n\t\t\t\tchannels,\n\t\t\t\tcreateDefaultChat,\n\t\t\t\tcreateDefaultChannel,\n\t\t\t\tentityType,\n\t\t\t\tteamColor,\n\t\t\t\tsettings,\n\t\t\t} = this.departmentData;\n\n\t\t\tlet departmentId = 0;\n\t\t\tlet accessCode = '';\n\t\t\tthis.waiting = true;\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst [newDepartment] = await WizardAPI.addDepartment(\n\t\t\t\t\tname,\n\t\t\t\t\tparentId,\n\t\t\t\t\tdescription,\n\t\t\t\t\tentityType,\n\t\t\t\t\tteamColor?.name,\n\t\t\t\t);\n\t\t\t\tdepartmentId = newDepartment.id;\n\t\t\t\taccessCode = newDepartment.accessCode;\n\n\t\t\t\tconst data = await this.getUsersPromise(departmentId);\n\t\t\t\tif (data?.updatedDepartmentIds)\n\t\t\t\t{\n\t\t\t\t\tchartWizardActions.refreshDepartments(data.updatedDepartmentIds);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tchartWizardActions.tryToAddCurrentDepartment(this.departmentData, departmentId);\n\t\t\t\t}\n\n\t\t\t\tawait WizardAPI.saveChats(\n\t\t\t\t\tdepartmentId,\n\t\t\t\t\t{ chat: [...chats], channel: [...channels] },\n\t\t\t\t\t{ chat: Number(createDefaultChat), channel: Number(createDefaultChannel) },\n\t\t\t\t\tnull,\n\t\t\t\t\tparentId,\n\t\t\t\t);\n\n\t\t\t\tif (entityType === EntityTypes.team)\n\t\t\t\t{\n\t\t\t\t\tawait WizardAPI.createSettings(\n\t\t\t\t\t\tdepartmentId,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t[NodeSettingsTypes.businessProcAuthority]: {\n\t\t\t\t\t\t\t\tvalues: [...settings[NodeSettingsTypes.businessProcAuthority]],\n\t\t\t\t\t\t\t\treplace: true,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\tparentId,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t\tcatch (error)\n\t\t\t{\n\t\t\t\tif (!reportedErrorTypes.has(error.code))\n\t\t\t\t{\n\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: error.message,\n\t\t\t\t\t\tautoHideDelay: 4000,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfinally\n\t\t\t{\n\t\t\t\tthis.waiting = false;\n\t\t\t}\n\n\t\t\tchartWizardActions.createDepartment({ ...this.departmentData, id: departmentId, accessCode });\n\t\t\tthis.$emit('modifyTree', { id: departmentId, parentId, showConfetti: true });\n\n\t\t\tconst { headsIds, deputiesIds, employeesIds } = this.calculateEmployeeIds();\n\n\t\t\tanalyticsSendData(\n\t\t\t\t{\n\t\t\t\t\ttool: 'structure',\n\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\tevent: 'create_dept',\n\t\t\t\t\tc_element: this.source,\n\t\t\t\t\tp2: `headAmount_${headsIds.length}`,\n\t\t\t\t\tp3: `secondHeadAmount_${deputiesIds.length}`,\n\t\t\t\t\tp4: `employeeAmount_${employeesIds.length}`,\n\t\t\t\t},\n\t\t\t);\n\t\t\tthis.close();\n\t\t},\n\t\tasync save(): Promise<void>\n\t\t{\n\t\t\tif (!this.isValidStep)\n\t\t\t{\n\t\t\t\tthis.shouldErrorHighlight = true;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst {\n\t\t\t\tid,\n\t\t\t\tparentId,\n\t\t\t\tname,\n\t\t\t\tdescription,\n\t\t\t\tteamColor,\n\t\t\t\tsettings,\n\t\t\t\tchats,\n\t\t\t\tchannels,\n\t\t\t\tcreateDefaultChat,\n\t\t\t\tcreateDefaultChannel,\n\t\t\t} = this.departmentData;\n\n\t\t\tconst currentNode = this.departments.get(id);\n\t\t\tconst targetNodeId = currentNode?.parentId === parentId ? null : parentId;\n\t\t\tthis.waiting = true;\n\n\t\t\tconst usersPromise = this.apiEntityChanged.has(WizardApiEntityChangedDict.employees)\n\t\t\t\t? this.getUsersPromise(id)\n\t\t\t\t: Promise.resolve();\n\n\t\t\tconst departmentPromise = this.apiEntityChanged.has(WizardApiEntityChangedDict.department)\n\t\t\t\t? WizardAPI.updateDepartment(id, targetNodeId, name, description, teamColor?.name)\n\t\t\t\t: Promise.resolve();\n\n\t\t\tconst settingsPromise = this.apiEntityChanged.has(WizardApiEntityChangedDict.settings)\n\t\t\t\t? WizardAPI.updateSettings(\n\t\t\t\t\tid,\n\t\t\t\t\t{\n\t\t\t\t\t\t[NodeSettingsTypes.businessProcAuthority]: {\n\t\t\t\t\t\t\tvalues: [...settings[NodeSettingsTypes.businessProcAuthority]],\n\t\t\t\t\t\t\treplace: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tparentId,\n\t\t\t\t)\n\t\t\t\t: Promise.resolve();\n\n\t\t\tthis.pickEditAnalytics(id, parentId);\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst [usersResponse] = await Promise.all([usersPromise, departmentPromise, settingsPromise]);\n\n\t\t\t\tif (this.apiEntityChanged.has(WizardApiEntityChangedDict.bindChats))\n\t\t\t\t{\n\t\t\t\t\tawait WizardAPI.saveChats(\n\t\t\t\t\t\tid,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tchat: chats.filter((chatId) => !this.initChats.some((chat) => chat.id === chatId)),\n\t\t\t\t\t\t\tchannel: channels.filter((channelId) => !this.initChannels.some((channel) => channel.id === channelId)),\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{ chat: Number(createDefaultChat), channel: Number(createDefaultChannel) },\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\t...this.initChats.filter((chat) => !chats.includes(chat.id)).map((chat) => chat.id),\n\t\t\t\t\t\t\t...this.initChannels.filter((channel) => !channels.includes(channel.id)).map((channel) => channel.id),\n\t\t\t\t\t\t],\n\t\t\t\t\t);\n\n\t\t\t\t\tthis.departmentData.chatsDetailed = null;\n\t\t\t\t\tthis.departmentData.channelsDetailed = null;\n\t\t\t\t}\n\n\t\t\t\tlet userMovedToRootIds = [];\n\t\t\t\tif (this.removedUsers.length > 0)\n\t\t\t\t{\n\t\t\t\t\tuserMovedToRootIds = usersResponse?.userMovedToRootIds ?? [];\n\t\t\t\t\tif (userMovedToRootIds.length > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tchartWizardActions.moveUsersToRootDepartment(this.removedUsers, userMovedToRootIds);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst store = useChartStore();\n\t\t\t\tif (userMovedToRootIds.includes(this.userId))\n\t\t\t\t{\n\t\t\t\t\tstore.changeCurrentDepartment(id, this.rootId);\n\t\t\t\t}\n\t\t\t\telse if (this.removedUsers.some((user) => user.id === this.userId))\n\t\t\t\t{\n\t\t\t\t\tstore.changeCurrentDepartment(id);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tchartWizardActions.tryToAddCurrentDepartment(this.departmentData, id);\n\t\t\t\t}\n\n\t\t\t\tstore.updateDepartment(this.departmentData);\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tconsole.error(e);\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfinally\n\t\t\t{\n\t\t\t\tthis.waiting = false;\n\t\t\t}\n\n\t\t\tthis.$emit('modifyTree', { id, parentId });\n\t\t\tthis.close();\n\t\t},\n\t\thandleSaveModeChanged(actionId: string): void\n\t\t{\n\t\t\tthis.saveMode = actionId;\n\t\t},\n\t\tcreateDefaultSaveMode(entityType: string = 'DEPARTMENT'): void\n\t\t{\n\t\t\tif (entityType === EntityTypes.team)\n\t\t\t{\n\t\t\t\tthis.saveMode = SaveMode.addUsers;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.saveMode = SaveMode.moveUsers;\n\t\t\t}\n\t\t},\n\t\tpickEditAnalytics(departmentId: number, parentId: number): void\n\t\t{\n\t\t\tconst currentNode = this.departments.get(departmentId);\n\t\t\tswitch (this.entity)\n\t\t\t{\n\t\t\t\tcase StepIds.department:\n\t\t\t\t\tanalyticsSendData({\n\t\t\t\t\t\ttool: 'structure',\n\t\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\t\tevent: 'edit_dept_name',\n\t\t\t\t\t\tc_element: this.source,\n\t\t\t\t\t\tp1: currentNode?.parentId === parentId ? 'editHead_N' : 'editHeadDept_Y',\n\t\t\t\t\t\tp2: currentNode?.name === name ? 'editName_N' : 'editName_Y',\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase StepIds.employees:\n\t\t\t\t{\n\t\t\t\t\tconst { headsIds, deputiesIds, employeesIds } = this.calculateEmployeeIds();\n\t\t\t\t\tanalyticsSendData({\n\t\t\t\t\t\ttool: 'structure',\n\t\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\t\tevent: 'edit_dept_employee',\n\t\t\t\t\t\tc_element: this.source,\n\t\t\t\t\t\tp2: `headAmount_${headsIds.length}`,\n\t\t\t\t\t\tp3: `secondHeadAmount_${deputiesIds.length}`,\n\t\t\t\t\t\tp4: `employeeAmount_${employeesIds.length}`,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t},\n\t\tpickStepsAnalytics(): void\n\t\t{\n\t\t\tlet event = null;\n\t\t\tswitch (this.currentStep.id)\n\t\t\t{\n\t\t\t\tcase StepIds.department:\n\t\t\t\t\tevent = 'create_dept_step1';\n\t\t\t\t\tbreak;\n\t\t\t\tcase StepIds.employees:\n\t\t\t\t\tevent = 'create_dept_step2';\n\t\t\t\t\tbreak;\n\t\t\t\tcase StepIds.bindChat:\n\t\t\t\t\tevent = 'create_dept_step3';\n\t\t\t\t\tbreak;\n\t\t\t\tcase StepIds.teamRights:\n\t\t\t\t\tevent = 'create_dept_step4';\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (event)\n\t\t\t{\n\t\t\t\tanalyticsSendData({\n\t\t\t\t\ttool: 'structure',\n\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\tevent,\n\t\t\t\t\tc_element: this.source,\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"chart-wizard\">\n\t\t\t<div class=\"chart-wizard__dialog\" :style=\"{ 'max-width': isFirstStep ? '580px' : '843px' }\">\n\t\t\t\t<div v-if=\"currentStep.hasBreadcrumbs\" class=\"chart-wizard__breadcrumbs-head\">\n\t\t\t\t\t<div class=\"chart-wizard__head_close --breadcrumbs\" @click=\"closeWithConfirm(true)\"></div>\n\t\t\t\t\t<div class=\"chart-wizard__breadcrumbs-head_descr\">\n\t\t\t\t\t\t{{ breadcrumbsTitle }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"chart-wizard__breadcrumbs-head_breadcrumbs\">\n\t\t\t\t\t\t<span \n\t\t\t\t\t\t\tv-for=\"(step, index) in breadcrumbsSteps\" \n\t\t\t\t\t\t\t:key=\"index\"\n\t\t\t\t\t\t\tclass=\"chart-wizard__breadcrumbs-head_breadcrumbs-item\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span v-if=\"index > 0\" class=\"ui-icon-set --chevron-right\"></span>\n\t\t\t\t\t\t\t<span class=\"chart-wizard__breadcrumbs-head_breadcrumbs-item-text\"\n\t\t\t\t\t\t\t\t  :class=\"{ '--active': step.id === currentStep.id }\"\n\t\t\t\t\t\t\t\t  :data-test-id=\"'hr-company-structure_chart-wizard__breadcrumbs_' + step.dataTestIdPart\"\n\t\t\t\t\t\t\t\t  @click=\"moveToStep(step.id)\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{{ step.breadcrumbsTitle }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-else class=\"chart-wizard__head\">\n\t\t\t\t\t<div class=\"chart-wizard__head_close\" @click=\"close(true)\"></div>\n\t\t\t\t\t<p class=\"chart-wizard__head_title\">{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_CREATE') }}</p>\n\t\t\t\t\t<p class=\"chart-wizard__head_descr\" :class=\"{ '--first-step': isFirstStep }\">\n\t\t\t\t\t\t{{ currentStep.title }}\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__content\" :style=\"{ display: !isEditMode && isFirstStep ? 'block' : 'flex' }\">\n\t\t\t\t\t<KeepAlive>\n\t\t\t\t\t\t<component\n\t\t\t\t\t\t\t:is=\"componentInfo.name\"\n\t\t\t\t\t\t\tv-bind=\"componentInfo.params\"\n\t\t\t\t\t\t\tv-on=\"{\n\t\t\t\t\t\t\t\tapplyData: onApplyData,\n\t\t\t\t\t\t\t\tsaveModeChanged: componentInfo.name === 'Employees' ? handleSaveModeChanged : undefined\n\t\t\t\t\t\t\t}\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t</component>\n\t\t\t\t\t</KeepAlive>\n\t\t\t\t\t<div v-if=\"currentStep.hasTreePreview\" class=\"chart-wizard__tree_container\">\n\t\t\t\t\t\t<TreePreview\n\t\t\t\t\t\t\t:parentId=\"departmentData.parentId\"\n\t\t\t\t\t\t\t:name=\"departmentData.name\"\n\t\t\t\t\t\t\t:heads=\"departmentData.heads\"\n\t\t\t\t\t\t\t:userCount=\"departmentData.userCount\"\n\t\t\t\t\t\t\t:entityType=\"departmentData.entityType\"\n\t\t\t\t\t\t\t:teamColor=\"departmentData.teamColor\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__footer\">\n\t\t\t\t\t<button\n\t\t\t\t\t\tv-if=\"stepIndex > 0\"\n\t\t\t\t\t\tclass=\"ui-btn ui-btn-light chart-wizard__button --back\"\n\t\t\t\t\t\t@click=\"move('back')\"\n\t\t\t\t\t\tdata-test-id=\"hr-company-structure_chart-wizard__back-button\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span class=\"chart-wizard__back-button-text\">\n\t\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BACK_BTN') }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\tv-show=\"stepIndex < steps.length - 1\"\n\t\t\t\t\t\tclass=\"ui-btn ui-btn-primary ui-btn-round chart-wizard__button --next\"\n\t\t\t\t\t\t:class=\"{ \n\t\t\t\t\t\t\t'ui-btn-disabled': !isValidStep,\n\t\t\t\t\t\t\t'ui-btn-light-border': isEditMode,\n\t\t\t\t\t\t }\"\n\t\t\t\t\t\t@click=\"move()\"\n\t\t\t\t\t\tdata-test-id=\"hr-company-structure_chart-wizard__next-button\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_NEXT_BTN') }}\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\tv-show=\"!isEditMode && stepIndex === steps.length - 1\"\n\t\t\t\t\t\tclass=\"ui-btn ui-btn-primary ui-btn-round chart-wizard__button\"\n\t\t\t\t\t\t:class=\"{ 'ui-btn-wait': waiting }\"\n\t\t\t\t\t\t@click=\"create\"\n\t\t\t\t\t\tdata-test-id=\"hr-company-structure_chart-wizard__create-button\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ createButtonText }}\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\tv-show=\"isEditMode\"\n\t\t\t\t\t\tclass=\"ui-btn ui-btn-primary ui-btn-round chart-wizard__button --save\"\n\t\t\t\t\t\t:class=\"{ 'ui-btn-wait': waiting, 'ui-btn-disabled': !isValidStep, }\"\n\t\t\t\t\t\t@click=\"save\"\n\t\t\t\t\t\tdata-test-id=\"hr-company-structure_chart-wizard__save-button\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_SAVE_BTN') }}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"chart-wizard__overlay\"></div>\n\t\t</div>\n\t`,\n};\n"],"names":["SaveMode","Object","freeze","moveUsers","addUsers","StepIds","entities","department","employees","bindChat","teamRights","AuthorityTypes","departmentHead","departmentDeputy","teamHead","teamDeputy","HeadUsers","name","components","UserListActionMenu","props","users","type","Array","required","showPlaceholder","Boolean","default","isTeamEntity","isExistingDepartment","userType","String","teamColor","data","headsVisible","created","userTypes","head","deputy","computed","headItemsCount","defaultAvatar","placeholderAvatar","avatarImage","dropdownItems","map","user","workPosition","loc","titleBar","isDeputy","methods","phraseCode","replacements","$Bitrix","Loc","getMessage","template","TreeNode","heads","userCount","Number","nodeId","entityType","EntityTypes","isShowLoader","memberRoles","getMemberRoles","departmentData","watch","newValue","$nextTick","loaderContainer","$refs","loader","Loader","size","show","isHeadsLoaded","loadHeads","departments","get","employeesCount","length","headUsers","filter","role","deputyUsers","deputyHead","showInfo","PermissionChecker","getInstance","hasPermission","PermissionActions","structureView","departmentId","team","dataTestIdSuffix","mapState","useChartStore","locPlural","count","getMessagePlural","departmentIds","store","formatDataTestId","prefix","TreePreview","parentId","rootId","parentNode","companyName","values","find","TeamColorPicker","BasePopup","modelValue","bindElement","HTMLElement","emits","popupConfig","popupWidth","pickerWidth","initialPopupOffset","angleWidth","width","height","borderRadius","contentNoPaddings","contentPadding","padding","offsetTop","offsetLeft","angleOffset","nodeColorsSettingsDict","NodeColorsSettingsDict","close","$emit","Department","description","shouldErrorHighlight","isEditMode","refToFocus","deniedError","showColorPicker","teamColorValue","locked","recreateTagSelector","selectedParentDepartment","departmentName","departmentDescription","departmentSelectorCashe","MemoryCache","departmentsSelector","getOrCreateTagSelector","mounted","renderTo","activated","isDepartmentDataChanged","isValid","trim","focus","title","innerHTML","createTagSelector","isTagSelectorLocked","preselectedItems","permissionChecker","permissionAction","teamCreate","departmentCreate","isTabEmpty","tab","getRootNode","getChildren","selector","TagSelector","events","onTagAdd","event","tag","id","onTagRemove","applyData","multiple","dialogOptions","dropdownMode","hideOnDeselect","options","selectMode","restricted","includedNodeEntityTypes","includedNodeEntityTypesInDialog","useMultipleTabs","onLoad","dialog","getDialog","getTabs","forEach","setVisible","target","selectedItem","selectedItems","next","value","lock","nodes","items","node","select","onLoadError","item","isTeamItem","permissionCreateAction","permissionEditAction","teamEdit","departmentEdit","key","remember","apiEntityChanged","WizardApiEntityChangedDict","parent","namePlaceholder","descriptionPlaceholder","higherLevelDepartmentContainer","showLockedSelectorErrorText","selectorErrorText","MenuOption","ChangeSaveModeControl","RouteActionMenu","menuItems","getMenuItems","menuVisible","actionId","onActionMenuItemClick","bIcon","Main","PERSON_ARROW_LEFT_1","color","getColorCode","CRM","PERSON_PLUS_2","getControlButtonText","Employees","employeesIds","selectedUsers","Set","departmentHeads","departmentEmployees","removedUsers","headSelector","getUserSelector","memberRolesKeys","deputySelector","employeesSelector","employee","initialUsers","reduce","set","add","prevMemberRoles","rolesKeys","keys","roleKey","handler","payload","preselectedEmployees","employeeId","setPreselectedItems","load","getPreselectedItems","getData","onSelectorToggle","has","delete","popupOptions","onBeforeShow","setHeight","isLoaded","toggleUsers","onShow","container","getContainer","top","getBoundingClientRect","offset","offsetHeight","document","body","margin","setLink","intranetUsersOnly","inviteEmployeeLink","getItems","hidden","setHidden","getItem","userData","getUserDataBySelectorItem","isEmployee","rendered","parsedPreselected","flat","includes","handleSaveModeChangedChanged","employeeTitle","DEFAULT_TAG_ID","ChatSelector","DefaultHint","BIcon","headsCreated","initChats","createDefault","isChannel","ChatTypeDict","channel","IconSet","hintText","createText","removeText","warningText","entityId","deselect","chatItem","setTitle","chat","initialChatsSet","preselectedChats","chats","getSelector","addChatTag","searchable","existingChat","dialogId","hasAccess","setDeselectable","push","replace","entity","getChannelDialogEntity","getChatDialogEntity","intId","enableSearch","recentTabOptions","getChatRecentTabOptions","getDefaultItem","tagOptions","itemOptions","getTestId","blueprint","BindChat","initChannels","chatHintText","channelHintText","some","hints","channels","createDefaultChat","createDefaultChannel","bindChats","onChatSelectorChanged","Entities","ResponsiveHint","selectedEntityType","hint","hintHideTimeout","hasTeamCreatePermission","hasPermissionOfAction","hasDepartmentCreatePermission","isEnabled","isSoon","isTeamsAvailable","company","deactivated","hide","clearTimeout","showHint","text","$event","Reflection","getClass","createInstance","popupParameters","bindOptions","position","angle","setTimeout","TeamRights","settings","initBpValues","businessProcSelector","getTagSelector","NodeSettingsTypes","businessProcAuthority","reportsSelector","reportsAuthority","businessProcPreselected","getTagItems","businessProcPreselectedItem","settingType","tagFontWeight","showAddButton","getCustomData","preventDefault","showAvatars","undeselectedItems","lockedTagOptions","bgColor","textColor","departmentTagOptions","teamTagOptions","soonItemOptions","customData","selectable","badges","badgesOptions","justifyContent","tabs","goToBPHelp","BX","Helper","businessDescription","Text","encode","reportsDescriptions","AccessDenied","WizardAPI","addDepartment","colorName","postData","getEmployees","updateDepartment","saveUsers","userIds","saveChats","ids","removeIds","createSettings","updateSettings","getSettings","getChatsAndChannels","chartWizardActions","createDepartment","children","moveUsersToRootDepartment","userMovedToRootIds","rootEmployees","rootNode","refreshDepartments","tryToAddCurrentDepartment","isCurrentUserAdd","userId","changeCurrentDepartment","ChartWizard","showEntitySelector","source","stepIndex","waiting","isValidStep","blue","departmentSettings","steps","saveMode","init","beforeUnmount","Event","unbind","window","handleBeforeUnload","breadcrumbsTitle","closeConfirmTitle","currentStep","componentInfo","isPermitted","params","isFirstStep","breadcrumbsSteps","step","hasBreadcrumbs","createButtonText","bind","createSteps","indexOf","getStepById","createDefaultSaveMode","rawSettings","acc","settingsType","settingsValue","hasOwn","rawChatsAndChannels","originalNodeId","analyticsSendData","tool","category","c_element","move","buttonId","pickStepsAnalytics","moveToStep","stepId","force","findIndex","isEditPermitted","index","sendEvent","closeWithConfirm","confirmPopup","MessageBox","message","yesCaption","noCaption","onYes","minHeight","buttons","MessageBoxButtons","YES_NO","closeIcon","className","getYesButton","setRound","getNoButton","onApplyData","prevEntityType","getAllSteps","hasTreePreview","dataTestIdPart","breadcrumbsTitleDepartment","breadcrumbsTitleTeam","teamAddMember","employeeAddToDepartment","teamCommunicationEdit","departmentCommunicationEdit","teamSettingsEdit","assign","getUsersPromise","calculateEmployeeIds","headsIds","deputiesIds","departmentUserIds","getUserMemberPromise","hasUsers","Promise","resolve","create","accessCode","newDepartment","updatedDepartmentIds","error","reportedErrorTypes","code","UI","Notification","Center","notify","content","autoHideDelay","showConfetti","p2","p3","p4","save","currentNode","targetNodeId","usersPromise","departmentPromise","settingsPromise","pickEditAnalytics","usersResponse","all","chatId","channelId","chatsDetailed","channelsDetailed","e","console","handleSaveModeChanged","p1"],"mappings":"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"}