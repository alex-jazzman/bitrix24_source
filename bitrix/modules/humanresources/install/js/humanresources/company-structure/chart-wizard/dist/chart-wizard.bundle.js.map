{"version":3,"file":"chart-wizard.bundle.js","sources":["../src/consts.js","../src/components/tree-preview/head-users.js","../src/components/tree-preview/tree-node.js","../src/components/tree-preview/tree-preview.js","../src/components/team-color-picker/team-color-picker.js","../src/components/steps/department.js","../src/components/change-save-mode-control/change-save-mode-control.js","../src/components/steps/employees.js","../src/components/communication-selector/selector-dictionary.js","../src/components/communication-selector/dictionaries/channel-selector-dictionary.js","../src/components/communication-selector/dictionaries/chat-selector-dictionary.js","../src/components/communication-selector/dictionaries/collab-selector-dictionary.js","../src/components/communication-selector/dictionaries/selector-dictionary-factory.js","../src/components/communication-selector/communication-selector.js","../src/components/steps/bind-chat.js","../src/components/steps/entities.js","../src/components/steps/settings.js","../src/components/steps/access-denied.js","../src/api.js","../src/actions.js","../src/components/wizard.js"],"sourcesContent":["import type { StepIdType } from './types';\n\nexport const SaveMode: Record<string> = Object.freeze({\n\tmoveUsers: 'moveUsers',\n\taddUsers: 'addUsers',\n});\n\nexport const StepIds: Record<StepIdType, StepIdType> = Object.freeze({\n\tentities: 'entities',\n\tdepartment: 'department',\n\temployees: 'employees',\n\tbindChat: 'bindChat',\n\tsettings: 'settings',\n});\n\nexport const AuthorityTypes: Record<string> = {\n\tdepartmentHead: 'HEAD',\n\tdepartmentDeputy: 'DEPUTY_HEAD',\n\tteamHead: 'TEAM_HEAD',\n\tteamDeputy: 'TEAM_DEPUTY',\n};\n","import { UserListActionMenu } from 'humanresources.company-structure.structure-components';\nimport type { UserData } from 'humanresources.company-structure.utils';\n\nexport const HeadUsers = {\n\tname: 'headUsers',\n\n\tcomponents: {\n\t\tUserListActionMenu,\n\t},\n\n\tprops: {\n\t\tusers: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tshowPlaceholder: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t\tisTeamEntity: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tisExistingDepartment: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t\tuserType: {\n\t\t\ttype: String,\n\t\t\tdefault: 'head',\n\t\t},\n\t\tteamColor: {\n\t\t\ttype: [Object, null],\n\t\t\tdefault: null,\n\t\t},\n\t},\n\n\tdata(): { headsVisible: boolean; }\n\t{\n\t\treturn {\n\t\t\theadsVisible: false,\n\t\t};\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.userTypes = {\n\t\t\thead: 'head',\n\t\t\tdeputy: 'deputy',\n\t\t};\n\t},\n\n\tcomputed:\n\t{\n\t\theadItemsCount(): number\n\t\t{\n\t\t\treturn this.isExistingDepartment ? 1 : 2;\n\t\t},\n\t\tdefaultAvatar(): string\n\t\t{\n\t\t\treturn '/bitrix/js/humanresources/company-structure/org-chart/src/images/default-user.svg';\n\t\t},\n\t\tplaceholderAvatar(): string\n\t\t{\n\t\t\tif (!this.isTeamEntity || !this.teamColor)\n\t\t\t{\n\t\t\t\treturn '/bitrix/js/humanresources/company-structure/chart-wizard/src/components/tree-preview/images/placeholder-avatar.svg';\n\t\t\t}\n\n\t\t\treturn `/bitrix/js/humanresources/company-structure/chart-wizard/src/components/tree-preview/images/${this.teamColor.avatarImage}`;\n\t\t},\n\t\tdropdownItems(): Array<UserData>\n\t\t{\n\t\t\treturn this.users.map((user: UserData): UserData => {\n\t\t\t\tconst workPosition = user.workPosition || this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_HEAD_POSITION');\n\n\t\t\t\treturn { ...user, workPosition };\n\t\t\t});\n\t\t},\n\t\ttitleBar(): string\n\t\t{\n\t\t\treturn this.userType === this.userTypes.deputy\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_DEPUTY_TITLE')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_HEAD_TITLE')\n\t\t\t;\n\t\t},\n\t\tisDeputy(): boolean\n\t\t{\n\t\t\treturn this.userType === this.userTypes.deputy;\n\t\t},\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"chart-wizard-tree-preview__node_head\"\n\t\t\t:class=\"{ '--deputy': isDeputy }\"\n\t\t\tv-for=\"(user, index) in users.slice(0, headItemsCount)\"\n\t\t>\n\t\t\t<img\n\t\t\t\t:src=\"user.avatar || defaultAvatar\"\n\t\t\t\tclass=\"chart-wizard-tree-preview__node_head-avatar --placeholder\"\n\t\t\t\t:class=\"{ '--deputy': isDeputy, '--old': isExistingDepartment }\"\n\t\t\t/>\n\t\t\t<div class=\"chart-wizard-tree-preview__node_head-text\" :class=\"{'--deputy': isDeputy }\">\n\t\t\t\t<span\n\t\t\t\t\tclass=\"chart-wizard-tree-preview__node_head-name --crop\"\n\t\t\t\t\t:class=\"{'--old': isExistingDepartment }\"\n\t\t\t\t>\n\t\t\t\t\t{{ user.name }}\n\t\t\t\t</span>\n\t\t\t\t<span\n\t\t\t\t\tv-if=\"!isDeputy\"\n\t\t\t\t\tclass=\"chart-wizard-tree-preview__node_head-position --crop\"\n\t\t\t\t\t:class=\"{'--old': isExistingDepartment }\"\n\t\t\t\t>\n\t\t\t\t\t{{ user.workPosition || loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_HEAD_POSITION') }}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<span\n\t\t\t\tv-if=\"index === headItemsCount - 1 && users.length > headItemsCount\"\n\t\t\t\tclass=\"chart-wizard-tree-preview__node_head-rest\"\n\t\t\t\t:class=\"{ '--active': headsVisible }\"\n\t\t\t\tref=\"showMoreHeadUserWizardList\"\n\t\t\t\t:data-test-id=\"'hr-company-structure_chart-wizard-tree__preview-' + userType + '-rest'\"\n\t\t\t\t@click.stop=\"headsVisible = true\"\n\t\t\t>\n\t\t\t\t\t{{ '+' + String(users.length - headItemsCount) }}\n\t\t\t</span>\n\t\t</div>\n\t\t<div\n\t\t\tv-if=\"users.length === 0 && showPlaceholder\"\n\t\t\tclass=\"chart-wizard-tree-preview__node_head\"\n\t\t\t:class=\"{ '--deputy': isDeputy }\"\n\t\t>\n\t\t\t<img\n\t\t\t\t:src=\"placeholderAvatar\"\n\t\t\t\tclass=\"chart-wizard-tree-preview__node_head-avatar --placeholder\"\n\t\t\t\t:class=\"{'--deputy': isDeputy, '--old': isExistingDepartment  }\"\n\t\t\t/>\n\t\t\t<div class=\"chart-wizard-tree-preview__node_head-text\">\n\t\t\t\t<span\n\t\t\t\t\tclass=\"chart-wizard-tree-preview__placeholder_name\"\n\t\t\t\t\t:class=\"{'--deputy': isDeputy, '--team': isTeamEntity }\"\n\t\t\t\t\t:style=\"{ 'background-color': teamColor ? teamColor.namePlaceholder : false }\"\n\t\t\t\t></span>\n\t\t\t\t<span\n\t\t\t\t\tv-if=\"!isDeputy\"\n\t\t\t\t\tclass=\"chart-wizard-tree-preview__node_head-position --crop\"\n\t\t\t\t>\n\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_HEAD_POSITION') }}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<UserListActionMenu\n\t\t\tv-if=\"headsVisible\"\n\t\t\t:id=\"isDeputy ? 'wizard-head-list-popup-deputy' : 'wizard-head-list-popup-head' \"\n\t\t\t:items=\"dropdownItems\"\n\t\t\t:width=\"228\"\n\t\t\t:bindElement=\"$refs.showMoreHeadUserWizardList[0]\"\n\t\t\t@close=\"headsVisible = false\"\n\t\t\t:titleBar=\"titleBar\"\n\t\t/>\n\t`,\n};\n","import { mapState } from 'ui.vue3.pinia';\nimport { Loader } from 'main.loader';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { Loc } from 'main.core';\nimport { getMemberRoles } from 'humanresources.company-structure.api';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\nimport { HeadUsers } from './head-users';\nimport { PermissionActions, PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport type { DepartmentData } from '../../types';\n\nexport const TreeNode = {\n\tname: 'treeNode',\n\n\tcomponents: { HeadUsers },\n\n\tprops: {\n\t\tname: String,\n\t\theads: Array,\n\t\tuserCount: Number,\n\t\tnodeId: Number,\n\t\tentityType: {\n\t\t\ttype: String,\n\t\t\tdefault: EntityTypes.department,\n\t\t},\n\t\t/** @type NodeColorSettingsType | null */\n\t\tteamColor: {\n\t\t\ttype: [Object, null],\n\t\t\tdefault: null,\n\t\t},\n\t},\n\n\tdata(): { isShowLoader: boolean; }\n\t{\n\t\treturn { isShowLoader: false };\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.memberRoles = getMemberRoles(this.departmentData.entityType);\n\t},\n\n\twatch:\n\t{\n\t\tisShowLoader(newValue: boolean): void\n\t\t{\n\t\t\tif (!newValue)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tconst { loaderContainer } = this.$refs;\n\t\t\t\tconst loader = new Loader({ size: 30 });\n\t\t\t\tloader.show(loaderContainer);\n\t\t\t});\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tdepartmentData(): DepartmentData | { name: string, ...Partial<DepartmentData> }\n\t\t{\n\t\t\tif (this.isExistingDepartment)\n\t\t\t{\n\t\t\t\tif (!this.isHeadsLoaded)\n\t\t\t\t{\n\t\t\t\t\tthis.loadHeads([this.nodeId]);\n\t\t\t\t}\n\n\t\t\t\treturn this.departments.get(this.nodeId);\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tname: this.name,\n\t\t\t\theads: this.heads,\n\t\t\t\tuserCount: this.userCount,\n\t\t\t\tentityType: this.entityType,\n\t\t\t};\n\t\t},\n\t\tisExistingDepartment(): boolean\n\t\t{\n\t\t\treturn Boolean(this.nodeId);\n\t\t},\n\t\temployeesCount(): number\n\t\t{\n\t\t\treturn (this.userCount || 0) - (this.heads?.length || 0);\n\t\t},\n\t\theadUsers(): ?Array<DepartmentData['heads']>\n\t\t{\n\t\t\treturn this.departmentData.heads?.filter((head) => {\n\t\t\t\treturn head.role === this.memberRoles.head;\n\t\t\t});\n\t\t},\n\t\tdeputyUsers(): ?Array<DepartmentData['heads']>\n\t\t{\n\t\t\treturn this.departmentData.heads?.filter((head) => {\n\t\t\t\treturn head.role === this.memberRoles.deputyHead;\n\t\t\t});\n\t\t},\n\t\tshowInfo(): boolean\n\t\t{\n\t\t\treturn this.nodeId\n\t\t\t\t? PermissionChecker.getInstance().hasPermission(PermissionActions.structureView, this.nodeId)\n\t\t\t\t: true;\n\t\t},\n\t\tisHeadsLoaded(departmentId: number): boolean\n\t\t{\n\t\t\tconst { heads } = this.departments.get(this.nodeId);\n\n\t\t\treturn Boolean(heads);\n\t\t},\n\t\tisTeamEntity(): boolean\n\t\t{\n\t\t\treturn this.departmentData.entityType === EntityTypes.team;\n\t\t},\n\t\tdataTestIdSuffix(): string\n\t\t{\n\t\t\treturn this.isExistingDepartment ? '' : '_new';\n\t\t},\n\t\t...mapState(useChartStore, ['departments']),\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tlocPlural(phraseCode: string, count: number): string\n\t\t{\n\t\t\treturn Loc.getMessagePlural(phraseCode, count, { '#COUNT#': count });\n\t\t},\n\t\tasync loadHeads(departmentIds: number[]): Promise<void>\n\t\t{\n\t\t\tconst store = useChartStore();\n\t\t\ttry\n\t\t\t{\n\t\t\t\tthis.isShowLoader = true;\n\t\t\t\tawait store.loadHeads(departmentIds);\n\t\t\t}\n\t\t\tfinally\n\t\t\t{\n\t\t\t\tthis.isShowLoader = false;\n\t\t\t}\n\t\t},\n\t\tformatDataTestId(prefix: string): string\n\t\t{\n\t\t\treturn prefix + this.dataTestIdSuffix;\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"chart-wizard-tree-preview__node\"\n\t\t\t:class=\"{ '--new': !isExistingDepartment, '--old': isExistingDepartment,'--team': isTeamEntity }\"\n\t\t>\n\t\t\t<div \n\t\t\t\tclass=\"chart-wizard-tree-preview__node_summary\" \n\t\t\t\t:class=\"{ '--old': isExistingDepartment, '--team': isTeamEntity }\"\n\t\t\t\t:style=\"{ '--team-border-color': teamColor?.previewBorder }\"\n\t\t\t>\n\t\t\t\t<div \n\t\t\t\t\tclass=\"chart-wizard-tree-preview__node_name --crop\"\n\t\t\t\t\t:data-test-id=\"formatDataTestId('chart-wizard-tree-preview__node_name')\"\n\t\t\t\t\t:style=\"{ 'background-color': teamColor ? teamColor.headBackground : false }\"\n\t\t\t\t>\n\t\t\t\t\t<span\n\t\t\t\t\t\tv-if=\"!departmentData.name\" \n\t\t\t\t\t\tclass=\"chart-wizard-tree-preview__placeholder_node_name\"\n\t\t\t\t\t\t:class=\"{ '--team': isTeamEntity }\"\n\t\t\t\t\t\t:style=\"{ 'background-color': teamColor ? teamColor.namePlaceholder : false }\"\n\t\t\t\t\t></span>\n\t\t\t\t\t{{departmentData.name}}\n\t\t\t\t</div>\n\t\t\t\t<div \n\t\t\t\t\tclass=\"chart-wizard-tree-preview__node_content\"\n\t\t\t\t\t:data-test-id=\"formatDataTestId('chart-wizard-tree-preview__head_list')\"\n\t\t\t\t>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"chart-wizard-tree-preview__head_list\"\n\t\t\t\t\t\t:data-test-id=\"formatDataTestId('chart-wizard-tree-preview__head_list')\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<HeadUsers\n\t\t\t\t\t\t\tv-if=\"showInfo && headUsers\"\n\t\t\t\t\t\t\t:users=\"headUsers\"\n\t\t\t\t\t\t\t:showPlaceholder=\"!isExistingDepartment\"\n\t\t\t\t\t\t\t:isTeamEntity=\"isTeamEntity\"\n\t\t\t\t\t\t\t:isExistingDepartment=\"isExistingDepartment\"\n\t\t\t\t\t\t\t:teamColor=\"teamColor\"\n\t\t\t\t\t\t/> \n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if=\"isShowLoader\" ref=\"loaderContainer\"></div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"showInfo && !isExistingDepartment\"\n\t\t\t\t\t\tclass=\"chart-wizard-tree-preview__node_employees\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"chart-wizard-tree-preview__node_employees-list\"\n\t\t\t\t\t\t\t:data-test-id=\"formatDataTestId('chart-wizard-tree-preview__node_employees-list')\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<p class=\"chart-wizard-tree-preview__node_employees-title\">\n\t\t\t\t\t\t\t\t{{\n\t\t\t\t\t\t\t\t\tisTeamEntity \n\t\t\t\t\t\t\t\t\t\t? loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TREE_PREVIEW_TEAM_EMPLOYEES_TITLE') \n\t\t\t\t\t\t\t\t\t\t: loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TREE_PREVIEW_EMPLOYEES_TITLE')\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<span class=\"chart-wizard-tree-preview__node_employees_count\">\n\t\t\t\t\t\t\t\t{{ locPlural('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TREE_PREVIEW_EMPLOYEES_COUNT', employeesCount) }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div \n\t\t\t\t\t\t\tclass=\"chart-wizard-tree-preview__node_deputies\"\n\t\t\t\t\t\t\t:data-test-id=\"formatDataTestId('chart-wizard-tree-preview__node_deputies-list')\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<p class=\"chart-wizard-tree-preview__node_employees-title\">\n\t\t\t\t\t\t\t\t{{\n\t\t\t\t\t\t\t\t\tisTeamEntity\n\t\t\t\t\t\t\t\t\t\t? loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TREE_PREVIEW_TEAM_DEPUTIES_TITLE') \n\t\t\t\t\t\t\t\t\t\t: loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TREE_PREVIEW_DEPUTIES_TITLE') \n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<HeadUsers\n\t\t\t\t\t\t\t\t:users=\"deputyUsers\"\n\t\t\t\t\t\t\t\t:isTeamEntity=\"isTeamEntity\"\n\t\t\t\t\t\t\t\t:isExistingDepartment=\"isExistingDepartment\"\n\t\t\t\t\t\t\t\tuserType=\"deputy\"\n\t\t\t\t\t\t\t\t:teamColor=\"teamColor\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<slot v-if=\"isExistingDepartment\"></slot>\n\t\t</div>\n\t`,\n};\n","import { mapState } from 'ui.vue3.pinia';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { TreeNode } from './tree-node';\nimport { EntityTypes, type NodeColorSettingsType } from 'humanresources.company-structure.utils';\nimport './style.css';\n\nexport const TreePreview = {\n\tname: 'treePreview',\n\n\tcomponents: { TreeNode },\n\n\tprops: {\n\t\tparentId: {\n\t\t\ttype: [Number, null],\n\t\t\trequired: true,\n\t\t},\n\t\tname: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\theads: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tuserCount: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tentityType: {\n\t\t\ttype: String,\n\t\t\tdefault: EntityTypes.department,\n\t\t},\n\t\t/** @type NodeColorSettingsType | null */\n\t\tteamColor: {\n\t\t\ttype: [Object, null],\n\t\t\tdefault: null,\n\t\t},\n\t},\n\n\tcomputed:\n\t{\n\t\trootId(): number\n\t\t{\n\t\t\tconst parentNode = this.departments.get(this.parentId);\n\t\t\tif (parentNode)\n\t\t\t{\n\t\t\t\treturn parentNode.parentId ?? 0;\n\t\t\t}\n\n\t\t\treturn 0;\n\t\t},\n\t\tcompanyName(): string\n\t\t{\n\t\t\tconst { name } = [...this.departments.values()].find((department) => {\n\t\t\t\treturn department.parentId === 0;\n\t\t\t});\n\n\t\t\treturn name;\n\t\t},\n\t\tisTeamEntity(): boolean\n\t\t{\n\t\t\treturn this.entityType === EntityTypes.team;\n\t\t},\n\t\t...mapState(useChartStore, ['departments']),\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"chart-wizard-tree-preview\">\n\t\t\t<div class=\"chart-wizard-tree-preview__header\">\n\t\t\t\t<span class=\"chart-wizard-tree-preview__header_text\">\n\t\t\t\t\t{{\n\t\t\t\t\t\tisTeamEntity\n\t\t\t\t\t\t\t? loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TREE_PREVIEW_TEAM_TITLE')\n\t\t\t\t\t\t\t: loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TREE_PREVIEW_DEPARTMENT_TITLE')\n\t\t\t\t\t}}\n\t\t\t\t</span>\n\t\t\t\t<span class=\"chart-wizard-tree-preview__header_name\">\n\t\t\t\t\t{{ companyName }}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<TreeNode\n\t\t\t\tv-if=\"rootId\"\n\t\t\t\t:nodeId=\"rootId\"\n\t\t\t>\n\t\t\t\t<TreeNode :nodeId=\"parentId\">\n\t\t\t\t\t<TreeNode\n\t\t\t\t\t\t:name=\"name\"\n\t\t\t\t\t\t:heads=\"heads\"\n\t\t\t\t\t\t:userCount=\"userCount\"\n\t\t\t\t\t\t:entityType=\"entityType\"\n\t\t\t\t\t\t:teamColor=\"teamColor\"\n\t\t\t\t\t></TreeNode>\n\t\t\t\t</TreeNode>\n\t\t\t</TreeNode>\n\t\t\t<TreeNode\n\t\t\t\tv-else-if=\"parentId\"\n\t\t\t\t:nodeId=\"parentId\"\n\t\t\t>\n\t\t\t\t<TreeNode\n\t\t\t\t\t:name=\"name\"\n\t\t\t\t\t:heads=\"heads\"\n\t\t\t\t\t:userCount=\"userCount\"\n\t\t\t\t\t:entityType=\"entityType\"\n\t\t\t\t\t:teamColor=\"teamColor\"\n\t\t\t\t></TreeNode>\n\t\t\t</TreeNode>\n\t\t\t<TreeNode\n\t\t\t\tv-else\n\t\t\t\t:name=\"name\"\n\t\t\t\t:heads=\"heads\"\n\t\t\t\t:userCount=\"userCount\"\n\t\t\t\t:entityType=\"entityType\"\n\t\t\t\t:teamColor=\"teamColor\"\n\t\t\t></TreeNode>\n\t\t</div>\n\t`,\n};\n","import { BasePopup } from 'humanresources.company-structure.structure-components';\nimport type { PopupOptions } from 'main.popup';\nimport { NodeColorsSettingsDict } from 'humanresources.company-structure.utils';\n\n// @vue/component\nexport const TeamColorPicker = {\n\tname: 'TeamColorPicker',\n\n\tcomponents: {\n\t\tBasePopup,\n\t},\n\n\tprops: {\n\t\t/** @type NodeColorSettingsType */\n\t\tmodelValue: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tbindElement: {\n\t\t\ttype: HTMLElement,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\temits: ['action', 'close', 'update:modelValue'],\n\n\tcomputed:\n\t{\n\t\tpopupConfig(): PopupOptions\n\t\t{\n\t\t\tconst popupWidth = 164;\n\t\t\tconst pickerWidth = 41;\n\t\t\tconst initialPopupOffset = 39;\n\t\t\tconst angleWidth = 33;\n\n\t\t\treturn {\n\t\t\t\twidth: popupWidth,\n\t\t\t\theight: 116,\n\t\t\t\tbindElement: this.bindElement,\n\t\t\t\tborderRadius: 12,\n\t\t\t\tcontentNoPaddings: true,\n\t\t\t\tcontentPadding: 0,\n\t\t\t\tpadding: 0,\n\t\t\t\toffsetTop: 4,\n\t\t\t\toffsetLeft: pickerWidth / 2 - popupWidth / 2 + initialPopupOffset,\n\t\t\t\tangleOffset: popupWidth / 2 - angleWidth / 2,\n\t\t\t};\n\t\t},\n\t\tnodeColorsSettingsDict(): typeof NodeColorsSettingsDict => NodeColorsSettingsDict\n\t\t{\n\t\t\treturn NodeColorsSettingsDict;\n\t\t},\n\t},\n\n\tmethods:\n\t{\n\t\tclose(): void\n\t\t{\n\t\t\tthis.$emit('close');\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<BasePopup\n\t\t\t:config=\"popupConfig\"\n\t\t\t:id=\"'chart_wizard__department__color-picker_popup'\"\n\t\t\t@close=\"close\"\n\t\t>\n\t\t\t<div\n\t\t\t\tclass=\"chart_wizard__department__color-picker_popup-container\"\n\t\t\t\t:data-test-id=\"'wizard-department-color-picker-popup'\"\n\t\t\t>\n\t\t\t\t<div v-for=\"item in nodeColorsSettingsDict\" \n\t\t\t\t\t class=\"chart_wizard__department__color-picker_color-item\"\n\t\t\t\t\t :class=\" {'--active': item.name === modelValue.name }\"\n\t\t\t\t\t @click=\"$emit('update:modelValue', item)\"\n\t\t\t\t\t :data-test-id=\"'wizard-department-color-picker-item-'+item.name\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"chart_wizard__department__color-picker_color-item_inner\"\n\t\t\t\t\t\t :style=\"{ 'background-color': item.pickerColor }\"\n\t\t\t\t\t></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</BasePopup>\n\t`,\n};\n","import { mapState } from 'ui.vue3.pinia';\nimport { TeamColorPicker } from '../team-color-picker/team-color-picker';\nimport { PermissionActions, PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport { EntityTypes, WizardApiEntityChangedDict, type NodeColorSettingsType } from 'humanresources.company-structure.utils';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { type BaseEvent } from 'main.core.events';\nimport { TagSelector, type Item } from 'ui.entity-selector';\nimport { MemoryCache } from 'main.core.cache';\n\ntype DepartmentStepDataType = {\n\tdeniedError: boolean,\n\tshowColorPicker: boolean,\n\tteamColorValue: NodeColorSettingsType | null,\n}\n\n// @vue/component\nexport const Department = {\n\tname: 'department',\n\n\tcomponents: { TeamColorPicker },\n\n\tprops: {\n\t\tparentId: {\n\t\t\ttype: [Number, null],\n\t\t\trequired: true,\n\t\t},\n\t\tname: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tdescription: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tshouldErrorHighlight: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tisEditMode: {\n\t\t\ttype: Boolean,\n\t\t},\n\t\tentityType: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tteamColor: {\n\t\t\ttype: [Object, null],\n\t\t\tdefault: null,\n\t\t},\n\t\trefToFocus: {\n\t\t\ttype: String,\n\t\t\tdefault: null,\n\t\t},\n\t},\n\n\temits: ['applyData'],\n\n\tdata(): DepartmentStepDataType\n\t{\n\t\treturn {\n\t\t\tdeniedError: false,\n\t\t\tshowColorPicker: false,\n\t\t\tteamColorValue: this.teamColor,\n\t\t\tlocked: false,\n\t\t};\n\t},\n\n\twatch:\n\t{\n\t\tisTeamEntity(): void\n\t\t{\n\t\t\t// tag selector is not valid now\n\t\t\tthis.recreateTagSelector();\n\t\t},\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.selectedParentDepartment = this.parentId;\n\t\tthis.departmentName = this.name;\n\t\tthis.departmentDescription = this.description;\n\t\tthis.departmentSelectorCashe = new MemoryCache();\n\t\tthis.departmentsSelector = this.getOrCreateTagSelector();\n\t},\n\n\tmounted(): void\n\t{\n\t\tthis.departmentsSelector.renderTo(this.$refs['tag-selector']);\n\t},\n\n\tactivated(): void\n\t{\n\t\tthis.teamColorValue = this.teamColor;\n\t\tthis.$emit('applyData', {\n\t\t\tisDepartmentDataChanged: false,\n\t\t\tisValid:\n\t\t\t\tthis.departmentName\n\t\t\t\t&& this.departmentName?.trim() !== ''\n\t\t\t\t&& this.selectedParentDepartment !== null\n\t\t\t\t&& !this.deniedError\n\t\t\t,\n\t\t});\n\n\t\tif (this.refToFocus && this.$refs[this.refToFocus])\n\t\t{\n\t\t\tthis.$refs[this.refToFocus].focus();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.$refs.title.focus();\n\t\t}\n\t},\n\n\tmethods:\n\t{\n\t\trecreateTagSelector(): void\n\t\t{\n\t\t\tthis.$refs['tag-selector'].innerHTML = '';\n\t\t\tthis.departmentsSelector = this.getOrCreateTagSelector();\n\t\t\tthis.departmentsSelector.renderTo(this.$refs['tag-selector']);\n\t\t},\n\t\tcreateTagSelector(): TagSelector\n\t\t{\n\t\t\tthis.locked = this.isTagSelectorLocked();\n\t\t\tlet preselectedItems = this.parentId ? [['structure-node', this.parentId]] : [];\n\t\t\tif (!this.isEditMode)\n\t\t\t{\n\t\t\t\tconst permissionChecker = PermissionChecker.getInstance();\n\t\t\t\tconst permissionAction = this.isTeamEntity ? PermissionActions.teamCreate : PermissionActions.departmentCreate;\n\t\t\t\tif (\n\t\t\t\t\tpermissionChecker\n\t\t\t\t\t&& !permissionChecker.hasPermission(permissionAction, this.parentId)\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tpreselectedItems = [['structure-node', 0]];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst isTabEmpty = (tab) => tab.getRootNode().getChildren().count() === 0;\n\n\t\t\tconst selector = new TagSelector({\n\t\t\t\tevents: {\n\t\t\t\t\tonTagAdd: (event: BaseEvent) => {\n\t\t\t\t\t\tconst { tag } = event.data;\n\t\t\t\t\t\tthis.selectedParentDepartment = tag.id;\n\t\t\t\t\t},\n\t\t\t\t\tonTagRemove: () => {\n\t\t\t\t\t\tthis.selectedParentDepartment = null;\n\t\t\t\t\t\tthis.applyData();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tmultiple: false,\n\t\t\t\tlocked: this.locked,\n\t\t\t\tdialogOptions: {\n\t\t\t\t\twidth: 425,\n\t\t\t\t\theight: 350,\n\t\t\t\t\tdropdownMode: true,\n\t\t\t\t\thideOnDeselect: true,\n\t\t\t\t\tentities: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'structure-node',\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tselectMode: 'departmentsOnly',\n\t\t\t\t\t\t\t\trestricted: this.isEditMode ? 'update' : 'create',\n\t\t\t\t\t\t\t\tincludedNodeEntityTypes: this.includedNodeEntityTypesInDialog,\n\t\t\t\t\t\t\t\tuseMultipleTabs: true,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tpreselectedItems,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonLoad: (event) => {\n\t\t\t\t\t\t\tconst dialog = selector.getDialog();\n\n\t\t\t\t\t\t\tdialog.getTabs()\n\t\t\t\t\t\t\t\t.filter((tab) => isTabEmpty(tab))\n\t\t\t\t\t\t\t\t.forEach((tab) => tab.setVisible(false))\n\t\t\t\t\t\t\t;\n\n\t\t\t\t\t\t\tconst target = event.target;\n\t\t\t\t\t\t\tconst selectedItem = target.selectedItems?.values()?.next()?.value;\n\t\t\t\t\t\t\tif (this.isEditMode)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (selectedItem?.id === this.parentId && this.locked)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tselector.lock();\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst permissionChecker = PermissionChecker.getInstance();\n\t\t\t\t\t\t\tif (!permissionChecker)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst nodes = target.items.get('structure-node');\n\n\t\t\t\t\t\t\tconst permissionAction = this.isTeamEntity\n\t\t\t\t\t\t\t\t? PermissionActions.teamCreate\n\t\t\t\t\t\t\t\t: PermissionActions.departmentCreate\n\t\t\t\t\t\t\t;\n\n\t\t\t\t\t\t\tfor (const [, node] of nodes)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif \t(\n\t\t\t\t\t\t\t\t\tpermissionChecker.hasPermission(permissionAction, node.id)\n\t\t\t\t\t\t\t\t\t&& !permissionChecker.hasPermission(permissionAction, selectedItem?.id ?? 0)\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tnode.select();\n\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonLoadError: () => {\n\t\t\t\t\t\t\tthis.selectedParentDepartment = null;\n\t\t\t\t\t\t\tthis.applyData();\n\t\t\t\t\t\t},\n\t\t\t\t\t\t'Item:onSelect': (event: BaseEvent<{ item: Item }>) => {\n\t\t\t\t\t\t\tthis.deniedError = false;\n\n\t\t\t\t\t\t\tconst target = event.target;\n\t\t\t\t\t\t\tconst selectedItem = target.selectedItems?.values()?.next()?.value;\n\n\t\t\t\t\t\t\tconst permissionChecker = PermissionChecker.getInstance();\n\t\t\t\t\t\t\tif (!permissionChecker)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst item = this.departments.get(selectedItem.id);\n\t\t\t\t\t\t\tif (!item)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst isTeamItem = item?.entityType === EntityTypes.team;\n\n\t\t\t\t\t\t\tconst permissionCreateAction = this.isTeamEntity\n\t\t\t\t\t\t\t\t? PermissionActions.teamCreate\n\t\t\t\t\t\t\t\t: PermissionActions.departmentCreate\n\t\t\t\t\t\t\t;\n\n\t\t\t\t\t\t\tconst permissionEditAction = isTeamItem\n\t\t\t\t\t\t\t\t? PermissionActions.teamEdit\n\t\t\t\t\t\t\t\t: PermissionActions.departmentEdit\n\t\t\t\t\t\t\t;\n\n\t\t\t\t\t\t\tconst permissionAction = this.isEditMode\n\t\t\t\t\t\t\t\t? permissionEditAction\n\t\t\t\t\t\t\t\t: permissionCreateAction\n\t\t\t\t\t\t\t;\n\n\t\t\t\t\t\t\tif (!permissionChecker.hasPermission(permissionAction, selectedItem.id))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.deniedError = true;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.applyData();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\treturn selector;\n\t\t},\n\t\tgetOrCreateTagSelector(): TagSelector\n\t\t{\n\t\t\tconst key = String(this.isTeamEntity);\n\n\t\t\treturn this.departmentSelectorCashe.remember(key, () => this.createTagSelector());\n\t\t},\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tapplyData(): void\n\t\t{\n\t\t\tthis.$emit('applyData', {\n\t\t\t\tapiEntityChanged: WizardApiEntityChangedDict.department,\n\t\t\t\tname: this.departmentName,\n\t\t\t\tdescription: this.departmentDescription,\n\t\t\t\tparentId: this.selectedParentDepartment,\n\t\t\t\tteamColor: this.teamColorValue,\n\t\t\t\tisDepartmentDataChanged: true,\n\t\t\t\tisValid:\n\t\t\t\t\tthis.departmentName\n\t\t\t\t\t&& this.departmentName?.trim() !== ''\n\t\t\t\t\t&& this.selectedParentDepartment !== null\n\t\t\t\t\t&& !this.deniedError\n\t\t\t\t,\n\t\t\t});\n\t\t},\n\t\tisTagSelectorLocked(): boolean\n\t\t{\n\t\t\tif (!this.isEditMode)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (this.parentId === 0)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tconst parent = this.departments.get(this.parentId);\n\t\t\tif (!parent)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst permissionChecker = PermissionChecker.getInstance();\n\t\t\tif (!permissionChecker)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (parent.entityType === EntityTypes.department)\n\t\t\t{\n\t\t\t\treturn !permissionChecker.hasPermission(PermissionActions.departmentEdit, parent.id);\n\t\t\t}\n\n\t\t\tif (parent.entityType === EntityTypes.team)\n\t\t\t{\n\t\t\t\treturn !permissionChecker.hasPermission(PermissionActions.teamEdit, parent.id);\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\t},\n\n\tcomputed:\n\t{\n\t\tincludedNodeEntityTypesInDialog(): string[]\n\t\t{\n\t\t\treturn this.isTeamEntity ? ['department', 'team'] : ['department'];\n\t\t},\n\t\tisTeamEntity(): boolean\n\t\t{\n\t\t\treturn this.entityType === EntityTypes.team;\n\t\t},\n\t\tnamePlaceholder(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_NAME_PLACEHOLDER_MSGVER_1')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_NAME_PLACEHOLDER');\n\t\t},\n\t\tdescriptionPlaceholder(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_DESCR_PLACEHOLDER')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_DESCR_PLACEHOLDER');\n\t\t},\n\t\thigherLevelDepartmentContainer(): string\n\t\t{\n\t\t\t// for team entity department tag selector should be placed after name and description\n\t\t\t// to presumably encourage user to fill in the description field\n\t\t\treturn this.isTeamEntity ? '.chart-wizard__department_higher_bottom' : '.chart-wizard__department_higher_top';\n\t\t},\n\t\tshowLockedSelectorErrorText(): boolean\n\t\t{\n\t\t\treturn this.locked && this.parentId !== 0;\n\t\t},\n\t\tselectorErrorText(): string\n\t\t{\n\t\t\tif (this.deniedError)\n\t\t\t{\n\t\t\t\treturn this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ADD_TO_DEPARTMENT_DENIED_MSG_VER_1');\n\t\t\t}\n\n\t\t\tif (this.locked && this.parentId !== 0)\n\t\t\t{\n\t\t\t\treturn this.isTeamEntity\n\t\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_PARENT_TEAM_ERROR')\n\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_PARENT_DEPARTMENT_ERROR')\n\t\t\t\t;\n\t\t\t}\n\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_PARENT_ERROR')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_PARENT_ERROR')\n\t\t\t;\n\t\t},\n\t\t...mapState(useChartStore, ['departments']),\n\t},\n\n\ttemplate: `\n\t\t<div class=\"chart-wizard__department\">\n\t\t\t<div class=\"chart-wizard__form\">\n\t\t\t\t<Teleport defer :to=\"higherLevelDepartmentContainer\">\n\t\t\t\t\t<span class=\"chart-wizard__department_item-label\">\n\t\t\t\t\t\t{{\n\t\t\t\t\t\t\tisTeamEntity\n\t\t\t\t\t\t\t\t? loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_HIGHER_WITH_TEAM_LABEL')\n\t\t\t\t\t\t\t\t: loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_HIGHER_LABEL')\n\t\t\t\t\t\t}}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div\n\t\t\t\t\t\t:class=\"{ 'ui-ctl-warning': deniedError || (selectedParentDepartment === null && shouldErrorHighlight) }\"\n\t\t\t\t\t\tref=\"tag-selector\"\n\t\t\t\t\t></div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"deniedError || (selectedParentDepartment === null && shouldErrorHighlight) || showLockedSelectorErrorText\"\n\t\t\t\t\t\tclass=\"chart-wizard__department_item-error\"\n\t\t\t\t\t\t:class=\"{'--wizard-warning-item':  locked && parentId !== 0}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"ui-icon-set --warning\"\n\t\t\t\t\t\t\t:style=\"locked && !deniedError ? { '--ui-icon-set__icon-size': '17px', '--ui-icon-set__icon-color': '#FFA900' } : {}\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<span class=\"chart-wizard__department_item-error-message\">\n\t\t\t\t\t\t\t{{ selectorErrorText }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</Teleport>\n\t\t\t\t<div\n\t\t\t\t\tv-show=\"!isTeamEntity\"\n\t\t\t\t\tclass=\"chart-wizard__department_item chart-wizard__department_higher_top\">\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__department_item\">\n\t\t\t\t\t<span class=\"chart-wizard__department_item-label\">\n\t\t\t\t\t\t{{\n\t\t\t\t\t\t\tisTeamEntity\n\t\t\t\t\t\t\t\t? loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_TEAM_NAME_LABEL')\n\t\t\t\t\t\t\t\t: loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_NAME_LABEL') \n\t\t\t\t\t\t}}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div class=\"chart-wizard__department_control-wrapper\">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"ui-ctl ui-ctl-textbox\"\n\t\t\t\t\t\t\t:class=\"{ 'ui-ctl-warning': shouldErrorHighlight && departmentName?.trim() === '' }\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tv-model=\"departmentName\"\n\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\tmaxlength=\"255\"\n\t\t\t\t\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\t\t\t\t\tref=\"title\"\n\t\t\t\t\t\t\t\t:placeholder=\"namePlaceholder\"\n\t\t\t\t\t\t\t\t@input=\"applyData()\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-if=\"isTeamEntity\" \n\t\t\t\t\t\t\t class=\"chart-wizard__department__color-picker\" \n\t\t\t\t\t\t\t @click=\"showColorPicker = true\"\n\t\t\t\t\t\t\t ref=\"TeamColorPicker\"\n\t\t\t\t\t\t\t :data-test-id=\"'wizard-department-color-picker'\"\n\t\t\t\t\t\t\t :class=\"{ '--active': showColorPicker }\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\"chart-wizard__department__color-picker_inner\"\n\t\t\t\t\t\t\t\t :style=\"{ 'background-color': teamColorValue?.pickerColor }\"\n\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"shouldErrorHighlight && departmentName?.trim() === ''\"\n\t\t\t\t\t\tclass=\"chart-wizard__department_item-error\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"ui-icon-set --warning\"></div>\n\t\t\t\t\t\t<span class=\"chart-wizard__department_item-error-message\">\n\t\t\t\t\t\t\t{{\n\t\t\t\t\t\t\t\tisTeamEntity\n\t\t\t\t\t\t\t\t\t? loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_NAME_ERROR')\n\t\t\t\t\t\t\t\t\t: loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_NAME_ERROR')\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__department_item\">\n\t\t\t\t\t<span class=\"chart-wizard__department_item-label\">\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_DESCR_LABEL') }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textarea ui-ctl-no-resize\">\n\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\tv-model=\"departmentDescription\"\n\t\t\t\t\t\t\tmaxlength=\"255\"\n\t\t\t\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\t\t\t\tref=\"description\"\n\t\t\t\t\t\t\t:placeholder=\"descriptionPlaceholder\"\n\t\t\t\t\t\t\t@change=\"applyData()\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t</textarea>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tv-show=\"isTeamEntity\"\n\t\t\t\t\tclass=\"chart-wizard__department_item chart-wizard__department_higher_bottom\"\n\t\t\t\t></div>\n\t\t\t</div>\n\t\t\t<TeamColorPicker\n\t\t\t\tv-if=\"showColorPicker\"\n\t\t\t\t:bindElement=\"$refs.TeamColorPicker\"\n\t\t\t\tv-model=\"teamColorValue\"\n\t\t\t\t@update:model-value=\"applyData()\"\n\t\t\t\t@close=\"showColorPicker = false\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { getColorCode } from 'humanresources.company-structure.utils';\nimport { RouteActionMenu } from 'humanresources.company-structure.structure-components';\nimport { CRM, Main } from 'ui.icon-set.api.core';\nimport './style.css';\nimport 'ui.icon-set.crm';\n\nconst MenuOption = Object.freeze({\n\tmoveUsers: 'moveUsers',\n\taddUsers: 'addUsers',\n});\n\nexport const ChangeSaveModeControl = {\n\tname: 'changeSaveModeControl',\n\temits: ['saveModeChanged'],\n\n\tcomponents: {\n\t\tRouteActionMenu,\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.menuItems = this.getMenuItems();\n\t},\n\n\tdata(): { menuVisible: boolean; actionId: MenuOption.moveUsers | MenuOption.addUsers }\n\t{\n\t\treturn {\n\t\t\tmenuVisible: false,\n\t\t\tactionId: MenuOption.moveUsers,\n\t\t};\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tonActionMenuItemClick(actionId: string): void\n\t\t{\n\t\t\tthis.actionId = actionId;\n\t\t\tthis.$emit('saveModeChanged', actionId);\n\t\t},\n\t\tgetMenuItems(): Array\n\t\t{\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\tid: MenuOption.moveUsers,\n\t\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_MOVE_USERS_TITLE'),\n\t\t\t\t\tdescription: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_MOVE_USERS_DESCRIPTION'),\n\t\t\t\t\tbIcon: {\n\t\t\t\t\t\tname: Main.PERSON_ARROW_LEFT_1,\n\t\t\t\t\t\tsize: 20,\n\t\t\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: MenuOption.addUsers,\n\t\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_ADD_USERS_TITLE'),\n\t\t\t\t\tdescription: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_ADD_USERS_DESCRIPTION'),\n\t\t\t\t\tbIcon: {\n\t\t\t\t\t\tname: CRM.PERSON_PLUS_2,\n\t\t\t\t\t\tsize: 20,\n\t\t\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t];\n\t\t},\n\t},\n\n\tcomputed: {\n\t\tgetControlButtonText(): string\n\t\t{\n\t\t\tconst phraseCode = this.actionId === MenuOption.moveUsers\n\t\t\t\t? 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_MOVE_USERS_TITLE'\n\t\t\t\t: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_ADD_USERS_TITLE';\n\n\t\t\treturn this.loc(phraseCode);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"chart-wizard__change-save-mode-control-container\"\n\t\t>\n\t\t\t<span>{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_CONTROL_TEXT') }}</span>\n\t\t\t<a\n\t\t\t\tclass=\"chart-wizard__change-save-mode-control-button\"\n\t\t\t\t:class=\"{ '--focused': menuVisible }\"\n\t\t\t\tref='changeSaveModeButton'\n\t\t\t\t@click=\"menuVisible = true\"\n\t\t\t>\n\t\t\t\t{{ getControlButtonText }}\n\t\t\t</a>\n\t\t</div>\n\t\t<RouteActionMenu\n\t\t\tv-if=\"menuVisible\"\n\t\t\t:id=\"'hr-wizard-save-mode-menu'\"\n\t\t\t:items=\"menuItems\"\n\t\t\t:width=\"302\"\n\t\t\t:bindElement=\"$refs.changeSaveModeButton\"\n\t\t\t@action=\"onActionMenuItemClick\"\n\t\t\t@close=\"menuVisible = false\"\n\t\t/>\n\t`,\n};\n","import { getMemberRoles, memberRolesKeys } from 'humanresources.company-structure.api';\nimport { MoveUserPopup } from 'humanresources.company-structure.structure-components';\nimport {\n\tEntityTypes,\n\tgetUserDataBySelectorItem,\n\tUserData,\n\tWizardApiEntityChangedDict,\n} from 'humanresources.company-structure.utils';\nimport { ChangeSaveModeControl } from '../change-save-mode-control/change-save-mode-control';\nimport { TagSelector, type ItemOptions } from 'ui.entity-selector';\n\nexport const Employees = {\n\tname: 'employees',\n\n\tcomponents: { ChangeSaveModeControl, MoveUserPopup },\n\n\temits: ['applyData', 'saveModeChanged'],\n\n\tprops: {\n\t\tentityId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\theads: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\temployeesIds: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tisEditMode: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tentityType: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tdata(): { showMoveUserPopup: boolean, movedUserData: ?UserData, movedUserRole: ?string }\n\t{\n\t\treturn {\n\t\t\tshowMoveUserPopup: false,\n\t\t\tmovedUserData: null,\n\t\t\tmovedUserRole: null,\n\t\t};\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.memberRoles = getMemberRoles(this.entityType);\n\t\tthis.selectedUsers = new Set();\n\t\tthis.departmentHeads = [];\n\t\tthis.departmentEmployees = [];\n\t\tthis.removedUsers = [];\n\t\tthis.headSelector = this.getUserSelector(memberRolesKeys.head);\n\t\tthis.deputySelector = this.getUserSelector(memberRolesKeys.deputyHead);\n\t\tthis.employeesSelector = this.getUserSelector(memberRolesKeys.employee);\n\t\tthis.moveUsersMap = {};\n\t\tthis.userCount = 0;\n\n\t\t// store initial users to control applyData method in tagSelector\n\t\tthis.initialUsers = this.heads.reduce((set, item) => set.add(item.id), new Set());\n\t\tthis.employeesIds.forEach((item) => this.initialUsers.add(item));\n\t},\n\n\tmounted(): void\n\t{\n\t\tthis.headSelector.renderTo(this.$refs['head-selector']);\n\t\tthis.deputySelector.renderTo(this.$refs['deputy-selector']);\n\t\tthis.employeesSelector.renderTo(this.$refs['employees-selector']);\n\t},\n\n\tactivated(): void\n\t{\n\t\tthis.$emit('applyData', {\n\t\t\tisDepartmentDataChanged: false,\n\t\t\tisValid: true,\n\t\t});\n\t},\n\n\twatch:\n\t{\n\t\tentityType(entityType: string): void\n\t\t{\n\t\t\tconst prevMemberRoles = this.memberRoles;\n\t\t\tconst rolesKeys = Object.keys(prevMemberRoles);\n\t\t\tthis.memberRoles = getMemberRoles(entityType);\n\n\t\t\tthis.departmentHeads = this.departmentHeads.map((item) => {\n\t\t\t\tconst roleKey = rolesKeys.find((key) => prevMemberRoles[key] === item.role);\n\n\t\t\t\treturn { ...item, role: this.memberRoles[roleKey] };\n\t\t\t});\n\n\t\t\tthis.departmentEmployees = this.departmentEmployees\n\t\t\t\t.map((item) => ({ ...item, role: this.memberRoles.employee }))\n\t\t\t;\n\t\t},\n\t\temployeesIds:\n\t\t{\n\t\t\thandler(payload: number[]): void\n\t\t\t{\n\t\t\t\tthis.employeesIds.forEach((item) => this.initialUsers.add(item));\n\t\t\t\tconst preselectedEmployees = payload.map((employeeId) => ['user', employeeId]);\n\t\t\t\tconst { dialog } = this.employeesSelector;\n\t\t\t\tdialog.setPreselectedItems(preselectedEmployees);\n\t\t\t\tdialog.load();\n\t\t\t},\n\t\t},\n\t},\n\n\tmethods:\n\t{\n\t\tgetPreselectedItems(role: string): Array<number>\n\t\t{\n\t\t\tif (this.memberRoles.employee === role)\n\t\t\t{\n\t\t\t\treturn this.employeesIds.map((employeeId) => ['user', employeeId]);\n\t\t\t}\n\n\t\t\treturn this.heads.filter((head) => head.role === role).map((head) => {\n\t\t\t\treturn ['user', head.id];\n\t\t\t});\n\t\t},\n\t\tgetUserSelector(roleKey: String): TagSelector\n\t\t{\n\t\t\tconst selector = new TagSelector({\n\t\t\t\tevents: {\n\t\t\t\t\tonTagAdd: (event: BaseEvent) => {\n\t\t\t\t\t\tconst { tag } = event.getData();\n\t\t\t\t\t\tthis.selectedUsers.add(tag.id);\n\t\t\t\t\t\tthis.onSelectorToggle(tag, this.memberRoles[roleKey]);\n\n\t\t\t\t\t\tif (this.initialUsers.has(tag.id))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.initialUsers.delete(tag.id);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.applyData();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tonTagRemove: (event: BaseEvent) => {\n\t\t\t\t\t\tconst { tag } = event.getData();\n\t\t\t\t\t\tthis.selectedUsers.delete(tag.id);\n\t\t\t\t\t\tthis.onSelectorToggle(tag, this.memberRoles[roleKey]);\n\t\t\t\t\t\tthis.applyData();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tmultiple: true,\n\t\t\t\tdialogOptions: {\n\t\t\t\t\tpreselectedItems: this.getPreselectedItems(this.memberRoles[roleKey]),\n\t\t\t\t\tpopupOptions: {\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tonBeforeShow: () => {\n\t\t\t\t\t\t\t\tdialog.setHeight(250);\n\t\t\t\t\t\t\t\tif (dialog.isLoaded())\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.toggleUsers(dialog);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonShow: () => {\n\t\t\t\t\t\t\tconst { dialog } = selector;\n\t\t\t\t\t\t\tconst container = dialog.getContainer();\n\t\t\t\t\t\t\tconst { top } = container.getBoundingClientRect();\n\t\t\t\t\t\t\tconst offset = top + container.offsetHeight - document.body.offsetHeight;\n\t\t\t\t\t\t\tif (offset > 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconst margin = 5;\n\t\t\t\t\t\t\t\tdialog.setHeight(container.offsetHeight - offset - margin);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonLoad: (event) => {\n\t\t\t\t\t\t\tthis.toggleUsers(dialog);\n\t\t\t\t\t\t\tconst users = event.target.items.get('user');\n\n\t\t\t\t\t\t\tusers.forEach((user) => {\n\t\t\t\t\t\t\t\tuser.setLink('');\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},\n\t\t\t\t\t\t'SearchTab:onLoad': () => {\n\t\t\t\t\t\t\tthis.toggleUsers(dialog);\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\theight: 250,\n\t\t\t\t\twidth: 380,\n\t\t\t\t\tentities: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'user',\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tintranetUsersOnly: true,\n\t\t\t\t\t\t\t\tinviteEmployeeLink: true,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tdropdownMode: true,\n\t\t\t\t\thideOnDeselect: false,\n\t\t\t\t},\n\t\t\t});\n\t\t\tconst dialog = selector.getDialog();\n\n\t\t\treturn selector;\n\t\t},\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\ttoggleUsers(dialog): void\n\t\t{\n\t\t\tconst items = dialog.getItems();\n\t\t\titems.forEach((item) => {\n\t\t\t\tconst hidden = this.selectedUsers.has(item.id)\n\t\t\t\t\t&& !dialog.selectedItems.has(item);\n\t\t\t\titem.setHidden(hidden);\n\t\t\t});\n\t\t},\n\t\tonSelectorToggle(tag: ItemOptions, role: string): void\n\t\t{\n\t\t\tconst item = tag.selector.dialog.getItem(['user', tag.id]);\n\t\t\tconst userData = getUserDataBySelectorItem(item, role);\n\n\t\t\tconst isEmployee = role === this.memberRoles.employee;\n\t\t\tif (!tag.rendered)\n\t\t\t{\n\t\t\t\tif (this.movedUserData?.id === userData.id)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.removedUsers = this.removedUsers.filter((user) => user.id !== userData.id);\n\t\t\t\tObject.keys(this.moveUsersMap).forEach((nodeId) => {\n\t\t\t\t\tthis.moveUsersMap[nodeId] = this.moveUsersMap[nodeId].filter((user) => user.id !== userData.id);\n\t\t\t\t});\n\n\t\t\t\tif (isEmployee)\n\t\t\t\t{\n\t\t\t\t\tthis.departmentEmployees = [...this.departmentEmployees, { ...userData }];\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.departmentHeads = [...this.departmentHeads, { ...userData }];\n\t\t\t\t}\n\n\t\t\t\tthis.userCount += 1;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.movedUserData = userData;\n\t\t\tthis.movedUserRole = role;\n\n\t\t\tif (!this.isTeamEntity && this.isUserPreselected(tag.selector, userData.id))\n\t\t\t{\n\t\t\t\tthis.showMoveUserPopup = true;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.handleMoveUserAction(null);\n\t\t\t}\n\t\t},\n\t\thandleMoveUserAction(newNodeId: ?number): void\n\t\t{\n\t\t\t// return user to selector if we try to move user to the same department/team\n\t\t\tif (newNodeId === this.entityId)\n\t\t\t{\n\t\t\t\tthis.handleAbortMove();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst selector = this.getSelectorByRole(this.movedUserRole);\n\n\t\t\tif (this.isUserPreselected(selector, this.movedUserData.id))\n\t\t\t{\n\t\t\t\tthis.removedUsers = [...this.removedUsers, { ...this.movedUserData, role: this.movedUserRole }];\n\t\t\t\tif (newNodeId)\n\t\t\t\t{\n\t\t\t\t\tthis.moveUsersMap[newNodeId] = this.moveUsersMap[newNodeId]\n\t\t\t\t\t\t? [...this.moveUsersMap[newNodeId], this.movedUserData]\n\t\t\t\t\t\t: [this.movedUserData]\n\t\t\t\t\t;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst isEmployee = this.movedUserRole === this.memberRoles.employee;\n\t\t\tif (isEmployee)\n\t\t\t{\n\t\t\t\tthis.departmentEmployees = this.departmentEmployees.filter((employee) => employee.id !== this.movedUserData.id);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.departmentHeads = this.departmentHeads.filter((head) => head.id !== this.movedUserData.id);\n\t\t\t}\n\n\t\t\tthis.userCount -= 1;\n\t\t\tthis.showMoveUserPopup = false;\n\t\t\tthis.movedUserData = null;\n\t\t\tthis.movedUserRole = null;\n\n\t\t\tthis.applyData();\n\t\t},\n\t\thandleAbortMove()\n\t\t{\n\t\t\tconst selector = this.getSelectorByRole(this.movedUserRole);\n\t\t\tconst tag = selector.getDialog().getItem({ id: this.movedUserData.id, entityId: 'user' });\n\t\t\ttag.select();\n\n\t\t\tthis.showMoveUserPopup = false;\n\t\t\tthis.movedUserData = null;\n\t\t\tthis.movedUserRole = null;\n\t\t},\n\t\tgetSelectorByRole(role: string): TagSelector\n\t\t{\n\t\t\tswitch (role)\n\t\t\t{\n\t\t\t\tcase this.memberRoles.head:\n\t\t\t\t\treturn this.headSelector;\n\t\t\t\tcase this.memberRoles.deputyHead:\n\t\t\t\t\treturn this.deputySelector;\n\t\t\t\tdefault:\n\t\t\t\t\treturn this.employeesSelector;\n\t\t\t}\n\t\t},\n\t\tapplyData(): void\n\t\t{\n\t\t\tthis.$emit('applyData', {\n\t\t\t\tapiEntityChanged: WizardApiEntityChangedDict.employees,\n\t\t\t\theads: this.departmentHeads,\n\t\t\t\temployees: this.departmentEmployees,\n\t\t\t\tremovedUsers: this.removedUsers,\n\t\t\t\tmoveUsersMap: this.moveUsersMap,\n\t\t\t\tuserCount: this.userCount,\n\t\t\t\tisDepartmentDataChanged: true,\n\t\t\t});\n\t\t},\n\t\thandleSaveModeChangedChanged(actionId: string): void\n\t\t{\n\t\t\tthis.$emit('saveModeChanged', actionId);\n\t\t},\n\t\tisUserPreselected(selector: TagSelector, userId: number): boolean\n\t\t{\n\t\t\tconst { preselectedItems = [] } = selector.dialog;\n\t\t\tconst parsedPreselected = preselectedItems\n\t\t\t\t.flat()\n\t\t\t\t.filter((preselectedItem) => preselectedItem !== 'user')\n\t\t\t;\n\n\t\t\treturn parsedPreselected.includes(userId);\n\t\t},\n\t},\n\n\tcomputed:\n\t{\n\t\tisTeamEntity(): boolean\n\t\t{\n\t\t\treturn this.entityType === EntityTypes.team;\n\t\t},\n\t\theadTitle(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_TEAM_HEAD_TITLE')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_HEAD_TITLE')\n\t\t\t;\n\t\t},\n\t\theadDescription(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_TEAM_HEAD_DESCR')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_HEAD_DESCR')\n\t\t\t;\n\t\t},\n\t\tdeputyTitle(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_TEAM_DEPUTY_TITLE')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_DEPUTY_TITLE')\n\t\t\t;\n\t\t},\n\t\tdeputyDescription(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_TEAM_DEPUTY_DESCR')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_DEPUTY_DESCR')\n\t\t\t;\n\t\t},\n\t\temployeeTitle(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_TEAM_EMPLOYEES_TITLE')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_EMPLOYEES_TITLE')\n\t\t\t;\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"chart-wizard__employee\">\n\t\t\t<div class=\"chart-wizard__form\">\n\t\t\t\t<div class=\"chart-wizard__employee_item\">\n\t\t\t\t\t<span class=\"chart-wizard__employee_item-label\">\n\t\t\t\t\t\t{{ headTitle }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"chart-wizard__employee_selector\"\n\t\t\t\t\t\tref=\"head-selector\"\n\t\t\t\t\t\tdata-test-id=\"hr-company-structure_chart-wizard__employees-head-selector\"\n\t\t\t\t\t/>\n\t\t\t\t\t<span class=\"chart-wizard__employee_item-description\">\n\t\t\t\t\t\t{{ headDescription }}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__employee_item\">\n\t\t\t\t\t<span class=\"chart-wizard__employee_item-label\">\n\t\t\t\t\t\t{{ deputyTitle }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"chart-wizard__employee_selector\"\n\t\t\t\t\t\tref=\"deputy-selector\"\n\t\t\t\t\t\tdata-test-id=\"hr-company-structure_chart-wizard__employees-deputy-selector\"\n\t\t\t\t\t/>\n\t\t\t\t\t<span class=\"chart-wizard__employee_item-description\">\n\t\t\t\t\t\t{{ deputyDescription }}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__employee_item\">\n\t\t\t\t\t<span class=\"chart-wizard__employee_item-label\">\n\t\t\t\t\t\t{{ employeeTitle }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"chart-wizard__employee_selector\"\n\t\t\t\t\t\tref=\"employees-selector\"\n\t\t\t\t\t\tdata-test-id=\"hr-company-structure_chart-wizard__employees-employee-selector\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div v-if=\"!isTeamEntity\" class=\"chart-wizard__employee_item --change-save-mode-control\">\n\t\t\t\t\t<ChangeSaveModeControl\n\t\t\t\t\t\tv-if=\"!isEditMode\"\n\t\t\t\t\t\t@saveModeChanged=\"handleSaveModeChangedChanged\"\n\t\t\t\t\t></ChangeSaveModeControl>\n\t\t\t\t\t<div class=\"chart-wizard__change-save-mode-control-container\" v-else>\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_EDIT_WIZARD_EMPLOYEE_SAVE_MODE_TEXT') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<MoveUserPopup\n\t\t\tv-if=\"showMoveUserPopup\"\n\t\t\t:originalNodeId=\"entityId\"\n\t\t\t:user=\"movedUserData\"\n\t\t\t:entityType=\"entityType\"\n\t\t\t:executeAction=\"false\"\n\t\t\t:onlyMove=\"false\"\n\t\t\t@action=\"handleMoveUserAction\"\n\t\t\t@close=\"handleAbortMove\"\n\t\t\t@remove=\"handleMoveUserAction\"\n\t\t/>\n\t`,\n};\n","import { PermissionChecker } from 'humanresources.company-structure.permission-checker';\ntype AvailablePhrases = 'hintText' | 'createText' | 'removeText' | 'warningText';\n\nexport class AbstractSelectorDictionary\n{\n\tphrases: Record<AvailablePhrases, { team: string, default: string }> = {};\n\tpermissionAction: { team: string, department: string } = { team: '', department: '' };\n\n\tgetPhrase(key: AvailablePhrases, isTeamEntity: boolean): string\n\t{\n\t\tconst phraseSet = this.phrases[key];\n\n\t\tif (!phraseSet)\n\t\t{\n\t\t\tthrow new Error(`Phrase set for key \"${key}\" is not defined in ${this.constructor.name} selector dictionary.`);\n\t\t}\n\n\t\treturn isTeamEntity ? phraseSet.team : phraseSet.default;\n\t}\n\n\tgetEntityName(): string\n\t{\n\t\treturn 'im-chat-only';\n\t}\n\n\tgetTagId(chat): string | number\n\t{\n\t\treturn `chat${chat.id}`;\n\t}\n\n\tgetItemId(tag): string | number\n\t{\n\t\treturn Number(tag.id.replace('chat', ''));\n\t}\n\n\tgetEntity(): Object {}\n\n\tgetDialogEvents(entityId: number, isTeamEntity: boolean, isEditMode: boolean): Object\n\t{\n\t\treturn {\n\t\t\tonLoad: (event: BaseEvent) => {\n\t\t\t\tconst dialog: Dialog = event.getTarget();\n\t\t\t\tif (!this.canEdit(entityId, isTeamEntity, isEditMode))\n\t\t\t\t{\n\t\t\t\t\tdialog.getTagSelector().lock();\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\t}\n\n\tgetTestId(blueprint: string): string {}\n\n\tcanEdit(entityId: number, isTeamEntity: boolean, isEditMode: boolean): boolean\n\t{\n\t\tif (!isEditMode)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tconst permissionChecker = PermissionChecker.getInstance();\n\t\tif (!permissionChecker)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst permissionAction = isTeamEntity\n\t\t\t? this.permissionAction.team\n\t\t\t: this.permissionAction.department\n\t\t;\n\n\t\treturn permissionChecker.hasPermission(permissionAction, entityId);\n\t}\n\n\tgetRemovePhrase(hasCurrentUser: boolean, isTeamEntity: boolean): string\n\t{\n\t\tthrow new Error('getRemovePhrase must be implemented in inheritor');\n\t}\n}\n","import { getChannelDialogEntity } from 'humanresources.company-structure.structure-components';\nimport { AbstractSelectorDictionary } from '../selector-dictionary';\nimport { PermissionActions } from 'humanresources.company-structure.permission-checker';\n\nexport class ChannelSelectorDictionary extends AbstractSelectorDictionary\n{\n\tphrases = {\n\t\thintText: {\n\t\t\tteam: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHANNELS_ADD_CHECKBOX_HINT',\n\t\t\tdefault: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHANNELS_ADD_CHECKBOX_HINT_MSGVER_1',\n\t\t},\n\t\tcreateText: {\n\t\t\tteam: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHANNELS_ADD_CHECKBOX_LABEL_MSGVER_1',\n\t\t\tdefault: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHANNELS_ADD_CHECKBOX_LABEL_MSGVER_2',\n\t\t},\n\t\twarningText: {\n\t\t\tteam: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHANNELS_ADD_CHECKBOX_WARNING',\n\t\t\tdefault: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHANNELS_ADD_CHECKBOX_WARNING',\n\t\t},\n\t};\n\n\tpermissionAction = {\n\t\tdepartment: PermissionActions.departmentChannelEdit,\n\t\tteam: PermissionActions.teamChannelEdit,\n\t};\n\n\tgetEntity(): Object\n\t{\n\t\treturn getChannelDialogEntity();\n\t}\n\n\tgetTestId(blueprint: string): string\n\t{\n\t\treturn blueprint.replace('chat', 'channel');\n\t}\n\n\tgetRemovePhrase(hasCurrentUser: boolean, isTeamEntity: boolean): string\n\t{\n\t\tif (hasCurrentUser)\n\t\t{\n\t\t\treturn isTeamEntity\n\t\t\t\t? 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHANNELS_REMOVE_CHECKBOX_LABEL_MSGVER_1'\n\t\t\t\t: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHANNELS_REMOVE_CHECKBOX_LABEL_MSGVER_1'\n\t\t\t;\n\t\t}\n\n\t\treturn isTeamEntity\n\t\t\t? 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHANNELS_REMOVE_CHECKBOX_LABEL_NOT_INSIDE'\n\t\t\t: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHANNELS_REMOVE_CHECKBOX_LABEL_NOT_INSIDE'\n\t\t;\n\t}\n}\n","import { getChatDialogEntity } from 'humanresources.company-structure.structure-components';\nimport { AbstractSelectorDictionary } from '../selector-dictionary';\nimport { PermissionActions } from 'humanresources.company-structure.permission-checker';\n\nexport class ChatSelectorDictionary extends AbstractSelectorDictionary\n{\n\tphrases = {\n\t\thintText: {\n\t\t\tteam: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHATS_ADD_CHECKBOX_HINT',\n\t\t\tdefault: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHATS_ADD_CHECKBOX_HINT_MSGVER_1',\n\t\t},\n\t\tcreateText: {\n\t\t\tteam: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHATS_ADD_CHECKBOX_LABEL_MSGVER_1',\n\t\t\tdefault: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHATS_ADD_CHECKBOX_LABEL_MSGVER_2',\n\t\t},\n\t\twarningText: {\n\t\t\tteam: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHATS_ADD_CHECKBOX_WARNING',\n\t\t\tdefault: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHATS_ADD_CHECKBOX_WARNING',\n\t\t},\n\t};\n\n\tpermissionAction = {\n\t\tdepartment: PermissionActions.departmentChatEdit,\n\t\tteam: PermissionActions.teamChatEdit,\n\t};\n\n\tgetEntity(): Object\n\t{\n\t\treturn getChatDialogEntity();\n\t}\n\n\tgetTestId(blueprint: string): string\n\t{\n\t\treturn blueprint;\n\t}\n\n\tgetRemovePhrase(hasCurrentUser: boolean, isTeamEntity: boolean): string\n\t{\n\t\tif (hasCurrentUser)\n\t\t{\n\t\t\treturn isTeamEntity\n\t\t\t\t? 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHATS_REMOVE_CHECKBOX_LABEL_MSGVER_1'\n\t\t\t\t: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHATS_REMOVE_CHECKBOX_LABEL_MSGVER_1'\n\t\t\t;\n\t\t}\n\n\t\treturn isTeamEntity\n\t\t\t? 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHATS_REMOVE_CHECKBOX_LABEL_NOT_INSIDE'\n\t\t\t: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHATS_REMOVE_CHECKBOX_LABEL_NOT_INSIDE'\n\t\t;\n\t}\n}\n","import { getCollabDialogEntity } from 'humanresources.company-structure.structure-components';\nimport { AbstractSelectorDictionary } from '../selector-dictionary';\nimport { PermissionActions } from 'humanresources.company-structure.permission-checker';\n\nexport class CollabSelectorDictionary extends AbstractSelectorDictionary\n{\n\tphrases = {\n\t\thintText: {\n\t\t\tteam: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_COLLAB_ADD_CHECKBOX_HINT',\n\t\t\tdefault: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_COLLAB_ADD_CHECKBOX_HINT',\n\t\t},\n\t\tcreateText: {\n\t\t\tteam: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_COLLAB_ADD_CHECKBOX_LABEL',\n\t\t\tdefault: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_COLLAB_ADD_CHECKBOX_LABEL',\n\t\t},\n\t\twarningText: {\n\t\t\tteam: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_COLLAB_ADD_CHECKBOX_WARNING',\n\t\t\tdefault: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_COLLAB_ADD_CHECKBOX_WARNING',\n\t\t},\n\t};\n\n\tpermissionAction = {\n\t\tdepartment: PermissionActions.departmentCollabEdit,\n\t\tteam: PermissionActions.teamCollabEdit,\n\t};\n\n\tgetEntityName(): string\n\t{\n\t\treturn 'project';\n\t}\n\n\tgetEntity(): Object\n\t{\n\t\treturn getCollabDialogEntity();\n\t}\n\n\tgetDialogEvents(entityId: number, isTeamEntity: boolean, isEditMode: boolean): Object\n\t{\n\t\treturn {\n\t\t\tonLoad: (event: BaseEvent) => {\n\t\t\t\tconst dialog: Dialog = event.getTarget();\n\t\t\t\tdialog.removeTab('projects');\n\t\t\t\tif (!this.canEdit(entityId, isTeamEntity, isEditMode))\n\t\t\t\t{\n\t\t\t\t\tdialog.getTagSelector().lock();\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\t}\n\n\tgetTagId(chat): string | number\n\t{\n\t\treturn Number(chat.id);\n\t}\n\n\tgetItemId(tag): string | number\n\t{\n\t\treturn tag.id;\n\t}\n\n\tgetTestId(blueprint: string): string\n\t{\n\t\treturn blueprint.replace('chat', 'collab');\n\t}\n\n\tgetRemovePhrase(hasCurrentUser: boolean, isTeamEntity: boolean): string\n\t{\n\t\tif (hasCurrentUser)\n\t\t{\n\t\t\treturn isTeamEntity\n\t\t\t\t? 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_COLLAB_REMOVE_CHECKBOX_LABEL'\n\t\t\t\t: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_COLLAB_REMOVE_CHECKBOX_LABEL'\n\t\t\t;\n\t\t}\n\n\t\treturn isTeamEntity\n\t\t\t? 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_COLLAB_REMOVE_CHECKBOX_LABEL_NOT_INSIDE'\n\t\t\t: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_COLLAB_REMOVE_CHECKBOX_LABEL_NOT_INSIDE'\n\t\t;\n\t}\n}\n","import { CommunicationsTypeDict } from 'humanresources.company-structure.structure-components';\nimport { ChannelSelectorDictionary } from './channel-selector-dictionary';\nimport { ChatSelectorDictionary } from './chat-selector-dictionary';\nimport { CollabSelectorDictionary } from './collab-selector-dictionary';\nimport { AbstractSelectorDictionary } from '../selector-dictionary';\n\nexport function createSelectorDictionary(type): AbstractSelectorDictionary\n{\n\tswitch (type)\n\t{\n\t\tcase CommunicationsTypeDict.chat:\n\t\t\treturn new ChatSelectorDictionary();\n\t\tcase CommunicationsTypeDict.channel:\n\t\t\treturn new ChannelSelectorDictionary();\n\t\tcase CommunicationsTypeDict.collab:\n\t\t\treturn new CollabSelectorDictionary();\n\t\tdefault:\n\t\t\tthrow new Error('Unknown selector type');\n\t}\n}\n","import {\n\tgetCommunicationsRecentTabOptions,\n\tCommunicationsTypeDict,\n\tDefaultHint,\n} from 'humanresources.company-structure.structure-components';\n// eslint-disable-next-line no-unused-vars\nimport type { CommunicationDetailed } from 'humanresources.company-structure.utils';\nimport { PermissionActions, PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport { Item, TagSelector } from 'ui.entity-selector';\nimport { Set as IconSet } from 'ui.icon-set.api.core';\nimport { BIcon } from 'ui.icon-set.api.vue';\nimport { AbstractSelectorDictionary } from './selector-dictionary';\nimport { createSelectorDictionary } from './dictionaries/selector-dictionary-factory';\n\nconst DEFAULT_TAG_ID = 'default';\n\n// Component for selecting chats or channels in the wizard. Consists of selector, default button, hint and warning\n// @vue/component\nexport const CommunicationSelector = {\n\tname: 'communicationSelector',\n\n\tcomponents: {\n\t\tDefaultHint,\n\t\tBIcon,\n\t},\n\n\tprops: {\n\t\tentityId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tname: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\theadsCreated: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\thasCurrentUser: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tisTeamEntity: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tisEditMode: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\t/** @type CommunicationDetailed[] */\n\t\tinitCommunications: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\t/** @type CommunicationsTypeDict.chat | ChatTypeDict.channel | ChatTypeDict.collab */\n\t\ttype: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\temits: ['applyData'],\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tcreateDefault: false,\n\t\t\tpermissionChecker: null,\n\t\t};\n\t},\n\n\tcomputed:\n\t{\n\t\tselectorDictionary(): AbstractSelectorDictionary\n\t\t{\n\t\t\treturn createSelectorDictionary(this.type);\n\t\t},\n\t\tisChannel(): boolean\n\t\t{\n\t\t\treturn this.type === CommunicationsTypeDict.channel;\n\t\t},\n\t\tset(): IconSet\n\t\t{\n\t\t\treturn IconSet;\n\t\t},\n\t\thintText(): string\n\t\t{\n\t\t\treturn this.loc(this.selectorDictionary.getPhrase('hintText', this.isTeamEntity));\n\t\t},\n\t\tcreateText(): string\n\t\t{\n\t\t\treturn this.loc(this.selectorDictionary.getPhrase('createText', this.isTeamEntity));\n\t\t},\n\t\tremoveText(): string\n\t\t{\n\t\t\treturn this.loc(this.selectorDictionary.getRemovePhrase(this.hasCurrentUser, this.isTeamEntity));\n\t\t},\n\t\twarningText(): string\n\t\t{\n\t\t\treturn this.loc(this.selectorDictionary.getPhrase('warningText', this.isTeamEntity));\n\t\t},\n\t\tcanBeEdit(): boolean\n\t\t{\n\t\t\tif (!this.isEditMode)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (this.type === CommunicationsTypeDict.chat)\n\t\t\t{\n\t\t\t\treturn this.isTeamEntity\n\t\t\t\t\t? this.permissionChecker.hasPermission(PermissionActions.teamChatEdit, this.entityId)\n\t\t\t\t\t: this.permissionChecker.hasPermission(PermissionActions.departmentChatEdit, this.entityId)\n\t\t\t\t;\n\t\t\t}\n\n\t\t\tif (this.type === CommunicationsTypeDict.channel)\n\t\t\t{\n\t\t\t\treturn this.isTeamEntity\n\t\t\t\t\t? this.permissionChecker.hasPermission(PermissionActions.teamChannelEdit, this.entityId)\n\t\t\t\t\t: this.permissionChecker.hasPermission(PermissionActions.departmentChannelEdit, this.entityId)\n\t\t\t\t;\n\t\t\t}\n\n\t\t\tif (this.type === CommunicationsTypeDict.collab)\n\t\t\t{\n\t\t\t\treturn this.isTeamEntity\n\t\t\t\t\t? this.permissionChecker.hasPermission(PermissionActions.teamCollabEdit, this.entityId)\n\t\t\t\t\t: this.permissionChecker.hasPermission(PermissionActions.departmentCollabEdit, this.entityId)\n\t\t\t\t;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\t},\n\n\twatch:\n\t{\n\t\tcreateDefault(value): void\n\t\t{\n\t\t\tif (value)\n\t\t\t{\n\t\t\t\tthis.selector.getDialog().getItem({ id: DEFAULT_TAG_ID, entityId: DEFAULT_TAG_ID }).select();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.selector.getDialog().getItem({ id: DEFAULT_TAG_ID, entityId: DEFAULT_TAG_ID }).deselect();\n\t\t\t}\n\t\t},\n\t\tname(value): void\n\t\t{\n\t\t\tconst defaultItem = this.selector.getDialog().getItem({ id: DEFAULT_TAG_ID, entityId: DEFAULT_TAG_ID });\n\t\t\tdefaultItem.setTitle(value);\n\n\t\t\tif (this.createDefault)\n\t\t\t{\n\t\t\t\tdefaultItem.deselect();\n\t\t\t\tdefaultItem.select();\n\t\t\t}\n\t\t},\n\t\theadsCreated(value): void\n\t\t{\n\t\t\tif (!value)\n\t\t\t{\n\t\t\t\tthis.createDefault = false;\n\t\t\t}\n\t\t},\n\t\tinitCommunications:\n\t\t{\n\t\t\thandler(payload: ChatOrChannelDetailed[]): void\n\t\t\t{\n\t\t\t\tpayload.forEach((item) => this.initialItemsSet.add(this.selectorDictionary.getTagId(item)));\n\t\t\t\tconst preselectedItems = payload.map((item) => [\n\t\t\t\t\tthis.selectorDictionary.getEntityName(),\n\t\t\t\t\tthis.selectorDictionary.getTagId(item),\n\t\t\t\t]);\n\t\t\t\tconst { dialog } = this.selector;\n\t\t\t\tdialog.setPreselectedItems(preselectedItems);\n\t\t\t\tdialog.load();\n\t\t\t},\n\t\t},\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.permissionChecker = PermissionChecker.getInstance();\n\t\tthis.communications = [];\n\t\t// store initial values to control applyData method in tagSelector\n\t\tthis.initialItemsSet = this.initCommunications\n\t\t\t.reduce((set, item) => set.add(this.selectorDictionary.getTagId(item)), new Set())\n\t\t;\n\t\tthis.selector = this.getSelector();\n\t},\n\n\tmounted(): void\n\t{\n\t\tthis.selector.renderTo(this.$refs['communications-selector']);\n\t},\n\n\tmethods:\n\t{\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\taddTag(tag): void\n\t\t{\n\t\t\tif (!tag.searchable)\n\t\t\t{\n\t\t\t\tconst existingItem = this.initCommunications\n\t\t\t\t\t.find((item) => this.selectorDictionary.getTagId(item) === tag.id)\n\t\t\t\t;\n\n\t\t\t\tif (existingItem?.title)\n\t\t\t\t{\n\t\t\t\t\ttag.setTitle(existingItem.title);\n\t\t\t\t\tif (existingItem.hasAccess)\n\t\t\t\t\t{\n\t\t\t\t\t\ttag.setDeselectable(true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.communications.push(this.selectorDictionary.getItemId(tag));\n\t\t},\n\t\tgetSelector(): TagSelector\n\t\t{\n\t\t\tconst entity = this.selectorDictionary.getEntity();\n\n\t\t\tconst options = {\n\t\t\t\tmultiple: true,\n\t\t\t\tevents: {\n\t\t\t\t\tonTagAdd: (event: BaseEvent) => {\n\t\t\t\t\t\tconst { tag } = event.getData();\n\t\t\t\t\t\tif (tag.id === DEFAULT_TAG_ID)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.createDefault = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.addTag(tag);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.initialItemsSet.has(tag.id))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.initialItemsSet.delete(tag.id);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.applyData();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tonTagRemove: (event: BaseEvent) => {\n\t\t\t\t\t\tconst { tag } = event.getData();\n\t\t\t\t\t\tconst intId = this.selectorDictionary.getItemId(tag);\n\t\t\t\t\t\tif (tag.id === DEFAULT_TAG_ID)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.createDefault = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.communications = this.communications.filter((item) => item !== intId);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.applyData();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tlocked: !this.canBeEdit,\n\t\t\t\tdialogOptions: {\n\t\t\t\t\tenableSearch: true,\n\t\t\t\t\theight: 250,\n\t\t\t\t\twidth: 380,\n\t\t\t\t\tdropdownMode: true,\n\t\t\t\t\tevents: this.selectorDictionary.getDialogEvents(this.entityId, this.isTeamEntity, this.isEditMode),\n\t\t\t\t\trecentTabOptions: getCommunicationsRecentTabOptions(this.entityType, this.type),\n\t\t\t\t\titems: [this.getDefaultItem(entity.tagOptions?.default, entity.itemOptions?.default)],\n\t\t\t\t\tpreselectedItems: this.initCommunications.map((item) => [\n\t\t\t\t\t\tthis.selectorDictionary.getEntityName(),\n\t\t\t\t\t\tthis.selectorDictionary.getTagId(item),\n\t\t\t\t\t]),\n\t\t\t\t\tentities: [entity],\n\t\t\t\t},\n\t\t\t};\n\n\t\t\treturn new TagSelector(options);\n\t\t},\n\t\tgetDefaultItem(tagOptions: Object = {}, itemOptions: Object = {}): Item\n\t\t{\n\t\t\treturn {\n\t\t\t\tid: DEFAULT_TAG_ID,\n\t\t\t\tentityId: DEFAULT_TAG_ID,\n\t\t\t\ttitle: this.name,\n\t\t\t\tsearchable: false,\n\t\t\t\ttagOptions,\n\t\t\t\t...itemOptions,\n\t\t\t};\n\t\t},\n\t\tapplyData(): void\n\t\t{\n\t\t\tthis.$emit('applyData', {\n\t\t\t\ttype: this.type,\n\t\t\t\tcommunications: this.communications,\n\t\t\t\tcreateDefault: this.createDefault,\n\t\t\t});\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"chart-wizard__chat_selector\"\n\t\t\tref=\"communications-selector\"\n\t\t\t:data-test-id=\"selectorDictionary.getTestId('hr-company-structure_chart-wizard__chat-selector')\"\n\t\t/>\n\t\t<div\n\t\t\tv-if=\"!createDefault\"\n\t\t\tclass=\"chart-wizard__bind-chat__item-checkbox_container\"\n\t\t>\n\t\t\t<div\n\t\t\t\t@click=\"createDefault = headsCreated && canBeEdit\"\n\t\t\t\tclass=\"chart-wizard__bind-chat__item-create\"\n\t\t\t\t:class=\"{ '--disabled': !headsCreated || !canBeEdit }\"\n\t\t\t\t:data-test-id=\"selectorDictionary.getTestId('hr-company-structure_chart-wizard__make-default-chat-create')\"\n\t\t\t\tv-html=\"createText\"\n\t\t\t>\n\t\t\t</div>\n\t\t\t<DefaultHint :content=\"hintText\" />\n\t\t</div>\n\t\t<div v-else class=\"chart-wizard__bind-chat__item-checkbox_container\">\n\t\t\t<div class=\"ui-icon-set --o-circle-check\"></div>\n\t\t\t<div\n\t\t\t\tclass=\"chart-wizard__bind-chat__item-remove\"\n\t\t\t\t:class=\"{ '--disabled': !headsCreated || !canBeEdit }\"\n\t\t\t\t:data-test-id=\"selectorDictionary.getTestId('hr-company-structure_chart-wizard__make-default-chat-remove')\"\n\t\t\t>\n\t\t\t\t{{ removeText }}\n\t\t\t</div>\n\t\t</div>\n\t\t<div v-if=\"!headsCreated\" class=\"chart-wizard__bind-chat__item-checkbox_warning\">\n\t\t\t<BIcon\n\t\t\t\t:name=\"set.WARNING\"\n\t\t\t\tcolor=\"#FFA900\"\n\t\t\t\t:size=\"16\"\n\t\t\t></BIcon>\n\t\t\t<span>\n\t\t\t\t{{ warningText }}\n\t\t\t</span>\n\t\t</div>\n\t`,\n};\n","import { getMemberRoles } from 'humanresources.company-structure.api';\nimport { PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport { EntityTypes, WizardApiEntityChangedDict, type CommunicationDetailed } from 'humanresources.company-structure.utils';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { mapState } from 'ui.vue3.pinia';\nimport { CommunicationSelector } from '../communication-selector/communication-selector';\nimport { CommunicationsTypeDict } from 'humanresources.company-structure.structure-components';\n\n// @vue/component\nexport const BindChat = {\n\tname: 'bindChat',\n\n\tcomponents: { CommunicationSelector },\n\n\tprops: {\n\t\tentityId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\theads: {\n\t\t\ttype: Array,\n\t\t\trequired: false,\n\t\t\tdefault: () => [],\n\t\t},\n\t\temployees: {\n\t\t\ttype: Array,\n\t\t\trequired: false,\n\t\t\tdefault: () => [],\n\t\t},\n\t\temployeesIds: {\n\t\t\ttype: Array,\n\t\t\trequired: false,\n\t\t\tdefault: () => [],\n\t\t},\n\t\tname: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tentityType: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tisEditMode: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\t/** @type CommunicationDetailed[] */\n\t\tinitChats: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\t/** @type CommunicationDetailed[] */\n\t\tinitChannels: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\t/** @type CommunicationDetailed[] */\n\t\tinitCollabs: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\temits: ['applyData'],\n\n\tcomputed:\n\t{\n\t\tisCollabsAvailable(): boolean\n\t\t{\n\t\t\treturn PermissionChecker.getInstance().isCollabsAvailable;\n\t\t},\n\t\theadsCreated(): boolean\n\t\t{\n\t\t\tconst memberRoles = getMemberRoles(this.entityType);\n\n\t\t\treturn this.heads.some((item) => item.role === memberRoles.head);\n\t\t},\n\t\thasCurrentUser(): boolean\n\t\t{\n\t\t\treturn this.heads.some((item) => item.id === this.userId)\n\t\t\t\t|| this.employeesIds.includes(this.userId)\n\t\t\t\t|| this.employees.some((item) => item.id === this.userId)\n\t\t\t;\n\t\t},\n\t\tisTeamEntity(): boolean\n\t\t{\n\t\t\treturn this.entityType === EntityTypes.team;\n\t\t},\n\t\thints(): string[]\n\t\t{\n\t\t\tif (this.isCollabsAvailable)\n\t\t\t{\n\t\t\t\tif (this.isTeamEntity)\n\t\t\t\t{\n\t\t\t\t\treturn [\n\t\t\t\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_HINT_1_W_COLLABS'),\n\t\t\t\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_HINT_2_MSGVER_1'),\n\t\t\t\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_HINT_3_W_COLLABS'),\n\t\t\t\t\t];\n\t\t\t\t}\n\n\t\t\t\treturn [\n\t\t\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_HINT_1_W_COLLABS'),\n\t\t\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_HINT_2_MSGVER_2'),\n\t\t\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_HINT_3_W_COLLABS'),\n\t\t\t\t];\n\t\t\t}\n\n\t\t\tif (this.isTeamEntity)\n\t\t\t{\n\t\t\t\treturn [\n\t\t\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_HINT_1'),\n\t\t\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_HINT_2_MSGVER_1'),\n\t\t\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_HINT_3'),\n\t\t\t\t];\n\t\t\t}\n\n\t\t\treturn [\n\t\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_HINT_1_MSGVER_1'),\n\t\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_HINT_2_MSGVER_2'),\n\t\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_HINT_3'),\n\t\t\t];\n\t\t},\n\t\tChatTypeDict(): Record<string, string>\n\t\t{\n\t\t\treturn CommunicationsTypeDict;\n\t\t},\n\t\thintTitle(): string\n\t\t{\n\t\t\tif (this.isCollabsAvailable)\n\t\t\t{\n\t\t\t\treturn this.isTeamEntity\n\t\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_HINT_TITLE_W_COLLABS')\n\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_HINT_TITLE_W_COLLABS')\n\t\t\t\t;\n\t\t\t}\n\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_HINT_TITLE')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_HINT_TITLE')\n\t\t\t;\n\t\t},\n\t\t...mapState(useChartStore, ['userId']),\n\t},\n\n\twatch:\n\t{\n\t\tinitChats(value: CommunicationDetailed[]): void\n\t\t{\n\t\t\tthis.chats = value.map((item) => item.id);\n\t\t},\n\t\tinitChannels(value: CommunicationDetailed[]): void\n\t\t{\n\t\t\tthis.channels = value.map((item) => item.id);\n\t\t},\n\t\tinitCollabs(value: CommunicationDetailed[]): void\n\t\t{\n\t\t\tthis.collabs = value.map((item) => item.id);\n\t\t},\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.chats = this.initChats.map((item) => item.id);\n\t\tthis.channels = this.initChannels.map((item) => item.id);\n\t\tthis.collabs = this.initCollabs.map((item) => Number(item.id));\n\t\tthis.createDefaultChat = false;\n\t\tthis.createDefaultChannel = false;\n\t\tthis.createDefaultCollab = false;\n\t},\n\n\tactivated(): void\n\t{\n\t\tthis.$emit('applyData', {\n\t\t\tisDepartmentDataChanged: false,\n\t\t\tisValid: true,\n\t\t});\n\t},\n\n\tmethods:\n\t{\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tapplyData(): void\n\t\t{\n\t\t\tthis.$emit('applyData', {\n\t\t\t\tapiEntityChanged: WizardApiEntityChangedDict.bindChats,\n\t\t\t\tchats: this.chats,\n\t\t\t\tchannels: this.channels,\n\t\t\t\tcollabs: this.collabs,\n\t\t\t\tcreateDefaultChat: this.createDefaultChat,\n\t\t\t\tcreateDefaultChannel: this.createDefaultChannel,\n\t\t\t\tcreateDefaultCollab: this.createDefaultCollab,\n\t\t\t\tisDepartmentDataChanged: true,\n\t\t\t});\n\t\t},\n\t\tonCommunicationSelectorChanged(data: { type: string, communications: Array, createDefault: boolean }): void\n\t\t{\n\t\t\tif (data.type === CommunicationsTypeDict.chat)\n\t\t\t{\n\t\t\t\tthis.chats = data.communications;\n\t\t\t\tthis.createDefaultChat = data.createDefault;\n\t\t\t}\n\t\t\telse if (data.type === CommunicationsTypeDict.channel)\n\t\t\t{\n\t\t\t\tthis.channels = data.communications;\n\t\t\t\tthis.createDefaultChannel = data.createDefault;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.collabs = data.communications;\n\t\t\t\tthis.createDefaultCollab = data.createDefault;\n\t\t\t}\n\n\t\t\tthis.applyData();\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"chart-wizard__bind-chat\">\n\t\t\t<div class=\"chart-wizard__bind-chat__item\" :class=\"{ '--team': isTeamEntity }\">\n\t\t\t\t<div v-if=\"!isEditMode\" class=\"chart-wizard__bind-chat__item-hint\">\n\t\t\t\t\t<div class=\"chart-wizard__bind-chat__item-hint_logo\"></div>\n\t\t\t\t\t<div class=\"chart-wizard__bind-chat__item-hint_text\">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"chart-wizard__bind-chat__item-hint_title\"\n\t\t\t\t\t\t\tv-html=\"hintTitle\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-for=\"hint in hints\"\n\t\t\t\t\t\t\t class=\"chart-wizard__bind-chat__item-hint_text-item\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\"chart-wizard__bind-chat__item-hint_text-item_icon\"></div>\n\t\t\t\t\t\t\t<span>{{ hint }}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__bind-chat__item-options\" v-if=\"isCollabsAvailable\">\n\t\t\t\t\t<div class=\"chart-wizard__bind-chat__item-options__item-content_title\">\n\t\t\t\t\t\t<div class=\"chart-wizard__bind-chat__item-options__item-content_title-text\">\n\t\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_COLLAB_TITLE') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<span class=\"chart-wizard__bind-chat__item-description\">\n\t\t\t\t\t\t{{\n\t\t\t\t\t\t\tisTeamEntity\n\t\t\t\t\t\t\t\t? loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_COLLAB_DESCRIPTION')\n\t\t\t\t\t\t\t\t: loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_COLLAB_DESCRIPTION')\n\t\t\t\t\t\t}}\n\t\t\t\t\t</span>\n\t\t\t\t\t<CommunicationSelector\n\t\t\t\t\t\t:entityId=\"entityId\"\n\t\t\t\t\t\t:name=\"name\"\n\t\t\t\t\t\t:headsCreated=\"headsCreated\"\n\t\t\t\t\t\t:hasCurrentUser=\"hasCurrentUser\"\n\t\t\t\t\t\t:initCommunications=\"initCollabs\"\n\t\t\t\t\t\t:type=\"ChatTypeDict.collab\"\n\t\t\t\t\t\t:isTeamEntity=\"isTeamEntity\"\n\t\t\t\t\t\t:isEditMode=\"isEditMode\"\n\t\t\t\t\t\t@applyData=\"onCommunicationSelectorChanged\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__bind-chat__item-options\">\n\t\t\t\t\t<div class=\"chart-wizard__bind-chat__item-options__item-content_title\">\n\t\t\t\t\t\t<div class=\"chart-wizard__bind-chat__item-options__item-content_title-text\">\n\t\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHANNELS_TITLE') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<span class=\"chart-wizard__bind-chat__item-description\">\n\t\t\t\t\t\t{{\n\t\t\t\t\t\t\tisTeamEntity\n\t\t\t\t\t\t\t\t? loc(\n\t\t\t\t\t\t\t\t\t'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHANNELS_DESCRIPTION')\n\t\t\t\t\t\t\t\t: loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHANNELS_DESCRIPTION')\n\t\t\t\t\t\t}}\n\t\t\t\t\t</span>\n\t\t\t\t\t<CommunicationSelector\n\t\t\t\t\t\t:entityId=\"entityId\"\n\t\t\t\t\t\t:name=\"name\"\n\t\t\t\t\t\t:headsCreated=\"headsCreated\"\n\t\t\t\t\t\t:hasCurrentUser=\"hasCurrentUser\"\n\t\t\t\t\t\t:initCommunications=\"initChannels\"\n\t\t\t\t\t\t:type=\"ChatTypeDict.channel\"\n\t\t\t\t\t\t:isTeamEntity=\"isTeamEntity\"\n\t\t\t\t\t\t:isEditMode=\"isEditMode\"\n\t\t\t\t\t\t@applyData=\"onCommunicationSelectorChanged\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__bind-chat__item-options\">\n\t\t\t\t\t<div class=\"chart-wizard__bind-chat__item-options__item-content_title\">\n\t\t\t\t\t\t<div class=\"chart-wizard__bind-chat__item-options__item-content_title-text\">\n\t\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHATS_TITLE') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<span class=\"chart-wizard__bind-chat__item-description\">\n\t\t\t\t\t\t{{\n\t\t\t\t\t\t\tisTeamEntity\n\t\t\t\t\t\t\t\t? loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHATS_DESCRIPTION')\n\t\t\t\t\t\t\t\t: loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHATS_DESCRIPTION')\n\t\t\t\t\t\t}}\n\t\t\t\t\t</span>\n\t\t\t\t\t<CommunicationSelector\n\t\t\t\t\t\t:entityId=\"entityId\"\n\t\t\t\t\t\t:name=\"name\"\n\t\t\t\t\t\t:headsCreated=\"headsCreated\"\n\t\t\t\t\t\t:hasCurrentUser=\"hasCurrentUser\"\n\t\t\t\t\t\t:initCommunications=\"initChats\"\n\t\t\t\t\t\t:type=\"ChatTypeDict.chat\"\n\t\t\t\t\t\t:isTeamEntity=\"isTeamEntity\"\n\t\t\t\t\t\t:isEditMode=\"isEditMode\"\n\t\t\t\t\t\t@applyData=\"onCommunicationSelectorChanged\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { PermissionActions, PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\nimport { Reflection } from 'main.core';\nimport { ResponsiveHint } from 'humanresources.company-structure.structure-components';\n\nexport const Entities = {\n\tprops: {\n\t\tparentId: {\n\t\t\ttype: [Number, null],\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tcomponents: { ResponsiveHint },\n\n\tdata(): { selectedEntityType: string; }\n\t{\n\t\treturn {\n\t\t\tselectedEntityType: EntityTypes.department,\n\t\t};\n\t},\n\n\temits: ['applyData'],\n\n\tcreated(): void\n\t{\n\t\tthis.hint = null;\n\t\tthis.hintHideTimeout = null;\n\n\t\tconst permissionChecker = PermissionChecker.getInstance();\n\n\t\tconst hasTeamCreatePermission = this.parentId === 0\n\t\t\t? permissionChecker.hasPermissionOfAction(PermissionActions.teamCreate)\n\t\t\t: permissionChecker.hasPermission(PermissionActions.teamCreate, this.parentId)\n\t\t;\n\n\t\tconst hasDepartmentCreatePermission = this.parentId === 0\n\t\t\t? permissionChecker.hasPermissionOfAction(PermissionActions.departmentCreate)\n\t\t\t: permissionChecker.hasPermission(PermissionActions.departmentCreate, this.parentId)\n\t\t;\n\n\t\tthis.entities = [\n\t\t\t{\n\t\t\t\ttype: EntityTypes.department,\n\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_DEPARTMENT_TITLE'),\n\t\t\t\tdescription: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_DEPARTMENT_DESCR_MSGVER_1'),\n\t\t\t\tisEnabled: hasDepartmentCreatePermission,\n\t\t\t\thint: !hasDepartmentCreatePermission\n\t\t\t\t\t&& this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_DEPARTMENT_NO_ACCESS_HINT'),\n\t\t\t\tisSoon: false,\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: EntityTypes.team,\n\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_FUNCTIONAL_TEAM_TITLE_MSGVER_1'),\n\t\t\t\tdescription: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_FUNCTIONAL_TEAM_DESCR_MSGVER_1'),\n\t\t\t\tisEnabled: PermissionChecker.isTeamsAvailable && hasTeamCreatePermission,\n\t\t\t\thint: PermissionChecker.isTeamsAvailable\n\t\t\t\t\t&& !hasTeamCreatePermission\n\t\t\t\t\t&& this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_FUNCTIONAL_TEAM_NO_ACCESS_HINT_MSGVER_1'),\n\t\t\t\tisSoon: !permissionChecker.isTeamsAvailable,\n\t\t\t},\n\t\t];\n\n\t\tfor (const entity of this.entities)\n\t\t{\n\t\t\tif (entity.isEnabled)\n\t\t\t{\n\t\t\t\tthis.selectedEntityType = entity.type;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tthis.applyData(this.selectedEntityType);\n\t},\n\n\tactivated(): void\n\t{\n\t\tthis.applyData(this.selectedEntityType);\n\t},\n\n\tdeactivated(): void\n\t{\n\t\tthis.hint?.hide();\n\t\tclearTimeout(this.hintHideTimeout);\n\t\tthis.hintHideTimeout = null;\n\t},\n\n\tmethods:\n\t{\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tapplyData(entityId: string): void\n\t\t{\n\t\t\tthis.selectedEntityType = entityId;\n\t\t\tthis.$emit('applyData', {\n\t\t\t\tisValid: true,\n\t\t\t\tisDepartmentDataChanged: false,\n\t\t\t\tentityType: this.selectedEntityType,\n\t\t\t});\n\t\t},\n\t\tshowHint(text: string, $event: PointerEvent): void\n\t\t{\n\t\t\tif (this.hintHideTimeout)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst width = 300;\n\t\t\tthis.hint = Reflection.getClass('BX.UI.Hint').createInstance({\n\t\t\t\tpopupParameters: {\n\t\t\t\t\twidth,\n\t\t\t\t\tbindOptions: { position: 'top' },\n\t\t\t\t\toffsetLeft: 225,\n\t\t\t\t\toffsetTop: -23,\n\t\t\t\t\tangle: { offset: width / 2 - 33 / 2 },\n\t\t\t\t},\n\t\t\t});\n\t\t\tthis.hint.show($event.target, text);\n\n\t\t\tthis.hintHideTimeout = setTimeout(() => {\n\t\t\t\tthis.hint?.hide();\n\t\t\t\tthis.hintHideTimeout = null;\n\t\t\t}, 2000);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tv-for=\"entity in entities\"\n\t\t\tclass=\"chart-wizard__entity-wrapper\"\n\t\t>\n\t\t\t<span v-if=\"entity.hint\" @click=\"showHint(entity.hint, $event)\" class=\"ui-hint chart-wizard__entity_hint-layout\"></span>\n\t\t\t<div class=\"chart-wizard__entity\"\n\t\t\t\t :class=\"{ \n\t\t\t\t\t['--' + entity.type.toLowerCase()]: true, \n\t\t\t\t\t'--selected': entity.type === selectedEntityType, \n\t\t\t\t\t'--enabled': entity.isEnabled \n\t\t\t\t}\"\n\t\t\t\t@click=\"entity.isEnabled && applyData(entity.type)\"\n\t\t\t>\n\t\t\t\t<div class=\"chart-wizard__entity_summary\">\n\t\t\t\t\t<h2\n\t\t\t\t\t\tclass=\"chart-wizard__entity_title\"\n\t\t\t\t\t\t:data-title=\"entity.isSoon ? loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_ACCESS_TITLE') : null\"\n\t\t\t\t\t\t:class=\"{ '--disabled': !entity.isEnabled, '--soon': entity.isSoon }\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{entity.title}}\n\t\t\t\t\t</h2>\n\t\t\t\t\t<p class=\"chart-wizard__entity_description\" :class=\"{ '--disabled': !entity.isEnabled}\">\n\t\t\t\t\t\t{{entity.description}}\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { getMemberRoles } from 'humanresources.company-structure.api';\nimport { Text } from 'main.core';\nimport { TagSelector } from 'ui.entity-selector';\nimport { AuthorityTypes } from '../../consts';\nimport { WizardApiEntityChangedDict, NodeSettingsTypes, EntityTypes, type UserData } from 'humanresources.company-structure.utils';\n\n// @vue/component\nexport const Settings = {\n\tname: 'NodeSettings',\n\n\tprops: {\n\t\tname: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\t/** @type {Record<string, Set>} */\n\t\tsettings: {\n\t\t\ttype: Object,\n\t\t\trequired: false,\n\t\t\tdefault: () => {},\n\t\t},\n\t\t/** @type {Record<string, boolean>} */\n\t\tfeatures: {\n\t\t\ttype: Object,\n\t\t\trequired: false,\n\t\t\tdefault: () => {},\n\t\t},\n\t\tshouldErrorHighlight: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tentityType: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\t/** @type UserData[] */\n\t\theads: {\n\t\t\ttype: Array,\n\t\t\trequired: false,\n\t\t\tdefault: () => [],\n\t\t},\n\t},\n\n\temits: ['applyData'],\n\n\tcomputed:\n\t{\n\t\tisTeamEntity(): boolean\n\t\t{\n\t\t\treturn this.entityType === EntityTypes.team;\n\t\t},\n\t\tisBusinessProcHeadNotSelected(): boolean\n\t\t{\n\t\t\tif (!this.isTeamEntity)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst bpSettings = this.settings[NodeSettingsTypes.businessProcAuthority];\n\n\t\t\treturn !bpSettings || bpSettings.size === 0;\n\t\t},\n\t\tbusinessDescription(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_BUSINESS_PROC_DESCRIPTION', {\n\t\t\t\t\t'#DEPARTMENT_NAME#': Text.encode(this.name),\n\t\t\t\t})\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_SETTINGS_BUSINESS_PROC_DESCRIPTION')\n\t\t\t;\n\t\t},\n\t\treportsDescriptions(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_REPORTS_DESCRIPTION', {\n\t\t\t\t\t'#DEPARTMENT_NAME#': Text.encode(this.name),\n\t\t\t\t})\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_SETTINGS_REPORTS_DESCRIPTION')\n\t\t\t;\n\t\t},\n\t\thintTitle(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_HINT_TITLE')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_SETTINGS_HINT_TITLE')\n\t\t\t;\n\t\t},\n\t\tbusinessProcWarningText(): string | null\n\t\t{\n\t\t\tif (this.isTeamEntity)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst memberRoles = getMemberRoles(this.entityType);\n\t\t\tconst hasHead = this.heads.some((item: UserData) => item.role === memberRoles.head);\n\t\t\tconst hasDeputy = this.heads.some((item: UserData) => item.role === memberRoles.deputyHead);\n\t\t\tconst headSelected = this.settings[NodeSettingsTypes.businessProcAuthority].has(AuthorityTypes.departmentHead);\n\t\t\tconst deputySelected = this.settings[NodeSettingsTypes.businessProcAuthority]\n\t\t\t\t.has(AuthorityTypes.departmentDeputy)\n\t\t\t;\n\n\t\t\tif (headSelected && hasHead && deputySelected && !hasDeputy)\n\t\t\t{\n\t\t\t\treturn this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_SETTINGS_BUSINESS_PROC_HAS_HEAD_NO_DEPUTY');\n\t\t\t}\n\n\t\t\tif (headSelected && !hasHead && deputySelected && hasDeputy)\n\t\t\t{\n\t\t\t\treturn this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_SETTINGS_BUSINESS_PROC_NO_HEAD_HAS_DEPUTY');\n\t\t\t}\n\n\t\t\tif (headSelected && !hasHead && deputySelected && !hasDeputy)\n\t\t\t{\n\t\t\t\treturn this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_SETTINGS_BUSINESS_PROC_NO_HEAD_NO_DEPUTY');\n\t\t\t}\n\n\t\t\tif (headSelected && !hasHead && !deputySelected)\n\t\t\t{\n\t\t\t\treturn this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_SETTINGS_BUSINESS_PROC_NO_HEAD');\n\t\t\t}\n\n\t\t\tif (!headSelected && deputySelected && !hasDeputy)\n\t\t\t{\n\t\t\t\treturn this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_SETTINGS_BUSINESS_PROC_NO_DEPUTY');\n\t\t\t}\n\n\t\t\tif (!headSelected && !deputySelected)\n\t\t\t{\n\t\t\t\treturn this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_SETTINGS_BUSINESS_PROC_EMPTY');\n\t\t\t}\n\n\t\t\treturn null;\n\t\t},\n\t},\n\n\twatch:\n\t{\n\t\tsettings:\n\t\t{\n\t\t\thandler(payload: Record<string, Set>): void\n\t\t\t{\n\t\t\t\tif (payload[NodeSettingsTypes.businessProcAuthority])\n\t\t\t\t{\n\t\t\t\t\tconst businessProcPreselected = this.getTagItems(false)\n\t\t\t\t\t\t.filter((item) => payload[NodeSettingsTypes.businessProcAuthority].has(item.id))\n\t\t\t\t\t;\n\n\t\t\t\t\tbusinessProcPreselected.forEach((businessProcPreselectedItem) => {\n\t\t\t\t\t\tconst item = this.businessProcSelector.dialog.getItem(['head-type', businessProcPreselectedItem.id]);\n\n\t\t\t\t\t\tif (item)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.initBpValues.add(businessProcPreselectedItem.id);\n\t\t\t\t\t\t\titem.select();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.hints = [\n\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_HINT_1'),\n\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_HINT_2'),\n\t\t];\n\n\t\tthis.initBpValues = new Set();\n\t\tthis.businessProcSelector = this.getTagSelector(NodeSettingsTypes.businessProcAuthority, false);\n\t\tthis.reportsSelector = this.getTagSelector(NodeSettingsTypes.reportsAuthority, true);\n\t},\n\n\tmounted(): void\n\t{\n\t\tthis.businessProcSelector.renderTo(this.$refs['business-proc-selector']);\n\t\tthis.reportsSelector.renderTo(this.$refs['reports-selector']);\n\t},\n\n\tactivated(): void\n\t{\n\t\tthis.$emit('applyData', {\n\t\t\tisDepartmentDataChanged: false,\n\t\t\tisValid: !this.isBusinessProcHeadNotSelected,\n\t\t});\n\t},\n\n\tmethods:\n\t{\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tapplyData(): void\n\t\t{\n\t\t\tthis.$emit('applyData', {\n\t\t\t\tapiEntityChanged: WizardApiEntityChangedDict.settings,\n\t\t\t\tsettings: this.settings,\n\t\t\t\tisDepartmentDataChanged: true,\n\t\t\t\tisValid: !this.isBusinessProcHeadNotSelected,\n\t\t\t});\n\t\t},\n\t\tgetTagSelector(settingType: string, locked: boolean): TagSelector\n\t\t{\n\t\t\treturn new TagSelector({\n\t\t\t\tevents: {\n\t\t\t\t\tonTagAdd: (event: BaseEvent) => {\n\t\t\t\t\t\tconst { tag } = event.getData();\n\t\t\t\t\t\tthis.settings[settingType].add(tag.id);\n\n\t\t\t\t\t\tif (this.initBpValues.has(tag.id))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.initBpValues.delete(tag.id);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.applyData();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tonTagRemove: (event: BaseEvent) => {\n\t\t\t\t\t\tconst { tag } = event.getData();\n\t\t\t\t\t\tthis.settings[settingType].delete(tag.id);\n\t\t\t\t\t\tthis.applyData();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tmultiple: true,\n\t\t\t\tid: 'head-type-selector',\n\t\t\t\tlocked,\n\t\t\t\ttagFontWeight: '700',\n\t\t\t\tshowAddButton: !locked,\n\t\t\t\tdialogOptions: {\n\t\t\t\t\tid: 'head-type-selector',\n\t\t\t\t\tevents: {\n\t\t\t\t\t\t'Item:onBeforeSelect': (event: BaseEvent) => {\n\t\t\t\t\t\t\tconst { item } = event.getData();\n\t\t\t\t\t\t\tif (!item.getCustomData()?.get('selectable'))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\twidth: 400,\n\t\t\t\t\theight: 200,\n\t\t\t\t\ttagMaxWidth: 400,\n\t\t\t\t\tdropdownMode: true,\n\t\t\t\t\tshowAvatars: false,\n\t\t\t\t\tselectedItems: this.getTagItems(locked).filter(((item) => this.settings[settingType].has(item.id))),\n\t\t\t\t\titems: this.getTagItems(locked),\n\t\t\t\t\tundeselectedItems: this.features.isDeputyApprovesBPAvailable || !this.isTeamEntity\n\t\t\t\t\t\t? []\n\t\t\t\t\t\t: [['head-type', AuthorityTypes.departmentHead]],\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t\tgetTagItems(locked: boolean): Array\n\t\t{\n\t\t\tconst lockedTagOptions = {\n\t\t\t\tbgColor: '#BDC1C6',\n\t\t\t\ttextColor: '#525C69',\n\t\t\t};\n\t\t\tconst departmentTagOptions = {\n\t\t\t\tbgColor: '#ADE7E4',\n\t\t\t\ttextColor: '#207976',\n\t\t\t\tmaxWidth: 400,\n\t\t\t};\n\t\t\tconst teamTagOptions = {\n\t\t\t\tbgColor: '#CCE3FF',\n\t\t\t\ttextColor: '#3592FF',\n\t\t\t\tmaxWidth: 400,\n\t\t\t};\n\n\t\t\tconst soonItemOptions = {\n\t\t\t\tcustomData: { selectable: false },\n\t\t\t\ttextColor: '#C9CCD0',\n\t\t\t\tbadges: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_SOON_ITEM_BADGE'),\n\t\t\t\t\t\ttextColor: '#FFFFFF',\n\t\t\t\t\t\tbgColor: '#2FC6F6',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tbadgesOptions: {\n\t\t\t\t\tjustifyContent: 'right',\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tconst deputyOptions = this.features.isDeputyApprovesBPAvailable || !this.isTeamEntity\n\t\t\t\t? { customData: { selectable: true } }\n\t\t\t\t: soonItemOptions\n\t\t\t;\n\n\t\t\tconst departmentHead = {\n\t\t\t\tid: AuthorityTypes.departmentHead,\n\t\t\t\tentityId: 'head-type',\n\t\t\t\ttabs: 'recents',\n\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_DEPARTMENT_HEAD_ITEM'),\n\t\t\t\ttagOptions: locked ? lockedTagOptions : departmentTagOptions,\n\t\t\t\tcustomData: { selectable: true },\n\t\t\t};\n\n\t\t\tconst teamHead = {\n\t\t\t\tid: AuthorityTypes.teamHead,\n\t\t\t\tentityId: 'head-type',\n\t\t\t\ttabs: 'recents',\n\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_TEAM_HEAD_ITEM'),\n\t\t\t\ttagOptions: locked ? lockedTagOptions : teamTagOptions,\n\t\t\t\tcustomData: { selectable: true },\n\t\t\t};\n\n\t\t\tconst departmentDeputy = {\n\t\t\t\tid: AuthorityTypes.departmentDeputy,\n\t\t\t\tentityId: 'head-type',\n\t\t\t\ttabs: 'recents',\n\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_DEPARTMENT_DEPUTY_ITEM'),\n\t\t\t\ttagOptions: locked ? lockedTagOptions : departmentTagOptions,\n\t\t\t\t...deputyOptions,\n\t\t\t};\n\n\t\t\tconst teamDeputy = {\n\t\t\t\tid: AuthorityTypes.teamDeputy,\n\t\t\t\tentityId: 'head-type',\n\t\t\t\ttabs: 'recents',\n\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_TEAM_DEPUTY_ITEM'),\n\t\t\t\ttagOptions: locked ? lockedTagOptions : teamTagOptions,\n\t\t\t\t...deputyOptions,\n\t\t\t};\n\n\t\t\tif (this.isTeamEntity)\n\t\t\t{\n\t\t\t\treturn this.features.isDeputyApprovesBPAvailable\n\t\t\t\t\t? [departmentHead, departmentDeputy, teamHead, teamDeputy]\n\t\t\t\t\t: [departmentHead, teamHead, departmentDeputy, teamDeputy]\n\t\t\t\t;\n\t\t\t}\n\n\t\t\treturn [departmentHead, departmentDeputy];\n\t\t},\n\t\tgoToBPHelp(event): void\n\t\t{\n\t\t\tif (top.BX.Helper)\n\t\t\t{\n\t\t\t\tevent.preventDefault();\n\t\t\t\ttop.BX.Helper.show('redirect=detail&code=25455744');\n\t\t\t}\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"chart-wizard__settings\">\n\t\t\t<div class=\"chart-wizard__settings__item\" :class=\"{ '--team': isTeamEntity }\">\n\t\t\t\t<div class=\"chart-wizard__settings__item-hint\">\n\t\t\t\t\t<div class=\"chart-wizard__settings__item-hint_logo\"></div>\n\t\t\t\t\t<div class=\"chart-wizard__settings__item-hint_text\">\n\t\t\t\t\t\t<div class=\"chart-wizard__settings__item-hint_title\">\n\t\t\t\t\t\t\t{{ hintTitle }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-for=\"hint in hints\"\n\t\t\t\t\t\t\tclass=\"chart-wizard__settings__item-hint_text-item\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\"chart-wizard__settings__item-hint_text-item_icon\"></div>\n\t\t\t\t\t\t\t<span>{{ hint }}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__settings__item-options\">\n\t\t\t\t\t<div class=\"chart-wizard__settings__item-options__item-content_title\"\n\t\t\t\t\t\t :data-title=\"loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_ACCESS_TITLE')\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"chart-wizard__settings__item-options__item-content_title-text\">\n\t\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_BUSINESS_PROC_TITLE') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<span v-if=\"isTeamEntity\" class=\"ui-hint\" @click=\"goToBPHelp\">\n\t\t\t\t\t\t\t<span class=\"ui-hint-icon\"/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"chart-wizard__settings__item-description-container\">\n\t\t\t\t\t\t<span class=\"chart-wizard__settings__item-description-text\" v-html=\"businessDescription\">\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"chart-wizard__settings__business-proc-selector\"\n\t\t\t\t\t\t:class=\"{ 'ui-ctl-warning': (isBusinessProcHeadNotSelected) }\"\n\t\t\t\t\t\tref=\"business-proc-selector\"\n\t\t\t\t\t\tdata-test-id=\"hr-company-structure__settings__business-proc-selector\"\n\t\t\t\t\t/>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"isBusinessProcHeadNotSelected\"\n\t\t\t\t\t\tclass=\"chart-wizard__settings__item-options-error\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"ui-icon-set --warning\"></div>\n\t\t\t\t\t\t<span class=\"chart-wizard__settings__item-options-error-message\">\n\t\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_BUSINESS_PROC_HEAD_ERROR') }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-else-if=\"businessProcWarningText\"\n\t\t\t\t\t\tclass=\"chart-wizard__settings__item-options-warning\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"ui-icon-set --warning\"></div>\n\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t{{ businessProcWarningText }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__settings__item-options\">\n\t\t\t\t\t<div class=\"chart-wizard__settings__item-options__item-content_title --soon\"\n\t\t\t\t\t\t :data-title=\"loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_ACCESS_TITLE')\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"chart-wizard__settings__item-options__item-content_title-text --soon\">\n\t\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_REPORTS_TITLE') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<span v-if=\"isTeamEntity\" class=\"chart-wizard__settings_ui-hint-disabled\">\n\t\t\t\t\t\t\t<span class=\"ui-hint-icon\"/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"chart-wizard__settings__item-description-container\">\n\t\t\t\t\t\t<span class=\"chart-wizard__settings__item-description-text --soon\" v-html=\"reportsDescriptions\">\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"chart-wizard__settings__reports-selector\"\n\t\t\t\t\t\tref=\"reports-selector\"\n\t\t\t\t\t\tdata-test-id=\"hr-company-structure__settings__reports-selector\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","// @vue/component\nexport const AccessDenied = {\n\tname: 'AccessDenied',\n\n\tmounted(): void\n\t{\n\t\t// enable 'next' button\n\t\tthis.$emit('applyData', {\n\t\t\tisDepartmentDataChanged: false,\n\t\t\tisValid: true,\n\t\t});\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"chart-wizard__access-denied\">\n\t\t\t<div class=\"chart-wizard__access-denied_icon\"></div>\n\t\t\t<div class=\"chart-wizard__access-denied_title\">\n\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ACCESS_DENIED_TITLE') }}\n\t\t\t</div>\n\t\t\t<div class=\"chart-wizard__access-denied_description\">\n\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ACCESS_DENIED_DESCRIPTION') }}\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { getData, postData } from 'humanresources.company-structure.api';\nimport type { ChatListResponse } from 'humanresources.company-structure.utils';\nimport { DepartmentUserIds } from './types';\n\nexport const WizardAPI = {\n\tcreateDepartment: (\n\t\tname: string,\n\t\tparentId: number,\n\t\tdescription: ?string,\n\t\tuserIds: DepartmentUserIds,\n\t\tmoveUsersToDepartment: number,\n\t\tcreateChat: number,\n\t\tbindingChatIds: number[],\n\t\tcreateChannel: number,\n\t\tbindingChannelIds: number[],\n\t\tcreateCollab: number,\n\t\tbindingCollabIds: number[],\n\t\tsettings: {},\n\t): Promise<void> => {\n\t\treturn postData('humanresources.api.Structure.Department.create', {\n\t\t\tname,\n\t\t\tparentId,\n\t\t\tdescription,\n\t\t\tuserIds,\n\t\t\tmoveUsersToDepartment,\n\t\t\tcreateChat,\n\t\t\tbindingChatIds,\n\t\t\tcreateChannel,\n\t\t\tbindingChannelIds,\n\t\t\tcreateCollab,\n\t\t\tbindingCollabIds,\n\t\t\tsettings,\n\t\t});\n\t},\n\tcreateTeam: (\n\t\tname: string,\n\t\tparentId: number,\n\t\tdescription: ?string,\n\t\tcolorName: ?string,\n\t\tuserIds: DepartmentUserIds,\n\t\tcreateChat: number,\n\t\tbindingChatIds: number[],\n\t\tcreateChannel: number,\n\t\tbindingChannelIds: number[],\n\t\tcreateCollab: number,\n\t\tbindingCollabIds: number[],\n\t\tsettings: {},\n\t): Promise<void> => {\n\t\treturn postData('humanresources.api.Structure.Team.create', {\n\t\t\tname,\n\t\t\tparentId,\n\t\t\tdescription,\n\t\t\tcolorName,\n\t\t\tuserIds,\n\t\t\tcreateChat,\n\t\t\tbindingChatIds,\n\t\t\tcreateChannel,\n\t\t\tbindingChannelIds,\n\t\t\tcreateCollab,\n\t\t\tbindingCollabIds,\n\t\t\tsettings,\n\t\t});\n\t},\n\taddDepartment: (\n\t\tname: string,\n\t\tparentId: number,\n\t\tdescription: ?string,\n\t\tentityType: ?string,\n\t\tcolorName: ?string,\n\t): Promise<void> => {\n\t\treturn postData('humanresources.api.Structure.Node.add', {\n\t\t\tname,\n\t\t\tparentId,\n\t\t\tdescription,\n\t\t\tentityType,\n\t\t\tcolorName,\n\t\t});\n\t},\n\tgetEmployees: (nodeId: number): Promise<Array<number>> => {\n\t\treturn postData('humanresources.api.Structure.Node.Member.Employee.getIds', { nodeId });\n\t},\n\tupdateDepartment: (\n\t\tnodeId: number,\n\t\tparentId: number,\n\t\tname: string,\n\t\tdescription: ?string,\n\t\tcolorName: ?string,\n\t): Promise<void> => {\n\t\treturn postData('humanresources.api.Structure.Node.update', {\n\t\t\tnodeId,\n\t\t\tname,\n\t\t\tparentId,\n\t\t\tdescription,\n\t\t\tcolorName,\n\t\t});\n\t},\n\tsaveUsers: (nodeId: number, userIds: DepartmentUserIds, parentId: ?number): Promise<Array> => {\n\t\treturn postData('humanresources.api.Structure.Node.Member.saveUserList', {\n\t\t\tnodeId,\n\t\t\tuserIds,\n\t\t\tparentId,\n\t\t});\n\t},\n\tmoveUsers: (nodeId: number, userIds: DepartmentUserIds, parentId: ?number): Promise<Array> => {\n\t\treturn postData('humanresources.api.Structure.Node.Member.moveUserListToDepartment', {\n\t\t\tnodeId,\n\t\t\tuserIds,\n\t\t\tparentId,\n\t\t});\n\t},\n\tsaveChats: (\n\t\tnodeId: number,\n\t\tids: number[],\n\t\tcreateDefault: number,\n\t\tremoveIds: number[],\n\t): Promise<void> => {\n\t\treturn postData('humanresources.api.Structure.Node.Member.Chat.saveChatList', {\n\t\t\tnodeId,\n\t\t\tcreateDefault,\n\t\t\tids,\n\t\t\tremoveIds,\n\t\t});\n\t},\n\tsaveChannels: (\n\t\tnodeId: number,\n\t\tids: number[],\n\t\tcreateDefault: number,\n\t\tremoveIds: number[],\n\t): Promise<void> => {\n\t\treturn postData('humanresources.api.Structure.Node.Member.Chat.saveChannelList', {\n\t\t\tnodeId,\n\t\t\tcreateDefault,\n\t\t\tids,\n\t\t\tremoveIds,\n\t\t});\n\t},\n\tsaveCollabs: (\n\t\tnodeId: number,\n\t\tids: number[],\n\t\tcreateDefault: number,\n\t\tremoveIds: number[],\n\t): Promise<void> => {\n\t\treturn postData('humanresources.api.Structure.Node.Member.Chat.saveCollabList', {\n\t\t\tnodeId,\n\t\t\tcreateDefault,\n\t\t\tids,\n\t\t\tremoveIds,\n\t\t});\n\t},\n\tcreateSettings: (\n\t\tnodeId: number,\n\t\tsettings: Record<string, {values: string[], replace: boolean}>,\n\t\tparentId: ?number,\n\t): Promise<void> => {\n\t\treturn postData('humanresources.api.Structure.Node.NodeSettings.create', {\n\t\t\tsettings,\n\t\t\tnodeId,\n\t\t\tparentId,\n\t\t});\n\t},\n\tupdateSettings: (\n\t\tnodeId: number,\n\t\tsettings: Record<string, {values: string[], replace: boolean}>,\n\t\tparentId: ?number,\n\t): Promise<void> => {\n\t\treturn postData('humanresources.api.Structure.Node.NodeSettings.update', {\n\t\t\tsettings,\n\t\t\tnodeId,\n\t\t\tparentId,\n\t\t});\n\t},\n\tgetSettings: (nodeId: number): Promise<Array<number>> => {\n\t\treturn postData('humanresources.api.Structure.Node.NodeSettings.get', { nodeId });\n\t},\n\tgetChatsAndChannels: (nodeId: number): Promise<ChatListResponse> => {\n\t\treturn getData('humanresources.api.Structure.Node.Member.Chat.getList', {\n\t\t\tnodeId,\n\t\t});\n\t},\n};\n","import { useChartStore, UserService } from 'humanresources.company-structure.chart-store';\nimport type { DepartmentData } from './types';\n\nexport const chartWizardActions = {\n\tcreateDepartment: async (departmentData: DepartmentData): void => {\n\t\tconst { departments, structureMap } = useChartStore();\n\t\tconst { id: departmentId, parentId, entityType } = departmentData;\n\t\tconst parent = departments.get(parentId);\n\t\tparent.children = [...parent.children ?? [], departmentId];\n\t\tstructureMap.set(departmentId, {\n\t\t\tid: departmentId,\n\t\t\tparentId,\n\t\t\tentityType,\n\t\t});\n\t\tdepartments.set(departmentId, {\n\t\t\t...departmentData,\n\t\t\tid: departmentId,\n\t\t\tchats: null,\n\t\t\tchannels: null,\n\t\t});\n\n\t\tawait UserService.refreshMultipleUsers();\n\t},\n\tmoveUsersToRootDepartment: (removedUsers: number[], userMovedToRootIds: number[]): void => {\n\t\tconst { departments } = useChartStore();\n\t\tconst rootEmployees = removedUsers.filter((user) => userMovedToRootIds.includes(user.id));\n\t\tconst rootNode = [...departments.values()].find((department) => department.parentId === 0);\n\t\tdepartments.set(rootNode.id, {\n\t\t\t...rootNode,\n\t\t\temployees: [...(rootNode.employees || []), ...rootEmployees],\n\t\t\tuserCount: rootNode.userCount + rootEmployees.length,\n\t\t});\n\n\t\tUserService.refreshMultipleUsers();\n\t},\n\trefreshDepartments: (ids: number[]): void => {\n\t\tconst store = useChartStore();\n\t\tstore.refreshDepartments(ids);\n\t},\n\ttryToAddCurrentDepartment(departmentData: DepartmentData, departmentId: number): void\n\t{\n\t\tconst store = useChartStore();\n\t\tconst { heads, employees } = departmentData;\n\t\tconst isCurrentUserAdd = [...heads, ...employees].some((user) => {\n\t\t\treturn user.id === store.userId;\n\t\t});\n\t\tif (isCurrentUserAdd)\n\t\t{\n\t\t\tstore.changeCurrentDepartment(0, departmentId);\n\t\t}\n\t},\n};\n","import { UI } from 'ui.notification';\nimport { MessageBox, MessageBoxButtons } from 'ui.dialogs.messagebox';\nimport { mapState } from 'ui.vue3.pinia';\nimport { Event } from 'main.core';\nimport { useChartStore, UserService } from 'humanresources.company-structure.chart-store';\nimport { getMemberRoles, reportedErrorTypes } from 'humanresources.company-structure.api';\nimport { DepartmentContentActions } from 'humanresources.company-structure.department-content';\nimport { StepIds, AuthorityTypes } from '../consts';\nimport { TreePreview } from './tree-preview/tree-preview';\nimport { Department } from './steps/department';\nimport { Employees } from './steps/employees';\nimport { BindChat } from './steps/bind-chat';\nimport { Entities } from './steps/entities';\nimport { Settings } from './steps/settings';\nimport { AccessDenied } from './steps/access-denied';\nimport { WizardAPI } from '../api';\nimport { chartWizardActions } from '../actions';\nimport { sendData as analyticsSendData } from 'ui.analytics';\nimport { PermissionActions, PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport type { WizardData, Step, DepartmentUserIds } from '../types';\nimport { EntityTypes, NodeColorsSettingsDict, WizardApiEntityChangedDict, NodeSettingsTypes } from 'humanresources.company-structure.utils';\nimport 'ui.buttons';\nimport 'ui.forms';\nimport '../style.css';\n\nconst SaveMode = Object.freeze({\n\tmoveUsers: 'moveUsers',\n\taddUsers: 'addUsers',\n});\n\nexport const ChartWizard = {\n\tname: 'chartWizard',\n\n\temits: ['modifyTree', 'close'],\n\n\tcomponents: { Department, Employees, BindChat, TreePreview, Entities, Settings, AccessDenied },\n\n\tprops: {\n\t\tnodeId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tisEditMode: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tshowEntitySelector: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t},\n\t\t/** @type StepIdType */\n\t\tentity: {\n\t\t\ttype: String,\n\t\t},\n\t\tentityType: {\n\t\t\ttype: String,\n\t\t\tdefault: EntityTypes.department,\n\t\t},\n\t\tsource: {\n\t\t\ttype: String,\n\t\t},\n\t\trefToFocus: {\n\t\t\ttype: String,\n\t\t\tdefault: null,\n\t\t},\n\t},\n\n\tdata(): WizardData\n\t{\n\t\treturn {\n\t\t\tstepIndex: 0,\n\t\t\twaiting: false,\n\t\t\tisValidStep: false,\n\t\t\tisDepartmentDataChanged: false,\n\t\t\tdepartmentData: {\n\t\t\t\tid: 0,\n\t\t\t\tparentId: 0,\n\t\t\t\tname: '',\n\t\t\t\tdescription: '',\n\t\t\t\theads: [],\n\t\t\t\temployees: [],\n\t\t\t\tchats: [],\n\t\t\t\tchannels: [],\n\t\t\t\tcollabs: [],\n\t\t\t\tuserCount: 0,\n\t\t\t\tcreateDefaultChat: false,\n\t\t\t\tcreateDefaultChannel: false,\n\t\t\t\tteamColor: NodeColorsSettingsDict.blue,\n\t\t\t\tentityType: EntityTypes.department,\n\t\t\t\tsettings: {\n\t\t\t\t\t[NodeSettingsTypes.businessProcAuthority]: new Set([AuthorityTypes.departmentHead]),\n\t\t\t\t\t[NodeSettingsTypes.reportsAuthority]: new Set([AuthorityTypes.departmentHead]),\n\t\t\t\t},\n\t\t\t},\n\t\t\tremovedUsers: [],\n\t\t\tmoveUsersMap: [],\n\t\t\temployeesIds: [],\n\t\t\tdepartmentSettings: {\n\t\t\t\t[NodeSettingsTypes.businessProcAuthority]: new Set([AuthorityTypes.departmentHead]),\n\t\t\t\t[NodeSettingsTypes.reportsAuthority]: new Set([AuthorityTypes.departmentHead]),\n\t\t\t},\n\t\t\tinitChats: [],\n\t\t\tinitChannels: [],\n\t\t\tinitCollabs: [],\n\t\t\tshouldErrorHighlight: false,\n\t\t\tsteps: [],\n\t\t\tsaveMode: SaveMode.moveUsers,\n\t\t\tpermissionChecker: null,\n\t\t};\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.permissionChecker = PermissionChecker.getInstance();\n\t\tthis.init();\n\t},\n\n\tbeforeUnmount(): void\n\t{\n\t\tEvent.unbind(window, 'beforeunload', this.handleBeforeUnload);\n\t},\n\n\tcomputed: {\n\t\tbreadcrumbsTitle(): string\n\t\t{\n\t\t\tif (this.isEditMode)\n\t\t\t{\n\t\t\t\treturn this.isTeamEntity\n\t\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EDIT_TEAM_TITLE')\n\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EDIT_TITLE')\n\t\t\t\t;\n\t\t\t}\n\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_CREATE_TEAM_TITLE')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_CREATE_TITLE')\n\t\t\t;\n\t\t},\n\t\tcloseConfirmTitle(): string\n\t\t{\n\t\t\tif (this.isEditMode)\n\t\t\t{\n\t\t\t\treturn this.departmentData?.entityType === EntityTypes.team\n\t\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_CLOSE_EDIT_WIZARD_TEAM_TITLE')\n\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_CLOSE_EDIT_WIZARD_DEPARTMENT_TITLE')\n\t\t\t\t;\n\t\t\t}\n\n\t\t\treturn this.departmentData?.entityType === EntityTypes.team\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_CLOSE_CREATE_WIZARD_TEAM_TITLE')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_CLOSE_CREATE_WIZARD_DEPARTMENT_TITLE')\n\t\t\t;\n\t\t},\n\t\tcurrentStep(): Step\n\t\t{\n\t\t\treturn this.steps[this.stepIndex];\n\t\t},\n\t\tisDeputyApprovesBPAvailable(): boolean\n\t\t{\n\t\t\tif (!this.permissionChecker)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.permissionChecker.checkDeputyApprovalBPAvailable();\n\t\t},\n\t\tisDepartmentSettingsAvailable(): boolean\n\t\t{\n\t\t\tif (!this.permissionChecker)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.permissionChecker.checkDepartmentSettingsAvailable();\n\t\t},\n\t\tcomponentInfo(): { name: string, params?: Object }\n\t\t{\n\t\t\tif (!this.currentStep.isPermitted)\n\t\t\t{\n\t\t\t\treturn {\n\t\t\t\t\tname: 'AccessDenied',\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tconst {\n\t\t\t\tparentId,\n\t\t\t\tname,\n\t\t\t\tdescription,\n\t\t\t\theads,\n\t\t\t\tentityType,\n\t\t\t\tteamColor,\n\t\t\t\temployees,\n\t\t\t} = this.departmentData;\n\n\t\t\tconst components = {\n\t\t\t\t[StepIds.department]: {\n\t\t\t\t\tname: 'Department',\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tparentId,\n\t\t\t\t\t\tname,\n\t\t\t\t\t\tdescription,\n\t\t\t\t\t\tentityType,\n\t\t\t\t\t\tteamColor,\n\t\t\t\t\t\trefToFocus: this.refToFocus,\n\t\t\t\t\t\tshouldErrorHighlight: this.shouldErrorHighlight,\n\t\t\t\t\t\tisEditMode: this.isEditMode,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t[StepIds.employees]: {\n\t\t\t\t\tname: 'Employees',\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tentityId: this.nodeId,\n\t\t\t\t\t\theads,\n\t\t\t\t\t\tentityType,\n\t\t\t\t\t\temployeesIds: this.employeesIds,\n\t\t\t\t\t\tisEditMode: this.isEditMode,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t[StepIds.bindChat]: {\n\t\t\t\t\tname: 'BindChat',\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tentityId: this.nodeId,\n\t\t\t\t\t\theads,\n\t\t\t\t\t\temployees,\n\t\t\t\t\t\temployeesIds: this.employeesIds,\n\t\t\t\t\t\tname,\n\t\t\t\t\t\tentityType,\n\t\t\t\t\t\tisEditMode: this.isEditMode,\n\t\t\t\t\t\tinitChats: this.initChats,\n\t\t\t\t\t\tinitChannels: this.initChannels,\n\t\t\t\t\t\tinitCollabs: this.initCollabs,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t[StepIds.settings]: {\n\t\t\t\t\tname: 'Settings',\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tname,\n\t\t\t\t\t\theads,\n\t\t\t\t\t\tsettings: this.departmentSettings,\n\t\t\t\t\t\tentityType,\n\t\t\t\t\t\tfeatures: {\n\t\t\t\t\t\t\tisDeputyApprovesBPAvailable: this.isDeputyApprovesBPAvailable,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tshouldErrorHighlight: this.shouldErrorHighlight,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t[StepIds.entities]: {\n\t\t\t\t\tname: 'Entities',\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tparentId,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t};\n\n\t\t\treturn components[this.currentStep.id];\n\t\t},\n\t\tisFirstStep(): boolean\n\t\t{\n\t\t\treturn this.currentStep.id === StepIds.entities;\n\t\t},\n\t\tbreadcrumbsSteps(): Step[]\n\t\t{\n\t\t\treturn this.steps.filter((step) => step.hasBreadcrumbs);\n\t\t},\n\t\trootId(): number\n\t\t{\n\t\t\tconst { id } = [...this.departments.values()].find((department) => {\n\t\t\t\treturn department.parentId === 0;\n\t\t\t});\n\n\t\t\treturn id;\n\t\t},\n\t\tisTeamEntity(): boolean\n\t\t{\n\t\t\treturn this.departmentData?.entityType === EntityTypes.team;\n\t\t},\n\t\tentityAnalyticsCategory(): string\n\t\t{\n\t\t\treturn this.isTeamEntity ? 'team' : 'dept';\n\t\t},\n\t\tcreateButtonText(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_CREATE_TEAM_BTN')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_CREATE_BTN')\n\t\t\t;\n\t\t},\n\t\t...mapState(useChartStore, ['departments', 'userId', 'currentDepartments']),\n\t},\n\n\tmethods: {\n\t\thandleBeforeUnload(event: Event): void\n\t\t{\n\t\t\tevent.preventDefault();\n\t\t},\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tmapRawSettings(rawSettings: number[]): Object<string, Set<(string)>>\n\t\t{\n\t\t\treturn rawSettings.reduce((acc, { settingsType, settingsValue }) => {\n\t\t\t\tif (!Object.hasOwn(acc, settingsType))\n\t\t\t\t{\n\t\t\t\t\tacc[settingsType] = new Set();\n\t\t\t\t}\n\n\t\t\t\tacc[settingsType].add(settingsValue);\n\n\t\t\t\treturn acc;\n\t\t\t}, {});\n\t\t},\n\t\tasync init(): Promise<void>\n\t\t{\n\t\t\tthis.apiEntityChanged = new Set();\n\n\t\t\t// Important: we need to call createSteps as soon as we get entityType or determine a lack of it\n\n\t\t\tEvent.bind(window, 'beforeunload', this.handleBeforeUnload);\n\t\t\tif (this.isEditMode)\n\t\t\t{\n\t\t\t\tconst {\n\t\t\t\t\tid,\n\t\t\t\t\tname,\n\t\t\t\t\tdescription,\n\t\t\t\t\tparentId,\n\t\t\t\t\theads,\n\t\t\t\t\tuserCount,\n\t\t\t\t\tchildren,\n\t\t\t\t\tentityType,\n\t\t\t\t\tteamColor,\n\t\t\t\t\temployees = [],\n\t\t\t\t} = this.departments.get(this.nodeId);\n\n\t\t\t\tthis.getMemberRoles(entityType);\n\t\t\t\tthis.createSteps(entityType, id);\n\t\t\t\tthis.stepIndex = this.steps.indexOf(this.getStepById(this.entity));\n\t\t\t\tthis.createDefaultSaveMode(entityType);\n\n\t\t\t\tthis.departmentData = {\n\t\t\t\t\t...this.departmentData,\n\t\t\t\t\tid,\n\t\t\t\t\tparentId,\n\t\t\t\t\tname,\n\t\t\t\t\tdescription,\n\t\t\t\t\theads,\n\t\t\t\t\tuserCount,\n\t\t\t\t\tchildren,\n\t\t\t\t\temployees,\n\t\t\t\t\tentityType,\n\t\t\t\t\tteamColor,\n\t\t\t\t\tcreateDefaultChat: false,\n\t\t\t\t\tcreateDefaultChannel: false,\n\t\t\t\t};\n\t\t\t\tconst rawSettings = await WizardAPI.getSettings(this.nodeId);\n\t\t\t\tconst newSettings = this.mapRawSettings(rawSettings);\n\n\t\t\t\tthis.departmentSettings[NodeSettingsTypes.businessProcAuthority] = new Set();\n\t\t\t\tthis.departmentSettings = {\n\t\t\t\t\t...this.departmentSettings,\n\t\t\t\t\t...newSettings,\n\t\t\t\t};\n\n\t\t\t\t// store directly bound chats and channels\n\t\t\t\tconst rawChatsAndChannels = await WizardAPI.getChatsAndChannels(this.nodeId);\n\t\t\t\tthis.initChats = rawChatsAndChannels.chats.filter((item) => !item.originalNodeId);\n\t\t\t\tthis.initChannels = rawChatsAndChannels.channels.filter((item) => !item.originalNodeId);\n\t\t\t\tthis.initCollabs = rawChatsAndChannels.collabs.filter((item) => !item.originalNodeId);\n\n\t\t\t\tthis.employeesIds = await WizardAPI.getEmployees(this.nodeId);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.entityType)\n\t\t\t{\n\t\t\t\tthis.departmentData.entityType = this.entityType;\n\t\t\t}\n\n\t\t\tthis.getMemberRoles(this.entityType);\n\t\t\tthis.createSteps(this.entityType, this.departmentData.id);\n\t\t\tthis.createDefaultSaveMode(this.entityType);\n\n\t\t\tif (this.nodeId)\n\t\t\t{\n\t\t\t\tthis.departmentData.parentId = this.nodeId;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.departmentData.parentId = 0;\n\n\t\t\tanalyticsSendData({\n\t\t\t\ttool: 'structure',\n\t\t\t\tcategory: 'structure',\n\t\t\t\tevent: 'create_wizard',\n\t\t\t\tc_element: this.source,\n\t\t\t});\n\t\t},\n\t\tgetMemberRoles(entityType): void\n\t\t{\n\t\t\tthis.memberRoles = getMemberRoles(entityType);\n\t\t},\n\t\tmove(buttonId: string = 'next'): void\n\t\t{\n\t\t\tif (!this.isValidStep)\n\t\t\t{\n\t\t\t\tthis.shouldErrorHighlight = true;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.stepIndex = buttonId === 'back' ? this.stepIndex - 1 : this.stepIndex + 1;\n\t\t\tthis.pickStepsAnalytics();\n\t\t},\n\t\tmoveToStep(stepId: string): void\n\t\t{\n\t\t\tif (!this.isValidStep)\n\t\t\t{\n\t\t\t\tthis.shouldErrorHighlight = true;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.stepIndex = this.steps.indexOf(this.getStepById(stepId, true));\n\t\t\tthis.pickStepsAnalytics();\n\t\t},\n\t\tgetStepById(stepId: string, force: false): Step\n\t\t{\n\t\t\tconst stepIndex = this.steps.findIndex((step) => stepId === step.id);\n\n\t\t\tif (stepIndex > -1 && (this.steps[stepIndex].isEditPermitted || force))\n\t\t\t{\n\t\t\t\treturn this.steps[stepIndex];\n\t\t\t}\n\n\t\t\treturn this.steps.find((step, index) => step.isEditPermitted && index > stepIndex)\n\t\t\t\t|| this.steps.find((step) => StepIds.department === step.id)\n\t\t\t;\n\t\t},\n\t\tclose(sendEvent: boolean = false): void\n\t\t{\n\t\t\tthis.$emit('close');\n\n\t\t\tif (sendEvent)\n\t\t\t{\n\t\t\t\tanalyticsSendData({\n\t\t\t\t\ttool: 'structure',\n\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\tevent: 'cancel_wizard',\n\t\t\t\t\ttype: this.entityAnalyticsCategory,\n\t\t\t\t\tc_element: this.source,\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tcloseWithConfirm(): void\n\t\t{\n\t\t\tif (!this.isDepartmentDataChanged)\n\t\t\t{\n\t\t\t\tthis.close(true);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst confirmPopup = new MessageBox({\n\t\t\t\ttitle: this.closeConfirmTitle,\n\t\t\t\tmessage: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_CLOSE_WIZARD_MESSAGE'),\n\t\t\t\tyesCaption: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_CLOSE_WIZARD_OK_CAPTION'),\n\t\t\t\tnoCaption: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_CLOSE_WIZARD_NO_CAPTION'),\n\t\t\t\tonYes: () => {\n\t\t\t\t\tthis.close(true);\n\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t\tminHeight: 155,\n\t\t\t\tbuttons: MessageBoxButtons.YES_NO,\n\t\t\t\tpopupOptions: {\n\t\t\t\t\tcloseIcon: true,\n\t\t\t\t\tclassName: 'humanresources-chart-wizard__close-confirm-popup',\n\t\t\t\t},\n\t\t\t});\n\t\t\tconfirmPopup.getYesButton().setRound(true);\n\t\t\tconfirmPopup.getNoButton().setRound(true);\n\t\t\tconfirmPopup.show();\n\t\t},\n\t\tonApplyData(\n\t\t\tdata: {\n\t\t\t\tisValid?: boolean,\n\t\t\t\tisDepartmentDataChanged?: boolean,\n\t\t\t\tremovedUsers?: User, ...Partial<WizardData['departmentData']>\n\t\t\t},\n\t\t): void\n\t\t{\n\t\t\tconst prevEntityType = this.departmentData.entityType;\n\t\t\tconst {\n\t\t\t\tisValid = true,\n\t\t\t\tremovedUsers = [],\n\t\t\t\tmoveUsersMap = {},\n\t\t\t\tisDepartmentDataChanged = true,\n\t\t\t\tapiEntityChanged = null,\n\t\t\t\t...departmentData\n\t\t\t} = data;\n\t\t\tthis.isValidStep = isValid;\n\t\t\tthis.isDepartmentDataChanged = this.isDepartmentDataChanged || isDepartmentDataChanged;\n\n\t\t\tif (apiEntityChanged)\n\t\t\t{\n\t\t\t\tthis.apiEntityChanged.add(apiEntityChanged);\n\t\t\t}\n\n\t\t\tif (departmentData)\n\t\t\t{\n\t\t\t\tthis.departmentData = {\n\t\t\t\t\t...this.departmentData,\n\t\t\t\t\t...departmentData,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tthis.removedUsers = removedUsers;\n\t\t\tthis.moveUsersMap = moveUsersMap;\n\t\t\tif (isValid)\n\t\t\t{\n\t\t\t\tthis.shouldErrorHighlight = false;\n\t\t\t}\n\n\t\t\t// change steps and roles according to entityType\n\t\t\tif (prevEntityType !== this.departmentData.entityType)\n\t\t\t{\n\t\t\t\tthis.getMemberRoles(this.departmentData.entityType);\n\t\t\t\tthis.createSteps(this.departmentData.entityType, this.departmentData.id);\n\t\t\t\tthis.createDefaultSaveMode(this.departmentData.entityType);\n\n\t\t\t\tconst prevMemberRoles = getMemberRoles(prevEntityType);\n\t\t\t\tconst rolesKeys = Object.keys(prevMemberRoles);\n\t\t\t\tthis.departmentData.heads = this.departmentData.heads.map((item) => {\n\t\t\t\t\tconst roleKey = rolesKeys.find((key) => prevMemberRoles[key] === item.role);\n\n\t\t\t\t\treturn { ...item, role: this.memberRoles[roleKey] };\n\t\t\t\t});\n\n\t\t\t\tthis.departmentData.employees = this.departmentData.employees\n\t\t\t\t\t.map((item) => ({ ...item, role: this.memberRoles.employee }))\n\t\t\t\t;\n\t\t\t}\n\n\t\t\t// change NodeColorsSettingsDict according to entityType\n\t\t\tthis.departmentData.teamColor = this.isTeamEntity\n\t\t\t\t? this.departmentData.teamColor ?? NodeColorsSettingsDict.blue\n\t\t\t\t: null\n\t\t\t;\n\t\t},\n\t\tgetAllSteps(entityType: string, departmentId: number = null): Step[]\n\t\t{\n\t\t\tconst isTeamEntity = entityType === EntityTypes.team;\n\n\t\t\treturn {\n\t\t\t\tentity: {\n\t\t\t\t\tid: StepIds.entities,\n\t\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_SELECT_ENTITY_TITLE'),\n\t\t\t\t\thasBreadcrumbs: false,\n\t\t\t\t\thasTreePreview: false,\n\t\t\t\t\tdataTestIdPart: 'entities',\n\t\t\t\t},\n\t\t\t\tdepartment: {\n\t\t\t\t\tid: StepIds.department,\n\t\t\t\t\tbreadcrumbsTitleDepartment: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_BREADCRUMBS',\n\t\t\t\t\tbreadcrumbsTitleTeam: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_TITLE_BREADCRUMBS',\n\t\t\t\t\thasBreadcrumbs: true,\n\t\t\t\t\thasTreePreview: true,\n\t\t\t\t\tisEditPermitted: isTeamEntity\n\t\t\t\t\t\t? this.permissionChecker.hasPermission(PermissionActions.teamEdit, departmentId)\n\t\t\t\t\t\t: this.permissionChecker.hasPermission(PermissionActions.departmentEdit, departmentId),\n\t\t\t\t\tdataTestIdPart: 'department',\n\t\t\t\t},\n\t\t\t\temployees: {\n\t\t\t\t\tid: StepIds.employees,\n\t\t\t\t\tbreadcrumbsTitleDepartment: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEES_BREADCRUMBS',\n\t\t\t\t\tbreadcrumbsTitleTeam: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_EMPLOYEES_BREADCRUMBS',\n\t\t\t\t\thasBreadcrumbs: true,\n\t\t\t\t\thasTreePreview: true,\n\t\t\t\t\tisEditPermitted: isTeamEntity\n\t\t\t\t\t\t? this.permissionChecker.hasPermission(PermissionActions.teamAddMember, departmentId)\n\t\t\t\t\t\t: this.permissionChecker.hasPermission(PermissionActions.employeeAddToDepartment, departmentId),\n\t\t\t\t\tdataTestIdPart: 'employees',\n\t\t\t\t},\n\t\t\t\tbindChat: {\n\t\t\t\t\tid: StepIds.bindChat,\n\t\t\t\t\tbreadcrumbsTitleDepartment: this.permissionChecker.isCollabsAvailable\n\t\t\t\t\t\t? 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TITLE_BREADCRUMBS_W_COLLABS'\n\t\t\t\t\t\t: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TITLE_BREADCRUMBS',\n\t\t\t\t\tbreadcrumbsTitleTeam: this.permissionChecker.isCollabsAvailable\n\t\t\t\t\t\t? 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_TITLE_BREADCRUMBS_W_COLLABS'\n\t\t\t\t\t\t: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_TITLE_BREADCRUMBS',\n\t\t\t\t\thasBreadcrumbs: true,\n\t\t\t\t\thasTreePreview: false,\n\t\t\t\t\tisEditPermitted: this.checkCommunicationEditPermission(departmentId, isTeamEntity),\n\t\t\t\t\tdataTestIdPart: 'bind-chat',\n\t\t\t\t},\n\t\t\t\tsettings: {\n\t\t\t\t\tid: StepIds.settings,\n\t\t\t\t\tbreadcrumbsTitleDepartment: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_SETTINGS_BREADCRUMBS',\n\t\t\t\t\tbreadcrumbsTitleTeam: 'HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_BREADCRUMBS',\n\t\t\t\t\thasBreadcrumbs: true,\n\t\t\t\t\thasTreePreview: false,\n\t\t\t\t\tisEditPermitted: isTeamEntity\n\t\t\t\t\t\t? this.permissionChecker.hasPermission(PermissionActions.teamSettingsEdit, departmentId)\n\t\t\t\t\t\t: this.permissionChecker.hasPermission(PermissionActions.departmentSettingsEdit, departmentId),\n\t\t\t\t\tdataTestIdPart: 'team-rights',\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\tcreateSteps(entityType: string = 'DEPARTMENT', departmentId: number = null): void\n\t\t{\n\t\t\tconst { entity, department, employees, bindChat, settings } = this.getAllSteps(entityType, departmentId);\n\n\t\t\tconst steps: Step[] = this.showEntitySelector ? [entity] : [];\n\t\t\tsteps.push(department, employees, bindChat);\n\n\t\t\tif (entityType === EntityTypes.team)\n\t\t\t{\n\t\t\t\tsteps.push(settings);\n\t\t\t\tsteps.forEach((step: Step): void => {\n\t\t\t\t\tObject.assign(step, {\n\t\t\t\t\t\tbreadcrumbsTitle: step.breadcrumbsTitleTeam ? this.loc(step.breadcrumbsTitleTeam) : '',\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (this.isDepartmentSettingsAvailable)\n\t\t\t\t{\n\t\t\t\t\tsteps.push(settings);\n\t\t\t\t}\n\n\t\t\t\tsteps.forEach((step: Step): void => {\n\t\t\t\t\tObject.assign(step, {\n\t\t\t\t\t\tbreadcrumbsTitle: step.breadcrumbsTitleDepartment ? this.loc(step.breadcrumbsTitleDepartment) : '',\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (this.isEditMode)\n\t\t\t{\n\t\t\t\tsteps.forEach((step: Step): void => {\n\t\t\t\t\tObject.assign(step, {\n\t\t\t\t\t\tisPermitted: step.isEditPermitted,\n\t\t\t\t\t\thasTreePreview: step.hasTreePreview && step.isEditPermitted,\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tsteps.forEach((step: Step): void => {\n\t\t\t\t\tObject.assign(step, {\n\t\t\t\t\t\tisPermitted: true,\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.steps = steps;\n\t\t},\n\t\tgetUsersPromise(departmentId: number): Promise<void>\n\t\t{\n\t\t\tconst ids = this.calculateEmployeeIds();\n\t\t\tconst { headsIds, deputiesIds, employeesIds } = ids;\n\n\t\t\tconst departmentUserIds = {\n\t\t\t\t[this.memberRoles.head]: headsIds,\n\t\t\t\t[this.memberRoles.deputyHead]: deputiesIds,\n\t\t\t\t[this.memberRoles.employee]: employeesIds,\n\t\t\t};\n\n\t\t\treturn this.getUserMemberPromise(departmentId, departmentUserIds);\n\t\t},\n\t\tcalculateEmployeeIds(): Object\n\t\t{\n\t\t\tconst { heads, employees = [] } = this.departmentData;\n\n\t\t\treturn [...heads, ...employees].reduce((acc, user) => {\n\t\t\t\tconst { headsIds, deputiesIds, employeesIds } = acc;\n\t\t\t\tif (user.role === this.memberRoles.head)\n\t\t\t\t{\n\t\t\t\t\theadsIds.push(user.id);\n\t\t\t\t}\n\t\t\t\telse if (user.role === this.memberRoles.deputyHead)\n\t\t\t\t{\n\t\t\t\t\tdeputiesIds.push(user.id);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\temployeesIds.push(user.id);\n\t\t\t\t}\n\n\t\t\t\treturn acc;\n\t\t\t}, {\n\t\t\t\theadsIds: [],\n\t\t\t\tdeputiesIds: [],\n\t\t\t\temployeesIds: [],\n\t\t\t});\n\t\t},\n\t\tgetUserMemberPromise(departmentId: number, ids: DepartmentUserIds, role: string): Promise<void>\n\t\t{\n\t\t\tif (this.isEditMode)\n\t\t\t{\n\t\t\t\treturn WizardAPI.saveUsers(departmentId, ids);\n\t\t\t}\n\n\t\t\tconst hasUsers = Object.values(ids).some((userIds) => userIds.length > 0);\n\t\t\tif (!hasUsers)\n\t\t\t{\n\t\t\t\treturn Promise.resolve();\n\t\t\t}\n\n\t\t\tconst parentId = this.departmentData.parentId ?? null;\n\t\t\tif (this.saveMode === SaveMode.moveUsers)\n\t\t\t{\n\t\t\t\treturn WizardAPI.moveUsers(departmentId, ids, parentId);\n\t\t\t}\n\n\t\t\treturn WizardAPI.saveUsers(departmentId, ids, parentId);\n\t\t},\n\t\tasync create(): Promise<void>\n\t\t{\n\t\t\tconst {\n\t\t\t\tname,\n\t\t\t\tparentId,\n\t\t\t\tdescription,\n\t\t\t\tchats,\n\t\t\t\tchannels,\n\t\t\t\tcollabs,\n\t\t\t\tcreateDefaultChat,\n\t\t\t\tcreateDefaultChannel,\n\t\t\t\tcreateDefaultCollab,\n\t\t\t\tentityType,\n\t\t\t\tteamColor,\n\t\t\t\tsettings,\n\t\t\t} = this.departmentData;\n\n\t\t\tlet departmentId = 0;\n\t\t\tlet accessCode = '';\n\t\t\tthis.waiting = true;\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst userIds = this.calculateEmployeeIds();\n\t\t\t\tconst { headsIds, deputiesIds, employeesIds } = userIds;\n\n\t\t\t\tconst departmentUserIds = {\n\t\t\t\t\t[this.memberRoles.head]: headsIds,\n\t\t\t\t\t[this.memberRoles.deputyHead]: deputiesIds,\n\t\t\t\t\t[this.memberRoles.employee]: employeesIds,\n\t\t\t\t};\n\n\t\t\t\tconst nodeSettings = {\n\t\t\t\t\t[NodeSettingsTypes.businessProcAuthority]:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvalues: [...settings[NodeSettingsTypes.businessProcAuthority]],\n\t\t\t\t\t\t\treplace: true,\n\t\t\t\t\t\t},\n\t\t\t\t};\n\n\t\t\t\tlet newDepartment = {};\n\t\t\t\tlet updatedDepartmentIds = false;\n\t\t\t\tlet userMovedToRootIds = false;\n\n\t\t\t\tif (entityType === EntityTypes.team)\n\t\t\t\t{\n\n\t\t\t\t\t({\n\t\t\t\t\t\tnode: newDepartment,\n\t\t\t\t\t\tupdatedDepartmentIds = false,\n\t\t\t\t\t\tuserMovedToRootIds = false,\n\t\t\t\t\t} = await WizardAPI.createTeam(\n\t\t\t\t\t\tname,\n\t\t\t\t\t\tparentId,\n\t\t\t\t\t\tdescription,\n\t\t\t\t\t\tteamColor.name,\n\t\t\t\t\t\tdepartmentUserIds,\n\t\t\t\t\t\tNumber(createDefaultChat),\n\t\t\t\t\t\tchats,\n\t\t\t\t\t\tNumber(createDefaultChannel),\n\t\t\t\t\t\tchannels,\n\t\t\t\t\t\tNumber(createDefaultCollab),\n\t\t\t\t\t\tcollabs,\n\t\t\t\t\t\tnodeSettings,\n\t\t\t\t\t));\n\t\t\t\t}\n\t\t\t\telse if (entityType === EntityTypes.department)\n\t\t\t\t{\n\t\t\t\t\t({\n\t\t\t\t\t\tnode: newDepartment,\n\t\t\t\t\t\tupdatedDepartmentIds = false,\n\t\t\t\t\t\tuserMovedToRootIds = false,\n\t\t\t\t\t} = await WizardAPI.createDepartment(\n\t\t\t\t\t\tname,\n\t\t\t\t\t\tparentId,\n\t\t\t\t\t\tdescription,\n\t\t\t\t\t\tdepartmentUserIds,\n\t\t\t\t\t\tthis.saveMode === SaveMode.moveUsers ? 1 : 0,\n\t\t\t\t\t\tNumber(createDefaultChat),\n\t\t\t\t\t\tchats,\n\t\t\t\t\t\tNumber(createDefaultChannel),\n\t\t\t\t\t\tchannels,\n\t\t\t\t\t\tNumber(createDefaultCollab),\n\t\t\t\t\t\tcollabs,\n\t\t\t\t\t\tnodeSettings,\n\t\t\t\t\t));\n\t\t\t\t}\n\n\t\t\t\tdepartmentId = newDepartment.id;\n\t\t\t\taccessCode = newDepartment.accessCode;\n\n\t\t\t\tif (updatedDepartmentIds)\n\t\t\t\t{\n\t\t\t\t\tchartWizardActions.refreshDepartments(updatedDepartmentIds);\n\t\t\t\t}\n\t\t\t\telse if (userMovedToRootIds)\n\t\t\t\t{\n\t\t\t\t\tchartWizardActions.tryToAddCurrentDepartment(this.departmentData, departmentId);\n\t\t\t\t}\n\t\t\t}\n\t\t\tcatch (error)\n\t\t\t{\n\t\t\t\tthis.reportError(error);\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfinally\n\t\t\t{\n\t\t\t\tthis.waiting = false;\n\t\t\t}\n\n\t\t\tawait chartWizardActions.createDepartment({ ...this.departmentData, id: departmentId, accessCode });\n\t\t\tthis.$emit('modifyTree', { id: departmentId, parentId, showConfetti: true });\n\n\t\t\tconst { headsIds, deputiesIds, employeesIds } = this.calculateEmployeeIds();\n\n\t\t\tanalyticsSendData(\n\t\t\t\t{\n\t\t\t\t\ttool: 'structure',\n\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\tevent: `create_${this.entityAnalyticsCategory}`,\n\t\t\t\t\tc_element: this.source,\n\t\t\t\t\t...(!this.isTeamEntity && {\n\t\t\t\t\t\tp1: `deptChat_${createDefaultChat ? 'Y' : 'N'}`,\n\t\t\t\t\t\tp2: `headAmount_${headsIds.length}`,\n\t\t\t\t\t\tp3: `secondHeadAmount_${deputiesIds.length}`,\n\t\t\t\t\t\tp4: `employeeAmount_${employeesIds.length}`,\n\t\t\t\t\t\tp5: `deptChannel_${createDefaultChannel ? 'Y' : 'N'}`,\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t);\n\t\t\tthis.close();\n\t\t},\n\t\tasync save(): Promise<void>\n\t\t{\n\t\t\tif (!this.isValidStep)\n\t\t\t{\n\t\t\t\tthis.shouldErrorHighlight = true;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst {\n\t\t\t\tid,\n\t\t\t\tparentId,\n\t\t\t\tname,\n\t\t\t\tdescription,\n\t\t\t\tteamColor,\n\t\t\t\tsettings,\n\t\t\t\tchats,\n\t\t\t\tcreateDefaultChat,\n\t\t\t\tchannels,\n\t\t\t\tcreateDefaultChannel,\n\t\t\t\tcollabs,\n\t\t\t\tcreateDefaultCollab,\n\t\t\t} = this.departmentData;\n\n\t\t\tconst currentNode = this.departments.get(id);\n\t\t\tconst targetNodeId = currentNode?.parentId === parentId ? null : parentId;\n\t\t\tthis.waiting = true;\n\n\t\t\tconst moveUsersResult = await this.moveUsers();\n\n\t\t\tlet allUpdatedDepartmentIds = [];\n\t\t\t// Process move users results to update UserService\n\t\t\tif (moveUsersResult.results?.length > 0)\n\t\t\t{\n\t\t\t\tfor (const result of moveUsersResult.results)\n\t\t\t\t{\n\t\t\t\t\t// Collect all updatedDepartmentIds\n\t\t\t\t\tif (result.response?.updatedDepartmentIds && Array.isArray(result.response.updatedDepartmentIds))\n\t\t\t\t\t{\n\t\t\t\t\t\tallUpdatedDepartmentIds = [...allUpdatedDepartmentIds, ...result.response.updatedDepartmentIds];\n\t\t\t\t\t}\n\n\t\t\t\t\tif (result.users?.length > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t// Call UserService.moveUsersToEntity for this batch\n\t\t\t\t\t\tUserService.moveUsersToEntity(\n\t\t\t\t\t\t\tNumber(result.departmentId),\n\t\t\t\t\t\t\tresult.users,\n\t\t\t\t\t\t\tresult.response?.userCount,\n\t\t\t\t\t\t\t[],\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tallUpdatedDepartmentIds = [...new Set(allUpdatedDepartmentIds)].filter((nodeId) => nodeId !== id);\n\t\t\t}\n\n\t\t\tconst usersPromise = this.apiEntityChanged.has(WizardApiEntityChangedDict.employees)\n\t\t\t\t? this.getUsersPromise(id)\n\t\t\t\t: Promise.resolve()\n\t\t\t;\n\n\t\t\tconst departmentPromise = this.apiEntityChanged.has(WizardApiEntityChangedDict.department)\n\t\t\t\t? WizardAPI.updateDepartment(id, targetNodeId, name, description, teamColor?.name)\n\t\t\t\t: Promise.resolve()\n\t\t\t;\n\n\t\t\tconst settingsPromise = this.apiEntityChanged.has(WizardApiEntityChangedDict.settings)\n\t\t\t\t? WizardAPI.updateSettings(\n\t\t\t\t\tid,\n\t\t\t\t\t{\n\t\t\t\t\t\t[NodeSettingsTypes.businessProcAuthority]: {\n\t\t\t\t\t\t\tvalues: [...settings[NodeSettingsTypes.businessProcAuthority]],\n\t\t\t\t\t\t\treplace: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tparentId,\n\t\t\t\t)\n\t\t\t\t: Promise.resolve()\n\t\t\t;\n\n\t\t\tthis.pickEditAnalytics(id, parentId);\n\n\t\t\tlet usersResponse = null;\n\t\t\ttry\n\t\t\t{\n\t\t\t\t[usersResponse] = await Promise.all([\n\t\t\t\t\tusersPromise,\n\t\t\t\t\tdepartmentPromise,\n\t\t\t\t\tsettingsPromise,\n\t\t\t\t]);\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tthis.reportError(e);\n\t\t\t\tthis.waiting = false;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.apiEntityChanged.has(WizardApiEntityChangedDict.bindChats))\n\t\t\t{\n\t\t\t\tconst chatsToAdd = chats.filter((chatId) => !this.initChats.some((chat) => chat.id === chatId));\n\t\t\t\tconst chatsToRemove = this.initChats.filter((chat) => !chats.includes(chat.id)).map((chat) => chat.id);\n\n\t\t\t\tif (chatsToAdd.length > 0 || chatsToRemove.length > 0 || Number(createDefaultChat) !== 0)\n\t\t\t\t{\n\t\t\t\t\ttry\n\t\t\t\t\t{\n\t\t\t\t\t\tawait WizardAPI.saveChats(id, chatsToAdd, Number(createDefaultChat), chatsToRemove);\n\t\t\t\t\t}\n\t\t\t\t\tcatch (e)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.reportError(e);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst channelsToAdd = channels.filter(\n\t\t\t\t\t(channelId) => !this.initChannels.some((channel) => channel.id === channelId),\n\t\t\t\t);\n\t\t\t\tconst channelsToRemove = this.initChannels.filter(\n\t\t\t\t\t(channel) => !channels.includes(channel.id),\n\t\t\t\t).map((channel) => channel.id);\n\n\t\t\t\tif (channelsToAdd.length > 0 || channelsToRemove.length > 0 || Number(createDefaultChannel) !== 0)\n\t\t\t\t{\n\t\t\t\t\ttry\n\t\t\t\t\t{\n\t\t\t\t\t\tawait WizardAPI.saveChannels(id, channelsToAdd, Number(createDefaultChannel), channelsToRemove);\n\t\t\t\t\t}\n\t\t\t\t\tcatch (e)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.reportError(e);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst collabsToAdd = collabs.filter(\n\t\t\t\t\t(collabId) => !this.initCollabs.some((collab) => Number(collab.id) === collabId),\n\t\t\t\t);\n\t\t\t\tconst collabsToRemove = this.initCollabs.filter(\n\t\t\t\t\t(collab) => !collabs.includes(Number(collab.id)),\n\t\t\t\t).map((collab) => collab.id);\n\n\t\t\t\tif (collabsToAdd.length > 0 || collabsToRemove.length > 0 || Number(createDefaultCollab) !== 0)\n\t\t\t\t{\n\t\t\t\t\ttry\n\t\t\t\t\t{\n\t\t\t\t\t\tawait WizardAPI.saveCollabs(id, collabsToAdd, Number(createDefaultCollab), collabsToRemove);\n\t\t\t\t\t}\n\t\t\t\t\tcatch (e)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.reportError(e);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.departmentData.chatsDetailed = null;\n\t\t\t\tthis.departmentData.channelsDetailed = null;\n\t\t\t\tthis.departmentData.collabssDetailed = null;\n\n\t\t\t\tif (this.isEditMode && id && DepartmentContentActions?.updateChatsInChildrenNodes)\n\t\t\t\t{\n\t\t\t\t\tDepartmentContentActions.updateChatsInChildrenNodes(this.nodeId);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet userMovedToRootIds = [];\n\t\t\tif (this.removedUsers.length > 0)\n\t\t\t{\n\t\t\t\tuserMovedToRootIds = usersResponse?.userMovedToRootIds ?? [];\n\t\t\t\tif (userMovedToRootIds.length > 0)\n\t\t\t\t{\n\t\t\t\t\tchartWizardActions.moveUsersToRootDepartment(this.removedUsers, userMovedToRootIds);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst store = useChartStore();\n\t\t\tif (userMovedToRootIds.includes(this.userId))\n\t\t\t{\n\t\t\t\tstore.changeCurrentDepartment(id, this.rootId);\n\t\t\t}\n\t\t\telse if (this.removedUsers.some((user) => user.id === this.userId))\n\t\t\t{\n\t\t\t\tstore.changeCurrentDepartment(id);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tchartWizardActions.tryToAddCurrentDepartment(this.departmentData, id);\n\t\t\t}\n\n\t\t\tstore.updateDepartment(this.departmentData);\n\t\t\tstore.refreshDepartments(allUpdatedDepartmentIds);\n\n\t\t\tthis.waiting = false;\n\t\t\tthis.$emit('modifyTree', { id, parentId });\n\t\t\tthis.close();\n\t\t},\n\t\treportError(error: Error, delay: number = 4000): void\n\t\t{\n\t\t\tif (!reportedErrorTypes.has(error.code))\n\t\t\t{\n\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\tcontent: error.message,\n\t\t\t\t\tautoHideDelay: delay,\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\thandleSaveModeChanged(actionId: string): void\n\t\t{\n\t\t\tthis.saveMode = actionId;\n\t\t},\n\t\tcreateDefaultSaveMode(entityType: string = 'DEPARTMENT'): void\n\t\t{\n\t\t\tif (entityType === EntityTypes.team)\n\t\t\t{\n\t\t\t\tthis.saveMode = SaveMode.addUsers;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.saveMode = SaveMode.moveUsers;\n\t\t\t}\n\t\t},\n\t\tpickEditAnalytics(departmentId: number, parentId: number): void\n\t\t{\n\t\t\tconst currentNode = this.departments.get(departmentId);\n\t\t\tswitch (this.entity)\n\t\t\t{\n\t\t\t\tcase StepIds.department:\n\t\t\t\t\tanalyticsSendData({\n\t\t\t\t\t\ttool: 'structure',\n\t\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\t\tevent: 'edit_dept_name',\n\t\t\t\t\t\tc_element: this.source,\n\t\t\t\t\t\tp1: currentNode?.parentId === parentId ? 'editHead_N' : 'editHeadDept_Y',\n\t\t\t\t\t\tp2: currentNode?.name === name ? 'editName_N' : 'editName_Y',\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase StepIds.employees:\n\t\t\t\t{\n\t\t\t\t\tconst { headsIds, deputiesIds, employeesIds } = this.calculateEmployeeIds();\n\t\t\t\t\tanalyticsSendData({\n\t\t\t\t\t\ttool: 'structure',\n\t\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\t\tevent: 'edit_dept_employee',\n\t\t\t\t\t\tc_element: this.source,\n\t\t\t\t\t\tp2: `headAmount_${headsIds.length}`,\n\t\t\t\t\t\tp3: `secondHeadAmount_${deputiesIds.length}`,\n\t\t\t\t\t\tp4: `employeeAmount_${employeesIds.length}`,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t},\n\t\tpickStepsAnalytics(): void\n\t\t{\n\t\t\tlet event = null;\n\t\t\tswitch (this.currentStep.id)\n\t\t\t{\n\t\t\t\tcase StepIds.department:\n\t\t\t\t\tevent = `create_${this.entityAnalyticsCategory}_step1`;\n\t\t\t\t\tbreak;\n\t\t\t\tcase StepIds.employees:\n\t\t\t\t\tevent = `create_${this.entityAnalyticsCategory}_step2`;\n\t\t\t\t\tbreak;\n\t\t\t\tcase StepIds.bindChat:\n\t\t\t\t\tevent = `create_${this.entityAnalyticsCategory}_step3`;\n\t\t\t\t\tbreak;\n\t\t\t\tcase StepIds.settings:\n\t\t\t\t\tevent = `create_${this.entityAnalyticsCategory}_step4`;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (event)\n\t\t\t{\n\t\t\t\tanalyticsSendData({\n\t\t\t\t\ttool: 'structure',\n\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\tevent,\n\t\t\t\t\ttype: this.entityAnalyticsCategory,\n\t\t\t\t\tc_element: this.source,\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tcheckCommunicationEditPermission(entityId: number, isTeamEntity: boolean): boolean\n\t\t{\n\t\t\treturn isTeamEntity\n\t\t\t\t? (\n\t\t\t\t\tthis.permissionChecker.hasPermission(PermissionActions.teamChatEdit, entityId)\n\t\t\t\t\t|| this.permissionChecker.hasPermission(PermissionActions.teamChannelEdit, entityId)\n\t\t\t\t\t|| this.permissionChecker.hasPermission(PermissionActions.teamCollabEdit, entityId)\n\t\t\t\t)\n\t\t\t\t: (\n\t\t\t\t\tthis.permissionChecker.hasPermission(PermissionActions.departmentChatEdit, entityId)\n\t\t\t\t\t|| this.permissionChecker.hasPermission(PermissionActions.departmentChannelEdit, entityId)\n\t\t\t\t\t|| this.permissionChecker.hasPermission(PermissionActions.departmentCollabEdit, entityId)\n\t\t\t\t)\n\t\t\t;\n\t\t},\n\t\tasync moveUsers(): Promise<Object>\n\t\t{\n\t\t\tif (!this.isEditMode || !this.moveUsersMap || Object.keys(this.moveUsersMap).length === 0)\n\t\t\t{\n\t\t\t\treturn { success: true, results: [] };\n\t\t\t}\n\n\t\t\tconst results = [];\n\t\t\tconst errors = [];\n\n\t\t\t// Execute promises for each department\n\t\t\tfor (const [departmentId, users] of Object.entries(this.moveUsersMap))\n\t\t\t{\n\t\t\t\tconst userIds = users.map((user) => user.id);\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\t// Create the department user IDs structure expected by the API\n\t\t\t\t\tconst departmentUserIds = {\n\t\t\t\t\t\t[this.memberRoles.employee]: userIds,\n\t\t\t\t\t\t[this.memberRoles.head]: [],\n\t\t\t\t\t\t[this.memberRoles.deputyHead]: [],\n\t\t\t\t\t};\n\n\t\t\t\t\t// Call the API to move users to this department and await the result\n\t\t\t\t\t// eslint-disable-next-line no-await-in-loop\n\t\t\t\t\tconst response = await WizardAPI.moveUsers(Number(departmentId), departmentUserIds);\n\t\t\t\t\tresults.push({ departmentId: Number(departmentId), users, response });\n\t\t\t\t}\n\t\t\t\tcatch (error)\n\t\t\t\t{\n\t\t\t\t\terrors.push({\n\t\t\t\t\t\tdepartmentId: Number(departmentId),\n\t\t\t\t\t\tusers,\n\t\t\t\t\t\terror: error.message || 'Unknown error moving users',\n\t\t\t\t\t});\n\t\t\t\t\tthis.reportError(error);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tsuccess: errors.length === 0,\n\t\t\t\tresults,\n\t\t\t\terrors: errors.length > 0 ? errors : null,\n\t\t\t};\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"chart-wizard\">\n\t\t\t<div class=\"chart-wizard__dialog\" :class=\"{ '--first-step': isFirstStep }\">\n\t\t\t\t<div v-if=\"currentStep.hasBreadcrumbs\" class=\"chart-wizard__breadcrumbs-head\">\n\t\t\t\t\t<div class=\"chart-wizard__head_close --breadcrumbs\" @click=\"closeWithConfirm(true)\"></div>\n\t\t\t\t\t<div class=\"chart-wizard__breadcrumbs-head_descr\">\n\t\t\t\t\t\t{{ breadcrumbsTitle }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"chart-wizard__breadcrumbs-head_breadcrumbs\">\n\t\t\t\t\t\t<span \n\t\t\t\t\t\t\tv-for=\"(step, index) in breadcrumbsSteps\" \n\t\t\t\t\t\t\t:key=\"index\"\n\t\t\t\t\t\t\tclass=\"chart-wizard__breadcrumbs-head_breadcrumbs-item\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span v-if=\"index > 0\" class=\"ui-icon-set --chevron-right\"></span>\n\t\t\t\t\t\t\t<span class=\"chart-wizard__breadcrumbs-head_breadcrumbs-item-text\"\n\t\t\t\t\t\t\t\t  :class=\"{ '--active': step.id === currentStep.id }\"\n\t\t\t\t\t\t\t\t  :data-test-id=\"'hr-company-structure_chart-wizard__breadcrumbs_' + step.dataTestIdPart\"\n\t\t\t\t\t\t\t\t  @click=\"moveToStep(step.id)\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{{ step.breadcrumbsTitle }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-else class=\"chart-wizard__head\">\n\t\t\t\t\t<div class=\"chart-wizard__head_close\" @click=\"close(true)\"></div>\n\t\t\t\t\t<p class=\"chart-wizard__head_title\">{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_CREATE') }}</p>\n\t\t\t\t\t<p class=\"chart-wizard__head_descr\" :class=\"{ '--first-step': isFirstStep }\">\n\t\t\t\t\t\t{{ currentStep.title }}\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__content\" :style=\"{ display: !isEditMode && isFirstStep ? 'block' : 'flex' }\">\n\t\t\t\t\t<KeepAlive>\n\t\t\t\t\t\t<component\n\t\t\t\t\t\t\t:is=\"componentInfo.name\"\n\t\t\t\t\t\t\tv-bind=\"componentInfo.params\"\n\t\t\t\t\t\t\tv-on=\"{\n\t\t\t\t\t\t\t\tapplyData: onApplyData,\n\t\t\t\t\t\t\t\tsaveModeChanged: componentInfo.name === 'Employees' ? handleSaveModeChanged : undefined\n\t\t\t\t\t\t\t}\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t</component>\n\t\t\t\t\t</KeepAlive>\n\t\t\t\t\t<div v-if=\"currentStep.hasTreePreview\" class=\"chart-wizard__tree_container\">\n\t\t\t\t\t\t<TreePreview\n\t\t\t\t\t\t\t:parentId=\"departmentData.parentId\"\n\t\t\t\t\t\t\t:name=\"departmentData.name\"\n\t\t\t\t\t\t\t:heads=\"departmentData.heads\"\n\t\t\t\t\t\t\t:userCount=\"departmentData.userCount\"\n\t\t\t\t\t\t\t:entityType=\"departmentData.entityType\"\n\t\t\t\t\t\t\t:teamColor=\"departmentData.teamColor\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"chart-wizard__footer\">\n\t\t\t\t\t<button\n\t\t\t\t\t\tv-if=\"stepIndex > 0\"\n\t\t\t\t\t\tclass=\"ui-btn ui-btn-light chart-wizard__button --back\"\n\t\t\t\t\t\t@click=\"move('back')\"\n\t\t\t\t\t\tdata-test-id=\"hr-company-structure_chart-wizard__back-button\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span class=\"chart-wizard__back-button-text\">\n\t\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BACK_BTN') }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\tv-show=\"stepIndex < steps.length - 1\"\n\t\t\t\t\t\tclass=\"ui-btn ui-btn-primary ui-btn-round chart-wizard__button --next\"\n\t\t\t\t\t\t:class=\"{ \n\t\t\t\t\t\t\t'ui-btn-disabled': !isValidStep,\n\t\t\t\t\t\t\t'ui-btn-light-border': isEditMode,\n\t\t\t\t\t\t }\"\n\t\t\t\t\t\t@click=\"move()\"\n\t\t\t\t\t\tdata-test-id=\"hr-company-structure_chart-wizard__next-button\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_NEXT_BTN') }}\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\tv-show=\"!isEditMode && stepIndex === steps.length - 1\"\n\t\t\t\t\t\tclass=\"ui-btn ui-btn-primary ui-btn-round chart-wizard__button\"\n\t\t\t\t\t\t:class=\"{ 'ui-btn-wait': waiting }\"\n\t\t\t\t\t\t@click=\"create\"\n\t\t\t\t\t\tdata-test-id=\"hr-company-structure_chart-wizard__create-button\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ createButtonText }}\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\tv-show=\"isEditMode\"\n\t\t\t\t\t\tclass=\"ui-btn ui-btn-primary ui-btn-round chart-wizard__button --save\"\n\t\t\t\t\t\t:class=\"{ 'ui-btn-wait': waiting, 'ui-btn-disabled': !isValidStep, }\"\n\t\t\t\t\t\t@click=\"save\"\n\t\t\t\t\t\tdata-test-id=\"hr-company-structure_chart-wizard__save-button\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_SAVE_BTN') }}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"chart-wizard__overlay\"></div>\n\t\t</div>\n\t`,\n};\n"],"names":["SaveMode","Object","freeze","moveUsers","addUsers","StepIds","entities","department","employees","bindChat","settings","AuthorityTypes","departmentHead","departmentDeputy","teamHead","teamDeputy","HeadUsers","name","components","UserListActionMenu","props","users","type","Array","required","showPlaceholder","Boolean","default","isTeamEntity","isExistingDepartment","userType","String","teamColor","data","headsVisible","created","userTypes","head","deputy","computed","headItemsCount","defaultAvatar","placeholderAvatar","avatarImage","dropdownItems","map","user","workPosition","loc","titleBar","isDeputy","methods","phraseCode","replacements","$Bitrix","Loc","getMessage","template","TreeNode","heads","userCount","Number","nodeId","entityType","EntityTypes","isShowLoader","memberRoles","getMemberRoles","departmentData","watch","newValue","$nextTick","loaderContainer","$refs","loader","Loader","size","show","isHeadsLoaded","loadHeads","departments","get","employeesCount","length","headUsers","filter","role","deputyUsers","deputyHead","showInfo","PermissionChecker","getInstance","hasPermission","PermissionActions","structureView","departmentId","team","dataTestIdSuffix","mapState","useChartStore","locPlural","count","getMessagePlural","departmentIds","store","formatDataTestId","prefix","TreePreview","parentId","rootId","parentNode","companyName","values","find","TeamColorPicker","BasePopup","modelValue","bindElement","HTMLElement","emits","popupConfig","popupWidth","pickerWidth","initialPopupOffset","angleWidth","width","height","borderRadius","contentNoPaddings","contentPadding","padding","offsetTop","offsetLeft","angleOffset","nodeColorsSettingsDict","NodeColorsSettingsDict","close","$emit","Department","description","shouldErrorHighlight","isEditMode","refToFocus","deniedError","showColorPicker","teamColorValue","locked","recreateTagSelector","selectedParentDepartment","departmentName","departmentDescription","departmentSelectorCashe","MemoryCache","departmentsSelector","getOrCreateTagSelector","mounted","renderTo","activated","isDepartmentDataChanged","isValid","trim","focus","title","innerHTML","createTagSelector","isTagSelectorLocked","preselectedItems","permissionChecker","permissionAction","teamCreate","departmentCreate","isTabEmpty","tab","getRootNode","getChildren","selector","TagSelector","events","onTagAdd","event","tag","id","onTagRemove","applyData","multiple","dialogOptions","dropdownMode","hideOnDeselect","options","selectMode","restricted","includedNodeEntityTypes","includedNodeEntityTypesInDialog","useMultipleTabs","onLoad","dialog","getDialog","getTabs","forEach","setVisible","target","selectedItem","selectedItems","next","value","lock","nodes","items","node","select","onLoadError","item","isTeamItem","permissionCreateAction","permissionEditAction","teamEdit","departmentEdit","key","remember","apiEntityChanged","WizardApiEntityChangedDict","parent","namePlaceholder","descriptionPlaceholder","higherLevelDepartmentContainer","showLockedSelectorErrorText","selectorErrorText","MenuOption","ChangeSaveModeControl","RouteActionMenu","menuItems","getMenuItems","menuVisible","actionId","onActionMenuItemClick","bIcon","Main","PERSON_ARROW_LEFT_1","color","getColorCode","CRM","PERSON_PLUS_2","getControlButtonText","Employees","MoveUserPopup","entityId","employeesIds","showMoveUserPopup","movedUserData","movedUserRole","selectedUsers","Set","departmentHeads","departmentEmployees","removedUsers","headSelector","getUserSelector","memberRolesKeys","deputySelector","employeesSelector","employee","moveUsersMap","initialUsers","reduce","set","add","prevMemberRoles","rolesKeys","keys","roleKey","handler","payload","preselectedEmployees","employeeId","setPreselectedItems","load","getPreselectedItems","getData","onSelectorToggle","has","delete","popupOptions","onBeforeShow","setHeight","isLoaded","toggleUsers","onShow","container","getContainer","top","getBoundingClientRect","offset","offsetHeight","document","body","margin","setLink","intranetUsersOnly","inviteEmployeeLink","getItems","hidden","setHidden","getItem","userData","getUserDataBySelectorItem","isEmployee","rendered","isUserPreselected","handleMoveUserAction","newNodeId","handleAbortMove","getSelectorByRole","handleSaveModeChangedChanged","userId","parsedPreselected","flat","preselectedItem","includes","headTitle","headDescription","deputyTitle","deputyDescription","employeeTitle","AbstractSelectorDictionary","phrases","getPhrase","phraseSet","Error","constructor","getEntityName","getTagId","chat","getItemId","replace","getEntity","getDialogEvents","getTarget","canEdit","getTagSelector","getTestId","blueprint","getRemovePhrase","hasCurrentUser","ChannelSelectorDictionary","hintText","createText","warningText","departmentChannelEdit","teamChannelEdit","getChannelDialogEntity","ChatSelectorDictionary","departmentChatEdit","teamChatEdit","getChatDialogEntity","CollabSelectorDictionary","departmentCollabEdit","teamCollabEdit","getCollabDialogEntity","removeTab","createSelectorDictionary","CommunicationsTypeDict","channel","collab","DEFAULT_TAG_ID","CommunicationSelector","DefaultHint","BIcon","headsCreated","initCommunications","createDefault","selectorDictionary","isChannel","IconSet","removeText","canBeEdit","deselect","defaultItem","setTitle","initialItemsSet","communications","getSelector","addTag","searchable","existingItem","hasAccess","setDeselectable","push","entity","intId","enableSearch","recentTabOptions","getCommunicationsRecentTabOptions","getDefaultItem","tagOptions","itemOptions","BindChat","initChats","initChannels","initCollabs","isCollabsAvailable","some","hints","ChatTypeDict","hintTitle","chats","channels","collabs","createDefaultChat","createDefaultChannel","createDefaultCollab","bindChats","onCommunicationSelectorChanged","Entities","ResponsiveHint","selectedEntityType","hint","hintHideTimeout","hasTeamCreatePermission","hasPermissionOfAction","hasDepartmentCreatePermission","isEnabled","isSoon","isTeamsAvailable","deactivated","hide","clearTimeout","showHint","text","$event","Reflection","getClass","createInstance","popupParameters","bindOptions","position","angle","setTimeout","Settings","features","isBusinessProcHeadNotSelected","bpSettings","NodeSettingsTypes","businessProcAuthority","businessDescription","Text","encode","reportsDescriptions","businessProcWarningText","hasHead","hasDeputy","headSelected","deputySelected","businessProcPreselected","getTagItems","businessProcPreselectedItem","businessProcSelector","initBpValues","reportsSelector","reportsAuthority","settingType","tagFontWeight","showAddButton","getCustomData","preventDefault","tagMaxWidth","showAvatars","undeselectedItems","isDeputyApprovesBPAvailable","lockedTagOptions","bgColor","textColor","departmentTagOptions","maxWidth","teamTagOptions","soonItemOptions","customData","selectable","badges","badgesOptions","justifyContent","deputyOptions","tabs","goToBPHelp","BX","Helper","AccessDenied","WizardAPI","createDepartment","userIds","moveUsersToDepartment","createChat","bindingChatIds","createChannel","bindingChannelIds","createCollab","bindingCollabIds","postData","createTeam","colorName","addDepartment","getEmployees","updateDepartment","saveUsers","saveChats","ids","removeIds","saveChannels","saveCollabs","createSettings","updateSettings","getSettings","getChatsAndChannels","chartWizardActions","structureMap","children","UserService","refreshMultipleUsers","moveUsersToRootDepartment","userMovedToRootIds","rootEmployees","rootNode","refreshDepartments","tryToAddCurrentDepartment","isCurrentUserAdd","changeCurrentDepartment","ChartWizard","showEntitySelector","source","stepIndex","waiting","isValidStep","blue","departmentSettings","steps","saveMode","init","beforeUnmount","Event","unbind","window","handleBeforeUnload","breadcrumbsTitle","closeConfirmTitle","currentStep","checkDeputyApprovalBPAvailable","isDepartmentSettingsAvailable","checkDepartmentSettingsAvailable","componentInfo","isPermitted","params","isFirstStep","breadcrumbsSteps","step","hasBreadcrumbs","entityAnalyticsCategory","createButtonText","mapRawSettings","rawSettings","acc","settingsType","settingsValue","hasOwn","bind","createSteps","indexOf","getStepById","createDefaultSaveMode","newSettings","rawChatsAndChannels","originalNodeId","analyticsSendData","tool","category","c_element","move","buttonId","pickStepsAnalytics","moveToStep","stepId","force","findIndex","isEditPermitted","index","sendEvent","closeWithConfirm","confirmPopup","MessageBox","message","yesCaption","noCaption","onYes","minHeight","buttons","MessageBoxButtons","YES_NO","closeIcon","className","getYesButton","setRound","getNoButton","onApplyData","prevEntityType","getAllSteps","hasTreePreview","dataTestIdPart","breadcrumbsTitleDepartment","breadcrumbsTitleTeam","teamAddMember","employeeAddToDepartment","checkCommunicationEditPermission","teamSettingsEdit","departmentSettingsEdit","assign","getUsersPromise","calculateEmployeeIds","headsIds","deputiesIds","departmentUserIds","getUserMemberPromise","hasUsers","Promise","resolve","create","accessCode","nodeSettings","newDepartment","updatedDepartmentIds","error","reportError","showConfetti","p1","p2","p3","p4","p5","save","currentNode","targetNodeId","moveUsersResult","allUpdatedDepartmentIds","results","result","response","isArray","moveUsersToEntity","usersPromise","departmentPromise","settingsPromise","pickEditAnalytics","usersResponse","all","e","chatsToAdd","chatId","chatsToRemove","channelsToAdd","channelId","channelsToRemove","collabsToAdd","collabId","collabsToRemove","chatsDetailed","channelsDetailed","collabssDetailed","DepartmentContentActions","updateChatsInChildrenNodes","delay","reportedErrorTypes","code","UI","Notification","Center","notify","content","autoHideDelay","handleSaveModeChanged","success","errors","entries"],"mappings":"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"}