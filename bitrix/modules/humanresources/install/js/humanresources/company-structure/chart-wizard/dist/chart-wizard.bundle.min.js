this.BX=this.BX||{};this.BX.Humanresources=this.BX.Humanresources||{};(function(t,e,s,i,n,a,r,o,d,l,c,h,_,p,m,E,u){"use strict";const T=Object.freeze({moveUsers:"moveUsers",addUsers:"addUsers"});const C=Object.freeze({entities:"entities",department:"department",employees:"employees",bindChat:"bindChat",teamRights:"teamRights"});const R={departmentHead:"HEAD",departmentDeputy:"DEPUTY_HEAD",teamHead:"TEAM_HEAD",teamDeputy:"TEAM_DEPUTY"};const S={name:"headUsers",components:{UserListActionMenu:l.UserListActionMenu},props:{users:{type:Array,required:true},showPlaceholder:{type:Boolean,default:true},isTeamEntity:{type:Boolean,default:false},isExistingDepartment:{type:Boolean,default:true},userType:{type:String,default:"head"},teamColor:{type:[Object,null],default:null}},data(){return{headsVisible:false}},created(){this.userTypes={head:"head",deputy:"deputy"}},computed:{headItemsCount(){return this.isExistingDepartment?1:2},defaultAvatar(){return"/bitrix/js/humanresources/company-structure/org-chart/src/images/default-user.svg"},placeholderAvatar(){if(!this.isTeamEntity||!this.teamColor){return"/bitrix/js/humanresources/company-structure/chart-wizard/src/components/tree-preview/images/placeholder-avatar.svg"}return`/bitrix/js/humanresources/company-structure/chart-wizard/src/components/tree-preview/images/${this.teamColor.avatarImage}`},dropdownItems(){return this.users.map((t=>{const e=t.workPosition||this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_HEAD_POSITION");return{...t,workPosition:e}}))},titleBar(){return this.userType===this.userTypes.deputy?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_DEPUTY_TITLE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_HEAD_TITLE")},isDeputy(){return this.userType===this.userTypes.deputy}},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)}},template:`\n\t\t<div\n\t\t\tclass="chart-wizard-tree-preview__node_head"\n\t\t\t:class="{ '--deputy': isDeputy }"\n\t\t\tv-for="(user, index) in users.slice(0, headItemsCount)"\n\t\t>\n\t\t\t<img\n\t\t\t\t:src="user.avatar || defaultAvatar"\n\t\t\t\tclass="chart-wizard-tree-preview__node_head-avatar --placeholder"\n\t\t\t\t:class="{ '--deputy': isDeputy, '--old': isExistingDepartment }"\n\t\t\t/>\n\t\t\t<div class="chart-wizard-tree-preview__node_head-text" :class="{'--deputy': isDeputy }">\n\t\t\t\t<span\n\t\t\t\t\tclass="chart-wizard-tree-preview__node_head-name --crop"\n\t\t\t\t\t:class="{'--old': isExistingDepartment }"\n\t\t\t\t>\n\t\t\t\t\t{{ user.name }}\n\t\t\t\t</span>\n\t\t\t\t<span\n\t\t\t\t\tv-if="!isDeputy"\n\t\t\t\t\tclass="chart-wizard-tree-preview__node_head-position --crop"\n\t\t\t\t\t:class="{'--old': isExistingDepartment }"\n\t\t\t\t>\n\t\t\t\t\t{{ user.workPosition || loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_HEAD_POSITION') }}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<span\n\t\t\t\tv-if="index === headItemsCount - 1 && users.length > headItemsCount"\n\t\t\t\tclass="chart-wizard-tree-preview__node_head-rest"\n\t\t\t\t:class="{ '--active': headsVisible }"\n\t\t\t\tref="showMoreHeadUserWizardList"\n\t\t\t\t:data-test-id="'hr-company-structure_chart-wizard-tree__preview-' + userType + '-rest'"\n\t\t\t\t@click.stop="headsVisible = true"\n\t\t\t>\n\t\t\t\t\t{{ '+' + String(users.length - headItemsCount) }}\n\t\t\t</span>\n\t\t</div>\n\t\t<div\n\t\t\tv-if="users.length === 0 && showPlaceholder"\n\t\t\tclass="chart-wizard-tree-preview__node_head"\n\t\t\t:class="{ '--deputy': isDeputy }"\n\t\t>\n\t\t\t<img\n\t\t\t\t:src="placeholderAvatar"\n\t\t\t\tclass="chart-wizard-tree-preview__node_head-avatar --placeholder"\n\t\t\t\t:class="{'--deputy': isDeputy, '--old': isExistingDepartment  }"\n\t\t\t/>\n\t\t\t<div class="chart-wizard-tree-preview__node_head-text">\n\t\t\t\t<span\n\t\t\t\t\tclass="chart-wizard-tree-preview__placeholder_name"\n\t\t\t\t\t:class="{'--deputy': isDeputy, '--team': isTeamEntity }"\n\t\t\t\t\t:style="{ 'background-color': teamColor ? teamColor.namePlaceholder : false }"\n\t\t\t\t></span>\n\t\t\t\t<span\n\t\t\t\t\tv-if="!isDeputy"\n\t\t\t\t\tclass="chart-wizard-tree-preview__node_head-position --crop"\n\t\t\t\t>\n\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_HEAD_POSITION') }}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<UserListActionMenu\n\t\t\tv-if="headsVisible"\n\t\t\t:id="isDeputy ? 'wizard-head-list-popup-deputy' : 'wizard-head-list-popup-head' "\n\t\t\t:items="dropdownItems"\n\t\t\t:width="228"\n\t\t\t:bindElement="$refs.showMoreHeadUserWizardList[0]"\n\t\t\t@close="headsVisible = false"\n\t\t\t:titleBar="titleBar"\n\t\t/>\n\t`};const A={name:"treeNode",components:{HeadUsers:S},props:{name:String,heads:Array,userCount:Number,nodeId:Number,entityType:{type:String,default:u.EntityTypes.department},teamColor:{type:[Object,null],default:null}},data(){return{isShowLoader:false}},created(){this.memberRoles=_.getMemberRoles(this.departmentData.entityType)},watch:{isShowLoader(t){if(!t){return}this.$nextTick((()=>{const{loaderContainer:t}=this.$refs;const e=new i.Loader({size:30});e.show(t)}))}},computed:{departmentData(){if(this.isExistingDepartment){if(!this.isHeadsLoaded){this.loadHeads([this.nodeId])}return this.departments.get(this.nodeId)}return{name:this.name,heads:this.heads,userCount:this.userCount,entityType:this.entityType}},isExistingDepartment(){return Boolean(this.nodeId)},employeesCount(){var t;return(this.userCount||0)-(((t=this.heads)==null?void 0:t.length)||0)},headUsers(){var t;return(t=this.departmentData.heads)==null?void 0:t.filter((t=>t.role===this.memberRoles.head))},deputyUsers(){var t;return(t=this.departmentData.heads)==null?void 0:t.filter((t=>t.role===this.memberRoles.deputyHead))},showInfo(){return this.nodeId?E.PermissionChecker.getInstance().hasPermission(E.PermissionActions.structureView,this.nodeId):true},isHeadsLoaded(t){const{heads:e}=this.departments.get(this.nodeId);return Boolean(e)},isTeamEntity(){return this.departmentData.entityType===u.EntityTypes.team},dataTestIdSuffix(){return this.isExistingDepartment?"":"_new"},...n.mapState(p.useChartStore,["departments"])},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},locPlural(t,e){return c.Loc.getMessagePlural(t,e,{"#COUNT#":e})},async loadHeads(t){const e=p.useChartStore();try{this.isShowLoader=true;await e.loadHeads(t)}finally{this.isShowLoader=false}},formatDataTestId(t){return t+this.dataTestIdSuffix}},template:`\n\t\t<div\n\t\t\tclass="chart-wizard-tree-preview__node"\n\t\t\t:class="{ '--new': !isExistingDepartment, '--old': isExistingDepartment,'--team': isTeamEntity }"\n\t\t>\n\t\t\t<div \n\t\t\t\tclass="chart-wizard-tree-preview__node_summary" \n\t\t\t\t:class="{ '--old': isExistingDepartment, '--team': isTeamEntity }"\n\t\t\t\t:style="{ '--team-border-color': teamColor?.previewBorder }"\n\t\t\t>\n\t\t\t\t<div \n\t\t\t\t\tclass="chart-wizard-tree-preview__node_name --crop"\n\t\t\t\t\t:data-test-id="formatDataTestId('chart-wizard-tree-preview__node_name')"\n\t\t\t\t\t:style="{ 'background-color': teamColor ? teamColor.headBackground : false }"\n\t\t\t\t>\n\t\t\t\t\t<span\n\t\t\t\t\t\tv-if="!departmentData.name" \n\t\t\t\t\t\tclass="chart-wizard-tree-preview__placeholder_node_name"\n\t\t\t\t\t\t:class="{ '--team': isTeamEntity }"\n\t\t\t\t\t\t:style="{ 'background-color': teamColor ? teamColor.namePlaceholder : false }"\n\t\t\t\t\t></span>\n\t\t\t\t\t{{departmentData.name}}\n\t\t\t\t</div>\n\t\t\t\t<div \n\t\t\t\t\tclass="chart-wizard-tree-preview__node_content"\n\t\t\t\t\t:data-test-id="formatDataTestId('chart-wizard-tree-preview__head_list')"\n\t\t\t\t>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="chart-wizard-tree-preview__head_list"\n\t\t\t\t\t\t:data-test-id="formatDataTestId('chart-wizard-tree-preview__head_list')"\n\t\t\t\t\t>\n\t\t\t\t\t\t<HeadUsers\n\t\t\t\t\t\t\tv-if="showInfo && headUsers"\n\t\t\t\t\t\t\t:users="headUsers"\n\t\t\t\t\t\t\t:showPlaceholder="!isExistingDepartment"\n\t\t\t\t\t\t\t:isTeamEntity="isTeamEntity"\n\t\t\t\t\t\t\t:isExistingDepartment="isExistingDepartment"\n\t\t\t\t\t\t\t:teamColor="teamColor"\n\t\t\t\t\t\t/> \n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if="isShowLoader" ref="loaderContainer"></div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="showInfo && !isExistingDepartment"\n\t\t\t\t\t\tclass="chart-wizard-tree-preview__node_employees"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass="chart-wizard-tree-preview__node_employees-list"\n\t\t\t\t\t\t\t:data-test-id="formatDataTestId('chart-wizard-tree-preview__node_employees-list')"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<p class="chart-wizard-tree-preview__node_employees-title">\n\t\t\t\t\t\t\t\t{{\n\t\t\t\t\t\t\t\t\tisTeamEntity \n\t\t\t\t\t\t\t\t\t? loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TREE_PREVIEW_TEAM_EMPLOYEES_TITLE') \n\t\t\t\t\t\t\t\t\t: loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TREE_PREVIEW_EMPLOYEES_TITLE')\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<span class="chart-wizard-tree-preview__node_employees_count">\n\t\t\t\t\t\t\t\t{{locPlural('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TREE_PREVIEW_EMPLOYEES_COUNT', employeesCount)}}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div \n\t\t\t\t\t\t\tclass="chart-wizard-tree-preview__node_deputies"\n\t\t\t\t\t\t\t:data-test-id="formatDataTestId('chart-wizard-tree-preview__node_deputies-list')"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<p class="chart-wizard-tree-preview__node_employees-title">\n\t\t\t\t\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TREE_PREVIEW_DEPUTIES_TITLE')}}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<HeadUsers\n\t\t\t\t\t\t\t\t:users="deputyUsers"\n\t\t\t\t\t\t\t\t:isTeamEntity="isTeamEntity"\n\t\t\t\t\t\t\t\t:isExistingDepartment="isExistingDepartment"\n\t\t\t\t\t\t\t\tuserType="deputy"\n\t\t\t\t\t\t\t\t:teamColor="teamColor"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<slot v-if="isExistingDepartment"></slot>\n\t\t</div>\n\t`};const y={name:"treePreview",components:{TreeNode:A},props:{parentId:{type:[Number,null],required:true},name:{type:String,required:true},heads:{type:Array,required:true},userCount:{type:Number,required:true},entityType:{type:String,default:u.EntityTypes.department},teamColor:{type:[Object,null],default:null}},computed:{rootId(){const t=this.departments.get(this.parentId);if(t){var e;return(e=t.parentId)!=null?e:0}return 0},companyName(){const{name:t}=[...this.departments.values()].find((t=>t.parentId===0));return t},isTeamEntity(){return this.entityType===u.EntityTypes.team},...n.mapState(p.useChartStore,["departments"])},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)}},template:`\n\t\t<div class="chart-wizard-tree-preview">\n\t\t\t<div class="chart-wizard-tree-preview__header">\n\t\t\t\t<span class="chart-wizard-tree-preview__header_text">\n\t\t\t\t\t{{\n\t\t\t\t\t\tisTeamEntity\n\t\t\t\t\t\t\t? loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TREE_PREVIEW_TEAM_TITLE')\n\t\t\t\t\t\t\t: loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TREE_PREVIEW_DEPARTMENT_TITLE')\n\t\t\t\t\t}}\n\t\t\t\t</span>\n\t\t\t\t<span class="chart-wizard-tree-preview__header_name">\n\t\t\t\t\t{{ companyName }}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<TreeNode\n\t\t\t\tv-if="rootId"\n\t\t\t\t:nodeId="rootId"\n\t\t\t>\n\t\t\t\t<TreeNode :nodeId="parentId">\n\t\t\t\t\t<TreeNode\n\t\t\t\t\t\t:name="name"\n\t\t\t\t\t\t:heads="heads"\n\t\t\t\t\t\t:userCount="userCount"\n\t\t\t\t\t\t:entityType="entityType"\n\t\t\t\t\t\t:teamColor="teamColor"\n\t\t\t\t\t></TreeNode>\n\t\t\t\t</TreeNode>\n\t\t\t</TreeNode>\n\t\t\t<TreeNode\n\t\t\t\tv-else-if="parentId"\n\t\t\t\t:nodeId="parentId"\n\t\t\t>\n\t\t\t\t<TreeNode\n\t\t\t\t\t:name="name"\n\t\t\t\t\t:heads="heads"\n\t\t\t\t\t:userCount="userCount"\n\t\t\t\t\t:entityType="entityType"\n\t\t\t\t\t:teamColor="teamColor"\n\t\t\t\t></TreeNode>\n\t\t\t</TreeNode>\n\t\t\t<TreeNode\n\t\t\t\tv-else\n\t\t\t\t:name="name"\n\t\t\t\t:heads="heads"\n\t\t\t\t:userCount="userCount"\n\t\t\t\t:entityType="entityType"\n\t\t\t\t:teamColor="teamColor"\n\t\t\t></TreeNode>\n\t\t</div>\n\t`};const U={name:"TeamColorPicker",components:{BasePopup:l.BasePopup},props:{modelValue:{type:Object,required:true},bindElement:{type:HTMLElement,required:true}},emits:["action","close","update:modelValue"],computed:{popupConfig(){const t=164;const e=41;const s=39;const i=33;return{width:t,height:116,bindElement:this.bindElement,borderRadius:12,contentNoPaddings:true,contentPadding:0,padding:0,offsetTop:4,offsetLeft:e/2-t/2+s,angleOffset:t/2-i/2}},nodeColorsSettingsDict(){return u.NodeColorsSettingsDict}},methods:{close(){this.$emit("close")}},template:`\n\t\t<BasePopup\n\t\t\t:config="popupConfig"\n\t\t\t:id="'chart_wizard__department__color-picker_popup'"\n\t\t\t@close="close"\n\t\t>\n\t\t\t<div\n\t\t\t\tclass="chart_wizard__department__color-picker_popup-container"\n\t\t\t\t:data-test-id="'wizard-department-color-picker-popup'"\n\t\t\t>\n\t\t\t\t<div v-for="item in nodeColorsSettingsDict" \n\t\t\t\t\t class="chart_wizard__department__color-picker_color-item"\n\t\t\t\t\t :class=" {'--active': item.name === modelValue.name }"\n\t\t\t\t\t @click="$emit('update:modelValue', item)"\n\t\t\t\t\t :data-test-id="'wizard-department-color-picker-item-'+item.name"\n\t\t\t\t>\n\t\t\t\t\t<div class="chart_wizard__department__color-picker_color-item_inner"\n\t\t\t\t\t\t :style="{ 'background-color': item.pickerColor }"\n\t\t\t\t\t></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</BasePopup>\n\t`};const D={name:"department",components:{TeamColorPicker:U},props:{parentId:{type:[Number,null],required:true},name:{type:String,required:true},description:{type:String,required:true},shouldErrorHighlight:{type:Boolean,required:true},isEditMode:{type:Boolean},entityType:{type:String,required:true},teamColor:{type:[Object,null],default:null},refToFocus:{type:String,default:null}},emits:["applyData"],data(){return{deniedError:false,showColorPicker:false,teamColorValue:this.teamColor,locked:false}},watch:{isTeamEntity(){this.recreateTagSelector()}},created(){this.selectedParentDepartment=this.parentId;this.departmentName=this.name;this.departmentDescription=this.description;this.departmentSelectorCashe=new a.MemoryCache;this.departmentsSelector=this.getOrCreateTagSelector()},mounted(){this.departmentsSelector.renderTo(this.$refs["tag-selector"])},activated(){var t;this.teamColorValue=this.teamColor;this.$emit("applyData",{isDepartmentDataChanged:false,isValid:this.departmentName&&((t=this.departmentName)==null?void 0:t.trim())!==""&&this.selectedParentDepartment!==null&&!this.deniedError});if(this.refToFocus&&this.$refs[this.refToFocus]){this.$refs[this.refToFocus].focus()}else{this.$refs.title.focus()}},methods:{recreateTagSelector(){this.$refs["tag-selector"].innerHTML="";this.departmentsSelector=this.getOrCreateTagSelector();this.departmentsSelector.renderTo(this.$refs["tag-selector"])},createTagSelector(){this.locked=this.isTagSelectorLocked();let t=this.parentId?[["structure-node",this.parentId]]:[];if(!this.isEditMode){const e=E.PermissionChecker.getInstance();const s=this.isTeamEntity?E.PermissionActions.teamCreate:E.PermissionActions.departmentCreate;if(e&&!e.hasPermission(s,this.parentId)){t=[["structure-node",0]]}}const e=t=>t.getRootNode().getChildren().count()===0;const s=new h.TagSelector({events:{onTagAdd:t=>{const{tag:e}=t.data;this.selectedParentDepartment=e.id},onTagRemove:()=>{this.selectedParentDepartment=null;this.applyData()}},multiple:false,locked:this.locked,dialogOptions:{width:425,height:350,dropdownMode:true,hideOnDeselect:true,entities:[{id:"structure-node",options:{selectMode:"departmentsOnly",restricted:this.isEditMode?"update":"create",includedNodeEntityTypes:this.includedNodeEntityTypesInDialog,useMultipleTabs:true}}],preselectedItems:t,events:{onLoad:t=>{var i,n,a;const r=s.getDialog();r.getTabs().filter((t=>e(t))).forEach((t=>t.setVisible(false)));const o=t.target;const d=(i=o.selectedItems)==null?void 0:(n=i.values())==null?void 0:(a=n.next())==null?void 0:a.value;if(this.isEditMode){if((d==null?void 0:d.id)===this.parentId&&this.locked){s.lock()}return}const l=E.PermissionChecker.getInstance();if(!l){return}const c=o.items.get("structure-node");const h=this.isTeamEntity?E.PermissionActions.teamCreate:E.PermissionActions.departmentCreate;for(const[,t]of c){var _;if(l.hasPermission(h,t.id)&&!l.hasPermission(h,(_=d==null?void 0:d.id)!=null?_:0)){t.select();break}}},onLoadError:()=>{this.selectedParentDepartment=null;this.applyData()},"Item:onSelect":t=>{var e,s,i;this.deniedError=false;const n=t.target;const a=(e=n.selectedItems)==null?void 0:(s=e.values())==null?void 0:(i=s.next())==null?void 0:i.value;const r=E.PermissionChecker.getInstance();if(!r){return}const o=this.departments.get(a.id);if(!o){return}const d=(o==null?void 0:o.entityType)===u.EntityTypes.team;const l=this.isTeamEntity?E.PermissionActions.teamCreate:E.PermissionActions.departmentCreate;const c=d?E.PermissionActions.teamEdit:E.PermissionActions.departmentEdit;const h=this.isEditMode?c:l;if(!r.hasPermission(h,a.id)){this.deniedError=true}this.applyData()}}}});return s},getOrCreateTagSelector(){const t=String(this.isTeamEntity);return this.departmentSelectorCashe.remember(t,(()=>this.createTagSelector()))},loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},applyData(){var t;this.$emit("applyData",{apiEntityChanged:u.WizardApiEntityChangedDict.department,name:this.departmentName,description:this.departmentDescription,parentId:this.selectedParentDepartment,teamColor:this.teamColorValue,isDepartmentDataChanged:true,isValid:this.departmentName&&((t=this.departmentName)==null?void 0:t.trim())!==""&&this.selectedParentDepartment!==null&&!this.deniedError})},isTagSelectorLocked(){if(!this.isEditMode){return false}if(this.parentId===0){return true}const t=this.departments.get(this.parentId);if(!t){return false}const e=E.PermissionChecker.getInstance();if(!e){return true}if(t.entityType===u.EntityTypes.department){return!e.hasPermission(E.PermissionActions.departmentEdit,t.id)}if(t.entityType===u.EntityTypes.team){return!e.hasPermission(E.PermissionActions.teamEdit,t.id)}return false}},computed:{includedNodeEntityTypesInDialog(){return this.isTeamEntity?["department","team"]:["department"]},isTeamEntity(){return this.entityType===u.EntityTypes.team},namePlaceholder(){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_NAME_PLACEHOLDER_MSGVER_1"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_NAME_PLACEHOLDER")},descriptionPlaceholder(){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_DESCR_PLACEHOLDER"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_DESCR_PLACEHOLDER")},higherLevelDepartmentContainer(){return this.isTeamEntity?".chart-wizard__department_higher_bottom":".chart-wizard__department_higher_top"},showLockedSelectorErrorText(){return this.locked&&this.parentId!==0},selectorErrorText(){if(this.deniedError){return this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ADD_TO_DEPARTMENT_DENIED_MSG_VER_1")}if(this.locked&&this.parentId!==0){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_PARENT_TEAM_ERROR"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_PARENT_DEPARTMENT_ERROR")}return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_PARENT_ERROR"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_PARENT_ERROR")},...n.mapState(p.useChartStore,["departments"])},template:`\n\t\t<div class="chart-wizard__department">\n\t\t\t<div class="chart-wizard__form">\n\t\t\t\t<Teleport defer :to="higherLevelDepartmentContainer">\n\t\t\t\t\t<span class="chart-wizard__department_item-label">\n\t\t\t\t\t\t{{\n\t\t\t\t\t\t\tisTeamEntity\n\t\t\t\t\t\t\t\t? loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_HIGHER_WITH_TEAM_LABEL')\n\t\t\t\t\t\t\t\t: loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_HIGHER_LABEL')\n\t\t\t\t\t\t}}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div\n\t\t\t\t\t\t:class="{ 'ui-ctl-warning': deniedError || (selectedParentDepartment === null && shouldErrorHighlight) }"\n\t\t\t\t\t\tref="tag-selector"\n\t\t\t\t\t></div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="deniedError || (selectedParentDepartment === null && shouldErrorHighlight) || showLockedSelectorErrorText"\n\t\t\t\t\t\tclass="chart-wizard__department_item-error"\n\t\t\t\t\t\t:class="{'--wizard-warning-item':  locked && parentId !== 0}"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass="ui-icon-set --warning"\n\t\t\t\t\t\t\t:style="locked && !deniedError ? { '--ui-icon-set__icon-size': '17px', '--ui-icon-set__icon-color': '#FFA900' } : {}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<span class="chart-wizard__department_item-error-message">\n\t\t\t\t\t\t\t{{ selectorErrorText }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</Teleport>\n\t\t\t\t<div\n\t\t\t\t\tv-show="!isTeamEntity"\n\t\t\t\t\tclass="chart-wizard__department_item chart-wizard__department_higher_top">\n\t\t\t\t</div>\n\t\t\t\t<div class="chart-wizard__department_item">\n\t\t\t\t\t<span class="chart-wizard__department_item-label">\n\t\t\t\t\t\t{{\n\t\t\t\t\t\t\tisTeamEntity\n\t\t\t\t\t\t\t\t? loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_TEAM_NAME_LABEL')\n\t\t\t\t\t\t\t\t: loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_NAME_LABEL') \n\t\t\t\t\t\t}}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div class="chart-wizard__department_control-wrapper">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass="ui-ctl ui-ctl-textbox"\n\t\t\t\t\t\t\t:class="{ 'ui-ctl-warning': shouldErrorHighlight && departmentName === '' }"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tv-model="departmentName"\n\t\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\t\tmaxlength="255"\n\t\t\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t\t\tref="title"\n\t\t\t\t\t\t\t\t:placeholder="namePlaceholder"\n\t\t\t\t\t\t\t\t@input="applyData()"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-if="isTeamEntity" \n\t\t\t\t\t\t\t class="chart-wizard__department__color-picker" \n\t\t\t\t\t\t\t @click="showColorPicker = true"\n\t\t\t\t\t\t\t ref="TeamColorPicker"\n\t\t\t\t\t\t\t :data-test-id="'wizard-department-color-picker'"\n\t\t\t\t\t\t\t :class="{ '--active': showColorPicker }"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class="chart-wizard__department__color-picker_inner"\n\t\t\t\t\t\t\t\t :style="{ 'background-color': teamColorValue?.pickerColor }"\n\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="shouldErrorHighlight && departmentName === ''"\n\t\t\t\t\t\tclass="chart-wizard__department_item-error"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="ui-icon-set --warning"></div>\n\t\t\t\t\t\t<span class="chart-wizard__department_item-error-message">\n\t\t\t\t\t\t\t{{\n\t\t\t\t\t\t\t\tisTeamEntity\n\t\t\t\t\t\t\t\t\t? loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_NAME_ERROR')\n\t\t\t\t\t\t\t\t\t: loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_NAME_ERROR')\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="chart-wizard__department_item">\n\t\t\t\t\t<span class="chart-wizard__department_item-label">\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_DESCR_LABEL') }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div class="ui-ctl ui-ctl-textarea ui-ctl-no-resize">\n\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\tv-model="departmentDescription"\n\t\t\t\t\t\t\tmaxlength="255"\n\t\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t\tref="description"\n\t\t\t\t\t\t\t:placeholder="descriptionPlaceholder"\n\t\t\t\t\t\t\t@change="applyData()"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t</textarea>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tv-show="isTeamEntity"\n\t\t\t\t\tclass="chart-wizard__department_item chart-wizard__department_higher_bottom"\n\t\t\t\t></div>\n\t\t\t</div>\n\t\t\t<TeamColorPicker\n\t\t\t\tv-if="showColorPicker"\n\t\t\t\t:bindElement="$refs.TeamColorPicker"\n\t\t\t\tv-model="teamColorValue"\n\t\t\t\t@update:model-value="applyData()"\n\t\t\t\t@close="showColorPicker = false"\n\t\t\t/>\n\t\t</div>\n\t`};const I=Object.freeze({moveUsers:"moveUsers",addUsers:"addUsers"});const g={name:"changeSaveModeControl",emits:["saveModeChanged"],components:{RouteActionMenu:l.RouteActionMenu},created(){this.menuItems=this.getMenuItems()},data(){return{menuVisible:false,actionId:I.moveUsers}},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},onActionMenuItemClick(t){this.actionId=t;this.$emit("saveModeChanged",t)},getMenuItems(){return[{id:I.moveUsers,title:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_MOVE_USERS_TITLE"),description:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_MOVE_USERS_DESCRIPTION"),bIcon:{name:o.Main.PERSON_ARROW_LEFT_1,size:20,color:u.getColorCode("paletteBlue50")}},{id:I.addUsers,title:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_ADD_USERS_TITLE"),description:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_ADD_USERS_DESCRIPTION"),bIcon:{name:o.CRM.PERSON_PLUS_2,size:20,color:u.getColorCode("paletteBlue50")}}]}},computed:{getControlButtonText(){const t=this.actionId===I.moveUsers?"HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_MOVE_USERS_TITLE":"HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_ADD_USERS_TITLE";return this.loc(t)}},template:`\n\t\t<div\n\t\t\tclass="chart-wizard__change-save-mode-control-container"\n\t\t>\n\t\t\t<span>{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_SAVE_MODE_CONTROL_TEXT') }}</span>\n\t\t\t<a\n\t\t\t\tclass="chart-wizard__change-save-mode-control-button"\n\t\t\t\t:class="{ '--focused': menuVisible }"\n\t\t\t\tref='changeSaveModeButton'\n\t\t\t\t@click="menuVisible = true"\n\t\t\t>\n\t\t\t\t{{ getControlButtonText }}\n\t\t\t</a>\n\t\t</div>\n\t\t<RouteActionMenu\n\t\t\tv-if="menuVisible"\n\t\t\t:id="'hr-wizard-save-mode-menu'"\n\t\t\t:items="menuItems"\n\t\t\t:width="302"\n\t\t\t:bindElement="$refs.changeSaveModeButton"\n\t\t\t@action="onActionMenuItemClick"\n\t\t\t@close="menuVisible = false"\n\t\t/>\n\t`};const N={name:"employees",components:{ChangeSaveModeControl:g},emits:["applyData","saveModeChanged"],props:{heads:{type:Array,required:true},employeesIds:{type:Array,required:true},isEditMode:{type:Boolean,required:true},entityType:{type:String,required:true}},created(){this.memberRoles=_.getMemberRoles(this.entityType);this.selectedUsers=new Set;this.departmentHeads=[];this.departmentEmployees=[];this.removedUsers=[];this.headSelector=this.getUserSelector(_.memberRolesKeys.head);this.deputySelector=this.getUserSelector(_.memberRolesKeys.deputyHead);this.employeesSelector=this.getUserSelector(_.memberRolesKeys.employee);this.userCount=0;this.initialUsers=this.heads.reduce(((t,e)=>t.add(e.id)),new Set);this.employeesIds.forEach((t=>this.initialUsers.add(t)))},mounted(){this.headSelector.renderTo(this.$refs["head-selector"]);this.deputySelector.renderTo(this.$refs["deputy-selector"]);this.employeesSelector.renderTo(this.$refs["employees-selector"])},activated(){this.$emit("applyData",{isDepartmentDataChanged:false,isValid:true})},watch:{entityType(t){const e=this.memberRoles;const s=Object.keys(e);this.memberRoles=_.getMemberRoles(t);this.departmentHeads=this.departmentHeads.map((t=>{const i=s.find((s=>e[s]===t.role));return{...t,role:this.memberRoles[i]}}));this.departmentEmployees=this.departmentEmployees.map((t=>({...t,role:this.memberRoles.employee})))},employeesIds:{handler(t){this.employeesIds.forEach((t=>this.initialUsers.add(t)));const e=t.map((t=>["user",t]));const{dialog:s}=this.employeesSelector;s.setPreselectedItems(e);s.load()}}},methods:{getPreselectedItems(t){if(this.memberRoles.employee===t){return this.employeesIds.map((t=>["user",t]))}return this.heads.filter((e=>e.role===t)).map((t=>["user",t.id]))},getUserSelector(t){const e=new h.TagSelector({events:{onTagAdd:e=>{const{tag:s}=e.getData();this.selectedUsers.add(s.id);this.onSelectorToggle(s,this.memberRoles[t]);if(this.initialUsers.has(s.id)){this.initialUsers.delete(s.id)}else{this.applyData()}},onTagRemove:e=>{const{tag:s}=e.getData();this.selectedUsers.delete(s.id);this.onSelectorToggle(s,this.memberRoles[t]);this.applyData()}},multiple:true,dialogOptions:{preselectedItems:this.getPreselectedItems(this.memberRoles[t]),popupOptions:{events:{onBeforeShow:()=>{s.setHeight(250);if(s.isLoaded()){this.toggleUsers(s)}}}},events:{onShow:()=>{const{dialog:t}=e;const s=t.getContainer();const{top:i}=s.getBoundingClientRect();const n=i+s.offsetHeight-document.body.offsetHeight;if(n>0){const e=5;t.setHeight(s.offsetHeight-n-e)}},onLoad:t=>{this.toggleUsers(s);const e=t.target.items.get("user");e.forEach((t=>{t.setLink("")}))},"SearchTab:onLoad":()=>{this.toggleUsers(s)}},height:250,width:380,entities:[{id:"user",options:{intranetUsersOnly:true,inviteEmployeeLink:true}}],dropdownMode:true,hideOnDeselect:false}});const s=e.getDialog();return e},loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},toggleUsers(t){const e=t.getItems();e.forEach((e=>{const s=this.selectedUsers.has(e.id)&&!t.selectedItems.has(e);e.setHidden(s)}))},onSelectorToggle(t,e){const s=t.selector.dialog.getItem(["user",t.id]);const i=u.getUserDataBySelectorItem(s,e);const n=e===this.memberRoles.employee;if(!t.rendered){this.removedUsers=this.removedUsers.filter((t=>t.id!==i.id));if(n){this.departmentEmployees=[...this.departmentEmployees,{...i}]}else{this.departmentHeads=[...this.departmentHeads,{...i}]}this.userCount+=1;return}const{preselectedItems:a=[]}=t.selector.dialog;const r=a.flat().filter((t=>t!=="user"));if(r.includes(i.id)){this.removedUsers=[...this.removedUsers,{...i,role:e}]}if(n){this.departmentEmployees=this.departmentEmployees.filter((e=>e.id!==t.id))}else{this.departmentHeads=this.departmentHeads.filter((e=>e.id!==t.id))}this.userCount-=1},applyData(){this.$emit("applyData",{apiEntityChanged:u.WizardApiEntityChangedDict.employees,heads:this.departmentHeads,employees:this.departmentEmployees,removedUsers:this.removedUsers,userCount:this.userCount,isDepartmentDataChanged:true})},handleSaveModeChangedChanged(t){this.$emit("saveModeChanged",t)}},computed:{isTeamEntity(){return this.entityType===u.EntityTypes.team},employeeTitle(){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_TEAM_EMPLOYEES_TITLE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_EMPLOYEES_TITLE")}},template:`\n\t\t<div class="chart-wizard__employee">\n\t\t\t<div class="chart-wizard__form">\n\t\t\t\t<div class="chart-wizard__employee_item">\n\t\t\t\t\t<span class="chart-wizard__employee_item-label">\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_HEAD_TITLE') }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="chart-wizard__employee_selector"\n\t\t\t\t\t\tref="head-selector"\n\t\t\t\t\t\tdata-test-id="hr-company-structure_chart-wizard__employees-head-selector"\n\t\t\t\t\t/>\n\t\t\t\t\t<span class="chart-wizard__employee_item-description">\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_HEAD_DESCR') }}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="chart-wizard__employee_item">\n\t\t\t\t\t<span class="chart-wizard__employee_item-label">\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_DEPUTY_TITLE') }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="chart-wizard__employee_selector"\n\t\t\t\t\t\tref="deputy-selector"\n\t\t\t\t\t\tdata-test-id="hr-company-structure_chart-wizard__employees-deputy-selector"\n\t\t\t\t\t/>\n\t\t\t\t\t<span class="chart-wizard__employee_item-description">\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_DEPUTY_DESCR') }}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="chart-wizard__employee_item">\n\t\t\t\t\t<span class="chart-wizard__employee_item-label">\n\t\t\t\t\t\t{{ employeeTitle }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="chart-wizard__employee_selector"\n\t\t\t\t\t\tref="employees-selector"\n\t\t\t\t\t\tdata-test-id="hr-company-structure_chart-wizard__employees-employee-selector"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div v-if="!isTeamEntity" class="chart-wizard__employee_item --change-save-mode-control">\n\t\t\t\t\t<ChangeSaveModeControl\n\t\t\t\t\t\tv-if="!isEditMode"\n\t\t\t\t\t\t@saveModeChanged="handleSaveModeChangedChanged"\n\t\t\t\t\t></ChangeSaveModeControl>\n\t\t\t\t\t<div class="chart-wizard__change-save-mode-control-container" v-else>\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_EDIT_WIZARD_EMPLOYEE_SAVE_MODE_TEXT') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const M="default";const v={name:"chatSelector",components:{DefaultHint:l.DefaultHint,BIcon:d.BIcon},props:{name:{type:String,required:true},headsCreated:{type:Boolean,required:true},isTeamEntity:{type:Boolean,required:true},initChats:{type:Array,required:true},type:{type:String,required:true}},emits:["applyData"],data(){return{createDefault:false}},computed:{isChannel(){return this.type===l.ChatTypeDict.channel},set(){return o.Set},hintText(){if(this.isChannel){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHANNELS_ADD_CHECKBOX_HINT"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHANNELS_ADD_CHECKBOX_HINT_MSGVER_1")}return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHATS_ADD_CHECKBOX_HINT"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHATS_ADD_CHECKBOX_HINT_MSGVER_1")},createText(){if(this.isChannel){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHANNELS_ADD_CHECKBOX_LABEL_MSGVER_1"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHANNELS_ADD_CHECKBOX_LABEL_MSGVER_2")}return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHATS_ADD_CHECKBOX_LABEL_MSGVER_1"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHATS_ADD_CHECKBOX_LABEL_MSGVER_2")},removeText(){if(this.isChannel){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHANNELS_REMOVE_CHECKBOX_LABEL"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHANNELS_REMOVE_CHECKBOX_LABEL")}return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHATS_REMOVE_CHECKBOX_LABEL"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHATS_REMOVE_CHECKBOX_LABEL")},warningText(){if(this.isChannel){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHANNELS_ADD_CHECKBOX_WARNING"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHANNELS_ADD_CHECKBOX_WARNING")}return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHATS_ADD_CHECKBOX_WARNING"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHATS_ADD_CHECKBOX_WARNING")}},watch:{createDefault(t){if(t){this.selector.getDialog().getItem({id:M,entityId:M}).select()}else{this.selector.getDialog().getItem({id:M,entityId:M}).deselect()}},name(t){const e=this.selector.getDialog().getItem({id:M,entityId:M});e.setTitle(t);if(this.createDefault){e.deselect();e.select()}},initChats:{handler(t){t.forEach((t=>this.initialChatsSet.add(`chat${t.id}`)));const e=t.map((t=>["im-chat-only",`chat${t.id}`]));const{dialog:s}=this.selector;s.setPreselectedItems(e);s.load()}}},created(){this.chats=[];this.initialChatsSet=this.initChats.reduce(((t,e)=>t.add(`chat${e.id}`)),new Set);this.selector=this.getSelector()},mounted(){this.selector.renderTo(this.$refs["chat-selector"])},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},addChatTag(t){if(!t.searchable){const e=this.initChats.find((e=>e.dialogId===t.id));if(e!=null&&e.title){t.setTitle(e.title);if(e.hasAccess){t.setDeselectable(true)}}}this.chats.push(Number(t.id.replace("chat","")))},getSelector(){var t,e;const s=this.isChannel?l.getChannelDialogEntity():l.getChatDialogEntity();const i={multiple:true,events:{onTagAdd:t=>{const{tag:e}=t.getData();if(e.id===M){this.createDefault=true}else{this.addChatTag(e)}if(this.initialChatsSet.has(e.id)){this.initialChatsSet.delete(e.id)}else{this.applyData()}},onTagRemove:t=>{const{tag:e}=t.getData();const s=Number(e.id.replace("chat",""));if(e.id===M){this.createDefault=false}else{this.chats=this.chats.filter((t=>t!==s))}this.applyData()}},dialogOptions:{enableSearch:true,height:250,width:380,dropdownMode:true,recentTabOptions:l.getChatRecentTabOptions(this.entityType,this.type),items:[this.getDefaultItem((t=s.tagOptions)==null?void 0:t.default,(e=s.itemOptions)==null?void 0:e.default)],preselectedItems:this.initChats.map((t=>["im-chat-only",`chat${t.id}`])),entities:[s]}};return new h.TagSelector(i)},getDefaultItem(t={},e={}){return{id:M,entityId:M,title:this.name,searchable:false,tagOptions:t,...e}},applyData(){this.$emit("applyData",{type:this.type,chats:this.chats,createDefault:this.createDefault})},getTestId(t){if(this.isChannel){return t.replace("chat","channel")}return t}},template:`\n\t\t<div\n\t\t\tclass="chart-wizard__chat_selector"\n\t\t\tref="chat-selector"\n\t\t\t:data-test-id="getTestId('hr-company-structure_chart-wizard__chat-selector')"\n\t\t/>\n\t\t<div\n\t\t\tv-if="!createDefault"\n\t\t\tclass="chart-wizard__bind-chat__item-checkbox_container"\n\t\t>\n\t\t\t<div\n\t\t\t\t@click="createDefault = headsCreated"\n\t\t\t\tclass="chart-wizard__bind-chat__item-create"\n\t\t\t\t:class="{ '--disabled': !headsCreated }"\n\t\t\t\t:data-test-id="getTestId('hr-company-structure_chart-wizard__make-default-chat-create')"\n\t\t\t\tv-html="createText"\n\t\t\t>\n\t\t\t</div>\n\t\t\t<DefaultHint :content="hintText" />\n\t\t</div>\n\t\t<div v-else class="chart-wizard__bind-chat__item-checkbox_container">\n\t\t\t<div class="ui-icon-set --o-circle-check"></div>\n\t\t\t<div\n\t\t\t\tclass="chart-wizard__bind-chat__item-remove"\n\t\t\t\t:class="{ '--disabled': !headsCreated }"\n\t\t\t\t:data-test-id="getTestId('hr-company-structure_chart-wizard__make-default-chat-remove')"\n\t\t\t>\n\t\t\t\t{{ removeText }}\n\t\t\t</div>\n\t\t</div>\n\t\t<div v-if="!headsCreated" class="chart-wizard__bind-chat__item-checkbox_warning">\n\t\t\t<BIcon\n\t\t\t\t:name="set.WARNING"\n\t\t\t\tcolor="#FFA900"\n\t\t\t\t:size="16"\n\t\t\t></BIcon>\n\t\t\t<span>\n\t\t\t\t{{ warningText }}\n\t\t\t</span>\n\t\t</div>\n\t`};const O={name:"bindChat",components:{ChatSelector:v},props:{heads:{type:Array,required:false,default:()=>[]},name:{type:String,required:true},entityType:{type:String,required:true},isEditMode:{type:Boolean,required:true},initChats:{type:Array,required:true},initChannels:{type:Array,required:true}},emits:["applyData"],computed:{chatHintText(){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHATS_ADD_CHECKBOX_HINT"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHATS_ADD_CHECKBOX_HINT_MSGVER_1")},channelHintText(){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHANNELS_ADD_CHECKBOX_HINT"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHANNELS_ADD_CHECKBOX_HINT_MSGVER_1")},headsCreated(){const t=_.getMemberRoles(this.entityType);return this.heads.some((e=>e.role===t.head))},isTeamEntity(){return this.entityType===u.EntityTypes.team},hints(){if(this.isTeamEntity){return[this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_HINT_1"),this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_HINT_2"),this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_HINT_3")]}return[this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_HINT_1_MSGVER_1"),this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_HINT_2_MSGVER_1"),this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_HINT_3")]},ChatTypeDict(){return l.ChatTypeDict}},watch:{initChats(t){this.chats=t.map((t=>t.id))},initChannels(t){this.channels=t.map((t=>t.id))}},created(){this.chats=this.initChats.map((t=>t.id));this.channels=this.initChannels.map((t=>t.id));this.createDefaultChat=false;this.createDefaultChannel=false},activated(){this.$emit("applyData",{isDepartmentDataChanged:false,isValid:true})},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},applyData(){this.$emit("applyData",{apiEntityChanged:u.WizardApiEntityChangedDict.bindChats,chats:this.chats,channels:this.channels,createDefaultChat:this.createDefaultChat,createDefaultChannel:this.createDefaultChannel,isDepartmentDataChanged:true})},onChatSelectorChanged(t){if(t.type===l.ChatTypeDict.chat){this.chats=t.chats;this.createDefaultChat=t.createDefault}else{this.channels=t.chats;this.createDefaultChannel=t.createDefault}this.applyData()}},template:`\n\t\t<div class="chart-wizard__bind-chat">\n\t\t\t<div class="chart-wizard__bind-chat__item">\n\t\t\t\t<div v-if="!isEditMode" class="chart-wizard__bind-chat__item-hint" :class="{ '--team': isTeamEntity }">\n\t\t\t\t\t<div class="chart-wizard__bind-chat__item-hint_logo" :class="{ '--team': isTeamEntity }"></div>\n\t\t\t\t\t<div class="chart-wizard__bind-chat__item-hint_text">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass="chart-wizard__bind-chat__item-hint_title"\n\t\t\t\t\t\t\tv-html="\n\t\t\t\t\t\t\t\tisTeamEntity \n\t\t\t\t\t\t\t\t\t? loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_HINT_TITLE')\n\t\t\t\t\t\t\t\t\t: loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_HINT_TITLE')\n\t\t\t\t\t\t\t"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-for="hint in hints"\n\t\t\t\t\t\t\t class="chart-wizard__bind-chat__item-hint_text-item"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass="chart-wizard__bind-chat__item-hint_text-item_icon"\n\t\t\t\t\t\t\t\t:class="{ '--team': isTeamEntity }"\n\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t\t<span>{{ hint }}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="chart-wizard__bind-chat__item-options">\n\t\t\t\t\t<div class="chart-wizard__bind-chat__item-options__item-content_title">\n\t\t\t\t\t\t<div class="chart-wizard__bind-chat__item-options__item-content_title-text">\n\t\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHATS_TITLE') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<span class="chart-wizard__bind-chat__item-description">\n\t\t\t\t\t\t{{\n\t\t\t\t\t\t\tisTeamEntity\n\t\t\t\t\t\t\t\t? loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHATS_DESCRIPTION')\n\t\t\t\t\t\t\t\t: loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHATS_DESCRIPTION')\n\t\t\t\t\t\t}}\n\t\t\t\t\t</span>\n\t\t\t\t\t<ChatSelector\n\t\t\t\t\t\t:name="name"\n\t\t\t\t\t\t:headsCreated="headsCreated"\n\t\t\t\t\t\t:initChats="initChats"\n\t\t\t\t\t\t:type="ChatTypeDict.chat"\n\t\t\t\t\t\t:isTeamEntity="isTeamEntity"\n\t\t\t\t\t\t@applyData="onChatSelectorChanged"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class="chart-wizard__bind-chat__item-options">\n\t\t\t\t\t<div class="chart-wizard__bind-chat__item-options__item-content_title">\n\t\t\t\t\t\t<div class="chart-wizard__bind-chat__item-options__item-content_title-text">\n\t\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHANNELS_TITLE') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<span class="chart-wizard__bind-chat__item-description">\n\t\t\t\t\t\t{{\n\t\t\t\t\t\t\tisTeamEntity\n\t\t\t\t\t\t\t\t? loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_SELECT_CHANNELS_DESCRIPTION')\n\t\t\t\t\t\t\t\t: loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_SELECT_CHANNELS_DESCRIPTION')\n\t\t\t\t\t\t}}\n\t\t\t\t\t</span>\n\t\t\t\t\t<ChatSelector\n\t\t\t\t\t\t:name="name"\n\t\t\t\t\t\t:headsCreated="headsCreated"\n\t\t\t\t\t\t:initChats="initChannels"\n\t\t\t\t\t\t:type="ChatTypeDict.channel"\n\t\t\t\t\t\t:isTeamEntity="isTeamEntity"\n\t\t\t\t\t\t@applyData="onChatSelectorChanged"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const f={props:{parentId:{type:[Number,null],required:true}},components:{ResponsiveHint:l.ResponsiveHint},data(){return{selectedEntityType:u.EntityTypes.department}},emits:["applyData"],created(){this.hint=null;this.hintHideTimeout=null;const t=E.PermissionChecker.getInstance();const e=this.parentId===0?t.hasPermissionOfAction(E.PermissionActions.teamCreate):t.hasPermission(E.PermissionActions.teamCreate,this.parentId);const s=this.parentId===0?t.hasPermissionOfAction(E.PermissionActions.departmentCreate):t.hasPermission(E.PermissionActions.departmentCreate,this.parentId);this.entities=[{type:u.EntityTypes.department,title:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_DEPARTMENT_TITLE"),description:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_DEPARTMENT_DESCR"),isEnabled:s,hint:!s&&this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_DEPARTMENT_NO_ACCESS_HINT"),isSoon:false},{type:u.EntityTypes.team,title:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_FUNCTIONAL_TEAM_TITLE_MSGVER_1"),description:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_FUNCTIONAL_TEAM_DESCR"),isEnabled:E.PermissionChecker.isTeamsAvailable&&e,hint:E.PermissionChecker.isTeamsAvailable&&!e&&this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_FUNCTIONAL_TEAM_NO_ACCESS_HINT_MSGVER_1"),isSoon:!t.isTeamsAvailable},{type:u.EntityTypes.company,title:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_COMPANY_TITLE"),description:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_COMPANY_DESCR"),isEnabled:false,isSoon:true}];for(const t of this.entities){if(t.isEnabled){this.selectedEntityType=t.type;break}}this.applyData(this.selectedEntityType)},activated(){this.applyData(this.selectedEntityType)},deactivated(){var t;(t=this.hint)==null?void 0:t.hide();clearTimeout(this.hintHideTimeout);this.hintHideTimeout=null},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},applyData(t){this.selectedEntityType=t;this.$emit("applyData",{isValid:true,isDepartmentDataChanged:false,entityType:this.selectedEntityType})},showHint(t,e){if(this.hintHideTimeout){return}const s=300;this.hint=c.Reflection.getClass("BX.UI.Hint").createInstance({popupParameters:{width:s,bindOptions:{position:"top"},offsetLeft:225,offsetTop:-23,angle:{offset:s/2-33/2}}});this.hint.show(e.target,t);this.hintHideTimeout=setTimeout((()=>{var t;(t=this.hint)==null?void 0:t.hide();this.hintHideTimeout=null}),2e3)}},template:`\n\t\t<div\n\t\t\tv-for="entity in entities"\n\t\t\tclass="chart-wizard__entity-wrapper"\n\t\t>\n\t\t\t<span v-if="entity.hint" @click="showHint(entity.hint, $event)" class="ui-hint chart-wizard__entity_hint-layout"></span>\n\t\t\t<div class="chart-wizard__entity"\n\t\t\t\t :class="{ \n\t\t\t\t\t['--' + entity.type.toLowerCase()]: true, \n\t\t\t\t\t'--selected': entity.type === selectedEntityType, \n\t\t\t\t\t'--enabled': entity.isEnabled \n\t\t\t\t}"\n\t\t\t\t@click="entity.isEnabled && applyData(entity.type)"\n\t\t\t>\n\t\t\t\t<div class="chart-wizard__entity_summary">\n\t\t\t\t\t<h2\n\t\t\t\t\t\tclass="chart-wizard__entity_title"\n\t\t\t\t\t\t:data-title="entity.isSoon ? loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_ACCESS_TITLE') : null"\n\t\t\t\t\t\t:class="{ '--disabled': !entity.isEnabled, '--soon': entity.isSoon }"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{entity.title}}\n\t\t\t\t\t</h2>\n\t\t\t\t\t<p class="chart-wizard__entity_description" :class="{ '--disabled': !entity.isEnabled}">\n\t\t\t\t\t\t{{entity.description}}\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const P={name:"teamRights",emits:["applyData"],props:{name:{type:String,required:true},settings:{type:Object,required:false}},created(){this.hints=[this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_HINT_1"),this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_HINT_2")];this.initBpValues=new Set;this.businessProcSelector=this.getTagSelector(u.NodeSettingsTypes.businessProcAuthority,false);this.reportsSelector=this.getTagSelector(u.NodeSettingsTypes.reportsAuthority,true)},mounted(){this.businessProcSelector.renderTo(this.$refs["business-proc-selector"]);this.reportsSelector.renderTo(this.$refs["reports-selector"])},activated(){this.$emit("applyData",{isDepartmentDataChanged:false,isValid:true})},watch:{settings:{handler(t){if(t[u.NodeSettingsTypes.businessProcAuthority]){const e=this.getTagItems(false).filter((e=>t[u.NodeSettingsTypes.businessProcAuthority].has(e.id)));e.forEach((t=>{const e=this.businessProcSelector.dialog.getItem(["head-type",t.id]);if(e){this.initBpValues.add(t.id);e.select()}}))}}}},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},applyData(){this.$emit("applyData",{apiEntityChanged:u.WizardApiEntityChangedDict.settings,settings:this.settings,isDepartmentDataChanged:true})},getTagSelector(t,e){return new h.TagSelector({events:{onTagAdd:e=>{const{tag:s}=e.getData();this.settings[t].add(s.id);if(this.initBpValues.has(s.id)){this.initBpValues.delete(s.id)}else{this.applyData()}},onTagRemove:e=>{const{tag:s}=e.getData();this.settings[t].delete(s.id);this.applyData()}},multiple:true,id:"head-type-selector",locked:e,tagFontWeight:"700",showAddButton:!e,dialogOptions:{id:"head-type-selector",events:{"Item:onBeforeSelect":t=>{var e;const{item:s}=t.getData();if(!((e=s.getCustomData())!=null&&e.get("selectable"))){t.preventDefault()}}},width:400,height:200,dropdownMode:true,showAvatars:false,selectedItems:this.getTagItems(e).filter((e=>this.settings[t].has(e.id))),items:this.getTagItems(e),undeselectedItems:[["head-type",R.departmentHead]]}})},getTagItems(t){const e={bgColor:"#BDC1C6",textColor:"#525C69"};const s={bgColor:"#ADE7E4",textColor:"#207976"};const i={bgColor:"#CCE3FF",textColor:"#3592FF"};const n={customData:{selectable:false},textColor:"#C9CCD0",badges:[{title:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_SOON_ITEM_BADGE"),textColor:"#FFFFFF",bgColor:"#2FC6F6"}],badgesOptions:{justifyContent:"right"}};return[{id:R.departmentHead,entityId:"head-type",tabs:"recents",title:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_DEPARTMENT_HEAD_ITEM"),tagOptions:t?e:s,customData:{selectable:true}},{id:R.teamHead,entityId:"head-type",tabs:"recents",title:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_TEAM_HEAD_ITEM"),tagOptions:t?e:i,customData:{selectable:true}},{id:R.departmentDeputy,entityId:"head-type",tabs:"recents",title:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_DEPARTMENT_DEPUTY_ITEM"),tagOptions:t?e:s,...n},{id:R.teamDeputy,entityId:"head-type",tabs:"recents",title:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_TEAM_DEPUTY_ITEM"),tagOptions:t?e:i,...n}]},goToBPHelp(t){if(top.BX.Helper){t.preventDefault();top.BX.Helper.show("redirect=detail&code=25455744")}}},computed:{businessDescription(){return this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_BUSINESS_PROC_DESCRIPTION",{"#DEPARTMENT_NAME#":c.Text.encode(this.name)})},reportsDescriptions(){return this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_REPORTS_DESCRIPTION",{"#DEPARTMENT_NAME#":c.Text.encode(this.name)})}},template:`\n\t\t<div class="chart-wizard__team-rights">\n\t\t\t<div class="chart-wizard__team-rights__item">\n\t\t\t\t<div class="chart-wizard__team-rights__item-hint --team">\n\t\t\t\t\t<div class="chart-wizard__team-rights__item-hint_logo --team"></div>\n\t\t\t\t\t<div class="chart-wizard__team-rights__item-hint_text">\n\t\t\t\t\t\t<div class="chart-wizard__team-rights__item-hint_title">\n\t\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_HINT_TITLE') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-for="hint in hints"\n\t\t\t\t\t\t\tclass="chart-wizard__team-rights__item-hint_text-item"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass="chart-wizard__team-rights__item-hint_text-item_icon --team"\n\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t\t<span>{{ hint }}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="chart-wizard__team-rights__item-options">\n\t\t\t\t\t<div class="chart-wizard__team-rights__item-options__item-content_title"\n\t\t\t\t\t\t :data-title="loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_ACCESS_TITLE')"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="chart-wizard__team-rights__item-options__item-content_title-text">\n\t\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_BUSINESS_PROC_TITLE') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<span class="ui-hint" @click="goToBPHelp">\n\t\t\t\t\t\t\t<span class="ui-hint-icon"/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="chart-wizard__team-rights__item-description-container">\n\t\t\t\t\t\t<span class="chart-wizard__team-rights__item-description-text" v-html="businessDescription">\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="chart-wizard__team-rights__business-proc-selector"\n\t\t\t\t\t\tref="business-proc-selector"\n\t\t\t\t\t\tdata-test-id="hr-company-structure__team-rights__business-proc-selector"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class="chart-wizard__team-rights__item-options">\n\t\t\t\t\t<div class="chart-wizard__team-rights__item-options__item-content_title --soon"\n\t\t\t\t\t\t :data-title="loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ENTITY_ACCESS_TITLE')"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="chart-wizard__team-rights__item-options__item-content_title-text">\n\t\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_REPORTS_TITLE') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<span class="chart-wizard__team-rights_ui-hint-disabled">\n\t\t\t\t\t\t\t<span class="ui-hint-icon"/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="chart-wizard__team-rights__item-description-container">\n\t\t\t\t\t\t<span class="chart-wizard__team-rights__item-description-text --soon" v-html="reportsDescriptions">\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="chart-wizard__team-rights__reports-selector"\n\t\t\t\t\t\tref="reports-selector"\n\t\t\t\t\t\tdata-test-id="hr-company-structure__team-rights__reports-selector"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const H={name:"AccessDenied",mounted(){this.$emit("applyData",{isDepartmentDataChanged:false,isValid:true})},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)}},template:`\n\t\t<div class="chart-wizard__access-denied">\n\t\t\t<div class="chart-wizard__access-denied_icon"></div>\n\t\t\t<div class="chart-wizard__access-denied_title">\n\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ACCESS_DENIED_TITLE') }}\n\t\t\t</div>\n\t\t\t<div class="chart-wizard__access-denied_description">\n\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_ACCESS_DENIED_DESCRIPTION') }}\n\t\t\t</div>\n\t\t</div>\n\t`};const w={addDepartment:(t,e,s,i,n)=>_.postData("humanresources.api.Structure.Node.add",{name:t,parentId:e,description:s,entityType:i,colorName:n}),getEmployees:t=>_.postData("humanresources.api.Structure.Node.Member.Employee.getIds",{nodeId:t}),updateDepartment:(t,e,s,i,n)=>_.postData("humanresources.api.Structure.Node.update",{nodeId:t,name:s,parentId:e,description:i,colorName:n}),saveUsers:(t,e,s)=>_.postData("humanresources.api.Structure.Node.Member.saveUserList",{nodeId:t,userIds:e,parentId:s}),moveUsers:(t,e,s)=>_.postData("humanresources.api.Structure.Node.Member.moveUserListToDepartment",{nodeId:t,userIds:e,parentId:s}),saveChats:(t,e,s,i=[],n=null)=>_.postData("humanresources.api.Structure.Node.Member.Chat.saveChatList",{nodeId:t,ids:e,createDefault:s,removeIds:i,parentId:n}),createSettings:(t,e,s)=>_.postData("humanresources.api.Structure.Node.NodeSettings.create",{settings:e,nodeId:t,parentId:s}),updateSettings:(t,e,s)=>_.postData("humanresources.api.Structure.Node.NodeSettings.update",{settings:e,nodeId:t,parentId:s}),getSettings:t=>_.postData("humanresources.api.Structure.Node.NodeSettings.get",{nodeId:t}),getChatsAndChannels:t=>_.getData("humanresources.api.Structure.Node.Member.Chat.getList",{nodeId:t})};const b={createDepartment:t=>{var e;const{departments:s}=p.useChartStore();const{id:i,parentId:n}=t;const a=s.get(n);a.children=[...(e=a.children)!=null?e:[],i];s.set(i,{...t,id:i,chats:null,channels:null})},moveUsersToRootDepartment:(t,e)=>{const{departments:s}=p.useChartStore();const i=t.filter((t=>e.includes(t.id)));const n=[...s.values()].find((t=>t.parentId===0));s.set(n.id,{...n,employees:[...n.employees||[],...i],userCount:n.userCount+i.length})},refreshDepartments:t=>{const e=p.useChartStore();e.refreshDepartments(t)},tryToAddCurrentDepartment(t,e){const s=p.useChartStore();const{heads:i,employees:n}=t;const a=[...i,...n].some((t=>t.id===s.userId));if(a){s.changeCurrentDepartment(0,e)}}};const L={name:"chartWizard",emits:["modifyTree","close"],components:{Department:D,Employees:N,BindChat:O,TreePreview:y,Entities:f,TeamRights:P,AccessDenied:H},props:{nodeId:{type:Number,required:true},isEditMode:{type:Boolean,required:true},showEntitySelector:{type:Boolean,required:false},entity:{type:String},entityType:{type:String,default:u.EntityTypes.department},source:{type:String},refToFocus:{type:String,default:null}},data(){return{stepIndex:0,waiting:false,isValidStep:false,isDepartmentDataChanged:false,departmentData:{id:0,parentId:0,name:"",description:"",heads:[],employees:[],chats:[],channels:[],userCount:0,createDefaultChat:false,createDefaultChannel:false,teamColor:u.NodeColorsSettingsDict.blue,entityType:u.EntityTypes.department,settings:{[u.NodeSettingsTypes.businessProcAuthority]:new Set([R.departmentHead]),[u.NodeSettingsTypes.reportsAuthority]:new Set([R.departmentHead])}},removedUsers:[],employeesIds:[],departmentSettings:{[u.NodeSettingsTypes.businessProcAuthority]:new Set([R.departmentHead]),[u.NodeSettingsTypes.reportsAuthority]:new Set([R.departmentHead])},initChats:[],initChannels:[],shouldErrorHighlight:false,steps:[],saveMode:T.moveUsers}},created(){this.init()},beforeUnmount(){c.Event.unbind(window,"beforeunload",this.handleBeforeUnload)},computed:{breadcrumbsTitle(){if(this.isEditMode){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EDIT_TEAM_TITLE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EDIT_TITLE")}return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_CREATE_TEAM_TITLE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_CREATE_TITLE")},closeConfirmTitle(){var t;if(this.isEditMode){var e;return((e=this.departmentData)==null?void 0:e.entityType)===u.EntityTypes.team?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_CLOSE_EDIT_WIZARD_TEAM_TITLE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_CLOSE_EDIT_WIZARD_DEPARTMENT_TITLE")}return((t=this.departmentData)==null?void 0:t.entityType)===u.EntityTypes.team?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_CLOSE_CREATE_WIZARD_TEAM_TITLE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_CLOSE_CREATE_WIZARD_DEPARTMENT_TITLE")},currentStep(){return this.steps[this.stepIndex]},componentInfo(){if(!this.currentStep.isPermitted){return{name:"AccessDenied"}}const{parentId:t,name:e,description:s,heads:i,entityType:n,teamColor:a}=this.departmentData;const r={[C.department]:{name:"Department",params:{parentId:t,name:e,description:s,entityType:n,teamColor:a,refToFocus:this.refToFocus,shouldErrorHighlight:this.shouldErrorHighlight,isEditMode:this.isEditMode}},[C.employees]:{name:"Employees",params:{heads:i,entityType:n,employeesIds:this.employeesIds,isEditMode:this.isEditMode}},[C.bindChat]:{name:"BindChat",params:{heads:i,name:e,entityType:n,isEditMode:this.isEditMode,initChats:this.initChats,initChannels:this.initChannels}},[C.teamRights]:{name:"TeamRights",params:{name:e,settings:this.departmentSettings}},[C.entities]:{name:"Entities",params:{parentId:t}}};return r[this.currentStep.id]},isFirstStep(){return this.currentStep.id===C.entities},breadcrumbsSteps(){return this.steps.filter((t=>t.hasBreadcrumbs))},rootId(){const{id:t}=[...this.departments.values()].find((t=>t.parentId===0));return t},isTeamEntity(){var t;return((t=this.departmentData)==null?void 0:t.entityType)===u.EntityTypes.team},createButtonText(){return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_CREATE_TEAM_BTN"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_CREATE_BTN")},...n.mapState(p.useChartStore,["departments","userId","currentDepartments"])},methods:{handleBeforeUnload(t){t.preventDefault()},loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},async init(){this.apiEntityChanged=new Set;c.Event.bind(window,"beforeunload",this.handleBeforeUnload);if(this.isEditMode){const{id:t,name:e,description:s,parentId:i,heads:n,userCount:a,children:r,entityType:o,teamColor:d,employees:l=[]}=this.departments.get(this.nodeId);this.getMemberRoles(o);this.createSteps(o,t);this.stepIndex=this.steps.indexOf(this.getStepById(this.entity));this.createDefaultSaveMode(o);this.departmentData={...this.departmentData,id:t,parentId:i,name:e,description:s,heads:n,userCount:a,children:r,employees:l,entityType:o,teamColor:d,createDefaultChat:false,createDefaultChannel:false};const c=await w.getSettings(this.nodeId);this.departmentSettings=c.reduce(((t,{settingsType:e,settingsValue:s})=>{if(!Object.hasOwn(t,e)){t[e]=new Set}t[e].add(s);return t}),{...this.departmentSettings});const h=await w.getChatsAndChannels(this.nodeId);this.initChats=h.chats.filter((t=>!t.originalNodeId));this.initChannels=h.channels.filter((t=>!t.originalNodeId));this.employeesIds=await w.getEmployees(this.nodeId);return}if(this.entityType){this.departmentData.entityType=this.entityType}this.getMemberRoles(this.entityType);this.createSteps(this.entityType,this.departmentData.id);this.createDefaultSaveMode(this.entityType);if(this.nodeId){this.departmentData.parentId=this.nodeId;return}this.departmentData.parentId=0;m.sendData({tool:"structure",category:"structure",event:"create_wizard",c_element:this.source})},getMemberRoles(t){this.memberRoles=_.getMemberRoles(t)},move(t="next"){if(t==="next"&&!this.isValidStep){this.shouldErrorHighlight=true;return}this.stepIndex=t==="back"?this.stepIndex-1:this.stepIndex+1;this.pickStepsAnalytics()},moveToStep(t){if(!this.isValidStep){this.shouldErrorHighlight=true;return}this.stepIndex=this.steps.indexOf(this.getStepById(t,true));this.pickStepsAnalytics()},getStepById(t,e){const s=this.steps.findIndex((e=>t===e.id));if(s>-1&&(this.steps[s].isEditPermitted||e)){return this.steps[s]}return this.steps.find(((t,e)=>t.isEditPermitted&&e>s))||this.steps.find((t=>C.department===t.id))},close(t=false){this.$emit("close");if(t){m.sendData({tool:"structure",category:"structure",event:"cancel_wizard",c_element:this.source})}},closeWithConfirm(){if(!this.isDepartmentDataChanged){this.close(true);return}const t=new s.MessageBox({title:this.closeConfirmTitle,message:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_CLOSE_WIZARD_MESSAGE"),yesCaption:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_CLOSE_WIZARD_OK_CAPTION"),noCaption:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_CLOSE_WIZARD_NO_CAPTION"),onYes:()=>{this.close(true);return true},minHeight:155,buttons:s.MessageBoxButtons.YES_NO,popupOptions:{closeIcon:true,className:"humanresources-chart-wizard__close-confirm-popup"}});t.getYesButton().setRound(true);t.getNoButton().setRound(true);t.show()},onApplyData(t){var e;const s=this.departmentData.entityType;const{isValid:i=true,removedUsers:n=[],isDepartmentDataChanged:a=true,apiEntityChanged:r=null,...o}=t;this.isValidStep=i;this.isDepartmentDataChanged=this.isDepartmentDataChanged||a;if(r){this.apiEntityChanged.add(r)}if(o){this.departmentData={...this.departmentData,...o}}this.removedUsers=n;if(i){this.shouldErrorHighlight=false}if(s!==this.departmentData.entityType){this.getMemberRoles(this.departmentData.entityType);this.createSteps(this.departmentData.entityType,this.departmentData.id);this.createDefaultSaveMode(this.departmentData.entityType);const t=_.getMemberRoles(s);const e=Object.keys(t);this.departmentData.heads=this.departmentData.heads.map((s=>{const i=e.find((e=>t[e]===s.role));return{...s,role:this.memberRoles[i]}}));this.departmentData.employees=this.departmentData.employees.map((t=>({...t,role:this.memberRoles.employee})))}this.departmentData.teamColor=this.isTeamEntity?(e=this.departmentData.teamColor)!=null?e:u.NodeColorsSettingsDict.blue:null},getAllSteps(t,e=null){const s=t===u.EntityTypes.team;const i=E.PermissionChecker.getInstance();return{entity:{id:C.entities,title:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_SELECT_ENTITY_TITLE"),hasBreadcrumbs:false,hasTreePreview:false,dataTestIdPart:"entities"},department:{id:C.department,breadcrumbsTitleDepartment:"HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_DEPARTMENT_BREADCRUMBS",breadcrumbsTitleTeam:"HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_TITLE_BREADCRUMBS",hasBreadcrumbs:true,hasTreePreview:true,isEditPermitted:s?i.hasPermission(E.PermissionActions.teamEdit,e):i.hasPermission(E.PermissionActions.departmentEdit,e),dataTestIdPart:"department"},employees:{id:C.employees,breadcrumbsTitleDepartment:"HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEES_BREADCRUMBS",breadcrumbsTitleTeam:"HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_EMPLOYEES_BREADCRUMBS",hasBreadcrumbs:true,hasTreePreview:true,isEditPermitted:s?i.hasPermission(E.PermissionActions.teamAddMember,e):i.hasPermission(E.PermissionActions.employeeAddToDepartment,e),dataTestIdPart:"employees"},bindChat:{id:C.bindChat,breadcrumbsTitleDepartment:"HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TITLE_BREADCRUMBS",breadcrumbsTitleTeam:"HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BINDCHAT_TEAM_TITLE_BREADCRUMBS",hasBreadcrumbs:true,hasTreePreview:false,isEditPermitted:s?i.hasPermission(E.PermissionActions.teamCommunicationEdit,e):i.hasPermission(E.PermissionActions.departmentCommunicationEdit,e),dataTestIdPart:"bind-chat"},teamRights:{id:C.teamRights,breadcrumbsTitleTeam:"HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_TEAM_RIGHTS_BREADCRUMBS",hasBreadcrumbs:true,hasTreePreview:false,isEditPermitted:s?i.hasPermission(E.PermissionActions.teamSettingsEdit,e):i.hasPermission(E.PermissionActions.departmentEdit,e),dataTestIdPart:"team-rights"}}},createSteps(t="DEPARTMENT",e=null){const{entity:s,department:i,employees:n,bindChat:a,teamRights:r}=this.getAllSteps(t,e);const o=this.showEntitySelector?[s]:[];o.push(i,n,a);if(t===u.EntityTypes.team){o.push(r);o.forEach((t=>{Object.assign(t,{breadcrumbsTitle:t.breadcrumbsTitleTeam?this.loc(t.breadcrumbsTitleTeam):""})}))}else{o.forEach((t=>{Object.assign(t,{breadcrumbsTitle:t.breadcrumbsTitleDepartment?this.loc(t.breadcrumbsTitleDepartment):""})}))}if(this.isEditMode){o.forEach((t=>{Object.assign(t,{isPermitted:t.isEditPermitted,hasTreePreview:t.hasTreePreview&&t.isEditPermitted})}))}else{o.forEach((t=>{Object.assign(t,{isPermitted:true})}))}this.steps=o},getUsersPromise(t){const e=this.calculateEmployeeIds();const{headsIds:s,deputiesIds:i,employeesIds:n}=e;const a={[this.memberRoles.head]:s,[this.memberRoles.deputyHead]:i,[this.memberRoles.employee]:n};return this.getUserMemberPromise(t,a)},calculateEmployeeIds(){const{heads:t,employees:e=[]}=this.departmentData;return[...t,...e].reduce(((t,e)=>{const{headsIds:s,deputiesIds:i,employeesIds:n}=t;if(e.role===this.memberRoles.head){s.push(e.id)}else if(e.role===this.memberRoles.deputyHead){i.push(e.id)}else{n.push(e.id)}return t}),{headsIds:[],deputiesIds:[],employeesIds:[]})},getUserMemberPromise(t,e,s){var i;if(this.isEditMode){return w.saveUsers(t,e)}const n=Object.values(e).some((t=>t.length>0));if(!n){return Promise.resolve()}const a=(i=this.departmentData.parentId)!=null?i:null;if(this.saveMode===T.moveUsers){return w.moveUsers(t,e,a)}return w.saveUsers(t,e,a)},async create(){const{name:t,parentId:s,description:i,chats:n,channels:a,createDefaultChat:r,createDefaultChannel:o,entityType:d,teamColor:l,settings:c}=this.departmentData;let h=0;let p="";this.waiting=true;try{const[e]=await w.addDepartment(t,s,i,d,l==null?void 0:l.name);h=e.id;p=e.accessCode;const _=await this.getUsersPromise(h);if(_!=null&&_.updatedDepartmentIds){b.refreshDepartments(_.updatedDepartmentIds)}else{b.tryToAddCurrentDepartment(this.departmentData,h)}await w.saveChats(h,{chat:[...n],channel:[...a]},{chat:Number(r),channel:Number(o)},null,s);if(d===u.EntityTypes.team){await w.createSettings(h,{[u.NodeSettingsTypes.businessProcAuthority]:{values:[...c[u.NodeSettingsTypes.businessProcAuthority]],replace:true}},s)}}catch(t){if(!_.reportedErrorTypes.has(t.code)){e.UI.Notification.Center.notify({content:t.message,autoHideDelay:4e3})}return}finally{this.waiting=false}b.createDepartment({...this.departmentData,id:h,accessCode:p});this.$emit("modifyTree",{id:h,parentId:s,showConfetti:true});const{headsIds:E,deputiesIds:T,employeesIds:C}=this.calculateEmployeeIds();m.sendData({tool:"structure",category:"structure",event:"create_dept",c_element:this.source,p2:`headAmount_${E.length}`,p3:`secondHeadAmount_${T.length}`,p4:`employeeAmount_${C.length}`});this.close()},async save(){if(!this.isValidStep){this.shouldErrorHighlight=true;return}const{id:t,parentId:e,name:s,description:i,teamColor:n,settings:a,chats:r,channels:o,createDefaultChat:d,createDefaultChannel:l}=this.departmentData;const c=this.departments.get(t);const h=(c==null?void 0:c.parentId)===e?null:e;this.waiting=true;const _=this.apiEntityChanged.has(u.WizardApiEntityChangedDict.employees)?this.getUsersPromise(t):Promise.resolve();const m=this.apiEntityChanged.has(u.WizardApiEntityChangedDict.department)?w.updateDepartment(t,h,s,i,n==null?void 0:n.name):Promise.resolve();const E=this.apiEntityChanged.has(u.WizardApiEntityChangedDict.settings)?w.updateSettings(t,{[u.NodeSettingsTypes.businessProcAuthority]:{values:[...a[u.NodeSettingsTypes.businessProcAuthority]],replace:true}},e):Promise.resolve();this.pickEditAnalytics(t,e);try{const[e]=await Promise.all([_,m,E]);if(this.apiEntityChanged.has(u.WizardApiEntityChangedDict.bindChats)){await w.saveChats(t,{chat:r.filter((t=>!this.initChats.some((e=>e.id===t)))),channel:o.filter((t=>!this.initChannels.some((e=>e.id===t))))},{chat:Number(d),channel:Number(l)},[...this.initChats.filter((t=>!r.includes(t.id))).map((t=>t.id)),...this.initChannels.filter((t=>!o.includes(t.id))).map((t=>t.id))]);this.departmentData.chatsDetailed=null;this.departmentData.channelsDetailed=null}let s=[];if(this.removedUsers.length>0){var T;s=(T=e==null?void 0:e.userMovedToRootIds)!=null?T:[];if(s.length>0){b.moveUsersToRootDepartment(this.removedUsers,s)}}const i=p.useChartStore();if(s.includes(this.userId)){i.changeCurrentDepartment(t,this.rootId)}else if(this.removedUsers.some((t=>t.id===this.userId))){i.changeCurrentDepartment(t)}else{b.tryToAddCurrentDepartment(this.departmentData,t)}i.updateDepartment(this.departmentData)}catch(t){console.error(t);return}finally{this.waiting=false}this.$emit("modifyTree",{id:t,parentId:e});this.close()},handleSaveModeChanged(t){this.saveMode=t},createDefaultSaveMode(t="DEPARTMENT"){if(t===u.EntityTypes.team){this.saveMode=T.addUsers}else{this.saveMode=T.moveUsers}},pickEditAnalytics(t,e){const s=this.departments.get(t);switch(this.entity){case C.department:m.sendData({tool:"structure",category:"structure",event:"edit_dept_name",c_element:this.source,p1:(s==null?void 0:s.parentId)===e?"editHead_N":"editHeadDept_Y",p2:(s==null?void 0:s.name)===name?"editName_N":"editName_Y"});break;case C.employees:{const{headsIds:t,deputiesIds:e,employeesIds:s}=this.calculateEmployeeIds();m.sendData({tool:"structure",category:"structure",event:"edit_dept_employee",c_element:this.source,p2:`headAmount_${t.length}`,p3:`secondHeadAmount_${e.length}`,p4:`employeeAmount_${s.length}`});break}default:break}},pickStepsAnalytics(){let t=null;switch(this.currentStep.id){case C.department:t="create_dept_step1";break;case C.employees:t="create_dept_step2";break;case C.bindChat:t="create_dept_step3";break;case C.teamRights:t="create_dept_step4";break;default:break}if(t){m.sendData({tool:"structure",category:"structure",event:t,c_element:this.source})}}},template:`\n\t\t<div class="chart-wizard">\n\t\t\t<div class="chart-wizard__dialog" :style="{ 'max-width': isFirstStep ? '580px' : '843px' }">\n\t\t\t\t<div v-if="currentStep.hasBreadcrumbs" class="chart-wizard__breadcrumbs-head">\n\t\t\t\t\t<div class="chart-wizard__head_close --breadcrumbs" @click="closeWithConfirm(true)"></div>\n\t\t\t\t\t<div class="chart-wizard__breadcrumbs-head_descr">\n\t\t\t\t\t\t{{ breadcrumbsTitle }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="chart-wizard__breadcrumbs-head_breadcrumbs">\n\t\t\t\t\t\t<span \n\t\t\t\t\t\t\tv-for="(step, index) in breadcrumbsSteps" \n\t\t\t\t\t\t\t:key="index"\n\t\t\t\t\t\t\tclass="chart-wizard__breadcrumbs-head_breadcrumbs-item"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span v-if="index > 0" class="ui-icon-set --chevron-right"></span>\n\t\t\t\t\t\t\t<span class="chart-wizard__breadcrumbs-head_breadcrumbs-item-text"\n\t\t\t\t\t\t\t\t  :class="{ '--active': step.id === currentStep.id }"\n\t\t\t\t\t\t\t\t  :data-test-id="'hr-company-structure_chart-wizard__breadcrumbs_' + step.dataTestIdPart"\n\t\t\t\t\t\t\t\t  @click="moveToStep(step.id)"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{{ step.breadcrumbsTitle }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-else class="chart-wizard__head">\n\t\t\t\t\t<div class="chart-wizard__head_close" @click="close(true)"></div>\n\t\t\t\t\t<p class="chart-wizard__head_title">{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_CREATE') }}</p>\n\t\t\t\t\t<p class="chart-wizard__head_descr" :class="{ '--first-step': isFirstStep }">\n\t\t\t\t\t\t{{ currentStep.title }}\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t\t<div class="chart-wizard__content" :style="{ display: !isEditMode && isFirstStep ? 'block' : 'flex' }">\n\t\t\t\t\t<KeepAlive>\n\t\t\t\t\t\t<component\n\t\t\t\t\t\t\t:is="componentInfo.name"\n\t\t\t\t\t\t\tv-bind="componentInfo.params"\n\t\t\t\t\t\t\tv-on="{\n\t\t\t\t\t\t\t\tapplyData: onApplyData,\n\t\t\t\t\t\t\t\tsaveModeChanged: componentInfo.name === 'Employees' ? handleSaveModeChanged : undefined\n\t\t\t\t\t\t\t}"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t</component>\n\t\t\t\t\t</KeepAlive>\n\t\t\t\t\t<div v-if="currentStep.hasTreePreview" class="chart-wizard__tree_container">\n\t\t\t\t\t\t<TreePreview\n\t\t\t\t\t\t\t:parentId="departmentData.parentId"\n\t\t\t\t\t\t\t:name="departmentData.name"\n\t\t\t\t\t\t\t:heads="departmentData.heads"\n\t\t\t\t\t\t\t:userCount="departmentData.userCount"\n\t\t\t\t\t\t\t:entityType="departmentData.entityType"\n\t\t\t\t\t\t\t:teamColor="departmentData.teamColor"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="chart-wizard__footer">\n\t\t\t\t\t<button\n\t\t\t\t\t\tv-if="stepIndex > 0"\n\t\t\t\t\t\tclass="ui-btn ui-btn-light chart-wizard__button --back"\n\t\t\t\t\t\t@click="move('back')"\n\t\t\t\t\t\tdata-test-id="hr-company-structure_chart-wizard__back-button"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span class="chart-wizard__back-button-text">\n\t\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_BACK_BTN') }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\tv-show="stepIndex < steps.length - 1"\n\t\t\t\t\t\tclass="ui-btn ui-btn-primary ui-btn-round chart-wizard__button --next"\n\t\t\t\t\t\t:class="{ \n\t\t\t\t\t\t\t'ui-btn-disabled': !isValidStep,\n\t\t\t\t\t\t\t'ui-btn-light-border': isEditMode,\n\t\t\t\t\t\t }"\n\t\t\t\t\t\t@click="move()"\n\t\t\t\t\t\tdata-test-id="hr-company-structure_chart-wizard__next-button"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_NEXT_BTN') }}\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\tv-show="!isEditMode && stepIndex === steps.length - 1"\n\t\t\t\t\t\tclass="ui-btn ui-btn-primary ui-btn-round chart-wizard__button"\n\t\t\t\t\t\t:class="{ 'ui-btn-wait': waiting }"\n\t\t\t\t\t\t@click="create"\n\t\t\t\t\t\tdata-test-id="hr-company-structure_chart-wizard__create-button"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ createButtonText }}\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\tv-show="isEditMode"\n\t\t\t\t\t\tclass="ui-btn ui-btn-primary ui-btn-round chart-wizard__button --save"\n\t\t\t\t\t\t:class="{ 'ui-btn-wait': waiting, 'ui-btn-disabled': !isValidStep, }"\n\t\t\t\t\t\t@click="save"\n\t\t\t\t\t\tdata-test-id="hr-company-structure_chart-wizard__save-button"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_SAVE_BTN') }}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="chart-wizard__overlay"></div>\n\t\t</div>\n\t`};t.ChartWizard=L})(this.BX.Humanresources.CompanyStructure=this.BX.Humanresources.CompanyStructure||{},BX,BX.UI.Dialogs,BX,BX.Vue3.Pinia,BX.Cache,BX,BX.UI.IconSet,BX.UI.IconSet,BX.Humanresources.CompanyStructure,BX,BX.UI.EntitySelector,BX.Humanresources.CompanyStructure,BX.Humanresources.CompanyStructure,BX.UI.Analytics,BX.Humanresources.CompanyStructure,BX.Humanresources.CompanyStructure);
//# sourceMappingURL=chart-wizard.bundle.map.js