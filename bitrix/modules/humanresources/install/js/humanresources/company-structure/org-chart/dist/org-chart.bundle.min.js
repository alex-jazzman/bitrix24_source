this.BX=this.BX||{};this.BX.Humanresources=this.BX.Humanresources||{};(function(t,e,s,n,i,o,a,r,l,c,d,h,u,E,_,p,m,T,R,v,C,b,A,M,S,P,N){"use strict";const I=Object.freeze({HR_DEPARTMENT_CONNECT:"hr-department-connect",HR_DEPARTMENT_DISCONNECT:"hr-department-disconnect",HR_DEPARTMENT_ADAPT_SIBLINGS:"hr-department-adapt-siblings",HR_DEPARTMENT_ADAPT_CONNECTOR_HEIGHT:"hr-department-adapt-connector-height",HR_DEPARTMENT_FOCUS:"hr-department-focus",HR_DEPARTMENT_CONTROL:"hr-department-control",HR_DEPARTMENT_MENU_CLOSE:"hr-department-menu-close",HR_ORG_CHART_CLOSE_BY_ESC:"SidePanel.Slider:onCloseByEsc",HR_ORG_CHART_CLOSE:"SidePanel.Slider:onClose",HR_FIRST_POPUP_SHOW:"HR.company-structure:first-popup-showed",HR_DRAG_ENTITY:"hr-drag-entity",HR_DROP_ENTITY:"hr-drop-entity",HR_ENTITY_TOGGLE_CONNECTORS:"hr-entity-toggle-connectors",HR_ORG_CHART_TRANSFORM_CANVAS:"hr-org-chart-transform-canvas",HR_DEPARTMENT_SLIDER_ON_MESSAGE:"SidePanel.Slider:onMessage",HR_ORG_CHART_LOCATE_TO_DEPARTMENT:"hr-org-chart-locate-to-department",HR_ENTITY_SHOW_WIZARD:"hr-entity-show-wizard",HR_ENTITY_REMOVE:"hr-entity-remove",HR_PUBLIC_FOCUS_NODE:"HumanResources.CompanyStructure:focusNode",INTRANET_USER_MINIPROFILE_CLOSE:"Intranet.User.MiniProfile:close"});const U=364;const f=Object.freeze({addDepartment:"add-department",addEmployee:"add-employee"});const y={name:"AddButton",components:{RouteActionMenu:u.RouteActionMenu},emits:["addDepartment"],data(){return{actionMenu:{visible:false}}},computed:{MenuOption(){return f}},mounted(){const t=S.PermissionChecker.getInstance();if(!t){return}this.dropdownItems=[{id:f.addDepartment,title:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_ADD_BUTTON_MENU_ADD_DEPARTMENT_TITLE"),description:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_ADD_BUTTON_MENU_ADD_DEPARTMENT_DESCR"),bIcon:{name:M.Main.CUBE_PLUS,size:20,color:A.getColorCode("paletteBlue50")},permission:{action:S.PermissionActions.departmentCreate}},{id:f.addEmployee,title:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_ADD_BUTTON_MENU_ADD_EMPLOYEE_TITLE"),description:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_ADD_BUTTON_MENU_ADD_EMPLOYEE_DESCR"),bIcon:{name:M.CRM.PERSON_PLUS_2,size:20,color:A.getColorCode("paletteBlue50")},permission:{action:S.PermissionActions.employeeAddToDepartment}}];this.dropdownItems=this.dropdownItems.filter((e=>{if(!e.permission){return false}return t.hasPermissionOfAction(e.permission.action)}))},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},addDepartment(){this.$emit("addDepartment")},actionMenuItemClickHandler(t){if(t===f.addDepartment){this.$emit("addDepartment")}}},template:`\n\t\t<div\n\t\t\tclass="ui-btn ui-btn-success ui-btn-round ui-btn-sm humanresources-title-panel__add-button"\n\t\t\tdata-test-id="hr-org-chart_title-panel__add-button"\n\t\t\t@click="addDepartment"\n\t\t>\n\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_ADD_BUTTON') }}\n\t\t</div>\n\t`};const g=t=>{const e=new Map;t.forEach((t=>{var s,n,i;const{id:o,parentId:a,colorName:r,entityType:l}=t;const c=(s=e.get(o))!=null?s:{};const d=A.getNodeColorSettings(r,l);e.set(o,{...c,...t,teamColor:d});if(a===0){return}const h=(n=e.get(a))!=null?n:{};const u=(i=h.children)!=null?i:[];e.set(a,{...h,children:[...u,o]})}));return e};const O={removeDepartment:t=>h.getData("humanresources.api.Structure.Node.delete",{nodeId:t}),getDepartmentsData:()=>h.getData("humanresources.api.Structure.get",{},{tool:"structure",category:"structure",event:"open_structure"}),getCurrentDepartments:()=>h.getData("humanresources.api.Structure.Node.current"),getDictionary:()=>h.getData("humanresources.api.Structure.dictionary"),getUserId:()=>h.getData("humanresources.api.User.getCurrentId"),firstTimeOpened:()=>h.postData("humanresources.api.User.firstTimeOpen"),updateDepartment:(t,e)=>h.postData("humanresources.api.Structure.Node.update",{nodeId:t,parentId:e,name:null}),changeOrder:(t,e,s)=>h.postData("humanresources.api.Structure.Node.changeOrder",{nodeId:t,direction:e,count:s}),createTreeDataStore:g};const D={applyData:(t,e,s)=>{const n=R.useChartStore();n.$patch({departments:t,currentDepartments:e,userId:s,searchedUserId:s})},focusDepartment:t=>{const e=R.useChartStore();e.focusedNode=t},searchUserInDepartment:t=>{const e=R.useChartStore();e.searchedUserId=t},moveSubordinatesToParent:t=>{const e=R.useChartStore();const{departments:s,currentDepartments:n}=e;const i=s.get(t);const{parentId:o,entityType:a,children:r=[],userCount:l,heads:c,employees:d=[]}=i;const u=s.get(o);r.forEach((t=>{const e=s.get(t);e.parentId=o}));if(l>0&&a===A.EntityTypes.department){var E,_;const t=new Set([...u.heads,...(E=u.employees)!=null?E:[]].map((t=>t.id)));const e=[...c,...d];const s=e.filter((e=>!t.has(e.id)));for(const t of s){t.role=h.memberRoles.employee}u.userCount+=s.length;u.employees=[...(_=u.employees)!=null?_:[],...s]}u.children=[...u.children,...r];if(n.includes(t)&&a===A.EntityTypes.department){e.changeCurrentDepartment(t,o)}},markDepartmentAsRemoved:t=>{const{departments:e}=R.useChartStore();const s=e.get(t);const{parentId:n}=s;const i=e.get(n);i.children=i.children.filter((e=>e!==t));delete s.parentId;e.set(t,{...s,prevParentId:n})},removeDepartment:t=>{const{departments:e}=R.useChartStore();e.delete(t)},inviteUser:t=>{const{nodeId:e,...s}=t;const{departments:n}=R.useChartStore();const i=n.get(e);if(i.employees){n.set(e,{...i,employees:[...i.employees,{...s}],userCount:i.userCount+1})}},orderDepartments:async(t,e,s,n)=>{const{departments:i}=R.useChartStore();const o=i.get(t);const{parentId:a}=o;const r=i.get(a);const{children:l}=r;const c=l.indexOf(e);const d=l.filter((e=>e!==t));d.splice(c,0,t);i.set(a,{...r,children:d});try{await O.changeOrder(t,s,n);return true}catch{i.set(a,{...r,children:l});return false}},clearNodesChatLists:t=>{const{departments:e}=R.useChartStore();t.forEach((t=>{const s=e.get(t);e.set(t,{...s,chats:null,channels:null})}))}};const L={name:"search-bar",components:{BIcon:T.BIcon},directives:{focus:{mounted(t){t.focus()}}},emits:["locate"],data(){return{canEditPermissions:false,showSearchBar:false}},computed:{set(){return T.Set},...c.mapState(R.useChartStore,["departments"])},watch:{departments:{handler(){this.searchDialog.destroy()},deep:true}},created(){this.searchDialog=this.getSearchDialog()},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},showSearchbar(){if(this.showSearchBar){this.showSearchBar=false;return}C.sendData({tool:"structure",category:"structure",event:"search"});this.showSearchBar=true},hideSearchbar(){this.showSearchBar=false},getSearchDialog(){const t=new o.Dialog({width:425,height:320,multiple:false,entities:[{id:"user",searchFields:[{name:"supertitle",type:"string",system:true,searchable:true},{name:"position",type:"string"}],options:{intranetUsersOnly:true,emailUsers:false,inviteEmployeeLink:false}},{id:"structure-node",options:{selectMode:"departmentsOnly",useMultipleTabs:true,restricted:"view",flatMode:true,includedNodeEntityTypes:["department","team"]}}],recentTabOptions:{id:"recents",visible:true},dropdownMode:true,enableSearch:false,hideOnDeselect:false,context:"HR_STRUCTURE",events:{"Item:onSelect":e=>{const s=e.getData().item;if(s.entityType==="employee"){this.$emit("locate",s.customData.get("nodeId"));D.searchUserInDepartment(s.id);t.recentItemsToSave.push(s);t.saveRecentItems();return}t.recentItemsToSave.push(s);t.saveRecentItems();this.$emit("locate",s.id)},onLoad:t=>{var e;(e=t.target.items.get("user"))==null?void 0:e.forEach((t=>{if(!t.getSubtitle()){t.setSubtitle(t.customData.get("position"))}}))},"SearchTab:onLoad":t=>{var e;(e=t.target.items.get("user"))==null?void 0:e.forEach((t=>{if(!t.getSubtitle()){t.setSubtitle(t.customData.get("position"))}}))},onDestroy:()=>{this.searchDialog=this.getSearchDialog()}}});const e=t.getContainer();N.Dom.attr(e,"data-test-id","hr-org-chart_title-panel__search-dialog-container");return t},onEnter(){if(this.$refs.searchName){this.searchDialog.setTargetNode(this.$refs.searchName);if(!this.searchDialog.isOpen()){this.searchDialog.show()}N.Event.bind(window,"mousedown",this.handleClickOutside)}},handleClickOutside(t){if(this.$refs.searchName&&!this.$refs.searchName.parentElement.contains(t.target)&&!this.searchDialog.isOpen()){this.clearSearch();this.hideSearchbar();N.Event.unbind(window,"mousedown",this.handleClickOutside)}},search(t){if(!this.searchDialog.isOpen()){this.searchDialog.show()}this.searchDialog.search(t)},clearSearch(){this.searchDialog.getSearchTab().clearResults();this.searchDialog.selectTab("recents");if(this.$refs.searchName){this.$refs.searchName.value="";this.$refs.searchName.focus()}}},template:`\n\t\t<div\n\t\t    class="humanresources-title-panel-search-bar-container"\n\t\t    :class="{'--opened': showSearchBar}"\n\t\t>\n\t\t  <div\n\t\t      class="humanresources-title-panel-search-bar-block__search"\n\t\t      @click="showSearchbar"\n\t\t\t\tdata-test-id="hr-org-chart_title-panel__search-bar-button"\n\t\t  >\n\t\t    <BIcon :name="set.SEARCH_2" :size="24" class="hr-title-search-icon"></BIcon>\n\t\t  </div>\n\t\t  <transition name="humanresources-title-panel-search-bar-fade" mode="in-out" @after-enter="onEnter">\n\t\t    <div v-if="showSearchBar"\n\t\t         class="humanresources-title-panel-search-bar-block__search-bar"\n\t\t    >\n\t\t      <input\n\t\t          ref="searchName"\n\t\t          key="searchInput"\n\t\t          type="text"\n\t\t          :placeholder="loc('HUMANRESOURCES_SEARCH_PLACEHOLDER_MSGVER_1')"\n\t\t          v-focus\n\t\t          class="humanresources-title-panel-search-bar-block__search-input"\n\t\t          @click="onEnter"\n\t\t          @input="search($event.target.value)"\n\t\t\t\t\tdata-test-id="hr-org-chart_title-panel__search-bar-input"\n\t\t      >\n\t\t      <div\n\t\t          key="searchReset"\n\t\t          @click="clearSearch"\n\t\t          class="humanresources-title-panel-search-bar-block__search-reset"\n\t\t      >\n\t\t        <div class="humanresources-title-panel-search-bar-block__search-cursor"></div>\n\t\t        <BIcon\n\t\t            :name="set.CROSS_CIRCLE_50"\n\t\t            :size="24"\n\t\t            color="#2FC6F6"\n\t\t        ></BIcon>\n\t\t      </div>\n\t\t    </div>\n\t\t  </transition>\n\t\t</div>\n\t`};const H=Object.freeze({accessRights:"access-rights",teamAccessRights:"team-access-rights"});const B={name:"BurgerMenuButton",components:{RouteActionMenu:u.RouteActionMenu},data(){return{actionMenu:{visible:false}}},mounted(){const t=S.PermissionChecker.getInstance();this.dropdownItems=[{id:H.accessRights,title:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_CONFIG_PERMISSION_TITLE_MSGVER_1"),description:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_CONFIG_PERMISSION_DESCR_MSGVER_1"),bIcon:{name:M.Main.PERSONS_2,size:20,color:A.getColorCode("paletteBlue50")},dataTestId:"hr-org-chart_title-panel__access-rights-button",permission:t.hasPermissionOfAction(S.PermissionActions.accessEdit)},{id:H.teamAccessRights,title:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_CONFIG_TEAM_PERMISSION_TITLE"),description:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_CONFIG_TEAM_PERMISSION_DESCR"),bIcon:{name:M.Main.MY_PLAN,size:20,color:A.getColorCode("paletteBlue50")},dataTestId:"hr-org-chart_title-panel__team-access-rights-button",permission:t.hasPermissionOfAction(S.PermissionActions.teamAccessEdit)}]},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},actionMenuItemClickHandler(t){if(t===H.accessRights){C.sendData({tool:"structure",category:"structure",event:"open_roles"});BX.SidePanel.Instance.open("/hr/config/permission/",{usePadding:true})}if(t===H.teamAccessRights){C.sendData({tool:"structure",category:"structure",event:"open_roles"});BX.SidePanel.Instance.open("/hr/config/permission/?category=TEAM",{usePadding:true})}}},template:`\n\t\t<span\n\t\t\tref="burgerMenuButton"\n\t\t\t@click="actionMenu.visible = true"\n\t\t\tclass="humanresources-title-panel__burger-menu-button"\n\t\t\tdata-test-id="hr-org-chart_title-panel__burger-menu-button"\n\t\t>\n\t\t\t<svg\n\t\t\t\tviewBox="0 0 24 24"\n\t\t\t\tfill="none"\n\t\t\t\tclass="humanresources-title-panel__icon"\n\t\t\t\t:class="{'--selected': actionMenu.visible }"\n\t\t\t\t>\n\t\t\t\t\t<path fill-rule="evenodd" clip-rule="evenodd" d="M18.7067 15.5577C18.8172 15.5577 18.9067 15.6473 18.9067 15.7577L18.9067 17.2424C18.9067 17.3528 18.8172 17.4424 18.7067 17.4424H5.29375C5.1833 17.4424 5.09375 17.3528 5.09375 17.2424L5.09379 15.7577C5.09379 15.6473 5.18333 15.5577 5.29379 15.5577H18.7067ZM18.7067 11.5577C18.8172 11.5577 18.9067 11.6473 18.9067 11.7577L18.9067 13.2424C18.9067 13.3528 18.8172 13.4424 18.7067 13.4424H5.29375C5.1833 13.4424 5.09375 13.3528 5.09375 13.2424L5.09379 11.7577C5.09379 11.6473 5.18333 11.5577 5.29379 11.5577H18.7067ZM18.7067 7.55774C18.8172 7.55774 18.9067 7.64729 18.9067 7.75774L18.9067 9.24238C18.9067 9.35284 18.8172 9.44238 18.7067 9.44238H5.29375C5.1833 9.44238 5.09375 9.35283 5.09375 9.24237L5.09379 7.75773C5.09379 7.64728 5.18333 7.55774 5.29379 7.55774H18.7067Z" fill="#959ca4"/>\n\t\t\t</svg>\n\t\t </span>\n\t\t<RouteActionMenu\n\t\t\tv-if="actionMenu.visible"\n\t\t\tid="title-panel-burger-menu"\n\t\t\t:items="dropdownItems.filter(item => item.permission)"\n\t\t\t:bindElement="this.$refs.burgerMenuButton"\n\t\t\t@action="actionMenuItemClickHandler($event)"\n\t\t\t@close="this.actionMenu.visible = false"\n\t\t\tcontainerDataTestId="hr-org-chart_title-panel__burger-menu-container"\n\t\t/>\n\t`};const F={components:{AddButton:y,BurgerMenuButton:B,SearchBar:L,BIcon:T.BIcon,Set:T.Set},data(){return{canEditPermissions:false,canAddNode:false,toolbarStarActive:false,isHovered:false}},created(){this.toolbarStarElement=document.getElementById("uiToolbarStar")},mounted(){try{const t=S.PermissionChecker.getInstance();this.canEditPermissions=t&&(t.hasPermissionOfAction(S.PermissionActions.accessEdit)||t.hasPermissionOfAction(S.PermissionActions.teamAccessEdit));this.canAddNode=t&&(t.hasPermissionOfAction(S.PermissionActions.departmentCreate)||t.hasPermissionOfAction(S.PermissionActions.teamCreate))}catch(t){console.error("Failed to fetch data:",t)}const t=new MutationObserver((()=>{this.toolbarStarActive=N.Dom.hasClass(this.toolbarStarElement,"ui-toolbar-star-active")}));t.observe(this.toolbarStarElement,{attributes:true,attributeFilter:["class"]});this.toolbarStarActive=N.Dom.hasClass(this.toolbarStarElement,"ui-toolbar-star-active")},name:"title-panel",emits:["showWizard"],computed:{set(){return T.Set},toolbarStarIcon(){if(this.isAirTemplate){return null}if(this.isHovered||this.toolbarStarActive){return this.set.FAVORITE_1}return this.set.FAVORITE_0},isAirTemplate(){return BX.Reflection.getClass("top.BX.Intranet.Bitrix24.Template")!==null},toolbarClassIcon(){if(!this.isAirTemplate){return"humanresources-title-panel__star"}return this.toolbarStarActive?"humanresources-title-panel__unpin":"humanresources-title-panel__pin"}},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},addDepartment(){this.$emit("showWizard",{source:h.AnalyticsSourceType.HEADER})},onLocate(t){P.EventEmitter.emit(i.events.HR_ORG_CHART_LOCATE_TO_DEPARTMENT,{nodeId:t})},triggerFavoriteStar(){this.toolbarStarElement.click();r.UI.Notification.Center.notify({content:this.toolbarStarActive?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_LEFT_MENU_UN_SAVED"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_LEFT_MENU_SAVED"),autoHideDelay:2e3})}},template:`\n\t\t<div class="humanresources-title-panel">\n\t\t\t<p class="humanresources-title-panel__title">\n\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_TITLE') }}\n\t\t\t</p>\n\t\t\t<BIcon\n\t\t\t\t:name="toolbarStarIcon"\n\t\t\t\t:size="24"\n\t\t\t\tcolor="rgba(149, 156, 164, 1)"\n\t\t\t\t:class="toolbarClassIcon"\n\t\t\t\t@mouseover="isHovered = true"\n\t\t\t\t@mouseleave="isHovered = false" @click="triggerFavoriteStar"\n\t\t\t></BIcon>\n\t\t\t<AddButton\n\t\t\t\tv-if="canAddNode"\n\t\t\t\t@addDepartment="addDepartment"\n\t\t\t/>\n\t\t\t<div class="humanresources-title-panel__icon-buttons">\n\t\t\t\t<BurgerMenuButton v-if="canEditPermissions"/>\n\t\t\t\t<SearchBar @locate="onLocate"/>\n\t\t\t</div>\n\t\t</div>\n\t`};const w=Object.freeze({FocusNodeId:"focusNodeId"});var x=babelHelpers.classPrivateFieldLooseKey("getParamsFromUrl");var Y=babelHelpers.classPrivateFieldLooseKey("castAndValidate");class k{static getParams(){const t=babelHelpers.classPrivateFieldLooseBase(this,x)[x]();return{focusNodeId:babelHelpers.classPrivateFieldLooseBase(this,Y)[Y](w.FocusNodeId,t.get(w.FocusNodeId))}}}function V(){const t=new Map;const e=new URLSearchParams(document.location.search);Object.values(w).forEach((s=>{const n=e.get(s);if(!n){return}t.set(s,n)}));return t}function $(t,e){if(N.Type.isUndefined(e)){return null}let s=e;if(t===w.FocusNodeId){s=Number(e);if(!N.Type.isInteger(s)){return null}}return s}Object.defineProperty(k,Y,{value:$});Object.defineProperty(k,x,{value:V});const z={name:"headList",components:{UserListActionMenu:u.UserListActionMenu},props:{items:{type:Array,required:false,default:()=>[]},title:{type:String,required:false,default:""},collapsed:{type:Boolean,required:false,default:false},type:{type:String,required:false,default:"head"},isTeamEntity:{type:Boolean,required:false,default:false}},data(){return{isCollapsed:false,isUpdating:true,headsVisible:false}},computed:{defaultAvatar(){return"/bitrix/js/humanresources/company-structure/org-chart/src/images/default-user.svg"},dropdownItems(){return this.items.map((t=>{const e=this.getPositionText(t);return{...t,workPosition:e}}))},titleBar(){return this.type===this.userTypes.deputy?this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_DEPUTY_TITLE"):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_HEAD_TITLE")}},created(){this.userTypes={head:"head",deputy:"deputy"}},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},handleUserClick(t){BX.SidePanel.Instance.open(t,{cacheable:false})},closeHeadList(){if(this.headsVisible){this.headsVisible=false;P.EventEmitter.unsubscribe(I.HR_DEPARTMENT_MENU_CLOSE,this.closeHeadList);P.EventEmitter.unsubscribe(I.HR_DRAG_ENTITY,this.closeHeadList)}},openHeadList(){if(!this.headsVisible){this.headsVisible=true;P.EventEmitter.subscribe(I.HR_DEPARTMENT_MENU_CLOSE,this.closeHeadList);P.EventEmitter.subscribe(I.HR_DRAG_ENTITY,this.closeHeadList)}},getPositionText(t){return t.workPosition||this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_HEAD_POSITION")}},template:`\n\t\t<div v-if="items.length">\n\t\t\t<p v-if="title" class="humanresources-tree__node_employees-title">\n\t\t\t\t{{ title }}\n\t\t\t</p>\n\t\t\t<div\n\t\t\t\tclass="humanresources-tree__node_head"\n\t\t\t\t:class="{ '--collapsed': collapsed }"\n\t\t\t\tv-for="(item, index) in items.slice(0, 2)"\n\t\t\t>\n\t\t\t\t<img\n\t\t\t\t\t:src="item.avatar ? encodeURI(item.avatar) : defaultAvatar"\n\t\t\t\t\tclass="humanresources-tree__node_avatar --head"\n\t\t\t\t\t:class="{ '--collapsed': collapsed }"\n\t\t\t\t\t@click.stop="handleUserClick(item.url)"\n\t\t\t\t/>\n\t\t\t\t<div class="humanresources-tree__node_head-text">\n\t\t\t\t\t<span\n\t\t\t\t\t\t:bx-tooltip-user-id="item.id"\n\t\t\t\t\t\tbx-tooltip-context="b24"\n\t\t\t\t\t\tclass="humanresources-tree__node_head-name"\n\t\t\t\t\t\t@click.stop="handleUserClick(item.url)"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ item.name }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span v-if="!collapsed" class="humanresources-tree__node_head-position">\n\t\t\t\t\t\t{{ getPositionText(item) }}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<span\n\t\t\t\t\tv-if="index === 1 && items.length > 2"\n\t\t\t\t\tclass="humanresources-tree__node_head-rest"\n\t\t\t\t\t:class="{ '--active': headsVisible }"\n\t\t\t\t\t:data-test-id="'hr-company-structure_org-chart-tree__node-' + type + '-rest'"\n\t\t\t\t\tref="showMoreHeadList"\n\t\t\t\t\t@click.stop="openHeadList"\n\t\t\t\t>\n\t\t\t\t\t{{ '+' + String(items.length - 2) }}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\t\t<UserListActionMenu\n\t\t\tv-if="headsVisible"\n\t\t\t:id="type === userTypes.head ? 'head-list-popup-head' : 'head-list-popup-deputy'"\n\t\t\t:items="dropdownItems"\n\t\t\t:width="228"\n\t\t\t:bindElement="$refs.showMoreHeadList[0]"\n\t\t\t@close="closeHeadList"\n\t\t\t:titleBar="titleBar"\n\t\t/>\n\t`};class j{constructor(t){this.permissionChecker=S.PermissionChecker.getInstance();this.entityId=t}getItems(){throw new Error("Must override this function")}getFilteredItems(){if(!this.permissionChecker){return[]}const t=this.getItems();return t.filter((t=>{if(N.Type.isFunction(t.hasPermission)){return t.hasPermission(this.permissionChecker,this.entityId)}return false}))}onActionMenuItemClick(t){const e=this.items.find((e=>e.id===t));e==null?void 0:e.invoke({entityId:this.entityId,analyticSource:this.analyticSource,entityType:this.entityType})}}class G{constructor({id:t,title:e,description:s,bIcon:n,permissionAction:i,dataTestId:o}){this.id=t;this.title=e;this.description=s;this.bIcon=n;this.permissionAction=i;this.dataTestId=o}invoke(t){throw new Error("Must override this function")}hasPermission(t,e){return t.hasPermission(this.permissionAction,e)}}const W=Object.freeze({editDepartment:"editDepartment",addDepartment:"addDepartment",addEmployee:"addEmployee",editEmployee:"editEmployee",removeDepartment:"removeDepartment",moveEmployee:"moveEmployee",userInvite:"userInvite",teamRights:"teamRights",moveUserToAnotherDepartment:"moveUserToAnotherDepartment",removeUserFromDepartment:"removeUserFromDepartment",fireUserFromCompany:"fireUserFromCompany",openChat:"openChat",unbindChat:"unbindChat"});class X extends G{constructor(t){let e="";let s="";const n=S.PermissionChecker.getInstance();if(n.isTeamsAvailable){e=t===A.EntityTypes.team?N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_ADD_TEAM_TITLE"):N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_ADD_DEPARTMENT_TITLE_MSGVER_1");s=t===A.EntityTypes.team?N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_ADD_TEAM_SUBTITLE"):N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_ADD_DEPARTMENT_SUBTITLE_MSGVER_1")}else{e=N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_ADD_DEPARTMENT_TITLE_NO_TEAM");s=N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_ADD_DEPARTMENT_SUBTITLE_NO_TEAM")}super({id:W.addDepartment,title:e,description:s,bIcon:{name:M.Main.CUBE_PLUS,size:20,color:A.getColorCode("paletteBlue50")},permissionAction:null,dataTestId:"hr-company-structure_menu__add-department-item"});this.entityType=t;this.permissionChecker=n;this.entityType=t}invoke({entityId:t,analyticSource:e,entityType:s}){if(s===A.EntityTypes.team){if(!this.permissionChecker.isTeamsAvailable){r.UI.Notification.Center.notify({content:N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_TEAMS_DISABLED_ERROR_MSGVER_1"),autoHideDelay:2e3});return}P.EventEmitter.emit(I.HR_ENTITY_SHOW_WIZARD,{nodeId:t,isEditMode:false,showEntitySelector:false,source:e,entityType:s})}else{P.EventEmitter.emit(I.HR_ENTITY_SHOW_WIZARD,{nodeId:t,isEditMode:false,showEntitySelector:true,source:e})}}hasPermission(t,e){if(this.entityType===A.EntityTypes.team){return t.hasPermission(S.PermissionActions.teamCreate,e)}return t.hasPermission(S.PermissionActions.departmentCreate,e)||t.hasPermission(S.PermissionActions.teamCreate,e)}}class K extends G{constructor(t){const e=t===A.EntityTypes.team?N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_EDIT_TEAM_TITLE"):N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_EDIT_DEPARTMENT_TITLE");const s=t===A.EntityTypes.team?N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_EDIT_TEAM_SUBTITLE_MSGVER_1"):N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_EDIT_DEPARTMENT_SUBTITLE_MSGVER_1");super({id:W.editDepartment,title:e,description:s,bIcon:{name:M.Main.EDIT_PENCIL,size:20,color:A.getColorCode("paletteBlue50")},permissionAction:null,dataTestId:"hr-company-structure_menu__edit-department-item"});this.entityType=t}invoke({entityId:t,analyticSource:e,refToFocus:s="title"}){P.EventEmitter.emit(I.HR_ENTITY_SHOW_WIZARD,{nodeId:t,isEditMode:true,showEntitySelector:false,type:"department",source:e,refToFocus:s})}hasPermission(t,e){if(this.entityType===A.EntityTypes.team){return t.hasPermission(S.PermissionActions.teamEdit,e)||t.hasPermission(S.PermissionActions.teamAddMember,e)||t.hasPermission(S.PermissionActions.teamCommunicationEdit,e)||t.hasPermission(S.PermissionActions.teamSettingsEdit,e)}return t.hasPermission(S.PermissionActions.departmentEdit,e)||t.hasPermission(S.PermissionActions.employeeAddToDepartment,e)||t.hasPermission(S.PermissionActions.departmentCommunicationEdit,e)}}class Z extends G{constructor(t){const e=t===A.EntityTypes.team?N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_REMOVE_TEAM_TITLE"):N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_REMOVE_DEPARTMENT_TITLE");const s=t===A.EntityTypes.team?N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_REMOVE_TEAM_SUBTITLE"):N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_REMOVE_DEPARTMENT_SUBTITLE");const n=t===A.EntityTypes.team?S.PermissionActions.teamDelete:S.PermissionActions.departmentDelete;super({id:W.removeDepartment,title:e,description:s,bIcon:{name:M.Main.TRASH_BIN,size:20,color:A.getColorCode("paletteRed40")},permissionAction:n,dataTestId:"hr-company-structure_menu__remove-department-item"})}invoke({entityId:t,entityType:e}){P.EventEmitter.emit(I.HR_ENTITY_REMOVE,{nodeId:t,entityType:e})}}class q extends G{constructor(t,e){const s=t===A.EntityTypes.team?S.PermissionActions.teamAddMember:S.PermissionActions.employeeAddToDepartment;super({id:W.addEmployee,bIcon:{name:M.CRM.PERSON_PLUS_2,size:20,color:A.getColorCode("paletteBlue50")},permissionAction:s,dataTestId:"hr-company-structure_menu__add-employee-item"});this.localize(t,e)}localize(t,e){const s=["head","employee"].includes(e)?e:"default";const n=t===A.EntityTypes.team?"team":"default";const i={head:{team:{title:N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_ADD_HEAD_TITLE"),description:N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_ADD_TEAM_HEAD_SUBTITLE"),role:h.teamMemberRoles.head},default:{title:N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_ADD_HEAD_TITLE"),description:N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_ADD_HEAD_SUBTITLE"),role:h.memberRoles.head}},employee:{team:{title:N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_ADD_TEAM_EMPLOYEE_TITLE"),description:N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_ADD_TEAM_EMPLOYEE_SUBTITLE"),role:h.teamMemberRoles.employee},default:{title:N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_ADD_EMPLOYEE_TITLE"),description:N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_ADD_EMPLOYEE_SUBTITLE"),role:h.memberRoles.employee}},default:{team:{title:N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_ADD_TEAM_EMPLOYEE_TITLE"),description:N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_ADD_TEAM_EMPLOYEE_SUBTITLE"),role:null},default:{title:N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_ADD_EMPLOYEE_TITLE"),description:N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_ADD_EMPLOYEE_SUBTITLE"),role:null}}};this.title=i[s][n].title;this.description=i[s][n].description;this.role=i[s][n].role}invoke({entityId:t,entityType:e}){l.UserManagementDialog.openDialog({nodeId:t,type:"add",role:this.role,entityType:e})}}class J extends G{constructor(t,e){const s=t===A.EntityTypes.team?S.PermissionActions.teamAddMember:S.PermissionActions.employeeAddToDepartment;super({id:W.editEmployee,imageClass:"-hr-department-org-chart-menu-edit-list",bIcon:{name:M.Main.EDIT_MENU,size:20,color:A.getColorCode("paletteBlue50")},permissionAction:s,dataTestId:"hr-company-structure_menu__edit-employee-item"});this.localize(t,e)}localize(t,e){const s=["head","employee"].includes(e)?e:"default";const n=t===A.EntityTypes.team?"team":"default";const i={head:{team:{title:N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_EDIT_TEAM_HEAD_TITLE"),description:N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_EDIT_TEAM_HEAD_SUBTITLE")},default:{title:N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_EDIT_HEAD_TITLE"),description:N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_EDIT_HEAD_SUBTITLE")}},employee:{team:{title:N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_EDIT_TEAM_EMPLOYEE_TITLE"),description:N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_EDIT_TEAM_EMPLOYEE_SUBTITLE")},default:{title:N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_EDIT_EMPLOYEE_TITLE"),description:N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_EDIT_TEAM_EMPLOYEE_SUBTITLE")}},default:{team:{title:N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_EDIT_TEAM_EMPLOYEE_LIST_TITLE"),description:N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_EDIT_TEAM_EMPLOYEE_LIST_SUBTITLE")},default:{title:N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_EDIT_EMPLOYEE_LIST_TITLE"),description:N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_EDIT_EMPLOYEE_LIST_SUBTITLE")}}};this.title=i[s][n].title;this.description=i[s][n].description}invoke({entityId:t,analyticSource:e}){P.EventEmitter.emit(I.HR_ENTITY_SHOW_WIZARD,{nodeId:t,isEditMode:true,showEntitySelector:false,type:"employees",source:e})}}class Q extends G{constructor(){super({id:W.moveEmployee,title:N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_MOVE_EMPLOYEE_TITLE"),description:N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_MOVE_EMPLOYEE_SUBTITLE"),bIcon:{name:M.Main.PERSON_ARROW_LEFT_1,size:20,color:A.getColorCode("paletteBlue50")},permissionAction:S.PermissionActions.employeeAddToDepartment,dataTestId:"hr-company-structure_menu__move-employee-item"})}invoke({entityId:t,analyticSource:e}){l.UserManagementDialog.openDialog({nodeId:t,type:"move"})}hasPermission(t,e){return t.currentUserPermissions.ACTION_EMPLOYEE_REMOVE_FROM_DEPARTMENT&&t.hasPermission(this.permissionAction,e)}}class tt extends G{constructor(){super({id:W.userInvite,title:N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_USER_INVITE_TITLE"),description:N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_USER_INVITE_SUBTITLE"),bIcon:{name:M.Main.PERSON_LETTER,size:20,color:A.getColorCode("paletteBlue50")},permissionAction:S.PermissionActions.inviteToDepartment,dataTestId:"hr-company-structure_menu__user-invite-item"})}invoke({entityId:t}){BX.SidePanel.Instance.open("/bitrix/services/main/ajax.php?action=getSliderContent"+"&c=bitrix%3Aintranet.invitation&mode=ajax"+`&departments[]=${Number(t)}&firstInvitationBlock=invite-with-group-dp`,{cacheable:false,allowChangeHistory:false,width:1100})}}class et extends j{constructor(t,e,s){super(t);this.entityType=e;this.analyticSource=s;this.items=this.getFilteredItems()}getItems(){if(this.entityType===A.EntityTypes.team){return[new K(this.entityType),new X(this.entityType),new q(this.entityType),new Z(this.entityType)]}return[new K(this.entityType),new X(this.entityType),new q(this.entityType),new Q,new tt,new Z(this.entityType)]}}const st={name:"DepartmentMenuButton",components:{RouteActionMenu:u.RouteActionMenu},props:{entityId:{type:Number,required:true},entityType:{type:String,default:A.EntityTypes.department}},data(){return{menuVisible:false}},computed:{menu(){return new et(this.entityId,this.entityType,h.AnalyticsSourceType.DETAIL)}},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},onActionMenuItemClick(t){this.menu.onActionMenuItemClick(t)},closeMenu(){if(this.menuVisible){this.menuVisible=false;P.EventEmitter.unsubscribe(I.HR_DEPARTMENT_MENU_CLOSE,this.closeMenu);P.EventEmitter.unsubscribe(I.HR_DRAG_ENTITY,this.closeMenu)}},openMenu(){if(!this.menuVisible){this.menuVisible=true;P.EventEmitter.subscribe(I.HR_DEPARTMENT_MENU_CLOSE,this.closeMenu);P.EventEmitter.subscribe(I.HR_DRAG_ENTITY,this.closeMenu)}}},template:`\n\t\t<div\n\t\t\tv-if="menu.items.length"\n\t\t\tclass="ui-icon-set --more humanresources-tree__node_department-menu-button"\n\t\t\t:class="{ '--focused': this.menuVisible }"\n\t\t\tref="departmentMenuButton"\n\t\t\tdata-test-id="tree-node-more-button"\n\t\t\t@click.stop="openMenu"\n\t\t>\n\t\t</div>\n\n\t\t<RouteActionMenu\n\t\t\tv-if="menuVisible"\n\t\t\t:id="'tree-node-department-menu-' + entityId"\n\t\t\t:width="302"\n\t\t\t:items="menu.items"\n\t\t\t:bindElement="this.$refs.departmentMenuButton"\n\t\t\t@action="onActionMenuItemClick"\n\t\t\t@close="closeMenu"\n\t\t/>\n\t`};const nt={name:"DepartmentInfoIconButton",components:{BasePopup:u.BasePopup},props:{entityId:{type:Number,required:true},canvasZoom:{type:Number,required:true},description:{type:[String,null],default:null}},data(){return{showPopup:false}},computed:{popupConfig(){const t=340;const e=22*this.canvasZoom;const s=41-this.canvasZoom;const n=33;return{width:t,bindElement:this.$refs.departmentMenuButton,bindOptions:{position:"top"},borderRadius:"12px",contentNoPaddings:true,contentPadding:0,padding:16,offsetTop:-2*this.canvasZoom,offsetLeft:e/2-t/2+s,angleOffset:t/2-n/2}}},created(){this.menuItem=new K(A.EntityTypes.team);const t=S.PermissionChecker.getInstance();this.canEdit=this.menuItem.hasPermission(t,this.entityId)},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},onClose(){if(this.showPopup){this.showPopup=false;P.EventEmitter.unsubscribe(I.HR_DEPARTMENT_MENU_CLOSE,this.onClose);P.EventEmitter.unsubscribe(I.HR_DRAG_ENTITY,this.onClose)}},onOpen(){if(!this.showPopup){this.showPopup=true;P.EventEmitter.subscribe(I.HR_DEPARTMENT_MENU_CLOSE,this.onClose);P.EventEmitter.subscribe(I.HR_DRAG_ENTITY,this.onClose)}},addDescription(){this.onClose();this.menuItem.invoke({entityId:this.entityId,analyticSource:h.AnalyticsSourceType.CARD,refToFocus:"description"})}},template:`\n\t\t<div\n\t\t\tv-if="canEdit || description"\n\t\t\tclass="ui-icon-set --info-1 humanresources-tree__node_department-menu-button"\n\t\t\t:class="{ '--focused': this.showPopup }"\n\t\t\tref="departmentMenuButton"\n\t\t\t@click.stop="onOpen"\n\t\t\tdata-test-id="tree-node-info-button"\n\t\t>\n\t\t</div>\n\t\t<BasePopup\n\t\t\tv-if="showPopup"\n\t\t\t:config="popupConfig"\n\t\t\t:id="'humanresources-tree__node_info-popup' + entityId"\n\t\t\t@close="onClose"\n\t\t>\n\t\t\t<div class="humanresources-tree__node_info-popup-content_description" v-if="description">\n\t\t\t\t{{ description }}\n\t\t\t</div>\n\t\t\t<div v-else class="humanresources-tree__node_info-popup-content">\n\t\t\t\t<div class="humanresources-tree__node_info-popup-content_left"></div>\n\t\t\t\t<div class="humanresources-tree__node_info-popup-content_right">\n\t\t\t\t\t<div class="humanresources-tree__node_info-popup-content_right_title">\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_INFO_POPUP_ADD_DESCRIPTION_TITLE') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="humanresources-tree__node_info-popup-content_right_text">\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_INFO_POPUP_ADD_DESCRIPTION_TEXT') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="ui-btn ui-btn-primary ui-btn-round ui-btn-xs ui-btn-no-caps"\n\t\t\t\t\t\tdata-test-id="tree-node-info-popup_add-button"\n\t\t\t\t\t\t@click="addDescription"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_INFO_POPUP_ADD_DESCRIPTION_BUTTON') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</BasePopup>\n\t`};const it={name:"SubdivisionAddButton",components:{BIcon:T.BIcon},props:{entityId:{type:Number,required:true},entityType:{type:String,default:A.EntityTypes.department}},computed:{set(){return T.Set}},created(){this.menuItem=new X(this.entityType);const t=S.PermissionChecker.getInstance();this.canShow=this.menuItem.hasPermission(t,this.entityId)},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},addSubdivision(){this.menuItem.invoke({entityId:this.entityId,analyticSource:h.AnalyticsSourceType.PLUS,entityType:this.entityType})}},template:`\n\t\t<div class="humanresources-tree__node_add-subdivision" v-if="canShow">\n\t\t  <button class="humanresources-tree__node_add-button" @click="addSubdivision">\n\t\t    <BIcon :name="set.PLUS_20" :size="32" class="humanresources-tree__node_add-icon"></BIcon>\n\t\t  </button>\n\t\t</div>\n\t`};const ot={name:"treeNode",components:{DepartmentMenuButton:st,HeadList:z,SubdivisionAddButton:it,DepartmentInfoIconButton:nt},directives:{hint:u.Hint},inject:["getTreeBounds"],props:{nodeId:{type:Number,required:true},expandedNodes:{type:Array,required:true},canvasZoom:{type:Number,required:true},currentDepartments:{type:Array,required:true},isShown:{type:Boolean,required:false,default:true}},emits:["calculatePosition"],data(){return{childrenOffset:0,childrenMounted:false,showInfo:true,showDnd:true}},computed:{memberRoles(){return h.getMemberRoles(this.nodeData.entityType)},nodeData(){return this.departments.get(this.nodeId)},nodeClass(){return{"--expanded":this.expandedNodes.includes(this.nodeId),"--current-department":this.isCurrentDepartment,"--focused":this.focusedNode===this.nodeId,"--with-restricted-access-rights":!this.showInfo,"--team":this.isTeamEntity}},subdivisionsClass(){return{"humanresources-tree__node_arrow":this.hasChildren,"--up":this.hasChildren&&this.isExpanded,"--down":this.hasChildren&&!this.isExpanded,"--transparent":!this.hasChildren}},hasChildren(){var t;return((t=this.nodeData.children)==null?void 0:t.length)>0},isExpanded(){return this.expandedNodes.includes(this.nodeId)},isCurrentDepartment(){return this.currentDepartments.includes(this.nodeId)},head(){var t;return(t=this.nodeData.heads)==null?void 0:t.filter((t=>t.role===this.memberRoles.head))},deputy(){var t;return(t=this.nodeData.heads)==null?void 0:t.filter((t=>t.role===this.memberRoles.deputyHead))},employeeCount(){return this.nodeData.userCount-this.nodeData.heads.length},childNodeStyle(){return{left:`${this.childrenOffset}px`}},showSubdivisionAddButton(){return this.expandedNodes.includes(this.nodeId)||this.focusedNode===this.nodeId},isTeamEntity(){return this.nodeData.entityType===A.EntityTypes.team},nodeDataTitle(){if(!this.isCurrentDepartment){return null}return this.isTeamEntity?this.loc("HUMANRESOURCES_COMPANY_CURRENT_TEAM"):this.loc("HUMANRESOURCES_COMPANY_CURRENT_DEPARTMENT")},subdivisionsText(){var t;if(this.isTeamEntity){var e;return(e=this.nodeData.children)!=null&&e.length?this.locPlural("HUMANRESOURCES_COMPANY_TEAM_CHILDREN_COUNT",this.nodeData.children.length):this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_TREE_TEAM_NO_SUBDEPARTMENTS")}if(!((t=this.nodeData.children)!=null&&t.length)){return this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_TREE_NO_SUBDEPARTMENTS")}const s=[...this.departments.values()].filter((t=>t.entityType===A.EntityTypes.department&&this.nodeData.children.includes(t.id))).length;const n=[...this.departments.values()].filter((t=>t.entityType===A.EntityTypes.team&&this.nodeData.children.includes(t.id))).length;if(n>0&&s>0){return this.loc("HUMANRESOURCES_COMPANY_DEPARTMENT_CHILDREN_COUNT_WITH_CONJUNCTION",{"#DEPT_COUNT#":this.locPlural("HUMANRESOURCES_COMPANY_DEPARTMENT_CHILDREN_COUNT",s),"#TEAM_COUNT#":this.locPlural("HUMANRESOURCES_COMPANY_TEAM_CHILDREN_COUNT",n)})}if(s>0){return this.locPlural("HUMANRESOURCES_COMPANY_DEPARTMENT_CHILDREN_COUNT",s)}if(n>0){return this.locPlural("HUMANRESOURCES_COMPANY_TEAM_CHILDREN_COUNT",n)}return this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_TREE_NO_SUBDEPARTMENTS")},...c.mapState(R.useChartStore,["departments","focusedNode"])},watch:{head(){this.adaptHeight()},isShown(){this.adaptHeight()},isExpanded:{handler(t){if(t&&!this.childrenMounted){this.childrenMounted=true}},immediate:true}},created(){this.width=278;this.gap=24;this.prevChildrenOffset=0;this.prevHeight=0},async mounted(){let t="";let e="";if(this.isTeamEntity){e=S.PermissionActions.teamView;t=S.PermissionActions.teamEdit}else{e=S.PermissionActions.structureView;t=S.PermissionActions.departmentEdit}const s=S.PermissionChecker.getInstance();this.showInfo=s.hasPermission(e,this.nodeId);this.showDnd=s.hasPermission(t,this.nodeId)&&s.hasPermission(t,this.nodeData.parentId);this.$emit("calculatePosition",this.nodeId);await this.$nextTick();this.prevHeight=this.$el.offsetHeight;P.EventEmitter.emit(I.HR_DEPARTMENT_CONNECT,{id:this.nodeId,parentId:this.nodeData.parentId,html:this.$el,parentsPath:this.getParentsPath(this.nodeData.parentId),...this.calculateNodePoints()})},unmounted(){N.Dom.remove(this.$el);const{prevParentId:t}=this.nodeData;if(!t){return}this.$emit("calculatePosition",this.nodeId);P.EventEmitter.emit(I.HR_DEPARTMENT_DISCONNECT,{id:this.nodeId,parentId:t})},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},onDepartmentClick(t){if(!this.showInfo){return}P.EventEmitter.emit(I.HR_DEPARTMENT_FOCUS,{nodeId:this.nodeId,showEmployees:t==="employees",subdivisionsSelected:t==="subdivisions"})},calculatePosition(t){const e=this.departments.get(this.nodeId);if(e.children.length===0){this.childrenOffset=0}else{const t=this.gap*(e.children.length-1);this.prevChildrenOffset=this.childrenOffset;this.childrenOffset=(this.width-(this.width*e.children.length+t))/2}const s=this.childrenOffset-this.prevChildrenOffset;if(s!==0){P.EventEmitter.emit(I.HR_DEPARTMENT_ADAPT_SIBLINGS,{parentId:this.nodeId,nodeId:t,offset:s})}},locPlural(t,e){return N.Loc.getMessagePlural(t,e,{"#COUNT#":e})},calculateNodePoints(){const{left:t,top:e,width:s}=this.$el.getBoundingClientRect();const{$el:n}=this.$parent.$parent;const{left:i,top:o,width:a,height:r}=n.getBoundingClientRect();const{x:l,y:c}=this.getTreeBounds();return{startPoint:{x:(i-l+a/2)/this.canvasZoom,y:(o-c+r)/this.canvasZoom},endPoint:{x:(t-l+s/2)/this.canvasZoom,y:(e-c)/this.canvasZoom}}},getParentsPath(t){let e=t;const s=[t];while(e){const t=this.departments.get(e);e=t.parentId;if(e){s.push(e)}}return s},async adaptHeight(){if(!this.isShown){return}await this.$nextTick();const t=this.$el.offsetHeight-this.prevHeight;if(t!==0){P.EventEmitter.emit(I.HR_DEPARTMENT_ADAPT_CONNECTOR_HEIGHT,{nodeId:this.nodeId,shift:t});this.prevHeight=this.$el.offsetHeight}}},template:`\n\t\t<div\n\t\t\t:data-id="nodeId"\n\t\t\t:class="nodeClass"\n\t\t\t:data-title="nodeDataTitle"\n\t\t\tclass="humanresources-tree__node"\n\t\t\t:style="{\n\t\t\t\t'--team-bubble-background': nodeData.teamColor?.bubbleBackground,\n\t\t\t\t'--team-focused-border-color': nodeData.teamColor?.focusedBorderColor,\n\t\t\t\t'--node-expanded-color': nodeData.teamColor?.expandedBorderColor,\n\t\t\t}"\n\t\t>\n\t\t\t<div\n\t\t\t\tclass="humanresources-tree__node_summary"\n\t\t\t\t@click.stop="onDepartmentClick('department')"\n\t\t\t>\n\t\t\t\t<template v-if="showInfo">\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="humanresources-tree__node_department"\n\t\t\t\t\t\t:style="{ 'background-color': nodeData.teamColor?.treeHeadBackground}"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="humanresources-tree__node_department-title">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tv-if="nodeData.parentId !== 0 && showDnd"\n\t\t\t\t\t\t\t\tclass="humanresources-tree__node_dnd-icon ui-icon-set --more-points"\n\t\t\t\t\t\t\t\t:class="{ '--team': isTeamEntity }"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\tv-hint\n\t\t\t\t\t\t\t\tclass="humanresources-tree__node_department-title_text"\n\t\t\t\t\t\t\t\t:class="{ '--no-dnd': !showDnd }"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{{nodeData.name}}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="humanresources-tree__node_department-menu-icons">\n\t\t\t\t\t\t\t<DepartmentInfoIconButton\n\t\t\t\t\t\t\t\tv-if="isTeamEntity"\n\t\t\t\t\t\t\t\t:description="nodeData.description"\n\t\t\t\t\t\t\t\t:entityId="nodeId"\n\t\t\t\t\t\t\t\t:canvasZoom="canvasZoom"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<DepartmentMenuButton\n\t\t\t\t\t\t\t\tv-if="head && deputy"\n\t\t\t\t\t\t\t\t:entityId="nodeId"\n\t\t\t\t\t\t\t\t:entityType="nodeData.entityType"\n\t\t\t\t\t\t\t></DepartmentMenuButton>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="humanresources-tree__node_description">\n\t\t\t\t\t\t<HeadList v-if="head" :items="head" :isTeamEntity="isTeamEntity"></HeadList>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-else\n\t\t\t\t\t\t\tclass="humanresources-tree__node_load-skeleton --heads"\n\t\t\t\t\t\t></div>\n\t\t\t\t\t\t<div v-if="deputy" class="humanresources-tree__node_employees">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<p class="humanresources-tree__node_employees-title">\n\t\t\t\t\t\t\t\t\t{{\n\t\t\t\t\t\t\t\t\t\tisTeamEntity\n\t\t\t\t\t\t\t\t\t\t\t? loc('HUMANRESOURCES_COMPANY_STRUCTURE_TREE_TEAM_EMPLOYEES_TITLE')\n\t\t\t\t\t\t\t\t\t\t\t: loc('HUMANRESOURCES_COMPANY_STRUCTURE_TREE_EMPLOYEES_TITLE')\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\tclass="humanresources-tree__node_employees-count"\n\t\t\t\t\t\t\t\t\t@click.stop="onDepartmentClick('employees')"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{{locPlural('HUMANRESOURCES_COMPANY_STRUCTURE_TREE_EMPLOYEES_COUNT', employeeCount)}}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div v-if="!deputy.length"></div>\n\t\t\t\t\t\t\t<HeadList\n\t\t\t\t\t\t\t\t:items="deputy"\n\t\t\t\t\t\t\t\t:title="loc('HUMANRESOURCES_COMPANY_STRUCTURE_TREE_DEPUTY_TITLE')"\n\t\t\t\t\t\t\t\t:collapsed="true"\n\t\t\t\t\t\t\t\t:type="'deputy'"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</HeadList>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-else\n\t\t\t\t\t\t\tclass="humanresources-tree__node_load-skeleton --deputies"\n\t\t\t\t\t\t></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="humanresources-tree__node_subdivisions"\n\t\t\t\t\t\t:class="subdivisionsClass"\n\t\t\t\t\t\t@click.stop="onDepartmentClick('subdivisions')"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span>{{ subdivisionsText }}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<svg v-else width="24" height="24" viewBox="0 0 24 24" fill="none" class="humanresources-tree__node_lock">\n\t\t\t\t\t<path d="M12.0646 4.231C13.9529 4.231 15.4836 5.76968 15.4836 7.66775V10.5612H17.2905V7.66775C17.2905 4.76657 14.9507 2.41476 12.0645 2.41476C9.17827 2.41476 6.83847 4.76657 6.83847 7.66775V10.5612H8.64544V7.66775C8.64544 5.76968 10.1762 4.231 12.0646 4.231Z" fill="#D5D7DB"/>\n\t\t\t\t\t<path fill-rule="evenodd" clip-rule="evenodd" d="M7.14721 10.3237C6.12854 10.3237 5.30273 11.1495 5.30273 12.1682V18.506C5.30273 19.5246 6.12854 20.3504 7.14722 20.3504H17.1029C18.1216 20.3504 18.9474 19.5246 18.9474 18.506V12.1682C18.9474 11.1495 18.1216 10.3237 17.1029 10.3237H7.14721ZM12.9216 15.5869C12.9216 15.5685 12.93 15.5512 12.944 15.5392C13.2142 15.3085 13.3859 14.9643 13.3859 14.5797C13.3859 13.8847 12.8259 13.3214 12.1353 13.3214C11.4446 13.3214 10.8846 13.8847 10.8846 14.5797C10.8846 14.9643 11.0563 15.3085 11.3266 15.5392C11.3406 15.5512 11.3489 15.5685 11.3489 15.5869V16.7572C11.3489 17.1915 11.701 17.5435 12.1353 17.5435C12.5696 17.5435 12.9216 17.1915 12.9216 16.7572V15.5869Z" fill="#D5D7DB"/>\n\t\t\t\t</svg>\n\t\t\t\t<SubdivisionAddButton\n\t\t\t\t\tv-if="showSubdivisionAddButton"\n\t\t\t\t\t:entityId="nodeId"\n\t\t\t\t\t:entityType="nodeData.entityType"\n\t\t\t\t\t@click.stop\n\t\t\t\t></SubdivisionAddButton>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if="nodeData.parentId === 0 && !hasChildren"\n\t\t\t\tclass="humanresources-tree__node_empty-skeleton"\n\t\t\t></div>\n\t\t\t<div\n\t\t\t\tv-if="hasChildren"\n\t\t\t\tref="childrenNode"\n\t\t\t\tclass="humanresources-tree__node_children"\n\t\t\t\t:style="childNodeStyle"\n\t\t\t>\n\t\t\t\t<TransitionGroup>\n\t\t\t\t\t<treeNode\n\t\t\t\t\t\tv-for="id in nodeData.children"\n\t\t\t\t\t\tv-if="isExpanded || childrenMounted"\n\t\t\t\t\t\tv-show="isExpanded"\n\t\t\t\t\t\t:ref="'node-' + id"\n\t\t\t\t\t\t:key="id"\n\t\t\t\t\t\t:nodeId="id"\n\t\t\t\t\t\t:expandedNodes="expandedNodes"\n\t\t\t\t\t\t:canvasZoom="canvasZoom"\n\t\t\t\t\t\t:currentDepartments="currentDepartments"\n\t\t\t\t\t\t:isShown="isExpanded"\n\t\t\t\t\t\t@calculatePosition="calculatePosition"\n\t\t\t\t\t/>\n\t\t\t\t</TransitionGroup>\n\t\t\t</div>\n\t\t</div>\n\t`};const at={name:"companyTreeConnectors",expose:["toggleConnectorsVisibility","toggleConnectorHighlighting","toggleAllConnectorsVisibility","adaptConnectorsAfterReorder"],props:{isLocatedDepartmentVisible:{type:Boolean,required:true},treeNodes:{type:Object,required:true}},data(){return{connectors:{}}},computed:{...c.mapState(R.useChartStore,["focusedNode","departments"])},created(){this.subscribeOnEvents();this.prevWindowWidth=window.innerWidth},beforeUnmount(){this.unsubscribeFromEvents()},methods:{onAddConnector({data:t}){var e;const{id:s,parentId:n}=t;if(!n){return}const i=(e=this.connectors[`${n}-${s}`])!=null?e:{};Object.assign(i,t);if(i.highlighted){delete this.connectors[`${n}-${s}`]}this.connectors[`${n}-${s}`]={show:true,highlighted:false,...i}},onRemoveConnector({data:t}){const{parentId:e,id:s}=t;delete this.connectors[`${e}-${s}`]},onAdaptSiblingConnectors({data:t}){const{nodeId:e,parentId:s,offset:n}=t;const i=this.departments.get(s);const o=i.children.includes(e);const a=Object.values(this.connectors);const r=a.reduce(((t,n)=>{const{endPoint:a,id:r,parentId:l}=n;if(!r||l!==s||r===e){return t}let c=0;if(o){c=i.children.indexOf(e)>i.children.indexOf(r)?1:-1}else{const{endPoint:t}=this.connectors[`${s}-${e}`];c=t.x>a.x?1:-1}return{...t,[r]:c}}),{});a.forEach((t=>{const{id:i,parentId:o,parentsPath:a,endPoint:l,startPoint:c}=t;if(!i||i===e){return}if(o===s){const{x:t}=l;const e=r[i];Object.assign(l,{x:t+n*e});return}const d=a==null?void 0:a.find((t=>Boolean(r[t])));if(d){const t=r[d];Object.assign(c,{x:c.x+n*t});Object.assign(l,{x:l.x+n*t})}}))},adaptConnectorsAfterReorder(t,e,s){t.forEach((t=>{const{parentId:n,children:i}=this.departments.get(t);const o=this.connectors[`${n}-${t}`];if(!o){return}Object.assign(o.endPoint,{x:o.endPoint.x+e});if(!s){Object.assign(o.startPoint,{x:o.startPoint.x+e})}if((i==null?void 0:i.length)>0){this.adaptConnectorsAfterReorder(i,e,false)}}))},onAdaptConnectorHeight({data:t}){const{shift:e,nodeId:s}=t;Object.values(this.connectors).forEach((t=>{if(t.parentId===s){Object.assign(t.startPoint,{y:t.startPoint.y+e})}}))},toggleConnectorsVisibility(t,e){const{children:s}=this.departments.get(t);s.forEach((s=>{var n;const i=(n=this.connectors[`${t}-${s}`])!=null?n:{};this.connectors={...this.connectors,[`${t}-${s}`]:{...i,show:e}}}))},toggleAllConnectorsVisibility(t,e){Object.keys(this.connectors).forEach((s=>{const n=this.connectors[s];if(!t||e.includes(n.parentId)&&t){n.show=t}}))},toggleConnectorHighlighting(t,e){var s;const{parentId:n}=this.departments.get(t);if(!n){return}if(!e){this.connectors[`${n}-${t}`]={...this.connectors[`${n}-${t}`],highlighted:false};return}const i=(s=this.connectors[`${n}-${t}`])!=null?s:{};delete this.connectors[`${n}-${t}`];this.connectors={...this.connectors,[`${n}-${t}`]:{...i,highlighted:true}}},getPath(t){const e=this.connectors[t];const{startPoint:s,endPoint:n,parentId:i}=e;if(!s||!n){return""}let o=115;const a=this.treeNodes.get(i);const r=getComputedStyle(a);const l=parseInt(r.getPropertyValue("--min-height"),10);const c=a.offsetHeight-l;o=c>0?o-c:o;const d=1;const h=s.y-d;const u=this.focusedNode===e.id?12:0;const E={start:"",end:""};let _=0;if(Math.round(s.x)>Math.round(n.x)){_=15;E.start="a15,15 0 0 1 -15,15";E.end="a15,15 0 0 0 -15,15"}else if(Math.round(s.x)<Math.round(n.x)){_=-15;E.start="a15,15 0 0 0 15,15";E.end="a15,15 0 0 1 15,15"}const p=n.y-u;return[`M${s.x} ${h}`,`V${h+o}`,`${String(E.start)}`,`H${n.x+_}`,`${String(E.end)}`,`V${p}`].join("")},subscribeOnEvents(){this.events={[I.HR_DEPARTMENT_CONNECT]:this.onAddConnector,[I.HR_DEPARTMENT_DISCONNECT]:this.onRemoveConnector,[I.HR_DEPARTMENT_ADAPT_SIBLINGS]:this.onAdaptSiblingConnectors,[I.HR_DEPARTMENT_ADAPT_CONNECTOR_HEIGHT]:this.onAdaptConnectorHeight};Object.entries(this.events).forEach((([t,e])=>{P.EventEmitter.subscribe(t,e)}));N.Event.bind(window,"resize",this.onResizeWindow)},unsubscribeFromEvents(){Object.entries(this.events).forEach((([t,e])=>{P.EventEmitter.unsubscribe(t,e)}));N.Event.unbind(window,"resize",this.onResizeWindow)},onResizeWindow(){const t=(window.innerWidth-this.prevWindowWidth)/2;this.prevWindowWidth=window.innerWidth;if(t===0){return}Object.keys(this.connectors).forEach((e=>{const s=this.connectors[e];if(s.startPoint&&s.endPoint){const e=s.startPoint.x;const n=s.endPoint.x;Object.assign(s.startPoint,{x:e+t});Object.assign(s.endPoint,{x:n+t})}}))}},template:`\n\t\t<svg class="humanresources-tree__connectors" fill="none">\n\t\t\t<marker\n\t\t\t\tid='arrow'\n\t\t\t\tmarkerUnits='userSpaceOnUse'\n\t\t\t\tmarkerWidth='20'\n\t\t\t\tmarkerHeight='12'\n\t\t\t\trefX='10'\n\t\t\t\trefY='10.5'\n\t\t\t>\n\t\t\t\t<path d="M1 1L10 10L19 1" class="--highlighted" />\n\t\t\t</marker>\n\t\t\t<path\n\t\t\t\tv-for="(connector, id) in connectors"\n\t\t\t\tv-show="connector.show"\n\t\t\t\t:ref="id"\n\t\t\t\t:marker-end="connector.highlighted ? 'url(#arrow)' : null"\n\t\t\t\t:class="{ '--highlighted': connector.highlighted }"\n\t\t\t\t:id="id"\n\t\t\t\t:d="getPath(id)"\n\t\t\t></path>\n\t\t</svg>\n\t`};let rt=t=>t,lt;const ct=302;const dt=15;var ht=babelHelpers.classPrivateFieldLooseKey("prevAffectedItems");var ut=babelHelpers.classPrivateFieldLooseKey("targetData");var Et=babelHelpers.classPrivateFieldLooseKey("transform");var _t=babelHelpers.classPrivateFieldLooseKey("tree");var pt=babelHelpers.classPrivateFieldLooseKey("draggedItem");var mt=babelHelpers.classPrivateFieldLooseKey("ghost");var Tt=babelHelpers.classPrivateFieldLooseKey("positionPointer");var Rt=babelHelpers.classPrivateFieldLooseKey("zoom");var vt=babelHelpers.classPrivateFieldLooseKey("canvas");var Ct=babelHelpers.classPrivateFieldLooseKey("prevPageX");var bt=babelHelpers.classPrivateFieldLooseKey("prevPageY");var At=babelHelpers.classPrivateFieldLooseKey("targetTeams");var Mt=babelHelpers.classPrivateFieldLooseKey("permissionChecker");var St=babelHelpers.classPrivateFieldLooseKey("draggedEntityType");var Pt=babelHelpers.classPrivateFieldLooseKey("mouseMoveHandler");var Nt=babelHelpers.classPrivateFieldLooseKey("mouseUpHandler");var It=babelHelpers.classPrivateFieldLooseKey("mouseWheelHandler");var Ut=babelHelpers.classPrivateFieldLooseKey("onMouseDown");var ft=babelHelpers.classPrivateFieldLooseKey("onMouseMove");var yt=babelHelpers.classPrivateFieldLooseKey("onMouseUp");var gt=babelHelpers.classPrivateFieldLooseKey("onMouseWheel");var Ot=babelHelpers.classPrivateFieldLooseKey("createGhost");var Dt=babelHelpers.classPrivateFieldLooseKey("createPositionPointer");var Lt=babelHelpers.classPrivateFieldLooseKey("setTransform");var Ht=babelHelpers.classPrivateFieldLooseKey("setPositionPointerTransform");var Bt=babelHelpers.classPrivateFieldLooseKey("getTargetData");var Ft=babelHelpers.classPrivateFieldLooseKey("reorderEntity");var wt=babelHelpers.classPrivateFieldLooseKey("changeParentWithReorder");var xt=babelHelpers.classPrivateFieldLooseKey("checkForDraggedOverflow");var Yt=babelHelpers.classPrivateFieldLooseKey("setStyles");var kt=babelHelpers.classPrivateFieldLooseKey("resetTeamsBlur");class Vt{constructor(t){Object.defineProperty(this,kt,{value:se});Object.defineProperty(this,Yt,{value:ee});Object.defineProperty(this,xt,{value:te});Object.defineProperty(this,wt,{value:Qt});Object.defineProperty(this,Ft,{value:Jt});Object.defineProperty(this,Bt,{value:qt});Object.defineProperty(this,Ht,{value:Zt});Object.defineProperty(this,Lt,{value:Kt});Object.defineProperty(this,Dt,{value:Xt});Object.defineProperty(this,Ot,{value:Wt});Object.defineProperty(this,gt,{value:Gt});Object.defineProperty(this,yt,{value:jt});Object.defineProperty(this,ft,{value:zt});Object.defineProperty(this,Ut,{value:$t});Object.defineProperty(this,ht,{writable:true,value:void 0});Object.defineProperty(this,ut,{writable:true,value:void 0});Object.defineProperty(this,Et,{writable:true,value:void 0});Object.defineProperty(this,_t,{writable:true,value:void 0});Object.defineProperty(this,pt,{writable:true,value:void 0});Object.defineProperty(this,mt,{writable:true,value:void 0});Object.defineProperty(this,Tt,{writable:true,value:void 0});Object.defineProperty(this,Rt,{writable:true,value:void 0});Object.defineProperty(this,vt,{writable:true,value:void 0});Object.defineProperty(this,Ct,{writable:true,value:0});Object.defineProperty(this,bt,{writable:true,value:0});Object.defineProperty(this,At,{writable:true,value:void 0});Object.defineProperty(this,Mt,{writable:true,value:void 0});Object.defineProperty(this,St,{writable:true,value:void 0});Object.defineProperty(this,Pt,{writable:true,value:void 0});Object.defineProperty(this,Nt,{writable:true,value:void 0});Object.defineProperty(this,It,{writable:true,value:void 0});N.Event.bind(t,"mousedown",(t=>{babelHelpers.classPrivateFieldLooseBase(this,Ut)[Ut](t)}));babelHelpers.classPrivateFieldLooseBase(this,Pt)[Pt]=t=>{babelHelpers.classPrivateFieldLooseBase(this,ft)[ft](t)};babelHelpers.classPrivateFieldLooseBase(this,Nt)[Nt]=t=>{babelHelpers.classPrivateFieldLooseBase(this,yt)[yt](t)};babelHelpers.classPrivateFieldLooseBase(this,It)[It]=t=>{babelHelpers.classPrivateFieldLooseBase(this,gt)[gt](t)};babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt]=S.PermissionChecker.getInstance()}}function $t({target:t,currentTarget:e,pageX:s,pageY:n}){if(!N.Dom.hasClass(t,"humanresources-tree__node_dnd-icon")){return}event.stopPropagation();babelHelpers.classPrivateFieldLooseBase(this,_t)[_t]=e;babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt]=Number(e.dataset.zoom);babelHelpers.classPrivateFieldLooseBase(this,vt)[vt]={x:Number(e.dataset.x),y:Number(e.dataset.y)};babelHelpers.classPrivateFieldLooseBase(this,pt)[pt]=t.closest(".humanresources-tree__node");babelHelpers.classPrivateFieldLooseBase(this,mt)[mt]=babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot]();babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct]=s;babelHelpers.classPrivateFieldLooseBase(this,bt)[bt]=n;babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt]=babelHelpers.classPrivateFieldLooseBase(this,Dt)[Dt]();babelHelpers.classPrivateFieldLooseBase(this,At)[At]=[];babelHelpers.classPrivateFieldLooseBase(this,ht)[ht]=[];babelHelpers.classPrivateFieldLooseBase(this,Et)[Et]={x:0,y:0,prevX:0,prevY:0};babelHelpers.classPrivateFieldLooseBase(this,ut)[ut]={};babelHelpers.classPrivateFieldLooseBase(this,St)[St]=N.Dom.hasClass(babelHelpers.classPrivateFieldLooseBase(this,pt)[pt],"--team")?A.EntityTypes.team:A.EntityTypes.department;N.Dom.addClass(e,"--drag-progress");N.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,pt)[pt].parentElement.parentElement,"--blur");babelHelpers.classPrivateFieldLooseBase(this,Ht)[Ht](babelHelpers.classPrivateFieldLooseBase(this,pt)[pt]);babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt]();N.Event.bind(document,"mousemove",babelHelpers.classPrivateFieldLooseBase(this,Pt)[Pt]);N.Event.bind(document,"mouseup",babelHelpers.classPrivateFieldLooseBase(this,Nt)[Nt]);N.Event.bind(document,"wheel",babelHelpers.classPrivateFieldLooseBase(this,It)[It]);P.EventEmitter.emit(I.HR_ENTITY_TOGGLE_CONNECTORS,{shouldShow:false});const i=Number(babelHelpers.classPrivateFieldLooseBase(this,pt)[pt].dataset.id);P.EventEmitter.emit(I.HR_DRAG_ENTITY,{draggedId:i})}function zt({pageX:t,pageY:e}){N.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,pt)[pt],"--hidden");N.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,_t)[_t].parentElement,"--disabled-transition");N.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt],["--inside","--no-permission"]);N.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt],"height",`${babelHelpers.classPrivateFieldLooseBase(this,pt)[pt].offsetHeight}px`);babelHelpers.classPrivateFieldLooseBase(this,kt)[kt]();babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].prevX=babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].x;babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].prevY=babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].y;babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].x+=(t-babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct])/babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt];babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].y+=(e-babelHelpers.classPrivateFieldLooseBase(this,bt)[bt])/babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt];babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct]=t;babelHelpers.classPrivateFieldLooseBase(this,bt)[bt]=e;babelHelpers.classPrivateFieldLooseBase(this,ht)[ht].forEach((t=>babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt](t,0,0)));babelHelpers.classPrivateFieldLooseBase(this,ht)[ht]=[];const{directionX:s,directionY:n}=babelHelpers.classPrivateFieldLooseBase(this,xt)[xt]();babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].x=s===0?babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].x:babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].x+s*dt/babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt];babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].y=n===0?babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].y:babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].y+n*dt/babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt];babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt](babelHelpers.classPrivateFieldLooseBase(this,mt)[mt],babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].x,babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].y,4);babelHelpers.classPrivateFieldLooseBase(this,Ht)[Ht](babelHelpers.classPrivateFieldLooseBase(this,pt)[pt]);babelHelpers.classPrivateFieldLooseBase(this,ut)[ut]=babelHelpers.classPrivateFieldLooseBase(this,Bt)[Bt]();if(!babelHelpers.classPrivateFieldLooseBase(this,ut)[ut].insertion){return}const{insertion:i,targetItem:o,hasPermission:a}=babelHelpers.classPrivateFieldLooseBase(this,ut)[ut];if(!a){N.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt],"--no-permission")}babelHelpers.classPrivateFieldLooseBase(this,Ht)[Ht](o);switch(i){case"reorder":{const t=babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft](o);babelHelpers.classPrivateFieldLooseBase(this,ht)[ht]=t;break}case"sibling-left":case"sibling-right":{const t=babelHelpers.classPrivateFieldLooseBase(this,wt)[wt](o,i);babelHelpers.classPrivateFieldLooseBase(this,ht)[ht]=t;break}default:N.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt],"--inside");N.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt],"height",`${o.offsetHeight}px`)}}function jt(){babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt](true);N.Event.unbind(document,"mousemove",babelHelpers.classPrivateFieldLooseBase(this,Pt)[Pt]);N.Event.unbind(document,"mouseup",babelHelpers.classPrivateFieldLooseBase(this,Nt)[Nt]);N.Event.unbind(document,"mouseup",babelHelpers.classPrivateFieldLooseBase(this,It)[It]);babelHelpers.classPrivateFieldLooseBase(this,ht)[ht].forEach((t=>babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt](t,0,0)));N.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,_t)[_t],"--drag-progress");N.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,pt)[pt].parentElement.parentElement,"--blur");N.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,pt)[pt],"--hidden");N.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,_t)[_t].parentElement,"--disabled-transition");N.Dom.remove(babelHelpers.classPrivateFieldLooseBase(this,mt)[mt]);N.Dom.remove(babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt]);babelHelpers.classPrivateFieldLooseBase(this,kt)[kt]();P.EventEmitter.emit(I.HR_ENTITY_TOGGLE_CONNECTORS,{shouldShow:true});const{insertion:t,targetItem:e,hasPermission:s}=babelHelpers.classPrivateFieldLooseBase(this,ut)[ut];if(!t||!s){return}const n=[...babelHelpers.classPrivateFieldLooseBase(this,pt)[pt].parentElement.children].indexOf(babelHelpers.classPrivateFieldLooseBase(this,pt)[pt]);const i=[...e.parentElement.children].indexOf(e);const o=Number(babelHelpers.classPrivateFieldLooseBase(this,pt)[pt].dataset.id);P.EventEmitter.emit(I.HR_DROP_ENTITY,{draggedId:o,targetId:Number(e.dataset.id),targetIndex:i,affectedItems:babelHelpers.classPrivateFieldLooseBase(this,ht)[ht].map((t=>Number(t.dataset.id))),direction:n<i?1:-1,insertion:t})}function Gt({shiftKey:t}){if(t){const t=Number(babelHelpers.classPrivateFieldLooseBase(this,_t)[_t].dataset.x);const e=t-babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].x;babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].x-=e/babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt];babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].x=t}else{const t=Number(babelHelpers.classPrivateFieldLooseBase(this,_t)[_t].dataset.y);const e=t-babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].y;babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].y-=e/babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt];babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].y=t}babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt](babelHelpers.classPrivateFieldLooseBase(this,mt)[mt],babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].x,babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].y,4)}function Wt(){const t=babelHelpers.classPrivateFieldLooseBase(this,pt)[pt].cloneNode(true);N.Dom.addClass(t,"humanresources-tree__dnd-ghost");N.Dom.removeClass(t,["--expanded","--focused"]);const{x:e,y:s}=babelHelpers.classPrivateFieldLooseBase(this,_t)[_t].getBoundingClientRect();const{x:n,y:i}=babelHelpers.classPrivateFieldLooseBase(this,pt)[pt].getBoundingClientRect();const o=n-e;const a=i-s;N.Dom.style(t,"left",`${o/babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt]}px`);N.Dom.style(t,"top",`${a/babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt]}px`);N.Dom.append(t,babelHelpers.classPrivateFieldLooseBase(this,_t)[_t]);return t}function Xt(){const{offsetWidth:t,offsetHeight:e}=babelHelpers.classPrivateFieldLooseBase(this,pt)[pt];const s=N.Dom.hasClass(babelHelpers.classPrivateFieldLooseBase(this,pt)[pt],"--team")?N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DRAG_TEAM_LABEL"):N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_DRAG_DEPARTMENT_LABEL");const n=N.Tag.render(lt||(lt=rt`
			<div
				class="humanresources-tree__position-pointer"
				style="width: ${0}px; height: ${0}px;);"
			>
				<div>
					<div class="ui-icon-set --circle-plus"></div>
					<span>${0}</span>
				</div>
				<div>
					<div class="ui-icon-set --cross-circle-50"></div>
					<span>
						${0}
					</span>
				</div>
			</div>
		`),t,e,s,N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_NO_DRAG_PERMISSION"));N.Dom.append(n,babelHelpers.classPrivateFieldLooseBase(this,_t)[_t]);babelHelpers.classPrivateFieldLooseBase(this,Ht)[Ht](babelHelpers.classPrivateFieldLooseBase(this,pt)[pt]);return n}function Kt(t,e,s,n=0){if(e===0&&s===0){N.Dom.style(t,"transform","");return}N.Dom.style(t,"transform",`translate3d(${e}px, ${s}px, 0) rotate(${n}deg)`)}function Zt(t){const{x:e,y:s}=babelHelpers.classPrivateFieldLooseBase(this,_t)[_t].getBoundingClientRect();const{x:n,y:i}=t.getBoundingClientRect();const o=(n-e)/babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt];const a=(i-s)/babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt];babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt](babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt],o,a)}function qt(){N.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,mt)[mt],"--disabled-events");babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt](babelHelpers.classPrivateFieldLooseBase(this,mt)[mt],babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].x,babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].y);const t=.7;const e=.6;const{x:s,y:n,width:i,height:o}=babelHelpers.classPrivateFieldLooseBase(this,mt)[mt].getBoundingClientRect();babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt](babelHelpers.classPrivateFieldLooseBase(this,mt)[mt],babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].x,babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].y,4);const a=[{x:s,y:n},{x:s+i,y:n},{x:s,y:n+o},{x:s+i,y:n+o},{x:s,y:n+o/2},{x:s+i,y:n+o/2}];const r=a.reduce(((a,r,l)=>{if(a.insertion){return a}const c=document.elementFromPoint(r.x,r.y);const d=c==null?void 0:c.closest(".humanresources-tree__node_summary");const h=d==null?void 0:d.parentElement;if(!h||h===babelHelpers.classPrivateFieldLooseBase(this,pt)[pt]){return a}const{x:u,y:E,width:_,height:p}=h.getBoundingClientRect();const m=babelHelpers.classPrivateFieldLooseBase(this,pt)[pt].parentElement===h.parentElement;const T=babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt].canSortEntitiesByParentId(Number(h.parentElement.parentElement.dataset.id));const R=l===0&&!N.Dom.hasClass(h,"--root")&&T;a.targetItem=h;if(m&&s+t*i<u+_&&R){return{...a,insertion:"reorder"}}if(!m&&n+e*o<E+p&&R){return{...a,insertion:s<u+_/2?"sibling-left":"sibling-right"}}const v=N.Dom.hasClass(h,"--team")&&!N.Dom.hasClass(babelHelpers.classPrivateFieldLooseBase(this,pt)[pt],"--team");const C=babelHelpers.classPrivateFieldLooseBase(this,pt)[pt].parentElement.parentElement===h;if(v||C){if(v){N.Dom.addClass(h,"--blur");babelHelpers.classPrivateFieldLooseBase(this,At)[At].push(h)}return a}return{...a,insertion:"inside",hasPermission:babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt].canBeParentForEntity(Number(h.dataset.id),babelHelpers.classPrivateFieldLooseBase(this,St)[St])}}),{hasPermission:true});N.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,mt)[mt],"--disabled-events");return r}function Jt(t){const e=[...babelHelpers.classPrivateFieldLooseBase(this,pt)[pt].parentElement.children];const s=e.indexOf(babelHelpers.classPrivateFieldLooseBase(this,pt)[pt]);const n=[...t.parentElement.children].indexOf(t);const i=s<n?1:-1;const o=i>0?e.slice(s+1,n+1):e.slice(n,s);o.forEach((t=>babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt](t,-i*ct,0)));return o}function Qt(t,e){const s=[...t.parentElement.children];const n=s.indexOf(t);let i=[];if(e==="sibling-right"){i=s.slice(0,n+1);i.forEach((t=>babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt](t,-ct,0)))}else{i=s.slice(n);i.forEach((t=>babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt](t,ct,0)))}return i}function te(){let t=0;let e=0;const{left:s,top:n}=babelHelpers.classPrivateFieldLooseBase(this,pt)[pt].getBoundingClientRect();const i=s/babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt];const o=n/babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt];if(i+babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].x<0){t=babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].x<babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].prevX?-1:0}if(i+babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].x+babelHelpers.classPrivateFieldLooseBase(this,pt)[pt].offsetWidth>document.body.offsetWidth/babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt]){t=babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].x>babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].prevX?1:0}if(o+babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].y<0){e=babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].y<babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].prevY?-1:0}if(o+babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].y+babelHelpers.classPrivateFieldLooseBase(this,pt)[pt].offsetHeight>document.body.offsetHeight/babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt]){e=babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].y>babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].prevY?1:0}if(t!==0||e!==0){P.EventEmitter.emit(I.HR_ORG_CHART_TRANSFORM_CANVAS,{directionX:t,directionY:e,speed:dt})}return{directionX:t,directionY:e}}function ee(t){N.Dom.style(document.body,"userSelect","none");N.Dom.style(document.body,"-webkit-user-select","none");N.Dom.style(document.body,"cursor","grabbing");if(t){N.Dom.style(document.body,"userSelect","");N.Dom.style(document.body,"-webkit-user-select","");N.Dom.style(document.body,"cursor","")}}function se(){babelHelpers.classPrivateFieldLooseBase(this,At)[At].forEach((t=>N.Dom.removeClass(t,"--blur")))}const ne={mounted(t){new Vt(t)},updated(t,{value:e}){const{x:s,y:n,zoom:i}=e;t.setAttribute("data-zoom",i);t.setAttribute("data-x",s);t.setAttribute("data-y",n)}};const ie={name:"companyTree",components:{TreeNode:ot,Connectors:at},directives:{dnd:ne},provide(){return{getTreeBounds:()=>this.getTreeBounds()}},props:{canvasTransform:{type:Object,required:true}},emits:["moveTo","showWizard","controlDetail"],data(){return{expandedNodes:[],isLocatedDepartmentVisible:false,isLoaded:false}},computed:{rootId(){const{id:t}=[...this.departments.values()].find((t=>t.parentId===0));return t},connectors(){return this.$refs.connectors},...c.mapState(R.useChartStore,["currentDepartments","userId","focusedNode","departments"])},created(){this.treeNodes=new Map;this.subscribeOnEvents();this.loadHeads([this.rootId])},mounted(){const t=this.getDepartmentIdForInitialFocus();this.currentDepartmentsLocated=[t];if(t!==this.rootId){this.expandDepartmentParents(t);this.focus(t,{expandAfterFocus:true});return}this.expandLowerDepartments();this.focus(t)},beforeUnmount(){this.unsubscribeFromEvents()},methods:{getDepartmentIdForInitialFocus(){const t=k.getParams().focusNodeId;if(t){const e=this.departments.get(t);if(e){return t}}for(const t of this.currentDepartments){const e=this.departments.get(t);if(e.entityType===A.EntityTypes.department){return t}}return this.rootId},loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},getTreeBounds(){return this.$el.getBoundingClientRect()},onConnectDepartment({data:t}){const{id:e,html:s}=t;this.treeNodes.set(e,s);const n=this.getDepartmentIdForInitialFocus();if(e===n&&!this.isLoaded){const t=1800;this.isLoaded=true;N.Runtime.debounce((()=>{this.moveTo(n)}),t)()}},onDisconnectDepartment({data:t}){const{id:e}=t;const s=this.departments.get(e);delete s.prevParentId;if(!s.parentId){D.removeDepartment(e)}},onDragEntity({data:t}){const{draggedId:e}=t;if(this.expandedNodes.includes(e)){this.collapseRecursively(e)}},onToggleConnectors({data:t}){const{shouldShow:e}=t;this.connectors.toggleAllConnectorsVisibility(e,this.expandedNodes)},async changeOrder(t){const{draggedId:e,targetId:s,affectedItems:n,direction:i}=t;const o=D.orderDepartments(e,s,i,n.length);const a=302;const r=n.length*i*a;this.connectors.adaptConnectorsAfterReorder([e],r,true);const l=-i*a;this.connectors.adaptConnectorsAfterReorder(n,l,true);const c=await o;if(!c){this.connectors.adaptConnectorsAfterReorder([e],-r,true);this.connectors.adaptConnectorsAfterReorder(n,-l,true)}},async updateParent(t){const{draggedId:e,targetId:s,targetIndex:n,insertion:i}=t;const{id:o,parentId:a}=this.departments.get(e);if(a===s&&i==="inside"){return}let r=null;const l=R.useChartStore();if(i==="sibling-left"||i==="sibling-right"){const{parentId:t}=this.departments.get(s);const a=i==="sibling-left"?n:n+1;l.updateDepartment({id:o,parentId:t},a);r=O.updateDepartment(e,t)}else{l.updateDepartment({id:o,parentId:s});r=O.updateDepartment(e,s)}this.locateToDepartment(e);try{await r;if(i==="sibling-left"||i==="sibling-right"){const{parentId:t}=this.departments.get(s);const{children:o}=this.departments.get(t);const a=i==="sibling-left"?1:2;const r=o.length-n-a;await O.changeOrder(e,-1,r)}}catch(t){console.error(t)}},onDropEntity({data:t}){const{insertion:e}=t;if(e==="reorder"){this.changeOrder(t);return}this.updateParent(t)},onPublicFocusNode({data:t}){const{nodeId:e}=t;const s=this.departments.get(e);if(!s){return}void this.locateToDepartment(e)},collapse(t){this.expandedNodes=this.expandedNodes.filter((e=>e!==t));this.connectors.toggleConnectorsVisibility(t,false);this.connectors.toggleConnectorHighlighting(t,false)},collapseRecursively(t){const e=t=>{var s;this.collapse(t);const n=this.departments.get(t);(s=n.children)==null?void 0:s.forEach((t=>{if(this.expandedNodes.includes(t)){e(t)}}))};const{parentId:s}=this.departments.get(t);const n=this.expandedNodes.find((t=>{const e=this.departments.get(t);return e.parentId===s}));if(n){e(n)}},expand(t){this.collapseRecursively(t);this.expandedNodes=[...this.expandedNodes,t];this.connectors.toggleConnectorsVisibility(t,true);this.connectors.toggleConnectorHighlighting(t,true);const e=this.departments.get(t);const s=e.children.filter((t=>!this.departments.get(t).heads));if(s.length>0){this.loadHeads(s)}C.sendData({tool:"structure",category:"structure",event:"expand_department"})},focus(t,e={}){var s;const{expandAfterFocus:n=false,showEmployees:i=false,subdivisionsSelected:o=false}=e;const a=((s=this.departments.get(t).children)==null?void 0:s.length)>0;let r=n||!this.expandedNodes.includes(t);if(i){r=this.expandedNodes.includes(t)}if(o||!a){this.collapseRecursively(t)}if(a&&r){this.expand(t)}if(this.focusedNode&&!this.expandedNodes.includes(this.focusedNode)){this.connectors.toggleConnectorHighlighting(this.focusedNode,false)}D.focusDepartment(t);this.connectors.toggleConnectorHighlighting(this.focusedNode,true)},onFocusDepartment({data:t}){const{nodeId:e,showEmployees:s,subdivisionsSelected:n}=t;this.focus(e,{showEmployees:s,subdivisionsSelected:n});this.$emit("controlDetail",{showEmployees:s,preventSwitch:n})},tryRemoveDepartment(t,e){const s={team:{title:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_REMOVE_TEAM_TITLE"),message:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_REMOVE_TEAM_MESSAGE"),success:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_REMOVE_TEAM_REMOVED"),error:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_REMOVE_TEAM_ERROR")},default:{title:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_REMOVE_DEPARTMENT_TITLE"),message:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_REMOVE_DEPARTMENT_MESSAGE"),success:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_REMOVE_DEPARTMENT_REMOVED"),error:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_REMOVE_DEPARTMENT_ERROR")}};const n=e===A.EntityTypes.team?"team":"default";const i=a.MessageBox.create({title:s[n].title,message:s[n].message,buttons:a.MessageBoxButtons.OK_CANCEL,onOk:async e=>{try{await this.removeDepartment(t);r.UI.Notification.Center.notify({content:s[n].success,autoHideDelay:2e3});e.close()}catch{r.UI.Notification.Center.notify({content:s[n].error,autoHideDelay:2e3})}},onCancel:t=>t.close(),minWidth:250,maxWidth:320,minHeight:175,okCaption:this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_REMOVE_DEPARTMENT_OK_CAPTION"),popupOptions:{className:"humanresources-tree__message-box",overlay:{opacity:40}}});const o=i.getOkButton();const l=i.getCancelButton();o.setRound(true);l.setRound(true);o.setColor(p.ButtonColor.DANGER);l.setColor(p.ButtonColor.LIGHT_BORDER);i.show()},async removeDepartment(t){await O.removeDepartment(t);const e=this.departments.get(t);const{parentId:s,children:n=[]}=e;if(n.length>0){this.collapse(t)}D.moveSubordinatesToParent(t);await this.$nextTick();D.markDepartmentAsRemoved(t);this.focus(s,{expandAfterFocus:true});this.moveTo(s)},expandDepartmentParents(t){let{parentId:e}=this.departments.get(t);while(e){if(!this.expandedNodes.includes(e)){this.expand(e)}e=this.departments.get(e).parentId}},expandLowerDepartments(){let t=0;const e=n=>{var i;const{children:o=[]}=this.departments.get(n);if(t===4||o.length===0){return}this.expand(n);t+=1;const a=Math.trunc(o.length/2);const r=o[a];if(((i=this.departments.get(r).children)==null?void 0:i.length)>0){e(r);return}for(let t=a-1;t>=0;t--){if(s(o[t])){return}}for(let t=a+1;t<o.length;t++){if(s(o[t])){return}}};const s=t=>{const{children:s=[]}=this.departments.get(t);if(s.length>0){e(t);return true}return false};e(this.rootId)},async locateToCurrentDepartment(){if(this.currentDepartmentsLocated.length===this.currentDepartments.length){this.currentDepartmentsLocated=[]}const t=this.currentDepartments.find((t=>!this.currentDepartmentsLocated.includes(t)));if(!t){return}this.currentDepartmentsLocated.push(t);await this.locateToDepartment(t);D.searchUserInDepartment(this.userId)},async locateToDepartment(t){this.isLocatedDepartmentVisible=false;this.expandDepartmentParents(t);this.focus(t,{expandAfterFocus:true});await this.$nextTick();this.isLocatedDepartmentVisible=true;await this.moveTo(t)},async moveTo(t){await this.$nextTick();const e=this.getTreeBounds();const s=e.x+e.width/2;const n=e.y+e.height/2;const i=this.treeNodes.get(t);const o=i.getBoundingClientRect();this.$emit("moveTo",{x:s-o.x-o.width/2,y:n-o.y-o.height/2,nodeId:t})},loadHeads(t){const e=R.useChartStore();e.loadHeads(t)},subscribeOnEvents(){this.events={[I.HR_DEPARTMENT_CONNECT]:this.onConnectDepartment,[I.HR_DEPARTMENT_DISCONNECT]:this.onDisconnectDepartment,[I.HR_DEPARTMENT_FOCUS]:this.onFocusDepartment,[I.HR_DRAG_ENTITY]:this.onDragEntity,[I.HR_DROP_ENTITY]:this.onDropEntity,[I.HR_ENTITY_TOGGLE_CONNECTORS]:this.onToggleConnectors,[I.HR_PUBLIC_FOCUS_NODE]:this.onPublicFocusNode};Object.entries(this.events).forEach((([t,e])=>{P.EventEmitter.subscribe(t,e)}))},unsubscribeFromEvents(){Object.entries(this.events).forEach((([t,e])=>{P.EventEmitter.unsubscribe(t,e)}))}},template:`\n\t\t<div\n\t\t\tclass="humanresources-tree"\n\t\t\tv-if="departments.size > 0"\n\t\t\tv-dnd="canvasTransform"\n\t\t>\n\t\t\t<TreeNode\n\t\t\t\tclass="--root"\n\t\t\t\t:key="rootId"\n\t\t\t\t:nodeId="rootId"\n\t\t\t\t:expandedNodes="[...expandedNodes]"\n\t\t\t\t:canvasZoom="canvasTransform.zoom"\n\t\t\t\t:currentDepartments="currentDepartments"\n\t\t\t></TreeNode>\n\t\t\t<Connectors\n\t\t\t\tref="connectors"\n\t\t\t\t:isLocatedDepartmentVisible="isLocatedDepartmentVisible"\n\t\t\t\t:treeNodes="treeNodes"\n\t\t\t></Connectors>\n\t\t</div>\n\t`};const oe={name:"transform-panel",props:{modelValue:{type:Object,required:true}},emits:["update:modelValue"],data(){return{selectedId:""}},computed:{zoomInPercent(){const t='<span class="humanresources-transform-panel__zoom_percent">%</span>';return`${(this.modelValue.zoom*100).toFixed(0)}${t}`}},created(){this.actions=Object.freeze({zoomIn:"zoomIn",zoomOut:"zoomOut",locate:"locate",navigate:"navigate"})},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},onZoom(t){const e=.2;const s=3;let n=-1;if(t){n=1;this.selectedId=this.actions.zoomIn}else{this.selectedId=this.actions.zoomOut}const i=Number((this.modelValue.zoom+e*n).toFixed(1));if(i<e||i>s){return}const o=this.$parent.$refs.tree.getTreeBounds();const a=o.width/2/this.modelValue.zoom-U/2;const r=o.height/2/this.modelValue.zoom;const l=(a-this.modelValue.x)/this.modelValue.zoom;const c=(r-this.modelValue.y)/this.modelValue.zoom;const d=a-l*i;const h=r-c*i;this.$emit("update:modelValue",{...this.modelValue,zoom:i,x:d,y:h})},onLocate(){P.EventEmitter.emit(I.HR_ORG_CHART_LOCATE_TO_DEPARTMENT);this.selectedId=this.actions.locate},onfocusout(){this.selectedId=""}},template:`\n\t\t<div class="humanresources-transform-panel" @focusout="onfocusout" tabindex="-1">\n\t\t\t<div\n\t\t\t\tclass="humanresources-transform-panel__locate"\n\t\t\t\t:class="{ '--selected': selectedId === actions.locate }"\n\t\t\t\t@click="onLocate"\n\t\t\t>\n\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_TREE_LOCATE')}}\n\t\t\t</div>\n\t\t\t<div class="humanresources-transform-panel__separator"></div>\n\t\t\t<div class="humanresources-transform-panel__zoom">\n\t\t\t\t<svg\n\t\t\t\t\tviewBox="0 0 16 16"\n\t\t\t\t\tfill="none"\n\t\t\t\t\tclass="humanresources-transform-panel__icon --zoom-out"\n\t\t\t\t\t:class="{ '--selected': selectedId === actions.zoomOut }"\n\t\t\t\t\t@click="onZoom(false)"\n\t\t\t\t>\n\t\t\t\t\t<path fill-rule="evenodd" clip-rule="evenodd" d="M4 8.66671V7.33337H7.33333H8.66667H12V8.66671H8.66667H7.33333H4Z" fill="#6A737F"/>\n\t\t\t\t</svg>\n\t\t\t\t<span v-html="zoomInPercent"></span>\n\t\t\t\t<svg\n\t\t\t\t\tviewBox="0 0 16 16"\n\t\t\t\t\tfill="none"\n\t\t\t\t\tclass="humanresources-transform-panel__icon --zoom-in"\n\t\t\t\t\t:class="{ '--selected': selectedId === actions.zoomIn }"\n\t\t\t\t\t@click="onZoom(true)"\n\t\t\t\t>\n\t\t\t\t\t<path fill-rule="evenodd" clip-rule="evenodd" d="M7.83333 4H9.16667V7.33333H12.5V8.66667H9.16667V12H7.83333V8.66667H4.5V7.33333H7.83333V4Z" fill="#6A737F"/>\n\t\t\t\t</svg>\n\t\t\t</div>\n\t\t</div>\n\t`};const ae={name:"detailPanelCollapsedTitle",props:{title:{type:String,required:true},avatars:{type:Array,required:true}},computed:{maxVisibleAvatarsCount(){return 2},additionalCount(){return this.avatars.length>this.maxVisibleAvatarsCount?this.avatars.length-this.maxVisibleAvatarsCount:0}},template:`\n\t\t<div class="humanresources-detail-panel__collapsed-title">\n\t\t\t<template v-for="(avatar, index) in avatars">\n\t\t\t\t<img\n\t\t\t\t\tv-if="index < this.maxVisibleAvatarsCount"\n\t\t\t\t\t:key="index"\n\t\t\t\t\t:src="encodeURI(avatar)"\n\t\t\t\t\tclass="humanresources-detail-panel__collapsed-title-avatar"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<div\n\t\t\t\tv-if="avatars.length > maxVisibleAvatarsCount"\n\t\t\t\tclass="humanresources-detail-panel__collapsed-title-avatar --additional"\n\t\t\t>\n\t\t\t +{{ additionalCount }}\n\t\t\t</div>\n\t\t\t<div class="humanresources-detail-panel__title">{{ title }}</div>\n\t\t</div>\n\t`};const re={name:"detailPanelEditButton",components:{BIcon:T.BIcon,RouteActionMenu:u.RouteActionMenu},props:{entityId:{type:Number,required:true},entityType:{type:String,default:A.EntityTypes.department}},data(){return{menuVisible:false}},computed:{set(){return T.Set},menu(){return new et(this.entityId,this.entityType,h.AnalyticsSourceType.DETAIL)}},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},onActionMenuItemClick(t){this.menu.onActionMenuItemClick(t)}},template:`\n\t\t<div\n\t\t\tv-if="menu.items.length"\n\t\t\tclass="humanresources-detail-panel__edit-button"\n\t\t\t:class="{ '--focused': menuVisible }"\n\t\t\t:ref="'detailPanelEditButton'"\n\t\t\tdata-id="hr-department-detail-panel__edit-menu-button"\n\t\t\t@click.stop="menuVisible = true"\n\t\t>\n\t\t\t<BIcon\n\t\t\t\tclass="humanresources-detail-panel__edit-button-icon"\n\t\t\t\t:name="set.MORE"\n\t\t\t\t:size="20"\n\t\t\t/>\n\t\t</div>\n\t\t<RouteActionMenu\n\t\t\tv-if="menuVisible"\n\t\t\tid="department-detail-content-edit-menu"\n\t\t\t:items="menu.items"\n\t\t\t:width="302"\n\t\t\t:bindElement="$refs.detailPanelEditButton"\n\t\t\t@action="onActionMenuItemClick"\n\t\t\t@close="menuVisible = false"\n\t\t/>\n\t`};const le={name:"detailPanel",components:{DepartmentContent:d.DepartmentContent,DetailPanelCollapsedTitle:ae,DetailPanelEditButton:re},directives:{hint:u.Hint},props:{preventPanelSwitch:Boolean,modelValue:Boolean},emits:["showWizard","removeDepartment","update:modelValue"],data(){return{title:"",isTeamEntity:false,teamColor:null,isCollapsed:true,isLoading:true,needToShowLoader:false}},computed:{...c.mapState(R.useChartStore,["focusedNode","departments"]),defaultAvatar(){return"/bitrix/js/humanresources/company-structure/org-chart/src/images/default-user.svg"},headAvatarsArray(){var t,e,s;const n=(t=this.departments.get(this.focusedNode).heads)!=null?t:[];return(e=n==null?void 0:(s=n.filter((t=>t.role===this.memberRoles.head)))==null?void 0:s.map((t=>t.avatar||this.defaultAvatar)))!=null?e:[]},entityType(){return this.departments.get(this.focusedNode).entityType},memberRoles(){return h.getMemberRoles(this.entityType)}},watch:{focusedNode(t,e){this.updateDetailPageHandler(t,e)},modelValue(t){this.isCollapsed=t},departments:{handler(t){const e=t.get(this.focusedNode);if(e){var s;this.title=(s=e.name)!=null?s:""}},deep:true}},methods:{toggleCollapse(){this.$emit("update:modelValue",!this.isCollapsed)},updateDetailPageHandler(t,e){var s,n;if(!this.preventPanelSwitch&&e!==0){this.$emit("update:modelValue",false)}this.isLoading=true;const i=this.departments.get(t);this.isTeamEntity=i.entityType===A.EntityTypes.team;this.title=(s=i.name)!=null?s:"";this.teamColor=(n=i.teamColor)!=null?n:null;this.isLoading=false},showLoader(){this.needToShowLoader=true},hideLoader(){this.needToShowLoader=false}},template:`\n\t\t<div\n\t\t\t:class="['humanresources-detail-panel', { '--collapsed': isCollapsed }]"\n\t\t\tv-on="isCollapsed ? { click: toggleCollapse } : {}"\n\t\t\tdata-id="hr-department-detail-panel__container"\n\t\t>\n\t\t\t<div\n\t\t\t\tv-if="!isLoading"\n\t\t\t\tclass="humanresources-detail-panel-container"\n\t\t\t\t:class="{ '--hide': needToShowLoader && !isCollapsed }"\n\t\t\t>\n\t\t\t\t<div class="humanresources-detail-panel__head" \n\t\t\t\t\t :class="{ '--team': isTeamEntity, '--collapsed': isCollapsed }"\n\t\t\t\t\t :style="{ '--team-head-background': teamColor?.treeHeadBackground }"\n\t\t\t\t>\n\t\t\t\t\t<span\n\t\t\t\t\t\tv-if="!isCollapsed"\n\t\t\t\t\t\tv-hint\n\t\t\t\t\t\tclass="humanresources-detail-panel__title"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ title }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<DetailPanelCollapsedTitle\n\t\t\t\t\t\tv-else\n\t\t\t\t\t\t:title="title"\n\t\t\t\t\t\t:avatars="headAvatarsArray"\n\t\t\t\t\t>\n\t\t\t\t\t</DetailPanelCollapsedTitle>\n\t\t\t\t\t<div class="humanresources-detail-panel__header_buttons_container">\n\t\t\t\t\t\t<DetailPanelEditButton\n\t\t\t\t\t\t\tv-if="!isCollapsed"\n\t\t\t\t\t\t\t:entityId="focusedNode"\n\t\t\t\t\t\t\t:entityType="entityType"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass="humanresources-detail-panel__collapse_button --icon"\n\t\t\t\t\t\t\t@click="toggleCollapse"\n\t\t\t\t\t\t\t:class="{ '--collapsed': isCollapsed }"\n\t\t\t\t\t\t\tdata-id="hr-department-detail-panel__collapse-button"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="humanresources-detail-panel__content" v-show="!isCollapsed">\n\t\t\t\t\t<DepartmentContent\n\t\t\t\t\t\t@showDetailLoader="showLoader"\n\t\t\t\t\t\t@hideDetailLoader="hideLoader"\n\t\t\t\t\t\t:isCollapsed="isCollapsed"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if="needToShowLoader && !isCollapsed" class="humanresources-detail-panel-loader-container"/>\n\t\t</div>\n\t`};const ce={name:"FirstPopup",components:{BIcon:T.BIcon},data(){return{show:false,title:"",description:"",subDescription:"",features:[]}},computed:{set(){return T.Set}},async mounted(){this.title=this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_TITLE");this.description=this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_DESCRIPTION");this.subDescription=this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_SUB_DESCRIPTION");this.features=[this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_FEATURE_1"),this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_FEATURE_2"),this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_FEATURE_3"),this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_FEATURE_4"),this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_FEATURE_5"),this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_FEATURE_6"),this.loc("HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_FEATURE_7")];const{firstTimeOpened:t}=await O.getDictionary();this.show=t==="N"&&this.title.length>0},methods:{closePopup(){O.firstTimeOpened();this.show=false;top.BX.Event.EventEmitter.emit(I.HR_FIRST_POPUP_SHOW)},loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)}},template:`\n\t\t<div v-if="show" class="first-popup">\n\t\t\t<div class="first-popup-overlay" @click="closePopup"></div>\n\t\t\t<div class="first-popup-content">\n\t\t\t\t<div class="title">{{ title }}</div>\n\t\t\t\t<div class="first-popup-left">\n\t\t\t\t\t<p class="description">{{ description }}</p>\n\t\t\t\t\t<p class="sub-description">{{ subDescription }}</p>\n\t\t\t\t\t<div class="first-popup-list">\n\t\t\t\t\t\t<div class="first-popup-list-item" v-for="(feature, index) in features" :key="index">\n\t\t\t\t\t\t\t<div class="first-popup-list-item-point">\u2022</div>\n\t\t\t\t\t\t\t<div class="first-popup-list-item-feature">{{ feature }}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<button class="ui-btn ui-btn-success first-popup-ui-btn" @click="closePopup">\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_BUTTON_START') }}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t\t<div class="first-popup-right">\n\t\t\t\t\t<video\n\t\t\t\t\t\tsrc="/bitrix/js/humanresources/company-structure/org-chart/src/components/first-popup/images/preview.webm"\n\t\t\t\t\t\tautoplay\n\t\t\t\t\t\tloop\n\t\t\t\t\t\tmuted\n\t\t\t\t\t\tplaysinline\n\t\t\t\t\t\tclass="first-popup-animation"\n\t\t\t\t\t></video>\n\t\t\t\t</div>\n\t\t\t\t<BIcon :name="set.CROSS_25" :size="24" class="first-popup-close" @click="closePopup"></BIcon>\n\t\t\t</div>\n\t\t</div>\n\t`};const de={components:{TransformCanvas:n.TransformCanvas,Tree:ie,TransformPanel:oe,ChartWizard:v.ChartWizard,FirstPopup:ce,DetailPanel:le,TitlePanel:F},data(){return{canvas:{shown:false,moved:false,modelTransform:{x:0,y:0,zoom:.3}},wizard:{shown:false,isEditMode:false,showEntitySelector:true,entity:"",nodeId:0,source:""},detailPanel:{collapsed:true,preventSwitch:false},isTransitionCompleted:false}},computed:{rootId(){const{id:t}=[...this.departments.values()].find((t=>t.parentId===0));return t},...c.mapState(R.useChartStore,["departments","currentDepartments"])},async created(){const t=BX.SidePanel.Instance.getTopSlider();t==null?void 0:t.showLoader();const[e,s,n]=await Promise.all([O.getDepartmentsData(),O.getCurrentDepartments(),O.getUserId()]);t==null?void 0:t.closeLoader();const i=O.createTreeDataStore(e);const o=s.filter((t=>i.has(t)));D.applyData(i,o,n);this.rootOffset=100;this.transformCanvas();this.canvas.shown=true;this.showConfetti=false;P.EventEmitter.subscribe(I.HR_DEPARTMENT_SLIDER_ON_MESSAGE,this.handleInviteSliderMessage);BX.PULL.subscribe({type:BX.PullClient.SubscriptionType.Server,moduleId:"humanresources",command:"linkChatsToNodes",callback:t=>this.clearChatLists(t)});P.EventEmitter.subscribe(I.HR_ENTITY_SHOW_WIZARD,this.showWizardEventHandler);P.EventEmitter.subscribe(I.HR_ENTITY_REMOVE,this.removeDepartmentEventHandler);P.EventEmitter.subscribe(I.HR_ORG_CHART_TRANSFORM_CANVAS,this.onCanvasTransformWhenDragging);P.EventEmitter.subscribe(I.HR_ORG_CHART_LOCATE_TO_DEPARTMENT,this.onLocate)},unmounted(){P.EventEmitter.unsubscribe(I.HR_DEPARTMENT_SLIDER_ON_MESSAGE,this.handleInviteSliderMessage);P.EventEmitter.unsubscribe(I.HR_ENTITY_SHOW_WIZARD,this.showWizardEventHandler);P.EventEmitter.unsubscribe(I.HR_ENTITY_REMOVE,this.removeDepartmentEventHandler);P.EventEmitter.unsubscribe(I.HR_ORG_CHART_TRANSFORM_CANVAS,this.onCanvasTransformWhenDragging);P.EventEmitter.unsubscribe(I.HR_ORG_CHART_LOCATE_TO_DEPARTMENT,this.onLocate)},methods:{onMoveTo({x:t,y:e,nodeId:s}){const{x:n,y:i,zoom:o}=this.canvas.modelTransform;const a=U*o;const r=t-a/2;const l=s===this.rootId?this.rootOffset:e/o;const c=Math.round(r)===Math.round(n)&&Math.round(e)===Math.round(i);this.detailPanel={...this.detailPanel,collapsed:false};if(c){return}this.canvas={...this.canvas,moved:true,modelTransform:{...this.canvas.modelTransform,x:r/o,y:l,zoom:1}};this.onUpdateTransform()},onLocate({data:t}){if(t.nodeId){this.$refs.tree.locateToDepartment(t.nodeId);return}this.$refs.tree.locateToCurrentDepartment()},showWizardEventHandler({data:t}){this.onShowWizard(t)},onShowWizard({nodeId:t=0,isEditMode:e=false,type:s,showEntitySelector:n=true,source:i="",entityType:o,refToFocus:a}={}){this.wizard={...this.wizard,shown:true,isEditMode:e,showEntitySelector:n,entity:s,nodeId:t,source:i,entityType:o,refToFocus:a};if(!e&&i!==h.AnalyticsSourceType.HEADER){C.sendData({tool:"structure",category:"structure",event:"create_dept_step1",c_element:i})}switch(s){case"department":C.sendData({tool:"structure",category:"structure",event:"create_dept_step1",c_element:i});break;case"employees":C.sendData({tool:"structure",category:"structure",event:"create_dept_step2",c_element:i});break;case"bindChat":C.sendData({tool:"structure",category:"structure",event:"create_dept_step3",c_element:i});break;case"teamRights":C.sendData({tool:"structure",category:"structure",event:"create_dept_step4",c_element:i});break}},onModifyTree({id:t,showConfetti:e}){this.showConfetti=e!=null?e:false;const{tree:s}=this.$refs;s.locateToDepartment(t)},onWizardClose(){this.wizard.shown=false},removeDepartmentEventHandler({data:t}){this.onRemoveDepartment(t.nodeId,t.entityType)},onRemoveDepartment(t,e){const{tree:s}=this.$refs;s.tryRemoveDepartment(t,e)},async onTransitionEnd(){if(this.canvas.moved){this.isTransitionCompleted=true}this.canvas.moved=false;if(!this.showConfetti){return}this.isTransitionCompleted=false;const t=s.Confetti.fire({particleCount:300,startVelocity:10,spread:400,ticks:100,origin:{y:.4,x:.37}});this.showConfetti=false;await t;this.isTransitionCompleted=true},onControlDetail({showEmployees:t,preventSwitch:e}){this.detailPanel={...this.detailPanel,preventSwitch:e};if(!t){return}this.detailPanel={...this.detailPanel,collapsed:false}},transformCanvas(){const{zoom:t}=this.canvas.modelTransform;const{offsetWidth:e,offsetHeight:s}=this.$el;const[n]=this.currentDepartments;const i=n===this.rootId?this.rootOffset:s/2-s*t/2;this.canvas.modelTransform={...this.canvas.modelTransform,x:e/2-e*t/2,y:i}},onUpdateTransform(){P.EventEmitter.emit(I.INTRANET_USER_MINIPROFILE_CLOSE);P.EventEmitter.emit(I.HR_DEPARTMENT_MENU_CLOSE)},handleInviteSliderMessage(t){const[e]=t.getData();const s=e.getEventId();if(s!=="BX.Intranet.Invitation:onAdd"){return}const{users:n}=e.getData();n.forEach((t=>{const e=A.getInvitedUserData(t);D.inviteUser(e)}))},clearChatLists(t){const e=Object.keys(t).map((t=>Number(t)));D.clearNodesChatLists(e)},onKeyDown(t){if(!this.isTransitionCompleted){t.preventDefault()}},onCanvasTransformWhenDragging({data:t}){const{directionX:e,directionY:s,speed:n}=t;if(e!==0){this.canvas.modelTransform.x+=-e*n}if(s!==0){this.canvas.modelTransform.y+=-s*n}}},template:`\n\t\t<div\n\t\t\tclass="humanresources-chart"\n\t\t\t:class="{ '--locked': !isTransitionCompleted }"\n\t\t\t@keydown="onKeyDown"\n\t\t>\n\t\t\t<TitlePanel @showWizard="onShowWizard"></TitlePanel>\n\t\t\t<TransformCanvas\n\t\t\t\tv-if="canvas.shown"\n\t\t\t\tv-slot="{transform}"\n\t\t\t\tv-model="canvas.modelTransform"\n\t\t\t\t@update:modelValue="onUpdateTransform"\n\t\t\t\t:class="{ '--moved': canvas.moved }"\n\t\t\t\t@transitionend="onTransitionEnd"\n\t\t\t>\n\t\t\t\t<Tree\n\t\t\t\t\t:canvasTransform="transform"\n\t\t\t\t\tref="tree"\n\t\t\t\t\t@moveTo="onMoveTo"\n\t\t\t\t\t@showWizard="onShowWizard"\n\t\t\t\t\t@controlDetail="onControlDetail"\n\t\t\t\t></Tree>\n\t\t\t</TransformCanvas>\n\t\t\t<DetailPanel\n\t\t\t\t@showWizard="onShowWizard"\n\t\t\t\t@removeDepartment="onRemoveDepartment"\n\t\t\t\tv-model="detailPanel.collapsed"\n\t\t\t\t:preventPanelSwitch="detailPanel.preventSwitch"\n\t\t\t></DetailPanel>\n\t\t\t<TransformPanel\n\t\t\t\tv-model="canvas.modelTransform"\n\t\t\t></TransformPanel>\n\t\t\t<ChartWizard\n\t\t\t\tv-if="wizard.shown"\n\t\t\t\t:nodeId="wizard.nodeId"\n\t\t\t\t:isEditMode="wizard.isEditMode"\n\t\t\t\t:showEntitySelector="wizard.showEntitySelector"\n\t\t\t\t:entity="wizard.entity"\n\t\t\t\t:entityType="wizard.entityType"\n\t\t\t\t:source="wizard.source"\n\t\t\t\t:refToFocus="wizard.refToFocus"\n\t\t\t\t@modifyTree="onModifyTree"\n\t\t\t\t@close="onWizardClose"\n\t\t\t></ChartWizard>\n\t\t\t<FirstPopup></FirstPopup>\n\t\t\t<div class="humanresources-chart__back"></div>\n\t\t</div>\n\t`};class he extends j{constructor(t,e,s,n){super(t);this.analyticSource=e;this.role=s;this.entityType=n;this.items=this.getFilteredItems()}getItems(){return[new q(this.entityType,this.role),new J(this.entityType,this.role)]}}class ue extends j{constructor(t,e,s,n){super(t);this.entityType=n;this.analyticSource=e;this.role=s;this.items=this.getFilteredItems()}getItems(){if(this.entityType===A.EntityTypes.team){return[new q(this.entityType,this.role)]}return[new Q,new tt,new q(this.entityType,this.role)]}}class Ee extends G{constructor(t){super({id:W.fireUserFromCompany,title:t?N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_DELETE_FROM_COMPANY_TITLE"):N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_FIRE_FROM_COMPANY_TITLE"),description:N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_FIRE_FROM_COMPANY_SUBTITLE_MSGVER_1"),bIcon:{name:M.Main.PERSONS_DENY,size:20,color:A.getColorCode("paletteRed40")},permissionAction:t?"":S.PermissionActions.employeeFire,dataTestId:"hr-department-detail-content__user-list_fire-user-from-department"})}hasPermission(t,e){return t.hasPermissionOfAction(this.permissionAction)}}class _e extends G{constructor(t){const e=t===A.EntityTypes.team?N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_MOVE_TO_ANOTHER_TEAM_TITLE"):N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_TITLE");const s=t===A.EntityTypes.team?N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_MOVE_TO_ANOTHER_TEAM_SUBTITLE"):N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_SUBTITLE");super({id:W.moveUserToAnotherDepartment,title:e,description:s,bIcon:{name:M.Main.PERSON_ARROW_LEFT_1,size:20,color:A.getColorCode("paletteBlue50")},permissionAction:null,dataTestId:"hr-department-detail-content__user-list_move-from-department"});this.entityType=t}hasPermission(t,e){const s=t.currentUserPermissions;const n=this.entityType===A.EntityTypes.team?S.PermissionActions.teamAddMember:S.PermissionActions.employeeAddToDepartment;const i=this.entityType===A.EntityTypes.team?S.PermissionActions.teamRemoveMember:S.PermissionActions.employeeRemoveFromDepartment;const o=this.entityType===A.EntityTypes.team?s.ACTION_TEAM_MEMBER_ADD:s.ACTION_EMPLOYEE_ADD_TO_DEPARTMENT;const a=this.entityType===A.EntityTypes.team?s.ACTION_TEAM_MEMBER_REMOVE:s.ACTION_EMPLOYEE_REMOVE_FROM_DEPARTMENT;const r=o<a?n:i;return t.hasPermission(r,e)}}class pe extends G{constructor(t){const e=t===A.EntityTypes.team?N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_REMOVE_FROM_TEAM_TITLE"):N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_REMOVE_FROM_DEPARTMENT_TITLE");const s=t===A.EntityTypes.team?N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_REMOVE_FROM_TEAM_SUBTITLE"):N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_REMOVE_FROM_DEPARTMENT_SUBTITLE");const n=t===A.EntityTypes.team?A.getColorCode("paletteRed40"):A.getColorCode("paletteBlue50");const i=t===A.EntityTypes.team?S.PermissionActions.teamRemoveMember:S.PermissionActions.employeeRemoveFromDepartment;super({id:W.removeUserFromDepartment,title:e,description:s,bIcon:{name:M.Main.TRASH_BIN,size:20,color:n},permissionAction:i,dataTestId:"hr-department-detail-content__user-list_remove-from-department"})}}class me extends j{constructor(t,e,s){super(t);this.isUserInvited=s;this.entityType=e;this.items=this.getFilteredItems()}getItems(){if(this.entityType===A.EntityTypes.team){return[new _e(this.entityType),new pe(this.entityType)]}return[new _e(this.entityType),new pe(this.entityType),new Ee(this.isUserInvited)]}}class Te extends G{constructor(t,e){const s=e.type===A.ChatTypes.chat?N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_OPEN_CHAT_TITLE"):N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_OPEN_CHANNEL_TITLE");const n=e.type===A.ChatTypes.chat?N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_OPEN_CHAT_DESCRIPTION"):N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_OPEN_CHANNEL_DESCRIPTION");super({id:W.openChat,title:s,description:n,bIcon:{name:M.Main.EDIT_PENCIL,size:20,color:A.getColorCode("paletteBlue50")},permissionAction:null,dataTestId:"hr-department-detail-content__chat-list_open-chat"});this.entityType=t;this.chat=e}hasPermission(t,e){return this.chat.hasAccess}}class Re extends G{constructor(t,e){let s="";let n="";if(t===A.EntityTypes.team){s=e.type===A.ChatTypes.chat?N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_UNBIND_TEAM_CHAT_TITLE"):N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_UNBIND_TEAM_CHANNEL_TITLE");n=e.type===A.ChatTypes.chat?N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_UNBIND_TEAM_CHAT_DESCRIPTION"):N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_UNBIND_TEAM_CHANNEL_DESCRIPTION")}else{s=e.type===A.ChatTypes.chat?N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_UNBIND_DEPARTMENT_CHAT_TITLE"):N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_UNBIND_DEPARTMENT_CHANNEL_TITLE");n=e.type===A.ChatTypes.chat?N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_UNBIND_DEPARTMENT_CHAT_DESCRIPTION"):N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_UNBIND_DEPARTMENT_CHANNEL_DESCRIPTION")}const i=t===A.EntityTypes.team?S.PermissionActions.teamCommunicationEdit:S.PermissionActions.departmentCommunicationEdit;super({id:W.unbindChat,title:s,description:n,bIcon:{name:M.Main.TRASH_BIN,size:20,color:A.getColorCode("paletteRed40")},permissionAction:i,dataTestId:"hr-department-detail-content__chat-list_open-chat"});this.chat=e}hasPermission(t,e){return!this.chat.originalNodeId&&this.chat.hasAccess&&t.hasPermission(this.permissionAction,e)}}class ve extends j{constructor(t,e,s){super(s);this.chat=e;this.entityType=t;this.items=this.getFilteredItems()}getItems(){return[new Te(this.entityType,this.chat),new Re(this.entityType,this.chat)]}}let Ce=t=>t,be;var Ae=babelHelpers.classPrivateFieldLooseKey("subscribeOnEvents");var Me=babelHelpers.classPrivateFieldLooseKey("getNotConvertedStateScreen");class Se{static async mount(t){const e=document.getElementById(t);N.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,Me)[Me](),e);babelHelpers.classPrivateFieldLooseBase(this,Ae)[Ae]();const s=3e4;this.updateConvertedStatusInterval=setInterval((async()=>{try{await O.getDictionary()}catch(t){if(t.code==="STRUCTURE_IS_NOT_CONVERTED"){return}if(t.code==="STRUCTURE_ACCESS_DENIED"){clearInterval(this.updateConvertedStatusInterval);window.location.reload()}throw t}clearInterval(this.updateConvertedStatusInterval);window.location.reload()}),s)}}function Pe(){const t=t=>{const[e]=t.data;e.denyAction()};const e=()=>{P.EventEmitter.unsubscribe(I.HR_ORG_CHART_CLOSE_BY_ESC,t);P.EventEmitter.unsubscribe(I.HR_ORG_CHART_CLOSE,e);clearInterval(this.updateConvertedStatusInterval)};P.EventEmitter.subscribe(I.HR_ORG_CHART_CLOSE_BY_ESC,t);P.EventEmitter.subscribe(I.HR_ORG_CHART_CLOSE,e)}function Ne(){return N.Tag.render(be||(be=Ce`
			<div class="humanresources-not-converted-state-screen">
				<div class="humanresources-not-converted-state-screen__icon"></div>
				<div class="humanresources-not-converted-state-screen__title">
					${0}
				</div>
				<div class="humanresources-not-converted-state-screen__description">
					${0}
				</div>
			</div>
		`),N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_NOT_CONVERTED_SCREEN_LOADING_TITLE"),N.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_NOT_CONVERTED_SCREEN_LOADING_DESCRIPTION"))}Object.defineProperty(Se,Me,{value:Ne});Object.defineProperty(Se,Ae,{value:Pe});var Ie=babelHelpers.classPrivateFieldLooseKey("subscribeOnEvents");class Ue{static async mount(t){const s=document.getElementById(t);const n=e.BitrixVue.createApp(de);const i=c.createPinia();n.use(i);babelHelpers.classPrivateFieldLooseBase(Ue,Ie)[Ie](n);const o=BX.SidePanel.Instance.getTopSlider();if(o){o.showLoader()}N.Dom.addClass(s,"humanresources-chart__back");await S.PermissionChecker.init();if(o){o.closeLoader()}N.Dom.removeClass(s,"humanresources-chart__back");n.mount(s)}}function fe(t){const e=t=>{const[e]=t.data;e.denyAction()};const s=()=>{P.EventEmitter.unsubscribe(I.HR_ORG_CHART_CLOSE_BY_ESC,e);P.EventEmitter.unsubscribe(I.HR_ORG_CHART_CLOSE,s);t.unmount()};P.EventEmitter.subscribe(I.HR_ORG_CHART_CLOSE_BY_ESC,e);P.EventEmitter.subscribe(I.HR_ORG_CHART_CLOSE,s)}Object.defineProperty(Ue,Ie,{value:fe});t.App=Ue;t.UsersTabActionMenu=he;t.EmptyUsersTabActionMenu=ue;t.UserListActionMenu=me;t.ChatListActionMenu=ve;t.MenuActions=W;t.NotConvertedState=Se;t.events=I})(this.BX.Humanresources.CompanyStructure=this.BX.Humanresources.CompanyStructure||{},BX.Vue3,BX.UI,BX.UI,BX.Humanresources.CompanyStructure,BX.UI.EntitySelector,BX.UI.Dialogs,BX,BX.Humanresources.CompanyStructure,BX.Vue3.Pinia,BX.Humanresources.CompanyStructure,BX.Humanresources.CompanyStructure,BX.Humanresources.CompanyStructure,BX,BX,BX.UI,BX,BX.UI.IconSet,BX.Humanresources.CompanyStructure,BX.Humanresources.CompanyStructure,BX.UI.Analytics,BX,BX.Humanresources.CompanyStructure,BX.UI.IconSet,BX.Humanresources.CompanyStructure,BX.Event,BX);
//# sourceMappingURL=org-chart.bundle.map.js