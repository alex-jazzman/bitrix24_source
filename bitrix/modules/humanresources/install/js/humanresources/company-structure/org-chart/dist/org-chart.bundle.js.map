{"version":3,"file":"org-chart.bundle.js","sources":["../src/consts.js","../src/components/title-panel/add-button/add-button.js","../src/api.js","../src/actions.js","../src/components/title-panel/search/search-bar.js","../src/components/title-panel/burger-menu-button/burger-menu-button.js","../src/components/title-panel/title-panel.js","../src/classes/url-provided-params-service.js","../src/components/tree/tree-node/head-list.js","../src/components/menu/abstract-action-menu.js","../src/components/menu/items/abstract-menu-item.js","../src/components/menu/menu-actions.js","../src/components/menu/items/department/add-department-menu-item.js","../src/components/menu/items/department/edit-department-menu-item.js","../src/components/menu/items/department/remove-department-menu-item.js","../src/components/menu/items/employees/add-employee-menu-item.js","../src/components/menu/items/department/edit-employees-menu-item.js","../src/components/menu/items/employees/move-employee-menu-item.js","../src/components/menu/items/employees/user-invite-menu-item.js","../src/components/menu/menu/entity-action-menu.js","../src/components/tree/tree-node/department-menu-button.js","../src/components/tree/tree-node/department-info-icon-button.js","../src/components/tree/tree-node/subdivision-add-button.js","../src/components/tree/tree-node/tree-node.js","../src/components/tree/connectors.js","../src/components/tree/directives/classes/drag-and-drop-controller.js","../src/components/tree/directives/drag-and-drop.js","../src/components/tree/tree.js","../src/components/transfrom-panel.js","../src/components/detail-panel/detail-panel-collapsed-title.js","../src/components/detail-panel/detail-panel-edit-button.js","../src/components/detail-panel/detail-panel.js","../src/components/first-popup/first-popup.js","../src/app.js","../src/components/menu/menu/users-tab-action-menu.js","../src/components/menu/menu/empty-users-tab-action-menu.js","../src/components/menu/items/user-item/fire-user-from-company.js","../src/components/menu/items/user-item/move-from-department.js","../src/components/menu/items/user-item/remove-from-department.js","../src/components/menu/menu/user-list-item-action-menu.js","../src/components/menu/items/chats/open-chat-menu-item.js","../src/components/menu/items/chats/unbund-chat-menu-item.js","../src/components/menu/menu/chat-list-action-menu.js","../src/not-converted-state.js","../src/main.js"],"sourcesContent":["export const events = Object.freeze({\n\tHR_DEPARTMENT_CONNECT: 'hr-department-connect',\n\tHR_DEPARTMENT_DISCONNECT: 'hr-department-disconnect',\n\tHR_DEPARTMENT_ADAPT_SIBLINGS: 'hr-department-adapt-siblings',\n\tHR_DEPARTMENT_ADAPT_CONNECTOR_HEIGHT: 'hr-department-adapt-connector-height',\n\tHR_DEPARTMENT_FOCUS: 'hr-department-focus',\n\tHR_DEPARTMENT_CONTROL: 'hr-department-control',\n\tHR_DEPARTMENT_MENU_CLOSE: 'hr-department-menu-close',\n\tHR_ORG_CHART_CLOSE_BY_ESC: 'SidePanel.Slider:onCloseByEsc',\n\tHR_ORG_CHART_CLOSE: 'SidePanel.Slider:onClose',\n\tHR_FIRST_POPUP_SHOW: 'HR.company-structure:first-popup-showed',\n\tHR_DRAG_ENTITY: 'hr-drag-entity',\n\tHR_DROP_ENTITY: 'hr-drop-entity',\n\tHR_ENTITY_TOGGLE_CONNECTORS: 'hr-entity-toggle-connectors',\n\tHR_ORG_CHART_TRANSFORM_CANVAS: 'hr-org-chart-transform-canvas',\n\tHR_DEPARTMENT_SLIDER_ON_MESSAGE: 'SidePanel.Slider:onMessage',\n\tHR_ORG_CHART_LOCATE_TO_DEPARTMENT: 'hr-org-chart-locate-to-department',\n\n\tHR_ENTITY_SHOW_WIZARD: 'hr-entity-show-wizard',\n\tHR_ENTITY_REMOVE: 'hr-entity-remove',\n\tHR_PUBLIC_FOCUS_NODE: 'HumanResources.CompanyStructure:focusNode',\n\n\tINTRANET_USER_MINIPROFILE_CLOSE: 'Intranet.User.MiniProfile:close',\n});\n\nexport const detailPanelWidth = 364;\n","import { RouteActionMenu } from 'humanresources.company-structure.structure-components';\nimport { Main, CRM } from 'ui.icon-set.api.core';\nimport { getColorCode } from 'humanresources.company-structure.utils';\nimport { PermissionActions, PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport 'ui.icon-set.main';\nimport 'ui.icon-set.crm';\n\nconst MenuOption = Object.freeze({\n\taddDepartment: 'add-department',\n\taddEmployee: 'add-employee',\n});\n\n// @vue/component\nexport const AddButton = {\n\tname: 'AddButton',\n\n\tcomponents: {\n\t\tRouteActionMenu,\n\t},\n\n\temits: ['addDepartment'],\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tactionMenu: {\n\t\t\t\tvisible: false,\n\t\t\t},\n\t\t};\n\t},\n\n\tcomputed: {\n\t\tMenuOption(): typeof MenuOption\n\t\t{\n\t\t\treturn MenuOption;\n\t\t},\n\t},\n\n\tmounted(): void\n\t{\n\t\tconst permissionChecker = PermissionChecker.getInstance();\n\n\t\tif (!permissionChecker)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.dropdownItems = [\n\t\t\t{\n\t\t\t\tid: MenuOption.addDepartment,\n\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_ADD_BUTTON_MENU_ADD_DEPARTMENT_TITLE'),\n\t\t\t\tdescription: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_ADD_BUTTON_MENU_ADD_DEPARTMENT_DESCR'),\n\t\t\t\tbIcon: {\n\t\t\t\t\tname: Main.CUBE_PLUS,\n\t\t\t\t\tsize: 20,\n\t\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t\t},\n\t\t\t\tpermission: {\n\t\t\t\t\taction: PermissionActions.departmentCreate,\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: MenuOption.addEmployee,\n\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_ADD_BUTTON_MENU_ADD_EMPLOYEE_TITLE'),\n\t\t\t\tdescription: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_ADD_BUTTON_MENU_ADD_EMPLOYEE_DESCR'),\n\t\t\t\tbIcon: {\n\t\t\t\t\tname: CRM.PERSON_PLUS_2,\n\t\t\t\t\tsize: 20,\n\t\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t\t},\n\t\t\t\tpermission: {\n\t\t\t\t\taction: PermissionActions.employeeAddToDepartment,\n\t\t\t\t},\n\t\t\t},\n\t\t];\n\n\t\tthis.dropdownItems = this.dropdownItems.filter((item) => {\n\t\t\tif (!item.permission)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn permissionChecker.hasPermissionOfAction(item.permission.action);\n\t\t});\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\taddDepartment(): void\n\t\t{\n\t\t\tthis.$emit('addDepartment');\n\t\t},\n\t\tactionMenuItemClickHandler(actionId: string): void\n\t\t{\n\t\t\tif (actionId === MenuOption.addDepartment)\n\t\t\t{\n\t\t\t\tthis.$emit('addDepartment');\n\t\t\t}\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"ui-btn ui-btn-success ui-btn-round ui-btn-sm humanresources-title-panel__add-button\"\n\t\t\tdata-test-id=\"hr-org-chart_title-panel__add-button\"\n\t\t\t@click=\"addDepartment\"\n\t\t>\n\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_ADD_BUTTON') }}\n\t\t</div>\n\t`,\n};\n","import { getData, postData } from 'humanresources.company-structure.api';\nimport { getNodeColorSettings } from 'humanresources.company-structure.utils';\nimport type { TreeItem } from './types';\n\nconst createTreeDataStore = (treeData: Array<TreeItem>): Map<number, TreeItem> => {\n\tconst dataMap = new Map();\n\ttreeData.forEach((item) => {\n\t\tconst { id, parentId, colorName, entityType } = item;\n\t\tconst mapItem = dataMap.get(id) ?? {};\n\t\tconst teamColor = getNodeColorSettings(colorName, entityType);\n\t\tdataMap.set(id, { ...mapItem, ...item, teamColor });\n\t\tif (parentId === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst mapParentItem = dataMap.get(parentId) ?? {};\n\t\tconst children = mapParentItem.children ?? [];\n\t\tdataMap.set(parentId, {\n\t\t\t...mapParentItem,\n\t\t\tchildren: [...children, id],\n\t\t});\n\t});\n\n\treturn dataMap;\n};\n\nexport const chartAPI = {\n\tremoveDepartment: (id: Number): Promise<void> => {\n\t\treturn getData('humanresources.api.Structure.Node.delete', { nodeId: id });\n\t},\n\tgetDepartmentsData: (): Promise<Array<TreeItem>> => {\n\t\treturn getData('humanresources.api.Structure.get', {}, { tool: 'structure', category: 'structure', event: 'open_structure' });\n\t},\n\tgetCurrentDepartments: (): Promise<number[]> => {\n\t\treturn getData('humanresources.api.Structure.Node.current');\n\t},\n\tgetDictionary: (): Promise<string> => {\n\t\treturn getData('humanresources.api.Structure.dictionary');\n\t},\n\tgetUserId: (): Promise<number> => {\n\t\treturn getData('humanresources.api.User.getCurrentId');\n\t},\n\tfirstTimeOpened: (): Promise<void> => {\n\t\treturn postData('humanresources.api.User.firstTimeOpen');\n\t},\n\tupdateDepartment: (nodeId: number, parentId: number): Promise<void> => {\n\t\treturn postData('humanresources.api.Structure.Node.update', {\n\t\t\tnodeId,\n\t\t\tparentId,\n\t\t\tname: null,\n\t\t});\n\t},\n\tchangeOrder: (draggedId: Number, direction: Number, count: number): Promise<void> => {\n\t\treturn postData('humanresources.api.Structure.Node.changeOrder', {\n\t\t\tnodeId: draggedId,\n\t\t\tdirection,\n\t\t\tcount,\n\t\t});\n\t},\n\tcreateTreeDataStore,\n};\n","import { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { memberRoles } from 'humanresources.company-structure.api';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\nimport { chartAPI } from './api';\nimport type { TreeItem } from './types';\nimport type { UserData } from 'humanresources.company-structure.utils';\n\nexport const OrgChartActions = {\n\tapplyData: (departments: Map<Number, TreeItem>, currentDepartments: number[], userId: number): void => {\n\t\tconst store = useChartStore();\n\t\tstore.$patch({\n\t\t\tdepartments,\n\t\t\tcurrentDepartments,\n\t\t\tuserId,\n\t\t\tsearchedUserId: userId,\n\t\t});\n\t},\n\tfocusDepartment: (departmentId: number): void => {\n\t\tconst store = useChartStore();\n\t\tstore.focusedNode = departmentId;\n\t},\n\tsearchUserInDepartment: (userId: number): void => {\n\t\tconst store = useChartStore();\n\t\tstore.searchedUserId = userId;\n\t},\n\tmoveSubordinatesToParent: (removableDepartmentId: number): void => {\n\t\tconst store = useChartStore();\n\t\tconst { departments, currentDepartments } = store;\n\t\tconst removableDepartment = departments.get(removableDepartmentId);\n\t\tconst {\n\t\t\tparentId,\n\t\t\tentityType,\n\t\t\tchildren: removableDeparmentChildren = [],\n\t\t\tuserCount: removableDepartmentUserCount,\n\t\t\theads: removableDeparmentHeads,\n\t\t\temployees: removableDeparmentEmployees = [],\n\t\t} = removableDepartment;\n\t\tconst parentDepartment = departments.get(parentId);\n\n\t\tremovableDeparmentChildren.forEach((childId) => {\n\t\t\tconst department = departments.get(childId);\n\t\t\tdepartment.parentId = parentId;\n\t\t});\n\t\tif ((removableDepartmentUserCount > 0) && (entityType === EntityTypes.department))\n\t\t{\n\t\t\tconst parentDepartmentUsersIds = new Set([\n\t\t\t\t...parentDepartment.heads,\n\t\t\t\t...(parentDepartment.employees ?? []),\n\t\t\t].map((user) => user.id));\n\t\t\tconst removableDeparmentUsers = [...removableDeparmentHeads, ...removableDeparmentEmployees];\n\t\t\tconst movableUsers = removableDeparmentUsers.filter((user) => {\n\t\t\t\treturn !parentDepartmentUsersIds.has(user.id);\n\t\t\t});\n\t\t\tfor (const user of movableUsers)\n\t\t\t{\n\t\t\t\tuser.role = memberRoles.employee;\n\t\t\t}\n\t\t\tparentDepartment.userCount += movableUsers.length;\n\t\t\tparentDepartment.employees = [\n\t\t\t\t...(parentDepartment.employees ?? []),\n\t\t\t\t...movableUsers,\n\t\t\t];\n\t\t}\n\n\t\tparentDepartment.children = [...parentDepartment.children, ...removableDeparmentChildren];\n\t\tif (currentDepartments.includes(removableDepartmentId) && (entityType === EntityTypes.department))\n\t\t{\n\t\t\tstore.changeCurrentDepartment(removableDepartmentId, parentId);\n\t\t}\n\t},\n\tmarkDepartmentAsRemoved: (removableDepartmentId: number): void => {\n\t\tconst { departments } = useChartStore();\n\t\tconst removableDepartment = departments.get(removableDepartmentId);\n\t\tconst { parentId } = removableDepartment;\n\t\tconst parentDepartment = departments.get(parentId);\n\t\tparentDepartment.children = parentDepartment.children.filter((childId) => {\n\t\t\treturn childId !== removableDepartmentId;\n\t\t});\n\t\tdelete removableDepartment.parentId;\n\t\tdepartments.set(removableDepartmentId, { ...removableDepartment, prevParentId: parentId });\n\t},\n\tremoveDepartment: (departmentId: number): void => {\n\t\tconst { departments } = useChartStore();\n\t\tdepartments.delete(departmentId);\n\t},\n\tinviteUser: (userData: UserData): void => {\n\t\tconst { nodeId, ...restData } = userData;\n\t\tconst { departments } = useChartStore();\n\t\tconst department = departments.get(nodeId);\n\t\tif (department.employees)\n\t\t{\n\t\t\tdepartments.set(nodeId, {\n\t\t\t\t...department,\n\t\t\t\temployees: [...department.employees, { ...restData }],\n\t\t\t\tuserCount: department.userCount + 1,\n\t\t\t});\n\t\t}\n\t},\n\torderDepartments: async (draggedId: number, targetId: number, direction: number, count: number): Promise<boolean> => {\n\t\tconst { departments } = useChartStore();\n\t\tconst department = departments.get(draggedId);\n\t\tconst { parentId } = department;\n\t\tconst parentDepartment = departments.get(parentId);\n\t\tconst { children } = parentDepartment;\n\t\tconst targetIndex = children.indexOf(targetId);\n\t\tconst newChildren = children.filter((childId) => childId !== draggedId);\n\t\tnewChildren.splice(targetIndex, 0, draggedId);\n\t\tdepartments.set(parentId, { ...parentDepartment, children: newChildren });\n\t\ttry\n\t\t{\n\t\t\tawait chartAPI.changeOrder(draggedId, direction, count);\n\n\t\t\treturn true;\n\t\t}\n\t\tcatch\n\t\t{\n\t\t\tdepartments.set(parentId, { ...parentDepartment, children });\n\n\t\t\treturn false;\n\t\t}\n\t},\n\tclearNodesChatLists: (nodeIds: Array<Number>): void => {\n\t\tconst { departments } = useChartStore();\n\t\tnodeIds.forEach((nodeId) => {\n\t\t\tconst department = departments.get(nodeId);\n\t\t\tdepartments.set(nodeId, { ...department, chats: null, channels: null });\n\t\t});\n\t},\n};\n","import { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { Event, Dom } from 'main.core';\nimport { type BaseEvent } from 'main.core.events';\nimport { Dialog, type Item } from 'ui.entity-selector';\nimport { BIcon, Set } from 'ui.icon-set.api.vue';\nimport { mapState } from 'ui.vue3.pinia';\nimport { sendData as analyticsSendData } from 'ui.analytics';\nimport { OrgChartActions } from '../../../actions';\n\nimport './style.css';\n\n// @vue/component\nexport const SearchBar = {\n\tname: 'search-bar',\n\n\tcomponents: {\n\t\tBIcon,\n\t},\n\n\tdirectives: {\n\t\tfocus: {\n\t\t\tmounted(el)\n\t\t\t{\n\t\t\t\tel.focus();\n\t\t\t},\n\t\t},\n\t},\n\n\temits: [\n\t\t'locate',\n\t],\n\n\tdata(): { canEditPermissions: boolean; showSearchBar: boolean; }\n\t{\n\t\treturn {\n\t\t\tcanEditPermissions: false,\n\t\t\tshowSearchBar: false,\n\t\t};\n\t},\n\n\tcomputed: {\n\t\tset(): Set\n\t\t{\n\t\t\treturn Set;\n\t\t},\n\t\t...mapState(useChartStore, ['departments']),\n\t},\n\n\twatch: {\n\t\tdepartments: {\n\t\t\thandler(): void\n\t\t\t{\n\t\t\t\tthis.searchDialog.destroy();\n\t\t\t},\n\t\t\tdeep: true,\n\t\t},\n\t},\n\n\tcreated()\n\t{\n\t\tthis.searchDialog = this.getSearchDialog();\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tshowSearchbar(): void\n\t\t{\n\t\t\tif (this.showSearchBar)\n\t\t\t{\n\t\t\t\tthis.showSearchBar = false;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tanalyticsSendData({ tool: 'structure', category: 'structure', event: 'search' });\n\n\t\t\tthis.showSearchBar = true;\n\t\t},\n\t\thideSearchbar(): void\n\t\t{\n\t\t\tthis.showSearchBar = false;\n\t\t},\n\t\tgetSearchDialog(): Dialog\n\t\t{\n\t\t\tconst dialog = new Dialog({\n\t\t\t\twidth: 425,\n\t\t\t\theight: 320,\n\t\t\t\tmultiple: false,\n\t\t\t\tentities: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'user',\n\t\t\t\t\t\tsearchFields: [\n\t\t\t\t\t\t\t{ name: 'supertitle', type: 'string', system: true, searchable: true },\n\t\t\t\t\t\t\t{ name: 'position', type: 'string' },\n\t\t\t\t\t\t],\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tintranetUsersOnly: true,\n\t\t\t\t\t\t\temailUsers: false,\n\t\t\t\t\t\t\tinviteEmployeeLink: false,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'structure-node',\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tselectMode: 'departmentsOnly',\n\t\t\t\t\t\t\tuseMultipleTabs: true,\n\t\t\t\t\t\t\trestricted: 'view',\n\t\t\t\t\t\t\tflatMode: true,\n\t\t\t\t\t\t\tincludedNodeEntityTypes: ['department', 'team'],\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\trecentTabOptions: {\n\t\t\t\t\tid: 'recents',\n\t\t\t\t\tvisible: true,\n\t\t\t\t},\n\t\t\t\tdropdownMode: true,\n\t\t\t\tenableSearch: false,\n\t\t\t\thideOnDeselect: false,\n\t\t\t\tcontext: 'HR_STRUCTURE',\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onSelect': (event: BaseEvent<{ item: Item }>) => {\n\t\t\t\t\t\tconst item = event.getData().item;\n\n\t\t\t\t\t\tif (item.entityType === 'employee')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.$emit('locate', item.customData.get('nodeId'));\n\t\t\t\t\t\t\tOrgChartActions.searchUserInDepartment(item.id);\n\t\t\t\t\t\t\tdialog.recentItemsToSave.push(item);\n\t\t\t\t\t\t\tdialog.saveRecentItems();\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdialog.recentItemsToSave.push(item);\n\t\t\t\t\t\tdialog.saveRecentItems();\n\n\t\t\t\t\t\tthis.$emit('locate', item.id);\n\t\t\t\t\t},\n\t\t\t\t\tonLoad: (event) => {\n\t\t\t\t\t\tevent.target.items.get('user')?.forEach((item) => {\n\t\t\t\t\t\t\tif (!item.getSubtitle())\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\titem.setSubtitle(item.customData.get('position'));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\t'SearchTab:onLoad': (event) => {\n\t\t\t\t\t\tevent.target.items.get('user')?.forEach((item) => {\n\t\t\t\t\t\t\tif (!item.getSubtitle())\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\titem.setSubtitle(item.customData.get('position'));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tonDestroy: () => {\n\t\t\t\t\t\tthis.searchDialog = this.getSearchDialog();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tconst dialogContainer = dialog.getContainer();\n\t\t\tDom.attr(dialogContainer, 'data-test-id', 'hr-org-chart_title-panel__search-dialog-container');\n\n\t\t\treturn dialog;\n\t\t},\n\n\t\tonEnter(): void\n\t\t{\n\t\t\tif (this.$refs.searchName)\n\t\t\t{\n\t\t\t\tthis.searchDialog.setTargetNode(this.$refs.searchName);\n\t\t\t\tif (!this.searchDialog.isOpen())\n\t\t\t\t{\n\t\t\t\t\tthis.searchDialog.show();\n\t\t\t\t}\n\t\t\t\tEvent.bind(window, 'mousedown', this.handleClickOutside);\n\t\t\t}\n\t\t},\n\t\thandleClickOutside(event): void\n\t\t{\n\t\t\tif (this.$refs.searchName\n\t\t\t\t&& !this.$refs.searchName.parentElement.contains(event.target) && !this.searchDialog.isOpen())\n\t\t\t{\n\t\t\t\tthis.clearSearch();\n\t\t\t\tthis.hideSearchbar();\n\t\t\t\tEvent.unbind(window, 'mousedown', this.handleClickOutside);\n\t\t\t}\n\t\t},\n\t\tsearch(value: string): void\n\t\t{\n\t\t\tif (!this.searchDialog.isOpen())\n\t\t\t{\n\t\t\t\tthis.searchDialog.show();\n\t\t\t}\n\n\t\t\tthis.searchDialog.search(value);\n\t\t},\n\t\tclearSearch()\n\t\t{\n\t\t\tthis.searchDialog.getSearchTab().clearResults();\n\t\t\tthis.searchDialog.selectTab('recents');\n\n\t\t\tif (this.$refs.searchName)\n\t\t\t{\n\t\t\t\tthis.$refs.searchName.value = '';\n\t\t\t\tthis.$refs.searchName.focus();\n\t\t\t}\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t    class=\"humanresources-title-panel-search-bar-container\"\n\t\t    :class=\"{'--opened': showSearchBar}\"\n\t\t>\n\t\t  <div\n\t\t      class=\"humanresources-title-panel-search-bar-block__search\"\n\t\t      @click=\"showSearchbar\"\n\t\t\t\tdata-test-id=\"hr-org-chart_title-panel__search-bar-button\"\n\t\t  >\n\t\t    <BIcon :name=\"set.SEARCH_2\" :size=\"24\" class=\"hr-title-search-icon\"></BIcon>\n\t\t  </div>\n\t\t  <transition name=\"humanresources-title-panel-search-bar-fade\" mode=\"in-out\" @after-enter=\"onEnter\">\n\t\t    <div v-if=\"showSearchBar\"\n\t\t         class=\"humanresources-title-panel-search-bar-block__search-bar\"\n\t\t    >\n\t\t      <input\n\t\t          ref=\"searchName\"\n\t\t          key=\"searchInput\"\n\t\t          type=\"text\"\n\t\t          :placeholder=\"loc('HUMANRESOURCES_SEARCH_PLACEHOLDER_MSGVER_1')\"\n\t\t          v-focus\n\t\t          class=\"humanresources-title-panel-search-bar-block__search-input\"\n\t\t          @click=\"onEnter\"\n\t\t          @input=\"search($event.target.value)\"\n\t\t\t\t\tdata-test-id=\"hr-org-chart_title-panel__search-bar-input\"\n\t\t      >\n\t\t      <div\n\t\t          key=\"searchReset\"\n\t\t          @click=\"clearSearch\"\n\t\t          class=\"humanresources-title-panel-search-bar-block__search-reset\"\n\t\t      >\n\t\t        <div class=\"humanresources-title-panel-search-bar-block__search-cursor\"></div>\n\t\t        <BIcon\n\t\t            :name=\"set.CROSS_CIRCLE_50\"\n\t\t            :size=\"24\"\n\t\t            color=\"#2FC6F6\"\n\t\t        ></BIcon>\n\t\t      </div>\n\t\t    </div>\n\t\t  </transition>\n\t\t</div>\n\t`,\n};\n","import { RouteActionMenu } from 'humanresources.company-structure.structure-components';\nimport { Main } from 'ui.icon-set.api.core';\nimport { getColorCode } from 'humanresources.company-structure.utils';\nimport { sendData as analyticsSendData } from 'ui.analytics';\n\nimport 'ui.icon-set.main';\nimport { PermissionActions, PermissionChecker } from 'humanresources.company-structure.permission-checker';\n\nconst MenuOption = Object.freeze({\n\taccessRights: 'access-rights',\n\tteamAccessRights: 'team-access-rights',\n});\n\n// @vue/component\nexport const BurgerMenuButton = {\n\tname: 'BurgerMenuButton',\n\n\tcomponents: {\n\t\tRouteActionMenu,\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tactionMenu: {\n\t\t\t\tvisible: false,\n\t\t\t},\n\t\t};\n\t},\n\n\tmounted(): void\n\t{\n\t\tconst permissionChecker = PermissionChecker.getInstance();\n\n\t\tthis.dropdownItems = [\n\t\t\t{\n\t\t\t\tid: MenuOption.accessRights,\n\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIG_PERMISSION_TITLE_MSGVER_1'),\n\t\t\t\tdescription: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIG_PERMISSION_DESCR_MSGVER_1'),\n\t\t\t\tbIcon: {\n\t\t\t\t\tname: Main.PERSONS_2,\n\t\t\t\t\tsize: 20,\n\t\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t\t},\n\t\t\t\tdataTestId: 'hr-org-chart_title-panel__access-rights-button',\n\t\t\t\tpermission: permissionChecker.hasPermissionOfAction(PermissionActions.accessEdit),\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: MenuOption.teamAccessRights,\n\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIG_TEAM_PERMISSION_TITLE'),\n\t\t\t\tdescription: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIG_TEAM_PERMISSION_DESCR'),\n\t\t\t\tbIcon: {\n\t\t\t\t\tname: Main.MY_PLAN,\n\t\t\t\t\tsize: 20,\n\t\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t\t},\n\t\t\t\tdataTestId: 'hr-org-chart_title-panel__team-access-rights-button',\n\t\t\t\tpermission: permissionChecker.hasPermissionOfAction(PermissionActions.teamAccessEdit),\n\t\t\t},\n\t\t];\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\n\t\tactionMenuItemClickHandler(actionId: string): void\n\t\t{\n\t\t\tif (actionId === MenuOption.accessRights)\n\t\t\t{\n\t\t\t\tanalyticsSendData({ tool: 'structure', category: 'structure', event: 'open_roles' });\n\n\t\t\t\tBX.SidePanel.Instance.open('/hr/config/permission/', { usePadding: true });\n\t\t\t}\n\n\t\t\tif (actionId === MenuOption.teamAccessRights)\n\t\t\t{\n\t\t\t\tanalyticsSendData({ tool: 'structure', category: 'structure', event: 'open_roles' });\n\n\t\t\t\tBX.SidePanel.Instance.open('/hr/config/permission/?category=TEAM', { usePadding: true });\n\t\t\t}\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<span\n\t\t\tref=\"burgerMenuButton\"\n\t\t\t@click=\"actionMenu.visible = true\"\n\t\t\tclass=\"humanresources-title-panel__burger-menu-button\"\n\t\t\tdata-test-id=\"hr-org-chart_title-panel__burger-menu-button\"\n\t\t>\n\t\t\t<svg\n\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\tfill=\"none\"\n\t\t\t\tclass=\"humanresources-title-panel__icon\"\n\t\t\t\t:class=\"{'--selected': actionMenu.visible }\"\n\t\t\t\t>\n\t\t\t\t\t<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M18.7067 15.5577C18.8172 15.5577 18.9067 15.6473 18.9067 15.7577L18.9067 17.2424C18.9067 17.3528 18.8172 17.4424 18.7067 17.4424H5.29375C5.1833 17.4424 5.09375 17.3528 5.09375 17.2424L5.09379 15.7577C5.09379 15.6473 5.18333 15.5577 5.29379 15.5577H18.7067ZM18.7067 11.5577C18.8172 11.5577 18.9067 11.6473 18.9067 11.7577L18.9067 13.2424C18.9067 13.3528 18.8172 13.4424 18.7067 13.4424H5.29375C5.1833 13.4424 5.09375 13.3528 5.09375 13.2424L5.09379 11.7577C5.09379 11.6473 5.18333 11.5577 5.29379 11.5577H18.7067ZM18.7067 7.55774C18.8172 7.55774 18.9067 7.64729 18.9067 7.75774L18.9067 9.24238C18.9067 9.35284 18.8172 9.44238 18.7067 9.44238H5.29375C5.1833 9.44238 5.09375 9.35283 5.09375 9.24237L5.09379 7.75773C5.09379 7.64728 5.18333 7.55774 5.29379 7.55774H18.7067Z\" fill=\"#959ca4\"/>\n\t\t\t</svg>\n\t\t </span>\n\t\t<RouteActionMenu\n\t\t\tv-if=\"actionMenu.visible\"\n\t\t\tid=\"title-panel-burger-menu\"\n\t\t\t:items=\"dropdownItems.filter(item => item.permission)\"\n\t\t\t:bindElement=\"this.$refs.burgerMenuButton\"\n\t\t\t@action=\"actionMenuItemClickHandler($event)\"\n\t\t\t@close=\"this.actionMenu.visible = false\"\n\t\t\tcontainerDataTestId=\"hr-org-chart_title-panel__burger-menu-container\"\n\t\t/>\n\t`,\n\n};\n","import { events } from 'humanresources.company-structure.org-chart';\nimport { EventEmitter } from 'main.core.events';\nimport { AddButton } from './add-button/add-button.js';\nimport { SearchBar } from './search/search-bar.js';\nimport { BurgerMenuButton } from './burger-menu-button/burger-menu-button.js';\nimport { PermissionActions, PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport { AnalyticsSourceType } from 'humanresources.company-structure.api';\nimport { UI } from 'ui.notification';\nimport { Dom } from 'main.core';\nimport { BIcon, Set } from 'ui.icon-set.api.vue';\n\nimport './style.css';\n\nexport const TitlePanel = {\n\tcomponents: {\n\t\tAddButton,\n\t\tBurgerMenuButton,\n\t\tSearchBar,\n\t\tBIcon,\n\t\tSet,\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tcanEditPermissions: false,\n\t\t\tcanAddNode: false,\n\t\t\ttoolbarStarActive: false,\n\t\t\tisHovered: false,\n\t\t};\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.toolbarStarElement = document.getElementById('uiToolbarStar');\n\t},\n\n\tmounted()\n\t{\n\t\ttry\n\t\t{\n\t\t\tconst permissionChecker = PermissionChecker.getInstance();\n\t\t\tthis.canEditPermissions = permissionChecker\n\t\t\t\t&& (permissionChecker.hasPermissionOfAction(PermissionActions.accessEdit)\n\t\t\t\t|| permissionChecker.hasPermissionOfAction(PermissionActions.teamAccessEdit)\n\t\t\t\t);\n\t\t\tthis.canAddNode = permissionChecker\n\t\t\t\t&& (\n\t\t\t\t\tpermissionChecker.hasPermissionOfAction(PermissionActions.departmentCreate)\n\t\t\t\t\t|| permissionChecker.hasPermissionOfAction(PermissionActions.teamCreate)\n\t\t\t\t);\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error('Failed to fetch data:', error);\n\t\t}\n\n\t\tconst observer = new MutationObserver(() => {\n\t\t\tthis.toolbarStarActive = Dom.hasClass(this.toolbarStarElement, 'ui-toolbar-star-active');\n\t\t});\n\n\t\tobserver.observe(this.toolbarStarElement, { attributes: true, attributeFilter: ['class'] });\n\n\t\tthis.toolbarStarActive = Dom.hasClass(this.toolbarStarElement, 'ui-toolbar-star-active');\n\t},\n\n\tname: 'title-panel',\n\n\temits: ['showWizard'],\n\n\tcomputed: {\n\t\tset(): Set\n\t\t{\n\t\t\treturn Set;\n\t\t},\n\t\ttoolbarStarIcon(): string | null\n\t\t{\n\t\t\tif (this.isAirTemplate)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (this.isHovered || this.toolbarStarActive)\n\t\t\t{\n\t\t\t\treturn this.set.FAVORITE_1;\n\t\t\t}\n\n\t\t\treturn this.set.FAVORITE_0;\n\t\t},\n\t\tisAirTemplate(): boolean\n\t\t{\n\t\t\treturn BX.Reflection.getClass('top.BX.Intranet.Bitrix24.Template') !== null;\n\t\t},\n\t\ttoolbarClassIcon(): string\n\t\t{\n\t\t\tif (!this.isAirTemplate)\n\t\t\t{\n\t\t\t\treturn 'humanresources-title-panel__star';\n\t\t\t}\n\n\t\t\treturn this.toolbarStarActive ? 'humanresources-title-panel__unpin' : 'humanresources-title-panel__pin';\n\t\t},\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\taddDepartment(): void\n\t\t{\n\t\t\tthis.$emit('showWizard', { source: AnalyticsSourceType.HEADER });\n\t\t},\n\t\tonLocate(nodeId: number)\n\t\t{\n\t\t\tEventEmitter.emit(events.HR_ORG_CHART_LOCATE_TO_DEPARTMENT, { nodeId });\n\t\t},\n\t\ttriggerFavoriteStar()\n\t\t{\n\t\t\tthis.toolbarStarElement.click();\n\n\t\t\tUI.Notification.Center.notify({\n\t\t\t\tcontent: this.toolbarStarActive\n\t\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_LEFT_MENU_UN_SAVED')\n\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_LEFT_MENU_SAVED'),\n\t\t\t\tautoHideDelay: 2000,\n\t\t\t});\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"humanresources-title-panel\">\n\t\t\t<p class=\"humanresources-title-panel__title\">\n\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_TITLE') }}\n\t\t\t</p>\n\t\t\t<BIcon\n\t\t\t\t:name=\"toolbarStarIcon\"\n\t\t\t\t:size=\"24\"\n\t\t\t\tcolor=\"rgba(149, 156, 164, 1)\"\n\t\t\t\t:class=\"toolbarClassIcon\"\n\t\t\t\t@mouseover=\"isHovered = true\"\n\t\t\t\t@mouseleave=\"isHovered = false\" @click=\"triggerFavoriteStar\"\n\t\t\t></BIcon>\n\t\t\t<AddButton\n\t\t\t\tv-if=\"canAddNode\"\n\t\t\t\t@addDepartment=\"addDepartment\"\n\t\t\t/>\n\t\t\t<div class=\"humanresources-title-panel__icon-buttons\">\n\t\t\t\t<BurgerMenuButton v-if=\"canEditPermissions\"/>\n\t\t\t\t<SearchBar @locate=\"onLocate\"/>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Type } from 'main.core';\n\ntype UrlProvidedParamsType = {\n\tfocusNodeId: ?number,\n};\n\nconst UrlParamNames = Object.freeze({\n\tFocusNodeId: 'focusNodeId',\n});\n\nexport class UrlProvidedParamsService\n{\n\tstatic getParams(): UrlProvidedParamsType\n\t{\n\t\tconst paramMap = this.#getParamsFromUrl();\n\n\t\treturn {\n\t\t\tfocusNodeId: this.#castAndValidate(UrlParamNames.FocusNodeId, paramMap.get(UrlParamNames.FocusNodeId)),\n\t\t};\n\t}\n\n\tstatic #getParamsFromUrl(): Map<$Values<typeof UrlParamNames>, string>\n\t{\n\t\tconst paramMap = new Map();\n\n\t\tconst urlSearchParams = new URLSearchParams(document.location.search);\n\t\tObject.values(UrlParamNames).forEach((paramName: string) => {\n\t\t\tconst paramValue = urlSearchParams.get(paramName);\n\t\t\tif (!paramValue)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tparamMap.set(paramName, paramValue);\n\t\t});\n\n\t\treturn paramMap;\n\t}\n\n\tstatic #castAndValidate(paramName: string, value: ?string): string | number | null\n\t{\n\t\tif (Type.isUndefined(value))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tlet castedValue = value;\n\t\tif (paramName === UrlParamNames.FocusNodeId)\n\t\t{\n\t\t\tcastedValue = Number(value);\n\t\t\tif (!Type.isInteger(castedValue))\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\n\t\treturn castedValue;\n\t}\n}\n","import './style.css';\nimport { UserListActionMenu } from 'humanresources.company-structure.structure-components';\nimport { events } from '../../../consts';\nimport { EventEmitter } from 'main.core.events';\nimport type { UserData } from 'humanresources.company-structure.utils';\n\n// @vue/component\nexport const HeadList = {\n\tname: 'headList',\n\n\tcomponents: {\n\t\tUserListActionMenu,\n\t},\n\n\tprops: {\n\t\titems: {\n\t\t\ttype: Array,\n\t\t\trequired: false,\n\t\t\tdefault: () => [],\n\t\t},\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: '',\n\t\t},\n\t\tcollapsed: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t\tdefault: false,\n\t\t},\n\t\ttype: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: 'head',\n\t\t},\n\t\tisTeamEntity: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tisCollapsed: false,\n\t\t\tisUpdating: true,\n\t\t\theadsVisible: false,\n\t\t};\n\t},\n\n\tcomputed:\n\t{\n\t\tdefaultAvatar(): String\n\t\t{\n\t\t\treturn '/bitrix/js/humanresources/company-structure/org-chart/src/images/default-user.svg';\n\t\t},\n\t\tdropdownItems(): Array<UserData>\n\t\t{\n\t\t\treturn this.items.map((item: UserData): UserData => {\n\t\t\t\tconst workPosition = this.getPositionText(item);\n\n\t\t\t\treturn { ...item, workPosition };\n\t\t\t});\n\t\t},\n\t\ttitleBar(): string\n\t\t{\n\t\t\treturn this.type === this.userTypes.deputy\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_DEPUTY_TITLE')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_HEAD_TITLE')\n\t\t\t;\n\t\t},\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.userTypes = {\n\t\t\thead: 'head',\n\t\t\tdeputy: 'deputy',\n\t\t};\n\t},\n\n\tmethods:\n\t{\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\thandleUserClick(url: string): void\n\t\t{\n\t\t\tBX.SidePanel.Instance.open(url, {\n\t\t\t\tcacheable: false,\n\t\t\t});\n\t\t},\n\t\tcloseHeadList(): void\n\t\t{\n\t\t\tif (this.headsVisible) // to prevent double unsubscription\n\t\t\t{\n\t\t\t\tthis.headsVisible = false;\n\t\t\t\tEventEmitter.unsubscribe(events.HR_DEPARTMENT_MENU_CLOSE, this.closeHeadList);\n\t\t\t\tEventEmitter.unsubscribe(events.HR_DRAG_ENTITY, this.closeHeadList);\n\t\t\t}\n\t\t},\n\t\topenHeadList(): void\n\t\t{\n\t\t\tif (!this.headsVisible) // to prevent double subscription\n\t\t\t{\n\t\t\t\tthis.headsVisible = true;\n\t\t\t\tEventEmitter.subscribe(events.HR_DEPARTMENT_MENU_CLOSE, this.closeHeadList);\n\t\t\t\tEventEmitter.subscribe(events.HR_DRAG_ENTITY, this.closeHeadList);\n\t\t\t}\n\t\t},\n\t\tgetPositionText(item: UserData): string\n\t\t{\n\t\t\treturn item.workPosition || this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_HEAD_POSITION');\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div v-if=\"items.length\">\n\t\t\t<p v-if=\"title\" class=\"humanresources-tree__node_employees-title\">\n\t\t\t\t{{ title }}\n\t\t\t</p>\n\t\t\t<div\n\t\t\t\tclass=\"humanresources-tree__node_head\"\n\t\t\t\t:class=\"{ '--collapsed': collapsed }\"\n\t\t\t\tv-for=\"(item, index) in items.slice(0, 2)\"\n\t\t\t>\n\t\t\t\t<img\n\t\t\t\t\t:src=\"item.avatar ? encodeURI(item.avatar) : defaultAvatar\"\n\t\t\t\t\tclass=\"humanresources-tree__node_avatar --head\"\n\t\t\t\t\t:class=\"{ '--collapsed': collapsed }\"\n\t\t\t\t\t@click.stop=\"handleUserClick(item.url)\"\n\t\t\t\t/>\n\t\t\t\t<div class=\"humanresources-tree__node_head-text\">\n\t\t\t\t\t<span\n\t\t\t\t\t\t:bx-tooltip-user-id=\"item.id\"\n\t\t\t\t\t\tbx-tooltip-context=\"b24\"\n\t\t\t\t\t\tclass=\"humanresources-tree__node_head-name\"\n\t\t\t\t\t\t@click.stop=\"handleUserClick(item.url)\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ item.name }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span v-if=\"!collapsed\" class=\"humanresources-tree__node_head-position\">\n\t\t\t\t\t\t{{ getPositionText(item) }}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<span\n\t\t\t\t\tv-if=\"index === 1 && items.length > 2\"\n\t\t\t\t\tclass=\"humanresources-tree__node_head-rest\"\n\t\t\t\t\t:class=\"{ '--active': headsVisible }\"\n\t\t\t\t\t:data-test-id=\"'hr-company-structure_org-chart-tree__node-' + type + '-rest'\"\n\t\t\t\t\tref=\"showMoreHeadList\"\n\t\t\t\t\t@click.stop=\"openHeadList\"\n\t\t\t\t>\n\t\t\t\t\t{{ '+' + String(items.length - 2) }}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\t\t<UserListActionMenu\n\t\t\tv-if=\"headsVisible\"\n\t\t\t:id=\"type === userTypes.head ? 'head-list-popup-head' : 'head-list-popup-deputy'\"\n\t\t\t:items=\"dropdownItems\"\n\t\t\t:width=\"228\"\n\t\t\t:bindElement=\"$refs.showMoreHeadList[0]\"\n\t\t\t@close=\"closeHeadList\"\n\t\t\t:titleBar=\"titleBar\"\n\t\t/>\n\t`,\n};\n","import { PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport type { PermissionCheckerClass } from 'humanresources.company-structure.permission-checker';\nimport { Type } from 'main.core';\n\nexport class AbstractActionMenu\n{\n\tpermissionChecker: PermissionCheckerClass;\n\tentityId: number;\n\tanalyticSource: string;\n\tentityType: string;\n\n\tconstructor(entityId: number)\n\t{\n\t\tthis.permissionChecker = PermissionChecker.getInstance();\n\t\tthis.entityId = entityId;\n\t}\n\n\tgetItems(): Array\n\t{\n\t\tthrow new Error('Must override this function');\n\t}\n\n\tgetFilteredItems(): Array\n\t{\n\t\tif (!this.permissionChecker)\n\t\t{\n\t\t\treturn [];\n\t\t}\n\n\t\tconst items = this.getItems();\n\n\t\treturn items.filter((item) => {\n\t\t\tif (Type.isFunction(item.hasPermission))\n\t\t\t{\n\t\t\t\treturn item.hasPermission(this.permissionChecker, this.entityId);\n\t\t\t}\n\n\t\t\treturn false;\n\t\t});\n\t}\n\n\tonActionMenuItemClick(actionId: string): void\n\t{\n\t\tconst targetItem = this.items.find((item) => item.id === actionId);\n\t\ttargetItem?.invoke({\n\t\t\tentityId: this.entityId,\n\t\t\tanalyticSource: this.analyticSource,\n\t\t\tentityType: this.entityType,\n\t\t});\n\t}\n}\n","import type { PermissionCheckerClass } from 'humanresources.company-structure.permission-checker';\n\ntype BIcon = {\n\tname: string,\n\tsize: number,\n\tcolor: string,\n};\n\nexport class AbstractMenuItem\n{\n\tid: string;\n\ttitle: string;\n\tdescription: string;\n\tbIcon: BIcon;\n\tpermissionAction: string;\n\tdataTestId: string;\n\n\tconstructor({ id, title, description, bIcon, permissionAction, dataTestId })\n\t{\n\t\tthis.id = id;\n\t\tthis.title = title;\n\t\tthis.description = description;\n\t\tthis.bIcon = bIcon;\n\t\tthis.permissionAction = permissionAction;\n\t\tthis.dataTestId = dataTestId;\n\t}\n\n\tinvoke(options: Object): void\n\t{\n\t\tthrow new Error('Must override this function');\n\t}\n\n\thasPermission(permissionChecker: PermissionCheckerClass, entityId: number): boolean\n\t{\n\t\treturn permissionChecker.hasPermission(this.permissionAction, entityId);\n\t}\n}\n","export const MenuActions = Object.freeze({\n\teditDepartment: 'editDepartment',\n\taddDepartment: 'addDepartment',\n\taddEmployee: 'addEmployee',\n\teditEmployee: 'editEmployee',\n\tremoveDepartment: 'removeDepartment',\n\tmoveEmployee: 'moveEmployee',\n\tuserInvite: 'userInvite',\n\tteamRights: 'teamRights',\n\n\tmoveUserToAnotherDepartment: 'moveUserToAnotherDepartment',\n\tremoveUserFromDepartment: 'removeUserFromDepartment',\n\tfireUserFromCompany: 'fireUserFromCompany',\n\n\topenChat: 'openChat',\n\tunbindChat: 'unbindChat',\n});\n","import {\n\tPermissionActions,\n\tPermissionChecker,\n\tPermissionCheckerClass,\n} from 'humanresources.company-structure.permission-checker';\nimport { EntityTypes, getColorCode } from 'humanresources.company-structure.utils';\nimport { Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Main } from 'ui.icon-set.api.core';\nimport { UI } from 'ui.notification';\nimport { events } from '../../../../consts';\nimport { AbstractMenuItem } from '../abstract-menu-item';\nimport { MenuActions } from '../../menu-actions';\n\nexport class AddDepartmentMenuItem extends AbstractMenuItem\n{\n\tpermissionChecker: PermissionCheckerClass;\n\tentityType: null;\n\n\tconstructor(entityType: string)\n\t{\n\t\tlet title = '';\n\t\tlet description = '';\n\n\t\t// temporary check for option\n\t\tconst permissionChecker = PermissionChecker.getInstance();\n\t\tif (permissionChecker.isTeamsAvailable)\n\t\t{\n\t\t\ttitle = entityType === EntityTypes.team\n\t\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_ADD_TEAM_TITLE')\n\t\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_ADD_DEPARTMENT_TITLE_MSGVER_1');\n\n\t\t\tdescription = entityType === EntityTypes.team\n\t\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_ADD_TEAM_SUBTITLE')\n\t\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_ADD_DEPARTMENT_SUBTITLE_MSGVER_1');\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttitle = Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_ADD_DEPARTMENT_TITLE_NO_TEAM');\n\t\t\tdescription = Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_ADD_DEPARTMENT_SUBTITLE_NO_TEAM');\n\t\t}\n\n\t\tsuper({\n\t\t\tid: MenuActions.addDepartment,\n\t\t\ttitle,\n\t\t\tdescription,\n\t\t\tbIcon: {\n\t\t\t\tname: Main.CUBE_PLUS,\n\t\t\t\tsize: 20,\n\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t},\n\t\t\tpermissionAction: null,\n\t\t\tdataTestId: 'hr-company-structure_menu__add-department-item',\n\t\t});\n\n\t\tthis.entityType = entityType;\n\t\tthis.permissionChecker = permissionChecker;\n\t\tthis.entityType = entityType;\n\t}\n\n\tinvoke({ entityId, analyticSource, entityType }): void\n\t{\n\t\t// for a team we can create only another team\n\t\tif (entityType === EntityTypes.team)\n\t\t{\n\t\t\tif (!this.permissionChecker.isTeamsAvailable)\n\t\t\t{\n\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\tcontent: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_TEAMS_DISABLED_ERROR_MSGVER_1'),\n\t\t\t\t\tautoHideDelay: 2000,\n\t\t\t\t});\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tEventEmitter.emit(events.HR_ENTITY_SHOW_WIZARD, {\n\t\t\t\tnodeId: entityId,\n\t\t\t\tisEditMode: false,\n\t\t\t\tshowEntitySelector: false,\n\t\t\t\tsource: analyticSource,\n\t\t\t\tentityType,\n\t\t\t});\n\t\t}\n\t\t// for a department we offer to chose entity\n\t\telse\n\t\t{\n\t\t\tEventEmitter.emit(events.HR_ENTITY_SHOW_WIZARD, {\n\t\t\t\tnodeId: entityId,\n\t\t\t\tisEditMode: false,\n\t\t\t\tshowEntitySelector: true,\n\t\t\t\tsource: analyticSource,\n\t\t\t});\n\t\t}\n\t}\n\n\thasPermission(permissionChecker: PermissionCheckerClass, entityId: number): boolean\n\t{\n\t\tif (this.entityType === EntityTypes.team)\n\t\t{\n\t\t\treturn permissionChecker.hasPermission(PermissionActions.teamCreate, entityId);\n\t\t}\n\n\t\treturn permissionChecker.hasPermission(PermissionActions.departmentCreate, entityId)\n\t\t\t|| permissionChecker.hasPermission(PermissionActions.teamCreate, entityId)\n\t\t;\n\t}\n}\n","import type { PermissionCheckerClass } from 'humanresources.company-structure.permission-checker';\nimport { PermissionActions } from 'humanresources.company-structure.permission-checker';\nimport { EntityTypes, getColorCode } from 'humanresources.company-structure.utils';\nimport { Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Main } from 'ui.icon-set.api.core';\nimport { events } from '../../../../consts';\nimport { AbstractMenuItem } from '../abstract-menu-item';\nimport { MenuActions } from '../../menu-actions';\n\nexport class EditDepartmentMenuItem extends AbstractMenuItem\n{\n\tentityType: null;\n\n\tconstructor(entityType: string)\n\t{\n\t\tconst title = entityType === EntityTypes.team\n\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_EDIT_TEAM_TITLE')\n\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_EDIT_DEPARTMENT_TITLE');\n\n\t\tconst description = entityType === EntityTypes.team\n\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_EDIT_TEAM_SUBTITLE_MSGVER_1')\n\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_EDIT_DEPARTMENT_SUBTITLE_MSGVER_1');\n\n\t\tsuper({\n\t\t\tid: MenuActions.editDepartment,\n\t\t\ttitle,\n\t\t\tdescription,\n\t\t\tbIcon: {\n\t\t\t\tname: Main.EDIT_PENCIL,\n\t\t\t\tsize: 20,\n\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t},\n\t\t\tpermissionAction: null,\n\t\t\tdataTestId: 'hr-company-structure_menu__edit-department-item',\n\t\t});\n\n\t\tthis.entityType = entityType;\n\t}\n\n\tinvoke({ entityId, analyticSource, refToFocus = 'title' }): void\n\t{\n\t\tEventEmitter.emit(events.HR_ENTITY_SHOW_WIZARD, {\n\t\t\tnodeId: entityId,\n\t\t\tisEditMode: true,\n\t\t\tshowEntitySelector: false,\n\t\t\ttype: 'department',\n\t\t\tsource: analyticSource,\n\t\t\trefToFocus,\n\t\t});\n\t}\n\n\thasPermission(permissionChecker: PermissionCheckerClass, entityId: number): boolean\n\t{\n\t\tif (this.entityType === EntityTypes.team)\n\t\t{\n\t\t\treturn permissionChecker.hasPermission(PermissionActions.teamEdit, entityId)\n\t\t\t\t|| permissionChecker.hasPermission(PermissionActions.teamAddMember, entityId)\n\t\t\t\t|| permissionChecker.hasPermission(PermissionActions.teamCommunicationEdit, entityId)\n\t\t\t\t|| permissionChecker.hasPermission(PermissionActions.teamSettingsEdit, entityId)\n\t\t\t;\n\t\t}\n\n\t\treturn permissionChecker.hasPermission(PermissionActions.departmentEdit, entityId)\n\t\t\t|| permissionChecker.hasPermission(PermissionActions.employeeAddToDepartment, entityId)\n\t\t\t|| permissionChecker.hasPermission(PermissionActions.departmentCommunicationEdit, entityId)\n\t\t;\n\t}\n}\n","import { PermissionActions } from 'humanresources.company-structure.permission-checker';\nimport { EntityTypes, getColorCode } from 'humanresources.company-structure.utils';\nimport { Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Main } from 'ui.icon-set.api.core';\nimport { events } from '../../../../consts';\nimport { AbstractMenuItem } from '../abstract-menu-item';\nimport { MenuActions } from '../../menu-actions';\n\nexport class RemoveDepartmentMenuItem extends AbstractMenuItem\n{\n\tconstructor(entityType: string)\n\t{\n\t\tconst title = entityType === EntityTypes.team\n\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_REMOVE_TEAM_TITLE')\n\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_REMOVE_DEPARTMENT_TITLE');\n\n\t\tconst description = entityType === EntityTypes.team\n\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_REMOVE_TEAM_SUBTITLE')\n\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_REMOVE_DEPARTMENT_SUBTITLE');\n\n\t\tconst permissionAction = entityType === EntityTypes.team\n\t\t\t? PermissionActions.teamDelete\n\t\t\t: PermissionActions.departmentDelete\n\t\t;\n\n\t\tsuper({\n\t\t\tid: MenuActions.removeDepartment,\n\t\t\ttitle,\n\t\t\tdescription,\n\t\t\tbIcon: {\n\t\t\t\tname: Main.TRASH_BIN,\n\t\t\t\tsize: 20,\n\t\t\t\tcolor: getColorCode('paletteRed40'),\n\t\t\t},\n\t\t\tpermissionAction,\n\t\t\tdataTestId: 'hr-company-structure_menu__remove-department-item',\n\t\t});\n\t}\n\n\tinvoke({ entityId, entityType }): void\n\t{\n\t\tEventEmitter.emit(events.HR_ENTITY_REMOVE, { nodeId: entityId, entityType });\n\t}\n}\n","import { memberRoles, teamMemberRoles } from 'humanresources.company-structure.api';\nimport { PermissionActions } from 'humanresources.company-structure.permission-checker';\nimport { EntityTypes, getColorCode } from 'humanresources.company-structure.utils';\nimport { Loc } from 'main.core';\nimport { CRM } from 'ui.icon-set.api.core';\nimport { AbstractMenuItem } from '../abstract-menu-item';\nimport { MenuActions } from '../../menu-actions';\nimport { UserManagementDialog } from 'humanresources.company-structure.user-management-dialog';\n\nexport class AddEmployeeMenuItem extends AbstractMenuItem\n{\n\trole: ?string;\n\n\tconstructor(entityType: string, role: ?string)\n\t{\n\t\tconst permissionAction = entityType === EntityTypes.team\n\t\t\t? PermissionActions.teamAddMember\n\t\t\t: PermissionActions.employeeAddToDepartment\n\t\t;\n\n\t\tsuper({\n\t\t\tid: MenuActions.addEmployee,\n\t\t\tbIcon: {\n\t\t\t\tname: CRM.PERSON_PLUS_2,\n\t\t\t\tsize: 20,\n\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t},\n\t\t\tpermissionAction,\n\t\t\tdataTestId: 'hr-company-structure_menu__add-employee-item',\n\t\t});\n\n\t\tthis.localize(entityType, role);\n\t}\n\n\tlocalize(entityType: string, role: ?string): [string, string]\n\t{\n\t\tconst i18nRole = ['head', 'employee'].includes(role) ? role : 'default';\n\t\tconst i18nType = entityType === EntityTypes.team ? 'team' : 'default';\n\n\t\tconst i18nMap = {\n\t\t\thead: {\n\t\t\t\tteam: {\n\t\t\t\t\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_ADD_HEAD_TITLE'),\n\t\t\t\t\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_ADD_TEAM_HEAD_SUBTITLE'),\n\t\t\t\t\trole: teamMemberRoles.head,\n\t\t\t\t},\n\t\t\t\tdefault: {\n\t\t\t\t\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_ADD_HEAD_TITLE'),\n\t\t\t\t\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_ADD_HEAD_SUBTITLE'),\n\t\t\t\t\trole: memberRoles.head,\n\t\t\t\t},\n\t\t\t},\n\t\t\temployee: {\n\t\t\t\tteam: {\n\t\t\t\t\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_ADD_TEAM_EMPLOYEE_TITLE'),\n\t\t\t\t\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_ADD_TEAM_EMPLOYEE_SUBTITLE'),\n\t\t\t\t\trole: teamMemberRoles.employee,\n\t\t\t\t},\n\t\t\t\tdefault: {\n\t\t\t\t\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_ADD_EMPLOYEE_TITLE'),\n\t\t\t\t\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_ADD_EMPLOYEE_SUBTITLE'),\n\t\t\t\t\trole: memberRoles.employee,\n\t\t\t\t},\n\t\t\t},\n\t\t\tdefault: {\n\t\t\t\tteam: {\n\t\t\t\t\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_ADD_TEAM_EMPLOYEE_TITLE'),\n\t\t\t\t\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_ADD_TEAM_EMPLOYEE_SUBTITLE'),\n\t\t\t\t\trole: null,\n\t\t\t\t},\n\t\t\t\tdefault: {\n\t\t\t\t\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_ADD_EMPLOYEE_TITLE'),\n\t\t\t\t\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_ADD_EMPLOYEE_SUBTITLE'),\n\t\t\t\t\trole: null,\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\n\t\tthis.title = i18nMap[i18nRole][i18nType].title;\n\t\tthis.description = i18nMap[i18nRole][i18nType].description;\n\t\tthis.role = i18nMap[i18nRole][i18nType].role;\n\t}\n\n\tinvoke({ entityId, entityType }): void\n\t{\n\t\tUserManagementDialog.openDialog({\n\t\t\tnodeId: entityId,\n\t\t\ttype: 'add',\n\t\t\trole: this.role,\n\t\t\tentityType,\n\t\t});\n\t}\n}\n","import { PermissionActions } from 'humanresources.company-structure.permission-checker';\nimport { EntityTypes, getColorCode } from 'humanresources.company-structure.utils';\nimport { Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Main } from 'ui.icon-set.api.core';\nimport { events } from '../../../../consts';\nimport { AbstractMenuItem } from '../abstract-menu-item';\nimport { MenuActions } from '../../menu-actions';\n\nexport class EditEmployeesMenuItem extends AbstractMenuItem\n{\n\trole: ?string;\n\n\tconstructor(entityType: string, role: ?string)\n\t{\n\t\tconst permissionAction = entityType === EntityTypes.team\n\t\t\t? PermissionActions.teamAddMember\n\t\t\t: PermissionActions.employeeAddToDepartment\n\t\t;\n\n\t\tsuper({\n\t\t\tid: MenuActions.editEmployee,\n\t\t\timageClass: '-hr-department-org-chart-menu-edit-list',\n\t\t\tbIcon: {\n\t\t\t\tname: Main.EDIT_MENU,\n\t\t\t\tsize: 20,\n\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t},\n\t\t\tpermissionAction,\n\t\t\tdataTestId: 'hr-company-structure_menu__edit-employee-item',\n\t\t});\n\n\t\tthis.localize(entityType, role);\n\t}\n\n\tlocalize(entityType: string, role: ?string): [string, string]\n\t{\n\t\tconst i18nRole = ['head', 'employee'].includes(role) ? role : 'default';\n\t\tconst i18nType = entityType === EntityTypes.team ? 'team' : 'default';\n\n\t\tconst i18nMap = {\n\t\t\thead: {\n\t\t\t\tteam: {\n\t\t\t\t\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_EDIT_TEAM_HEAD_TITLE'),\n\t\t\t\t\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_EDIT_TEAM_HEAD_SUBTITLE'),\n\t\t\t\t},\n\t\t\t\tdefault: {\n\t\t\t\t\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_EDIT_HEAD_TITLE'),\n\t\t\t\t\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_EDIT_HEAD_SUBTITLE'),\n\t\t\t\t},\n\t\t\t},\n\t\t\temployee: {\n\t\t\t\tteam: {\n\t\t\t\t\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_EDIT_TEAM_EMPLOYEE_TITLE'),\n\t\t\t\t\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_EDIT_TEAM_EMPLOYEE_SUBTITLE'),\n\t\t\t\t},\n\t\t\t\tdefault: {\n\t\t\t\t\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_EDIT_EMPLOYEE_TITLE'),\n\t\t\t\t\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_EDIT_TEAM_EMPLOYEE_SUBTITLE'),\n\t\t\t\t},\n\t\t\t},\n\t\t\tdefault: {\n\t\t\t\tteam: {\n\t\t\t\t\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_EDIT_TEAM_EMPLOYEE_LIST_TITLE'),\n\t\t\t\t\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_EDIT_TEAM_EMPLOYEE_LIST_SUBTITLE'),\n\t\t\t\t},\n\t\t\t\tdefault: {\n\t\t\t\t\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_EDIT_EMPLOYEE_LIST_TITLE'),\n\t\t\t\t\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_EDIT_EMPLOYEE_LIST_SUBTITLE'),\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\n\t\tthis.title = i18nMap[i18nRole][i18nType].title;\n\t\tthis.description = i18nMap[i18nRole][i18nType].description;\n\t}\n\n\tinvoke({ entityId, analyticSource }): void\n\t{\n\t\tEventEmitter.emit(events.HR_ENTITY_SHOW_WIZARD, {\n\t\t\tnodeId: entityId,\n\t\t\tisEditMode: true,\n\t\t\tshowEntitySelector: false,\n\t\t\ttype: 'employees',\n\t\t\tsource: analyticSource,\n\t\t});\n\t}\n}\n","import type { PermissionCheckerClass } from 'humanresources.company-structure.permission-checker';\nimport { PermissionActions } from 'humanresources.company-structure.permission-checker';\nimport { getColorCode } from 'humanresources.company-structure.utils';\nimport { Loc } from 'main.core';\nimport { Main } from 'ui.icon-set.api.core';\nimport { AbstractMenuItem } from '../abstract-menu-item';\nimport { MenuActions } from '../../menu-actions';\nimport { UserManagementDialog } from 'humanresources.company-structure.user-management-dialog';\n\nexport class MoveEmployeeMenuItem extends AbstractMenuItem\n{\n\tconstructor()\n\t{\n\t\tsuper({\n\t\t\tid: MenuActions.moveEmployee,\n\t\t\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_MOVE_EMPLOYEE_TITLE'),\n\t\t\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_MOVE_EMPLOYEE_SUBTITLE'),\n\t\t\tbIcon: {\n\t\t\t\tname: Main.PERSON_ARROW_LEFT_1,\n\t\t\t\tsize: 20,\n\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t},\n\t\t\tpermissionAction: PermissionActions.employeeAddToDepartment,\n\t\t\tdataTestId: 'hr-company-structure_menu__move-employee-item',\n\t\t});\n\t}\n\n\tinvoke({ entityId, analyticSource }): void\n\t{\n\t\tUserManagementDialog.openDialog({\n\t\t\tnodeId: entityId,\n\t\t\ttype: 'move',\n\t\t});\n\t}\n\n\thasPermission(permissionChecker: PermissionCheckerClass, entityId: number): boolean\n\t{\n\t\treturn permissionChecker.currentUserPermissions.ACTION_EMPLOYEE_REMOVE_FROM_DEPARTMENT\n\t\t\t&& permissionChecker.hasPermission(this.permissionAction, entityId)\n\t\t;\n\t}\n}\n","import { PermissionActions } from 'humanresources.company-structure.permission-checker';\nimport { getColorCode } from 'humanresources.company-structure.utils';\nimport { Loc } from 'main.core';\nimport { Main } from 'ui.icon-set.api.core';\nimport { AbstractMenuItem } from '../abstract-menu-item';\nimport { MenuActions } from '../../menu-actions';\n\nexport class UserInviteMenuItem extends AbstractMenuItem\n{\n\tconstructor()\n\t{\n\t\tsuper({\n\t\t\tid: MenuActions.userInvite,\n\t\t\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_USER_INVITE_TITLE'),\n\t\t\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_USER_INVITE_SUBTITLE'),\n\t\t\tbIcon: {\n\t\t\t\tname: Main.PERSON_LETTER,\n\t\t\t\tsize: 20,\n\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t},\n\t\t\tpermissionAction: PermissionActions.inviteToDepartment,\n\t\t\tdataTestId: 'hr-company-structure_menu__user-invite-item',\n\t\t});\n\t}\n\n\tinvoke({ entityId }): void\n\t{\n\t\tBX.SidePanel.Instance.open(\n\t\t\t'/bitrix/services/main/ajax.php?action=getSliderContent'\n\t\t\t+ '&c=bitrix%3Aintranet.invitation&mode=ajax'\n\t\t\t+ `&departments[]=${Number(entityId)}&firstInvitationBlock=invite-with-group-dp`,\n\t\t\t{ cacheable: false, allowChangeHistory: false, width: 1100 },\n\t\t);\n\t}\n}\n","import { EntityTypes } from 'humanresources.company-structure.utils';\nimport { AbstractActionMenu } from '../abstract-action-menu';\nimport { AddDepartmentMenuItem } from '../items/department/add-department-menu-item';\nimport { EditDepartmentMenuItem } from '../items/department/edit-department-menu-item';\nimport { RemoveDepartmentMenuItem } from '../items/department/remove-department-menu-item';\nimport { TeamRightsMenuItem } from '../items/department/team-rights-menu-item';\nimport { AddEmployeeMenuItem } from '../items/employees/add-employee-menu-item';\nimport { EditEmployeesMenuItem } from '../items/department/edit-employees-menu-item';\nimport { MoveEmployeeMenuItem } from '../items/employees/move-employee-menu-item';\nimport { UserInviteMenuItem } from '../items/employees/user-invite-menu-item';\n\nexport class EntityActionMenu extends AbstractActionMenu\n{\n\tconstructor(entityId: number, entityType: string, analyticSource: string)\n\t{\n\t\tsuper(entityId);\n\t\tthis.entityType = entityType;\n\t\tthis.analyticSource = analyticSource;\n\t\tthis.items = this.getFilteredItems();\n\t}\n\n\tgetItems(): Array\n\t{\n\t\tif (this.entityType === EntityTypes.team)\n\t\t{\n\t\t\treturn [\n\t\t\t\tnew EditDepartmentMenuItem(this.entityType),\n\t\t\t\tnew AddDepartmentMenuItem(this.entityType),\n\t\t\t\tnew AddEmployeeMenuItem(this.entityType),\n\t\t\t\tnew RemoveDepartmentMenuItem(this.entityType),\n\t\t\t];\n\t\t}\n\n\t\treturn [\n\t\t\tnew EditDepartmentMenuItem(this.entityType),\n\t\t\tnew AddDepartmentMenuItem(this.entityType),\n\t\t\tnew AddEmployeeMenuItem(this.entityType),\n\t\t\tnew MoveEmployeeMenuItem(),\n\t\t\tnew UserInviteMenuItem(),\n\t\t\tnew RemoveDepartmentMenuItem(this.entityType),\n\t\t];\n\t}\n}\n","import { AnalyticsSourceType } from 'humanresources.company-structure.api';\nimport { EventEmitter } from 'main.core.events';\nimport { RouteActionMenu } from 'humanresources.company-structure.structure-components';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\nimport 'ui.icon-set.main';\nimport { events } from '../../../consts';\nimport { EntityActionMenu } from '../../menu/menu/entity-action-menu';\n\n// @vue/component\nexport const DepartmentMenuButton = {\n\tname: 'DepartmentMenuButton',\n\n\tcomponents: {\n\t\tRouteActionMenu,\n\t},\n\n\tprops: {\n\t\tentityId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tentityType: {\n\t\t\ttype: String,\n\t\t\tdefault: EntityTypes.department,\n\t\t},\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tmenuVisible: false,\n\t\t};\n\t},\n\n\tcomputed: {\n\t\tmenu(): EntityActionMenu\n\t\t{\n\t\t\treturn new EntityActionMenu(this.entityId, this.entityType, AnalyticsSourceType.DETAIL);\n\t\t},\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tonActionMenuItemClick(actionId: string): void\n\t\t{\n\t\t\tthis.menu.onActionMenuItemClick(actionId);\n\t\t},\n\t\tcloseMenu(): void\n\t\t{\n\t\t\tif (this.menuVisible)\n\t\t\t{\n\t\t\t\tthis.menuVisible = false;\n\t\t\t\tEventEmitter.unsubscribe(events.HR_DEPARTMENT_MENU_CLOSE, this.closeMenu);\n\t\t\t\tEventEmitter.unsubscribe(events.HR_DRAG_ENTITY, this.closeMenu);\n\t\t\t}\n\t\t},\n\t\topenMenu(): void\n\t\t{\n\t\t\tif (!this.menuVisible)\n\t\t\t{\n\t\t\t\tthis.menuVisible = true;\n\t\t\t\tEventEmitter.subscribe(events.HR_DEPARTMENT_MENU_CLOSE, this.closeMenu);\n\t\t\t\tEventEmitter.subscribe(events.HR_DRAG_ENTITY, this.closeMenu);\n\t\t\t}\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tv-if=\"menu.items.length\"\n\t\t\tclass=\"ui-icon-set --more humanresources-tree__node_department-menu-button\"\n\t\t\t:class=\"{ '--focused': this.menuVisible }\"\n\t\t\tref=\"departmentMenuButton\"\n\t\t\tdata-test-id=\"tree-node-more-button\"\n\t\t\t@click.stop=\"openMenu\"\n\t\t>\n\t\t</div>\n\n\t\t<RouteActionMenu\n\t\t\tv-if=\"menuVisible\"\n\t\t\t:id=\"'tree-node-department-menu-' + entityId\"\n\t\t\t:width=\"302\"\n\t\t\t:items=\"menu.items\"\n\t\t\t:bindElement=\"this.$refs.departmentMenuButton\"\n\t\t\t@action=\"onActionMenuItemClick\"\n\t\t\t@close=\"closeMenu\"\n\t\t/>\n\t`,\n};\n","import { AnalyticsSourceType } from 'humanresources.company-structure.api';\nimport { PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport { BasePopup } from 'humanresources.company-structure.structure-components';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\nimport { EventEmitter } from 'main.core.events';\nimport type { PopupOptions } from 'main.popup';\nimport { events } from '../../../consts';\nimport { EditDepartmentMenuItem } from '../../menu/items/department/edit-department-menu-item';\n\n// @vue/component\nexport const DepartmentInfoIconButton = {\n\tname: 'DepartmentInfoIconButton',\n\n\tcomponents: {\n\t\tBasePopup,\n\t},\n\n\tprops: {\n\t\tentityId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tcanvasZoom: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tdescription: {\n\t\t\ttype: [String, null],\n\t\t\tdefault: null,\n\t\t},\n\t},\n\n\tdata(): { showPopup: boolean }\n\t{\n\t\treturn {\n\t\t\tshowPopup: false,\n\t\t};\n\t},\n\n\tcomputed:\n\t{\n\t\tpopupConfig(): PopupOptions\n\t\t{\n\t\t\tconst popupWidth = 340;\n\t\t\tconst buttonWidth = 22 * this.canvasZoom;\n\t\t\tconst initialPopupOffset = 41 - this.canvasZoom; // subtract 1px * zoom\n\t\t\tconst angleWidth = 33;\n\n\t\t\treturn {\n\t\t\t\twidth: popupWidth,\n\t\t\t\tbindElement: this.$refs.departmentMenuButton,\n\t\t\t\tbindOptions: { position: 'top' },\n\t\t\t\tborderRadius: '12px',\n\t\t\t\tcontentNoPaddings: true,\n\t\t\t\tcontentPadding: 0,\n\t\t\t\tpadding: 16,\n\t\t\t\toffsetTop: -2 * this.canvasZoom,\n\t\t\t\toffsetLeft: buttonWidth / 2 - popupWidth / 2 + initialPopupOffset,\n\t\t\t\tangleOffset: popupWidth / 2 - angleWidth / 2,\n\t\t\t};\n\t\t},\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.menuItem = new EditDepartmentMenuItem(EntityTypes.team);\n\t\tconst permissionChecker = PermissionChecker.getInstance();\n\n\t\tthis.canEdit = this.menuItem.hasPermission(permissionChecker, this.entityId);\n\t},\n\n\tmethods:\n\t{\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tonClose(): void\n\t\t{\n\t\t\tif (this.showPopup)\n\t\t\t{\n\t\t\t\tthis.showPopup = false;\n\t\t\t\tEventEmitter.unsubscribe(events.HR_DEPARTMENT_MENU_CLOSE, this.onClose);\n\t\t\t\tEventEmitter.unsubscribe(events.HR_DRAG_ENTITY, this.onClose);\n\t\t\t}\n\t\t},\n\t\tonOpen(): void\n\t\t{\n\t\t\tif (!this.showPopup)\n\t\t\t{\n\t\t\t\tthis.showPopup = true;\n\t\t\t\tEventEmitter.subscribe(events.HR_DEPARTMENT_MENU_CLOSE, this.onClose);\n\t\t\t\tEventEmitter.subscribe(events.HR_DRAG_ENTITY, this.onClose);\n\t\t\t}\n\t\t},\n\t\taddDescription(): void\n\t\t{\n\t\t\tthis.onClose();\n\t\t\tthis.menuItem.invoke({\n\t\t\t\tentityId: this.entityId,\n\t\t\t\tanalyticSource: AnalyticsSourceType.CARD,\n\t\t\t\trefToFocus: 'description',\n\t\t\t});\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tv-if=\"canEdit || description\"\n\t\t\tclass=\"ui-icon-set --info-1 humanresources-tree__node_department-menu-button\"\n\t\t\t:class=\"{ '--focused': this.showPopup }\"\n\t\t\tref=\"departmentMenuButton\"\n\t\t\t@click.stop=\"onOpen\"\n\t\t\tdata-test-id=\"tree-node-info-button\"\n\t\t>\n\t\t</div>\n\t\t<BasePopup\n\t\t\tv-if=\"showPopup\"\n\t\t\t:config=\"popupConfig\"\n\t\t\t:id=\"'humanresources-tree__node_info-popup' + entityId\"\n\t\t\t@close=\"onClose\"\n\t\t>\n\t\t\t<div class=\"humanresources-tree__node_info-popup-content_description\" v-if=\"description\">\n\t\t\t\t{{ description }}\n\t\t\t</div>\n\t\t\t<div v-else class=\"humanresources-tree__node_info-popup-content\">\n\t\t\t\t<div class=\"humanresources-tree__node_info-popup-content_left\"></div>\n\t\t\t\t<div class=\"humanresources-tree__node_info-popup-content_right\">\n\t\t\t\t\t<div class=\"humanresources-tree__node_info-popup-content_right_title\">\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_INFO_POPUP_ADD_DESCRIPTION_TITLE') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"humanresources-tree__node_info-popup-content_right_text\">\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_INFO_POPUP_ADD_DESCRIPTION_TEXT') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"ui-btn ui-btn-primary ui-btn-round ui-btn-xs ui-btn-no-caps\"\n\t\t\t\t\t\tdata-test-id=\"tree-node-info-popup_add-button\"\n\t\t\t\t\t\t@click=\"addDescription\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_INFO_POPUP_ADD_DESCRIPTION_BUTTON') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</BasePopup>\n\t`,\n};\n","import { AnalyticsSourceType } from 'humanresources.company-structure.api';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\nimport { BIcon, Set } from 'ui.icon-set.api.vue';\nimport 'ui.icon-set.main';\nimport { PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport { AddDepartmentMenuItem } from '../../menu/items/department/add-department-menu-item';\n\n// @vue/component\nexport const SubdivisionAddButton = {\n\tname: 'SubdivisionAddButton',\n\n\tcomponents: {\n\t\tBIcon,\n\t},\n\n\tprops: {\n\t\tentityId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tentityType: {\n\t\t\ttype: String,\n\t\t\tdefault: EntityTypes.department,\n\t\t},\n\t},\n\n\tcomputed:\n\t{\n\t\tset(): Set\n\t\t{\n\t\t\treturn Set;\n\t\t},\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.menuItem = new AddDepartmentMenuItem(this.entityType);\n\t\tconst permissionChecker = PermissionChecker.getInstance();\n\n\t\tthis.canShow = this.menuItem.hasPermission(permissionChecker, this.entityId);\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\taddSubdivision(): void\n\t\t{\n\t\t\tthis.menuItem.invoke({\n\t\t\t\tentityId: this.entityId,\n\t\t\t\tanalyticSource: AnalyticsSourceType.PLUS,\n\t\t\t\tentityType: this.entityType,\n\t\t\t});\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"humanresources-tree__node_add-subdivision\" v-if=\"canShow\">\n\t\t  <button class=\"humanresources-tree__node_add-button\" @click=\"addSubdivision\">\n\t\t    <BIcon :name=\"set.PLUS_20\" :size=\"32\" class=\"humanresources-tree__node_add-icon\"></BIcon>\n\t\t  </button>\n\t\t</div>\n\t`,\n};\n","import { Dom, Loc } from 'main.core';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { mapState } from 'ui.vue3.pinia';\nimport { getMemberRoles, type MemberRolesType } from 'humanresources.company-structure.api';\nimport { Hint } from 'humanresources.company-structure.structure-components';\nimport { EventEmitter } from 'main.core.events';\nimport { events } from '../../../consts';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\nimport { HeadList } from './head-list';\nimport { DepartmentMenuButton } from './department-menu-button';\nimport { DepartmentInfoIconButton } from './department-info-icon-button';\nimport { SubdivisionAddButton } from './subdivision-add-button';\nimport { PermissionActions, PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport type { MountedDepartment, TreeItem, TreeNodeData } from '../../../types';\nimport './style.css';\n\n// @vue/component\nexport const TreeNode = {\n\tname: 'treeNode',\n\n\tcomponents: {\n\t\tDepartmentMenuButton,\n\t\tHeadList,\n\t\tSubdivisionAddButton,\n\t\tDepartmentInfoIconButton,\n\t},\n\n\tdirectives: { hint: Hint },\n\n\tinject: ['getTreeBounds'],\n\n\tprops: {\n\t\tnodeId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\texpandedNodes: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tcanvasZoom: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tcurrentDepartments: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tisShown: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t\tdefault: true,\n\t\t},\n\t},\n\n\temits: ['calculatePosition'],\n\n\tdata(): TreeNodeData\n\t{\n\t\treturn {\n\t\t\tchildrenOffset: 0,\n\t\t\tchildrenMounted: false,\n\t\t\tshowInfo: true,\n\t\t\tshowDnd: true,\n\t\t};\n\t},\n\n\tcomputed:\n\t{\n\t\tmemberRoles(): MemberRolesType\n\t\t{\n\t\t\treturn getMemberRoles(this.nodeData.entityType);\n\t\t},\n\t\tnodeData(): TreeItem\n\t\t{\n\t\t\treturn this.departments.get(this.nodeId);\n\t\t},\n\t\tnodeClass(): { [key: string]: boolean; }\n\t\t{\n\t\t\treturn {\n\t\t\t\t'--expanded': this.expandedNodes.includes(this.nodeId),\n\t\t\t\t'--current-department': this.isCurrentDepartment,\n\t\t\t\t'--focused': this.focusedNode === this.nodeId,\n\t\t\t\t'--with-restricted-access-rights': !this.showInfo,\n\t\t\t\t'--team': this.isTeamEntity,\n\t\t\t};\n\t\t},\n\t\tsubdivisionsClass(): { [key: string]: boolean; }\n\t\t{\n\t\t\treturn {\n\t\t\t\t'humanresources-tree__node_arrow': this.hasChildren,\n\t\t\t\t'--up': this.hasChildren && this.isExpanded,\n\t\t\t\t'--down': this.hasChildren && !this.isExpanded,\n\t\t\t\t'--transparent': !this.hasChildren,\n\t\t\t};\n\t\t},\n\t\thasChildren(): boolean\n\t\t{\n\t\t\treturn this.nodeData.children?.length > 0;\n\t\t},\n\t\tisExpanded(): boolean\n\t\t{\n\t\t\treturn this.expandedNodes.includes(this.nodeId);\n\t\t},\n\t\tisCurrentDepartment(): Boolean\n\t\t{\n\t\t\treturn this.currentDepartments.includes(this.nodeId);\n\t\t},\n\t\thead(): ?TreeItem['heads']\n\t\t{\n\t\t\treturn this.nodeData.heads?.filter((head) => {\n\t\t\t\treturn head.role === this.memberRoles.head;\n\t\t\t});\n\t\t},\n\t\tdeputy(): ?TreeItem['heads']\n\t\t{\n\t\t\treturn this.nodeData.heads?.filter((head) => {\n\t\t\t\treturn head.role === this.memberRoles.deputyHead;\n\t\t\t});\n\t\t},\n\t\temployeeCount(): number\n\t\t{\n\t\t\treturn this.nodeData.userCount - this.nodeData.heads.length;\n\t\t},\n\t\tchildNodeStyle(): { left: String; }\n\t\t{\n\t\t\treturn { left: `${this.childrenOffset}px` };\n\t\t},\n\t\tshowSubdivisionAddButton(): boolean\n\t\t{\n\t\t\treturn this.expandedNodes.includes(this.nodeId) || this.focusedNode === this.nodeId;\n\t\t},\n\t\tisTeamEntity(): boolean\n\t\t{\n\t\t\treturn this.nodeData.entityType === EntityTypes.team;\n\t\t},\n\t\tnodeDataTitle(): ?string\n\t\t{\n\t\t\tif (!this.isCurrentDepartment)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_CURRENT_TEAM')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_CURRENT_DEPARTMENT');\n\t\t},\n\t\tsubdivisionsText(): string\n\t\t{\n\t\t\tif (this.isTeamEntity)\n\t\t\t{\n\t\t\t\treturn this.nodeData.children?.length\n\t\t\t\t\t? this.locPlural('HUMANRESOURCES_COMPANY_TEAM_CHILDREN_COUNT', this.nodeData.children.length)\n\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_TREE_TEAM_NO_SUBDEPARTMENTS');\n\t\t\t}\n\n\t\t\tif (!(this.nodeData.children?.length))\n\t\t\t{\n\t\t\t\treturn this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_TREE_NO_SUBDEPARTMENTS');\n\t\t\t}\n\n\t\t\tconst childDepartmentsCount = [...this.departments.values()].filter((department) => {\n\t\t\t\treturn department.entityType === EntityTypes.department && this.nodeData.children.includes(department.id);\n\t\t\t}).length;\n\n\t\t\tconst childTeamsCount = [...this.departments.values()].filter((department) => {\n\t\t\t\treturn department.entityType === EntityTypes.team && this.nodeData.children.includes(department.id);\n\t\t\t}).length;\n\n\t\t\tif ((childTeamsCount > 0) && (childDepartmentsCount > 0))\n\t\t\t{\n\t\t\t\treturn this.loc('HUMANRESOURCES_COMPANY_DEPARTMENT_CHILDREN_COUNT_WITH_CONJUNCTION', {\n\t\t\t\t\t'#DEPT_COUNT#': this.locPlural('HUMANRESOURCES_COMPANY_DEPARTMENT_CHILDREN_COUNT', childDepartmentsCount),\n\t\t\t\t\t'#TEAM_COUNT#': this.locPlural('HUMANRESOURCES_COMPANY_TEAM_CHILDREN_COUNT', childTeamsCount),\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (childDepartmentsCount > 0)\n\t\t\t{\n\t\t\t\treturn this.locPlural('HUMANRESOURCES_COMPANY_DEPARTMENT_CHILDREN_COUNT', childDepartmentsCount);\n\t\t\t}\n\n\t\t\tif (childTeamsCount > 0)\n\t\t\t{\n\t\t\t\treturn this.locPlural('HUMANRESOURCES_COMPANY_TEAM_CHILDREN_COUNT', childTeamsCount);\n\t\t\t}\n\n\t\t\treturn this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_TREE_NO_SUBDEPARTMENTS');\n\t\t},\n\t\t...mapState(useChartStore, ['departments', 'focusedNode']),\n\t},\n\n\twatch:\n\t{\n\t\thead(): void\n\t\t{\n\t\t\tthis.adaptHeight();\n\t\t},\n\t\tisShown(): void\n\t\t{\n\t\t\tthis.adaptHeight();\n\t\t},\n\t\tisExpanded:\n\t\t{\n\t\t\thandler(isExpanded: boolean): void\n\t\t\t{\n\t\t\t\tif (isExpanded && !this.childrenMounted)\n\t\t\t\t{\n\t\t\t\t\tthis.childrenMounted = true;\n\t\t\t\t}\n\t\t\t},\n\t\t\timmediate: true,\n\t\t},\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.width = 278;\n\t\tthis.gap = 24;\n\t\tthis.prevChildrenOffset = 0;\n\t\tthis.prevHeight = 0;\n\t},\n\n\tasync mounted(): Promise<void>\n\t{\n\t\tlet editAction = '';\n\t\tlet viewAction = '';\n\t\tif (this.isTeamEntity)\n\t\t{\n\t\t\tviewAction = PermissionActions.teamView;\n\t\t\teditAction = PermissionActions.teamEdit;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tviewAction = PermissionActions.structureView;\n\t\t\teditAction = PermissionActions.departmentEdit;\n\t\t}\n\n\t\tconst permissionChecker = PermissionChecker.getInstance();\n\t\tthis.showInfo = permissionChecker.hasPermission(viewAction, this.nodeId);\n\t\tthis.showDnd =\tpermissionChecker.hasPermission(editAction, this.nodeId)\n\t\t\t&& permissionChecker.hasPermission(editAction, this.nodeData.parentId);\n\n\t\tthis.$emit('calculatePosition', this.nodeId);\n\t\tawait this.$nextTick();\n\t\tthis.prevHeight = this.$el.offsetHeight;\n\t\tEventEmitter.emit(events.HR_DEPARTMENT_CONNECT, {\n\t\t\tid: this.nodeId,\n\t\t\tparentId: this.nodeData.parentId,\n\t\t\thtml: this.$el,\n\t\t\tparentsPath: this.getParentsPath(this.nodeData.parentId),\n\t\t\t...this.calculateNodePoints(),\n\t\t});\n\t},\n\tunmounted(): void\n\t{\n\t\tDom.remove(this.$el);\n\t\tconst { prevParentId } = this.nodeData;\n\t\tif (!prevParentId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.$emit('calculatePosition', this.nodeId);\n\t\tEventEmitter.emit(events.HR_DEPARTMENT_DISCONNECT, {\n\t\t\tid: this.nodeId,\n\t\t\tparentId: prevParentId,\n\t\t});\n\t},\n\n\tmethods:\n\t{\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tonDepartmentClick(targetId: string): void\n\t\t{\n\t\t\tif (!this.showInfo)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tEventEmitter.emit(events.HR_DEPARTMENT_FOCUS, {\n\t\t\t\tnodeId: this.nodeId,\n\t\t\t\tshowEmployees: targetId === 'employees',\n\t\t\t\tsubdivisionsSelected: targetId === 'subdivisions',\n\t\t\t});\n\t\t},\n\t\tcalculatePosition(nodeId: number): void\n\t\t{\n\t\t\tconst node = this.departments.get(this.nodeId);\n\n\t\t\tif (node.children.length === 0)\n\t\t\t{\n\t\t\t\tthis.childrenOffset = 0;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst gap = this.gap * (node.children.length - 1);\n\t\t\t\tthis.prevChildrenOffset = this.childrenOffset;\n\t\t\t\tthis.childrenOffset = (this.width - (this.width * node.children.length + gap)) / 2;\n\t\t\t}\n\n\t\t\tconst offset = this.childrenOffset - this.prevChildrenOffset;\n\t\t\tif (offset !== 0)\n\t\t\t{\n\t\t\t\tEventEmitter.emit(events.HR_DEPARTMENT_ADAPT_SIBLINGS, {\n\t\t\t\t\tparentId: this.nodeId,\n\t\t\t\t\tnodeId,\n\t\t\t\t\toffset,\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tlocPlural(phraseCode: string, count: number): string\n\t\t{\n\t\t\treturn Loc.getMessagePlural(phraseCode, count, { '#COUNT#': count });\n\t\t},\n\t\tcalculateNodePoints(): { startPoint: MountedDepartment['startPoint'], endPoint: MountedDepartment['endPoint'] }\n\t\t{\n\t\t\tconst { left, top, width } = this.$el.getBoundingClientRect();\n\t\t\tconst { $el: parentNode } = this.$parent.$parent;\n\t\t\tconst {\n\t\t\t\tleft: parentLeft,\n\t\t\t\ttop: parentTop,\n\t\t\t\twidth: parentWidth,\n\t\t\t\theight: parentHeight,\n\t\t\t} = parentNode.getBoundingClientRect();\n\t\t\tconst { x: chartX, y: chartY } = this.getTreeBounds();\n\n\t\t\treturn {\n\t\t\t\tstartPoint: {\n\t\t\t\t\tx: (parentLeft - chartX + parentWidth / 2) / this.canvasZoom,\n\t\t\t\t\ty: (parentTop - chartY + parentHeight) / this.canvasZoom,\n\t\t\t\t},\n\t\t\t\tendPoint: {\n\t\t\t\t\tx: (left - chartX + width / 2) / this.canvasZoom,\n\t\t\t\t\ty: (top - chartY) / this.canvasZoom,\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\tgetParentsPath(parentId: number): Array<number>\n\t\t{\n\t\t\tlet topLevelId = parentId;\n\t\t\tconst parentsPath = [parentId];\n\t\t\twhile (topLevelId)\n\t\t\t{\n\t\t\t\tconst parentNode = this.departments.get(topLevelId);\n\t\t\t\ttopLevelId = parentNode.parentId;\n\t\t\t\tif (topLevelId)\n\t\t\t\t{\n\t\t\t\t\tparentsPath.push(topLevelId);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn parentsPath;\n\t\t},\n\t\tasync adaptHeight(): Promise<void>\n\t\t{\n\t\t\tif (!this.isShown)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait this.$nextTick();\n\t\t\tconst shift = this.$el.offsetHeight - this.prevHeight;\n\t\t\tif (shift !== 0)\n\t\t\t{\n\t\t\t\tEventEmitter.emit(events.HR_DEPARTMENT_ADAPT_CONNECTOR_HEIGHT, {\n\t\t\t\t\tnodeId: this.nodeId,\n\t\t\t\t\tshift,\n\t\t\t\t});\n\t\t\t\tthis.prevHeight = this.$el.offsetHeight;\n\t\t\t}\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\t:data-id=\"nodeId\"\n\t\t\t:class=\"nodeClass\"\n\t\t\t:data-title=\"nodeDataTitle\"\n\t\t\tclass=\"humanresources-tree__node\"\n\t\t\t:style=\"{\n\t\t\t\t'--team-bubble-background': nodeData.teamColor?.bubbleBackground,\n\t\t\t\t'--team-focused-border-color': nodeData.teamColor?.focusedBorderColor,\n\t\t\t\t'--node-expanded-color': nodeData.teamColor?.expandedBorderColor,\n\t\t\t}\"\n\t\t>\n\t\t\t<div\n\t\t\t\tclass=\"humanresources-tree__node_summary\"\n\t\t\t\t@click.stop=\"onDepartmentClick('department')\"\n\t\t\t>\n\t\t\t\t<template v-if=\"showInfo\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"humanresources-tree__node_department\"\n\t\t\t\t\t\t:style=\"{ 'background-color': nodeData.teamColor?.treeHeadBackground}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"humanresources-tree__node_department-title\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tv-if=\"nodeData.parentId !== 0 && showDnd\"\n\t\t\t\t\t\t\t\tclass=\"humanresources-tree__node_dnd-icon ui-icon-set --more-points\"\n\t\t\t\t\t\t\t\t:class=\"{ '--team': isTeamEntity }\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\tv-hint\n\t\t\t\t\t\t\t\tclass=\"humanresources-tree__node_department-title_text\"\n\t\t\t\t\t\t\t\t:class=\"{ '--no-dnd': !showDnd }\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{{nodeData.name}}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"humanresources-tree__node_department-menu-icons\">\n\t\t\t\t\t\t\t<DepartmentInfoIconButton\n\t\t\t\t\t\t\t\tv-if=\"isTeamEntity\"\n\t\t\t\t\t\t\t\t:description=\"nodeData.description\"\n\t\t\t\t\t\t\t\t:entityId=\"nodeId\"\n\t\t\t\t\t\t\t\t:canvasZoom=\"canvasZoom\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<DepartmentMenuButton\n\t\t\t\t\t\t\t\tv-if=\"head && deputy\"\n\t\t\t\t\t\t\t\t:entityId=\"nodeId\"\n\t\t\t\t\t\t\t\t:entityType=\"nodeData.entityType\"\n\t\t\t\t\t\t\t></DepartmentMenuButton>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"humanresources-tree__node_description\">\n\t\t\t\t\t\t<HeadList v-if=\"head\" :items=\"head\" :isTeamEntity=\"isTeamEntity\"></HeadList>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-else\n\t\t\t\t\t\t\tclass=\"humanresources-tree__node_load-skeleton --heads\"\n\t\t\t\t\t\t></div>\n\t\t\t\t\t\t<div v-if=\"deputy\" class=\"humanresources-tree__node_employees\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<p class=\"humanresources-tree__node_employees-title\">\n\t\t\t\t\t\t\t\t\t{{\n\t\t\t\t\t\t\t\t\t\tisTeamEntity\n\t\t\t\t\t\t\t\t\t\t\t? loc('HUMANRESOURCES_COMPANY_STRUCTURE_TREE_TEAM_EMPLOYEES_TITLE')\n\t\t\t\t\t\t\t\t\t\t\t: loc('HUMANRESOURCES_COMPANY_STRUCTURE_TREE_EMPLOYEES_TITLE')\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\tclass=\"humanresources-tree__node_employees-count\"\n\t\t\t\t\t\t\t\t\t@click.stop=\"onDepartmentClick('employees')\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{{locPlural('HUMANRESOURCES_COMPANY_STRUCTURE_TREE_EMPLOYEES_COUNT', employeeCount)}}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div v-if=\"!deputy.length\"></div>\n\t\t\t\t\t\t\t<HeadList\n\t\t\t\t\t\t\t\t:items=\"deputy\"\n\t\t\t\t\t\t\t\t:title=\"loc('HUMANRESOURCES_COMPANY_STRUCTURE_TREE_DEPUTY_TITLE')\"\n\t\t\t\t\t\t\t\t:collapsed=\"true\"\n\t\t\t\t\t\t\t\t:type=\"'deputy'\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</HeadList>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-else\n\t\t\t\t\t\t\tclass=\"humanresources-tree__node_load-skeleton --deputies\"\n\t\t\t\t\t\t></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"humanresources-tree__node_subdivisions\"\n\t\t\t\t\t\t:class=\"subdivisionsClass\"\n\t\t\t\t\t\t@click.stop=\"onDepartmentClick('subdivisions')\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span>{{ subdivisionsText }}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<svg v-else width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" class=\"humanresources-tree__node_lock\">\n\t\t\t\t\t<path d=\"M12.0646 4.231C13.9529 4.231 15.4836 5.76968 15.4836 7.66775V10.5612H17.2905V7.66775C17.2905 4.76657 14.9507 2.41476 12.0645 2.41476C9.17827 2.41476 6.83847 4.76657 6.83847 7.66775V10.5612H8.64544V7.66775C8.64544 5.76968 10.1762 4.231 12.0646 4.231Z\" fill=\"#D5D7DB\"/>\n\t\t\t\t\t<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M7.14721 10.3237C6.12854 10.3237 5.30273 11.1495 5.30273 12.1682V18.506C5.30273 19.5246 6.12854 20.3504 7.14722 20.3504H17.1029C18.1216 20.3504 18.9474 19.5246 18.9474 18.506V12.1682C18.9474 11.1495 18.1216 10.3237 17.1029 10.3237H7.14721ZM12.9216 15.5869C12.9216 15.5685 12.93 15.5512 12.944 15.5392C13.2142 15.3085 13.3859 14.9643 13.3859 14.5797C13.3859 13.8847 12.8259 13.3214 12.1353 13.3214C11.4446 13.3214 10.8846 13.8847 10.8846 14.5797C10.8846 14.9643 11.0563 15.3085 11.3266 15.5392C11.3406 15.5512 11.3489 15.5685 11.3489 15.5869V16.7572C11.3489 17.1915 11.701 17.5435 12.1353 17.5435C12.5696 17.5435 12.9216 17.1915 12.9216 16.7572V15.5869Z\" fill=\"#D5D7DB\"/>\n\t\t\t\t</svg>\n\t\t\t\t<SubdivisionAddButton\n\t\t\t\t\tv-if=\"showSubdivisionAddButton\"\n\t\t\t\t\t:entityId=\"nodeId\"\n\t\t\t\t\t:entityType=\"nodeData.entityType\"\n\t\t\t\t\t@click.stop\n\t\t\t\t></SubdivisionAddButton>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if=\"nodeData.parentId === 0 && !hasChildren\"\n\t\t\t\tclass=\"humanresources-tree__node_empty-skeleton\"\n\t\t\t></div>\n\t\t\t<div\n\t\t\t\tv-if=\"hasChildren\"\n\t\t\t\tref=\"childrenNode\"\n\t\t\t\tclass=\"humanresources-tree__node_children\"\n\t\t\t\t:style=\"childNodeStyle\"\n\t\t\t>\n\t\t\t\t<TransitionGroup>\n\t\t\t\t\t<treeNode\n\t\t\t\t\t\tv-for=\"id in nodeData.children\"\n\t\t\t\t\t\tv-if=\"isExpanded || childrenMounted\"\n\t\t\t\t\t\tv-show=\"isExpanded\"\n\t\t\t\t\t\t:ref=\"'node-' + id\"\n\t\t\t\t\t\t:key=\"id\"\n\t\t\t\t\t\t:nodeId=\"id\"\n\t\t\t\t\t\t:expandedNodes=\"expandedNodes\"\n\t\t\t\t\t\t:canvasZoom=\"canvasZoom\"\n\t\t\t\t\t\t:currentDepartments=\"currentDepartments\"\n\t\t\t\t\t\t:isShown=\"isExpanded\"\n\t\t\t\t\t\t@calculatePosition=\"calculatePosition\"\n\t\t\t\t\t/>\n\t\t\t\t</TransitionGroup>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Event } from 'main.core';\nimport { mapState } from 'ui.vue3.pinia';\nimport { EventEmitter, type BaseEvent } from 'main.core.events';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { events } from '../../consts';\nimport type { ConnectorsData, MountedDepartment } from '../../types';\n\n// @vue/component\nexport const Connectors = {\n\tname: 'companyTreeConnectors',\n\n\texpose: [\n\t\t'toggleConnectorsVisibility',\n\t\t'toggleConnectorHighlighting',\n\t\t'toggleAllConnectorsVisibility',\n\t\t'adaptConnectorsAfterReorder',\n\t],\n\n\tprops: {\n\t\tisLocatedDepartmentVisible: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\t/** @type Map */\n\t\ttreeNodes: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tdata(): { connectors: Record<string, ConnectorsData> }\n\t{\n\t\treturn { connectors: {} };\n\t},\n\n\tcomputed:\n\t{\n\t\t...mapState(useChartStore, ['focusedNode', 'departments']),\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.subscribeOnEvents();\n\t\tthis.prevWindowWidth = window.innerWidth;\n\t},\n\n\tbeforeUnmount(): void\n\t{\n\t\tthis.unsubscribeFromEvents();\n\t},\n\n\tmethods:\n\t{\n\t\tonAddConnector({ data }: MountedDepartment): void\n\t\t{\n\t\t\tconst { id, parentId } = data;\n\t\t\tif (!parentId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst connector = this.connectors[`${parentId}-${id}`] ?? {};\n\t\t\tObject.assign(connector, data);\n\t\t\tif (connector.highlighted)\n\t\t\t{\n\t\t\t\tdelete this.connectors[`${parentId}-${id}`];\n\t\t\t}\n\n\t\t\tthis.connectors[`${parentId}-${id}`] = {\n\t\t\t\tshow: true,\n\t\t\t\thighlighted: false,\n\t\t\t\t...connector,\n\t\t\t};\n\t\t},\n\t\tonRemoveConnector({ data }: MountedDepartment): void\n\t\t{\n\t\t\tconst { parentId, id } = data;\n\t\t\tdelete this.connectors[`${parentId}-${id}`];\n\t\t},\n\t\tonAdaptSiblingConnectors({ data }: { nodeId: number; parentId: number; offset: number; }): void\n\t\t{\n\t\t\tconst { nodeId, parentId, offset } = data;\n\t\t\tconst parentDepartment = this.departments.get(parentId);\n\t\t\tconst isMounted = parentDepartment.children.includes(nodeId);\n\t\t\tconst values = Object.values(this.connectors);\n\t\t\tconst parsedSiblingConnectors = values.reduce((acc, connector) => {\n\t\t\t\tconst { endPoint: currentEndPoint, id: currentId, parentId: currentParentId } = connector;\n\t\t\t\tif (!currentId || currentParentId !== parentId || currentId === nodeId)\n\t\t\t\t{\n\t\t\t\t\treturn acc;\n\t\t\t\t}\n\n\t\t\t\tlet sign = 0;\n\t\t\t\tif (isMounted)\n\t\t\t\t{\n\t\t\t\t\tsign = parentDepartment.children.indexOf(nodeId)\n\t\t\t\t\t\t> parentDepartment.children.indexOf(currentId) ? 1 : -1;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tconst { endPoint } = this.connectors[`${parentId}-${nodeId}`];\n\t\t\t\t\tsign = endPoint.x > currentEndPoint.x ? 1 : -1;\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\t...acc,\n\t\t\t\t\t[currentId]: sign,\n\t\t\t\t};\n\t\t\t}, {});\n\t\t\tvalues.forEach((connector) => {\n\t\t\t\tconst {\n\t\t\t\t\tid: currentId,\n\t\t\t\t\tparentId: currentParentId,\n\t\t\t\t\tparentsPath,\n\t\t\t\t\tendPoint: currentEndPoint,\n\t\t\t\t\tstartPoint: currentStartPoint,\n\t\t\t\t} = connector;\n\t\t\t\tif (!currentId || currentId === nodeId)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (currentParentId === parentId)\n\t\t\t\t{\n\t\t\t\t\tconst { x } = currentEndPoint;\n\t\t\t\t\tconst sign = parsedSiblingConnectors[currentId];\n\t\t\t\t\tObject.assign(currentEndPoint, { x: x + offset * sign });\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst ancestorId = parentsPath?.find((id) => {\n\t\t\t\t\treturn Boolean(parsedSiblingConnectors[id]);\n\t\t\t\t});\n\t\t\t\tif (ancestorId)\n\t\t\t\t{\n\t\t\t\t\tconst ancestorSign = parsedSiblingConnectors[ancestorId];\n\t\t\t\t\tObject.assign(currentStartPoint, { x: currentStartPoint.x + offset * ancestorSign });\n\t\t\t\t\tObject.assign(currentEndPoint, { x: currentEndPoint.x + offset * ancestorSign });\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tadaptConnectorsAfterReorder(ids: number[], shift: Number, isRoot: boolean): void\n\t\t{\n\t\t\tids.forEach((departmentId) => {\n\t\t\t\tconst { parentId, children } = this.departments.get(departmentId);\n\t\t\t\tconst connector = this.connectors[`${parentId}-${departmentId}`];\n\t\t\t\tif (!connector)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tObject.assign(connector.endPoint, { x: connector.endPoint.x + shift });\n\t\t\t\tif (!isRoot)\n\t\t\t\t{\n\t\t\t\t\tObject.assign(connector.startPoint, { x: connector.startPoint.x + shift });\n\t\t\t\t}\n\n\t\t\t\tif (children?.length > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.adaptConnectorsAfterReorder(children, shift, false);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tonAdaptConnectorHeight({ data }: BaseEvent): void\n\t\t{\n\t\t\tconst { shift, nodeId } = data;\n\t\t\tObject.values(this.connectors).forEach((connector) => {\n\t\t\t\tif (connector.parentId === nodeId)\n\t\t\t\t{\n\t\t\t\t\tObject.assign(connector.startPoint, { y: connector.startPoint.y + shift });\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\ttoggleConnectorsVisibility(parentId: number, show: boolean): void\n\t\t{\n\t\t\tconst { children } = this.departments.get(parentId);\n\t\t\tchildren.forEach((childId) => {\n\t\t\t\tconst connector = this.connectors[`${parentId}-${childId}`] ?? {};\n\t\t\t\tthis.connectors = {\n\t\t\t\t\t...this.connectors,\n\t\t\t\t\t[`${parentId}-${childId}`]: { ...connector, show },\n\t\t\t\t};\n\t\t\t});\n\t\t},\n\t\ttoggleAllConnectorsVisibility(shouldShow: boolean, expandedNodes: number[]): void\n\t\t{\n\t\t\tObject.keys(this.connectors).forEach((key) => {\n\t\t\t\tconst connector = this.connectors[key];\n\t\t\t\tif (!shouldShow || (expandedNodes.includes(connector.parentId) && shouldShow))\n\t\t\t\t{\n\t\t\t\t\tconnector.show = shouldShow;\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\ttoggleConnectorHighlighting(nodeId: number, expanded: boolean): void\n\t\t{\n\t\t\tconst { parentId } = this.departments.get(nodeId);\n\t\t\tif (!parentId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!expanded)\n\t\t\t{\n\t\t\t\tthis.connectors[`${parentId}-${nodeId}`] = {\n\t\t\t\t\t...this.connectors[`${parentId}-${nodeId}`],\n\t\t\t\t\thighlighted: false,\n\t\t\t\t};\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst highlightedConnector = this.connectors[`${parentId}-${nodeId}`] ?? {};\n\t\t\tdelete this.connectors[`${parentId}-${nodeId}`];\n\t\t\tthis.connectors = {\n\t\t\t\t...this.connectors,\n\t\t\t\t[`${parentId}-${nodeId}`]: {\n\t\t\t\t\t...highlightedConnector,\n\t\t\t\t\thighlighted: true,\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\tgetPath(id: string): string\n\t\t{\n\t\t\tconst connector = this.connectors[id];\n\t\t\tconst { startPoint, endPoint, parentId } = connector;\n\n\t\t\tif (!startPoint || !endPoint)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tlet verticalLineHeight = 115;\n\t\t\tconst parentNode = this.treeNodes.get(parentId);\n\t\t\tconst parentNodeStyle = getComputedStyle(parentNode);\n\t\t\tconst minDepartmentHeight = parseInt(parentNodeStyle.getPropertyValue('--min-height'), 10);\n\t\t\tconst diffHeight = parentNode.offsetHeight - minDepartmentHeight;\n\t\t\tverticalLineHeight = diffHeight > 0 ? verticalLineHeight - diffHeight : verticalLineHeight;\n\t\t\tconst shiftY = 1;\n\n\t\t\tconst startY = startPoint.y - shiftY;\n\t\t\tconst shadowOffset = this.focusedNode === connector.id ? 12 : 0;\n\t\t\tconst rounded = { start: '', end: '' };\n\t\t\tlet arcRadius = 0;\n\n\t\t\tif (Math.round(startPoint.x) > Math.round(endPoint.x))\n\t\t\t{\n\t\t\t\tarcRadius = 15;\n\t\t\t\trounded.start = 'a15,15 0 0 1 -15,15';\n\t\t\t\trounded.end = 'a15,15 0 0 0 -15,15';\n\t\t\t}\n\t\t\telse if (Math.round(startPoint.x) < Math.round(endPoint.x))\n\t\t\t{\n\t\t\t\tarcRadius = -15;\n\t\t\t\trounded.start = 'a15,15 0 0 0 15,15';\n\t\t\t\trounded.end = 'a15,15 0 0 1 15,15';\n\t\t\t}\n\n\t\t\tconst adjustedEndY = endPoint.y - shadowOffset;\n\n\t\t\treturn [\n\t\t\t\t`M${startPoint.x} ${startY}`,\n\t\t\t\t`V${startY + verticalLineHeight}`,\n\t\t\t\t`${String(rounded.start)}`,\n\t\t\t\t`H${endPoint.x + arcRadius}`,\n\t\t\t\t`${String(rounded.end)}`,\n\t\t\t\t`V${adjustedEndY}`,\n\t\t\t].join('');\n\t\t},\n\t\tsubscribeOnEvents(): void\n\t\t{\n\t\t\tthis.events = {\n\t\t\t\t[events.HR_DEPARTMENT_CONNECT]: this.onAddConnector,\n\t\t\t\t[events.HR_DEPARTMENT_DISCONNECT]: this.onRemoveConnector,\n\t\t\t\t[events.HR_DEPARTMENT_ADAPT_SIBLINGS]: this.onAdaptSiblingConnectors,\n\t\t\t\t[events.HR_DEPARTMENT_ADAPT_CONNECTOR_HEIGHT]: this.onAdaptConnectorHeight,\n\t\t\t};\n\t\t\tObject.entries(this.events).forEach(([event, handle]) => {\n\t\t\t\tEventEmitter.subscribe(event, handle);\n\t\t\t});\n\t\t\tEvent.bind(window, 'resize', this.onResizeWindow);\n\t\t},\n\t\tunsubscribeFromEvents(): void\n\t\t{\n\t\t\tObject.entries(this.events).forEach(([event, handle]) => {\n\t\t\t\tEventEmitter.unsubscribe(event, handle);\n\t\t\t});\n\t\t\tEvent.unbind(window, 'resize', this.onResizeWindow);\n\t\t},\n\t\tonResizeWindow(): void\n\t\t{\n\t\t\tconst offset = (window.innerWidth - this.prevWindowWidth) / 2;\n\t\t\tthis.prevWindowWidth = window.innerWidth;\n\t\t\tif (offset === 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tObject.keys(this.connectors).forEach((key) => {\n\t\t\t\tconst connector = this.connectors[key];\n\t\t\t\tif (connector.startPoint && connector.endPoint)\n\t\t\t\t{\n\t\t\t\t\tconst startPointX = connector.startPoint.x;\n\t\t\t\t\tconst endPointX = connector.endPoint.x;\n\t\t\t\t\tObject.assign(connector.startPoint, { x: startPointX + offset });\n\t\t\t\t\tObject.assign(connector.endPoint, { x: endPointX + offset });\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<svg class=\"humanresources-tree__connectors\" fill=\"none\">\n\t\t\t<marker\n\t\t\t\tid='arrow'\n\t\t\t\tmarkerUnits='userSpaceOnUse'\n\t\t\t\tmarkerWidth='20'\n\t\t\t\tmarkerHeight='12'\n\t\t\t\trefX='10'\n\t\t\t\trefY='10.5'\n\t\t\t>\n\t\t\t\t<path d=\"M1 1L10 10L19 1\" class=\"--highlighted\" />\n\t\t\t</marker>\n\t\t\t<path\n\t\t\t\tv-for=\"(connector, id) in connectors\"\n\t\t\t\tv-show=\"connector.show\"\n\t\t\t\t:ref=\"id\"\n\t\t\t\t:marker-end=\"connector.highlighted ? 'url(#arrow)' : null\"\n\t\t\t\t:class=\"{ '--highlighted': connector.highlighted }\"\n\t\t\t\t:id=\"id\"\n\t\t\t\t:d=\"getPath(id)\"\n\t\t\t></path>\n\t\t</svg>\n\t`,\n};\n","import { Event, Dom, Tag, Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { events } from '../../../../consts';\nimport { PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\n\nconst FULL_WIDTH = 302;\nconst CANVAS_MOVE_SPEED = 15;\n\nexport class TreeNodeDragController\n{\n\t#prevAffectedItems: HTMLElement[];\n\t#targetData: { targetItem: HTMLElement; insertion: string; };\n\t#transform: { x: number; y: number; prevX: number; prevY: number; };\n\t#tree: HTMLElement;\n\t#draggedItem: HTMLElement;\n\t#ghost: HTMLElement;\n\t#positionPointer: HTMLElement;\n\t#zoom: number;\n\t#canvas: { x: number; y: number; };\n\t#prevPageX: number = 0;\n\t#prevPageY: number = 0;\n\t#targetTeams: HTMLElement[];\n\t#permissionChecker: PermissionChecker;\n\t#draggedEntityType: string;\n\t#mouseMoveHandler: (event: MouseEvent) => void;\n\t#mouseUpHandler: (event: MouseEvent) => void;\n\t#mouseWheelHandler: (event: MouseEvent) => void;\n\n\tconstructor(el: HTMLElement)\n\t{\n\t\tEvent.bind(el, 'mousedown', (event: MouseEvent) => {\n\t\t\tthis.#onMouseDown(event);\n\t\t});\n\t\tthis.#mouseMoveHandler = (event: MouseEvent) => {\n\t\t\tthis.#onMouseMove(event);\n\t\t};\n\n\t\tthis.#mouseUpHandler = (event: MouseEvent) => {\n\t\t\tthis.#onMouseUp(event);\n\t\t};\n\n\t\tthis.#mouseWheelHandler = (event: MouseEvent) => {\n\t\t\tthis.#onMouseWheel(event);\n\t\t};\n\n\t\tthis.#permissionChecker = PermissionChecker.getInstance();\n\t}\n\n\t#onMouseDown({ target, currentTarget: tree, pageX, pageY }: MouseEvent): void\n\t{\n\t\tif (!Dom.hasClass(target, 'humanresources-tree__node_dnd-icon'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tevent.stopPropagation();\n\t\tthis.#tree = tree;\n\t\tthis.#zoom = Number(tree.dataset.zoom);\n\t\tthis.#canvas = { x: Number(tree.dataset.x), y: Number(tree.dataset.y) };\n\t\tthis.#draggedItem = target.closest('.humanresources-tree__node');\n\t\tthis.#ghost = this.#createGhost();\n\t\tthis.#prevPageX = pageX;\n\t\tthis.#prevPageY = pageY;\n\t\tthis.#positionPointer = this.#createPositionPointer();\n\t\tthis.#targetTeams = [];\n\t\tthis.#prevAffectedItems = [];\n\t\tthis.#transform = { x: 0, y: 0, prevX: 0, prevY: 0 };\n\t\tthis.#targetData = {};\n\t\tthis.#draggedEntityType = Dom.hasClass(this.#draggedItem, '--team') ? EntityTypes.team : EntityTypes.department;\n\t\tDom.addClass(tree, '--drag-progress');\n\t\tDom.addClass(this.#draggedItem.parentElement.parentElement, '--blur');\n\t\tthis.#setPositionPointerTransform(this.#draggedItem);\n\t\tthis.#setStyles();\n\t\tEvent.bind(document, 'mousemove', this.#mouseMoveHandler);\n\t\tEvent.bind(document, 'mouseup', this.#mouseUpHandler);\n\t\tEvent.bind(document, 'wheel', this.#mouseWheelHandler);\n\t\tEventEmitter.emit(events.HR_ENTITY_TOGGLE_CONNECTORS, { shouldShow: false });\n\t\tconst draggedId = Number(this.#draggedItem.dataset.id);\n\t\tEventEmitter.emit(events.HR_DRAG_ENTITY, { draggedId });\n\t}\n\n\t#onMouseMove({ pageX, pageY }: MouseEvent): void\n\t{\n\t\tDom.addClass(this.#draggedItem, '--hidden');\n\t\tDom.addClass(this.#tree.parentElement, '--disabled-transition');\n\t\tDom.removeClass(this.#positionPointer, ['--inside', '--no-permission']);\n\t\tDom.style(this.#positionPointer, 'height', `${this.#draggedItem.offsetHeight}px`);\n\t\tthis.#resetTeamsBlur();\n\t\tthis.#transform.prevX = this.#transform.x;\n\t\tthis.#transform.prevY = this.#transform.y;\n\t\tthis.#transform.x += (pageX - this.#prevPageX) / this.#zoom;\n\t\tthis.#transform.y += (pageY - this.#prevPageY) / this.#zoom;\n\t\tthis.#prevPageX = pageX;\n\t\tthis.#prevPageY = pageY;\n\t\tthis.#prevAffectedItems.forEach((affectedItem) => this.#setTransform(affectedItem, 0, 0));\n\t\tthis.#prevAffectedItems = [];\n\t\tconst { directionX, directionY } = this.#checkForDraggedOverflow();\n\t\tthis.#transform.x = directionX === 0\n\t\t\t? this.#transform.x\n\t\t\t: this.#transform.x + directionX * CANVAS_MOVE_SPEED / this.#zoom;\n\t\tthis.#transform.y = directionY === 0\n\t\t\t? this.#transform.y\n\t\t\t: this.#transform.y + directionY * CANVAS_MOVE_SPEED / this.#zoom;\n\t\tthis.#setTransform(this.#ghost, this.#transform.x, this.#transform.y, 4);\n\t\tthis.#setPositionPointerTransform(this.#draggedItem);\n\t\tthis.#targetData = this.#getTargetData();\n\t\tif (!this.#targetData.insertion)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst { insertion, targetItem, hasPermission } = this.#targetData;\n\t\tif (!hasPermission)\n\t\t{\n\t\t\tDom.addClass(this.#positionPointer, '--no-permission');\n\t\t}\n\n\t\tthis.#setPositionPointerTransform(targetItem);\n\t\tswitch (insertion)\n\t\t{\n\t\t\tcase 'reorder':\n\t\t\t{\n\t\t\t\tconst affectedItems = this.#reorderEntity(targetItem);\n\t\t\t\tthis.#prevAffectedItems = affectedItems;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'sibling-left':\n\t\t\tcase 'sibling-right':\n\t\t\t{\n\t\t\t\tconst affectedItems = this.#changeParentWithReorder(targetItem, insertion);\n\t\t\t\tthis.#prevAffectedItems = affectedItems;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tdefault:\n\t\t\t\tDom.addClass(this.#positionPointer, '--inside');\n\t\t\t\tDom.style(this.#positionPointer, 'height', `${targetItem.offsetHeight}px`);\n\t\t}\n\t}\n\n\t#onMouseUp(): void\n\t{\n\t\tthis.#setStyles(true);\n\t\tEvent.unbind(document, 'mousemove', this.#mouseMoveHandler);\n\t\tEvent.unbind(document, 'mouseup', this.#mouseUpHandler);\n\t\tEvent.unbind(document, 'mouseup', this.#mouseWheelHandler);\n\t\tthis.#prevAffectedItems.forEach((item) => this.#setTransform(item, 0, 0));\n\t\tDom.removeClass(this.#tree, '--drag-progress');\n\t\tDom.removeClass(this.#draggedItem.parentElement.parentElement, '--blur');\n\t\tDom.removeClass(this.#draggedItem, '--hidden');\n\t\tDom.removeClass(this.#tree.parentElement, '--disabled-transition');\n\t\tDom.remove(this.#ghost);\n\t\tDom.remove(this.#positionPointer);\n\t\tthis.#resetTeamsBlur();\n\t\tEventEmitter.emit(events.HR_ENTITY_TOGGLE_CONNECTORS, { shouldShow: true });\n\t\tconst { insertion, targetItem, hasPermission } = this.#targetData;\n\t\tif (!insertion || !hasPermission)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst draggedIndex = [...this.#draggedItem.parentElement.children].indexOf(this.#draggedItem);\n\t\tconst targetIndex = [...targetItem.parentElement.children].indexOf(targetItem);\n\t\tconst draggedId = Number(this.#draggedItem.dataset.id);\n\t\tEventEmitter.emit(events.HR_DROP_ENTITY, {\n\t\t\tdraggedId,\n\t\t\ttargetId: Number(targetItem.dataset.id),\n\t\t\ttargetIndex,\n\t\t\taffectedItems: this.#prevAffectedItems.map((item) => Number(item.dataset.id)),\n\t\t\tdirection: draggedIndex < targetIndex ? 1 : -1,\n\t\t\tinsertion,\n\t\t});\n\t}\n\n\t#onMouseWheel({ shiftKey }: WheelEvent): void\n\t{\n\t\tif (shiftKey)\n\t\t{\n\t\t\tconst currentCanvasX = Number(this.#tree.dataset.x);\n\t\t\tconst movementX = currentCanvasX - this.#canvas.x;\n\t\t\tthis.#transform.x -= movementX / this.#zoom;\n\t\t\tthis.#canvas.x = currentCanvasX;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst currentCanvasY = Number(this.#tree.dataset.y);\n\t\t\tconst movementY = currentCanvasY - this.#canvas.y;\n\t\t\tthis.#transform.y -= movementY / this.#zoom;\n\t\t\tthis.#canvas.y = currentCanvasY;\n\t\t}\n\n\t\tthis.#setTransform(this.#ghost, this.#transform.x, this.#transform.y, 4);\n\t}\n\n\t#createGhost(): HTMLElement\n\t{\n\t\tconst ghost = this.#draggedItem.cloneNode(true);\n\t\tDom.addClass(ghost, 'humanresources-tree__dnd-ghost');\n\t\tDom.removeClass(ghost, ['--expanded', '--focused']);\n\t\tconst { x: treeX, y: treeY } = this.#tree.getBoundingClientRect();\n\t\tconst { x: draggedX, y: draggedY } = this.#draggedItem.getBoundingClientRect();\n\t\tconst left = draggedX - treeX;\n\t\tconst top = draggedY - treeY;\n\t\tDom.style(ghost, 'left', `${left / this.#zoom}px`);\n\t\tDom.style(ghost, 'top', `${top / this.#zoom}px`);\n\t\tDom.append(ghost, this.#tree);\n\n\t\treturn ghost;\n\t}\n\n\t#createPositionPointer(): HTMLElement\n\t{\n\t\tconst { offsetWidth, offsetHeight } = this.#draggedItem;\n\t\tconst text = Dom.hasClass(this.#draggedItem, '--team')\n\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DRAG_TEAM_LABEL')\n\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DRAG_DEPARTMENT_LABEL');\n\t\tconst positionPointer = Tag.render`\n\t\t\t<div\n\t\t\t\tclass=\"humanresources-tree__position-pointer\"\n\t\t\t\tstyle=\"width: ${offsetWidth}px; height: ${offsetHeight}px;);\"\n\t\t\t>\n\t\t\t\t<div>\n\t\t\t\t\t<div class=\"ui-icon-set --circle-plus\"></div>\n\t\t\t\t\t<span>${text}</span>\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<div class=\"ui-icon-set --cross-circle-50\"></div>\n\t\t\t\t\t<span>\n\t\t\t\t\t\t${Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_NO_DRAG_PERMISSION')}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t\tDom.append(positionPointer, this.#tree);\n\t\tthis.#setPositionPointerTransform(this.#draggedItem);\n\n\t\treturn positionPointer;\n\t}\n\n\t#setTransform(element: HTMLElement, x: number, y: number, rotation: number = 0): void\n\t{\n\t\tif (x === 0 && y === 0)\n\t\t{\n\t\t\tDom.style(element, 'transform', '');\n\n\t\t\treturn;\n\t\t}\n\n\t\tDom.style(element, 'transform', `translate3d(${x}px, ${y}px, 0) rotate(${rotation}deg)`);\n\t}\n\n\t#setPositionPointerTransform(node: HTMLElement): void\n\t{\n\t\tconst { x: treeX, y: treeY } = this.#tree.getBoundingClientRect();\n\t\tconst { x: nodeX, y: nodeY } = node.getBoundingClientRect();\n\t\tconst x = (nodeX - treeX) / this.#zoom;\n\t\tconst y = (nodeY - treeY) / this.#zoom;\n\t\tthis.#setTransform(this.#positionPointer, x, y);\n\t}\n\n\t#getTargetData(): { insertion?: string; targetItem?: HTMLElement; }\n\t{\n\t\tDom.addClass(this.#ghost, '--disabled-events');\n\t\tthis.#setTransform(this.#ghost, this.#transform.x, this.#transform.y);\n\t\tconst reorderThreshold = 0.7;\n\t\tconst changeParentWithReorderThreshold = 0.6;\n\t\tconst {\n\t\t\tx,\n\t\t\ty,\n\t\t\twidth: draggedWidth,\n\t\t\theight: draggedHeight,\n\t\t} = this.#ghost.getBoundingClientRect();\n\t\tthis.#setTransform(this.#ghost, this.#transform.x, this.#transform.y, 4);\n\t\tconst points = [\n\t\t\t{ x, y },\n\t\t\t{ x: x + draggedWidth, y },\n\t\t\t{ x, y: y + draggedHeight },\n\t\t\t{ x: x + draggedWidth, y: y + draggedHeight },\n\t\t\t{ x, y: y + draggedHeight / 2 },\n\t\t\t{ x: x + draggedWidth, y: y + draggedHeight / 2 },\n\t\t];\n\t\tconst targetData = points.reduce((acc, point, i) => {\n\t\t\tif (acc.insertion)\n\t\t\t{\n\t\t\t\treturn acc;\n\t\t\t}\n\n\t\t\tconst belowItem = document.elementFromPoint(point.x, point.y);\n\t\t\tconst targetItemSummary = belowItem?.closest('.humanresources-tree__node_summary');\n\t\t\tconst targetItem = targetItemSummary?.parentElement;\n\t\t\tif (!targetItem || targetItem === this.#draggedItem)\n\t\t\t{\n\t\t\t\treturn acc;\n\t\t\t}\n\n\t\t\tconst {\n\t\t\t\tx: targetX,\n\t\t\t\ty: targetY,\n\t\t\t\twidth: targetWidth,\n\t\t\t\theight: targetHeight,\n\t\t\t} = targetItem.getBoundingClientRect();\n\t\t\tconst sameParent = this.#draggedItem.parentElement === targetItem.parentElement;\n\t\t\tconst hasSortPermission = this.#permissionChecker.canSortEntitiesByParentId(\n\t\t\t\tNumber(targetItem.parentElement.parentElement.dataset.id),\n\t\t\t);\n\t\t\tconst allowSort = i === 0 && !Dom.hasClass(targetItem, '--root') && hasSortPermission;\n\t\t\tacc.targetItem = targetItem;\n\t\t\tif (sameParent && x + reorderThreshold * draggedWidth < targetX + targetWidth && allowSort)\n\t\t\t{\n\t\t\t\treturn { ...acc, insertion: 'reorder' };\n\t\t\t}\n\n\t\t\tif (!sameParent && y + changeParentWithReorderThreshold * draggedHeight < targetY + targetHeight && allowSort)\n\t\t\t{\n\t\t\t\treturn {\n\t\t\t\t\t...acc,\n\t\t\t\t\tinsertion: x < targetX + targetWidth / 2 ? 'sibling-left' : 'sibling-right',\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tconst isDepartmentInsertToTeam = Dom.hasClass(targetItem, '--team') && !Dom.hasClass(this.#draggedItem, '--team');\n\t\t\tconst isInsertToParent = this.#draggedItem.parentElement.parentElement === targetItem;\n\t\t\tif (isDepartmentInsertToTeam || isInsertToParent)\n\t\t\t{\n\t\t\t\tif (isDepartmentInsertToTeam)\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(targetItem, '--blur');\n\t\t\t\t\tthis.#targetTeams.push(targetItem);\n\t\t\t\t}\n\n\t\t\t\treturn acc;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\t...acc,\n\t\t\t\tinsertion: 'inside',\n\t\t\t\thasPermission: this.#permissionChecker.canBeParentForEntity(\n\t\t\t\t\tNumber(targetItem.dataset.id),\n\t\t\t\t\tthis.#draggedEntityType,\n\t\t\t\t),\n\t\t\t};\n\t\t}, { hasPermission: true });\n\n\t\tDom.removeClass(this.#ghost, '--disabled-events');\n\n\t\treturn targetData;\n\t}\n\n\t#reorderEntity(targetItem: HTMLElement): HTMLElement[]\n\t{\n\t\tconst children = [...this.#draggedItem.parentElement.children];\n\t\tconst draggedIndex = children.indexOf(this.#draggedItem);\n\t\tconst targetIndex = [...targetItem.parentElement.children].indexOf(targetItem);\n\t\tconst direction = draggedIndex < targetIndex ? 1 : -1;\n\t\tconst affectedItems = direction > 0\n\t\t\t? children.slice(draggedIndex + 1, targetIndex + 1)\n\t\t\t: children.slice(targetIndex, draggedIndex);\n\t\taffectedItems.forEach((affectedItem) => this.#setTransform(affectedItem, -direction * FULL_WIDTH, 0));\n\n\t\treturn affectedItems;\n\t}\n\n\t#changeParentWithReorder(targetItem: HTMLElement, insertion: string): HTMLElement[]\n\t{\n\t\tconst children = [...targetItem.parentElement.children];\n\t\tconst targetIndex = children.indexOf(targetItem);\n\t\tlet affectedItems = [];\n\t\tif (insertion === 'sibling-right')\n\t\t{\n\t\t\taffectedItems = children.slice(0, targetIndex + 1);\n\t\t\taffectedItems.forEach((affectedItem) => this.#setTransform(affectedItem, -FULL_WIDTH, 0));\n\t\t}\n\t\telse\n\t\t{\n\t\t\taffectedItems = children.slice(targetIndex);\n\t\t\taffectedItems.forEach((affectedItem) => this.#setTransform(affectedItem, FULL_WIDTH, 0));\n\t\t}\n\n\t\treturn affectedItems;\n\t}\n\n\t#checkForDraggedOverflow(): { directionX: number; directionY: number; }\n\t{\n\t\tlet directionX = 0;\n\t\tlet directionY = 0;\n\t\tconst { left, top } = this.#draggedItem.getBoundingClientRect();\n\t\tconst zoomedLeft = left / this.#zoom;\n\t\tconst zoomedTop = top / this.#zoom;\n\t\tif (zoomedLeft + this.#transform.x < 0)\n\t\t{\n\t\t\tdirectionX = this.#transform.x < this.#transform.prevX ? -1 : 0;\n\t\t}\n\n\t\tif (zoomedLeft + this.#transform.x + this.#draggedItem.offsetWidth > document.body.offsetWidth / this.#zoom)\n\t\t{\n\t\t\tdirectionX = this.#transform.x > this.#transform.prevX ? 1 : 0;\n\t\t}\n\n\t\tif (zoomedTop + this.#transform.y < 0)\n\t\t{\n\t\t\tdirectionY = this.#transform.y < this.#transform.prevY ? -1 : 0;\n\t\t}\n\n\t\tif (zoomedTop + this.#transform.y + this.#draggedItem.offsetHeight > document.body.offsetHeight / this.#zoom)\n\t\t{\n\t\t\tdirectionY = this.#transform.y > this.#transform.prevY ? 1 : 0;\n\t\t}\n\n\t\tif (directionX !== 0 || directionY !== 0)\n\t\t{\n\t\t\tEventEmitter.emit(events.HR_ORG_CHART_TRANSFORM_CANVAS, {\n\t\t\t\tdirectionX,\n\t\t\t\tdirectionY,\n\t\t\t\tspeed: CANVAS_MOVE_SPEED,\n\t\t\t});\n\t\t}\n\n\t\treturn {\n\t\t\tdirectionX,\n\t\t\tdirectionY,\n\t\t};\n\t}\n\n\t#setStyles(shouldReset: ?boolean): void\n\t{\n\t\tDom.style(document.body, 'userSelect', 'none');\n\t\tDom.style(document.body, '-webkit-user-select', 'none');\n\t\tDom.style(document.body, 'cursor', 'grabbing');\n\t\tif (shouldReset)\n\t\t{\n\t\t\tDom.style(document.body, 'userSelect', '');\n\t\t\tDom.style(document.body, '-webkit-user-select', '');\n\t\t\tDom.style(document.body, 'cursor', '');\n\t\t}\n\t}\n\n\t#resetTeamsBlur(): void\n\t{\n\t\tthis.#targetTeams.forEach((team) => Dom.removeClass(team, '--blur'));\n\t}\n}\n","import { TreeNodeDragController } from './classes/drag-and-drop-controller';\n\nexport const DragAndDrop = {\n\tmounted(el: HTMLElement): void\n\t{\n\t\tnew TreeNodeDragController(el);\n\t},\n\tupdated(el: HTMLElement, { value }: Object): void\n\t{\n\t\tconst { x, y, zoom } = value;\n\t\tel.setAttribute('data-zoom', zoom);\n\t\tel.setAttribute('data-x', x);\n\t\tel.setAttribute('data-y', y);\n\t},\n};\n","import { Runtime } from 'main.core';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\nimport { MessageBox, MessageBoxButtons } from 'ui.dialogs.messagebox';\nimport { UI } from 'ui.notification';\nimport { ButtonColor } from 'ui.buttons';\nimport { UrlProvidedParamsService } from '../../classes/url-provided-params-service';\nimport { TreeNode } from './tree-node/tree-node';\nimport { Connectors } from './connectors';\nimport { DragAndDrop } from './directives/drag-and-drop';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { mapState } from 'ui.vue3.pinia';\nimport { EventEmitter, type BaseEvent } from 'main.core.events';\nimport { events } from '../../consts';\nimport { chartAPI } from '../../api';\nimport { sendData as analyticsSendData } from 'ui.analytics';\nimport { OrgChartActions } from '../../actions';\nimport type { MountedDepartment, TreeData, DragAndDropData } from '../../types';\nimport './style.css';\n\n// @vue/component\nexport const Tree = {\n\tname: 'companyTree',\n\n\tcomponents: { TreeNode, Connectors },\n\n\tdirectives: { dnd: DragAndDrop },\n\n\tprovide(): { [key: string]: Function }\n\t{\n\t\treturn {\n\t\t\tgetTreeBounds: () => this.getTreeBounds(),\n\t\t};\n\t},\n\n\tprops: {\n\t\tcanvasTransform: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\temits: ['moveTo', 'showWizard', 'controlDetail'],\n\n\tdata(): TreeData\n\t{\n\t\treturn {\n\t\t\texpandedNodes: [],\n\t\t\tisLocatedDepartmentVisible: false,\n\t\t\tisLoaded: false,\n\t\t};\n\t},\n\n\tcomputed:\n\t{\n\t\trootId(): number\n\t\t{\n\t\t\tconst { id: rootId } = [...this.departments.values()].find((department) => {\n\t\t\t\treturn department.parentId === 0;\n\t\t\t});\n\n\t\t\treturn rootId;\n\t\t},\n\t\tconnectors(): Connectors\n\t\t{\n\t\t\treturn this.$refs.connectors;\n\t\t},\n\t\t...mapState(useChartStore, ['currentDepartments', 'userId', 'focusedNode', 'departments']),\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.treeNodes = new Map();\n\t\tthis.subscribeOnEvents();\n\t\tthis.loadHeads([this.rootId]);\n\t},\n\n\tmounted(): void\n\t{\n\t\tconst departmentToFocus = this.getDepartmentIdForInitialFocus();\n\t\tthis.currentDepartmentsLocated = [departmentToFocus];\n\n\t\tif (departmentToFocus !== this.rootId)\n\t\t{\n\t\t\tthis.expandDepartmentParents(departmentToFocus);\n\t\t\tthis.focus(departmentToFocus, { expandAfterFocus: true });\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.expandLowerDepartments();\n\t\tthis.focus(departmentToFocus);\n\t},\n\n\tbeforeUnmount(): void\n\t{\n\t\tthis.unsubscribeFromEvents();\n\t},\n\n\tmethods:\n\t{\n\t\tgetDepartmentIdForInitialFocus(): ?number\n\t\t{\n\t\t\tconst providedFocusNodeId = UrlProvidedParamsService.getParams().focusNodeId;\n\t\t\tif (providedFocusNodeId)\n\t\t\t{\n\t\t\t\tconst node = this.departments.get(providedFocusNodeId);\n\t\t\t\tif (node)\n\t\t\t\t{\n\t\t\t\t\treturn providedFocusNodeId;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (const currentDepartmentId: number of this.currentDepartments)\n\t\t\t{\n\t\t\t\tconst node = this.departments.get(currentDepartmentId);\n\n\t\t\t\tif (node.entityType === EntityTypes.department)\n\t\t\t\t{\n\t\t\t\t\treturn currentDepartmentId;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn this.rootId;\n\t\t},\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tgetTreeBounds(): DOMRect\n\t\t{\n\t\t\treturn this.$el.getBoundingClientRect();\n\t\t},\n\t\tonConnectDepartment({ data }: MountedDepartment): void\n\t\t{\n\t\t\tconst { id, html } = data;\n\t\t\tthis.treeNodes.set(id, html);\n\t\t\tconst departmentIdToFocus = this.getDepartmentIdForInitialFocus();\n\t\t\tif (id === departmentIdToFocus && !this.isLoaded) // zoom to  department when loading\n\t\t\t{\n\t\t\t\tconst movingDelay = 1800;\n\t\t\t\tthis.isLoaded = true;\n\t\t\t\tRuntime.debounce(() => {\n\t\t\t\t\tthis.moveTo(departmentIdToFocus);\n\t\t\t\t}, movingDelay)();\n\t\t\t}\n\t\t},\n\t\tonDisconnectDepartment({ data }: MountedDepartment): void\n\t\t{\n\t\t\tconst { id } = data;\n\t\t\tconst department = this.departments.get(id);\n\t\t\tdelete department.prevParentId;\n\t\t\tif (!department.parentId)\n\t\t\t{\n\t\t\t\tOrgChartActions.removeDepartment(id);\n\t\t\t}\n\t\t},\n\t\tonDragEntity({ data }: BaseEvent): void\n\t\t{\n\t\t\tconst { draggedId } = data;\n\t\t\tif (this.expandedNodes.includes(draggedId))\n\t\t\t{\n\t\t\t\tthis.collapseRecursively(draggedId);\n\t\t\t}\n\t\t},\n\t\tonToggleConnectors({ data }: BaseEvent): void\n\t\t{\n\t\t\tconst { shouldShow } = data;\n\t\t\tthis.connectors.toggleAllConnectorsVisibility(shouldShow, this.expandedNodes);\n\t\t},\n\t\tasync changeOrder(data: DragAndDropData): Promise<void>\n\t\t{\n\t\t\tconst { draggedId, targetId, affectedItems, direction } = data;\n\t\t\tconst promise = OrgChartActions.orderDepartments(draggedId, targetId, direction, affectedItems.length);\n\t\t\tconst fullDepartmentWidth = 302;\n\t\t\tconst draggedShift = affectedItems.length * direction * fullDepartmentWidth;\n\t\t\tthis.connectors.adaptConnectorsAfterReorder([draggedId], draggedShift, true);\n\t\t\tconst affectedShift = -direction * fullDepartmentWidth;\n\t\t\tthis.connectors.adaptConnectorsAfterReorder(affectedItems, affectedShift, true);\n\t\t\tconst ordered = await promise;\n\t\t\tif (!ordered)\n\t\t\t{\n\t\t\t\tthis.connectors.adaptConnectorsAfterReorder([draggedId], -draggedShift, true);\n\t\t\t\tthis.connectors.adaptConnectorsAfterReorder(affectedItems, -affectedShift, true);\n\t\t\t}\n\t\t},\n\t\tasync updateParent(data: DragAndDropData): Promise<void>\n\t\t{\n\t\t\tconst { draggedId, targetId, targetIndex, insertion } = data;\n\t\t\tconst { id, parentId } = this.departments.get(draggedId);\n\t\t\tif (parentId === targetId && insertion === 'inside')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet updateParentPromise = null;\n\t\t\tconst store = useChartStore();\n\t\t\tif (insertion === 'sibling-left' || insertion === 'sibling-right')\n\t\t\t{\n\t\t\t\tconst { parentId: targetParentId } = this.departments.get(targetId);\n\t\t\t\tconst position = insertion === 'sibling-left' ? targetIndex : targetIndex + 1;\n\t\t\t\tstore.updateDepartment({ id, parentId: targetParentId }, position);\n\t\t\t\tupdateParentPromise = chartAPI.updateDepartment(draggedId, targetParentId);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tstore.updateDepartment({ id, parentId: targetId });\n\t\t\t\tupdateParentPromise = chartAPI.updateDepartment(draggedId, targetId);\n\t\t\t}\n\n\t\t\tthis.locateToDepartment(draggedId);\n\t\t\ttry\n\t\t\t{\n\t\t\t\tawait updateParentPromise;\n\t\t\t\tif (insertion === 'sibling-left' || insertion === 'sibling-right')\n\t\t\t\t{\n\t\t\t\t\tconst { parentId: targetParentId } = this.departments.get(targetId);\n\t\t\t\t\tconst { children } = this.departments.get(targetParentId);\n\t\t\t\t\tconst shift = insertion === 'sibling-left' ? 1 : 2;\n\t\t\t\t\tconst affectedCount = children.length - targetIndex - shift;\n\t\t\t\t\tawait chartAPI.changeOrder(draggedId, -1, affectedCount);\n\t\t\t\t}\n\t\t\t}\n\t\t\tcatch (err)\n\t\t\t{\n\t\t\t\tconsole.error(err);\n\t\t\t}\n\t\t},\n\t\tonDropEntity({ data }: BaseEvent): void\n\t\t{\n\t\t\tconst { insertion } = data;\n\t\t\tif (insertion === 'reorder')\n\t\t\t{\n\t\t\t\tthis.changeOrder(data);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.updateParent(data);\n\t\t},\n\t\tonPublicFocusNode({ data }: BaseEvent): void\n\t\t{\n\t\t\tconst { nodeId } = data;\n\n\t\t\tconst node = this.departments.get(nodeId);\n\t\t\tif (!node)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvoid this.locateToDepartment(nodeId);\n\t\t},\n\t\tcollapse(nodeId: number): void\n\t\t{\n\t\t\tthis.expandedNodes = this.expandedNodes.filter((expandedId) => expandedId !== nodeId);\n\t\t\tthis.connectors.toggleConnectorsVisibility(nodeId, false);\n\t\t\tthis.connectors.toggleConnectorHighlighting(nodeId, false);\n\t\t},\n\t\tcollapseRecursively(nodeId: number): void\n\t\t{\n\t\t\tconst deepCollapse = (id: number) => {\n\t\t\t\tthis.collapse(id);\n\t\t\t\tconst node = this.departments.get(id);\n\t\t\t\tnode.children?.forEach((childId) => {\n\t\t\t\t\tif (this.expandedNodes.includes(childId))\n\t\t\t\t\t{\n\t\t\t\t\t\tdeepCollapse(childId);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t};\n\t\t\tconst { parentId } = this.departments.get(nodeId);\n\t\t\tconst expandedNode = this.expandedNodes.find((id) => {\n\t\t\t\tconst node = this.departments.get(id);\n\n\t\t\t\treturn node.parentId === parentId;\n\t\t\t});\n\t\t\tif (expandedNode)\n\t\t\t{\n\t\t\t\tdeepCollapse(expandedNode);\n\t\t\t}\n\t\t},\n\t\texpand(departmentId: number): void\n\t\t{\n\t\t\tthis.collapseRecursively(departmentId);\n\t\t\tthis.expandedNodes = [...this.expandedNodes, departmentId];\n\t\t\tthis.connectors.toggleConnectorsVisibility(departmentId, true);\n\t\t\tthis.connectors.toggleConnectorHighlighting(departmentId, true);\n\t\t\tconst department = this.departments.get(departmentId);\n\t\t\tconst childrenWithoutHeads = department.children.filter((childId) => {\n\t\t\t\treturn !this.departments.get(childId).heads;\n\t\t\t});\n\t\t\tif (childrenWithoutHeads.length > 0)\n\t\t\t{\n\t\t\t\tthis.loadHeads(childrenWithoutHeads);\n\t\t\t}\n\n\t\t\tanalyticsSendData({ tool: 'structure', category: 'structure', event: 'expand_department' });\n\t\t},\n\t\tfocus(nodeId: number, options: Object = {}): void\n\t\t{\n\t\t\tconst { expandAfterFocus = false, showEmployees = false, subdivisionsSelected = false } = options;\n\t\t\tconst hasChildren = this.departments.get(nodeId).children?.length > 0;\n\n\t\t\tlet shouldExpand = expandAfterFocus || !this.expandedNodes.includes(nodeId);\n\t\t\tif (showEmployees)\n\t\t\t{\n\t\t\t\tshouldExpand = this.expandedNodes.includes(nodeId);\n\t\t\t}\n\n\t\t\tif (subdivisionsSelected || !hasChildren)\n\t\t\t{\n\t\t\t\tthis.collapseRecursively(nodeId);\n\t\t\t}\n\n\t\t\tif (hasChildren && shouldExpand)\n\t\t\t{\n\t\t\t\tthis.expand(nodeId);\n\t\t\t}\n\n\t\t\tif (this.focusedNode && !this.expandedNodes.includes(this.focusedNode))\n\t\t\t{\n\t\t\t\tthis.connectors.toggleConnectorHighlighting(this.focusedNode, false);\n\t\t\t}\n\n\t\t\tOrgChartActions.focusDepartment(nodeId);\n\t\t\tthis.connectors.toggleConnectorHighlighting(this.focusedNode, true);\n\t\t},\n\t\tonFocusDepartment({ data }: { nodeId: number }): void\n\t\t{\n\t\t\tconst { nodeId, showEmployees, subdivisionsSelected } = data;\n\t\t\tthis.focus(nodeId, { showEmployees, subdivisionsSelected });\n\t\t\tthis.$emit('controlDetail', {\n\t\t\t\tshowEmployees,\n\t\t\t\tpreventSwitch: subdivisionsSelected,\n\t\t\t});\n\t\t},\n\t\ttryRemoveDepartment(nodeId: number, entityType: string): void\n\t\t{\n\t\t\tconst localizationMap = {\n\t\t\t\tteam: {\n\t\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_REMOVE_TEAM_TITLE'),\n\t\t\t\t\tmessage: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_REMOVE_TEAM_MESSAGE'),\n\t\t\t\t\tsuccess: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_REMOVE_TEAM_REMOVED'),\n\t\t\t\t\terror: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_REMOVE_TEAM_ERROR'),\n\t\t\t\t},\n\t\t\t\tdefault: {\n\t\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_REMOVE_DEPARTMENT_TITLE'),\n\t\t\t\t\tmessage: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_REMOVE_DEPARTMENT_MESSAGE'),\n\t\t\t\t\tsuccess: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_REMOVE_DEPARTMENT_REMOVED'),\n\t\t\t\t\terror: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_REMOVE_DEPARTMENT_ERROR'),\n\t\t\t\t},\n\t\t\t};\n\t\t\tconst mapIndex = entityType === EntityTypes.team ? 'team' : 'default';\n\t\t\tconst messageBox = MessageBox.create({\n\t\t\t\ttitle: localizationMap[mapIndex].title,\n\t\t\t\tmessage: localizationMap[mapIndex].message,\n\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t\tonOk: async (dialog: MessageBox) => {\n\t\t\t\t\ttry\n\t\t\t\t\t{\n\t\t\t\t\t\tawait this.removeDepartment(nodeId);\n\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\tcontent: localizationMap[mapIndex].success,\n\t\t\t\t\t\t\tautoHideDelay: 2000,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tdialog.close();\n\t\t\t\t\t}\n\t\t\t\t\tcatch\n\t\t\t\t\t{\n\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\tcontent: localizationMap[mapIndex].error,\n\t\t\t\t\t\t\tautoHideDelay: 2000,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonCancel: (dialog: MessageBox) => dialog.close(),\n\t\t\t\tminWidth: 250,\n\t\t\t\tmaxWidth: 320,\n\t\t\t\tminHeight: 175,\n\t\t\t\tokCaption: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_REMOVE_DEPARTMENT_OK_CAPTION'),\n\t\t\t\tpopupOptions: { className: 'humanresources-tree__message-box', overlay: { opacity: 40 } },\n\t\t\t});\n\t\t\tconst okButton = messageBox.getOkButton();\n\t\t\tconst cancelButton = messageBox.getCancelButton();\n\t\t\tokButton.setRound(true);\n\t\t\tcancelButton.setRound(true);\n\t\t\tokButton.setColor(ButtonColor.DANGER);\n\t\t\tcancelButton.setColor(ButtonColor.LIGHT_BORDER);\n\t\t\tmessageBox.show();\n\t\t},\n\t\tasync removeDepartment(nodeId: number): Promise<void>\n\t\t{\n\t\t\tawait chartAPI.removeDepartment(nodeId);\n\t\t\tconst removableDepartment = this.departments.get(nodeId);\n\t\t\tconst { parentId, children: removableDepartmentChildren = [] } = removableDepartment;\n\t\t\tif (removableDepartmentChildren.length > 0)\n\t\t\t{\n\t\t\t\tthis.collapse(nodeId);\n\t\t\t}\n\n\t\t\tOrgChartActions.moveSubordinatesToParent(nodeId);\n\t\t\tawait this.$nextTick();\n\t\t\tOrgChartActions.markDepartmentAsRemoved(nodeId);\n\t\t\tthis.focus(parentId, { expandAfterFocus: true });\n\t\t\tthis.moveTo(parentId);\n\t\t},\n\t\texpandDepartmentParents(nodeId: number): void\n\t\t{\n\t\t\tlet { parentId } = this.departments.get(nodeId);\n\t\t\twhile (parentId)\n\t\t\t{\n\t\t\t\tif (!this.expandedNodes.includes(parentId))\n\t\t\t\t{\n\t\t\t\t\tthis.expand(parentId);\n\t\t\t\t}\n\n\t\t\t\tparentId = this.departments.get(parentId).parentId;\n\t\t\t}\n\t\t},\n\t\texpandLowerDepartments(): void\n\t\t{\n\t\t\tlet expandLevel = 0;\n\t\t\tconst expandRecursively = (departmentId: number) => {\n\t\t\t\tconst { children = [] } = this.departments.get(departmentId);\n\t\t\t\tif (expandLevel === 4 || children.length === 0)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.expand(departmentId);\n\t\t\t\texpandLevel += 1;\n\t\t\t\tconst middleBound = Math.trunc(children.length / 2);\n\t\t\t\tconst childId = children[middleBound];\n\t\t\t\tif (this.departments.get(childId).children?.length > 0)\n\t\t\t\t{\n\t\t\t\t\texpandRecursively(childId);\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfor (let i = middleBound - 1; i >= 0; i--)\n\t\t\t\t{\n\t\t\t\t\tif (traverseSibling(children[i]))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfor (let i = middleBound + 1; i < children.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (traverseSibling(children[i]))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconst traverseSibling = (siblingId: number) => {\n\t\t\t\tconst { children: currentChildren = [] } = this.departments.get(siblingId);\n\n\t\t\t\tif (currentChildren.length > 0)\n\t\t\t\t{\n\t\t\t\t\texpandRecursively(siblingId);\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t};\n\t\t\texpandRecursively(this.rootId);\n\t\t},\n\t\tasync locateToCurrentDepartment(): Promise<void>\n\t\t{\n\t\t\t// currentDepartmentsLocated manipulation needed to cycle through current departments\n\t\t\tif (this.currentDepartmentsLocated.length === this.currentDepartments.length)\n\t\t\t{\n\t\t\t\tthis.currentDepartmentsLocated = [];\n\t\t\t}\n\t\t\tconst currentDepartment = this.currentDepartments.find((item) => !this.currentDepartmentsLocated.includes(item));\n\t\t\tif (!currentDepartment)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.currentDepartmentsLocated.push(currentDepartment);\n\t\t\tawait this.locateToDepartment(currentDepartment);\n\t\t\tOrgChartActions.searchUserInDepartment(this.userId);\n\t\t},\n\t\tasync locateToDepartment(nodeId: number): Promise<void>\n\t\t{\n\t\t\tthis.isLocatedDepartmentVisible = false;\n\t\t\tthis.expandDepartmentParents(nodeId);\n\t\t\tthis.focus(nodeId, { expandAfterFocus: true });\n\t\t\t// $nextTick makes sure that this.getTreeBounds() returns correct value when nodeId is not visible\n\t\t\tawait this.$nextTick();\n\t\t\tthis.isLocatedDepartmentVisible = true;\n\t\t\tawait this.moveTo(nodeId);\n\t\t},\n\t\tasync moveTo(nodeId: number): Promise<void>\n\t\t{\n\t\t\tawait this.$nextTick();\n\t\t\tconst treeRect = this.getTreeBounds();\n\t\t\tconst centerX = treeRect.x + treeRect.width / 2;\n\t\t\tconst centerY = treeRect.y + treeRect.height / 2;\n\t\t\tconst treeNode = this.treeNodes.get(nodeId);\n\t\t\tconst treeNodeRect = treeNode.getBoundingClientRect();\n\t\t\tthis.$emit('moveTo', {\n\t\t\t\tx: centerX - treeNodeRect.x - treeNodeRect.width / 2,\n\t\t\t\ty: centerY - treeNodeRect.y - treeNodeRect.height / 2,\n\t\t\t\tnodeId,\n\t\t\t});\n\t\t},\n\t\tloadHeads(departmentIds: number[]): void\n\t\t{\n\t\t\tconst store = useChartStore();\n\t\t\tstore.loadHeads(departmentIds);\n\t\t},\n\t\tsubscribeOnEvents(): void\n\t\t{\n\t\t\tthis.events = {\n\t\t\t\t[events.HR_DEPARTMENT_CONNECT]: this.onConnectDepartment,\n\t\t\t\t[events.HR_DEPARTMENT_DISCONNECT]: this.onDisconnectDepartment,\n\t\t\t\t[events.HR_DEPARTMENT_FOCUS]: this.onFocusDepartment,\n\t\t\t\t[events.HR_DRAG_ENTITY]: this.onDragEntity,\n\t\t\t\t[events.HR_DROP_ENTITY]: this.onDropEntity,\n\t\t\t\t[events.HR_ENTITY_TOGGLE_CONNECTORS]: this.onToggleConnectors,\n\t\t\t\t[events.HR_PUBLIC_FOCUS_NODE]: this.onPublicFocusNode,\n\t\t\t};\n\t\t\tObject.entries(this.events).forEach(([event, handle]) => {\n\t\t\t\tEventEmitter.subscribe(event, handle);\n\t\t\t});\n\t\t},\n\t\tunsubscribeFromEvents(): void\n\t\t{\n\t\t\tObject.entries(this.events).forEach(([event, handle]) => {\n\t\t\t\tEventEmitter.unsubscribe(event, handle);\n\t\t\t});\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"humanresources-tree\"\n\t\t\tv-if=\"departments.size > 0\"\n\t\t\tv-dnd=\"canvasTransform\"\n\t\t>\n\t\t\t<TreeNode\n\t\t\t\tclass=\"--root\"\n\t\t\t\t:key=\"rootId\"\n\t\t\t\t:nodeId=\"rootId\"\n\t\t\t\t:expandedNodes=\"[...expandedNodes]\"\n\t\t\t\t:canvasZoom=\"canvasTransform.zoom\"\n\t\t\t\t:currentDepartments=\"currentDepartments\"\n\t\t\t></TreeNode>\n\t\t\t<Connectors\n\t\t\t\tref=\"connectors\"\n\t\t\t\t:isLocatedDepartmentVisible=\"isLocatedDepartmentVisible\"\n\t\t\t\t:treeNodes=\"treeNodes\"\n\t\t\t></Connectors>\n\t\t</div>\n\t`,\n};\n","import { EventEmitter } from 'main.core.events';\nimport { detailPanelWidth, events } from '../consts';\n\n// @vue/component\nexport const TransformPanel = {\n\tname: 'transform-panel',\n\n\tprops:\n\t{\n\t\tmodelValue: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\temits: ['update:modelValue'],\n\n\tdata(): { selectedId: string; }\n\t{\n\t\treturn {\n\t\t\tselectedId: '',\n\t\t};\n\t},\n\n\tcomputed:\n\t{\n\t\tzoomInPercent(): string\n\t\t{\n\t\t\tconst percent = '<span class=\"humanresources-transform-panel__zoom_percent\">%</span>';\n\n\t\t\treturn `${(this.modelValue.zoom * 100).toFixed(0)}${percent}`;\n\t\t},\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.actions = Object.freeze({\n\t\t\tzoomIn: 'zoomIn',\n\t\t\tzoomOut: 'zoomOut',\n\t\t\tlocate: 'locate',\n\t\t\tnavigate: 'navigate',\n\t\t});\n\t},\n\n\tmethods:\n\t{\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tonZoom(zoomIn: boolean): void\n\t\t{\n\t\t\tconst leftBound = 0.2;\n\t\t\tconst rightBound = 3;\n\t\t\tlet direction = -1;\n\t\t\tif (zoomIn)\n\t\t\t{\n\t\t\t\tdirection = 1;\n\t\t\t\tthis.selectedId = this.actions.zoomIn;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.selectedId = this.actions.zoomOut;\n\t\t\t}\n\n\t\t\tconst zoom = Number((this.modelValue.zoom + leftBound * direction).toFixed(1));\n\t\t\tif (zoom < leftBound || zoom > rightBound)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// calibrate x and y according to viewpoint center\n\t\t\tconst treeRect = this.$parent.$refs.tree.getTreeBounds();\n\t\t\tconst centerX = (treeRect.width / 2) / this.modelValue.zoom - detailPanelWidth / 2;\n\t\t\tconst centerY = (treeRect.height / 2) / this.modelValue.zoom;\n\n\t\t\tconst oldCenterX = (centerX - this.modelValue.x) / this.modelValue.zoom;\n\t\t\tconst oldCenterY = (centerY - this.modelValue.y) / this.modelValue.zoom;\n\n\t\t\tconst x = centerX - oldCenterX * zoom;\n\t\t\tconst y = centerY - oldCenterY * zoom;\n\n\t\t\tthis.$emit('update:modelValue', { ...this.modelValue, zoom, x, y });\n\t\t},\n\t\tonLocate(): void\n\t\t{\n\t\t\tEventEmitter.emit(events.HR_ORG_CHART_LOCATE_TO_DEPARTMENT);\n\t\t\tthis.selectedId = this.actions.locate;\n\t\t},\n\t\tonfocusout(): void\n\t\t{\n\t\t\tthis.selectedId = '';\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"humanresources-transform-panel\" @focusout=\"onfocusout\" tabindex=\"-1\">\n\t\t\t<div\n\t\t\t\tclass=\"humanresources-transform-panel__locate\"\n\t\t\t\t:class=\"{ '--selected': selectedId === actions.locate }\"\n\t\t\t\t@click=\"onLocate\"\n\t\t\t>\n\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_TREE_LOCATE')}}\n\t\t\t</div>\n\t\t\t<div class=\"humanresources-transform-panel__separator\"></div>\n\t\t\t<div class=\"humanresources-transform-panel__zoom\">\n\t\t\t\t<svg\n\t\t\t\t\tviewBox=\"0 0 16 16\"\n\t\t\t\t\tfill=\"none\"\n\t\t\t\t\tclass=\"humanresources-transform-panel__icon --zoom-out\"\n\t\t\t\t\t:class=\"{ '--selected': selectedId === actions.zoomOut }\"\n\t\t\t\t\t@click=\"onZoom(false)\"\n\t\t\t\t>\n\t\t\t\t\t<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M4 8.66671V7.33337H7.33333H8.66667H12V8.66671H8.66667H7.33333H4Z\" fill=\"#6A737F\"/>\n\t\t\t\t</svg>\n\t\t\t\t<span v-html=\"zoomInPercent\"></span>\n\t\t\t\t<svg\n\t\t\t\t\tviewBox=\"0 0 16 16\"\n\t\t\t\t\tfill=\"none\"\n\t\t\t\t\tclass=\"humanresources-transform-panel__icon --zoom-in\"\n\t\t\t\t\t:class=\"{ '--selected': selectedId === actions.zoomIn }\"\n\t\t\t\t\t@click=\"onZoom(true)\"\n\t\t\t\t>\n\t\t\t\t\t<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M7.83333 4H9.16667V7.33333H12.5V8.66667H9.16667V12H7.83333V8.66667H4.5V7.33333H7.83333V4Z\" fill=\"#6A737F\"/>\n\t\t\t\t</svg>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","// @vue/component\nexport const DetailPanelCollapsedTitle = {\n\tname: 'detailPanelCollapsedTitle',\n\n\tprops:\n\t{\n\t\ttitle:\n\t\t{\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tavatars:\n\t\t{\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tcomputed:\n\t{\n\t\tmaxVisibleAvatarsCount(): Number\n\t\t{\n\t\t\treturn 2;\n\t\t},\n\t\tadditionalCount(): Number\n\t\t{\n\t\t\treturn this.avatars.length > this.maxVisibleAvatarsCount ? this.avatars.length - this.maxVisibleAvatarsCount : 0;\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"humanresources-detail-panel__collapsed-title\">\n\t\t\t<template v-for=\"(avatar, index) in avatars\">\n\t\t\t\t<img\n\t\t\t\t\tv-if=\"index < this.maxVisibleAvatarsCount\"\n\t\t\t\t\t:key=\"index\"\n\t\t\t\t\t:src=\"encodeURI(avatar)\"\n\t\t\t\t\tclass=\"humanresources-detail-panel__collapsed-title-avatar\"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<div\n\t\t\t\tv-if=\"avatars.length > maxVisibleAvatarsCount\"\n\t\t\t\tclass=\"humanresources-detail-panel__collapsed-title-avatar --additional\"\n\t\t\t>\n\t\t\t +{{ additionalCount }}\n\t\t\t</div>\n\t\t\t<div class=\"humanresources-detail-panel__title\">{{ title }}</div>\n\t\t</div>\n\t`,\n};\n","import { AnalyticsSourceType } from 'humanresources.company-structure.api';\nimport { BIcon, Set } from 'ui.icon-set.api.vue';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\nimport { RouteActionMenu } from 'humanresources.company-structure.structure-components';\nimport { EntityActionMenu } from '../menu/menu/entity-action-menu';\n\nimport '../../style.css';\nimport 'ui.icon-set.main';\nimport 'ui.icon-set.crm';\n\n/**\n * Component for displaying icon that shows EntityActionMenu\n */\n// @vue/component\nexport const DetailPanelEditButton = {\n\tname: 'detailPanelEditButton',\n\n\tcomponents: {\n\t\tBIcon,\n\t\tRouteActionMenu,\n\t},\n\n\tprops: {\n\t\tentityId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tentityType: {\n\t\t\ttype: String,\n\t\t\tdefault: EntityTypes.department,\n\t\t},\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tmenuVisible: false,\n\t\t};\n\t},\n\n\tcomputed: {\n\t\tset(): Set\n\t\t{\n\t\t\treturn Set;\n\t\t},\n\t\tmenu(): EntityActionMenu\n\t\t{\n\t\t\treturn new EntityActionMenu(this.entityId, this.entityType, AnalyticsSourceType.DETAIL);\n\t\t},\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tonActionMenuItemClick(actionId: string): void\n\t\t{\n\t\t\tthis.menu.onActionMenuItemClick(actionId);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tv-if=\"menu.items.length\"\n\t\t\tclass=\"humanresources-detail-panel__edit-button\"\n\t\t\t:class=\"{ '--focused': menuVisible }\"\n\t\t\t:ref=\"'detailPanelEditButton'\"\n\t\t\tdata-id=\"hr-department-detail-panel__edit-menu-button\"\n\t\t\t@click.stop=\"menuVisible = true\"\n\t\t>\n\t\t\t<BIcon\n\t\t\t\tclass=\"humanresources-detail-panel__edit-button-icon\"\n\t\t\t\t:name=\"set.MORE\"\n\t\t\t\t:size=\"20\"\n\t\t\t/>\n\t\t</div>\n\t\t<RouteActionMenu\n\t\t\tv-if=\"menuVisible\"\n\t\t\tid=\"department-detail-content-edit-menu\"\n\t\t\t:items=\"menu.items\"\n\t\t\t:width=\"302\"\n\t\t\t:bindElement=\"$refs.detailPanelEditButton\"\n\t\t\t@action=\"onActionMenuItemClick\"\n\t\t\t@close=\"menuVisible = false\"\n\t\t/>\n\t`,\n};\n","import { EntityTypes } from 'humanresources.company-structure.utils';\nimport { DetailPanelCollapsedTitle } from './detail-panel-collapsed-title';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { mapState } from 'ui.vue3.pinia';\nimport { getMemberRoles, type MemberRolesType } from 'humanresources.company-structure.api';\nimport { DepartmentContent } from 'humanresources.company-structure.department-content';\nimport { Hint } from 'humanresources.company-structure.structure-components';\nimport { DetailPanelEditButton } from './detail-panel-edit-button';\n\nimport './style.css';\n\n// @vue/component\nexport const DetailPanel = {\n\tname: 'detailPanel',\n\n\tcomponents: { DepartmentContent, DetailPanelCollapsedTitle, DetailPanelEditButton },\n\n\tdirectives: { hint: Hint },\n\n\tprops: {\n\t\tpreventPanelSwitch: Boolean,\n\t\tmodelValue: Boolean,\n\t},\n\n\temits: ['showWizard', 'removeDepartment', 'update:modelValue'],\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\ttitle: '',\n\t\t\tisTeamEntity: false,\n\t\t\tteamColor: null,\n\t\t\tisCollapsed: true,\n\t\t\tisLoading: true,\n\t\t\tneedToShowLoader: false,\n\t\t};\n\t},\n\n\tcomputed:\n\t{\n\t\t...mapState(useChartStore, ['focusedNode', 'departments']),\n\t\tdefaultAvatar(): String\n\t\t{\n\t\t\treturn '/bitrix/js/humanresources/company-structure/org-chart/src/images/default-user.svg';\n\t\t},\n\t\theadAvatarsArray(): Array\n\t\t{\n\t\t\tconst heads = this.departments.get(this.focusedNode).heads ?? [];\n\n\t\t\treturn heads\n\t\t\t\t?.filter((employee) => employee.role === this.memberRoles.head)\n\t\t\t\t?.map((employee) => employee.avatar || this.defaultAvatar) ?? []\n\t\t\t;\n\t\t},\n\t\tentityType(): string\n\t\t{\n\t\t\treturn this.departments.get(this.focusedNode).entityType;\n\t\t},\n\t\tmemberRoles(): MemberRolesType\n\t\t{\n\t\t\treturn getMemberRoles(this.entityType);\n\t\t},\n\t},\n\n\twatch: {\n\t\tfocusedNode(newId: number, oldId: number): void\n\t\t{\n\t\t\tthis.updateDetailPageHandler(newId, oldId);\n\t\t},\n\t\tmodelValue(collapsed: boolean): void\n\t\t{\n\t\t\tthis.isCollapsed = collapsed;\n\t\t},\n\t\tdepartments: {\n\t\t\thandler(newDepartments): void\n\t\t\t{\n\t\t\t\tconst department = newDepartments.get(this.focusedNode);\n\t\t\t\tif (department)\n\t\t\t\t{\n\t\t\t\t\tthis.title = department.name ?? '';\n\t\t\t\t}\n\t\t\t},\n\t\t\tdeep: true,\n\t\t},\n\t},\n\n\tmethods:\n\t{\n\t\ttoggleCollapse(): void\n\t\t{\n\t\t\tthis.$emit('update:modelValue', !this.isCollapsed);\n\t\t},\n\t\tupdateDetailPageHandler(nodeId: number, oldId: number): void\n\t\t{\n\t\t\tif (!this.preventPanelSwitch && oldId !== 0)\n\t\t\t{\n\t\t\t\tthis.$emit('update:modelValue', false);\n\t\t\t}\n\n\t\t\tthis.isLoading = true;\n\t\t\tconst department = this.departments.get(nodeId);\n\n\t\t\tthis.isTeamEntity = department.entityType === EntityTypes.team;\n\t\t\tthis.title = department.name ?? '';\n\t\t\tthis.teamColor = department.teamColor ?? null;\n\t\t\tthis.isLoading = false;\n\t\t},\n\t\tshowLoader(): void\n\t\t{\n\t\t\tthis.needToShowLoader = true;\n\t\t},\n\t\thideLoader(): void\n\t\t{\n\t\t\tthis.needToShowLoader = false;\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\t:class=\"['humanresources-detail-panel', { '--collapsed': isCollapsed }]\"\n\t\t\tv-on=\"isCollapsed ? { click: toggleCollapse } : {}\"\n\t\t\tdata-id=\"hr-department-detail-panel__container\"\n\t\t>\n\t\t\t<div\n\t\t\t\tv-if=\"!isLoading\"\n\t\t\t\tclass=\"humanresources-detail-panel-container\"\n\t\t\t\t:class=\"{ '--hide': needToShowLoader && !isCollapsed }\"\n\t\t\t>\n\t\t\t\t<div class=\"humanresources-detail-panel__head\" \n\t\t\t\t\t :class=\"{ '--team': isTeamEntity, '--collapsed': isCollapsed }\"\n\t\t\t\t\t :style=\"{ '--team-head-background': teamColor?.treeHeadBackground }\"\n\t\t\t\t>\n\t\t\t\t\t<span\n\t\t\t\t\t\tv-if=\"!isCollapsed\"\n\t\t\t\t\t\tv-hint\n\t\t\t\t\t\tclass=\"humanresources-detail-panel__title\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ title }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<DetailPanelCollapsedTitle\n\t\t\t\t\t\tv-else\n\t\t\t\t\t\t:title=\"title\"\n\t\t\t\t\t\t:avatars=\"headAvatarsArray\"\n\t\t\t\t\t>\n\t\t\t\t\t</DetailPanelCollapsedTitle>\n\t\t\t\t\t<div class=\"humanresources-detail-panel__header_buttons_container\">\n\t\t\t\t\t\t<DetailPanelEditButton\n\t\t\t\t\t\t\tv-if=\"!isCollapsed\"\n\t\t\t\t\t\t\t:entityId=\"focusedNode\"\n\t\t\t\t\t\t\t:entityType=\"entityType\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"humanresources-detail-panel__collapse_button --icon\"\n\t\t\t\t\t\t\t@click=\"toggleCollapse\"\n\t\t\t\t\t\t\t:class=\"{ '--collapsed': isCollapsed }\"\n\t\t\t\t\t\t\tdata-id=\"hr-department-detail-panel__collapse-button\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"humanresources-detail-panel__content\" v-show=\"!isCollapsed\">\n\t\t\t\t\t<DepartmentContent\n\t\t\t\t\t\t@showDetailLoader=\"showLoader\"\n\t\t\t\t\t\t@hideDetailLoader=\"hideLoader\"\n\t\t\t\t\t\t:isCollapsed=\"isCollapsed\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if=\"needToShowLoader && !isCollapsed\" class=\"humanresources-detail-panel-loader-container\"/>\n\t\t</div>\n\t`,\n};\n","import 'ui.buttons';\nimport 'ui.forms';\nimport './style.css';\nimport { chartAPI } from '../../api';\nimport { events } from '../../consts';\nimport { BIcon, Set } from 'ui.icon-set.api.vue';\nimport type { FirstPopupData } from '../../types';\n\n// @vue/component\nexport const FirstPopup = {\n\tname: 'FirstPopup',\n\tcomponents: {\n\t\tBIcon,\n\t},\n\n\tdata(): FirstPopupData\n\t{\n\t\treturn {\n\t\t\tshow: false,\n\t\t\ttitle: '',\n\t\t\tdescription: '',\n\t\t\tsubDescription: '',\n\t\t\tfeatures: [],\n\t\t};\n\t},\n\n\tcomputed:\n\t{\n\t\tset(): Set\n\t\t{\n\t\t\treturn Set;\n\t\t},\n\t},\n\n\tasync mounted(): Promise<void>\n\t{\n\t\tthis.title = this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_TITLE');\n\t\tthis.description = this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_DESCRIPTION');\n\t\tthis.subDescription = this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_SUB_DESCRIPTION');\n\t\tthis.features = [\n\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_FEATURE_1'),\n\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_FEATURE_2'),\n\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_FEATURE_3'),\n\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_FEATURE_4'),\n\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_FEATURE_5'),\n\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_FEATURE_6'),\n\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_FEATURE_7'),\n\t\t];\n\n\t\tconst { firstTimeOpened } = await chartAPI.getDictionary();\n\t\tthis.show = firstTimeOpened === 'N' && this.title.length > 0;\n\t},\n\n\tmethods: {\n\t\tclosePopup(): void\n\t\t{\n\t\t\tchartAPI.firstTimeOpened();\n\t\t\tthis.show = false;\n\t\t\ttop.BX.Event.EventEmitter.emit(events.HR_FIRST_POPUP_SHOW);\n\t\t},\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div v-if=\"show\" class=\"first-popup\">\n\t\t\t<div class=\"first-popup-overlay\" @click=\"closePopup\"></div>\n\t\t\t<div class=\"first-popup-content\">\n\t\t\t\t<div class=\"title\">{{ title }}</div>\n\t\t\t\t<div class=\"first-popup-left\">\n\t\t\t\t\t<p class=\"description\">{{ description }}</p>\n\t\t\t\t\t<p class=\"sub-description\">{{ subDescription }}</p>\n\t\t\t\t\t<div class=\"first-popup-list\">\n\t\t\t\t\t\t<div class=\"first-popup-list-item\" v-for=\"(feature, index) in features\" :key=\"index\">\n\t\t\t\t\t\t\t<div class=\"first-popup-list-item-point\">•</div>\n\t\t\t\t\t\t\t<div class=\"first-popup-list-item-feature\">{{ feature }}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<button class=\"ui-btn ui-btn-success first-popup-ui-btn\" @click=\"closePopup\">\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_BUTTON_START') }}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"first-popup-right\">\n\t\t\t\t\t<video\n\t\t\t\t\t\tsrc=\"/bitrix/js/humanresources/company-structure/org-chart/src/components/first-popup/images/preview.webm\"\n\t\t\t\t\t\tautoplay\n\t\t\t\t\t\tloop\n\t\t\t\t\t\tmuted\n\t\t\t\t\t\tplaysinline\n\t\t\t\t\t\tclass=\"first-popup-animation\"\n\t\t\t\t\t></video>\n\t\t\t\t</div>\n\t\t\t\t<BIcon :name=\"set.CROSS_25\" :size=\"24\" class=\"first-popup-close\" @click=\"closePopup\"></BIcon>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { EventEmitter, type BaseEvent } from 'main.core.events';\nimport { Confetti } from 'ui.confetti';\nimport { mapState } from 'ui.vue3.pinia';\nimport { TransformCanvas } from 'ui.canvas';\nimport { AnalyticsSourceType } from 'humanresources.company-structure.api';\nimport { TitlePanel } from './components/title-panel/title-panel';\nimport { Tree } from './components/tree/tree';\nimport { TransformPanel } from './components/transfrom-panel';\nimport { DetailPanel } from './components/detail-panel/detail-panel';\nimport { FirstPopup } from './components/first-popup/first-popup';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { ChartWizard } from 'humanresources.company-structure.chart-wizard';\nimport { getInvitedUserData } from 'humanresources.company-structure.utils';\nimport { chartAPI } from './api';\nimport { events, detailPanelWidth } from './consts';\nimport { OrgChartActions } from './actions';\nimport { sendData as analyticsSendData } from 'ui.analytics';\n\nimport type { ChartData } from './types';\nimport './style.css';\nimport 'ui.design-tokens';\n\n// @vue/component\nexport const Chart = {\n\tcomponents: {\n\t\tTransformCanvas,\n\t\tTree,\n\t\tTransformPanel,\n\t\tChartWizard,\n\t\tFirstPopup,\n\t\tDetailPanel,\n\t\tTitlePanel,\n\t},\n\n\tdata(): ChartData\n\t{\n\t\treturn {\n\t\t\tcanvas: {\n\t\t\t\tshown: false,\n\t\t\t\tmoved: false,\n\t\t\t\tmodelTransform: {\n\t\t\t\t\tx: 0,\n\t\t\t\t\ty: 0,\n\t\t\t\t\tzoom: 0.3,\n\t\t\t\t},\n\t\t\t},\n\t\t\twizard: {\n\t\t\t\tshown: false,\n\t\t\t\tisEditMode: false,\n\t\t\t\tshowEntitySelector: true,\n\t\t\t\tentity: '',\n\t\t\t\tnodeId: 0,\n\t\t\t\tsource: '',\n\t\t\t},\n\t\t\tdetailPanel: {\n\t\t\t\tcollapsed: true,\n\t\t\t\tpreventSwitch: false,\n\t\t\t},\n\t\t\t// so we block all controls until transition isn't completed\n\t\t\tisTransitionCompleted: false,\n\t\t};\n\t},\n\n\tcomputed:\n\t{\n\t\trootId(): number\n\t\t{\n\t\t\tconst { id: rootId } = [...this.departments.values()].find((department) => {\n\t\t\t\treturn department.parentId === 0;\n\t\t\t});\n\n\t\t\treturn rootId;\n\t\t},\n\t\t...mapState(useChartStore, ['departments', 'currentDepartments']),\n\t},\n\n\tasync created(): Promise<void>\n\t{\n\t\tconst slider = BX.SidePanel.Instance.getTopSlider();\n\t\tslider?.showLoader();\n\t\tconst [departments, currentDepartments, userId] = await Promise.all([\n\t\t\tchartAPI.getDepartmentsData(),\n\t\t\tchartAPI.getCurrentDepartments(),\n\t\t\tchartAPI.getUserId(),\n\t\t]);\n\t\tslider?.closeLoader();\n\t\tconst parsedDepartments = chartAPI.createTreeDataStore(departments);\n\t\tconst availableDepartments = currentDepartments.filter((item) => parsedDepartments.has(item));\n\t\tOrgChartActions.applyData(parsedDepartments, availableDepartments, userId);\n\t\tthis.rootOffset = 100;\n\t\tthis.transformCanvas();\n\t\tthis.canvas.shown = true;\n\t\tthis.showConfetti = false;\n\t\tEventEmitter.subscribe(events.HR_DEPARTMENT_SLIDER_ON_MESSAGE, this.handleInviteSliderMessage);\n\t\tBX.PULL.subscribe({\n\t\t\ttype: BX.PullClient.SubscriptionType.Server,\n\t\t\tmoduleId: 'humanresources',\n\t\t\tcommand: 'linkChatsToNodes',\n\t\t\tcallback: (data) => this.clearChatLists(data),\n\t\t});\n\t\tEventEmitter.subscribe(events.HR_ENTITY_SHOW_WIZARD, this.showWizardEventHandler);\n\t\tEventEmitter.subscribe(events.HR_ENTITY_REMOVE, this.removeDepartmentEventHandler);\n\t\tEventEmitter.subscribe(events.HR_ORG_CHART_TRANSFORM_CANVAS, this.onCanvasTransformWhenDragging);\n\t\tEventEmitter.subscribe(events.HR_ORG_CHART_LOCATE_TO_DEPARTMENT, this.onLocate);\n\t},\n\n\tunmounted(): void\n\t{\n\t\tEventEmitter.unsubscribe(events.HR_DEPARTMENT_SLIDER_ON_MESSAGE, this.handleInviteSliderMessage);\n\t\tEventEmitter.unsubscribe(events.HR_ENTITY_SHOW_WIZARD, this.showWizardEventHandler);\n\t\tEventEmitter.unsubscribe(events.HR_ENTITY_REMOVE, this.removeDepartmentEventHandler);\n\t\tEventEmitter.unsubscribe(events.HR_ORG_CHART_TRANSFORM_CANVAS, this.onCanvasTransformWhenDragging);\n\t\tEventEmitter.unsubscribe(events.HR_ORG_CHART_LOCATE_TO_DEPARTMENT, this.onLocate);\n\t},\n\n\tmethods:\n\t{\n\t\tonMoveTo({ x, y, nodeId }: { x: Number; y: Number; nodeId: Number; }): void\n\t\t{\n\t\t\tconst { x: prevX, y: prevY, zoom } = this.canvas.modelTransform;\n\t\t\tconst detailPanelWidthZoomed = detailPanelWidth * zoom;\n\t\t\tconst newX = x - detailPanelWidthZoomed / 2;\n\t\t\tconst newY = nodeId === this.rootId ? this.rootOffset : y / zoom;\n\t\t\tconst samePoint = Math.round(newX) === Math.round(prevX) && Math.round(y) === Math.round(prevY);\n\t\t\tthis.detailPanel = {\n\t\t\t\t...this.detailPanel,\n\t\t\t\tcollapsed: false,\n\t\t\t};\n\t\t\tif (samePoint)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.canvas = {\n\t\t\t\t...this.canvas,\n\t\t\t\tmoved: true,\n\t\t\t\tmodelTransform: { ...this.canvas.modelTransform, x: newX / zoom, y: newY, zoom: 1 },\n\t\t\t};\n\t\t\tthis.onUpdateTransform();\n\t\t},\n\t\tonLocate({ data }: BaseEvent): void\n\t\t{\n\t\t\tif (data.nodeId)\n\t\t\t{\n\t\t\t\tthis.$refs.tree.locateToDepartment(data.nodeId);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$refs.tree.locateToCurrentDepartment();\n\t\t},\n\t\tshowWizardEventHandler({ data }: BaseEvent): void\n\t\t{\n\t\t\tthis.onShowWizard(data);\n\t\t},\n\t\tonShowWizard({\n\t\t\tnodeId = 0,\n\t\t\tisEditMode = false,\n\t\t\ttype,\n\t\t\tshowEntitySelector = true,\n\t\t\tsource = '',\n\t\t\tentityType,\n\t\t\trefToFocus,\n\t\t}: { nodeId: number; isEditMode: boolean, showEntitySelector: boolean, source: string } = {}): void\n\t\t{\n\t\t\tthis.wizard = {\n\t\t\t\t...this.wizard,\n\t\t\t\tshown: true,\n\t\t\t\tisEditMode,\n\t\t\t\tshowEntitySelector,\n\t\t\t\tentity: type,\n\t\t\t\tnodeId,\n\t\t\t\tsource,\n\t\t\t\tentityType,\n\t\t\t\trefToFocus,\n\t\t\t};\n\n\t\t\tif (!isEditMode && source !== AnalyticsSourceType.HEADER)\n\t\t\t{\n\t\t\t\tanalyticsSendData({\n\t\t\t\t\ttool: 'structure',\n\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\tevent: 'create_dept_step1',\n\t\t\t\t\tc_element: source,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// eslint-disable-next-line default-case\n\t\t\tswitch (type)\n\t\t\t{\n\t\t\t\tcase 'department':\n\t\t\t\t\tanalyticsSendData({\n\t\t\t\t\t\ttool: 'structure',\n\t\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\t\tevent: 'create_dept_step1',\n\t\t\t\t\t\tc_element: source,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'employees':\n\t\t\t\t\tanalyticsSendData({\n\t\t\t\t\t\ttool: 'structure',\n\t\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\t\tevent: 'create_dept_step2',\n\t\t\t\t\t\tc_element: source,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'bindChat':\n\t\t\t\t\tanalyticsSendData({\n\t\t\t\t\t\ttool: 'structure',\n\t\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\t\tevent: 'create_dept_step3',\n\t\t\t\t\t\tc_element: source,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'teamRights':\n\t\t\t\t\tanalyticsSendData({\n\t\t\t\t\t\ttool: 'structure',\n\t\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\t\tevent: 'create_dept_step4',\n\t\t\t\t\t\tc_element: source,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t},\n\t\tonModifyTree({ id, showConfetti }): void\n\t\t{\n\t\t\tthis.showConfetti = showConfetti ?? false;\n\t\t\tconst { tree } = this.$refs;\n\t\t\ttree.locateToDepartment(id);\n\t\t},\n\t\tonWizardClose(): void\n\t\t{\n\t\t\tthis.wizard.shown = false;\n\t\t},\n\t\tremoveDepartmentEventHandler({ data }: BaseEvent): void\n\t\t{\n\t\t\tthis.onRemoveDepartment(data.nodeId, data.entityType);\n\t\t},\n\t\tonRemoveDepartment(nodeId: number, entityType: string): void\n\t\t{\n\t\t\tconst { tree } = this.$refs;\n\t\t\ttree.tryRemoveDepartment(nodeId, entityType);\n\t\t},\n\t\tasync onTransitionEnd(): Promise<void>\n\t\t{\n\t\t\tif (this.canvas.moved)\n\t\t\t{\n\t\t\t\tthis.isTransitionCompleted = true;\n\t\t\t}\n\n\t\t\tthis.canvas.moved = false;\n\t\t\tif (!this.showConfetti)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isTransitionCompleted = false;\n\t\t\tconst promise = Confetti.fire({\n\t\t\t\tparticleCount: 300,\n\t\t\t\tstartVelocity: 10,\n\t\t\t\tspread: 400,\n\t\t\t\tticks: 100,\n\t\t\t\torigin: { y: 0.4, x: 0.37 },\n\t\t\t});\n\t\t\tthis.showConfetti = false;\n\t\t\tawait promise;\n\t\t\tthis.isTransitionCompleted = true;\n\t\t},\n\t\tonControlDetail({ showEmployees, preventSwitch }): void\n\t\t{\n\t\t\tthis.detailPanel = {\n\t\t\t\t...this.detailPanel,\n\t\t\t\tpreventSwitch,\n\t\t\t};\n\t\t\tif (!showEmployees)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.detailPanel = {\n\t\t\t\t...this.detailPanel,\n\t\t\t\tcollapsed: false,\n\t\t\t};\n\t\t},\n\t\ttransformCanvas(): void\n\t\t{\n\t\t\tconst { zoom } = this.canvas.modelTransform;\n\t\t\tconst { offsetWidth, offsetHeight } = this.$el;\n\t\t\tconst [currentDepartment] = this.currentDepartments;\n\t\t\tconst y = currentDepartment === this.rootId ? this.rootOffset : offsetHeight / 2 - (offsetHeight * zoom) / 2;\n\t\t\tthis.canvas.modelTransform = {\n\t\t\t\t...this.canvas.modelTransform,\n\t\t\t\tx: offsetWidth / 2 - (offsetWidth * zoom) / 2,\n\t\t\t\ty,\n\t\t\t};\n\t\t},\n\t\tonUpdateTransform(): void\n\t\t{\n\t\t\tEventEmitter.emit(events.INTRANET_USER_MINIPROFILE_CLOSE);\n\t\t\tEventEmitter.emit(events.HR_DEPARTMENT_MENU_CLOSE);\n\t\t},\n\t\thandleInviteSliderMessage(event: BaseEvent): void\n\t\t{\n\t\t\tconst [messageEvent] = event.getData();\n\t\t\tconst eventId = messageEvent.getEventId();\n\t\t\tif (eventId !== 'BX.Intranet.Invitation:onAdd')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { users } = messageEvent.getData();\n\t\t\tusers.forEach((user) => {\n\t\t\t\tconst invitedUserData = getInvitedUserData(user);\n\t\t\t\tOrgChartActions.inviteUser(invitedUserData);\n\t\t\t});\n\t\t},\n\t\tclearChatLists(data): void\n\t\t{\n\t\t\tconst nodeIds = Object.keys(data).map((key) => Number(key));\n\t\t\tOrgChartActions.clearNodesChatLists(nodeIds);\n\t\t},\n\t\tonKeyDown(event: KeyboardEvent): void\n\t\t{\n\t\t\tif (!this.isTransitionCompleted)\n\t\t\t{\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t},\n\t\tonCanvasTransformWhenDragging({ data }: BaseEvent): void\n\t\t{\n\t\t\tconst { directionX, directionY, speed } = data;\n\t\t\tif (directionX !== 0)\n\t\t\t{\n\t\t\t\tthis.canvas.modelTransform.x += -directionX * speed;\n\t\t\t}\n\n\t\t\tif (directionY !== 0)\n\t\t\t{\n\t\t\t\tthis.canvas.modelTransform.y += -directionY * speed;\n\t\t\t}\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"humanresources-chart\"\n\t\t\t:class=\"{ '--locked': !isTransitionCompleted }\"\n\t\t\t@keydown=\"onKeyDown\"\n\t\t>\n\t\t\t<TitlePanel @showWizard=\"onShowWizard\"></TitlePanel>\n\t\t\t<TransformCanvas\n\t\t\t\tv-if=\"canvas.shown\"\n\t\t\t\tv-slot=\"{transform}\"\n\t\t\t\tv-model=\"canvas.modelTransform\"\n\t\t\t\t@update:modelValue=\"onUpdateTransform\"\n\t\t\t\t:class=\"{ '--moved': canvas.moved }\"\n\t\t\t\t@transitionend=\"onTransitionEnd\"\n\t\t\t>\n\t\t\t\t<Tree\n\t\t\t\t\t:canvasTransform=\"transform\"\n\t\t\t\t\tref=\"tree\"\n\t\t\t\t\t@moveTo=\"onMoveTo\"\n\t\t\t\t\t@showWizard=\"onShowWizard\"\n\t\t\t\t\t@controlDetail=\"onControlDetail\"\n\t\t\t\t></Tree>\n\t\t\t</TransformCanvas>\n\t\t\t<DetailPanel\n\t\t\t\t@showWizard=\"onShowWizard\"\n\t\t\t\t@removeDepartment=\"onRemoveDepartment\"\n\t\t\t\tv-model=\"detailPanel.collapsed\"\n\t\t\t\t:preventPanelSwitch=\"detailPanel.preventSwitch\"\n\t\t\t></DetailPanel>\n\t\t\t<TransformPanel\n\t\t\t\tv-model=\"canvas.modelTransform\"\n\t\t\t></TransformPanel>\n\t\t\t<ChartWizard\n\t\t\t\tv-if=\"wizard.shown\"\n\t\t\t\t:nodeId=\"wizard.nodeId\"\n\t\t\t\t:isEditMode=\"wizard.isEditMode\"\n\t\t\t\t:showEntitySelector=\"wizard.showEntitySelector\"\n\t\t\t\t:entity=\"wizard.entity\"\n\t\t\t\t:entityType=\"wizard.entityType\"\n\t\t\t\t:source=\"wizard.source\"\n\t\t\t\t:refToFocus=\"wizard.refToFocus\"\n\t\t\t\t@modifyTree=\"onModifyTree\"\n\t\t\t\t@close=\"onWizardClose\"\n\t\t\t></ChartWizard>\n\t\t\t<FirstPopup></FirstPopup>\n\t\t\t<div class=\"humanresources-chart__back\"></div>\n\t\t</div>\n\t`,\n};\n","import { AbstractActionMenu } from '../abstract-action-menu';\nimport { AddEmployeeMenuItem } from '../items/employees/add-employee-menu-item';\nimport { EditEmployeesMenuItem } from '../items/department/edit-employees-menu-item';\n\nexport class UsersTabActionMenu extends AbstractActionMenu\n{\n\tconstructor(entityId: number, analyticSource: string, role: string, entityType: string)\n\t{\n\t\tsuper(entityId);\n\t\tthis.analyticSource = analyticSource;\n\t\tthis.role = role;\n\t\tthis.entityType = entityType;\n\t\tthis.items = this.getFilteredItems();\n\t}\n\n\tgetItems(): Array\n\t{\n\t\treturn [\n\t\t\tnew AddEmployeeMenuItem(this.entityType, this.role),\n\t\t\tnew EditEmployeesMenuItem(this.entityType, this.role),\n\t\t];\n\t}\n}\n","import { EntityTypes } from 'humanresources.company-structure.utils';\nimport { AbstractActionMenu } from '../abstract-action-menu';\nimport { AddEmployeeMenuItem } from '../items/employees/add-employee-menu-item';\nimport { MoveEmployeeMenuItem } from '../items/employees/move-employee-menu-item';\nimport { UserInviteMenuItem } from '../items/employees/user-invite-menu-item';\n\nexport class EmptyUsersTabActionMenu extends AbstractActionMenu\n{\n\tconstructor(entityId: number, analyticSource: string, role: string, entityType: string)\n\t{\n\t\tsuper(entityId);\n\t\tthis.entityType = entityType;\n\t\tthis.analyticSource = analyticSource;\n\t\tthis.role = role;\n\t\tthis.items = this.getFilteredItems();\n\t}\n\n\tgetItems(): Array\n\t{\n\t\tif (this.entityType === EntityTypes.team)\n\t\t{\n\t\t\treturn [\n\t\t\t\tnew AddEmployeeMenuItem(this.entityType, this.role),\n\t\t\t];\n\t\t}\n\n\t\treturn [\n\t\t\tnew MoveEmployeeMenuItem(),\n\t\t\tnew UserInviteMenuItem(),\n\t\t\tnew AddEmployeeMenuItem(this.entityType, this.role),\n\t\t];\n\t}\n}\n","import type { PermissionCheckerClass } from 'humanresources.company-structure.permission-checker';\nimport { PermissionActions } from 'humanresources.company-structure.permission-checker';\nimport { getColorCode } from 'humanresources.company-structure.utils';\nimport { Loc } from 'main.core';\nimport { Main } from 'ui.icon-set.api.core';\nimport { AbstractMenuItem } from '../abstract-menu-item';\nimport { MenuActions } from '../../menu-actions';\n\nexport class FireUserFromCompanyMenuItem extends AbstractMenuItem\n{\n\tconstructor(isUserInvited: boolean)\n\t{\n\t\tsuper({\n\t\t\tid: MenuActions.fireUserFromCompany,\n\t\t\ttitle: isUserInvited\n\t\t\t\t? Loc.getMessage(\n\t\t\t\t\t'HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_DELETE_FROM_COMPANY_TITLE',\n\t\t\t\t)\n\t\t\t\t: Loc.getMessage(\n\t\t\t\t\t'HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_FIRE_FROM_COMPANY_TITLE',\n\t\t\t\t),\n\t\t\tdescription: Loc.getMessage(\n\t\t\t\t'HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_FIRE_FROM_COMPANY_SUBTITLE_MSGVER_1',\n\t\t\t),\n\t\t\tbIcon: {\n\t\t\t\tname: Main.PERSONS_DENY,\n\t\t\t\tsize: 20,\n\t\t\t\tcolor: getColorCode('paletteRed40'),\n\t\t\t},\n\t\t\tpermissionAction: isUserInvited ? '' : PermissionActions.employeeFire,\n\t\t\tdataTestId: 'hr-department-detail-content__user-list_fire-user-from-department',\n\t\t});\n\t}\n\n\thasPermission(permissionChecker: PermissionCheckerClass, entityId: number): boolean\n\t{\n\t\treturn permissionChecker.hasPermissionOfAction(this.permissionAction);\n\t}\n}\n","import type { PermissionCheckerClass } from 'humanresources.company-structure.permission-checker';\nimport { PermissionActions } from 'humanresources.company-structure.permission-checker';\nimport { EntityTypes, getColorCode } from 'humanresources.company-structure.utils';\nimport { Loc } from 'main.core';\nimport { Main } from 'ui.icon-set.api.core';\nimport { AbstractMenuItem } from '../abstract-menu-item';\nimport { MenuActions } from '../../menu-actions';\n\nexport class MoveFromDepartmentMenuItem extends AbstractMenuItem\n{\n\tconstructor(entityType: string)\n\t{\n\t\tconst title = entityType === EntityTypes.team\n\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_MOVE_TO_ANOTHER_TEAM_TITLE')\n\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_TITLE')\n\t\t;\n\n\t\tconst description = entityType === EntityTypes.team\n\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_MOVE_TO_ANOTHER_TEAM_SUBTITLE')\n\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_SUBTITLE')\n\t\t;\n\n\t\tsuper({\n\t\t\tid: MenuActions.moveUserToAnotherDepartment,\n\t\t\ttitle,\n\t\t\tdescription,\n\t\t\tbIcon: {\n\t\t\t\tname: Main.PERSON_ARROW_LEFT_1,\n\t\t\t\tsize: 20,\n\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t},\n\t\t\tpermissionAction: null,\n\t\t\tdataTestId: 'hr-department-detail-content__user-list_move-from-department',\n\t\t});\n\n\t\tthis.entityType = entityType;\n\t}\n\n\thasPermission(permissionChecker: PermissionCheckerClass, entityId: number): boolean\n\t{\n\t\tconst permissions = permissionChecker.currentUserPermissions;\n\n\t\tconst addMemberPermissionAction = this.entityType === EntityTypes.team\n\t\t\t? PermissionActions.teamAddMember\n\t\t\t: PermissionActions.employeeAddToDepartment\n\t\t;\n\n\t\tconst removeMemberPermissionAction = this.entityType === EntityTypes.team\n\t\t\t? PermissionActions.teamRemoveMember\n\t\t\t: PermissionActions.employeeRemoveFromDepartment\n\t\t;\n\n\t\tconst addMemberPermissionValue = this.entityType === EntityTypes.team\n\t\t\t? permissions.ACTION_TEAM_MEMBER_ADD\n\t\t\t: permissions.ACTION_EMPLOYEE_ADD_TO_DEPARTMENT\n\t\t;\n\n\t\tconst removeMemberPermissionValue = this.entityType === EntityTypes.team\n\t\t\t? permissions.ACTION_TEAM_MEMBER_REMOVE\n\t\t\t: permissions.ACTION_EMPLOYEE_REMOVE_FROM_DEPARTMENT\n\t\t;\n\n\t\tconst moveUserPermission = addMemberPermissionValue < removeMemberPermissionValue\n\t\t\t? addMemberPermissionAction\n\t\t\t: removeMemberPermissionAction\n\t\t;\n\n\t\treturn permissionChecker.hasPermission(moveUserPermission, entityId);\n\t}\n}\n","import { PermissionActions } from 'humanresources.company-structure.permission-checker';\nimport { EntityTypes, getColorCode } from 'humanresources.company-structure.utils';\nimport { Loc } from 'main.core';\nimport { Main } from 'ui.icon-set.api.core';\nimport { AbstractMenuItem } from '../abstract-menu-item';\nimport { MenuActions } from '../../menu-actions';\n\nexport class RemoveFromDepartmentMenuItem extends AbstractMenuItem\n{\n\tconstructor(entityType: string)\n\t{\n\t\tconst title = entityType === EntityTypes.team\n\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_REMOVE_FROM_TEAM_TITLE')\n\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_REMOVE_FROM_DEPARTMENT_TITLE')\n\t\t;\n\n\t\tconst description = entityType === EntityTypes.team\n\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_REMOVE_FROM_TEAM_SUBTITLE')\n\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_REMOVE_FROM_DEPARTMENT_SUBTITLE')\n\t\t;\n\n\t\tconst color = entityType === EntityTypes.team\n\t\t\t? getColorCode('paletteRed40')\n\t\t\t: getColorCode('paletteBlue50')\n\t\t;\n\n\t\tconst permissionAction = entityType === EntityTypes.team\n\t\t\t? PermissionActions.teamRemoveMember\n\t\t\t: PermissionActions.employeeRemoveFromDepartment\n\t\t;\n\n\t\tsuper({\n\t\t\tid: MenuActions.removeUserFromDepartment,\n\t\t\ttitle,\n\t\t\tdescription,\n\t\t\tbIcon: {\n\t\t\t\tname: Main.TRASH_BIN,\n\t\t\t\tsize: 20,\n\t\t\t\tcolor,\n\t\t\t},\n\t\t\tpermissionAction,\n\t\t\tdataTestId: 'hr-department-detail-content__user-list_remove-from-department',\n\t\t});\n\t}\n}\n","import { EntityTypes } from 'humanresources.company-structure.utils';\nimport { AbstractActionMenu } from '../abstract-action-menu';\nimport { FireUserFromCompanyMenuItem } from '../items/user-item/fire-user-from-company';\nimport { MoveFromDepartmentMenuItem } from '../items/user-item/move-from-department';\nimport { RemoveFromDepartmentMenuItem } from '../items/user-item/remove-from-department';\n\nexport class UserListActionMenu extends AbstractActionMenu\n{\n\tisUserInvited: boolean;\n\n\tconstructor(entityId: number, entityType: string, isUserInvited: boolean)\n\t{\n\t\tsuper(entityId);\n\t\tthis.isUserInvited = isUserInvited;\n\t\tthis.entityType = entityType;\n\t\tthis.items = this.getFilteredItems();\n\t}\n\n\tgetItems(): Array\n\t{\n\t\tif (this.entityType === EntityTypes.team)\n\t\t{\n\t\t\treturn [\n\t\t\t\tnew MoveFromDepartmentMenuItem(this.entityType),\n\t\t\t\tnew RemoveFromDepartmentMenuItem(this.entityType),\n\t\t\t];\n\t\t}\n\n\t\treturn [\n\t\t\tnew MoveFromDepartmentMenuItem(this.entityType),\n\t\t\tnew RemoveFromDepartmentMenuItem(this.entityType),\n\t\t\tnew FireUserFromCompanyMenuItem(this.isUserInvited),\n\t\t];\n\t}\n}\n","import type { ChatOrChannelDetailed } from 'humanresources.company-structure.utils';\nimport { getColorCode, ChatTypes } from 'humanresources.company-structure.utils';\nimport { Main } from 'ui.icon-set.api.core';\nimport { AbstractMenuItem } from '../abstract-menu-item';\nimport { PermissionCheckerClass } from 'humanresources.company-structure.permission-checker';\nimport { MenuActions } from '../../menu-actions';\nimport { Loc } from 'main.core';\n\n/**\n * Menu item for opening a chat or channel.\n * Displays appropriate title, and description based on chat type.\n * Checks permissions using hasAccess property of the chat.\n */\nexport class OpenChatMenuItem extends AbstractMenuItem\n{\n\tchat: ChatOrChannelDetailed;\n\n\tconstructor(entityType: string, chat: ChatOrChannelDetailed)\n\t{\n\t\tconst title = chat.type === ChatTypes.chat\n\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_OPEN_CHAT_TITLE')\n\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_OPEN_CHANNEL_TITLE')\n\t\t;\n\n\t\tconst description = chat.type === ChatTypes.chat\n\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_OPEN_CHAT_DESCRIPTION')\n\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_OPEN_CHANNEL_DESCRIPTION')\n\t\t;\n\n\t\tsuper({\n\t\t\tid: MenuActions.openChat,\n\t\t\ttitle,\n\t\t\tdescription,\n\t\t\tbIcon: {\n\t\t\t\tname: Main.EDIT_PENCIL,\n\t\t\t\tsize: 20,\n\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t},\n\t\t\tpermissionAction: null,\n\t\t\tdataTestId: 'hr-department-detail-content__chat-list_open-chat',\n\t\t});\n\n\t\tthis.entityType = entityType;\n\t\tthis.chat = chat;\n\t}\n\n\thasPermission(permissionChecker: PermissionCheckerClass, entityId: number): boolean\n\t{\n\t\treturn this.chat.hasAccess;\n\t}\n}\n","import type { ChatOrChannelDetailed } from 'humanresources.company-structure.utils';\nimport { EntityTypes, getColorCode, ChatTypes } from 'humanresources.company-structure.utils';\nimport { Main } from 'ui.icon-set.api.core';\nimport { PermissionActions, PermissionCheckerClass } from 'humanresources.company-structure.permission-checker';\nimport { AbstractMenuItem } from '../abstract-menu-item';\nimport { MenuActions } from '../../menu-actions';\nimport { Loc } from 'main.core';\n\n/**\n * Menu item for unbinding a chat or channel from a team or department.\n * Displays appropriate title, description, and permission requirements\n * based on the entity type and chat type.\n */\nexport class UnbindChatMenuItem extends AbstractMenuItem\n{\n\tchat: ChatOrChannelDetailed;\n\n\tconstructor(entityType: string, chat: ChatOrChannelDetailed)\n\t{\n\t\tlet title = '';\n\t\tlet description = '';\n\n\t\tif (entityType === EntityTypes.team)\n\t\t{\n\t\t\ttitle = chat.type === ChatTypes.chat\n\t\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_UNBIND_TEAM_CHAT_TITLE')\n\t\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_UNBIND_TEAM_CHANNEL_TITLE')\n\t\t\t;\n\n\t\t\tdescription = chat.type === ChatTypes.chat\n\t\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_UNBIND_TEAM_CHAT_DESCRIPTION')\n\t\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_UNBIND_TEAM_CHANNEL_DESCRIPTION')\n\t\t\t;\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttitle = chat.type === ChatTypes.chat\n\t\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_UNBIND_DEPARTMENT_CHAT_TITLE')\n\t\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_UNBIND_DEPARTMENT_CHANNEL_TITLE')\n\t\t\t;\n\n\t\t\tdescription = chat.type === ChatTypes.chat\n\t\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_UNBIND_DEPARTMENT_CHAT_DESCRIPTION')\n\t\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_UNBIND_DEPARTMENT_CHANNEL_DESCRIPTION')\n\t\t\t;\n\t\t}\n\n\t\tconst permissionAction = entityType === EntityTypes.team\n\t\t\t? PermissionActions.teamCommunicationEdit\n\t\t\t: PermissionActions.departmentCommunicationEdit\n\t\t;\n\n\t\tsuper({\n\t\t\tid: MenuActions.unbindChat,\n\t\t\ttitle,\n\t\t\tdescription,\n\t\t\tbIcon: {\n\t\t\t\tname: Main.TRASH_BIN,\n\t\t\t\tsize: 20,\n\t\t\t\tcolor: getColorCode('paletteRed40'),\n\t\t\t},\n\t\t\tpermissionAction,\n\t\t\tdataTestId: 'hr-department-detail-content__chat-list_open-chat',\n\t\t});\n\n\t\tthis.chat = chat;\n\t}\n\n\thasPermission(permissionChecker: PermissionCheckerClass, entityId: number): boolean\n\t{\n\t\treturn !this.chat.originalNodeId\n\t\t\t&& this.chat.hasAccess\n\t\t\t&& permissionChecker.hasPermission(this.permissionAction, entityId)\n\t\t;\n\t}\n}\n","import type { ChatOrChannelDetailed } from 'humanresources.company-structure.utils';\nimport { AbstractActionMenu } from '../abstract-action-menu';\nimport { OpenChatMenuItem } from '../items/chats/open-chat-menu-item';\nimport { UnbindChatMenuItem } from '../items/chats/unbund-chat-menu-item';\n\n/**\n * Action menu for chat or channel items in the company structure.\n * Provides menu items to open or unbind a chat/channel.\n */\nexport class ChatListActionMenu extends AbstractActionMenu\n{\n\tchat: ChatOrChannelDetailed;\n\n\tconstructor(entityType: number, chat: ChatOrChannelDetailed, entityId: number)\n\t{\n\t\tsuper(entityId);\n\t\tthis.chat = chat;\n\t\tthis.entityType = entityType;\n\t\tthis.items = this.getFilteredItems();\n\t}\n\n\tgetItems(): Array\n\t{\n\t\treturn [\n\t\t\tnew OpenChatMenuItem(this.entityType, this.chat),\n\t\t\tnew UnbindChatMenuItem(this.entityType, this.chat),\n\t\t];\n\t}\n}\n","import { EventEmitter, type BaseEvent } from 'main.core.events';\nimport { events } from './consts';\nimport { Dom, Loc, Tag } from 'main.core';\nimport { chartAPI } from './api';\n\nexport class NotConvertedState\n{\n\tstatic updateConvertedStatusInterval;\n\n\tstatic #subscribeOnEvents(): void\n\t{\n\t\tconst onCloseByEsc = (event: BaseEvent) => {\n\t\t\tconst [sidePanelEvent] = event.data;\n\t\t\tsidePanelEvent.denyAction();\n\t\t};\n\n\t\tconst onClose = () => {\n\t\t\tEventEmitter.unsubscribe(events.HR_ORG_CHART_CLOSE_BY_ESC, onCloseByEsc);\n\t\t\tEventEmitter.unsubscribe(events.HR_ORG_CHART_CLOSE, onClose);\n\t\t\tclearInterval(this.updateConvertedStatusInterval);\n\t\t};\n\t\tEventEmitter.subscribe(events.HR_ORG_CHART_CLOSE_BY_ESC, onCloseByEsc);\n\t\tEventEmitter.subscribe(events.HR_ORG_CHART_CLOSE, onClose);\n\t}\n\n\tstatic async mount(containerId: string): Promise<void>\n\t{\n\t\tconst container = document.getElementById(containerId);\n\t\tDom.append(this.#getNotConvertedStateScreen(), container);\n\t\tthis.#subscribeOnEvents();\n\n\t\tconst updateTimeMs = 30000;\n\t\tthis.updateConvertedStatusInterval = setInterval(async () => {\n\t\t\ttry\n\t\t\t{\n\t\t\t\tawait chartAPI.getDictionary();\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tif (e.code === 'STRUCTURE_IS_NOT_CONVERTED')\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (e.code === 'STRUCTURE_ACCESS_DENIED')\n\t\t\t\t{\n\t\t\t\t\tclearInterval(this.updateConvertedStatusInterval);\n\t\t\t\t\twindow.location.reload();\n\t\t\t\t}\n\n\t\t\t\tthrow e;\n\t\t\t}\n\n\t\t\tclearInterval(this.updateConvertedStatusInterval);\n\t\t\twindow.location.reload();\n\t\t}, updateTimeMs);\n\t}\n\n\tstatic #getNotConvertedStateScreen(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"humanresources-not-converted-state-screen\">\n\t\t\t\t<div class=\"humanresources-not-converted-state-screen__icon\"></div>\n\t\t\t\t<div class=\"humanresources-not-converted-state-screen__title\">\n\t\t\t\t\t${Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_NOT_CONVERTED_SCREEN_LOADING_TITLE')}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"humanresources-not-converted-state-screen__description\">\n\t\t\t\t\t${Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_NOT_CONVERTED_SCREEN_LOADING_DESCRIPTION')}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n}\n","import { EventEmitter, type BaseEvent } from 'main.core.events';\nimport { events } from './consts';\nimport { BitrixVue } from 'ui.vue3';\nimport { createPinia } from 'ui.vue3.pinia';\nimport { Dom } from 'main.core';\nimport { Chart } from './app';\nimport { PermissionChecker } from 'humanresources.company-structure.permission-checker';\n\nexport { UsersTabActionMenu } from './components/menu/menu/users-tab-action-menu';\nexport { EmptyUsersTabActionMenu } from './components/menu/menu/empty-users-tab-action-menu';\nexport { UserListActionMenu } from './components/menu/menu/user-list-item-action-menu';\nexport { ChatListActionMenu } from './components/menu/menu/chat-list-action-menu';\nexport { MenuActions } from './components/menu/menu-actions';\nexport { NotConvertedState } from './not-converted-state';\nexport { events } from './consts';\n\nexport class App\n{\n\tstatic #subscribeOnEvents(app: Object): void\n\t{\n\t\tconst onCloseByEsc = (event: BaseEvent) => {\n\t\t\tconst [sidePanelEvent] = event.data;\n\t\t\tsidePanelEvent.denyAction();\n\t\t};\n\n\t\tconst onClose = () => {\n\t\t\tEventEmitter.unsubscribe(events.HR_ORG_CHART_CLOSE_BY_ESC, onCloseByEsc);\n\t\t\tEventEmitter.unsubscribe(events.HR_ORG_CHART_CLOSE, onClose);\n\t\t\tapp.unmount();\n\t\t};\n\t\tEventEmitter.subscribe(events.HR_ORG_CHART_CLOSE_BY_ESC, onCloseByEsc);\n\t\tEventEmitter.subscribe(events.HR_ORG_CHART_CLOSE, onClose);\n\t}\n\n\tstatic async mount(containerId: string): Promise<void>\n\t{\n\t\tconst container = document.getElementById(containerId);\n\t\tconst app = BitrixVue.createApp(Chart);\n\t\tconst store = createPinia();\n\t\tapp.use(store);\n\t\tApp.#subscribeOnEvents(app);\n\n\t\tconst slider = BX.SidePanel.Instance.getTopSlider();\n\t\tif (slider)\n\t\t{\n\t\t\tslider.showLoader();\n\t\t}\n\t\tDom.addClass(container, 'humanresources-chart__back');\n\n\t\tawait PermissionChecker.init();\n\t\tif (slider)\n\t\t{\n\t\t\tslider.closeLoader();\n\t\t}\n\t\tDom.removeClass(container, 'humanresources-chart__back');\n\t\tapp.mount(container);\n\t}\n}\n"],"names":["events","Object","freeze","HR_DEPARTMENT_CONNECT","HR_DEPARTMENT_DISCONNECT","HR_DEPARTMENT_ADAPT_SIBLINGS","HR_DEPARTMENT_ADAPT_CONNECTOR_HEIGHT","HR_DEPARTMENT_FOCUS","HR_DEPARTMENT_CONTROL","HR_DEPARTMENT_MENU_CLOSE","HR_ORG_CHART_CLOSE_BY_ESC","HR_ORG_CHART_CLOSE","HR_FIRST_POPUP_SHOW","HR_DRAG_ENTITY","HR_DROP_ENTITY","HR_ENTITY_TOGGLE_CONNECTORS","HR_ORG_CHART_TRANSFORM_CANVAS","HR_DEPARTMENT_SLIDER_ON_MESSAGE","HR_ORG_CHART_LOCATE_TO_DEPARTMENT","HR_ENTITY_SHOW_WIZARD","HR_ENTITY_REMOVE","HR_PUBLIC_FOCUS_NODE","INTRANET_USER_MINIPROFILE_CLOSE","detailPanelWidth","MenuOption","addDepartment","addEmployee","AddButton","name","components","RouteActionMenu","emits","data","actionMenu","visible","computed","mounted","permissionChecker","PermissionChecker","getInstance","dropdownItems","id","title","loc","description","bIcon","Main","CUBE_PLUS","size","color","getColorCode","permission","action","PermissionActions","departmentCreate","CRM","PERSON_PLUS_2","employeeAddToDepartment","filter","item","hasPermissionOfAction","methods","phraseCode","replacements","$Bitrix","Loc","getMessage","$emit","actionMenuItemClickHandler","actionId","template","createTreeDataStore","treeData","dataMap","Map","forEach","parentId","colorName","entityType","mapItem","get","teamColor","getNodeColorSettings","set","mapParentItem","children","chartAPI","removeDepartment","getData","nodeId","getDepartmentsData","tool","category","event","getCurrentDepartments","getDictionary","getUserId","firstTimeOpened","postData","updateDepartment","changeOrder","draggedId","direction","count","OrgChartActions","applyData","departments","currentDepartments","userId","store","useChartStore","$patch","searchedUserId","focusDepartment","departmentId","focusedNode","searchUserInDepartment","moveSubordinatesToParent","removableDepartmentId","removableDepartment","removableDeparmentChildren","userCount","removableDepartmentUserCount","heads","removableDeparmentHeads","employees","removableDeparmentEmployees","parentDepartment","childId","department","EntityTypes","parentDepartmentUsersIds","Set","map","user","removableDeparmentUsers","movableUsers","has","role","memberRoles","employee","length","includes","changeCurrentDepartment","markDepartmentAsRemoved","prevParentId","delete","inviteUser","userData","restData","orderDepartments","targetId","targetIndex","indexOf","newChildren","splice","clearNodesChatLists","nodeIds","chats","channels","SearchBar","BIcon","directives","focus","el","canEditPermissions","showSearchBar","mapState","watch","handler","searchDialog","destroy","deep","created","getSearchDialog","showSearchbar","analyticsSendData","hideSearchbar","dialog","Dialog","width","height","multiple","entities","searchFields","type","system","searchable","options","intranetUsersOnly","emailUsers","inviteEmployeeLink","selectMode","useMultipleTabs","restricted","flatMode","includedNodeEntityTypes","recentTabOptions","dropdownMode","enableSearch","hideOnDeselect","context","customData","recentItemsToSave","push","saveRecentItems","onLoad","target","items","getSubtitle","setSubtitle","onDestroy","dialogContainer","getContainer","Dom","attr","onEnter","$refs","searchName","setTargetNode","isOpen","show","Event","bind","window","handleClickOutside","parentElement","contains","clearSearch","unbind","search","value","getSearchTab","clearResults","selectTab","accessRights","teamAccessRights","BurgerMenuButton","PERSONS_2","dataTestId","accessEdit","MY_PLAN","teamAccessEdit","BX","SidePanel","Instance","open","usePadding","TitlePanel","canAddNode","toolbarStarActive","isHovered","toolbarStarElement","document","getElementById","teamCreate","error","console","observer","MutationObserver","hasClass","observe","attributes","attributeFilter","toolbarStarIcon","isAirTemplate","FAVORITE_1","FAVORITE_0","Reflection","getClass","toolbarClassIcon","source","AnalyticsSourceType","HEADER","onLocate","EventEmitter","emit","triggerFavoriteStar","click","UI","Notification","Center","notify","content","autoHideDelay","UrlParamNames","FocusNodeId","UrlProvidedParamsService","getParams","paramMap","focusNodeId","urlSearchParams","URLSearchParams","location","values","paramName","paramValue","Type","isUndefined","castedValue","Number","isInteger","HeadList","UserListActionMenu","props","Array","required","default","String","collapsed","Boolean","isTeamEntity","isCollapsed","isUpdating","headsVisible","defaultAvatar","workPosition","getPositionText","titleBar","userTypes","deputy","head","handleUserClick","url","cacheable","closeHeadList","unsubscribe","openHeadList","subscribe","AbstractActionMenu","constructor","entityId","getItems","Error","getFilteredItems","isFunction","hasPermission","onActionMenuItemClick","targetItem","find","invoke","analyticSource","AbstractMenuItem","permissionAction","MenuActions","editDepartment","editEmployee","moveEmployee","userInvite","teamRights","moveUserToAnotherDepartment","removeUserFromDepartment","fireUserFromCompany","openChat","unbindChat","AddDepartmentMenuItem","isTeamsAvailable","team","isEditMode","showEntitySelector","EditDepartmentMenuItem","EDIT_PENCIL","refToFocus","teamEdit","teamAddMember","teamCommunicationEdit","teamSettingsEdit","departmentEdit","departmentCommunicationEdit","RemoveDepartmentMenuItem","teamDelete","departmentDelete","TRASH_BIN","AddEmployeeMenuItem","localize","i18nRole","i18nType","i18nMap","teamMemberRoles","UserManagementDialog","openDialog","EditEmployeesMenuItem","imageClass","EDIT_MENU","MoveEmployeeMenuItem","PERSON_ARROW_LEFT_1","currentUserPermissions","ACTION_EMPLOYEE_REMOVE_FROM_DEPARTMENT","UserInviteMenuItem","PERSON_LETTER","inviteToDepartment","allowChangeHistory","EntityActionMenu","DepartmentMenuButton","menuVisible","menu","DETAIL","closeMenu","openMenu","DepartmentInfoIconButton","BasePopup","canvasZoom","showPopup","popupConfig","popupWidth","buttonWidth","initialPopupOffset","angleWidth","bindElement","departmentMenuButton","bindOptions","position","borderRadius","contentNoPaddings","contentPadding","padding","offsetTop","offsetLeft","angleOffset","menuItem","canEdit","onClose","onOpen","addDescription","CARD","SubdivisionAddButton","canShow","addSubdivision","PLUS","TreeNode","hint","Hint","inject","expandedNodes","isShown","childrenOffset","childrenMounted","showInfo","showDnd","getMemberRoles","nodeData","nodeClass","isCurrentDepartment","subdivisionsClass","hasChildren","isExpanded","deputyHead","employeeCount","childNodeStyle","left","showSubdivisionAddButton","nodeDataTitle","subdivisionsText","locPlural","childDepartmentsCount","childTeamsCount","adaptHeight","immediate","gap","prevChildrenOffset","prevHeight","editAction","viewAction","teamView","structureView","$nextTick","$el","offsetHeight","html","parentsPath","getParentsPath","calculateNodePoints","unmounted","remove","onDepartmentClick","showEmployees","subdivisionsSelected","calculatePosition","node","offset","getMessagePlural","top","getBoundingClientRect","parentNode","$parent","parentLeft","parentTop","parentWidth","parentHeight","x","chartX","y","chartY","getTreeBounds","startPoint","endPoint","topLevelId","shift","Connectors","expose","isLocatedDepartmentVisible","treeNodes","connectors","subscribeOnEvents","prevWindowWidth","innerWidth","beforeUnmount","unsubscribeFromEvents","onAddConnector","connector","assign","highlighted","onRemoveConnector","onAdaptSiblingConnectors","isMounted","parsedSiblingConnectors","reduce","acc","currentEndPoint","currentId","currentParentId","sign","currentStartPoint","ancestorId","ancestorSign","adaptConnectorsAfterReorder","ids","isRoot","onAdaptConnectorHeight","toggleConnectorsVisibility","toggleAllConnectorsVisibility","shouldShow","keys","key","toggleConnectorHighlighting","expanded","highlightedConnector","getPath","verticalLineHeight","parentNodeStyle","getComputedStyle","minDepartmentHeight","parseInt","getPropertyValue","diffHeight","shiftY","startY","shadowOffset","rounded","start","end","arcRadius","Math","round","adjustedEndY","join","entries","handle","onResizeWindow","startPointX","endPointX","FULL_WIDTH","CANVAS_MOVE_SPEED","TreeNodeDragController","currentTarget","tree","pageX","pageY","stopPropagation","dataset","zoom","closest","prevX","prevY","addClass","removeClass","style","affectedItem","directionX","directionY","insertion","affectedItems","draggedIndex","shiftKey","currentCanvasX","movementX","currentCanvasY","movementY","ghost","cloneNode","treeX","treeY","draggedX","draggedY","append","offsetWidth","text","positionPointer","Tag","render","element","rotation","nodeX","nodeY","reorderThreshold","changeParentWithReorderThreshold","draggedWidth","draggedHeight","points","targetData","point","i","belowItem","elementFromPoint","targetItemSummary","targetX","targetY","targetWidth","targetHeight","sameParent","hasSortPermission","canSortEntitiesByParentId","allowSort","isDepartmentInsertToTeam","isInsertToParent","canBeParentForEntity","slice","zoomedLeft","zoomedTop","body","speed","shouldReset","DragAndDrop","updated","setAttribute","Tree","dnd","provide","canvasTransform","isLoaded","rootId","loadHeads","departmentToFocus","getDepartmentIdForInitialFocus","currentDepartmentsLocated","expandDepartmentParents","expandAfterFocus","expandLowerDepartments","providedFocusNodeId","currentDepartmentId","onConnectDepartment","departmentIdToFocus","movingDelay","Runtime","debounce","moveTo","onDisconnectDepartment","onDragEntity","collapseRecursively","onToggleConnectors","promise","fullDepartmentWidth","draggedShift","affectedShift","ordered","updateParent","updateParentPromise","targetParentId","locateToDepartment","affectedCount","err","onDropEntity","onPublicFocusNode","collapse","expandedId","deepCollapse","expandedNode","expand","childrenWithoutHeads","shouldExpand","onFocusDepartment","preventSwitch","tryRemoveDepartment","localizationMap","message","success","mapIndex","messageBox","MessageBox","create","buttons","MessageBoxButtons","OK_CANCEL","onOk","close","onCancel","minWidth","maxWidth","minHeight","okCaption","popupOptions","className","overlay","opacity","okButton","getOkButton","cancelButton","getCancelButton","setRound","setColor","ButtonColor","DANGER","LIGHT_BORDER","removableDepartmentChildren","expandLevel","expandRecursively","middleBound","trunc","traverseSibling","siblingId","currentChildren","locateToCurrentDepartment","currentDepartment","treeRect","centerX","centerY","treeNode","treeNodeRect","departmentIds","TransformPanel","modelValue","selectedId","zoomInPercent","percent","toFixed","actions","zoomIn","zoomOut","locate","navigate","onZoom","leftBound","rightBound","oldCenterX","oldCenterY","onfocusout","DetailPanelCollapsedTitle","avatars","maxVisibleAvatarsCount","additionalCount","DetailPanelEditButton","DetailPanel","DepartmentContent","preventPanelSwitch","isLoading","needToShowLoader","headAvatarsArray","avatar","newId","oldId","updateDetailPageHandler","newDepartments","toggleCollapse","showLoader","hideLoader","FirstPopup","subDescription","features","closePopup","Chart","TransformCanvas","ChartWizard","canvas","shown","moved","modelTransform","wizard","entity","detailPanel","isTransitionCompleted","slider","getTopSlider","Promise","all","closeLoader","parsedDepartments","availableDepartments","rootOffset","transformCanvas","showConfetti","handleInviteSliderMessage","PULL","PullClient","SubscriptionType","Server","moduleId","command","callback","clearChatLists","showWizardEventHandler","removeDepartmentEventHandler","onCanvasTransformWhenDragging","onMoveTo","detailPanelWidthZoomed","newX","newY","samePoint","onUpdateTransform","onShowWizard","c_element","onModifyTree","onWizardClose","onRemoveDepartment","onTransitionEnd","Confetti","fire","particleCount","startVelocity","spread","ticks","origin","onControlDetail","messageEvent","eventId","getEventId","users","invitedUserData","getInvitedUserData","onKeyDown","preventDefault","UsersTabActionMenu","EmptyUsersTabActionMenu","FireUserFromCompanyMenuItem","isUserInvited","PERSONS_DENY","employeeFire","MoveFromDepartmentMenuItem","permissions","addMemberPermissionAction","removeMemberPermissionAction","teamRemoveMember","employeeRemoveFromDepartment","addMemberPermissionValue","ACTION_TEAM_MEMBER_ADD","ACTION_EMPLOYEE_ADD_TO_DEPARTMENT","removeMemberPermissionValue","ACTION_TEAM_MEMBER_REMOVE","moveUserPermission","RemoveFromDepartmentMenuItem","OpenChatMenuItem","chat","ChatTypes","hasAccess","UnbindChatMenuItem","originalNodeId","ChatListActionMenu","NotConvertedState","mount","containerId","container","updateTimeMs","updateConvertedStatusInterval","setInterval","e","code","clearInterval","reload","onCloseByEsc","sidePanelEvent","denyAction","App","app","BitrixVue","createApp","createPinia","use","init","unmount"],"mappings":"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"}