{"version":3,"file":"org-chart.bundle.js","sources":["../src/consts.js","../src/components/title-panel/add-button/add-button.js","../src/api.js","../src/actions.js","../src/components/title-panel/search/search-bar.js","../src/components/title-panel/burger-menu-button/burger-menu-button.js","../src/components/title-panel/title-panel.js","../../department-content/src/api.js","../../department-content/src/actions.js","../../user-management-dialog/src/actions.js","../src/classes/url-provided-params-service.js","../src/components/tree/tree-node/head-list.js","../src/components/menu/abstract-action-menu.js","../src/components/menu/items/abstract-menu-item.js","../src/components/menu/menu-actions.js","../src/components/menu/items/department/add-department-menu-item.js","../src/components/menu/items/department/edit-department-menu-item.js","../src/components/menu/items/department/remove-department-menu-item.js","../src/components/menu/items/employees/add-employee-menu-item.js","../src/components/menu/items/department/edit-employees-menu-item.js","../src/components/menu/items/employees/move-employee-menu-item.js","../src/components/menu/items/employees/user-invite-menu-item.js","../src/components/menu/menu/entity-action-menu.js","../src/components/tree/tree-node/department-menu-button.js","../src/components/tree/tree-node/department-info-icon-button.js","../src/components/tree/tree-node/subdivision-add-button.js","../src/components/tree/tree-node/tree-node.js","../src/components/tree/connectors.js","../src/components/tree/directives/classes/drag-and-drop-controller.js","../src/components/tree/directives/drag-and-drop.js","../src/components/tree/tree.js","../src/components/transfrom-panel.js","../src/components/detail-panel/detail-panel-collapsed-title.js","../src/components/detail-panel/detail-panel-edit-button.js","../src/components/detail-panel/detail-panel.js","../src/components/first-popup/first-popup.js","../src/app.js","../src/components/menu/menu/users-tab-action-menu.js","../src/components/menu/menu/empty-users-tab-action-menu.js","../src/components/menu/items/user-item/fire-user-from-company.js","../src/components/menu/items/user-item/move-from-department.js","../src/components/menu/items/user-item/remove-from-department.js","../src/components/menu/menu/user-list-item-action-menu.js","../src/components/menu/items/chats/open-chat-menu-item.js","../src/components/menu/items/chats/unbund-chat-menu-item.js","../src/components/menu/menu/chat-list-action-menu.js","../src/not-converted-state.js","../src/main.js"],"sourcesContent":["export const events = Object.freeze({\n\tHR_DEPARTMENT_CONNECT: 'hr-department-connect',\n\tHR_DEPARTMENT_DISCONNECT: 'hr-department-disconnect',\n\tHR_DEPARTMENT_ADAPT_SIBLINGS: 'hr-department-adapt-siblings',\n\tHR_DEPARTMENT_ADAPT_CONNECTOR_HEIGHT: 'hr-department-adapt-connector-height',\n\tHR_DEPARTMENT_FOCUS: 'hr-department-focus',\n\tHR_DEPARTMENT_CONTROL: 'hr-department-control',\n\tHR_DEPARTMENT_MENU_CLOSE: 'hr-department-menu-close',\n\tHR_ORG_CHART_CLOSE_BY_ESC: 'SidePanel.Slider:onCloseByEsc',\n\tHR_ORG_CHART_CLOSE: 'SidePanel.Slider:onClose',\n\tHR_FIRST_POPUP_SHOW: 'HR.company-structure:first-popup-showed',\n\tHR_DRAG_ENTITY: 'hr-drag-entity',\n\tHR_DROP_ENTITY: 'hr-drop-entity',\n\tHR_ORG_CHART_TRANSFORM_CANVAS: 'hr-org-chart-transform-canvas',\n\tHR_DEPARTMENT_SLIDER_ON_MESSAGE: 'SidePanel.Slider:onMessage',\n\tHR_ORG_CHART_LOCATE_TO_DEPARTMENT: 'hr-org-chart-locate-to-department',\n\tHR_ENTITY_TOGGLE_ELEMENTS: 'hr-entity-toggle-elements',\n\n\tHR_ENTITY_SHOW_WIZARD: 'hr-entity-show-wizard',\n\tHR_ENTITY_REMOVE: 'hr-entity-remove',\n\tHR_PUBLIC_FOCUS_NODE: 'HumanResources.CompanyStructure:focusNode',\n\n\tINTRANET_USER_MINIPROFILE_CLOSE: 'Intranet.User.MiniProfile:close',\n\n\tHR_USER_DRAG_START: 'HumanResources.User:dragStart',\n\tHR_USER_DRAG_MOVE: 'HumanResources.User:dragMove',\n\tHR_USER_DRAG_DROP: 'HumanResources.User:drop',\n\tHR_USER_DRAG_END: 'HumanResources.User:dragEnd',\n\tHR_USER_DRAG_ENTER_NODE: 'HumanResources.User:dragEnterNode',\n\tHR_USER_DRAG_LEAVE_NODE: 'HumanResources.User:dragLeaveNode',\n});\n\nexport const detailPanelWidth = 364;\n","import { RouteActionMenu } from 'humanresources.company-structure.structure-components';\nimport { Main, CRM } from 'ui.icon-set.api.core';\nimport { getColorCode } from 'humanresources.company-structure.utils';\nimport { PermissionActions, PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport 'ui.icon-set.main';\nimport 'ui.icon-set.crm';\n\nconst MenuOption = Object.freeze({\n\taddDepartment: 'add-department',\n\taddEmployee: 'add-employee',\n});\n\n// @vue/component\nexport const AddButton = {\n\tname: 'AddButton',\n\n\tcomponents: {\n\t\tRouteActionMenu,\n\t},\n\n\temits: ['addDepartment'],\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tactionMenu: {\n\t\t\t\tvisible: false,\n\t\t\t},\n\t\t};\n\t},\n\n\tcomputed: {\n\t\tMenuOption(): typeof MenuOption\n\t\t{\n\t\t\treturn MenuOption;\n\t\t},\n\t},\n\n\tmounted(): void\n\t{\n\t\tconst permissionChecker = PermissionChecker.getInstance();\n\n\t\tif (!permissionChecker)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.dropdownItems = [\n\t\t\t{\n\t\t\t\tid: MenuOption.addDepartment,\n\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_ADD_BUTTON_MENU_ADD_DEPARTMENT_TITLE'),\n\t\t\t\tdescription: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_ADD_BUTTON_MENU_ADD_DEPARTMENT_DESCR'),\n\t\t\t\tbIcon: {\n\t\t\t\t\tname: Main.CUBE_PLUS,\n\t\t\t\t\tsize: 20,\n\t\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t\t},\n\t\t\t\tpermission: {\n\t\t\t\t\taction: PermissionActions.departmentCreate,\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: MenuOption.addEmployee,\n\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_ADD_BUTTON_MENU_ADD_EMPLOYEE_TITLE'),\n\t\t\t\tdescription: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_ADD_BUTTON_MENU_ADD_EMPLOYEE_DESCR'),\n\t\t\t\tbIcon: {\n\t\t\t\t\tname: CRM.PERSON_PLUS_2,\n\t\t\t\t\tsize: 20,\n\t\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t\t},\n\t\t\t\tpermission: {\n\t\t\t\t\taction: PermissionActions.employeeAddToDepartment,\n\t\t\t\t},\n\t\t\t},\n\t\t];\n\n\t\tthis.dropdownItems = this.dropdownItems.filter((item) => {\n\t\t\tif (!item.permission)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn permissionChecker.hasPermissionOfAction(item.permission.action);\n\t\t});\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\taddDepartment(): void\n\t\t{\n\t\t\tthis.$emit('addDepartment');\n\t\t},\n\t\tactionMenuItemClickHandler(actionId: string): void\n\t\t{\n\t\t\tif (actionId === MenuOption.addDepartment)\n\t\t\t{\n\t\t\t\tthis.$emit('addDepartment');\n\t\t\t}\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"ui-btn ui-btn-success ui-btn-round ui-btn-sm humanresources-title-panel__add-button\"\n\t\t\tdata-test-id=\"hr-org-chart_title-panel__add-button\"\n\t\t\t@click=\"addDepartment\"\n\t\t>\n\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_ADD_BUTTON') }}\n\t\t</div>\n\t`,\n};\n","import { getData, postData } from 'humanresources.company-structure.api';\nimport { getNodeColorSettings } from 'humanresources.company-structure.utils';\nimport type { TreeItem } from './types';\n\nconst createTreeDataStore = (treeData: Array<TreeItem>): Map<number, TreeItem> => {\n\tconst dataMap = new Map();\n\ttreeData.forEach((item) => {\n\t\tconst { id, parentId, colorName, entityType } = item;\n\t\tconst mapItem = dataMap.get(id) ?? {};\n\t\tconst teamColor = getNodeColorSettings(colorName, entityType);\n\t\tdataMap.set(id, { ...mapItem, ...item, teamColor });\n\t\tif (parentId === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst mapParentItem = dataMap.get(parentId) ?? {};\n\t\tconst children = mapParentItem.children ?? [];\n\t\tdataMap.set(parentId, {\n\t\t\t...mapParentItem,\n\t\t\tchildren: [...children, id],\n\t\t});\n\t});\n\n\treturn dataMap;\n};\n\nexport const chartAPI = {\n\tremoveDepartment: (id: Number): Promise<void> => {\n\t\treturn getData('humanresources.api.Structure.Node.delete', { nodeId: id });\n\t},\n\tgetDepartmentsData: (): Promise<Array<TreeItem>> => {\n\t\treturn getData('humanresources.api.Structure.get', {}, { tool: 'structure', category: 'structure', event: 'open_structure' });\n\t},\n\tgetCurrentDepartments: (): Promise<number[]> => {\n\t\treturn getData('humanresources.api.Structure.Node.current');\n\t},\n\tgetDictionary: (): Promise<string> => {\n\t\treturn getData('humanresources.api.Structure.dictionary');\n\t},\n\tgetUserId: (): Promise<number> => {\n\t\treturn getData('humanresources.api.User.getCurrentId');\n\t},\n\tfirstTimeOpened: (): Promise<void> => {\n\t\treturn postData('humanresources.api.User.firstTimeOpen');\n\t},\n\tupdateDepartment: (nodeId: number, parentId: number): Promise<void> => {\n\t\treturn postData('humanresources.api.Structure.Node.update', {\n\t\t\tnodeId,\n\t\t\tparentId,\n\t\t\tname: null,\n\t\t});\n\t},\n\tchangeOrder: (draggedId: Number, direction: Number, count: number): Promise<void> => {\n\t\treturn postData('humanresources.api.Structure.Node.changeOrder', {\n\t\t\tnodeId: draggedId,\n\t\t\tdirection,\n\t\t\tcount,\n\t\t});\n\t},\n\tcreateTreeDataStore,\n};\n","import { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { getMemberRoles, memberRoles } from 'humanresources.company-structure.api';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\nimport { chartAPI } from './api';\nimport type { TreeItem } from './types';\nimport type { UserData } from 'humanresources.company-structure.utils';\n\nexport const OrgChartActions = {\n\tapplyData: (departments: Map<Number, TreeItem>, currentDepartments: number[], userId: number, map: Array): void => {\n\t\tconst store = useChartStore();\n\t\tstore.$patch({\n\t\t\tdepartments,\n\t\t\tcurrentDepartments,\n\t\t\tuserId,\n\t\t\tsearchedUserId: userId,\n\t\t\tstructureMap: map,\n\t\t});\n\t},\n\tfocusDepartment: (departmentId: number): void => {\n\t\tconst store = useChartStore();\n\t\tstore.focusedNode = departmentId;\n\t},\n\tsearchUserInDepartment: (userId: number): void => {\n\t\tconst store = useChartStore();\n\t\tstore.searchedUserId = userId;\n\t},\n\tmoveSubordinatesToParent: (removableDepartmentId: number): void => {\n\t\tconst store = useChartStore();\n\t\tconst { departments, currentDepartments, structureMap } = store;\n\t\tconst removableDepartment = departments.get(removableDepartmentId);\n\t\tconst {\n\t\t\tparentId,\n\t\t\tentityType,\n\t\t\tchildren: removableDeparmentChildren = [],\n\t\t\tuserCount: removableDepartmentUserCount,\n\t\t\theads: removableDeparmentHeads,\n\t\t\temployees: removableDeparmentEmployees = [],\n\t\t} = removableDepartment;\n\t\tconst parentDepartment = departments.get(parentId);\n\n\t\tremovableDeparmentChildren.forEach((childId) => {\n\t\t\tconst department = departments.get(childId);\n\t\t\tconst mapEntity = structureMap.get(childId);\n\t\t\tmapEntity.parentId = parentId;\n\t\t\tdepartment.parentId = parentId;\n\t\t});\n\t\tif ((removableDepartmentUserCount > 0) && (entityType === EntityTypes.department))\n\t\t{\n\t\t\tconst parentDepartmentUsersIds = new Set([\n\t\t\t\t...parentDepartment.heads,\n\t\t\t\t...(parentDepartment.employees ?? []),\n\t\t\t].map((user) => user.id));\n\t\t\tconst removableDeparmentUsers = [...removableDeparmentHeads, ...removableDeparmentEmployees];\n\t\t\tconst movableUsers = removableDeparmentUsers.filter((user) => {\n\t\t\t\treturn !parentDepartmentUsersIds.has(user.id);\n\t\t\t});\n\t\t\tfor (const user of movableUsers)\n\t\t\t{\n\t\t\t\tuser.role = memberRoles.employee;\n\t\t\t}\n\t\t\tparentDepartment.userCount += movableUsers.length;\n\t\t\tparentDepartment.employees = [\n\t\t\t\t...(parentDepartment.employees ?? []),\n\t\t\t\t...movableUsers,\n\t\t\t];\n\t\t}\n\n\t\tparentDepartment.children = [...parentDepartment.children, ...removableDeparmentChildren];\n\t\tif (currentDepartments.includes(removableDepartmentId) && (entityType === EntityTypes.department))\n\t\t{\n\t\t\tstore.changeCurrentDepartment(removableDepartmentId, parentId);\n\t\t}\n\t},\n\tmarkDepartmentAsRemoved: (removableDepartmentId: number): void => {\n\t\tconst { departments } = useChartStore();\n\t\tconst removableDepartment = departments.get(removableDepartmentId);\n\t\tconst { parentId } = removableDepartment;\n\t\tconst parentDepartment = departments.get(parentId);\n\t\tparentDepartment.children = parentDepartment.children.filter((childId) => {\n\t\t\treturn childId !== removableDepartmentId;\n\t\t});\n\t\tdelete removableDepartment.parentId;\n\t\tdepartments.set(removableDepartmentId, { ...removableDepartment, prevParentId: parentId });\n\t},\n\tremoveDepartment: (departmentId: number): void => {\n\t\tconst { departments, structureMap } = useChartStore();\n\t\tdepartments.delete(departmentId);\n\t\tstructureMap.delete(departmentId);\n\t},\n\tinviteUser: (userData: UserData): void => {\n\t\tconst { nodeId, ...restData } = userData;\n\t\tconst { departments } = useChartStore();\n\t\tconst department = departments.get(nodeId);\n\t\tif (department.employees)\n\t\t{\n\t\t\tdepartments.set(nodeId, {\n\t\t\t\t...department,\n\t\t\t\temployees: [...department.employees, { ...restData }],\n\t\t\t\tuserCount: department.userCount + 1,\n\t\t\t});\n\t\t}\n\t},\n\torderDepartments: async (draggedId: number, targetId: number, direction: number, count: number): Promise<boolean> => {\n\t\tconst { departments } = useChartStore();\n\t\tconst department = departments.get(draggedId);\n\t\tconst { parentId } = department;\n\t\tconst parentDepartment = departments.get(parentId);\n\t\tconst { children } = parentDepartment;\n\t\tconst targetIndex = children.indexOf(targetId);\n\t\tconst newChildren = children.filter((childId) => childId !== draggedId);\n\t\tnewChildren.splice(targetIndex, 0, draggedId);\n\t\tdepartments.set(parentId, { ...parentDepartment, children: newChildren });\n\t\ttry\n\t\t{\n\t\t\tawait chartAPI.changeOrder(draggedId, direction, count);\n\n\t\t\treturn true;\n\t\t}\n\t\tcatch\n\t\t{\n\t\t\tdepartments.set(parentId, { ...parentDepartment, children });\n\n\t\t\treturn false;\n\t\t}\n\t},\n\tclearNodesChatLists: (nodeIds: Array<Number>): void => {\n\t\tconst { departments } = useChartStore();\n\t\tnodeIds.forEach((nodeId) => {\n\t\t\tconst department = departments.get(nodeId);\n\t\t\tdepartments.set(nodeId, { ...department, chats: null, channels: null });\n\t\t});\n\t},\n};\n","import { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { Event, Dom } from 'main.core';\nimport { type BaseEvent } from 'main.core.events';\nimport { Dialog, type Item } from 'ui.entity-selector';\nimport { BIcon, Set } from 'ui.icon-set.api.vue';\nimport { mapState } from 'ui.vue3.pinia';\nimport { sendData as analyticsSendData } from 'ui.analytics';\nimport { OrgChartActions } from '../../../actions';\n\nimport './style.css';\n\n// @vue/component\nexport const SearchBar = {\n\tname: 'search-bar',\n\n\tcomponents: {\n\t\tBIcon,\n\t},\n\n\tdirectives: {\n\t\tfocus: {\n\t\t\tmounted(el)\n\t\t\t{\n\t\t\t\tel.focus();\n\t\t\t},\n\t\t},\n\t},\n\n\temits: [\n\t\t'locate',\n\t],\n\n\tdata(): { canEditPermissions: boolean; showSearchBar: boolean; }\n\t{\n\t\treturn {\n\t\t\tcanEditPermissions: false,\n\t\t\tshowSearchBar: false,\n\t\t};\n\t},\n\n\tcomputed: {\n\t\tset(): Set\n\t\t{\n\t\t\treturn Set;\n\t\t},\n\t\t...mapState(useChartStore, ['departments']),\n\t},\n\n\twatch: {\n\t\tdepartments: {\n\t\t\thandler(): void\n\t\t\t{\n\t\t\t\tthis.searchDialog.destroy();\n\t\t\t},\n\t\t\tdeep: true,\n\t\t},\n\t},\n\n\tcreated()\n\t{\n\t\tthis.searchDialog = this.getSearchDialog();\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tshowSearchbar(): void\n\t\t{\n\t\t\tif (this.showSearchBar)\n\t\t\t{\n\t\t\t\tthis.showSearchBar = false;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tanalyticsSendData({ tool: 'structure', category: 'structure', event: 'search' });\n\n\t\t\tthis.showSearchBar = true;\n\t\t},\n\t\thideSearchbar(): void\n\t\t{\n\t\t\tthis.showSearchBar = false;\n\t\t},\n\t\tgetSearchDialog(): Dialog\n\t\t{\n\t\t\tconst dialog = new Dialog({\n\t\t\t\twidth: 425,\n\t\t\t\theight: 320,\n\t\t\t\tmultiple: false,\n\t\t\t\tentities: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'user',\n\t\t\t\t\t\tsearchFields: [\n\t\t\t\t\t\t\t{ name: 'supertitle', type: 'string', system: true, searchable: true },\n\t\t\t\t\t\t\t{ name: 'position', type: 'string' },\n\t\t\t\t\t\t],\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tintranetUsersOnly: true,\n\t\t\t\t\t\t\temailUsers: false,\n\t\t\t\t\t\t\tinviteEmployeeLink: false,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'structure-node',\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tselectMode: 'departmentsOnly',\n\t\t\t\t\t\t\tuseMultipleTabs: true,\n\t\t\t\t\t\t\trestricted: 'view',\n\t\t\t\t\t\t\tflatMode: true,\n\t\t\t\t\t\t\tincludedNodeEntityTypes: ['department', 'team'],\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\trecentTabOptions: {\n\t\t\t\t\tid: 'recents',\n\t\t\t\t\tvisible: true,\n\t\t\t\t},\n\t\t\t\tdropdownMode: true,\n\t\t\t\tenableSearch: false,\n\t\t\t\thideOnDeselect: false,\n\t\t\t\tcontext: 'HR_STRUCTURE',\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onSelect': (event: BaseEvent<{ item: Item }>) => {\n\t\t\t\t\t\tconst item = event.getData().item;\n\n\t\t\t\t\t\tif (item.entityType === 'employee')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.$emit('locate', item.customData.get('nodeId'));\n\t\t\t\t\t\t\tOrgChartActions.searchUserInDepartment(item.id);\n\t\t\t\t\t\t\tdialog.recentItemsToSave.push(item);\n\t\t\t\t\t\t\tdialog.saveRecentItems();\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdialog.recentItemsToSave.push(item);\n\t\t\t\t\t\tdialog.saveRecentItems();\n\n\t\t\t\t\t\tthis.$emit('locate', item.id);\n\t\t\t\t\t},\n\t\t\t\t\tonLoad: (event) => {\n\t\t\t\t\t\tevent.target.items.get('user')?.forEach((item) => {\n\t\t\t\t\t\t\tif (!item.getSubtitle())\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\titem.setSubtitle(item.customData.get('position'));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\t'SearchTab:onLoad': (event) => {\n\t\t\t\t\t\tevent.target.items.get('user')?.forEach((item) => {\n\t\t\t\t\t\t\tif (!item.getSubtitle())\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\titem.setSubtitle(item.customData.get('position'));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tonDestroy: () => {\n\t\t\t\t\t\tthis.searchDialog = this.getSearchDialog();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tconst dialogContainer = dialog.getContainer();\n\t\t\tDom.attr(dialogContainer, 'data-test-id', 'hr-org-chart_title-panel__search-dialog-container');\n\n\t\t\treturn dialog;\n\t\t},\n\n\t\tonEnter(): void\n\t\t{\n\t\t\tif (this.$refs.searchName)\n\t\t\t{\n\t\t\t\tthis.searchDialog.setTargetNode(this.$refs.searchName);\n\t\t\t\tif (!this.searchDialog.isOpen())\n\t\t\t\t{\n\t\t\t\t\tthis.searchDialog.show();\n\t\t\t\t}\n\t\t\t\tEvent.bind(window, 'mousedown', this.handleClickOutside);\n\t\t\t}\n\t\t},\n\t\thandleClickOutside(event): void\n\t\t{\n\t\t\tif (this.$refs.searchName\n\t\t\t\t&& !this.$refs.searchName.parentElement.contains(event.target) && !this.searchDialog.isOpen())\n\t\t\t{\n\t\t\t\tthis.clearSearch();\n\t\t\t\tthis.hideSearchbar();\n\t\t\t\tEvent.unbind(window, 'mousedown', this.handleClickOutside);\n\t\t\t}\n\t\t},\n\t\tsearch(value: string): void\n\t\t{\n\t\t\tif (!this.searchDialog.isOpen())\n\t\t\t{\n\t\t\t\tthis.searchDialog.show();\n\t\t\t}\n\n\t\t\tthis.searchDialog.search(value);\n\t\t},\n\t\tclearSearch()\n\t\t{\n\t\t\tthis.searchDialog.getSearchTab().clearResults();\n\t\t\tthis.searchDialog.selectTab('recents');\n\n\t\t\tif (this.$refs.searchName)\n\t\t\t{\n\t\t\t\tthis.$refs.searchName.value = '';\n\t\t\t\tthis.$refs.searchName.focus();\n\t\t\t}\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t    class=\"humanresources-title-panel-search-bar-container\"\n\t\t    :class=\"{'--opened': showSearchBar}\"\n\t\t>\n\t\t  <div\n\t\t      class=\"humanresources-title-panel-search-bar-block__search\"\n\t\t      @click=\"showSearchbar\"\n\t\t\t\tdata-test-id=\"hr-org-chart_title-panel__search-bar-button\"\n\t\t  >\n\t\t    <BIcon :name=\"set.SEARCH_2\" :size=\"24\" class=\"hr-title-search-icon\"></BIcon>\n\t\t  </div>\n\t\t  <transition name=\"humanresources-title-panel-search-bar-fade\" mode=\"in-out\" @after-enter=\"onEnter\">\n\t\t    <div v-if=\"showSearchBar\"\n\t\t         class=\"humanresources-title-panel-search-bar-block__search-bar\"\n\t\t    >\n\t\t      <input\n\t\t          ref=\"searchName\"\n\t\t          key=\"searchInput\"\n\t\t          type=\"text\"\n\t\t          :placeholder=\"loc('HUMANRESOURCES_SEARCH_PLACEHOLDER_MSGVER_1')\"\n\t\t          v-focus\n\t\t          class=\"humanresources-title-panel-search-bar-block__search-input\"\n\t\t          @click=\"onEnter\"\n\t\t          @input=\"search($event.target.value)\"\n\t\t\t\t\tdata-test-id=\"hr-org-chart_title-panel__search-bar-input\"\n\t\t      >\n\t\t      <div\n\t\t          key=\"searchReset\"\n\t\t          @click=\"clearSearch\"\n\t\t          class=\"humanresources-title-panel-search-bar-block__search-reset\"\n\t\t      >\n\t\t        <div class=\"humanresources-title-panel-search-bar-block__search-cursor\"></div>\n\t\t        <BIcon\n\t\t            :name=\"set.CROSS_CIRCLE_50\"\n\t\t            :size=\"24\"\n\t\t            color=\"#2FC6F6\"\n\t\t        ></BIcon>\n\t\t      </div>\n\t\t    </div>\n\t\t  </transition>\n\t\t</div>\n\t`,\n};\n","import { RouteActionMenu } from 'humanresources.company-structure.structure-components';\nimport { Main } from 'ui.icon-set.api.core';\nimport { getColorCode } from 'humanresources.company-structure.utils';\nimport { sendData as analyticsSendData } from 'ui.analytics';\n\nimport 'ui.icon-set.main';\nimport { PermissionActions, PermissionChecker } from 'humanresources.company-structure.permission-checker';\n\nconst MenuOption = Object.freeze({\n\taccessRights: 'access-rights',\n\tteamAccessRights: 'team-access-rights',\n});\n\n// @vue/component\nexport const BurgerMenuButton = {\n\tname: 'BurgerMenuButton',\n\n\tcomponents: {\n\t\tRouteActionMenu,\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tactionMenu: {\n\t\t\t\tvisible: false,\n\t\t\t},\n\t\t};\n\t},\n\n\tmounted(): void\n\t{\n\t\tconst permissionChecker = PermissionChecker.getInstance();\n\t\tconst id = permissionChecker.hasPermissionOfAction(PermissionActions.accessEdit)\n\t\t\t? MenuOption.accessRights\n\t\t\t: MenuOption.teamAccessRights\n\t\t;\n\n\t\tthis.dropdownItems = [\n\t\t\t{\n\t\t\t\tid,\n\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIG_PERMISSION'),\n\t\t\t\tdescription: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIG_PERMISSION_DESCR_MSGVER_2'),\n\t\t\t\tbIcon: {\n\t\t\t\t\tname: Main.PERSONS_2,\n\t\t\t\t\tsize: 20,\n\t\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t\t},\n\t\t\t\tdataTestId: 'hr-org-chart_title-panel__access-rights-button',\n\t\t\t\tpermission: permissionChecker.hasPermissionOfAction(PermissionActions.accessEdit)\n\t\t\t\t\t|| permissionChecker.hasPermissionOfAction(PermissionActions.teamAccessEdit)\n\t\t\t\t,\n\t\t\t},\n\t\t];\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\n\t\tactionMenuItemClickHandler(actionId: string): void\n\t\t{\n\t\t\tif (actionId === MenuOption.accessRights)\n\t\t\t{\n\t\t\t\tanalyticsSendData({ tool: 'structure', category: 'structure', event: 'open_roles' });\n\n\t\t\t\tBX.SidePanel.Instance.open('/hr/config/permission/', { usePadding: true });\n\t\t\t}\n\n\t\t\tif (actionId === MenuOption.teamAccessRights)\n\t\t\t{\n\t\t\t\tanalyticsSendData({ tool: 'structure', category: 'structure', event: 'open_roles' });\n\n\t\t\t\tBX.SidePanel.Instance.open('/hr/config/permission/?category=TEAM', { usePadding: true });\n\t\t\t}\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<span\n\t\t\tref=\"burgerMenuButton\"\n\t\t\t@click=\"actionMenu.visible = true\"\n\t\t\tclass=\"humanresources-title-panel__burger-menu-button\"\n\t\t\tdata-test-id=\"hr-org-chart_title-panel__burger-menu-button\"\n\t\t>\n\t\t\t<svg\n\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\tfill=\"none\"\n\t\t\t\tclass=\"humanresources-title-panel__icon\"\n\t\t\t\t:class=\"{'--selected': actionMenu.visible }\"\n\t\t\t\t>\n\t\t\t\t\t<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M18.7067 15.5577C18.8172 15.5577 18.9067 15.6473 18.9067 15.7577L18.9067 17.2424C18.9067 17.3528 18.8172 17.4424 18.7067 17.4424H5.29375C5.1833 17.4424 5.09375 17.3528 5.09375 17.2424L5.09379 15.7577C5.09379 15.6473 5.18333 15.5577 5.29379 15.5577H18.7067ZM18.7067 11.5577C18.8172 11.5577 18.9067 11.6473 18.9067 11.7577L18.9067 13.2424C18.9067 13.3528 18.8172 13.4424 18.7067 13.4424H5.29375C5.1833 13.4424 5.09375 13.3528 5.09375 13.2424L5.09379 11.7577C5.09379 11.6473 5.18333 11.5577 5.29379 11.5577H18.7067ZM18.7067 7.55774C18.8172 7.55774 18.9067 7.64729 18.9067 7.75774L18.9067 9.24238C18.9067 9.35284 18.8172 9.44238 18.7067 9.44238H5.29375C5.1833 9.44238 5.09375 9.35283 5.09375 9.24237L5.09379 7.75773C5.09379 7.64728 5.18333 7.55774 5.29379 7.55774H18.7067Z\" fill=\"#959ca4\"/>\n\t\t\t</svg>\n\t\t </span>\n\t\t<RouteActionMenu\n\t\t\tv-if=\"actionMenu.visible\"\n\t\t\tid=\"title-panel-burger-menu\"\n\t\t\t:items=\"dropdownItems.filter(item => item.permission)\"\n\t\t\t:bindElement=\"this.$refs.burgerMenuButton\"\n\t\t\t@action=\"actionMenuItemClickHandler($event)\"\n\t\t\t@close=\"this.actionMenu.visible = false\"\n\t\t\tcontainerDataTestId=\"hr-org-chart_title-panel__burger-menu-container\"\n\t\t/>\n\t`,\n\n};\n","import { events } from 'humanresources.company-structure.org-chart';\nimport { EventEmitter } from 'main.core.events';\nimport { AddButton } from './add-button/add-button.js';\nimport { SearchBar } from './search/search-bar.js';\nimport { BurgerMenuButton } from './burger-menu-button/burger-menu-button.js';\nimport { PermissionActions, PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport { AnalyticsSourceType } from 'humanresources.company-structure.api';\nimport { UI } from 'ui.notification';\nimport { Dom } from 'main.core';\nimport { BIcon, Set } from 'ui.icon-set.api.vue';\n\nimport './style.css';\n\nexport const TitlePanel = {\n\tcomponents: {\n\t\tAddButton,\n\t\tBurgerMenuButton,\n\t\tSearchBar,\n\t\tBIcon,\n\t\tSet,\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tcanEditPermissions: false,\n\t\t\tcanAddNode: false,\n\t\t\ttoolbarStarActive: false,\n\t\t\tisHovered: false,\n\t\t};\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.toolbarStarElement = document.getElementById('uiToolbarStar');\n\t},\n\n\tmounted()\n\t{\n\t\ttry\n\t\t{\n\t\t\tconst permissionChecker = PermissionChecker.getInstance();\n\t\t\tthis.canEditPermissions = permissionChecker\n\t\t\t\t&& (permissionChecker.hasPermissionOfAction(PermissionActions.accessEdit)\n\t\t\t\t|| permissionChecker.hasPermissionOfAction(PermissionActions.teamAccessEdit)\n\t\t\t\t);\n\t\t\tthis.canAddNode = permissionChecker\n\t\t\t\t&& (\n\t\t\t\t\tpermissionChecker.hasPermissionOfAction(PermissionActions.departmentCreate)\n\t\t\t\t\t|| permissionChecker.hasPermissionOfAction(PermissionActions.teamCreate)\n\t\t\t\t);\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error('Failed to fetch data:', error);\n\t\t}\n\n\t\tconst observer = new MutationObserver(() => {\n\t\t\tthis.toolbarStarActive = Dom.hasClass(this.toolbarStarElement, 'ui-toolbar-star-active');\n\t\t});\n\n\t\tobserver.observe(this.toolbarStarElement, { attributes: true, attributeFilter: ['class'] });\n\n\t\tthis.toolbarStarActive = Dom.hasClass(this.toolbarStarElement, 'ui-toolbar-star-active');\n\t},\n\n\tname: 'title-panel',\n\n\temits: ['showWizard'],\n\n\tcomputed: {\n\t\tset(): Set\n\t\t{\n\t\t\treturn Set;\n\t\t},\n\t\ttoolbarStarIcon(): string | null\n\t\t{\n\t\t\tif (this.isAirTemplate)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (this.isHovered || this.toolbarStarActive)\n\t\t\t{\n\t\t\t\treturn this.set.FAVORITE_1;\n\t\t\t}\n\n\t\t\treturn this.set.FAVORITE_0;\n\t\t},\n\t\tisAirTemplate(): boolean\n\t\t{\n\t\t\treturn BX.Reflection.getClass('top.BX.Intranet.Bitrix24.Template') !== null;\n\t\t},\n\t\ttoolbarClassIcon(): string\n\t\t{\n\t\t\tif (!this.isAirTemplate)\n\t\t\t{\n\t\t\t\treturn 'humanresources-title-panel__star';\n\t\t\t}\n\n\t\t\treturn this.toolbarStarActive ? 'humanresources-title-panel__unpin' : 'humanresources-title-panel__pin';\n\t\t},\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\taddDepartment(): void\n\t\t{\n\t\t\tthis.$emit('showWizard', { source: AnalyticsSourceType.HEADER });\n\t\t},\n\t\tonLocate(nodeId: number)\n\t\t{\n\t\t\tEventEmitter.emit(events.HR_ORG_CHART_LOCATE_TO_DEPARTMENT, { nodeId });\n\t\t},\n\t\ttriggerFavoriteStar()\n\t\t{\n\t\t\tthis.toolbarStarElement.click();\n\n\t\t\tUI.Notification.Center.notify({\n\t\t\t\tcontent: this.toolbarStarActive\n\t\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_LEFT_MENU_UN_SAVED')\n\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_LEFT_MENU_SAVED'),\n\t\t\t\tautoHideDelay: 2000,\n\t\t\t});\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"humanresources-title-panel\">\n\t\t\t<p class=\"humanresources-title-panel__title\">\n\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_TITLE') }}\n\t\t\t</p>\n\t\t\t<BIcon\n\t\t\t\t:name=\"toolbarStarIcon\"\n\t\t\t\t:size=\"24\"\n\t\t\t\tcolor=\"rgba(149, 156, 164, 1)\"\n\t\t\t\t:class=\"toolbarClassIcon\"\n\t\t\t\t@mouseover=\"isHovered = true\"\n\t\t\t\t@mouseleave=\"isHovered = false\" @click=\"triggerFavoriteStar\"\n\t\t\t></BIcon>\n\t\t\t<AddButton\n\t\t\t\tv-if=\"canAddNode\"\n\t\t\t\t@addDepartment=\"addDepartment\"\n\t\t\t/>\n\t\t\t<div class=\"humanresources-title-panel__icon-buttons\">\n\t\t\t\t<BurgerMenuButton v-if=\"canEditPermissions\"/>\n\t\t\t\t<SearchBar @locate=\"onLocate\"/>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { getData, postData } from 'humanresources.company-structure.api';\nimport type { ChatListResponse } from 'humanresources.company-structure.utils';\n\nexport const DepartmentAPI = {\n\tgetPagedEmployees: (id: Number, page: Number, countPerPage: Number) => {\n\t\treturn getData('humanresources.api.Structure.Node.Member.Employee.list', { nodeId: id, page, countPerPage });\n\t},\n\tremoveUserFromDepartment: (nodeId: number, userId: number): Promise<void> => {\n\t\treturn postData('humanresources.api.Structure.Node.Member.deleteUser', {\n\t\t\tnodeId,\n\t\t\tuserId,\n\t\t});\n\t},\n\tmoveUserToDepartment: (nodeId: number, userId: number, targetNodeId: number, role: string): Promise<void> => {\n\t\treturn postData('humanresources.api.Structure.Node.Member.moveUser', {\n\t\t\tnodeId,\n\t\t\tuserId,\n\t\t\ttargetNodeId,\n\t\t\troleXmlId: role,\n\t\t});\n\t},\n\tisUserInMultipleDepartments: (userId: number): Promise<void> => {\n\t\treturn getData('humanresources.api.User.isUserInMultipleDepartments', {\n\t\t\tuserId,\n\t\t});\n\t},\n\tgetUserInfo: (nodeId: number, userId: number): Promise<void> => {\n\t\treturn getData('humanresources.api.User.getInfoByUserMember', {\n\t\t\tnodeId,\n\t\t\tuserId,\n\t\t});\n\t},\n\tfireUser: (userId: number): Promise<void> => {\n\t\treturn postData('intranet.user.fire', {\n\t\t\tuserId,\n\t\t});\n\t},\n\tfindMemberByQuery: (nodeId: number, query: string): Promise<void> => {\n\t\treturn getData('humanresources.api.Structure.Node.Member.find', {\n\t\t\tnodeId,\n\t\t\tquery,\n\t\t});\n\t},\n\tgetChatsAndChannels: (nodeId: number): Promise<ChatListResponse> => {\n\t\treturn getData('humanresources.api.Structure.Node.Member.Chat.getList', {\n\t\t\tnodeId,\n\t\t});\n\t},\n\tsaveChats: (\n\t\tnodeId: number,\n\t\tids: { chat: number[], channel: number[], collab: number[], withChildren: boolean } = {},\n\t\tremoveIds: { chat?: number[], channel?: number[], collab?: number[] } = {},\n\t\tparentId: ?number = null,\n\t): Promise<Array> => {\n\t\treturn postData('humanresources.api.Structure.Node.Member.Chat.saveChatList', {\n\t\t\tnodeId,\n\t\t\tids,\n\t\t\tremoveIds,\n\t\t\tparentId,\n\t\t});\n\t},\n};\n","import { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { getMemberRoles } from 'humanresources.company-structure.api';\nimport { Type } from 'main.core';\nimport type { ChatOrChannelDetailed } from 'humanresources.company-structure.utils';\nimport { DepartmentAPI } from './api';\n\nconst markDescendantsForChatReload = (childrenIds: Array<number>) => {\n\tconst store = useChartStore();\n\tconst queue = [...childrenIds];\n\tconst visited = new Set();\n\tconst maxIterations = 10000;\n\tlet iterations = 0;\n\n\twhile (queue.length > 0 && iterations < maxIterations)\n\t{\n\t\titerations++;\n\t\tconst childId = queue.shift();\n\n\t\tif (visited.has(childId))\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\t\tvisited.add(childId);\n\n\t\tconst childDepartment = store.departments.get(childId);\n\t\tif (!childDepartment)\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\n\t\tchildDepartment.chatsDetailed = null;\n\t\tchildDepartment.channelsDetailed = null;\n\n\t\tif (childDepartment.children && childDepartment.children.length > 0)\n\t\t{\n\t\t\tqueue.push(...childDepartment.children);\n\t\t}\n\t}\n};\n\nexport const DepartmentContentActions = {\n\tmoveUserToDepartment: (departmentId, userId, targetDepartmentId, role): void => {\n\t\tconst store = useChartStore();\n\t\tconst department = store.departments.get(departmentId);\n\t\tconst targetDepartment = store.departments.get(targetDepartmentId);\n\n\t\tif (!department || !targetDepartment)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst oldMemberRoles = getMemberRoles(department.entityType);\n\t\tconst targetMemberRoles = getMemberRoles(targetDepartment.entityType);\n\t\tconst user = role === oldMemberRoles.employee\n\t\t\t? department.employees?.find((employee) => employee.id === userId)\n\t\t\t: department.heads.find((head) => head.id === userId)\n\t\t;\n\t\tif (!user)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tdepartment.userCount -= 1;\n\t\tif (role === oldMemberRoles.employee)\n\t\t{\n\t\t\tdepartment.employees = department.employees.filter((employee) => employee.id !== userId);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdepartment.heads = department.heads.filter((head) => head.id !== userId);\n\t\t}\n\n\t\ttargetDepartment.userCount += 1;\n\t\tif (userId === store.userId)\n\t\t{\n\t\t\tstore.changeCurrentDepartment(departmentId, targetDepartmentId);\n\t\t}\n\n\t\tuser.role = targetMemberRoles.employee;\n\t\tif (!targetDepartment.employees)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\ttargetDepartment.employees.push(user);\n\t},\n\tremoveUserFromDepartment: (departmentId, userId, role): void => {\n\t\tconst store = useChartStore();\n\t\tconst department = store.departments.get(departmentId);\n\t\tconst oldMemberRoles = getMemberRoles(department.entityType);\n\t\tif (!department)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (userId === store.userId)\n\t\t{\n\t\t\tstore.changeCurrentDepartment(departmentId);\n\t\t}\n\n\t\tdepartment.userCount -= 1;\n\t\tif (role === oldMemberRoles.employee)\n\t\t{\n\t\t\tdepartment.employees = department.employees.filter((employee) => employee.id !== userId);\n\n\t\t\treturn;\n\t\t}\n\n\t\tdepartment.heads = department.heads.filter((head) => head.id !== userId);\n\t},\n\tupdateEmployees: (departmentId: number, employees: Array): void => {\n\t\tconst { departments } = useChartStore();\n\t\tconst department = departments.get(departmentId);\n\n\t\tif (!department)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tdepartments.set(departmentId, { ...department, employees });\n\t},\n\tupdateHeads: (departmentId: number, heads: Array): void => {\n\t\tconst { departments } = useChartStore();\n\t\tconst department = departments.get(departmentId);\n\n\t\tif (!department)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tdepartments.set(departmentId, { ...department, heads });\n\t},\n\tupdateEmployeeListOptions: (\n\t\tdepartmentId: number,\n\t\toptions: { page?: number, shouldUpdateList?: boolean, isListUpdated?: boolean },\n\t): void => {\n\t\tconst { departments } = useChartStore();\n\t\tconst department = departments.get(departmentId);\n\n\t\tif (!department)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tdepartment.employeeListOptions = {\n\t\t\t...department.employeeListOptions,\n\t\t\t...options,\n\t\t};\n\n\t\tdepartments.set(departmentId, department);\n\t},\n\tsetChatsAndChannels: (\n\t\tnodeId: number,\n\t\tchats: Array<ChatOrChannelDetailed>,\n\t\tchannels: Array<ChatOrChannelDetailed>,\n\t\tchatsNoAccess: number = 0,\n\t\tchannelsNoAccess: number = 0,\n\t): void => {\n\t\tconst store = useChartStore();\n\t\tconst department = store.departments.get(nodeId);\n\t\tif (!department)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tdepartment.channelsDetailed = channels;\n\t\tdepartment.chatsDetailed = chats;\n\t\tdepartment.channelsNoAccess = channelsNoAccess;\n\t\tdepartment.chatsNoAccess = chatsNoAccess;\n\t\tdepartment.chatAndChannelsCount = chats.length + channels.length + chatsNoAccess + channelsNoAccess;\n\t},\n\tremoveUserFromAllDepartments: async (userId): Promise<void> => {\n\t\tconst store = useChartStore();\n\t\tconst departments = store.departments;\n\t\tconst departmentsToUpdate = [];\n\n\t\tfor (const [key, department] of departments)\n\t\t{\n\t\t\tif (\n\t\t\t\t(\n\t\t\t\t\t'heads' in department\n\t\t\t\t\t&& Type.isArray(department.heads)\n\t\t\t\t\t&& department.heads.some((employee) => employee.id === userId)\n\t\t\t\t)\n\t\t\t\t|| (\n\t\t\t\t\t'employees' in department\n\t\t\t\t\t&& Type.isArray(department.employees)\n\t\t\t\t\t&& department.employees.some((employee) => employee.id === userId)\n\t\t\t\t)\n\t\t\t)\n\t\t\t{\n\t\t\t\tdepartmentsToUpdate.push(key);\n\t\t\t}\n\t\t}\n\n\t\treturn store.refreshDepartments(departmentsToUpdate);\n\t},\n\tunbindChatFromNode: (nodeId: number, chatId: number): void => {\n\t\tconst store = useChartStore();\n\t\tconst department = store.departments.get(nodeId);\n\t\tif (!department)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tdepartment.channelsDetailed = department.channelsDetailed.filter((chat) => chat.id !== chatId);\n\t\tdepartment.chatsDetailed = department.chatsDetailed.filter((chat) => chat.id !== chatId);\n\t\tdepartment.chatAndChannelsCount--;\n\t},\n\tupdateChatsInChildrenNodes: (parentNodeId: number): void => {\n\t\tconst store = useChartStore();\n\t\tconst parentDepartment = store.departments.get(parentNodeId);\n\n\t\tif (!parentDepartment || !parentDepartment.children)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tmarkDescendantsForChatReload(parentDepartment.children);\n\t},\n};\n","import { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { getMemberRoles } from 'humanresources.company-structure.api';\n\nexport const UserManagementDialogActions = {\n\tgetDepartmentName: (nodeId: number): string => {\n\t\tconst { departments } = useChartStore();\n\t\tconst targetDepartment = departments.get(nodeId);\n\t\tif (!targetDepartment)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\treturn targetDepartment.name;\n\t},\n\tmoveUsersToDepartment: (\n\t\tnodeId: number,\n\t\tusers: Array,\n\t\tuserCount: number,\n\t\tupdatedDepartmentIds: number[],\n\t): void => {\n\t\tconst store = useChartStore();\n\t\tconst targetDepartment = store.departments.get(nodeId);\n\t\tif (!targetDepartment)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst newMemberUserIds = new Set(users.map((user) => user.id));\n\t\tconst employees = (targetDepartment.employees ?? []).filter((user) => !newMemberUserIds.has(user.id));\n\t\tconst headsUserIds = new Set(targetDepartment.heads.map((head) => head.id));\n\t\tconst newUsers = users.filter((user) => !headsUserIds.has(user.id));\n\t\temployees.push(...newUsers);\n\t\ttargetDepartment.employees = employees;\n\t\ttargetDepartment.userCount = userCount;\n\n\t\tif (updatedDepartmentIds.length > 0)\n\t\t{\n\t\t\tvoid store.refreshDepartments(updatedDepartmentIds);\n\t\t}\n\t},\n\taddUsersToDepartment: (\n\t\tnodeId: number,\n\t\tusers: Array,\n\t\tuserCount: number,\n\t\trole: string,\n\t): void => {\n\t\tconst store = useChartStore();\n\t\tconst targetDepartment = store.departments.get(nodeId);\n\t\tif (!targetDepartment)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst memberRoles = getMemberRoles(targetDepartment.entityType);\n\n\t\tconst newMemberUserIds = new Set(users.map((user) => user.id));\n\t\tif (newMemberUserIds.has(store.userId))\n\t\t{\n\t\t\tstore.changeCurrentDepartment(0, targetDepartment.id);\n\t\t}\n\t\tconst heads = (targetDepartment.heads ?? []).filter((user) => !newMemberUserIds.has(user.id));\n\n\t\tconst employees = (targetDepartment.employees ?? []).filter((user) => !newMemberUserIds.has(user.id));\n\t\t(role === memberRoles.employee ? employees : heads).push(...users);\n\n\t\ttargetDepartment.heads = heads;\n\t\ttargetDepartment.employees = employees;\n\t\ttargetDepartment.userCount = userCount;\n\t},\n};\n","import { Type } from 'main.core';\n\ntype UrlProvidedParamsType = {\n\tfocusNodeId: ?number,\n};\n\nconst UrlParamNames = Object.freeze({\n\tFocusNodeId: 'focusNodeId',\n});\n\nexport class UrlProvidedParamsService\n{\n\tstatic getParams(): UrlProvidedParamsType\n\t{\n\t\tconst paramMap = this.#getParamsFromUrl();\n\n\t\treturn {\n\t\t\tfocusNodeId: this.#castAndValidate(UrlParamNames.FocusNodeId, paramMap.get(UrlParamNames.FocusNodeId)),\n\t\t};\n\t}\n\n\tstatic #getParamsFromUrl(): Map<$Values<typeof UrlParamNames>, string>\n\t{\n\t\tconst paramMap = new Map();\n\n\t\tconst urlSearchParams = new URLSearchParams(document.location.search);\n\t\tObject.values(UrlParamNames).forEach((paramName: string) => {\n\t\t\tconst paramValue = urlSearchParams.get(paramName);\n\t\t\tif (!paramValue)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tparamMap.set(paramName, paramValue);\n\t\t});\n\n\t\treturn paramMap;\n\t}\n\n\tstatic #castAndValidate(paramName: string, value: ?string): string | number | null\n\t{\n\t\tif (Type.isUndefined(value))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tlet castedValue = value;\n\t\tif (paramName === UrlParamNames.FocusNodeId)\n\t\t{\n\t\t\tcastedValue = Number(value);\n\t\t\tif (!Type.isInteger(castedValue))\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\n\t\treturn castedValue;\n\t}\n}\n","import './style.css';\nimport { UserListActionMenu } from 'humanresources.company-structure.structure-components';\nimport { events } from '../../../consts';\nimport { EventEmitter } from 'main.core.events';\nimport type { UserData } from 'humanresources.company-structure.utils';\n\n// @vue/component\nexport const HeadList = {\n\tname: 'headList',\n\n\tcomponents: {\n\t\tUserListActionMenu,\n\t},\n\n\tprops: {\n\t\titems: {\n\t\t\ttype: Array,\n\t\t\trequired: false,\n\t\t\tdefault: () => [],\n\t\t},\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: '',\n\t\t},\n\t\tcollapsed: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t\tdefault: false,\n\t\t},\n\t\ttype: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: 'head',\n\t\t},\n\t\tisTeamEntity: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tisCollapsed: false,\n\t\t\tisUpdating: true,\n\t\t\theadsVisible: false,\n\t\t};\n\t},\n\n\tcomputed:\n\t{\n\t\tdefaultAvatar(): String\n\t\t{\n\t\t\treturn '/bitrix/js/humanresources/company-structure/org-chart/src/images/default-user.svg';\n\t\t},\n\t\tdropdownItems(): Array<UserData>\n\t\t{\n\t\t\treturn this.items.map((item: UserData): UserData => {\n\t\t\t\tconst workPosition = this.getPositionText(item);\n\n\t\t\t\treturn { ...item, workPosition };\n\t\t\t});\n\t\t},\n\t\ttitleBar(): string\n\t\t{\n\t\t\treturn this.type === this.userTypes.deputy\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_DEPUTY_TITLE')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_HEAD_TITLE')\n\t\t\t;\n\t\t},\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.userTypes = {\n\t\t\thead: 'head',\n\t\t\tdeputy: 'deputy',\n\t\t};\n\t},\n\n\tmethods:\n\t{\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\thandleUserClick(url: string): void\n\t\t{\n\t\t\tBX.SidePanel.Instance.open(url, {\n\t\t\t\tcacheable: false,\n\t\t\t});\n\t\t},\n\t\tcloseHeadList(): void\n\t\t{\n\t\t\tif (this.headsVisible) // to prevent double unsubscription\n\t\t\t{\n\t\t\t\tthis.headsVisible = false;\n\t\t\t\tEventEmitter.unsubscribe(events.HR_DEPARTMENT_MENU_CLOSE, this.closeHeadList);\n\t\t\t\tEventEmitter.unsubscribe(events.HR_DRAG_ENTITY, this.closeHeadList);\n\t\t\t}\n\t\t},\n\t\topenHeadList(): void\n\t\t{\n\t\t\tif (!this.headsVisible) // to prevent double subscription\n\t\t\t{\n\t\t\t\tthis.headsVisible = true;\n\t\t\t\tEventEmitter.subscribe(events.HR_DEPARTMENT_MENU_CLOSE, this.closeHeadList);\n\t\t\t\tEventEmitter.subscribe(events.HR_DRAG_ENTITY, this.closeHeadList);\n\t\t\t}\n\t\t},\n\t\tgetPositionText(item: UserData): string\n\t\t{\n\t\t\treturn item.workPosition || this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_HEAD_POSITION');\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div v-if=\"items.length\">\n\t\t\t<p v-if=\"title\" class=\"humanresources-tree__node_employees-title\">\n\t\t\t\t{{ title }}\n\t\t\t</p>\n\t\t\t<div\n\t\t\t\tclass=\"humanresources-tree__node_head\"\n\t\t\t\t:class=\"{ '--collapsed': collapsed }\"\n\t\t\t\tv-for=\"(item, index) in items.slice(0, 2)\"\n\t\t\t>\n\t\t\t\t<img\n\t\t\t\t\t:src=\"item.avatar ? encodeURI(item.avatar) : defaultAvatar\"\n\t\t\t\t\tclass=\"humanresources-tree__node_avatar --head\"\n\t\t\t\t\t:class=\"{ '--collapsed': collapsed }\"\n\t\t\t\t\t@click.stop=\"handleUserClick(item.url)\"\n\t\t\t\t/>\n\t\t\t\t<div class=\"humanresources-tree__node_head-text\">\n\t\t\t\t\t<span\n\t\t\t\t\t\t:bx-tooltip-user-id=\"item.id\"\n\t\t\t\t\t\tbx-tooltip-context=\"b24\"\n\t\t\t\t\t\tclass=\"humanresources-tree__node_head-name\"\n\t\t\t\t\t\t@click.stop=\"handleUserClick(item.url)\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ item.name }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span v-if=\"!collapsed\" class=\"humanresources-tree__node_head-position\">\n\t\t\t\t\t\t{{ getPositionText(item) }}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<span\n\t\t\t\t\tv-if=\"index === 1 && items.length > 2\"\n\t\t\t\t\tclass=\"humanresources-tree__node_head-rest\"\n\t\t\t\t\t:class=\"{ '--active': headsVisible }\"\n\t\t\t\t\t:data-test-id=\"'hr-company-structure_org-chart-tree__node-' + type + '-rest'\"\n\t\t\t\t\tref=\"showMoreHeadList\"\n\t\t\t\t\t@click.stop=\"openHeadList\"\n\t\t\t\t>\n\t\t\t\t\t{{ '+' + String(items.length - 2) }}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\t\t<UserListActionMenu\n\t\t\tv-if=\"headsVisible\"\n\t\t\t:id=\"type === userTypes.head ? 'head-list-popup-head' : 'head-list-popup-deputy'\"\n\t\t\t:items=\"dropdownItems\"\n\t\t\t:width=\"228\"\n\t\t\t:bindElement=\"$refs.showMoreHeadList[0]\"\n\t\t\t@close=\"closeHeadList\"\n\t\t\t:titleBar=\"titleBar\"\n\t\t/>\n\t`,\n};\n","import { PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport type { PermissionCheckerClass } from 'humanresources.company-structure.permission-checker';\nimport { Type } from 'main.core';\n\nexport class AbstractActionMenu\n{\n\tpermissionChecker: PermissionCheckerClass;\n\tentityId: number;\n\tanalyticSource: string;\n\tentityType: string;\n\n\tconstructor(entityId: number)\n\t{\n\t\tthis.permissionChecker = PermissionChecker.getInstance();\n\t\tthis.entityId = entityId;\n\t}\n\n\tgetItems(): Array\n\t{\n\t\tthrow new Error('Must override this function');\n\t}\n\n\tgetFilteredItems(): Array\n\t{\n\t\tif (!this.permissionChecker)\n\t\t{\n\t\t\treturn [];\n\t\t}\n\n\t\tconst items = this.getItems();\n\n\t\treturn items.filter((item) => {\n\t\t\tif (Type.isFunction(item.hasPermission))\n\t\t\t{\n\t\t\t\treturn item.hasPermission(this.permissionChecker, this.entityId);\n\t\t\t}\n\n\t\t\treturn false;\n\t\t});\n\t}\n\n\tonActionMenuItemClick(actionId: string): void\n\t{\n\t\tconst targetItem = this.items.find((item) => item.id === actionId);\n\t\ttargetItem?.invoke({\n\t\t\tentityId: this.entityId,\n\t\t\tanalyticSource: this.analyticSource,\n\t\t\tentityType: this.entityType,\n\t\t});\n\t}\n}\n","import type { PermissionCheckerClass } from 'humanresources.company-structure.permission-checker';\n\ntype BIcon = {\n\tname: string,\n\tsize: number,\n\tcolor: string,\n};\n\nexport class AbstractMenuItem\n{\n\tid: string;\n\ttitle: string;\n\tdescription: string;\n\tbIcon: BIcon;\n\tpermissionAction: string;\n\tdataTestId: string;\n\n\tconstructor({ id, title, description, bIcon, permissionAction, dataTestId })\n\t{\n\t\tthis.id = id;\n\t\tthis.title = title;\n\t\tthis.description = description;\n\t\tthis.bIcon = bIcon;\n\t\tthis.permissionAction = permissionAction;\n\t\tthis.dataTestId = dataTestId;\n\t}\n\n\tinvoke(options: Object): void\n\t{\n\t\tthrow new Error('Must override this function');\n\t}\n\n\thasPermission(permissionChecker: PermissionCheckerClass, entityId: number): boolean\n\t{\n\t\treturn permissionChecker.hasPermission(this.permissionAction, entityId);\n\t}\n}\n","export const MenuActions = Object.freeze({\n\teditDepartment: 'editDepartment',\n\taddDepartment: 'addDepartment',\n\taddEmployee: 'addEmployee',\n\teditEmployee: 'editEmployee',\n\tremoveDepartment: 'removeDepartment',\n\tmoveEmployee: 'moveEmployee',\n\tuserInvite: 'userInvite',\n\tteamRights: 'teamRights',\n\n\tmoveUserToAnotherDepartment: 'moveUserToAnotherDepartment',\n\tremoveUserFromDepartment: 'removeUserFromDepartment',\n\tfireUserFromCompany: 'fireUserFromCompany',\n\n\topenChat: 'openChat',\n\tunbindChat: 'unbindChat',\n});\n","import {\n\tPermissionActions,\n\tPermissionChecker,\n\tPermissionCheckerClass,\n} from 'humanresources.company-structure.permission-checker';\nimport { EntityTypes, getColorCode } from 'humanresources.company-structure.utils';\nimport { Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Main } from 'ui.icon-set.api.core';\nimport { UI } from 'ui.notification';\nimport { events } from '../../../../consts';\nimport { AbstractMenuItem } from '../abstract-menu-item';\nimport { MenuActions } from '../../menu-actions';\n\nexport class AddDepartmentMenuItem extends AbstractMenuItem\n{\n\tpermissionChecker: PermissionCheckerClass;\n\tentityType: null;\n\n\tconstructor(entityType: string)\n\t{\n\t\tlet title = '';\n\t\tlet description = '';\n\n\t\t// temporary check for option\n\t\tconst permissionChecker = PermissionChecker.getInstance();\n\t\tif (permissionChecker.isTeamsAvailable)\n\t\t{\n\t\t\ttitle = entityType === EntityTypes.team\n\t\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_ADD_TEAM_TITLE')\n\t\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_ADD_DEPARTMENT_TITLE_MSGVER_1');\n\n\t\t\tdescription = entityType === EntityTypes.team\n\t\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_ADD_TEAM_SUBTITLE')\n\t\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_ADD_DEPARTMENT_SUBTITLE_MSGVER_1');\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttitle = Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_ADD_DEPARTMENT_TITLE_NO_TEAM');\n\t\t\tdescription = Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_ADD_DEPARTMENT_SUBTITLE_NO_TEAM');\n\t\t}\n\n\t\tsuper({\n\t\t\tid: MenuActions.addDepartment,\n\t\t\ttitle,\n\t\t\tdescription,\n\t\t\tbIcon: {\n\t\t\t\tname: Main.CUBE_PLUS,\n\t\t\t\tsize: 20,\n\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t},\n\t\t\tpermissionAction: null,\n\t\t\tdataTestId: 'hr-company-structure_menu__add-department-item',\n\t\t});\n\n\t\tthis.entityType = entityType;\n\t\tthis.permissionChecker = permissionChecker;\n\t\tthis.entityType = entityType;\n\t}\n\n\tinvoke({ entityId, analyticSource, entityType }): void\n\t{\n\t\t// for a team we can create only another team\n\t\tif (entityType === EntityTypes.team)\n\t\t{\n\t\t\tif (!this.permissionChecker.isTeamsAvailable)\n\t\t\t{\n\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\tcontent: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_TEAMS_DISABLED_ERROR_MSGVER_1'),\n\t\t\t\t\tautoHideDelay: 2000,\n\t\t\t\t});\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tEventEmitter.emit(events.HR_ENTITY_SHOW_WIZARD, {\n\t\t\t\tnodeId: entityId,\n\t\t\t\tisEditMode: false,\n\t\t\t\tshowEntitySelector: false,\n\t\t\t\tsource: analyticSource,\n\t\t\t\tentityType,\n\t\t\t});\n\t\t}\n\t\t// for a department we offer to chose entity\n\t\telse\n\t\t{\n\t\t\tEventEmitter.emit(events.HR_ENTITY_SHOW_WIZARD, {\n\t\t\t\tnodeId: entityId,\n\t\t\t\tisEditMode: false,\n\t\t\t\tshowEntitySelector: true,\n\t\t\t\tsource: analyticSource,\n\t\t\t});\n\t\t}\n\t}\n\n\thasPermission(permissionChecker: PermissionCheckerClass, entityId: number): boolean\n\t{\n\t\tif (this.entityType === EntityTypes.team)\n\t\t{\n\t\t\treturn permissionChecker.hasPermission(PermissionActions.teamCreate, entityId);\n\t\t}\n\n\t\treturn permissionChecker.hasPermission(PermissionActions.departmentCreate, entityId)\n\t\t\t|| permissionChecker.hasPermission(PermissionActions.teamCreate, entityId)\n\t\t;\n\t}\n}\n","import type { PermissionCheckerClass } from 'humanresources.company-structure.permission-checker';\nimport { PermissionActions } from 'humanresources.company-structure.permission-checker';\nimport { EntityTypes, getColorCode } from 'humanresources.company-structure.utils';\nimport { Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Main } from 'ui.icon-set.api.core';\nimport { events } from '../../../../consts';\nimport { AbstractMenuItem } from '../abstract-menu-item';\nimport { MenuActions } from '../../menu-actions';\n\nexport class EditDepartmentMenuItem extends AbstractMenuItem\n{\n\tentityType: null;\n\n\tconstructor(entityType: string)\n\t{\n\t\tconst title = entityType === EntityTypes.team\n\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_EDIT_TEAM_TITLE')\n\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_EDIT_DEPARTMENT_TITLE');\n\n\t\tconst description = entityType === EntityTypes.team\n\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_EDIT_TEAM_SUBTITLE_MSGVER_1')\n\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_EDIT_DEPARTMENT_SUBTITLE_MSGVER_1');\n\n\t\tsuper({\n\t\t\tid: MenuActions.editDepartment,\n\t\t\ttitle,\n\t\t\tdescription,\n\t\t\tbIcon: {\n\t\t\t\tname: Main.EDIT_PENCIL,\n\t\t\t\tsize: 20,\n\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t},\n\t\t\tpermissionAction: null,\n\t\t\tdataTestId: 'hr-company-structure_menu__edit-department-item',\n\t\t});\n\n\t\tthis.entityType = entityType;\n\t}\n\n\tinvoke({ entityId, analyticSource, refToFocus = 'title' }): void\n\t{\n\t\tEventEmitter.emit(events.HR_ENTITY_SHOW_WIZARD, {\n\t\t\tnodeId: entityId,\n\t\t\tisEditMode: true,\n\t\t\tshowEntitySelector: false,\n\t\t\ttype: 'department',\n\t\t\tsource: analyticSource,\n\t\t\trefToFocus,\n\t\t});\n\t}\n\n\thasPermission(permissionChecker: PermissionCheckerClass, entityId: number): boolean\n\t{\n\t\tif (this.entityType === EntityTypes.team)\n\t\t{\n\t\t\treturn permissionChecker.hasPermission(PermissionActions.teamEdit, entityId)\n\t\t\t\t|| permissionChecker.hasPermission(PermissionActions.teamAddMember, entityId)\n\t\t\t\t|| permissionChecker.hasPermission(PermissionActions.teamCommunicationEdit, entityId)\n\t\t\t\t|| permissionChecker.hasPermission(PermissionActions.teamSettingsEdit, entityId)\n\t\t\t;\n\t\t}\n\n\t\treturn permissionChecker.hasPermission(PermissionActions.departmentEdit, entityId)\n\t\t\t|| permissionChecker.hasPermission(PermissionActions.employeeAddToDepartment, entityId)\n\t\t\t|| permissionChecker.hasPermission(PermissionActions.departmentCommunicationEdit, entityId)\n\t\t;\n\t}\n}\n","import { PermissionActions } from 'humanresources.company-structure.permission-checker';\nimport { EntityTypes, getColorCode } from 'humanresources.company-structure.utils';\nimport { Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Main } from 'ui.icon-set.api.core';\nimport { events } from '../../../../consts';\nimport { AbstractMenuItem } from '../abstract-menu-item';\nimport { MenuActions } from '../../menu-actions';\n\nexport class RemoveDepartmentMenuItem extends AbstractMenuItem\n{\n\tconstructor(entityType: string)\n\t{\n\t\tconst title = entityType === EntityTypes.team\n\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_REMOVE_TEAM_TITLE')\n\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_REMOVE_DEPARTMENT_TITLE');\n\n\t\tconst description = entityType === EntityTypes.team\n\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_REMOVE_TEAM_SUBTITLE')\n\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_REMOVE_DEPARTMENT_SUBTITLE');\n\n\t\tconst permissionAction = entityType === EntityTypes.team\n\t\t\t? PermissionActions.teamDelete\n\t\t\t: PermissionActions.departmentDelete\n\t\t;\n\n\t\tsuper({\n\t\t\tid: MenuActions.removeDepartment,\n\t\t\ttitle,\n\t\t\tdescription,\n\t\t\tbIcon: {\n\t\t\t\tname: Main.TRASH_BIN,\n\t\t\t\tsize: 20,\n\t\t\t\tcolor: getColorCode('paletteRed40'),\n\t\t\t},\n\t\t\tpermissionAction,\n\t\t\tdataTestId: 'hr-company-structure_menu__remove-department-item',\n\t\t});\n\t}\n\n\tinvoke({ entityId, entityType }): void\n\t{\n\t\tEventEmitter.emit(events.HR_ENTITY_REMOVE, { nodeId: entityId, entityType });\n\t}\n}\n","import { memberRoles, teamMemberRoles } from 'humanresources.company-structure.api';\nimport { PermissionActions } from 'humanresources.company-structure.permission-checker';\nimport { EntityTypes, getColorCode } from 'humanresources.company-structure.utils';\nimport { Loc } from 'main.core';\nimport { CRM } from 'ui.icon-set.api.core';\nimport { AbstractMenuItem } from '../abstract-menu-item';\nimport { MenuActions } from '../../menu-actions';\nimport { UserManagementDialog } from 'humanresources.company-structure.user-management-dialog';\n\nexport class AddEmployeeMenuItem extends AbstractMenuItem\n{\n\trole: ?string;\n\n\tconstructor(entityType: string, role: ?string)\n\t{\n\t\tconst permissionAction = entityType === EntityTypes.team\n\t\t\t? PermissionActions.teamAddMember\n\t\t\t: PermissionActions.employeeAddToDepartment\n\t\t;\n\n\t\tsuper({\n\t\t\tid: MenuActions.addEmployee,\n\t\t\tbIcon: {\n\t\t\t\tname: CRM.PERSON_PLUS_2,\n\t\t\t\tsize: 20,\n\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t},\n\t\t\tpermissionAction,\n\t\t\tdataTestId: 'hr-company-structure_menu__add-employee-item',\n\t\t});\n\n\t\tthis.localize(entityType, role);\n\t}\n\n\tlocalize(entityType: string, role: ?string): [string, string]\n\t{\n\t\tconst i18nRole = ['head', 'employee'].includes(role) ? role : 'default';\n\t\tconst i18nType = entityType === EntityTypes.team ? 'team' : 'default';\n\n\t\tconst i18nMap = {\n\t\t\thead: {\n\t\t\t\tteam: {\n\t\t\t\t\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_ADD_TEAM_HEAD_TITLE'),\n\t\t\t\t\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_ADD_TEAM_HEAD_SUBTITLE'),\n\t\t\t\t\trole: teamMemberRoles.head,\n\t\t\t\t},\n\t\t\t\tdefault: {\n\t\t\t\t\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_ADD_HEAD_TITLE'),\n\t\t\t\t\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_ADD_HEAD_SUBTITLE'),\n\t\t\t\t\trole: memberRoles.head,\n\t\t\t\t},\n\t\t\t},\n\t\t\temployee: {\n\t\t\t\tteam: {\n\t\t\t\t\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_ADD_TEAM_EMPLOYEE_TITLE'),\n\t\t\t\t\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_ADD_TEAM_EMPLOYEE_SUBTITLE'),\n\t\t\t\t\trole: teamMemberRoles.employee,\n\t\t\t\t},\n\t\t\t\tdefault: {\n\t\t\t\t\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_ADD_EMPLOYEE_TITLE'),\n\t\t\t\t\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_ADD_EMPLOYEE_SUBTITLE'),\n\t\t\t\t\trole: memberRoles.employee,\n\t\t\t\t},\n\t\t\t},\n\t\t\tdefault: {\n\t\t\t\tteam: {\n\t\t\t\t\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_ADD_TEAM_EMPLOYEE_TITLE'),\n\t\t\t\t\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_ADD_TEAM_EMPLOYEE_SUBTITLE'),\n\t\t\t\t\trole: null,\n\t\t\t\t},\n\t\t\t\tdefault: {\n\t\t\t\t\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_ADD_EMPLOYEE_TITLE'),\n\t\t\t\t\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_ADD_EMPLOYEE_SUBTITLE'),\n\t\t\t\t\trole: null,\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\n\t\tthis.title = i18nMap[i18nRole][i18nType].title;\n\t\tthis.description = i18nMap[i18nRole][i18nType].description;\n\t\tthis.role = i18nMap[i18nRole][i18nType].role;\n\t}\n\n\tinvoke({ entityId, entityType }): void\n\t{\n\t\tUserManagementDialog.openDialog({\n\t\t\tnodeId: entityId,\n\t\t\ttype: 'add',\n\t\t\trole: this.role,\n\t\t\tentityType,\n\t\t});\n\t}\n}\n","import { PermissionActions } from 'humanresources.company-structure.permission-checker';\nimport { EntityTypes, getColorCode } from 'humanresources.company-structure.utils';\nimport { Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Main } from 'ui.icon-set.api.core';\nimport { events } from '../../../../consts';\nimport { AbstractMenuItem } from '../abstract-menu-item';\nimport { MenuActions } from '../../menu-actions';\n\nexport class EditEmployeesMenuItem extends AbstractMenuItem\n{\n\trole: ?string;\n\n\tconstructor(entityType: string, role: ?string)\n\t{\n\t\tconst permissionAction = entityType === EntityTypes.team\n\t\t\t? PermissionActions.teamAddMember\n\t\t\t: PermissionActions.employeeAddToDepartment\n\t\t;\n\n\t\tsuper({\n\t\t\tid: MenuActions.editEmployee,\n\t\t\timageClass: '-hr-department-org-chart-menu-edit-list',\n\t\t\tbIcon: {\n\t\t\t\tname: Main.EDIT_MENU,\n\t\t\t\tsize: 20,\n\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t},\n\t\t\tpermissionAction,\n\t\t\tdataTestId: 'hr-company-structure_menu__edit-employee-item',\n\t\t});\n\n\t\tthis.localize(entityType, role);\n\t}\n\n\tlocalize(entityType: string, role: ?string): [string, string]\n\t{\n\t\tconst i18nRole = ['head', 'employee'].includes(role) ? role : 'default';\n\t\tconst i18nType = entityType === EntityTypes.team ? 'team' : 'default';\n\n\t\tconst i18nMap = {\n\t\t\thead: {\n\t\t\t\tteam: {\n\t\t\t\t\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_EDIT_TEAM_HEAD_TITLE'),\n\t\t\t\t\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_EDIT_TEAM_HEAD_SUBTITLE'),\n\t\t\t\t},\n\t\t\t\tdefault: {\n\t\t\t\t\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_EDIT_HEAD_TITLE'),\n\t\t\t\t\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_EDIT_HEAD_SUBTITLE'),\n\t\t\t\t},\n\t\t\t},\n\t\t\temployee: {\n\t\t\t\tteam: {\n\t\t\t\t\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_EDIT_TEAM_EMPLOYEE_TITLE'),\n\t\t\t\t\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_EDIT_TEAM_EMPLOYEE_SUBTITLE'),\n\t\t\t\t},\n\t\t\t\tdefault: {\n\t\t\t\t\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_EDIT_EMPLOYEE_TITLE'),\n\t\t\t\t\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_EDIT_TEAM_EMPLOYEE_SUBTITLE'),\n\t\t\t\t},\n\t\t\t},\n\t\t\tdefault: {\n\t\t\t\tteam: {\n\t\t\t\t\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_EDIT_TEAM_EMPLOYEE_LIST_TITLE'),\n\t\t\t\t\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_EDIT_TEAM_EMPLOYEE_LIST_SUBTITLE'),\n\t\t\t\t},\n\t\t\t\tdefault: {\n\t\t\t\t\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_EDIT_EMPLOYEE_LIST_TITLE'),\n\t\t\t\t\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_EDIT_EMPLOYEE_LIST_SUBTITLE'),\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\n\t\tthis.title = i18nMap[i18nRole][i18nType].title;\n\t\tthis.description = i18nMap[i18nRole][i18nType].description;\n\t}\n\n\tinvoke({ entityId, analyticSource }): void\n\t{\n\t\tEventEmitter.emit(events.HR_ENTITY_SHOW_WIZARD, {\n\t\t\tnodeId: entityId,\n\t\t\tisEditMode: true,\n\t\t\tshowEntitySelector: false,\n\t\t\ttype: 'employees',\n\t\t\tsource: analyticSource,\n\t\t});\n\t}\n}\n","import type { PermissionCheckerClass } from 'humanresources.company-structure.permission-checker';\nimport { PermissionActions } from 'humanresources.company-structure.permission-checker';\nimport { getColorCode } from 'humanresources.company-structure.utils';\nimport { Loc } from 'main.core';\nimport { Main } from 'ui.icon-set.api.core';\nimport { AbstractMenuItem } from '../abstract-menu-item';\nimport { MenuActions } from '../../menu-actions';\nimport { UserManagementDialog } from 'humanresources.company-structure.user-management-dialog';\n\nexport class MoveEmployeeMenuItem extends AbstractMenuItem\n{\n\tconstructor()\n\t{\n\t\tsuper({\n\t\t\tid: MenuActions.moveEmployee,\n\t\t\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_MOVE_EMPLOYEE_TITLE'),\n\t\t\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_MOVE_EMPLOYEE_SUBTITLE'),\n\t\t\tbIcon: {\n\t\t\t\tname: Main.PERSON_ARROW_LEFT_1,\n\t\t\t\tsize: 20,\n\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t},\n\t\t\tpermissionAction: PermissionActions.employeeAddToDepartment,\n\t\t\tdataTestId: 'hr-company-structure_menu__move-employee-item',\n\t\t});\n\t}\n\n\tinvoke({ entityId, analyticSource }): void\n\t{\n\t\tUserManagementDialog.openDialog({\n\t\t\tnodeId: entityId,\n\t\t\ttype: 'move',\n\t\t});\n\t}\n\n\thasPermission(permissionChecker: PermissionCheckerClass, entityId: number): boolean\n\t{\n\t\treturn permissionChecker.currentUserPermissions.ACTION_EMPLOYEE_REMOVE_FROM_DEPARTMENT\n\t\t\t&& permissionChecker.hasPermission(this.permissionAction, entityId)\n\t\t;\n\t}\n}\n","import { PermissionActions } from 'humanresources.company-structure.permission-checker';\nimport { getColorCode } from 'humanresources.company-structure.utils';\nimport { Loc } from 'main.core';\nimport { Main } from 'ui.icon-set.api.core';\nimport { AbstractMenuItem } from '../abstract-menu-item';\nimport { MenuActions } from '../../menu-actions';\n\nexport class UserInviteMenuItem extends AbstractMenuItem\n{\n\tconstructor()\n\t{\n\t\tsuper({\n\t\t\tid: MenuActions.userInvite,\n\t\t\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_USER_INVITE_TITLE'),\n\t\t\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_USER_INVITE_SUBTITLE'),\n\t\t\tbIcon: {\n\t\t\t\tname: Main.PERSON_LETTER,\n\t\t\t\tsize: 20,\n\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t},\n\t\t\tpermissionAction: PermissionActions.inviteToDepartment,\n\t\t\tdataTestId: 'hr-company-structure_menu__user-invite-item',\n\t\t});\n\t}\n\n\tinvoke({ entityId }): void\n\t{\n\t\tBX.SidePanel.Instance.open(\n\t\t\t'/bitrix/services/main/ajax.php?action=getSliderContent'\n\t\t\t+ '&c=bitrix%3Aintranet.invitation&mode=ajax'\n\t\t\t+ `&departments[]=${Number(entityId)}&firstInvitationBlock=invite-with-group-dp`,\n\t\t\t{ cacheable: false, allowChangeHistory: false, width: 1100 },\n\t\t);\n\t}\n}\n","import { EntityTypes } from 'humanresources.company-structure.utils';\nimport { AbstractActionMenu } from '../abstract-action-menu';\nimport { AddDepartmentMenuItem } from '../items/department/add-department-menu-item';\nimport { EditDepartmentMenuItem } from '../items/department/edit-department-menu-item';\nimport { RemoveDepartmentMenuItem } from '../items/department/remove-department-menu-item';\nimport { TeamRightsMenuItem } from '../items/department/team-rights-menu-item';\nimport { AddEmployeeMenuItem } from '../items/employees/add-employee-menu-item';\nimport { EditEmployeesMenuItem } from '../items/department/edit-employees-menu-item';\nimport { MoveEmployeeMenuItem } from '../items/employees/move-employee-menu-item';\nimport { UserInviteMenuItem } from '../items/employees/user-invite-menu-item';\n\nexport class EntityActionMenu extends AbstractActionMenu\n{\n\tconstructor(entityId: number, entityType: string, analyticSource: string)\n\t{\n\t\tsuper(entityId);\n\t\tthis.entityType = entityType;\n\t\tthis.analyticSource = analyticSource;\n\t\tthis.items = this.getFilteredItems();\n\t}\n\n\tgetItems(): Array\n\t{\n\t\tif (this.entityType === EntityTypes.team)\n\t\t{\n\t\t\treturn [\n\t\t\t\tnew EditDepartmentMenuItem(this.entityType),\n\t\t\t\tnew AddDepartmentMenuItem(this.entityType),\n\t\t\t\tnew AddEmployeeMenuItem(this.entityType),\n\t\t\t\tnew RemoveDepartmentMenuItem(this.entityType),\n\t\t\t];\n\t\t}\n\n\t\treturn [\n\t\t\tnew EditDepartmentMenuItem(this.entityType),\n\t\t\tnew AddDepartmentMenuItem(this.entityType),\n\t\t\tnew AddEmployeeMenuItem(this.entityType),\n\t\t\tnew MoveEmployeeMenuItem(),\n\t\t\tnew UserInviteMenuItem(),\n\t\t\tnew RemoveDepartmentMenuItem(this.entityType),\n\t\t];\n\t}\n}\n","import { AnalyticsSourceType } from 'humanresources.company-structure.api';\nimport { EventEmitter } from 'main.core.events';\nimport { RouteActionMenu } from 'humanresources.company-structure.structure-components';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\nimport 'ui.icon-set.main';\nimport { events } from '../../../consts';\nimport { EntityActionMenu } from '../../menu/menu/entity-action-menu';\n\n// @vue/component\nexport const DepartmentMenuButton = {\n\tname: 'DepartmentMenuButton',\n\n\tcomponents: {\n\t\tRouteActionMenu,\n\t},\n\n\tprops: {\n\t\tentityId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tentityType: {\n\t\t\ttype: String,\n\t\t\tdefault: EntityTypes.department,\n\t\t},\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tmenuVisible: false,\n\t\t};\n\t},\n\n\tcomputed: {\n\t\tmenu(): EntityActionMenu\n\t\t{\n\t\t\treturn new EntityActionMenu(this.entityId, this.entityType, AnalyticsSourceType.DETAIL);\n\t\t},\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tonActionMenuItemClick(actionId: string): void\n\t\t{\n\t\t\tthis.menu.onActionMenuItemClick(actionId);\n\t\t},\n\t\tcloseMenu(): void\n\t\t{\n\t\t\tif (this.menuVisible)\n\t\t\t{\n\t\t\t\tthis.menuVisible = false;\n\t\t\t\tEventEmitter.unsubscribe(events.HR_DEPARTMENT_MENU_CLOSE, this.closeMenu);\n\t\t\t\tEventEmitter.unsubscribe(events.HR_DRAG_ENTITY, this.closeMenu);\n\t\t\t}\n\t\t},\n\t\topenMenu(): void\n\t\t{\n\t\t\tif (!this.menuVisible)\n\t\t\t{\n\t\t\t\tthis.menuVisible = true;\n\t\t\t\tEventEmitter.subscribe(events.HR_DEPARTMENT_MENU_CLOSE, this.closeMenu);\n\t\t\t\tEventEmitter.subscribe(events.HR_DRAG_ENTITY, this.closeMenu);\n\t\t\t}\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tv-if=\"menu.items.length\"\n\t\t\tclass=\"ui-icon-set --more humanresources-tree__node_department-menu-button\"\n\t\t\t:class=\"{ '--focused': this.menuVisible }\"\n\t\t\tref=\"departmentMenuButton\"\n\t\t\tdata-test-id=\"tree-node-more-button\"\n\t\t\t@click.stop=\"openMenu\"\n\t\t>\n\t\t</div>\n\n\t\t<RouteActionMenu\n\t\t\tv-if=\"menuVisible\"\n\t\t\t:id=\"'tree-node-department-menu-' + entityId\"\n\t\t\t:width=\"302\"\n\t\t\t:items=\"menu.items\"\n\t\t\t:bindElement=\"this.$refs.departmentMenuButton\"\n\t\t\t@action=\"onActionMenuItemClick\"\n\t\t\t@close=\"closeMenu\"\n\t\t/>\n\t`,\n};\n","import { AnalyticsSourceType } from 'humanresources.company-structure.api';\nimport { PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport { BasePopup } from 'humanresources.company-structure.structure-components';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\nimport { EventEmitter } from 'main.core.events';\nimport type { PopupOptions } from 'main.popup';\nimport { events } from '../../../consts';\nimport { EditDepartmentMenuItem } from '../../menu/items/department/edit-department-menu-item';\n\n// @vue/component\nexport const DepartmentInfoIconButton = {\n\tname: 'DepartmentInfoIconButton',\n\n\tcomponents: {\n\t\tBasePopup,\n\t},\n\n\tprops: {\n\t\tentityId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tcanvasZoom: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tdescription: {\n\t\t\ttype: [String, null],\n\t\t\tdefault: null,\n\t\t},\n\t},\n\n\tdata(): { showPopup: boolean }\n\t{\n\t\treturn {\n\t\t\tshowPopup: false,\n\t\t};\n\t},\n\n\tcomputed:\n\t{\n\t\tpopupConfig(): PopupOptions\n\t\t{\n\t\t\tconst popupWidth = 340;\n\t\t\tconst buttonWidth = 22 * this.canvasZoom;\n\t\t\tconst initialPopupOffset = 41 - this.canvasZoom; // subtract 1px * zoom\n\t\t\tconst angleWidth = 33;\n\n\t\t\treturn {\n\t\t\t\twidth: popupWidth,\n\t\t\t\tbindElement: this.$refs.departmentMenuButton,\n\t\t\t\tbindOptions: { position: 'top' },\n\t\t\t\tborderRadius: '12px',\n\t\t\t\tcontentNoPaddings: true,\n\t\t\t\tcontentPadding: 0,\n\t\t\t\tpadding: 16,\n\t\t\t\toffsetTop: -2 * this.canvasZoom,\n\t\t\t\toffsetLeft: buttonWidth / 2 - popupWidth / 2 + initialPopupOffset,\n\t\t\t\tangleOffset: popupWidth / 2 - angleWidth / 2,\n\t\t\t};\n\t\t},\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.menuItem = new EditDepartmentMenuItem(EntityTypes.team);\n\t\tconst permissionChecker = PermissionChecker.getInstance();\n\n\t\tthis.canEdit = this.menuItem.hasPermission(permissionChecker, this.entityId);\n\t},\n\n\tmethods:\n\t{\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tonClose(): void\n\t\t{\n\t\t\tif (this.showPopup)\n\t\t\t{\n\t\t\t\tthis.showPopup = false;\n\t\t\t\tEventEmitter.unsubscribe(events.HR_DEPARTMENT_MENU_CLOSE, this.onClose);\n\t\t\t\tEventEmitter.unsubscribe(events.HR_DRAG_ENTITY, this.onClose);\n\t\t\t}\n\t\t},\n\t\tonOpen(): void\n\t\t{\n\t\t\tif (!this.showPopup)\n\t\t\t{\n\t\t\t\tthis.showPopup = true;\n\t\t\t\tEventEmitter.subscribe(events.HR_DEPARTMENT_MENU_CLOSE, this.onClose);\n\t\t\t\tEventEmitter.subscribe(events.HR_DRAG_ENTITY, this.onClose);\n\t\t\t}\n\t\t},\n\t\taddDescription(): void\n\t\t{\n\t\t\tthis.onClose();\n\t\t\tthis.menuItem.invoke({\n\t\t\t\tentityId: this.entityId,\n\t\t\t\tanalyticSource: AnalyticsSourceType.CARD,\n\t\t\t\trefToFocus: 'description',\n\t\t\t});\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tv-if=\"canEdit || description\"\n\t\t\tclass=\"ui-icon-set --info-1 humanresources-tree__node_department-menu-button\"\n\t\t\t:class=\"{ '--focused': this.showPopup }\"\n\t\t\tref=\"departmentMenuButton\"\n\t\t\t@click.stop=\"onOpen\"\n\t\t\tdata-test-id=\"tree-node-info-button\"\n\t\t>\n\t\t</div>\n\t\t<BasePopup\n\t\t\tv-if=\"showPopup\"\n\t\t\t:config=\"popupConfig\"\n\t\t\t:id=\"'humanresources-tree__node_info-popup' + entityId\"\n\t\t\t@close=\"onClose\"\n\t\t>\n\t\t\t<div class=\"humanresources-tree__node_info-popup-content_description\" v-if=\"description\">\n\t\t\t\t{{ description }}\n\t\t\t</div>\n\t\t\t<div v-else class=\"humanresources-tree__node_info-popup-content\">\n\t\t\t\t<div class=\"humanresources-tree__node_info-popup-content_left\"></div>\n\t\t\t\t<div class=\"humanresources-tree__node_info-popup-content_right\">\n\t\t\t\t\t<div class=\"humanresources-tree__node_info-popup-content_right_title\">\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_INFO_POPUP_ADD_DESCRIPTION_TITLE') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"humanresources-tree__node_info-popup-content_right_text\">\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_INFO_POPUP_ADD_DESCRIPTION_TEXT') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"ui-btn ui-btn-primary ui-btn-round ui-btn-xs ui-btn-no-caps\"\n\t\t\t\t\t\tdata-test-id=\"tree-node-info-popup_add-button\"\n\t\t\t\t\t\t@click=\"addDescription\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_INFO_POPUP_ADD_DESCRIPTION_BUTTON') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</BasePopup>\n\t`,\n};\n","import { AnalyticsSourceType } from 'humanresources.company-structure.api';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\nimport { BIcon, Set } from 'ui.icon-set.api.vue';\nimport 'ui.icon-set.main';\nimport { PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport { AddDepartmentMenuItem } from '../../menu/items/department/add-department-menu-item';\n\n// @vue/component\nexport const SubdivisionAddButton = {\n\tname: 'SubdivisionAddButton',\n\n\tcomponents: {\n\t\tBIcon,\n\t},\n\n\tprops: {\n\t\tentityId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tentityType: {\n\t\t\ttype: String,\n\t\t\tdefault: EntityTypes.department,\n\t\t},\n\t},\n\n\tcomputed:\n\t{\n\t\tset(): Set\n\t\t{\n\t\t\treturn Set;\n\t\t},\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.menuItem = new AddDepartmentMenuItem(this.entityType);\n\t\tconst permissionChecker = PermissionChecker.getInstance();\n\n\t\tthis.canShow = this.menuItem.hasPermission(permissionChecker, this.entityId);\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\taddSubdivision(): void\n\t\t{\n\t\t\tthis.menuItem.invoke({\n\t\t\t\tentityId: this.entityId,\n\t\t\t\tanalyticSource: AnalyticsSourceType.PLUS,\n\t\t\t\tentityType: this.entityType,\n\t\t\t});\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"humanresources-tree__node_add-subdivision\" v-if=\"canShow\">\n\t\t  <button class=\"humanresources-tree__node_add-button\" @click=\"addSubdivision\">\n\t\t    <BIcon :name=\"set.PLUS_20\" :size=\"32\" class=\"humanresources-tree__node_add-icon\"></BIcon>\n\t\t  </button>\n\t\t</div>\n\t`,\n};\n","import { Dom, Loc } from 'main.core';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { mapState } from 'ui.vue3.pinia';\nimport { getMemberRoles, type MemberRolesType } from 'humanresources.company-structure.api';\nimport { Hint } from 'humanresources.company-structure.structure-components';\nimport { EventEmitter } from 'main.core.events';\nimport { events } from '../../../consts';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\nimport { HeadList } from './head-list';\nimport { DepartmentMenuButton } from './department-menu-button';\nimport { DepartmentInfoIconButton } from './department-info-icon-button';\nimport { SubdivisionAddButton } from './subdivision-add-button';\nimport { PermissionActions, PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport type { MountedDepartment, TreeItem, TreeNodeData } from '../../../types';\nimport './style.css';\n\n// @vue/component\nexport const TreeNode = {\n\tname: 'treeNode',\n\n\tcomponents: {\n\t\tDepartmentMenuButton,\n\t\tHeadList,\n\t\tSubdivisionAddButton,\n\t\tDepartmentInfoIconButton,\n\t},\n\n\tdirectives: { hint: Hint },\n\n\tinject: ['getTreeBounds'],\n\n\tprops: {\n\t\tnodeId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\texpandedNodes: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tcanvasZoom: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tcurrentDepartments: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tisShown: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t\tdefault: true,\n\t\t},\n\t\tuserDropTargetNodeId: {\n\t\t\ttype: Number,\n\t\t\tdefault: null,\n\t\t},\n\t\tisUserDropAllowed: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tisDraggingUser: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\n\temits: ['calculatePosition'],\n\n\tdata(): TreeNodeData\n\t{\n\t\treturn {\n\t\t\tchildrenOffset: 0,\n\t\t\tchildrenMounted: false,\n\t\t\tshowInfo: true,\n\t\t\tshowDnd: true,\n\t\t};\n\t},\n\n\tcomputed:\n\t{\n\t\tmemberRoles(): MemberRolesType\n\t\t{\n\t\t\treturn getMemberRoles(this.nodeData.entityType);\n\t\t},\n\t\tnodeData(): TreeItem\n\t\t{\n\t\t\treturn this.departments.get(this.nodeId);\n\t\t},\n\t\tnodeClass(): { [key: string]: boolean; }\n\t\t{\n\t\t\tconst isDragSource = this.isDraggingUser && this.nodeId === this.focusedNode;\n\n\t\t\treturn {\n\t\t\t\t'--expanded': this.expandedNodes.includes(this.nodeId),\n\t\t\t\t'--current-department': this.isCurrentDepartment,\n\t\t\t\t'--focused': this.focusedNode === this.nodeId,\n\t\t\t\t'--with-restricted-access-rights': !this.showInfo,\n\t\t\t\t'--team': this.isTeamEntity,\n\t\t\t\t'--drag-source': isDragSource,\n\t\t\t};\n\t\t},\n\t\tsubdivisionsClass(): { [key: string]: boolean; }\n\t\t{\n\t\t\treturn {\n\t\t\t\t'humanresources-tree__node_arrow': this.hasChildren,\n\t\t\t\t'--up': this.hasChildren && this.isExpanded,\n\t\t\t\t'--down': this.hasChildren && !this.isExpanded,\n\t\t\t\t'--transparent': !this.hasChildren,\n\t\t\t};\n\t\t},\n\t\thasChildren(): boolean\n\t\t{\n\t\t\treturn this.nodeData.children?.length > 0;\n\t\t},\n\t\tisExpanded(): boolean\n\t\t{\n\t\t\treturn this.expandedNodes.includes(this.nodeId);\n\t\t},\n\t\tisCurrentDepartment(): Boolean\n\t\t{\n\t\t\treturn this.currentDepartments.includes(this.nodeId);\n\t\t},\n\t\thead(): ?TreeItem['heads']\n\t\t{\n\t\t\treturn this.nodeData.heads?.filter((head) => {\n\t\t\t\treturn head.role === this.memberRoles.head;\n\t\t\t});\n\t\t},\n\t\tdeputy(): ?TreeItem['heads']\n\t\t{\n\t\t\treturn this.nodeData.heads?.filter((head) => {\n\t\t\t\treturn head.role === this.memberRoles.deputyHead;\n\t\t\t});\n\t\t},\n\t\temployeeCount(): number\n\t\t{\n\t\t\treturn this.nodeData.userCount - this.nodeData.heads.length;\n\t\t},\n\t\tchildNodeStyle(): { left: String; }\n\t\t{\n\t\t\treturn { left: `${this.childrenOffset}px` };\n\t\t},\n\t\tshowSubdivisionAddButton(): boolean\n\t\t{\n\t\t\treturn this.expandedNodes.includes(this.nodeId) || this.focusedNode === this.nodeId;\n\t\t},\n\t\tisTeamEntity(): boolean\n\t\t{\n\t\t\treturn this.nodeData.entityType === EntityTypes.team;\n\t\t},\n\t\tnodeDataTitle(): ?string\n\t\t{\n\t\t\tif (!this.isCurrentDepartment)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_CURRENT_TEAM')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_CURRENT_DEPARTMENT');\n\t\t},\n\t\tsubdivisionsText(): string\n\t\t{\n\t\t\tif (this.isTeamEntity)\n\t\t\t{\n\t\t\t\treturn this.nodeData.children?.length\n\t\t\t\t\t? this.locPlural('HUMANRESOURCES_COMPANY_TEAM_CHILDREN_COUNT', this.nodeData.children.length)\n\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_TREE_TEAM_NO_SUBDEPARTMENTS');\n\t\t\t}\n\n\t\t\tif (!(this.nodeData.children?.length))\n\t\t\t{\n\t\t\t\treturn this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_TREE_NO_SUBDEPARTMENTS');\n\t\t\t}\n\n\t\t\tconst childDepartmentsCount = [...this.departments.values()].filter((department) => {\n\t\t\t\treturn department.entityType === EntityTypes.department && this.nodeData.children.includes(department.id);\n\t\t\t}).length;\n\n\t\t\tconst childTeamsCount = [...this.departments.values()].filter((department) => {\n\t\t\t\treturn department.entityType === EntityTypes.team && this.nodeData.children.includes(department.id);\n\t\t\t}).length;\n\n\t\t\tif ((childTeamsCount > 0) && (childDepartmentsCount > 0))\n\t\t\t{\n\t\t\t\treturn this.loc('HUMANRESOURCES_COMPANY_DEPARTMENT_CHILDREN_COUNT_WITH_CONJUNCTION', {\n\t\t\t\t\t'#DEPT_COUNT#': this.locPlural('HUMANRESOURCES_COMPANY_DEPARTMENT_CHILDREN_COUNT', childDepartmentsCount),\n\t\t\t\t\t'#TEAM_COUNT#': this.locPlural('HUMANRESOURCES_COMPANY_TEAM_CHILDREN_COUNT', childTeamsCount),\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (childDepartmentsCount > 0)\n\t\t\t{\n\t\t\t\treturn this.locPlural('HUMANRESOURCES_COMPANY_DEPARTMENT_CHILDREN_COUNT', childDepartmentsCount);\n\t\t\t}\n\n\t\t\tif (childTeamsCount > 0)\n\t\t\t{\n\t\t\t\treturn this.locPlural('HUMANRESOURCES_COMPANY_TEAM_CHILDREN_COUNT', childTeamsCount);\n\t\t\t}\n\n\t\t\treturn this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_TREE_NO_SUBDEPARTMENTS');\n\t\t},\n\t\tdeputyTitle(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_TREE_TEAM_DEPUTY_TITLE')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_TREE_DEPUTY_TITLE')\n\t\t\t;\n\t\t},\n\t\tdropOverlayText(): string\n\t\t{\n\t\t\tconst sourceNode = this.departments.get(this.focusedNode);\n\t\t\tif (sourceNode.entityType !== this.nodeData.entityType)\n\t\t\t{\n\t\t\t\treturn this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DND_USER_MOVED_FORBIDDEN');\n\t\t\t}\n\n\t\t\treturn this.isUserDropAllowed\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DND_USER_MOVED_ALLOWED')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DND_USER_MOVED_NO_RIGHTS')\n\t\t\t;\n\t\t},\n\t\tshowOverlay(): boolean\n\t\t{\n\t\t\treturn this.nodeId === this.userDropTargetNodeId && this.nodeId !== this.focusedNode;\n\t\t},\n\t\t...mapState(useChartStore, ['departments', 'focusedNode']),\n\t},\n\n\twatch:\n\t{\n\t\thead(): void\n\t\t{\n\t\t\tthis.adaptHeight();\n\t\t},\n\t\tisShown(): void\n\t\t{\n\t\t\tthis.adaptHeight();\n\t\t},\n\t\tisExpanded:\n\t\t{\n\t\t\thandler(isExpanded: boolean): void\n\t\t\t{\n\t\t\t\tif (isExpanded && !this.childrenMounted)\n\t\t\t\t{\n\t\t\t\t\tthis.childrenMounted = true;\n\t\t\t\t}\n\t\t\t},\n\t\t\timmediate: true,\n\t\t},\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.width = 278;\n\t\tthis.gap = 24;\n\t\tthis.prevChildrenOffset = 0;\n\t\tthis.prevHeight = 0;\n\t},\n\n\tasync mounted(): Promise<void>\n\t{\n\t\tlet editAction = '';\n\t\tlet viewAction = '';\n\t\tif (this.isTeamEntity)\n\t\t{\n\t\t\tviewAction = PermissionActions.teamView;\n\t\t\teditAction = PermissionActions.teamEdit;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tviewAction = PermissionActions.structureView;\n\t\t\teditAction = PermissionActions.departmentEdit;\n\t\t}\n\n\t\tconst permissionChecker = PermissionChecker.getInstance();\n\t\tthis.showInfo = permissionChecker.hasPermission(viewAction, this.nodeId);\n\t\tthis.showDnd =\tpermissionChecker.hasPermission(editAction, this.nodeId)\n\t\t\t&& permissionChecker.hasPermission(editAction, this.nodeData.parentId);\n\n\t\tthis.$emit('calculatePosition', this.nodeId);\n\t\tawait this.$nextTick();\n\t\tthis.prevHeight = this.$el.offsetHeight;\n\t\tEventEmitter.emit(events.HR_DEPARTMENT_CONNECT, {\n\t\t\tid: this.nodeId,\n\t\t\tparentId: this.nodeData.parentId,\n\t\t\thtml: this.$el,\n\t\t\tparentsPath: this.getParentsPath(this.nodeData.parentId),\n\t\t\t...this.calculateNodePoints(),\n\t\t});\n\t},\n\tunmounted(): void\n\t{\n\t\tDom.remove(this.$el);\n\t\tconst { prevParentId } = this.nodeData;\n\t\tif (!prevParentId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.$emit('calculatePosition', this.nodeId);\n\t\tEventEmitter.emit(events.HR_DEPARTMENT_DISCONNECT, {\n\t\t\tid: this.nodeId,\n\t\t\tparentId: prevParentId,\n\t\t});\n\t},\n\n\tmethods:\n\t{\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tonDepartmentClick(targetId: string): void\n\t\t{\n\t\t\tif (!this.showInfo)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tEventEmitter.emit(events.HR_DEPARTMENT_FOCUS, {\n\t\t\t\tnodeId: this.nodeId,\n\t\t\t\tshowEmployees: targetId === 'employees',\n\t\t\t\tsubdivisionsSelected: targetId === 'subdivisions',\n\t\t\t});\n\t\t},\n\t\tcalculatePosition(nodeId: number): void\n\t\t{\n\t\t\tconst node = this.departments.get(this.nodeId);\n\n\t\t\tif (node.children.length === 0)\n\t\t\t{\n\t\t\t\tthis.childrenOffset = 0;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst gap = this.gap * (node.children.length - 1);\n\t\t\t\tthis.prevChildrenOffset = this.childrenOffset;\n\t\t\t\tthis.childrenOffset = (this.width - (this.width * node.children.length + gap)) / 2;\n\t\t\t}\n\n\t\t\tconst offset = this.childrenOffset - this.prevChildrenOffset;\n\t\t\tif (offset !== 0)\n\t\t\t{\n\t\t\t\tEventEmitter.emit(events.HR_DEPARTMENT_ADAPT_SIBLINGS, {\n\t\t\t\t\tparentId: this.nodeId,\n\t\t\t\t\tnodeId,\n\t\t\t\t\toffset,\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tlocPlural(phraseCode: string, count: number): string\n\t\t{\n\t\t\treturn Loc.getMessagePlural(phraseCode, count, { '#COUNT#': count });\n\t\t},\n\t\tcalculateNodePoints(): { startPoint: MountedDepartment['startPoint'], endPoint: MountedDepartment['endPoint'] }\n\t\t{\n\t\t\tconst { left, top, width } = this.$el.getBoundingClientRect();\n\t\t\tconst { $el: parentNode } = this.$parent.$parent;\n\t\t\tconst {\n\t\t\t\tleft: parentLeft,\n\t\t\t\ttop: parentTop,\n\t\t\t\twidth: parentWidth,\n\t\t\t\theight: parentHeight,\n\t\t\t} = parentNode.getBoundingClientRect();\n\t\t\tconst { x: chartX, y: chartY } = this.getTreeBounds();\n\n\t\t\treturn {\n\t\t\t\tstartPoint: {\n\t\t\t\t\tx: (parentLeft - chartX + parentWidth / 2) / this.canvasZoom,\n\t\t\t\t\ty: (parentTop - chartY + parentHeight) / this.canvasZoom,\n\t\t\t\t},\n\t\t\t\tendPoint: {\n\t\t\t\t\tx: (left - chartX + width / 2) / this.canvasZoom,\n\t\t\t\t\ty: (top - chartY) / this.canvasZoom,\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\tgetParentsPath(parentId: number): Array<number>\n\t\t{\n\t\t\tlet topLevelId = parentId;\n\t\t\tconst parentsPath = [parentId];\n\t\t\twhile (topLevelId)\n\t\t\t{\n\t\t\t\tconst parentNode = this.departments.get(topLevelId);\n\t\t\t\ttopLevelId = parentNode.parentId;\n\t\t\t\tif (topLevelId)\n\t\t\t\t{\n\t\t\t\t\tparentsPath.push(topLevelId);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn parentsPath;\n\t\t},\n\t\tasync adaptHeight(): Promise<void>\n\t\t{\n\t\t\tif (!this.isShown)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait this.$nextTick();\n\t\t\tconst shift = this.$el.offsetHeight - this.prevHeight;\n\t\t\tif (shift !== 0)\n\t\t\t{\n\t\t\t\tEventEmitter.emit(events.HR_DEPARTMENT_ADAPT_CONNECTOR_HEIGHT, {\n\t\t\t\t\tnodeId: this.nodeId,\n\t\t\t\t\tshift,\n\t\t\t\t});\n\t\t\t\tthis.prevHeight = this.$el.offsetHeight;\n\t\t\t}\n\t\t},\n\t\tonDragMouseEnter(): void\n\t\t{\n\t\t\tEventEmitter.emit(events.HR_USER_DRAG_ENTER_NODE, { nodeId: this.nodeId });\n\t\t},\n\n\t\tonDragMouseLeave(): void\n\t\t{\n\t\t\tEventEmitter.emit(events.HR_USER_DRAG_LEAVE_NODE, { nodeId: this.nodeId });\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\t:data-id=\"nodeId\"\n\t\t\t:class=\"nodeClass\"\n\t\t\t:data-title=\"nodeDataTitle\"\n\t\t\tclass=\"humanresources-tree__node\"\n\t\t\t:style=\"{\n\t\t\t\t'--team-bubble-background': nodeData.teamColor?.bubbleBackground,\n\t\t\t\t'--team-focused-border-color': nodeData.teamColor?.focusedBorderColor,\n\t\t\t\t'--node-expanded-color': nodeData.teamColor?.expandedBorderColor,\n\t\t\t}\"\n\t\t>\n\t\t\t<div v-if=\"showOverlay\"\n\t\t\t\tclass=\"humanresources-tree__node_drop-overlay\"\n\t\t\t>\n\t\t\t\t<div class=\"ui-icon-set\"\n\t\t\t\t\t :class=\"{\n\t\t\t\t\t'--circle-plus': isUserDropAllowed,\n\t\t\t\t\t'--cross-circle-50': !isUserDropAllowed\n\t\t\t\t}\"\n\t\t\t\t></div>\n\t\t\t\t<div class=\"humanresources-tree__node_drop-overlay-text\">\n\t\t\t\t\t{{ dropOverlayText }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tclass=\"humanresources-tree__node_summary\"\n\t\t\t\t@click.stop=\"onDepartmentClick('department')\"\n\t\t\t\t@mouseenter=\"onDragMouseEnter\"\n\t\t\t\t@mouseleave=\"onDragMouseLeave\"\n\t\t\t>\n\t\t\t\t<template v-if=\"showInfo\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"humanresources-tree__node_department\"\n\t\t\t\t\t\t:style=\"{ 'background-color': nodeData.teamColor?.treeHeadBackground}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"humanresources-tree__node_department-title\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tv-if=\"nodeData.parentId !== 0 && showDnd\"\n\t\t\t\t\t\t\t\tclass=\"humanresources-tree__node_dnd-icon ui-icon-set --more-points\"\n\t\t\t\t\t\t\t\t:class=\"{ '--team': isTeamEntity }\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\tv-hint\n\t\t\t\t\t\t\t\tclass=\"humanresources-tree__node_department-title_text\"\n\t\t\t\t\t\t\t\t:class=\"{ '--no-dnd': !showDnd }\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{{nodeData.name}}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"humanresources-tree__node_department-menu-icons\">\n\t\t\t\t\t\t\t<DepartmentInfoIconButton\n\t\t\t\t\t\t\t\tv-if=\"isTeamEntity\"\n\t\t\t\t\t\t\t\t:description=\"nodeData.description\"\n\t\t\t\t\t\t\t\t:entityId=\"nodeId\"\n\t\t\t\t\t\t\t\t:canvasZoom=\"canvasZoom\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<DepartmentMenuButton\n\t\t\t\t\t\t\t\tv-if=\"head && deputy\"\n\t\t\t\t\t\t\t\t:entityId=\"nodeId\"\n\t\t\t\t\t\t\t\t:entityType=\"nodeData.entityType\"\n\t\t\t\t\t\t\t></DepartmentMenuButton>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"humanresources-tree__node_description\">\n\t\t\t\t\t\t<HeadList v-if=\"head\" :items=\"head\" :isTeamEntity=\"isTeamEntity\"></HeadList>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-else\n\t\t\t\t\t\t\tclass=\"humanresources-tree__node_load-skeleton --heads\"\n\t\t\t\t\t\t></div>\n\t\t\t\t\t\t<div v-if=\"deputy\" class=\"humanresources-tree__node_employees\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<p class=\"humanresources-tree__node_employees-title\">\n\t\t\t\t\t\t\t\t\t{{\n\t\t\t\t\t\t\t\t\t\tisTeamEntity\n\t\t\t\t\t\t\t\t\t\t\t? loc('HUMANRESOURCES_COMPANY_STRUCTURE_TREE_TEAM_EMPLOYEES_TITLE')\n\t\t\t\t\t\t\t\t\t\t\t: loc('HUMANRESOURCES_COMPANY_STRUCTURE_TREE_EMPLOYEES_TITLE')\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\tclass=\"humanresources-tree__node_employees-count\"\n\t\t\t\t\t\t\t\t\t@click.stop=\"onDepartmentClick('employees')\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{{locPlural('HUMANRESOURCES_COMPANY_STRUCTURE_TREE_EMPLOYEES_COUNT', employeeCount)}}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div v-if=\"!deputy.length\"></div>\n\t\t\t\t\t\t\t<HeadList\n\t\t\t\t\t\t\t\t:items=\"deputy\"\n\t\t\t\t\t\t\t\t:title=\"deputyTitle\"\n\t\t\t\t\t\t\t\t:collapsed=\"true\"\n\t\t\t\t\t\t\t\t:type=\"'deputy'\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</HeadList>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-else\n\t\t\t\t\t\t\tclass=\"humanresources-tree__node_load-skeleton --deputies\"\n\t\t\t\t\t\t></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"humanresources-tree__node_subdivisions\"\n\t\t\t\t\t\t:class=\"subdivisionsClass\"\n\t\t\t\t\t\t@click.stop=\"onDepartmentClick('subdivisions')\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span>{{ subdivisionsText }}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<svg v-else width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" class=\"humanresources-tree__node_lock\">\n\t\t\t\t\t<path d=\"M12.0646 4.231C13.9529 4.231 15.4836 5.76968 15.4836 7.66775V10.5612H17.2905V7.66775C17.2905 4.76657 14.9507 2.41476 12.0645 2.41476C9.17827 2.41476 6.83847 4.76657 6.83847 7.66775V10.5612H8.64544V7.66775C8.64544 5.76968 10.1762 4.231 12.0646 4.231Z\" fill=\"#D5D7DB\"/>\n\t\t\t\t\t<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M7.14721 10.3237C6.12854 10.3237 5.30273 11.1495 5.30273 12.1682V18.506C5.30273 19.5246 6.12854 20.3504 7.14722 20.3504H17.1029C18.1216 20.3504 18.9474 19.5246 18.9474 18.506V12.1682C18.9474 11.1495 18.1216 10.3237 17.1029 10.3237H7.14721ZM12.9216 15.5869C12.9216 15.5685 12.93 15.5512 12.944 15.5392C13.2142 15.3085 13.3859 14.9643 13.3859 14.5797C13.3859 13.8847 12.8259 13.3214 12.1353 13.3214C11.4446 13.3214 10.8846 13.8847 10.8846 14.5797C10.8846 14.9643 11.0563 15.3085 11.3266 15.5392C11.3406 15.5512 11.3489 15.5685 11.3489 15.5869V16.7572C11.3489 17.1915 11.701 17.5435 12.1353 17.5435C12.5696 17.5435 12.9216 17.1915 12.9216 16.7572V15.5869Z\" fill=\"#D5D7DB\"/>\n\t\t\t\t</svg>\n\t\t\t\t<SubdivisionAddButton\n\t\t\t\t\tv-if=\"showSubdivisionAddButton\"\n\t\t\t\t\t:entityId=\"nodeId\"\n\t\t\t\t\t:entityType=\"nodeData.entityType\"\n\t\t\t\t\t@click.stop\n\t\t\t\t></SubdivisionAddButton>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if=\"nodeData.parentId === 0 && !hasChildren\"\n\t\t\t\tclass=\"humanresources-tree__node_empty-skeleton\"\n\t\t\t></div>\n\t\t\t<div\n\t\t\t\tv-if=\"hasChildren\"\n\t\t\t\tref=\"childrenNode\"\n\t\t\t\tclass=\"humanresources-tree__node_children\"\n\t\t\t\t:style=\"childNodeStyle\"\n\t\t\t>\n\t\t\t\t<TransitionGroup>\n\t\t\t\t\t<treeNode\n\t\t\t\t\t\tv-for=\"id in nodeData.children\"\n\t\t\t\t\t\tv-if=\"isExpanded || childrenMounted\"\n\t\t\t\t\t\tv-show=\"isExpanded\"\n\t\t\t\t\t\t:ref=\"'node-' + id\"\n\t\t\t\t\t\t:key=\"id\"\n\t\t\t\t\t\t:nodeId=\"id\"\n\t\t\t\t\t\t:expandedNodes=\"expandedNodes\"\n\t\t\t\t\t\t:canvasZoom=\"canvasZoom\"\n\t\t\t\t\t\t:currentDepartments=\"currentDepartments\"\n\t\t\t\t\t\t:isShown=\"isExpanded\"\n\t\t\t\t\t\t@calculatePosition=\"calculatePosition\"\n\t\t\t\t\t\t:userDropTargetNodeId=\"userDropTargetNodeId\"\n\t\t\t\t\t\t:isUserDropAllowed=\"isUserDropAllowed\"\n\t\t\t\t\t\t:isDraggingUser=\"isDraggingUser\"\n\t\t\t\t\t/>\n\t\t\t\t</TransitionGroup>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Event } from 'main.core';\nimport { mapState } from 'ui.vue3.pinia';\nimport { EventEmitter, type BaseEvent } from 'main.core.events';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { events } from '../../consts';\nimport type { ConnectorsData, MountedDepartment } from '../../types';\n\n// @vue/component\nexport const Connectors = {\n\tname: 'companyTreeConnectors',\n\n\texpose: [\n\t\t'toggleConnectorsVisibility',\n\t\t'toggleConnectorHighlighting',\n\t\t'toggleAllConnectorsVisibility',\n\t\t'adaptConnectorsAfterReorder',\n\t],\n\n\tprops: {\n\t\tisLocatedDepartmentVisible: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\t/** @type Map */\n\t\ttreeNodes: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tdata(): { connectors: Record<string, ConnectorsData> }\n\t{\n\t\treturn { connectors: {} };\n\t},\n\n\tcomputed:\n\t{\n\t\t...mapState(useChartStore, ['focusedNode', 'departments']),\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.subscribeOnEvents();\n\t\tthis.prevWindowWidth = window.innerWidth;\n\t},\n\n\tbeforeUnmount(): void\n\t{\n\t\tthis.unsubscribeFromEvents();\n\t},\n\n\tmethods:\n\t{\n\t\tonAddConnector({ data }: MountedDepartment): void\n\t\t{\n\t\t\tconst { id, parentId } = data;\n\t\t\tif (!parentId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst connector = this.connectors[`${parentId}-${id}`] ?? {};\n\t\t\tObject.assign(connector, data);\n\t\t\tif (connector.highlighted)\n\t\t\t{\n\t\t\t\tdelete this.connectors[`${parentId}-${id}`];\n\t\t\t}\n\n\t\t\tthis.connectors[`${parentId}-${id}`] = {\n\t\t\t\tshow: true,\n\t\t\t\thighlighted: false,\n\t\t\t\t...connector,\n\t\t\t};\n\t\t},\n\t\tonRemoveConnector({ data }: MountedDepartment): void\n\t\t{\n\t\t\tconst { parentId, id } = data;\n\t\t\tdelete this.connectors[`${parentId}-${id}`];\n\t\t},\n\t\tonAdaptSiblingConnectors({ data }: { nodeId: number; parentId: number; offset: number; }): void\n\t\t{\n\t\t\tconst { nodeId, parentId, offset } = data;\n\t\t\tconst parentDepartment = this.departments.get(parentId);\n\t\t\tconst isMounted = parentDepartment.children.includes(nodeId);\n\t\t\tconst values = Object.values(this.connectors);\n\t\t\tconst parsedSiblingConnectors = values.reduce((acc, connector) => {\n\t\t\t\tconst { endPoint: currentEndPoint, id: currentId, parentId: currentParentId } = connector;\n\t\t\t\tif (!currentId || currentParentId !== parentId || currentId === nodeId)\n\t\t\t\t{\n\t\t\t\t\treturn acc;\n\t\t\t\t}\n\n\t\t\t\tlet sign = 0;\n\t\t\t\tif (isMounted)\n\t\t\t\t{\n\t\t\t\t\tsign = parentDepartment.children.indexOf(nodeId)\n\t\t\t\t\t\t> parentDepartment.children.indexOf(currentId) ? 1 : -1;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tconst { endPoint } = this.connectors[`${parentId}-${nodeId}`];\n\t\t\t\t\tsign = endPoint.x > currentEndPoint.x ? 1 : -1;\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\t...acc,\n\t\t\t\t\t[currentId]: sign,\n\t\t\t\t};\n\t\t\t}, {});\n\t\t\tvalues.forEach((connector) => {\n\t\t\t\tconst {\n\t\t\t\t\tid: currentId,\n\t\t\t\t\tparentId: currentParentId,\n\t\t\t\t\tparentsPath,\n\t\t\t\t\tendPoint: currentEndPoint,\n\t\t\t\t\tstartPoint: currentStartPoint,\n\t\t\t\t} = connector;\n\t\t\t\tif (!currentId || currentId === nodeId)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (currentParentId === parentId)\n\t\t\t\t{\n\t\t\t\t\tconst { x } = currentEndPoint;\n\t\t\t\t\tconst sign = parsedSiblingConnectors[currentId];\n\t\t\t\t\tObject.assign(currentEndPoint, { x: x + offset * sign });\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst ancestorId = parentsPath?.find((id) => {\n\t\t\t\t\treturn Boolean(parsedSiblingConnectors[id]);\n\t\t\t\t});\n\t\t\t\tif (ancestorId)\n\t\t\t\t{\n\t\t\t\t\tconst ancestorSign = parsedSiblingConnectors[ancestorId];\n\t\t\t\t\tObject.assign(currentStartPoint, { x: currentStartPoint.x + offset * ancestorSign });\n\t\t\t\t\tObject.assign(currentEndPoint, { x: currentEndPoint.x + offset * ancestorSign });\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tadaptConnectorsAfterReorder(ids: number[], shift: Number, isRoot: boolean): void\n\t\t{\n\t\t\tids.forEach((departmentId) => {\n\t\t\t\tconst { parentId, children } = this.departments.get(departmentId);\n\t\t\t\tconst connector = this.connectors[`${parentId}-${departmentId}`];\n\t\t\t\tif (!connector)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tObject.assign(connector.endPoint, { x: connector.endPoint.x + shift });\n\t\t\t\tif (!isRoot)\n\t\t\t\t{\n\t\t\t\t\tObject.assign(connector.startPoint, { x: connector.startPoint.x + shift });\n\t\t\t\t}\n\n\t\t\t\tif (children?.length > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.adaptConnectorsAfterReorder(children, shift, false);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tonAdaptConnectorHeight({ data }: BaseEvent): void\n\t\t{\n\t\t\tconst { shift, nodeId } = data;\n\t\t\tObject.values(this.connectors).forEach((connector) => {\n\t\t\t\tif (connector.parentId === nodeId)\n\t\t\t\t{\n\t\t\t\t\tObject.assign(connector.startPoint, { y: connector.startPoint.y + shift });\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\ttoggleConnectorsVisibility(parentId: number, show: boolean): void\n\t\t{\n\t\t\tconst { children } = this.departments.get(parentId);\n\t\t\tchildren.forEach((childId) => {\n\t\t\t\tconst connector = this.connectors[`${parentId}-${childId}`] ?? {};\n\t\t\t\tthis.connectors = {\n\t\t\t\t\t...this.connectors,\n\t\t\t\t\t[`${parentId}-${childId}`]: { ...connector, show },\n\t\t\t\t};\n\t\t\t});\n\t\t},\n\t\ttoggleAllConnectorsVisibility(shouldShow: boolean, expandedNodes: number[]): void\n\t\t{\n\t\t\tObject.keys(this.connectors).forEach((key) => {\n\t\t\t\tconst connector = this.connectors[key];\n\t\t\t\tif (!shouldShow || (expandedNodes.includes(connector.parentId) && shouldShow))\n\t\t\t\t{\n\t\t\t\t\tconnector.show = shouldShow;\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\ttoggleConnectorHighlighting(nodeId: number, expanded: boolean): void\n\t\t{\n\t\t\tconst { parentId } = this.departments.get(nodeId);\n\t\t\tif (!parentId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!expanded)\n\t\t\t{\n\t\t\t\tthis.connectors[`${parentId}-${nodeId}`] = {\n\t\t\t\t\t...this.connectors[`${parentId}-${nodeId}`],\n\t\t\t\t\thighlighted: false,\n\t\t\t\t};\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst highlightedConnector = this.connectors[`${parentId}-${nodeId}`] ?? {};\n\t\t\tdelete this.connectors[`${parentId}-${nodeId}`];\n\t\t\tthis.connectors = {\n\t\t\t\t...this.connectors,\n\t\t\t\t[`${parentId}-${nodeId}`]: {\n\t\t\t\t\t...highlightedConnector,\n\t\t\t\t\thighlighted: true,\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\tgetPath(id: string): string\n\t\t{\n\t\t\tconst connector = this.connectors[id];\n\t\t\tconst { startPoint, endPoint, parentId } = connector;\n\n\t\t\tif (!startPoint || !endPoint)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tlet verticalLineHeight = 115;\n\t\t\tconst parentNode = this.treeNodes.get(parentId);\n\t\t\tconst parentNodeStyle = getComputedStyle(parentNode);\n\t\t\tconst minDepartmentHeight = parseInt(parentNodeStyle.getPropertyValue('--min-height'), 10);\n\t\t\tconst diffHeight = parentNode.offsetHeight - minDepartmentHeight;\n\t\t\tverticalLineHeight = diffHeight > 0 ? verticalLineHeight - diffHeight : verticalLineHeight;\n\t\t\tconst shiftY = 1;\n\n\t\t\tconst startY = startPoint.y - shiftY;\n\t\t\tconst shadowOffset = this.focusedNode === connector.id ? 12 : 0;\n\t\t\tconst rounded = { start: '', end: '' };\n\t\t\tlet arcRadius = 0;\n\n\t\t\tif (Math.round(startPoint.x) > Math.round(endPoint.x))\n\t\t\t{\n\t\t\t\tarcRadius = 15;\n\t\t\t\trounded.start = 'a15,15 0 0 1 -15,15';\n\t\t\t\trounded.end = 'a15,15 0 0 0 -15,15';\n\t\t\t}\n\t\t\telse if (Math.round(startPoint.x) < Math.round(endPoint.x))\n\t\t\t{\n\t\t\t\tarcRadius = -15;\n\t\t\t\trounded.start = 'a15,15 0 0 0 15,15';\n\t\t\t\trounded.end = 'a15,15 0 0 1 15,15';\n\t\t\t}\n\n\t\t\tconst adjustedEndY = endPoint.y - shadowOffset;\n\n\t\t\treturn [\n\t\t\t\t`M${startPoint.x} ${startY}`,\n\t\t\t\t`V${startY + verticalLineHeight}`,\n\t\t\t\t`${String(rounded.start)}`,\n\t\t\t\t`H${endPoint.x + arcRadius}`,\n\t\t\t\t`${String(rounded.end)}`,\n\t\t\t\t`V${adjustedEndY}`,\n\t\t\t].join('');\n\t\t},\n\t\tsubscribeOnEvents(): void\n\t\t{\n\t\t\tthis.events = {\n\t\t\t\t[events.HR_DEPARTMENT_CONNECT]: this.onAddConnector,\n\t\t\t\t[events.HR_DEPARTMENT_DISCONNECT]: this.onRemoveConnector,\n\t\t\t\t[events.HR_DEPARTMENT_ADAPT_SIBLINGS]: this.onAdaptSiblingConnectors,\n\t\t\t\t[events.HR_DEPARTMENT_ADAPT_CONNECTOR_HEIGHT]: this.onAdaptConnectorHeight,\n\t\t\t};\n\t\t\tObject.entries(this.events).forEach(([event, handle]) => {\n\t\t\t\tEventEmitter.subscribe(event, handle);\n\t\t\t});\n\t\t\tEvent.bind(window, 'resize', this.onResizeWindow);\n\t\t},\n\t\tunsubscribeFromEvents(): void\n\t\t{\n\t\t\tObject.entries(this.events).forEach(([event, handle]) => {\n\t\t\t\tEventEmitter.unsubscribe(event, handle);\n\t\t\t});\n\t\t\tEvent.unbind(window, 'resize', this.onResizeWindow);\n\t\t},\n\t\tonResizeWindow(): void\n\t\t{\n\t\t\tconst offset = (window.innerWidth - this.prevWindowWidth) / 2;\n\t\t\tthis.prevWindowWidth = window.innerWidth;\n\t\t\tif (offset === 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tObject.keys(this.connectors).forEach((key) => {\n\t\t\t\tconst connector = this.connectors[key];\n\t\t\t\tif (connector.startPoint && connector.endPoint)\n\t\t\t\t{\n\t\t\t\t\tconst startPointX = connector.startPoint.x;\n\t\t\t\t\tconst endPointX = connector.endPoint.x;\n\t\t\t\t\tObject.assign(connector.startPoint, { x: startPointX + offset });\n\t\t\t\t\tObject.assign(connector.endPoint, { x: endPointX + offset });\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<svg class=\"humanresources-tree__connectors\" fill=\"none\">\n\t\t\t<marker\n\t\t\t\tid='arrow'\n\t\t\t\tmarkerUnits='userSpaceOnUse'\n\t\t\t\tmarkerWidth='20'\n\t\t\t\tmarkerHeight='12'\n\t\t\t\trefX='10'\n\t\t\t\trefY='10.5'\n\t\t\t>\n\t\t\t\t<path d=\"M1 1L10 10L19 1\" class=\"--highlighted\" />\n\t\t\t</marker>\n\t\t\t<path\n\t\t\t\tv-for=\"(connector, id) in connectors\"\n\t\t\t\tv-show=\"connector.show\"\n\t\t\t\t:ref=\"id\"\n\t\t\t\t:marker-end=\"connector.highlighted ? 'url(#arrow)' : null\"\n\t\t\t\t:class=\"{ '--highlighted': connector.highlighted }\"\n\t\t\t\t:id=\"id\"\n\t\t\t\t:d=\"getPath(id)\"\n\t\t\t></path>\n\t\t</svg>\n\t`,\n};\n","import { Event, Dom, Tag, Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { events } from '../../../../consts';\nimport { PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\n\nconst FULL_WIDTH = 302;\nconst CANVAS_MOVE_SPEED = 15;\n\nexport class TreeNodeDragController\n{\n\t#prevAffectedItems: HTMLElement[];\n\t#targetData: { targetItem: HTMLElement; insertion: string; };\n\t#transform: { x: number; y: number; prevX: number; prevY: number; };\n\t#tree: HTMLElement;\n\t#draggedItem: HTMLElement;\n\t#ghost: HTMLElement;\n\t#positionPointer: HTMLElement;\n\t#zoom: number;\n\t#canvas: { x: number; y: number; };\n\t#prevPageX: number = 0;\n\t#prevPageY: number = 0;\n\t#targetTeams: HTMLElement[];\n\t#permissionChecker: PermissionChecker;\n\t#draggedEntityType: string;\n\t#mouseMoveHandler: (event: MouseEvent) => void;\n\t#mouseUpHandler: (event: MouseEvent) => void;\n\t#mouseWheelHandler: (event: MouseEvent) => void;\n\n\tconstructor(el: HTMLElement)\n\t{\n\t\tEvent.bind(el, 'mousedown', (event: MouseEvent) => {\n\t\t\tthis.#onMouseDown(event);\n\t\t});\n\t\tthis.#mouseMoveHandler = (event: MouseEvent) => {\n\t\t\tthis.#onMouseMove(event);\n\t\t};\n\n\t\tthis.#mouseUpHandler = (event: MouseEvent) => {\n\t\t\tthis.#onMouseUp(event);\n\t\t};\n\n\t\tthis.#mouseWheelHandler = (event: MouseEvent) => {\n\t\t\tthis.#onMouseWheel(event);\n\t\t};\n\n\t\tthis.#permissionChecker = PermissionChecker.getInstance();\n\t}\n\n\t#onMouseDown({ target, currentTarget: tree, pageX, pageY }: MouseEvent): void\n\t{\n\t\tif (!Dom.hasClass(target, 'humanresources-tree__node_dnd-icon'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tevent.stopPropagation();\n\t\tthis.#tree = tree;\n\t\tthis.#zoom = Number(tree.dataset.zoom);\n\t\tthis.#canvas = { x: Number(tree.dataset.x), y: Number(tree.dataset.y) };\n\t\tthis.#draggedItem = target.closest('.humanresources-tree__node');\n\t\tthis.#ghost = this.#createGhost();\n\t\tthis.#prevPageX = pageX;\n\t\tthis.#prevPageY = pageY;\n\t\tthis.#positionPointer = this.#createPositionPointer();\n\t\tthis.#targetTeams = [];\n\t\tthis.#prevAffectedItems = [];\n\t\tthis.#transform = { x: 0, y: 0, prevX: 0, prevY: 0 };\n\t\tthis.#targetData = {};\n\t\tthis.#draggedEntityType = Dom.hasClass(this.#draggedItem, '--team') ? EntityTypes.team : EntityTypes.department;\n\t\tDom.addClass(tree, '--drag-progress');\n\t\tDom.addClass(this.#draggedItem.parentElement.parentElement, '--blur');\n\t\tthis.#setPositionPointerTransform(this.#draggedItem);\n\t\tthis.#setStyles();\n\t\tEvent.bind(document, 'mousemove', this.#mouseMoveHandler);\n\t\tEvent.bind(document, 'mouseup', this.#mouseUpHandler);\n\t\tEvent.bind(document, 'wheel', this.#mouseWheelHandler);\n\t\tEventEmitter.emit(events.HR_ENTITY_TOGGLE_ELEMENTS, { shouldShowElements: false });\n\t\tconst draggedId = Number(this.#draggedItem.dataset.id);\n\t\tEventEmitter.emit(events.HR_DRAG_ENTITY, { draggedId });\n\t}\n\n\t#onMouseMove({ pageX, pageY }: MouseEvent): void\n\t{\n\t\tDom.addClass(this.#draggedItem, '--hidden');\n\t\tDom.addClass(this.#tree.parentElement, '--disabled-transition');\n\t\tDom.removeClass(this.#positionPointer, ['--inside', '--no-permission']);\n\t\tDom.style(this.#positionPointer, 'height', `${this.#draggedItem.offsetHeight}px`);\n\t\tthis.#resetTeamsBlur();\n\t\tthis.#transform.prevX = this.#transform.x;\n\t\tthis.#transform.prevY = this.#transform.y;\n\t\tthis.#transform.x += (pageX - this.#prevPageX) / this.#zoom;\n\t\tthis.#transform.y += (pageY - this.#prevPageY) / this.#zoom;\n\t\tthis.#prevPageX = pageX;\n\t\tthis.#prevPageY = pageY;\n\t\tthis.#prevAffectedItems.forEach((affectedItem) => this.#setTransform(affectedItem, 0, 0));\n\t\tthis.#prevAffectedItems = [];\n\t\tconst { directionX, directionY } = this.#checkForDraggedOverflow();\n\t\tthis.#transform.x = directionX === 0\n\t\t\t? this.#transform.x\n\t\t\t: this.#transform.x + directionX * CANVAS_MOVE_SPEED / this.#zoom;\n\t\tthis.#transform.y = directionY === 0\n\t\t\t? this.#transform.y\n\t\t\t: this.#transform.y + directionY * CANVAS_MOVE_SPEED / this.#zoom;\n\t\tthis.#setTransform(this.#ghost, this.#transform.x, this.#transform.y, 4);\n\t\tthis.#setPositionPointerTransform(this.#draggedItem);\n\t\tthis.#targetData = this.#getTargetData();\n\t\tif (!this.#targetData.insertion)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst { insertion, targetItem, hasPermission } = this.#targetData;\n\t\tif (!hasPermission)\n\t\t{\n\t\t\tDom.addClass(this.#positionPointer, '--no-permission');\n\t\t}\n\n\t\tthis.#setPositionPointerTransform(targetItem);\n\t\tswitch (insertion)\n\t\t{\n\t\t\tcase 'reorder':\n\t\t\t{\n\t\t\t\tconst affectedItems = this.#reorderEntity(targetItem);\n\t\t\t\tthis.#prevAffectedItems = affectedItems;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'sibling-left':\n\t\t\tcase 'sibling-right':\n\t\t\t{\n\t\t\t\tconst affectedItems = this.#changeParentWithReorder(targetItem, insertion);\n\t\t\t\tthis.#prevAffectedItems = affectedItems;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tdefault:\n\t\t\t\tDom.addClass(this.#positionPointer, '--inside');\n\t\t\t\tDom.style(this.#positionPointer, 'height', `${targetItem.offsetHeight}px`);\n\t\t}\n\t}\n\n\t#onMouseUp(): void\n\t{\n\t\tthis.#setStyles(true);\n\t\tEvent.unbind(document, 'mousemove', this.#mouseMoveHandler);\n\t\tEvent.unbind(document, 'mouseup', this.#mouseUpHandler);\n\t\tEvent.unbind(document, 'mouseup', this.#mouseWheelHandler);\n\t\tthis.#prevAffectedItems.forEach((item) => this.#setTransform(item, 0, 0));\n\t\tDom.removeClass(this.#tree, '--drag-progress');\n\t\tDom.removeClass(this.#draggedItem.parentElement.parentElement, '--blur');\n\t\tDom.removeClass(this.#draggedItem, '--hidden');\n\t\tDom.removeClass(this.#tree.parentElement, '--disabled-transition');\n\t\tDom.remove(this.#ghost);\n\t\tDom.remove(this.#positionPointer);\n\t\tthis.#resetTeamsBlur();\n\t\tEventEmitter.emit(events.HR_ENTITY_TOGGLE_ELEMENTS, { shouldShowElements: true });\n\t\tconst { insertion, targetItem, hasPermission } = this.#targetData;\n\t\tif (!insertion || !hasPermission)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst draggedIndex = [...this.#draggedItem.parentElement.children].indexOf(this.#draggedItem);\n\t\tconst targetIndex = [...targetItem.parentElement.children].indexOf(targetItem);\n\t\tconst draggedId = Number(this.#draggedItem.dataset.id);\n\t\tEventEmitter.emit(events.HR_DROP_ENTITY, {\n\t\t\tdraggedId,\n\t\t\ttargetId: Number(targetItem.dataset.id),\n\t\t\ttargetIndex,\n\t\t\taffectedItems: this.#prevAffectedItems.map((item) => Number(item.dataset.id)),\n\t\t\tdirection: draggedIndex < targetIndex ? 1 : -1,\n\t\t\tinsertion,\n\t\t});\n\t}\n\n\t#onMouseWheel({ shiftKey }: WheelEvent): void\n\t{\n\t\tif (shiftKey)\n\t\t{\n\t\t\tconst currentCanvasX = Number(this.#tree.dataset.x);\n\t\t\tconst movementX = currentCanvasX - this.#canvas.x;\n\t\t\tthis.#transform.x -= movementX / this.#zoom;\n\t\t\tthis.#canvas.x = currentCanvasX;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst currentCanvasY = Number(this.#tree.dataset.y);\n\t\t\tconst movementY = currentCanvasY - this.#canvas.y;\n\t\t\tthis.#transform.y -= movementY / this.#zoom;\n\t\t\tthis.#canvas.y = currentCanvasY;\n\t\t}\n\n\t\tthis.#setTransform(this.#ghost, this.#transform.x, this.#transform.y, 4);\n\t}\n\n\t#createGhost(): HTMLElement\n\t{\n\t\tconst ghost = this.#draggedItem.cloneNode(true);\n\t\tDom.addClass(ghost, 'humanresources-tree__dnd-ghost');\n\t\tDom.removeClass(ghost, ['--expanded', '--focused']);\n\t\tconst { x: treeX, y: treeY } = this.#tree.getBoundingClientRect();\n\t\tconst { x: draggedX, y: draggedY } = this.#draggedItem.getBoundingClientRect();\n\t\tconst left = draggedX - treeX;\n\t\tconst top = draggedY - treeY;\n\t\tDom.style(ghost, 'left', `${left / this.#zoom}px`);\n\t\tDom.style(ghost, 'top', `${top / this.#zoom}px`);\n\t\tDom.append(ghost, this.#tree);\n\n\t\treturn ghost;\n\t}\n\n\t#createPositionPointer(): HTMLElement\n\t{\n\t\tconst { offsetWidth, offsetHeight } = this.#draggedItem;\n\t\tconst text = Dom.hasClass(this.#draggedItem, '--team')\n\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DRAG_TEAM_LABEL')\n\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DRAG_DEPARTMENT_LABEL');\n\t\tconst positionPointer = Tag.render`\n\t\t\t<div\n\t\t\t\tclass=\"humanresources-tree__position-pointer\"\n\t\t\t\tstyle=\"width: ${offsetWidth}px; height: ${offsetHeight}px;);\"\n\t\t\t>\n\t\t\t\t<div>\n\t\t\t\t\t<div class=\"ui-icon-set --circle-plus\"></div>\n\t\t\t\t\t<span>${text}</span>\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<div class=\"ui-icon-set --cross-circle-50\"></div>\n\t\t\t\t\t<span>\n\t\t\t\t\t\t${Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_NO_DRAG_PERMISSION')}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t\tDom.append(positionPointer, this.#tree);\n\t\tthis.#setPositionPointerTransform(this.#draggedItem);\n\n\t\treturn positionPointer;\n\t}\n\n\t#setTransform(element: HTMLElement, x: number, y: number, rotation: number = 0): void\n\t{\n\t\tif (x === 0 && y === 0)\n\t\t{\n\t\t\tDom.style(element, 'transform', '');\n\n\t\t\treturn;\n\t\t}\n\n\t\tDom.style(element, 'transform', `translate3d(${x}px, ${y}px, 0) rotate(${rotation}deg)`);\n\t}\n\n\t#setPositionPointerTransform(node: HTMLElement): void\n\t{\n\t\tconst { x: treeX, y: treeY } = this.#tree.getBoundingClientRect();\n\t\tconst { x: nodeX, y: nodeY } = node.getBoundingClientRect();\n\t\tconst x = (nodeX - treeX) / this.#zoom;\n\t\tconst y = (nodeY - treeY) / this.#zoom;\n\t\tthis.#setTransform(this.#positionPointer, x, y);\n\t}\n\n\t#getTargetData(): { insertion?: string; targetItem?: HTMLElement; }\n\t{\n\t\tDom.addClass(this.#ghost, '--disabled-events');\n\t\tthis.#setTransform(this.#ghost, this.#transform.x, this.#transform.y);\n\t\tconst reorderThreshold = 0.7;\n\t\tconst changeParentWithReorderThreshold = 0.6;\n\t\tconst {\n\t\t\tx,\n\t\t\ty,\n\t\t\twidth: draggedWidth,\n\t\t\theight: draggedHeight,\n\t\t} = this.#ghost.getBoundingClientRect();\n\t\tthis.#setTransform(this.#ghost, this.#transform.x, this.#transform.y, 4);\n\t\tconst points = [\n\t\t\t{ x, y },\n\t\t\t{ x: x + draggedWidth, y },\n\t\t\t{ x, y: y + draggedHeight },\n\t\t\t{ x: x + draggedWidth, y: y + draggedHeight },\n\t\t\t{ x, y: y + draggedHeight / 2 },\n\t\t\t{ x: x + draggedWidth, y: y + draggedHeight / 2 },\n\t\t];\n\t\tconst targetData = points.reduce((acc, point, i) => {\n\t\t\tif (acc.insertion)\n\t\t\t{\n\t\t\t\treturn acc;\n\t\t\t}\n\n\t\t\tconst belowItem = document.elementFromPoint(point.x, point.y);\n\t\t\tconst targetItemSummary = belowItem?.closest('.humanresources-tree__node_summary');\n\t\t\tconst targetItem = targetItemSummary?.parentElement;\n\t\t\tif (!targetItem || targetItem === this.#draggedItem)\n\t\t\t{\n\t\t\t\treturn acc;\n\t\t\t}\n\n\t\t\tconst {\n\t\t\t\tx: targetX,\n\t\t\t\ty: targetY,\n\t\t\t\twidth: targetWidth,\n\t\t\t\theight: targetHeight,\n\t\t\t} = targetItem.getBoundingClientRect();\n\t\t\tconst sameParent = this.#draggedItem.parentElement === targetItem.parentElement;\n\t\t\tconst hasSortPermission = this.#permissionChecker.canSortEntitiesByParentId(\n\t\t\t\tNumber(targetItem.parentElement.parentElement.dataset.id),\n\t\t\t);\n\t\t\tconst allowSort = i === 0 && !Dom.hasClass(targetItem, '--root') && hasSortPermission;\n\t\t\tacc.targetItem = targetItem;\n\t\t\tif (sameParent && x + reorderThreshold * draggedWidth < targetX + targetWidth && allowSort)\n\t\t\t{\n\t\t\t\treturn { ...acc, insertion: 'reorder' };\n\t\t\t}\n\n\t\t\tif (!sameParent && y + changeParentWithReorderThreshold * draggedHeight < targetY + targetHeight && allowSort)\n\t\t\t{\n\t\t\t\treturn {\n\t\t\t\t\t...acc,\n\t\t\t\t\tinsertion: x < targetX + targetWidth / 2 ? 'sibling-left' : 'sibling-right',\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tconst isDepartmentInsertToTeam = Dom.hasClass(targetItem, '--team') && !Dom.hasClass(this.#draggedItem, '--team');\n\t\t\tconst isInsertToParent = this.#draggedItem.parentElement.parentElement === targetItem;\n\t\t\tif (isDepartmentInsertToTeam || isInsertToParent)\n\t\t\t{\n\t\t\t\tif (isDepartmentInsertToTeam)\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(targetItem, '--blur');\n\t\t\t\t\tthis.#targetTeams.push(targetItem);\n\t\t\t\t}\n\n\t\t\t\treturn acc;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\t...acc,\n\t\t\t\tinsertion: 'inside',\n\t\t\t\thasPermission: this.#permissionChecker.canBeParentForEntity(\n\t\t\t\t\tNumber(targetItem.dataset.id),\n\t\t\t\t\tthis.#draggedEntityType,\n\t\t\t\t),\n\t\t\t};\n\t\t}, { hasPermission: true });\n\n\t\tDom.removeClass(this.#ghost, '--disabled-events');\n\n\t\treturn targetData;\n\t}\n\n\t#reorderEntity(targetItem: HTMLElement): HTMLElement[]\n\t{\n\t\tconst children = [...this.#draggedItem.parentElement.children];\n\t\tconst draggedIndex = children.indexOf(this.#draggedItem);\n\t\tconst targetIndex = [...targetItem.parentElement.children].indexOf(targetItem);\n\t\tconst direction = draggedIndex < targetIndex ? 1 : -1;\n\t\tconst affectedItems = direction > 0\n\t\t\t? children.slice(draggedIndex + 1, targetIndex + 1)\n\t\t\t: children.slice(targetIndex, draggedIndex);\n\t\taffectedItems.forEach((affectedItem) => this.#setTransform(affectedItem, -direction * FULL_WIDTH, 0));\n\n\t\treturn affectedItems;\n\t}\n\n\t#changeParentWithReorder(targetItem: HTMLElement, insertion: string): HTMLElement[]\n\t{\n\t\tconst children = [...targetItem.parentElement.children];\n\t\tconst targetIndex = children.indexOf(targetItem);\n\t\tlet affectedItems = [];\n\t\tif (insertion === 'sibling-right')\n\t\t{\n\t\t\taffectedItems = children.slice(0, targetIndex + 1);\n\t\t\taffectedItems.forEach((affectedItem) => this.#setTransform(affectedItem, -FULL_WIDTH, 0));\n\t\t}\n\t\telse\n\t\t{\n\t\t\taffectedItems = children.slice(targetIndex);\n\t\t\taffectedItems.forEach((affectedItem) => this.#setTransform(affectedItem, FULL_WIDTH, 0));\n\t\t}\n\n\t\treturn affectedItems;\n\t}\n\n\t#checkForDraggedOverflow(): { directionX: number; directionY: number; }\n\t{\n\t\tlet directionX = 0;\n\t\tlet directionY = 0;\n\t\tconst { left, top } = this.#draggedItem.getBoundingClientRect();\n\t\tconst zoomedLeft = left / this.#zoom;\n\t\tconst zoomedTop = top / this.#zoom;\n\t\tif (zoomedLeft + this.#transform.x < 0)\n\t\t{\n\t\t\tdirectionX = this.#transform.x < this.#transform.prevX ? -1 : 0;\n\t\t}\n\n\t\tif (zoomedLeft + this.#transform.x + this.#draggedItem.offsetWidth > document.body.offsetWidth / this.#zoom)\n\t\t{\n\t\t\tdirectionX = this.#transform.x > this.#transform.prevX ? 1 : 0;\n\t\t}\n\n\t\tif (zoomedTop + this.#transform.y < 0)\n\t\t{\n\t\t\tdirectionY = this.#transform.y < this.#transform.prevY ? -1 : 0;\n\t\t}\n\n\t\tif (zoomedTop + this.#transform.y + this.#draggedItem.offsetHeight > document.body.offsetHeight / this.#zoom)\n\t\t{\n\t\t\tdirectionY = this.#transform.y > this.#transform.prevY ? 1 : 0;\n\t\t}\n\n\t\tif (directionX !== 0 || directionY !== 0)\n\t\t{\n\t\t\tEventEmitter.emit(events.HR_ORG_CHART_TRANSFORM_CANVAS, {\n\t\t\t\tdirectionX,\n\t\t\t\tdirectionY,\n\t\t\t\tspeed: CANVAS_MOVE_SPEED,\n\t\t\t});\n\t\t}\n\n\t\treturn {\n\t\t\tdirectionX,\n\t\t\tdirectionY,\n\t\t};\n\t}\n\n\t#setStyles(shouldReset: ?boolean): void\n\t{\n\t\tDom.style(document.body, 'userSelect', 'none');\n\t\tDom.style(document.body, '-webkit-user-select', 'none');\n\t\tDom.style(document.body, 'cursor', 'grabbing');\n\t\tif (shouldReset)\n\t\t{\n\t\t\tDom.style(document.body, 'userSelect', '');\n\t\t\tDom.style(document.body, '-webkit-user-select', '');\n\t\t\tDom.style(document.body, 'cursor', '');\n\t\t}\n\t}\n\n\t#resetTeamsBlur(): void\n\t{\n\t\tthis.#targetTeams.forEach((team) => Dom.removeClass(team, '--blur'));\n\t}\n}\n","import { TreeNodeDragController } from './classes/drag-and-drop-controller';\n\nexport const DragAndDrop = {\n\tmounted(el: HTMLElement): void\n\t{\n\t\tnew TreeNodeDragController(el);\n\t},\n\tupdated(el: HTMLElement, { value }: Object): void\n\t{\n\t\tconst { x, y, zoom } = value;\n\t\tel.setAttribute('data-zoom', zoom);\n\t\tel.setAttribute('data-x', x);\n\t\tel.setAttribute('data-y', y);\n\t},\n};\n","import { PermissionChecker, PermissionActions } from 'humanresources.company-structure.permission-checker';\nimport { UserManagementDialogAPI } from 'humanresources.company-structure.user-management-dialog';\nimport { Runtime, Loc, Text } from 'main.core';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\nimport { MessageBox, MessageBoxButtons } from 'ui.dialogs.messagebox';\nimport { UI } from 'ui.notification';\nimport { ButtonColor } from 'ui.buttons';\nimport { DepartmentContentActions } from '../../../../department-content/src/actions';\nimport { DepartmentAPI } from '../../../../department-content/src/api';\nimport { UserManagementDialogActions } from '../../../../user-management-dialog/src/actions';\nimport { UrlProvidedParamsService } from '../../classes/url-provided-params-service';\nimport { TreeNode } from './tree-node/tree-node';\nimport { Connectors } from './connectors';\nimport { DragAndDrop } from './directives/drag-and-drop';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { MoveEmployeeConfirmationPopup, ConfirmationPopup } from 'humanresources.company-structure.structure-components';\nimport { mapState } from 'ui.vue3.pinia';\nimport { EventEmitter, type BaseEvent } from 'main.core.events';\nimport { events } from '../../consts';\nimport { chartAPI } from '../../api';\nimport { sendData as analyticsSendData } from 'ui.analytics';\nimport { OrgChartActions } from '../../actions';\nimport type { MountedDepartment, TreeData, DragAndDropData } from '../../types';\nimport './style.css';\n\n// @vue/component\nexport const Tree = {\n\tname: 'companyTree',\n\n\tcomponents: {\n\t\tTreeNode,\n\t\tConnectors,\n\t\tMoveEmployeeConfirmationPopup,\n\t\tConfirmationPopup,\n\t},\n\n\tdirectives: { dnd: DragAndDrop },\n\n\tprovide(): { [key: string]: Function }\n\t{\n\t\treturn {\n\t\t\tgetTreeBounds: () => this.getTreeBounds(),\n\t\t};\n\t},\n\n\tprops: {\n\t\tcanvasTransform: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\temits: ['moveTo', 'showWizard', 'controlDetail'],\n\n\tdata(): TreeData\n\t{\n\t\treturn {\n\t\t\texpandedNodes: [],\n\t\t\tisLocatedDepartmentVisible: false,\n\t\t\tisLoaded: false,\n\t\t\tuserDropTargetNodeId: null,\n\t\t\tisUserDropAllowed: false,\n\t\t\tdraggedUserData: null,\n\t\t\tshowDndConfirmationPopup: false,\n\t\t\tshowDndErrorPopup: false,\n\t\t\tdndErrorPopupDescription: '',\n\t\t\tdndUserMoveContext: null,\n\t\t\tisCombineOnly: false,\n\t\t};\n\t},\n\n\tcomputed:\n\t{\n\t\tentityType(): string\n\t\t{\n\t\t\treturn this.departments.get(this.focusedNode)?.entityType || '';\n\t\t},\n\t\trootId(): number\n\t\t{\n\t\t\tconst { id: rootId } = [...this.departments.values()].find((department) => {\n\t\t\t\treturn department.parentId === 0;\n\t\t\t});\n\n\t\t\treturn rootId;\n\t\t},\n\t\tconnectors(): Connectors\n\t\t{\n\t\t\treturn this.$refs.connectors;\n\t\t},\n\t\tdndPopupDescription(): string\n\t\t{\n\t\t\tconst targetDepartment = this.departments.get(this.dndUserMoveContext.targetDepartmentId);\n\t\t\tconst phrase = targetDepartment.entityType === EntityTypes.team ? 'HUMANRESOURCES_COMPANY_STRUCTURE_DND_USER_CONFIRM_POPUP_DESC_TEAM'\n\t\t\t\t: 'HUMANRESOURCES_COMPANY_STRUCTURE_DND_USER_CONFIRM_POPUP_DESC_DEPARTMENT'\n\t\t\t;\n\n\t\t\treturn Loc.getMessage(phrase, {\n\t\t\t\t'#USER_NAME#': Text.encode(this.dndUserMoveContext.user.name),\n\t\t\t\t'#DEPARTMENT_NAME#': Text.encode(targetDepartment.name),\n\t\t\t\t'[link]': `<a class=\"hr-department-detail-content__move-user-department-user-link\" href=\"${this.dndUserMoveContext.user.url}\">`,\n\t\t\t\t'[/link]': '</a>',\n\t\t\t});\n\t\t},\n\t\t...mapState(useChartStore, ['currentDepartments', 'userId', 'focusedNode', 'departments']),\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.treeNodes = new Map();\n\t\tthis.subscribeOnEvents();\n\t\tthis.loadHeads([this.rootId]);\n\t},\n\n\tmounted(): void\n\t{\n\t\tconst departmentToFocus = this.getDepartmentIdForInitialFocus();\n\t\tthis.currentDepartmentsLocated = [departmentToFocus];\n\n\t\tif (departmentToFocus !== this.rootId)\n\t\t{\n\t\t\tthis.expandDepartmentParents(departmentToFocus);\n\t\t\tthis.focus(departmentToFocus, { expandAfterFocus: true });\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.expandLowerDepartments();\n\t\tthis.focus(departmentToFocus);\n\t},\n\n\tbeforeUnmount(): void\n\t{\n\t\tthis.unsubscribeFromEvents();\n\t},\n\n\tmethods:\n\t{\n\t\tgetDepartmentIdForInitialFocus(): ?number\n\t\t{\n\t\t\tconst providedFocusNodeId = UrlProvidedParamsService.getParams().focusNodeId;\n\t\t\tif (providedFocusNodeId)\n\t\t\t{\n\t\t\t\tconst node = this.departments.get(providedFocusNodeId);\n\t\t\t\tif (node)\n\t\t\t\t{\n\t\t\t\t\treturn providedFocusNodeId;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (const currentDepartmentId: number of this.currentDepartments)\n\t\t\t{\n\t\t\t\tconst node = this.departments.get(currentDepartmentId);\n\n\t\t\t\tif (node.entityType === EntityTypes.department)\n\t\t\t\t{\n\t\t\t\t\treturn currentDepartmentId;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn this.rootId;\n\t\t},\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tgetTreeBounds(): DOMRect\n\t\t{\n\t\t\treturn this.$el.getBoundingClientRect();\n\t\t},\n\t\tonConnectDepartment({ data }: MountedDepartment): void\n\t\t{\n\t\t\tconst { id, html } = data;\n\t\t\tthis.treeNodes.set(id, html);\n\t\t\tconst departmentIdToFocus = this.getDepartmentIdForInitialFocus();\n\t\t\tif (id === departmentIdToFocus && !this.isLoaded) // zoom to  department when loading\n\t\t\t{\n\t\t\t\tconst movingDelay = 1800;\n\t\t\t\tthis.isLoaded = true;\n\t\t\t\tRuntime.debounce(() => {\n\t\t\t\t\tthis.moveTo(departmentIdToFocus);\n\t\t\t\t}, movingDelay)();\n\t\t\t}\n\t\t},\n\t\tonDisconnectDepartment({ data }: MountedDepartment): void\n\t\t{\n\t\t\tconst { id } = data;\n\t\t\tconst department = this.departments.get(id);\n\t\t\tdelete department.prevParentId;\n\t\t\tif (!department.parentId)\n\t\t\t{\n\t\t\t\tOrgChartActions.removeDepartment(id);\n\t\t\t}\n\t\t},\n\t\tonDragEntity({ data }: BaseEvent): void\n\t\t{\n\t\t\tconst { draggedId } = data;\n\t\t\tif (this.expandedNodes.includes(draggedId))\n\t\t\t{\n\t\t\t\tthis.collapseRecursively(draggedId);\n\t\t\t}\n\t\t},\n\t\tonToggleConnectors({ data }: BaseEvent): void\n\t\t{\n\t\t\tconst { shouldShowElements } = data;\n\t\t\tthis.connectors.toggleAllConnectorsVisibility(shouldShowElements, this.expandedNodes);\n\t\t},\n\t\tasync changeOrder(data: DragAndDropData): Promise<void>\n\t\t{\n\t\t\tconst { draggedId, targetId, affectedItems, direction } = data;\n\t\t\tconst promise = OrgChartActions.orderDepartments(draggedId, targetId, direction, affectedItems.length);\n\t\t\tconst fullDepartmentWidth = 302;\n\t\t\tconst draggedShift = affectedItems.length * direction * fullDepartmentWidth;\n\t\t\tthis.connectors.adaptConnectorsAfterReorder([draggedId], draggedShift, true);\n\t\t\tconst affectedShift = -direction * fullDepartmentWidth;\n\t\t\tthis.connectors.adaptConnectorsAfterReorder(affectedItems, affectedShift, true);\n\t\t\tconst ordered = await promise;\n\t\t\tif (!ordered)\n\t\t\t{\n\t\t\t\tthis.connectors.adaptConnectorsAfterReorder([draggedId], -draggedShift, true);\n\t\t\t\tthis.connectors.adaptConnectorsAfterReorder(affectedItems, -affectedShift, true);\n\t\t\t}\n\t\t},\n\t\tasync updateParent(data: DragAndDropData): Promise<void>\n\t\t{\n\t\t\tconst { draggedId, targetId, targetIndex, insertion } = data;\n\t\t\tconst { id, parentId } = this.departments.get(draggedId);\n\t\t\tif (parentId === targetId && insertion === 'inside')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet updateParentPromise = null;\n\t\t\tconst store = useChartStore();\n\t\t\tif (insertion === 'sibling-left' || insertion === 'sibling-right')\n\t\t\t{\n\t\t\t\tconst { parentId: targetParentId } = this.departments.get(targetId);\n\t\t\t\tconst position = insertion === 'sibling-left' ? targetIndex : targetIndex + 1;\n\t\t\t\tstore.updateDepartment({ id, parentId: targetParentId }, position);\n\t\t\t\tupdateParentPromise = chartAPI.updateDepartment(draggedId, targetParentId);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tstore.updateDepartment({ id, parentId: targetId });\n\t\t\t\tupdateParentPromise = chartAPI.updateDepartment(draggedId, targetId);\n\t\t\t}\n\n\t\t\tthis.locateToDepartment(draggedId);\n\t\t\ttry\n\t\t\t{\n\t\t\t\tawait updateParentPromise;\n\t\t\t\tif (insertion === 'sibling-left' || insertion === 'sibling-right')\n\t\t\t\t{\n\t\t\t\t\tconst { parentId: targetParentId } = this.departments.get(targetId);\n\t\t\t\t\tconst { children } = this.departments.get(targetParentId);\n\t\t\t\t\tconst shift = insertion === 'sibling-left' ? 1 : 2;\n\t\t\t\t\tconst affectedCount = children.length - targetIndex - shift;\n\t\t\t\t\tawait chartAPI.changeOrder(draggedId, -1, affectedCount);\n\t\t\t\t}\n\t\t\t}\n\t\t\tcatch (err)\n\t\t\t{\n\t\t\t\tconsole.error(err);\n\t\t\t}\n\t\t},\n\t\tonDropEntity({ data }: BaseEvent): void\n\t\t{\n\t\t\tconst { insertion } = data;\n\t\t\tif (insertion === 'reorder')\n\t\t\t{\n\t\t\t\tthis.changeOrder(data);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.updateParent(data);\n\t\t},\n\t\tonPublicFocusNode({ data }: BaseEvent): void\n\t\t{\n\t\t\tconst { nodeId } = data;\n\n\t\t\tconst node = this.departments.get(nodeId);\n\t\t\tif (!node)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvoid this.locateToDepartment(nodeId);\n\t\t},\n\t\tcollapse(nodeId: number): void\n\t\t{\n\t\t\tthis.expandedNodes = this.expandedNodes.filter((expandedId) => expandedId !== nodeId);\n\t\t\tthis.connectors.toggleConnectorsVisibility(nodeId, false);\n\t\t\tthis.connectors.toggleConnectorHighlighting(nodeId, false);\n\t\t},\n\t\tcollapseRecursively(nodeId: number): void\n\t\t{\n\t\t\tconst deepCollapse = (id: number) => {\n\t\t\t\tthis.collapse(id);\n\t\t\t\tconst node = this.departments.get(id);\n\t\t\t\tnode.children?.forEach((childId) => {\n\t\t\t\t\tif (this.expandedNodes.includes(childId))\n\t\t\t\t\t{\n\t\t\t\t\t\tdeepCollapse(childId);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t};\n\t\t\tconst { parentId } = this.departments.get(nodeId);\n\t\t\tconst expandedNode = this.expandedNodes.find((id) => {\n\t\t\t\tconst node = this.departments.get(id);\n\n\t\t\t\treturn node.parentId === parentId;\n\t\t\t});\n\t\t\tif (expandedNode)\n\t\t\t{\n\t\t\t\tdeepCollapse(expandedNode);\n\t\t\t}\n\t\t},\n\t\texpand(departmentId: number): void\n\t\t{\n\t\t\tthis.collapseRecursively(departmentId);\n\t\t\tthis.expandedNodes = [...this.expandedNodes, departmentId];\n\t\t\tthis.connectors.toggleConnectorsVisibility(departmentId, true);\n\t\t\tthis.connectors.toggleConnectorHighlighting(departmentId, true);\n\t\t\tconst department = this.departments.get(departmentId);\n\t\t\tconst childrenWithoutHeads = department.children.filter((childId) => {\n\t\t\t\treturn !this.departments.get(childId).heads;\n\t\t\t});\n\t\t\tif (childrenWithoutHeads.length > 0)\n\t\t\t{\n\t\t\t\tthis.loadHeads(childrenWithoutHeads);\n\t\t\t}\n\n\t\t\tanalyticsSendData({ tool: 'structure', category: 'structure', event: 'expand_department' });\n\t\t},\n\t\tfocus(nodeId: number, options: Object = {}): void\n\t\t{\n\t\t\tconst { expandAfterFocus = false, showEmployees = false, subdivisionsSelected = false } = options;\n\t\t\tconst hasChildren = this.departments.get(nodeId).children?.length > 0;\n\n\t\t\tlet shouldExpand = expandAfterFocus || !this.expandedNodes.includes(nodeId);\n\t\t\tif (showEmployees)\n\t\t\t{\n\t\t\t\tshouldExpand = this.expandedNodes.includes(nodeId);\n\t\t\t}\n\n\t\t\tif (subdivisionsSelected || !hasChildren)\n\t\t\t{\n\t\t\t\tthis.collapseRecursively(nodeId);\n\t\t\t}\n\n\t\t\tif (hasChildren && shouldExpand)\n\t\t\t{\n\t\t\t\tthis.expand(nodeId);\n\t\t\t}\n\n\t\t\tif (this.focusedNode && !this.expandedNodes.includes(this.focusedNode))\n\t\t\t{\n\t\t\t\tthis.connectors.toggleConnectorHighlighting(this.focusedNode, false);\n\t\t\t}\n\n\t\t\tOrgChartActions.focusDepartment(nodeId);\n\t\t\tthis.connectors.toggleConnectorHighlighting(this.focusedNode, true);\n\t\t},\n\t\tonFocusDepartment({ data }: { nodeId: number }): void\n\t\t{\n\t\t\tconst { nodeId, showEmployees, subdivisionsSelected } = data;\n\t\t\tthis.focus(nodeId, { showEmployees, subdivisionsSelected });\n\t\t\tthis.$emit('controlDetail', {\n\t\t\t\tshowEmployees,\n\t\t\t\tpreventSwitch: subdivisionsSelected,\n\t\t\t});\n\t\t},\n\t\ttryRemoveDepartment(nodeId: number, entityType: string): void\n\t\t{\n\t\t\tconst localizationMap = {\n\t\t\t\tteam: {\n\t\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_REMOVE_TEAM_TITLE'),\n\t\t\t\t\tmessage: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_REMOVE_TEAM_MESSAGE'),\n\t\t\t\t\tsuccess: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_REMOVE_TEAM_REMOVED'),\n\t\t\t\t\terror: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_REMOVE_TEAM_ERROR'),\n\t\t\t\t},\n\t\t\t\tdefault: {\n\t\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_REMOVE_DEPARTMENT_TITLE'),\n\t\t\t\t\tmessage: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_REMOVE_DEPARTMENT_MESSAGE'),\n\t\t\t\t\tsuccess: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_REMOVE_DEPARTMENT_REMOVED'),\n\t\t\t\t\terror: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_REMOVE_DEPARTMENT_ERROR'),\n\t\t\t\t},\n\t\t\t};\n\t\t\tconst mapIndex = entityType === EntityTypes.team ? 'team' : 'default';\n\t\t\tconst messageBox = MessageBox.create({\n\t\t\t\ttitle: localizationMap[mapIndex].title,\n\t\t\t\tmessage: localizationMap[mapIndex].message,\n\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t\tonOk: async (dialog: MessageBox) => {\n\t\t\t\t\ttry\n\t\t\t\t\t{\n\t\t\t\t\t\tawait this.removeDepartment(nodeId);\n\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\tcontent: localizationMap[mapIndex].success,\n\t\t\t\t\t\t\tautoHideDelay: 2000,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tdialog.close();\n\t\t\t\t\t}\n\t\t\t\t\tcatch\n\t\t\t\t\t{\n\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\tcontent: localizationMap[mapIndex].error,\n\t\t\t\t\t\t\tautoHideDelay: 2000,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonCancel: (dialog: MessageBox) => dialog.close(),\n\t\t\t\tminWidth: 250,\n\t\t\t\tmaxWidth: 320,\n\t\t\t\tminHeight: 175,\n\t\t\t\tokCaption: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_REMOVE_DEPARTMENT_OK_CAPTION'),\n\t\t\t\tpopupOptions: { className: 'humanresources-tree__message-box', overlay: { opacity: 40 } },\n\t\t\t});\n\t\t\tconst okButton = messageBox.getOkButton();\n\t\t\tconst cancelButton = messageBox.getCancelButton();\n\t\t\tokButton.setRound(true);\n\t\t\tcancelButton.setRound(true);\n\t\t\tokButton.setColor(ButtonColor.DANGER);\n\t\t\tcancelButton.setColor(ButtonColor.LIGHT_BORDER);\n\t\t\tmessageBox.show();\n\t\t},\n\t\tasync removeDepartment(nodeId: number): Promise<void>\n\t\t{\n\t\t\tawait chartAPI.removeDepartment(nodeId);\n\t\t\tconst removableDepartment = this.departments.get(nodeId);\n\t\t\tconst { parentId, children: removableDepartmentChildren = [] } = removableDepartment;\n\t\t\tif (removableDepartmentChildren.length > 0)\n\t\t\t{\n\t\t\t\tthis.collapse(nodeId);\n\t\t\t}\n\n\t\t\tOrgChartActions.moveSubordinatesToParent(nodeId);\n\t\t\tawait this.$nextTick();\n\t\t\tOrgChartActions.markDepartmentAsRemoved(nodeId);\n\t\t\tthis.focus(parentId, { expandAfterFocus: true });\n\t\t\tthis.moveTo(parentId);\n\t\t},\n\t\texpandDepartmentParents(nodeId: number): void\n\t\t{\n\t\t\tlet { parentId } = this.departments.get(nodeId);\n\t\t\twhile (parentId)\n\t\t\t{\n\t\t\t\tif (!this.expandedNodes.includes(parentId))\n\t\t\t\t{\n\t\t\t\t\tthis.expand(parentId);\n\t\t\t\t}\n\n\t\t\t\tparentId = this.departments.get(parentId).parentId;\n\t\t\t}\n\t\t},\n\t\texpandLowerDepartments(): void\n\t\t{\n\t\t\tlet expandLevel = 0;\n\t\t\tconst expandRecursively = (departmentId: number) => {\n\t\t\t\tconst { children = [] } = this.departments.get(departmentId);\n\t\t\t\tif (expandLevel === 4 || children.length === 0)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.expand(departmentId);\n\t\t\t\texpandLevel += 1;\n\t\t\t\tconst middleBound = Math.trunc(children.length / 2);\n\t\t\t\tconst childId = children[middleBound];\n\t\t\t\tif (this.departments.get(childId).children?.length > 0)\n\t\t\t\t{\n\t\t\t\t\texpandRecursively(childId);\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfor (let i = middleBound - 1; i >= 0; i--)\n\t\t\t\t{\n\t\t\t\t\tif (traverseSibling(children[i]))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfor (let i = middleBound + 1; i < children.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (traverseSibling(children[i]))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconst traverseSibling = (siblingId: number) => {\n\t\t\t\tconst { children: currentChildren = [] } = this.departments.get(siblingId);\n\n\t\t\t\tif (currentChildren.length > 0)\n\t\t\t\t{\n\t\t\t\t\texpandRecursively(siblingId);\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t};\n\t\t\texpandRecursively(this.rootId);\n\t\t},\n\t\tasync locateToCurrentDepartment(): Promise<void>\n\t\t{\n\t\t\t// currentDepartmentsLocated manipulation needed to cycle through current departments\n\t\t\tif (this.currentDepartmentsLocated.length === this.currentDepartments.length)\n\t\t\t{\n\t\t\t\tthis.currentDepartmentsLocated = [];\n\t\t\t}\n\t\t\tconst currentDepartment = this.currentDepartments.find((item) => !this.currentDepartmentsLocated.includes(item));\n\t\t\tif (!currentDepartment)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.currentDepartmentsLocated.push(currentDepartment);\n\t\t\tawait this.locateToDepartment(currentDepartment);\n\t\t\tOrgChartActions.searchUserInDepartment(this.userId);\n\t\t},\n\t\tasync locateToDepartment(nodeId: number): Promise<void>\n\t\t{\n\t\t\tthis.isLocatedDepartmentVisible = false;\n\t\t\tthis.expandDepartmentParents(nodeId);\n\t\t\tthis.focus(nodeId, { expandAfterFocus: true });\n\t\t\t// $nextTick makes sure that this.getTreeBounds() returns correct value when nodeId is not visible\n\t\t\tawait this.$nextTick();\n\t\t\tthis.isLocatedDepartmentVisible = true;\n\t\t\tawait this.moveTo(nodeId);\n\t\t},\n\t\tasync moveTo(nodeId: number): Promise<void>\n\t\t{\n\t\t\tawait this.$nextTick();\n\t\t\tconst treeRect = this.getTreeBounds();\n\t\t\tconst centerX = treeRect.x + treeRect.width / 2;\n\t\t\tconst centerY = treeRect.y + treeRect.height / 2;\n\t\t\tconst treeNode = this.treeNodes.get(nodeId);\n\t\t\tconst treeNodeRect = treeNode.getBoundingClientRect();\n\t\t\tthis.$emit('moveTo', {\n\t\t\t\tx: centerX - treeNodeRect.x - treeNodeRect.width / 2,\n\t\t\t\ty: centerY - treeNodeRect.y - treeNodeRect.height / 2,\n\t\t\t\tnodeId,\n\t\t\t});\n\t\t},\n\t\tloadHeads(departmentIds: number[]): void\n\t\t{\n\t\t\tconst store = useChartStore();\n\t\t\tstore.loadHeads(departmentIds);\n\t\t},\n\t\tsubscribeOnEvents(): void\n\t\t{\n\t\t\tthis.events = {\n\t\t\t\t[events.HR_DEPARTMENT_CONNECT]: this.onConnectDepartment,\n\t\t\t\t[events.HR_DEPARTMENT_DISCONNECT]: this.onDisconnectDepartment,\n\t\t\t\t[events.HR_DEPARTMENT_FOCUS]: this.onFocusDepartment,\n\t\t\t\t[events.HR_DRAG_ENTITY]: this.onDragEntity,\n\t\t\t\t[events.HR_DROP_ENTITY]: this.onDropEntity,\n\t\t\t\t[events.HR_ENTITY_TOGGLE_ELEMENTS]: this.onToggleConnectors,\n\t\t\t\t[events.HR_PUBLIC_FOCUS_NODE]: this.onPublicFocusNode,\n\t\t\t\t[events.HR_USER_DRAG_START]: this.onUserDragStart,\n\t\t\t\t[events.HR_USER_DRAG_DROP]: this.onUserDragDrop,\n\t\t\t\t[events.HR_USER_DRAG_END]: this.onUserDragEnd,\n\t\t\t\t[events.HR_USER_DRAG_ENTER_NODE]: this.onUserDragEnterNode,\n\t\t\t\t[events.HR_USER_DRAG_LEAVE_NODE]: this.onUserDragLeaveNode,\n\t\t\t};\n\t\t\tObject.entries(this.events).forEach(([event, handle]) => {\n\t\t\t\tEventEmitter.subscribe(event, handle);\n\t\t\t});\n\t\t},\n\t\tunsubscribeFromEvents(): void\n\t\t{\n\t\t\tObject.entries(this.events).forEach(([event, handle]) => {\n\t\t\t\tEventEmitter.unsubscribe(event, handle);\n\t\t\t});\n\t\t},\n\t\tonUserDragStart({ data }): void\n\t\t{\n\t\t\tthis.draggedUserData = data.user;\n\t\t},\n\t\tonUserDragEnterNode({ data }): void\n\t\t{\n\t\t\tif (!this.draggedUserData)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst hoveredNodeId = data.nodeId;\n\t\t\tconst sourceDepartmentId = this.focusedNode;\n\n\t\t\tconst hoveredNode = this.departments.get(hoveredNodeId);\n\t\t\tconst sourceNode = this.departments.get(sourceDepartmentId);\n\n\t\t\tif (sourceNode.entityType !== hoveredNode.entityType || hoveredNodeId === sourceDepartmentId)\n\t\t\t{\n\t\t\t\tthis.userDropTargetNodeId = hoveredNodeId;\n\t\t\t\tthis.isUserDropAllowed = false;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.userDropTargetNodeId = hoveredNodeId;\n\t\t\tconst movePermissions = this.canMoveUser(sourceDepartmentId, hoveredNodeId);\n\t\t\tthis.isUserDropAllowed = movePermissions.isAllowed;\n\t\t\tthis.isCombineOnly = movePermissions.combineOnly;\n\t\t},\n\t\tonUserDragLeaveNode({ data }): void\n\t\t{\n\t\t\tif (!this.draggedUserData)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.userDropTargetNodeId === data.nodeId)\n\t\t\t{\n\t\t\t\tthis.userDropTargetNodeId = null;\n\t\t\t\tthis.isUserDropAllowed = false;\n\t\t\t}\n\t\t},\n\t\tasync onUserDragDrop(): Promise<void>\n\t\t{\n\t\t\tif (!this.userDropTargetNodeId || !this.isUserDropAllowed)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.dndUserMoveContext = {\n\t\t\t\tuser: this.draggedUserData,\n\t\t\t\tsourceDepartmentId: this.focusedNode,\n\t\t\t\ttargetDepartmentId: this.userDropTargetNodeId,\n\t\t\t\tsourceRole: this.draggedUserData.role,\n\t\t\t};\n\n\t\t\tthis.showDndConfirmationPopup = true;\n\t\t},\n\t\tasync confirmUserMove(payload: {\n\t\t\trole: string;\n\t\t\troleLabel: string;\n\t\t\tisCombineMode: boolean;\n\t\t\tbadgeText: string;\n\t\t}): Promise<void>\n\t\t{\n\t\t\tthis.showDndConfirmationPopup = false;\n\t\t\tconst { user, targetDepartmentId } = this.dndUserMoveContext;\n\n\t\t\tconst targetDepartment = this.departments.get(targetDepartmentId);\n\t\t\tconst userInTarget = (targetDepartment.heads ?? []).find((u) => u.id === user.id)\n\t\t\t\t|| (targetDepartment.employees ?? []).find((u) => u.id === user.id);\n\t\t\tconst isAlreadyInTarget = Boolean(userInTarget);\n\t\t\tconst isRoleTheSame = isAlreadyInTarget && (userInTarget.role === payload.role);\n\n\t\t\tif (isAlreadyInTarget && isRoleTheSame)\n\t\t\t{\n\t\t\t\tthis.displayDndErrorPopup(user, targetDepartmentId);\n\t\t\t\tthis.dndUserMoveContext = null;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttry\n\t\t\t{\n\t\t\t\tif (payload.isCombineMode)\n\t\t\t\t{\n\t\t\t\t\tawait this.handleCombineUser(this.dndUserMoveContext, payload);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tawait this.handleMoveUser(this.dndUserMoveContext, payload, isAlreadyInTarget);\n\t\t\t\t}\n\n\t\t\t\tconst phrase = targetDepartment.entityType === EntityTypes.team ? 'HUMANRESOURCES_COMPANY_STRUCTURE_DND_USER_MOVED_SUCCESS_TEAM'\n\t\t\t\t\t: 'HUMANRESOURCES_COMPANY_STRUCTURE_DND_USER_MOVED_SUCCESS_DEPARTMENT'\n\t\t\t\t;\n\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\tcontent: this.loc(phrase, {\n\t\t\t\t\t\t'#USER_NAME#': Text.encode(user.name),\n\t\t\t\t\t\t'#DEPARTMENT_NAME#': Text.encode(targetDepartment.name),\n\t\t\t\t\t\t'#USER_ROLE#': Text.encode(payload.roleLabel),\n\t\t\t\t\t}),\n\t\t\t\t});\n\t\t\t}\n\t\t\tcatch (error)\n\t\t\t{\n\t\t\t\tconsole.error(error);\n\t\t\t}\n\n\t\t\tthis.dndUserMoveContext = null;\n\t\t},\n\t\tasync handleCombineUser(dndContext, payload): Promise<void>\n\t\t{\n\t\t\tconst { user, targetDepartmentId } = dndContext;\n\t\t\tconst data = await UserManagementDialogAPI.addUsersToDepartment(targetDepartmentId, [user.id], payload.role);\n\n\t\t\tUserManagementDialogActions.addUsersToDepartment(\n\t\t\t\ttargetDepartmentId,\n\t\t\t\t[{ ...user, role: payload.role, badgeText: payload.badgeText ?? null }],\n\t\t\t\tdata.userCount,\n\t\t\t\tpayload.role,\n\t\t\t);\n\t\t},\n\t\tasync handleMoveUser(dndContext, payload, isAlreadyInTarget): Promise<void>\n\t\t{\n\t\t\tconst { user, sourceDepartmentId, targetDepartmentId, sourceRole } = dndContext;\n\t\t\tconst targetDepartment = this.departments.get(targetDepartmentId);\n\n\t\t\tif (isAlreadyInTarget)\n\t\t\t{\n\t\t\t\tawait UserManagementDialogAPI.addUsersToDepartment(targetDepartmentId, [user.id], payload.role);\n\t\t\t\tawait DepartmentAPI.removeUserFromDepartment(sourceDepartmentId, user.id);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tawait DepartmentAPI.moveUserToDepartment(\n\t\t\t\t\tsourceDepartmentId,\n\t\t\t\t\tuser.id,\n\t\t\t\t\ttargetDepartmentId,\n\t\t\t\t\tpayload.role,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tconst finalUserCount = targetDepartment.userCount + (isAlreadyInTarget ? 0 : 1);\n\n\t\t\tDepartmentContentActions.removeUserFromDepartment(sourceDepartmentId, user.id, sourceRole);\n\t\t\tUserManagementDialogActions.addUsersToDepartment(\n\t\t\t\ttargetDepartmentId,\n\t\t\t\t[{ ...user, role: payload.role, badgeText: payload.badgeText ?? null }],\n\t\t\t\tfinalUserCount,\n\t\t\t\tpayload.role,\n\t\t\t);\n\t\t},\n\t\tdisplayDndErrorPopup(user, targetDepartmentId: number): void\n\t\t{\n\t\t\tconst targetDepartment = this.departments.get(targetDepartmentId);\n\t\t\tconst phrase = targetDepartment.entityType === EntityTypes.team ? 'HUMANRESOURCES_COMPANY_STRUCTURE_DND_ERROR_POPUP_DESC_TEAM'\n\t\t\t\t: 'HUMANRESOURCES_COMPANY_STRUCTURE_DND_ERROR_POPUP_DESC_DEPARTMENT'\n\t\t\t;\n\t\t\tthis.dndErrorPopupDescription = Loc.getMessage(phrase, {\n\t\t\t\t'#USER_NAME#': Text.encode(user.name),\n\t\t\t\t'#DEPARTMENT_NAME#': Text.encode(targetDepartment.name),\n\t\t\t\t'[link]': `<a class=\"hr-department-detail-content__move-user-department-user-link\" href=\"${user.url}\">`,\n\t\t\t\t'[/link]': '</a>',\n\t\t\t});\n\n\t\t\tthis.showDndErrorPopup = true;\n\t\t},\n\t\tcancelUserMove(): void\n\t\t{\n\t\t\tif (!this.dndUserMoveContext)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.showDndConfirmationPopup = false;\n\t\t\tthis.dndUserMoveContext = null;\n\t\t},\n\t\tcloseDndErrorPopup(): void\n\t\t{\n\t\t\tthis.showDndErrorPopup = false;\n\t\t\tthis.dndErrorPopupDescription = '';\n\t\t\tthis.dndUserMoveContext = null;\n\t\t},\n\t\tonUserDragEnd(): void\n\t\t{\n\t\t\tthis.userDropTargetNodeId = null;\n\t\t\tthis.isUserDropAllowed = false;\n\t\t\tthis.draggedUserData = null;\n\t\t},\n\t\tcanMoveUser(sourceDepartmentId: number, targetDepartmentId: number): { isAllowed: boolean; combineOnly: boolean }\n\t\t{\n\t\t\tconst permissionChecker = PermissionChecker.getInstance();\n\t\t\tconst sourceDepartmentData = this.departments.get(sourceDepartmentId);\n\t\t\tconst hoveredNodeData = this.departments.get(targetDepartmentId);\n\n\t\t\tif (!sourceDepartmentData || !hoveredNodeData)\n\t\t\t{\n\t\t\t\treturn { isAllowed: false, forceCombine: false };\n\t\t\t}\n\n\t\t\tconst sourcePermissionAction = sourceDepartmentData.entityType === EntityTypes.team\n\t\t\t\t? PermissionActions.teamRemoveMember\n\t\t\t\t: PermissionActions.employeeRemoveFromDepartment;\n\t\t\tconst canTakeFromSource = permissionChecker.hasPermission(sourcePermissionAction, sourceDepartmentId);\n\n\t\t\tconst targetPermissionAction = hoveredNodeData.entityType === EntityTypes.team\n\t\t\t\t? PermissionActions.teamAddMember\n\t\t\t\t: PermissionActions.employeeAddToDepartment;\n\t\t\tconst canPutToTarget = permissionChecker.hasPermission(targetPermissionAction, targetDepartmentId);\n\n\t\t\tif (canTakeFromSource && canPutToTarget)\n\t\t\t{\n\t\t\t\treturn { isAllowed: true, combineOnly: false };\n\t\t\t}\n\n\t\t\tif (!canTakeFromSource && canPutToTarget)\n\t\t\t{\n\t\t\t\treturn { isAllowed: true, combineOnly: true };\n\t\t\t}\n\n\t\t\treturn { isAllowed: false, combineOnly: false };\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"humanresources-tree\"\n\t\t\tv-if=\"departments.size > 0\"\n\t\t\tv-dnd=\"canvasTransform\"\n\t\t>\n\t\t\t<TreeNode\n\t\t\t\tclass=\"--root\"\n\t\t\t\t:key=\"rootId\"\n\t\t\t\t:nodeId=\"rootId\"\n\t\t\t\t:expandedNodes=\"[...expandedNodes]\"\n\t\t\t\t:canvasZoom=\"canvasTransform.zoom\"\n\t\t\t\t:currentDepartments=\"currentDepartments\"\n\t\t\t\t:userDropTargetNodeId=\"userDropTargetNodeId\"\n\t\t\t\t:isUserDropAllowed=\"isUserDropAllowed\"\n\t\t\t\t:isDraggingUser=\"!!draggedUserData\"\n\t\t\t></TreeNode>\n\t\t\t<Connectors\n\t\t\t\tref=\"connectors\"\n\t\t\t\t:isLocatedDepartmentVisible=\"isLocatedDepartmentVisible\"\n\t\t\t\t:treeNodes=\"treeNodes\"\n\t\t\t></Connectors>\n\t\t\t<MoveEmployeeConfirmationPopup\n\t\t\t\tv-if=\"showDndConfirmationPopup\"\n\t\t\t\t:description=\"dndPopupDescription\"\n\t\t\t\t:showRoleSelect=\"true\"\n\t\t\t\t:showCombineCheckbox=\"true\"\n\t\t\t\t:isCombineOnly=\"isCombineOnly\"\n\t\t\t\t:entityType=\"entityType\"\n\t\t\t\t@confirm=\"confirmUserMove\"\n\t\t\t\t@close=\"cancelUserMove\"\n\t\t\t/>\n\t\t\t<ConfirmationPopup\n\t\t\t\tv-if=\"showDndErrorPopup\"\n\t\t\t\t:withoutTitleBar = true\n\t\t\t\t:onlyConfirmButtonMode = true\n\t\t\t\t:confirmBtnText = \"loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_ALREADY_BELONGS_TO_DEPARTMENT_CLOSE_BUTTON')\"\n\t\t\t\t:width=\"300\"\n\t\t\t\t@action=\"closeDndErrorPopup\"\n\t\t\t\t@close=\"closeDndErrorPopup\"\n\t\t\t>\n\t\t\t\t<template v-slot:content>\n\t\t\t\t\t<div class=\"hr-department-detail-content__user-action-text-container\">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"hr-department-detail-content__user-belongs-to-department-text-container\"\n\t\t\t\t\t\t\tv-html=\"dndErrorPopupDescription\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</ConfirmationPopup>\n\t\t</div>\n\t`,\n};\n","import { EventEmitter } from 'main.core.events';\nimport { detailPanelWidth, events } from '../consts';\n\n// @vue/component\nexport const TransformPanel = {\n\tname: 'transform-panel',\n\n\tprops:\n\t{\n\t\tmodelValue: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\temits: ['update:modelValue'],\n\n\tdata(): { selectedId: string; }\n\t{\n\t\treturn {\n\t\t\tselectedId: '',\n\t\t};\n\t},\n\n\tcomputed:\n\t{\n\t\tzoomInPercent(): string\n\t\t{\n\t\t\tconst percent = '<span class=\"humanresources-transform-panel__zoom_percent\">%</span>';\n\n\t\t\treturn `${(this.modelValue.zoom * 100).toFixed(0)}${percent}`;\n\t\t},\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.actions = Object.freeze({\n\t\t\tzoomIn: 'zoomIn',\n\t\t\tzoomOut: 'zoomOut',\n\t\t\tlocate: 'locate',\n\t\t\tnavigate: 'navigate',\n\t\t});\n\t},\n\n\tmethods:\n\t{\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tonZoom(zoomIn: boolean): void\n\t\t{\n\t\t\tconst leftBound = 0.2;\n\t\t\tconst rightBound = 3;\n\t\t\tlet direction = -1;\n\t\t\tif (zoomIn)\n\t\t\t{\n\t\t\t\tdirection = 1;\n\t\t\t\tthis.selectedId = this.actions.zoomIn;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.selectedId = this.actions.zoomOut;\n\t\t\t}\n\n\t\t\tconst zoom = Number((this.modelValue.zoom + leftBound * direction).toFixed(1));\n\t\t\tif (zoom < leftBound || zoom > rightBound)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// calibrate x and y according to viewpoint center\n\t\t\tconst treeRect = this.$parent.$refs.tree.getTreeBounds();\n\t\t\tconst centerX = (treeRect.width / 2) / this.modelValue.zoom - detailPanelWidth / 2;\n\t\t\tconst centerY = (treeRect.height / 2) / this.modelValue.zoom;\n\n\t\t\tconst oldCenterX = (centerX - this.modelValue.x) / this.modelValue.zoom;\n\t\t\tconst oldCenterY = (centerY - this.modelValue.y) / this.modelValue.zoom;\n\n\t\t\tconst x = centerX - oldCenterX * zoom;\n\t\t\tconst y = centerY - oldCenterY * zoom;\n\n\t\t\tthis.$emit('update:modelValue', { ...this.modelValue, zoom, x, y });\n\t\t},\n\t\tonLocate(): void\n\t\t{\n\t\t\tEventEmitter.emit(events.HR_ORG_CHART_LOCATE_TO_DEPARTMENT);\n\t\t\tthis.selectedId = this.actions.locate;\n\t\t},\n\t\tonfocusout(): void\n\t\t{\n\t\t\tthis.selectedId = '';\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"humanresources-transform-panel\" @focusout=\"onfocusout\" tabindex=\"-1\">\n\t\t\t<div\n\t\t\t\tclass=\"humanresources-transform-panel__locate\"\n\t\t\t\t:class=\"{ '--selected': selectedId === actions.locate }\"\n\t\t\t\t@click=\"onLocate\"\n\t\t\t>\n\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_TREE_LOCATE')}}\n\t\t\t</div>\n\t\t\t<div class=\"humanresources-transform-panel__separator\"></div>\n\t\t\t<div class=\"humanresources-transform-panel__zoom\">\n\t\t\t\t<svg\n\t\t\t\t\tviewBox=\"0 0 16 16\"\n\t\t\t\t\tfill=\"none\"\n\t\t\t\t\tclass=\"humanresources-transform-panel__icon --zoom-out\"\n\t\t\t\t\t:class=\"{ '--selected': selectedId === actions.zoomOut }\"\n\t\t\t\t\t@click=\"onZoom(false)\"\n\t\t\t\t>\n\t\t\t\t\t<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M4 8.66671V7.33337H7.33333H8.66667H12V8.66671H8.66667H7.33333H4Z\" fill=\"#6A737F\"/>\n\t\t\t\t</svg>\n\t\t\t\t<span v-html=\"zoomInPercent\"></span>\n\t\t\t\t<svg\n\t\t\t\t\tviewBox=\"0 0 16 16\"\n\t\t\t\t\tfill=\"none\"\n\t\t\t\t\tclass=\"humanresources-transform-panel__icon --zoom-in\"\n\t\t\t\t\t:class=\"{ '--selected': selectedId === actions.zoomIn }\"\n\t\t\t\t\t@click=\"onZoom(true)\"\n\t\t\t\t>\n\t\t\t\t\t<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M7.83333 4H9.16667V7.33333H12.5V8.66667H9.16667V12H7.83333V8.66667H4.5V7.33333H7.83333V4Z\" fill=\"#6A737F\"/>\n\t\t\t\t</svg>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","// @vue/component\nexport const DetailPanelCollapsedTitle = {\n\tname: 'detailPanelCollapsedTitle',\n\n\tprops:\n\t{\n\t\ttitle:\n\t\t{\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tavatars:\n\t\t{\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tcomputed:\n\t{\n\t\tmaxVisibleAvatarsCount(): Number\n\t\t{\n\t\t\treturn 2;\n\t\t},\n\t\tadditionalCount(): Number\n\t\t{\n\t\t\treturn this.avatars.length > this.maxVisibleAvatarsCount ? this.avatars.length - this.maxVisibleAvatarsCount : 0;\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"humanresources-detail-panel__collapsed-title\">\n\t\t\t<template v-for=\"(avatar, index) in avatars\">\n\t\t\t\t<img\n\t\t\t\t\tv-if=\"index < this.maxVisibleAvatarsCount\"\n\t\t\t\t\t:key=\"index\"\n\t\t\t\t\t:src=\"encodeURI(avatar)\"\n\t\t\t\t\tclass=\"humanresources-detail-panel__collapsed-title-avatar\"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<div\n\t\t\t\tv-if=\"avatars.length > maxVisibleAvatarsCount\"\n\t\t\t\tclass=\"humanresources-detail-panel__collapsed-title-avatar --additional\"\n\t\t\t>\n\t\t\t +{{ additionalCount }}\n\t\t\t</div>\n\t\t\t<div class=\"humanresources-detail-panel__title\">{{ title }}</div>\n\t\t</div>\n\t`,\n};\n","import { AnalyticsSourceType } from 'humanresources.company-structure.api';\nimport { BIcon, Set } from 'ui.icon-set.api.vue';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\nimport { RouteActionMenu } from 'humanresources.company-structure.structure-components';\nimport { EntityActionMenu } from '../menu/menu/entity-action-menu';\n\nimport '../../style.css';\nimport 'ui.icon-set.main';\nimport 'ui.icon-set.crm';\n\n/**\n * Component for displaying icon that shows EntityActionMenu\n */\n// @vue/component\nexport const DetailPanelEditButton = {\n\tname: 'detailPanelEditButton',\n\n\tcomponents: {\n\t\tBIcon,\n\t\tRouteActionMenu,\n\t},\n\n\tprops: {\n\t\tentityId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tentityType: {\n\t\t\ttype: String,\n\t\t\tdefault: EntityTypes.department,\n\t\t},\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tmenuVisible: false,\n\t\t};\n\t},\n\n\tcomputed: {\n\t\tset(): Set\n\t\t{\n\t\t\treturn Set;\n\t\t},\n\t\tmenu(): EntityActionMenu\n\t\t{\n\t\t\treturn new EntityActionMenu(this.entityId, this.entityType, AnalyticsSourceType.DETAIL);\n\t\t},\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tonActionMenuItemClick(actionId: string): void\n\t\t{\n\t\t\tthis.menu.onActionMenuItemClick(actionId);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tv-if=\"menu.items.length\"\n\t\t\tclass=\"humanresources-detail-panel__edit-button\"\n\t\t\t:class=\"{ '--focused': menuVisible }\"\n\t\t\t:ref=\"'detailPanelEditButton'\"\n\t\t\tdata-id=\"hr-department-detail-panel__edit-menu-button\"\n\t\t\t@click.stop=\"menuVisible = true\"\n\t\t>\n\t\t\t<BIcon\n\t\t\t\tclass=\"humanresources-detail-panel__edit-button-icon\"\n\t\t\t\t:name=\"set.MORE\"\n\t\t\t\t:size=\"20\"\n\t\t\t/>\n\t\t</div>\n\t\t<RouteActionMenu\n\t\t\tv-if=\"menuVisible\"\n\t\t\tid=\"department-detail-content-edit-menu\"\n\t\t\t:items=\"menu.items\"\n\t\t\t:width=\"302\"\n\t\t\t:bindElement=\"$refs.detailPanelEditButton\"\n\t\t\t@action=\"onActionMenuItemClick\"\n\t\t\t@close=\"menuVisible = false\"\n\t\t/>\n\t`,\n};\n","import { EntityTypes } from 'humanresources.company-structure.utils';\nimport type { BaseEvent } from 'main.core.events';\nimport { EventEmitter } from 'main.core.events';\nimport { events } from '../../consts';\nimport { DetailPanelCollapsedTitle } from './detail-panel-collapsed-title';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { mapState } from 'ui.vue3.pinia';\nimport { getMemberRoles, type MemberRolesType } from 'humanresources.company-structure.api';\nimport { DepartmentContent } from 'humanresources.company-structure.department-content';\nimport { Hint } from 'humanresources.company-structure.structure-components';\nimport { DetailPanelEditButton } from './detail-panel-edit-button';\n\nimport './style.css';\n\n// @vue/component\nexport const DetailPanel = {\n\tname: 'detailPanel',\n\n\tcomponents: { DepartmentContent, DetailPanelCollapsedTitle, DetailPanelEditButton },\n\n\tdirectives: { hint: Hint },\n\n\tprops: {\n\t\tpreventPanelSwitch: Boolean,\n\t\tmodelValue: Boolean,\n\t},\n\n\temits: ['showWizard', 'removeDepartment', 'update:modelValue'],\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\ttitle: '',\n\t\t\tisTeamEntity: false,\n\t\t\tteamColor: null,\n\t\t\tisCollapsed: true,\n\t\t\tisHidden: false,\n\t\t\tisLoading: true,\n\t\t\tneedToShowLoader: false,\n\t\t};\n\t},\n\n\tcomputed:\n\t{\n\t\t...mapState(useChartStore, ['focusedNode', 'departments']),\n\t\tdefaultAvatar(): String\n\t\t{\n\t\t\treturn '/bitrix/js/humanresources/company-structure/org-chart/src/images/default-user.svg';\n\t\t},\n\t\theadAvatarsArray(): Array\n\t\t{\n\t\t\tconst heads = this.departments.get(this.focusedNode).heads ?? [];\n\n\t\t\treturn heads\n\t\t\t\t?.filter((employee) => employee.role === this.memberRoles.head)\n\t\t\t\t?.map((employee) => employee.avatar || this.defaultAvatar) ?? []\n\t\t\t;\n\t\t},\n\t\tentityType(): string\n\t\t{\n\t\t\treturn this.departments.get(this.focusedNode).entityType;\n\t\t},\n\t\tmemberRoles(): MemberRolesType\n\t\t{\n\t\t\treturn getMemberRoles(this.entityType);\n\t\t},\n\t\tisPanelCollapsed(): boolean\n\t\t{\n\t\t\treturn this.isCollapsed || this.isHidden;\n\t\t}\n\t},\n\n\twatch: {\n\t\tfocusedNode(newId: number, oldId: number): void\n\t\t{\n\t\t\tthis.updateDetailPageHandler(newId, oldId);\n\t\t},\n\t\tmodelValue(collapsed: boolean): void\n\t\t{\n\t\t\tthis.isCollapsed = collapsed;\n\t\t},\n\t\tdepartments: {\n\t\t\thandler(newDepartments): void\n\t\t\t{\n\t\t\t\tconst department = newDepartments.get(this.focusedNode);\n\t\t\t\tif (department)\n\t\t\t\t{\n\t\t\t\t\tthis.title = department.name ?? '';\n\t\t\t\t}\n\t\t\t},\n\t\t\tdeep: true,\n\t\t},\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.subscribeOnEvents();\n\t},\n\n\tbeforeUnmount(): void\n\t{\n\t\tthis.unsubscribeFromEvents();\n\t},\n\n\tmethods:\n\t{\n\t\ttoggleCollapse(): void\n\t\t{\n\t\t\tthis.$emit('update:modelValue', !this.isCollapsed);\n\t\t},\n\t\tupdateDetailPageHandler(nodeId: number, oldId: number): void\n\t\t{\n\t\t\tif (!this.preventPanelSwitch && oldId !== 0)\n\t\t\t{\n\t\t\t\tthis.$emit('update:modelValue', false);\n\t\t\t}\n\n\t\t\tthis.isLoading = true;\n\t\t\tconst department = this.departments.get(nodeId);\n\n\t\t\tthis.isTeamEntity = department.entityType === EntityTypes.team;\n\t\t\tthis.title = department.name ?? '';\n\t\t\tthis.teamColor = department.teamColor ?? null;\n\t\t\tthis.isLoading = false;\n\t\t},\n\t\tshowLoader(): void\n\t\t{\n\t\t\tthis.needToShowLoader = true;\n\t\t},\n\t\thideLoader(): void\n\t\t{\n\t\t\tthis.needToShowLoader = false;\n\t\t},\n\t\tsubscribeOnEvents(): void\n\t\t{\n\t\t\tthis.events = {\n\t\t\t\t[events.HR_ENTITY_TOGGLE_ELEMENTS]: this.onToggleDetailPanel,\n\t\t\t};\n\t\t\tObject.entries(this.events).forEach(([event, handle]) => {\n\t\t\t\tEventEmitter.subscribe(event, handle);\n\t\t\t});\n\t\t},\n\t\tunsubscribeFromEvents(): void\n\t\t{\n\t\t\tObject.entries(this.events).forEach(([event, handle]) => {\n\t\t\t\tEventEmitter.unsubscribe(event, handle);\n\t\t\t});\n\t\t},\n\t\tonToggleDetailPanel({ data }: BaseEvent): void\n\t\t{\n\t\t\tconst { shouldShowElements } = data;\n\t\t\tthis.isHidden = !shouldShowElements;\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\t:class=\"['humanresources-detail-panel', { '--collapsed': isPanelCollapsed }]\"\n\t\t\tv-on=\"isPanelCollapsed ? { click: toggleCollapse } : {}\"\n\t\t\tdata-id=\"hr-department-detail-panel__container\"\n\t\t>\n\t\t\t<div\n\t\t\t\tv-if=\"!isLoading\"\n\t\t\t\tclass=\"humanresources-detail-panel-container\"\n\t\t\t\t:class=\"{ '--hide': needToShowLoader && !isPanelCollapsed }\"\n\t\t\t>\n\t\t\t\t<div class=\"humanresources-detail-panel__head\" \n\t\t\t\t\t :class=\"{ '--team': isTeamEntity, '--collapsed': isPanelCollapsed }\"\n\t\t\t\t\t :style=\"{ '--team-head-background': teamColor?.treeHeadBackground }\"\n\t\t\t\t>\n\t\t\t\t\t<span\n\t\t\t\t\t\tv-if=\"!isPanelCollapsed\"\n\t\t\t\t\t\tv-hint\n\t\t\t\t\t\tclass=\"humanresources-detail-panel__title\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ title }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<DetailPanelCollapsedTitle\n\t\t\t\t\t\tv-else\n\t\t\t\t\t\t:title=\"title\"\n\t\t\t\t\t\t:avatars=\"headAvatarsArray\"\n\t\t\t\t\t>\n\t\t\t\t\t</DetailPanelCollapsedTitle>\n\t\t\t\t\t<div class=\"humanresources-detail-panel__header_buttons_container\">\n\t\t\t\t\t\t<DetailPanelEditButton\n\t\t\t\t\t\t\tv-if=\"!isPanelCollapsed\"\n\t\t\t\t\t\t\t:entityId=\"focusedNode\"\n\t\t\t\t\t\t\t:entityType=\"entityType\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"humanresources-detail-panel__collapse_button --icon\"\n\t\t\t\t\t\t\t@click=\"toggleCollapse\"\n\t\t\t\t\t\t\t:class=\"{ '--collapsed': isPanelCollapsed }\"\n\t\t\t\t\t\t\tdata-id=\"hr-department-detail-panel__collapse-button\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"humanresources-detail-panel__content\" v-show=\"!isPanelCollapsed\">\n\t\t\t\t\t<DepartmentContent\n\t\t\t\t\t\t@showDetailLoader=\"showLoader\"\n\t\t\t\t\t\t@hideDetailLoader=\"hideLoader\"\n\t\t\t\t\t\t:isCollapsed=\"isPanelCollapsed\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if=\"needToShowLoader && !isPanelCollapsed\" class=\"humanresources-detail-panel-loader-container\"/>\n\t\t</div>\n\t`,\n};\n","import 'ui.buttons';\nimport 'ui.forms';\nimport './style.css';\nimport { chartAPI } from '../../api';\nimport { events } from '../../consts';\nimport { BIcon, Set } from 'ui.icon-set.api.vue';\nimport type { FirstPopupData } from '../../types';\n\n// @vue/component\nexport const FirstPopup = {\n\tname: 'FirstPopup',\n\tcomponents: {\n\t\tBIcon,\n\t},\n\n\tdata(): FirstPopupData\n\t{\n\t\treturn {\n\t\t\tshow: false,\n\t\t\ttitle: '',\n\t\t\tdescription: '',\n\t\t\tsubDescription: '',\n\t\t\tfeatures: [],\n\t\t};\n\t},\n\n\tcomputed:\n\t{\n\t\tset(): Set\n\t\t{\n\t\t\treturn Set;\n\t\t},\n\t},\n\n\tasync mounted(): Promise<void>\n\t{\n\t\tthis.title = this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_TITLE');\n\t\tthis.description = this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_DESCRIPTION');\n\t\tthis.subDescription = this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_SUB_DESCRIPTION');\n\t\tthis.features = [\n\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_FEATURE_1'),\n\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_FEATURE_2'),\n\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_FEATURE_3'),\n\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_FEATURE_4'),\n\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_FEATURE_5'),\n\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_FEATURE_6'),\n\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_FEATURE_7'),\n\t\t];\n\n\t\tconst { firstTimeOpened } = await chartAPI.getDictionary();\n\t\tthis.show = firstTimeOpened === 'N' && this.title.length > 0;\n\t},\n\n\tmethods: {\n\t\tclosePopup(): void\n\t\t{\n\t\t\tchartAPI.firstTimeOpened();\n\t\t\tthis.show = false;\n\t\t\ttop.BX.Event.EventEmitter.emit(events.HR_FIRST_POPUP_SHOW);\n\t\t},\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div v-if=\"show\" class=\"first-popup\">\n\t\t\t<div class=\"first-popup-overlay\" @click=\"closePopup\"></div>\n\t\t\t<div class=\"first-popup-content\">\n\t\t\t\t<div class=\"title\">{{ title }}</div>\n\t\t\t\t<div class=\"first-popup-left\">\n\t\t\t\t\t<p class=\"description\">{{ description }}</p>\n\t\t\t\t\t<p class=\"sub-description\">{{ subDescription }}</p>\n\t\t\t\t\t<div class=\"first-popup-list\">\n\t\t\t\t\t\t<div class=\"first-popup-list-item\" v-for=\"(feature, index) in features\" :key=\"index\">\n\t\t\t\t\t\t\t<div class=\"first-popup-list-item-point\">•</div>\n\t\t\t\t\t\t\t<div class=\"first-popup-list-item-feature\">{{ feature }}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<button class=\"ui-btn ui-btn-success first-popup-ui-btn\" @click=\"closePopup\">\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_BUTTON_START') }}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"first-popup-right\">\n\t\t\t\t\t<video\n\t\t\t\t\t\tsrc=\"/bitrix/js/humanresources/company-structure/org-chart/src/components/first-popup/images/preview.webm\"\n\t\t\t\t\t\tautoplay\n\t\t\t\t\t\tloop\n\t\t\t\t\t\tmuted\n\t\t\t\t\t\tplaysinline\n\t\t\t\t\t\tclass=\"first-popup-animation\"\n\t\t\t\t\t></video>\n\t\t\t\t</div>\n\t\t\t\t<BIcon :name=\"set.CROSS_25\" :size=\"24\" class=\"first-popup-close\" @click=\"closePopup\"></BIcon>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { EventEmitter, type BaseEvent } from 'main.core.events';\nimport { Confetti } from 'ui.confetti';\nimport { mapState } from 'ui.vue3.pinia';\nimport { TransformCanvas } from 'ui.canvas';\nimport { AnalyticsSourceType } from 'humanresources.company-structure.api';\nimport { TitlePanel } from './components/title-panel/title-panel';\nimport { Tree } from './components/tree/tree';\nimport { TransformPanel } from './components/transfrom-panel';\nimport { DetailPanel } from './components/detail-panel/detail-panel';\nimport { FirstPopup } from './components/first-popup/first-popup';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { ChartWizard } from 'humanresources.company-structure.chart-wizard';\nimport { getInvitedUserData } from 'humanresources.company-structure.utils';\nimport { chartAPI } from './api';\nimport { events, detailPanelWidth } from './consts';\nimport { OrgChartActions } from './actions';\nimport { sendData as analyticsSendData } from 'ui.analytics';\n\nimport type { ChartData } from './types';\nimport './style.css';\nimport 'ui.design-tokens';\n\n// @vue/component\nexport const Chart = {\n\tcomponents: {\n\t\tTransformCanvas,\n\t\tTree,\n\t\tTransformPanel,\n\t\tChartWizard,\n\t\tFirstPopup,\n\t\tDetailPanel,\n\t\tTitlePanel,\n\t},\n\n\tdata(): ChartData\n\t{\n\t\treturn {\n\t\t\tcanvas: {\n\t\t\t\tshown: false,\n\t\t\t\tmoved: false,\n\t\t\t\tmodelTransform: {\n\t\t\t\t\tx: 0,\n\t\t\t\t\ty: 0,\n\t\t\t\t\tzoom: 0.3,\n\t\t\t\t},\n\t\t\t},\n\t\t\twizard: {\n\t\t\t\tshown: false,\n\t\t\t\tisEditMode: false,\n\t\t\t\tshowEntitySelector: true,\n\t\t\t\tentity: '',\n\t\t\t\tnodeId: 0,\n\t\t\t\tsource: '',\n\t\t\t},\n\t\t\tdetailPanel: {\n\t\t\t\tcollapsed: true,\n\t\t\t\tpreventSwitch: false,\n\t\t\t},\n\t\t\t// so we block all controls until transition isn't completed\n\t\t\tisTransitionCompleted: false,\n\t\t};\n\t},\n\n\tcomputed:\n\t{\n\t\trootId(): number\n\t\t{\n\t\t\tconst { id: rootId } = [...this.departments.values()].find((department) => {\n\t\t\t\treturn department.parentId === 0;\n\t\t\t});\n\n\t\t\treturn rootId;\n\t\t},\n\t\t...mapState(useChartStore, ['departments', 'currentDepartments']),\n\t},\n\n\tasync created(): Promise<void>\n\t{\n\t\tconst slider = BX.SidePanel.Instance.getTopSlider();\n\t\tslider?.showLoader();\n\t\tconst [departmentsData, currentDepartments, userId] = await Promise.all([\n\t\t\tchartAPI.getDepartmentsData(),\n\t\t\tchartAPI.getCurrentDepartments(),\n\t\t\tchartAPI.getUserId(),\n\t\t]);\n\t\tslider?.closeLoader();\n\t\tconst departments = departmentsData.structure;\n\t\tconst structureMap = Object.entries(departmentsData.map).reduce((map, [id, value]) => {\n\t\t\tmap.set(Number(id), { id: Number(id), ...value });\n\n\t\t\treturn map;\n\t\t}, new Map());\n\t\tconst parsedDepartments = chartAPI.createTreeDataStore(departments);\n\t\tconst availableDepartments = currentDepartments.filter((item) => parsedDepartments.has(item));\n\t\tOrgChartActions.applyData(parsedDepartments, availableDepartments, userId, structureMap);\n\t\tthis.rootOffset = 100;\n\t\tthis.transformCanvas();\n\t\tthis.canvas.shown = true;\n\t\tthis.showConfetti = false;\n\t\tEventEmitter.subscribe(events.HR_DEPARTMENT_SLIDER_ON_MESSAGE, this.handleInviteSliderMessage);\n\t\tBX.PULL.subscribe({\n\t\t\ttype: BX.PullClient.SubscriptionType.Server,\n\t\t\tmoduleId: 'humanresources',\n\t\t\tcommand: 'linkChatsToNodes',\n\t\t\tcallback: (data) => this.clearChatLists(data),\n\t\t});\n\t\tEventEmitter.subscribe(events.HR_ENTITY_SHOW_WIZARD, this.showWizardEventHandler);\n\t\tEventEmitter.subscribe(events.HR_ENTITY_REMOVE, this.removeDepartmentEventHandler);\n\t\tEventEmitter.subscribe(events.HR_ORG_CHART_TRANSFORM_CANVAS, this.onCanvasTransformWhenDragging);\n\t\tEventEmitter.subscribe(events.HR_ORG_CHART_LOCATE_TO_DEPARTMENT, this.onLocate);\n\t},\n\n\tunmounted(): void\n\t{\n\t\tEventEmitter.unsubscribe(events.HR_DEPARTMENT_SLIDER_ON_MESSAGE, this.handleInviteSliderMessage);\n\t\tEventEmitter.unsubscribe(events.HR_ENTITY_SHOW_WIZARD, this.showWizardEventHandler);\n\t\tEventEmitter.unsubscribe(events.HR_ENTITY_REMOVE, this.removeDepartmentEventHandler);\n\t\tEventEmitter.unsubscribe(events.HR_ORG_CHART_TRANSFORM_CANVAS, this.onCanvasTransformWhenDragging);\n\t\tEventEmitter.unsubscribe(events.HR_ORG_CHART_LOCATE_TO_DEPARTMENT, this.onLocate);\n\t},\n\n\tmethods:\n\t{\n\t\tonMoveTo({ x, y, nodeId }: { x: Number; y: Number; nodeId: Number; }): void\n\t\t{\n\t\t\tconst { x: prevX, y: prevY, zoom } = this.canvas.modelTransform;\n\t\t\tconst detailPanelWidthZoomed = detailPanelWidth * zoom;\n\t\t\tconst newX = x - detailPanelWidthZoomed / 2;\n\t\t\tconst newY = nodeId === this.rootId ? this.rootOffset : y / zoom;\n\t\t\tconst samePoint = Math.round(newX) === Math.round(prevX) && Math.round(y) === Math.round(prevY);\n\t\t\tthis.detailPanel = {\n\t\t\t\t...this.detailPanel,\n\t\t\t\tcollapsed: false,\n\t\t\t};\n\t\t\tif (samePoint)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.canvas = {\n\t\t\t\t...this.canvas,\n\t\t\t\tmoved: true,\n\t\t\t\tmodelTransform: { ...this.canvas.modelTransform, x: newX / zoom, y: newY, zoom: 1 },\n\t\t\t};\n\t\t\tthis.onUpdateTransform();\n\t\t},\n\t\tonLocate({ data }: BaseEvent): void\n\t\t{\n\t\t\tif (data.nodeId)\n\t\t\t{\n\t\t\t\tthis.$refs.tree.locateToDepartment(data.nodeId);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$refs.tree.locateToCurrentDepartment();\n\t\t},\n\t\tshowWizardEventHandler({ data }: BaseEvent): void\n\t\t{\n\t\t\tthis.onShowWizard(data);\n\t\t},\n\t\tonShowWizard({\n\t\t\tnodeId = 0,\n\t\t\tisEditMode = false,\n\t\t\ttype,\n\t\t\tshowEntitySelector = true,\n\t\t\tsource = '',\n\t\t\tentityType,\n\t\t\trefToFocus,\n\t\t}: { nodeId: number; isEditMode: boolean, showEntitySelector: boolean, source: string } = {}): void\n\t\t{\n\t\t\tthis.wizard = {\n\t\t\t\t...this.wizard,\n\t\t\t\tshown: true,\n\t\t\t\tisEditMode,\n\t\t\t\tshowEntitySelector,\n\t\t\t\tentity: type,\n\t\t\t\tnodeId,\n\t\t\t\tsource,\n\t\t\t\tentityType,\n\t\t\t\trefToFocus,\n\t\t\t};\n\n\t\t\tif (!isEditMode && source !== AnalyticsSourceType.HEADER)\n\t\t\t{\n\t\t\t\tanalyticsSendData({\n\t\t\t\t\ttool: 'structure',\n\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\tevent: 'create_dept_step1',\n\t\t\t\t\tc_element: source,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// eslint-disable-next-line default-case\n\t\t\tswitch (type)\n\t\t\t{\n\t\t\t\tcase 'department':\n\t\t\t\t\tanalyticsSendData({\n\t\t\t\t\t\ttool: 'structure',\n\t\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\t\tevent: 'create_dept_step1',\n\t\t\t\t\t\tc_element: source,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'employees':\n\t\t\t\t\tanalyticsSendData({\n\t\t\t\t\t\ttool: 'structure',\n\t\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\t\tevent: 'create_dept_step2',\n\t\t\t\t\t\tc_element: source,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'bindChat':\n\t\t\t\t\tanalyticsSendData({\n\t\t\t\t\t\ttool: 'structure',\n\t\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\t\tevent: 'create_dept_step3',\n\t\t\t\t\t\tc_element: source,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'teamRights':\n\t\t\t\t\tanalyticsSendData({\n\t\t\t\t\t\ttool: 'structure',\n\t\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\t\tevent: 'create_dept_step4',\n\t\t\t\t\t\tc_element: source,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t},\n\t\tonModifyTree({ id, showConfetti }): void\n\t\t{\n\t\t\tthis.showConfetti = showConfetti ?? false;\n\t\t\tconst { tree } = this.$refs;\n\t\t\ttree.locateToDepartment(id);\n\t\t},\n\t\tonWizardClose(): void\n\t\t{\n\t\t\tthis.wizard.shown = false;\n\t\t},\n\t\tremoveDepartmentEventHandler({ data }: BaseEvent): void\n\t\t{\n\t\t\tthis.onRemoveDepartment(data.nodeId, data.entityType);\n\t\t},\n\t\tonRemoveDepartment(nodeId: number, entityType: string): void\n\t\t{\n\t\t\tconst { tree } = this.$refs;\n\t\t\ttree.tryRemoveDepartment(nodeId, entityType);\n\t\t},\n\t\tasync onTransitionEnd(): Promise<void>\n\t\t{\n\t\t\tif (this.canvas.moved)\n\t\t\t{\n\t\t\t\tthis.isTransitionCompleted = true;\n\t\t\t}\n\n\t\t\tthis.canvas.moved = false;\n\t\t\tif (!this.showConfetti)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isTransitionCompleted = false;\n\t\t\tconst promise = Confetti.fire({\n\t\t\t\tparticleCount: 300,\n\t\t\t\tstartVelocity: 10,\n\t\t\t\tspread: 400,\n\t\t\t\tticks: 100,\n\t\t\t\torigin: { y: 0.4, x: 0.37 },\n\t\t\t});\n\t\t\tthis.showConfetti = false;\n\t\t\tawait promise;\n\t\t\tthis.isTransitionCompleted = true;\n\t\t},\n\t\tonControlDetail({ showEmployees, preventSwitch }): void\n\t\t{\n\t\t\tthis.detailPanel = {\n\t\t\t\t...this.detailPanel,\n\t\t\t\tpreventSwitch,\n\t\t\t};\n\t\t\tif (!showEmployees)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.detailPanel = {\n\t\t\t\t...this.detailPanel,\n\t\t\t\tcollapsed: false,\n\t\t\t};\n\t\t},\n\t\ttransformCanvas(): void\n\t\t{\n\t\t\tconst { zoom } = this.canvas.modelTransform;\n\t\t\tconst { offsetWidth, offsetHeight } = this.$el;\n\t\t\tconst [currentDepartment] = this.currentDepartments;\n\t\t\tconst y = currentDepartment === this.rootId ? this.rootOffset : offsetHeight / 2 - (offsetHeight * zoom) / 2;\n\t\t\tthis.canvas.modelTransform = {\n\t\t\t\t...this.canvas.modelTransform,\n\t\t\t\tx: offsetWidth / 2 - (offsetWidth * zoom) / 2,\n\t\t\t\ty,\n\t\t\t};\n\t\t},\n\t\tonUpdateTransform(): void\n\t\t{\n\t\t\tEventEmitter.emit(events.INTRANET_USER_MINIPROFILE_CLOSE);\n\t\t\tEventEmitter.emit(events.HR_DEPARTMENT_MENU_CLOSE);\n\t\t},\n\t\thandleInviteSliderMessage(event: BaseEvent): void\n\t\t{\n\t\t\tconst [messageEvent] = event.getData();\n\t\t\tconst eventId = messageEvent.getEventId();\n\t\t\tif (eventId !== 'BX.Intranet.Invitation:onAdd')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { users } = messageEvent.getData();\n\t\t\tusers.forEach((user) => {\n\t\t\t\tconst invitedUserData = getInvitedUserData(user);\n\t\t\t\tOrgChartActions.inviteUser(invitedUserData);\n\t\t\t});\n\t\t},\n\t\tclearChatLists(data): void\n\t\t{\n\t\t\tconst nodeIds = Object.keys(data).map((key) => Number(key));\n\t\t\tOrgChartActions.clearNodesChatLists(nodeIds);\n\t\t},\n\t\tonKeyDown(event: KeyboardEvent): void\n\t\t{\n\t\t\tif (!this.isTransitionCompleted)\n\t\t\t{\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t},\n\t\tonCanvasTransformWhenDragging({ data }: BaseEvent): void\n\t\t{\n\t\t\tconst { directionX, directionY, speed } = data;\n\t\t\tif (directionX !== 0)\n\t\t\t{\n\t\t\t\tthis.canvas.modelTransform.x += -directionX * speed;\n\t\t\t}\n\n\t\t\tif (directionY !== 0)\n\t\t\t{\n\t\t\t\tthis.canvas.modelTransform.y += -directionY * speed;\n\t\t\t}\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"humanresources-chart\"\n\t\t\t:class=\"{ '--locked': !isTransitionCompleted }\"\n\t\t\t@keydown=\"onKeyDown\"\n\t\t>\n\t\t\t<TitlePanel @showWizard=\"onShowWizard\"></TitlePanel>\n\t\t\t<TransformCanvas\n\t\t\t\tv-if=\"canvas.shown\"\n\t\t\t\tv-slot=\"{transform}\"\n\t\t\t\tv-model=\"canvas.modelTransform\"\n\t\t\t\t@update:modelValue=\"onUpdateTransform\"\n\t\t\t\t:class=\"{ '--moved': canvas.moved }\"\n\t\t\t\t@transitionend=\"onTransitionEnd\"\n\t\t\t>\n\t\t\t\t<Tree\n\t\t\t\t\t:canvasTransform=\"transform\"\n\t\t\t\t\tref=\"tree\"\n\t\t\t\t\t@moveTo=\"onMoveTo\"\n\t\t\t\t\t@showWizard=\"onShowWizard\"\n\t\t\t\t\t@controlDetail=\"onControlDetail\"\n\t\t\t\t></Tree>\n\t\t\t</TransformCanvas>\n\t\t\t<DetailPanel\n\t\t\t\t@showWizard=\"onShowWizard\"\n\t\t\t\t@removeDepartment=\"onRemoveDepartment\"\n\t\t\t\tv-model=\"detailPanel.collapsed\"\n\t\t\t\t:preventPanelSwitch=\"detailPanel.preventSwitch\"\n\t\t\t></DetailPanel>\n\t\t\t<TransformPanel\n\t\t\t\tv-model=\"canvas.modelTransform\"\n\t\t\t></TransformPanel>\n\t\t\t<ChartWizard\n\t\t\t\tv-if=\"wizard.shown\"\n\t\t\t\t:nodeId=\"wizard.nodeId\"\n\t\t\t\t:isEditMode=\"wizard.isEditMode\"\n\t\t\t\t:showEntitySelector=\"wizard.showEntitySelector\"\n\t\t\t\t:entity=\"wizard.entity\"\n\t\t\t\t:entityType=\"wizard.entityType\"\n\t\t\t\t:source=\"wizard.source\"\n\t\t\t\t:refToFocus=\"wizard.refToFocus\"\n\t\t\t\t@modifyTree=\"onModifyTree\"\n\t\t\t\t@close=\"onWizardClose\"\n\t\t\t></ChartWizard>\n\t\t\t<FirstPopup></FirstPopup>\n\t\t\t<div class=\"humanresources-chart__back\"></div>\n\t\t</div>\n\t`,\n};\n","import { AbstractActionMenu } from '../abstract-action-menu';\nimport { AddEmployeeMenuItem } from '../items/employees/add-employee-menu-item';\nimport { EditEmployeesMenuItem } from '../items/department/edit-employees-menu-item';\n\nexport class UsersTabActionMenu extends AbstractActionMenu\n{\n\tconstructor(entityId: number, analyticSource: string, role: string, entityType: string)\n\t{\n\t\tsuper(entityId);\n\t\tthis.analyticSource = analyticSource;\n\t\tthis.role = role;\n\t\tthis.entityType = entityType;\n\t\tthis.items = this.getFilteredItems();\n\t}\n\n\tgetItems(): Array\n\t{\n\t\treturn [\n\t\t\tnew AddEmployeeMenuItem(this.entityType, this.role),\n\t\t\tnew EditEmployeesMenuItem(this.entityType, this.role),\n\t\t];\n\t}\n}\n","import { EntityTypes } from 'humanresources.company-structure.utils';\nimport { AbstractActionMenu } from '../abstract-action-menu';\nimport { AddEmployeeMenuItem } from '../items/employees/add-employee-menu-item';\nimport { MoveEmployeeMenuItem } from '../items/employees/move-employee-menu-item';\nimport { UserInviteMenuItem } from '../items/employees/user-invite-menu-item';\n\nexport class EmptyUsersTabActionMenu extends AbstractActionMenu\n{\n\tconstructor(entityId: number, analyticSource: string, role: string, entityType: string)\n\t{\n\t\tsuper(entityId);\n\t\tthis.entityType = entityType;\n\t\tthis.analyticSource = analyticSource;\n\t\tthis.role = role;\n\t\tthis.items = this.getFilteredItems();\n\t}\n\n\tgetItems(): Array\n\t{\n\t\tif (this.entityType === EntityTypes.team)\n\t\t{\n\t\t\treturn [\n\t\t\t\tnew AddEmployeeMenuItem(this.entityType, this.role),\n\t\t\t];\n\t\t}\n\n\t\treturn [\n\t\t\tnew MoveEmployeeMenuItem(),\n\t\t\tnew UserInviteMenuItem(),\n\t\t\tnew AddEmployeeMenuItem(this.entityType, this.role),\n\t\t];\n\t}\n}\n","import type { PermissionCheckerClass } from 'humanresources.company-structure.permission-checker';\nimport { PermissionActions } from 'humanresources.company-structure.permission-checker';\nimport { getColorCode } from 'humanresources.company-structure.utils';\nimport { Loc } from 'main.core';\nimport { Main } from 'ui.icon-set.api.core';\nimport { AbstractMenuItem } from '../abstract-menu-item';\nimport { MenuActions } from '../../menu-actions';\n\nexport class FireUserFromCompanyMenuItem extends AbstractMenuItem\n{\n\tconstructor(isUserInvited: boolean)\n\t{\n\t\tsuper({\n\t\t\tid: MenuActions.fireUserFromCompany,\n\t\t\ttitle: isUserInvited\n\t\t\t\t? Loc.getMessage(\n\t\t\t\t\t'HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_DELETE_FROM_COMPANY_TITLE',\n\t\t\t\t)\n\t\t\t\t: Loc.getMessage(\n\t\t\t\t\t'HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_FIRE_FROM_COMPANY_TITLE',\n\t\t\t\t),\n\t\t\tdescription: Loc.getMessage(\n\t\t\t\t'HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_FIRE_FROM_COMPANY_SUBTITLE_MSGVER_1',\n\t\t\t),\n\t\t\tbIcon: {\n\t\t\t\tname: Main.PERSONS_DENY,\n\t\t\t\tsize: 20,\n\t\t\t\tcolor: getColorCode('paletteRed40'),\n\t\t\t},\n\t\t\tpermissionAction: isUserInvited ? '' : PermissionActions.employeeFire,\n\t\t\tdataTestId: 'hr-department-detail-content__user-list_fire-user-from-department',\n\t\t});\n\t}\n\n\thasPermission(permissionChecker: PermissionCheckerClass, entityId: number): boolean\n\t{\n\t\treturn permissionChecker.hasPermissionOfAction(this.permissionAction);\n\t}\n}\n","import type { PermissionCheckerClass } from 'humanresources.company-structure.permission-checker';\nimport { PermissionActions } from 'humanresources.company-structure.permission-checker';\nimport { EntityTypes, getColorCode } from 'humanresources.company-structure.utils';\nimport { Loc } from 'main.core';\nimport { Main } from 'ui.icon-set.api.core';\nimport { AbstractMenuItem } from '../abstract-menu-item';\nimport { MenuActions } from '../../menu-actions';\n\nexport class MoveFromDepartmentMenuItem extends AbstractMenuItem\n{\n\tconstructor(entityType: string)\n\t{\n\t\tconst title = entityType === EntityTypes.team\n\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_MOVE_TO_ANOTHER_TEAM_TITLE')\n\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_TITLE')\n\t\t;\n\n\t\tconst description = entityType === EntityTypes.team\n\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_MOVE_TO_ANOTHER_TEAM_SUBTITLE')\n\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_SUBTITLE')\n\t\t;\n\n\t\tsuper({\n\t\t\tid: MenuActions.moveUserToAnotherDepartment,\n\t\t\ttitle,\n\t\t\tdescription,\n\t\t\tbIcon: {\n\t\t\t\tname: Main.PERSON_ARROW_LEFT_1,\n\t\t\t\tsize: 20,\n\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t},\n\t\t\tpermissionAction: null,\n\t\t\tdataTestId: 'hr-department-detail-content__user-list_move-from-department',\n\t\t});\n\n\t\tthis.entityType = entityType;\n\t}\n\n\thasPermission(permissionChecker: PermissionCheckerClass, entityId: number): boolean\n\t{\n\t\tconst permissions = permissionChecker.currentUserPermissions;\n\n\t\tconst addMemberPermissionAction = this.entityType === EntityTypes.team\n\t\t\t? PermissionActions.teamAddMember\n\t\t\t: PermissionActions.employeeAddToDepartment\n\t\t;\n\n\t\tconst removeMemberPermissionAction = this.entityType === EntityTypes.team\n\t\t\t? PermissionActions.teamRemoveMember\n\t\t\t: PermissionActions.employeeRemoveFromDepartment\n\t\t;\n\n\t\tconst addMemberPermissionValue = this.entityType === EntityTypes.team\n\t\t\t? permissions.ACTION_TEAM_MEMBER_ADD\n\t\t\t: permissions.ACTION_EMPLOYEE_ADD_TO_DEPARTMENT\n\t\t;\n\n\t\tconst removeMemberPermissionValue = this.entityType === EntityTypes.team\n\t\t\t? permissions.ACTION_TEAM_MEMBER_REMOVE\n\t\t\t: permissions.ACTION_EMPLOYEE_REMOVE_FROM_DEPARTMENT\n\t\t;\n\n\t\tconst moveUserPermission = addMemberPermissionValue < removeMemberPermissionValue\n\t\t\t? addMemberPermissionAction\n\t\t\t: removeMemberPermissionAction\n\t\t;\n\n\t\treturn permissionChecker.hasPermission(moveUserPermission, entityId);\n\t}\n}\n","import { PermissionActions } from 'humanresources.company-structure.permission-checker';\nimport { EntityTypes, getColorCode } from 'humanresources.company-structure.utils';\nimport { Loc } from 'main.core';\nimport { Main } from 'ui.icon-set.api.core';\nimport { AbstractMenuItem } from '../abstract-menu-item';\nimport { MenuActions } from '../../menu-actions';\n\nexport class RemoveFromDepartmentMenuItem extends AbstractMenuItem\n{\n\tconstructor(entityType: string)\n\t{\n\t\tconst title = entityType === EntityTypes.team\n\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_REMOVE_FROM_TEAM_TITLE')\n\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_REMOVE_FROM_DEPARTMENT_TITLE')\n\t\t;\n\n\t\tconst description = entityType === EntityTypes.team\n\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_REMOVE_FROM_TEAM_SUBTITLE')\n\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_REMOVE_FROM_DEPARTMENT_SUBTITLE')\n\t\t;\n\n\t\tconst color = entityType === EntityTypes.team\n\t\t\t? getColorCode('paletteRed40')\n\t\t\t: getColorCode('paletteBlue50')\n\t\t;\n\n\t\tconst permissionAction = entityType === EntityTypes.team\n\t\t\t? PermissionActions.teamRemoveMember\n\t\t\t: PermissionActions.employeeRemoveFromDepartment\n\t\t;\n\n\t\tsuper({\n\t\t\tid: MenuActions.removeUserFromDepartment,\n\t\t\ttitle,\n\t\t\tdescription,\n\t\t\tbIcon: {\n\t\t\t\tname: Main.TRASH_BIN,\n\t\t\t\tsize: 20,\n\t\t\t\tcolor,\n\t\t\t},\n\t\t\tpermissionAction,\n\t\t\tdataTestId: 'hr-department-detail-content__user-list_remove-from-department',\n\t\t});\n\t}\n}\n","import { EntityTypes } from 'humanresources.company-structure.utils';\nimport { AbstractActionMenu } from '../abstract-action-menu';\nimport { FireUserFromCompanyMenuItem } from '../items/user-item/fire-user-from-company';\nimport { MoveFromDepartmentMenuItem } from '../items/user-item/move-from-department';\nimport { RemoveFromDepartmentMenuItem } from '../items/user-item/remove-from-department';\n\nexport class UserListActionMenu extends AbstractActionMenu\n{\n\tisUserInvited: boolean;\n\n\tconstructor(entityId: number, entityType: string, isUserInvited: boolean)\n\t{\n\t\tsuper(entityId);\n\t\tthis.isUserInvited = isUserInvited;\n\t\tthis.entityType = entityType;\n\t\tthis.items = this.getFilteredItems();\n\t}\n\n\tgetItems(): Array\n\t{\n\t\tif (this.entityType === EntityTypes.team)\n\t\t{\n\t\t\treturn [\n\t\t\t\tnew MoveFromDepartmentMenuItem(this.entityType),\n\t\t\t\tnew RemoveFromDepartmentMenuItem(this.entityType),\n\t\t\t];\n\t\t}\n\n\t\treturn [\n\t\t\tnew MoveFromDepartmentMenuItem(this.entityType),\n\t\t\tnew RemoveFromDepartmentMenuItem(this.entityType),\n\t\t\tnew FireUserFromCompanyMenuItem(this.isUserInvited),\n\t\t];\n\t}\n}\n","import type { ChatOrChannelDetailed } from 'humanresources.company-structure.utils';\nimport { getColorCode, ChatTypes } from 'humanresources.company-structure.utils';\nimport { Main } from 'ui.icon-set.api.core';\nimport { AbstractMenuItem } from '../abstract-menu-item';\nimport { PermissionCheckerClass } from 'humanresources.company-structure.permission-checker';\nimport { MenuActions } from '../../menu-actions';\nimport { Loc } from 'main.core';\n\n/**\n * Menu item for opening a chat or channel.\n * Displays appropriate title, and description based on chat type.\n * Checks permissions using hasAccess property of the chat.\n */\nexport class OpenChatMenuItem extends AbstractMenuItem\n{\n\tchat: ChatOrChannelDetailed;\n\n\tconstructor(entityType: string, chat: ChatOrChannelDetailed)\n\t{\n\t\tconst title = chat.type === ChatTypes.chat\n\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_OPEN_CHAT_TITLE')\n\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_OPEN_CHANNEL_TITLE')\n\t\t;\n\n\t\tconst description = chat.type === ChatTypes.chat\n\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_OPEN_CHAT_DESCRIPTION')\n\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_OPEN_CHANNEL_DESCRIPTION')\n\t\t;\n\n\t\tsuper({\n\t\t\tid: MenuActions.openChat,\n\t\t\ttitle,\n\t\t\tdescription,\n\t\t\tbIcon: {\n\t\t\t\tname: Main.EDIT_PENCIL,\n\t\t\t\tsize: 20,\n\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t},\n\t\t\tpermissionAction: null,\n\t\t\tdataTestId: 'hr-department-detail-content__chat-list_open-chat',\n\t\t});\n\n\t\tthis.entityType = entityType;\n\t\tthis.chat = chat;\n\t}\n\n\thasPermission(permissionChecker: PermissionCheckerClass, entityId: number): boolean\n\t{\n\t\treturn this.chat.hasAccess;\n\t}\n}\n","import type { ChatOrChannelDetailed } from 'humanresources.company-structure.utils';\nimport { EntityTypes, getColorCode, ChatTypes } from 'humanresources.company-structure.utils';\nimport { Main } from 'ui.icon-set.api.core';\nimport { PermissionActions, PermissionCheckerClass } from 'humanresources.company-structure.permission-checker';\nimport { AbstractMenuItem } from '../abstract-menu-item';\nimport { MenuActions } from '../../menu-actions';\nimport { Loc } from 'main.core';\n\n/**\n * Menu item for unbinding a chat or channel from a team or department.\n * Displays appropriate title, description, and permission requirements\n * based on the entity type and chat type.\n */\nexport class UnbindChatMenuItem extends AbstractMenuItem\n{\n\tchat: ChatOrChannelDetailed;\n\n\tconstructor(entityType: string, chat: ChatOrChannelDetailed)\n\t{\n\t\tlet title = '';\n\t\tlet description = '';\n\n\t\tif (entityType === EntityTypes.team)\n\t\t{\n\t\t\ttitle = chat.type === ChatTypes.chat\n\t\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_UNBIND_TEAM_CHAT_TITLE')\n\t\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_UNBIND_TEAM_CHANNEL_TITLE')\n\t\t\t;\n\n\t\t\tdescription = chat.type === ChatTypes.chat\n\t\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_UNBIND_TEAM_CHAT_DESCRIPTION')\n\t\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_UNBIND_TEAM_CHANNEL_DESCRIPTION')\n\t\t\t;\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttitle = chat.type === ChatTypes.chat\n\t\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_UNBIND_DEPARTMENT_CHAT_TITLE')\n\t\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_UNBIND_DEPARTMENT_CHANNEL_TITLE')\n\t\t\t;\n\n\t\t\tdescription = chat.type === ChatTypes.chat\n\t\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_UNBIND_DEPARTMENT_CHAT_DESCRIPTION')\n\t\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_UNBIND_DEPARTMENT_CHANNEL_DESCRIPTION')\n\t\t\t;\n\t\t}\n\n\t\tconst permissionAction = entityType === EntityTypes.team\n\t\t\t? PermissionActions.teamCommunicationEdit\n\t\t\t: PermissionActions.departmentCommunicationEdit\n\t\t;\n\n\t\tsuper({\n\t\t\tid: MenuActions.unbindChat,\n\t\t\ttitle,\n\t\t\tdescription,\n\t\t\tbIcon: {\n\t\t\t\tname: Main.TRASH_BIN,\n\t\t\t\tsize: 20,\n\t\t\t\tcolor: getColorCode('paletteRed40'),\n\t\t\t},\n\t\t\tpermissionAction,\n\t\t\tdataTestId: 'hr-department-detail-content__chat-list_open-chat',\n\t\t});\n\n\t\tthis.chat = chat;\n\t}\n\n\thasPermission(permissionChecker: PermissionCheckerClass, entityId: number): boolean\n\t{\n\t\treturn !this.chat.originalNodeId\n\t\t\t&& this.chat.hasAccess\n\t\t\t&& permissionChecker.hasPermission(this.permissionAction, entityId)\n\t\t;\n\t}\n}\n","import type { ChatOrChannelDetailed } from 'humanresources.company-structure.utils';\nimport { AbstractActionMenu } from '../abstract-action-menu';\nimport { OpenChatMenuItem } from '../items/chats/open-chat-menu-item';\nimport { UnbindChatMenuItem } from '../items/chats/unbund-chat-menu-item';\n\n/**\n * Action menu for chat or channel items in the company structure.\n * Provides menu items to open or unbind a chat/channel.\n */\nexport class ChatListActionMenu extends AbstractActionMenu\n{\n\tchat: ChatOrChannelDetailed;\n\n\tconstructor(entityType: number, chat: ChatOrChannelDetailed, entityId: number)\n\t{\n\t\tsuper(entityId);\n\t\tthis.chat = chat;\n\t\tthis.entityType = entityType;\n\t\tthis.items = this.getFilteredItems();\n\t}\n\n\tgetItems(): Array\n\t{\n\t\treturn [\n\t\t\tnew OpenChatMenuItem(this.entityType, this.chat),\n\t\t\tnew UnbindChatMenuItem(this.entityType, this.chat),\n\t\t];\n\t}\n}\n","import { EventEmitter, type BaseEvent } from 'main.core.events';\nimport { events } from './consts';\nimport { Dom, Loc, Tag } from 'main.core';\nimport { chartAPI } from './api';\n\nexport class NotConvertedState\n{\n\tstatic updateConvertedStatusInterval;\n\n\tstatic #subscribeOnEvents(): void\n\t{\n\t\tconst onCloseByEsc = (event: BaseEvent) => {\n\t\t\tconst [sidePanelEvent] = event.data;\n\t\t\tsidePanelEvent.denyAction();\n\t\t};\n\n\t\tconst onClose = () => {\n\t\t\tEventEmitter.unsubscribe(events.HR_ORG_CHART_CLOSE_BY_ESC, onCloseByEsc);\n\t\t\tEventEmitter.unsubscribe(events.HR_ORG_CHART_CLOSE, onClose);\n\t\t\tclearInterval(this.updateConvertedStatusInterval);\n\t\t};\n\t\tEventEmitter.subscribe(events.HR_ORG_CHART_CLOSE_BY_ESC, onCloseByEsc);\n\t\tEventEmitter.subscribe(events.HR_ORG_CHART_CLOSE, onClose);\n\t}\n\n\tstatic async mount(containerId: string): Promise<void>\n\t{\n\t\tconst container = document.getElementById(containerId);\n\t\tDom.append(this.#getNotConvertedStateScreen(), container);\n\t\tthis.#subscribeOnEvents();\n\n\t\tconst updateTimeMs = 30000;\n\t\tthis.updateConvertedStatusInterval = setInterval(async () => {\n\t\t\ttry\n\t\t\t{\n\t\t\t\tawait chartAPI.getDictionary();\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tif (e.code === 'STRUCTURE_IS_NOT_CONVERTED')\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (e.code === 'STRUCTURE_ACCESS_DENIED')\n\t\t\t\t{\n\t\t\t\t\tclearInterval(this.updateConvertedStatusInterval);\n\t\t\t\t\twindow.location.reload();\n\t\t\t\t}\n\n\t\t\t\tthrow e;\n\t\t\t}\n\n\t\t\tclearInterval(this.updateConvertedStatusInterval);\n\t\t\twindow.location.reload();\n\t\t}, updateTimeMs);\n\t}\n\n\tstatic #getNotConvertedStateScreen(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"humanresources-not-converted-state-screen\">\n\t\t\t\t<div class=\"humanresources-not-converted-state-screen__icon\"></div>\n\t\t\t\t<div class=\"humanresources-not-converted-state-screen__title\">\n\t\t\t\t\t${Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_NOT_CONVERTED_SCREEN_LOADING_TITLE')}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"humanresources-not-converted-state-screen__description\">\n\t\t\t\t\t${Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_NOT_CONVERTED_SCREEN_LOADING_DESCRIPTION')}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n}\n","import { EventEmitter, type BaseEvent } from 'main.core.events';\nimport { events } from './consts';\nimport { BitrixVue } from 'ui.vue3';\nimport { createPinia } from 'ui.vue3.pinia';\nimport { Dom } from 'main.core';\nimport { Chart } from './app';\nimport { PermissionChecker } from 'humanresources.company-structure.permission-checker';\n\nexport { UsersTabActionMenu } from './components/menu/menu/users-tab-action-menu';\nexport { EmptyUsersTabActionMenu } from './components/menu/menu/empty-users-tab-action-menu';\nexport { UserListActionMenu } from './components/menu/menu/user-list-item-action-menu';\nexport { ChatListActionMenu } from './components/menu/menu/chat-list-action-menu';\nexport { MenuActions } from './components/menu/menu-actions';\nexport { NotConvertedState } from './not-converted-state';\nexport { events } from './consts';\n\nexport class App\n{\n\tstatic #subscribeOnEvents(app: Object): void\n\t{\n\t\tconst onCloseByEsc = (event: BaseEvent) => {\n\t\t\tconst [sidePanelEvent] = event.data;\n\t\t\tsidePanelEvent.denyAction();\n\t\t};\n\n\t\tconst onClose = () => {\n\t\t\tEventEmitter.unsubscribe(events.HR_ORG_CHART_CLOSE_BY_ESC, onCloseByEsc);\n\t\t\tEventEmitter.unsubscribe(events.HR_ORG_CHART_CLOSE, onClose);\n\t\t\tapp.unmount();\n\t\t};\n\t\tEventEmitter.subscribe(events.HR_ORG_CHART_CLOSE_BY_ESC, onCloseByEsc);\n\t\tEventEmitter.subscribe(events.HR_ORG_CHART_CLOSE, onClose);\n\t}\n\n\tstatic async mount(containerId: string): Promise<void>\n\t{\n\t\tconst container = document.getElementById(containerId);\n\t\tconst app = BitrixVue.createApp(Chart);\n\t\tconst store = createPinia();\n\t\tapp.use(store);\n\t\tApp.#subscribeOnEvents(app);\n\n\t\tconst slider = BX.SidePanel.Instance.getTopSlider();\n\t\tif (slider)\n\t\t{\n\t\t\tslider.showLoader();\n\t\t}\n\t\tDom.addClass(container, 'humanresources-chart__back');\n\n\t\tawait PermissionChecker.init();\n\t\tif (slider)\n\t\t{\n\t\t\tslider.closeLoader();\n\t\t}\n\t\tDom.removeClass(container, 'humanresources-chart__back');\n\t\tapp.mount(container);\n\t}\n}\n"],"names":["events","Object","freeze","HR_DEPARTMENT_CONNECT","HR_DEPARTMENT_DISCONNECT","HR_DEPARTMENT_ADAPT_SIBLINGS","HR_DEPARTMENT_ADAPT_CONNECTOR_HEIGHT","HR_DEPARTMENT_FOCUS","HR_DEPARTMENT_CONTROL","HR_DEPARTMENT_MENU_CLOSE","HR_ORG_CHART_CLOSE_BY_ESC","HR_ORG_CHART_CLOSE","HR_FIRST_POPUP_SHOW","HR_DRAG_ENTITY","HR_DROP_ENTITY","HR_ORG_CHART_TRANSFORM_CANVAS","HR_DEPARTMENT_SLIDER_ON_MESSAGE","HR_ORG_CHART_LOCATE_TO_DEPARTMENT","HR_ENTITY_TOGGLE_ELEMENTS","HR_ENTITY_SHOW_WIZARD","HR_ENTITY_REMOVE","HR_PUBLIC_FOCUS_NODE","INTRANET_USER_MINIPROFILE_CLOSE","HR_USER_DRAG_START","HR_USER_DRAG_MOVE","HR_USER_DRAG_DROP","HR_USER_DRAG_END","HR_USER_DRAG_ENTER_NODE","HR_USER_DRAG_LEAVE_NODE","detailPanelWidth","MenuOption","addDepartment","addEmployee","AddButton","name","components","RouteActionMenu","emits","data","actionMenu","visible","computed","mounted","permissionChecker","PermissionChecker","getInstance","dropdownItems","id","title","loc","description","bIcon","Main","CUBE_PLUS","size","color","getColorCode","permission","action","PermissionActions","departmentCreate","CRM","PERSON_PLUS_2","employeeAddToDepartment","filter","item","hasPermissionOfAction","methods","phraseCode","replacements","$Bitrix","Loc","getMessage","$emit","actionMenuItemClickHandler","actionId","template","createTreeDataStore","treeData","dataMap","Map","forEach","parentId","colorName","entityType","mapItem","get","teamColor","getNodeColorSettings","set","mapParentItem","children","chartAPI","removeDepartment","getData","nodeId","getDepartmentsData","tool","category","event","getCurrentDepartments","getDictionary","getUserId","firstTimeOpened","postData","updateDepartment","changeOrder","draggedId","direction","count","OrgChartActions","applyData","departments","currentDepartments","userId","map","store","useChartStore","$patch","searchedUserId","structureMap","focusDepartment","departmentId","focusedNode","searchUserInDepartment","moveSubordinatesToParent","removableDepartmentId","removableDepartment","removableDeparmentChildren","userCount","removableDepartmentUserCount","heads","removableDeparmentHeads","employees","removableDeparmentEmployees","parentDepartment","childId","department","mapEntity","EntityTypes","parentDepartmentUsersIds","Set","user","removableDeparmentUsers","movableUsers","has","role","memberRoles","employee","length","includes","changeCurrentDepartment","markDepartmentAsRemoved","prevParentId","delete","inviteUser","userData","restData","orderDepartments","targetId","targetIndex","indexOf","newChildren","splice","clearNodesChatLists","nodeIds","chats","channels","SearchBar","BIcon","directives","focus","el","canEditPermissions","showSearchBar","mapState","watch","handler","searchDialog","destroy","deep","created","getSearchDialog","showSearchbar","analyticsSendData","hideSearchbar","dialog","Dialog","width","height","multiple","entities","searchFields","type","system","searchable","options","intranetUsersOnly","emailUsers","inviteEmployeeLink","selectMode","useMultipleTabs","restricted","flatMode","includedNodeEntityTypes","recentTabOptions","dropdownMode","enableSearch","hideOnDeselect","context","customData","recentItemsToSave","push","saveRecentItems","onLoad","target","items","getSubtitle","setSubtitle","onDestroy","dialogContainer","getContainer","Dom","attr","onEnter","$refs","searchName","setTargetNode","isOpen","show","Event","bind","window","handleClickOutside","parentElement","contains","clearSearch","unbind","search","value","getSearchTab","clearResults","selectTab","accessRights","teamAccessRights","BurgerMenuButton","accessEdit","PERSONS_2","dataTestId","teamAccessEdit","BX","SidePanel","Instance","open","usePadding","TitlePanel","canAddNode","toolbarStarActive","isHovered","toolbarStarElement","document","getElementById","teamCreate","error","console","observer","MutationObserver","hasClass","observe","attributes","attributeFilter","toolbarStarIcon","isAirTemplate","FAVORITE_1","FAVORITE_0","Reflection","getClass","toolbarClassIcon","source","AnalyticsSourceType","HEADER","onLocate","EventEmitter","emit","triggerFavoriteStar","click","UI","Notification","Center","notify","content","autoHideDelay","DepartmentAPI","getPagedEmployees","page","countPerPage","removeUserFromDepartment","moveUserToDepartment","targetNodeId","roleXmlId","isUserInMultipleDepartments","getUserInfo","fireUser","findMemberByQuery","query","getChatsAndChannels","saveChats","ids","removeIds","markDescendantsForChatReload","childrenIds","queue","visited","maxIterations","iterations","shift","add","childDepartment","chatsDetailed","channelsDetailed","DepartmentContentActions","targetDepartmentId","targetDepartment","oldMemberRoles","getMemberRoles","targetMemberRoles","find","head","updateEmployees","updateHeads","updateEmployeeListOptions","employeeListOptions","setChatsAndChannels","chatsNoAccess","channelsNoAccess","chatAndChannelsCount","removeUserFromAllDepartments","departmentsToUpdate","key","Type","isArray","some","refreshDepartments","unbindChatFromNode","chatId","chat","updateChatsInChildrenNodes","parentNodeId","UserManagementDialogActions","getDepartmentName","moveUsersToDepartment","users","updatedDepartmentIds","newMemberUserIds","headsUserIds","newUsers","addUsersToDepartment","UrlParamNames","FocusNodeId","UrlProvidedParamsService","getParams","paramMap","focusNodeId","urlSearchParams","URLSearchParams","location","values","paramName","paramValue","isUndefined","castedValue","Number","isInteger","HeadList","UserListActionMenu","props","Array","required","default","String","collapsed","Boolean","isTeamEntity","isCollapsed","isUpdating","headsVisible","defaultAvatar","workPosition","getPositionText","titleBar","userTypes","deputy","handleUserClick","url","cacheable","closeHeadList","unsubscribe","openHeadList","subscribe","AbstractActionMenu","constructor","entityId","getItems","Error","getFilteredItems","isFunction","hasPermission","onActionMenuItemClick","targetItem","invoke","analyticSource","AbstractMenuItem","permissionAction","MenuActions","editDepartment","editEmployee","moveEmployee","userInvite","teamRights","moveUserToAnotherDepartment","fireUserFromCompany","openChat","unbindChat","AddDepartmentMenuItem","isTeamsAvailable","team","isEditMode","showEntitySelector","EditDepartmentMenuItem","EDIT_PENCIL","refToFocus","teamEdit","teamAddMember","teamCommunicationEdit","teamSettingsEdit","departmentEdit","departmentCommunicationEdit","RemoveDepartmentMenuItem","teamDelete","departmentDelete","TRASH_BIN","AddEmployeeMenuItem","localize","i18nRole","i18nType","i18nMap","teamMemberRoles","UserManagementDialog","openDialog","EditEmployeesMenuItem","imageClass","EDIT_MENU","MoveEmployeeMenuItem","PERSON_ARROW_LEFT_1","currentUserPermissions","ACTION_EMPLOYEE_REMOVE_FROM_DEPARTMENT","UserInviteMenuItem","PERSON_LETTER","inviteToDepartment","allowChangeHistory","EntityActionMenu","DepartmentMenuButton","menuVisible","menu","DETAIL","closeMenu","openMenu","DepartmentInfoIconButton","BasePopup","canvasZoom","showPopup","popupConfig","popupWidth","buttonWidth","initialPopupOffset","angleWidth","bindElement","departmentMenuButton","bindOptions","position","borderRadius","contentNoPaddings","contentPadding","padding","offsetTop","offsetLeft","angleOffset","menuItem","canEdit","onClose","onOpen","addDescription","CARD","SubdivisionAddButton","canShow","addSubdivision","PLUS","TreeNode","hint","Hint","inject","expandedNodes","isShown","userDropTargetNodeId","isUserDropAllowed","isDraggingUser","childrenOffset","childrenMounted","showInfo","showDnd","nodeData","nodeClass","isDragSource","isCurrentDepartment","subdivisionsClass","hasChildren","isExpanded","deputyHead","employeeCount","childNodeStyle","left","showSubdivisionAddButton","nodeDataTitle","subdivisionsText","locPlural","childDepartmentsCount","childTeamsCount","deputyTitle","dropOverlayText","sourceNode","showOverlay","adaptHeight","immediate","gap","prevChildrenOffset","prevHeight","editAction","viewAction","teamView","structureView","$nextTick","$el","offsetHeight","html","parentsPath","getParentsPath","calculateNodePoints","unmounted","remove","onDepartmentClick","showEmployees","subdivisionsSelected","calculatePosition","node","offset","getMessagePlural","top","getBoundingClientRect","parentNode","$parent","parentLeft","parentTop","parentWidth","parentHeight","x","chartX","y","chartY","getTreeBounds","startPoint","endPoint","topLevelId","onDragMouseEnter","onDragMouseLeave","Connectors","expose","isLocatedDepartmentVisible","treeNodes","connectors","subscribeOnEvents","prevWindowWidth","innerWidth","beforeUnmount","unsubscribeFromEvents","onAddConnector","connector","assign","highlighted","onRemoveConnector","onAdaptSiblingConnectors","isMounted","parsedSiblingConnectors","reduce","acc","currentEndPoint","currentId","currentParentId","sign","currentStartPoint","ancestorId","ancestorSign","adaptConnectorsAfterReorder","isRoot","onAdaptConnectorHeight","toggleConnectorsVisibility","toggleAllConnectorsVisibility","shouldShow","keys","toggleConnectorHighlighting","expanded","highlightedConnector","getPath","verticalLineHeight","parentNodeStyle","getComputedStyle","minDepartmentHeight","parseInt","getPropertyValue","diffHeight","shiftY","startY","shadowOffset","rounded","start","end","arcRadius","Math","round","adjustedEndY","join","entries","handle","onResizeWindow","startPointX","endPointX","FULL_WIDTH","CANVAS_MOVE_SPEED","TreeNodeDragController","currentTarget","tree","pageX","pageY","stopPropagation","dataset","zoom","closest","prevX","prevY","addClass","shouldShowElements","removeClass","style","affectedItem","directionX","directionY","insertion","affectedItems","draggedIndex","shiftKey","currentCanvasX","movementX","currentCanvasY","movementY","ghost","cloneNode","treeX","treeY","draggedX","draggedY","append","offsetWidth","text","positionPointer","Tag","render","element","rotation","nodeX","nodeY","reorderThreshold","changeParentWithReorderThreshold","draggedWidth","draggedHeight","points","targetData","point","i","belowItem","elementFromPoint","targetItemSummary","targetX","targetY","targetWidth","targetHeight","sameParent","hasSortPermission","canSortEntitiesByParentId","allowSort","isDepartmentInsertToTeam","isInsertToParent","canBeParentForEntity","slice","zoomedLeft","zoomedTop","body","speed","shouldReset","DragAndDrop","updated","setAttribute","Tree","MoveEmployeeConfirmationPopup","ConfirmationPopup","dnd","provide","canvasTransform","isLoaded","draggedUserData","showDndConfirmationPopup","showDndErrorPopup","dndErrorPopupDescription","dndUserMoveContext","isCombineOnly","rootId","dndPopupDescription","phrase","Text","encode","loadHeads","departmentToFocus","getDepartmentIdForInitialFocus","currentDepartmentsLocated","expandDepartmentParents","expandAfterFocus","expandLowerDepartments","providedFocusNodeId","currentDepartmentId","onConnectDepartment","departmentIdToFocus","movingDelay","Runtime","debounce","moveTo","onDisconnectDepartment","onDragEntity","collapseRecursively","onToggleConnectors","promise","fullDepartmentWidth","draggedShift","affectedShift","ordered","updateParent","updateParentPromise","targetParentId","locateToDepartment","affectedCount","err","onDropEntity","onPublicFocusNode","collapse","expandedId","deepCollapse","expandedNode","expand","childrenWithoutHeads","shouldExpand","onFocusDepartment","preventSwitch","tryRemoveDepartment","localizationMap","message","success","mapIndex","messageBox","MessageBox","create","buttons","MessageBoxButtons","OK_CANCEL","onOk","close","onCancel","minWidth","maxWidth","minHeight","okCaption","popupOptions","className","overlay","opacity","okButton","getOkButton","cancelButton","getCancelButton","setRound","setColor","ButtonColor","DANGER","LIGHT_BORDER","removableDepartmentChildren","expandLevel","expandRecursively","middleBound","trunc","traverseSibling","siblingId","currentChildren","locateToCurrentDepartment","currentDepartment","treeRect","centerX","centerY","treeNode","treeNodeRect","departmentIds","onUserDragStart","onUserDragDrop","onUserDragEnd","onUserDragEnterNode","onUserDragLeaveNode","hoveredNodeId","sourceDepartmentId","hoveredNode","movePermissions","canMoveUser","isAllowed","combineOnly","sourceRole","confirmUserMove","payload","userInTarget","u","isAlreadyInTarget","isRoleTheSame","displayDndErrorPopup","isCombineMode","handleCombineUser","handleMoveUser","roleLabel","dndContext","UserManagementDialogAPI","badgeText","finalUserCount","cancelUserMove","closeDndErrorPopup","sourceDepartmentData","hoveredNodeData","forceCombine","sourcePermissionAction","teamRemoveMember","employeeRemoveFromDepartment","canTakeFromSource","targetPermissionAction","canPutToTarget","TransformPanel","modelValue","selectedId","zoomInPercent","percent","toFixed","actions","zoomIn","zoomOut","locate","navigate","onZoom","leftBound","rightBound","oldCenterX","oldCenterY","onfocusout","DetailPanelCollapsedTitle","avatars","maxVisibleAvatarsCount","additionalCount","DetailPanelEditButton","DetailPanel","DepartmentContent","preventPanelSwitch","isHidden","isLoading","needToShowLoader","headAvatarsArray","avatar","isPanelCollapsed","newId","oldId","updateDetailPageHandler","newDepartments","toggleCollapse","showLoader","hideLoader","onToggleDetailPanel","FirstPopup","subDescription","features","closePopup","Chart","TransformCanvas","ChartWizard","canvas","shown","moved","modelTransform","wizard","entity","detailPanel","isTransitionCompleted","slider","getTopSlider","departmentsData","Promise","all","closeLoader","structure","parsedDepartments","availableDepartments","rootOffset","transformCanvas","showConfetti","handleInviteSliderMessage","PULL","PullClient","SubscriptionType","Server","moduleId","command","callback","clearChatLists","showWizardEventHandler","removeDepartmentEventHandler","onCanvasTransformWhenDragging","onMoveTo","detailPanelWidthZoomed","newX","newY","samePoint","onUpdateTransform","onShowWizard","c_element","onModifyTree","onWizardClose","onRemoveDepartment","onTransitionEnd","Confetti","fire","particleCount","startVelocity","spread","ticks","origin","onControlDetail","messageEvent","eventId","getEventId","invitedUserData","getInvitedUserData","onKeyDown","preventDefault","UsersTabActionMenu","EmptyUsersTabActionMenu","FireUserFromCompanyMenuItem","isUserInvited","PERSONS_DENY","employeeFire","MoveFromDepartmentMenuItem","permissions","addMemberPermissionAction","removeMemberPermissionAction","addMemberPermissionValue","ACTION_TEAM_MEMBER_ADD","ACTION_EMPLOYEE_ADD_TO_DEPARTMENT","removeMemberPermissionValue","ACTION_TEAM_MEMBER_REMOVE","moveUserPermission","RemoveFromDepartmentMenuItem","OpenChatMenuItem","ChatTypes","hasAccess","UnbindChatMenuItem","originalNodeId","ChatListActionMenu","NotConvertedState","mount","containerId","container","updateTimeMs","updateConvertedStatusInterval","setInterval","e","code","clearInterval","reload","onCloseByEsc","sidePanelEvent","denyAction","App","app","BitrixVue","createApp","createPinia","use","init","unmount"],"mappings":";;;;;;OAAaA,MAAM,GAAGC,MAAM,CAACC,MAAM,CAAC;GACnCC,qBAAqB,EAAE,uBAAuB;GAC9CC,wBAAwB,EAAE,0BAA0B;GACpDC,4BAA4B,EAAE,8BAA8B;GAC5DC,oCAAoC,EAAE,sCAAsC;GAC5EC,mBAAmB,EAAE,qBAAqB;GAC1CC,qBAAqB,EAAE,uBAAuB;GAC9CC,wBAAwB,EAAE,0BAA0B;GACpDC,yBAAyB,EAAE,+BAA+B;GAC1DC,kBAAkB,EAAE,0BAA0B;GAC9CC,mBAAmB,EAAE,yCAAyC;GAC9DC,cAAc,EAAE,gBAAgB;GAChCC,cAAc,EAAE,gBAAgB;GAChCC,6BAA6B,EAAE,+BAA+B;GAC9DC,+BAA+B,EAAE,4BAA4B;GAC7DC,iCAAiC,EAAE,mCAAmC;GACtEC,yBAAyB,EAAE,2BAA2B;GAEtDC,qBAAqB,EAAE,uBAAuB;GAC9CC,gBAAgB,EAAE,kBAAkB;GACpCC,oBAAoB,EAAE,2CAA2C;GAEjEC,+BAA+B,EAAE,iCAAiC;GAElEC,kBAAkB,EAAE,+BAA+B;GACnDC,iBAAiB,EAAE,8BAA8B;GACjDC,iBAAiB,EAAE,0BAA0B;GAC7CC,gBAAgB,EAAE,6BAA6B;GAC/CC,uBAAuB,EAAE,mCAAmC;GAC5DC,uBAAuB,EAAE;CAC1B,CAAC,CAAC;AAEF,CAAO,MAAMC,gBAAgB,GAAG,GAAG;;CCzBnC,MAAMC,UAAU,GAAG7B,MAAM,CAACC,MAAM,CAAC;GAChC6B,aAAa,EAAE,gBAAgB;GAC/BC,WAAW,EAAE;CACd,CAAC,CAAC;;CAEF;AACA,CAAO,MAAMC,SAAS,GAAG;GACxBC,IAAI,EAAE,WAAW;GAEjBC,UAAU,EAAE;sBACXC;IACA;GAEDC,KAAK,EAAE,CAAC,eAAe,CAAC;GAExBC,IAAI,GACJ;KACC,OAAO;OACNC,UAAU,EAAE;SACXC,OAAO,EAAE;;MAEV;IACD;GAEDC,QAAQ,EAAE;KACTX,UAAU,GACV;OACC,OAAOA,UAAU;;IAElB;GAEDY,OAAO,GACP;KACC,MAAMC,iBAAiB,GAAGC,mEAAiB,CAACC,WAAW,EAAE;KAEzD,IAAI,CAACF,iBAAiB,EACtB;OACC;;KAED,IAAI,CAACG,aAAa,GAAG,CACpB;OACCC,EAAE,EAAEjB,UAAU,CAACC,aAAa;OAC5BiB,KAAK,EAAE,IAAI,CAACC,GAAG,CAAC,uEAAuE,CAAC;OACxFC,WAAW,EAAE,IAAI,CAACD,GAAG,CAAC,uEAAuE,CAAC;OAC9FE,KAAK,EAAE;SACNjB,IAAI,EAAEkB,wBAAI,CAACC,SAAS;SACpBC,IAAI,EAAE,EAAE;SACRC,KAAK,EAAEC,kDAAY,CAAC,eAAe;QACnC;OACDC,UAAU,EAAE;SACXC,MAAM,EAAEC,mEAAiB,CAACC;;MAE3B,EACD;OACCb,EAAE,EAAEjB,UAAU,CAACE,WAAW;OAC1BgB,KAAK,EAAE,IAAI,CAACC,GAAG,CAAC,qEAAqE,CAAC;OACtFC,WAAW,EAAE,IAAI,CAACD,GAAG,CAAC,qEAAqE,CAAC;OAC5FE,KAAK,EAAE;SACNjB,IAAI,EAAE2B,uBAAG,CAACC,aAAa;SACvBR,IAAI,EAAE,EAAE;SACRC,KAAK,EAAEC,kDAAY,CAAC,eAAe;QACnC;OACDC,UAAU,EAAE;SACXC,MAAM,EAAEC,mEAAiB,CAACI;;MAE3B,CACD;KAED,IAAI,CAACjB,aAAa,GAAG,IAAI,CAACA,aAAa,CAACkB,MAAM,CAAEC,IAAI,IAAK;OACxD,IAAI,CAACA,IAAI,CAACR,UAAU,EACpB;SACC,OAAO,KAAK;;OAGb,OAAOd,iBAAiB,CAACuB,qBAAqB,CAACD,IAAI,CAACR,UAAU,CAACC,MAAM,CAAC;MACtE,CAAC;IACF;GAEDS,OAAO,EAAE;KACRlB,GAAG,CAACmB,UAAkB,EAAEC,YAAqC,GAAG,EAAE,EAClE;OACC,OAAO,IAAI,CAACC,OAAO,CAACC,GAAG,CAACC,UAAU,CAACJ,UAAU,EAAEC,YAAY,CAAC;MAC5D;KACDtC,aAAa,GACb;OACC,IAAI,CAAC0C,KAAK,CAAC,eAAe,CAAC;MAC3B;KACDC,0BAA0B,CAACC,QAAgB,EAC3C;OACC,IAAIA,QAAQ,KAAK7C,UAAU,CAACC,aAAa,EACzC;SACC,IAAI,CAAC0C,KAAK,CAAC,eAAe,CAAC;;;IAG7B;GACDG,QAAQ,EAAG;;;;;;;;;CASZ,CAAC;;CC3GD,MAAMC,mBAAmB,GAAIC,QAAyB,IAA4B;GACjF,MAAMC,OAAO,GAAG,IAAIC,GAAG,EAAE;GACzBF,QAAQ,CAACG,OAAO,CAAEhB,IAAI,IAAK;KAAA;KAC1B,MAAM;OAAElB,EAAE;OAAEmC,QAAQ;OAAEC,SAAS;OAAEC;MAAY,GAAGnB,IAAI;KACpD,MAAMoB,OAAO,mBAAGN,OAAO,CAACO,GAAG,CAACvC,EAAE,CAAC,2BAAI,EAAE;KACrC,MAAMwC,SAAS,GAAGC,0DAAoB,CAACL,SAAS,EAAEC,UAAU,CAAC;KAC7DL,OAAO,CAACU,GAAG,CAAC1C,EAAE,EAAE;OAAE,GAAGsC,OAAO;OAAE,GAAGpB,IAAI;OAAEsB;MAAW,CAAC;KACnD,IAAIL,QAAQ,KAAK,CAAC,EAClB;OACC;;KAGD,MAAMQ,aAAa,oBAAGX,OAAO,CAACO,GAAG,CAACJ,QAAQ,CAAC,4BAAI,EAAE;KACjD,MAAMS,QAAQ,4BAAGD,aAAa,CAACC,QAAQ,oCAAI,EAAE;KAC7CZ,OAAO,CAACU,GAAG,CAACP,QAAQ,EAAE;OACrB,GAAGQ,aAAa;OAChBC,QAAQ,EAAE,CAAC,GAAGA,QAAQ,EAAE5C,EAAE;MAC1B,CAAC;IACF,CAAC;GAEF,OAAOgC,OAAO;CACf,CAAC;AAED,CAAO,MAAMa,QAAQ,GAAG;GACvBC,gBAAgB,EAAG9C,EAAU,IAAoB;KAChD,OAAO+C,2CAAO,CAAC,0CAA0C,EAAE;OAAEC,MAAM,EAAEhD;MAAI,CAAC;IAC1E;GACDiD,kBAAkB,EAAE,MAAgC;KACnD,OAAOF,2CAAO,CAAC,kCAAkC,EAAE,EAAE,EAAE;OAAEG,IAAI,EAAE,WAAW;OAAEC,QAAQ,EAAE,WAAW;OAAEC,KAAK,EAAE;MAAkB,CAAC;IAC7H;GACDC,qBAAqB,EAAE,MAAyB;KAC/C,OAAON,2CAAO,CAAC,2CAA2C,CAAC;IAC3D;GACDO,aAAa,EAAE,MAAuB;KACrC,OAAOP,2CAAO,CAAC,yCAAyC,CAAC;IACzD;GACDQ,SAAS,EAAE,MAAuB;KACjC,OAAOR,2CAAO,CAAC,sCAAsC,CAAC;IACtD;GACDS,eAAe,EAAE,MAAqB;KACrC,OAAOC,4CAAQ,CAAC,uCAAuC,CAAC;IACxD;GACDC,gBAAgB,EAAE,CAACV,MAAc,EAAEb,QAAgB,KAAoB;KACtE,OAAOsB,4CAAQ,CAAC,0CAA0C,EAAE;OAC3DT,MAAM;OACNb,QAAQ;OACRhD,IAAI,EAAE;MACN,CAAC;IACF;GACDwE,WAAW,EAAE,CAACC,SAAiB,EAAEC,SAAiB,EAAEC,KAAa,KAAoB;KACpF,OAAOL,4CAAQ,CAAC,+CAA+C,EAAE;OAChET,MAAM,EAAEY,SAAS;OACjBC,SAAS;OACTC;MACA,CAAC;IACF;GACDhC;CACD,CAAC;;CCtDM,MAAMiC,eAAe,GAAG;GAC9BC,SAAS,EAAE,CAACC,WAAkC,EAAEC,kBAA4B,EAAEC,MAAc,EAAEC,GAAU,KAAW;KAClH,MAAMC,KAAK,GAAGC,wDAAa,EAAE;KAC7BD,KAAK,CAACE,MAAM,CAAC;OACZN,WAAW;OACXC,kBAAkB;OAClBC,MAAM;OACNK,cAAc,EAAEL,MAAM;OACtBM,YAAY,EAAEL;MACd,CAAC;IACF;GACDM,eAAe,EAAGC,YAAoB,IAAW;KAChD,MAAMN,KAAK,GAAGC,wDAAa,EAAE;KAC7BD,KAAK,CAACO,WAAW,GAAGD,YAAY;IAChC;GACDE,sBAAsB,EAAGV,MAAc,IAAW;KACjD,MAAME,KAAK,GAAGC,wDAAa,EAAE;KAC7BD,KAAK,CAACG,cAAc,GAAGL,MAAM;IAC7B;GACDW,wBAAwB,EAAGC,qBAA6B,IAAW;KAClE,MAAMV,KAAK,GAAGC,wDAAa,EAAE;KAC7B,MAAM;OAAEL,WAAW;OAAEC,kBAAkB;OAAEO;MAAc,GAAGJ,KAAK;KAC/D,MAAMW,mBAAmB,GAAGf,WAAW,CAAC1B,GAAG,CAACwC,qBAAqB,CAAC;KAClE,MAAM;OACL5C,QAAQ;OACRE,UAAU;OACVO,QAAQ,EAAEqC,0BAA0B,GAAG,EAAE;OACzCC,SAAS,EAAEC,4BAA4B;OACvCC,KAAK,EAAEC,uBAAuB;OAC9BC,SAAS,EAAEC,2BAA2B,GAAG;MACzC,GAAGP,mBAAmB;KACvB,MAAMQ,gBAAgB,GAAGvB,WAAW,CAAC1B,GAAG,CAACJ,QAAQ,CAAC;KAElD8C,0BAA0B,CAAC/C,OAAO,CAAEuD,OAAO,IAAK;OAC/C,MAAMC,UAAU,GAAGzB,WAAW,CAAC1B,GAAG,CAACkD,OAAO,CAAC;OAC3C,MAAME,SAAS,GAAGlB,YAAY,CAAClC,GAAG,CAACkD,OAAO,CAAC;OAC3CE,SAAS,CAACxD,QAAQ,GAAGA,QAAQ;OAC7BuD,UAAU,CAACvD,QAAQ,GAAGA,QAAQ;MAC9B,CAAC;KACF,IAAKgD,4BAA4B,GAAG,CAAC,IAAM9C,UAAU,KAAKuD,iDAAW,CAACF,UAAW,EACjF;OAAA;OACC,MAAMG,wBAAwB,GAAG,IAAIC,GAAG,CAAC,CACxC,GAAGN,gBAAgB,CAACJ,KAAK,EACzB,6BAAII,gBAAgB,CAACF,SAAS,oCAAI,EAAE,CAAC,CACrC,CAAClB,GAAG,CAAE2B,IAAI,IAAKA,IAAI,CAAC/F,EAAE,CAAC,CAAC;OACzB,MAAMgG,uBAAuB,GAAG,CAAC,GAAGX,uBAAuB,EAAE,GAAGE,2BAA2B,CAAC;OAC5F,MAAMU,YAAY,GAAGD,uBAAuB,CAAC/E,MAAM,CAAE8E,IAAI,IAAK;SAC7D,OAAO,CAACF,wBAAwB,CAACK,GAAG,CAACH,IAAI,CAAC/F,EAAE,CAAC;QAC7C,CAAC;OACF,KAAK,MAAM+F,IAAI,IAAIE,YAAY,EAC/B;SACCF,IAAI,CAACI,IAAI,GAAGC,+CAAW,CAACC,QAAQ;;OAEjCb,gBAAgB,CAACN,SAAS,IAAIe,YAAY,CAACK,MAAM;OACjDd,gBAAgB,CAACF,SAAS,GAAG,CAC5B,8BAAIE,gBAAgB,CAACF,SAAS,qCAAI,EAAE,CAAC,EACrC,GAAGW,YAAY,CACf;;KAGFT,gBAAgB,CAAC5C,QAAQ,GAAG,CAAC,GAAG4C,gBAAgB,CAAC5C,QAAQ,EAAE,GAAGqC,0BAA0B,CAAC;KACzF,IAAIf,kBAAkB,CAACqC,QAAQ,CAACxB,qBAAqB,CAAC,IAAK1C,UAAU,KAAKuD,iDAAW,CAACF,UAAW,EACjG;OACCrB,KAAK,CAACmC,uBAAuB,CAACzB,qBAAqB,EAAE5C,QAAQ,CAAC;;IAE/D;GACDsE,uBAAuB,EAAG1B,qBAA6B,IAAW;KACjE,MAAM;OAAEd;MAAa,GAAGK,wDAAa,EAAE;KACvC,MAAMU,mBAAmB,GAAGf,WAAW,CAAC1B,GAAG,CAACwC,qBAAqB,CAAC;KAClE,MAAM;OAAE5C;MAAU,GAAG6C,mBAAmB;KACxC,MAAMQ,gBAAgB,GAAGvB,WAAW,CAAC1B,GAAG,CAACJ,QAAQ,CAAC;KAClDqD,gBAAgB,CAAC5C,QAAQ,GAAG4C,gBAAgB,CAAC5C,QAAQ,CAAC3B,MAAM,CAAEwE,OAAO,IAAK;OACzE,OAAOA,OAAO,KAAKV,qBAAqB;MACxC,CAAC;KACF,OAAOC,mBAAmB,CAAC7C,QAAQ;KACnC8B,WAAW,CAACvB,GAAG,CAACqC,qBAAqB,EAAE;OAAE,GAAGC,mBAAmB;OAAE0B,YAAY,EAAEvE;MAAU,CAAC;IAC1F;GACDW,gBAAgB,EAAG6B,YAAoB,IAAW;KACjD,MAAM;OAAEV,WAAW;OAAEQ;MAAc,GAAGH,wDAAa,EAAE;KACrDL,WAAW,CAAC0C,MAAM,CAAChC,YAAY,CAAC;KAChCF,YAAY,CAACkC,MAAM,CAAChC,YAAY,CAAC;IACjC;GACDiC,UAAU,EAAGC,QAAkB,IAAW;KACzC,MAAM;OAAE7D,MAAM;OAAE,GAAG8D;MAAU,GAAGD,QAAQ;KACxC,MAAM;OAAE5C;MAAa,GAAGK,wDAAa,EAAE;KACvC,MAAMoB,UAAU,GAAGzB,WAAW,CAAC1B,GAAG,CAACS,MAAM,CAAC;KAC1C,IAAI0C,UAAU,CAACJ,SAAS,EACxB;OACCrB,WAAW,CAACvB,GAAG,CAACM,MAAM,EAAE;SACvB,GAAG0C,UAAU;SACbJ,SAAS,EAAE,CAAC,GAAGI,UAAU,CAACJ,SAAS,EAAE;WAAE,GAAGwB;UAAU,CAAC;SACrD5B,SAAS,EAAEQ,UAAU,CAACR,SAAS,GAAG;QAClC,CAAC;;IAEH;GACD6B,gBAAgB,EAAE,OAAOnD,SAAiB,EAAEoD,QAAgB,EAAEnD,SAAiB,EAAEC,KAAa,KAAuB;KACpH,MAAM;OAAEG;MAAa,GAAGK,wDAAa,EAAE;KACvC,MAAMoB,UAAU,GAAGzB,WAAW,CAAC1B,GAAG,CAACqB,SAAS,CAAC;KAC7C,MAAM;OAAEzB;MAAU,GAAGuD,UAAU;KAC/B,MAAMF,gBAAgB,GAAGvB,WAAW,CAAC1B,GAAG,CAACJ,QAAQ,CAAC;KAClD,MAAM;OAAES;MAAU,GAAG4C,gBAAgB;KACrC,MAAMyB,WAAW,GAAGrE,QAAQ,CAACsE,OAAO,CAACF,QAAQ,CAAC;KAC9C,MAAMG,WAAW,GAAGvE,QAAQ,CAAC3B,MAAM,CAAEwE,OAAO,IAAKA,OAAO,KAAK7B,SAAS,CAAC;KACvEuD,WAAW,CAACC,MAAM,CAACH,WAAW,EAAE,CAAC,EAAErD,SAAS,CAAC;KAC7CK,WAAW,CAACvB,GAAG,CAACP,QAAQ,EAAE;OAAE,GAAGqD,gBAAgB;OAAE5C,QAAQ,EAAEuE;MAAa,CAAC;KACzE,IACA;OACC,MAAMtE,QAAQ,CAACc,WAAW,CAACC,SAAS,EAAEC,SAAS,EAAEC,KAAK,CAAC;OAEvD,OAAO,IAAI;MACX,CACD,MACA;OACCG,WAAW,CAACvB,GAAG,CAACP,QAAQ,EAAE;SAAE,GAAGqD,gBAAgB;SAAE5C;QAAU,CAAC;OAE5D,OAAO,KAAK;;IAEb;GACDyE,mBAAmB,EAAGC,OAAsB,IAAW;KACtD,MAAM;OAAErD;MAAa,GAAGK,wDAAa,EAAE;KACvCgD,OAAO,CAACpF,OAAO,CAAEc,MAAM,IAAK;OAC3B,MAAM0C,UAAU,GAAGzB,WAAW,CAAC1B,GAAG,CAACS,MAAM,CAAC;OAC1CiB,WAAW,CAACvB,GAAG,CAACM,MAAM,EAAE;SAAE,GAAG0C,UAAU;SAAE6B,KAAK,EAAE,IAAI;SAAEC,QAAQ,EAAE;QAAM,CAAC;MACvE,CAAC;;CAEJ,CAAC;;CCzHD;AACA,CAAO,MAAMC,SAAS,GAAG;GACxBtI,IAAI,EAAE,YAAY;GAElBC,UAAU,EAAE;YACXsI;IACA;GAEDC,UAAU,EAAE;KACXC,KAAK,EAAE;OACNjI,OAAO,CAACkI,EAAE,EACV;SACCA,EAAE,CAACD,KAAK,EAAE;;;IAGZ;GAEDtI,KAAK,EAAE,CACN,QAAQ,CACR;GAEDC,IAAI,GACJ;KACC,OAAO;OACNuI,kBAAkB,EAAE,KAAK;OACzBC,aAAa,EAAE;MACf;IACD;GAEDrI,QAAQ,EAAE;KACTgD,GAAG,GACH;OACC,OAAOoD,sBAAG;MACV;KACD,GAAGkC,sBAAQ,CAAC1D,wDAAa,EAAE,CAAC,aAAa,CAAC;IAC1C;GAED2D,KAAK,EAAE;KACNhE,WAAW,EAAE;OACZiE,OAAO,GACP;SACC,IAAI,CAACC,YAAY,CAACC,OAAO,EAAE;QAC3B;OACDC,IAAI,EAAE;;IAEP;GAEDC,OAAO,GACP;KACC,IAAI,CAACH,YAAY,GAAG,IAAI,CAACI,eAAe,EAAE;IAC1C;GAEDnH,OAAO,EAAE;KACRlB,GAAG,CAACmB,UAAkB,EAAEC,YAAqC,GAAG,EAAE,EAClE;OACC,OAAO,IAAI,CAACC,OAAO,CAACC,GAAG,CAACC,UAAU,CAACJ,UAAU,EAAEC,YAAY,CAAC;MAC5D;KACDkH,aAAa,GACb;OACC,IAAI,IAAI,CAACT,aAAa,EACtB;SACC,IAAI,CAACA,aAAa,GAAG,KAAK;SAE1B;;OAGDU,qBAAiB,CAAC;SAAEvF,IAAI,EAAE,WAAW;SAAEC,QAAQ,EAAE,WAAW;SAAEC,KAAK,EAAE;QAAU,CAAC;OAEhF,IAAI,CAAC2E,aAAa,GAAG,IAAI;MACzB;KACDW,aAAa,GACb;OACC,IAAI,CAACX,aAAa,GAAG,KAAK;MAC1B;KACDQ,eAAe,GACf;OACC,MAAMI,MAAM,GAAG,IAAIC,wBAAM,CAAC;SACzBC,KAAK,EAAE,GAAG;SACVC,MAAM,EAAE,GAAG;SACXC,QAAQ,EAAE,KAAK;SACfC,QAAQ,EAAE,CACT;WACChJ,EAAE,EAAE,MAAM;WACViJ,YAAY,EAAE,CACb;aAAE9J,IAAI,EAAE,YAAY;aAAE+J,IAAI,EAAE,QAAQ;aAAEC,MAAM,EAAE,IAAI;aAAEC,UAAU,EAAE;YAAM,EACtE;aAAEjK,IAAI,EAAE,UAAU;aAAE+J,IAAI,EAAE;YAAU,CACpC;WACDG,OAAO,EAAE;aACRC,iBAAiB,EAAE,IAAI;aACvBC,UAAU,EAAE,KAAK;aACjBC,kBAAkB,EAAE;;UAErB,EACD;WACCxJ,EAAE,EAAE,gBAAgB;WACpBqJ,OAAO,EAAE;aACRI,UAAU,EAAE,iBAAiB;aAC7BC,eAAe,EAAE,IAAI;aACrBC,UAAU,EAAE,MAAM;aAClBC,QAAQ,EAAE,IAAI;aACdC,uBAAuB,EAAE,CAAC,YAAY,EAAE,MAAM;;UAE/C,CACD;SACDC,gBAAgB,EAAE;WACjB9J,EAAE,EAAE,SAAS;WACbP,OAAO,EAAE;UACT;SACDsK,YAAY,EAAE,IAAI;SAClBC,YAAY,EAAE,KAAK;SACnBC,cAAc,EAAE,KAAK;SACrBC,OAAO,EAAE,cAAc;SACvBjN,MAAM,EAAE;WACP,eAAe,EAAGmG,KAAgC,IAAK;aACtD,MAAMlC,IAAI,GAAGkC,KAAK,CAACL,OAAO,EAAE,CAAC7B,IAAI;aAEjC,IAAIA,IAAI,CAACmB,UAAU,KAAK,UAAU,EAClC;eACC,IAAI,CAACX,KAAK,CAAC,QAAQ,EAAER,IAAI,CAACiJ,UAAU,CAAC5H,GAAG,CAAC,QAAQ,CAAC,CAAC;eACnDwB,eAAe,CAACc,sBAAsB,CAAC3D,IAAI,CAAClB,EAAE,CAAC;eAC/C2I,MAAM,CAACyB,iBAAiB,CAACC,IAAI,CAACnJ,IAAI,CAAC;eACnCyH,MAAM,CAAC2B,eAAe,EAAE;eAExB;;aAGD3B,MAAM,CAACyB,iBAAiB,CAACC,IAAI,CAACnJ,IAAI,CAAC;aACnCyH,MAAM,CAAC2B,eAAe,EAAE;aAExB,IAAI,CAAC5I,KAAK,CAAC,QAAQ,EAAER,IAAI,CAAClB,EAAE,CAAC;YAC7B;WACDuK,MAAM,EAAGnH,KAAK,IAAK;aAAA;aAClB,yBAAAA,KAAK,CAACoH,MAAM,CAACC,KAAK,CAAClI,GAAG,CAAC,MAAM,CAAC,qBAA9B,sBAAgCL,OAAO,CAAEhB,IAAI,IAAK;eACjD,IAAI,CAACA,IAAI,CAACwJ,WAAW,EAAE,EACvB;iBACCxJ,IAAI,CAACyJ,WAAW,CAACzJ,IAAI,CAACiJ,UAAU,CAAC5H,GAAG,CAAC,UAAU,CAAC,CAAC;;cAElD,CAAC;YACF;WACD,kBAAkB,EAAGa,KAAK,IAAK;aAAA;aAC9B,0BAAAA,KAAK,CAACoH,MAAM,CAACC,KAAK,CAAClI,GAAG,CAAC,MAAM,CAAC,qBAA9B,uBAAgCL,OAAO,CAAEhB,IAAI,IAAK;eACjD,IAAI,CAACA,IAAI,CAACwJ,WAAW,EAAE,EACvB;iBACCxJ,IAAI,CAACyJ,WAAW,CAACzJ,IAAI,CAACiJ,UAAU,CAAC5H,GAAG,CAAC,UAAU,CAAC,CAAC;;cAElD,CAAC;YACF;WACDqI,SAAS,EAAE,MAAM;aAChB,IAAI,CAACzC,YAAY,GAAG,IAAI,CAACI,eAAe,EAAE;;;QAG5C,CAAC;OAEF,MAAMsC,eAAe,GAAGlC,MAAM,CAACmC,YAAY,EAAE;OAC7CC,aAAG,CAACC,IAAI,CAACH,eAAe,EAAE,cAAc,EAAE,mDAAmD,CAAC;OAE9F,OAAOlC,MAAM;MACb;KAEDsC,OAAO,GACP;OACC,IAAI,IAAI,CAACC,KAAK,CAACC,UAAU,EACzB;SACC,IAAI,CAAChD,YAAY,CAACiD,aAAa,CAAC,IAAI,CAACF,KAAK,CAACC,UAAU,CAAC;SACtD,IAAI,CAAC,IAAI,CAAChD,YAAY,CAACkD,MAAM,EAAE,EAC/B;WACC,IAAI,CAAClD,YAAY,CAACmD,IAAI,EAAE;;SAEzBC,eAAK,CAACC,IAAI,CAACC,MAAM,EAAE,WAAW,EAAE,IAAI,CAACC,kBAAkB,CAAC;;MAEzD;KACDA,kBAAkB,CAACtI,KAAK,EACxB;OACC,IAAI,IAAI,CAAC8H,KAAK,CAACC,UAAU,IACrB,CAAC,IAAI,CAACD,KAAK,CAACC,UAAU,CAACQ,aAAa,CAACC,QAAQ,CAACxI,KAAK,CAACoH,MAAM,CAAC,IAAI,CAAC,IAAI,CAACrC,YAAY,CAACkD,MAAM,EAAE,EAC9F;SACC,IAAI,CAACQ,WAAW,EAAE;SAClB,IAAI,CAACnD,aAAa,EAAE;SACpB6C,eAAK,CAACO,MAAM,CAACL,MAAM,EAAE,WAAW,EAAE,IAAI,CAACC,kBAAkB,CAAC;;MAE3D;KACDK,MAAM,CAACC,KAAa,EACpB;OACC,IAAI,CAAC,IAAI,CAAC7D,YAAY,CAACkD,MAAM,EAAE,EAC/B;SACC,IAAI,CAAClD,YAAY,CAACmD,IAAI,EAAE;;OAGzB,IAAI,CAACnD,YAAY,CAAC4D,MAAM,CAACC,KAAK,CAAC;MAC/B;KACDH,WAAW,GACX;OACC,IAAI,CAAC1D,YAAY,CAAC8D,YAAY,EAAE,CAACC,YAAY,EAAE;OAC/C,IAAI,CAAC/D,YAAY,CAACgE,SAAS,CAAC,SAAS,CAAC;OAEtC,IAAI,IAAI,CAACjB,KAAK,CAACC,UAAU,EACzB;SACC,IAAI,CAACD,KAAK,CAACC,UAAU,CAACa,KAAK,GAAG,EAAE;SAChC,IAAI,CAACd,KAAK,CAACC,UAAU,CAACvD,KAAK,EAAE;;;IAG/B;GAED/F,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CA2CZ,CAAC;;CCzPD,MAAM9C,YAAU,GAAG7B,MAAM,CAACC,MAAM,CAAC;GAChCiP,YAAY,EAAE,eAAe;GAC7BC,gBAAgB,EAAE;CACnB,CAAC,CAAC;;CAEF;AACA,CAAO,MAAMC,gBAAgB,GAAG;GAC/BnN,IAAI,EAAE,kBAAkB;GAExBC,UAAU,EAAE;sBACXC;IACA;GAEDE,IAAI,GACJ;KACC,OAAO;OACNC,UAAU,EAAE;SACXC,OAAO,EAAE;;MAEV;IACD;GAEDE,OAAO,GACP;KACC,MAAMC,iBAAiB,GAAGC,mEAAiB,CAACC,WAAW,EAAE;KACzD,MAAME,EAAE,GAAGJ,iBAAiB,CAACuB,qBAAqB,CAACP,mEAAiB,CAAC2L,UAAU,CAAC,GAC7ExN,YAAU,CAACqN,YAAY,GACvBrN,YAAU,CAACsN,gBAAgB;KAG9B,IAAI,CAACtM,aAAa,GAAG,CACpB;OACCC,EAAE;OACFC,KAAK,EAAE,IAAI,CAACC,GAAG,CAAC,oDAAoD,CAAC;OACrEC,WAAW,EAAE,IAAI,CAACD,GAAG,CAAC,mEAAmE,CAAC;OAC1FE,KAAK,EAAE;SACNjB,IAAI,EAAEkB,wBAAI,CAACmM,SAAS;SACpBjM,IAAI,EAAE,EAAE;SACRC,KAAK,EAAEC,kDAAY,CAAC,eAAe;QACnC;OACDgM,UAAU,EAAE,gDAAgD;OAC5D/L,UAAU,EAAEd,iBAAiB,CAACuB,qBAAqB,CAACP,mEAAiB,CAAC2L,UAAU,CAAC,IAC7E3M,iBAAiB,CAACuB,qBAAqB,CAACP,mEAAiB,CAAC8L,cAAc;MAE5E,CACD;IACD;GAEDtL,OAAO,EAAE;KACRlB,GAAG,CAACmB,UAAkB,EAAEC,YAAqC,GAAG,EAAE,EAClE;OACC,OAAO,IAAI,CAACC,OAAO,CAACC,GAAG,CAACC,UAAU,CAACJ,UAAU,EAAEC,YAAY,CAAC;MAC5D;KAEDK,0BAA0B,CAACC,QAAgB,EAC3C;OACC,IAAIA,QAAQ,KAAK7C,YAAU,CAACqN,YAAY,EACxC;SACC3D,qBAAiB,CAAC;WAAEvF,IAAI,EAAE,WAAW;WAAEC,QAAQ,EAAE,WAAW;WAAEC,KAAK,EAAE;UAAc,CAAC;SAEpFuJ,EAAE,CAACC,SAAS,CAACC,QAAQ,CAACC,IAAI,CAAC,wBAAwB,EAAE;WAAEC,UAAU,EAAE;UAAM,CAAC;;OAG3E,IAAInL,QAAQ,KAAK7C,YAAU,CAACsN,gBAAgB,EAC5C;SACC5D,qBAAiB,CAAC;WAAEvF,IAAI,EAAE,WAAW;WAAEC,QAAQ,EAAE,WAAW;WAAEC,KAAK,EAAE;UAAc,CAAC;SAEpFuJ,EAAE,CAACC,SAAS,CAACC,QAAQ,CAACC,IAAI,CAAC,sCAAsC,EAAE;WAAEC,UAAU,EAAE;UAAM,CAAC;;;IAG1F;GAEDlL,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;CA2BZ,CAAC;;CC9FM,MAAMmL,UAAU,GAAG;GACzB5N,UAAU,EAAE;KACXF,SAAS;KACToN,gBAAgB;KAChB7E,SAAS;YACTC,wBAAK;UACL5B;IACA;GAEDvG,IAAI,GACJ;KACC,OAAO;OACNuI,kBAAkB,EAAE,KAAK;OACzBmF,UAAU,EAAE,KAAK;OACjBC,iBAAiB,EAAE,KAAK;OACxBC,SAAS,EAAE;MACX;IACD;GAED7E,OAAO,GACP;KACC,IAAI,CAAC8E,kBAAkB,GAAGC,QAAQ,CAACC,cAAc,CAAC,eAAe,CAAC;IAClE;GAED3N,OAAO,GACP;KACC,IACA;OACC,MAAMC,iBAAiB,GAAGC,mEAAiB,CAACC,WAAW,EAAE;OACzD,IAAI,CAACgI,kBAAkB,GAAGlI,iBAAiB,KACtCA,iBAAiB,CAACuB,qBAAqB,CAACP,mEAAiB,CAAC2L,UAAU,CAAC,IACtE3M,iBAAiB,CAACuB,qBAAqB,CAACP,mEAAiB,CAAC8L,cAAc,CAAC,CAC3E;OACF,IAAI,CAACO,UAAU,GAAGrN,iBAAiB,KAEjCA,iBAAiB,CAACuB,qBAAqB,CAACP,mEAAiB,CAACC,gBAAgB,CAAC,IACxEjB,iBAAiB,CAACuB,qBAAqB,CAACP,mEAAiB,CAAC2M,UAAU,CAAC,CACxE;MACF,CACD,OAAOC,KAAK,EACZ;OACCC,OAAO,CAACD,KAAK,CAAC,uBAAuB,EAAEA,KAAK,CAAC;;KAG9C,MAAME,QAAQ,GAAG,IAAIC,gBAAgB,CAAC,MAAM;OAC3C,IAAI,CAACT,iBAAiB,GAAGnC,aAAG,CAAC6C,QAAQ,CAAC,IAAI,CAACR,kBAAkB,EAAE,wBAAwB,CAAC;MACxF,CAAC;KAEFM,QAAQ,CAACG,OAAO,CAAC,IAAI,CAACT,kBAAkB,EAAE;OAAEU,UAAU,EAAE,IAAI;OAAEC,eAAe,EAAE,CAAC,OAAO;MAAG,CAAC;KAE3F,IAAI,CAACb,iBAAiB,GAAGnC,aAAG,CAAC6C,QAAQ,CAAC,IAAI,CAACR,kBAAkB,EAAE,wBAAwB,CAAC;IACxF;GAEDjO,IAAI,EAAE,aAAa;GAEnBG,KAAK,EAAE,CAAC,YAAY,CAAC;GAErBI,QAAQ,EAAE;KACTgD,GAAG,GACH;OACC,OAAOoD,sBAAG;MACV;KACDkI,eAAe,GACf;OACC,IAAI,IAAI,CAACC,aAAa,EACtB;SACC,OAAO,IAAI;;OAGZ,IAAI,IAAI,CAACd,SAAS,IAAI,IAAI,CAACD,iBAAiB,EAC5C;SACC,OAAO,IAAI,CAACxK,GAAG,CAACwL,UAAU;;OAG3B,OAAO,IAAI,CAACxL,GAAG,CAACyL,UAAU;MAC1B;KACDF,aAAa,GACb;OACC,OAAOtB,EAAE,CAACyB,UAAU,CAACC,QAAQ,CAAC,mCAAmC,CAAC,KAAK,IAAI;MAC3E;KACDC,gBAAgB,GAChB;OACC,IAAI,CAAC,IAAI,CAACL,aAAa,EACvB;SACC,OAAO,kCAAkC;;OAG1C,OAAO,IAAI,CAACf,iBAAiB,GAAG,mCAAmC,GAAG,iCAAiC;;IAExG;GAED9L,OAAO,EAAE;KACRlB,GAAG,CAACmB,UAAkB,EAAEC,YAAqC,GAAG,EAAE,EAClE;OACC,OAAO,IAAI,CAACC,OAAO,CAACC,GAAG,CAACC,UAAU,CAACJ,UAAU,EAAEC,YAAY,CAAC;MAC5D;KACDtC,aAAa,GACb;OACC,IAAI,CAAC0C,KAAK,CAAC,YAAY,EAAE;SAAE6M,MAAM,EAAEC,uDAAmB,CAACC;QAAQ,CAAC;MAChE;KACDC,QAAQ,CAAC1L,MAAc,EACvB;OACC2L,6BAAY,CAACC,IAAI,CAAC3R,+CAAM,CAACiB,iCAAiC,EAAE;SAAE8E;QAAQ,CAAC;MACvE;KACD6L,mBAAmB,GACnB;OACC,IAAI,CAACzB,kBAAkB,CAAC0B,KAAK,EAAE;OAE/BC,kBAAE,CAACC,YAAY,CAACC,MAAM,CAACC,MAAM,CAAC;SAC7BC,OAAO,EAAE,IAAI,CAACjC,iBAAiB,GAC5B,IAAI,CAAChN,GAAG,CAAC,qDAAqD,CAAC,GAC/D,IAAI,CAACA,GAAG,CAAC,kDAAkD,CAAC;SAC/DkP,aAAa,EAAE;QACf,CAAC;;IAEH;GAEDvN,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;CAuBZ,CAAC;;CCtJM,MAAMwN,aAAa,GAAG;GAC5BC,iBAAiB,EAAE,CAACtP,EAAU,EAAEuP,IAAY,EAAEC,YAAoB,KAAK;KACtE,OAAOzM,2CAAO,CAAC,wDAAwD,EAAE;OAAEC,MAAM,EAAEhD,EAAE;OAAEuP,IAAI;OAAEC;MAAc,CAAC;IAC5G;GACDC,wBAAwB,EAAE,CAACzM,MAAc,EAAEmB,MAAc,KAAoB;KAC5E,OAAOV,4CAAQ,CAAC,qDAAqD,EAAE;OACtET,MAAM;OACNmB;MACA,CAAC;IACF;GACDuL,oBAAoB,EAAE,CAAC1M,MAAc,EAAEmB,MAAc,EAAEwL,YAAoB,EAAExJ,IAAY,KAAoB;KAC5G,OAAO1C,4CAAQ,CAAC,mDAAmD,EAAE;OACpET,MAAM;OACNmB,MAAM;OACNwL,YAAY;OACZC,SAAS,EAAEzJ;MACX,CAAC;IACF;GACD0J,2BAA2B,EAAG1L,MAAc,IAAoB;KAC/D,OAAOpB,2CAAO,CAAC,qDAAqD,EAAE;OACrEoB;MACA,CAAC;IACF;GACD2L,WAAW,EAAE,CAAC9M,MAAc,EAAEmB,MAAc,KAAoB;KAC/D,OAAOpB,2CAAO,CAAC,6CAA6C,EAAE;OAC7DC,MAAM;OACNmB;MACA,CAAC;IACF;GACD4L,QAAQ,EAAG5L,MAAc,IAAoB;KAC5C,OAAOV,4CAAQ,CAAC,oBAAoB,EAAE;OACrCU;MACA,CAAC;IACF;GACD6L,iBAAiB,EAAE,CAAChN,MAAc,EAAEiN,KAAa,KAAoB;KACpE,OAAOlN,2CAAO,CAAC,+CAA+C,EAAE;OAC/DC,MAAM;OACNiN;MACA,CAAC;IACF;GACDC,mBAAmB,EAAGlN,MAAc,IAAgC;KACnE,OAAOD,2CAAO,CAAC,uDAAuD,EAAE;OACvEC;MACA,CAAC;IACF;GACDmN,SAAS,EAAE,CACVnN,MAAc,EACdoN,GAAmF,GAAG,EAAE,EACxFC,SAAqE,GAAG,EAAE,EAC1ElO,QAAiB,GAAG,IAAI,KACJ;KACpB,OAAOsB,4CAAQ,CAAC,4DAA4D,EAAE;OAC7ET,MAAM;OACNoN,GAAG;OACHC,SAAS;OACTlO;MACA,CAAC;;CAEJ,CAAC;;CCvDD,MAAMmO,4BAA4B,GAAIC,WAA0B,IAAK;GACpE,MAAMlM,KAAK,GAAGC,wDAAa,EAAE;GAC7B,MAAMkM,KAAK,GAAG,CAAC,GAAGD,WAAW,CAAC;GAC9B,MAAME,OAAO,GAAG,IAAI3K,GAAG,EAAE;GACzB,MAAM4K,aAAa,GAAG,KAAK;GAC3B,IAAIC,UAAU,GAAG,CAAC;GAElB,OAAOH,KAAK,CAAClK,MAAM,GAAG,CAAC,IAAIqK,UAAU,GAAGD,aAAa,EACrD;KACCC,UAAU,EAAE;KACZ,MAAMlL,OAAO,GAAG+K,KAAK,CAACI,KAAK,EAAE;KAE7B,IAAIH,OAAO,CAACvK,GAAG,CAACT,OAAO,CAAC,EACxB;OACC;;KAEDgL,OAAO,CAACI,GAAG,CAACpL,OAAO,CAAC;KAEpB,MAAMqL,eAAe,GAAGzM,KAAK,CAACJ,WAAW,CAAC1B,GAAG,CAACkD,OAAO,CAAC;KACtD,IAAI,CAACqL,eAAe,EACpB;OACC;;KAGDA,eAAe,CAACC,aAAa,GAAG,IAAI;KACpCD,eAAe,CAACE,gBAAgB,GAAG,IAAI;KAEvC,IAAIF,eAAe,CAAClO,QAAQ,IAAIkO,eAAe,CAAClO,QAAQ,CAAC0D,MAAM,GAAG,CAAC,EACnE;OACCkK,KAAK,CAACnG,IAAI,CAAC,GAAGyG,eAAe,CAAClO,QAAQ,CAAC;;;CAG1C,CAAC;AAED,CAAO,MAAMqO,wBAAwB,GAAG;GACvCvB,oBAAoB,EAAE,CAAC/K,YAAY,EAAER,MAAM,EAAE+M,kBAAkB,EAAE/K,IAAI,KAAW;KAAA;KAC/E,MAAM9B,KAAK,GAAGC,wDAAa,EAAE;KAC7B,MAAMoB,UAAU,GAAGrB,KAAK,CAACJ,WAAW,CAAC1B,GAAG,CAACoC,YAAY,CAAC;KACtD,MAAMwM,gBAAgB,GAAG9M,KAAK,CAACJ,WAAW,CAAC1B,GAAG,CAAC2O,kBAAkB,CAAC;KAElE,IAAI,CAACxL,UAAU,IAAI,CAACyL,gBAAgB,EACpC;OACC;;KAGD,MAAMC,cAAc,GAAGC,kDAAc,CAAC3L,UAAU,CAACrD,UAAU,CAAC;KAC5D,MAAMiP,iBAAiB,GAAGD,kDAAc,CAACF,gBAAgB,CAAC9O,UAAU,CAAC;KACrE,MAAM0D,IAAI,GAAGI,IAAI,KAAKiL,cAAc,CAAC/K,QAAQ,4BAC1CX,UAAU,CAACJ,SAAS,qBAApB,sBAAsBiM,IAAI,CAAElL,QAAQ,IAAKA,QAAQ,CAACrG,EAAE,KAAKmE,MAAM,CAAC,GAChEuB,UAAU,CAACN,KAAK,CAACmM,IAAI,CAAEC,IAAI,IAAKA,IAAI,CAACxR,EAAE,KAAKmE,MAAM,CAAC;KAEtD,IAAI,CAAC4B,IAAI,EACT;OACC;;KAGDL,UAAU,CAACR,SAAS,IAAI,CAAC;KACzB,IAAIiB,IAAI,KAAKiL,cAAc,CAAC/K,QAAQ,EACpC;OACCX,UAAU,CAACJ,SAAS,GAAGI,UAAU,CAACJ,SAAS,CAACrE,MAAM,CAAEoF,QAAQ,IAAKA,QAAQ,CAACrG,EAAE,KAAKmE,MAAM,CAAC;MACxF,MAED;OACCuB,UAAU,CAACN,KAAK,GAAGM,UAAU,CAACN,KAAK,CAACnE,MAAM,CAAEuQ,IAAI,IAAKA,IAAI,CAACxR,EAAE,KAAKmE,MAAM,CAAC;;KAGzEgN,gBAAgB,CAACjM,SAAS,IAAI,CAAC;KAC/B,IAAIf,MAAM,KAAKE,KAAK,CAACF,MAAM,EAC3B;OACCE,KAAK,CAACmC,uBAAuB,CAAC7B,YAAY,EAAEuM,kBAAkB,CAAC;;KAGhEnL,IAAI,CAACI,IAAI,GAAGmL,iBAAiB,CAACjL,QAAQ;KACtC,IAAI,CAAC8K,gBAAgB,CAAC7L,SAAS,EAC/B;OACC;;KAED6L,gBAAgB,CAAC7L,SAAS,CAAC+E,IAAI,CAACtE,IAAI,CAAC;IACrC;GACD0J,wBAAwB,EAAE,CAAC9K,YAAY,EAAER,MAAM,EAAEgC,IAAI,KAAW;KAC/D,MAAM9B,KAAK,GAAGC,wDAAa,EAAE;KAC7B,MAAMoB,UAAU,GAAGrB,KAAK,CAACJ,WAAW,CAAC1B,GAAG,CAACoC,YAAY,CAAC;KACtD,MAAMyM,cAAc,GAAGC,kDAAc,CAAC3L,UAAU,CAACrD,UAAU,CAAC;KAC5D,IAAI,CAACqD,UAAU,EACf;OACC;;KAGD,IAAIvB,MAAM,KAAKE,KAAK,CAACF,MAAM,EAC3B;OACCE,KAAK,CAACmC,uBAAuB,CAAC7B,YAAY,CAAC;;KAG5Ce,UAAU,CAACR,SAAS,IAAI,CAAC;KACzB,IAAIiB,IAAI,KAAKiL,cAAc,CAAC/K,QAAQ,EACpC;OACCX,UAAU,CAACJ,SAAS,GAAGI,UAAU,CAACJ,SAAS,CAACrE,MAAM,CAAEoF,QAAQ,IAAKA,QAAQ,CAACrG,EAAE,KAAKmE,MAAM,CAAC;OAExF;;KAGDuB,UAAU,CAACN,KAAK,GAAGM,UAAU,CAACN,KAAK,CAACnE,MAAM,CAAEuQ,IAAI,IAAKA,IAAI,CAACxR,EAAE,KAAKmE,MAAM,CAAC;IACxE;GACDsN,eAAe,EAAE,CAAC9M,YAAoB,EAAEW,SAAgB,KAAW;KAClE,MAAM;OAAErB;MAAa,GAAGK,wDAAa,EAAE;KACvC,MAAMoB,UAAU,GAAGzB,WAAW,CAAC1B,GAAG,CAACoC,YAAY,CAAC;KAEhD,IAAI,CAACe,UAAU,EACf;OACC;;KAGDzB,WAAW,CAACvB,GAAG,CAACiC,YAAY,EAAE;OAAE,GAAGe,UAAU;OAAEJ;MAAW,CAAC;IAC3D;GACDoM,WAAW,EAAE,CAAC/M,YAAoB,EAAES,KAAY,KAAW;KAC1D,MAAM;OAAEnB;MAAa,GAAGK,wDAAa,EAAE;KACvC,MAAMoB,UAAU,GAAGzB,WAAW,CAAC1B,GAAG,CAACoC,YAAY,CAAC;KAEhD,IAAI,CAACe,UAAU,EACf;OACC;;KAGDzB,WAAW,CAACvB,GAAG,CAACiC,YAAY,EAAE;OAAE,GAAGe,UAAU;OAAEN;MAAO,CAAC;IACvD;GACDuM,yBAAyB,EAAE,CAC1BhN,YAAoB,EACpB0E,OAA+E,KACrE;KACV,MAAM;OAAEpF;MAAa,GAAGK,wDAAa,EAAE;KACvC,MAAMoB,UAAU,GAAGzB,WAAW,CAAC1B,GAAG,CAACoC,YAAY,CAAC;KAEhD,IAAI,CAACe,UAAU,EACf;OACC;;KAGDA,UAAU,CAACkM,mBAAmB,GAAG;OAChC,GAAGlM,UAAU,CAACkM,mBAAmB;OACjC,GAAGvI;MACH;KAEDpF,WAAW,CAACvB,GAAG,CAACiC,YAAY,EAAEe,UAAU,CAAC;IACzC;GACDmM,mBAAmB,EAAE,CACpB7O,MAAc,EACduE,KAAmC,EACnCC,QAAsC,EACtCsK,aAAqB,GAAG,CAAC,EACzBC,gBAAwB,GAAG,CAAC,KAClB;KACV,MAAM1N,KAAK,GAAGC,wDAAa,EAAE;KAC7B,MAAMoB,UAAU,GAAGrB,KAAK,CAACJ,WAAW,CAAC1B,GAAG,CAACS,MAAM,CAAC;KAChD,IAAI,CAAC0C,UAAU,EACf;OACC;;KAGDA,UAAU,CAACsL,gBAAgB,GAAGxJ,QAAQ;KACtC9B,UAAU,CAACqL,aAAa,GAAGxJ,KAAK;KAChC7B,UAAU,CAACqM,gBAAgB,GAAGA,gBAAgB;KAC9CrM,UAAU,CAACoM,aAAa,GAAGA,aAAa;KACxCpM,UAAU,CAACsM,oBAAoB,GAAGzK,KAAK,CAACjB,MAAM,GAAGkB,QAAQ,CAAClB,MAAM,GAAGwL,aAAa,GAAGC,gBAAgB;IACnG;GACDE,4BAA4B,EAAE,MAAO9N,MAAM,IAAoB;KAC9D,MAAME,KAAK,GAAGC,wDAAa,EAAE;KAC7B,MAAML,WAAW,GAAGI,KAAK,CAACJ,WAAW;KACrC,MAAMiO,mBAAmB,GAAG,EAAE;KAE9B,KAAK,MAAM,CAACC,GAAG,EAAEzM,UAAU,CAAC,IAAIzB,WAAW,EAC3C;OACC,IAEE,OAAO,IAAIyB,UAAU,IAClB0M,cAAI,CAACC,OAAO,CAAC3M,UAAU,CAACN,KAAK,CAAC,IAC9BM,UAAU,CAACN,KAAK,CAACkN,IAAI,CAAEjM,QAAQ,IAAKA,QAAQ,CAACrG,EAAE,KAAKmE,MAAM,CAAC,IAG9D,WAAW,IAAIuB,UAAU,IACtB0M,cAAI,CAACC,OAAO,CAAC3M,UAAU,CAACJ,SAAS,CAAC,IAClCI,UAAU,CAACJ,SAAS,CAACgN,IAAI,CAAEjM,QAAQ,IAAKA,QAAQ,CAACrG,EAAE,KAAKmE,MAAM,CACjE,EAEF;SACC+N,mBAAmB,CAAC7H,IAAI,CAAC8H,GAAG,CAAC;;;KAI/B,OAAO9N,KAAK,CAACkO,kBAAkB,CAACL,mBAAmB,CAAC;IACpD;GACDM,kBAAkB,EAAE,CAACxP,MAAc,EAAEyP,MAAc,KAAW;KAC7D,MAAMpO,KAAK,GAAGC,wDAAa,EAAE;KAC7B,MAAMoB,UAAU,GAAGrB,KAAK,CAACJ,WAAW,CAAC1B,GAAG,CAACS,MAAM,CAAC;KAChD,IAAI,CAAC0C,UAAU,EACf;OACC;;KAGDA,UAAU,CAACsL,gBAAgB,GAAGtL,UAAU,CAACsL,gBAAgB,CAAC/P,MAAM,CAAEyR,IAAI,IAAKA,IAAI,CAAC1S,EAAE,KAAKyS,MAAM,CAAC;KAC9F/M,UAAU,CAACqL,aAAa,GAAGrL,UAAU,CAACqL,aAAa,CAAC9P,MAAM,CAAEyR,IAAI,IAAKA,IAAI,CAAC1S,EAAE,KAAKyS,MAAM,CAAC;KACxF/M,UAAU,CAACsM,oBAAoB,EAAE;IACjC;GACDW,0BAA0B,EAAGC,YAAoB,IAAW;KAC3D,MAAMvO,KAAK,GAAGC,wDAAa,EAAE;KAC7B,MAAMkB,gBAAgB,GAAGnB,KAAK,CAACJ,WAAW,CAAC1B,GAAG,CAACqQ,YAAY,CAAC;KAE5D,IAAI,CAACpN,gBAAgB,IAAI,CAACA,gBAAgB,CAAC5C,QAAQ,EACnD;OACC;;KAGD0N,4BAA4B,CAAC9K,gBAAgB,CAAC5C,QAAQ,CAAC;;CAEzD,CAAC;;CCxNM,MAAMiQ,2BAA2B,GAAG;GAC1CC,iBAAiB,EAAG9P,MAAc,IAAa;KAC9C,MAAM;OAAEiB;MAAa,GAAGK,wDAAa,EAAE;KACvC,MAAM6M,gBAAgB,GAAGlN,WAAW,CAAC1B,GAAG,CAACS,MAAM,CAAC;KAChD,IAAI,CAACmO,gBAAgB,EACrB;OACC,OAAO,EAAE;;KAGV,OAAOA,gBAAgB,CAAChS,IAAI;IAC5B;GACD4T,qBAAqB,EAAE,CACtB/P,MAAc,EACdgQ,KAAY,EACZ9N,SAAiB,EACjB+N,oBAA8B,KACpB;KAAA;KACV,MAAM5O,KAAK,GAAGC,wDAAa,EAAE;KAC7B,MAAM6M,gBAAgB,GAAG9M,KAAK,CAACJ,WAAW,CAAC1B,GAAG,CAACS,MAAM,CAAC;KACtD,IAAI,CAACmO,gBAAgB,EACrB;OACC;;KAGD,MAAM+B,gBAAgB,GAAG,IAAIpN,GAAG,CAACkN,KAAK,CAAC5O,GAAG,CAAE2B,IAAI,IAAKA,IAAI,CAAC/F,EAAE,CAAC,CAAC;KAC9D,MAAMsF,SAAS,GAAG,0BAAC6L,gBAAgB,CAAC7L,SAAS,oCAAI,EAAE,EAAErE,MAAM,CAAE8E,IAAI,IAAK,CAACmN,gBAAgB,CAAChN,GAAG,CAACH,IAAI,CAAC/F,EAAE,CAAC,CAAC;KACrG,MAAMmT,YAAY,GAAG,IAAIrN,GAAG,CAACqL,gBAAgB,CAAC/L,KAAK,CAAChB,GAAG,CAAEoN,IAAI,IAAKA,IAAI,CAACxR,EAAE,CAAC,CAAC;KAC3E,MAAMoT,QAAQ,GAAGJ,KAAK,CAAC/R,MAAM,CAAE8E,IAAI,IAAK,CAACoN,YAAY,CAACjN,GAAG,CAACH,IAAI,CAAC/F,EAAE,CAAC,CAAC;KACnEsF,SAAS,CAAC+E,IAAI,CAAC,GAAG+I,QAAQ,CAAC;KAC3BjC,gBAAgB,CAAC7L,SAAS,GAAGA,SAAS;KACtC6L,gBAAgB,CAACjM,SAAS,GAAGA,SAAS;KAEtC,IAAI+N,oBAAoB,CAAC3M,MAAM,GAAG,CAAC,EACnC;OACC,KAAKjC,KAAK,CAACkO,kBAAkB,CAACU,oBAAoB,CAAC;;IAEpD;GACDI,oBAAoB,EAAE,CACrBrQ,MAAc,EACdgQ,KAAY,EACZ9N,SAAiB,EACjBiB,IAAY,KACF;KAAA;KACV,MAAM9B,KAAK,GAAGC,wDAAa,EAAE;KAC7B,MAAM6M,gBAAgB,GAAG9M,KAAK,CAACJ,WAAW,CAAC1B,GAAG,CAACS,MAAM,CAAC;KACtD,IAAI,CAACmO,gBAAgB,EACrB;OACC;;KAED,MAAM/K,WAAW,GAAGiL,kDAAc,CAACF,gBAAgB,CAAC9O,UAAU,CAAC;KAE/D,MAAM6Q,gBAAgB,GAAG,IAAIpN,GAAG,CAACkN,KAAK,CAAC5O,GAAG,CAAE2B,IAAI,IAAKA,IAAI,CAAC/F,EAAE,CAAC,CAAC;KAC9D,IAAIkT,gBAAgB,CAAChN,GAAG,CAAC7B,KAAK,CAACF,MAAM,CAAC,EACtC;OACCE,KAAK,CAACmC,uBAAuB,CAAC,CAAC,EAAE2K,gBAAgB,CAACnR,EAAE,CAAC;;KAEtD,MAAMoF,KAAK,GAAG,0BAAC+L,gBAAgB,CAAC/L,KAAK,oCAAI,EAAE,EAAEnE,MAAM,CAAE8E,IAAI,IAAK,CAACmN,gBAAgB,CAAChN,GAAG,CAACH,IAAI,CAAC/F,EAAE,CAAC,CAAC;KAE7F,MAAMsF,SAAS,GAAG,2BAAC6L,gBAAgB,CAAC7L,SAAS,qCAAI,EAAE,EAAErE,MAAM,CAAE8E,IAAI,IAAK,CAACmN,gBAAgB,CAAChN,GAAG,CAACH,IAAI,CAAC/F,EAAE,CAAC,CAAC;KACrG,CAACmG,IAAI,KAAKC,WAAW,CAACC,QAAQ,GAAGf,SAAS,GAAGF,KAAK,EAAEiF,IAAI,CAAC,GAAG2I,KAAK,CAAC;KAElE7B,gBAAgB,CAAC/L,KAAK,GAAGA,KAAK;KAC9B+L,gBAAgB,CAAC7L,SAAS,GAAGA,SAAS;KACtC6L,gBAAgB,CAACjM,SAAS,GAAGA,SAAS;;CAExC,CAAC;;CC9DD,MAAMoO,aAAa,GAAGpW,MAAM,CAACC,MAAM,CAAC;GACnCoW,WAAW,EAAE;CACd,CAAC,CAAC;CAAC;CAAA;AAEH,CAAO,MAAMC,wBAAwB,CACrC;GACC,OAAOC,SAAS,GAChB;KACC,MAAMC,QAAQ,2CAAG,IAAI,yCAAoB;KAEzC,OAAO;OACNC,WAAW,0CAAE,IAAI,sCAAkBL,aAAa,CAACC,WAAW,EAAEG,QAAQ,CAACnR,GAAG,CAAC+Q,aAAa,CAACC,WAAW,CAAC;MACrG;;CAwCH;CAAC,8BApCA;GACC,MAAMG,QAAQ,GAAG,IAAIzR,GAAG,EAAE;GAE1B,MAAM2R,eAAe,GAAG,IAAIC,eAAe,CAACxG,QAAQ,CAACyG,QAAQ,CAAC/H,MAAM,CAAC;GACrE7O,MAAM,CAAC6W,MAAM,CAACT,aAAa,CAAC,CAACpR,OAAO,CAAE8R,SAAiB,IAAK;KAC3D,MAAMC,UAAU,GAAGL,eAAe,CAACrR,GAAG,CAACyR,SAAS,CAAC;KACjD,IAAI,CAACC,UAAU,EACf;OACC;;KAGDP,QAAQ,CAAChR,GAAG,CAACsR,SAAS,EAAEC,UAAU,CAAC;IACnC,CAAC;GAEF,OAAOP,QAAQ;CAChB;CAAC,2BAEuBM,SAAiB,EAAEhI,KAAc,EACzD;GACC,IAAIoG,cAAI,CAAC8B,WAAW,CAAClI,KAAK,CAAC,EAC3B;KACC,OAAO,IAAI;;GAGZ,IAAImI,WAAW,GAAGnI,KAAK;GACvB,IAAIgI,SAAS,KAAKV,aAAa,CAACC,WAAW,EAC3C;KACCY,WAAW,GAAGC,MAAM,CAACpI,KAAK,CAAC;KAC3B,IAAI,CAACoG,cAAI,CAACiC,SAAS,CAACF,WAAW,CAAC,EAChC;OACC,OAAO,IAAI;;;GAIb,OAAOA,WAAW;CACnB;CAAC,sBA/CWX,wBAAwB;GAAA;CAAA;CAAA,sBAAxBA,wBAAwB;GAAA;CAAA;;CCJrC;AACA,CAAO,MAAMc,QAAQ,GAAG;GACvBnV,IAAI,EAAE,UAAU;GAEhBC,UAAU,EAAE;yBACXmV;IACA;GAEDC,KAAK,EAAE;KACN/J,KAAK,EAAE;OACNvB,IAAI,EAAEuL,KAAK;OACXC,QAAQ,EAAE,KAAK;OACfC,OAAO,EAAE,MAAM;MACf;KACD1U,KAAK,EAAE;OACNiJ,IAAI,EAAE0L,MAAM;OACZF,QAAQ,EAAE,KAAK;OACfC,OAAO,EAAE;MACT;KACDE,SAAS,EAAE;OACV3L,IAAI,EAAE4L,OAAO;OACbJ,QAAQ,EAAE,KAAK;OACfC,OAAO,EAAE;MACT;KACDzL,IAAI,EAAE;OACLA,IAAI,EAAE0L,MAAM;OACZF,QAAQ,EAAE,KAAK;OACfC,OAAO,EAAE;MACT;KACDI,YAAY,EAAE;OACb7L,IAAI,EAAE4L,OAAO;OACbJ,QAAQ,EAAE,KAAK;OACfC,OAAO,EAAE;;IAEV;GAEDpV,IAAI,GACJ;KACC,OAAO;OACNyV,WAAW,EAAE,KAAK;OAClBC,UAAU,EAAE,IAAI;OAChBC,YAAY,EAAE;MACd;IACD;GAEDxV,QAAQ,EACR;KACCyV,aAAa,GACb;OACC,OAAO,mFAAmF;MAC1F;KACDpV,aAAa,GACb;OACC,OAAO,IAAI,CAAC0K,KAAK,CAACrG,GAAG,CAAElD,IAAc,IAAe;SACnD,MAAMkU,YAAY,GAAG,IAAI,CAACC,eAAe,CAACnU,IAAI,CAAC;SAE/C,OAAO;WAAE,GAAGA,IAAI;WAAEkU;UAAc;QAChC,CAAC;MACF;KACDE,QAAQ,GACR;OACC,OAAO,IAAI,CAACpM,IAAI,KAAK,IAAI,CAACqM,SAAS,CAACC,MAAM,GACvC,IAAI,CAACtV,GAAG,CAAC,+DAA+D,CAAC,GACzE,IAAI,CAACA,GAAG,CAAC,6DAA6D,CAAC;;IAG3E;GAEDoI,OAAO,GACP;KACC,IAAI,CAACiN,SAAS,GAAG;OAChB/D,IAAI,EAAE,MAAM;OACZgE,MAAM,EAAE;MACR;IACD;GAEDpU,OAAO,EACP;KACClB,GAAG,CAACmB,UAAkB,EAAEC,YAAmC,GAAG,EAAE,EAChE;OACC,OAAO,IAAI,CAACC,OAAO,CAACC,GAAG,CAACC,UAAU,CAACJ,UAAU,EAAEC,YAAY,CAAC;MAC5D;KACDmU,eAAe,CAACC,GAAW,EAC3B;OACC/I,EAAE,CAACC,SAAS,CAACC,QAAQ,CAACC,IAAI,CAAC4I,GAAG,EAAE;SAC/BC,SAAS,EAAE;QACX,CAAC;MACF;KACDC,aAAa,GACb;OACC,IAAI,IAAI,CAACV,YAAY;;SACrB;WACC,IAAI,CAACA,YAAY,GAAG,KAAK;WACzBvG,6BAAY,CAACkH,WAAW,CAAC5Y,MAAM,CAACS,wBAAwB,EAAE,IAAI,CAACkY,aAAa,CAAC;WAC7EjH,6BAAY,CAACkH,WAAW,CAAC5Y,MAAM,CAACa,cAAc,EAAE,IAAI,CAAC8X,aAAa,CAAC;;MAEpE;KACDE,YAAY,GACZ;OACC,IAAI,CAAC,IAAI,CAACZ,YAAY;;SACtB;WACC,IAAI,CAACA,YAAY,GAAG,IAAI;WACxBvG,6BAAY,CAACoH,SAAS,CAAC9Y,MAAM,CAACS,wBAAwB,EAAE,IAAI,CAACkY,aAAa,CAAC;WAC3EjH,6BAAY,CAACoH,SAAS,CAAC9Y,MAAM,CAACa,cAAc,EAAE,IAAI,CAAC8X,aAAa,CAAC;;MAElE;KACDP,eAAe,CAACnU,IAAc,EAC9B;OACC,OAAOA,IAAI,CAACkU,YAAY,IAAI,IAAI,CAAClV,GAAG,CAAC,gDAAgD,CAAC;;IAEvF;GAED2B,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAmDZ,CAAC;;CCrKM,MAAMmU,kBAAkB,CAC/B;GAMCC,WAAW,CAACC,QAAgB,EAC5B;KACC,IAAI,CAACtW,iBAAiB,GAAGC,mEAAiB,CAACC,WAAW,EAAE;KACxD,IAAI,CAACoW,QAAQ,GAAGA,QAAQ;;GAGzBC,QAAQ,GACR;KACC,MAAM,IAAIC,KAAK,CAAC,6BAA6B,CAAC;;GAG/CC,gBAAgB,GAChB;KACC,IAAI,CAAC,IAAI,CAACzW,iBAAiB,EAC3B;OACC,OAAO,EAAE;;KAGV,MAAM6K,KAAK,GAAG,IAAI,CAAC0L,QAAQ,EAAE;KAE7B,OAAO1L,KAAK,CAACxJ,MAAM,CAAEC,IAAI,IAAK;OAC7B,IAAIkR,cAAI,CAACkE,UAAU,CAACpV,IAAI,CAACqV,aAAa,CAAC,EACvC;SACC,OAAOrV,IAAI,CAACqV,aAAa,CAAC,IAAI,CAAC3W,iBAAiB,EAAE,IAAI,CAACsW,QAAQ,CAAC;;OAGjE,OAAO,KAAK;MACZ,CAAC;;GAGHM,qBAAqB,CAAC5U,QAAgB,EACtC;KACC,MAAM6U,UAAU,GAAG,IAAI,CAAChM,KAAK,CAAC8G,IAAI,CAAErQ,IAAI,IAAKA,IAAI,CAAClB,EAAE,KAAK4B,QAAQ,CAAC;KAClE6U,UAAU,oBAAVA,UAAU,CAAEC,MAAM,CAAC;OAClBR,QAAQ,EAAE,IAAI,CAACA,QAAQ;OACvBS,cAAc,EAAE,IAAI,CAACA,cAAc;OACnCtU,UAAU,EAAE,IAAI,CAACA;MACjB,CAAC;;CAEJ;;CC1CO,MAAMuU,gBAAgB,CAC7B;GAQCX,WAAW,CAAC;KAAEjW,EAAE;KAAEC,KAAK;KAAEE,WAAW;KAAEC,KAAK;KAAEyW,gBAAgB;KAAEpK;IAAY,EAC3E;KACC,IAAI,CAACzM,EAAE,GAAGA,EAAE;KACZ,IAAI,CAACC,KAAK,GAAGA,KAAK;KAClB,IAAI,CAACE,WAAW,GAAGA,WAAW;KAC9B,IAAI,CAACC,KAAK,GAAGA,KAAK;KAClB,IAAI,CAACyW,gBAAgB,GAAGA,gBAAgB;KACxC,IAAI,CAACpK,UAAU,GAAGA,UAAU;;GAG7BiK,MAAM,CAACrN,OAAe,EACtB;KACC,MAAM,IAAI+M,KAAK,CAAC,6BAA6B,CAAC;;GAG/CG,aAAa,CAAC3W,iBAAyC,EAAEsW,QAAgB,EACzE;KACC,OAAOtW,iBAAiB,CAAC2W,aAAa,CAAC,IAAI,CAACM,gBAAgB,EAAEX,QAAQ,CAAC;;CAEzE;;OCpCaY,WAAW,GAAG5Z,MAAM,CAACC,MAAM,CAAC;GACxC4Z,cAAc,EAAE,gBAAgB;GAChC/X,aAAa,EAAE,eAAe;GAC9BC,WAAW,EAAE,aAAa;GAC1B+X,YAAY,EAAE,cAAc;GAC5BlU,gBAAgB,EAAE,kBAAkB;GACpCmU,YAAY,EAAE,cAAc;GAC5BC,UAAU,EAAE,YAAY;GACxBC,UAAU,EAAE,YAAY;GAExBC,2BAA2B,EAAE,6BAA6B;GAC1D3H,wBAAwB,EAAE,0BAA0B;GACpD4H,mBAAmB,EAAE,qBAAqB;GAE1CC,QAAQ,EAAE,UAAU;GACpBC,UAAU,EAAE;CACb,CAAC,CAAC;;CCFK,MAAMC,qBAAqB,SAASZ,gBAAgB,CAC3D;GAICX,WAAW,CAAC5T,UAAkB,EAC9B;KACC,IAAIpC,KAAK,GAAG,EAAE;KACd,IAAIE,WAAW,GAAG,EAAE;;;KAGpB,MAAMP,iBAAiB,GAAGC,mEAAiB,CAACC,WAAW,EAAE;KACzD,IAAIF,iBAAiB,CAAC6X,gBAAgB,EACtC;OACCxX,KAAK,GAAGoC,UAAU,KAAKuD,iDAAW,CAAC8R,IAAI,GACpClW,aAAG,CAACC,UAAU,CAAC,6EAA6E,CAAC,GAC7FD,aAAG,CAACC,UAAU,CAAC,4FAA4F,CAAC;OAE/GtB,WAAW,GAAGkC,UAAU,KAAKuD,iDAAW,CAAC8R,IAAI,GAC1ClW,aAAG,CAACC,UAAU,CAAC,gFAAgF,CAAC,GAChGD,aAAG,CAACC,UAAU,CAAC,+FAA+F,CAAC;MAClH,MAED;OACCxB,KAAK,GAAGuB,aAAG,CAACC,UAAU,CAAC,2FAA2F,CAAC;OACnHtB,WAAW,GAAGqB,aAAG,CAACC,UAAU,CAAC,8FAA8F,CAAC;;KAG7H,KAAK,CAAC;OACLzB,EAAE,EAAE8W,WAAW,CAAC9X,aAAa;OAC7BiB,KAAK;OACLE,WAAW;OACXC,KAAK,EAAE;SACNjB,IAAI,EAAEkB,wBAAI,CAACC,SAAS;SACpBC,IAAI,EAAE,EAAE;SACRC,KAAK,EAAEC,kDAAY,CAAC,eAAe;QACnC;OACDoW,gBAAgB,EAAE,IAAI;OACtBpK,UAAU,EAAE;MACZ,CAAC;KAEF,IAAI,CAACpK,UAAU,GAAGA,UAAU;KAC5B,IAAI,CAACzC,iBAAiB,GAAGA,iBAAiB;KAC1C,IAAI,CAACyC,UAAU,GAAGA,UAAU;;GAG7BqU,MAAM,CAAC;KAAER,QAAQ;KAAES,cAAc;KAAEtU;IAAY,EAC/C;;KAEC,IAAIA,UAAU,KAAKuD,iDAAW,CAAC8R,IAAI,EACnC;OACC,IAAI,CAAC,IAAI,CAAC9X,iBAAiB,CAAC6X,gBAAgB,EAC5C;SACC1I,kBAAE,CAACC,YAAY,CAACC,MAAM,CAACC,MAAM,CAAC;WAC7BC,OAAO,EAAE3N,aAAG,CAACC,UAAU,CAAC,gEAAgE,CAAC;WACzF2N,aAAa,EAAE;UACf,CAAC;SAEF;;OAEDT,6BAAY,CAACC,IAAI,CAAC3R,MAAM,CAACmB,qBAAqB,EAAE;SAC/C4E,MAAM,EAAEkT,QAAQ;SAChByB,UAAU,EAAE,KAAK;SACjBC,kBAAkB,EAAE,KAAK;SACzBrJ,MAAM,EAAEoI,cAAc;SACtBtU;QACA,CAAC;;;UAIH;OACCsM,6BAAY,CAACC,IAAI,CAAC3R,MAAM,CAACmB,qBAAqB,EAAE;SAC/C4E,MAAM,EAAEkT,QAAQ;SAChByB,UAAU,EAAE,KAAK;SACjBC,kBAAkB,EAAE,IAAI;SACxBrJ,MAAM,EAAEoI;QACR,CAAC;;;GAIJJ,aAAa,CAAC3W,iBAAyC,EAAEsW,QAAgB,EACzE;KACC,IAAI,IAAI,CAAC7T,UAAU,KAAKuD,iDAAW,CAAC8R,IAAI,EACxC;OACC,OAAO9X,iBAAiB,CAAC2W,aAAa,CAAC3V,mEAAiB,CAAC2M,UAAU,EAAE2I,QAAQ,CAAC;;KAG/E,OAAOtW,iBAAiB,CAAC2W,aAAa,CAAC3V,mEAAiB,CAACC,gBAAgB,EAAEqV,QAAQ,CAAC,IAChFtW,iBAAiB,CAAC2W,aAAa,CAAC3V,mEAAiB,CAAC2M,UAAU,EAAE2I,QAAQ,CAAC;;CAG7E;;CC/FO,MAAM2B,sBAAsB,SAASjB,gBAAgB,CAC5D;GAGCX,WAAW,CAAC5T,UAAkB,EAC9B;KACC,MAAMpC,KAAK,GAAGoC,UAAU,KAAKuD,iDAAW,CAAC8R,IAAI,GAC1ClW,aAAG,CAACC,UAAU,CAAC,8EAA8E,CAAC,GAC9FD,aAAG,CAACC,UAAU,CAAC,oFAAoF,CAAC;KAEvG,MAAMtB,WAAW,GAAGkC,UAAU,KAAKuD,iDAAW,CAAC8R,IAAI,GAChDlW,aAAG,CAACC,UAAU,CAAC,0FAA0F,CAAC,GAC1GD,aAAG,CAACC,UAAU,CAAC,gGAAgG,CAAC;KAEnH,KAAK,CAAC;OACLzB,EAAE,EAAE8W,WAAW,CAACC,cAAc;OAC9B9W,KAAK;OACLE,WAAW;OACXC,KAAK,EAAE;SACNjB,IAAI,EAAEkB,wBAAI,CAACyX,WAAW;SACtBvX,IAAI,EAAE,EAAE;SACRC,KAAK,EAAEC,kDAAY,CAAC,eAAe;QACnC;OACDoW,gBAAgB,EAAE,IAAI;OACtBpK,UAAU,EAAE;MACZ,CAAC;KAEF,IAAI,CAACpK,UAAU,GAAGA,UAAU;;GAG7BqU,MAAM,CAAC;KAAER,QAAQ;KAAES,cAAc;KAAEoB,UAAU,GAAG;IAAS,EACzD;KACCpJ,6BAAY,CAACC,IAAI,CAAC3R,MAAM,CAACmB,qBAAqB,EAAE;OAC/C4E,MAAM,EAAEkT,QAAQ;OAChByB,UAAU,EAAE,IAAI;OAChBC,kBAAkB,EAAE,KAAK;OACzB1O,IAAI,EAAE,YAAY;OAClBqF,MAAM,EAAEoI,cAAc;OACtBoB;MACA,CAAC;;GAGHxB,aAAa,CAAC3W,iBAAyC,EAAEsW,QAAgB,EACzE;KACC,IAAI,IAAI,CAAC7T,UAAU,KAAKuD,iDAAW,CAAC8R,IAAI,EACxC;OACC,OAAO9X,iBAAiB,CAAC2W,aAAa,CAAC3V,mEAAiB,CAACoX,QAAQ,EAAE9B,QAAQ,CAAC,IACxEtW,iBAAiB,CAAC2W,aAAa,CAAC3V,mEAAiB,CAACqX,aAAa,EAAE/B,QAAQ,CAAC,IAC1EtW,iBAAiB,CAAC2W,aAAa,CAAC3V,mEAAiB,CAACsX,qBAAqB,EAAEhC,QAAQ,CAAC,IAClFtW,iBAAiB,CAAC2W,aAAa,CAAC3V,mEAAiB,CAACuX,gBAAgB,EAAEjC,QAAQ,CAAC;;KAIlF,OAAOtW,iBAAiB,CAAC2W,aAAa,CAAC3V,mEAAiB,CAACwX,cAAc,EAAElC,QAAQ,CAAC,IAC9EtW,iBAAiB,CAAC2W,aAAa,CAAC3V,mEAAiB,CAACI,uBAAuB,EAAEkV,QAAQ,CAAC,IACpFtW,iBAAiB,CAAC2W,aAAa,CAAC3V,mEAAiB,CAACyX,2BAA2B,EAAEnC,QAAQ,CAAC;;CAG9F;;CC3DO,MAAMoC,wBAAwB,SAAS1B,gBAAgB,CAC9D;GACCX,WAAW,CAAC5T,UAAkB,EAC9B;KACC,MAAMpC,KAAK,GAAGoC,UAAU,KAAKuD,iDAAW,CAAC8R,IAAI,GAC1ClW,aAAG,CAACC,UAAU,CAAC,gFAAgF,CAAC,GAChGD,aAAG,CAACC,UAAU,CAAC,sFAAsF,CAAC;KAEzG,MAAMtB,WAAW,GAAGkC,UAAU,KAAKuD,iDAAW,CAAC8R,IAAI,GAChDlW,aAAG,CAACC,UAAU,CAAC,mFAAmF,CAAC,GACnGD,aAAG,CAACC,UAAU,CAAC,yFAAyF,CAAC;KAE5G,MAAMoV,gBAAgB,GAAGxU,UAAU,KAAKuD,iDAAW,CAAC8R,IAAI,GACrD9W,mEAAiB,CAAC2X,UAAU,GAC5B3X,mEAAiB,CAAC4X,gBAAgB;KAGrC,KAAK,CAAC;OACLxY,EAAE,EAAE8W,WAAW,CAAChU,gBAAgB;OAChC7C,KAAK;OACLE,WAAW;OACXC,KAAK,EAAE;SACNjB,IAAI,EAAEkB,wBAAI,CAACoY,SAAS;SACpBlY,IAAI,EAAE,EAAE;SACRC,KAAK,EAAEC,kDAAY,CAAC,cAAc;QAClC;OACDoW,gBAAgB;OAChBpK,UAAU,EAAE;MACZ,CAAC;;GAGHiK,MAAM,CAAC;KAAER,QAAQ;KAAE7T;IAAY,EAC/B;KACCsM,6BAAY,CAACC,IAAI,CAAC3R,MAAM,CAACoB,gBAAgB,EAAE;OAAE2E,MAAM,EAAEkT,QAAQ;OAAE7T;MAAY,CAAC;;CAE9E;;CCnCO,MAAMqW,mBAAmB,SAAS9B,gBAAgB,CACzD;GAGCX,WAAW,CAAC5T,UAAkB,EAAE8D,IAAa,EAC7C;KACC,MAAM0Q,gBAAgB,GAAGxU,UAAU,KAAKuD,iDAAW,CAAC8R,IAAI,GACrD9W,mEAAiB,CAACqX,aAAa,GAC/BrX,mEAAiB,CAACI,uBAAuB;KAG5C,KAAK,CAAC;OACLhB,EAAE,EAAE8W,WAAW,CAAC7X,WAAW;OAC3BmB,KAAK,EAAE;SACNjB,IAAI,EAAE2B,uBAAG,CAACC,aAAa;SACvBR,IAAI,EAAE,EAAE;SACRC,KAAK,EAAEC,kDAAY,CAAC,eAAe;QACnC;OACDoW,gBAAgB;OAChBpK,UAAU,EAAE;MACZ,CAAC;KAEF,IAAI,CAACkM,QAAQ,CAACtW,UAAU,EAAE8D,IAAI,CAAC;;GAGhCwS,QAAQ,CAACtW,UAAkB,EAAE8D,IAAa,EAC1C;KACC,MAAMyS,QAAQ,GAAG,CAAC,MAAM,EAAE,UAAU,CAAC,CAACrS,QAAQ,CAACJ,IAAI,CAAC,GAAGA,IAAI,GAAG,SAAS;KACvE,MAAM0S,QAAQ,GAAGxW,UAAU,KAAKuD,iDAAW,CAAC8R,IAAI,GAAG,MAAM,GAAG,SAAS;KAErE,MAAMoB,OAAO,GAAG;OACftH,IAAI,EAAE;SACLkG,IAAI,EAAE;WACLzX,KAAK,EAAEuB,aAAG,CAACC,UAAU,CAAC,qGAAqG,CAAC;WAC5HtB,WAAW,EAAEqB,aAAG,CAACC,UAAU,CAAC,wGAAwG,CAAC;WACrI0E,IAAI,EAAE4S,mDAAe,CAACvH;UACtB;SACDmD,OAAO,EAAE;WACR1U,KAAK,EAAEuB,aAAG,CAACC,UAAU,CAAC,gGAAgG,CAAC;WACvHtB,WAAW,EAAEqB,aAAG,CAACC,UAAU,CAAC,mGAAmG,CAAC;WAChI0E,IAAI,EAAEC,+CAAW,CAACoL;;QAEnB;OACDnL,QAAQ,EAAE;SACTqR,IAAI,EAAE;WACLzX,KAAK,EAAEuB,aAAG,CAACC,UAAU,CAAC,yGAAyG,CAAC;WAChItB,WAAW,EAAEqB,aAAG,CAACC,UAAU,CAAC,4GAA4G,CAAC;WACzI0E,IAAI,EAAE4S,mDAAe,CAAC1S;UACtB;SACDsO,OAAO,EAAE;WACR1U,KAAK,EAAEuB,aAAG,CAACC,UAAU,CAAC,oGAAoG,CAAC;WAC3HtB,WAAW,EAAEqB,aAAG,CAACC,UAAU,CAAC,uGAAuG,CAAC;WACpI0E,IAAI,EAAEC,+CAAW,CAACC;;QAEnB;OACDsO,OAAO,EAAE;SACR+C,IAAI,EAAE;WACLzX,KAAK,EAAEuB,aAAG,CAACC,UAAU,CAAC,sFAAsF,CAAC;WAC7GtB,WAAW,EAAEqB,aAAG,CAACC,UAAU,CAAC,yFAAyF,CAAC;WACtH0E,IAAI,EAAE;UACN;SACDwO,OAAO,EAAE;WACR1U,KAAK,EAAEuB,aAAG,CAACC,UAAU,CAAC,iFAAiF,CAAC;WACxGtB,WAAW,EAAEqB,aAAG,CAACC,UAAU,CAAC,oFAAoF,CAAC;WACjH0E,IAAI,EAAE;;;MAGR;KAED,IAAI,CAAClG,KAAK,GAAG6Y,OAAO,CAACF,QAAQ,CAAC,CAACC,QAAQ,CAAC,CAAC5Y,KAAK;KAC9C,IAAI,CAACE,WAAW,GAAG2Y,OAAO,CAACF,QAAQ,CAAC,CAACC,QAAQ,CAAC,CAAC1Y,WAAW;KAC1D,IAAI,CAACgG,IAAI,GAAG2S,OAAO,CAACF,QAAQ,CAAC,CAACC,QAAQ,CAAC,CAAC1S,IAAI;;GAG7CuQ,MAAM,CAAC;KAAER,QAAQ;KAAE7T;IAAY,EAC/B;KACC2W,yEAAoB,CAACC,UAAU,CAAC;OAC/BjW,MAAM,EAAEkT,QAAQ;OAChBhN,IAAI,EAAE,KAAK;OACX/C,IAAI,EAAE,IAAI,CAACA,IAAI;OACf9D;MACA,CAAC;;CAEJ;;CCnFO,MAAM6W,qBAAqB,SAAStC,gBAAgB,CAC3D;GAGCX,WAAW,CAAC5T,UAAkB,EAAE8D,IAAa,EAC7C;KACC,MAAM0Q,gBAAgB,GAAGxU,UAAU,KAAKuD,iDAAW,CAAC8R,IAAI,GACrD9W,mEAAiB,CAACqX,aAAa,GAC/BrX,mEAAiB,CAACI,uBAAuB;KAG5C,KAAK,CAAC;OACLhB,EAAE,EAAE8W,WAAW,CAACE,YAAY;OAC5BmC,UAAU,EAAE,yCAAyC;OACrD/Y,KAAK,EAAE;SACNjB,IAAI,EAAEkB,wBAAI,CAAC+Y,SAAS;SACpB7Y,IAAI,EAAE,EAAE;SACRC,KAAK,EAAEC,kDAAY,CAAC,eAAe;QACnC;OACDoW,gBAAgB;OAChBpK,UAAU,EAAE;MACZ,CAAC;KAEF,IAAI,CAACkM,QAAQ,CAACtW,UAAU,EAAE8D,IAAI,CAAC;;GAGhCwS,QAAQ,CAACtW,UAAkB,EAAE8D,IAAa,EAC1C;KACC,MAAMyS,QAAQ,GAAG,CAAC,MAAM,EAAE,UAAU,CAAC,CAACrS,QAAQ,CAACJ,IAAI,CAAC,GAAGA,IAAI,GAAG,SAAS;KACvE,MAAM0S,QAAQ,GAAGxW,UAAU,KAAKuD,iDAAW,CAAC8R,IAAI,GAAG,MAAM,GAAG,SAAS;KAErE,MAAMoB,OAAO,GAAG;OACftH,IAAI,EAAE;SACLkG,IAAI,EAAE;WACLzX,KAAK,EAAEuB,aAAG,CAACC,UAAU,CAAC,sGAAsG,CAAC;WAC7HtB,WAAW,EAAEqB,aAAG,CAACC,UAAU,CAAC,yGAAyG;UACrI;SACDkT,OAAO,EAAE;WACR1U,KAAK,EAAEuB,aAAG,CAACC,UAAU,CAAC,iGAAiG,CAAC;WACxHtB,WAAW,EAAEqB,aAAG,CAACC,UAAU,CAAC,oGAAoG;;QAEjI;OACD4E,QAAQ,EAAE;SACTqR,IAAI,EAAE;WACLzX,KAAK,EAAEuB,aAAG,CAACC,UAAU,CAAC,0GAA0G,CAAC;WACjItB,WAAW,EAAEqB,aAAG,CAACC,UAAU,CAAC,6GAA6G;UACzI;SACDkT,OAAO,EAAE;WACR1U,KAAK,EAAEuB,aAAG,CAACC,UAAU,CAAC,qGAAqG,CAAC;WAC5HtB,WAAW,EAAEqB,aAAG,CAACC,UAAU,CAAC,6GAA6G;;QAE1I;OACDkT,OAAO,EAAE;SACR+C,IAAI,EAAE;WACLzX,KAAK,EAAEuB,aAAG,CAACC,UAAU,CAAC,4FAA4F,CAAC;WACnHtB,WAAW,EAAEqB,aAAG,CAACC,UAAU,CAAC,+FAA+F;UAC3H;SACDkT,OAAO,EAAE;WACR1U,KAAK,EAAEuB,aAAG,CAACC,UAAU,CAAC,uFAAuF,CAAC;WAC9GtB,WAAW,EAAEqB,aAAG,CAACC,UAAU,CAAC,0FAA0F;;;MAGxH;KAED,IAAI,CAACxB,KAAK,GAAG6Y,OAAO,CAACF,QAAQ,CAAC,CAACC,QAAQ,CAAC,CAAC5Y,KAAK;KAC9C,IAAI,CAACE,WAAW,GAAG2Y,OAAO,CAACF,QAAQ,CAAC,CAACC,QAAQ,CAAC,CAAC1Y,WAAW;;GAG3DuW,MAAM,CAAC;KAAER,QAAQ;KAAES;IAAgB,EACnC;KACChI,6BAAY,CAACC,IAAI,CAAC3R,MAAM,CAACmB,qBAAqB,EAAE;OAC/C4E,MAAM,EAAEkT,QAAQ;OAChByB,UAAU,EAAE,IAAI;OAChBC,kBAAkB,EAAE,KAAK;OACzB1O,IAAI,EAAE,WAAW;OACjBqF,MAAM,EAAEoI;MACR,CAAC;;CAEJ;;CC9EO,MAAM0C,oBAAoB,SAASzC,gBAAgB,CAC1D;GACCX,WAAW,GACX;KACC,KAAK,CAAC;OACLjW,EAAE,EAAE8W,WAAW,CAACG,YAAY;OAC5BhX,KAAK,EAAEuB,aAAG,CAACC,UAAU,CAAC,kFAAkF,CAAC;OACzGtB,WAAW,EAAEqB,aAAG,CAACC,UAAU,CAAC,qFAAqF,CAAC;OAClHrB,KAAK,EAAE;SACNjB,IAAI,EAAEkB,wBAAI,CAACiZ,mBAAmB;SAC9B/Y,IAAI,EAAE,EAAE;SACRC,KAAK,EAAEC,kDAAY,CAAC,eAAe;QACnC;OACDoW,gBAAgB,EAAEjW,mEAAiB,CAACI,uBAAuB;OAC3DyL,UAAU,EAAE;MACZ,CAAC;;GAGHiK,MAAM,CAAC;KAAER,QAAQ;KAAES;IAAgB,EACnC;KACCqC,yEAAoB,CAACC,UAAU,CAAC;OAC/BjW,MAAM,EAAEkT,QAAQ;OAChBhN,IAAI,EAAE;MACN,CAAC;;GAGHqN,aAAa,CAAC3W,iBAAyC,EAAEsW,QAAgB,EACzE;KACC,OAAOtW,iBAAiB,CAAC2Z,sBAAsB,CAACC,sCAAsC,IAClF5Z,iBAAiB,CAAC2W,aAAa,CAAC,IAAI,CAACM,gBAAgB,EAAEX,QAAQ,CAAC;;CAGtE;;CClCO,MAAMuD,kBAAkB,SAAS7C,gBAAgB,CACxD;GACCX,WAAW,GACX;KACC,KAAK,CAAC;OACLjW,EAAE,EAAE8W,WAAW,CAACI,UAAU;OAC1BjX,KAAK,EAAEuB,aAAG,CAACC,UAAU,CAAC,gFAAgF,CAAC;OACvGtB,WAAW,EAAEqB,aAAG,CAACC,UAAU,CAAC,mFAAmF,CAAC;OAChHrB,KAAK,EAAE;SACNjB,IAAI,EAAEkB,wBAAI,CAACqZ,aAAa;SACxBnZ,IAAI,EAAE,EAAE;SACRC,KAAK,EAAEC,kDAAY,CAAC,eAAe;QACnC;OACDoW,gBAAgB,EAAEjW,mEAAiB,CAAC+Y,kBAAkB;OACtDlN,UAAU,EAAE;MACZ,CAAC;;GAGHiK,MAAM,CAAC;KAAER;IAAU,EACnB;KACCvJ,EAAE,CAACC,SAAS,CAACC,QAAQ,CAACC,IAAI,CACzB,wDAAwD,GACtD,2CAA2C,GAC1C,kBAAiBsH,MAAM,CAAC8B,QAAQ,CAAE,4CAA2C,EAChF;OAAEP,SAAS,EAAE,KAAK;OAAEiE,kBAAkB,EAAE,KAAK;OAAE/Q,KAAK,EAAE;MAAM,CAC5D;;CAEH;;CCvBO,MAAMgR,gBAAgB,SAAS7D,kBAAkB,CACxD;GACCC,WAAW,CAACC,QAAgB,EAAE7T,UAAkB,EAAEsU,cAAsB,EACxE;KACC,KAAK,CAACT,QAAQ,CAAC;KACf,IAAI,CAAC7T,UAAU,GAAGA,UAAU;KAC5B,IAAI,CAACsU,cAAc,GAAGA,cAAc;KACpC,IAAI,CAAClM,KAAK,GAAG,IAAI,CAAC4L,gBAAgB,EAAE;;GAGrCF,QAAQ,GACR;KACC,IAAI,IAAI,CAAC9T,UAAU,KAAKuD,iDAAW,CAAC8R,IAAI,EACxC;OACC,OAAO,CACN,IAAIG,sBAAsB,CAAC,IAAI,CAACxV,UAAU,CAAC,EAC3C,IAAImV,qBAAqB,CAAC,IAAI,CAACnV,UAAU,CAAC,EAC1C,IAAIqW,mBAAmB,CAAC,IAAI,CAACrW,UAAU,CAAC,EACxC,IAAIiW,wBAAwB,CAAC,IAAI,CAACjW,UAAU,CAAC,CAC7C;;KAGF,OAAO,CACN,IAAIwV,sBAAsB,CAAC,IAAI,CAACxV,UAAU,CAAC,EAC3C,IAAImV,qBAAqB,CAAC,IAAI,CAACnV,UAAU,CAAC,EAC1C,IAAIqW,mBAAmB,CAAC,IAAI,CAACrW,UAAU,CAAC,EACxC,IAAIgX,oBAAoB,EAAE,EAC1B,IAAII,kBAAkB,EAAE,EACxB,IAAInB,wBAAwB,CAAC,IAAI,CAACjW,UAAU,CAAC,CAC7C;;CAEH;;CClCA;AACA,CAAO,MAAMyX,oBAAoB,GAAG;GACnC3a,IAAI,EAAE,sBAAsB;GAE5BC,UAAU,EAAE;sBACXC;IACA;GAEDmV,KAAK,EAAE;KACN0B,QAAQ,EAAE;OACThN,IAAI,EAAEkL,MAAM;OACZM,QAAQ,EAAE;MACV;KACDrS,UAAU,EAAE;OACX6G,IAAI,EAAE0L,MAAM;OACZD,OAAO,EAAE/O,iDAAW,CAACF;;IAEtB;GAEDnG,IAAI,GACJ;KACC,OAAO;OACNwa,WAAW,EAAE;MACb;IACD;GAEDra,QAAQ,EAAE;KACTsa,IAAI,GACJ;OACC,OAAO,IAAIH,gBAAgB,CAAC,IAAI,CAAC3D,QAAQ,EAAE,IAAI,CAAC7T,UAAU,EAAEmM,uDAAmB,CAACyL,MAAM,CAAC;;IAExF;GAED7Y,OAAO,EAAE;KACRlB,GAAG,CAACmB,UAAkB,EAAEC,YAAqC,GAAG,EAAE,EAClE;OACC,OAAO,IAAI,CAACC,OAAO,CAACC,GAAG,CAACC,UAAU,CAACJ,UAAU,EAAEC,YAAY,CAAC;MAC5D;KACDkV,qBAAqB,CAAC5U,QAAgB,EACtC;OACC,IAAI,CAACoY,IAAI,CAACxD,qBAAqB,CAAC5U,QAAQ,CAAC;MACzC;KACDsY,SAAS,GACT;OACC,IAAI,IAAI,CAACH,WAAW,EACpB;SACC,IAAI,CAACA,WAAW,GAAG,KAAK;SACxBpL,6BAAY,CAACkH,WAAW,CAAC5Y,MAAM,CAACS,wBAAwB,EAAE,IAAI,CAACwc,SAAS,CAAC;SACzEvL,6BAAY,CAACkH,WAAW,CAAC5Y,MAAM,CAACa,cAAc,EAAE,IAAI,CAACoc,SAAS,CAAC;;MAEhE;KACDC,QAAQ,GACR;OACC,IAAI,CAAC,IAAI,CAACJ,WAAW,EACrB;SACC,IAAI,CAACA,WAAW,GAAG,IAAI;SACvBpL,6BAAY,CAACoH,SAAS,CAAC9Y,MAAM,CAACS,wBAAwB,EAAE,IAAI,CAACwc,SAAS,CAAC;SACvEvL,6BAAY,CAACoH,SAAS,CAAC9Y,MAAM,CAACa,cAAc,EAAE,IAAI,CAACoc,SAAS,CAAC;;;IAG/D;GAEDrY,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;CAqBZ,CAAC;;CClFD;AACA,CAAO,MAAMuY,wBAAwB,GAAG;GACvCjb,IAAI,EAAE,0BAA0B;GAEhCC,UAAU,EAAE;gBACXib;IACA;GAED7F,KAAK,EAAE;KACN0B,QAAQ,EAAE;OACThN,IAAI,EAAEkL,MAAM;OACZM,QAAQ,EAAE;MACV;KACD4F,UAAU,EAAE;OACXpR,IAAI,EAAEkL,MAAM;OACZM,QAAQ,EAAE;MACV;KACDvU,WAAW,EAAE;OACZ+I,IAAI,EAAE,CAAC0L,MAAM,EAAE,IAAI,CAAC;OACpBD,OAAO,EAAE;;IAEV;GAEDpV,IAAI,GACJ;KACC,OAAO;OACNgb,SAAS,EAAE;MACX;IACD;GAED7a,QAAQ,EACR;KACC8a,WAAW,GACX;OACC,MAAMC,UAAU,GAAG,GAAG;OACtB,MAAMC,WAAW,GAAG,EAAE,GAAG,IAAI,CAACJ,UAAU;OACxC,MAAMK,kBAAkB,GAAG,EAAE,GAAG,IAAI,CAACL,UAAU,CAAC;OAChD,MAAMM,UAAU,GAAG,EAAE;OAErB,OAAO;SACN/R,KAAK,EAAE4R,UAAU;SACjBI,WAAW,EAAE,IAAI,CAAC3P,KAAK,CAAC4P,oBAAoB;SAC5CC,WAAW,EAAE;WAAEC,QAAQ,EAAE;UAAO;SAChCC,YAAY,EAAE,MAAM;SACpBC,iBAAiB,EAAE,IAAI;SACvBC,cAAc,EAAE,CAAC;SACjBC,OAAO,EAAE,EAAE;SACXC,SAAS,EAAE,CAAC,CAAC,GAAG,IAAI,CAACf,UAAU;SAC/BgB,UAAU,EAAEZ,WAAW,GAAG,CAAC,GAAGD,UAAU,GAAG,CAAC,GAAGE,kBAAkB;SACjEY,WAAW,EAAEd,UAAU,GAAG,CAAC,GAAGG,UAAU,GAAG;QAC3C;;IAEF;GAEDtS,OAAO,GACP;KACC,IAAI,CAACkT,QAAQ,GAAG,IAAI3D,sBAAsB,CAACjS,iDAAW,CAAC8R,IAAI,CAAC;KAC5D,MAAM9X,iBAAiB,GAAGC,mEAAiB,CAACC,WAAW,EAAE;KAEzD,IAAI,CAAC2b,OAAO,GAAG,IAAI,CAACD,QAAQ,CAACjF,aAAa,CAAC3W,iBAAiB,EAAE,IAAI,CAACsW,QAAQ,CAAC;IAC5E;GAED9U,OAAO,EACP;KACClB,GAAG,CAACmB,UAAkB,EAAEC,YAAqC,GAAG,EAAE,EAClE;OACC,OAAO,IAAI,CAACC,OAAO,CAACC,GAAG,CAACC,UAAU,CAACJ,UAAU,EAAEC,YAAY,CAAC;MAC5D;KACDoa,OAAO,GACP;OACC,IAAI,IAAI,CAACnB,SAAS,EAClB;SACC,IAAI,CAACA,SAAS,GAAG,KAAK;SACtB5L,6BAAY,CAACkH,WAAW,CAAC5Y,MAAM,CAACS,wBAAwB,EAAE,IAAI,CAACge,OAAO,CAAC;SACvE/M,6BAAY,CAACkH,WAAW,CAAC5Y,MAAM,CAACa,cAAc,EAAE,IAAI,CAAC4d,OAAO,CAAC;;MAE9D;KACDC,MAAM,GACN;OACC,IAAI,CAAC,IAAI,CAACpB,SAAS,EACnB;SACC,IAAI,CAACA,SAAS,GAAG,IAAI;SACrB5L,6BAAY,CAACoH,SAAS,CAAC9Y,MAAM,CAACS,wBAAwB,EAAE,IAAI,CAACge,OAAO,CAAC;SACrE/M,6BAAY,CAACoH,SAAS,CAAC9Y,MAAM,CAACa,cAAc,EAAE,IAAI,CAAC4d,OAAO,CAAC;;MAE5D;KACDE,cAAc,GACd;OACC,IAAI,CAACF,OAAO,EAAE;OACd,IAAI,CAACF,QAAQ,CAAC9E,MAAM,CAAC;SACpBR,QAAQ,EAAE,IAAI,CAACA,QAAQ;SACvBS,cAAc,EAAEnI,uDAAmB,CAACqN,IAAI;SACxC9D,UAAU,EAAE;QACZ,CAAC;;IAEH;GAEDlW,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAuCZ,CAAC;;CC1ID;AACA,CAAO,MAAMia,oBAAoB,GAAG;GACnC3c,IAAI,EAAE,sBAAsB;GAE5BC,UAAU,EAAE;YACXsI;IACA;GAED8M,KAAK,EAAE;KACN0B,QAAQ,EAAE;OACThN,IAAI,EAAEkL,MAAM;OACZM,QAAQ,EAAE;MACV;KACDrS,UAAU,EAAE;OACX6G,IAAI,EAAE0L,MAAM;OACZD,OAAO,EAAE/O,iDAAW,CAACF;;IAEtB;GAEDhG,QAAQ,EACR;KACCgD,GAAG,GACH;OACC,OAAOoD,sBAAG;;IAEX;GAEDwC,OAAO,GACP;KACC,IAAI,CAACkT,QAAQ,GAAG,IAAIhE,qBAAqB,CAAC,IAAI,CAACnV,UAAU,CAAC;KAC1D,MAAMzC,iBAAiB,GAAGC,mEAAiB,CAACC,WAAW,EAAE;KAEzD,IAAI,CAACic,OAAO,GAAG,IAAI,CAACP,QAAQ,CAACjF,aAAa,CAAC3W,iBAAiB,EAAE,IAAI,CAACsW,QAAQ,CAAC;IAC5E;GAED9U,OAAO,EAAE;KACRlB,GAAG,CAACmB,UAAkB,EAAEC,YAAqC,GAAG,EAAE,EAClE;OACC,OAAO,IAAI,CAACC,OAAO,CAACC,GAAG,CAACC,UAAU,CAACJ,UAAU,EAAEC,YAAY,CAAC;MAC5D;KACD0a,cAAc,GACd;OACC,IAAI,CAACR,QAAQ,CAAC9E,MAAM,CAAC;SACpBR,QAAQ,EAAE,IAAI,CAACA,QAAQ;SACvBS,cAAc,EAAEnI,uDAAmB,CAACyN,IAAI;SACxC5Z,UAAU,EAAE,IAAI,CAACA;QACjB,CAAC;;IAEH;GAEDR,QAAQ,EAAG;;;;;;;CAOZ,CAAC;;CChDD;AACA,CAAO,MAAMqa,QAAQ,GAAG;GACvB/c,IAAI,EAAE,UAAU;GAEhBC,UAAU,EAAE;KACX0a,oBAAoB;KACpBxF,QAAQ;KACRwH,oBAAoB;KACpB1B;IACA;GAEDzS,UAAU,EAAE;KAAEwU,IAAI,EAAEC;IAAM;GAE1BC,MAAM,EAAE,CAAC,eAAe,CAAC;GAEzB7H,KAAK,EAAE;KACNxR,MAAM,EAAE;OACPkG,IAAI,EAAEkL,MAAM;OACZM,QAAQ,EAAE;MACV;KACD4H,aAAa,EAAE;OACdpT,IAAI,EAAEuL,KAAK;OACXC,QAAQ,EAAE;MACV;KACD4F,UAAU,EAAE;OACXpR,IAAI,EAAEkL,MAAM;OACZM,QAAQ,EAAE;MACV;KACDxQ,kBAAkB,EAAE;OACnBgF,IAAI,EAAEuL,KAAK;OACXC,QAAQ,EAAE;MACV;KACD6H,OAAO,EAAE;OACRrT,IAAI,EAAE4L,OAAO;OACbJ,QAAQ,EAAE,KAAK;OACfC,OAAO,EAAE;MACT;KACD6H,oBAAoB,EAAE;OACrBtT,IAAI,EAAEkL,MAAM;OACZO,OAAO,EAAE;MACT;KACD8H,iBAAiB,EAAE;OAClBvT,IAAI,EAAE4L,OAAO;OACbH,OAAO,EAAE;MACT;KACD+H,cAAc,EAAE;OACfxT,IAAI,EAAE4L,OAAO;OACbH,OAAO,EAAE;;IAEV;GAEDrV,KAAK,EAAE,CAAC,mBAAmB,CAAC;GAE5BC,IAAI,GACJ;KACC,OAAO;OACNod,cAAc,EAAE,CAAC;OACjBC,eAAe,EAAE,KAAK;OACtBC,QAAQ,EAAE,IAAI;OACdC,OAAO,EAAE;MACT;IACD;GAEDpd,QAAQ,EACR;KACC0G,WAAW,GACX;OACC,OAAOiL,kDAAc,CAAC,IAAI,CAAC0L,QAAQ,CAAC1a,UAAU,CAAC;MAC/C;KACD0a,QAAQ,GACR;OACC,OAAO,IAAI,CAAC9Y,WAAW,CAAC1B,GAAG,CAAC,IAAI,CAACS,MAAM,CAAC;MACxC;KACDga,SAAS,GACT;OACC,MAAMC,YAAY,GAAG,IAAI,CAACP,cAAc,IAAI,IAAI,CAAC1Z,MAAM,KAAK,IAAI,CAAC4B,WAAW;OAE5E,OAAO;SACN,YAAY,EAAE,IAAI,CAAC0X,aAAa,CAAC/V,QAAQ,CAAC,IAAI,CAACvD,MAAM,CAAC;SACtD,sBAAsB,EAAE,IAAI,CAACka,mBAAmB;SAChD,WAAW,EAAE,IAAI,CAACtY,WAAW,KAAK,IAAI,CAAC5B,MAAM;SAC7C,iCAAiC,EAAE,CAAC,IAAI,CAAC6Z,QAAQ;SACjD,QAAQ,EAAE,IAAI,CAAC9H,YAAY;SAC3B,eAAe,EAAEkI;QACjB;MACD;KACDE,iBAAiB,GACjB;OACC,OAAO;SACN,iCAAiC,EAAE,IAAI,CAACC,WAAW;SACnD,MAAM,EAAE,IAAI,CAACA,WAAW,IAAI,IAAI,CAACC,UAAU;SAC3C,QAAQ,EAAE,IAAI,CAACD,WAAW,IAAI,CAAC,IAAI,CAACC,UAAU;SAC9C,eAAe,EAAE,CAAC,IAAI,CAACD;QACvB;MACD;KACDA,WAAW,GACX;OAAA;OACC,OAAO,8BAAI,CAACL,QAAQ,CAACna,QAAQ,qBAAtB,sBAAwB0D,MAAM,IAAG,CAAC;MACzC;KACD+W,UAAU,GACV;OACC,OAAO,IAAI,CAACf,aAAa,CAAC/V,QAAQ,CAAC,IAAI,CAACvD,MAAM,CAAC;MAC/C;KACDka,mBAAmB,GACnB;OACC,OAAO,IAAI,CAAChZ,kBAAkB,CAACqC,QAAQ,CAAC,IAAI,CAACvD,MAAM,CAAC;MACpD;KACDwO,IAAI,GACJ;OAAA;OACC,+BAAO,IAAI,CAACuL,QAAQ,CAAC3X,KAAK,qBAAnB,qBAAqBnE,MAAM,CAAEuQ,IAAI,IAAK;SAC5C,OAAOA,IAAI,CAACrL,IAAI,KAAK,IAAI,CAACC,WAAW,CAACoL,IAAI;QAC1C,CAAC;MACF;KACDgE,MAAM,GACN;OAAA;OACC,gCAAO,IAAI,CAACuH,QAAQ,CAAC3X,KAAK,qBAAnB,sBAAqBnE,MAAM,CAAEuQ,IAAI,IAAK;SAC5C,OAAOA,IAAI,CAACrL,IAAI,KAAK,IAAI,CAACC,WAAW,CAACkX,UAAU;QAChD,CAAC;MACF;KACDC,aAAa,GACb;OACC,OAAO,IAAI,CAACR,QAAQ,CAAC7X,SAAS,GAAG,IAAI,CAAC6X,QAAQ,CAAC3X,KAAK,CAACkB,MAAM;MAC3D;KACDkX,cAAc,GACd;OACC,OAAO;SAAEC,IAAI,EAAG,GAAE,IAAI,CAACd,cAAe;QAAK;MAC3C;KACDe,wBAAwB,GACxB;OACC,OAAO,IAAI,CAACpB,aAAa,CAAC/V,QAAQ,CAAC,IAAI,CAACvD,MAAM,CAAC,IAAI,IAAI,CAAC4B,WAAW,KAAK,IAAI,CAAC5B,MAAM;MACnF;KACD+R,YAAY,GACZ;OACC,OAAO,IAAI,CAACgI,QAAQ,CAAC1a,UAAU,KAAKuD,iDAAW,CAAC8R,IAAI;MACpD;KACDiG,aAAa,GACb;OACC,IAAI,CAAC,IAAI,CAACT,mBAAmB,EAC7B;SACC,OAAO,IAAI;;OAGZ,OAAO,IAAI,CAACnI,YAAY,GACrB,IAAI,CAAC7U,GAAG,CAAC,qCAAqC,CAAC,GAC/C,IAAI,CAACA,GAAG,CAAC,2CAA2C,CAAC;MACxD;KACD0d,gBAAgB,GAChB;OAAA;OACC,IAAI,IAAI,CAAC7I,YAAY,EACrB;SAAA;SACC,OAAO,8BAAI,CAACgI,QAAQ,CAACna,QAAQ,aAAtB,uBAAwB0D,MAAM,GAClC,IAAI,CAACuX,SAAS,CAAC,4CAA4C,EAAE,IAAI,CAACd,QAAQ,CAACna,QAAQ,CAAC0D,MAAM,CAAC,GAC3F,IAAI,CAACpG,GAAG,CAAC,8DAA8D,CAAC;;OAG5E,IAAI,4BAAE,IAAI,CAAC6c,QAAQ,CAACna,QAAQ,aAAtB,uBAAwB0D,MAAM,CAAC,EACrC;SACC,OAAO,IAAI,CAACpG,GAAG,CAAC,yDAAyD,CAAC;;OAG3E,MAAM4d,qBAAqB,GAAG,CAAC,GAAG,IAAI,CAAC7Z,WAAW,CAAC8P,MAAM,EAAE,CAAC,CAAC9S,MAAM,CAAEyE,UAAU,IAAK;SACnF,OAAOA,UAAU,CAACrD,UAAU,KAAKuD,iDAAW,CAACF,UAAU,IAAI,IAAI,CAACqX,QAAQ,CAACna,QAAQ,CAAC2D,QAAQ,CAACb,UAAU,CAAC1F,EAAE,CAAC;QACzG,CAAC,CAACsG,MAAM;OAET,MAAMyX,eAAe,GAAG,CAAC,GAAG,IAAI,CAAC9Z,WAAW,CAAC8P,MAAM,EAAE,CAAC,CAAC9S,MAAM,CAAEyE,UAAU,IAAK;SAC7E,OAAOA,UAAU,CAACrD,UAAU,KAAKuD,iDAAW,CAAC8R,IAAI,IAAI,IAAI,CAACqF,QAAQ,CAACna,QAAQ,CAAC2D,QAAQ,CAACb,UAAU,CAAC1F,EAAE,CAAC;QACnG,CAAC,CAACsG,MAAM;OAET,IAAKyX,eAAe,GAAG,CAAC,IAAMD,qBAAqB,GAAG,CAAE,EACxD;SACC,OAAO,IAAI,CAAC5d,GAAG,CAAC,mEAAmE,EAAE;WACpF,cAAc,EAAE,IAAI,CAAC2d,SAAS,CAAC,kDAAkD,EAAEC,qBAAqB,CAAC;WACzG,cAAc,EAAE,IAAI,CAACD,SAAS,CAAC,4CAA4C,EAAEE,eAAe;UAC5F,CAAC;;OAGH,IAAID,qBAAqB,GAAG,CAAC,EAC7B;SACC,OAAO,IAAI,CAACD,SAAS,CAAC,kDAAkD,EAAEC,qBAAqB,CAAC;;OAGjG,IAAIC,eAAe,GAAG,CAAC,EACvB;SACC,OAAO,IAAI,CAACF,SAAS,CAAC,4CAA4C,EAAEE,eAAe,CAAC;;OAGrF,OAAO,IAAI,CAAC7d,GAAG,CAAC,yDAAyD,CAAC;MAC1E;KACD8d,WAAW,GACX;OACC,OAAO,IAAI,CAACjJ,YAAY,GACrB,IAAI,CAAC7U,GAAG,CAAC,yDAAyD,CAAC,GACnE,IAAI,CAACA,GAAG,CAAC,oDAAoD,CAAC;MAEjE;KACD+d,eAAe,GACf;OACC,MAAMC,UAAU,GAAG,IAAI,CAACja,WAAW,CAAC1B,GAAG,CAAC,IAAI,CAACqC,WAAW,CAAC;OACzD,IAAIsZ,UAAU,CAAC7b,UAAU,KAAK,IAAI,CAAC0a,QAAQ,CAAC1a,UAAU,EACtD;SACC,OAAO,IAAI,CAACnC,GAAG,CAAC,2DAA2D,CAAC;;OAG7E,OAAO,IAAI,CAACuc,iBAAiB,GAC1B,IAAI,CAACvc,GAAG,CAAC,yDAAyD,CAAC,GACnE,IAAI,CAACA,GAAG,CAAC,2DAA2D,CAAC;MAExE;KACDie,WAAW,GACX;OACC,OAAO,IAAI,CAACnb,MAAM,KAAK,IAAI,CAACwZ,oBAAoB,IAAI,IAAI,CAACxZ,MAAM,KAAK,IAAI,CAAC4B,WAAW;MACpF;KACD,GAAGoD,sBAAQ,CAAC1D,wDAAa,EAAE,CAAC,aAAa,EAAE,aAAa,CAAC;IACzD;GAED2D,KAAK,EACL;KACCuJ,IAAI,GACJ;OACC,IAAI,CAAC4M,WAAW,EAAE;MAClB;KACD7B,OAAO,GACP;OACC,IAAI,CAAC6B,WAAW,EAAE;MAClB;KACDf,UAAU,EACV;OACCnV,OAAO,CAACmV,UAAmB,EAC3B;SACC,IAAIA,UAAU,IAAI,CAAC,IAAI,CAACT,eAAe,EACvC;WACC,IAAI,CAACA,eAAe,GAAG,IAAI;;QAE5B;OACDyB,SAAS,EAAE;;IAEZ;GAED/V,OAAO,GACP;KACC,IAAI,CAACO,KAAK,GAAG,GAAG;KAChB,IAAI,CAACyV,GAAG,GAAG,EAAE;KACb,IAAI,CAACC,kBAAkB,GAAG,CAAC;KAC3B,IAAI,CAACC,UAAU,GAAG,CAAC;IACnB;GAED,MAAM7e,OAAO,GACb;KACC,IAAI8e,UAAU,GAAG,EAAE;KACnB,IAAIC,UAAU,GAAG,EAAE;KACnB,IAAI,IAAI,CAAC3J,YAAY,EACrB;OACC2J,UAAU,GAAG9d,mEAAiB,CAAC+d,QAAQ;OACvCF,UAAU,GAAG7d,mEAAiB,CAACoX,QAAQ;MACvC,MAED;OACC0G,UAAU,GAAG9d,mEAAiB,CAACge,aAAa;OAC5CH,UAAU,GAAG7d,mEAAiB,CAACwX,cAAc;;KAG9C,MAAMxY,iBAAiB,GAAGC,mEAAiB,CAACC,WAAW,EAAE;KACzD,IAAI,CAAC+c,QAAQ,GAAGjd,iBAAiB,CAAC2W,aAAa,CAACmI,UAAU,EAAE,IAAI,CAAC1b,MAAM,CAAC;KACxE,IAAI,CAAC8Z,OAAO,GAAGld,iBAAiB,CAAC2W,aAAa,CAACkI,UAAU,EAAE,IAAI,CAACzb,MAAM,CAAC,IACnEpD,iBAAiB,CAAC2W,aAAa,CAACkI,UAAU,EAAE,IAAI,CAAC1B,QAAQ,CAAC5a,QAAQ,CAAC;KAEvE,IAAI,CAACT,KAAK,CAAC,mBAAmB,EAAE,IAAI,CAACsB,MAAM,CAAC;KAC5C,MAAM,IAAI,CAAC6b,SAAS,EAAE;KACtB,IAAI,CAACL,UAAU,GAAG,IAAI,CAACM,GAAG,CAACC,YAAY;KACvCpQ,6BAAY,CAACC,IAAI,CAAC3R,MAAM,CAACG,qBAAqB,EAAE;OAC/C4C,EAAE,EAAE,IAAI,CAACgD,MAAM;OACfb,QAAQ,EAAE,IAAI,CAAC4a,QAAQ,CAAC5a,QAAQ;OAChC6c,IAAI,EAAE,IAAI,CAACF,GAAG;OACdG,WAAW,EAAE,IAAI,CAACC,cAAc,CAAC,IAAI,CAACnC,QAAQ,CAAC5a,QAAQ,CAAC;OACxD,GAAG,IAAI,CAACgd,mBAAmB;MAC3B,CAAC;IACF;GACDC,SAAS,GACT;KACCrU,aAAG,CAACsU,MAAM,CAAC,IAAI,CAACP,GAAG,CAAC;KACpB,MAAM;OAAEpY;MAAc,GAAG,IAAI,CAACqW,QAAQ;KACtC,IAAI,CAACrW,YAAY,EACjB;OACC;;KAGD,IAAI,CAAChF,KAAK,CAAC,mBAAmB,EAAE,IAAI,CAACsB,MAAM,CAAC;KAC5C2L,6BAAY,CAACC,IAAI,CAAC3R,MAAM,CAACI,wBAAwB,EAAE;OAClD2C,EAAE,EAAE,IAAI,CAACgD,MAAM;OACfb,QAAQ,EAAEuE;MACV,CAAC;IACF;GAEDtF,OAAO,EACP;KACClB,GAAG,CAACmB,UAAkB,EAAEC,YAAmC,GAAG,EAAE,EAChE;OACC,OAAO,IAAI,CAACC,OAAO,CAACC,GAAG,CAACC,UAAU,CAACJ,UAAU,EAAEC,YAAY,CAAC;MAC5D;KACDge,iBAAiB,CAACtY,QAAgB,EAClC;OACC,IAAI,CAAC,IAAI,CAAC6V,QAAQ,EAClB;SACC;;OAGDlO,6BAAY,CAACC,IAAI,CAAC3R,MAAM,CAACO,mBAAmB,EAAE;SAC7CwF,MAAM,EAAE,IAAI,CAACA,MAAM;SACnBuc,aAAa,EAAEvY,QAAQ,KAAK,WAAW;SACvCwY,oBAAoB,EAAExY,QAAQ,KAAK;QACnC,CAAC;MACF;KACDyY,iBAAiB,CAACzc,MAAc,EAChC;OACC,MAAM0c,IAAI,GAAG,IAAI,CAACzb,WAAW,CAAC1B,GAAG,CAAC,IAAI,CAACS,MAAM,CAAC;OAE9C,IAAI0c,IAAI,CAAC9c,QAAQ,CAAC0D,MAAM,KAAK,CAAC,EAC9B;SACC,IAAI,CAACqW,cAAc,GAAG,CAAC;QACvB,MAED;SACC,MAAM2B,GAAG,GAAG,IAAI,CAACA,GAAG,IAAIoB,IAAI,CAAC9c,QAAQ,CAAC0D,MAAM,GAAG,CAAC,CAAC;SACjD,IAAI,CAACiY,kBAAkB,GAAG,IAAI,CAAC5B,cAAc;SAC7C,IAAI,CAACA,cAAc,GAAG,CAAC,IAAI,CAAC9T,KAAK,IAAI,IAAI,CAACA,KAAK,GAAG6W,IAAI,CAAC9c,QAAQ,CAAC0D,MAAM,GAAGgY,GAAG,CAAC,IAAI,CAAC;;OAGnF,MAAMqB,MAAM,GAAG,IAAI,CAAChD,cAAc,GAAG,IAAI,CAAC4B,kBAAkB;OAC5D,IAAIoB,MAAM,KAAK,CAAC,EAChB;SACChR,6BAAY,CAACC,IAAI,CAAC3R,MAAM,CAACK,4BAA4B,EAAE;WACtD6E,QAAQ,EAAE,IAAI,CAACa,MAAM;WACrBA,MAAM;WACN2c;UACA,CAAC;;MAEH;KACD9B,SAAS,CAACxc,UAAkB,EAAEyC,KAAa,EAC3C;OACC,OAAOtC,aAAG,CAACoe,gBAAgB,CAACve,UAAU,EAAEyC,KAAK,EAAE;SAAE,SAAS,EAAEA;QAAO,CAAC;MACpE;KACDqb,mBAAmB,GACnB;OACC,MAAM;SAAE1B,IAAI;SAAEoC,GAAG;SAAEhX;QAAO,GAAG,IAAI,CAACiW,GAAG,CAACgB,qBAAqB,EAAE;OAC7D,MAAM;SAAEhB,GAAG,EAAEiB;QAAY,GAAG,IAAI,CAACC,OAAO,CAACA,OAAO;OAChD,MAAM;SACLvC,IAAI,EAAEwC,UAAU;SAChBJ,GAAG,EAAEK,SAAS;SACdrX,KAAK,EAAEsX,WAAW;SAClBrX,MAAM,EAAEsX;QACR,GAAGL,UAAU,CAACD,qBAAqB,EAAE;OACtC,MAAM;SAAEO,CAAC,EAAEC,MAAM;SAAEC,CAAC,EAAEC;QAAQ,GAAG,IAAI,CAACC,aAAa,EAAE;OAErD,OAAO;SACNC,UAAU,EAAE;WACXL,CAAC,EAAE,CAACJ,UAAU,GAAGK,MAAM,GAAGH,WAAW,GAAG,CAAC,IAAI,IAAI,CAAC7F,UAAU;WAC5DiG,CAAC,EAAE,CAACL,SAAS,GAAGM,MAAM,GAAGJ,YAAY,IAAI,IAAI,CAAC9F;UAC9C;SACDqG,QAAQ,EAAE;WACTN,CAAC,EAAE,CAAC5C,IAAI,GAAG6C,MAAM,GAAGzX,KAAK,GAAG,CAAC,IAAI,IAAI,CAACyR,UAAU;WAChDiG,CAAC,EAAE,CAACV,GAAG,GAAGW,MAAM,IAAI,IAAI,CAAClG;;QAE1B;MACD;KACD4E,cAAc,CAAC/c,QAAgB,EAC/B;OACC,IAAIye,UAAU,GAAGze,QAAQ;OACzB,MAAM8c,WAAW,GAAG,CAAC9c,QAAQ,CAAC;OAC9B,OAAOye,UAAU,EACjB;SACC,MAAMb,UAAU,GAAG,IAAI,CAAC9b,WAAW,CAAC1B,GAAG,CAACqe,UAAU,CAAC;SACnDA,UAAU,GAAGb,UAAU,CAAC5d,QAAQ;SAChC,IAAIye,UAAU,EACd;WACC3B,WAAW,CAAC5U,IAAI,CAACuW,UAAU,CAAC;;;OAI9B,OAAO3B,WAAW;MAClB;KACD,MAAMb,WAAW,GACjB;OACC,IAAI,CAAC,IAAI,CAAC7B,OAAO,EACjB;SACC;;OAGD,MAAM,IAAI,CAACsC,SAAS,EAAE;OACtB,MAAMjO,KAAK,GAAG,IAAI,CAACkO,GAAG,CAACC,YAAY,GAAG,IAAI,CAACP,UAAU;OACrD,IAAI5N,KAAK,KAAK,CAAC,EACf;SACCjC,6BAAY,CAACC,IAAI,CAAC3R,MAAM,CAACM,oCAAoC,EAAE;WAC9DyF,MAAM,EAAE,IAAI,CAACA,MAAM;WACnB4N;UACA,CAAC;SACF,IAAI,CAAC4N,UAAU,GAAG,IAAI,CAACM,GAAG,CAACC,YAAY;;MAExC;KACD8B,gBAAgB,GAChB;OACClS,6BAAY,CAACC,IAAI,CAAC3R,MAAM,CAAC2B,uBAAuB,EAAE;SAAEoE,MAAM,EAAE,IAAI,CAACA;QAAQ,CAAC;MAC1E;KAED8d,gBAAgB,GAChB;OACCnS,6BAAY,CAACC,IAAI,CAAC3R,MAAM,CAAC4B,uBAAuB,EAAE;SAAEmE,MAAM,EAAE,IAAI,CAACA;QAAQ,CAAC;;IAE3E;GAEDnB,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAuJZ,CAAC;;CCzjBD;AACA,CAAO,MAAMkf,UAAU,GAAG;GACzB5hB,IAAI,EAAE,uBAAuB;GAE7B6hB,MAAM,EAAE,CACP,4BAA4B,EAC5B,6BAA6B,EAC7B,+BAA+B,EAC/B,6BAA6B,CAC7B;GAEDxM,KAAK,EAAE;KACNyM,0BAA0B,EAAE;OAC3B/X,IAAI,EAAE4L,OAAO;OACbJ,QAAQ,EAAE;MACV;;KAEDwM,SAAS,EAAE;OACVhY,IAAI,EAAEhM,MAAM;OACZwX,QAAQ,EAAE;;IAEX;GAEDnV,IAAI,GACJ;KACC,OAAO;OAAE4hB,UAAU,EAAE;MAAI;IACzB;GAEDzhB,QAAQ,EACR;KACC,GAAGsI,sBAAQ,CAAC1D,wDAAa,EAAE,CAAC,aAAa,EAAE,aAAa,CAAC;IACzD;GAEDgE,OAAO,GACP;KACC,IAAI,CAAC8Y,iBAAiB,EAAE;KACxB,IAAI,CAACC,eAAe,GAAG5V,MAAM,CAAC6V,UAAU;IACxC;GAEDC,aAAa,GACb;KACC,IAAI,CAACC,qBAAqB,EAAE;IAC5B;GAEDpgB,OAAO,EACP;KACCqgB,cAAc,CAAC;OAAEliB;MAAyB,EAC1C;OAAA;OACC,MAAM;SAAES,EAAE;SAAEmC;QAAU,GAAG5C,IAAI;OAC7B,IAAI,CAAC4C,QAAQ,EACb;SACC;;OAGD,MAAMuf,SAAS,uBAAG,IAAI,CAACP,UAAU,CAAE,GAAEhf,QAAS,IAAGnC,EAAG,EAAC,CAAC,+BAAI,EAAE;OAC5D9C,MAAM,CAACykB,MAAM,CAACD,SAAS,EAAEniB,IAAI,CAAC;OAC9B,IAAImiB,SAAS,CAACE,WAAW,EACzB;SACC,OAAO,IAAI,CAACT,UAAU,CAAE,GAAEhf,QAAS,IAAGnC,EAAG,EAAC,CAAC;;OAG5C,IAAI,CAACmhB,UAAU,CAAE,GAAEhf,QAAS,IAAGnC,EAAG,EAAC,CAAC,GAAG;SACtCsL,IAAI,EAAE,IAAI;SACVsW,WAAW,EAAE,KAAK;SAClB,GAAGF;QACH;MACD;KACDG,iBAAiB,CAAC;OAAEtiB;MAAyB,EAC7C;OACC,MAAM;SAAE4C,QAAQ;SAAEnC;QAAI,GAAGT,IAAI;OAC7B,OAAO,IAAI,CAAC4hB,UAAU,CAAE,GAAEhf,QAAS,IAAGnC,EAAG,EAAC,CAAC;MAC3C;KACD8hB,wBAAwB,CAAC;OAAEviB;MAA6D,EACxF;OACC,MAAM;SAAEyD,MAAM;SAAEb,QAAQ;SAAEwd;QAAQ,GAAGpgB,IAAI;OACzC,MAAMiG,gBAAgB,GAAG,IAAI,CAACvB,WAAW,CAAC1B,GAAG,CAACJ,QAAQ,CAAC;OACvD,MAAM4f,SAAS,GAAGvc,gBAAgB,CAAC5C,QAAQ,CAAC2D,QAAQ,CAACvD,MAAM,CAAC;OAC5D,MAAM+Q,MAAM,GAAG7W,MAAM,CAAC6W,MAAM,CAAC,IAAI,CAACoN,UAAU,CAAC;OAC7C,MAAMa,uBAAuB,GAAGjO,MAAM,CAACkO,MAAM,CAAC,CAACC,GAAG,EAAER,SAAS,KAAK;SACjE,MAAM;WAAEf,QAAQ,EAAEwB,eAAe;WAAEniB,EAAE,EAAEoiB,SAAS;WAAEjgB,QAAQ,EAAEkgB;UAAiB,GAAGX,SAAS;SACzF,IAAI,CAACU,SAAS,IAAIC,eAAe,KAAKlgB,QAAQ,IAAIigB,SAAS,KAAKpf,MAAM,EACtE;WACC,OAAOkf,GAAG;;SAGX,IAAII,IAAI,GAAG,CAAC;SACZ,IAAIP,SAAS,EACb;WACCO,IAAI,GAAG9c,gBAAgB,CAAC5C,QAAQ,CAACsE,OAAO,CAAClE,MAAM,CAAC,GAC7CwC,gBAAgB,CAAC5C,QAAQ,CAACsE,OAAO,CAACkb,SAAS,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;UACxD,MAED;WACC,MAAM;aAAEzB;YAAU,GAAG,IAAI,CAACQ,UAAU,CAAE,GAAEhf,QAAS,IAAGa,MAAO,EAAC,CAAC;WAC7Dsf,IAAI,GAAG3B,QAAQ,CAACN,CAAC,GAAG8B,eAAe,CAAC9B,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;;SAG/C,OAAO;WACN,GAAG6B,GAAG;WACN,CAACE,SAAS,GAAGE;UACb;QACD,EAAE,EAAE,CAAC;OACNvO,MAAM,CAAC7R,OAAO,CAAEwf,SAAS,IAAK;SAC7B,MAAM;WACL1hB,EAAE,EAAEoiB,SAAS;WACbjgB,QAAQ,EAAEkgB,eAAe;WACzBpD,WAAW;WACX0B,QAAQ,EAAEwB,eAAe;WACzBzB,UAAU,EAAE6B;UACZ,GAAGb,SAAS;SACb,IAAI,CAACU,SAAS,IAAIA,SAAS,KAAKpf,MAAM,EACtC;WACC;;SAGD,IAAIqf,eAAe,KAAKlgB,QAAQ,EAChC;WACC,MAAM;aAAEke;YAAG,GAAG8B,eAAe;WAC7B,MAAMG,IAAI,GAAGN,uBAAuB,CAACI,SAAS,CAAC;WAC/CllB,MAAM,CAACykB,MAAM,CAACQ,eAAe,EAAE;aAAE9B,CAAC,EAAEA,CAAC,GAAGV,MAAM,GAAG2C;YAAM,CAAC;WAExD;;SAGD,MAAME,UAAU,GAAGvD,WAAW,oBAAXA,WAAW,CAAE1N,IAAI,CAAEvR,EAAE,IAAK;WAC5C,OAAO8U,OAAO,CAACkN,uBAAuB,CAAChiB,EAAE,CAAC,CAAC;UAC3C,CAAC;SACF,IAAIwiB,UAAU,EACd;WACC,MAAMC,YAAY,GAAGT,uBAAuB,CAACQ,UAAU,CAAC;WACxDtlB,MAAM,CAACykB,MAAM,CAACY,iBAAiB,EAAE;aAAElC,CAAC,EAAEkC,iBAAiB,CAAClC,CAAC,GAAGV,MAAM,GAAG8C;YAAc,CAAC;WACpFvlB,MAAM,CAACykB,MAAM,CAACQ,eAAe,EAAE;aAAE9B,CAAC,EAAE8B,eAAe,CAAC9B,CAAC,GAAGV,MAAM,GAAG8C;YAAc,CAAC;;QAEjF,CAAC;MACF;KACDC,2BAA2B,CAACtS,GAAa,EAAEQ,KAAa,EAAE+R,MAAe,EACzE;OACCvS,GAAG,CAAClO,OAAO,CAAEyC,YAAY,IAAK;SAC7B,MAAM;WAAExC,QAAQ;WAAES;UAAU,GAAG,IAAI,CAACqB,WAAW,CAAC1B,GAAG,CAACoC,YAAY,CAAC;SACjE,MAAM+c,SAAS,GAAG,IAAI,CAACP,UAAU,CAAE,GAAEhf,QAAS,IAAGwC,YAAa,EAAC,CAAC;SAChE,IAAI,CAAC+c,SAAS,EACd;WACC;;SAGDxkB,MAAM,CAACykB,MAAM,CAACD,SAAS,CAACf,QAAQ,EAAE;WAAEN,CAAC,EAAEqB,SAAS,CAACf,QAAQ,CAACN,CAAC,GAAGzP;UAAO,CAAC;SACtE,IAAI,CAAC+R,MAAM,EACX;WACCzlB,MAAM,CAACykB,MAAM,CAACD,SAAS,CAAChB,UAAU,EAAE;aAAEL,CAAC,EAAEqB,SAAS,CAAChB,UAAU,CAACL,CAAC,GAAGzP;YAAO,CAAC;;SAG3E,IAAI,CAAAhO,QAAQ,oBAARA,QAAQ,CAAE0D,MAAM,IAAG,CAAC,EACxB;WACC,IAAI,CAACoc,2BAA2B,CAAC9f,QAAQ,EAAEgO,KAAK,EAAE,KAAK,CAAC;;QAEzD,CAAC;MACF;KACDgS,sBAAsB,CAAC;OAAErjB;MAAiB,EAC1C;OACC,MAAM;SAAEqR,KAAK;SAAE5N;QAAQ,GAAGzD,IAAI;OAC9BrC,MAAM,CAAC6W,MAAM,CAAC,IAAI,CAACoN,UAAU,CAAC,CAACjf,OAAO,CAAEwf,SAAS,IAAK;SACrD,IAAIA,SAAS,CAACvf,QAAQ,KAAKa,MAAM,EACjC;WACC9F,MAAM,CAACykB,MAAM,CAACD,SAAS,CAAChB,UAAU,EAAE;aAAEH,CAAC,EAAEmB,SAAS,CAAChB,UAAU,CAACH,CAAC,GAAG3P;YAAO,CAAC;;QAE3E,CAAC;MACF;KACDiS,0BAA0B,CAAC1gB,QAAgB,EAAEmJ,IAAa,EAC1D;OACC,MAAM;SAAE1I;QAAU,GAAG,IAAI,CAACqB,WAAW,CAAC1B,GAAG,CAACJ,QAAQ,CAAC;OACnDS,QAAQ,CAACV,OAAO,CAAEuD,OAAO,IAAK;SAAA;SAC7B,MAAMic,SAAS,wBAAG,IAAI,CAACP,UAAU,CAAE,GAAEhf,QAAS,IAAGsD,OAAQ,EAAC,CAAC,gCAAI,EAAE;SACjE,IAAI,CAAC0b,UAAU,GAAG;WACjB,GAAG,IAAI,CAACA,UAAU;WAClB,CAAE,GAAEhf,QAAS,IAAGsD,OAAQ,EAAC,GAAG;aAAE,GAAGic,SAAS;aAAEpW;;UAC5C;QACD,CAAC;MACF;KACDwX,6BAA6B,CAACC,UAAmB,EAAEzG,aAAuB,EAC1E;OACCpf,MAAM,CAAC8lB,IAAI,CAAC,IAAI,CAAC7B,UAAU,CAAC,CAACjf,OAAO,CAAEiQ,GAAG,IAAK;SAC7C,MAAMuP,SAAS,GAAG,IAAI,CAACP,UAAU,CAAChP,GAAG,CAAC;SACtC,IAAI,CAAC4Q,UAAU,IAAKzG,aAAa,CAAC/V,QAAQ,CAACmb,SAAS,CAACvf,QAAQ,CAAC,IAAI4gB,UAAW,EAC7E;WACCrB,SAAS,CAACpW,IAAI,GAAGyX,UAAU;;QAE5B,CAAC;MACF;KACDE,2BAA2B,CAACjgB,MAAc,EAAEkgB,QAAiB,EAC7D;OAAA;OACC,MAAM;SAAE/gB;QAAU,GAAG,IAAI,CAAC8B,WAAW,CAAC1B,GAAG,CAACS,MAAM,CAAC;OACjD,IAAI,CAACb,QAAQ,EACb;SACC;;OAGD,IAAI,CAAC+gB,QAAQ,EACb;SACC,IAAI,CAAC/B,UAAU,CAAE,GAAEhf,QAAS,IAAGa,MAAO,EAAC,CAAC,GAAG;WAC1C,GAAG,IAAI,CAACme,UAAU,CAAE,GAAEhf,QAAS,IAAGa,MAAO,EAAC,CAAC;WAC3C4e,WAAW,EAAE;UACb;SAED;;OAGD,MAAMuB,oBAAoB,wBAAG,IAAI,CAAChC,UAAU,CAAE,GAAEhf,QAAS,IAAGa,MAAO,EAAC,CAAC,gCAAI,EAAE;OAC3E,OAAO,IAAI,CAACme,UAAU,CAAE,GAAEhf,QAAS,IAAGa,MAAO,EAAC,CAAC;OAC/C,IAAI,CAACme,UAAU,GAAG;SACjB,GAAG,IAAI,CAACA,UAAU;SAClB,CAAE,GAAEhf,QAAS,IAAGa,MAAO,EAAC,GAAG;WAC1B,GAAGmgB,oBAAoB;WACvBvB,WAAW,EAAE;;QAEd;MACD;KACDwB,OAAO,CAACpjB,EAAU,EAClB;OACC,MAAM0hB,SAAS,GAAG,IAAI,CAACP,UAAU,CAACnhB,EAAE,CAAC;OACrC,MAAM;SAAE0gB,UAAU;SAAEC,QAAQ;SAAExe;QAAU,GAAGuf,SAAS;OAEpD,IAAI,CAAChB,UAAU,IAAI,CAACC,QAAQ,EAC5B;SACC,OAAO,EAAE;;OAGV,IAAI0C,kBAAkB,GAAG,GAAG;OAC5B,MAAMtD,UAAU,GAAG,IAAI,CAACmB,SAAS,CAAC3e,GAAG,CAACJ,QAAQ,CAAC;OAC/C,MAAMmhB,eAAe,GAAGC,gBAAgB,CAACxD,UAAU,CAAC;OACpD,MAAMyD,mBAAmB,GAAGC,QAAQ,CAACH,eAAe,CAACI,gBAAgB,CAAC,cAAc,CAAC,EAAE,EAAE,CAAC;OAC1F,MAAMC,UAAU,GAAG5D,UAAU,CAAChB,YAAY,GAAGyE,mBAAmB;OAChEH,kBAAkB,GAAGM,UAAU,GAAG,CAAC,GAAGN,kBAAkB,GAAGM,UAAU,GAAGN,kBAAkB;OAC1F,MAAMO,MAAM,GAAG,CAAC;OAEhB,MAAMC,MAAM,GAAGnD,UAAU,CAACH,CAAC,GAAGqD,MAAM;OACpC,MAAME,YAAY,GAAG,IAAI,CAAClf,WAAW,KAAK8c,SAAS,CAAC1hB,EAAE,GAAG,EAAE,GAAG,CAAC;OAC/D,MAAM+jB,OAAO,GAAG;SAAEC,KAAK,EAAE,EAAE;SAAEC,GAAG,EAAE;QAAI;OACtC,IAAIC,SAAS,GAAG,CAAC;OAEjB,IAAIC,IAAI,CAACC,KAAK,CAAC1D,UAAU,CAACL,CAAC,CAAC,GAAG8D,IAAI,CAACC,KAAK,CAACzD,QAAQ,CAACN,CAAC,CAAC,EACrD;SACC6D,SAAS,GAAG,EAAE;SACdH,OAAO,CAACC,KAAK,GAAG,qBAAqB;SACrCD,OAAO,CAACE,GAAG,GAAG,qBAAqB;QACnC,MACI,IAAIE,IAAI,CAACC,KAAK,CAAC1D,UAAU,CAACL,CAAC,CAAC,GAAG8D,IAAI,CAACC,KAAK,CAACzD,QAAQ,CAACN,CAAC,CAAC,EAC1D;SACC6D,SAAS,GAAG,CAAC,EAAE;SACfH,OAAO,CAACC,KAAK,GAAG,oBAAoB;SACpCD,OAAO,CAACE,GAAG,GAAG,oBAAoB;;OAGnC,MAAMI,YAAY,GAAG1D,QAAQ,CAACJ,CAAC,GAAGuD,YAAY;OAE9C,OAAO,CACL,IAAGpD,UAAU,CAACL,CAAE,IAAGwD,MAAO,EAAC,EAC3B,IAAGA,MAAM,GAAGR,kBAAmB,EAAC,EAChC,GAAEzO,MAAM,CAACmP,OAAO,CAACC,KAAK,CAAE,EAAC,EACzB,IAAGrD,QAAQ,CAACN,CAAC,GAAG6D,SAAU,EAAC,EAC3B,GAAEtP,MAAM,CAACmP,OAAO,CAACE,GAAG,CAAE,EAAC,EACvB,IAAGI,YAAa,EAAC,CAClB,CAACC,IAAI,CAAC,EAAE,CAAC;MACV;KACDlD,iBAAiB,GACjB;OACC,IAAI,CAACnkB,MAAM,GAAG;SACb,CAACA,MAAM,CAACG,qBAAqB,GAAG,IAAI,CAACqkB,cAAc;SACnD,CAACxkB,MAAM,CAACI,wBAAwB,GAAG,IAAI,CAACwkB,iBAAiB;SACzD,CAAC5kB,MAAM,CAACK,4BAA4B,GAAG,IAAI,CAACwkB,wBAAwB;SACpE,CAAC7kB,MAAM,CAACM,oCAAoC,GAAG,IAAI,CAACqlB;QACpD;OACD1lB,MAAM,CAACqnB,OAAO,CAAC,IAAI,CAACtnB,MAAM,CAAC,CAACiF,OAAO,CAAC,CAAC,CAACkB,KAAK,EAAEohB,MAAM,CAAC,KAAK;SACxD7V,6BAAY,CAACoH,SAAS,CAAC3S,KAAK,EAAEohB,MAAM,CAAC;QACrC,CAAC;OACFjZ,eAAK,CAACC,IAAI,CAACC,MAAM,EAAE,QAAQ,EAAE,IAAI,CAACgZ,cAAc,CAAC;MACjD;KACDjD,qBAAqB,GACrB;OACCtkB,MAAM,CAACqnB,OAAO,CAAC,IAAI,CAACtnB,MAAM,CAAC,CAACiF,OAAO,CAAC,CAAC,CAACkB,KAAK,EAAEohB,MAAM,CAAC,KAAK;SACxD7V,6BAAY,CAACkH,WAAW,CAACzS,KAAK,EAAEohB,MAAM,CAAC;QACvC,CAAC;OACFjZ,eAAK,CAACO,MAAM,CAACL,MAAM,EAAE,QAAQ,EAAE,IAAI,CAACgZ,cAAc,CAAC;MACnD;KACDA,cAAc,GACd;OACC,MAAM9E,MAAM,GAAG,CAAClU,MAAM,CAAC6V,UAAU,GAAG,IAAI,CAACD,eAAe,IAAI,CAAC;OAC7D,IAAI,CAACA,eAAe,GAAG5V,MAAM,CAAC6V,UAAU;OACxC,IAAI3B,MAAM,KAAK,CAAC,EAChB;SACC;;OAGDziB,MAAM,CAAC8lB,IAAI,CAAC,IAAI,CAAC7B,UAAU,CAAC,CAACjf,OAAO,CAAEiQ,GAAG,IAAK;SAC7C,MAAMuP,SAAS,GAAG,IAAI,CAACP,UAAU,CAAChP,GAAG,CAAC;SACtC,IAAIuP,SAAS,CAAChB,UAAU,IAAIgB,SAAS,CAACf,QAAQ,EAC9C;WACC,MAAM+D,WAAW,GAAGhD,SAAS,CAAChB,UAAU,CAACL,CAAC;WAC1C,MAAMsE,SAAS,GAAGjD,SAAS,CAACf,QAAQ,CAACN,CAAC;WACtCnjB,MAAM,CAACykB,MAAM,CAACD,SAAS,CAAChB,UAAU,EAAE;aAAEL,CAAC,EAAEqE,WAAW,GAAG/E;YAAQ,CAAC;WAChEziB,MAAM,CAACykB,MAAM,CAACD,SAAS,CAACf,QAAQ,EAAE;aAAEN,CAAC,EAAEsE,SAAS,GAAGhF;YAAQ,CAAC;;QAE7D,CAAC;;IAEH;GAED9d,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;CAuBZ,CAAC;;;;AC/UD,CAMA,MAAM+iB,UAAU,GAAG,GAAG;CACtB,MAAMC,iBAAiB,GAAG,EAAE;CAAC;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAE7B,CAAO,MAAMC,sBAAsB,CACnC;GAmBC7O,WAAW,CAACpO,EAAe,EAC3B;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA,OAVqB;;KAAC;OAAA;OAAA,OACD;;KAAC;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAUrB0D,eAAK,CAACC,IAAI,CAAC3D,EAAE,EAAE,WAAW,EAAGzE,KAAiB,IAAK;OAClD,4CAAI,8BAAcA,KAAK;MACvB,CAAC;KACF,4CAAI,0CAAsBA,KAAiB,IAAK;OAC/C,4CAAI,8BAAcA,KAAK;MACvB;KAED,4CAAI,sCAAoBA,KAAiB,IAAK;OAC7C,4CAAI,0BAAYA,KAAK;MACrB;KAED,4CAAI,4CAAuBA,KAAiB,IAAK;OAChD,4CAAI,gCAAeA,KAAK;MACxB;KAED,4CAAI,4CAAsBvD,mEAAiB,CAACC,WAAW,EAAE;;CA0Y3D;CAAC,uBAvYa;GAAE0K,MAAM;GAAEua,aAAa,EAAEC,IAAI;GAAEC,KAAK;GAAEC;CAAkB,CAAC,EACtE;GACC,IAAI,CAACna,aAAG,CAAC6C,QAAQ,CAACpD,MAAM,EAAE,oCAAoC,CAAC,EAC/D;KACC;;GAGDpH,KAAK,CAAC+hB,eAAe,EAAE;GACvB,4CAAI,kBAASH,IAAI;GACjB,4CAAI,kBAAS5Q,MAAM,CAAC4Q,IAAI,CAACI,OAAO,CAACC,IAAI,CAAC;GACtC,4CAAI,sBAAW;KAAEhF,CAAC,EAAEjM,MAAM,CAAC4Q,IAAI,CAACI,OAAO,CAAC/E,CAAC,CAAC;KAAEE,CAAC,EAAEnM,MAAM,CAAC4Q,IAAI,CAACI,OAAO,CAAC7E,CAAC;IAAG;GACvE,4CAAI,gCAAgB/V,MAAM,CAAC8a,OAAO,CAAC,4BAA4B,CAAC;GAChE,4CAAI,4DAAU,IAAI,+BAAe;GACjC,4CAAI,4BAAcL,KAAK;GACvB,4CAAI,4BAAcC,KAAK;GACvB,4CAAI,gFAAoB,IAAI,mDAAyB;GACrD,4CAAI,gCAAgB,EAAE;GACtB,4CAAI,4CAAsB,EAAE;GAC5B,4CAAI,4BAAc;KAAE7E,CAAC,EAAE,CAAC;KAAEE,CAAC,EAAE,CAAC;KAAEgF,KAAK,EAAE,CAAC;KAAEC,KAAK,EAAE;IAAG;GACpD,4CAAI,8BAAe,EAAE;GACrB,4CAAI,4CAAsBza,aAAG,CAAC6C,QAAQ,yCAAC,IAAI,+BAAe,QAAQ,CAAC,GAAGhI,iDAAW,CAAC8R,IAAI,GAAG9R,iDAAW,CAACF,UAAU;GAC/GqF,aAAG,CAAC0a,QAAQ,CAACT,IAAI,EAAE,iBAAiB,CAAC;GACrCja,aAAG,CAAC0a,QAAQ,CAAC,4CAAI,8BAAc9Z,aAAa,CAACA,aAAa,EAAE,QAAQ,CAAC;GACrE,4CAAI,sGAA8B,IAAI;GACtC,4CAAI;GACJJ,eAAK,CAACC,IAAI,CAAC6B,QAAQ,EAAE,WAAW,0CAAE,IAAI,wCAAmB;GACzD9B,eAAK,CAACC,IAAI,CAAC6B,QAAQ,EAAE,SAAS,0CAAE,IAAI,oCAAiB;GACrD9B,eAAK,CAACC,IAAI,CAAC6B,QAAQ,EAAE,OAAO,0CAAE,IAAI,0CAAoB;GACtDsB,6BAAY,CAACC,IAAI,CAAC3R,MAAM,CAACkB,yBAAyB,EAAE;KAAEunB,kBAAkB,EAAE;IAAO,CAAC;GAClF,MAAM9hB,SAAS,GAAGwQ,MAAM,CAAC,4CAAI,8BAAcgR,OAAO,CAACplB,EAAE,CAAC;GACtD2O,6BAAY,CAACC,IAAI,CAAC3R,MAAM,CAACa,cAAc,EAAE;KAAE8F;IAAW,CAAC;CACxD;CAAC,uBAEY;GAAEqhB,KAAK;GAAEC;CAAkB,CAAC,EACzC;GACCna,aAAG,CAAC0a,QAAQ,yCAAC,IAAI,+BAAe,UAAU,CAAC;GAC3C1a,aAAG,CAAC0a,QAAQ,CAAC,4CAAI,gBAAO9Z,aAAa,EAAE,uBAAuB,CAAC;GAC/DZ,aAAG,CAAC4a,WAAW,yCAAC,IAAI,uCAAmB,CAAC,UAAU,EAAE,iBAAiB,CAAC,CAAC;GACvE5a,aAAG,CAAC6a,KAAK,yCAAC,IAAI,uCAAmB,QAAQ,EAAG,GAAE,4CAAI,8BAAc7G,YAAa,IAAG,CAAC;GACjF,4CAAI;GACJ,4CAAI,0BAAYwG,KAAK,GAAG,4CAAI,0BAAYlF,CAAC;GACzC,4CAAI,0BAAYmF,KAAK,GAAG,4CAAI,0BAAYjF,CAAC;GACzC,4CAAI,0BAAYF,CAAC,IAAI,CAAC4E,KAAK,2CAAG,IAAI,yBAAW,4CAAI,IAAI,eAAM;GAC3D,4CAAI,0BAAY1E,CAAC,IAAI,CAAC2E,KAAK,2CAAG,IAAI,yBAAW,4CAAI,IAAI,eAAM;GAC3D,4CAAI,4BAAcD,KAAK;GACvB,4CAAI,4BAAcC,KAAK;GACvB,4CAAI,0CAAoBhjB,OAAO,CAAE2jB,YAAY,4CAAK,IAAI,gCAAeA,YAAY,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;GACzF,4CAAI,4CAAsB,EAAE;GAC5B,MAAM;KAAEC,UAAU;KAAEC;IAAY,2CAAG,IAAI,uDAA2B;GAClE,4CAAI,0BAAY1F,CAAC,GAAGyF,UAAU,KAAK,CAAC,GACjC,4CAAI,0BAAYzF,CAAC,GACjB,4CAAI,0BAAYA,CAAC,GAAGyF,UAAU,GAAGjB,iBAAiB,2CAAG,IAAI,eAAM;GAClE,4CAAI,0BAAYtE,CAAC,GAAGwF,UAAU,KAAK,CAAC,GACjC,4CAAI,0BAAYxF,CAAC,GACjB,4CAAI,0BAAYA,CAAC,GAAGwF,UAAU,GAAGlB,iBAAiB,2CAAG,IAAI,eAAM;GAClE,4CAAI,wEAAe,IAAI,mBAAS,4CAAI,0BAAYxE,CAAC,EAAE,4CAAI,0BAAYE,CAAC,EAAE,CAAC;GACvE,4CAAI,sGAA8B,IAAI;GACtC,4CAAI,sEAAe,IAAI,mCAAiB;GACxC,IAAI,CAAC,4CAAI,4BAAayF,SAAS,EAC/B;KACC;;GAGD,MAAM;KAAEA,SAAS;KAAEvP,UAAU;KAAEF;IAAe,2CAAG,IAAI,2BAAY;GACjE,IAAI,CAACA,aAAa,EAClB;KACCxL,aAAG,CAAC0a,QAAQ,yCAAC,IAAI,uCAAmB,iBAAiB,CAAC;;GAGvD,4CAAI,8DAA8BhP,UAAU;GAC5C,QAAQuP,SAAS;KAEhB,KAAK,SAAS;OACd;SACC,MAAMC,aAAa,2CAAG,IAAI,kCAAgBxP,UAAU,CAAC;SACrD,4CAAI,4CAAsBwP,aAAa;SACvC;;KAED,KAAK,cAAc;KACnB,KAAK,eAAe;OACpB;SACC,MAAMA,aAAa,2CAAG,IAAI,sDAA0BxP,UAAU,EAAEuP,SAAS,CAAC;SAC1E,4CAAI,4CAAsBC,aAAa;SACvC;;KAED;OACClb,aAAG,CAAC0a,QAAQ,yCAAC,IAAI,uCAAmB,UAAU,CAAC;OAC/C1a,aAAG,CAAC6a,KAAK,yCAAC,IAAI,uCAAmB,QAAQ,EAAG,GAAEnP,UAAU,CAACsI,YAAa,IAAG,CAAC;;CAE7E;CAAC,uBAGD;GACC,4CAAI,0BAAY,IAAI;GACpBxT,eAAK,CAACO,MAAM,CAACuB,QAAQ,EAAE,WAAW,0CAAE,IAAI,wCAAmB;GAC3D9B,eAAK,CAACO,MAAM,CAACuB,QAAQ,EAAE,SAAS,0CAAE,IAAI,oCAAiB;GACvD9B,eAAK,CAACO,MAAM,CAACuB,QAAQ,EAAE,SAAS,0CAAE,IAAI,0CAAoB;GAC1D,4CAAI,0CAAoBnL,OAAO,CAAEhB,IAAI,4CAAK,IAAI,gCAAeA,IAAI,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;GACzE6J,aAAG,CAAC4a,WAAW,yCAAC,IAAI,iBAAQ,iBAAiB,CAAC;GAC9C5a,aAAG,CAAC4a,WAAW,CAAC,4CAAI,8BAAcha,aAAa,CAACA,aAAa,EAAE,QAAQ,CAAC;GACxEZ,aAAG,CAAC4a,WAAW,yCAAC,IAAI,+BAAe,UAAU,CAAC;GAC9C5a,aAAG,CAAC4a,WAAW,CAAC,4CAAI,gBAAOha,aAAa,EAAE,uBAAuB,CAAC;GAClEZ,aAAG,CAACsU,MAAM,yCAAC,IAAI,kBAAQ;GACvBtU,aAAG,CAACsU,MAAM,yCAAC,IAAI,sCAAkB;GACjC,4CAAI;GACJ1Q,6BAAY,CAACC,IAAI,CAAC3R,MAAM,CAACkB,yBAAyB,EAAE;KAAEunB,kBAAkB,EAAE;IAAM,CAAC;GACjF,MAAM;KAAEM,SAAS;KAAEvP,UAAU;KAAEF;IAAe,2CAAG,IAAI,2BAAY;GACjE,IAAI,CAACyP,SAAS,IAAI,CAACzP,aAAa,EAChC;KACC;;GAGD,MAAM2P,YAAY,GAAG,CAAC,GAAG,4CAAI,8BAAcva,aAAa,CAAC/I,QAAQ,CAAC,CAACsE,OAAO,yCAAC,IAAI,8BAAc;GAC7F,MAAMD,WAAW,GAAG,CAAC,GAAGwP,UAAU,CAAC9K,aAAa,CAAC/I,QAAQ,CAAC,CAACsE,OAAO,CAACuP,UAAU,CAAC;GAC9E,MAAM7S,SAAS,GAAGwQ,MAAM,CAAC,4CAAI,8BAAcgR,OAAO,CAACplB,EAAE,CAAC;GACtD2O,6BAAY,CAACC,IAAI,CAAC3R,MAAM,CAACc,cAAc,EAAE;KACxC6F,SAAS;KACToD,QAAQ,EAAEoN,MAAM,CAACqC,UAAU,CAAC2O,OAAO,CAACplB,EAAE,CAAC;KACvCiH,WAAW;KACXgf,aAAa,EAAE,4CAAI,0CAAoB7hB,GAAG,CAAElD,IAAI,IAAKkT,MAAM,CAAClT,IAAI,CAACkkB,OAAO,CAACplB,EAAE,CAAC,CAAC;KAC7E6D,SAAS,EAAEqiB,YAAY,GAAGjf,WAAW,GAAG,CAAC,GAAG,CAAC,CAAC;KAC9C+e;IACA,CAAC;CACH;CAAC,wBAEa;GAAEG;CAAqB,CAAC,EACtC;GACC,IAAIA,QAAQ,EACZ;KACC,MAAMC,cAAc,GAAGhS,MAAM,CAAC,4CAAI,gBAAOgR,OAAO,CAAC/E,CAAC,CAAC;KACnD,MAAMgG,SAAS,GAAGD,cAAc,GAAG,4CAAI,oBAAS/F,CAAC;KACjD,4CAAI,0BAAYA,CAAC,IAAIgG,SAAS,2CAAG,IAAI,eAAM;KAC3C,4CAAI,oBAAShG,CAAC,GAAG+F,cAAc;IAC/B,MAED;KACC,MAAME,cAAc,GAAGlS,MAAM,CAAC,4CAAI,gBAAOgR,OAAO,CAAC7E,CAAC,CAAC;KACnD,MAAMgG,SAAS,GAAGD,cAAc,GAAG,4CAAI,oBAAS/F,CAAC;KACjD,4CAAI,0BAAYA,CAAC,IAAIgG,SAAS,2CAAG,IAAI,eAAM;KAC3C,4CAAI,oBAAShG,CAAC,GAAG+F,cAAc;;GAGhC,4CAAI,wEAAe,IAAI,mBAAS,4CAAI,0BAAYjG,CAAC,EAAE,4CAAI,0BAAYE,CAAC,EAAE,CAAC;CACxE;CAAC,yBAGD;GACC,MAAMiG,KAAK,GAAG,4CAAI,8BAAcC,SAAS,CAAC,IAAI,CAAC;GAC/C1b,aAAG,CAAC0a,QAAQ,CAACe,KAAK,EAAE,gCAAgC,CAAC;GACrDzb,aAAG,CAAC4a,WAAW,CAACa,KAAK,EAAE,CAAC,YAAY,EAAE,WAAW,CAAC,CAAC;GACnD,MAAM;KAAEnG,CAAC,EAAEqG,KAAK;KAAEnG,CAAC,EAAEoG;IAAO,GAAG,4CAAI,gBAAO7G,qBAAqB,EAAE;GACjE,MAAM;KAAEO,CAAC,EAAEuG,QAAQ;KAAErG,CAAC,EAAEsG;IAAU,GAAG,4CAAI,8BAAc/G,qBAAqB,EAAE;GAC9E,MAAMrC,IAAI,GAAGmJ,QAAQ,GAAGF,KAAK;GAC7B,MAAM7G,GAAG,GAAGgH,QAAQ,GAAGF,KAAK;GAC5B5b,aAAG,CAAC6a,KAAK,CAACY,KAAK,EAAE,MAAM,EAAG,GAAE/I,IAAI,2CAAG,IAAI,eAAO,IAAG,CAAC;GAClD1S,aAAG,CAAC6a,KAAK,CAACY,KAAK,EAAE,KAAK,EAAG,GAAE3G,GAAG,2CAAG,IAAI,eAAO,IAAG,CAAC;GAChD9U,aAAG,CAAC+b,MAAM,CAACN,KAAK,0CAAE,IAAI,gBAAO;GAE7B,OAAOA,KAAK;CACb;CAAC,mCAGD;GACC,MAAM;KAAEO,WAAW;KAAEhI;IAAc,2CAAG,IAAI,6BAAa;GACvD,MAAMiI,IAAI,GAAGjc,aAAG,CAAC6C,QAAQ,yCAAC,IAAI,+BAAe,QAAQ,CAAC,GACnDpM,aAAG,CAACC,UAAU,CAAC,kDAAkD,CAAC,GAClED,aAAG,CAACC,UAAU,CAAC,wDAAwD,CAAC;GAC3E,MAAMwlB,eAAe,GAAGC,aAAG,CAACC,MAAM,cAAC;;;oBAGnB,CAAc,eAAY,CAAe;;;;aAIhD,CAAO;;;;;QAKZ,CAAwE;;;;GAI5E,GAbkBJ,WAAW,EAAehI,YAAY,EAI7CiI,IAAI,EAKTxlB,aAAG,CAACC,UAAU,CAAC,qDAAqD,CAAC,CAI1E;GACDsJ,aAAG,CAAC+b,MAAM,CAACG,eAAe,0CAAE,IAAI,gBAAO;GACvC,4CAAI,sGAA8B,IAAI;GAEtC,OAAOA,eAAe;CACvB;CAAC,wBAEaG,OAAoB,EAAE/G,CAAS,EAAEE,CAAS,EAAE8G,QAAgB,GAAG,CAAC,EAC9E;GACC,IAAIhH,CAAC,KAAK,CAAC,IAAIE,CAAC,KAAK,CAAC,EACtB;KACCxV,aAAG,CAAC6a,KAAK,CAACwB,OAAO,EAAE,WAAW,EAAE,EAAE,CAAC;KAEnC;;GAGDrc,aAAG,CAAC6a,KAAK,CAACwB,OAAO,EAAE,WAAW,EAAG,eAAc/G,CAAE,OAAME,CAAE,iBAAgB8G,QAAS,MAAK,CAAC;CACzF;CAAC,uCAE4B3H,IAAiB,EAC9C;GACC,MAAM;KAAEW,CAAC,EAAEqG,KAAK;KAAEnG,CAAC,EAAEoG;IAAO,GAAG,4CAAI,gBAAO7G,qBAAqB,EAAE;GACjE,MAAM;KAAEO,CAAC,EAAEiH,KAAK;KAAE/G,CAAC,EAAEgH;IAAO,GAAG7H,IAAI,CAACI,qBAAqB,EAAE;GAC3D,MAAMO,CAAC,GAAG,CAACiH,KAAK,GAAGZ,KAAK,4CAAI,IAAI,eAAM;GACtC,MAAMnG,CAAC,GAAG,CAACgH,KAAK,GAAGZ,KAAK,4CAAI,IAAI,eAAM;GACtC,4CAAI,wEAAe,IAAI,uCAAmBtG,CAAC,EAAEE,CAAC;CAC/C;CAAC,2BAGD;GACCxV,aAAG,CAAC0a,QAAQ,yCAAC,IAAI,mBAAS,mBAAmB,CAAC;GAC9C,4CAAI,wEAAe,IAAI,mBAAS,4CAAI,0BAAYpF,CAAC,EAAE,4CAAI,0BAAYE,CAAC;GACpE,MAAMiH,gBAAgB,GAAG,GAAG;GAC5B,MAAMC,gCAAgC,GAAG,GAAG;GAC5C,MAAM;KACLpH,CAAC;KACDE,CAAC;KACD1X,KAAK,EAAE6e,YAAY;KACnB5e,MAAM,EAAE6e;IACR,GAAG,4CAAI,kBAAQ7H,qBAAqB,EAAE;GACvC,4CAAI,wEAAe,IAAI,mBAAS,4CAAI,0BAAYO,CAAC,EAAE,4CAAI,0BAAYE,CAAC,EAAE,CAAC;GACvE,MAAMqH,MAAM,GAAG,CACd;KAAEvH,CAAC;KAAEE;IAAG,EACR;KAAEF,CAAC,EAAEA,CAAC,GAAGqH,YAAY;KAAEnH;IAAG,EAC1B;KAAEF,CAAC;KAAEE,CAAC,EAAEA,CAAC,GAAGoH;IAAe,EAC3B;KAAEtH,CAAC,EAAEA,CAAC,GAAGqH,YAAY;KAAEnH,CAAC,EAAEA,CAAC,GAAGoH;IAAe,EAC7C;KAAEtH,CAAC;KAAEE,CAAC,EAAEA,CAAC,GAAGoH,aAAa,GAAG;IAAG,EAC/B;KAAEtH,CAAC,EAAEA,CAAC,GAAGqH,YAAY;KAAEnH,CAAC,EAAEA,CAAC,GAAGoH,aAAa,GAAG;IAAG,CACjD;GACD,MAAME,UAAU,GAAGD,MAAM,CAAC3F,MAAM,CAAC,CAACC,GAAG,EAAE4F,KAAK,EAAEC,CAAC,KAAK;KACnD,IAAI7F,GAAG,CAAC8D,SAAS,EACjB;OACC,OAAO9D,GAAG;;KAGX,MAAM8F,SAAS,GAAG3a,QAAQ,CAAC4a,gBAAgB,CAACH,KAAK,CAACzH,CAAC,EAAEyH,KAAK,CAACvH,CAAC,CAAC;KAC7D,MAAM2H,iBAAiB,GAAGF,SAAS,oBAATA,SAAS,CAAE1C,OAAO,CAAC,oCAAoC,CAAC;KAClF,MAAM7O,UAAU,GAAGyR,iBAAiB,oBAAjBA,iBAAiB,CAAEvc,aAAa;KACnD,IAAI,CAAC8K,UAAU,IAAIA,UAAU,6CAAK,IAAI,6BAAa,EACnD;OACC,OAAOyL,GAAG;;KAGX,MAAM;OACL7B,CAAC,EAAE8H,OAAO;OACV5H,CAAC,EAAE6H,OAAO;OACVvf,KAAK,EAAEwf,WAAW;OAClBvf,MAAM,EAAEwf;MACR,GAAG7R,UAAU,CAACqJ,qBAAqB,EAAE;KACtC,MAAMyI,UAAU,GAAG,4CAAI,8BAAc5c,aAAa,KAAK8K,UAAU,CAAC9K,aAAa;KAC/E,MAAM6c,iBAAiB,GAAG,4CAAI,0CAAoBC,yBAAyB,CAC1ErU,MAAM,CAACqC,UAAU,CAAC9K,aAAa,CAACA,aAAa,CAACyZ,OAAO,CAACplB,EAAE,CAAC,CACzD;KACD,MAAM0oB,SAAS,GAAGX,CAAC,KAAK,CAAC,IAAI,CAAChd,aAAG,CAAC6C,QAAQ,CAAC6I,UAAU,EAAE,QAAQ,CAAC,IAAI+R,iBAAiB;KACrFtG,GAAG,CAACzL,UAAU,GAAGA,UAAU;KAC3B,IAAI8R,UAAU,IAAIlI,CAAC,GAAGmH,gBAAgB,GAAGE,YAAY,GAAGS,OAAO,GAAGE,WAAW,IAAIK,SAAS,EAC1F;OACC,OAAO;SAAE,GAAGxG,GAAG;SAAE8D,SAAS,EAAE;QAAW;;KAGxC,IAAI,CAACuC,UAAU,IAAIhI,CAAC,GAAGkH,gCAAgC,GAAGE,aAAa,GAAGS,OAAO,GAAGE,YAAY,IAAII,SAAS,EAC7G;OACC,OAAO;SACN,GAAGxG,GAAG;SACN8D,SAAS,EAAE3F,CAAC,GAAG8H,OAAO,GAAGE,WAAW,GAAG,CAAC,GAAG,cAAc,GAAG;QAC5D;;KAGF,MAAMM,wBAAwB,GAAG5d,aAAG,CAAC6C,QAAQ,CAAC6I,UAAU,EAAE,QAAQ,CAAC,IAAI,CAAC1L,aAAG,CAAC6C,QAAQ,yCAAC,IAAI,+BAAe,QAAQ,CAAC;KACjH,MAAMgb,gBAAgB,GAAG,4CAAI,8BAAcjd,aAAa,CAACA,aAAa,KAAK8K,UAAU;KACrF,IAAIkS,wBAAwB,IAAIC,gBAAgB,EAChD;OACC,IAAID,wBAAwB,EAC5B;SACC5d,aAAG,CAAC0a,QAAQ,CAAChP,UAAU,EAAE,QAAQ,CAAC;SAClC,4CAAI,8BAAcpM,IAAI,CAACoM,UAAU,CAAC;;OAGnC,OAAOyL,GAAG;;KAGX,OAAO;OACN,GAAGA,GAAG;OACN8D,SAAS,EAAE,QAAQ;OACnBzP,aAAa,EAAE,4CAAI,0CAAoBsS,oBAAoB,CAC1DzU,MAAM,CAACqC,UAAU,CAAC2O,OAAO,CAACplB,EAAE,CAAC,0CAC7B,IAAI;MAEL;IACD,EAAE;KAAEuW,aAAa,EAAE;IAAM,CAAC;GAE3BxL,aAAG,CAAC4a,WAAW,yCAAC,IAAI,mBAAS,mBAAmB,CAAC;GAEjD,OAAOkC,UAAU;CAClB;CAAC,yBAEcpR,UAAuB,EACtC;GACC,MAAM7T,QAAQ,GAAG,CAAC,GAAG,4CAAI,8BAAc+I,aAAa,CAAC/I,QAAQ,CAAC;GAC9D,MAAMsjB,YAAY,GAAGtjB,QAAQ,CAACsE,OAAO,yCAAC,IAAI,8BAAc;GACxD,MAAMD,WAAW,GAAG,CAAC,GAAGwP,UAAU,CAAC9K,aAAa,CAAC/I,QAAQ,CAAC,CAACsE,OAAO,CAACuP,UAAU,CAAC;GAC9E,MAAM5S,SAAS,GAAGqiB,YAAY,GAAGjf,WAAW,GAAG,CAAC,GAAG,CAAC,CAAC;GACrD,MAAMgf,aAAa,GAAGpiB,SAAS,GAAG,CAAC,GAChCjB,QAAQ,CAACkmB,KAAK,CAAC5C,YAAY,GAAG,CAAC,EAAEjf,WAAW,GAAG,CAAC,CAAC,GACjDrE,QAAQ,CAACkmB,KAAK,CAAC7hB,WAAW,EAAEif,YAAY,CAAC;GAC5CD,aAAa,CAAC/jB,OAAO,CAAE2jB,YAAY,4CAAK,IAAI,gCAAeA,YAAY,EAAE,CAAChiB,SAAS,GAAG+gB,UAAU,EAAE,CAAC,CAAC,CAAC;GAErG,OAAOqB,aAAa;CACrB;CAAC,mCAEwBxP,UAAuB,EAAEuP,SAAiB,EACnE;GACC,MAAMpjB,QAAQ,GAAG,CAAC,GAAG6T,UAAU,CAAC9K,aAAa,CAAC/I,QAAQ,CAAC;GACvD,MAAMqE,WAAW,GAAGrE,QAAQ,CAACsE,OAAO,CAACuP,UAAU,CAAC;GAChD,IAAIwP,aAAa,GAAG,EAAE;GACtB,IAAID,SAAS,KAAK,eAAe,EACjC;KACCC,aAAa,GAAGrjB,QAAQ,CAACkmB,KAAK,CAAC,CAAC,EAAE7hB,WAAW,GAAG,CAAC,CAAC;KAClDgf,aAAa,CAAC/jB,OAAO,CAAE2jB,YAAY,4CAAK,IAAI,gCAAeA,YAAY,EAAE,CAACjB,UAAU,EAAE,CAAC,CAAC,CAAC;IACzF,MAED;KACCqB,aAAa,GAAGrjB,QAAQ,CAACkmB,KAAK,CAAC7hB,WAAW,CAAC;KAC3Cgf,aAAa,CAAC/jB,OAAO,CAAE2jB,YAAY,4CAAK,IAAI,gCAAeA,YAAY,EAAEjB,UAAU,EAAE,CAAC,CAAC,CAAC;;GAGzF,OAAOqB,aAAa;CACrB;CAAC,qCAGD;GACC,IAAIH,UAAU,GAAG,CAAC;GAClB,IAAIC,UAAU,GAAG,CAAC;GAClB,MAAM;KAAEtI,IAAI;KAAEoC;IAAK,GAAG,4CAAI,8BAAcC,qBAAqB,EAAE;GAC/D,MAAMiJ,UAAU,GAAGtL,IAAI,2CAAG,IAAI,eAAM;GACpC,MAAMuL,SAAS,GAAGnJ,GAAG,2CAAG,IAAI,eAAM;GAClC,IAAIkJ,UAAU,GAAG,4CAAI,0BAAY1I,CAAC,GAAG,CAAC,EACtC;KACCyF,UAAU,GAAG,4CAAI,0BAAYzF,CAAC,GAAG,4CAAI,0BAAYkF,KAAK,GAAG,CAAC,CAAC,GAAG,CAAC;;GAGhE,IAAIwD,UAAU,GAAG,4CAAI,0BAAY1I,CAAC,GAAG,4CAAI,8BAAc0G,WAAW,GAAG1Z,QAAQ,CAAC4b,IAAI,CAAClC,WAAW,2CAAG,IAAI,eAAM,EAC3G;KACCjB,UAAU,GAAG,4CAAI,0BAAYzF,CAAC,GAAG,4CAAI,0BAAYkF,KAAK,GAAG,CAAC,GAAG,CAAC;;GAG/D,IAAIyD,SAAS,GAAG,4CAAI,0BAAYzI,CAAC,GAAG,CAAC,EACrC;KACCwF,UAAU,GAAG,4CAAI,0BAAYxF,CAAC,GAAG,4CAAI,0BAAYiF,KAAK,GAAG,CAAC,CAAC,GAAG,CAAC;;GAGhE,IAAIwD,SAAS,GAAG,4CAAI,0BAAYzI,CAAC,GAAG,4CAAI,8BAAcxB,YAAY,GAAG1R,QAAQ,CAAC4b,IAAI,CAAClK,YAAY,2CAAG,IAAI,eAAM,EAC5G;KACCgH,UAAU,GAAG,4CAAI,0BAAYxF,CAAC,GAAG,4CAAI,0BAAYiF,KAAK,GAAG,CAAC,GAAG,CAAC;;GAG/D,IAAIM,UAAU,KAAK,CAAC,IAAIC,UAAU,KAAK,CAAC,EACxC;KACCpX,6BAAY,CAACC,IAAI,CAAC3R,MAAM,CAACe,6BAA6B,EAAE;OACvD8nB,UAAU;OACVC,UAAU;OACVmD,KAAK,EAAErE;MACP,CAAC;;GAGH,OAAO;KACNiB,UAAU;KACVC;IACA;CACF;CAAC,qBAEUoD,WAAqB,EAChC;GACCpe,aAAG,CAAC6a,KAAK,CAACvY,QAAQ,CAAC4b,IAAI,EAAE,YAAY,EAAE,MAAM,CAAC;GAC9Cle,aAAG,CAAC6a,KAAK,CAACvY,QAAQ,CAAC4b,IAAI,EAAE,qBAAqB,EAAE,MAAM,CAAC;GACvDle,aAAG,CAAC6a,KAAK,CAACvY,QAAQ,CAAC4b,IAAI,EAAE,QAAQ,EAAE,UAAU,CAAC;GAC9C,IAAIE,WAAW,EACf;KACCpe,aAAG,CAAC6a,KAAK,CAACvY,QAAQ,CAAC4b,IAAI,EAAE,YAAY,EAAE,EAAE,CAAC;KAC1Cle,aAAG,CAAC6a,KAAK,CAACvY,QAAQ,CAAC4b,IAAI,EAAE,qBAAqB,EAAE,EAAE,CAAC;KACnDle,aAAG,CAAC6a,KAAK,CAACvY,QAAQ,CAAC4b,IAAI,EAAE,QAAQ,EAAE,EAAE,CAAC;;CAExC;CAAC,4BAGD;GACC,4CAAI,8BAAc/mB,OAAO,CAAEwV,IAAI,IAAK3M,aAAG,CAAC4a,WAAW,CAACjO,IAAI,EAAE,QAAQ,CAAC,CAAC;CACrE;;CCrbM,MAAM0R,WAAW,GAAG;GAC1BzpB,OAAO,CAACkI,EAAe,EACvB;KACC,IAAIid,sBAAsB,CAACjd,EAAE,CAAC;IAC9B;GACDwhB,OAAO,CAACxhB,EAAe,EAAE;KAAEmE;IAAe,EAC1C;KACC,MAAM;OAAEqU,CAAC;OAAEE,CAAC;OAAE8E;MAAM,GAAGrZ,KAAK;KAC5BnE,EAAE,CAACyhB,YAAY,CAAC,WAAW,EAAEjE,IAAI,CAAC;KAClCxd,EAAE,CAACyhB,YAAY,CAAC,QAAQ,EAAEjJ,CAAC,CAAC;KAC5BxY,EAAE,CAACyhB,YAAY,CAAC,QAAQ,EAAE/I,CAAC,CAAC;;CAE9B,CAAC;;CCWD;AACA,CAAO,MAAMgJ,IAAI,GAAG;GACnBpqB,IAAI,EAAE,aAAa;GAEnBC,UAAU,EAAE;KACX8c,QAAQ;KACR6E,UAAU;oCACVyI,iFAA6B;wBAC7BC;IACA;GAED9hB,UAAU,EAAE;KAAE+hB,GAAG,EAAEN;IAAa;GAEhCO,OAAO,GACP;KACC,OAAO;OACNlJ,aAAa,EAAE,MAAM,IAAI,CAACA,aAAa;MACvC;IACD;GAEDjM,KAAK,EAAE;KACNoV,eAAe,EAAE;OAChB1gB,IAAI,EAAEhM,MAAM;OACZwX,QAAQ,EAAE;;IAEX;GAEDpV,KAAK,EAAE,CAAC,QAAQ,EAAE,YAAY,EAAE,eAAe,CAAC;GAEhDC,IAAI,GACJ;KACC,OAAO;OACN+c,aAAa,EAAE,EAAE;OACjB2E,0BAA0B,EAAE,KAAK;OACjC4I,QAAQ,EAAE,KAAK;OACfrN,oBAAoB,EAAE,IAAI;OAC1BC,iBAAiB,EAAE,KAAK;OACxBqN,eAAe,EAAE,IAAI;OACrBC,wBAAwB,EAAE,KAAK;OAC/BC,iBAAiB,EAAE,KAAK;OACxBC,wBAAwB,EAAE,EAAE;OAC5BC,kBAAkB,EAAE,IAAI;OACxBC,aAAa,EAAE;MACf;IACD;GAEDzqB,QAAQ,EACR;KACC2C,UAAU,GACV;OAAA;OACC,OAAO,8BAAI,CAAC4B,WAAW,CAAC1B,GAAG,CAAC,IAAI,CAACqC,WAAW,CAAC,qBAAtC,sBAAwCvC,UAAU,KAAI,EAAE;MAC/D;KACD+nB,MAAM,GACN;OACC,MAAM;SAAEpqB,EAAE,EAAEoqB;QAAQ,GAAG,CAAC,GAAG,IAAI,CAACnmB,WAAW,CAAC8P,MAAM,EAAE,CAAC,CAACxC,IAAI,CAAE7L,UAAU,IAAK;SAC1E,OAAOA,UAAU,CAACvD,QAAQ,KAAK,CAAC;QAChC,CAAC;OAEF,OAAOioB,MAAM;MACb;KACDjJ,UAAU,GACV;OACC,OAAO,IAAI,CAACjW,KAAK,CAACiW,UAAU;MAC5B;KACDkJ,mBAAmB,GACnB;OACC,MAAMlZ,gBAAgB,GAAG,IAAI,CAAClN,WAAW,CAAC1B,GAAG,CAAC,IAAI,CAAC2nB,kBAAkB,CAAChZ,kBAAkB,CAAC;OACzF,MAAMoZ,MAAM,GAAGnZ,gBAAgB,CAAC9O,UAAU,KAAKuD,iDAAW,CAAC8R,IAAI,GAAG,mEAAmE,GAClI,yEAAyE;OAG5E,OAAOlW,aAAG,CAACC,UAAU,CAAC6oB,MAAM,EAAE;SAC7B,aAAa,EAAEC,cAAI,CAACC,MAAM,CAAC,IAAI,CAACN,kBAAkB,CAACnkB,IAAI,CAAC5G,IAAI,CAAC;SAC7D,mBAAmB,EAAEorB,cAAI,CAACC,MAAM,CAACrZ,gBAAgB,CAAChS,IAAI,CAAC;SACvD,QAAQ,EAAG,iFAAgF,IAAI,CAAC+qB,kBAAkB,CAACnkB,IAAI,CAAC2P,GAAI,IAAG;SAC/H,SAAS,EAAE;QACX,CAAC;MACF;KACD,GAAG1N,sBAAQ,CAAC1D,wDAAa,EAAE,CAAC,oBAAoB,EAAE,QAAQ,EAAE,aAAa,EAAE,aAAa,CAAC;IACzF;GAEDgE,OAAO,GACP;KACC,IAAI,CAAC4Y,SAAS,GAAG,IAAIjf,GAAG,EAAE;KAC1B,IAAI,CAACmf,iBAAiB,EAAE;KACxB,IAAI,CAACqJ,SAAS,CAAC,CAAC,IAAI,CAACL,MAAM,CAAC,CAAC;IAC7B;GAEDzqB,OAAO,GACP;KACC,MAAM+qB,iBAAiB,GAAG,IAAI,CAACC,8BAA8B,EAAE;KAC/D,IAAI,CAACC,yBAAyB,GAAG,CAACF,iBAAiB,CAAC;KAEpD,IAAIA,iBAAiB,KAAK,IAAI,CAACN,MAAM,EACrC;OACC,IAAI,CAACS,uBAAuB,CAACH,iBAAiB,CAAC;OAC/C,IAAI,CAAC9iB,KAAK,CAAC8iB,iBAAiB,EAAE;SAAEI,gBAAgB,EAAE;QAAM,CAAC;OAEzD;;KAGD,IAAI,CAACC,sBAAsB,EAAE;KAC7B,IAAI,CAACnjB,KAAK,CAAC8iB,iBAAiB,CAAC;IAC7B;GAEDnJ,aAAa,GACb;KACC,IAAI,CAACC,qBAAqB,EAAE;IAC5B;GAEDpgB,OAAO,EACP;KACCupB,8BAA8B,GAC9B;OACC,MAAMK,mBAAmB,GAAGxX,wBAAwB,CAACC,SAAS,EAAE,CAACE,WAAW;OAC5E,IAAIqX,mBAAmB,EACvB;SACC,MAAMtL,IAAI,GAAG,IAAI,CAACzb,WAAW,CAAC1B,GAAG,CAACyoB,mBAAmB,CAAC;SACtD,IAAItL,IAAI,EACR;WACC,OAAOsL,mBAAmB;;;OAI5B,KAAK,MAAMC,mBAA2B,IAAI,IAAI,CAAC/mB,kBAAkB,EACjE;SACC,MAAMwb,IAAI,GAAG,IAAI,CAACzb,WAAW,CAAC1B,GAAG,CAAC0oB,mBAAmB,CAAC;SAEtD,IAAIvL,IAAI,CAACrd,UAAU,KAAKuD,iDAAW,CAACF,UAAU,EAC9C;WACC,OAAOulB,mBAAmB;;;OAI5B,OAAO,IAAI,CAACb,MAAM;MAClB;KACDlqB,GAAG,CAACmB,UAAkB,EAAEC,YAAmC,GAAG,EAAE,EAChE;OACC,OAAO,IAAI,CAACC,OAAO,CAACC,GAAG,CAACC,UAAU,CAACJ,UAAU,EAAEC,YAAY,CAAC;MAC5D;KACDmf,aAAa,GACb;OACC,OAAO,IAAI,CAAC3B,GAAG,CAACgB,qBAAqB,EAAE;MACvC;KACDoL,mBAAmB,CAAC;OAAE3rB;MAAyB,EAC/C;OACC,MAAM;SAAES,EAAE;SAAEgf;QAAM,GAAGzf,IAAI;OACzB,IAAI,CAAC2hB,SAAS,CAACxe,GAAG,CAAC1C,EAAE,EAAEgf,IAAI,CAAC;OAC5B,MAAMmM,mBAAmB,GAAG,IAAI,CAACR,8BAA8B,EAAE;OACjE,IAAI3qB,EAAE,KAAKmrB,mBAAmB,IAAI,CAAC,IAAI,CAACtB,QAAQ;;SAChD;WACC,MAAMuB,WAAW,GAAG,IAAI;WACxB,IAAI,CAACvB,QAAQ,GAAG,IAAI;WACpBwB,iBAAO,CAACC,QAAQ,CAAC,MAAM;aACtB,IAAI,CAACC,MAAM,CAACJ,mBAAmB,CAAC;YAChC,EAAEC,WAAW,CAAC,EAAE;;MAElB;KACDI,sBAAsB,CAAC;OAAEjsB;MAAyB,EAClD;OACC,MAAM;SAAES;QAAI,GAAGT,IAAI;OACnB,MAAMmG,UAAU,GAAG,IAAI,CAACzB,WAAW,CAAC1B,GAAG,CAACvC,EAAE,CAAC;OAC3C,OAAO0F,UAAU,CAACgB,YAAY;OAC9B,IAAI,CAAChB,UAAU,CAACvD,QAAQ,EACxB;SACC4B,eAAe,CAACjB,gBAAgB,CAAC9C,EAAE,CAAC;;MAErC;KACDyrB,YAAY,CAAC;OAAElsB;MAAiB,EAChC;OACC,MAAM;SAAEqE;QAAW,GAAGrE,IAAI;OAC1B,IAAI,IAAI,CAAC+c,aAAa,CAAC/V,QAAQ,CAAC3C,SAAS,CAAC,EAC1C;SACC,IAAI,CAAC8nB,mBAAmB,CAAC9nB,SAAS,CAAC;;MAEpC;KACD+nB,kBAAkB,CAAC;OAAEpsB;MAAiB,EACtC;OACC,MAAM;SAAEmmB;QAAoB,GAAGnmB,IAAI;OACnC,IAAI,CAAC4hB,UAAU,CAAC2B,6BAA6B,CAAC4C,kBAAkB,EAAE,IAAI,CAACpJ,aAAa,CAAC;MACrF;KACD,MAAM3Y,WAAW,CAACpE,IAAqB,EACvC;OACC,MAAM;SAAEqE,SAAS;SAAEoD,QAAQ;SAAEif,aAAa;SAAEpiB;QAAW,GAAGtE,IAAI;OAC9D,MAAMqsB,OAAO,GAAG7nB,eAAe,CAACgD,gBAAgB,CAACnD,SAAS,EAAEoD,QAAQ,EAAEnD,SAAS,EAAEoiB,aAAa,CAAC3f,MAAM,CAAC;OACtG,MAAMulB,mBAAmB,GAAG,GAAG;OAC/B,MAAMC,YAAY,GAAG7F,aAAa,CAAC3f,MAAM,GAAGzC,SAAS,GAAGgoB,mBAAmB;OAC3E,IAAI,CAAC1K,UAAU,CAACuB,2BAA2B,CAAC,CAAC9e,SAAS,CAAC,EAAEkoB,YAAY,EAAE,IAAI,CAAC;OAC5E,MAAMC,aAAa,GAAG,CAACloB,SAAS,GAAGgoB,mBAAmB;OACtD,IAAI,CAAC1K,UAAU,CAACuB,2BAA2B,CAACuD,aAAa,EAAE8F,aAAa,EAAE,IAAI,CAAC;OAC/E,MAAMC,OAAO,GAAG,MAAMJ,OAAO;OAC7B,IAAI,CAACI,OAAO,EACZ;SACC,IAAI,CAAC7K,UAAU,CAACuB,2BAA2B,CAAC,CAAC9e,SAAS,CAAC,EAAE,CAACkoB,YAAY,EAAE,IAAI,CAAC;SAC7E,IAAI,CAAC3K,UAAU,CAACuB,2BAA2B,CAACuD,aAAa,EAAE,CAAC8F,aAAa,EAAE,IAAI,CAAC;;MAEjF;KACD,MAAME,YAAY,CAAC1sB,IAAqB,EACxC;OACC,MAAM;SAAEqE,SAAS;SAAEoD,QAAQ;SAAEC,WAAW;SAAE+e;QAAW,GAAGzmB,IAAI;OAC5D,MAAM;SAAES,EAAE;SAAEmC;QAAU,GAAG,IAAI,CAAC8B,WAAW,CAAC1B,GAAG,CAACqB,SAAS,CAAC;OACxD,IAAIzB,QAAQ,KAAK6E,QAAQ,IAAIgf,SAAS,KAAK,QAAQ,EACnD;SACC;;OAGD,IAAIkG,mBAAmB,GAAG,IAAI;OAC9B,MAAM7nB,KAAK,GAAGC,wDAAa,EAAE;OAC7B,IAAI0hB,SAAS,KAAK,cAAc,IAAIA,SAAS,KAAK,eAAe,EACjE;SACC,MAAM;WAAE7jB,QAAQ,EAAEgqB;UAAgB,GAAG,IAAI,CAACloB,WAAW,CAAC1B,GAAG,CAACyE,QAAQ,CAAC;SACnE,MAAMgU,QAAQ,GAAGgL,SAAS,KAAK,cAAc,GAAG/e,WAAW,GAAGA,WAAW,GAAG,CAAC;SAC7E5C,KAAK,CAACX,gBAAgB,CAAC;WAAE1D,EAAE;WAAEmC,QAAQ,EAAEgqB;UAAgB,EAAEnR,QAAQ,CAAC;SAClEkR,mBAAmB,GAAGrpB,QAAQ,CAACa,gBAAgB,CAACE,SAAS,EAAEuoB,cAAc,CAAC;QAC1E,MAED;SACC9nB,KAAK,CAACX,gBAAgB,CAAC;WAAE1D,EAAE;WAAEmC,QAAQ,EAAE6E;UAAU,CAAC;SAClDklB,mBAAmB,GAAGrpB,QAAQ,CAACa,gBAAgB,CAACE,SAAS,EAAEoD,QAAQ,CAAC;;OAGrE,IAAI,CAAColB,kBAAkB,CAACxoB,SAAS,CAAC;OAClC,IACA;SACC,MAAMsoB,mBAAmB;SACzB,IAAIlG,SAAS,KAAK,cAAc,IAAIA,SAAS,KAAK,eAAe,EACjE;WACC,MAAM;aAAE7jB,QAAQ,EAAEgqB;YAAgB,GAAG,IAAI,CAACloB,WAAW,CAAC1B,GAAG,CAACyE,QAAQ,CAAC;WACnE,MAAM;aAAEpE;YAAU,GAAG,IAAI,CAACqB,WAAW,CAAC1B,GAAG,CAAC4pB,cAAc,CAAC;WACzD,MAAMvb,KAAK,GAAGoV,SAAS,KAAK,cAAc,GAAG,CAAC,GAAG,CAAC;WAClD,MAAMqG,aAAa,GAAGzpB,QAAQ,CAAC0D,MAAM,GAAGW,WAAW,GAAG2J,KAAK;WAC3D,MAAM/N,QAAQ,CAACc,WAAW,CAACC,SAAS,EAAE,CAAC,CAAC,EAAEyoB,aAAa,CAAC;;QAEzD,CACD,OAAOC,GAAG,EACV;SACC7e,OAAO,CAACD,KAAK,CAAC8e,GAAG,CAAC;;MAEnB;KACDC,YAAY,CAAC;OAAEhtB;MAAiB,EAChC;OACC,MAAM;SAAEymB;QAAW,GAAGzmB,IAAI;OAC1B,IAAIymB,SAAS,KAAK,SAAS,EAC3B;SACC,IAAI,CAACriB,WAAW,CAACpE,IAAI,CAAC;SAEtB;;OAGD,IAAI,CAAC0sB,YAAY,CAAC1sB,IAAI,CAAC;MACvB;KACDitB,iBAAiB,CAAC;OAAEjtB;MAAiB,EACrC;OACC,MAAM;SAAEyD;QAAQ,GAAGzD,IAAI;OAEvB,MAAMmgB,IAAI,GAAG,IAAI,CAACzb,WAAW,CAAC1B,GAAG,CAACS,MAAM,CAAC;OACzC,IAAI,CAAC0c,IAAI,EACT;SACC;;OAGD,KAAK,IAAI,CAAC0M,kBAAkB,CAACppB,MAAM,CAAC;MACpC;KACDypB,QAAQ,CAACzpB,MAAc,EACvB;OACC,IAAI,CAACsZ,aAAa,GAAG,IAAI,CAACA,aAAa,CAACrb,MAAM,CAAEyrB,UAAU,IAAKA,UAAU,KAAK1pB,MAAM,CAAC;OACrF,IAAI,CAACme,UAAU,CAAC0B,0BAA0B,CAAC7f,MAAM,EAAE,KAAK,CAAC;OACzD,IAAI,CAACme,UAAU,CAAC8B,2BAA2B,CAACjgB,MAAM,EAAE,KAAK,CAAC;MAC1D;KACD0oB,mBAAmB,CAAC1oB,MAAc,EAClC;OACC,MAAM2pB,YAAY,GAAI3sB,EAAU,IAAK;SAAA;SACpC,IAAI,CAACysB,QAAQ,CAACzsB,EAAE,CAAC;SACjB,MAAM0f,IAAI,GAAG,IAAI,CAACzb,WAAW,CAAC1B,GAAG,CAACvC,EAAE,CAAC;SACrC,kBAAA0f,IAAI,CAAC9c,QAAQ,qBAAb,eAAeV,OAAO,CAAEuD,OAAO,IAAK;WACnC,IAAI,IAAI,CAAC6W,aAAa,CAAC/V,QAAQ,CAACd,OAAO,CAAC,EACxC;aACCknB,YAAY,CAAClnB,OAAO,CAAC;;UAEtB,CAAC;QACF;OACD,MAAM;SAAEtD;QAAU,GAAG,IAAI,CAAC8B,WAAW,CAAC1B,GAAG,CAACS,MAAM,CAAC;OACjD,MAAM4pB,YAAY,GAAG,IAAI,CAACtQ,aAAa,CAAC/K,IAAI,CAAEvR,EAAE,IAAK;SACpD,MAAM0f,IAAI,GAAG,IAAI,CAACzb,WAAW,CAAC1B,GAAG,CAACvC,EAAE,CAAC;SAErC,OAAO0f,IAAI,CAACvd,QAAQ,KAAKA,QAAQ;QACjC,CAAC;OACF,IAAIyqB,YAAY,EAChB;SACCD,YAAY,CAACC,YAAY,CAAC;;MAE3B;KACDC,MAAM,CAACloB,YAAoB,EAC3B;OACC,IAAI,CAAC+mB,mBAAmB,CAAC/mB,YAAY,CAAC;OACtC,IAAI,CAAC2X,aAAa,GAAG,CAAC,GAAG,IAAI,CAACA,aAAa,EAAE3X,YAAY,CAAC;OAC1D,IAAI,CAACwc,UAAU,CAAC0B,0BAA0B,CAACle,YAAY,EAAE,IAAI,CAAC;OAC9D,IAAI,CAACwc,UAAU,CAAC8B,2BAA2B,CAACte,YAAY,EAAE,IAAI,CAAC;OAC/D,MAAMe,UAAU,GAAG,IAAI,CAACzB,WAAW,CAAC1B,GAAG,CAACoC,YAAY,CAAC;OACrD,MAAMmoB,oBAAoB,GAAGpnB,UAAU,CAAC9C,QAAQ,CAAC3B,MAAM,CAAEwE,OAAO,IAAK;SACpE,OAAO,CAAC,IAAI,CAACxB,WAAW,CAAC1B,GAAG,CAACkD,OAAO,CAAC,CAACL,KAAK;QAC3C,CAAC;OACF,IAAI0nB,oBAAoB,CAACxmB,MAAM,GAAG,CAAC,EACnC;SACC,IAAI,CAACmkB,SAAS,CAACqC,oBAAoB,CAAC;;OAGrCrkB,qBAAiB,CAAC;SAAEvF,IAAI,EAAE,WAAW;SAAEC,QAAQ,EAAE,WAAW;SAAEC,KAAK,EAAE;QAAqB,CAAC;MAC3F;KACDwE,KAAK,CAAC5E,MAAc,EAAEqG,OAAe,GAAG,EAAE,EAC1C;OAAA;OACC,MAAM;SAAEyhB,gBAAgB,GAAG,KAAK;SAAEvL,aAAa,GAAG,KAAK;SAAEC,oBAAoB,GAAG;QAAO,GAAGnW,OAAO;OACjG,MAAM+T,WAAW,GAAG,+BAAI,CAACnZ,WAAW,CAAC1B,GAAG,CAACS,MAAM,CAAC,CAACJ,QAAQ,qBAArC,uBAAuC0D,MAAM,IAAG,CAAC;OAErE,IAAIymB,YAAY,GAAGjC,gBAAgB,IAAI,CAAC,IAAI,CAACxO,aAAa,CAAC/V,QAAQ,CAACvD,MAAM,CAAC;OAC3E,IAAIuc,aAAa,EACjB;SACCwN,YAAY,GAAG,IAAI,CAACzQ,aAAa,CAAC/V,QAAQ,CAACvD,MAAM,CAAC;;OAGnD,IAAIwc,oBAAoB,IAAI,CAACpC,WAAW,EACxC;SACC,IAAI,CAACsO,mBAAmB,CAAC1oB,MAAM,CAAC;;OAGjC,IAAIoa,WAAW,IAAI2P,YAAY,EAC/B;SACC,IAAI,CAACF,MAAM,CAAC7pB,MAAM,CAAC;;OAGpB,IAAI,IAAI,CAAC4B,WAAW,IAAI,CAAC,IAAI,CAAC0X,aAAa,CAAC/V,QAAQ,CAAC,IAAI,CAAC3B,WAAW,CAAC,EACtE;SACC,IAAI,CAACuc,UAAU,CAAC8B,2BAA2B,CAAC,IAAI,CAACre,WAAW,EAAE,KAAK,CAAC;;OAGrEb,eAAe,CAACW,eAAe,CAAC1B,MAAM,CAAC;OACvC,IAAI,CAACme,UAAU,CAAC8B,2BAA2B,CAAC,IAAI,CAACre,WAAW,EAAE,IAAI,CAAC;MACnE;KACDooB,iBAAiB,CAAC;OAAEztB;MAA0B,EAC9C;OACC,MAAM;SAAEyD,MAAM;SAAEuc,aAAa;SAAEC;QAAsB,GAAGjgB,IAAI;OAC5D,IAAI,CAACqI,KAAK,CAAC5E,MAAM,EAAE;SAAEuc,aAAa;SAAEC;QAAsB,CAAC;OAC3D,IAAI,CAAC9d,KAAK,CAAC,eAAe,EAAE;SAC3B6d,aAAa;SACb0N,aAAa,EAAEzN;QACf,CAAC;MACF;KACD0N,mBAAmB,CAAClqB,MAAc,EAAEX,UAAkB,EACtD;OACC,MAAM8qB,eAAe,GAAG;SACvBzV,IAAI,EAAE;WACLzX,KAAK,EAAE,IAAI,CAACC,GAAG,CAAC,4DAA4D,CAAC;WAC7EktB,OAAO,EAAE,IAAI,CAACltB,GAAG,CAAC,8DAA8D,CAAC;WACjFmtB,OAAO,EAAE,IAAI,CAACntB,GAAG,CAAC,8DAA8D,CAAC;WACjFsN,KAAK,EAAE,IAAI,CAACtN,GAAG,CAAC,4DAA4D;UAC5E;SACDyU,OAAO,EAAE;WACR1U,KAAK,EAAE,IAAI,CAACC,GAAG,CAAC,kEAAkE,CAAC;WACnFktB,OAAO,EAAE,IAAI,CAACltB,GAAG,CAAC,oEAAoE,CAAC;WACvFmtB,OAAO,EAAE,IAAI,CAACntB,GAAG,CAAC,oEAAoE,CAAC;WACvFsN,KAAK,EAAE,IAAI,CAACtN,GAAG,CAAC,kEAAkE;;QAEnF;OACD,MAAMotB,QAAQ,GAAGjrB,UAAU,KAAKuD,iDAAW,CAAC8R,IAAI,GAAG,MAAM,GAAG,SAAS;OACrE,MAAM6V,UAAU,GAAGC,gCAAU,CAACC,MAAM,CAAC;SACpCxtB,KAAK,EAAEktB,eAAe,CAACG,QAAQ,CAAC,CAACrtB,KAAK;SACtCmtB,OAAO,EAAED,eAAe,CAACG,QAAQ,CAAC,CAACF,OAAO;SAC1CM,OAAO,EAAEC,uCAAiB,CAACC,SAAS;SACpCC,IAAI,EAAE,MAAOllB,MAAkB,IAAK;WACnC,IACA;aACC,MAAM,IAAI,CAAC7F,gBAAgB,CAACE,MAAM,CAAC;aACnC+L,kBAAE,CAACC,YAAY,CAACC,MAAM,CAACC,MAAM,CAAC;eAC7BC,OAAO,EAAEge,eAAe,CAACG,QAAQ,CAAC,CAACD,OAAO;eAC1Cje,aAAa,EAAE;cACf,CAAC;aACFzG,MAAM,CAACmlB,KAAK,EAAE;YACd,CACD,MACA;aACC/e,kBAAE,CAACC,YAAY,CAACC,MAAM,CAACC,MAAM,CAAC;eAC7BC,OAAO,EAAEge,eAAe,CAACG,QAAQ,CAAC,CAAC9f,KAAK;eACxC4B,aAAa,EAAE;cACf,CAAC;;UAEH;SACD2e,QAAQ,EAAGplB,MAAkB,IAAKA,MAAM,CAACmlB,KAAK,EAAE;SAChDE,QAAQ,EAAE,GAAG;SACbC,QAAQ,EAAE,GAAG;SACbC,SAAS,EAAE,GAAG;SACdC,SAAS,EAAE,IAAI,CAACjuB,GAAG,CAAC,uEAAuE,CAAC;SAC5FkuB,YAAY,EAAE;WAAEC,SAAS,EAAE,kCAAkC;WAAEC,OAAO,EAAE;aAAEC,OAAO,EAAE;;;QACnF,CAAC;OACF,MAAMC,QAAQ,GAAGjB,UAAU,CAACkB,WAAW,EAAE;OACzC,MAAMC,YAAY,GAAGnB,UAAU,CAACoB,eAAe,EAAE;OACjDH,QAAQ,CAACI,QAAQ,CAAC,IAAI,CAAC;OACvBF,YAAY,CAACE,QAAQ,CAAC,IAAI,CAAC;OAC3BJ,QAAQ,CAACK,QAAQ,CAACC,sBAAW,CAACC,MAAM,CAAC;OACrCL,YAAY,CAACG,QAAQ,CAACC,sBAAW,CAACE,YAAY,CAAC;OAC/CzB,UAAU,CAACjiB,IAAI,EAAE;MACjB;KACD,MAAMxI,gBAAgB,CAACE,MAAc,EACrC;OACC,MAAMH,QAAQ,CAACC,gBAAgB,CAACE,MAAM,CAAC;OACvC,MAAMgC,mBAAmB,GAAG,IAAI,CAACf,WAAW,CAAC1B,GAAG,CAACS,MAAM,CAAC;OACxD,MAAM;SAAEb,QAAQ;SAAES,QAAQ,EAAEqsB,2BAA2B,GAAG;QAAI,GAAGjqB,mBAAmB;OACpF,IAAIiqB,2BAA2B,CAAC3oB,MAAM,GAAG,CAAC,EAC1C;SACC,IAAI,CAACmmB,QAAQ,CAACzpB,MAAM,CAAC;;OAGtBe,eAAe,CAACe,wBAAwB,CAAC9B,MAAM,CAAC;OAChD,MAAM,IAAI,CAAC6b,SAAS,EAAE;OACtB9a,eAAe,CAAC0C,uBAAuB,CAACzD,MAAM,CAAC;OAC/C,IAAI,CAAC4E,KAAK,CAACzF,QAAQ,EAAE;SAAE2oB,gBAAgB,EAAE;QAAM,CAAC;OAChD,IAAI,CAACS,MAAM,CAACppB,QAAQ,CAAC;MACrB;KACD0oB,uBAAuB,CAAC7nB,MAAc,EACtC;OACC,IAAI;SAAEb;QAAU,GAAG,IAAI,CAAC8B,WAAW,CAAC1B,GAAG,CAACS,MAAM,CAAC;OAC/C,OAAOb,QAAQ,EACf;SACC,IAAI,CAAC,IAAI,CAACma,aAAa,CAAC/V,QAAQ,CAACpE,QAAQ,CAAC,EAC1C;WACC,IAAI,CAAC0qB,MAAM,CAAC1qB,QAAQ,CAAC;;SAGtBA,QAAQ,GAAG,IAAI,CAAC8B,WAAW,CAAC1B,GAAG,CAACJ,QAAQ,CAAC,CAACA,QAAQ;;MAEnD;KACD4oB,sBAAsB,GACtB;OACC,IAAImE,WAAW,GAAG,CAAC;OACnB,MAAMC,iBAAiB,GAAIxqB,YAAoB,IAAK;SAAA;SACnD,MAAM;WAAE/B,QAAQ,GAAG;UAAI,GAAG,IAAI,CAACqB,WAAW,CAAC1B,GAAG,CAACoC,YAAY,CAAC;SAC5D,IAAIuqB,WAAW,KAAK,CAAC,IAAItsB,QAAQ,CAAC0D,MAAM,KAAK,CAAC,EAC9C;WACC;;SAGD,IAAI,CAACumB,MAAM,CAACloB,YAAY,CAAC;SACzBuqB,WAAW,IAAI,CAAC;SAChB,MAAME,WAAW,GAAGjL,IAAI,CAACkL,KAAK,CAACzsB,QAAQ,CAAC0D,MAAM,GAAG,CAAC,CAAC;SACnD,MAAMb,OAAO,GAAG7C,QAAQ,CAACwsB,WAAW,CAAC;SACrC,IAAI,+BAAI,CAACnrB,WAAW,CAAC1B,GAAG,CAACkD,OAAO,CAAC,CAAC7C,QAAQ,qBAAtC,uBAAwC0D,MAAM,IAAG,CAAC,EACtD;WACC6oB,iBAAiB,CAAC1pB,OAAO,CAAC;WAE1B;;SAGD,KAAK,IAAIsiB,CAAC,GAAGqH,WAAW,GAAG,CAAC,EAAErH,CAAC,IAAI,CAAC,EAAEA,CAAC,EAAE,EACzC;WACC,IAAIuH,eAAe,CAAC1sB,QAAQ,CAACmlB,CAAC,CAAC,CAAC,EAChC;aACC;;;SAIF,KAAK,IAAIA,CAAC,GAAGqH,WAAW,GAAG,CAAC,EAAErH,CAAC,GAAGnlB,QAAQ,CAAC0D,MAAM,EAAEyhB,CAAC,EAAE,EACtD;WACC,IAAIuH,eAAe,CAAC1sB,QAAQ,CAACmlB,CAAC,CAAC,CAAC,EAChC;aACC;;;QAGF;OAED,MAAMuH,eAAe,GAAIC,SAAiB,IAAK;SAC9C,MAAM;WAAE3sB,QAAQ,EAAE4sB,eAAe,GAAG;UAAI,GAAG,IAAI,CAACvrB,WAAW,CAAC1B,GAAG,CAACgtB,SAAS,CAAC;SAE1E,IAAIC,eAAe,CAAClpB,MAAM,GAAG,CAAC,EAC9B;WACC6oB,iBAAiB,CAACI,SAAS,CAAC;WAE5B,OAAO,IAAI;;SAGZ,OAAO,KAAK;QACZ;OACDJ,iBAAiB,CAAC,IAAI,CAAC/E,MAAM,CAAC;MAC9B;KACD,MAAMqF,yBAAyB,GAC/B;;OAEC,IAAI,IAAI,CAAC7E,yBAAyB,CAACtkB,MAAM,KAAK,IAAI,CAACpC,kBAAkB,CAACoC,MAAM,EAC5E;SACC,IAAI,CAACskB,yBAAyB,GAAG,EAAE;;OAEpC,MAAM8E,iBAAiB,GAAG,IAAI,CAACxrB,kBAAkB,CAACqN,IAAI,CAAErQ,IAAI,IAAK,CAAC,IAAI,CAAC0pB,yBAAyB,CAACrkB,QAAQ,CAACrF,IAAI,CAAC,CAAC;OAChH,IAAI,CAACwuB,iBAAiB,EACtB;SACC;;OAGD,IAAI,CAAC9E,yBAAyB,CAACvgB,IAAI,CAACqlB,iBAAiB,CAAC;OACtD,MAAM,IAAI,CAACtD,kBAAkB,CAACsD,iBAAiB,CAAC;OAChD3rB,eAAe,CAACc,sBAAsB,CAAC,IAAI,CAACV,MAAM,CAAC;MACnD;KACD,MAAMioB,kBAAkB,CAACppB,MAAc,EACvC;OACC,IAAI,CAACie,0BAA0B,GAAG,KAAK;OACvC,IAAI,CAAC4J,uBAAuB,CAAC7nB,MAAM,CAAC;OACpC,IAAI,CAAC4E,KAAK,CAAC5E,MAAM,EAAE;SAAE8nB,gBAAgB,EAAE;QAAM,CAAC;;OAE9C,MAAM,IAAI,CAACjM,SAAS,EAAE;OACtB,IAAI,CAACoC,0BAA0B,GAAG,IAAI;OACtC,MAAM,IAAI,CAACsK,MAAM,CAACvoB,MAAM,CAAC;MACzB;KACD,MAAMuoB,MAAM,CAACvoB,MAAc,EAC3B;OACC,MAAM,IAAI,CAAC6b,SAAS,EAAE;OACtB,MAAM8Q,QAAQ,GAAG,IAAI,CAAClP,aAAa,EAAE;OACrC,MAAMmP,OAAO,GAAGD,QAAQ,CAACtP,CAAC,GAAGsP,QAAQ,CAAC9mB,KAAK,GAAG,CAAC;OAC/C,MAAMgnB,OAAO,GAAGF,QAAQ,CAACpP,CAAC,GAAGoP,QAAQ,CAAC7mB,MAAM,GAAG,CAAC;OAChD,MAAMgnB,QAAQ,GAAG,IAAI,CAAC5O,SAAS,CAAC3e,GAAG,CAACS,MAAM,CAAC;OAC3C,MAAM+sB,YAAY,GAAGD,QAAQ,CAAChQ,qBAAqB,EAAE;OACrD,IAAI,CAACpe,KAAK,CAAC,QAAQ,EAAE;SACpB2e,CAAC,EAAEuP,OAAO,GAAGG,YAAY,CAAC1P,CAAC,GAAG0P,YAAY,CAAClnB,KAAK,GAAG,CAAC;SACpD0X,CAAC,EAAEsP,OAAO,GAAGE,YAAY,CAACxP,CAAC,GAAGwP,YAAY,CAACjnB,MAAM,GAAG,CAAC;SACrD9F;QACA,CAAC;MACF;KACDynB,SAAS,CAACuF,aAAuB,EACjC;OACC,MAAM3rB,KAAK,GAAGC,wDAAa,EAAE;OAC7BD,KAAK,CAAComB,SAAS,CAACuF,aAAa,CAAC;MAC9B;KACD5O,iBAAiB,GACjB;OACC,IAAI,CAACnkB,MAAM,GAAG;SACb,CAACA,MAAM,CAACG,qBAAqB,GAAG,IAAI,CAAC8tB,mBAAmB;SACxD,CAACjuB,MAAM,CAACI,wBAAwB,GAAG,IAAI,CAACmuB,sBAAsB;SAC9D,CAACvuB,MAAM,CAACO,mBAAmB,GAAG,IAAI,CAACwvB,iBAAiB;SACpD,CAAC/vB,MAAM,CAACa,cAAc,GAAG,IAAI,CAAC2tB,YAAY;SAC1C,CAACxuB,MAAM,CAACc,cAAc,GAAG,IAAI,CAACwuB,YAAY;SAC1C,CAACtvB,MAAM,CAACkB,yBAAyB,GAAG,IAAI,CAACwtB,kBAAkB;SAC3D,CAAC1uB,MAAM,CAACqB,oBAAoB,GAAG,IAAI,CAACkuB,iBAAiB;SACrD,CAACvvB,MAAM,CAACuB,kBAAkB,GAAG,IAAI,CAACyxB,eAAe;SACjD,CAAChzB,MAAM,CAACyB,iBAAiB,GAAG,IAAI,CAACwxB,cAAc;SAC/C,CAACjzB,MAAM,CAAC0B,gBAAgB,GAAG,IAAI,CAACwxB,aAAa;SAC7C,CAAClzB,MAAM,CAAC2B,uBAAuB,GAAG,IAAI,CAACwxB,mBAAmB;SAC1D,CAACnzB,MAAM,CAAC4B,uBAAuB,GAAG,IAAI,CAACwxB;QACvC;OACDnzB,MAAM,CAACqnB,OAAO,CAAC,IAAI,CAACtnB,MAAM,CAAC,CAACiF,OAAO,CAAC,CAAC,CAACkB,KAAK,EAAEohB,MAAM,CAAC,KAAK;SACxD7V,6BAAY,CAACoH,SAAS,CAAC3S,KAAK,EAAEohB,MAAM,CAAC;QACrC,CAAC;MACF;KACDhD,qBAAqB,GACrB;OACCtkB,MAAM,CAACqnB,OAAO,CAAC,IAAI,CAACtnB,MAAM,CAAC,CAACiF,OAAO,CAAC,CAAC,CAACkB,KAAK,EAAEohB,MAAM,CAAC,KAAK;SACxD7V,6BAAY,CAACkH,WAAW,CAACzS,KAAK,EAAEohB,MAAM,CAAC;QACvC,CAAC;MACF;KACDyL,eAAe,CAAC;OAAE1wB;MAAM,EACxB;OACC,IAAI,CAACuqB,eAAe,GAAGvqB,IAAI,CAACwG,IAAI;MAChC;KACDqqB,mBAAmB,CAAC;OAAE7wB;MAAM,EAC5B;OACC,IAAI,CAAC,IAAI,CAACuqB,eAAe,EACzB;SACC;;OAGD,MAAMwG,aAAa,GAAG/wB,IAAI,CAACyD,MAAM;OACjC,MAAMutB,kBAAkB,GAAG,IAAI,CAAC3rB,WAAW;OAE3C,MAAM4rB,WAAW,GAAG,IAAI,CAACvsB,WAAW,CAAC1B,GAAG,CAAC+tB,aAAa,CAAC;OACvD,MAAMpS,UAAU,GAAG,IAAI,CAACja,WAAW,CAAC1B,GAAG,CAACguB,kBAAkB,CAAC;OAE3D,IAAIrS,UAAU,CAAC7b,UAAU,KAAKmuB,WAAW,CAACnuB,UAAU,IAAIiuB,aAAa,KAAKC,kBAAkB,EAC5F;SACC,IAAI,CAAC/T,oBAAoB,GAAG8T,aAAa;SACzC,IAAI,CAAC7T,iBAAiB,GAAG,KAAK;SAE9B;;OAGD,IAAI,CAACD,oBAAoB,GAAG8T,aAAa;OACzC,MAAMG,eAAe,GAAG,IAAI,CAACC,WAAW,CAACH,kBAAkB,EAAED,aAAa,CAAC;OAC3E,IAAI,CAAC7T,iBAAiB,GAAGgU,eAAe,CAACE,SAAS;OAClD,IAAI,CAACxG,aAAa,GAAGsG,eAAe,CAACG,WAAW;MAChD;KACDP,mBAAmB,CAAC;OAAE9wB;MAAM,EAC5B;OACC,IAAI,CAAC,IAAI,CAACuqB,eAAe,EACzB;SACC;;OAGD,IAAI,IAAI,CAACtN,oBAAoB,KAAKjd,IAAI,CAACyD,MAAM,EAC7C;SACC,IAAI,CAACwZ,oBAAoB,GAAG,IAAI;SAChC,IAAI,CAACC,iBAAiB,GAAG,KAAK;;MAE/B;KACD,MAAMyT,cAAc,GACpB;OACC,IAAI,CAAC,IAAI,CAAC1T,oBAAoB,IAAI,CAAC,IAAI,CAACC,iBAAiB,EACzD;SACC;;OAGD,IAAI,CAACyN,kBAAkB,GAAG;SACzBnkB,IAAI,EAAE,IAAI,CAAC+jB,eAAe;SAC1ByG,kBAAkB,EAAE,IAAI,CAAC3rB,WAAW;SACpCsM,kBAAkB,EAAE,IAAI,CAACsL,oBAAoB;SAC7CqU,UAAU,EAAE,IAAI,CAAC/G,eAAe,CAAC3jB;QACjC;OAED,IAAI,CAAC4jB,wBAAwB,GAAG,IAAI;MACpC;KACD,MAAM+G,eAAe,CAACC,OAKrB,EACD;OAAA;OACC,IAAI,CAAChH,wBAAwB,GAAG,KAAK;OACrC,MAAM;SAAEhkB,IAAI;SAAEmL;QAAoB,GAAG,IAAI,CAACgZ,kBAAkB;OAE5D,MAAM/Y,gBAAgB,GAAG,IAAI,CAAClN,WAAW,CAAC1B,GAAG,CAAC2O,kBAAkB,CAAC;OACjE,MAAM8f,YAAY,GAAG,0BAAC7f,gBAAgB,CAAC/L,KAAK,oCAAI,EAAE,EAAEmM,IAAI,CAAE0f,CAAC,IAAKA,CAAC,CAACjxB,EAAE,KAAK+F,IAAI,CAAC/F,EAAE,CAAC,IAC7E,0BAACmR,gBAAgB,CAAC7L,SAAS,oCAAI,EAAE,EAAEiM,IAAI,CAAE0f,CAAC,IAAKA,CAAC,CAACjxB,EAAE,KAAK+F,IAAI,CAAC/F,EAAE,CAAC;OACpE,MAAMkxB,iBAAiB,GAAGpc,OAAO,CAACkc,YAAY,CAAC;OAC/C,MAAMG,aAAa,GAAGD,iBAAiB,IAAKF,YAAY,CAAC7qB,IAAI,KAAK4qB,OAAO,CAAC5qB,IAAK;OAE/E,IAAI+qB,iBAAiB,IAAIC,aAAa,EACtC;SACC,IAAI,CAACC,oBAAoB,CAACrrB,IAAI,EAAEmL,kBAAkB,CAAC;SACnD,IAAI,CAACgZ,kBAAkB,GAAG,IAAI;SAE9B;;OAGD,IACA;SACC,IAAI6G,OAAO,CAACM,aAAa,EACzB;WACC,MAAM,IAAI,CAACC,iBAAiB,CAAC,IAAI,CAACpH,kBAAkB,EAAE6G,OAAO,CAAC;UAC9D,MAED;WACC,MAAM,IAAI,CAACQ,cAAc,CAAC,IAAI,CAACrH,kBAAkB,EAAE6G,OAAO,EAAEG,iBAAiB,CAAC;;SAG/E,MAAM5G,MAAM,GAAGnZ,gBAAgB,CAAC9O,UAAU,KAAKuD,iDAAW,CAAC8R,IAAI,GAAG,8DAA8D,GAC7H,oEAAoE;SAEvE3I,kBAAE,CAACC,YAAY,CAACC,MAAM,CAACC,MAAM,CAAC;WAC7BC,OAAO,EAAE,IAAI,CAACjP,GAAG,CAACoqB,MAAM,EAAE;aACzB,aAAa,EAAEC,cAAI,CAACC,MAAM,CAACzkB,IAAI,CAAC5G,IAAI,CAAC;aACrC,mBAAmB,EAAEorB,cAAI,CAACC,MAAM,CAACrZ,gBAAgB,CAAChS,IAAI,CAAC;aACvD,aAAa,EAAEorB,cAAI,CAACC,MAAM,CAACuG,OAAO,CAACS,SAAS;YAC5C;UACD,CAAC;QACF,CACD,OAAOhkB,KAAK,EACZ;SACCC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;;OAGrB,IAAI,CAAC0c,kBAAkB,GAAG,IAAI;MAC9B;KACD,MAAMoH,iBAAiB,CAACG,UAAU,EAAEV,OAAO,EAC3C;OAAA;OACC,MAAM;SAAEhrB,IAAI;SAAEmL;QAAoB,GAAGugB,UAAU;OAC/C,MAAMlyB,IAAI,GAAG,MAAMmyB,4EAAuB,CAACre,oBAAoB,CAACnC,kBAAkB,EAAE,CAACnL,IAAI,CAAC/F,EAAE,CAAC,EAAE+wB,OAAO,CAAC5qB,IAAI,CAAC;OAE5G0M,2BAA2B,CAACQ,oBAAoB,CAC/CnC,kBAAkB,EAClB,CAAC;SAAE,GAAGnL,IAAI;SAAEI,IAAI,EAAE4qB,OAAO,CAAC5qB,IAAI;SAAEwrB,SAAS,wBAAEZ,OAAO,CAACY,SAAS,iCAAI;QAAM,CAAC,EACvEpyB,IAAI,CAAC2F,SAAS,EACd6rB,OAAO,CAAC5qB,IAAI,CACZ;MACD;KACD,MAAMorB,cAAc,CAACE,UAAU,EAAEV,OAAO,EAAEG,iBAAiB,EAC3D;OAAA;OACC,MAAM;SAAEnrB,IAAI;SAAEwqB,kBAAkB;SAAErf,kBAAkB;SAAE2f;QAAY,GAAGY,UAAU;OAC/E,MAAMtgB,gBAAgB,GAAG,IAAI,CAAClN,WAAW,CAAC1B,GAAG,CAAC2O,kBAAkB,CAAC;OAEjE,IAAIggB,iBAAiB,EACrB;SACC,MAAMQ,4EAAuB,CAACre,oBAAoB,CAACnC,kBAAkB,EAAE,CAACnL,IAAI,CAAC/F,EAAE,CAAC,EAAE+wB,OAAO,CAAC5qB,IAAI,CAAC;SAC/F,MAAMkJ,aAAa,CAACI,wBAAwB,CAAC8gB,kBAAkB,EAAExqB,IAAI,CAAC/F,EAAE,CAAC;QACzE,MAED;SACC,MAAMqP,aAAa,CAACK,oBAAoB,CACvC6gB,kBAAkB,EAClBxqB,IAAI,CAAC/F,EAAE,EACPkR,kBAAkB,EAClB6f,OAAO,CAAC5qB,IAAI,CACZ;;OAGF,MAAMyrB,cAAc,GAAGzgB,gBAAgB,CAACjM,SAAS,IAAIgsB,iBAAiB,GAAG,CAAC,GAAG,CAAC,CAAC;OAE/EjgB,wBAAwB,CAACxB,wBAAwB,CAAC8gB,kBAAkB,EAAExqB,IAAI,CAAC/F,EAAE,EAAE6wB,UAAU,CAAC;OAC1Fhe,2BAA2B,CAACQ,oBAAoB,CAC/CnC,kBAAkB,EAClB,CAAC;SAAE,GAAGnL,IAAI;SAAEI,IAAI,EAAE4qB,OAAO,CAAC5qB,IAAI;SAAEwrB,SAAS,yBAAEZ,OAAO,CAACY,SAAS,kCAAI;QAAM,CAAC,EACvEC,cAAc,EACdb,OAAO,CAAC5qB,IAAI,CACZ;MACD;KACDirB,oBAAoB,CAACrrB,IAAI,EAAEmL,kBAA0B,EACrD;OACC,MAAMC,gBAAgB,GAAG,IAAI,CAAClN,WAAW,CAAC1B,GAAG,CAAC2O,kBAAkB,CAAC;OACjE,MAAMoZ,MAAM,GAAGnZ,gBAAgB,CAAC9O,UAAU,KAAKuD,iDAAW,CAAC8R,IAAI,GAAG,4DAA4D,GAC3H,kEAAkE;OAErE,IAAI,CAACuS,wBAAwB,GAAGzoB,aAAG,CAACC,UAAU,CAAC6oB,MAAM,EAAE;SACtD,aAAa,EAAEC,cAAI,CAACC,MAAM,CAACzkB,IAAI,CAAC5G,IAAI,CAAC;SACrC,mBAAmB,EAAEorB,cAAI,CAACC,MAAM,CAACrZ,gBAAgB,CAAChS,IAAI,CAAC;SACvD,QAAQ,EAAG,iFAAgF4G,IAAI,CAAC2P,GAAI,IAAG;SACvG,SAAS,EAAE;QACX,CAAC;OAEF,IAAI,CAACsU,iBAAiB,GAAG,IAAI;MAC7B;KACD6H,cAAc,GACd;OACC,IAAI,CAAC,IAAI,CAAC3H,kBAAkB,EAC5B;SACC;;OAGD,IAAI,CAACH,wBAAwB,GAAG,KAAK;OACrC,IAAI,CAACG,kBAAkB,GAAG,IAAI;MAC9B;KACD4H,kBAAkB,GAClB;OACC,IAAI,CAAC9H,iBAAiB,GAAG,KAAK;OAC9B,IAAI,CAACC,wBAAwB,GAAG,EAAE;OAClC,IAAI,CAACC,kBAAkB,GAAG,IAAI;MAC9B;KACDiG,aAAa,GACb;OACC,IAAI,CAAC3T,oBAAoB,GAAG,IAAI;OAChC,IAAI,CAACC,iBAAiB,GAAG,KAAK;OAC9B,IAAI,CAACqN,eAAe,GAAG,IAAI;MAC3B;KACD4G,WAAW,CAACH,kBAA0B,EAAErf,kBAA0B,EAClE;OACC,MAAMtR,iBAAiB,GAAGC,mEAAiB,CAACC,WAAW,EAAE;OACzD,MAAMiyB,oBAAoB,GAAG,IAAI,CAAC9tB,WAAW,CAAC1B,GAAG,CAACguB,kBAAkB,CAAC;OACrE,MAAMyB,eAAe,GAAG,IAAI,CAAC/tB,WAAW,CAAC1B,GAAG,CAAC2O,kBAAkB,CAAC;OAEhE,IAAI,CAAC6gB,oBAAoB,IAAI,CAACC,eAAe,EAC7C;SACC,OAAO;WAAErB,SAAS,EAAE,KAAK;WAAEsB,YAAY,EAAE;UAAO;;OAGjD,MAAMC,sBAAsB,GAAGH,oBAAoB,CAAC1vB,UAAU,KAAKuD,iDAAW,CAAC8R,IAAI,GAChF9W,mEAAiB,CAACuxB,gBAAgB,GAClCvxB,mEAAiB,CAACwxB,4BAA4B;OACjD,MAAMC,iBAAiB,GAAGzyB,iBAAiB,CAAC2W,aAAa,CAAC2b,sBAAsB,EAAE3B,kBAAkB,CAAC;OAErG,MAAM+B,sBAAsB,GAAGN,eAAe,CAAC3vB,UAAU,KAAKuD,iDAAW,CAAC8R,IAAI,GAC3E9W,mEAAiB,CAACqX,aAAa,GAC/BrX,mEAAiB,CAACI,uBAAuB;OAC5C,MAAMuxB,cAAc,GAAG3yB,iBAAiB,CAAC2W,aAAa,CAAC+b,sBAAsB,EAAEphB,kBAAkB,CAAC;OAElG,IAAImhB,iBAAiB,IAAIE,cAAc,EACvC;SACC,OAAO;WAAE5B,SAAS,EAAE,IAAI;WAAEC,WAAW,EAAE;UAAO;;OAG/C,IAAI,CAACyB,iBAAiB,IAAIE,cAAc,EACxC;SACC,OAAO;WAAE5B,SAAS,EAAE,IAAI;WAAEC,WAAW,EAAE;UAAM;;OAG9C,OAAO;SAAED,SAAS,EAAE,KAAK;SAAEC,WAAW,EAAE;QAAO;;IAEhD;GAED/uB,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAoDZ,CAAC;;CCt1BD;AACA,CAAO,MAAM2wB,cAAc,GAAG;GAC7BrzB,IAAI,EAAE,iBAAiB;GAEvBqV,KAAK,EACL;KACCie,UAAU,EAAE;OACXvpB,IAAI,EAAEhM,MAAM;OACZwX,QAAQ,EAAE;;IAEX;GAEDpV,KAAK,EAAE,CAAC,mBAAmB,CAAC;GAE5BC,IAAI,GACJ;KACC,OAAO;OACNmzB,UAAU,EAAE;MACZ;IACD;GAEDhzB,QAAQ,EACR;KACCizB,aAAa,GACb;OACC,MAAMC,OAAO,GAAG,qEAAqE;OAErF,OAAQ,GAAE,CAAC,IAAI,CAACH,UAAU,CAACpN,IAAI,GAAG,GAAG,EAAEwN,OAAO,CAAC,CAAC,CAAE,GAAED,OAAQ,EAAC;;IAE9D;GAEDtqB,OAAO,GACP;KACC,IAAI,CAACwqB,OAAO,GAAG51B,MAAM,CAACC,MAAM,CAAC;OAC5B41B,MAAM,EAAE,QAAQ;OAChBC,OAAO,EAAE,SAAS;OAClBC,MAAM,EAAE,QAAQ;OAChBC,QAAQ,EAAE;MACV,CAAC;IACF;GAED9xB,OAAO,EACP;KACClB,GAAG,CAACmB,UAAkB,EAAEC,YAAmC,GAAG,EAAE,EAChE;OACC,OAAO,IAAI,CAACC,OAAO,CAACC,GAAG,CAACC,UAAU,CAACJ,UAAU,EAAEC,YAAY,CAAC;MAC5D;KACD6xB,MAAM,CAACJ,MAAe,EACtB;OACC,MAAMK,SAAS,GAAG,GAAG;OACrB,MAAMC,UAAU,GAAG,CAAC;OACpB,IAAIxvB,SAAS,GAAG,CAAC,CAAC;OAClB,IAAIkvB,MAAM,EACV;SACClvB,SAAS,GAAG,CAAC;SACb,IAAI,CAAC6uB,UAAU,GAAG,IAAI,CAACI,OAAO,CAACC,MAAM;QACrC,MAED;SACC,IAAI,CAACL,UAAU,GAAG,IAAI,CAACI,OAAO,CAACE,OAAO;;OAGvC,MAAM3N,IAAI,GAAGjR,MAAM,CAAC,CAAC,IAAI,CAACqe,UAAU,CAACpN,IAAI,GAAG+N,SAAS,GAAGvvB,SAAS,EAAEgvB,OAAO,CAAC,CAAC,CAAC,CAAC;OAC9E,IAAIxN,IAAI,GAAG+N,SAAS,IAAI/N,IAAI,GAAGgO,UAAU,EACzC;SACC;;;;OAID,MAAM1D,QAAQ,GAAG,IAAI,CAAC3P,OAAO,CAAC9U,KAAK,CAAC8Z,IAAI,CAACvE,aAAa,EAAE;OACxD,MAAMmP,OAAO,GAAID,QAAQ,CAAC9mB,KAAK,GAAG,CAAC,GAAI,IAAI,CAAC4pB,UAAU,CAACpN,IAAI,GAAGvmB,gBAAgB,GAAG,CAAC;OAClF,MAAM+wB,OAAO,GAAIF,QAAQ,CAAC7mB,MAAM,GAAG,CAAC,GAAI,IAAI,CAAC2pB,UAAU,CAACpN,IAAI;OAE5D,MAAMiO,UAAU,GAAG,CAAC1D,OAAO,GAAG,IAAI,CAAC6C,UAAU,CAACpS,CAAC,IAAI,IAAI,CAACoS,UAAU,CAACpN,IAAI;OACvE,MAAMkO,UAAU,GAAG,CAAC1D,OAAO,GAAG,IAAI,CAAC4C,UAAU,CAAClS,CAAC,IAAI,IAAI,CAACkS,UAAU,CAACpN,IAAI;OAEvE,MAAMhF,CAAC,GAAGuP,OAAO,GAAG0D,UAAU,GAAGjO,IAAI;OACrC,MAAM9E,CAAC,GAAGsP,OAAO,GAAG0D,UAAU,GAAGlO,IAAI;OAErC,IAAI,CAAC3jB,KAAK,CAAC,mBAAmB,EAAE;SAAE,GAAG,IAAI,CAAC+wB,UAAU;SAAEpN,IAAI;SAAEhF,CAAC;SAAEE;QAAG,CAAC;MACnE;KACD7R,QAAQ,GACR;OACCC,6BAAY,CAACC,IAAI,CAAC3R,MAAM,CAACiB,iCAAiC,CAAC;OAC3D,IAAI,CAACw0B,UAAU,GAAG,IAAI,CAACI,OAAO,CAACG,MAAM;MACrC;KACDO,UAAU,GACV;OACC,IAAI,CAACd,UAAU,GAAG,EAAE;;IAErB;GAED7wB,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAiCZ,CAAC;;CChID;AACA,CAAO,MAAM4xB,yBAAyB,GAAG;GACxCt0B,IAAI,EAAE,2BAA2B;GAEjCqV,KAAK,EACL;KACCvU,KAAK,EACL;OACCiJ,IAAI,EAAE0L,MAAM;OACZF,QAAQ,EAAE;MACV;KACDgf,OAAO,EACP;OACCxqB,IAAI,EAAEuL,KAAK;OACXC,QAAQ,EAAE;;IAEX;GAEDhV,QAAQ,EACR;KACCi0B,sBAAsB,GACtB;OACC,OAAO,CAAC;MACR;KACDC,eAAe,GACf;OACC,OAAO,IAAI,CAACF,OAAO,CAACptB,MAAM,GAAG,IAAI,CAACqtB,sBAAsB,GAAG,IAAI,CAACD,OAAO,CAACptB,MAAM,GAAG,IAAI,CAACqtB,sBAAsB,GAAG,CAAC;;IAEjH;GAED9xB,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;CAmBZ,CAAC;;CCvCD;CACA;CACA;CACA;AACA,CAAO,MAAMgyB,qBAAqB,GAAG;GACpC10B,IAAI,EAAE,uBAAuB;GAE7BC,UAAU,EAAE;YACXsI,wBAAK;sBACLrI;IACA;GAEDmV,KAAK,EAAE;KACN0B,QAAQ,EAAE;OACThN,IAAI,EAAEkL,MAAM;OACZM,QAAQ,EAAE;MACV;KACDrS,UAAU,EAAE;OACX6G,IAAI,EAAE0L,MAAM;OACZD,OAAO,EAAE/O,iDAAW,CAACF;;IAEtB;GAEDnG,IAAI,GACJ;KACC,OAAO;OACNwa,WAAW,EAAE;MACb;IACD;GAEDra,QAAQ,EAAE;KACTgD,GAAG,GACH;OACC,OAAOoD,sBAAG;MACV;KACDkU,IAAI,GACJ;OACC,OAAO,IAAIH,gBAAgB,CAAC,IAAI,CAAC3D,QAAQ,EAAE,IAAI,CAAC7T,UAAU,EAAEmM,uDAAmB,CAACyL,MAAM,CAAC;;IAExF;GAED7Y,OAAO,EAAE;KACRlB,GAAG,CAACmB,UAAkB,EAAEC,YAAqC,GAAG,EAAE,EAClE;OACC,OAAO,IAAI,CAACC,OAAO,CAACC,GAAG,CAACC,UAAU,CAACJ,UAAU,EAAEC,YAAY,CAAC;MAC5D;KACDkV,qBAAqB,CAAC5U,QAAgB,EACtC;OACC,IAAI,CAACoY,IAAI,CAACxD,qBAAqB,CAAC5U,QAAQ,CAAC;;IAE1C;GAEDC,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;CAyBZ,CAAC;;CCzED;AACA,CAAO,MAAMiyB,WAAW,GAAG;GAC1B30B,IAAI,EAAE,aAAa;GAEnBC,UAAU,EAAE;wBAAE20B,mEAAiB;KAAEN,yBAAyB;KAAEI;IAAuB;GAEnFlsB,UAAU,EAAE;KAAEwU,IAAI,EAAEC;IAAM;GAE1B5H,KAAK,EAAE;KACNwf,kBAAkB,EAAElf,OAAO;KAC3B2d,UAAU,EAAE3d;IACZ;GAEDxV,KAAK,EAAE,CAAC,YAAY,EAAE,kBAAkB,EAAE,mBAAmB,CAAC;GAE9DC,IAAI,GACJ;KACC,OAAO;OACNU,KAAK,EAAE,EAAE;OACT8U,YAAY,EAAE,KAAK;OACnBvS,SAAS,EAAE,IAAI;OACfwS,WAAW,EAAE,IAAI;OACjBif,QAAQ,EAAE,KAAK;OACfC,SAAS,EAAE,IAAI;OACfC,gBAAgB,EAAE;MAClB;IACD;GAEDz0B,QAAQ,EACR;KACC,GAAGsI,sBAAQ,CAAC1D,wDAAa,EAAE,CAAC,aAAa,EAAE,aAAa,CAAC,CAAC;KAC1D6Q,aAAa,GACb;OACC,OAAO,mFAAmF;MAC1F;KACDif,gBAAgB,GAChB;OAAA;OACC,MAAMhvB,KAAK,4BAAG,IAAI,CAACnB,WAAW,CAAC1B,GAAG,CAAC,IAAI,CAACqC,WAAW,CAAC,CAACQ,KAAK,oCAAI,EAAE;OAEhE,4BAAOA,KAAK,qCAALA,KAAK,CACTnE,MAAM,CAAEoF,QAAQ,IAAKA,QAAQ,CAACF,IAAI,KAAK,IAAI,CAACC,WAAW,CAACoL,IAAI,CAAC,qBADzD,cAEJpN,GAAG,CAAEiC,QAAQ,IAAKA,QAAQ,CAACguB,MAAM,IAAI,IAAI,CAAClf,aAAa,CAAC,gCAAI,EAAE;MAEjE;KACD9S,UAAU,GACV;OACC,OAAO,IAAI,CAAC4B,WAAW,CAAC1B,GAAG,CAAC,IAAI,CAACqC,WAAW,CAAC,CAACvC,UAAU;MACxD;KACD+D,WAAW,GACX;OACC,OAAOiL,kDAAc,CAAC,IAAI,CAAChP,UAAU,CAAC;MACtC;KACDiyB,gBAAgB,GAChB;OACC,OAAO,IAAI,CAACtf,WAAW,IAAI,IAAI,CAACif,QAAQ;;IAEzC;GAEDhsB,KAAK,EAAE;KACNrD,WAAW,CAAC2vB,KAAa,EAAEC,KAAa,EACxC;OACC,IAAI,CAACC,uBAAuB,CAACF,KAAK,EAAEC,KAAK,CAAC;MAC1C;KACD/B,UAAU,CAAC5d,SAAkB,EAC7B;OACC,IAAI,CAACG,WAAW,GAAGH,SAAS;MAC5B;KACD5Q,WAAW,EAAE;OACZiE,OAAO,CAACwsB,cAAc,EACtB;SACC,MAAMhvB,UAAU,GAAGgvB,cAAc,CAACnyB,GAAG,CAAC,IAAI,CAACqC,WAAW,CAAC;SACvD,IAAIc,UAAU,EACd;WAAA;WACC,IAAI,CAACzF,KAAK,uBAAGyF,UAAU,CAACvG,IAAI,+BAAI,EAAE;;QAEnC;OACDkJ,IAAI,EAAE;;IAEP;GAEDC,OAAO,GACP;KACC,IAAI,CAAC8Y,iBAAiB,EAAE;IACxB;GAEDG,aAAa,GACb;KACC,IAAI,CAACC,qBAAqB,EAAE;IAC5B;GAEDpgB,OAAO,EACP;KACCuzB,cAAc,GACd;OACC,IAAI,CAACjzB,KAAK,CAAC,mBAAmB,EAAE,CAAC,IAAI,CAACsT,WAAW,CAAC;MAClD;KACDyf,uBAAuB,CAACzxB,MAAc,EAAEwxB,KAAa,EACrD;OAAA;OACC,IAAI,CAAC,IAAI,CAACR,kBAAkB,IAAIQ,KAAK,KAAK,CAAC,EAC3C;SACC,IAAI,CAAC9yB,KAAK,CAAC,mBAAmB,EAAE,KAAK,CAAC;;OAGvC,IAAI,CAACwyB,SAAS,GAAG,IAAI;OACrB,MAAMxuB,UAAU,GAAG,IAAI,CAACzB,WAAW,CAAC1B,GAAG,CAACS,MAAM,CAAC;OAE/C,IAAI,CAAC+R,YAAY,GAAGrP,UAAU,CAACrD,UAAU,KAAKuD,iDAAW,CAAC8R,IAAI;OAC9D,IAAI,CAACzX,KAAK,wBAAGyF,UAAU,CAACvG,IAAI,gCAAI,EAAE;OAClC,IAAI,CAACqD,SAAS,4BAAGkD,UAAU,CAAClD,SAAS,oCAAI,IAAI;OAC7C,IAAI,CAAC0xB,SAAS,GAAG,KAAK;MACtB;KACDU,UAAU,GACV;OACC,IAAI,CAACT,gBAAgB,GAAG,IAAI;MAC5B;KACDU,UAAU,GACV;OACC,IAAI,CAACV,gBAAgB,GAAG,KAAK;MAC7B;KACD/S,iBAAiB,GACjB;OACC,IAAI,CAACnkB,MAAM,GAAG;SACb,CAACA,MAAM,CAACkB,yBAAyB,GAAG,IAAI,CAAC22B;QACzC;OACD53B,MAAM,CAACqnB,OAAO,CAAC,IAAI,CAACtnB,MAAM,CAAC,CAACiF,OAAO,CAAC,CAAC,CAACkB,KAAK,EAAEohB,MAAM,CAAC,KAAK;SACxD7V,6BAAY,CAACoH,SAAS,CAAC3S,KAAK,EAAEohB,MAAM,CAAC;QACrC,CAAC;MACF;KACDhD,qBAAqB,GACrB;OACCtkB,MAAM,CAACqnB,OAAO,CAAC,IAAI,CAACtnB,MAAM,CAAC,CAACiF,OAAO,CAAC,CAAC,CAACkB,KAAK,EAAEohB,MAAM,CAAC,KAAK;SACxD7V,6BAAY,CAACkH,WAAW,CAACzS,KAAK,EAAEohB,MAAM,CAAC;QACvC,CAAC;MACF;KACDsQ,mBAAmB,CAAC;OAAEv1B;MAAiB,EACvC;OACC,MAAM;SAAEmmB;QAAoB,GAAGnmB,IAAI;OACnC,IAAI,CAAC00B,QAAQ,GAAG,CAACvO,kBAAkB;;IAEpC;GAED7jB,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAqDZ,CAAC;;CCxMD;AACA,CAAO,MAAMkzB,UAAU,GAAG;GACzB51B,IAAI,EAAE,YAAY;GAClBC,UAAU,EAAE;YACXsI;IACA;GAEDnI,IAAI,GACJ;KACC,OAAO;OACN+L,IAAI,EAAE,KAAK;OACXrL,KAAK,EAAE,EAAE;OACTE,WAAW,EAAE,EAAE;OACf60B,cAAc,EAAE,EAAE;OAClBC,QAAQ,EAAE;MACV;IACD;GAEDv1B,QAAQ,EACR;KACCgD,GAAG,GACH;OACC,OAAOoD,sBAAG;;IAEX;GAED,MAAMnG,OAAO,GACb;KACC,IAAI,CAACM,KAAK,GAAG,IAAI,CAACC,GAAG,CAAC,mDAAmD,CAAC;KAC1E,IAAI,CAACC,WAAW,GAAG,IAAI,CAACD,GAAG,CAAC,yDAAyD,CAAC;KACtF,IAAI,CAAC80B,cAAc,GAAG,IAAI,CAAC90B,GAAG,CAAC,6DAA6D,CAAC;KAC7F,IAAI,CAAC+0B,QAAQ,GAAG,CACf,IAAI,CAAC/0B,GAAG,CAAC,uDAAuD,CAAC,EACjE,IAAI,CAACA,GAAG,CAAC,uDAAuD,CAAC,EACjE,IAAI,CAACA,GAAG,CAAC,uDAAuD,CAAC,EACjE,IAAI,CAACA,GAAG,CAAC,uDAAuD,CAAC,EACjE,IAAI,CAACA,GAAG,CAAC,uDAAuD,CAAC,EACjE,IAAI,CAACA,GAAG,CAAC,uDAAuD,CAAC,EACjE,IAAI,CAACA,GAAG,CAAC,uDAAuD,CAAC,CACjE;KAED,MAAM;OAAEsD;MAAiB,GAAG,MAAMX,QAAQ,CAACS,aAAa,EAAE;KAC1D,IAAI,CAACgI,IAAI,GAAG9H,eAAe,KAAK,GAAG,IAAI,IAAI,CAACvD,KAAK,CAACqG,MAAM,GAAG,CAAC;IAC5D;GAEDlF,OAAO,EAAE;KACR8zB,UAAU,GACV;OACCryB,QAAQ,CAACW,eAAe,EAAE;OAC1B,IAAI,CAAC8H,IAAI,GAAG,KAAK;OACjBuU,GAAG,CAAClT,EAAE,CAACpB,KAAK,CAACoD,YAAY,CAACC,IAAI,CAAC3R,MAAM,CAACY,mBAAmB,CAAC;MAC1D;KACDqC,GAAG,CAACmB,UAAkB,EAAEC,YAAqC,GAAG,EAAE,EAClE;OACC,OAAO,IAAI,CAACC,OAAO,CAACC,GAAG,CAACC,UAAU,CAACJ,UAAU,EAAEC,YAAY,CAAC;;IAE7D;GAEDO,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAgCZ,CAAC;;CC5ED;AACA,CAAO,MAAMszB,KAAK,GAAG;GACpB/1B,UAAU,EAAE;sBACXg2B,yBAAe;KACf7L,IAAI;KACJiJ,cAAc;kBACd6C,uDAAW;KACXN,UAAU;KACVjB,WAAW;KACX9mB;IACA;GAEDzN,IAAI,GACJ;KACC,OAAO;OACN+1B,MAAM,EAAE;SACPC,KAAK,EAAE,KAAK;SACZC,KAAK,EAAE,KAAK;SACZC,cAAc,EAAE;WACfpV,CAAC,EAAE,CAAC;WACJE,CAAC,EAAE,CAAC;WACJ8E,IAAI,EAAE;;QAEP;OACDqQ,MAAM,EAAE;SACPH,KAAK,EAAE,KAAK;SACZ5d,UAAU,EAAE,KAAK;SACjBC,kBAAkB,EAAE,IAAI;SACxB+d,MAAM,EAAE,EAAE;SACV3yB,MAAM,EAAE,CAAC;SACTuL,MAAM,EAAE;QACR;OACDqnB,WAAW,EAAE;SACZ/gB,SAAS,EAAE,IAAI;SACfoY,aAAa,EAAE;QACf;;OAED4I,qBAAqB,EAAE;MACvB;IACD;GAEDn2B,QAAQ,EACR;KACC0qB,MAAM,GACN;OACC,MAAM;SAAEpqB,EAAE,EAAEoqB;QAAQ,GAAG,CAAC,GAAG,IAAI,CAACnmB,WAAW,CAAC8P,MAAM,EAAE,CAAC,CAACxC,IAAI,CAAE7L,UAAU,IAAK;SAC1E,OAAOA,UAAU,CAACvD,QAAQ,KAAK,CAAC;QAChC,CAAC;OAEF,OAAOioB,MAAM;MACb;KACD,GAAGpiB,sBAAQ,CAAC1D,wDAAa,EAAE,CAAC,aAAa,EAAE,oBAAoB,CAAC;IAChE;GAED,MAAMgE,OAAO,GACb;KACC,MAAMwtB,MAAM,GAAGnpB,EAAE,CAACC,SAAS,CAACC,QAAQ,CAACkpB,YAAY,EAAE;KACnDD,MAAM,oBAANA,MAAM,CAAElB,UAAU,EAAE;KACpB,MAAM,CAACoB,eAAe,EAAE9xB,kBAAkB,EAAEC,MAAM,CAAC,GAAG,MAAM8xB,OAAO,CAACC,GAAG,CAAC,CACvErzB,QAAQ,CAACI,kBAAkB,EAAE,EAC7BJ,QAAQ,CAACQ,qBAAqB,EAAE,EAChCR,QAAQ,CAACU,SAAS,EAAE,CACpB,CAAC;KACFuyB,MAAM,oBAANA,MAAM,CAAEK,WAAW,EAAE;KACrB,MAAMlyB,WAAW,GAAG+xB,eAAe,CAACI,SAAS;KAC7C,MAAM3xB,YAAY,GAAGvH,MAAM,CAACqnB,OAAO,CAACyR,eAAe,CAAC5xB,GAAG,CAAC,CAAC6d,MAAM,CAAC,CAAC7d,GAAG,EAAE,CAACpE,EAAE,EAAEgM,KAAK,CAAC,KAAK;OACrF5H,GAAG,CAAC1B,GAAG,CAAC0R,MAAM,CAACpU,EAAE,CAAC,EAAE;SAAEA,EAAE,EAAEoU,MAAM,CAACpU,EAAE,CAAC;SAAE,GAAGgM;QAAO,CAAC;OAEjD,OAAO5H,GAAG;MACV,EAAE,IAAInC,GAAG,EAAE,CAAC;KACb,MAAMo0B,iBAAiB,GAAGxzB,QAAQ,CAACf,mBAAmB,CAACmC,WAAW,CAAC;KACnE,MAAMqyB,oBAAoB,GAAGpyB,kBAAkB,CAACjD,MAAM,CAAEC,IAAI,IAAKm1B,iBAAiB,CAACnwB,GAAG,CAAChF,IAAI,CAAC,CAAC;KAC7F6C,eAAe,CAACC,SAAS,CAACqyB,iBAAiB,EAAEC,oBAAoB,EAAEnyB,MAAM,EAAEM,YAAY,CAAC;KACxF,IAAI,CAAC8xB,UAAU,GAAG,GAAG;KACrB,IAAI,CAACC,eAAe,EAAE;KACtB,IAAI,CAAClB,MAAM,CAACC,KAAK,GAAG,IAAI;KACxB,IAAI,CAACkB,YAAY,GAAG,KAAK;KACzB9nB,6BAAY,CAACoH,SAAS,CAAC9Y,MAAM,CAACgB,+BAA+B,EAAE,IAAI,CAACy4B,yBAAyB,CAAC;KAC9F/pB,EAAE,CAACgqB,IAAI,CAAC5gB,SAAS,CAAC;OACjB7M,IAAI,EAAEyD,EAAE,CAACiqB,UAAU,CAACC,gBAAgB,CAACC,MAAM;OAC3CC,QAAQ,EAAE,gBAAgB;OAC1BC,OAAO,EAAE,kBAAkB;OAC3BC,QAAQ,EAAG13B,IAAI,IAAK,IAAI,CAAC23B,cAAc,CAAC33B,IAAI;MAC5C,CAAC;KACFoP,6BAAY,CAACoH,SAAS,CAAC9Y,MAAM,CAACmB,qBAAqB,EAAE,IAAI,CAAC+4B,sBAAsB,CAAC;KACjFxoB,6BAAY,CAACoH,SAAS,CAAC9Y,MAAM,CAACoB,gBAAgB,EAAE,IAAI,CAAC+4B,4BAA4B,CAAC;KAClFzoB,6BAAY,CAACoH,SAAS,CAAC9Y,MAAM,CAACe,6BAA6B,EAAE,IAAI,CAACq5B,6BAA6B,CAAC;KAChG1oB,6BAAY,CAACoH,SAAS,CAAC9Y,MAAM,CAACiB,iCAAiC,EAAE,IAAI,CAACwQ,QAAQ,CAAC;IAC/E;GAED0Q,SAAS,GACT;KACCzQ,6BAAY,CAACkH,WAAW,CAAC5Y,MAAM,CAACgB,+BAA+B,EAAE,IAAI,CAACy4B,yBAAyB,CAAC;KAChG/nB,6BAAY,CAACkH,WAAW,CAAC5Y,MAAM,CAACmB,qBAAqB,EAAE,IAAI,CAAC+4B,sBAAsB,CAAC;KACnFxoB,6BAAY,CAACkH,WAAW,CAAC5Y,MAAM,CAACoB,gBAAgB,EAAE,IAAI,CAAC+4B,4BAA4B,CAAC;KACpFzoB,6BAAY,CAACkH,WAAW,CAAC5Y,MAAM,CAACe,6BAA6B,EAAE,IAAI,CAACq5B,6BAA6B,CAAC;KAClG1oB,6BAAY,CAACkH,WAAW,CAAC5Y,MAAM,CAACiB,iCAAiC,EAAE,IAAI,CAACwQ,QAAQ,CAAC;IACjF;GAEDtN,OAAO,EACP;KACCk2B,QAAQ,CAAC;OAAEjX,CAAC;OAAEE,CAAC;OAAEvd;MAAmD,EACpE;OACC,MAAM;SAAEqd,CAAC,EAAEkF,KAAK;SAAEhF,CAAC,EAAEiF,KAAK;SAAEH;QAAM,GAAG,IAAI,CAACiQ,MAAM,CAACG,cAAc;OAC/D,MAAM8B,sBAAsB,GAAGz4B,gBAAgB,GAAGumB,IAAI;OACtD,MAAMmS,IAAI,GAAGnX,CAAC,GAAGkX,sBAAsB,GAAG,CAAC;OAC3C,MAAME,IAAI,GAAGz0B,MAAM,KAAK,IAAI,CAAConB,MAAM,GAAG,IAAI,CAACmM,UAAU,GAAGhW,CAAC,GAAG8E,IAAI;OAChE,MAAMqS,SAAS,GAAGvT,IAAI,CAACC,KAAK,CAACoT,IAAI,CAAC,KAAKrT,IAAI,CAACC,KAAK,CAACmB,KAAK,CAAC,IAAIpB,IAAI,CAACC,KAAK,CAAC7D,CAAC,CAAC,KAAK4D,IAAI,CAACC,KAAK,CAACoB,KAAK,CAAC;OAC/F,IAAI,CAACoQ,WAAW,GAAG;SAClB,GAAG,IAAI,CAACA,WAAW;SACnB/gB,SAAS,EAAE;QACX;OACD,IAAI6iB,SAAS,EACb;SACC;;OAGD,IAAI,CAACpC,MAAM,GAAG;SACb,GAAG,IAAI,CAACA,MAAM;SACdE,KAAK,EAAE,IAAI;SACXC,cAAc,EAAE;WAAE,GAAG,IAAI,CAACH,MAAM,CAACG,cAAc;WAAEpV,CAAC,EAAEmX,IAAI,GAAGnS,IAAI;WAAE9E,CAAC,EAAEkX,IAAI;WAAEpS,IAAI,EAAE;;QAChF;OACD,IAAI,CAACsS,iBAAiB,EAAE;MACxB;KACDjpB,QAAQ,CAAC;OAAEnP;MAAiB,EAC5B;OACC,IAAIA,IAAI,CAACyD,MAAM,EACf;SACC,IAAI,CAACkI,KAAK,CAAC8Z,IAAI,CAACoH,kBAAkB,CAAC7sB,IAAI,CAACyD,MAAM,CAAC;SAE/C;;OAGD,IAAI,CAACkI,KAAK,CAAC8Z,IAAI,CAACyK,yBAAyB,EAAE;MAC3C;KACD0H,sBAAsB,CAAC;OAAE53B;MAAiB,EAC1C;OACC,IAAI,CAACq4B,YAAY,CAACr4B,IAAI,CAAC;MACvB;KACDq4B,YAAY,CAAC;OACZ50B,MAAM,GAAG,CAAC;OACV2U,UAAU,GAAG,KAAK;OAClBzO,IAAI;OACJ0O,kBAAkB,GAAG,IAAI;OACzBrJ,MAAM,GAAG,EAAE;OACXlM,UAAU;OACV0V;MACsF,GAAG,EAAE,EAC5F;OACC,IAAI,CAAC2d,MAAM,GAAG;SACb,GAAG,IAAI,CAACA,MAAM;SACdH,KAAK,EAAE,IAAI;SACX5d,UAAU;SACVC,kBAAkB;SAClB+d,MAAM,EAAEzsB,IAAI;SACZlG,MAAM;SACNuL,MAAM;SACNlM,UAAU;SACV0V;QACA;OAED,IAAI,CAACJ,UAAU,IAAIpJ,MAAM,KAAKC,uDAAmB,CAACC,MAAM,EACxD;SACChG,qBAAiB,CAAC;WACjBvF,IAAI,EAAE,WAAW;WACjBC,QAAQ,EAAE,WAAW;WACrBC,KAAK,EAAE,mBAAmB;WAC1By0B,SAAS,EAAEtpB;UACX,CAAC;;;;OAIH,QAAQrF,IAAI;SAEX,KAAK,YAAY;WAChBT,qBAAiB,CAAC;aACjBvF,IAAI,EAAE,WAAW;aACjBC,QAAQ,EAAE,WAAW;aACrBC,KAAK,EAAE,mBAAmB;aAC1By0B,SAAS,EAAEtpB;YACX,CAAC;WACF;SACD,KAAK,WAAW;WACf9F,qBAAiB,CAAC;aACjBvF,IAAI,EAAE,WAAW;aACjBC,QAAQ,EAAE,WAAW;aACrBC,KAAK,EAAE,mBAAmB;aAC1By0B,SAAS,EAAEtpB;YACX,CAAC;WACF;SACD,KAAK,UAAU;WACd9F,qBAAiB,CAAC;aACjBvF,IAAI,EAAE,WAAW;aACjBC,QAAQ,EAAE,WAAW;aACrBC,KAAK,EAAE,mBAAmB;aAC1By0B,SAAS,EAAEtpB;YACX,CAAC;WACF;SACD,KAAK,YAAY;WAChB9F,qBAAiB,CAAC;aACjBvF,IAAI,EAAE,WAAW;aACjBC,QAAQ,EAAE,WAAW;aACrBC,KAAK,EAAE,mBAAmB;aAC1By0B,SAAS,EAAEtpB;YACX,CAAC;WACF;;MAEF;KACDupB,YAAY,CAAC;OAAE93B,EAAE;OAAEy2B;MAAc,EACjC;OACC,IAAI,CAACA,YAAY,GAAGA,YAAY,WAAZA,YAAY,GAAI,KAAK;OACzC,MAAM;SAAEzR;QAAM,GAAG,IAAI,CAAC9Z,KAAK;OAC3B8Z,IAAI,CAACoH,kBAAkB,CAACpsB,EAAE,CAAC;MAC3B;KACD+3B,aAAa,GACb;OACC,IAAI,CAACrC,MAAM,CAACH,KAAK,GAAG,KAAK;MACzB;KACD6B,4BAA4B,CAAC;OAAE73B;MAAiB,EAChD;OACC,IAAI,CAACy4B,kBAAkB,CAACz4B,IAAI,CAACyD,MAAM,EAAEzD,IAAI,CAAC8C,UAAU,CAAC;MACrD;KACD21B,kBAAkB,CAACh1B,MAAc,EAAEX,UAAkB,EACrD;OACC,MAAM;SAAE2iB;QAAM,GAAG,IAAI,CAAC9Z,KAAK;OAC3B8Z,IAAI,CAACkI,mBAAmB,CAAClqB,MAAM,EAAEX,UAAU,CAAC;MAC5C;KACD,MAAM41B,eAAe,GACrB;OACC,IAAI,IAAI,CAAC3C,MAAM,CAACE,KAAK,EACrB;SACC,IAAI,CAACK,qBAAqB,GAAG,IAAI;;OAGlC,IAAI,CAACP,MAAM,CAACE,KAAK,GAAG,KAAK;OACzB,IAAI,CAAC,IAAI,CAACiB,YAAY,EACtB;SACC;;OAGD,IAAI,CAACZ,qBAAqB,GAAG,KAAK;OAClC,MAAMjK,OAAO,GAAGsM,oBAAQ,CAACC,IAAI,CAAC;SAC7BC,aAAa,EAAE,GAAG;SAClBC,aAAa,EAAE,EAAE;SACjBC,MAAM,EAAE,GAAG;SACXC,KAAK,EAAE,GAAG;SACVC,MAAM,EAAE;WAAEjY,CAAC,EAAE,GAAG;WAAEF,CAAC,EAAE;;QACrB,CAAC;OACF,IAAI,CAACoW,YAAY,GAAG,KAAK;OACzB,MAAM7K,OAAO;OACb,IAAI,CAACiK,qBAAqB,GAAG,IAAI;MACjC;KACD4C,eAAe,CAAC;OAAElZ,aAAa;OAAE0N;MAAe,EAChD;OACC,IAAI,CAAC2I,WAAW,GAAG;SAClB,GAAG,IAAI,CAACA,WAAW;SACnB3I;QACA;OACD,IAAI,CAAC1N,aAAa,EAClB;SACC;;OAGD,IAAI,CAACqW,WAAW,GAAG;SAClB,GAAG,IAAI,CAACA,WAAW;SACnB/gB,SAAS,EAAE;QACX;MACD;KACD2hB,eAAe,GACf;OACC,MAAM;SAAEnR;QAAM,GAAG,IAAI,CAACiQ,MAAM,CAACG,cAAc;OAC3C,MAAM;SAAE1O,WAAW;SAAEhI;QAAc,GAAG,IAAI,CAACD,GAAG;OAC9C,MAAM,CAAC4Q,iBAAiB,CAAC,GAAG,IAAI,CAACxrB,kBAAkB;OACnD,MAAMqc,CAAC,GAAGmP,iBAAiB,KAAK,IAAI,CAACtF,MAAM,GAAG,IAAI,CAACmM,UAAU,GAAGxX,YAAY,GAAG,CAAC,GAAIA,YAAY,GAAGsG,IAAI,GAAI,CAAC;OAC5G,IAAI,CAACiQ,MAAM,CAACG,cAAc,GAAG;SAC5B,GAAG,IAAI,CAACH,MAAM,CAACG,cAAc;SAC7BpV,CAAC,EAAE0G,WAAW,GAAG,CAAC,GAAIA,WAAW,GAAG1B,IAAI,GAAI,CAAC;SAC7C9E;QACA;MACD;KACDoX,iBAAiB,GACjB;OACChpB,6BAAY,CAACC,IAAI,CAAC3R,MAAM,CAACsB,+BAA+B,CAAC;OACzDoQ,6BAAY,CAACC,IAAI,CAAC3R,MAAM,CAACS,wBAAwB,CAAC;MAClD;KACDg5B,yBAAyB,CAACtzB,KAAgB,EAC1C;OACC,MAAM,CAACs1B,YAAY,CAAC,GAAGt1B,KAAK,CAACL,OAAO,EAAE;OACtC,MAAM41B,OAAO,GAAGD,YAAY,CAACE,UAAU,EAAE;OACzC,IAAID,OAAO,KAAK,8BAA8B,EAC9C;SACC;;OAGD,MAAM;SAAE3lB;QAAO,GAAG0lB,YAAY,CAAC31B,OAAO,EAAE;OACxCiQ,KAAK,CAAC9Q,OAAO,CAAE6D,IAAI,IAAK;SACvB,MAAM8yB,eAAe,GAAGC,wDAAkB,CAAC/yB,IAAI,CAAC;SAChDhC,eAAe,CAAC6C,UAAU,CAACiyB,eAAe,CAAC;QAC3C,CAAC;MACF;KACD3B,cAAc,CAAC33B,IAAI,EACnB;OACC,MAAM+H,OAAO,GAAGpK,MAAM,CAAC8lB,IAAI,CAACzjB,IAAI,CAAC,CAAC6E,GAAG,CAAE+N,GAAG,IAAKiC,MAAM,CAACjC,GAAG,CAAC,CAAC;OAC3DpO,eAAe,CAACsD,mBAAmB,CAACC,OAAO,CAAC;MAC5C;KACDyxB,SAAS,CAAC31B,KAAoB,EAC9B;OACC,IAAI,CAAC,IAAI,CAACyyB,qBAAqB,EAC/B;SACCzyB,KAAK,CAAC41B,cAAc,EAAE;;MAEvB;KACD3B,6BAA6B,CAAC;OAAE93B;MAAiB,EACjD;OACC,MAAM;SAAEumB,UAAU;SAAEC,UAAU;SAAEmD;QAAO,GAAG3pB,IAAI;OAC9C,IAAIumB,UAAU,KAAK,CAAC,EACpB;SACC,IAAI,CAACwP,MAAM,CAACG,cAAc,CAACpV,CAAC,IAAI,CAACyF,UAAU,GAAGoD,KAAK;;OAGpD,IAAInD,UAAU,KAAK,CAAC,EACpB;SACC,IAAI,CAACuP,MAAM,CAACG,cAAc,CAAClV,CAAC,IAAI,CAACwF,UAAU,GAAGmD,KAAK;;;IAGrD;GAEDrnB,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAgDZ,CAAC;;CCzYM,MAAMo3B,kBAAkB,SAASjjB,kBAAkB,CAC1D;GACCC,WAAW,CAACC,QAAgB,EAAES,cAAsB,EAAExQ,IAAY,EAAE9D,UAAkB,EACtF;KACC,KAAK,CAAC6T,QAAQ,CAAC;KACf,IAAI,CAACS,cAAc,GAAGA,cAAc;KACpC,IAAI,CAACxQ,IAAI,GAAGA,IAAI;KAChB,IAAI,CAAC9D,UAAU,GAAGA,UAAU;KAC5B,IAAI,CAACoI,KAAK,GAAG,IAAI,CAAC4L,gBAAgB,EAAE;;GAGrCF,QAAQ,GACR;KACC,OAAO,CACN,IAAIuC,mBAAmB,CAAC,IAAI,CAACrW,UAAU,EAAE,IAAI,CAAC8D,IAAI,CAAC,EACnD,IAAI+S,qBAAqB,CAAC,IAAI,CAAC7W,UAAU,EAAE,IAAI,CAAC8D,IAAI,CAAC,CACrD;;CAEH;;CChBO,MAAM+yB,uBAAuB,SAASljB,kBAAkB,CAC/D;GACCC,WAAW,CAACC,QAAgB,EAAES,cAAsB,EAAExQ,IAAY,EAAE9D,UAAkB,EACtF;KACC,KAAK,CAAC6T,QAAQ,CAAC;KACf,IAAI,CAAC7T,UAAU,GAAGA,UAAU;KAC5B,IAAI,CAACsU,cAAc,GAAGA,cAAc;KACpC,IAAI,CAACxQ,IAAI,GAAGA,IAAI;KAChB,IAAI,CAACsE,KAAK,GAAG,IAAI,CAAC4L,gBAAgB,EAAE;;GAGrCF,QAAQ,GACR;KACC,IAAI,IAAI,CAAC9T,UAAU,KAAKuD,iDAAW,CAAC8R,IAAI,EACxC;OACC,OAAO,CACN,IAAIgB,mBAAmB,CAAC,IAAI,CAACrW,UAAU,EAAE,IAAI,CAAC8D,IAAI,CAAC,CACnD;;KAGF,OAAO,CACN,IAAIkT,oBAAoB,EAAE,EAC1B,IAAII,kBAAkB,EAAE,EACxB,IAAIf,mBAAmB,CAAC,IAAI,CAACrW,UAAU,EAAE,IAAI,CAAC8D,IAAI,CAAC,CACnD;;CAEH;;CCxBO,MAAMgzB,2BAA2B,SAASviB,gBAAgB,CACjE;GACCX,WAAW,CAACmjB,aAAsB,EAClC;KACC,KAAK,CAAC;OACLp5B,EAAE,EAAE8W,WAAW,CAACO,mBAAmB;OACnCpX,KAAK,EAAEm5B,aAAa,GACjB53B,aAAG,CAACC,UAAU,CACf,kFAAkF,CAClF,GACCD,aAAG,CAACC,UAAU,CACf,gFAAgF,CAChF;OACFtB,WAAW,EAAEqB,aAAG,CAACC,UAAU,CAC1B,4FAA4F,CAC5F;OACDrB,KAAK,EAAE;SACNjB,IAAI,EAAEkB,wBAAI,CAACg5B,YAAY;SACvB94B,IAAI,EAAE,EAAE;SACRC,KAAK,EAAEC,kDAAY,CAAC,cAAc;QAClC;OACDoW,gBAAgB,EAAEuiB,aAAa,GAAG,EAAE,GAAGx4B,mEAAiB,CAAC04B,YAAY;OACrE7sB,UAAU,EAAE;MACZ,CAAC;;GAGH8J,aAAa,CAAC3W,iBAAyC,EAAEsW,QAAgB,EACzE;KACC,OAAOtW,iBAAiB,CAACuB,qBAAqB,CAAC,IAAI,CAAC0V,gBAAgB,CAAC;;CAEvE;;CC9BO,MAAM0iB,0BAA0B,SAAS3iB,gBAAgB,CAChE;GACCX,WAAW,CAAC5T,UAAkB,EAC9B;KACC,MAAMpC,KAAK,GAAGoC,UAAU,KAAKuD,iDAAW,CAAC8R,IAAI,GAC1ClW,aAAG,CAACC,UAAU,CAAC,mFAAmF,CAAC,GACnGD,aAAG,CAACC,UAAU,CAAC,yFAAyF,CAAC;KAG5G,MAAMtB,WAAW,GAAGkC,UAAU,KAAKuD,iDAAW,CAAC8R,IAAI,GAChDlW,aAAG,CAACC,UAAU,CAAC,sFAAsF,CAAC,GACtGD,aAAG,CAACC,UAAU,CAAC,4FAA4F,CAAC;KAG/G,KAAK,CAAC;OACLzB,EAAE,EAAE8W,WAAW,CAACM,2BAA2B;OAC3CnX,KAAK;OACLE,WAAW;OACXC,KAAK,EAAE;SACNjB,IAAI,EAAEkB,wBAAI,CAACiZ,mBAAmB;SAC9B/Y,IAAI,EAAE,EAAE;SACRC,KAAK,EAAEC,kDAAY,CAAC,eAAe;QACnC;OACDoW,gBAAgB,EAAE,IAAI;OACtBpK,UAAU,EAAE;MACZ,CAAC;KAEF,IAAI,CAACpK,UAAU,GAAGA,UAAU;;GAG7BkU,aAAa,CAAC3W,iBAAyC,EAAEsW,QAAgB,EACzE;KACC,MAAMsjB,WAAW,GAAG55B,iBAAiB,CAAC2Z,sBAAsB;KAE5D,MAAMkgB,yBAAyB,GAAG,IAAI,CAACp3B,UAAU,KAAKuD,iDAAW,CAAC8R,IAAI,GACnE9W,mEAAiB,CAACqX,aAAa,GAC/BrX,mEAAiB,CAACI,uBAAuB;KAG5C,MAAM04B,4BAA4B,GAAG,IAAI,CAACr3B,UAAU,KAAKuD,iDAAW,CAAC8R,IAAI,GACtE9W,mEAAiB,CAACuxB,gBAAgB,GAClCvxB,mEAAiB,CAACwxB,4BAA4B;KAGjD,MAAMuH,wBAAwB,GAAG,IAAI,CAACt3B,UAAU,KAAKuD,iDAAW,CAAC8R,IAAI,GAClE8hB,WAAW,CAACI,sBAAsB,GAClCJ,WAAW,CAACK,iCAAiC;KAGhD,MAAMC,2BAA2B,GAAG,IAAI,CAACz3B,UAAU,KAAKuD,iDAAW,CAAC8R,IAAI,GACrE8hB,WAAW,CAACO,yBAAyB,GACrCP,WAAW,CAAChgB,sCAAsC;KAGrD,MAAMwgB,kBAAkB,GAAGL,wBAAwB,GAAGG,2BAA2B,GAC9EL,yBAAyB,GACzBC,4BAA4B;KAG/B,OAAO95B,iBAAiB,CAAC2W,aAAa,CAACyjB,kBAAkB,EAAE9jB,QAAQ,CAAC;;CAEtE;;CC9DO,MAAM+jB,4BAA4B,SAASrjB,gBAAgB,CAClE;GACCX,WAAW,CAAC5T,UAAkB,EAC9B;KACC,MAAMpC,KAAK,GAAGoC,UAAU,KAAKuD,iDAAW,CAAC8R,IAAI,GAC1ClW,aAAG,CAACC,UAAU,CAAC,+EAA+E,CAAC,GAC/FD,aAAG,CAACC,UAAU,CAAC,qFAAqF,CAAC;KAGxG,MAAMtB,WAAW,GAAGkC,UAAU,KAAKuD,iDAAW,CAAC8R,IAAI,GAChDlW,aAAG,CAACC,UAAU,CAAC,kFAAkF,CAAC,GAClGD,aAAG,CAACC,UAAU,CAAC,wFAAwF,CAAC;KAG3G,MAAMjB,KAAK,GAAG6B,UAAU,KAAKuD,iDAAW,CAAC8R,IAAI,GAC1CjX,kDAAY,CAAC,cAAc,CAAC,GAC5BA,kDAAY,CAAC,eAAe,CAAC;KAGhC,MAAMoW,gBAAgB,GAAGxU,UAAU,KAAKuD,iDAAW,CAAC8R,IAAI,GACrD9W,mEAAiB,CAACuxB,gBAAgB,GAClCvxB,mEAAiB,CAACwxB,4BAA4B;KAGjD,KAAK,CAAC;OACLpyB,EAAE,EAAE8W,WAAW,CAACrH,wBAAwB;OACxCxP,KAAK;OACLE,WAAW;OACXC,KAAK,EAAE;SACNjB,IAAI,EAAEkB,wBAAI,CAACoY,SAAS;SACpBlY,IAAI,EAAE,EAAE;SACRC;QACA;OACDqW,gBAAgB;OAChBpK,UAAU,EAAE;MACZ,CAAC;;CAEJ;;CCtCO,MAAM8H,kBAAkB,SAASyB,kBAAkB,CAC1D;GAGCC,WAAW,CAACC,QAAgB,EAAE7T,UAAkB,EAAE+2B,aAAsB,EACxE;KACC,KAAK,CAACljB,QAAQ,CAAC;KACf,IAAI,CAACkjB,aAAa,GAAGA,aAAa;KAClC,IAAI,CAAC/2B,UAAU,GAAGA,UAAU;KAC5B,IAAI,CAACoI,KAAK,GAAG,IAAI,CAAC4L,gBAAgB,EAAE;;GAGrCF,QAAQ,GACR;KACC,IAAI,IAAI,CAAC9T,UAAU,KAAKuD,iDAAW,CAAC8R,IAAI,EACxC;OACC,OAAO,CACN,IAAI6hB,0BAA0B,CAAC,IAAI,CAACl3B,UAAU,CAAC,EAC/C,IAAI43B,4BAA4B,CAAC,IAAI,CAAC53B,UAAU,CAAC,CACjD;;KAGF,OAAO,CACN,IAAIk3B,0BAA0B,CAAC,IAAI,CAACl3B,UAAU,CAAC,EAC/C,IAAI43B,4BAA4B,CAAC,IAAI,CAAC53B,UAAU,CAAC,EACjD,IAAI82B,2BAA2B,CAAC,IAAI,CAACC,aAAa,CAAC,CACnD;;CAEH;;CC1BA;CACA;CACA;CACA;CACA;AACA,CAAO,MAAMc,gBAAgB,SAAStjB,gBAAgB,CACtD;GAGCX,WAAW,CAAC5T,UAAkB,EAAEqQ,IAA2B,EAC3D;KACC,MAAMzS,KAAK,GAAGyS,IAAI,CAACxJ,IAAI,KAAKixB,+CAAS,CAACznB,IAAI,GACvClR,aAAG,CAACC,UAAU,CAAC,wEAAwE,CAAC,GACxFD,aAAG,CAACC,UAAU,CAAC,2EAA2E,CAAC;KAG9F,MAAMtB,WAAW,GAAGuS,IAAI,CAACxJ,IAAI,KAAKixB,+CAAS,CAACznB,IAAI,GAC7ClR,aAAG,CAACC,UAAU,CAAC,8EAA8E,CAAC,GAC9FD,aAAG,CAACC,UAAU,CAAC,iFAAiF,CAAC;KAGpG,KAAK,CAAC;OACLzB,EAAE,EAAE8W,WAAW,CAACQ,QAAQ;OACxBrX,KAAK;OACLE,WAAW;OACXC,KAAK,EAAE;SACNjB,IAAI,EAAEkB,wBAAI,CAACyX,WAAW;SACtBvX,IAAI,EAAE,EAAE;SACRC,KAAK,EAAEC,kDAAY,CAAC,eAAe;QACnC;OACDoW,gBAAgB,EAAE,IAAI;OACtBpK,UAAU,EAAE;MACZ,CAAC;KAEF,IAAI,CAACpK,UAAU,GAAGA,UAAU;KAC5B,IAAI,CAACqQ,IAAI,GAAGA,IAAI;;GAGjB6D,aAAa,CAAC3W,iBAAyC,EAAEsW,QAAgB,EACzE;KACC,OAAO,IAAI,CAACxD,IAAI,CAAC0nB,SAAS;;CAE5B;;CC1CA;CACA;CACA;CACA;CACA;AACA,CAAO,MAAMC,kBAAkB,SAASzjB,gBAAgB,CACxD;GAGCX,WAAW,CAAC5T,UAAkB,EAAEqQ,IAA2B,EAC3D;KACC,IAAIzS,KAAK,GAAG,EAAE;KACd,IAAIE,WAAW,GAAG,EAAE;KAEpB,IAAIkC,UAAU,KAAKuD,iDAAW,CAAC8R,IAAI,EACnC;OACCzX,KAAK,GAAGyS,IAAI,CAACxJ,IAAI,KAAKixB,+CAAS,CAACznB,IAAI,GACjClR,aAAG,CAACC,UAAU,CAAC,+EAA+E,CAAC,GAC/FD,aAAG,CAACC,UAAU,CAAC,kFAAkF,CAAC;OAGrGtB,WAAW,GAAGuS,IAAI,CAACxJ,IAAI,KAAKixB,+CAAS,CAACznB,IAAI,GACvClR,aAAG,CAACC,UAAU,CAAC,qFAAqF,CAAC,GACrGD,aAAG,CAACC,UAAU,CAAC,wFAAwF,CAAC;MAE3G,MAED;OACCxB,KAAK,GAAGyS,IAAI,CAACxJ,IAAI,KAAKixB,+CAAS,CAACznB,IAAI,GACjClR,aAAG,CAACC,UAAU,CAAC,qFAAqF,CAAC,GACrGD,aAAG,CAACC,UAAU,CAAC,wFAAwF,CAAC;OAG3GtB,WAAW,GAAGuS,IAAI,CAACxJ,IAAI,KAAKixB,+CAAS,CAACznB,IAAI,GACvClR,aAAG,CAACC,UAAU,CAAC,2FAA2F,CAAC,GAC3GD,aAAG,CAACC,UAAU,CAAC,8FAA8F,CAAC;;KAIlH,MAAMoV,gBAAgB,GAAGxU,UAAU,KAAKuD,iDAAW,CAAC8R,IAAI,GACrD9W,mEAAiB,CAACsX,qBAAqB,GACvCtX,mEAAiB,CAACyX,2BAA2B;KAGhD,KAAK,CAAC;OACLrY,EAAE,EAAE8W,WAAW,CAACS,UAAU;OAC1BtX,KAAK;OACLE,WAAW;OACXC,KAAK,EAAE;SACNjB,IAAI,EAAEkB,wBAAI,CAACoY,SAAS;SACpBlY,IAAI,EAAE,EAAE;SACRC,KAAK,EAAEC,kDAAY,CAAC,cAAc;QAClC;OACDoW,gBAAgB;OAChBpK,UAAU,EAAE;MACZ,CAAC;KAEF,IAAI,CAACiG,IAAI,GAAGA,IAAI;;GAGjB6D,aAAa,CAAC3W,iBAAyC,EAAEsW,QAAgB,EACzE;KACC,OAAO,CAAC,IAAI,CAACxD,IAAI,CAAC4nB,cAAc,IAC5B,IAAI,CAAC5nB,IAAI,CAAC0nB,SAAS,IACnBx6B,iBAAiB,CAAC2W,aAAa,CAAC,IAAI,CAACM,gBAAgB,EAAEX,QAAQ,CAAC;;CAGtE;;CCtEA;CACA;CACA;CACA;AACA,CAAO,MAAMqkB,kBAAkB,SAASvkB,kBAAkB,CAC1D;GAGCC,WAAW,CAAC5T,UAAkB,EAAEqQ,IAA2B,EAAEwD,QAAgB,EAC7E;KACC,KAAK,CAACA,QAAQ,CAAC;KACf,IAAI,CAACxD,IAAI,GAAGA,IAAI;KAChB,IAAI,CAACrQ,UAAU,GAAGA,UAAU;KAC5B,IAAI,CAACoI,KAAK,GAAG,IAAI,CAAC4L,gBAAgB,EAAE;;GAGrCF,QAAQ,GACR;KACC,OAAO,CACN,IAAI+jB,gBAAgB,CAAC,IAAI,CAAC73B,UAAU,EAAE,IAAI,CAACqQ,IAAI,CAAC,EAChD,IAAI2nB,kBAAkB,CAAC,IAAI,CAACh4B,UAAU,EAAE,IAAI,CAACqQ,IAAI,CAAC,CAClD;;CAEH;;;;AC5BA,CAGiC;CAAA;AAEjC,CAAO,MAAM8nB,iBAAiB,CAC9B;GAmBC,aAAaC,KAAK,CAACC,WAAmB,EACtC;KACC,MAAMC,SAAS,GAAGttB,QAAQ,CAACC,cAAc,CAACotB,WAAW,CAAC;KACtD3vB,aAAG,CAAC+b,MAAM,yCAAC,IAAI,+DAAgC6T,SAAS,CAAC;KACzD,4CAAI;KAEJ,MAAMC,YAAY,GAAG,KAAK;KAC1B,IAAI,CAACC,6BAA6B,GAAGC,WAAW,CAAC,YAAY;OAC5D,IACA;SACC,MAAMj4B,QAAQ,CAACS,aAAa,EAAE;QAC9B,CACD,OAAOy3B,CAAC,EACR;SACC,IAAIA,CAAC,CAACC,IAAI,KAAK,4BAA4B,EAC3C;WACC;;SAGD,IAAID,CAAC,CAACC,IAAI,KAAK,yBAAyB,EACxC;WACCC,aAAa,CAAC,IAAI,CAACJ,6BAA6B,CAAC;WACjDpvB,MAAM,CAACqI,QAAQ,CAAConB,MAAM,EAAE;;SAGzB,MAAMH,CAAC;;OAGRE,aAAa,CAAC,IAAI,CAACJ,6BAA6B,CAAC;OACjDpvB,MAAM,CAACqI,QAAQ,CAAConB,MAAM,EAAE;MACxB,EAAEN,YAAY,CAAC;;CAiBlB;CAAC,+BA9DA;GACC,MAAMO,YAAY,GAAI/3B,KAAgB,IAAK;KAC1C,MAAM,CAACg4B,cAAc,CAAC,GAAGh4B,KAAK,CAAC7D,IAAI;KACnC67B,cAAc,CAACC,UAAU,EAAE;IAC3B;GAED,MAAM3f,OAAO,GAAG,MAAM;KACrB/M,6BAAY,CAACkH,WAAW,CAAC5Y,MAAM,CAACU,yBAAyB,EAAEw9B,YAAY,CAAC;KACxExsB,6BAAY,CAACkH,WAAW,CAAC5Y,MAAM,CAACW,kBAAkB,EAAE8d,OAAO,CAAC;KAC5Duf,aAAa,CAAC,IAAI,CAACJ,6BAA6B,CAAC;IACjD;GACDlsB,6BAAY,CAACoH,SAAS,CAAC9Y,MAAM,CAACU,yBAAyB,EAAEw9B,YAAY,CAAC;GACtExsB,6BAAY,CAACoH,SAAS,CAAC9Y,MAAM,CAACW,kBAAkB,EAAE8d,OAAO,CAAC;CAC3D;CAAC,wCAoCD;GACC,OAAOwL,aAAG,CAACC,MAAM,oBAAC;;;;OAIf,CAAwF;;;OAGxF,CAA8F;;;GAGjG,GANK3lB,aAAG,CAACC,UAAU,CAAC,qEAAqE,CAAC,EAGrFD,aAAG,CAACC,UAAU,CAAC,2EAA2E,CAAC;CAIjG;CAAC,sBAlEW+4B,iBAAiB;GAAA;CAAA;CAAA,sBAAjBA,iBAAiB;GAAA;CAAA;;CCSI;AAElC,CAAO,MAAMc,GAAG,CAChB;GAiBC,aAAab,KAAK,CAACC,WAAmB,EACtC;KACC,MAAMC,SAAS,GAAGttB,QAAQ,CAACC,cAAc,CAACotB,WAAW,CAAC;KACtD,MAAMa,GAAG,GAAGC,iBAAS,CAACC,SAAS,CAACtG,KAAK,CAAC;KACtC,MAAM9wB,KAAK,GAAGq3B,yBAAW,EAAE;KAC3BH,GAAG,CAACI,GAAG,CAACt3B,KAAK,CAAC;KACd,wCAAAi3B,GAAG,8CAAoBC,GAAG;KAE1B,MAAMzF,MAAM,GAAGnpB,EAAE,CAACC,SAAS,CAACC,QAAQ,CAACkpB,YAAY,EAAE;KACnD,IAAID,MAAM,EACV;OACCA,MAAM,CAAClB,UAAU,EAAE;;KAEpB7pB,aAAG,CAAC0a,QAAQ,CAACkV,SAAS,EAAE,4BAA4B,CAAC;KAErD,MAAM96B,mEAAiB,CAAC+7B,IAAI,EAAE;KAC9B,IAAI9F,MAAM,EACV;OACCA,MAAM,CAACK,WAAW,EAAE;;KAErBprB,aAAG,CAAC4a,WAAW,CAACgV,SAAS,EAAE,4BAA4B,CAAC;KACxDY,GAAG,CAACd,KAAK,CAACE,SAAS,CAAC;;CAEtB;CAAC,+BAvC0BY,GAAW,EACrC;GACC,MAAMJ,YAAY,GAAI/3B,KAAgB,IAAK;KAC1C,MAAM,CAACg4B,cAAc,CAAC,GAAGh4B,KAAK,CAAC7D,IAAI;KACnC67B,cAAc,CAACC,UAAU,EAAE;IAC3B;GAED,MAAM3f,OAAO,GAAG,MAAM;KACrB/M,6BAAY,CAACkH,WAAW,CAAC5Y,MAAM,CAACU,yBAAyB,EAAEw9B,YAAY,CAAC;KACxExsB,6BAAY,CAACkH,WAAW,CAAC5Y,MAAM,CAACW,kBAAkB,EAAE8d,OAAO,CAAC;KAC5D6f,GAAG,CAACM,OAAO,EAAE;IACb;GACDltB,6BAAY,CAACoH,SAAS,CAAC9Y,MAAM,CAACU,yBAAyB,EAAEw9B,YAAY,CAAC;GACtExsB,6BAAY,CAACoH,SAAS,CAAC9Y,MAAM,CAACW,kBAAkB,EAAE8d,OAAO,CAAC;CAC3D;CAAC,sBAhBW4f,GAAG;GAAA;CAAA;;;;;;;;;;;;;;;"}