this.BX=this.BX||{};this.BX.Humanresources=this.BX.Humanresources||{};(function(e,t,s,i,r,a,o,l){"use strict";const n={getDepartmentName:e=>{const{departments:t}=o.useChartStore();const s=t.get(e);if(!s){return""}return s.name},moveUsersToDepartment:(e,t,s,i)=>{var r;const a=o.useChartStore();const l=a.departments.get(e);if(!l){return}const n=new Set(t.map((e=>e.id)));const d=((r=l.employees)!=null?r:[]).filter((e=>!n.has(e.id)));const c=new Set(l.heads.map((e=>e.id)));const h=t.filter((e=>!c.has(e.id)));d.push(...h);l.employees=d;l.userCount=s;if(i.length>0){void a.refreshDepartments(i)}},addUsersToDepartment:(e,t,s,i)=>{var r,a;const n=o.useChartStore();const d=n.departments.get(e);if(!d){return}const c=l.getMemberRoles(d.entityType);const h=new Set(t.map((e=>e.id)));if(h.has(n.userId)){n.changeCurrentDepartment(0,d.id)}const p=((r=d.heads)!=null?r:[]).filter((e=>!h.has(e.id)));const u=((a=d.employees)!=null?a:[]).filter((e=>!h.has(e.id)));(i===c.employee?u:p).push(...t);d.heads=p;d.employees=u;d.userCount=s}};const d={moveUsersToDepartment:(e,t)=>l.postData("humanresources.api.Structure.Node.Member.moveUserListToDepartment",{nodeId:e,userIds:t}),addUsersToDepartment:(e,t,s)=>l.postData("humanresources.api.Structure.Node.Member.addUserMember",{nodeId:e,userIds:t,roleXmlId:s})};const c=["add","move"];let h=e=>e,p;const u="ui-btn-disabled";var E=babelHelpers.classPrivateFieldLooseKey("handleOnTagAdd");var b=babelHelpers.classPrivateFieldLooseKey("handleOnTagRemove");var _=babelHelpers.classPrivateFieldLooseKey("onUserToggle");var m=babelHelpers.classPrivateFieldLooseKey("toggleAddButton");var v=babelHelpers.classPrivateFieldLooseKey("setConfirmButtonText");var T=babelHelpers.classPrivateFieldLooseKey("saveUsers");class y extends i.BaseFooter{constructor(e,t){var i,a,o;super(e,t);Object.defineProperty(this,T,{value:U});Object.defineProperty(this,v,{value:S});Object.defineProperty(this,m,{value:A});Object.defineProperty(this,_,{value:M});Object.defineProperty(this,b,{value:R});Object.defineProperty(this,E,{value:g});this.nodeId=this.getOption("nodeId");if(!s.Type.isInteger(this.nodeId)){throw new TypeError("Invalid argument 'nodeId'. An integer value was expected.")}this.entityType=(i=this.getOption("entityType"))!=null?i:r.EntityTypes.team;this.memberRoles=l.getMemberRoles(this.entityType);this.role=(a=this.getOption("role"))!=null?a:this.memberRoles.employee;const n=(o=this.getOption("type"))!=null?o:"";if(s.Type.isString(n)&&c.includes(n)){this.type=n}else{throw new TypeError(`Invalid argument 'type'. Expected one of: ${c.join(", ")}`)}babelHelpers.classPrivateFieldLooseBase(this,v)[v]();const d=this.getDialog().getSelectedItems();this.userCount=d.length;this.users=[];d.forEach((e=>{babelHelpers.classPrivateFieldLooseBase(this,_)[_](e)}));this.getDialog().subscribe("Item:onSelect",babelHelpers.classPrivateFieldLooseBase(this,E)[E].bind(this));this.getDialog().subscribe("Item:onDeselect",babelHelpers.classPrivateFieldLooseBase(this,b)[b].bind(this))}render(){var e;const{footer:t,footerAddButton:i,footerCloseButton:r}=s.Tag.render(p||(p=h`
			<div ref="footer" class="hr-user-management-dialog__footer">
				<button ref="footerAddButton" class="ui-btn ui-btn ui-btn-sm ui-btn-primary ${0} ui-btn-round hr-user-management-dialog__footer-btn-width">
					${0}
				</button>
				<button ref="footerCloseButton" class="ui-btn ui-btn ui-btn-sm ui-btn-light-border ui-btn-round hr-user-management-dialog__footer-btn-width">
					${0}
				</button>
			</div>
		`),this.users.length===0?u:"",(e=this.confirmButtonText)!=null?e:"",s.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_CANCEL_BUTTON"));this.footerAddButton=i;s.Event.bind(r,"click",(e=>{this.dialog.hide()}));s.Event.bind(i,"click",(e=>{const t=this.dialog.getSelectedItems();const r=t.map((e=>e.getId()));if(r.length>0){s.Dom.addClass(i,"ui-btn-wait");this.action(r)}}));return t}destroyDialog(){this.isInProcess=false;this.getDialog().destroy()}async action(e){if(!this.userCount||this.isInProcess){return}this.isInProcess=true;const t=this.type==="move"?{[this.memberRoles.employee]:e}:e;const s=await babelHelpers.classPrivateFieldLooseBase(this,T)[T](t).catch((()=>{}));if(!s){this.destroyDialog();return}if(this.type==="add"){var i,r;n.addUsersToDepartment(this.nodeId,this.users,(i=s.userCount)!=null?i:0,(r=this.role)!=null?r:this.memberRoles.employee)}if(this.type==="move"){var a,o;n.moveUsersToDepartment(this.nodeId,this.users,(a=s.userCount)!=null?a:0,(o=s.updatedDepartmentIds)!=null?o:[])}const l=this.getNotificationMessageCode();if(l){this.showNotification(l)}this.destroyDialog()}showNotification(e){const t=n.getDepartmentName(this.nodeId);a.UI.Notification.Center.notify({content:s.Text.encode(s.Loc.getMessage(e,{"#DEPARTMENT#":t})),autoHideDelay:2e3})}getNotificationMessageCode(){if(this.type==="add"){if(this.users.length>1){if(this.entityType===r.EntityTypes.team){this.showNotification("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ADD_TEAM_USER_ADD_EMPLOYEES_MESSAGE")}else{this.showNotification("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ADD_USER_ADD_EMPLOYEES_MESSAGE")}}if(this.users.length===1){if(this.entityType===r.EntityTypes.team){this.showNotification("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ADD_TEAM_USER_ADD_EMPLOYEE_MESSAGE")}else{this.showNotification("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ADD_USER_ADD_EMPLOYEE_MESSAGE")}}}if(this.type==="move"){if(this.users.length>1){this.showNotification("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_MOVE_USER_FROM_MOVE_EMPLOYEES_MESSAGE")}if(this.users.length===1){this.showNotification("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_MOVE_USER_FROM_MOVE_EMPLOYEE_MESSAGE")}}return null}}function g(e){const{item:t}=e.getData();babelHelpers.classPrivateFieldLooseBase(this,_)[_](t)}function R(e){const{item:t}=e.getData();babelHelpers.classPrivateFieldLooseBase(this,_)[_](t,false)}function M(e,t=true){if(!t){this.users=this.users.filter((t=>t.id!==e.id));this.userCount-=1;babelHelpers.classPrivateFieldLooseBase(this,m)[m]();return}const s=r.getUserDataBySelectorItem(e,this.role);this.users=[...this.users,s];this.userCount+=1;babelHelpers.classPrivateFieldLooseBase(this,m)[m]()}function A(){if(this.userCount===0){s.Dom.addClass(this.footerAddButton,u);return}s.Dom.removeClass(this.footerAddButton,u)}function S(){if(this.type==="move"){this.confirmButtonText=s.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_MOVE_USER_FROM_CONFIRM_BUTTON");return}if(this.type==="add"){this.confirmButtonText=s.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ADD_USER_CONFIRM_BUTTON");return}this.confirmButtonText=""}function U(e){if(this.type==="move"){return d.moveUsersToDepartment(this.nodeId,e)}return d.addUsersToDepartment(this.nodeId,e,this.role)}let L=e=>e,P,O,f,H,N;var D=babelHelpers.classPrivateFieldLooseKey("addRoleSwitcher");var C=babelHelpers.classPrivateFieldLooseKey("toggleRoleSwitcherMenu");var B=babelHelpers.classPrivateFieldLooseKey("changeRole");var F=babelHelpers.classPrivateFieldLooseKey("getHeadRoleText");var I=babelHelpers.classPrivateFieldLooseKey("getDeputyRoleText");class w extends i.BaseHeader{constructor(e,t){var i,a,o,n,d;super(e,t);Object.defineProperty(this,I,{value:x});Object.defineProperty(this,F,{value:K});Object.defineProperty(this,B,{value:j});Object.defineProperty(this,C,{value:Y});Object.defineProperty(this,D,{value:G});this.tiltle=s.Text.encode((i=this.getOption("title"))!=null?i:"");this.description=s.Text.encode((a=this.getOption("description"))!=null?a:"");this.memberRoles=(o=this.getOption("memberRoles"))!=null?o:l.memberRoles;this.role=(n=this.getOption("role"))!=null?n:this.memberRoles.employee;this.entityType=(d=this.getOption("entityType"))!=null?d:r.EntityTypes.department}render(){const{header:e,headerCloseButton:t}=s.Tag.render(P||(P=L`
			<div ref="header" class="hr-user-management-dialog__header">
				<div ref="headerCloseButton" class="hr-user-management-dialog__header-close_button"></div>
				<span class="hr-user-management-dialog__header-title">
					${0}
				</span>
			</div>
		`),this.tiltle);s.Event.bind(t,"click",(()=>{this.getDialog().hide()}));this.header=e;if(this.role===this.memberRoles.employee){const e=s.Tag.render(O||(O=L`
				<span class="hr-user-management-dialog__header-description">
					${0}
				</span>
			`),this.description);s.Dom.append(e,this.header)}else{babelHelpers.classPrivateFieldLooseBase(this,D)[D]()}return e}}function G(){const{roleSwitcherContainer:e,roleSwitcher:t}=s.Tag.render(f||(f=L`
			<div ref="roleSwitcherContainer" class="hr-user-management-dialog__role_switcher-container">
				<span class="hr-user-management-dialog__role_switcher_title">
					${0}
					</span>
				<div ref="roleSwitcher" class="hr-user-management-dialog__role_switcher">
					${0}
				</div>
			</div>
		`),s.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ROLE_PICKER_TEXT"),babelHelpers.classPrivateFieldLooseBase(this,F)[F]());s.Dom.append(e,this.header);this.roleSwitcher=t;s.Event.bind(this.roleSwitcher,"click",(()=>{babelHelpers.classPrivateFieldLooseBase(this,C)[C]()}))}function Y(){const e=`${this.getDialog().id}-role-switcher`;const i=t.PopupManager.getPopupById(e);if(i){i.destroy();return}const r=new t.Menu({id:e,bindElement:this.roleSwitcher,autoHide:true,closeByEsc:true,maxWidth:263,events:{onPopupDestroy:()=>{s.Dom.removeClass(this.roleSwitcher,"--focused")}}});const a=[{html:s.Tag.render(H||(H=L`
					<div 
						data-test-id="hr-company-structure_user-management-dialog__role-switcher-head"
					>
						${0}
					</div>
				`),babelHelpers.classPrivateFieldLooseBase(this,F)[F]()),onclick:()=>{this.roleSwitcher.innerText=babelHelpers.classPrivateFieldLooseBase(this,F)[F]();babelHelpers.classPrivateFieldLooseBase(this,B)[B](this.memberRoles.head);r.destroy()}},{html:s.Tag.render(N||(N=L`
					<div 
						data-test-id="hr-company-structure_user-management-dialog__role-switcher-deputy"
					>
						${0}
					</div>
				`),babelHelpers.classPrivateFieldLooseBase(this,I)[I]()),onclick:()=>{this.roleSwitcher.innerText=babelHelpers.classPrivateFieldLooseBase(this,I)[I]();babelHelpers.classPrivateFieldLooseBase(this,B)[B](this.memberRoles.deputyHead);r.destroy()}}];a.forEach((e=>r.addMenuItem(e)));if(r.isShown){r.destroy();return}r.show();s.Dom.addClass(this.roleSwitcher,"--focused")}function j(e){const t=this.getDialog().getFooter().getOptions();t.role=e;this.getDialog().setFooter(y,t)}function K(){return this.entityType===r.EntityTypes.team?s.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_TEAM_HEAD_ROLE_TITLE"):s.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_HEAD_ROLE_TITLE")}function x(){return this.entityType===r.EntityTypes.team?s.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_TEAM_DEPUTY_ROLE_TITLE"):s.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_DEPUTY_ROLE_TITLE")}const X="hr-user-management-dialog";var $=babelHelpers.classPrivateFieldLooseKey("dialog");var V=babelHelpers.classPrivateFieldLooseKey("nodeId");var k=babelHelpers.classPrivateFieldLooseKey("type");var W=babelHelpers.classPrivateFieldLooseKey("role");var q=babelHelpers.classPrivateFieldLooseKey("entityType");var z=babelHelpers.classPrivateFieldLooseKey("memberRoles");var J=babelHelpers.classPrivateFieldLooseKey("createDialog");var Q=babelHelpers.classPrivateFieldLooseKey("getTitleByTypeAndRoleAndEntity");var Z=babelHelpers.classPrivateFieldLooseKey("getDescriptionByTypeRoleAndEntity");class ee{constructor(e){Object.defineProperty(this,Z,{value:ie});Object.defineProperty(this,Q,{value:se});Object.defineProperty(this,J,{value:te});Object.defineProperty(this,$,{writable:true,value:void 0});Object.defineProperty(this,V,{writable:true,value:void 0});Object.defineProperty(this,k,{writable:true,value:void 0});Object.defineProperty(this,W,{writable:true,value:void 0});Object.defineProperty(this,q,{writable:true,value:void 0});Object.defineProperty(this,z,{writable:true,value:void 0});if(s.Type.isInteger(e.nodeId)){babelHelpers.classPrivateFieldLooseBase(this,V)[V]=e.nodeId}else{throw new TypeError("Invalid argument 'nodeId'. An integer value was expected.")}if(s.Type.isString(e.type)&&c.includes(e.type)){babelHelpers.classPrivateFieldLooseBase(this,k)[k]=e.type}else{throw new TypeError(`Invalid argument 'type'. Expected one of: ${c.join(", ")}`)}if(s.Type.isString(e.entityType)&&Object.values(r.EntityTypes).includes(e.entityType)){babelHelpers.classPrivateFieldLooseBase(this,q)[q]=e.entityType;if(babelHelpers.classPrivateFieldLooseBase(this,q)[q]===r.EntityTypes.team){babelHelpers.classPrivateFieldLooseBase(this,k)[k]="add"}}else{babelHelpers.classPrivateFieldLooseBase(this,q)[q]=r.EntityTypes.department}babelHelpers.classPrivateFieldLooseBase(this,z)[z]=l.getMemberRoles(babelHelpers.classPrivateFieldLooseBase(this,q)[q]);if(Object.values(babelHelpers.classPrivateFieldLooseBase(this,z)[z]).includes(e.role)){babelHelpers.classPrivateFieldLooseBase(this,W)[W]=e.role}else{babelHelpers.classPrivateFieldLooseBase(this,W)[W]=babelHelpers.classPrivateFieldLooseBase(this,z)[z].employee}this.id=`${X}-${babelHelpers.classPrivateFieldLooseBase(this,k)[k]}`;this.title=babelHelpers.classPrivateFieldLooseBase(this,Q)[Q](babelHelpers.classPrivateFieldLooseBase(this,k)[k],babelHelpers.classPrivateFieldLooseBase(this,W)[W],babelHelpers.classPrivateFieldLooseBase(this,q)[q]);this.description=babelHelpers.classPrivateFieldLooseBase(this,Z)[Z](babelHelpers.classPrivateFieldLooseBase(this,k)[k],babelHelpers.classPrivateFieldLooseBase(this,W)[W],babelHelpers.classPrivateFieldLooseBase(this,q)[q]);babelHelpers.classPrivateFieldLooseBase(this,J)[J]()}static openDialog(e){const t=new ee(e);t.show()}show(){babelHelpers.classPrivateFieldLooseBase(this,$)[$].show()}}function te(){babelHelpers.classPrivateFieldLooseBase(this,$)[$]=new i.Dialog({id:this.id,width:400,height:511,multiple:true,cacheable:false,dropdownMode:true,compactView:false,enableSearch:true,showAvatars:true,autoHide:false,header:w,headerOptions:{title:this.title,role:babelHelpers.classPrivateFieldLooseBase(this,W)[W],description:this.description,memberRoles:babelHelpers.classPrivateFieldLooseBase(this,z)[z],entityType:babelHelpers.classPrivateFieldLooseBase(this,q)[q]},footer:y,footerOptions:{nodeId:babelHelpers.classPrivateFieldLooseBase(this,V)[V],role:babelHelpers.classPrivateFieldLooseBase(this,W)[W],type:babelHelpers.classPrivateFieldLooseBase(this,k)[k],entityType:babelHelpers.classPrivateFieldLooseBase(this,q)[q]},popupOptions:{overlay:{opacity:40}},entities:[{id:"user",options:{intranetUsersOnly:true,inviteEmployeeLink:false}}]})}function se(e,t,i){if(e==="add"&&t===babelHelpers.classPrivateFieldLooseBase(this,z)[z].employee&&i===r.EntityTypes.team){return s.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ADD_TEAM_EMPLOYEE_TITLE")}if(e==="move"&&t===babelHelpers.classPrivateFieldLooseBase(this,z)[z].employee){return s.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_MOVE_USER_FROM_TITLE")}if(e==="add"&&t===babelHelpers.classPrivateFieldLooseBase(this,z)[z].employee){return s.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ADD_EMPLOYEE_TITLE")}if(e==="add"&&t===babelHelpers.classPrivateFieldLooseBase(this,z)[z].head&&i===r.EntityTypes.team){return s.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ADD_TEAM_HEAD_TITLE")}if(e==="add"&&t===babelHelpers.classPrivateFieldLooseBase(this,z)[z].head){return s.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ADD_HEAD_TITLE")}return""}function ie(e,t,i){if(e==="add"&&i===r.EntityTypes.team){return s.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ADD_TEAM_EMPLOYEE_DESCRIPTION")}if(e==="move"&&t===babelHelpers.classPrivateFieldLooseBase(this,z)[z].employee){return s.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_MOVE_USER_FROM_DESCRIPTION")}if(e==="add"&&t===babelHelpers.classPrivateFieldLooseBase(this,z)[z].employee){return s.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ADD_EMPLOYEE_DESCRIPTION")}return""}e.UserManagementDialog=ee;e.UserManagementDialogAPI=d})(this.BX.Humanresources.CompanyStructure=this.BX.Humanresources.CompanyStructure||{},BX.Main,BX,BX.UI.EntitySelector,BX.Humanresources.CompanyStructure,BX,BX.Humanresources.CompanyStructure,BX.Humanresources.CompanyStructure);
//# sourceMappingURL=user-management-dialog.bundle.map.js