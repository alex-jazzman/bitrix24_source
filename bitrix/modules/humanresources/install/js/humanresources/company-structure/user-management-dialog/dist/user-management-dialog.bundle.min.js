this.BX=this.BX||{};this.BX.Humanresources=this.BX.Humanresources||{};(function(e,s,t,i,a,r,o,l){"use strict";const n={getDepartmentName:e=>{const{departments:s}=o.useChartStore();const t=s.get(e);if(!t){return""}return t.name}};const d={moveUsersToDepartment:(e,s)=>l.postData("humanresources.api.Structure.Node.Member.moveUserListToDepartment",{nodeId:e,userIds:s}),addUsersToDepartment:(e,s,t)=>l.postData("humanresources.api.Structure.Node.Member.addUserMember",{nodeId:e,userIds:s,roleXmlId:t})};const c=["add","move"];let h=e=>e,E;const p="ui-btn-disabled";var u=babelHelpers.classPrivateFieldLooseKey("handleOnTagAdd");var b=babelHelpers.classPrivateFieldLooseKey("handleOnTagRemove");var _=babelHelpers.classPrivateFieldLooseKey("onUserToggle");var v=babelHelpers.classPrivateFieldLooseKey("toggleAddButton");var T=babelHelpers.classPrivateFieldLooseKey("setConfirmButtonText");var y=babelHelpers.classPrivateFieldLooseKey("saveUsers");class m extends i.BaseFooter{constructor(e,s){var i,r,o;super(e,s);Object.defineProperty(this,y,{value:U});Object.defineProperty(this,T,{value:S});Object.defineProperty(this,v,{value:g});Object.defineProperty(this,_,{value:M});Object.defineProperty(this,b,{value:A});Object.defineProperty(this,u,{value:R});this.nodeId=this.getOption("nodeId");if(!t.Type.isInteger(this.nodeId)){throw new TypeError("Invalid argument 'nodeId'. An integer value was expected.")}this.entityType=(i=this.getOption("entityType"))!=null?i:a.EntityTypes.team;this.memberRoles=l.getMemberRoles(this.entityType);this.role=(r=this.getOption("role"))!=null?r:this.memberRoles.employee;const n=(o=this.getOption("type"))!=null?o:"";if(t.Type.isString(n)&&c.includes(n)){this.type=n}else{throw new TypeError(`Invalid argument 'type'. Expected one of: ${c.join(", ")}`)}babelHelpers.classPrivateFieldLooseBase(this,T)[T]();const d=this.getDialog().getSelectedItems();this.userCount=d.length;this.users=[];d.forEach((e=>{babelHelpers.classPrivateFieldLooseBase(this,_)[_](e)}));this.getDialog().subscribe("Item:onSelect",babelHelpers.classPrivateFieldLooseBase(this,u)[u].bind(this));this.getDialog().subscribe("Item:onDeselect",babelHelpers.classPrivateFieldLooseBase(this,b)[b].bind(this))}render(){var e;const{footer:s,footerAddButton:i,footerCloseButton:a}=t.Tag.render(E||(E=h`
			<div ref="footer" class="hr-user-management-dialog__footer">
				<button ref="footerAddButton" class="ui-btn ui-btn ui-btn-sm ui-btn-primary ${0} ui-btn-round hr-user-management-dialog__footer-btn-width">
					${0}
				</button>
				<button ref="footerCloseButton" class="ui-btn ui-btn ui-btn-sm ui-btn-light-border ui-btn-round hr-user-management-dialog__footer-btn-width">
					${0}
				</button>
			</div>
		`),this.users.length===0?p:"",(e=this.confirmButtonText)!=null?e:"",t.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_CANCEL_BUTTON"));this.footerAddButton=i;t.Event.bind(a,"click",(e=>{this.dialog.hide()}));t.Event.bind(i,"click",(e=>{const s=this.dialog.getSelectedItems();const a=s.map((e=>e.getId()));if(a.length>0){t.Dom.addClass(i,"ui-btn-wait");this.action(a)}}));return s}destroyDialog(){this.isInProcess=false;this.getDialog().destroy()}async action(e){if(!this.userCount||this.isInProcess){return}this.isInProcess=true;const s=this.type==="move"?{[this.memberRoles.employee]:e}:e;const t=await babelHelpers.classPrivateFieldLooseBase(this,y)[y](s).catch((()=>{}));if(!t){this.destroyDialog();return}if(this.type==="add"){var i,a;o.UserService.addUsersToEntity(this.nodeId,this.users,(i=t.userCount)!=null?i:0,(a=this.role)!=null?a:this.memberRoles.employee)}if(this.type==="move"){var r,l;o.UserService.moveUsersToEntity(this.nodeId,this.users,(r=t.userCount)!=null?r:0,(l=t.updatedDepartmentIds)!=null?l:[])}const n=this.getNotificationMessageCode();if(n){this.showNotification(n)}this.destroyDialog()}showNotification(e){const s=n.getDepartmentName(this.nodeId);r.UI.Notification.Center.notify({content:t.Text.encode(t.Loc.getMessage(e,{"#DEPARTMENT#":s})),autoHideDelay:2e3})}getNotificationMessageCode(){if(this.type==="add"){if(this.users.length>1){if(this.entityType===a.EntityTypes.team){this.showNotification("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ADD_TEAM_USER_ADD_EMPLOYEES_MESSAGE")}else{this.showNotification("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ADD_USER_ADD_EMPLOYEES_MESSAGE")}}if(this.users.length===1){if(this.entityType===a.EntityTypes.team){this.showNotification("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ADD_TEAM_USER_ADD_EMPLOYEE_MESSAGE")}else{this.showNotification("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ADD_USER_ADD_EMPLOYEE_MESSAGE")}}}if(this.type==="move"){if(this.users.length>1){this.showNotification("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_MOVE_USER_FROM_MOVE_EMPLOYEES_MESSAGE")}if(this.users.length===1){this.showNotification("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_MOVE_USER_FROM_MOVE_EMPLOYEE_MESSAGE")}}return null}}function R(e){const{item:s}=e.getData();babelHelpers.classPrivateFieldLooseBase(this,_)[_](s)}function A(e){const{item:s}=e.getData();babelHelpers.classPrivateFieldLooseBase(this,_)[_](s,false)}function M(e,s=true){if(!s){this.users=this.users.filter((s=>s.id!==e.id));this.userCount-=1;babelHelpers.classPrivateFieldLooseBase(this,v)[v]();return}const t=a.getUserDataBySelectorItem(e,this.role);this.users=[...this.users,t];this.userCount+=1;babelHelpers.classPrivateFieldLooseBase(this,v)[v]()}function g(){if(this.userCount===0){t.Dom.addClass(this.footerAddButton,p);return}t.Dom.removeClass(this.footerAddButton,p)}function S(){if(this.type==="move"){this.confirmButtonText=t.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_MOVE_USER_FROM_CONFIRM_BUTTON");return}if(this.type==="add"){this.confirmButtonText=t.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ADD_USER_CONFIRM_BUTTON");return}this.confirmButtonText=""}function U(e){if(this.type==="move"){return d.moveUsersToDepartment(this.nodeId,e)}return d.addUsersToDepartment(this.nodeId,e,this.role)}let L=e=>e,P,O,f,H,N;var D=babelHelpers.classPrivateFieldLooseKey("addRoleSwitcher");var C=babelHelpers.classPrivateFieldLooseKey("toggleRoleSwitcherMenu");var B=babelHelpers.classPrivateFieldLooseKey("changeRole");var F=babelHelpers.classPrivateFieldLooseKey("getHeadRoleText");var I=babelHelpers.classPrivateFieldLooseKey("getDeputyRoleText");class w extends i.BaseHeader{constructor(e,s){var i,r,o,n,d;super(e,s);Object.defineProperty(this,I,{value:x});Object.defineProperty(this,F,{value:K});Object.defineProperty(this,B,{value:j});Object.defineProperty(this,C,{value:Y});Object.defineProperty(this,D,{value:G});this.tiltle=t.Text.encode((i=this.getOption("title"))!=null?i:"");this.description=t.Text.encode((r=this.getOption("description"))!=null?r:"");this.memberRoles=(o=this.getOption("memberRoles"))!=null?o:l.memberRoles;this.role=(n=this.getOption("role"))!=null?n:this.memberRoles.employee;this.entityType=(d=this.getOption("entityType"))!=null?d:a.EntityTypes.department}render(){const{header:e,headerCloseButton:s}=t.Tag.render(P||(P=L`
			<div ref="header" class="hr-user-management-dialog__header">
				<div ref="headerCloseButton" class="hr-user-management-dialog__header-close_button"></div>
				<span class="hr-user-management-dialog__header-title">
					${0}
				</span>
			</div>
		`),this.tiltle);t.Event.bind(s,"click",(()=>{this.getDialog().hide()}));this.header=e;if(this.role===this.memberRoles.employee){const e=t.Tag.render(O||(O=L`
				<span class="hr-user-management-dialog__header-description">
					${0}
				</span>
			`),this.description);t.Dom.append(e,this.header)}else{babelHelpers.classPrivateFieldLooseBase(this,D)[D]()}return e}}function G(){const{roleSwitcherContainer:e,roleSwitcher:s}=t.Tag.render(f||(f=L`
			<div ref="roleSwitcherContainer" class="hr-user-management-dialog__role_switcher-container">
				<span class="hr-user-management-dialog__role_switcher_title">
					${0}
					</span>
				<div ref="roleSwitcher" class="hr-user-management-dialog__role_switcher">
					${0}
				</div>
			</div>
		`),t.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ROLE_PICKER_TEXT"),babelHelpers.classPrivateFieldLooseBase(this,F)[F]());t.Dom.append(e,this.header);this.roleSwitcher=s;t.Event.bind(this.roleSwitcher,"click",(()=>{babelHelpers.classPrivateFieldLooseBase(this,C)[C]()}))}function Y(){const e=`${this.getDialog().id}-role-switcher`;const i=s.PopupManager.getPopupById(e);if(i){i.destroy();return}const a=new s.Menu({id:e,bindElement:this.roleSwitcher,autoHide:true,closeByEsc:true,maxWidth:263,events:{onPopupDestroy:()=>{t.Dom.removeClass(this.roleSwitcher,"--focused")}}});const r=[{html:t.Tag.render(H||(H=L`
					<div 
						data-test-id="hr-company-structure_user-management-dialog__role-switcher-head"
					>
						${0}
					</div>
				`),babelHelpers.classPrivateFieldLooseBase(this,F)[F]()),onclick:()=>{this.roleSwitcher.innerText=babelHelpers.classPrivateFieldLooseBase(this,F)[F]();babelHelpers.classPrivateFieldLooseBase(this,B)[B](this.memberRoles.head);a.destroy()}},{html:t.Tag.render(N||(N=L`
					<div 
						data-test-id="hr-company-structure_user-management-dialog__role-switcher-deputy"
					>
						${0}
					</div>
				`),babelHelpers.classPrivateFieldLooseBase(this,I)[I]()),onclick:()=>{this.roleSwitcher.innerText=babelHelpers.classPrivateFieldLooseBase(this,I)[I]();babelHelpers.classPrivateFieldLooseBase(this,B)[B](this.memberRoles.deputyHead);a.destroy()}}];r.forEach((e=>a.addMenuItem(e)));if(a.isShown){a.destroy();return}a.show();t.Dom.addClass(this.roleSwitcher,"--focused")}function j(e){const s=this.getDialog().getFooter().getOptions();s.role=e;this.getDialog().setFooter(m,s)}function K(){return this.entityType===a.EntityTypes.team?t.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_TEAM_HEAD_ROLE_TITLE"):t.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_HEAD_ROLE_TITLE")}function x(){return this.entityType===a.EntityTypes.team?t.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_TEAM_DEPUTY_ROLE_TITLE"):t.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_DEPUTY_ROLE_TITLE")}const X="hr-user-management-dialog";var $=babelHelpers.classPrivateFieldLooseKey("dialog");var V=babelHelpers.classPrivateFieldLooseKey("nodeId");var k=babelHelpers.classPrivateFieldLooseKey("type");var W=babelHelpers.classPrivateFieldLooseKey("role");var q=babelHelpers.classPrivateFieldLooseKey("entityType");var z=babelHelpers.classPrivateFieldLooseKey("memberRoles");var J=babelHelpers.classPrivateFieldLooseKey("createDialog");var Q=babelHelpers.classPrivateFieldLooseKey("getTitleByTypeAndRoleAndEntity");var Z=babelHelpers.classPrivateFieldLooseKey("getDescriptionByTypeRoleAndEntity");class ee{constructor(e){Object.defineProperty(this,Z,{value:ie});Object.defineProperty(this,Q,{value:te});Object.defineProperty(this,J,{value:se});Object.defineProperty(this,$,{writable:true,value:void 0});Object.defineProperty(this,V,{writable:true,value:void 0});Object.defineProperty(this,k,{writable:true,value:void 0});Object.defineProperty(this,W,{writable:true,value:void 0});Object.defineProperty(this,q,{writable:true,value:void 0});Object.defineProperty(this,z,{writable:true,value:void 0});if(t.Type.isInteger(e.nodeId)){babelHelpers.classPrivateFieldLooseBase(this,V)[V]=e.nodeId}else{throw new TypeError("Invalid argument 'nodeId'. An integer value was expected.")}if(t.Type.isString(e.type)&&c.includes(e.type)){babelHelpers.classPrivateFieldLooseBase(this,k)[k]=e.type}else{throw new TypeError(`Invalid argument 'type'. Expected one of: ${c.join(", ")}`)}if(t.Type.isString(e.entityType)&&Object.values(a.EntityTypes).includes(e.entityType)){babelHelpers.classPrivateFieldLooseBase(this,q)[q]=e.entityType;if(babelHelpers.classPrivateFieldLooseBase(this,q)[q]===a.EntityTypes.team){babelHelpers.classPrivateFieldLooseBase(this,k)[k]="add"}}else{babelHelpers.classPrivateFieldLooseBase(this,q)[q]=a.EntityTypes.department}babelHelpers.classPrivateFieldLooseBase(this,z)[z]=l.getMemberRoles(babelHelpers.classPrivateFieldLooseBase(this,q)[q]);if(Object.values(babelHelpers.classPrivateFieldLooseBase(this,z)[z]).includes(e.role)){babelHelpers.classPrivateFieldLooseBase(this,W)[W]=e.role}else{babelHelpers.classPrivateFieldLooseBase(this,W)[W]=babelHelpers.classPrivateFieldLooseBase(this,z)[z].employee}this.id=`${X}-${babelHelpers.classPrivateFieldLooseBase(this,k)[k]}`;this.title=babelHelpers.classPrivateFieldLooseBase(this,Q)[Q](babelHelpers.classPrivateFieldLooseBase(this,k)[k],babelHelpers.classPrivateFieldLooseBase(this,W)[W],babelHelpers.classPrivateFieldLooseBase(this,q)[q]);this.description=babelHelpers.classPrivateFieldLooseBase(this,Z)[Z](babelHelpers.classPrivateFieldLooseBase(this,k)[k],babelHelpers.classPrivateFieldLooseBase(this,W)[W],babelHelpers.classPrivateFieldLooseBase(this,q)[q]);babelHelpers.classPrivateFieldLooseBase(this,J)[J]()}static openDialog(e){const s=new ee(e);s.show()}show(){babelHelpers.classPrivateFieldLooseBase(this,$)[$].show()}}function se(){babelHelpers.classPrivateFieldLooseBase(this,$)[$]=new i.Dialog({id:this.id,width:400,height:511,multiple:true,cacheable:false,dropdownMode:true,compactView:false,enableSearch:true,showAvatars:true,autoHide:false,header:w,headerOptions:{title:this.title,role:babelHelpers.classPrivateFieldLooseBase(this,W)[W],description:this.description,memberRoles:babelHelpers.classPrivateFieldLooseBase(this,z)[z],entityType:babelHelpers.classPrivateFieldLooseBase(this,q)[q]},footer:m,footerOptions:{nodeId:babelHelpers.classPrivateFieldLooseBase(this,V)[V],role:babelHelpers.classPrivateFieldLooseBase(this,W)[W],type:babelHelpers.classPrivateFieldLooseBase(this,k)[k],entityType:babelHelpers.classPrivateFieldLooseBase(this,q)[q]},popupOptions:{overlay:{opacity:40}},entities:[{id:"user",options:{intranetUsersOnly:true,inviteEmployeeLink:false}}]})}function te(e,s,i){if(e==="add"&&s===babelHelpers.classPrivateFieldLooseBase(this,z)[z].employee&&i===a.EntityTypes.team){return t.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ADD_TEAM_EMPLOYEE_TITLE")}if(e==="move"&&s===babelHelpers.classPrivateFieldLooseBase(this,z)[z].employee){return t.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_MOVE_USER_FROM_TITLE")}if(e==="add"&&s===babelHelpers.classPrivateFieldLooseBase(this,z)[z].employee){return t.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ADD_EMPLOYEE_TITLE")}if(e==="add"&&s===babelHelpers.classPrivateFieldLooseBase(this,z)[z].head&&i===a.EntityTypes.team){return t.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ADD_TEAM_HEAD_TITLE")}if(e==="add"&&s===babelHelpers.classPrivateFieldLooseBase(this,z)[z].head){return t.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ADD_HEAD_TITLE")}return""}function ie(e,s,i){if(e==="add"&&i===a.EntityTypes.team){return t.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ADD_TEAM_EMPLOYEE_DESCRIPTION")}if(e==="move"&&s===babelHelpers.classPrivateFieldLooseBase(this,z)[z].employee){return t.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_MOVE_USER_FROM_DESCRIPTION")}if(e==="add"&&s===babelHelpers.classPrivateFieldLooseBase(this,z)[z].employee){return t.Loc.getMessage("HUMANRESOURCES_COMPANY_STRUCTURE_USER_MANAGEMENT_DIALOG_ADD_EMPLOYEE_DESCRIPTION")}return""}e.UserManagementDialog=ee;e.UserManagementDialogAPI=d})(this.BX.Humanresources.CompanyStructure=this.BX.Humanresources.CompanyStructure||{},BX.Main,BX,BX.UI.EntitySelector,BX.Humanresources.CompanyStructure,BX,BX.Humanresources.CompanyStructure,BX.Humanresources.CompanyStructure);
//# sourceMappingURL=user-management-dialog.bundle.map.js