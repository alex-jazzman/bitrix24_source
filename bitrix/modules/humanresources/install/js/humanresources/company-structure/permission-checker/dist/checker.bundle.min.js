this.BX=this.BX||{};this.BX.Humanresources=this.BX.Humanresources||{};(function(e,t,r,s){"use strict";const i=e=>{const t=new Map;e.forEach((e=>{var r,i,n;const{id:a,parentId:o,colorName:u,entityType:l}=e;const c=(r=t.get(a))!=null?r:{};const m=s.getNodeColorSettings(u,l);t.set(a,{...c,...e,teamColor:m});if(o===0){return}const d=(i=t.get(o))!=null?i:{};const f=(n=d.children)!=null?n:[];t.set(o,{...d,children:[...f,a]})}));return t};const n={removeDepartment:e=>t.getData("humanresources.api.Structure.Node.delete",{nodeId:e}),getDepartmentsData:()=>t.getData("humanresources.api.Structure.get",{},{tool:"structure",category:"structure",event:"open_structure"}),getCurrentDepartments:()=>t.getData("humanresources.api.Structure.Node.current"),getDictionary:()=>t.getData("humanresources.api.Structure.dictionary"),getUserId:()=>t.getData("humanresources.api.User.getCurrentId"),firstTimeOpened:()=>t.postData("humanresources.api.User.firstTimeOpen"),createTreeDataStore:i};const a=Object.freeze({structureView:"ACTION_STRUCTURE_VIEW",departmentCreate:"ACTION_DEPARTMENT_CREATE",departmentDelete:"ACTION_DEPARTMENT_DELETE",departmentEdit:"ACTION_DEPARTMENT_EDIT",employeeAddToDepartment:"ACTION_EMPLOYEE_ADD_TO_DEPARTMENT",employeeRemoveFromDepartment:"ACTION_EMPLOYEE_REMOVE_FROM_DEPARTMENT",employeeFire:"ACTION_FIRE_EMPLOYEE",accessEdit:"ACTION_USERS_ACCESS_EDIT",teamAccessEdit:"ACTION_TEAM_ACCESS_EDIT",inviteToDepartment:"ACTION_USER_INVITE",teamView:"ACTION_TEAM_VIEW",teamCreate:"ACTION_TEAM_CREATE",teamEdit:"ACTION_TEAM_EDIT",teamDelete:"ACTION_TEAM_DELETE",teamAddMember:"ACTION_TEAM_MEMBER_ADD",teamRemoveMember:"ACTION_TEAM_MEMBER_REMOVE",teamSettingsEdit:"ACTION_TEAM_SETTINGS_EDIT"});const o=Object.freeze({fullCompany:30,selfAndSub:20,self:10,none:0});var u=babelHelpers.classPrivateFieldLooseKey("isTeamAction");var l=babelHelpers.classPrivateFieldLooseKey("hasPermissionOfTeamAction");var c=babelHelpers.classPrivateFieldLooseKey("hasPermissionOfDepartmentAction");var m=babelHelpers.classPrivateFieldLooseKey("hasPermissionOfTeamActionByTeamPermission");var d=babelHelpers.classPrivateFieldLooseKey("hasPermissionOfTeamActionByDepartmentPermission");class f{constructor(){Object.defineProperty(this,d,{value:A});Object.defineProperty(this,m,{value:h});Object.defineProperty(this,c,{value:T});Object.defineProperty(this,l,{value:p});Object.defineProperty(this,u,{value:E});if(!f.instance){this.currentUserPermissions={};this.permissionVariablesDictionary=[];this.isTeamsAvailable=false;this.isInitialized=false;f.instance=this}return f.instance}getInstance(){return f.instance}async init(){if(this.isInitialized){return}const{currentUserPermissions:e,permissionVariablesDictionary:t,teamsAvailable:r}=await n.getDictionary();this.currentUserPermissions=e;this.permissionVariablesDictionary=t;this.isTeamsAvailable=r;this.isInitialized=true}hasPermission(e,t,r=o.none){const s=this.currentUserPermissions[e];if(!s||t===0){return false}if(babelHelpers.classPrivateFieldLooseBase(this,u)[u](e)){if(!this.isTeamsAvailable){return false}return babelHelpers.classPrivateFieldLooseBase(this,l)[l](s,t,e)}return babelHelpers.classPrivateFieldLooseBase(this,c)[c](s,t,e,r)}hasPermissionWithAnyNode(e){const t=this.currentUserPermissions[e];if(!t){return false}if(babelHelpers.classPrivateFieldLooseBase(this,u)[u](e)){if(!this.isTeamsAvailable){return false}return t.TEAM>o.none||t.DEPARTMENT>o.none}return t>o.none}hasPermissionOfAction(e){if(babelHelpers.classPrivateFieldLooseBase(this,u)[u](e)){return this.hasPermissionWithAnyNode(e)}return this.currentUserPermissions[e]!==undefined&&this.currentUserPermissions[e]!==null&&this.currentUserPermissions[e]!==o.none}}function E(e){const t=[a.teamView,a.teamCreate,a.teamEdit,a.teamDelete,a.teamAddMember,a.teamRemoveMember,a.teamSettingsEdit];return t.includes(e)}function p(e,t,i){if(e.TEAM===o.fullCompany){const e=r.useChartStore().departments;const n=e.get(t);if(i===a.teamCreate&&n.entityType===s.EntityTypes.department){return this.hasPermission(a.structureView,n.id)}return true}if(babelHelpers.classPrivateFieldLooseBase(this,m)[m](t,e.TEAM)){return true}return babelHelpers.classPrivateFieldLooseBase(this,d)[d](t,e.DEPARTMENT,i)}function T(e,t,s,i){const n=this.permissionVariablesDictionary.find((t=>t.id===e));if(!n){return false}const u=r.useChartStore().departments;if(s===a.departmentDelete){const e=[...u.values()].find((e=>e.parentId===0)).id;if(t===e){return false}}const l=r.useChartStore().currentDepartments;if(n.id<i){return false}switch(n.id){case o.fullCompany:return true;case o.selfAndSub:{if(l.includes(t)){return true}let e=u.get(t);while(e){if(l.includes(e.id)){return true}e=u.get(e.parentId)}return false}case o.self:return l.includes(t);case o.none:default:return false}}function h(e,t=o.none){if(t===o.none){return false}const i=r.useChartStore().currentDepartments;if(i.includes(e)){return true}if(t===o.self){return false}const n=r.useChartStore().departments;let a=n.get(e);while(a){if(a.entityType===s.EntityTypes.department){return false}if(i.includes(a.id)){return true}a=n.get(a.parentId)}return false}function A(e,t=o.none,i=""){if(t===o.none){return false}const n=r.useChartStore().currentDepartments;if(n.includes(e)){return true}const u=r.useChartStore().departments;let l=u.get(e);while(l){if(n.includes(l.id)){return true}if(t===o.self&&l.type===s.EntityTypes.department){if(i===a.teamCreate){return this.hasPermission(a.structureView,l.id)&&n.includes(l.id)}return false}l=u.get(l.parentId)}return false}const C=new f;e.PermissionActions=a;e.PermissionLevels=o;e.PermissionCheckerClass=f;e.PermissionChecker=C})(this.BX.Humanresources.CompanyStructure=this.BX.Humanresources.CompanyStructure||{},BX.Humanresources.CompanyStructure,BX.Humanresources.CompanyStructure,BX.Humanresources.CompanyStructure);
//# sourceMappingURL=checker.bundle.map.js