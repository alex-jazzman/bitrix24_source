{"version":3,"file":"checker.bundle.js","sources":["../../org-chart/src/api.js","../src/entity-permission-checkers/base-permission-checker.js","../src/consts.js","../src/entity-permission-checkers/team-checker.js","../src/entity-permission-checkers/department-checker.js","../src/checker.js"],"sourcesContent":["import { getData, postData } from 'humanresources.company-structure.api';\nimport { getNodeColorSettings } from 'humanresources.company-structure.utils';\nimport type { TreeItem } from './types';\n\nconst createTreeDataStore = (treeData: Array<TreeItem>): Map<number, TreeItem> => {\n\tconst dataMap = new Map();\n\ttreeData.forEach((item) => {\n\t\tconst { id, parentId, colorName, entityType } = item;\n\t\tconst mapItem = dataMap.get(id) ?? {};\n\t\tconst teamColor = getNodeColorSettings(colorName, entityType);\n\t\tdataMap.set(id, { ...mapItem, ...item, teamColor });\n\t\tif (parentId === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst mapParentItem = dataMap.get(parentId) ?? {};\n\t\tconst children = mapParentItem.children ?? [];\n\t\tdataMap.set(parentId, {\n\t\t\t...mapParentItem,\n\t\t\tchildren: [...children, id],\n\t\t});\n\t});\n\n\treturn dataMap;\n};\n\nexport const chartAPI = {\n\tremoveDepartment: (id: Number): Promise<void> => {\n\t\treturn getData('humanresources.api.Structure.Node.delete', { nodeId: id });\n\t},\n\tgetDepartmentsData: (): Promise<Array<TreeItem>> => {\n\t\treturn getData('humanresources.api.Structure.get', {}, { tool: 'structure', category: 'structure', event: 'open_structure' });\n\t},\n\tgetCurrentDepartments: (): Promise<number[]> => {\n\t\treturn getData('humanresources.api.Structure.Node.current');\n\t},\n\tgetDictionary: (): Promise<Object> => {\n\t\treturn getData('humanresources.api.Structure.dictionary');\n\t},\n\tgetUserId: (): Promise<number> => {\n\t\treturn getData('humanresources.api.User.getCurrentId');\n\t},\n\tfirstTimeOpened: (): Promise<void> => {\n\t\treturn postData('humanresources.api.User.firstTimeOpen');\n\t},\n\tupdateDepartment: (nodeId: number, parentId: number): Promise<void> => {\n\t\treturn postData('humanresources.api.Structure.Node.update', {\n\t\t\tnodeId,\n\t\t\tparentId,\n\t\t\tname: null,\n\t\t});\n\t},\n\tchangeOrder: (draggedId: Number, direction: Number, count: number): Promise<void> => {\n\t\treturn postData('humanresources.api.Structure.Node.changeOrder', {\n\t\t\tnodeId: draggedId,\n\t\t\tdirection,\n\t\t\tcount,\n\t\t});\n\t},\n\tcreateTreeDataStore,\n};\n","export class BasePermissionChecker\n{\n\tisCheckerAction(action): boolean\n\t{\n\t\tthrow new Error('The method isCheckerAction must be implemented in the subclass');\n\t}\n\n\thasPermission(action: string, nodeId: number, permissionValue: any, minLevel: ?any): boolean\n\t{\n\t\tthrow new Error('The method hasPermission must be implemented in the subclass');\n\t}\n}\n","export const PermissionActions = Object.freeze({\n\tstructureView: 'ACTION_STRUCTURE_VIEW',\n\tdepartmentCreate: 'ACTION_DEPARTMENT_CREATE',\n\tdepartmentDelete: 'ACTION_DEPARTMENT_DELETE',\n\tdepartmentEdit: 'ACTION_DEPARTMENT_EDIT',\n\temployeeAddToDepartment: 'ACTION_EMPLOYEE_ADD_TO_DEPARTMENT',\n\temployeeRemoveFromDepartment: 'ACTION_EMPLOYEE_REMOVE_FROM_DEPARTMENT',\n\temployeeFire: 'ACTION_FIRE_EMPLOYEE',\n\tdepartmentSettingsEdit: 'ACTION_DEPARTMENT_SETTINGS_EDIT',\n\tdepartmentChatEdit: 'ACTION_DEPARTMENT_CHAT_EDIT',\n\tdepartmentChannelEdit: 'ACTION_DEPARTMENT_CHANNEL_EDIT',\n\tdepartmentCollabEdit: 'ACTION_DEPARTMENT_COLLAB_EDIT',\n\taccessEdit: 'ACTION_USERS_ACCESS_EDIT',\n\tteamAccessEdit: 'ACTION_TEAM_ACCESS_EDIT',\n\tinviteToDepartment: 'ACTION_USER_INVITE',\n\tteamView: 'ACTION_TEAM_VIEW',\n\tteamCreate: 'ACTION_TEAM_CREATE',\n\tteamEdit: 'ACTION_TEAM_EDIT',\n\tteamDelete: 'ACTION_TEAM_DELETE',\n\tteamAddMember: 'ACTION_TEAM_MEMBER_ADD',\n\tteamRemoveMember: 'ACTION_TEAM_MEMBER_REMOVE',\n\tteamSettingsEdit: 'ACTION_TEAM_SETTINGS_EDIT',\n\tteamChatEdit: 'ACTION_TEAM_CHAT_EDIT',\n\tteamChannelEdit: 'ACTION_TEAM_CHANNEL_EDIT',\n\tteamCollabEdit: 'ACTION_TEAM_COLLAB_EDIT',\n});\n\nexport const PermissionLevels = Object.freeze({\n\tfullCompany: 30,\n\tselfAndSub: 20,\n\tself: 10,\n\tnone: 0,\n});\n","import { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { BasePermissionChecker } from './base-permission-checker';\nimport { PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport { PermissionActions, PermissionLevels } from '../consts';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\n\nexport class TeamPermissionChecker extends BasePermissionChecker\n{\n\tconstructor(departmentChecker, currentUserPermissions)\n\t{\n\t\tsuper();\n\t\tthis.departmentChecker = departmentChecker;\n\t\tthis.currentUserPermissions = currentUserPermissions;\n\t}\n\n\tisCheckerAction(action: string): boolean\n\t{\n\t\tconst teamActions = [\n\t\t\tPermissionActions.teamView,\n\t\t\tPermissionActions.teamCreate,\n\t\t\tPermissionActions.teamEdit,\n\t\t\tPermissionActions.teamDelete,\n\t\t\tPermissionActions.teamAddMember,\n\t\t\tPermissionActions.teamRemoveMember,\n\t\t\tPermissionActions.teamSettingsEdit,\n\t\t\tPermissionActions.teamChatEdit,\n\t\t\tPermissionActions.teamChannelEdit,\n\t\t\tPermissionActions.teamCollabEdit,\n\t\t];\n\n\t\treturn teamActions.includes(action);\n\t}\n\n\thasPermission(\n\t\taction: string,\n\t\tentityId: number,\n\t\tpermissionValue: {TEAM: number, DEPARTMENT: number},\n\t\tminValue?: { TEAM?: number, DEPARTMENT?: number } | null,\n\t): boolean\n\t{\n\t\tif (minValue)\n\t\t{\n\t\t\tconst isTeamPermissionInsufficient = permissionValue.TEAM < (minValue?.TEAM || 0);\n\t\t\tconst isDepartmentPermissionInsufficient = permissionValue.DEPARTMENT < (minValue?.DEPARTMENT || 0);\n\n\t\t\tif (isTeamPermissionInsufficient || isDepartmentPermissionInsufficient)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tif (permissionValue.TEAM === PermissionLevels.fullCompany)\n\t\t{\n\t\t\tconst entities = useChartStore().structureMap;\n\t\t\tconst currentNode = entities.get(entityId);\n\n\t\t\tif (\n\t\t\t\t(action === PermissionActions.teamCreate || action === PermissionActions.teamEdit)\n\t\t\t\t&& currentNode.entityType === EntityTypes.department\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn PermissionChecker.hasPermission(PermissionActions.structureView, currentNode.id);\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\tif (this.hasPermissionByTeamPermission(entityId, permissionValue.TEAM))\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\treturn this.hasPermissionByDepartmentPermission(entityId, permissionValue.DEPARTMENT, action);\n\t}\n\n\thasPermissionByTeamPermission(nodeId: number, level: number = PermissionLevels.none): boolean\n\t{\n\t\tif (level === PermissionLevels.none)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst entities = useChartStore().structureMap;\n\t\tconst userEntities = useChartStore().currentDepartments;\n\t\tconst userTeams = new Set(\n\t\t\tuserEntities.filter((id) => {\n\t\t\t\tconst department = entities.get(id);\n\n\t\t\t\treturn department && department.entityType === EntityTypes.team;\n\t\t\t}),\n\t\t);\n\n\t\tif (userTeams.has(nodeId))\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (level === PermissionLevels.self)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet currentDepartment = entities.get(nodeId);\n\t\twhile (currentDepartment)\n\t\t{\n\t\t\tif (currentDepartment.entityType === EntityTypes.department)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (userTeams.has(currentDepartment.id))\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tcurrentDepartment = entities.get(currentDepartment.parentId);\n\t\t}\n\n\t\treturn false;\n\t}\n\n\thasPermissionByDepartmentPermission(nodeId, level = PermissionLevels.none, action = ''): boolean\n\t{\n\t\tif (level === PermissionLevels.none)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst entities = useChartStore().structureMap;\n\t\tconst userEntities = useChartStore().currentDepartments;\n\t\tconst userDepartments = new Set(\n\t\t\tuserEntities.filter((id) => {\n\t\t\t\tconst department = entities.get(id);\n\n\t\t\t\treturn department && department.entityType === EntityTypes.department;\n\t\t\t}),\n\t\t);\n\n\t\tif (userDepartments.has(nodeId))\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tlet currentDepartment = entities.get(nodeId);\n\t\twhile (currentDepartment)\n\t\t{\n\t\t\tif (userDepartments.has(currentDepartment.id))\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (level === PermissionLevels.self && currentDepartment.entityType === EntityTypes.department)\n\t\t\t{\n\t\t\t\tif (action === PermissionActions.teamCreate || action === PermissionActions.teamEdit)\n\t\t\t\t{\n\t\t\t\t\treturn userDepartments.has(currentDepartment.id);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tcurrentDepartment = entities.get(currentDepartment.parentId);\n\t\t}\n\n\t\treturn false;\n\t}\n}\n","import { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { BasePermissionChecker } from './base-permission-checker';\nimport { PermissionActions, PermissionLevels } from '../consts';\nimport { Type } from 'main.core';\n\nexport class DepartmentPermissionChecker extends BasePermissionChecker\n{\n\tisCheckerAction(action: string): boolean\n\t{\n\t\tconst departmentActions = [\n\t\t\tPermissionActions.structureView,\n\t\t\tPermissionActions.departmentCreate,\n\t\t\tPermissionActions.departmentDelete,\n\t\t\tPermissionActions.departmentEdit,\n\t\t\tPermissionActions.employeeAddToDepartment,\n\t\t\tPermissionActions.employeeRemoveFromDepartment,\n\t\t\tPermissionActions.employeeFire,\n\t\t\tPermissionActions.departmentSettingsEdit,\n\t\t\tPermissionActions.departmentChatEdit,\n\t\t\tPermissionActions.departmentChannelEdit,\n\t\t\tPermissionActions.departmentCollabEdit,\n\t\t\tPermissionActions.inviteToDepartment,\n\t\t];\n\n\t\treturn departmentActions.includes(action);\n\t}\n\n\thasPermission(action: string, departmentId: number, permissionValue: number, minLevel?: number): boolean\n\t{\n\t\tif (\n\t\t\t!this.isCheckerAction(action)\n\t\t\t&& !Type.isNumber(permissionValue)\n\t\t)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (\n\t\t\tminLevel !== null\n\t\t\t&& permissionValue < minLevel\n\t\t)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst departments = useChartStore().structureMap;\n\t\tif (action === PermissionActions.departmentDelete)\n\t\t{\n\t\t\tconst rootId = [...departments.values()].find((department) => department.parentId === 0).id;\n\t\t\tif (departmentId === rootId)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tconst userDepartments = useChartStore().currentDepartments;\n\t\tswitch (permissionValue)\n\t\t{\n\t\t\tcase PermissionLevels.fullCompany:\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tcase PermissionLevels.selfAndSub:\n\t\t\t{\n\t\t\t\tlet currentDepartment = departments.get(departmentId);\n\t\t\t\twhile (currentDepartment)\n\t\t\t\t{\n\t\t\t\t\tif (userDepartments.includes(currentDepartment.id))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tcurrentDepartment = departments.get(currentDepartment.parentId);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tcase PermissionLevels.self:\n\t\t\t{\n\t\t\t\treturn userDepartments.includes(departmentId);\n\t\t\t}\n\n\t\t\tcase PermissionLevels.none:\n\t\t\tdefault:\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n}\n","/* eslint-disable no-constructor-return */\nimport { chartAPI } from '../../org-chart/src/api';\nimport { TeamPermissionChecker } from './entity-permission-checkers/team-checker';\nimport { DepartmentPermissionChecker } from './entity-permission-checkers/department-checker';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\nimport { PermissionLevels, PermissionActions } from './consts';\n\nexport class PermissionCheckerClass\n{\n\tconstructor(): PermissionCheckerClass\n\t{\n\t\tif (!PermissionCheckerClass.instance)\n\t\t{\n\t\t\tthis.currentUserPermissions = {};\n\t\t\tthis.isTeamsAvailable = false;\n\t\t\tthis.isCollabsAvailable = false;\n\t\t\tthis.isDeputyApprovesBPAvailable = false;\n\t\t\tthis.isInitialized = false;\n\t\t\tthis.departmentChecker = new DepartmentPermissionChecker();\n\t\t\tthis.teamChecker = new TeamPermissionChecker(this.departmentChecker, this.currentUserPermissions);\n\t\t\tPermissionCheckerClass.instance = this;\n\t\t}\n\n\t\treturn PermissionCheckerClass.instance;\n\t}\n\n\tgetInstance(): PermissionCheckerClass\n\t{\n\t\treturn PermissionCheckerClass.instance;\n\t}\n\n\tasync init(): Promise<void>\n\t{\n\t\tif (this.isInitialized)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst {\n\t\t\tcurrentUserPermissions,\n\t\t\tteamsAvailable,\n\t\t\tcollabsAvailable,\n\t\t\tdeputyApprovesBP,\n\t\t\tdepartmentSettingsAvailable,\n\t\t} = await chartAPI.getDictionary();\n\n\t\tthis.currentUserPermissions = currentUserPermissions;\n\t\tthis.isTeamsAvailable = teamsAvailable;\n\t\tthis.isCollabsAvailable = collabsAvailable;\n\t\tthis.isDeputyApprovesBPAvailable = deputyApprovesBP;\n\t\tthis.isDepartmentSettingsAvailable = departmentSettingsAvailable;\n\n\t\tthis.isInitialized = true;\n\t}\n\n\thasPermission(action: string, entityId: number, minLevel: any = null): boolean\n\t{\n\t\tconst permissionLevel = this.currentUserPermissions[action];\n\n\t\tif (!permissionLevel || !entityId)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.departmentChecker.isCheckerAction(action))\n\t\t{\n\t\t\treturn this.departmentChecker.hasPermission(\n\t\t\t\taction,\n\t\t\t\tentityId,\n\t\t\t\tpermissionLevel,\n\t\t\t\tminLevel,\n\t\t\t);\n\t\t}\n\n\t\tif (\n\t\t\tthis.isTeamsAvailable\n\t\t\t&& this.teamChecker.isCheckerAction(action)\n\t\t)\n\t\t{\n\t\t\treturn this.teamChecker.hasPermission(\n\t\t\t\taction,\n\t\t\t\tentityId,\n\t\t\t\tpermissionLevel,\n\t\t\t\tminLevel,\n\t\t\t);\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tcheckDeputyApprovalBPAvailable(): boolean\n\t{\n\t\treturn this.isDeputyApprovesBPAvailable;\n\t}\n\n\tcheckDepartmentSettingsAvailable(): boolean\n\t{\n\t\treturn this.isDepartmentSettingsAvailable;\n\t}\n\n\thasPermissionOfAction(action: string): boolean\n\t{\n\t\tconst permissionLevel = this.currentUserPermissions[action];\n\n\t\tif (!permissionLevel)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.teamChecker.isCheckerAction(action))\n\t\t{\n\t\t\tif (!this.isTeamsAvailable)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn permissionLevel.TEAM > PermissionLevels.none || permissionLevel.DEPARTMENT > PermissionLevels.none;\n\t\t}\n\n\t\treturn permissionLevel > PermissionLevels.none;\n\t}\n\n\tcanSortEntitiesByParentId(entityId: number): boolean\n\t{\n\t\tconst entities = useChartStore().departments;\n\t\tconst entity = entities.get(entityId);\n\t\tif (!entity)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst teamTeamMinValue = { TEAM: PermissionLevels.selfAndSub };\n\t\tconst teamDepartmentMinValue = { DEPARTMENT: PermissionLevels.selfAndSub };\n\n\t\tconst teamAction = PermissionActions.teamEdit;\n\t\tif (entity.entityType === EntityTypes.team)\n\t\t{\n\t\t\treturn this.hasPermission(teamAction, entityId, teamTeamMinValue)\n\t\t\t\t|| this.hasPermission(teamAction, entityId, teamDepartmentMinValue)\n\t\t\t;\n\t\t}\n\n\t\tif (entity.entityType === EntityTypes.department)\n\t\t{\n\t\t\tconst departmentAction = PermissionActions.departmentEdit;\n\n\t\t\treturn this.hasPermission(departmentAction, entityId, PermissionLevels.selfAndSub);\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tcanBeParentForEntity(entityId: number, type: EntityTypes): boolean\n\t{\n\t\tif (type === EntityTypes.department)\n\t\t{\n\t\t\treturn this.hasPermission(PermissionActions.departmentEdit, entityId);\n\t\t}\n\n\t\tif (type === EntityTypes.team)\n\t\t{\n\t\t\treturn this.hasPermission(PermissionActions.teamEdit, entityId);\n\t\t}\n\n\t\treturn false;\n\t}\n}\n\nexport const PermissionChecker = new PermissionCheckerClass();\n"],"names":["createTreeDataStore","treeData","dataMap","Map","forEach","item","id","parentId","colorName","entityType","mapItem","get","teamColor","getNodeColorSettings","set","mapParentItem","children","chartAPI","removeDepartment","getData","nodeId","getDepartmentsData","tool","category","event","getCurrentDepartments","getDictionary","getUserId","firstTimeOpened","postData","updateDepartment","name","changeOrder","draggedId","direction","count","BasePermissionChecker","isCheckerAction","action","Error","hasPermission","permissionValue","minLevel","PermissionActions","Object","freeze","structureView","departmentCreate","departmentDelete","departmentEdit","employeeAddToDepartment","employeeRemoveFromDepartment","employeeFire","departmentSettingsEdit","departmentChatEdit","departmentChannelEdit","departmentCollabEdit","accessEdit","teamAccessEdit","inviteToDepartment","teamView","teamCreate","teamEdit","teamDelete","teamAddMember","teamRemoveMember","teamSettingsEdit","teamChatEdit","teamChannelEdit","teamCollabEdit","PermissionLevels","fullCompany","selfAndSub","self","none","TeamPermissionChecker","constructor","departmentChecker","currentUserPermissions","teamActions","includes","entityId","minValue","isTeamPermissionInsufficient","TEAM","isDepartmentPermissionInsufficient","DEPARTMENT","entities","useChartStore","structureMap","currentNode","EntityTypes","department","PermissionChecker","hasPermissionByTeamPermission","hasPermissionByDepartmentPermission","level","userEntities","currentDepartments","userTeams","Set","filter","team","has","currentDepartment","userDepartments","DepartmentPermissionChecker","departmentActions","departmentId","Type","isNumber","departments","rootId","values","find","PermissionCheckerClass","instance","isTeamsAvailable","isCollabsAvailable","isDeputyApprovesBPAvailable","isInitialized","teamChecker","getInstance","init","teamsAvailable","collabsAvailable","deputyApprovesBP","departmentSettingsAvailable","isDepartmentSettingsAvailable","permissionLevel","checkDeputyApprovalBPAvailable","checkDepartmentSettingsAvailable","hasPermissionOfAction","canSortEntitiesByParentId","entity","teamTeamMinValue","teamDepartmentMinValue","teamAction","departmentAction","canBeParentForEntity","type"],"mappings":"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"}