{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { ajax as Ajax, Reflection, Dom, Loc } from 'main.core';\nimport { App } from 'ui.accessrights.v2';\nimport { Loader } from 'main.loader';\nimport { ButtonColor, ButtonSize, CancelButton, SaveButton } from 'ui.buttons';\nimport { MessageBox } from 'ui.dialogs.messagebox';\n\nconst namespace = Reflection.namespace('BX.Humanresources');\n\nclass ConfigPermsComponent\n{\n\taccessRights: App;\n\taccessRightsOption: Object;\n\tmenuId: string;\n\tisRendered: boolean;\n\n\tconstructor(config: { accessRightsOption: Object, accessRights: App, menuId: string })\n\t{\n\t\tthis.accessRightsOption = config.accessRightsOption;\n\t\tthis.accessRights = config.accessRights;\n\t\tthis.menuId = config.menuId;\n\t}\n\n\tinit(): void\n\t{\n\t\tthis.accessRights.draw();\n\t\tthis.isRendered = true;\n\t\tthis.#addWrapperSliderContent();\n\t\tthis.#addWrapperLeftMenu();\n\t}\n\n\t#addWrapperSliderContent(): void\n\t{\n\t\tconst sliderContent = document.getElementById('ui-page-slider-content');\n\t\tif (sliderContent)\n\t\t{\n\t\t\tconst wrapperSliderContent = Dom.create('div', {\n\t\t\t\tprops: { className: 'hr-permission-config-role-main-content' },\n\t\t\t});\n\n\t\t\twrapperSliderContent.className = 'hr-permission-config-role-main-content';\n\t\t\tDom.insertBefore(wrapperSliderContent, sliderContent);\n\t\t\tDom.append(sliderContent, wrapperSliderContent);\n\t\t}\n\t}\n\n\t#addWrapperLeftMenu(): void\n\t{\n\t\tconst leftPanel = document.getElementById('left-panel');\n\n\t\tif (leftPanel)\n\t\t{\n\t\t\tconst wrapperLeftMenu = Dom.create('div', {\n\t\t\t\tprops: { className: 'hr-permission-config-role-main-left-menu' },\n\t\t\t});\n\n\t\t\tDom.insertBefore(wrapperLeftMenu, leftPanel);\n\t\t\tDom.append(leftPanel, wrapperLeftMenu);\n\t\t}\n\t}\n\n\topenPermission(parameters: { category: string, menuId: string }): void\n\t{\n\t\tif (parameters.menuId === this.menuId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isRendered && this.accessRights.hasUnsavedChanges())\n\t\t{\n\t\t\tevent.stopImmediatePropagation();\n\t\t\tthis.#confirmBeforeRedraw(parameters.menuId);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.redrawAccessRight(parameters);\n\t\t}\n\t}\n\n\tredrawAccessRight(parameters: { category: string, menuId: string }): void\n\t{\n\t\tif (this.isRendered)\n\t\t{\n\t\t\tthis.accessRights.destroy();\n\t\t}\n\n\t\tthis.menuId = parameters.menuId;\n\t\tthis.isRendered = false;\n\t\tconst loader = new Loader({\n\t\t\ttarget: document.getElementById('bx-hr-permission-config-role-main-container'),\n\t\t});\n\t\tloader.show();\n\n\t\tthis.#runGetDataAjaxRequest(parameters)\n\t\t\t.then((data) => {\n\t\t\t\tif (data.userGroups && data.accessRights)\n\t\t\t\t{\n\t\t\t\t\tthis.accessRightsOption.userGroups = data.userGroups;\n\t\t\t\t\tthis.accessRightsOption.accessRights = data.accessRights;\n\t\t\t\t\tthis.accessRightsOption.additionalSaveParams = { category: parameters.category };\n\t\t\t\t\tthis.accessRightsOption.loadParams = { category: parameters.category };\n\n\t\t\t\t\tthis.accessRights = new App(this.accessRightsOption);\n\t\t\t\t\tscrollTo({ top: 0 });\n\t\t\t\t}\n\t\t\t\tthis.accessRights.draw();\n\t\t\t\tthis.isRendered = true;\n\t\t\t})\n\t\t\t.catch(() => {\n\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\tcontent: Loc.getMessage('HUMANRESOURCES_CONFIG_PERMISSIONS_ERROR'),\n\t\t\t\t\tposition: 'top-right',\n\t\t\t\t\tautoHideDelay: 3000,\n\t\t\t\t});\n\t\t\t})\n\t\t\t.finally(() => {\n\t\t\t\tloader.destroy();\n\t\t\t})\n\t\t;\n\t}\n\n\t#confirmBeforeRedraw(menuId: string): void\n\t{\n\t\tconst messageBox = MessageBox.create({\n\t\t\tmessage: Loc.getMessage('HUMANRESOURCES_CONFIG_PERMISSIONS_SAVE_MESSAGEBOX_TEXT'),\n\t\t\tmodal: true,\n\t\t\tbuttons: [\n\t\t\t\tnew SaveButton({\n\t\t\t\t\tsize: ButtonSize.SMALL,\n\t\t\t\t\tcolor: ButtonColor.PRIMARY,\n\t\t\t\t\tonclick: (button) => {\n\t\t\t\t\t\tthis.#handleSaveButtonClick(button, menuId, messageBox);\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tnew CancelButton({\n\t\t\t\t\tsize: ButtonSize.SMALL,\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\n\t\tmessageBox.show();\n\t}\n\n\t#handleSaveButtonClick(button: SaveButton, menuId: string, messageBox: MessageBox): void\n\t{\n\t\tbutton.setWaiting(true);\n\t\tthis.accessRights.sendActionRequest()\n\t\t\t.then(() => {\n\t\t\t\tdocument.querySelector(`[data-menu-id=\"${menuId}\"]`).click();\n\t\t\t})\n\t\t\t.catch(() => {})\n\t\t\t.finally(() => {\n\t\t\t\tmessageBox.close();\n\t\t\t})\n\t\t;\n\t}\n\n\t#runGetDataAjaxRequest(parameters: { category: string, menuId: string }): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tAjax.runComponentAction(\n\t\t\t\t'bitrix:humanresources.config.permissions',\n\t\t\t\t'getData',\n\t\t\t\t{\n\t\t\t\t\tmode: 'class',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tparameters,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t)\n\t\t\t\t.then((response) => {\n\t\t\t\t\tresolve(response.data);\n\t\t\t\t})\n\t\t\t\t.catch(reject)\n\t\t\t;\n\t\t});\n\t}\n}\n\nnamespace.ConfigPermsComponent = ConfigPermsComponent;\n"],"names":["namespace","Reflection","ConfigPermsComponent","config","accessRightsOption","accessRights","menuId","draw","isRendered","parameters","hasUnsavedChanges","event","stopImmediatePropagation","redrawAccessRight","destroy","loader","Loader","target","document","getElementById","show","then","data","userGroups","additionalSaveParams","category","loadParams","App","scrollTo","top","BX","UI","Notification","Center","notify","content","Loc","getMessage","position","autoHideDelay","sliderContent","wrapperSliderContent","Dom","create","props","className","insertBefore","append","leftPanel","wrapperLeftMenu","messageBox","MessageBox","message","modal","buttons","SaveButton","size","ButtonSize","SMALL","color","ButtonColor","PRIMARY","onclick","button","CancelButton","close","setWaiting","sendActionRequest","querySelector","click","Promise","resolve","reject","Ajax","runComponentAction","mode","response"],"mappings":"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"}