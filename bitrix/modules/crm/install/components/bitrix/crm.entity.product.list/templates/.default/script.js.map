{"version":3,"file":"script.js","sources":["src/js/hint.popup.js","src/js/reserve.control.js","src/js/store.available.popup.js","src/js/money.control.js","src/js/product.list.row.js","src/js/page.events.manager.js","src/js/settings.button.js","src/js/field.hint.manager.js","src/js/product.list.editor.js"],"sourcesContent":["import {Popup} from 'main.popup';\nimport {Tag, Text} from 'main.core';\nimport {Editor} from './product.list.editor';\n\nexport default class HintPopup\n{\n\teditor: Editor;\n\thintPopup: ?Popup;\n\n\tconstructor(editor: Editor)\n\t{\n\t\tthis.editor = editor;\n\t}\n\n\tload(node: HTMLElement, text: String): Popup\n\t{\n\t\tif (!this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup = new Popup(\n\t\t\t\t'ui-hint-popup-' + this.editor.getId(),\n\t\t\t\tnull,\n\t\t\t\t{\n\t\t\t\t\tdarkMode: true,\n\t\t\t\t\tcloseIcon: true,\n\t\t\t\t\tanimation: 'fading-slide',\n\t\t\t\t\tautoHide: true,\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tthis.hintPopup.setBindElement(node);\n\t\tthis.hintPopup.adjustPosition();\n\t\tthis.hintPopup.setContent(Tag.render`\n\t\t\t<div class='ui-hint-content'>${Text.encode(text)}</div>\n\t\t`);\n\n\t\treturn this.hintPopup;\n\t}\n\n\tshow()\n\t{\n\t\tif (this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup.show();\n\t\t}\n\t}\n\n\tclose()\n\t{\n\t\tif (this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup.close();\n\t\t}\n\t}\n}\n","import { Tag, Text, Loc, Event, Cache, Runtime, Dom } from 'main.core';\nimport { EventEmitter, BaseEvent } from 'main.core.events';\nimport { Row } from './product.list.row';\nimport { ModeList } from 'catalog.store-enable-wizard';\n\nexport default class ReserveControl\n{\n\tstatic INPUT_NAME = 'INPUT_RESERVE_QUANTITY';\n\tstatic VIEW_NAME = 'VIEW_RESERVE_QUANTITY';\n\tstatic DATE_NAME = 'DATE_RESERVE_END';\n\tstatic QUANTITY_NAME = 'QUANTITY';\n\tstatic DEDUCTED_QUANTITY_NAME = 'DEDUCTED_QUANTITY';\n\n\t#row:Row = null;\n\t#cache = new Cache.MemoryCache();\n\tisReserveEqualProductQuantity = true;\n\twrapper = null;\n\tmeasureName;\n\n\tconstructor(options)\n\t{\n\t\tthis.#row = options.row;\n\t\tthis.inputFieldName = options.inputName || ReserveControl.INPUT_NAME;\n\t\tthis.viewName = ReserveControl.VIEW_NAME;\n\t\tthis.dateFieldName = options.dateFieldName || ReserveControl.DATE_NAME;\n\t\tthis.quantityFieldName = options.quantityFieldName || ReserveControl.QUANTITY_NAME;\n\t\tthis.deductedQuantityFieldName = options.deductedQuantityFieldName || ReserveControl.DEDUCTED_QUANTITY_NAME;\n\t\tthis.defaultDateReservation = options.defaultDateReservation || null;\n\t\tthis.isBlocked = options.isBlocked || false;\n\t\tthis.isInventoryManagementToolEnabled = options.isInventoryManagementToolEnabled || false;\n\t\tthis.inventoryManagementMode = options.inventoryManagementMode || '';\n\t\tthis.measureName = options.measureName;\n\n\t\tthis.isReserveEqualProductQuantity =\n\t\t\toptions.isReserveEqualProductQuantity\n\t\t\t&& (\n\t\t\t\tthis.getReservedQuantity() === this.getQuantity()\n\t\t\t\t|| this.#row.isNewRow()\n\t\t\t)\n\t\t;\n\t}\n\n\trenderTo(node: HTMLElement): void\n\t{\n\t\tthis.wrapper = node;\n\n\t\tDom.append(Tag.render`<div>${this.#getReserveInputNode()}</div>`, this.wrapper);\n\t\tEvent.bind(this.#getReserveInputNode().querySelector('input'), 'input', Runtime.debounce(this.onReserveInputChange, 800, this));\n\n\t\tif (!this.#isInventoryManagementMode1C())\n\t\t{\n\t\t\tif (this.getReservedQuantity() > 0 || this.isReserveEqualProductQuantity)\n\t\t\t{\n\t\t\t\tthis.#layoutDateReservation(this.getDateReservation());\n\t\t\t}\n\n\t\t\tDom.append(this.#getDateNode(), this.wrapper);\n\n\t\t\tEvent.bind(this.#getDateNode(), 'click', ReserveControl.#onDateInputClick.bind(this));\n\t\t\tEvent.bind(this.#getDateNode().querySelector('input'), 'change', this.onDateChange.bind(this));\n\t\t}\n\t}\n\n\tsetReservedQuantity(value: Number, isTriggerEvent: ?Boolean)\n\t{\n\t\tconst input = this.#getReserveInputNode().querySelector('input');\n\t\tif (input)\n\t\t{\n\t\t\tinput.value = value;\n\n\t\t\tif (isTriggerEvent)\n\t\t\t{\n\t\t\t\tinput.dispatchEvent(new window.Event('input'));\n\t\t\t}\n\t\t}\n\t}\n\n\tgetReservedQuantity(): number\n\t{\n\t\treturn Text.toNumber(this.#row.getField(this.inputFieldName));\n\t}\n\n\tgetDateReservation()\n\t{\n\t\treturn this.#row.getField(this.dateFieldName) || '';\n\t}\n\n\tgetQuantity(): number\n\t{\n\t\treturn Text.toNumber(this.#row.getField(this.quantityFieldName));\n\t}\n\n\tgetDeductedQuantity(): number\n\t{\n\t\treturn Text.toNumber(this.#row.getField(this.deductedQuantityFieldName));\n\t}\n\n\tgetAvailableQuantity(): number\n\t{\n\t\treturn this.getQuantity() - this.getDeductedQuantity();\n\t}\n\n\tonReserveInputChange(event: BaseEvent)\n\t{\n\t\tconst value = Text.toNumber(event.target.value);\n\n\t\tthis.changeInputValue(value);\n\t}\n\n\tchangeInputValue(rawValue): void\n\t{\n\t\tlet value = rawValue;\n\t\tif (value > this.getAvailableQuantity())\n\t\t{\n\t\t\tthis.#showNotify('reserveCountError', 'CRM_ENTITY_PL_IS_LESS_QUANTITY_WITH_DEDUCTED_THEN_RESERVED');\n\n\t\t\tvalue = this.getAvailableQuantity();\n\t\t\tthis.setReservedQuantity(value);\n\t\t}\n\t\telse if (value < 0)\n\t\t{\n\t\t\tthis.#showNotify('reserveNegativeCountError', 'CRM_ENTITY_PL_IS_NEGATIVE_INPUT_RESERVE');\n\n\t\t\tvalue = 0;\n\t\t\tthis.setReservedQuantity(value);\n\t\t}\n\n\t\tif (value > 0)\n\t\t{\n\t\t\tconst dateReservation = this.getDateReservation();\n\t\t\tif (dateReservation === '')\n\t\t\t{\n\t\t\t\tthis.changeDateReservation(this.defaultDateReservation);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#layoutDateReservation(dateReservation);\n\t\t\t}\n\t\t}\n\t\telse if (value <= 0)\n\t\t{\n\t\t\tthis.changeDateReservation();\n\t\t}\n\n\t\tthis.setReservedQuantity(value, false);\n\t\tthis.#row.updateField(this.inputFieldName, value);\n\t}\n\n\tclearCache()\n\t{\n\t\tthis.#cache.delete('dateInput');\n\t\tthis.#cache.delete('reserveInput');\n\t}\n\n\tisInputDisabled(): boolean\n\t{\n\t\tif (\n\t\t\tthis.isBlocked\n\t\t\t|| !this.isInventoryManagementToolEnabled\n\t\t)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tconst model = this.#row.getModel();\n\t\tif (model)\n\t\t{\n\t\t\treturn model.isSimple() || model.isService();\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tstatic #onDateInputClick(event: BaseEvent)\n\t{\n\t\tBX.calendar({\n\t\t\tnode: event.target,\n\t\t\tfield: event.target.parentNode.querySelector('input'),\n\t\t\tbTime: false,\n\t\t});\n\t}\n\n\tonDateChange(event: BaseEvent)\n\t{\n\t\tconst value = event.target.value;\n\t\tconst newDate = BX.parseDate(value);\n\t\tconst current = new Date();\n\t\tcurrent.setHours(0, 0, 0, 0);\n\t\tif (newDate >= current)\n\t\t{\n\t\t\tthis.changeDateReservation(value);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#showNotify('reserveDateError', 'CRM_ENTITY_PL_DATE_IN_PAST');\n\n\t\t\tthis.changeDateReservation(this.defaultDateReservation);\n\t\t}\n\t}\n\n\t#getDateNode(): HTMLElement\n\t{\n\t\treturn this.#cache.remember('dateInput', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div>\n\t\t\t\t\t<a class=\"crm-entity-product-list-reserve-date\"></a>\n\t\t\t\t\t<input\n\t\t\t\t\t\tdata-name=\"${this.dateFieldName}\"\n\t\t\t\t\t\tname=\"${this.dateFieldName}\"\n\t\t\t\t\t\ttype=\"hidden\"\n\t\t\t\t\t\tvalue=\"${this.getDateReservation()}\"\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\t#getReserveInputNode(): HTMLElement\n\t{\n\t\treturn this.#cache.remember('reserveInput', () => {\n\t\t\tconst viewReserveNode =\n\t\t\t\tthis.#isInventoryManagementMode1C()\n\t\t\t\t\t? Tag.render`\n\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t<span data-name=\"${this.viewName}\">\n\t\t\t\t\t\t\t\t${this.getReservedQuantity()}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t&nbsp;\n\t\t\t\t\t\t\t${Text.encode(this.#row.getMeasureName())}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t`\n\t\t\t\t\t: null\n\t\t\t;\n\n\t\t\tconst tag = Tag.render`\n\t\t\t\t<div ${this.isInputDisabled() ? 'class=\"crm-entity-product-list-locked-field-wrapper\"' : ''}>\n\t\t\t\t\t${viewReserveNode}\n\t\t\t\t\t<input type=\"${this.#isInventoryManagementMode1C() ? 'hidden' : 'text'}\"\n\t\t\t\t\t\tdata-name=\"${this.inputFieldName}\"\n\t\t\t\t\t\tname=\"${this.inputFieldName}\"\n\t\t\t\t\t\tclass=\"ui-ctl-element ui-ctl-textbox ${this.isInputDisabled() ? 'crm-entity-product-list-locked-field' : ''}\"\n\t\t\t\t\t\tautoComplete=\"off\"\n\t\t\t\t\t\tvalue=\"${this.getReservedQuantity()}\"\n\t\t\t\t\t\tplaceholder=\"0\"\n\t\t\t\t\t\ttitle=\"${this.getReservedQuantity()}\"\n\t\t\t\t\t\t${this.isInputDisabled() ? 'disabled' : ''}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\tif (this.isBlocked || !this.isInventoryManagementToolEnabled)\n\t\t\t{\n\t\t\t\ttag.onclick = () => EventEmitter.emit(this, 'onNodeClick');\n\t\t\t}\n\n\t\t\treturn tag;\n\t\t});\n\t}\n\n\tchangeDateReservation(date: string = '')\n\t{\n\t\tif (date !== this.getDateReservation())\n\t\t{\n\t\t\tthis.#row.updateField(this.dateFieldName, date);\n\t\t}\n\n\t\tthis.#layoutDateReservation(date);\n\t}\n\n\t#layoutDateReservation(date: string = ''): void\n\t{\n\t\tconst linkText =\n\t\t\t(date === '')\n\t\t\t\t? ''\n\t\t\t\t: Loc.getMessage(\n\t\t\t\t\t'CRM_ENTITY_PL_RESERVED_DATE',\n\t\t\t\t\t{\n\t\t\t\t\t\t'#FINAL_RESERVATION_DATE#': date,\n\t\t\t\t\t},\n\t\t\t\t)\n\t\t;\n\t\tconst link = this.#getDateNode().querySelector('a');\n\t\tif (link)\n\t\t{\n\t\t\tlink.innerText = linkText;\n\t\t}\n\n\t\tconst hiddenInput = this.#getDateNode().querySelector('input');\n\t\tif (hiddenInput)\n\t\t{\n\t\t\thiddenInput.value = date;\n\t\t}\n\t}\n\n\tdisable(wrapper: Element | null): void\n\t{\n\t\tconst node = wrapper || this.wrapper;\n\t\tif (node)\n\t\t{\n\t\t\tnode.innerHTML = this.getReservedQuantity() + ' ' + Text.encode(this.measureName);\n\t\t}\n\t}\n\n\t#isInventoryManagementMode1C(): boolean\n\t{\n\t\treturn this.inventoryManagementMode === ModeList.MODE_1C;\n\t}\n\n\t#showNotify(notifyId: string, messageId: string): void\n\t{\n\t\tlet notify = BX.UI.Notification.Center.getBalloonById(notifyId);\n\t\tif (!notify)\n\t\t{\n\t\t\tconst notificationOptions = {\n\t\t\t\tid: notifyId,\n\t\t\t\tcloseButton: true,\n\t\t\t\tautoHideDelay: 3000,\n\t\t\t\tcontent: Tag.render`<div>${Loc.getMessage(messageId)}</div>`,\n\t\t\t};\n\n\t\t\tnotify = BX.UI.Notification.Center.notify(notificationOptions);\n\t\t}\n\n\t\tnotify.show();\n\t}\n}\n","import { Event, Loc, Tag, Uri, Dom } from 'main.core';\nimport { Popup, PopupManager } from 'main.popup';\nimport { ProductModel } from 'catalog.product-model';\nimport { ModeList } from 'catalog.store-enable-wizard';\n\nexport default class StoreAvailablePopup\n{\n\t#rowId;\n\t#model: ProductModel;\n\t#inventoryManagementMode: ?string;\n\t#node: HTMLElement;\n\t#popup: ?Popup;\n\n\tconstructor(options)\n\t{\n\t\tthis.#rowId = options.rowId\n\t\tthis.#model = options.model;\n\t\tthis.#inventoryManagementMode = options.inventoryManagementMode;\n\t\tthis.setNode(options.node);\n\t}\n\n\tsetNode(node: HTMLElement)\n\t{\n\t\tthis.#node = node;\n\t\tDom.addClass(this.#node, 'store-available-popup-link');\n\n\t\tEvent.bind(this.#node, 'click', this.togglePopup.bind(this));\n\t}\n\n\t#createPopup()\n\t{\n\t\tconst popupId = `store-available-popup-row-${this.#rowId}`;\n\t\tconst popup = PopupManager.getPopupById(popupId);\n\t\tif (popup)\n\t\t{\n\t\t\tthis.#popup = popup;\n\t\t\tthis.#popup.setBindElement(this.#node);\n\t\t\tthis.#popup.setContent(this.getPopupContent());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#popup = PopupManager.create({\n\t\t\t\tid: popupId,\n\t\t\t\tbindElement: this.#node,\n\t\t\t\tautoHide: true,\n\t\t\t\tdraggable: false,\n\t\t\t\toffsetLeft: -218,\n\t\t\t\toffsetTop: 0,\n\t\t\t\tangle: {\n\t\t\t\t\tposition: 'top',\n\t\t\t\t\toffset: 250\n\t\t\t\t},\n\t\t\t\tnoAllPaddings: true,\n\t\t\t\tbindOptions: {\n\t\t\t\t\tforceBindPosition: true\n\t\t\t\t},\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tcontent: this.getPopupContent(),\n\t\t\t});\n\t\t}\n\t}\n\n\tgetPopupContent(): HTMLElement\n\t{\n\t\tconst storeId = this.#model.getField('STORE_ID');\n\t\tconst storeCollection = this.#model.getStoreCollection();\n\n\t\tconst storeQuantity = storeCollection.getStoreAmount(storeId);\n\t\tconst reservedQuantity = storeCollection.getStoreReserved(storeId);\n\t\tconst availableQuantity = storeCollection.getStoreAvailableAmount(storeId);\n\n\t\tconst renderHead = (value) => {\n\t\t\treturn `<td class=\"main-grid-cell-head main-grid-col-no-sortable main-grid-cell-right\">\n\t\t\t\t<div class=\"main-grid-cell-inner\">\n\t\t\t\t\t<span class=\"main-grid-cell-head-container\">${value}</span>\n\t\t\t\t</div>\n\t\t\t</td>`;\n\t\t};\n\n\t\tconst renderRow = (value) => {\n\t\t\treturn `<td class=\"main-grid-cell main-grid-cell-right\">\n\t\t\t\t<div class=\"main-grid-cell-inner\">\n\t\t\t\t\t<span class=\"main-grid-cell-content\">${value}</span>\n\t\t\t\t</div>\n\t\t\t</td>`;\n\t\t};\n\n\t\tconst isReservedQuantityLink = reservedQuantity > 0 && this.#inventoryManagementMode !== ModeList.MODE_1C;\n\n\t\tconst reservedQuantityContent = isReservedQuantityLink\n\t\t\t? `<a href=\"#\" class=\"store-available-popup-reserves-slider-link\">${reservedQuantity}</a>`\n\t\t\t: reservedQuantity\n\t\t;\n\t\tconst viewAvailableQuantity = availableQuantity <= 0\n\t\t\t? `<span class=\"text--danger\">${availableQuantity}`\n\t\t\t: availableQuantity\n\t\t;\n\n\t\tconst result = Tag.render`\n\t\t\t<div class=\"store-available-popup-container\">\n\t\t\t\t<table class=\"main-grid-table\">\n\t\t\t\t\t<thead class=\"main-grid-header\">\n\t\t\t\t\t\t<tr class=\"main-grid-row-head\">\n\t\t\t\t\t\t\t${renderHead(Loc.getMessage('CRM_ENTITY_PL_STORE_AVAILABLE_POPUP_QUANTITY_COMMON_MSGVER_1'))}\n\t\t\t\t\t\t\t${renderHead(Loc.getMessage('CRM_ENTITY_PL_STORE_AVAILABLE_POPUP_QUANTITY_RESERVED'))}\n\t\t\t\t\t\t\t${renderHead(Loc.getMessage('CRM_ENTITY_PL_STORE_AVAILABLE_POPUP_QUANTITY_AVAILABLE'))}\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</thead>\n\t\t\t\t\t<tbody>\n\t\t\t\t\t\t<tr class=\"main-grid-row main-grid-row-body\">\n\t\t\t\t\t\t\t${renderRow(storeQuantity)}\n\t\t\t\t\t\t\t${renderRow(reservedQuantityContent)}\n\t\t\t\t\t\t\t${renderRow(viewAvailableQuantity)}\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</tbody>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t`;\n\n\t\tif (isReservedQuantityLink)\n\t\t{\n\t\t\tEvent.bind(\n\t\t\t\tresult.querySelector('.store-available-popup-reserves-slider-link'),\n\t\t\t\t'click',\n\t\t\t\t(e) => {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tthis.openDealsWithReservedProductSlider();\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\topenDealsWithReservedProductSlider()\n\t{\n\t\tconst reservedDealsSliderLink = '/bitrix/components/bitrix/catalog.productcard.reserved.deal.list/slider.php';\n\n\t\tconst storeId = this.#model.getField('STORE_ID');\n\t\tconst productId = this.#model.getField('PRODUCT_ID');\n\n\t\tconst sliderLink = new Uri(reservedDealsSliderLink);\n\t\tsliderLink.setQueryParam('productId', productId);\n\t\tsliderLink.setQueryParam('storeId', storeId);\n\n\t\tBX.SidePanel.Instance.open(sliderLink.toString(), {\n\t\t\tallowChangeHistory: false,\n\t\t\tcacheable: false\n\t\t});\n\t}\n\n\ttogglePopup()\n\t{\n\t\tif (this.#popup)\n\t\t{\n\t\t\tif (this.#popup.isShown())\n\t\t\t{\n\t\t\t\tthis.#popup.close();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#popup.setContent(this.getPopupContent());\n\t\t\t\tthis.#popup.show();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#createPopup();\n\t\t\tthis.#popup.show();\n\t\t}\n\t}\n}\n","export default class MoneyControl\n{\n\tnode: Element;\n\thint: String|null;\n\n\tconstructor(options)\n\t{\n\t\tthis.node = options.node;\n\t\tthis.hint = options.hint;\n\t}\n\n\tenable(): void\n\t{\n\t\tthis.node.removeAttribute('disabled');\n\t\tthis.node.removeAttribute('data-hint-no-icon');\n\t\tthis.node.removeAttribute('data-hint');\n\t\tthis.node.classList.remove('ui-ctl-element');\n\n\t\tconst currencyBlock = this.node.querySelector('.main-grid-editor-money-currency');\n\t\tif (currencyBlock)\n\t\t{\n\t\t\tcurrencyBlock.classList.add('main-dropdown');\n\t\t\tcurrencyBlock.dataset.disabled = false;\n\t\t}\n\n\t\tthis.node.querySelector('.main-grid-editor-money-price')?.removeAttribute('disabled');\n\t}\n\n\tdisable(): void\n\t{\n\t\tthis.node.setAttribute('disabled', '');\n\t\tthis.node.classList.add('ui-ctl-element');\n\t\tthis.node.querySelector('.main-grid-editor-money-price')?.setAttribute('disabled', '');\n\n\t\tconst currencyBlock = this.node.querySelector('.main-grid-editor-money-currency');\n\t\tif (currencyBlock)\n\t\t{\n\t\t\tcurrencyBlock.classList.remove('main-dropdown');\n\t\t\tcurrencyBlock.dataset.disabled = true;\n\t\t}\n\n\t\tif (this.hint)\n\t\t{\n\t\t\tthis.node.setAttribute('data-hint-no-icon', '');\n\t\t\tthis.node.setAttribute('data-hint', this.hint);\n\n\t\t\tBX.UI.Hint.init(this.node.parentNode);\n\t\t}\n\t}\n}\n","import {Cache, Dom, Event, Loc, Reflection, Runtime, Tag, Text, Type} from 'main.core';\nimport {Editor} from './product.list.editor';\nimport {DiscountType, DiscountTypes, FieldScheme, ProductCalculator} from 'catalog.product-calculator';\nimport {CurrencyCore} from 'currency.currency-core';\nimport 'ui.hint';\nimport 'ui.notification';\nimport HintPopup from './hint.popup';\nimport {ProductModel} from \"catalog.product-model\";\nimport {EventEmitter} from \"main.core.events\";\nimport {StoreSelector} from \"catalog.store-selector\";\nimport ReserveControl from \"./reserve.control\";\nimport {PopupMenu} from \"main.popup\";\nimport {ProductSelector} from \"catalog.product-selector\";\nimport StoreAvailablePopup from './store.available.popup';\nimport MoneyControl from './money.control';\n\ntype Action = {\n\ttype: string,\n\tfield?: string,\n\tvalue?: string,\n};\n\ntype Settings = {}\n\nconst MODE_EDIT = 'EDIT';\nconst MODE_SET = 'SET';\n\nconst enableImageInputCache = new Map();\n\nexport class Row\n{\n\tstatic CATALOG_PRICE_CHANGING_DISABLED = 'CATALOG_PRICE_CHANGING_DISABLED';\n\n\tid: ?string;\n\tsettings: Object;\n\teditor: ?Editor;\n\tmodel: ?ProductModel;\n\tmainSelector: ?ProductSelector;\n\treserveControl: ?ReserveControl;\n\tstoreSelector: ?StoreSelector;\n\tstoreAvailablePopup: ?StoreAvailablePopup;\n\tfields: Object = {};\n\texternalActions: Array<Action> = [];\n\n\thandleChangeStoreData = this.#onChangeStoreData.bind(this);\n\thandleProductErrorsChange = Runtime.debounce(this.#onProductErrorsChange, 500, this);\n\thandleMainSelectorClear = Runtime.debounce(this.#onMainSelectorClear.bind(this), 500, this);\n\thandleStoreFieldChange = Runtime.debounce(this.#onStoreFieldChange.bind(this), 500, this);\n\thandleStoreFieldClear = Runtime.debounce(this.#onStoreFieldClear.bind(this), 500, this);\n\n\tcache = new Cache.MemoryCache();\n\tmodeChanges = {\n\t\tEDIT: MODE_EDIT,\n\t\tSET: MODE_SET,\n\t};\n\tonAfterExecuteExternalActions: ?CallableFunction;\n\n\tconstructor(id: string, fields: Object, settings: Settings, editor: Editor): void\n\t{\n\t\tthis.setId(id);\n\t\tthis.setSettings(settings);\n\t\tthis.setEditor(editor);\n\t\tthis.setModel(fields, settings);\n\t\tthis.setFields(fields);\n\t\tthis.#initActions();\n\t\tthis.#initSelector();\n\t\tthis.#initStoreSelector();\n\t\tthis.#initStoreAvailablePopup();\n\t\tthis.#initReservedControl();\n\t\tthis.modifyBasePriceInput();\n\t\tthis.modifyQuantityInput();\n\t\tthis.refreshFieldsLayout();\n\t\tthis.updateUiStoreAmountData();\n\t\tthis.initHandlersForSelectors();\n\t\trequestAnimationFrame(this.initHandlers.bind(this));\n\t}\n\n\tgetNode(): ?HTMLElement\n\t{\n\t\treturn this.cache.remember('node', () => {\n\t\t\tconst rowId = this.getField('ID', 0);\n\n\t\t\treturn this.getEditorContainer().querySelector('[data-id=\"' + rowId + '\"]');\n\t\t});\n\t}\n\n\tgetSelector(): ?ProductSelector\n\t{\n\t\treturn this.mainSelector;\n\t}\n\n\tisNewRow(): Boolean\n\t{\n\t\treturn isNaN(+this.getField('ID'));\n\t}\n\n\tgetId(): string\n\t{\n\t\treturn this.id;\n\t}\n\n\tsetId(id: string): void\n\t{\n\t\tthis.id = id;\n\t}\n\n\tgetSettings(): {}\n\t{\n\t\treturn this.settings;\n\t}\n\n\tsetSettings(settings: Settings): void\n\t{\n\t\tthis.settings = Type.isPlainObject(settings) ? settings : {};\n\t}\n\n\tgetSettingValue(name, defaultValue)\n\t{\n\t\treturn this.settings.hasOwnProperty(name) ? this.settings[name] : defaultValue;\n\t}\n\n\tsetSettingValue(name, value): void\n\t{\n\t\tthis.settings[name] = value;\n\t}\n\n\tsetEditor(editor: Editor): void\n\t{\n\t\tthis.editor = editor;\n\t}\n\n\tgetEditor(): Editor\n\t{\n\t\treturn this.editor;\n\t}\n\n\tgetEditorContainer(): HTMLElement\n\t{\n\t\treturn this.getEditor().getContainer();\n\t}\n\n\tgetHintPopup(): HintPopup\n\t{\n\t\treturn this.getEditor().getHintPopup();\n\t}\n\n\tinitHandlers()\n\t{\n\t\tconst editor = this.getEditor();\n\n\t\tthis.getNode().querySelectorAll('input').forEach((node) => {\n\t\t\tEvent.bind(node, 'input', editor.changeProductFieldHandler);\n\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t// disable drag-n-drop events for text fields\n\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t});\n\t\tthis.getNode().querySelectorAll('select').forEach((node) => {\n\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t// disable drag-n-drop events for select fields\n\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t});\n\t}\n\n\tinitHandlersForSelectors()\n\t{\n\t\tconst editor = this.getEditor();\n\n\t\tconst selectorNames = ['MAIN_INFO', 'STORE_INFO', 'RESERVE_INFO'];\n\n\t\tselectorNames.forEach((name) => {\n\t\t\tthis.getNode().querySelectorAll('[data-name=\"'+ name +'\"] input[type=\"text\"]').forEach(node => {\n\t\t\t\tEvent.bind(node, 'input', editor.changeProductFieldHandler);\n\t\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\n\t\t\t\t// disable drag-n-drop events for select fields\n\t\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\n\t\t\t});\n\t\t});\n\t}\n\n\tunsubscribeCustomEvents()\n\t{\n\t\tif (this.mainSelector)\n\t\t{\n\t\t\tthis.mainSelector.unsubscribeEvents();\n\t\t\tEventEmitter.unsubscribe(\n\t\t\t\tthis.mainSelector,\n\t\t\t\t'onClear',\n\t\t\t\tthis.handleMainSelectorClear\n\t\t\t);\n\t\t}\n\n\t\tif (this.storeSelector)\n\t\t{\n\t\t\tthis.storeSelector.unsubscribeEvents();\n\t\t\tEventEmitter.unsubscribe(\n\t\t\t\tthis.storeSelector,\n\t\t\t\t'onChange',\n\t\t\t\tthis.handleStoreFieldChange\n\t\t\t);\n\n\t\t\tEventEmitter.unsubscribe(\n\t\t\t\tthis.storeSelector,\n\t\t\t\t'onClear',\n\t\t\t\tthis.handleStoreFieldClear\n\t\t\t);\n\t\t}\n\n\t\tEventEmitter.unsubscribe(\n\t\t\tthis.model,\n\t\t\t'onChangeStoreData',\n\t\t\tthis.handleChangeStoreData,\n\t\t);\n\n\t\tEventEmitter.unsubscribe(\n\t\t\tthis.model,\n\t\t\t'onErrorsChange',\n\t\t\tthis.handleProductErrorsChange,\n\t\t);\n\t}\n\n\t#initActions()\n\t{\n\t\tif (this.getEditor().isReadOnly() || this.isRestrictedStoreInfo())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst actionCellContentContainer = this.getNode().querySelector('.main-grid-cell-action .main-grid-cell-content');\n\t\tif (Type.isDomNode(actionCellContentContainer))\n\t\t{\n\t\t\tconst actionsButton = Tag.render`\n\t\t\t\t<a\n\t\t\t\t\thref=\"#\"\n\t\t\t\t\tclass=\"main-grid-row-action-button\"\n\t\t\t\t></a>\n\t\t\t`;\n\n\t\t\tEvent.bind(actionsButton, 'click', (event) => {\n\t\t\t\tconst menuItems = [\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_PL_COPY'),\n\t\t\t\t\t\tonclick: this.handleCopyAction.bind(this),\n\t\t\t\t\t\tdisabled: this.editor.getSettingValue('disabledSelectProductInput'),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_PL_DELETE'),\n\t\t\t\t\t\tonclick: this.handleDeleteAction.bind(this),\n\t\t\t\t\t\tdisabled: this.getModel().isEmpty() && this.getEditor().products.length <= 1,\n\t\t\t\t\t}\n\t\t\t\t];\n\n\t\t\t\tPopupMenu.show({\n\t\t\t\t\tid: this.getId() + '_actions_popup',\n\t\t\t\t\tbindElement: actionsButton,\n\t\t\t\t\titems: menuItems,\n\t\t\t\t\tcacheable: false,\n\t\t\t\t});\n\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopPropagation();\n\t\t\t});\n\n\t\t\tDom.append(actionsButton, actionCellContentContainer);\n\t\t}\n\t}\n\n\tmodifyBasePriceInput(): void\n\t{\n\t\tconst priceNode = this.#getNodeChildByDataName('PRICE');\n\t\tif (!priceNode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst control = new MoneyControl({\n\t\t\tnode: priceNode,\n\t\t\thint: Loc.getMessage('CRM_ENTITY_PL_PRICE_CHANGING_RESTRICTED'),\n\t\t});\n\t\tif (!this.#isEditableCatalogPrice())\n\t\t{\n\t\t\tcontrol.disable();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcontrol.enable();\n\t\t}\n\t}\n\n\tmodifyQuantityInput(): void\n\t{\n\t\tif (!this.isRestrictedStoreInfo())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst countField = this.#getNodeChildByDataName('QUANTITY');\n\t\tif (countField)\n\t\t{\n\t\t\tconst control = new MoneyControl({\n\t\t\t\tnode: countField,\n\t\t\t\thint: Loc.getMessage('CRM_ENTITY_PL_ROW_UPDATE_RESTRICTED_BY_STORE'),\n\t\t\t});\n\t\t\tcontrol.disable();\n\t\t}\n\t}\n\n\t#isEditableCatalogPrice(): boolean\n\t{\n\t\treturn this.editor.canEditCatalogPrice()\n\t\t\t|| !this.getModel().isCatalogExisted()\n\t\t\t|| this.getModel().isNew()\n\t\t;\n\t}\n\n\t#isSaveableCatalogPrice(): boolean\n\t{\n\t\treturn this.getModel().isCatalogExisted() && this.getModel().isNew();\n\t}\n\n\t#initSelector()\n\t{\n\t\tconst id = 'crm_grid_' + this.getId();\n\t\tconst enableImageInput = this.editor.getSettingValue('enableSelectProductImageInput', true);\n\n\t\tthis.mainSelector = ProductSelector.getById(id);\n\t\tif (!this.mainSelector)\n\t\t{\n\t\t\tconst selectorOptions = {\n\t\t\t\tiblockId: this.model.getIblockId(),\n\t\t\t\tbasePriceId: this.model.getBasePriceId(),\n\t\t\t\tcurrency: this.model.getCurrency(),\n\t\t\t\tmodel: this.model,\n\t\t\t\tconfig: {\n\t\t\t\t\tENABLE_SEARCH: true,\n\t\t\t\t\tIS_ALLOWED_CREATION_PRODUCT: true,\n\t\t\t\t\tENABLE_IMAGE_INPUT: enableImageInput,\n\t\t\t\t\tROLLBACK_INPUT_AFTER_CANCEL: true,\n\t\t\t\t\tENABLE_INPUT_DETAIL_LINK: true,\n\t\t\t\t\tROW_ID: this.getId(),\n\t\t\t\t\tENABLE_SKU_SELECTION: true,\n\t\t\t\t\tENABLE_EMPTY_PRODUCT_ERROR: false,\n\t\t\t\t\tSELECTOR_INPUT_DISABLED: this.editor.getSettingValue('disabledSelectProductInput'),\n\t\t\t\t\tURL_BUILDER_CONTEXT: this.editor.getSettingValue('productUrlBuilderContext'),\n\t\t\t\t\tRESTRICTED_PRODUCT_TYPES: this.getEditor().getRestrictedProductTypes(),\n\t\t\t\t},\n\t\t\t\tmode: ProductSelector.MODE_EDIT,\n\t\t\t};\n\n\t\t\tthis.mainSelector = new ProductSelector('crm_grid_' + this.getId(), selectorOptions);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.mainSelector.subscribeEvents();\n\n\t\t\tif (enableImageInput !== enableImageInputCache[id])\n\t\t\t{\n\t\t\t\tthis.mainSelector.setConfig('ENABLE_IMAGE_INPUT', enableImageInput);\n\t\t\t\tif (enableImageInput)\n\t\t\t\t{\n\t\t\t\t\tthis.mainSelector.layoutImage();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tenableImageInputCache[id] = enableImageInput;\n\n\t\tif (this.isRestrictedStoreInfo())\n\t\t{\n\t\t\tthis.mainSelector.setMode(ProductSelector.MODE_VIEW);\n\t\t}\n\n\t\tconst mainInfoNode = this.#getNodeChildByDataName('MAIN_INFO');\n\t\tif (mainInfoNode)\n\t\t{\n\t\t\tconst numberSelector = mainInfoNode.querySelector('.main-grid-row-number');\n\t\t\tif (!Type.isDomNode(numberSelector))\n\t\t\t{\n\t\t\t\tDom.append(Tag.render`<div class=\"main-grid-row-number\"></div>`, mainInfoNode);\n\t\t\t}\n\n\t\t\tlet selectorWrapper =  mainInfoNode.querySelector('.main-grid-row-product-selector');\n\t\t\tif (!Type.isDomNode(selectorWrapper))\n\t\t\t{\n\t\t\t\tselectorWrapper = Tag.render`<div class=\"main-grid-row-product-selector\"></div>`;\n\t\t\t\tDom.append(selectorWrapper, mainInfoNode);\n\t\t\t}\n\n\t\t\tthis.mainSelector.skuTreeInstance = null;\n\t\t\tif (this.editor.isVisible())\n\t\t\t{\n\t\t\t\tthis.mainSelector.renderTo(selectorWrapper);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.mainSelector.wrapper = selectorWrapper;\n\t\t\t}\n\t\t}\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.mainSelector,\n\t\t\t'onClear',\n\t\t\tthis.handleMainSelectorClear\n\t\t);\n\t}\n\n\t#onMainSelectorClear()\n\t{\n\t\tthis.updateField('OFFER_ID', 0);\n\t\tthis.updateField('PRODUCT_NAME', '');\n\t\tthis.updateUiStoreAmountData();\n\t\tthis.updateField('DEDUCTED_QUANTITY', 0);\n\t\tthis.updateField('ROW_RESERVED', 0);\n\t}\n\n\t#initStoreSelector()\n\t{\n\t\tthis.storeSelector = new StoreSelector(\n\t\t\tthis.getId(),\n\t\t\t{\n\t\t\t\tinputFieldId: 'STORE_ID',\n\t\t\t\tinputFieldTitle: 'STORE_TITLE',\n\t\t\t\tconfig: {\n\t\t\t\t\tENABLE_SEARCH: true,\n\t\t\t\t\tENABLE_INPUT_DETAIL_LINK: false,\n\t\t\t\t\tROW_ID: this.getId(),\n\t\t\t\t},\n\t\t\t\tmode: StoreSelector.MODE_EDIT,\n\t\t\t\tmodel: this.model,\n\t\t\t}\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.storeSelector,\n\t\t\t'onChange',\n\t\t\tthis.handleStoreFieldChange\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.storeSelector,\n\t\t\t'onClear',\n\t\t\tthis.handleStoreFieldClear\n\t\t);\n\n\t\tif (this.isRestrictedStoreInfo() && this.storeSelector.searchInput)\n\t\t{\n\t\t\tthis.storeSelector.searchInput.disable(\n\t\t\t\tLoc.getMessage('CRM_ENTITY_PL_ROW_UPDATE_STORE_RESTRICTED_BY_STORE')\n\t\t\t);\n\t\t}\n\n\t\tthis.layoutStoreSelector();\n\t}\n\n\tlayoutStoreSelector()\n\t{\n\t\tconst storeWrapper = this.#getNodeChildByDataName('STORE_INFO');\n\t\tif (this.storeSelector && storeWrapper)\n\t\t{\n\t\t\tstoreWrapper.innerHTML = '';\n\n\t\t\tif (this.#needStoreSelectorInput())\n\t\t\t{\n\t\t\t\tthis.storeSelector.renderTo(storeWrapper);\n\n\t\t\t\tif (this.isReserveBlocked())\n\t\t\t\t{\n\t\t\t\t\tthis.#applyStoreSelectorRestrictionTweaks();\n\t\t\t\t}\n\t\t\t\telse if (!this.isInventoryManagementToolEnabled())\n\t\t\t\t{\n\t\t\t\t\tthis.#applyStoreSelectorToolAvailabilityTweaks();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t#initStoreAvailablePopup()\n\t{\n\t\tconst storeAvaiableNode = this.#getNodeChildByDataName('STORE_AVAILABLE');\n\t\tif (!storeAvaiableNode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.storeAvailablePopup = new StoreAvailablePopup({\n\t\t\trowId: this.id,\n\t\t\tmodel: this.getModel(),\n\t\t\tnode: storeAvaiableNode,\n\t\t\tinventoryManagementMode: this.getInventoryManagementMode(),\n\t\t});\n\t}\n\n\t#applyStoreSelectorRestrictionTweaks()\n\t{\n\t\tconst storeSearchInput = this.storeSelector.searchInput;\n\t\tif (!storeSearchInput || !storeSearchInput.getNameInput())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tstoreSearchInput.toggleIcon(this.storeSelector.searchInput.getSearchIcon(), 'none');\n\t\tstoreSearchInput.getNameInput().disabled = true;\n\t\tDom.addClass(storeSearchInput.getNameInput(), 'crm-entity-product-list-locked-field');\n\t\tif (this.storeSelector.getWrapper())\n\t\t{\n\t\t\tDom.addClass(this.storeSelector.getWrapper(), 'crm-entity-product-list-locked-field-wrapper');\n\t\t\tEvent.bind(this.storeSelector.getWrapper(), 'click', () => {\n\t\t\t\tthis.editor.openIntegrationLimitSlider();\n\t\t\t});\n\t\t}\n\t}\n\n\t#applyStoreSelectorToolAvailabilityTweaks()\n\t{\n\t\tconst storeSearchInput = this.storeSelector.searchInput;\n\t\tif (!storeSearchInput || !storeSearchInput.getNameInput())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tstoreSearchInput.toggleIcon(this.storeSelector.searchInput.getSearchIcon(), 'none');\n\t\tstoreSearchInput.getNameInput().disabled = true;\n\t\tDom.addClass(storeSearchInput.getNameInput(), 'crm-entity-product-list-locked-field');\n\t\tif (this.storeSelector.getWrapper())\n\t\t{\n\t\t\tDom.addClass(this.storeSelector.getWrapper(), 'crm-entity-product-list-locked-field-wrapper');\n\t\t\tEvent.bind(this.storeSelector.getWrapper(), 'click', () => {\n\t\t\t\tthis.editor.openInventoryManagementToolDisabledSlider();\n\t\t\t});\n\t\t}\n\t}\n\n\t#initReservedControl()\n\t{\n\t\tconst storeWrapper = this.#getNodeChildByDataName('RESERVE_INFO');\n\t\tif (storeWrapper && this.#getAllowedStores().length)\n\t\t{\n\t\t\tthis.reserveControl = new ReserveControl({\n\t\t\t\trow: this,\n\t\t\t\tisReserveEqualProductQuantity: this.#isReserveEqualProductQuantity(),\n\t\t\t\tdefaultDateReservation: this.editor.getSettingValue('defaultDateReservation'),\n\t\t\t\tisInventoryManagementToolEnabled: this.isInventoryManagementToolEnabled(),\n\t\t\t\tinventoryManagementMode: this.getInventoryManagementMode(),\n\t\t\t\tisBlocked: this.isReserveBlocked(),\n\t\t\t\tmeasureName: this.getMeasureName(),\n\t\t\t});\n\n\t\t\tEventEmitter.subscribe(\n\t\t\t\tthis.reserveControl,\n\t\t\t\t'onNodeClick',\n\t\t\t\t() => {\n\t\t\t\t\tif (this.isReserveBlocked())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.editor.openIntegrationLimitSlider();\n\t\t\t\t\t}\n\t\t\t\t\telse if (!this.isInventoryManagementToolEnabled())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.editor.openInventoryManagementToolDisabledSlider();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tif (this.isRestrictedStoreInfo())\n\t\t\t{\n\t\t\t\tthis.reserveControl.disable();\n\t\t\t}\n\n\t\t\tthis.layoutReserveControl();\n\t\t}\n\n\t\tconst quantityInput = this.getNode().querySelector('div[data-name=\"QUANTITY\"] input');\n\t\tif (quantityInput)\n\t\t{\n\t\t\tEvent.bind(\n\t\t\t\tquantityInput,\n\t\t\t\t'change',\n\t\t\t\t(event) => {\n\t\t\t\t\tconst isReserveEqualProductQuantity =\n\t\t\t\t\t\tthis.#isReserveEqualProductQuantity()\n\t\t\t\t\t\t&& this.reserveControl?.isReserveEqualProductQuantity\n\t\t\t\t\t;\n\t\t\t\t\tif (isReserveEqualProductQuantity)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setReserveQuantity(this.getField('QUANTITY'));\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst value = Text.toNumber(event.target.value);\n\t\t\t\t\tconst errorNotifyId = 'quantityReservedCountError';\n\t\t\t\t\tlet notify = BX.UI.Notification.Center.getBalloonById(errorNotifyId);\n\t\t\t\t\tif (value < this.getField('INPUT_RESERVE_QUANTITY'))\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!notify)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst notificationOptions = {\n\t\t\t\t\t\t\t\tid: errorNotifyId,\n\t\t\t\t\t\t\t\tcloseButton: true,\n\t\t\t\t\t\t\t\tautoHideDelay: 3000,\n\t\t\t\t\t\t\t\tcontent: Tag.render`<div>${Loc.getMessage('CRM_ENTITY_PL_IS_LESS_QUANTITY_THEN_RESERVED')}</div>`,\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tnotify = BX.UI.Notification.Center.notify(notificationOptions);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.setReserveQuantity(this.getField('QUANTITY'));\n\t\t\t\t\t\tnotify.show();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n\n\t#onStoreFieldChange(event)\n\t{\n\t\tconst data = event.getData();\n\t\tdata.fields.forEach((item) => {\n\t\t\tthis.updateField(item.NAME, item.VALUE);\n\t\t});\n\n\t\tthis.initHandlersForSelectors();\n\t}\n\n\t#onStoreFieldClear()\n\t{\n\t\tthis.initHandlersForSelectors();\n\t}\n\n\tlayoutReserveControl()\n\t{\n\t\tconst storeWrapper = this.#getNodeChildByDataName('RESERVE_INFO');\n\t\tif (storeWrapper && this.reserveControl)\n\t\t{\n\t\t\tstoreWrapper.innerHTML = '';\n\t\t\tthis.reserveControl.clearCache();\n\n\t\t\tif (this.#needReserveControlInput())\n\t\t\t{\n\t\t\t\tif (this.isRestrictedStoreInfo())\n\t\t\t\t{\n\t\t\t\t\tstoreWrapper.innerHTML = this.reserveControl.getReservedQuantity() + ' ' + Text.encode(this.getMeasureName());\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.reserveControl.renderTo(storeWrapper);\n\t\t\t}\n\t\t}\n\t}\n\n\tclearReserveControl()\n\t{\n\t\tconst storeWrapper = this.#getNodeChildByDataName('RESERVE_INFO');\n\t\tif (storeWrapper && this.reserveControl)\n\t\t{\n\t\t\tstoreWrapper.innerHTML = '';\n\t\t\tthis.reserveControl.clearCache();\n\t\t}\n\t}\n\n\tsetRowNumber(number)\n\t{\n\t\tthis.getNode().querySelectorAll('.main-grid-row-number').forEach(node => {\n\t\t\tnode.textContent = number + '.';\n\t\t});\n\t}\n\n\tgetFields(fields: Array = [])\n\t{\n\t\tlet result;\n\n\t\tif (!Type.isArrayFilled(fields))\n\t\t{\n\t\t\tresult = Runtime.clone(this.fields);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = {};\n\n\t\t\tfor (const fieldName of fields)\n\t\t\t{\n\t\t\t\tresult[fieldName] = this.getField(fieldName);\n\t\t\t}\n\t\t}\n\n\t\tif ('PRODUCT_NAME' in result)\n\t\t{\n\t\t\tconst fixedProductName = this.getField('FIXED_PRODUCT_NAME', '');\n\n\t\t\tif (Type.isStringFilled(fixedProductName))\n\t\t\t{\n\t\t\t\tresult['PRODUCT_NAME'] = fixedProductName;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetCatalogFields(): Object\n\t{\n\t\tconst fields = this.getFields(['CURRENCY', 'QUANTITY', 'MEASURE_CODE']);\n\n\t\tfields['PRICE'] = this.getBasePrice();\n\t\tfields['VAT_INCLUDED'] = this.getTaxIncluded();\n\t\tfields['VAT_ID'] = this.getTaxId();\n\n\t\treturn fields;\n\t}\n\n\tgetCalculateFields(): FieldScheme\n\t{\n\t\treturn {\n\t\t\t'PRICE': this.getPrice(),\n\t\t\t'BASE_PRICE': this.getBasePrice(),\n\t\t\t'PRICE_EXCLUSIVE': this.getPriceExclusive(),\n\t\t\t'PRICE_NETTO': this.getPriceNetto(),\n\t\t\t'PRICE_BRUTTO': this.getPriceBrutto(),\n\t\t\t'QUANTITY': this.getQuantity(),\n\t\t\t'DISCOUNT_TYPE_ID': this.getDiscountType(),\n\t\t\t'DISCOUNT_RATE': this.getDiscountRate(),\n\t\t\t'DISCOUNT_SUM': this.getDiscountSum(),\n\t\t\t'DISCOUNT_ROW': this.getDiscountRow(),\n\t\t\t'TAX_INCLUDED': this.getTaxIncluded(),\n\t\t\t'TAX_RATE': this.getTaxRate()\n\t\t};\n\t}\n\n\tsetFields(fields: Object): void\n\t{\n\t\tfor (const name in fields)\n\t\t{\n\t\t\tif (fields.hasOwnProperty(name))\n\t\t\t{\n\t\t\t\tthis.setField(name, fields[name]);\n\t\t\t\tthis.getModel().setField(name, fields[name]);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetField(name: string, defaultValue)\n\t{\n\t\treturn this.fields.hasOwnProperty(name) ? this.fields[name] : defaultValue;\n\t}\n\n\tsetField(name: string, value, changeModel: boolean = true): void\n\t{\n\t\tthis.fields[name] = value;\n\n\t\tif (changeModel)\n\t\t{\n\t\t\tthis.getModel().setField(name, value);\n\t\t}\n\t}\n\n\tgetUiFieldId(field): string\n\t{\n\t\treturn this.getId() + '_' + field;\n\t}\n\n\tgetBasePrice(): number\n\t{\n\t\treturn this.getField('BASE_PRICE', 0);\n\t}\n\n\tisPriceNetto(): boolean\n\t{\n\t\treturn this.getEditor().isTaxAllowed() && !this.isTaxIncluded();\n\t}\n\n\tgetPrice(): number\n\t{\n\t\treturn this.getField('PRICE', 0);\n\t}\n\n\tgetPriceExclusive(): number\n\t{\n\t\treturn this.getField('PRICE_EXCLUSIVE', 0);\n\t}\n\n\tgetPriceNetto(): number\n\t{\n\t\treturn this.getField('PRICE_NETTO', 0);\n\t}\n\n\tgetPriceBrutto(): number\n\t{\n\t\treturn this.getField('PRICE_BRUTTO', 0);\n\t}\n\n\tgetQuantity(): number\n\t{\n\t\treturn this.getField('QUANTITY', 1);\n\t}\n\n\tgetDiscountType(): DiscountTypes\n\t{\n\t\treturn this.getField('DISCOUNT_TYPE_ID', DiscountType.UNDEFINED);\n\t}\n\n\tisDiscountUndefined(): boolean\n\t{\n\t\treturn this.getDiscountType() === DiscountType.UNDEFINED;\n\t}\n\n\tisDiscountPercentage(): boolean\n\t{\n\t\treturn this.getDiscountType() === DiscountType.PERCENTAGE;\n\t}\n\n\tisDiscountMonetary(): boolean\n\t{\n\t\treturn this.getDiscountType() === DiscountType.MONETARY;\n\t}\n\n\tisDiscountHandmade(): boolean\n\t{\n\t\treturn this.isDiscountPercentage() || this.isDiscountMonetary();\n\t}\n\n\tgetDiscountRate(): number\n\t{\n\t\treturn this.getField('DISCOUNT_RATE', 0);\n\t}\n\n\tgetDiscountSum(): number\n\t{\n\t\treturn this.getField('DISCOUNT_SUM', 0);\n\t}\n\n\tgetDiscountRow(): number\n\t{\n\t\treturn this.getField('DISCOUNT_ROW', 0);\n\t}\n\n\tisEmptyDiscount(): boolean\n\t{\n\t\tif (this.isDiscountPercentage())\n\t\t{\n\t\t\treturn this.getDiscountRate() === 0;\n\t\t}\n\t\telse if (this.isDiscountMonetary())\n\t\t{\n\t\t\treturn this.getDiscountSum() === 0;\n\t\t}\n\t\telse if (this.isDiscountUndefined())\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tisEmptyRow(): boolean\n\t{\n\t\treturn (\n\t\t\t!Type.isStringFilled(this.getField('NAME', '').trim())\n\t\t\t&& this.model.isEmpty()\n\t\t\t&& this.getBasePrice() <= 0\n\t\t)\n\t}\n\n\tgetTaxIncluded(): 'Y' | 'N'\n\t{\n\t\treturn this.getField('TAX_INCLUDED', 'N');\n\t}\n\n\tisTaxIncluded(): boolean\n\t{\n\t\treturn this.getTaxIncluded() === 'Y';\n\t}\n\n\tgetTaxRate(): number\n\t{\n\t\treturn this.getField('TAX_RATE', 0);\n\t}\n\n\tgetTaxSum(): number\n\t{\n\t\treturn this.isTaxIncluded()\n\t\t\t? this.getPrice() * this.getQuantity() * (1 - 1 / (1 + this.getTaxRate() / 100))\n\t\t\t: this.getPriceExclusive() * this.getQuantity() * this.getTaxRate() / 100;\n\t}\n\n\tgetTaxNode(): ?HTMLSelectElement\n\t{\n\t\treturn this.getNode().querySelector('select[data-field-code=\"TAX_RATE\"]');\n\t}\n\n\tgetTaxId(): number\n\t{\n\t\tconst taxNode = this.getTaxNode();\n\n\t\tif (Type.isDomNode(taxNode) && taxNode.options[taxNode.selectedIndex])\n\t\t{\n\t\t\treturn Text.toNumber(taxNode.options[taxNode.selectedIndex].getAttribute('data-tax-id'));\n\t\t}\n\n\t\treturn 0;\n\t}\n\n\tupdateFieldByEvent(fieldCode: string, event: UIEvent): void\n\t{\n\t\tconst target = event.target;\n\t\tconst value = target.type === 'checkbox' ? target.checked : target.value;\n\t\tconst mode = (event.type === 'input' || event.type === 'change') ? MODE_EDIT : MODE_SET;\n\n\t\tthis.updateField(fieldCode, value, mode);\n\t}\n\n\tupdateField(fieldCode: string, value, mode = MODE_SET): void\n\t{\n\t\tthis.resetExternalActions();\n\t\tthis.updateFieldValue(fieldCode, value, mode);\n\t\tthis.executeExternalActions();\n\t}\n\n\tupdateFieldValue(code: string, value, mode = MODE_SET): void\n\t{\n\t\tswitch (code)\n\t\t{\n\t\t\tcase 'ID':\n\t\t\tcase 'OFFER_ID':\n\t\t\t\tthis.changeProductId(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'QUANTITY':\n\t\t\t\tthis.changeQuantity(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'MEASURE_CODE':\n\t\t\t\tthis.changeMeasureCode(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT':\n\t\t\tcase 'DISCOUNT_PRICE':\n\t\t\t\tthis.changeDiscount(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_TYPE_ID':\n\t\t\t\tthis.changeDiscountType(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_ROW':\n\t\t\t\tthis.changeRowDiscount(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'VAT_ID':\n\t\t\tcase 'TAX_ID':\n\t\t\t\tthis.changeTaxId(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'TAX_RATE':\n\t\t\t\tthis.changeTaxRate(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'VAT_INCLUDED':\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\t\tthis.changeTaxIncluded(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'SUM':\n\t\t\t\tthis.changeRowSum(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'NAME':\n\t\t\tcase 'PRODUCT_NAME':\n\t\t\tcase 'MAIN_INFO':\n\t\t\t\tthis.changeProductName(value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'SORT':\n\t\t\t\tthis.changeSort(value, mode);\n\t\t\t\tbreak;\n\n\t\t\tcase 'STORE_ID':\n\t\t\t\tthis.changeStore(value);\n\t\t\t\tbreak;\n\t\t\tcase 'STORE_TITLE':\n\t\t\t\tthis.changeStoreName(value);\n\t\t\t\tbreak;\n\t\t\tcase 'INPUT_RESERVE_QUANTITY':\n\t\t\t\tthis.changeReserveQuantity(value);\n\t\t\t\tbreak;\n\t\t\tcase 'DATE_RESERVE_END':\n\t\t\t\tthis.changeDateReserveEnd(value);\n\t\t\t\tbreak;\n\t\t\tcase 'PRICE':\n\t\t\tcase 'BASE_PRICE':\n\t\t\t\tthis.changeBasePrice(value, mode);\n\t\t\t\tbreak;\n\t\t\tcase 'DEDUCTED_QUANTITY':\n\t\t\t\tthis.setDeductedQuantity(value);\n\t\t\t\tbreak;\n\t\t\tcase 'ROW_RESERVED':\n\t\t\t\tthis.setRowReserved(value);\n\t\t\t\tbreak;\n\t\t\tcase 'TYPE':\n\t\t\t\tthis.setType(value);\n\t\t\t\tbreak;\n\t\t\tcase 'SKU_TREE':\n\t\t\tcase 'DETAIL_URL':\n\t\t\tcase 'IMAGE_INFO':\n\t\t\tcase 'COMMON_STORE_AMOUNT':\n\t\t\t\tthis.setField(code, value);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tupdateFieldByName(field, value)\n\t{\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\t\tthis.setTaxIncluded(value);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\thandleCopyAction(event, menuItem)\n\t{\n\t\tthis.getEditor()?.copyRow(this);\n\t\tconst menu = menuItem.getMenuWindow();\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.destroy();\n\t\t}\n\t}\n\n\thandleDeleteAction(event, menuItem)\n\t{\n\t\tthis.getEditor()?.deleteRow(this.getField('ID'));\n\t\tconst menu = menuItem.getMenuWindow();\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.destroy();\n\t\t}\n\t}\n\n\tchangeProductId(value)\n\t{\n\t\tconst preparedValue = this.parseInt(value);\n\n\t\tthis.setProductId(preparedValue);\n\t}\n\n\tchangeQuantity(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getQuantityPrecision());\n\t\tthis.setQuantity(preparedValue, mode);\n\t}\n\n\tchangeMeasureCode(value: string, mode = MODE_SET): void\n\t{\n\t\tthis\n\t\t\t.getEditor()\n\t\t\t.getMeasures()\n\t\t\t.filter((item) => item.CODE === value)\n\t\t\t.forEach((item) => this.setMeasure(item, mode))\n\t\t;\n\t}\n\n\tchangeDiscount(value, mode = MODE_SET)\n\t{\n\t\tlet preparedValue;\n\n\t\tif (this.isDiscountPercentage())\n\t\t{\n\t\t\tpreparedValue = this.parseFloat(value, this.getCommonPrecision());\n\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpreparedValue = this\n\t\t\t\t.parseFloat(value, this.getPricePrecision())\n\t\t\t\t.toFixed(this.getPricePrecision())\n\t\t\t;\n\t\t}\n\n\t\tthis.setDiscount(preparedValue, mode);\n\t}\n\n\tchangeDiscountType(value)\n\t{\n\t\tconst preparedValue = this.parseInt(value, DiscountType.UNDEFINED);\n\n\t\tthis.setDiscountType(preparedValue);\n\t}\n\n\tchangeRowDiscount(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\n\n\t\tthis.setRowDiscount(preparedValue, mode);\n\t}\n\n\tchangeTaxId(value: number): void\n\t{\n\t\tconst taxList = this.getEditor().getTaxList();\n\t\tif (Type.isArrayFilled(taxList))\n\t\t{\n\t\t\tlet taxRate = taxList.find((item) => parseInt(item.ID) === parseInt(value));\n\t\t\tif (!taxRate)\n\t\t\t{\n\t\t\t\ttaxRate = taxList.find((item) => Type.isNil(item.VALUE));\n\t\t\t}\n\n\t\t\tif (taxRate)\n\t\t\t{\n\t\t\t\tthis.changeTaxRate(taxRate.VALUE);\n\t\t\t}\n\t\t}\n\t}\n\n\tchangeTaxRate(value: number | null): void\n\t{\n\t\tconst preparedValue =\n\t\t\tType.isNil(value) || value === ''\n\t\t\t\t? null\n\t\t\t\t: this.parseFloat(value, this.getCommonPrecision())\n\t\t;\n\n\t\tthis.setTaxRate(preparedValue);\n\t}\n\n\tchangeTaxIncluded(value)\n\t{\n\t\tif (Type.isBoolean(value))\n\t\t{\n\t\t\tvalue = value ? 'Y' : 'N';\n\t\t}\n\n\t\tthis.setTaxIncluded(value);\n\t}\n\n\tchangeRowSum(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\n\n\t\tthis.setRowSum(preparedValue, mode);\n\t}\n\n\tchangeProductName(value)\n\t{\n\t\tconst preparedValue = value.toString();\n\t\tconst isChangedValue = this.getField('PRODUCT_NAME') !== preparedValue;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.setField('PRODUCT_NAME', preparedValue);\n\t\t\tthis.setField('NAME', preparedValue);\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\tchangeSort(value, mode = MODE_SET)\n\t{\n\t\tconst preparedValue = this.parseInt(value);\n\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.setField('SORT', preparedValue);\n\t\t}\n\n\t\tconst isChangedValue = this.getField('SORT') !== preparedValue;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.addActionProductChange();\n\t\t}\n\t}\n\n\tchangeStore(value: number): void\n\t{\n\t\tif (this.isReserveBlocked())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst preparedValue = Text.toNumber(value);\n\t\tif (this.getField('STORE_ID') === preparedValue)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setField('STORE_ID', preparedValue);\n\t\tthis.setField('STORE_AVAILABLE', this.model.getStoreCollection().getStoreAvailableAmount(value));\n\n\t\tthis.updateUiStoreAmountData();\n\t\tthis.layoutReserveControl();\n\t\tthis.addActionProductChange();\n\t\tthis.initHandlersForSelectors();\n\t}\n\n\t#onChangeStoreData()\n\t{\n\t\tlet storeId = this.getField('STORE_ID');\n\n\t\tif (!this.isReserveBlocked() && this.isNewRow() && this.storeSelector)\n\t\t{\n\t\t\tconst currentAmount = this.getModel().getStoreCollection().getStoreAmount(storeId);\n\t\t\tif (currentAmount <= 0 && this.getModel().isChanged())\n\t\t\t{\n\t\t\t\tconst maxStore = this.getModel().getStoreCollection().getMaxFilledStore();\n\t\t\t\tif (maxStore.AMOUNT > currentAmount)\n\t\t\t\t{\n\t\t\t\t\tthis.storeSelector.onStoreSelect(maxStore.STORE_ID, Text.decode(maxStore.STORE_TITLE));\n\t\t\t\t}\n\t\t\t\telse if (Type.isNil(storeId))\n\t\t\t\t{\n\t\t\t\t\tstoreId = +this.storeSelector.getStoreId();\n\t\t\t\t\tif (storeId > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.changeStore(storeId);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.setField('STORE_AVAILABLE', this.model.getStoreCollection().getStoreAvailableAmount(storeId));\n\n\t\tthis.updateUiStoreAmountData();\n\t}\n\n\tupdateUiStoreAmountData()\n\t{\n\t\tconst availableWrapper = this.#getNodeChildByDataName('STORE_AVAILABLE');\n\t\tif (!Type.isDomNode(availableWrapper))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst storeId = this.getField('STORE_ID');\n\t\tif (!storeId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst available = this.model.getStoreCollection().getStoreAvailableAmount(storeId);\n\t\tconst amount = Text.toNumber(available)\n\n\t\tlet amountWithMeasure = '';\n\n\t\tif (!this.getModel().isCatalogExisted() || this.isRestrictedStoreInfo() || this.getModel().isService())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tamountWithMeasure = amount + ' ' + this.getMeasureName();\n\t\tavailableWrapper.innerHTML =\n\t\t\tamount > 0\n\t\t\t\t? amountWithMeasure\n\t\t\t\t: `<span class=\"store-available-popup-link--danger\">${amountWithMeasure}</span>`\n\t\t;\n\t}\n\n\tupdatePropertyFields()\n\t{\n\t\tconst productProps = this.model.getField('PRODUCT_PROPERTIES');\n\n\t\tfor (const property in productProps)\n\t\t{\n\t\t\tconst availableWrapper = this.#getNodeChildByDataName(property);\n\t\t\tif (availableWrapper)\n\t\t\t{\n\t\t\t\tconst value = this.model.getField('PRODUCT_PROPERTIES')[property] ?? '';\n\t\t\t\tavailableWrapper.innerHTML = value;\n\t\t\t}\n\t\t}\n\t}\n\n\tclearPropertyFields()\n\t{\n\t\tconst propNodes = this.#getNodesChild();\n\t\tpropNodes.forEach((property) => {\n\t\t\tproperty.innerHTML = '';\n\t\t})\n\t}\n\n\tsetRowReserved(value)\n\t{\n\t\tthis.setField('ROW_RESERVED', value)\n\t\tconst reserveWrapper = this.#getNodeChildByDataName('ROW_RESERVED');\n\t\tif (!Type.isDomNode(reserveWrapper))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.getModel().isCatalogExisted() || this.getModel().isService())\n\t\t{\n\t\t\treserveWrapper.innerHTML = '';\n\t\t\treturn;\n\t\t}\n\n\t\treserveWrapper.innerHTML = Text.toNumber(this.getField('ROW_RESERVED')) + ' ' + this.getMeasureName();\n\t}\n\n\tsetDeductedQuantity(value)\n\t{\n\t\tthis.setField('DEDUCTED_QUANTITY', value);\n\t\tconst deductedWrapper = this.#getNodeChildByDataName('DEDUCTED_QUANTITY');\n\t\tif (!Type.isDomNode(deductedWrapper))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.getModel().isCatalogExisted() || this.getModel().isService())\n\t\t{\n\t\t\tdeductedWrapper.innerHTML = '';\n\t\t\treturn;\n\t\t}\n\n\t\tdeductedWrapper.innerHTML = Text.toNumber(this.getField('DEDUCTED_QUANTITY')) + ' ' + this.getMeasureName();\n\t}\n\n\tchangeStoreName(value: number)\n\t{\n\t\tconst preparedValue = value.toString();\n\t\tthis.setField('STORE_TITLE', preparedValue);\n\t\tthis.addActionProductChange();\n\t}\n\n\tchangeDateReserveEnd(value: string)\n\t{\n\t\tconst preparedValue = Type.isNil(value) ? '' : value.toString();\n\t\tthis.setField('DATE_RESERVE_END', preparedValue);\n\t\tthis.addActionProductChange();\n\t}\n\n\tchangeReserveQuantity(value: number)\n\t{\n\t\tconst preparedValue = Text.toNumber(value);\n\t\tconst reserveDifference = preparedValue - this.getField('INPUT_RESERVE_QUANTITY');\n\n\t\tif (reserveDifference === 0 || isNaN(reserveDifference))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst newReserve = this.getField('ROW_RESERVED') + reserveDifference;\n\n\t\tthis.setField('ROW_RESERVED', newReserve);\n\t\tthis.setField('RESERVE_QUANTITY', Math.max(newReserve, 0));\n\t\tthis.setField('INPUT_RESERVE_QUANTITY', preparedValue);\n\n\t\tthis.addActionProductChange();\n\t}\n\n\tresetReserveFields()\n\t{\n\t\tthis.setField('ROW_RESERVED', null);\n\t\tthis.setField('RESERVE_QUANTITY', null);\n\t\tthis.setField('INPUT_RESERVE_QUANTITY', null);\n\t}\n\n\trefreshFieldsLayout(exceptFields: Array<string> = []): void\n\t{\n\t\tfor (const field in this.fields)\n\t\t{\n\t\t\tif (this.fields.hasOwnProperty(field) && !exceptFields.includes(field))\n\t\t\t{\n\t\t\t\tthis.updateUiField(field, this.fields[field]);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetCalculator(): ProductCalculator\n\t{\n\t\treturn this.getModel()\n\t\t\t.getCalculator()\n\t\t\t.setFields(this.getCalculateFields())\n\t\t\t.setSettings(this.getEditor().getSettings())\n\t\t;\n\t}\n\n\tsetModel(fields: {} = {}, settings: Settings = {}): void\n\t{\n\t\tconst selectorId = settings.selectorId;\n\t\tif (selectorId)\n\t\t{\n\t\t\tconst model = ProductModel.getById(selectorId);\n\t\t\tif (model)\n\t\t\t{\n\t\t\t\tthis.model = model;\n\t\t\t}\n\t\t}\n\n\t\tif (!this.model)\n\t\t{\n\t\t\tthis.model = new ProductModel({\n\t\t\t\tid: selectorId,\n\t\t\t\tcurrency: this.getEditor().getCurrencyId(),\n\t\t\t\tiblockId: fields['IBLOCK_ID'],\n\t\t\t\tbasePriceId: fields['BASE_PRICE_ID'],\n\t\t\t\tisSimpleModel: Text.toInteger(fields['PRODUCT_ID']) <= 0 && Type.isStringFilled(fields['NAME']),\n\t\t\t\tskuTree: Type.isStringFilled(fields['SKU_TREE']) ? JSON.parse(fields['SKU_TREE']) : null,\n\t\t\t\tstoreMap: fields['STORE_MAP'] ?? {},\n\t\t\t\tfields,\n\t\t\t});\n\n\t\t\tif (!Type.isNil(fields['DETAIL_URL']))\n\t\t\t{\n\t\t\t\tthis.model.setDetailPath(fields['DETAIL_URL']);\n\t\t\t}\n\t\t}\n\n\t\t// fill after change setting show pictures.\n\t\tconst imageInfo = Type.isStringFilled(fields['IMAGE_INFO']) ? JSON.parse(fields['IMAGE_INFO']) : null\n\t\tif (Type.isObject(imageInfo))\n\t\t{\n\t\t\tthis.model.getImageCollection().setPreview(imageInfo['preview']);\n\t\t\tthis.model.getImageCollection().setEditInput(imageInfo['input']);\n\t\t\tthis.model.getImageCollection().setMorePhotoValues(imageInfo['values']);\n\t\t}\n\n\t\tif (this.#isReserveEqualProductQuantity())\n\t\t{\n\t\t\tif (!this.getModel().getField('DATE_RESERVE_END'))\n\t\t\t{\n\t\t\t\tthis.setField('DATE_RESERVE_END', this.editor.getSettingValue('defaultDateReservation'));\n\t\t\t}\n\t\t}\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.model,\n\t\t\t'onErrorsChange',\n\t\t\tthis.handleProductErrorsChange,\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\tthis.model,\n\t\t\t'onChangeStoreData',\n\t\t\tthis.handleChangeStoreData,\n\t\t);\n\t}\n\n\tgetModel(): ?ProductModel\n\t{\n\t\treturn this.model;\n\t}\n\n\t#onProductErrorsChange()\n\t{\n\t\tthis.getEditor().handleProductErrorsChange();\n\t}\n\n\tsetProductId(value)\n\t{\n\t\tconst isChangedValue = this.getField('PRODUCT_ID') !== value;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tthis.getModel().setOption('isSimpleModel', value <= 0 && Type.isStringFilled(this.getField('NAME')));\n\t\t\tthis.setField('PRODUCT_ID', value, false);\n\t\t\tthis.setField('OFFER_ID', value, false);\n\t\t\tthis.storeSelector?.setProductId(value);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\n\t\t\tif (\n\t\t\t\tthis.reserveControl\n\t\t\t\t&& this.#isReserveEqualProductQuantity()\n\t\t\t\t&& this.#needReserveControlInput()\n\t\t\t)\n\t\t\t{\n\t\t\t\tif (!this.getModel().getField('DATE_RESERVE_END'))\n\t\t\t\t{\n\t\t\t\t\tthis.setField('DATE_RESERVE_END', this.editor.getSettingValue('defaultDateReservation'));\n\t\t\t\t}\n\n\t\t\t\tthis.resetReserveFields();\n\n\t\t\t\tthis.onAfterExecuteExternalActions = () => {\n\n\t\t\t\t\tthis.reserveControl.changeInputValue(this.getField('QUANTITY'));\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n\n\tchangeBasePrice(value, mode = MODE_SET)\n\t{\n\t\tif (mode === MODE_EDIT && !this.#isEditableCatalogPrice())\n\t\t{\n\t\t\tvalue = this.getField('BASE_PRICE');\n\t\t\tthis.updateUiInputField('PRICE', value.toFixed(this.getPricePrecision()));\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst originalPrice = value;\n\t\t// price can't be less than zero\n\t\tvalue = Math.max(value, 0);\n\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiInputField('PRICE', value.toFixed(this.getPricePrecision()));\n\t\t}\n\n\t\tconst isChangedValue = this.getBasePrice() !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateBasePrice(value);\n\t\t\tthis.setFields(calculatedFields);\n\n\t\t\tconst exceptFieldNames = (mode === MODE_EDIT) ? ['BASE_PRICE', 'PRICE'] : [];\n\t\t\tthis.refreshFieldsLayout(exceptFieldNames);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\n\t\tthis.#togglePriceHintPopup(originalPrice < 0 && originalPrice !== value);\n\t}\n\n\t#shouldShowSmallPriceHint(): boolean\n\t{\n\t\treturn (\n\t\t\tText.toNumber(this.getField('PRICE')) > 0\n\t\t\t&& Text.toNumber(this.getField('PRICE')) < 1\n\t\t\t&& this.isDiscountPercentage()\n\t\t\t&& (\n\t\t\t\tText.toNumber(this.getField('DISCOUNT_SUM')) > 0\n\t\t\t\t|| Text.toNumber(this.getField('DISCOUNT_RATE')) > 0\n\t\t\t\t|| Text.toNumber(this.getField('DISCOUNT_ROW')) > 0\n\t\t\t)\n\t\t);\n\t}\n\n\t#togglePriceHintPopup(showNegative: boolean = false): void\n\t{\n\t\tif (this.#shouldShowSmallPriceHint())\n\t\t{\n\t\t\tthis.getHintPopup()\n\t\t\t\t.load(\n\t\t\t\t\tthis.getInputByFieldName('PRICE'),\n\t\t\t\t\tLoc.getMessage('CRM_ENTITY_PL_SMALL_PRICE_NOTICE')\n\t\t\t\t)\n\t\t\t\t.show()\n\t\t\t;\n\t\t}\n\t\telse if (showNegative)\n\t\t{\n\t\t\tthis.getHintPopup()\n\t\t\t\t.load(\n\t\t\t\t\tthis.getInputByFieldName('PRICE'),\n\t\t\t\t\tLoc.getMessage('CRM_ENTITY_PL_NEGATIVE_PRICE_NOTICE')\n\t\t\t\t)\n\t\t\t\t.show()\n\t\t\t;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getHintPopup().close();\n\t\t}\n\t}\n\n\tsetQuantity(value, mode = MODE_SET)\n\t{\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiInputField('QUANTITY', value);\n\t\t}\n\n\t\tconst isChangedValue = this.getField('QUANTITY') !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst errorNotifyId = 'quantityReservedCountError';\n\t\t\tconst notify = BX.UI.Notification.Center.getBalloonById(errorNotifyId);\n\t\t\tif (notify)\n\t\t\t{\n\t\t\t\tnotify.close();\n\t\t\t}\n\n\t\t\tconst calculatedFields = this.getCalculator().calculateQuantity(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tthis.refreshFieldsLayout(['QUANTITY']);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetReserveQuantity(value)\n\t{\n\t\tconst node = this.#getNodeChildByDataName('RESERVE_INFO');\n\t\tconst input = node?.querySelector('input[name=\"INPUT_RESERVE_QUANTITY\"]');\n\t\tif (Type.isElementNode(input))\n\t\t{\n\t\t\tinput.value = value;\n\n\t\t\tconst view = node?.querySelector('span[data-name=\"VIEW_RESERVE_QUANTITY\"]');\n\t\t\tif (view)\n\t\t\t{\n\t\t\t\tview.textContent = value;\n\t\t\t}\n\n\t\t\tthis.reserveControl?.changeInputValue(value);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.changeReserveQuantity(value)\n\t\t}\n\t}\n\n\tsetMeasure(measure, mode = MODE_SET)\n\t{\n\t\tthis.setField('MEASURE_CODE', measure.CODE);\n\t\tthis.setField('MEASURE_NAME', measure.SYMBOL);\n\n\t\tthis.updateUiMoneyField('MEASURE_CODE', measure.CODE, Text.encode(measure.SYMBOL));\n\n\t\tif (this.getModel().isNew())\n\t\t{\n\t\t\tthis.getModel().save(['MEASURE_CODE']);\n\t\t}\n\t\telse if (mode === MODE_EDIT)\n\t\t{\n\t\t\tthis.getModel().showSaveNotifier(\n\t\t\t\t'measureChanger_' + this.getId(),\n\t\t\t\t{\n\t\t\t\t\ttitle: Loc.getMessage('CATALOG_PRODUCT_MODEL_SAVING_NOTIFICATION_MEASURE_CHANGED_QUERY'),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonSave: () => {\n\t\t\t\t\t\t\tthis.getModel().save(['MEASURE_CODE', 'MEASURE_NAME']);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tthis.addActionProductChange();\n\t}\n\n\tsetDiscount(value, mode = MODE_SET)\n\t{\n\t\tif (!this.isDiscountHandmade())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst fieldName = this.isDiscountPercentage() ? 'DISCOUNT_RATE' : 'DISCOUNT_SUM';\n\t\tconst isChangedValue = this.getField(fieldName) !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateDiscount(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tconst exceptFieldNames = (mode === MODE_EDIT) ? ['DISCOUNT_RATE', 'DISCOUNT_SUM', 'DISCOUNT'] : [];\n\t\t\tthis.refreshFieldsLayout(exceptFieldNames);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\n\t\tthis.#togglePriceHintPopup();\n\t}\n\n\tsetDiscountType(value)\n\t{\n\t\tconst isChangedValue = value !== DiscountType.UNDEFINED\n\t\t\t&& this.getField('DISCOUNT_TYPE_ID') !== value;\n\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateDiscountType(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tthis.refreshFieldsLayout();\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetRowDiscount(value, mode = MODE_SET)\n\t{\n\t\tconst isChangedValue = this.getField('DISCOUNT_ROW') !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateRowDiscount(value);\n\t\t\tthis.setFields(calculatedFields);\n\n\t\t\tconst exceptFieldNames = (mode === MODE_EDIT) ? ['DISCOUNT_ROW'] : [];\n\t\t\tthis.refreshFieldsLayout(exceptFieldNames);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetTaxRate(value)\n\t{\n\t\tif (!this.getEditor().isTaxAllowed())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst isChangedValue = this.getTaxRate() !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateTax(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tthis.refreshFieldsLayout();\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetTaxIncluded(value: 'Y' | 'N', mode = MODE_SET)\n\t{\n\t\tif (!this.getEditor().isTaxAllowed())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (mode === MODE_SET)\n\t\t{\n\t\t\tthis.updateUiCheckboxField('TAX_INCLUDED', value);\n\t\t}\n\n\t\tconst isChangedValue = this.getTaxIncluded() !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateTaxIncluded(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tthis.refreshFieldsLayout();\n\n\t\t\tthis.addActionUpdateFieldList('TAX_INCLUDED', value);\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\tsetRowSum(value, mode = MODE_SET)\n\t{\n\t\tconst isChangedValue = this.getField('SUM') !== value;\n\t\tif (isChangedValue)\n\t\t{\n\t\t\tconst calculatedFields = this.getCalculator().calculateRowSum(value);\n\t\t\tthis.setFields(calculatedFields);\n\t\t\tconst exceptFieldNames = (mode === MODE_EDIT) ? ['SUM'] : [];\n\t\t\tthis.refreshFieldsLayout(exceptFieldNames);\n\n\t\t\tthis.addActionProductChange();\n\t\t\tthis.addActionUpdateTotal();\n\t\t}\n\t}\n\n\t// controls\n\tgetInputByFieldName(fieldName: string): ?HTMLElement\n\t{\n\t\tconst fieldId = this.getUiFieldId(fieldName);\n\t\tlet item = document.getElementById(fieldId);\n\n\t\tif (!Type.isElementNode(item))\n\t\t{\n\t\t\titem = this.getNode().querySelector('[name=\"' + fieldId + '\"]');\n\t\t}\n\n\t\treturn item;\n\t}\n\n\tupdateUiInputField(name, value)\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.value = value;\n\t\t}\n\t}\n\n\tupdateUiCheckboxField(name, value)\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.checked = value === 'Y';\n\t\t}\n\t}\n\n\tupdateUiDiscountTypeField(name: string, value: number): void\n\t{\n\t\tconst text =\n\t\t\tvalue === DiscountType.MONETARY\n\t\t\t\t? this.getEditor().getCurrencyText()\n\t\t\t\t: '%'\n\t\t;\n\n\t\tthis.updateUiMoneyField(name, value, text);\n\t}\n\n\tgetMoneyFieldDropdownApi(name): ?BX.Main.dropdown\n\t{\n\t\tif (!Reflection.getClass('BX.Main.dropdownManager'))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn BX.Main.dropdownManager.getById(this.getId() + '_' + name + '_control');\n\t}\n\n\tupdateMoneyFieldUiWithDropdownApi(dropdown: BX.Main.dropdown, value: number | string)\n\t{\n\t\tif (dropdown.getValue() === value)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst item = dropdown.menu.itemsContainer.querySelector('[data-value=\"' + value + '\"]');\n\t\tconst menuItem = item && dropdown.getMenuItem(item);\n\t\tif (menuItem)\n\t\t{\n\t\t\tdropdown.refresh(menuItem);\n\t\t\tdropdown.selectItem(menuItem);\n\t\t}\n\t}\n\n\tupdateMoneyFieldUiManually(name: string, value: number | string, text: string): void\n\t{\n\t\tconst item = this.getInputByFieldName(name);\n\t\tif (!Type.isElementNode(item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\titem.dataset.value = value;\n\n\t\tconst span = item.querySelector('span.main-dropdown-inner');\n\t\tif (!Type.isElementNode(span))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tspan.innerHTML = text;\n\t}\n\n\tupdateUiMoneyField(name: string, value: number | string, text: string): void\n\t{\n\t\tconst dropdownApi = this.getMoneyFieldDropdownApi(name);\n\t\tif (dropdownApi)\n\t\t{\n\t\t\tthis.updateMoneyFieldUiWithDropdownApi(dropdownApi, value);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.updateMoneyFieldUiManually(name, value, text);\n\t\t}\n\t}\n\n\tupdateUiMeasure(code, name)\n\t{\n\t\tthis.updateUiMoneyField(\n\t\t\t'MEASURE_CODE',\n\t\t\tcode,\n\t\t\tname\n\t\t);\n\n\t\tthis.updateUiStoreAmountData();\n\t}\n\n\tupdateUiHtmlField(name, html)\n\t{\n\t\tconst item = this.getNode().querySelector('[data-name=\"' + name + '\"]');\n\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\titem.innerHTML = html;\n\t\t}\n\t}\n\n\tupdateUiCurrencyFields()\n\t{\n\t\tconst currencyText = this.getEditor().getCurrencyText();\n\t\tconst currencyId = '' + this.getEditor().getCurrencyId();\n\n\t\tconst currencyFieldNames = ['PRICE_CURRENCY', 'SUM_CURRENCY', 'DISCOUNT_TYPE_ID', 'DISCOUNT_ROW_CURRENCY'];\n\t\tcurrencyFieldNames.forEach((name) => {\n\t\t\tconst dropdownValues = [];\n\t\t\tif (name === 'DISCOUNT_TYPE_ID')\n\t\t\t{\n\t\t\t\tdropdownValues.push({\n\t\t\t\t\tNAME: '%',\n\t\t\t\t\tVALUE: '' + DiscountType.PERCENTAGE\n\t\t\t\t});\n\t\t\t\tdropdownValues.push({\n\t\t\t\t\tNAME: currencyText,\n\t\t\t\t\tVALUE: '' + DiscountType.MONETARY\n\t\t\t\t});\n\t\t\t\tif (this.getDiscountType() === DiscountType.MONETARY)\n\t\t\t\t{\n\t\t\t\t\tthis.updateMoneyFieldUiManually(name, DiscountType.MONETARY, currencyText);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tdropdownValues.push({\n\t\t\t\t\tNAME: currencyText,\n\t\t\t\t\tVALUE: currencyId\n\t\t\t\t});\n\t\t\t\tthis.updateUiMoneyField(name, currencyId, currencyText);\n\t\t\t}\n\n\t\t\tDom.attr(this.getInputByFieldName(name), 'data-items', dropdownValues);\n\t\t});\n\n\t\tthis.updateUiField('TAX_SUM', this.getField('TAX_SUM'));\n\t}\n\n\tupdateUiField(field, value): void\n\t{\n\t\tconst uiName = this.getUiFieldName(field);\n\t\tif (!uiName)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst uiType = this.getUiFieldType(uiName);\n\t\tif (!uiType)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.allowUpdateUiField(field))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tswitch (uiType)\n\t\t{\n\t\t\tcase 'input':\n\t\t\t\tif (field === 'QUANTITY')\n\t\t\t\t{\n\t\t\t\t\tvalue = this.parseFloat(value, this.getQuantityPrecision());\n\t\t\t\t}\n\t\t\t\telse if (field === 'DISCOUNT_RATE')\n\t\t\t\t{\n\t\t\t\t\tvalue = this.parseFloat(value, this.getCommonPrecision());\n\t\t\t\t}\n\t\t\t\telse if (field === 'TAX_RATE')\n\t\t\t\t{\n\t\t\t\t\tvalue =\n\t\t\t\t\t\tType.isNil(value) || value === ''\n\t\t\t\t\t\t\t? ''\n\t\t\t\t\t\t\t: this.parseFloat(value, this.getCommonPrecision())\n\t\t\t\t\t;\n\t\t\t\t}\n\t\t\t\telse if (value === 0)\n\t\t\t\t{\n\t\t\t\t\tvalue = '';\n\t\t\t\t}\n\t\t\t\telse if (Type.isNumber(value))\n\t\t\t\t{\n\t\t\t\t\tvalue = this\n\t\t\t\t\t\t.parseFloat(value, this.getPricePrecision())\n\t\t\t\t\t\t.toFixed(this.getPricePrecision())\n\t\t\t\t\t;\n\t\t\t\t}\n\n\t\t\t\tthis.updateUiInputField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'checkbox':\n\t\t\t\tthis.updateUiCheckboxField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'discount_type_field':\n\t\t\t\tthis.updateUiDiscountTypeField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'html':\n\t\t\t\tthis.updateUiHtmlField(uiName, value);\n\t\t\t\tbreak;\n\n\t\t\tcase 'money_html':\n\t\t\t\tvalue = CurrencyCore.currencyFormat(value, this.getEditor().getCurrencyId(), true);\n\t\t\t\tthis.updateUiHtmlField(uiName, value);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tgetUiFieldName(field): string\n\t{\n\t\tlet result = null;\n\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'QUANTITY':\n\t\t\tcase 'MEASURE_CODE':\n\t\t\tcase 'DISCOUNT_ROW':\n\t\t\tcase 'DISCOUNT_TYPE_ID':\n\t\t\tcase 'TAX_RATE':\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\tcase 'TAX_SUM':\n\t\t\tcase 'SUM':\n\t\t\tcase 'PRODUCT_NAME':\n\t\t\tcase 'SORT':\n\t\t\t\tresult = field;\n\t\t\t\tbreak;\n\n\t\t\tcase 'BASE_PRICE':\n\t\t\t\tresult = 'PRICE';\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_RATE':\n\t\t\tcase 'DISCOUNT_SUM':\n\t\t\t\tresult = 'DISCOUNT_PRICE';\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetUiFieldType(field): string\n\t{\n\t\tlet result = null;\n\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'PRICE':\n\t\t\tcase 'QUANTITY':\n\t\t\tcase 'TAX_RATE':\n\t\t\tcase 'DISCOUNT_PRICE':\n\t\t\tcase 'DISCOUNT_RATE':\n\t\t\tcase 'DISCOUNT_SUM':\n\t\t\tcase 'DISCOUNT_ROW':\n\t\t\tcase 'SUM':\n\t\t\tcase 'PRODUCT_NAME':\n\t\t\tcase 'SORT':\n\t\t\t\tresult = 'input';\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_TYPE_ID':\n\t\t\t\tresult = 'discount_type_field';\n\t\t\t\tbreak;\n\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\t\tresult = 'checkbox';\n\t\t\t\tbreak;\n\n\t\t\tcase 'TAX_SUM':\n\t\t\t\tresult = 'money_html';\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tallowUpdateUiField(field): boolean\n\t{\n\t\tlet result = true;\n\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'PRICE_NETTO':\n\t\t\t\tresult = this.isPriceNetto();\n\t\t\t\tbreak;\n\n\t\t\tcase 'PRICE_BRUTTO':\n\t\t\t\tresult = !this.isPriceNetto();\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_RATE':\n\t\t\t\tresult = this.isDiscountPercentage();\n\t\t\t\tbreak;\n\n\t\t\tcase 'DISCOUNT_SUM':\n\t\t\t\tresult = this.isDiscountMonetary();\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t// proxy\n\tparseInt(value: number | string, defaultValue: number = 0): number\n\t{\n\t\treturn this.getEditor().parseInt(value, defaultValue);\n\t}\n\n\tparseFloat(value: number | string, precision: number, defaultValue = 0): number\n\t{\n\t\treturn this.getEditor().parseFloat(value, precision, defaultValue);\n\t}\n\n\tgetPricePrecision(): number\n\t{\n\t\treturn this.getEditor().getPricePrecision();\n\t}\n\n\tgetQuantityPrecision(): number\n\t{\n\t\treturn this.getEditor().getQuantityPrecision();\n\t}\n\n\tgetCommonPrecision(): number\n\t{\n\t\treturn this.getEditor().getCommonPrecision();\n\t}\n\n\tresetExternalActions()\n\t{\n\t\tthis.externalActions.length = 0;\n\t}\n\n\taddExternalAction(action: Action)\n\t{\n\t\tthis.externalActions.push(action);\n\t}\n\n\taddActionProductChange()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.productChange,\n\t\t\tid: this.getId()\n\t\t});\n\t}\n\n\taddActionDisableSaveButton()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.disableSaveButton,\n\t\t\tid: this.getId()\n\t\t});\n\t}\n\n\taddActionUpdateFieldList(field, value)\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.updateListField,\n\t\t\tfield,\n\t\t\tvalue\n\t\t});\n\t}\n\n\taddActionStateChanged()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.stateChanged,\n\t\t\tvalue: true\n\t\t});\n\t}\n\n\taddActionStateReset()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.stateChanged,\n\t\t\tvalue: false\n\t\t});\n\t}\n\n\taddActionUpdateTotal()\n\t{\n\t\tthis.addExternalAction({\n\t\t\ttype: this.getEditor().actions.updateTotal\n\t\t});\n\t}\n\n\texecuteExternalActions()\n\t{\n\t\tif (this.externalActions.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getEditor().executeActions(this.externalActions);\n\t\tthis.resetExternalActions();\n\n\t\tif (this.onAfterExecuteExternalActions)\n\t\t{\n\t\t\tconst callback = this.onAfterExecuteExternalActions;\n\t\t\tthis.onAfterExecuteExternalActions = null;\n\t\t\tcallback.call();\n\t\t}\n\t}\n\n\tisEmpty(): boolean\n\t{\n\t\treturn (\n\t\t\t!Type.isStringFilled(this.getField('PRODUCT_NAME', '').trim())\n\t\t\t&& this.getField('PRODUCT_ID', 0) <= 0\n\t\t\t&& this.getPrice() <= 0\n\t\t)\n\t}\n\n\tisReserveBlocked(): boolean\n\t{\n\t\treturn this.getSettingValue('isReserveBlocked', false);\n\t}\n\n\tisInventoryManagementToolEnabled(): boolean\n\t{\n\t\treturn this.getSettingValue('isInventoryManagementToolEnabled', true);\n\t}\n\n\tgetInventoryManagementMode(): ?string\n\t{\n\t\treturn this.getSettingValue('inventoryManagementMode', '');\n\t}\n\n\tisRestrictedStoreInfo(): boolean\n\t{\n\t\tif (!this.editor.getSettingValue('allowReservation', true))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst storeId = this.getField('STORE_ID')?.toString();\n\t\tif (Type.isNil(storeId) || storeId === '0')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\telse if (this.getModel().isSimple() || this.getModel().isService())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn !this.#getAllowedStores().includes(storeId);\n\t}\n\n\t#getAllowedStores(): Array\n\t{\n\t\treturn this.editor.getSettingValue('allowedStores', []);\n\t}\n\n\t#isReserveEqualProductQuantity(): Boolean\n\t{\n\t\treturn this.editor.getSettingValue('isReserveEqualProductQuantity', false);\n\t}\n\n\tgetMeasureName()\n\t{\n\t\tconst measureName =\n\t\t\tType.isStringFilled(this.model.getField('MEASURE_NAME'))\n\t\t\t\t? this.model.getField('MEASURE_NAME')\n\t\t\t\t: this.editor.getDefaultMeasure()?.SYMBOL || ''\n\t\t;\n\n\t\treturn Text.encode(measureName);\n\t}\n\n\t#getNodeChildByDataName(name: String): HTMLElement\n\t{\n\t\treturn this.getNode().querySelector(`[data-name=\"${name}\"]`);\n\t}\n\n\t#getNodesChild(): NodeList\n\t{\n\t\treturn this.getNode().querySelectorAll(`span[data-name]`);\n\t}\n\n\tsetType(value)\n\t{\n\t\tthis.setField('TYPE', value);\n\n\t\tif (this.getModel().isService())\n\t\t{\n\t\t\tthis.clearReserveControl();\n\t\t}\n\t}\n\n\t#needReserveControlInput(): boolean\n\t{\n\t\treturn !this.getModel().isSimple() && !this.getModel().isService();\n\t}\n\n\t#needStoreSelectorInput(): boolean\n\t{\n\t\treturn !this.getModel().isSimple() && !this.getModel().isService();\n\t}\n}\n","export class PageEventsManager\n{\n\t_settings = {};\n\n\tconstructor(settings)\n\t{\n\t\tthis._settings = settings ? settings : {};\n\t\tthis.eventHandlers = {};\n\t}\n\n\tregisterEventHandler(eventName, eventHandler)\n\t{\n\t\tif (!this.eventHandlers[eventName])\n\t\t\tthis.eventHandlers[eventName] = [];\n\t\tthis.eventHandlers[eventName].push(eventHandler);\n\t\tBX.addCustomEvent(this, eventName, eventHandler);\n\t}\n\n\tfireEvent(eventName, eventParams)\n\t{\n\t\tBX.onCustomEvent(this, eventName, eventParams);\n\t}\n\n\tunregisterEventHandlers(eventName)\n\t{\n\t\tif (this.eventHandlers[eventName])\n\t\t{\n\t\t\tfor (var i = 0; i < this.eventHandlers[eventName].length; i++)\n\t\t\t{\n\t\t\t\tBX.removeCustomEvent(this, eventName, this.eventHandlers[eventName][i]);\n\t\t\t}\n\t\t\tdelete this.eventHandlers[eventName];\n\t\t}\n\t}\n}","import { Popup } from 'main.popup';\nimport { ajax, Cache, Event, Loc, Tag, Type } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport { Editor } from './product.list.editor';\n\nexport default class SettingsPopup\n{\n\t#target: HTMLElement;\n\t#settings: [];\n\t#editor: Editor;\n\t#cache = new Cache.MemoryCache();\n\n\tconstructor(target: HTMLElement, settings = [], editor: Editor)\n\t{\n\t\tthis.#target = target;\n\t\tthis.#settings = settings;\n\t\tthis.#editor = editor;\n\t}\n\n\tshow()\n\t{\n\t\tthis.getPopup().show();\n\t}\n\n\tgetPopup()\n\t{\n\t\treturn this.#cache.remember('settings-popup', () => {\n\t\t\treturn new Popup(\n\t\t\t\tthis.#editor.getId() + '_' + Math.random() * 100,\n\t\t\t\tthis.#target,\n\t\t\t\t{\n\t\t\t\t\tautoHide: true,\n\t\t\t\t\tdraggable: false,\n\t\t\t\t\toffsetLeft: 0,\n\t\t\t\t\toffsetTop: 0,\n\t\t\t\t\tangle: {position: 'top', offset: 43},\n\t\t\t\t\tnoAllPaddings: true,\n\t\t\t\t\tbindOptions: {forceBindPosition: true},\n\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\tcontent: this.#prepareSettingsContent()\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t}\n\n\tgetSetting(id: string)\n\t{\n\t\treturn this.#settings.filter(item => {\n\t\t\treturn item.id === id;\n\t\t})[0];\n\t}\n\n\t#prepareSettingsContent(): HTMLElement\n\t{\n\t\tconst content = Tag.render`\n\t\t\t<div class='ui-entity-editor-popup-create-field-list'></div>\n\t\t`;\n\n\t\tthis.#settings.forEach(item => {\n\t\t\tcontent.append(this.#getSettingItem(item));\n\t\t});\n\n\t\treturn content;\n\t}\n\n\t#getSettingItem(item): HTMLElement\n\t{\n\t\tconst input = Tag.render`\n\t\t\t<input type=\"checkbox\">\n\t\t`;\n\t\tinput.checked = item.checked;\n\t\tinput.disabled = item.disabled ?? false;\n\t\tinput.dataset.settingId = item.id;\n\n\t\tconst descriptionNode = (\n\t\t\tType.isStringFilled(item.desc)\n\t\t\t\t? Tag.render`<span class=\"ui-entity-editor-popup-create-field-item-desc\">${item.desc}</span>`\n\t\t\t\t: ''\n\t\t);\n\n\t\tconst hintNode = (\n\t\t\tType.isStringFilled(item.hint)\n\t\t\t\t? Tag.render`<span class=\"crm-entity-product-list-setting-hint\" data-hint=\"${item.hint}\"></span>`\n\t\t\t\t: ''\n\t\t);\n\n\t\tconst setting = Tag.render`\n\t\t\t<label class=\"ui-ctl-block ui-entity-editor-popup-create-field-item ui-ctl-w100\">\n\t\t\t\t<div class=\"ui-ctl-w10\" style=\"text-align: center\">${input}</div>\n\t\t\t\t<div class=\"ui-ctl-w75\">\n\t\t\t\t\t<span class=\"ui-entity-editor-popup-create-field-item-title ${item.disabled ? 'crm-entity-product-list-disabled-setting' : ''}\">${item.title}${hintNode}</span>\n\t\t\t\t\t${descriptionNode}\n\t\t\t\t</div>\n\t\t\t</label>\n\t\t`;\n\n\t\tBX.UI.Hint.init(setting);\n\n\t\tEvent.bind(setting, 'change', this.#setSetting.bind(this));\n\n\t\treturn setting;\n\t}\n\n\t#setSetting(event: BaseEvent): void\n\t{\n\t\tconst settingItem = this.getSetting(event.target.dataset.settingId);\n\t\tif (!settingItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst settingEnabled = event.target.checked;\n\t\tthis.requestGridSettings(settingItem, settingEnabled);\n\t}\n\n\trequestGridSettings(setting, enabled)\n\t{\n\t\tconst headers = [];\n\t\tconst cells = this.#editor.getGrid().getRows().getHeadFirstChild().getCells();\n\n\t\tArray.from(cells).forEach((header) => {\n\t\t\tif ('name' in header.dataset)\n\t\t\t{\n\t\t\t\theaders.push(header.dataset.name);\n\t\t\t}\n\t\t});\n\n\t\tajax.runComponentAction(\n\t\t\tthis.#editor.getComponentName(),\n\t\t\t'setGridSetting',\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tdata: {\n\t\t\t\t\tsignedParameters: this.#editor.getSignedParameters(),\n\t\t\t\t\tsettingId: setting.id,\n\t\t\t\t\tselected: enabled,\n\t\t\t\t\tcurrentHeaders: headers\n\t\t\t\t}\n\t\t\t}\n\t\t).then(() => {\n\t\t\tlet message;\n\t\t\tsetting.checked = enabled;\n\t\t\tif (setting.id === 'ADD_NEW_ROW_TOP')\n\t\t\t{\n\t\t\t\tconst panel = enabled ? 'top' : 'bottom';\n\t\t\t\tthis.#editor.setSettingValue('newRowPosition', panel);\n\t\t\t\tconst activePanel = this.#editor.changeActivePanelButtons(panel);\n\t\t\t\tconst settingButton = activePanel.querySelector('[data-role=\"product-list-settings-button\"]');\n\t\t\t\tthis.getPopup().setBindElement(settingButton);\n\n\t\t\t\tmessage = enabled\n\t\t\t\t\t? Loc.getMessage('CRM_ENTITY_PL_SETTING_ENABLED')\n\t\t\t\t\t: Loc.getMessage('CRM_ENTITY_PL_SETTING_DISABLED');\n\t\t\t\tmessage = message.replace('#NAME#', setting.title);\n\t\t\t}\n\t\t\telse if(setting.id === 'WAREHOUSE')\n\t\t\t{\n\t\t\t\tthis.#editor.reloadGrid(false);\n\t\t\t\tmessage = enabled\n\t\t\t\t\t? Loc.getMessage('CRM_ENTITY_CARD_WAREHOUSE_ENABLED')\n\t\t\t\t\t: Loc.getMessage('CRM_ENTITY_CARD_WAREHOUSE_DISABLED');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#editor.reloadGrid();\n\n\t\t\t\tmessage = enabled\n\t\t\t\t\t? Loc.getMessage('CRM_ENTITY_PL_SETTING_ENABLED')\n\t\t\t\t\t: Loc.getMessage('CRM_ENTITY_PL_SETTING_DISABLED');\n\t\t\t\tmessage = message.replace('#NAME#', setting.title)\n\t\t\t}\n\t\t\tthis.getPopup().close();\n\n\t\t\tthis.#showNotification(message, {\n\t\t\t\tcategory: 'popup-settings'\n\t\t\t});\n\t\t});\n\t}\n\n\t#showNotification(content: string, options)\n\t{\n\t\toptions = options || {};\n\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: content,\n\t\t\tstack: options.stack || null,\n\t\t\tposition: 'top-right',\n\t\t\twidth: 'auto',\n\t\t\tcategory: options.category || null,\n\t\t\tautoHideDelay: options.autoHideDelay || 3000\n\t\t});\n\t}\n\n\tupdateCheckboxState(): void\n\t{\n\t\tconst popupContainer = this.getPopup().getContentContainer();\n\n\t\tthis.#settings\n\t\t\t.filter(item => item.action === 'grid' && Type.isArray(item.columns))\n\t\t\t.forEach(item => {\n\t\t\t\tlet allColumnsExist = true;\n\n\t\t\t\titem.columns.forEach(columnName => {\n\t\t\t\t\tif (!this.#editor.getGrid().getColumnHeaderCellByName(columnName))\n\t\t\t\t\t{\n\t\t\t\t\t\tallColumnsExist = false;\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\tconst checkbox = popupContainer.querySelector('input[data-setting-id=\"' + item.id + '\"]');\n\t\t\t\tif (Type.isDomNode(checkbox))\n\t\t\t\t{\n\t\t\t\t\tcheckbox.checked = allColumnsExist;\n\t\t\t\t}\n\t\t\t});\n\t}\n}\n","// @flow\n\nimport {Event} from 'main.core';\nimport {Guide} from 'ui.tour';\nimport 'spotlight';\n\nexport class FieldHintManager\n{\n\tfieldHintIsBusy: boolean = false;\n\tactiveHintGuide: Guide|null = null;\n\n\t#gridGetter: Function;\n\t#contentContainer: HTMLElement;\n\n\tconstructor(contentContainer: HTMLElement, gridGetter: Function)\n\t{\n\t\tthis.#contentContainer = contentContainer;\n\t\tthis.#gridGetter = gridGetter;\n\t}\n\n\tprocessFieldTour(fieldNode: HTMLElement, tourData: Object, endTourHandler: Function, addictedFieldNodes: Array<HTMLElement> = []): void\n\t{\n\t\tif (this.fieldHintIsBusy)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.fieldHintIsBusy = true;\n\t\t// When click action in progress tour will be closed -> 'onClose' tour method will be executed\n\t\ttourData.events = {\n\t\t\tonClose: () => {\n\t\t\t\tendTourHandler();\n\t\t\t\tthis.fieldHintIsBusy = false;\n\t\t\t\tthis.activeHintGuide = null;\n\t\t\t}\n\t\t}\n\n\t\tif (this.#fieldNodeIsInGridVision(fieldNode))\n\t\t{\n\t\t\tlet tourObject = this.#tieTourToNode(fieldNode, tourData);\n\t\t\tthis.#freezeGridContainer(() => {\n\t\t\t\ttourObject.close();\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst gridContainer = this.#gridGetter().getContainer();\n\t\t\tconst leftArrow = gridContainer.querySelector('.main-grid-ear-left');\n\t\t\tconst rightArrow = gridContainer.querySelector('.main-grid-ear-right');\n\n\t\t\tconst fieldPos = fieldNode.getClientRects()[0].x;\n\t\t\tconst gridPos = gridContainer.getClientRects()[0].x;\n\n\t\t\tlet spotlight = null;\n\t\t\tif (fieldPos > gridPos) {\n\t\t\t\tspotlight = this.#bindSpotlightToNode(rightArrow);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tspotlight = this.#bindSpotlightToNode(leftArrow);\n\t\t\t}\n\n\t\t\tthis.#bindGridNodeVisionChange(fieldNode, () => {\n\t\t\t\tspotlight.close();\n\t\t\t\tlet tourObject = this.#tieTourToNode(fieldNode, tourData);\n\t\t\t\tthis.#freezeGridContainer(() => {\n\t\t\t\t\ttourObject.close();\n\t\t\t\t})\n\t\t\t}, [], addictedFieldNodes);\n\t\t}\n\t}\n\n\t#bindGridNodeVisionChange(observedNode: HTMLElement, onSuccessVisionCallback: Function, callbackParams: Array = [], addictedNodes: Array<HTMLElement> = [])\n\t{\n\t\tconst observedNodes = this.#getPossibleToValidateFieldNodes(observedNode, ...addictedNodes);\n\t\tconst observer = (event: Event) => {\n\t\t\tif (this.#fieldNodeIsInGridVision(...observedNodes))\n\t\t\t{\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tthis.#gridGetter().getScrollContainer(),\n\t\t\t\t\t'scroll',\n\t\t\t\t\tobserver\n\t\t\t\t);\n\t\t\t\tEvent.unbind(\n\t\t\t\t\twindow,\n\t\t\t\t\t'resize',\n\t\t\t\t\tobserver\n\t\t\t\t);\n\n\t\t\t\tonSuccessVisionCallback(...callbackParams);\n\t\t\t}\n\t\t}\n\n\t\tEvent.bind(\n\t\t\tthis.#gridGetter().getScrollContainer(),\n\t\t\t'scroll',\n\t\t\tobserver\n\t\t);\n\t\tEvent.bind(\n\t\t\twindow,\n\t\t\t'resize',\n\t\t\tobserver\n\t\t);\n\t}\n\n\t#getPossibleToValidateFieldNodes(mainNode: HTMLElement, ...addictedNodes: Array<HTMLElement>): Array<HTMLElement>\n\t{\n\t\tconst nodesTuple = [];\n\t\tfor (const addictedNode: HTMLElement of addictedNodes)\n\t\t{\n\t\t\tnodesTuple.push({\n\t\t\t\tnode: addictedNode,\n\t\t\t\tnodeRect: addictedNode.getClientRects()[0],\n\t\t\t});\n\t\t}\n\n\t\tconst mainNodeTupleEl = {\n\t\t\tnode: mainNode,\n\t\t\tnodeRect: mainNode.getClientRects()[0],\n\t\t};\n\t\tnodesTuple.push(mainNodeTupleEl);\n\n\t\tnodesTuple.sort((firstEl, secondEl) => {\n\t\t\tconst {x: firstX} = firstEl.nodeRect;\n\t\t\tconst {x: secondX} = secondEl.nodeRect;\n\n\t\t\tif (firstX < secondX)\n\t\t\t{\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\telse if (firstX > secondX)\n\t\t\t{\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t});\n\n\t\tconst gridRect = this.#gridGetter()?.getContainer().getClientRects()?.[0];\n\t\tfunction widthIsValid(leftPos: number, rightPos: number)\n\t\t{\n\t\t\treturn Math.abs(leftPos - rightPos) < gridRect.width;\n\t\t}\n\n\t\twhile (nodesTuple.length > 1 && !widthIsValid(nodesTuple[0].nodeRect.x,nodesTuple[nodesTuple.length-1].nodeRect.x))\n\t\t{\n\t\t\tconst firstEl = nodesTuple[0];\n\t\t\tconst lastEl = nodesTuple[nodesTuple.length-1];\n\t\t\tif (firstEl === mainNodeTupleEl)\n\t\t\t{\n\t\t\t\tnodesTuple.pop();\n\t\t\t}\n\t\t\telse if (lastEl === mainNodeTupleEl)\n\t\t\t{\n\t\t\t\tnodesTuple.shift();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst firstElDistance = mainNodeTupleEl.nodeRect.x - firstEl.nodeRect.x;\n\t\t\t\tconst lastElDistance = lastEl.nodeRect.x - mainNodeTupleEl.nodeRect.x;\n\t\t\t\tif (firstElDistance >= lastElDistance)\n\t\t\t\t{\n\t\t\t\t\tnodesTuple.shift();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tnodesTuple.pop();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn nodesTuple.map((el) => el.node);\n\t}\n\n\t#fieldNodeIsInGridVision(...fieldNodes: Array<HTMLElement>) {\n\t\tconst gridRect = this.#gridGetter()?.getContainer().getClientRects()?.[0];\n\n\t\tif (gridRect === undefined)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tconst gridLeftEdge = gridRect.x;\n\t\tconst gridRightEdge = gridRect.x + gridRect.width;\n\n\t\tfor (const fieldNode: HTMLElement of fieldNodes)\n\t\t{\n\t\t\tconst fieldRect = fieldNode.getClientRects()?.[0];\n\t\t\tif (fieldRect === undefined)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst fieldLeftEdge = fieldRect.x;\n\t\t\tconst fieldRightEdge = fieldRect.x + fieldRect.width;\n\n\t\t\tif (fieldLeftEdge < gridLeftEdge || fieldRightEdge > gridRightEdge)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t#bindSpotlightToNode(targetNode: HTMLElement)\n\t{\n\t\tconst spotlight = new BX.SpotLight(\n\t\t\t{\n\t\t\t\tid: 'arrow_spotlight',\n\t\t\t\ttargetElement: targetNode,\n\t\t\t\tautoSave: true,\n\t\t\t\ttargetVertex: \"middle-center\",\n\t\t\t\tzIndex: 200,\n\t\t\t}\n\t\t);\n\t\tspotlight.show();\n\t\tspotlight.container.style.pointerEvents = \"none\";\n\n\t\treturn spotlight;\n\t}\n\n\t#freezeGridContainer(onCloseCallback: Function, callbackParams: Array = [])\n\t{\n\t\tconst gridContainer = this.#gridGetter().getContainer();\n\t\tconst leftArrow = gridContainer.querySelector('.main-grid-ear-left');\n\t\tconst rightArrow = gridContainer.querySelector('.main-grid-ear-right');\n\n\t\tgridContainer.style.pointerEvents = \"none\";\n\t\tleftArrow.style.pointerEvents = \"none\";\n\t\trightArrow.style.pointerEvents = \"none\";\n\n\t\tconst clickObserver = (event) => {\n\t\t\tgridContainer.style.pointerEvents = \"auto\";\n\t\t\tleftArrow.style.pointerEvents = \"auto\";\n\t\t\trightArrow.style.pointerEvents = \"auto\";\n\t\t\tEvent.unbind(\n\t\t\t\tthis.#contentContainer,\n\t\t\t\t'click',\n\t\t\t\tclickObserver\n\t\t\t);\n\n\t\t\tonCloseCallback(...callbackParams);\n\t\t}\n\t\tsetTimeout(() => {\n\t\t\tEvent.bind(\n\t\t\t\tthis.#contentContainer,\n\t\t\t\t'click',\n\t\t\t\tclickObserver\n\t\t\t);\n\t\t}, 500);\n\t}\n\n\t#tieTourToNode(tourTarget: HTMLElement, tourData: Object): Guide\n\t{\n\n\t\tconst guide = new Guide({\n\t\t\tsteps: [\n\t\t\t\tObject.assign({target: tourTarget}, tourData),\n\t\t\t],\n\t\t\tonEvents: true,\n\t\t});\n\t\tthis.activeHintGuide = guide;\n\n\t\tguide.showNextStep();\n\t\treturn guide;\n\t}\n\n\tgetActiveHint(): Guide|null\n\t{\n\t\tif (!this.fieldHintIsBusy)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\telse if (this.activeHintGuide instanceof Guide)\n\t\t{\n\t\t\treturn this.activeHintGuide;\n\t\t}\n\n\t\treturn null;\n\t}\n}\n","import {ajax, Cache, Dom, Event, Loc, Reflection, Runtime, Tag, Text, Type} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\nimport {Row} from './product.list.row';\nimport {PageEventsManager} from './page.events.manager';\nimport {DiscountType} from 'catalog.product-calculator';\nimport SettingsPopup from './settings.button';\nimport {CurrencyCore} from 'currency.currency-core';\nimport {ProductSelector} from 'catalog.product-selector';\nimport HintPopup from './hint.popup';\nimport {ProductModel} from \"catalog.product-model\";\nimport {PULL} from 'pull.client';\nimport {FieldHintManager} from \"./field.hint.manager\";\nimport {Guide} from 'ui.tour';\nimport { OneCPlanRestrictionSlider } from 'catalog.tool-availability-manager';\n\nimport 'ui.hint';\n\nconst GRID_TEMPLATE_ROW = 'template_0';\nconst DEFAULT_PRECISION: number = 2;\n\nexport class Editor\n{\n\tid: ?string;\n\tsettings: Object;\n\tajaxPool: Map = new Map();\n\tcontroller: ?BX.Crm.EntityProductListController;\n\tcontainer: ?HTMLElement;\n\tform: ?HTMLElement\n\tproducts: Row[] = [];\n\tproductsWasInitiated = false;\n\tisChangedGrid = false;\n\tisVisibleGrid = false;\n\tpageEventsManager: PageEventsManager;\n\tcache = new Cache.MemoryCache();\n\n\t#fieldHintManager: FieldHintManager;\n\n\tactions = {\n\t\tdisableSaveButton: 'disableSaveButton',\n\t\tproductChange: 'productChange',\n\t\tproductListChanged: 'productListChanged',\n\t\tupdateListField: 'listField',\n\t\tstateChanged: 'stateChange',\n\t\tupdateTotal: 'total'\n\t};\n\n\tstateChange = {\n\t\tchanged: false,\n\t\tsended: false\n\t};\n\n\tupdateFieldForList = null;\n\n\ttotalData = {\n\t\tinProgress: false\n\t};\n\n\tproductSelectionPopupHandler = this.handleProductSelectionPopup.bind(this);\n\tproductRowAddHandler = this.handleProductRowAdd.bind(this);\n\tshowSettingsPopupHandler = this.handleShowSettingsPopup.bind(this);\n\n\tonDialogSelectProductHandler = this.handleOnDialogSelectProduct.bind(this);\n\tonAddViewedProductToDealHandler = this.handleOnAddViewedProductToDeal.bind(this);\n\tonSaveHandler = this.handleOnSave.bind(this);\n\tonFocusToProductList = this.handleProductListFocus.bind(this);\n\tonEntityUpdateHandler = this.handleOnEntityUpdate.bind(this);\n\tonEditorSubmit = this.handleEditorSubmit.bind(this);\n\tonInnerCancelHandler = this.handleOnInnerCancel.bind(this);\n\tonBeforeGridRequestHandler = this.handleOnBeforeGridRequest.bind(this);\n\tonGridUpdatedHandler = this.handleOnGridUpdated.bind(this);\n\tonGridRowMovedHandler = this.handleOnGridRowMoved.bind(this);\n\tonBeforeProductChangeHandler = this.handleOnBeforeProductChange.bind(this);\n\tonProductChangeHandler = this.handleOnProductChange.bind(this);\n\tonBeforeProductClearHandler = this.handleOnBeforeProductClear.bind(this);\n\tonProductClearHandler = this.handleOnProductClear.bind(this);\n\tdropdownChangeHandler = this.handleDropdownChange.bind(this);\n\tpullReloadGrid = null;\n\n\tchangeProductFieldHandler = this.handleFieldChange.bind(this);\n\tupdateTotalDataDelayedHandler = Runtime.debounce(this.updateTotalDataDelayed, 1000, this);\n\n\tconstructor(id)\n\t{\n\t\tthis.setId(id);\n\t}\n\n\tinit(config = {})\n\t{\n\t\tthis.setSettings(config);\n\n\t\tif (this.canEdit())\n\t\t{\n\t\t\tthis.addFirstRowIfEmpty();\n\t\t\tthis.enableEdit();\n\t\t}\n\n\t\tthis.initForm();\n\t\tthis.initProducts();\n\t\tthis.initGridData();\n\n\t\tthis.#fieldHintManager = new FieldHintManager(this.getContainer(), this.getGrid.bind(this));\n\n\t\tEventEmitter.emit(window, 'EntityProductListController', [this]);\n\n\t\tthis.#initSupportCustomRowActions();\n\n\t\tthis.subscribeDomEvents();\n\t\tthis.subscribeCustomEvents();\n\n\t\tif (this.getSettingValue('isReserveBlocked', false))\n\t\t{\n\t\t\tconst headersToLock = ['STORE_INFO', 'RESERVE_INFO'];\n\t\t\tconst container = this.getContainer();\n\t\t\theadersToLock.forEach((headerId) => {\n\t\t\t\tconst header = container?.querySelector(`.main-grid-cell-head[data-name=\"${headerId}\"] .main-grid-cell-head-container`);\n\t\t\t\tif (header)\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(header, 'main-grid-cell-head-locked');\n\t\t\t\t\theader.onclick = (event) => {\n\t\t\t\t\t\tif (Dom.hasClass(event.target, 'ui-hint-icon'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.openIntegrationLimitSlider();\n\t\t\t\t\t};\n\t\t\t\t\tconst lock = Tag.render`<span class=\"crm-entity-product-list-locked-header\"></span>`;\n\t\t\t\t\theader.insertBefore(lock, header.firstChild);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tthis\n\t\t\t.getContainer()\n\t\t\t.querySelectorAll('.crm-entity-product-list-add-block')\n\t\t\t.forEach((buttonBlock) => {\n\t\t\t\tBX.UI.Hint.init(buttonBlock);\n\t\t\t})\n\t\t;\n\t}\n\n\tsubscribeDomEvents()\n\t{\n\t\tthis.unsubscribeDomEvents();\n\t\tconst container = this.getContainer();\n\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tif (!this.getSettingValue('disabledSelectProductButton', false))\n\t\t\t{\n\t\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-select-button\"]').forEach((selectButton) => {\n\t\t\t\t\tEvent.bind(\n\t\t\t\t\t\tselectButton,\n\t\t\t\t\t\t'click',\n\t\t\t\t\t\tthis.productSelectionPopupHandler\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (!this.getSettingValue('disabledAddRowButton', false))\n\t\t\t{\n\t\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-add-button\"]').forEach((addButton) => {\n\t\t\t\t\tif (this.getSettingValue('isOnecInventoryManagementRestricted') === true)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.addClass(addButton, 'ui-btn-icon-lock');\n\t\t\t\t\t}\n\n\t\t\t\t\tEvent.bind(\n\t\t\t\t\t\taddButton,\n\t\t\t\t\t\t'click',\n\t\t\t\t\t\tthis.productRowAddHandler\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-settings-button\"]').forEach((configButton) => {\n\t\t\t\tEvent.bind(\n\t\t\t\t\tconfigButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.showSettingsPopupHandler\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t}\n\n\tunsubscribeDomEvents()\n\t{\n\t\tconst container = this.getContainer();\n\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-select-button\"]').forEach((selectButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tselectButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productSelectionPopupHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-add-button\"]').forEach((addButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\taddButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.productRowAddHandler\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-settings-button\"]').forEach((configButton) => {\n\t\t\t\tEvent.unbind(\n\t\t\t\t\tconfigButton,\n\t\t\t\t\t'click',\n\t\t\t\t\tthis.showSettingsPopupHandler\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t}\n\n\tsubscribeCustomEvents()\n\t{\n\t\tthis.unsubscribeCustomEvents();\n\t\tEventEmitter.subscribe('CrmProductSearchDialog_SelectProduct', this.onDialogSelectProductHandler);\n\t\tEventEmitter.subscribe('onAddViewedProductToDeal', this.onAddViewedProductToDealHandler);\n\t\tEventEmitter.subscribe('BX.Crm.EntityEditor:onSave', this.onSaveHandler);\n\t\tEventEmitter.subscribe('onFocusToProductList', this.onFocusToProductList);\n\t\tEventEmitter.subscribe('onCrmEntityUpdate', this.onEntityUpdateHandler);\n\t\tEventEmitter.subscribe('BX.Crm.EntityEditorAjax:onSubmit', this.onEditorSubmit);\n\t\tEventEmitter.subscribe('EntityProductListController:onInnerCancel', this.onInnerCancelHandler);\n\t\tEventEmitter.subscribe('Grid::beforeRequest', this.onBeforeGridRequestHandler);\n\t\tEventEmitter.subscribe('Grid::updated', this.onGridUpdatedHandler);\n\t\tEventEmitter.subscribe('Grid::rowMoved', this.onGridRowMovedHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onBeforeChange', this.onBeforeProductChangeHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onChange', this.onProductChangeHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onBeforeClear', this.onBeforeProductClearHandler);\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onClear', this.onProductClearHandler);\n\t\tEventEmitter.subscribe('Dropdown::change', this.dropdownChangeHandler);\n\t\tif (PULL)\n\t\t{\n\t\t\tthis.pullReloadGrid = PULL.subscribe({\n\t\t\t\tmoduleId: 'crm',\n\t\t\t\tcallback: (data) => {\n\t\t\t\t\tif (\n\t\t\t\t\t\tdata.command === 'onCatalogInventoryManagementEnabled'\n\t\t\t\t\t\t|| data.command === 'onCatalogInventoryManagementDisabled'\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.reloadGrid(false);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tunsubscribeCustomEvents()\n\t{\n\t\tEventEmitter.unsubscribe('CrmProductSearchDialog_SelectProduct', this.onDialogSelectProductHandler);\n\t\tEventEmitter.unsubscribe('onAddViewedProductToDeal', this.onAddViewedProductToDealHandler);\n\t\tEventEmitter.unsubscribe('BX.Crm.EntityEditor:onSave', this.onSaveHandler);\n\t\tEventEmitter.unsubscribe('onFocusToProductList', this.onFocusToProductList);\n\t\tEventEmitter.unsubscribe('onCrmEntityUpdate', this.onEntityUpdateHandler);\n\t\tEventEmitter.unsubscribe('BX.Crm.EntityEditorAjax:onSubmit', this.onEditorSubmit);\n\t\tEventEmitter.unsubscribe('EntityProductListController:onInnerCancel', this.onInnerCancelHandler);\n\t\tEventEmitter.unsubscribe('Grid::beforeRequest', this.onBeforeGridRequestHandler);\n\t\tEventEmitter.unsubscribe('Grid::updated', this.onGridUpdatedHandler);\n\t\tEventEmitter.unsubscribe('Grid::rowMoved', this.onGridRowMovedHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onBeforeChange', this.onBeforeProductChangeHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onChange', this.onProductChangeHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onBeforeClear', this.onBeforeProductClearHandler);\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onClear', this.onProductClearHandler);\n\t\tEventEmitter.unsubscribe('Dropdown::change', this.dropdownChangeHandler);\n\t\tif (!Type.isNil(this.pullReloadGrid))\n\t\t{\n\t\t\tthis.pullReloadGrid();\n\t\t}\n\t}\n\n\t#initSupportCustomRowActions()\n\t{\n\t\tthis.getGrid()._clickOnRowActionsButton = () => {};\n\t}\n\n\thandleOnDialogSelectProduct(event: BaseEvent)\n\t{\n\t\tconst [productId] = event.getCompatData();\n\t\tlet id;\n\t\tif (this.getProductCount() > 0 || this.products[0]?.getField('ID') <= 0)\n\t\t{\n\t\t\tid = this.addProductRow();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tid = this.products[0]?.getField('ID');\n\t\t}\n\t\tthis.selectProductInRow(id, productId)\n\t}\n\n\thandleOnAddViewedProductToDeal(event: BaseEvent)\n\t{\n\t\tconst [productId] = event.getCompatData();\n\t\tlet id;\n\t\tif (this.getProductCount() > 0)\n\t\t{\n\t\t\tid = this.addProductRow();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tid = this.products[0]?.getField('ID');\n\t\t}\n\t\tthis.selectViewedProductInRow(id, productId);\n\t}\n\n\tselectViewedProductInRow(id: string, productId: number): void\n\t{\n\t\tif (!Type.isStringFilled(id) || Text.toNumber(productId) <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\trequestAnimationFrame(() => {\n\t\t\tconst productSelector = this.getProductSelector(id);\n\t\t\tif (productSelector)\n\t\t\t{\n\t\t\t\tproductSelector.onProductSelect(productId);\n\t\t\t}\n\t\t});\n\t}\n\n\tselectProductInRow(id: string, productId: number): void\n\t{\n\t\tif (!Type.isStringFilled(id) || Text.toNumber(productId) <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\trequestAnimationFrame(() => {\n\t\t\tconst productSelector = this.getProductSelector(id);\n\t\t\tif (productSelector)\n\t\t\t{\n\t\t\t\tproductSelector.searchInput.clearErrors();\n\t\t\t\tproductSelector.onProductSelect(productId);\n\t\t\t}\n\t\t});\n\t}\n\n\thandleOnSave(event: BaseEvent)\n\t{\n\t\tconst items = [];\n\n\t\tthis.products.forEach((product) => {\n\t\t\tconst item = {\n\t\t\t\tfields: {...product.fields},\n\t\t\t\trowId: product.fields.ROW_ID\n\t\t\t};\n\t\t\titems.push(item);\n\t\t});\n\n\t\tthis.setSettingValue('items', items);\n\t}\n\n\thandleProductListFocus(event: BaseEvent)\n\t{\n\t\tif (this.isReadOnly())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet listHaveEmptyRows = false;\n\n\t\tfor (const product of this.products)\n\t\t{\n\t\t\tif (product.isEmptyRow())\n\t\t\t{\n\t\t\t\tlistHaveEmptyRows = true;\n\t\t\t\tthis.focusProductSelector(product.fields['ID']);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (!listHaveEmptyRows)\n\t\t{\n\t\t\tthis.handleProductRowAdd();\n\t\t}\n\t}\n\n\thandleOnEntityUpdate(event: BaseEvent)\n\t{\n\t\tconst [data] = event.getData();\n\t\tif (\n\t\t\tthis.isChanged()\n\t\t\t&& data.entityId === this.getSettingValue('entityId')\n\t\t\t&& data.entityTypeId === this.getSettingValue('entityTypeId')\n\t\t)\n\t\t{\n\t\t\tthis.setGridChanged(false);\n\t\t\tthis.reloadGrid(false);\n\t\t}\n\t}\n\n\thandleEditorSubmit(event: BaseEvent)\n\t{\n\t\tif (!this.isLocationDependantTaxesEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst entityData = event.getData()[0];\n\t\tif (!entityData || !entityData.hasOwnProperty('LOCATION_ID'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (entityData['LOCATION_ID'] !== this.getLocationId())\n\t\t{\n\t\t\tthis.setLocationId(entityData['LOCATION_ID']);\n\t\t\tthis.reloadGrid(false);\n\t\t}\n\t}\n\n\thandleOnInnerCancel(event: BaseEvent)\n\t{\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.rollback();\n\t\t}\n\n\t\tthis.setGridChanged(false);\n\n\t\tEventEmitter.subscribeOnce(\n\t\t\tthis,\n\t\t\t'onGridReloaded',\n\t\t\t() => this.actionUpdateTotalData({isInternalChanging: true})\n\t\t)\n\t\tthis.reloadGrid(false);\n\t}\n\n\tchangeActivePanelButtons(panelCode: 'top' | 'bottom'): HTMLElement\n\t{\n\t\tconst container = this.getContainer();\n\t\tconst activePanel = container.querySelector('.crm-entity-product-list-add-block-' + panelCode);\n\t\tif (Type.isDomNode(activePanel))\n\t\t{\n\t\t\tDom.removeClass(activePanel, 'crm-entity-product-list-add-block-hidden');\n\t\t\tDom.addClass(activePanel, 'crm-entity-product-list-add-block-active');\n\t\t}\n\n\t\tconst hiddenPanelCode = (panelCode === 'top') ? 'bottom' : 'top';\n\t\tconst removePanel = container.querySelector('.crm-entity-product-list-add-block-' + hiddenPanelCode);\n\t\tif (Type.isDomNode(removePanel))\n\t\t{\n\t\t\tDom.addClass(removePanel, 'crm-entity-product-list-add-block-hidden');\n\t\t\tDom.removeClass(removePanel, 'crm-entity-product-list-add-block-active');\n\t\t}\n\n\t\treturn activePanel;\n\t}\n\n\treloadGrid(useProductsFromRequest: boolean = true, isInternalChanging: ?boolean = null): void\n\t{\n\t\tif (isInternalChanging === null)\n\t\t{\n\t\t\tisInternalChanging = !useProductsFromRequest;\n\t\t}\n\n\t\tthis.getGrid().reloadTable(\n\t\t\t'POST',\n\t\t\t{useProductsFromRequest},\n\t\t\t() => EventEmitter.emit(this, 'onGridReloaded')\n\t\t);\n\t}\n\n\t/*\n\t\tkeep in mind different actions for this handler:\n\t\t- native reload by grid actions (columns settings, etc)\t\t- products from request\n\t\t- reload by tax/discount settings button\t\t\t\t\t- products from request\t\tthis.reloadGrid(true)\n\t\t- rollback\t\t\t\t\t\t\t\t\t\t\t\t\t- products from db\t\t\tthis.reloadGrid(false)\n\t\t- reload after SalesCenter order save\t\t\t\t\t\t- products from db\t\t\tthis.reloadGrid(false)\n\t\t- reload after save if location had been changed\n\t */\n\thandleOnBeforeGridRequest(event: BaseEvent)\n\t{\n\t\tconst [grid, eventArgs] = event.getCompatData();\n\n\t\tif (!grid || !grid.parent || grid.parent.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// reload by native grid actions (columns settings, etc), otherwise by this.reloadGrid()\n\t\tconst isNativeAction = !('useProductsFromRequest' in eventArgs.data);\n\t\tconst useProductsFromRequest = isNativeAction ? true : eventArgs.data.useProductsFromRequest;\n\n\t\teventArgs.url = this.getReloadUrl();\n\t\teventArgs.method = 'POST';\n\t\teventArgs.sessid = BX.bitrix_sessid();\n\t\teventArgs.data = {\n\t\t\t...eventArgs.data,\n\t\t\tsignedParameters: this.getSignedParameters(),\n\t\t\tproducts: useProductsFromRequest ? this.getProductsFields(Editor.#getAjaxFields()) : null,\n\t\t\tlocationId: this.getLocationId(),\n\t\t\tcurrencyId: this.getCurrencyId(),\n\t\t};\n\n\t\tthis.clearEditor();\n\n\t\tif (isNativeAction && this.isChanged())\n\t\t{\n\t\t\tEventEmitter.subscribeOnce('Grid::updated', () => this.actionUpdateTotalData({isInternalChanging: false}));\n\t\t}\n\t}\n\n\thandleOnGridUpdated(event: BaseEvent)\n\t{\n\t\tconst [grid] = event.getCompatData();\n\n\t\tif (!grid || grid.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getSettingsPopup().updateCheckboxState();\n\t}\n\n\thandleOnGridRowMoved(event: BaseEvent)\n\t{\n\t\tconst [ids, , grid] = event.getCompatData();\n\n\t\tif (!grid || grid.getId() !== this.getGridId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst changed = this.resortProductsByIds(ids);\n\t\tif (changed)\n\t\t{\n\t\t\tthis.refreshSortFields();\n\t\t\tthis.numerateRows();\n\t\t\tthis.executeActions([{type: this.actions.productListChanged}]);\n\t\t}\n\t}\n\n\tinitPageEventsManager(): void\n\t{\n\t\tconst componentId = this.getSettingValue('componentId');\n\t\tthis.pageEventsManager = new PageEventsManager({id: componentId});\n\t}\n\n\tgetPageEventsManager(): PageEventsManager\n\t{\n\t\tif (!this.pageEventsManager)\n\t\t{\n\t\t\tthis.initPageEventsManager();\n\t\t}\n\n\t\treturn this.pageEventsManager;\n\t}\n\n\tcanEdit(): boolean\n\t{\n\t\treturn this.getSettingValue('allowEdit', false) === true;\n\t}\n\n\tcanEditCatalogPrice(): boolean\n\t{\n\t\treturn this.getSettingValue('allowCatalogPriceEdit', false) === true;\n\t}\n\n\tcanSaveCatalogPrice(): boolean\n\t{\n\t\treturn this.getSettingValue('allowCatalogPriceSave', false) === true;\n\t}\n\n\tenableEdit()\n\t{\n\t\t// Cannot use editSelected because checkboxes have been removed\n\t\tconst rows = this.getGrid().getRows().getRows();\n\t\trows.forEach((current) => {\n\t\t\tif (!current.isHeadChild() && !current.isTemplate())\n\t\t\t{\n\t\t\t\tcurrent.edit();\n\t\t\t}\n\t\t});\n\t}\n\n\taddFirstRowIfEmpty(): void\n\t{\n\t\tif (this.getGrid().getRows().getCountDisplayed() === 0)\n\t\t{\n\t\t\trequestAnimationFrame(() => this.addProductRow());\n\t\t}\n\t}\n\n\tclearEditor()\n\t{\n\t\tthis.unsubscribeProductsEvents();\n\n\t\tthis.products = [];\n\t\tthis.productsWasInitiated = false;\n\n\t\tthis.destroySettingsPopup();\n\t\tthis.unsubscribeDomEvents();\n\t\tthis.unsubscribeCustomEvents();\n\n\t\tEvent.unbindAll(this.container);\n\t}\n\n\twasProductsInitiated()\n\t{\n\t\treturn this.productsWasInitiated;\n\t}\n\n\tunsubscribeProductsEvents()\n\t{\n\t\tthis.products.forEach((current) => {\n\t\t\tcurrent.unsubscribeCustomEvents();\n\t\t});\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.setForm(null);\n\t\tthis.clearController();\n\t\tthis.clearEditor();\n\t}\n\n\tsetController(controller)\n\t{\n\t\tif (this.controller === controller)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.clearProductList();\n\t\t}\n\t\tthis.controller = controller;\n\t}\n\n\tclearController()\n\t{\n\t\tthis.controller = null;\n\t}\n\n\tgetId()\n\t{\n\t\treturn this.id;\n\t}\n\n\tsetId(id)\n\t{\n\t\tthis.id = id;\n\t}\n\n\t/* settings tools */\n\tgetSettings()\n\t{\n\t\treturn this.settings;\n\t}\n\n\tsetSettings(settings)\n\t{\n\t\tthis.settings = settings ? settings : {};\n\t}\n\n\tgetSettingValue(name: string, defaultValue)\n\t{\n\t\treturn this.settings.hasOwnProperty(name) ? this.settings[name] : defaultValue;\n\t}\n\n\tsetSettingValue(name, value)\n\t{\n\t\tthis.settings[name] = value;\n\t}\n\n\tgetComponentName()\n\t{\n\t\treturn this.getSettingValue('componentName', '');\n\t}\n\n\tgetReloadUrl()\n\t{\n\t\treturn this.getSettingValue('reloadUrl', '');\n\t}\n\n\tgetSignedParameters()\n\t{\n\t\treturn this.getSettingValue('signedParameters', '');\n\t}\n\n\tgetContainerId()\n\t{\n\t\treturn this.getSettingValue('containerId', '');\n\t}\n\n\tgetGridId(): string\n\t{\n\t\treturn this.getSettingValue('gridId', '');\n\t}\n\n\tgetLanguageId()\n\t{\n\t\treturn this.getSettingValue('languageId', '');\n\t}\n\n\tgetSiteId()\n\t{\n\t\treturn this.getSettingValue('siteId', '');\n\t}\n\n\tgetCatalogId()\n\t{\n\t\treturn this.getSettingValue('catalogId', 0);\n\t}\n\n\tisReadOnly()\n\t{\n\t\treturn this.getSettingValue('readOnly', true);\n\t}\n\n\tsetReadOnly(readOnly)\n\t{\n\t\tthis.setSettingValue('readOnly', readOnly);\n\t}\n\n\tgetCurrencyId(): string\n\t{\n\t\treturn this.getSettingValue('currencyId', '');\n\t}\n\n\tsetCurrencyId(currencyId): void\n\t{\n\t\tthis.setSettingValue('currencyId', currencyId);\n\t\tthis.products.forEach(product => product.getModel()?.setOption('currency', currencyId));\n\t}\n\n\tisLocationDependantTaxesEnabled(): boolean\n\t{\n\t\treturn this.getSettingValue('isLocationDependantTaxesEnabled', false);\n\t}\n\n\tgetLocationId(): ?string\n\t{\n\t\treturn this.getSettingValue('locationId');\n\t}\n\n\tsetLocationId(locationId: string): void\n\t{\n\t\tthis.setSettingValue('locationId', locationId);\n\t}\n\n\tchangeCurrencyId(currencyId): void\n\t{\n\t\tthis.setCurrencyId(currencyId);\n\t\tconst products = [];\n\t\tthis.products.forEach((product) => {\n\t\t\tconst priceFields = {};\n\t\t\tthis.#getCalculatePriceFieldNames().forEach((name) => {\n\t\t\t\tpriceFields[name] = product.getField(name);\n\t\t\t});\n\n\t\t\tproducts.push({\n\t\t\t\tfields: priceFields,\n\t\t\t\tid: product.getId()\n\t\t\t});\n\t\t});\n\n\t\tif (products.length > 0)\n\t\t{\n\t\t\tthis.ajaxRequest('calculateProductPrices', {\n\t\t\t\tproducts,\n\t\t\t\tcurrencyId\n\t\t\t});\n\t\t}\n\n\t\tconst editData = this.getGridEditData();\n\t\tconst templateRow = editData[GRID_TEMPLATE_ROW];\n\t\ttemplateRow['CURRENCY'] = this.getCurrencyId();\n\t\tconst templateFieldNames = ['DISCOUNT_ROW', 'SUM', 'PRICE'];\n\n\t\ttemplateFieldNames.forEach((field) => {\n\t\t\ttemplateRow[field]['CURRENCY']['VALUE'] = this.getCurrencyId();\n\t\t});\n\t\tthis.setGridEditData(editData);\n\t}\n\n\t#getCalculatePriceFieldNames(): []\n\t{\n\t\treturn [\n\t\t\t'BASE_PRICE',\n\t\t\t'TAX_INCLUDED',\n\t\t\t'PRICE_NETTO',\n\t\t\t'PRICE_BRUTTO',\n\t\t\t'DISCOUNT_ROW',\n\t\t\t'DISCOUNT_SUM',\n\t\t\t'CURRENCY'\n\t\t];\n\t}\n\n\tonCalculatePricesResponse(products: [])\n\t{\n\t\tthis.products.forEach((product) => {\n\t\t\tif (Type.isObject(products[product.getId()]))\n\t\t\t{\n\t\t\t\tproduct.updateUiCurrencyFields();\n\t\t\t\t['BASE_PRICE', 'DISCOUNT_ROW', 'DISCOUNT_SUM', 'CURRENCY_ID'].forEach((name) => {\n\t\t\t\t\tproduct.updateField(name, Text.toNumber(products[product.getId()][name]));\n\t\t\t\t});\n\t\t\t\tproduct.setField('CURRENCY', products[product.getId()]['CURRENCY_ID']);\n\t\t\t}\n\t\t});\n\n\t\tthis.updateTotalUiCurrency();\n\t}\n\n\tupdateTotalUiCurrency()\n\t{\n\t\tconst totalBlock = BX(this.getSettingValue('totalBlockContainerId', null));\n\t\tif (Type.isElementNode(totalBlock))\n\t\t{\n\t\t\ttotalBlock.querySelectorAll('.crm-product-list-payment-side-table-column').forEach((column) => {\n\t\t\t\tconst valueElement = column.querySelector('.crm-product-list-result-grid-total');\n\t\t\t\tif (valueElement)\n\t\t\t\t{\n\t\t\t\t\tcolumn.innerHTML = CurrencyCore.getPriceControl(valueElement, this.getCurrencyId());\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tgetCurrencyText(): string\n\t{\n\t\tconst currencyId = this.getCurrencyId();\n\t\tif (!Type.isStringFilled(currencyId))\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\tconst format = CurrencyCore.getCurrencyFormat(currencyId);\n\n\t\treturn format && format.FORMAT_STRING.replace(/(^|[^&])#/, '$1').trim() || currencyId;\n\t}\n\n\tgetDataFieldName()\n\t{\n\t\treturn this.getSettingValue('dataFieldName', '');\n\t}\n\n\tgetDataSettingsFieldName()\n\t{\n\t\tconst field = this.getDataFieldName();\n\n\t\treturn Type.isStringFilled(field) ? field + '_SETTINGS' : '';\n\t}\n\n\tgetDiscountEnabled(): 'Y' | 'N'\n\t{\n\t\treturn this.getSettingValue('enableDiscount', 'N');\n\t}\n\n\tgetPricePrecision(): number\n\t{\n\t\treturn this.getSettingValue('pricePrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetQuantityPrecision(): number\n\t{\n\t\treturn this.getSettingValue('quantityPrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetCommonPrecision(): number\n\t{\n\t\treturn this.getSettingValue('commonPrecision', DEFAULT_PRECISION);\n\t}\n\n\tgetTaxList(): Array\n\t{\n\t\treturn this.getSettingValue('taxList', []);\n\t}\n\n\tgetTaxAllowed(): 'Y' | 'N'\n\t{\n\t\treturn this.getSettingValue('allowTax', 'N');\n\t}\n\n\tisTaxAllowed(): boolean\n\t{\n\t\treturn this.getTaxAllowed() === 'Y';\n\t}\n\n\tgetTaxEnabled(): 'Y' | 'N'\n\t{\n\t\treturn this.getSettingValue('enableTax', 'N');\n\t}\n\n\tisTaxEnabled(): boolean\n\t{\n\t\treturn this.getTaxEnabled() === 'Y';\n\t}\n\n\tisTaxUniform(): boolean\n\t{\n\t\treturn this.getSettingValue('taxUniform', true);\n\t}\n\n\tgetMeasures(): []\n\t{\n\t\treturn this.getSettingValue('measures', []);\n\t}\n\n\tgetDefaultMeasure()\n\t{\n\t\treturn this.getSettingValue('defaultMeasure', {});\n\t}\n\n\tgetRowIdPrefix()\n\t{\n\t\treturn this.getSettingValue('rowIdPrefix', 'crm_entity_product_list_');\n\t}\n\n\t/* settings tools finish */\n\n\t/* calculate tools */\n\tparseInt(value: number | string, defaultValue: number = 0)\n\t{\n\t\tlet result;\n\n\t\tconst isNumberValue = Type.isNumber(value);\n\t\tconst isStringValue = Type.isStringFilled(value);\n\n\t\tif (!isNumberValue && !isStringValue)\n\t\t{\n\t\t\treturn defaultValue;\n\t\t}\n\n\t\tif (isStringValue)\n\t\t{\n\t\t\tvalue = value.replace(/^\\s+|\\s+$/g, '');\n\t\t\tconst isNegative = value.indexOf('-') === 0;\n\t\t\tresult = parseInt(value.replace(/[^\\d]/g, ''), 10);\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (isNegative)\n\t\t\t\t{\n\t\t\t\t\tresult = -result;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = parseInt(value, 10);\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tparseFloat(value: number | string, precision: number = DEFAULT_PRECISION, defaultValue: number = 0.0)\n\t{\n\t\tlet result;\n\n\t\tconst isNumberValue = Type.isNumber(value);\n\t\tconst isStringValue = Type.isStringFilled(value);\n\n\t\tif (!isNumberValue && !isStringValue)\n\t\t{\n\t\t\treturn defaultValue;\n\t\t}\n\n\t\tif (isStringValue)\n\t\t{\n\t\t\tvalue = value.replace(/^\\s+|\\s+$/g, '');\n\n\t\t\tconst dot = value.indexOf('.');\n\t\t\tconst comma = value.indexOf(',');\n\t\t\tconst isNegative = value.indexOf('-') === 0;\n\n\t\t\tif (dot < 0 && comma >= 0)\n\t\t\t{\n\t\t\t\tlet s1 = value.substr(0, comma);\n\t\t\t\tconst decimalLength = value.length - comma - 1;\n\n\t\t\t\tif (decimalLength > 0)\n\t\t\t\t{\n\t\t\t\t\ts1 += '.' + value.substr(comma + 1, decimalLength);\n\t\t\t\t}\n\n\t\t\t\tvalue = s1;\n\t\t\t}\n\n\t\t\tvalue = value.replace(/[^\\d.]+/g, '');\n\t\t\tresult = parseFloat(value);\n\n\t\t\tif (isNaN(result))\n\t\t\t{\n\t\t\t\tresult = defaultValue;\n\t\t\t}\n\t\t\tif (isNegative)\n\t\t\t{\n\t\t\t\tresult = -result;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = parseFloat(value);\n\t\t}\n\n\t\tif (precision >= 0)\n\t\t{\n\t\t\tresult = this.round(result, precision);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tround(value: number, precision: number = DEFAULT_PRECISION)\n\t{\n\t\tconst factor = Math.pow(10, precision);\n\n\t\treturn Math.round(value * factor) / factor;\n\t}\n\n\tcalculatePriceWithoutDiscount(price, discount, discountType)\n\t{\n\t\tlet result = 0.0;\n\n\t\tswitch (discountType)\n\t\t{\n\t\t\tcase DiscountType.PERCENTAGE:\n\t\t\t\tresult = (price - ((price * discount) / 100));\n\t\t\t\tbreak;\n\n\t\t\tcase DiscountType.MONETARY:\n\t\t\t\tresult = (price - discount);\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tcalculateDiscountRate(originalPrice, price)\n\t{\n\t\tif (originalPrice === 0.0)\n\t\t{\n\t\t\treturn 0.0;\n\t\t}\n\n\t\tif (price === 0.0)\n\t\t{\n\t\t\treturn originalPrice > 0 ? 100.0 : -100.0;\n\t\t}\n\n\t\treturn ((100 * (originalPrice - price)) / originalPrice);\n\t}\n\n\tcalculateDiscount(originalPrice, discountRate)\n\t{\n\t\treturn originalPrice * discountRate / 100;\n\t}\n\n\tcalculatePriceWithoutTax(price, taxRate)\n\t{\n\t\t// Tax is not included in price\n\t\treturn price / (1 + (taxRate / 100));\n\t}\n\n\tcalculatePriceWithTax(price, taxRate)\n\t{\n\t\t// Tax is included in price\n\t\treturn price * (1 + (taxRate / 100));\n\t}\n\n\t/* calculate tools finish */\n\n\tgetContainer()\n\t{\n\t\treturn this.cache.remember('container', () => {\n\t\t\treturn document.getElementById(this.getContainerId());\n\t\t});\n\t}\n\n\tinitForm()\n\t{\n\t\tconst formId = this.getSettingValue('formId', '');\n\t\tconst form = Type.isStringFilled(formId) ? BX('form_' + formId) : null;\n\n\t\tif (Type.isElementNode(form))\n\t\t{\n\t\t\tthis.setForm(form);\n\t\t}\n\t}\n\n\tisExistForm()\n\t{\n\t\treturn Type.isElementNode(this.getForm());\n\t}\n\n\tgetForm()\n\t{\n\t\treturn this.form;\n\t}\n\n\tsetForm(form)\n\t{\n\t\tthis.form = form;\n\t}\n\n\tinitFormFields()\n\t{\n\t\tconst container = this.getForm();\n\t\tif (Type.isElementNode(container))\n\t\t{\n\t\t\tconst field = this.getDataField();\n\t\t\tif (!Type.isElementNode(field))\n\t\t\t{\n\t\t\t\tthis.initDataField();\n\t\t\t}\n\n\t\t\tconst settingsField = this.getDataSettingsField();\n\t\t\tif (!Type.isElementNode(settingsField))\n\t\t\t{\n\t\t\t\tthis.initDataSettingsField();\n\t\t\t}\n\t\t}\n\t}\n\n\tinitFormField(fieldName)\n\t{\n\t\tconst container = this.getForm();\n\n\t\tif (Type.isElementNode(container) && Type.isStringFilled(fieldName))\n\t\t{\n\t\t\tDom.append(\n\t\t\t\tDom.create(\n\t\t\t\t\t'input',\n\t\t\t\t\t{attrs: {type: \"hidden\", name: fieldName}}\n\t\t\t\t),\n\t\t\t\tcontainer\n\t\t\t)\n\t\t}\n\t}\n\n\tremoveFormFields()\n\t{\n\t\tconst field = this.getDataField();\n\t\tif (Type.isElementNode(field))\n\t\t{\n\t\t\tDom.remove(field);\n\t\t}\n\n\t\tconst settingsField = this.getDataSettingsField();\n\t\tif (Type.isElementNode(settingsField))\n\t\t{\n\t\t\tDom.remove(settingsField);\n\t\t}\n\t}\n\n\tinitDataField()\n\t{\n\t\tthis.initFormField(this.getDataFieldName());\n\t}\n\n\tinitDataSettingsField()\n\t{\n\t\tthis.initFormField(this.getDataSettingsFieldName());\n\t}\n\n\tgetFormField(fieldName)\n\t{\n\t\tconst container = this.getForm();\n\n\t\tif (Type.isElementNode(container) && Type.isStringFilled(fieldName))\n\t\t{\n\t\t\treturn container.querySelector('input[name=\"' + fieldName + '\"]');\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetDataField()\n\t{\n\t\treturn this.getFormField(this.getDataFieldName());\n\t}\n\n\tgetDataSettingsField()\n\t{\n\t\treturn this.getFormField(this.getDataSettingsFieldName());\n\t}\n\n\tgetProductCount()\n\t{\n\t\treturn this.products\n\t\t\t.filter(item => !item.isEmpty())\n\t\t\t.length\n\t\t\t;\n\t}\n\n\tinitProducts()\n\t{\n\t\tconst list = this.getSettingValue('items', []);\n\n\t\tconst isReserveBlocked = this.getSettingValue('isReserveBlocked', false);\n\t\tconst isInventoryManagementToolEnabled = this.getSettingValue('isInventoryManagementToolEnabled', false);\n\t\tconst inventoryManagementMode = this.getSettingValue('inventoryManagementMode', null);\n\n\t\tfor (const item of list)\n\t\t{\n\t\t\tconst fields = {...item.fields};\n\t\t\tconst settings = {\n\t\t\t\tselectorId: item.selectorId,\n\t\t\t\tisReserveBlocked,\n\t\t\t\tisInventoryManagementToolEnabled,\n\t\t\t\tinventoryManagementMode,\n\t\t\t};\n\t\t\tthis.products.push(new Row(item.rowId, fields, settings, this));\n\t\t}\n\n\t\tthis.numerateRows();\n\n\t\tthis.productsWasInitiated = true;\n\t}\n\n\tnumerateRows()\n\t{\n\t\tthis.products.forEach((product, index) => {\n\t\t\tproduct.setRowNumber(index + 1);\n\t\t})\n\t}\n\n\tgetGrid(): ?BX.Main.Grid\n\t{\n\t\treturn this.cache.remember('grid', () => {\n\t\t\tconst gridId = this.getGridId();\n\n\t\t\tif (!Reflection.getClass('BX.Main.gridManager.getInstanceById'))\n\t\t\t{\n\t\t\t\tthrow Error(`Cannot find grid with '${gridId}' id.`)\n\t\t\t}\n\n\t\t\treturn BX.Main.gridManager.getInstanceById(gridId);\n\t\t});\n\t}\n\n\tinitGridData()\n\t{\n\t\tconst gridEditData = this.getSettingValue('templateGridEditData', null);\n\t\tif (gridEditData)\n\t\t{\n\t\t\tthis.setGridEditData(gridEditData);\n\t\t}\n\t}\n\n\tgetGridEditData()\n\t{\n\t\treturn this.getGrid().arParams.EDITABLE_DATA;\n\t}\n\n\tsetGridEditData(data: {})\n\t{\n\t\tthis.getGrid().arParams.EDITABLE_DATA = data;\n\t}\n\n\tsetOriginalTemplateEditData(data)\n\t{\n\t\tthis.getGrid().arParams.EDITABLE_DATA[GRID_TEMPLATE_ROW] = data;\n\t}\n\n\thandleProductErrorsChange()\n\t{\n\t\tif (this.#childrenHasErrors())\n\t\t{\n\t\t\tthis.controller.disableSaveButton();\n\t\t}\n\t}\n\n\t#childrenHasErrors()\n\t{\n\t\treturn this.products\n\t\t\t.filter((product) => product.getModel().getErrorCollection().hasErrors())\n\t\t\t.length > 0\n\t\t;\n\t}\n\n\thandleFieldChange(event)\n\t{\n\t\tconst row = event.target.closest('tr');\n\t\tif (row && row.hasAttribute('data-id'))\n\t\t{\n\t\t\tconst product = this.getProductById(row.getAttribute('data-id'));\n\t\t\tif (product)\n\t\t\t{\n\t\t\t\tconst cell = event.target.closest('td');\n\t\t\t\tconst fieldCode = this.getFieldCodeByGridCell(row, cell);\n\t\t\t\tif (fieldCode)\n\t\t\t\t{\n\t\t\t\t\tproduct.updateFieldByEvent(fieldCode, event);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\thandleDropdownChange(event: BaseEvent)\n\t{\n\t\tconst [dropdownId, , , , value] = event.getData();\n\t\tconst regExp = new RegExp(this.getRowIdPrefix() + '([A-Za-z0-9]+)_(\\\\w+)_control', 'i');\n\t\tconst matches = dropdownId.match(regExp);\n\t\tif (matches)\n\t\t{\n\t\t\tconst [, rowId, fieldCode] = matches;\n\t\t\tconst product = this.getProductById(rowId);\n\t\t\tif (product)\n\t\t\t{\n\t\t\t\tproduct.updateField(fieldCode, value, product.modeChanges.EDIT);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetProductById(id: string): ?Row\n\t{\n\t\tconst rowId = this.getRowIdPrefix() + id;\n\n\t\treturn this.getProductByRowId(rowId);\n\t}\n\n\tgetProductByRowId(rowId: string): ?Row\n\t{\n\t\treturn this.products.find((row: Row) => {\n\t\t\treturn row.getId() === rowId;\n\t\t});\n\t}\n\n\tgetFieldCodeByGridCell(row: HTMLTableRowElement, cell: HTMLTableCellElement): ?string\n\t{\n\t\tif (!Type.isDomNode(row) || !Type.isDomNode(cell))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst grid = this.getGrid();\n\t\tif (grid)\n\t\t{\n\t\t\tconst headRow = grid.getRows().getHeadFirstChild();\n\t\t\tconst index = [...row.cells].indexOf(cell);\n\n\t\t\treturn headRow.getCellNameByCellIndex(index);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\thandleProductSelectionPopup(event)\n\t{\n\t\tconst caller = 'crm_entity_product_list';\n\t\tconst jsEventsManagerId = this.getSettingValue('jsEventsManagerId', '');\n\n\t\tconst popup = new BX.CDialog({\n\t\t\tcontent_url: '/bitrix/components/bitrix/crm.product_row.list/product_choice_dialog.php?'\n\t\t\t\t+ 'caller=' + caller\n\t\t\t\t+ '&JS_EVENTS_MANAGER_ID=' + BX.util.urlencode(jsEventsManagerId)\n\t\t\t\t+ '&sessid=' + BX.bitrix_sessid(),\n\t\t\theight: Math.max(500, window.innerHeight - 400),\n\t\t\twidth: Math.max(800, window.innerWidth - 400),\n\t\t\tdraggable: true,\n\t\t\tresizable: true,\n\t\t\tmin_height: 500,\n\t\t\tmin_width: 800,\n\t\t\tzIndex: 800\n\t\t});\n\n\t\tEventEmitter.subscribeOnce(popup, 'onWindowRegister', BX.defer(() => {\n\t\t\tpopup.Get().style.position = 'fixed';\n\t\t\tpopup.Get().style.top = (parseInt(popup.Get().style.top) - BX.GetWindowScrollPos().scrollTop) + 'px';\n\t\t}));\n\n\t\tEventEmitter.subscribeOnce(window, 'EntityProductListController:onInnerCancel', BX.defer(() => {\n\t\t\tpopup.Close();\n\t\t}));\n\n\t\tif (!Type.isUndefined(BX.Crm.EntityEvent))\n\t\t{\n\t\t\tEventEmitter.subscribeOnce(window, BX.Crm.EntityEvent.names.update, BX.defer(() => {\n\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\tpopup.Close()\n\t\t\t\t}, 0);\n\t\t\t}));\n\t\t}\n\n\t\tpopup.Show();\n\t}\n\n\taddProductRow(anchorProduct: Row = null): string\n\t{\n\t\tconst row = this.createGridProductRow();\n\t\tconst newId = row.getId();\n\n\t\tif (anchorProduct)\n\t\t{\n\t\t\tconst anchorRowNode = this.getGrid().getRows().getById(anchorProduct.getField('ID'))?.getNode();\n\t\t\tif (anchorRowNode)\n\t\t\t{\n\t\t\t\tanchorRowNode.parentNode.insertBefore(row.getNode(), anchorRowNode.nextSibling);\n\t\t\t}\n\t\t}\n\n\t\tthis.initializeNewProductRow(newId, anchorProduct);\n\t\tthis.getGrid().bindOnRowEvents();\n\t\treturn newId;\n\t}\n\n\thandleProductRowAdd(): void\n\t{\n\t\tif (this.getSettingValue('isOnecInventoryManagementRestricted') === true)\n\t\t{\n\t\t\tOneCPlanRestrictionSlider.show();\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst id = this.addProductRow();\n\t\tthis.focusProductSelector(id);\n\t}\n\n\thandleShowSettingsPopup()\n\t{\n\t\tthis.getSettingsPopup().show();\n\t}\n\n\tdestroySettingsPopup()\n\t{\n\t\tif (this.cache.has('settings-popup'))\n\t\t{\n\t\t\tthis.cache.get('settings-popup').getPopup().destroy();\n\t\t\tthis.cache.delete('settings-popup');\n\t\t}\n\t}\n\n\tgetSettingsPopup()\n\t{\n\t\treturn this.cache.remember('settings-popup', () => {\n\t\t\treturn new SettingsPopup(\n\t\t\t\tthis.getContainer().querySelector('.crm-entity-product-list-add-block-active [data-role=\"product-list-settings-button\"]'),\n\t\t\t\tthis.getSettingValue('popupSettings', []),\n\t\t\t\tthis\n\t\t\t);\n\t\t});\n\t}\n\n\tgetHintPopup(): HintPopup\n\t{\n\t\treturn this.cache.remember('hint-popup', () => {\n\t\t\treturn new HintPopup(this);\n\t\t});\n\t}\n\n\tcreateGridProductRow(): BX.Grid.Row\n\t{\n\t\tconst newId = Text.getRandom();\n\t\tconst originalTemplate = this.redefineTemplateEditData(newId);\n\n\t\tconst grid = this.getGrid();\n\t\tlet newRow;\n\t\tif (this.getSettingValue('newRowPosition') === 'bottom')\n\t\t{\n\t\t\tnewRow = grid.appendRowEditor();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tnewRow = grid.prependRowEditor();\n\t\t}\n\n\t\tconst newNode = newRow.getNode();\n\n\t\tif (Type.isDomNode(newNode))\n\t\t{\n\t\t\tnewNode.setAttribute('data-id', newId);\n\t\t\tnewRow.makeCountable();\n\t\t}\n\n\t\tif (originalTemplate)\n\t\t{\n\t\t\tthis.setOriginalTemplateEditData(originalTemplate);\n\t\t}\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tgrid.adjustRows();\n\t\tgrid.updateCounterDisplayed();\n\t\tgrid.updateCounterSelected();\n\n\t\treturn newRow;\n\t}\n\n\thandleDeleteRow(rowId, event: BaseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tthis.deleteRow(rowId);\n\t}\n\n\tredefineTemplateEditData(newId: string)\n\t{\n\t\tconst data = this.getGridEditData();\n\t\tconst originalTemplateData = data[GRID_TEMPLATE_ROW];\n\t\tconst customEditData = this.prepareCustomEditData(originalTemplateData, newId);\n\n\t\tthis.setOriginalTemplateEditData({...originalTemplateData, ...customEditData})\n\n\t\treturn originalTemplateData;\n\t}\n\n\tprepareCustomEditData(originalEditData, newId)\n\t{\n\t\tconst customEditData = {};\n\t\tconst templateIdMask = this.getSettingValue('templateIdMask', '');\n\n\t\tfor (let i in originalEditData)\n\t\t{\n\t\t\tif (originalEditData.hasOwnProperty(i))\n\t\t\t{\n\t\t\t\tif (Type.isStringFilled(originalEditData[i]) && originalEditData[i].indexOf(templateIdMask) >= 0)\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = originalEditData[i].replace(\n\t\t\t\t\t\tnew RegExp(templateIdMask, 'g'),\n\t\t\t\t\t\tnewId\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\telse if (Type.isPlainObject(originalEditData[i]))\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = this.prepareCustomEditData(originalEditData[i], newId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tcustomEditData[i] = originalEditData[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn customEditData;\n\t}\n\n\tinitializeNewProductRow(newId, anchorProduct: Row = null): Row\n\t{\n\t\tlet fields = anchorProduct?.getFields();\n\t\tif (Type.isNil(fields))\n\t\t{\n\t\t\tfields = {\n\t\t\t\t...this.getSettingValue('templateItemFields', {}),\n\t\t\t\t...{\n\t\t\t\t\tCURRENCY: this.getCurrencyId()\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconst lastItem = this.products[this.products.length - 1];\n\t\t\tif (lastItem)\n\t\t\t{\n\t\t\t\tfields.TAX_INCLUDED = lastItem.getField('TAX_INCLUDED');\n\t\t\t}\n\t\t}\n\n\t\tconst rowId = this.getRowIdPrefix() + newId;\n\t\tfields.ID = newId;\n\t\tif (Type.isObject(fields.IMAGE_INFO))\n\t\t{\n\t\t\tdelete(fields.IMAGE_INFO.input);\n\t\t}\n\t\tdelete(fields.RESERVE_ID);\n\t\tconst isReserveBlocked = this.getSettingValue('isReserveBlocked', false);\n\t\tconst isInventoryManagementToolEnabled = this.getSettingValue('isInventoryManagementToolEnabled', false);\n\t\tconst inventoryManagementMode = this.getSettingValue('inventoryManagementMode', null);\n\n\t\tconst settings = {\n\t\t\tisReserveBlocked,\n\t\t\tisInventoryManagementToolEnabled,\n\t\t\tinventoryManagementMode,\n\t\t\tselectorId: 'crm_grid_' + rowId,\n\t\t};\n\t\tconst product = new Row(rowId, fields, settings, this);\n\t\tproduct.refreshFieldsLayout();\n\n\t\tif (anchorProduct instanceof Row)\n\t\t{\n\t\t\tthis.products.splice(1 + this.products.indexOf(anchorProduct), 0, product);\n\n\t\t\tproduct.getSelector()?.reloadFileInput();\n\t\t\tproduct.getSelector()?.layout();\n\t\t\tproduct.updateUiMeasure(\n\t\t\t\tproduct.getField('MEASURE_CODE'),\n\t\t\t\tText.encode(product.getField('MEASURE_NAME'))\n\t\t\t);\n\t\t}\n\t\telse if (this.getSettingValue('newRowPosition') === 'bottom')\n\t\t{\n\t\t\tthis.products.push(product);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.products.unshift(product);\n\t\t}\n\n\t\tthis.refreshSortFields();\n\t\tthis.numerateRows();\n\n\t\tproduct.updateUiCurrencyFields();\n\t\tthis.updateTotalUiCurrency();\n\n\t\tproduct\n\t\t\t.getSelector()\n\t\t\t?.setConfig(\n\t\t\t\t'ENABLE_EMPTY_PRODUCT_ERROR',\n\t\t\t\tthis.getSettingValue('enableEmptyProductError', false)\n\t\t\t)\n\t\t;\n\t\treturn product;\n\t}\n\n\tisTaxIncludedActive(): boolean\n\t{\n\t\treturn this.products\n\t\t\t.filter((product) => product.isTaxIncluded())\n\t\t\t.length > 0\n\t\t;\n\t}\n\n\tgetProductSelector(newId: string): ?ProductSelector\n\t{\n\t\treturn ProductSelector.getById('crm_grid_' + this.getRowIdPrefix() + newId);\n\t}\n\n\tfocusProductSelector(newId: string): void\n\t{\n\t\trequestAnimationFrame(() => {\n\t\t\tthis\n\t\t\t\t.getProductSelector(newId)\n\t\t\t\t?.searchInDialog()\n\t\t\t\t.focusName()\n\t\t\t;\n\t\t});\n\t}\n\n\thandleOnBeforeProductChange(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\t\tconst product = this.getProductByRowId(data.rowId);\n\t\tif (product)\n\t\t{\n\t\t\tthis.getGrid().tableFade();\n\t\t\tproduct.resetExternalActions();\n\t\t}\n\t}\n\n\thandleOnProductChange(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\n\t\tconst productRow = this.getProductByRowId(data.rowId);\n\t\tif (productRow && data.fields)\n\t\t{\n\t\t\tconst promise = new Promise((resolve, reject) => {\n\t\t\t\tconst fields = data.fields;\n\n\t\t\t\tif (!Type.isNil(fields['IMAGE_INFO']))\n\t\t\t\t{\n\t\t\t\t\tfields['IMAGE_INFO'] = JSON.stringify(fields['IMAGE_INFO']);\n\t\t\t\t}\n\n\t\t\t\tif (this.getCurrencyId() !== fields['CURRENCY_ID'])\n\t\t\t\t{\n\t\t\t\t\tfields['CURRENCY'] = fields['CURRENCY_ID'];\n\n\t\t\t\t\tconst priceFields = {};\n\t\t\t\t\tthis.#getCalculatePriceFieldNames().forEach((name) => {\n\t\t\t\t\t\tpriceFields[name] = data.fields[name]\n\t\t\t\t\t});\n\n\t\t\t\t\tconst products = [{\n\t\t\t\t\t\tfields: priceFields,\n\t\t\t\t\t\tid: productRow.getId()\n\t\t\t\t\t}];\n\n\t\t\t\t\tajax.runComponentAction(\n\t\t\t\t\t\tthis.getComponentName(),\n\t\t\t\t\t\t'calculateProductPrices',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmode: 'class',\n\t\t\t\t\t\t\tsignedParameters: this.getSignedParameters(),\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tproducts,\n\t\t\t\t\t\t\t\tcurrencyId: this.getCurrencyId(),\n\t\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\t\tACTION: 'calculateProductPrices'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t).then(\n\t\t\t\t\t\t(response) => {\n\t\t\t\t\t\t\tconst changedFields = response.data.result[productRow.getId()];\n\t\t\t\t\t\t\tif (changedFields)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tchangedFields['CUSTOMIZED'] = 'Y';\n\t\t\t\t\t\t\t\tresolve(Object.assign(fields, changedFields));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tresolve(fields);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tresolve(fields);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tpromise.then((fields) => {\n\t\t\t\tif (this.products.length > 1)\n\t\t\t\t{\n\t\t\t\t\tconst taxId = fields['VAT_ID'] || fields['TAX_ID'];\n\t\t\t\t\tconst taxIncluded = fields['VAT_INCLUDED'] || fields['TAX_INCLUDED'];\n\n\t\t\t\t\tif (taxId > 0 && taxIncluded !== productRow.getTaxIncluded())\n\t\t\t\t\t{\n\t\t\t\t\t\tconst taxRate = this.getTaxList()?.find((item) => parseInt(item.ID) === taxId);\n\t\t\t\t\t\tif (taxRate?.VALUE > 0 && taxIncluded === 'Y')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfields['BASE_PRICE'] = fields['BASE_PRICE'] / (1 + taxRate.VALUE / 100);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t['TAX_INCLUDED', 'VAT_INCLUDED'].forEach(name => delete(fields[name]));\n\t\t\t\t}\n\n\t\t\t\tif (productRow.getField('OFFER_ID') !== fields.ID)\n\t\t\t\t{\n\t\t\t\t\tfields['ROW_RESERVED'] = 0;\n\t\t\t\t\tfields['DEDUCTED_QUANTITY'] = 0;\n\t\t\t\t\tif (!this.getSettingValue('allowDiscountChange', true))\n\t\t\t\t\t{\n\t\t\t\t\t\tfields['DISCOUNT_ROW'] = 0;\n\t\t\t\t\t\tfields['DISCOUNT_SUM'] = 0;\n\t\t\t\t\t\tfields['DISCOUNT_RATE'] = 0;\n\t\t\t\t\t\tfields['DISCOUNT'] = 0;\n\t\t\t\t\t\tproductRow.updateUiHtmlField(\n\t\t\t\t\t\t\t'DISCOUNT_PRICE',\n\t\t\t\t\t\t\tCurrencyCore.currencyFormat(0, this.getCurrencyId(), true)\n\t\t\t\t\t\t);\n\t\t\t\t\t\tproductRow.updateUiHtmlField(\n\t\t\t\t\t\t\t'DISCOUNT_ROW',\n\t\t\t\t\t\t\tCurrencyCore.currencyFormat(0, this.getCurrencyId(), true)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tObject.keys(fields).forEach((key) => {\n\t\t\t\t\tproductRow.updateFieldValue(key, fields[key]);\n\t\t\t\t});\n\n\t\t\t\tif (!Type.isStringFilled(fields['CUSTOMIZED']))\n\t\t\t\t{\n\t\t\t\t\tproductRow.setField('CUSTOMIZED', 'N');\n\t\t\t\t}\n\n\t\t\t\tproductRow.setField('IS_NEW', data.isNew ? 'Y' : 'N');\n\n\t\t\t\tproductRow.layoutReserveControl();\n\t\t\t\tproductRow.layoutStoreSelector();\n\t\t\t\tproductRow.initHandlersForSelectors();\n\t\t\t\tproductRow.updateUiStoreAmountData();\n\t\t\t\tproductRow.updatePropertyFields();\n\t\t\t\tproductRow.modifyBasePriceInput();\n\t\t\t\tproductRow.executeExternalActions();\n\t\t\t\tthis.getGrid().tableUnfade();\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getGrid().tableUnfade();\n\t\t}\n\t}\n\n\thandleOnBeforeProductClear(event: BaseEvent)\n\t{\n\t\tconst {rowId} = event.getData();\n\t\tconst product = this.getProductByRowId(rowId);\n\t\tproduct.clearPropertyFields();\n\t}\n\n\thandleOnProductClear(event: BaseEvent)\n\t{\n\t\tconst {rowId} = event.getData();\n\n\t\tconst product = this.getProductByRowId(rowId);\n\t\tif (product)\n\t\t{\n\t\t\tproduct.layoutReserveControl();\n\t\t\tproduct.initHandlersForSelectors();\n\t\t\tproduct.changeBasePrice(0);\n\t\t\tif (!this.getSettingValue('allowDiscountChange', true))\n\t\t\t{\n\t\t\t\tproduct.setDiscount(0);\n\t\t\t\tproduct.updateUiHtmlField(\n\t\t\t\t\t'DISCOUNT_PRICE',\n\t\t\t\t\tCurrencyCore.currencyFormat(0, this.getCurrencyId(), true)\n\t\t\t\t);\n\t\t\t\tproduct.updateUiHtmlField(\n\t\t\t\t\t'DISCOUNT_ROW',\n\t\t\t\t\tCurrencyCore.currencyFormat(0, this.getCurrencyId(), true)\n\t\t\t\t);\n\t\t\t}\n\t\t\tproduct.modifyBasePriceInput();\n\t\t\tproduct.executeExternalActions();\n\t\t}\n\t}\n\n\tcompileProductData(): void\n\t{\n\t\tif (!this.isExistForm())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.initFormFields();\n\n\t\tconst field = this.getDataField();\n\t\tconst settingsField = this.getDataSettingsField();\n\n\t\tthis.cleanProductRows();\n\n\t\tif (Type.isElementNode(field) && Type.isElementNode(settingsField))\n\t\t{\n\t\t\tfield.value = this.prepareProductDataValue();\n\n\t\t\tsettingsField.value = JSON.stringify({\n\t\t\t\tENABLE_DISCOUNT: this.getDiscountEnabled(),\n\t\t\t\tENABLE_TAX: this.getTaxEnabled()\n\t\t\t});\n\t\t}\n\n\t\tthis.addFirstRowIfEmpty();\n\t}\n\n\tprepareProductDataValue(): string\n\t{\n\t\tlet productDataValue = '';\n\n\t\tif (this.getProductCount())\n\t\t{\n\t\t\tconst productData = [];\n\n\t\t\tthis.products.forEach((item) => {\n\t\t\t\tconst saveFields = item.getFields(Editor.#getAjaxFields());\n\n\t\t\t\tif (!/^[0-9]+$/.test(saveFields['ID']))\n\t\t\t\t{\n\t\t\t\t\tsaveFields['ID'] = 0;\n\t\t\t\t}\n\n\t\t\t\tsaveFields['CUSTOMIZED'] = 'Y';\n\n\t\t\t\tproductData.push(saveFields);\n\t\t\t});\n\n\t\t\tproductDataValue = JSON.stringify(productData);\n\t\t}\n\n\t\treturn productDataValue;\n\t}\n\n\tstatic #getAjaxFields(): []\n\t{\n\t\treturn [\n\t\t\t'ID',\n\t\t\t'PRODUCT_ID',\n\t\t\t'PRODUCT_NAME',\n\t\t\t'QUANTITY',\n\t\t\t'TAX_RATE',\n\t\t\t'TAX_INCLUDED',\n\t\t\t'PRICE_EXCLUSIVE',\n\t\t\t'PRICE_NETTO',\n\t\t\t'PRICE_BRUTTO',\n\t\t\t'PRICE',\n\t\t\t'CUSTOMIZED',\n\t\t\t'BASE_PRICE',\n\t\t\t'DISCOUNT_ROW',\n\t\t\t'DISCOUNT_SUM',\n\t\t\t'DISCOUNT_TYPE_ID',\n\t\t\t'DISCOUNT_RATE',\n\t\t\t'CURRENCY',\n\t\t\t'STORE_ID',\n\t\t\t'INPUT_RESERVE_QUANTITY',\n\t\t\t'RESERVE_QUANTITY',\n\t\t\t'DATE_RESERVE_END',\n\t\t\t'SORT',\n\t\t\t'MEASURE_CODE',\n\t\t\t'MEASURE_NAME',\n\t\t\t'TYPE',\n\t\t];\n\t}\n\n\t/* actions */\n\texecuteActions(actions)\n\t{\n\t\tif (!Type.isArrayFilled(actions))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst disableSaveButton = actions\n\t\t\t.filter(\n\t\t\t\t(action) => action.type === this.actions.updateTotal || action.type === this.actions.disableSaveButton\n\t\t\t)\n\t\t\t.length > 0\n\t\t;\n\n\t\tfor (const item of actions)\n\t\t{\n\t\t\tif (\n\t\t\t\t!Type.isPlainObject(item)\n\t\t\t\t|| !Type.isStringFilled(item.type)\n\t\t\t)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tswitch (item.type)\n\t\t\t{\n\t\t\t\tcase this.actions.productChange:\n\t\t\t\t\tthis.actionSendProductChange(item, disableSaveButton);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.productListChanged:\n\t\t\t\t\tthis.actionSendProductListChanged(disableSaveButton);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.updateListField:\n\t\t\t\t\tthis.actionUpdateListField(item);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.updateTotal:\n\t\t\t\t\tthis.actionUpdateTotalData();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase this.actions.stateChanged:\n\t\t\t\t\tthis.actionSendStatusChange(item);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tactionSendProductChange(item, disableSaveButton)\n\t{\n\t\tif (!Type.isStringFilled(item.id))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst product = this.getProductByRowId(item.id);\n\t\tif (!product)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tEventEmitter.emit(this, 'ProductList::onChangeFields', {\n\t\t\trowId: item.id,\n\t\t\tproductId: product.getField('PRODUCT_ID'),\n\t\t\tfields: this.getProductByRowId(item.id).getCatalogFields()\n\t\t});\n\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.productChange(disableSaveButton);\n\t\t\tthis.setGridChanged(true);\n\t\t}\n\t}\n\n\tactionSendProductListChanged(disableSaveButton: boolean = false): void\n\t{\n\t\tif (this.controller)\n\t\t{\n\t\t\tthis.controller.productChange(disableSaveButton);\n\t\t\tthis.setGridChanged(true);\n\t\t}\n\t}\n\n\tactionUpdateListField(item)\n\t{\n\t\tif (!Type.isStringFilled(item.field) || !('value' in item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.allowUpdateListField(item.field))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.updateFieldForList = item.field;\n\n\t\tfor (const row of this.products)\n\t\t{\n\t\t\trow.updateFieldByName(item.field, item.value);\n\t\t}\n\n\t\tthis.updateFieldForList = null;\n\t}\n\n\tactionUpdateTotalData(options = {})\n\t{\n\t\tif (this.totalData.inProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.updateTotalDataDelayedHandler(options);\n\t}\n\n\tactionSendStatusChange(item)\n\t{\n\t\tif (!('value' in item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.stateChange.changed === item.value)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.stateChange.changed = item.value;\n\t\tif (this.stateChange.sended)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.stateChange.sended = true;\n\t}\n\n\t/* actions finish */\n\n\t/* action tools */\n\tallowUpdateListField(field)\n\t{\n\t\tif (this.updateFieldForList !== null)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet result = true;\n\n\t\tswitch (field)\n\t\t{\n\t\t\tcase 'TAX_INCLUDED':\n\t\t\t\tresult = this.isTaxUniform() && this.isTaxAllowed();\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tsetGridChanged(changed: boolean)\n\t{\n\t\tthis.isChangedGrid = changed;\n\t}\n\n\tisChanged(): boolean\n\t{\n\t\treturn this.isChangedGrid;\n\t}\n\n\tupdateTotalDataDelayed(options = {})\n\t{\n\t\tif (this.totalData.inProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.totalData.inProgress = true;\n\n\t\tconst products = this.getProductsFields(this.getProductFieldListForTotalData());\n\t\tproducts.forEach(item => item['CUSTOMIZED'] = 'Y');\n\n\t\tthis.ajaxRequest('calculateTotalData', {\n\t\t\toptions,\n\t\t\tproducts,\n\t\t\tcurrencyId: this.getCurrencyId()\n\t\t});\n\t}\n\n\tgetProductsFields(fields: Array = [])\n\t{\n\t\tconst productFields = [];\n\n\t\tfor (const item of this.products)\n\t\t{\n\t\t\tproductFields.push(item.getFields(fields));\n\t\t}\n\n\t\treturn productFields;\n\t}\n\n\tgetProductFieldListForTotalData()\n\t{\n\t\treturn [\n\t\t\t'PRODUCT_ID',\n\t\t\t'PRODUCT_NAME',\n\t\t\t'QUANTITY',\n\t\t\t'DISCOUNT_TYPE_ID',\n\t\t\t'DISCOUNT_RATE',\n\t\t\t'DISCOUNT_SUM',\n\t\t\t'TAX_RATE',\n\t\t\t'TAX_INCLUDED',\n\t\t\t'PRICE_EXCLUSIVE',\n\t\t\t'PRICE',\n\t\t\t'CUSTOMIZED'\n\t\t];\n\t}\n\n\tsetTotalData(data, options = {})\n\t{\n\t\tconst item = BX(this.getSettingValue('totalBlockContainerId', null));\n\t\tif (Type.isElementNode(item))\n\t\t{\n\t\t\tconst currencyId = this.getCurrencyId();\n\t\t\tconst list = ['totalCost', 'totalDelivery', 'totalTax', 'totalWithoutTax', 'totalDiscount', 'totalWithoutDiscount'];\n\n\t\t\tfor (const id of list)\n\t\t\t{\n\t\t\t\tconst row = item.querySelector('[data-total=\"' + id + '\"]');\n\n\t\t\t\tif (Type.isElementNode(row) && (id in data))\n\t\t\t\t{\n\t\t\t\t\trow.innerHTML = CurrencyCore.currencyFormat(data[id], currencyId, false);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.sendTotalData(data, options);\n\t\tthis.totalData.inProgress = false;\n\t}\n\n\tsendTotalData(data, options)\n\t{\n\t\tif (this.controller)\n\t\t{\n\t\t\tlet needMarkAsChanged = true;\n\t\t\tif (\n\t\t\t\tType.isObject(options)\n\t\t\t\t&& (options.isInternalChanging === true || options.isInternalChanging === 'true')\n\t\t\t)\n\t\t\t{\n\t\t\t\tneedMarkAsChanged = false;\n\t\t\t}\n\n\t\t\tsetTimeout(\n\t\t\t\t() => {\n\t\t\t\t\tthis.controller.changeSumTotal(data, needMarkAsChanged, !this.#childrenHasErrors());\n\t\t\t\t},\n\t\t\t\t500\n\t\t\t);\n\t\t}\n\t}\n\n\t/* action tools finish */\n\n\t/* ajax tools */\n\tajaxRequest(action, data)\n\t{\n\t\tconst requestKey = Text.getRandom();\n\t\tthis.ajaxPool.set(action, requestKey);\n\n\t\tif (!Type.isPlainObject(data.options))\n\t\t{\n\t\t\tdata.options = {};\n\t\t}\n\t\tdata.options.ACTION = action;\n\t\tdata.options.REQUEST_KEY = requestKey;\n\n\t\tajax.runComponentAction(\n\t\t\tthis.getComponentName(),\n\t\t\taction,\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tsignedParameters: this.getSignedParameters(),\n\t\t\t\tdata: data\n\t\t\t}\n\t\t).then(\n\t\t\t(response) => this.ajaxResultSuccess(response, data.options),\n\t\t\t(response) => this.ajaxResultFailure(response, data.options)\n\t\t);\n\t}\n\n\tajaxResultSuccess(response, requestOptions)\n\t{\n\t\tif (!this.ajaxResultCommonCheck(response) || this.ajaxPool.get(response.data.action) !== requestOptions.REQUEST_KEY)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.ajaxPool.delete(response.data.action);\n\n\t\tEventEmitter.emit(this, 'onAjaxSuccess', response.data.action);\n\n\t\tswitch (response.data.action)\n\t\t{\n\t\t\tcase 'calculateTotalData':\n\t\t\t\tif (Type.isPlainObject(response.data.result))\n\t\t\t\t{\n\t\t\t\t\tthis.setTotalData(response.data.result, requestOptions);\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\tcase 'calculateProductPrices':\n\t\t\t\tif (Type.isPlainObject(response.data.result))\n\t\t\t\t{\n\t\t\t\t\tthis.onCalculatePricesResponse(response.data.result);\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tvalidateSubmit()\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst currentBalloon = BX.UI.Notification.Center.getBalloonByCategory(ProductModel.SAVE_NOTIFICATION_CATEGORY);\n\t\t\tif (currentBalloon)\n\t\t\t{\n\t\t\t\tEventEmitter.subscribeOnce(\n\t\t\t\t\tcurrentBalloon,\n\t\t\t\t\tBX.UI.Notification.Event.getFullName('onClose'),\n\t\t\t\t\t() => {\n\t\t\t\t\t\tsetTimeout(resolve, 500);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\tcurrentBalloon.close();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tsetTimeout(resolve(), 50);\n\t\t\t}\n\t\t});\n\t}\n\n\tajaxResultFailure(response, requestOptions)\n\t{\n\t\tthis.ajaxPool.delete(requestOptions.ACTION);\n\t}\n\n\tajaxResultCommonCheck(responce)\n\t{\n\t\tif (!Type.isPlainObject(responce))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isStringFilled(responce.status))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (responce.status !== 'success')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isPlainObject(responce.data))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isStringFilled(responce.data.action))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\t// noinspection RedundantIfStatementJS\n\t\tif (!('result' in responce.data))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tdeleteRow(rowId: string, skipActions: boolean = false): void\n\t{\n\t\tif (!Type.isStringFilled(rowId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst gridRow = this.getGrid().getRows().getById(rowId);\n\t\tif (gridRow)\n\t\t{\n\t\t\tDom.remove(gridRow.getNode());\n\t\t\tthis.getGrid().getRows().reset();\n\t\t}\n\n\t\tconst productRow = this.getProductById(rowId);\n\t\tif (productRow)\n\t\t{\n\t\t\tconst index = this.products.indexOf(productRow);\n\t\t\tif (index > -1)\n\t\t\t{\n\t\t\t\tthis.products.splice(index, 1);\n\t\t\t\tthis.refreshSortFields();\n\t\t\t\tthis.numerateRows();\n\t\t\t}\n\t\t}\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tif (!skipActions)\n\t\t{\n\t\t\tthis.addFirstRowIfEmpty();\n\t\t\tthis.executeActions([\n\t\t\t\t{type: this.actions.productListChanged},\n\t\t\t\t{type: this.actions.updateTotal}\n\t\t\t]);\n\t\t}\n\t}\n\n\tcopyRow(row: Row): void\n\t{\n\t\tthis.addProductRow(row)\n\t\tthis.refreshSortFields();\n\t\tthis.numerateRows();\n\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\n\n\t\tthis.executeActions([\n\t\t\t{type: this.actions.productListChanged},\n\t\t\t{type: this.actions.updateTotal}\n\t\t]);\n\t}\n\n\tcleanProductRows(): void\n\t{\n\t\tthis.products\n\t\t\t.filter(item => item.isEmpty())\n\t\t\t.forEach((row) => this.deleteRow(row.getField('ID'), true))\n\t\t;\n\t}\n\n\tresortProductsByIds(ids: Array): boolean\n\t{\n\t\tlet changed = false;\n\n\t\tif (Type.isArrayFilled(ids))\n\t\t{\n\t\t\tthis.products.sort((a, b) => {\n\t\t\t\tif (ids.indexOf(a.getField('ID')) > ids.indexOf(b.getField('ID')))\n\t\t\t\t{\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\n\t\t\t\tchanged = true;\n\n\t\t\t\treturn -1;\n\t\t\t});\n\t\t}\n\n\t\treturn changed;\n\t}\n\n\trefreshSortFields(): void\n\t{\n\t\tthis.products.forEach((item, index) => item.setField('SORT', (index + 1) * 10));\n\t}\n\n\thandleOnTabShow(): void\n\t{\n\t\tif (!this.isVisible())\n\t\t{\n\t\t\tthis.products.forEach(\n\t\t\t\t(product) => {\n\t\t\t\t\tproduct.getSelector()?.layout();\n\t\t\t\t\tproduct.initHandlersForSelectors();\n\t\t\t\t});\n\t\t}\n\t\tEventEmitter.emit('onDemandRecalculateWrapper', [this]);\n\n\t\tthis.isVisibleGrid = true;\n\t}\n\n\tisVisible(): boolean\n\t{\n\t\treturn this.isVisibleGrid;\n\t}\n\n\tshowFieldTourHint(fieldName: string, tourData: Object, endTourHandler: Function, addictedFields: Array<string> = [], rowId: string = ''): void\n\t{\n\t\tif (this.products.length > 0)\n\t\t{\n\t\t\tlet productNode = this.products[0].getNode();\n\t\t\tif (this.getProductByRowId(rowId))\n\t\t\t{\n\t\t\t\tproductNode = this.getProductByRowId(rowId).getNode();\n\t\t\t}\n\n\t\t\tconst addictedNodes = [];\n\t\t\tfor (const fieldName of addictedFields)\n\t\t\t{\n\t\t\t\tconst fieldNode = productNode.querySelector(`[data-name=\"${fieldName}\"]`);\n\t\t\t\tif (fieldNode !== null)\n\t\t\t\t{\n\t\t\t\t\taddictedNodes.push(fieldNode);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst fieldNode = productNode.querySelector(`[data-name=\"${fieldName}\"]`);\n\n\t\t\tif (fieldNode !== null)\n\t\t\t{\n\t\t\t\tthis.#fieldHintManager.processFieldTour(fieldNode, tourData, endTourHandler, addictedNodes);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetActiveHint(): Guide|null\n\t{\n\t\treturn this.#fieldHintManager.getActiveHint();\n\t}\n\n\topenIntegrationLimitSlider()\n\t{\n\t\ttop.BX.UI.InfoHelper.show('limit_store_crm_integration');\n\t\tconst helperSlider = top.BX.UI.InfoHelper.getSlider();\n\t\ttop.BX.Event.EventEmitter.subscribeOnce('SidePanel.Slider:onCloseComplete', (event) => {\n\t\t\tconst slider = event.getData()[0]?.getSlider();\n\t\t\tif (slider !== helperSlider)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\twindow.location.search += '&active_tab=tab_products';\n\t\t});\n\t}\n\n\topenInventoryManagementToolDisabledSlider()\n\t{\n\t\tRuntime.loadExtension('catalog.tool-availability-manager').then((exports) => {\n\t\t\tconst { ToolAvailabilityManager } = exports;\n\t\t\tToolAvailabilityManager.openInventoryManagementToolDisabledSlider();\n\t\t});\n\t}\n\n\tgetRestrictedProductTypes(): Array\n\t{\n\t\treturn this.getSettingValue('restrictedProductTypes', []);\n\t}\n}\n"],"names":["HintPopup","editor","node","text","hintPopup","Popup","getId","darkMode","closeIcon","animation","autoHide","setBindElement","adjustPosition","setContent","Tag","render","Text","encode","show","close","ReserveControl","options","Cache","MemoryCache","row","inputFieldName","inputName","INPUT_NAME","viewName","VIEW_NAME","dateFieldName","DATE_NAME","quantityFieldName","QUANTITY_NAME","deductedQuantityFieldName","DEDUCTED_QUANTITY_NAME","defaultDateReservation","isBlocked","isInventoryManagementToolEnabled","inventoryManagementMode","measureName","isReserveEqualProductQuantity","getReservedQuantity","getQuantity","isNewRow","wrapper","Dom","append","Event","bind","querySelector","Runtime","debounce","onReserveInputChange","getDateReservation","onDateChange","value","isTriggerEvent","input","dispatchEvent","window","toNumber","getField","getDeductedQuantity","event","target","changeInputValue","rawValue","getAvailableQuantity","setReservedQuantity","dateReservation","changeDateReservation","updateField","model","getModel","isSimple","isService","newDate","BX","parseDate","current","Date","setHours","date","innerHTML","calendar","field","parentNode","bTime","remember","viewReserveNode","getMeasureName","tag","isInputDisabled","onclick","EventEmitter","emit","linkText","Loc","getMessage","link","innerText","hiddenInput","ModeList","MODE_1C","notifyId","messageId","notify","UI","Notification","Center","getBalloonById","notificationOptions","id","closeButton","autoHideDelay","content","StoreAvailablePopup","_classPrivateMethodInitSpec","_classPrivateFieldInitSpec","rowId","setNode","addClass","togglePopup","storeId","storeCollection","getStoreCollection","storeQuantity","getStoreAmount","reservedQuantity","getStoreReserved","availableQuantity","getStoreAvailableAmount","renderHead","renderRow","isReservedQuantityLink","reservedQuantityContent","viewAvailableQuantity","result","e","preventDefault","openDealsWithReservedProductSlider","reservedDealsSliderLink","productId","sliderLink","Uri","setQueryParam","SidePanel","Instance","open","toString","allowChangeHistory","cacheable","isShown","getPopupContent","_classPrivateMethodGet","popupId","popup","PopupManager","getPopupById","create","bindElement","draggable","offsetLeft","offsetTop","angle","position","offset","noAllPaddings","bindOptions","forceBindPosition","closeByEsc","MoneyControl","hint","removeAttribute","classList","remove","currencyBlock","add","dataset","disabled","setAttribute","Hint","init","MODE_EDIT","MODE_SET","enableImageInputCache","Map","Row","fields","settings","EDIT","SET","setId","setSettings","setEditor","setModel","setFields","modifyBasePriceInput","modifyQuantityInput","refreshFieldsLayout","updateUiStoreAmountData","initHandlersForSelectors","requestAnimationFrame","initHandlers","cache","getEditorContainer","mainSelector","isNaN","Type","isPlainObject","name","defaultValue","hasOwnProperty","getEditor","getContainer","getHintPopup","getNode","querySelectorAll","forEach","changeProductFieldHandler","stopPropagation","selectorNames","unsubscribeEvents","unsubscribe","handleMainSelectorClear","storeSelector","handleStoreFieldChange","handleStoreFieldClear","handleChangeStoreData","handleProductErrorsChange","priceNode","control","disable","enable","isRestrictedStoreInfo","countField","storeWrapper","renderTo","isReserveBlocked","reserveControl","clearCache","number","textContent","isArrayFilled","clone","fieldName","fixedProductName","isStringFilled","getFields","getBasePrice","getTaxIncluded","getTaxId","getPrice","getPriceExclusive","getPriceNetto","getPriceBrutto","getDiscountType","getDiscountRate","getDiscountSum","getDiscountRow","getTaxRate","setField","changeModel","isTaxAllowed","isTaxIncluded","DiscountType","UNDEFINED","PERCENTAGE","MONETARY","isDiscountPercentage","isDiscountMonetary","isDiscountUndefined","trim","isEmpty","taxNode","getTaxNode","isDomNode","selectedIndex","getAttribute","fieldCode","type","checked","mode","resetExternalActions","updateFieldValue","executeExternalActions","code","changeProductId","changeQuantity","changeMeasureCode","changeDiscount","changeDiscountType","changeRowDiscount","changeTaxId","changeTaxRate","changeTaxIncluded","changeRowSum","changeProductName","changeSort","changeStore","changeStoreName","changeReserveQuantity","changeDateReserveEnd","changeBasePrice","setDeductedQuantity","setRowReserved","setType","setTaxIncluded","menuItem","copyRow","menu","getMenuWindow","destroy","deleteRow","preparedValue","parseInt","setProductId","parseFloat","getQuantityPrecision","setQuantity","getMeasures","filter","item","CODE","setMeasure","getCommonPrecision","getPricePrecision","toFixed","setDiscount","setDiscountType","setRowDiscount","taxList","getTaxList","taxRate","find","ID","isNil","VALUE","setTaxRate","isBoolean","setRowSum","isChangedValue","addActionProductChange","layoutReserveControl","availableWrapper","available","amount","amountWithMeasure","isCatalogExisted","productProps","property","propNodes","reserveWrapper","deductedWrapper","reserveDifference","newReserve","Math","max","exceptFields","includes","updateUiField","getCalculator","getCalculateFields","getSettings","selectorId","ProductModel","getById","currency","getCurrencyId","iblockId","basePriceId","isSimpleModel","toInteger","skuTree","JSON","parse","storeMap","setDetailPath","imageInfo","isObject","getImageCollection","setPreview","setEditInput","setMorePhotoValues","getSettingValue","subscribe","setOption","addActionUpdateTotal","resetReserveFields","onAfterExecuteExternalActions","updateUiInputField","originalPrice","calculatedFields","calculateBasePrice","exceptFieldNames","errorNotifyId","calculateQuantity","isElementNode","view","measure","SYMBOL","updateUiMoneyField","isNew","save","showSaveNotifier","title","events","onSave","isDiscountHandmade","calculateDiscount","calculateDiscountType","calculateRowDiscount","calculateTax","updateUiCheckboxField","calculateTaxIncluded","addActionUpdateFieldList","calculateRowSum","fieldId","getUiFieldId","document","getElementById","getInputByFieldName","getCurrencyText","Reflection","getClass","Main","dropdownManager","dropdown","getValue","itemsContainer","getMenuItem","refresh","selectItem","span","dropdownApi","getMoneyFieldDropdownApi","updateMoneyFieldUiWithDropdownApi","updateMoneyFieldUiManually","html","currencyText","currencyId","currencyFieldNames","dropdownValues","push","NAME","attr","uiName","getUiFieldName","uiType","getUiFieldType","allowUpdateUiField","isNumber","updateUiDiscountTypeField","updateUiHtmlField","CurrencyCore","currencyFormat","isPriceNetto","precision","externalActions","length","action","addExternalAction","actions","productChange","disableSaveButton","updateListField","stateChanged","updateTotal","executeActions","callback","call","getDefaultMeasure","clearReserveControl","isReadOnly","actionCellContentContainer","actionsButton","menuItems","handleCopyAction","handleDeleteAction","products","PopupMenu","items","canEditCatalogPrice","enableImageInput","ProductSelector","selectorOptions","getIblockId","getBasePriceId","getCurrency","config","ENABLE_SEARCH","IS_ALLOWED_CREATION_PRODUCT","ENABLE_IMAGE_INPUT","ROLLBACK_INPUT_AFTER_CANCEL","ENABLE_INPUT_DETAIL_LINK","ROW_ID","ENABLE_SKU_SELECTION","ENABLE_EMPTY_PRODUCT_ERROR","SELECTOR_INPUT_DISABLED","URL_BUILDER_CONTEXT","RESTRICTED_PRODUCT_TYPES","getRestrictedProductTypes","subscribeEvents","setConfig","layoutImage","setMode","MODE_VIEW","mainInfoNode","numberSelector","selectorWrapper","skuTreeInstance","isVisible","StoreSelector","inputFieldId","inputFieldTitle","searchInput","layoutStoreSelector","storeAvaiableNode","storeAvailablePopup","getInventoryManagementMode","storeSearchInput","getNameInput","toggleIcon","getSearchIcon","getWrapper","openIntegrationLimitSlider","openInventoryManagementToolDisabledSlider","quantityInput","setReserveQuantity","data","getData","currentAmount","isChanged","maxStore","getMaxFilledStore","AMOUNT","onStoreSelect","STORE_ID","decode","STORE_TITLE","getStoreId","showNegative","load","PageEventsManager","_settings","eventHandlers","eventName","eventHandler","addCustomEvent","eventParams","onCustomEvent","i","removeCustomEvent","SettingsPopup","getPopup","random","setting","enabled","headers","cells","getGrid","getRows","getHeadFirstChild","getCells","Array","from","header","ajax","runComponentAction","getComponentName","signedParameters","getSignedParameters","settingId","selected","currentHeaders","then","message","panel","setSettingValue","activePanel","changeActivePanelButtons","settingButton","replace","reloadGrid","category","popupContainer","getContentContainer","isArray","columns","allColumnsExist","columnName","getColumnHeaderCellByName","checkbox","descriptionNode","desc","hintNode","settingItem","getSetting","settingEnabled","requestGridSettings","stack","width","FieldHintManager","contentContainer","gridGetter","fieldNode","tourData","endTourHandler","addictedFieldNodes","fieldHintIsBusy","onClose","activeHintGuide","tourObject","gridContainer","leftArrow","rightArrow","fieldPos","getClientRects","x","gridPos","spotlight","Guide","observedNode","onSuccessVisionCallback","callbackParams","addictedNodes","observedNodes","observer","unbind","getScrollContainer","mainNode","nodesTuple","addictedNode","nodeRect","mainNodeTupleEl","sort","firstEl","secondEl","firstX","secondX","gridRect","widthIsValid","leftPos","rightPos","abs","lastEl","pop","shift","firstElDistance","lastElDistance","map","el","undefined","gridLeftEdge","gridRightEdge","fieldNodes","fieldRect","fieldLeftEdge","fieldRightEdge","targetNode","SpotLight","targetElement","autoSave","targetVertex","zIndex","container","style","pointerEvents","onCloseCallback","clickObserver","setTimeout","tourTarget","guide","steps","Object","assign","onEvents","showNextStep","GRID_TEMPLATE_ROW","DEFAULT_PRECISION","Editor","productListChanged","changed","sended","inProgress","handleProductSelectionPopup","handleProductRowAdd","handleShowSettingsPopup","handleOnDialogSelectProduct","handleOnAddViewedProductToDeal","handleOnSave","handleProductListFocus","handleOnEntityUpdate","handleEditorSubmit","handleOnInnerCancel","handleOnBeforeGridRequest","handleOnGridUpdated","handleOnGridRowMoved","handleOnBeforeProductChange","handleOnProductChange","handleOnBeforeProductClear","handleOnProductClear","handleDropdownChange","handleFieldChange","updateTotalDataDelayed","canEdit","addFirstRowIfEmpty","enableEdit","initForm","initProducts","initGridData","subscribeDomEvents","subscribeCustomEvents","headersToLock","headerId","hasClass","lock","insertBefore","firstChild","buttonBlock","unsubscribeDomEvents","selectButton","productSelectionPopupHandler","addButton","productRowAddHandler","configButton","showSettingsPopupHandler","unsubscribeCustomEvents","onDialogSelectProductHandler","onAddViewedProductToDealHandler","onSaveHandler","onFocusToProductList","onEntityUpdateHandler","onEditorSubmit","onInnerCancelHandler","onBeforeGridRequestHandler","onGridUpdatedHandler","onGridRowMovedHandler","onBeforeProductChangeHandler","onProductChangeHandler","onBeforeProductClearHandler","onProductClearHandler","dropdownChangeHandler","PULL","pullReloadGrid","moduleId","command","getCompatData","getProductCount","addProductRow","selectProductInRow","selectViewedProductInRow","productSelector","getProductSelector","onProductSelect","clearErrors","product","listHaveEmptyRows","isEmptyRow","focusProductSelector","entityId","entityTypeId","setGridChanged","isLocationDependantTaxesEnabled","entityData","getLocationId","setLocationId","controller","rollback","subscribeOnce","actionUpdateTotalData","isInternalChanging","panelCode","removeClass","hiddenPanelCode","removePanel","useProductsFromRequest","reloadTable","grid","eventArgs","parent","getGridId","isNativeAction","url","getReloadUrl","method","sessid","bitrix_sessid","getProductsFields","locationId","clearEditor","getSettingsPopup","updateCheckboxState","ids","resortProductsByIds","refreshSortFields","numerateRows","componentId","pageEventsManager","initPageEventsManager","rows","isHeadChild","isTemplate","edit","getCountDisplayed","unsubscribeProductsEvents","productsWasInitiated","destroySettingsPopup","unbindAll","setForm","clearController","clearProductList","readOnly","setCurrencyId","priceFields","ajaxRequest","editData","getGridEditData","templateRow","templateFieldNames","setGridEditData","updateUiCurrencyFields","updateTotalUiCurrency","totalBlock","column","valueElement","getPriceControl","format","getCurrencyFormat","FORMAT_STRING","getDataFieldName","getTaxAllowed","getTaxEnabled","isNumberValue","isStringValue","isNegative","indexOf","dot","comma","s1","substr","decimalLength","round","factor","pow","price","discount","discountType","discountRate","getContainerId","formId","form","getForm","getDataField","initDataField","settingsField","getDataSettingsField","initDataSettingsField","attrs","initFormField","getDataSettingsFieldName","getFormField","list","index","setRowNumber","gridId","Error","gridManager","getInstanceById","gridEditData","arParams","EDITABLE_DATA","closest","hasAttribute","getProductById","cell","getFieldCodeByGridCell","updateFieldByEvent","dropdownId","regExp","RegExp","getRowIdPrefix","matches","match","modeChanges","getProductByRowId","headRow","getCellNameByCellIndex","caller","jsEventsManagerId","CDialog","content_url","util","urlencode","height","innerHeight","innerWidth","resizable","min_height","min_width","defer","Get","top","GetWindowScrollPos","scrollTop","Close","isUndefined","Crm","EntityEvent","names","update","Show","anchorProduct","createGridProductRow","newId","anchorRowNode","nextSibling","initializeNewProductRow","bindOnRowEvents","OneCPlanRestrictionSlider","has","get","getRandom","originalTemplate","redefineTemplateEditData","newRow","appendRowEditor","prependRowEditor","newNode","makeCountable","setOriginalTemplateEditData","adjustRows","updateCounterDisplayed","updateCounterSelected","originalTemplateData","customEditData","prepareCustomEditData","originalEditData","templateIdMask","CURRENCY","lastItem","TAX_INCLUDED","IMAGE_INFO","RESERVE_ID","splice","getSelector","reloadFileInput","layout","updateUiMeasure","unshift","searchInDialog","focusName","tableFade","productRow","promise","Promise","resolve","reject","stringify","ACTION","response","changedFields","taxId","taxIncluded","keys","key","updatePropertyFields","tableUnfade","clearPropertyFields","isExistForm","initFormFields","cleanProductRows","prepareProductDataValue","ENABLE_DISCOUNT","getDiscountEnabled","ENABLE_TAX","productDataValue","productData","saveFields","test","actionSendProductChange","actionSendProductListChanged","actionUpdateListField","actionSendStatusChange","getCatalogFields","allowUpdateListField","updateFieldForList","updateFieldByName","totalData","updateTotalDataDelayedHandler","stateChange","isTaxUniform","isChangedGrid","getProductFieldListForTotalData","productFields","sendTotalData","needMarkAsChanged","changeSumTotal","requestKey","ajaxPool","set","REQUEST_KEY","ajaxResultSuccess","ajaxResultFailure","requestOptions","ajaxResultCommonCheck","setTotalData","onCalculatePricesResponse","currentBalloon","getBalloonByCategory","SAVE_NOTIFICATION_CATEGORY","getFullName","responce","status","skipActions","gridRow","reset","a","b","isVisibleGrid","addictedFields","productNode","processFieldTour","getActiveHint","InfoHelper","helperSlider","getSlider","slider","location","search","loadExtension","exports","ToolAvailabilityManager","_clickOnRowActionsButton","getErrorCollection","hasErrors"],"mappings":"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"}