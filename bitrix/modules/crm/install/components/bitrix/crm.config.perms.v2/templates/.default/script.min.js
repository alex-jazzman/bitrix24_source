(function(e,t,s,i,n){"use strict";function o(e,t){c(e,t);t.add(e)}function c(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function a(e,t,s){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}var r=t.Reflection.namespace("BX.Crm");var u=new WeakSet;var l=new WeakSet;var h=new WeakSet;var d=new WeakSet;var g=new WeakSet;var m=new WeakSet;var f=function(){function e(t){var s;babelHelpers.classCallCheck(this,e);o(this,m);o(this,g);o(this,d);o(this,h);o(this,l);o(this,u);this.AccessRightsOption=t.AccessRightsOption;this.AccessRights=t.AccessRights;this.hasLeftMenu=t.hasLeftMenu;this.menuId=t.menuId;this.useAirDesign=(s=t.useAirDesign)!==null&&s!==void 0?s:false}babelHelpers.createClass(e,[{key:"init",value:function e(){this.AccessRights.draw();a(this,h,A).call(this);if(this.hasLeftMenu){a(this,u,p).call(this);a(this,l,v).call(this)}}},{key:"openPermission",value:function e(t){if(this.menuId===t.menuId){return}if(!this.AccessRights.hasUnsavedChanges()){this.redrawAccessRight(t)}else{event.stopImmediatePropagation();a(this,g,w).call(this,t)}}},{key:"redrawAccessRight",value:function e(t){var s=this;var i=new BX.Loader({target:document.getElementById("bx-crm-perms-config-permissions")});this.AccessRights.destroy();i.show();a(this,d,R).call(this,t).then((function(e){var i=e.accessRightsData,o=e.maxVisibleUserGroups,c=e.additionalSaveParams;s.AccessRightsOption.userGroups=i.userGroups;s.AccessRightsOption.accessRights=i.accessRights;s.AccessRightsOption.maxVisibleUserGroups=o;s.AccessRightsOption.additionalSaveParams=c;s.AccessRights=new n.App(s.AccessRightsOption);s.AccessRights.draw();scrollTo({top:0});s.menuId=t.menuId}))["catch"]((function(e){var t,i;console.warn("ui.accessrights.v2: error during redraw",e);a(s,m,S).call(s,(e===null||e===void 0?void 0:(t=e.errors)===null||t===void 0?void 0:(i=t[0])===null||i===void 0?void 0:i.message)||"Something went wrong")}))["finally"]((function(){i.hide()}))}}]);return e}();function p(){var e=document.getElementById("ui-page-slider-content");if(e){var t=document.createElement("div");t.className="crm-config-perms-v2-slider-content";e.parentNode.insertBefore(t,e);t.appendChild(e)}}function v(){var e=document.getElementById("left-panel");if(e){var t=document.createElement("div");t.className="crm-config-perms-v2-sidebar";e.parentNode.insertBefore(t,e);t.appendChild(e)}}function A(){var e=t.Reflection.getClass("top.BX.Helper");var s=new i.Button({size:i.ButtonSize.SMALL,text:t.Loc.getMessage("CRM_CONFIG_PERMS_HELP_MSGVER_1"),style:i.AirButtonStyle.OUTLINE_NO_ACCENT,useAirDesign:true,onclick:function t(){var s="23240636";e===null||e===void 0?void 0:e.show("redirect=detail&code=".concat(s))}});var n=document.querySelector(".crm-config-perms-v2-header");s.renderTo(n)}function R(e){return new Promise((function(s,i){t.ajax.runComponentAction("bitrix:crm.config.perms.v2","getData",{mode:"class",data:{controllerData:e}}).then((function(e){s(e.data)}))["catch"](i)}))}function w(e){var n=this;var o=s.MessageBox.create({message:t.Loc.getMessage("CRM_CONFIG_PERMS_SAVE_POPUP_TITLE"),modal:true,useAirDesign:true,buttons:[new i.SaveButton({size:i.ButtonSize.LARGE,style:i.AirButtonStyle.FILLED,useAirDesign:true,onclick:function t(s){s.setWaiting(true);n.AccessRights.sendActionRequest().then((function(){document.querySelector('[data-menu-id="'.concat(e.menuId,'"]')).click()}))["catch"]()["finally"]((function(){o.close()}))}}),new i.CancelButton({text:t.Loc.getMessage("CRM_CONFIG_PERMS_SAVE_POPUP_CANCEL"),size:i.ButtonSize.LARGE,style:i.AirButtonStyle.OUTLINE,useAirDesign:true,onclick:function e(){o.close()}})],popupOptions:{fixed:true}});o.show()}function S(e){BX.UI.Notification.Center.notify({content:e,position:"top-right",autoHideDelay:3e3})}r.ConfigPermsComponent=f})(this.window=this.window||{},BX,BX.UI.Dialogs,BX.UI,BX.UI.AccessRights.V2);
//# sourceMappingURL=script.map.js