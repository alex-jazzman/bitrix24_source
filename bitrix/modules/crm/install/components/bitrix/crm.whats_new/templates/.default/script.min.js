(function(e,t,i,s,a){"use strict";var l,r;function n(e,t){u(e,t);t.add(e)}function o(e,t,i){u(e,t);t.set(e,i)}function u(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function c(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var p=t.Reflection.namespace("BX.Crm.WhatsNew");var v=new WeakMap;var h=new WeakMap;var d=new WeakMap;var b=new WeakMap;var w=new WeakMap;var f=new WeakMap;var P=new WeakMap;var m=new WeakSet;var g=new WeakSet;var H=new WeakSet;var F=new WeakSet;var S=new WeakSet;var k=new WeakSet;var G=new WeakSet;var C=new WeakSet;var y=new WeakSet;var N=new WeakSet;var W=function(){function e(i){var s=i.slides,a=i.steps,l=i.options,r=i.closeOptionCategory,u=i.closeOptionName;babelHelpers.classCallCheck(this,e);n(this,N);n(this,y);n(this,C);n(this,G);n(this,k);n(this,S);n(this,F);n(this,H);n(this,g);n(this,m);o(this,v,{writable:true,value:void 0});o(this,h,{writable:true,value:void 0});o(this,d,{writable:true,value:void 0});o(this,b,{writable:true,value:void 0});o(this,w,{writable:true,value:void 0});o(this,f,{writable:true,value:void 0});o(this,P,{writable:true,value:false});babelHelpers.classPrivateFieldSet(this,v,[]);babelHelpers.classPrivateFieldSet(this,h,[]);babelHelpers.classPrivateFieldSet(this,d,l);babelHelpers.classPrivateFieldSet(this,b,null);this.slideClassName="crm-whats-new-slides-wrapper";babelHelpers.classPrivateFieldSet(this,f,t.Type.isString(r)?r:"");babelHelpers.classPrivateFieldSet(this,w,t.Type.isString(u)?u:"");this.onClickClose=this.onClickCloseHandler.bind(this);this.whatNewPromise=null;this.tourPromise=null;c(this,m,O).call(this,s);c(this,F,T).call(this,a)}babelHelpers.createClass(e,[{key:"show",value:function e(){if(babelHelpers.classPrivateFieldGet(this,d).isNumberOfViewsExceeded){console.warn("Number of views exceeded");return}if(babelHelpers.classPrivateFieldGet(this,v).length>0){c(this,y,V).call(this)}else if(babelHelpers.classPrivateFieldGet(this,h).length>0){c(this,N,X).call(this)}}},{key:"onClickCloseHandler",value:function e(){var t=babelHelpers.classPrivateFieldGet(this,b).getLastPosition();var i=babelHelpers.classPrivateFieldGet(this,b).getPositionBySlide(babelHelpers.classPrivateFieldGet(this,b).getCurrentSlide());if(i>=t){babelHelpers.classPrivateFieldGet(this,b).destroy()}else{babelHelpers.classPrivateFieldGet(this,b).selectNextSlide()}}},{key:"createGuideInstance",value:function e(t,i,s){var a=this;return new t({onEvents:s,steps:i,events:{onFinish:function e(){if(babelHelpers.classPrivateFieldGet(a,v).length===0){a.save()}}}})}},{key:"setStepPopupOptions",value:function e(t){var i;var s=babelHelpers.classPrivateFieldGet(this,d),a=s.steps,l=s.hideTourOnMissClick,r=l===void 0?false:l;t.setAutoHide(r);if(a!==null&&a!==void 0&&(i=a.popup)!==null&&i!==void 0&&i.width){t.setWidth(a.popup.width)}}},{key:"save",value:function e(){var i,s=this;t.ajax.runAction("crm.settings.tour.updateOption",{json:{category:babelHelpers.classPrivateFieldGet(this,f),name:babelHelpers.classPrivateFieldGet(this,w),options:{isMultipleViewsAllowed:!babelHelpers.classPrivateFieldGet(this,P)&&c(this,G,B).call(this),numberOfViewsLimit:(i=babelHelpers.classPrivateFieldGet(this,d).numberOfViewsLimit)!==null&&i!==void 0?i:1}}}).then((function(e){var t=e.data;babelHelpers.classPrivateFieldGet(s,d).isNumberOfViewsExceeded=t.isNumberOfViewsExceeded;babelHelpers.classPrivateFieldSet(s,P,true)}))["catch"]((function(e){console.error("Could not save tour settings",e)}))}}]);return e}();function O(e){var i=this;if(e.length>0){this.whatNewPromise=t.Runtime.loadExtension("ui.dialogs.whats-new")}babelHelpers.classPrivateFieldSet(this,v,e.map((function(e){return{className:i.slideClassName,title:e.title,html:c(i,g,M).call(i,e)}})))}function M(e){var i=t.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="crm-whats-new-slide">\n\t\t\t\t<img src="','" alt="">\n\t\t\t\t<div class="crm-whats-new-slide-inner-title"> '," </div>\n\t\t\t\t<p>","</p>\n\t\t\t</div>\n\t\t"])),e.innerImage,e.innerTitle,e.innerDescription);var s=c(this,H,x).call(this,e);if(s.length>0){var a=t.Tag.render(r||(r=babelHelpers.taggedTemplateLiteral(['<div class="crm-whats-new-slide-buttons"></div>'])));t.Dom.append(a,i);s.forEach((function(e){t.Dom.append(e.getContainer(),a)}))}return i}function x(e){var t=this;var i=[];if(e.buttons){var s="ui-btn ui-btn-primary ui-btn-hover ui-btn-round ";i=e.buttons.map((function(e){var i;var l={className:s+((i=e.className)!==null&&i!==void 0?i:""),text:e.text};if(e.onClickClose){l.onclick=function(){return t.onClickClose()}}else if(e.helpDeskCode){l.onclick=function(){return c(t,C,D).call(t,e.helpDeskCode)}}return new a.Button(l)}))}return i}function T(e){var s=this;if(e.length>0){this.tourPromise=t.Runtime.loadExtension("ui.tour")}babelHelpers.classPrivateFieldSet(this,h,e.map((function(e){var t={id:e.id,title:e.title,text:e.text,position:e.position,article:e.article};if(e.useDynamicTarget){var a;var l=(a=e.eventName)!==null&&a!==void 0?a:c(s,k,I).call(s,t.id);i.EventEmitter.subscribeOnce(l,c(s,S,E).bind(s))}else{t.target=e.target}return t})))}function E(e){var t=this;this.tourPromise.then((function(i){var s=e.data,a=s.stepId,l=s.target,r=s.delay;var n=babelHelpers.classPrivateFieldGet(t,h).find((function(e){return e.id===a}));if(!n){console.error("step not found");return}setTimeout((function(){n.target=l;var e=i.Guide;var s=t.createGuideInstance(e,[n],true);t.setStepPopupOptions(s.getPopup());s.showNextStep();t.save()}),r||0)}))}function I(e){return"Crm.WhatsNew::onTargetSetted::".concat(e)}function B(){return babelHelpers.classPrivateFieldGet(this,d).numberOfViewsLimit>1}function D(e){if(top.BX.Helper){top.BX.Helper.show("redirect=detail&code=".concat(e));event.preventDefault()}}function V(){var e=this;if(s.PopupManager&&s.PopupManager.isAnyPopupShown()){return}this.whatNewPromise.then((function(t){var i=t.WhatsNew;babelHelpers.classPrivateFieldSet(e,b,new i({slides:babelHelpers.classPrivateFieldGet(e,v),popupOptions:{height:440},events:{onDestroy:function t(){e.save();c(e,N,X).call(e)}}}));babelHelpers.classPrivateFieldGet(e,b).show();W.whatsNewInstances.push(babelHelpers.classPrivateFieldGet(e,b))}),this)}function X(){var e=this;var i=t.clone(babelHelpers.classPrivateFieldGet(this,h));i=i.filter((function(e){return Boolean(e.target)}));if(i.length===0){return}this.tourPromise.then((function(t){if(s.PopupManager&&s.PopupManager.isAnyPopupShown()){return}var a=t.Guide;var l=e.createGuideInstance(a,i,babelHelpers.classPrivateFieldGet(e,h).length<=1);if(W.tourInstances.find((function(e){var t;return(t=e.getPopup())===null||t===void 0?void 0:t.isShown()}))){return}W.tourInstances.push(l);e.setStepPopupOptions(l.getPopup());if(l.steps.length>1||babelHelpers.classPrivateFieldGet(e,d).showOverlayFromFirstStep){l.start()}else{l.showNextStep()}e.save()}))}babelHelpers.defineProperty(W,"tourInstances",[]);babelHelpers.defineProperty(W,"whatsNewInstances",[]);p.ActionViewMode=W})(this.window=this.window||{},BX,BX.Event,BX.Main,BX.UI);
//# sourceMappingURL=script.map.js