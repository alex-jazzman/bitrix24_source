{"version":3,"file":"inline-placeholder-selector.bundle.js","sources":["../src/inline-placeholder-selector.js"],"sourcesContent":["import { Dom, Tag, Type } from 'main.core';\nimport { Dialog } from 'ui.entity-selector';\nimport './inline-placeholder-selector.css';\nimport 'ui.forms';\nimport { InlinePlaceholderSelectorOptions } from './inline-placeholder-selector-options';\n\nexport const InlinePlaceholderSelectorMode = {\n\tINPUT: 'input',\n\tTEXTAREA: 'textarea',\n};\n\nexport class InlinePlaceholderSelector\n{\n\t#mode: string;\n\t#value: string;\n\t#target: HTMLElement;\n\t#multiple: boolean;\n\t#menuButton: HTMLElement;\n\t#dialog: Dialog;\n\t#inputElement: HTMLElement;\n\t#entityTypeIds: Array<number>;\n\t#onBeforeMenuOpen: ?Function;\n\n\tconstructor(params: InlinePlaceholderSelectorOptions)\n\t{\n\t\tif (!Type.isDomNode(params.target))\n\t\t{\n\t\t\tthrow new Error('Target DOM node not found');\n\t\t}\n\n\t\tlet entityTypeIds = Type.isArrayFilled(params.entityTypeIds)\n\t\t\t? params.entityTypeIds\n\t\t\t: []\n\t\t;\n\t\tentityTypeIds = entityTypeIds.filter(entityTypeId => BX.CrmEntityType.isDefined(entityTypeId));\n\n\t\tthis.#target = params.target;\n\t\tthis.#entityTypeIds = entityTypeIds;\n\t\tthis.#mode = params.mode ?? InlinePlaceholderSelectorMode.INPUT;\n\t\tthis.#value = params.value ?? '';\n\t\tthis.#multiple = params.multiple ?? false;\n\t\tthis.#onBeforeMenuOpen = Type.isFunction(params.onBeforeMenuOpen) ? params.onBeforeMenuOpen : null;\n\t}\n\n\tsetEntityTypeIds(entityTypeIds: Array<number>): void\n\t{\n\t\tthis.#entityTypeIds = entityTypeIds;\n\t}\n\n\tshow()\n\t{\n\t\tDom.append(this.#render(), this.#target);\n\t}\n\n\tgetValue(): string\n\t{\n\t\treturn this.#inputElement.value ?? '';\n\t}\n\n\t#getDialog(): Dialog\n\t{\n\t\tif (Type.isNull(this.#onBeforeMenuOpen) && this.#dialog)\n\t\t{\n\t\t\treturn this.#dialog;\n\t\t}\n\n\t\tconst entity = this.#multiple\n\t\t\t? {\n\t\t\t\tid: 'multiple_placeholder',\n\t\t\t\tdynamicLoad: true,\n\t\t\t\tdynamicSearch: false,\n\t\t\t\tsearchable: true,\n\t\t\t\toptions: {\n\t\t\t\t\tentityTypeIds: this.#entityTypeIds,\n\t\t\t\t},\n\t\t\t}\n\t\t\t: {\n\t\t\t\tid: 'placeholder',\n\t\t\t\tdynamicLoad: true,\n\t\t\t\tdynamicSearch: false,\n\t\t\t\tsearchable: true,\n\t\t\t\toptions: {\n\t\t\t\t\tentityTypeId: this.#entityTypeIds[0],\n\t\t\t\t},\n\t\t\t}\n\t\t;\n\n\t\tthis.#dialog = new Dialog({\n\t\t\ttargetNode: this.#menuButton,\n\t\t\tmultiple: false,\n\t\t\tshowAvatars: false,\n\t\t\tdropdownMode: true,\n\t\t\tcompactView: true,\n\t\t\tenableSearch: true,\n\t\t\tentities: [\n\t\t\t\tentity,\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\t'Item:onSelect': (event: BaseEvent) => {\n\t\t\t\t\tconst { item: selectedItem } = event.getData();\n\t\t\t\t\tthis.#onSelect(selectedItem);\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\treturn this.#dialog;\n\t}\n\n\t#render(): HTMLElement\n\t{\n\t\tthis.#menuButton = Tag.render`\n\t\t\t<span \n\t\t\tonclick=\"${this.#openMenu.bind(this)}\"\n\t\t\tclass=\"crm-inline-placeholder-selector-dotted\"\n\t\t\t></span>\n\t\t`;\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-inline-placeholder-selector\">\n\t\t\t\t${this.#renderFormElement()}\n\t\t\t\t${this.#menuButton}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#renderFormElement(): HTMLElement\n\t{\n\t\tif (this.#mode === InlinePlaceholderSelectorMode.TEXTAREA)\n\t\t{\n\t\t\tthis.#inputElement = Tag.render`<textarea class=\"ui-ctl-element\" name=\"subject\"></textarea>`;\n\t\t\tthis.#inputElement.value = this.#value;\n\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"ui-ctl ui-ctl-textarea ui-ctl-no-resize ui-ctl-w100\">\n\t\t\t\t\t${this.#inputElement}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\tthis.#inputElement = Tag.render`<input type=\"text\" class=\"ui-ctl-element\" name=\"subject\">`;\n\t\tthis.#inputElement.value = this.#value;\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\n\t\t\t\t${this.#inputElement}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tasync #openMenu(): void\n\t{\n\t\tif (this.#onBeforeMenuOpen)\n\t\t{\n\t\t\tawait this.#onBeforeMenuOpen();\n\t\t}\n\n\t\tthis.#getDialog().show();\n\t}\n\n\t#onSelect(selectedItem)\n\t{\n\t\tconst placeholder = `{${selectedItem.customData.get('text')}}`;\n\n\t\tconst cursorPosition = this.#inputElement.selectionStart;\n\t\tconst currentValue = this.#inputElement.value;\n\n\t\tthis.#inputElement.value = currentValue.slice(0, cursorPosition) + placeholder + currentValue.slice(\n\t\t\tcursorPosition,\n\t\t);\n\n\t\tconst newCursorPosition = cursorPosition + placeholder.length;\n\t\tthis.#inputElement.setSelectionRange(newCursorPosition, newCursorPosition);\n\n\t\tthis.#inputElement.focus();\n\n\t\tthis.#getDialog().deselectAll();\n\t}\n}\n"],"names":["InlinePlaceholderSelectorMode","INPUT","TEXTAREA","InlinePlaceholderSelector","params","Type","isDomNode","target","Error","entityTypeIds","isArrayFilled","filter","entityTypeId","BX","CrmEntityType","isDefined","mode","value","multiple","isFunction","onBeforeMenuOpen","Dom","append","isNull","entity","id","dynamicLoad","dynamicSearch","searchable","options","Dialog","targetNode","showAvatars","dropdownMode","compactView","enableSearch","entities","events","event","getData","selectedItem","item","Tag","render","bind","show","placeholder","customData","get","cursorPosition","selectionStart","currentValue","slice","newCursorPosition","length","setSelectionRange","focus","deselectAll"],"mappings":"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"}