{"version":3,"file":"inline-placeholder-selector.bundle.js","sources":["../src/inline-placeholder-selector.js"],"sourcesContent":["import { Tag, Type, Dom } from 'main.core';\nimport { Dialog } from 'ui.entity-selector';\nimport './inline-placeholder-selector.css';\nimport 'ui.forms';\nimport { InlinePlaceholderSelectorOptions } from './inline-placeholder-selector-options';\n\nexport const InlinePlaceholderSelectorMode = {\n\tINPUT: 'input',\n\tTEXTAREA: 'textarea',\n};\n\nexport class InlinePlaceholderSelector\n{\n\t#mode: string;\n\t#value: string;\n\t#target: HTMLElement;\n\t#menuButton: HTMLElement;\n\t#dialog: Dialog;\n\t#inputElement: HTMLElement;\n\t#entityTypeId: number;\n\n\tconstructor(params: InlinePlaceholderSelectorOptions)\n\t{\n\t\tif (!Type.isDomNode(params.target))\n\t\t{\n\t\t\tthrow new Error('Target DOM node not found');\n\t\t}\n\n\t\tthis.#target = params.target;\n\t\tthis.#entityTypeId = Type.isInteger(params.entityTypeId) ? params.entityTypeId : 0;\n\t\tthis.#mode = params.mode ?? InlinePlaceholderSelectorMode.INPUT;\n\t\tthis.#value = params.value ?? '';\n\t}\n\n\tshow()\n\t{\n\t\tDom.append(this.#render(), this.#target);\n\t}\n\n\tgetValue(): string\n\t{\n\t\treturn this.#inputElement.value ?? '';\n\t}\n\n\t#getDialog(): Dialog\n\t{\n\t\tif (this.#dialog)\n\t\t{\n\t\t\treturn this.#dialog;\n\t\t}\n\n\t\tthis.#dialog = new Dialog({\n\t\t\ttargetNode: this.#menuButton,\n\t\t\tmultiple: false,\n\t\t\tshowAvatars: false,\n\t\t\tdropdownMode: true,\n\t\t\tcompactView: true,\n\t\t\tenableSearch: true,\n\t\t\tentities: [\n\t\t\t\t{\n\t\t\t\t\tid: 'placeholder',\n\t\t\t\t\tdynamicLoad: true,\n\t\t\t\t\tdynamicSearch: false,\n\t\t\t\t\tsearchable: true,\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tentityTypeId: this.#entityTypeId,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\t'Item:onSelect': (event: BaseEvent) => {\n\t\t\t\t\tconst { item: selectedItem } = event.getData();\n\t\t\t\t\tthis.#onSelect(selectedItem);\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\treturn this.#dialog;\n\t}\n\n\t#render(): HTMLElement\n\t{\n\t\tthis.#menuButton = Tag.render`\n\t\t\t<span \n\t\t\tonclick=\"${this.#openMenu.bind(this)}\"\n\t\t\tclass=\"crm-inline-placeholder-selector-dotted\"\n\t\t\t></span>\n\t\t`;\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-inline-placeholder-selector\">\n\t\t\t\t${this.#renderFormElement()}\n\t\t\t\t${this.#menuButton}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#renderFormElement(): HTMLElement\n\t{\n\t\tif (this.#mode === InlinePlaceholderSelectorMode.TEXTAREA)\n\t\t{\n\t\t\tthis.#inputElement = Tag.render`<textarea class=\"ui-ctl-element\" name=\"subject\"></textarea>`;\n\t\t\tthis.#inputElement.value = this.#value;\n\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"ui-ctl ui-ctl-textarea ui-ctl-no-resize ui-ctl-w100\">\n\t\t\t\t\t${this.#inputElement}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\tthis.#inputElement = Tag.render`<input type=\"text\" class=\"ui-ctl-element\" name=\"subject\">`;\n\t\tthis.#inputElement.value = this.#value;\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\n\t\t\t\t${this.#inputElement}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#openMenu()\n\t{\n\t\tthis.#getDialog().show();\n\t}\n\n\t#onSelect(selectedItem)\n\t{\n\t\tconst placeholder = `{${selectedItem.customData.get('text')}}`;\n\n\t\tconst cursorPosition = this.#inputElement.selectionStart;\n\t\tconst currentValue = this.#inputElement.value;\n\n\t\tthis.#inputElement.value = currentValue.slice(0, cursorPosition) + placeholder + currentValue.slice(\n\t\t\tcursorPosition,\n\t\t);\n\n\t\tconst newCursorPosition = cursorPosition + placeholder.length;\n\t\tthis.#inputElement.setSelectionRange(newCursorPosition, newCursorPosition);\n\n\t\tthis.#inputElement.focus();\n\n\t\tthis.#getDialog().deselectAll();\n\t}\n}\n"],"names":["InlinePlaceholderSelectorMode","INPUT","TEXTAREA","InlinePlaceholderSelector","params","Type","isDomNode","target","Error","isInteger","entityTypeId","mode","value","Dom","append","Dialog","targetNode","multiple","showAvatars","dropdownMode","compactView","enableSearch","entities","id","dynamicLoad","dynamicSearch","searchable","options","events","event","getData","selectedItem","item","Tag","render","bind","show","placeholder","customData","get","cursorPosition","selectionStart","currentValue","slice","newCursorPosition","length","setSelectionRange","focus","deselectAll"],"mappings":"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"}