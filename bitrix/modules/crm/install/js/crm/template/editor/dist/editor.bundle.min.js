this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};(function(e,t,l,a,i,s,r,n,c,o){"use strict";function h(e,t){p(e,t);t.add(e)}function d(e,t,l){p(e,t);t.set(e,l)}function p(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function v(e,t,l){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return l}var u=new WeakMap;var b=new WeakMap;var f=new WeakMap;var P=new WeakMap;var w=new WeakMap;var E=new WeakSet;var T=new WeakSet;var F=new WeakSet;var H=new WeakSet;var m=new WeakSet;var S=function(){function e(t){var l=t.bindElement,a=t.isTextItemFirst,i=t.onEditorItemClick,s=t.onTextItemClick;babelHelpers.classCallCheck(this,e);h(this,m);h(this,H);h(this,F);h(this,T);h(this,E);d(this,u,{writable:true,value:null});d(this,b,{writable:true,value:null});d(this,f,{writable:true,value:false});d(this,P,{writable:true,value:function e(){}});d(this,w,{writable:true,value:function e(){}});babelHelpers.classPrivateFieldSet(this,b,l);babelHelpers.classPrivateFieldSet(this,f,a);babelHelpers.classPrivateFieldSet(this,P,i);babelHelpers.classPrivateFieldSet(this,w,s)}babelHelpers.createClass(e,[{key:"show",value:function e(){v(this,E,y).call(this).show()}}]);return e}();function y(){if(babelHelpers.classPrivateFieldGet(this,u)===null){babelHelpers.classPrivateFieldSet(this,u,n.MenuManager.create({id:"crm-template-editor-placeholder-selector",bindElement:babelHelpers.classPrivateFieldGet(this,b),autoHide:true,offsetLeft:20,angle:true,closeByEsc:false,cacheable:false,items:v(this,T,g).call(this)}))}return babelHelpers.classPrivateFieldGet(this,u)}function g(){var e=v(this,F,k).call(this);var t=v(this,H,L).call(this);if(babelHelpers.classPrivateFieldGet(this,f)){return[t,e]}return[e,t]}function k(){var e=this;return{html:v(this,m,I).call(this,"CRM_TEMPLATE_EDITOR_SELECT_FIELD"),onclick:function t(){babelHelpers.classPrivateFieldGet(e,P).call(e,babelHelpers.classPrivateFieldGet(e,b))}}}function L(){var e=this;var t=babelHelpers.classPrivateFieldGet(this,f)?"CRM_TEMPLATE_EDITOR_UPDATE_TEXT":"CRM_TEMPLATE_EDITOR_CREATE_TEXT";return{html:v(this,m,I).call(this,t),onclick:function t(){v(e,E,y).call(e).close();babelHelpers.classPrivateFieldGet(e,w).call(e,babelHelpers.classPrivateFieldGet(e,b))}}}function I(e){var t='<span class="crm-template-editor-placeholder-selector-menu-item">#ITEM_TEXT#</span>';return t.replace("#ITEM_TEXT#",r.Text.encode(r.Loc.getMessage(e)))}var G,D;function C(e,t){_(e,t);t.add(e)}function M(e,t,l){_(e,t);t.set(e,l)}function _(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function W(e,t,l){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return l}var A=new WeakMap;var O=new WeakMap;var R=new WeakMap;var B=new WeakMap;var x=new WeakMap;var X=new WeakSet;var N=new WeakSet;var U=new WeakSet;var j=new WeakSet;var V=new WeakSet;var z=new WeakSet;var Y=new WeakSet;var q=new WeakSet;var K=new WeakSet;var J=new WeakSet;var Q=new WeakSet;var Z=function(){function e(t){var l=t.bindElement,a=t.value,i=t.onApply;babelHelpers.classCallCheck(this,e);C(this,Q);C(this,J);C(this,K);C(this,q);C(this,Y);C(this,z);C(this,V);C(this,j);C(this,U);C(this,N);C(this,X);M(this,A,{writable:true,value:null});M(this,O,{writable:true,value:null});M(this,R,{writable:true,value:null});M(this,B,{writable:true,value:null});M(this,x,{writable:true,value:function e(){}});babelHelpers.classPrivateFieldSet(this,R,l);babelHelpers.classPrivateFieldSet(this,B,a);babelHelpers.classPrivateFieldSet(this,x,i)}babelHelpers.createClass(e,[{key:"destroy",value:function e(){var t;(t=babelHelpers.classPrivateFieldGet(this,A))===null||t===void 0?void 0:t.destroy()}},{key:"show",value:function e(){W(this,X,$).call(this).show()}}]);return e}();function $(){var e=this;if(babelHelpers.classPrivateFieldGet(this,A)===null){babelHelpers.classPrivateFieldSet(this,A,n.PopupWindowManager.create("crm-template-editor-text-popup",babelHelpers.classPrivateFieldGet(this,R),{autoHide:true,content:W(this,N,ee).call(this),closeByEsc:true,closeIcon:false,buttons:W(this,j,le).call(this),cacheable:false}));babelHelpers.classPrivateFieldGet(this,A).subscribe("onShow",(function(){setTimeout((function(){babelHelpers.classPrivateFieldGet(e,O).focus();W(e,Q,oe).call(e)}),0)}))}return babelHelpers.classPrivateFieldGet(this,A)}function ee(){var e=r.Tag.render(G||(G=babelHelpers.taggedTemplateLiteral(['<div class="crm-template-editor-text-popup-wrapper"></div>'])));babelHelpers.classPrivateFieldSet(this,O,r.Tag.render(D||(D=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<input \n\t\t\t\ttype="text" \n\t\t\t\tvalue="','"\n\t\t\t\tplaceholder="','\n\t\t\t">\n\t\t'])),r.Text.encode(babelHelpers.classPrivateFieldGet(this,B)),r.Loc.getMessage("CRM_TEMPLATE_EDITOR_SELECT_FIELD_PLACEHOLDER")));r.Dom.append(babelHelpers.classPrivateFieldGet(this,O),e);W(this,U,te).call(this);return e}function te(){var e=this;r.Event.bind(babelHelpers.classPrivateFieldGet(this,O),"keyup",(function(t){var l=W(e,K,ne).call(e);if(!l){return}var a=t.target.value;W(e,z,ie).call(e,l,a)}))}function le(){return[W(this,V,ae).call(this),W(this,J,ce).call(this)]}function ae(){var e=this;var t=new s.Button({id:"apply-button",text:W(this,Y,se).call(this),className:"ui-btn ui-btn-xs ui-btn-primary ui-btn-round",onclick:function t(){W(e,q,re).call(e)}});var l=babelHelpers.classPrivateFieldGet(this,O),a=l.value;W(this,z,ie).call(this,t,a);return t}function ie(e,t){e.setState(r.Type.isStringFilled(t)&&r.Type.isStringFilled(t.trim())?s.ButtonState.ACTIVE:s.ButtonState.DISABLED)}function se(){if(r.Type.isStringFilled(babelHelpers.classPrivateFieldGet(this,B))){return r.Loc.getMessage("CRM_TEMPLATE_EDITOR_TEXT_POPUP_UPDATE")}return r.Loc.getMessage("CRM_TEMPLATE_EDITOR_TEXT_POPUP_ADD")}function re(){var e=W(this,K,ne).call(this);if(e.getState()!==s.ButtonState.ACTIVE){return}this.destroy();var t=babelHelpers.classPrivateFieldGet(this,O),l=t.value;babelHelpers.classPrivateFieldGet(this,R).textContent=r.Text.encode(l);babelHelpers.classPrivateFieldGet(this,x).call(this,l.trim())}function ne(){return babelHelpers.classPrivateFieldGet(this,A).getButton("apply-button")}function ce(){var e=this;return new s.Button({text:r.Loc.getMessage("CRM_TEMPLATE_EDITOR_TEXT_POPUP_CANCEL"),className:"ui-btn ui-btn-xs ui-btn-light ui-btn-round",onclick:function t(){e.destroy()}})}function oe(){var e=babelHelpers.classPrivateFieldGet(this,O).value.length;babelHelpers.classPrivateFieldGet(this,O).selectionStart=e;babelHelpers.classPrivateFieldGet(this,O).selectionEnd=e}var he,de;function pe(e,t){ue(e,t);t.add(e)}function ve(e,t,l){ue(e,t);t.set(e,l)}function ue(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function be(e,t,l){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return l}var fe={LOADING:1,SUCCESS:2,FAILED:3};var Pe=new WeakMap;var we=new WeakMap;var Ee=new WeakMap;var Te=new WeakMap;var Fe=new WeakMap;var He=new WeakMap;var me=new WeakSet;var Se=new WeakSet;var ye=function(){function e(t,l,a){babelHelpers.classCallCheck(this,e);pe(this,Se);pe(this,me);ve(this,Pe,{writable:true,value:null});ve(this,we,{writable:true,value:null});ve(this,Ee,{writable:true,value:null});ve(this,Te,{writable:true,value:null});ve(this,Fe,{writable:true,value:null});ve(this,He,{writable:true,value:null});babelHelpers.classPrivateFieldSet(this,we,t);babelHelpers.classPrivateFieldSet(this,Fe,l);babelHelpers.classPrivateFieldSet(this,He,a)}babelHelpers.createClass(e,[{key:"destroy",value:function e(){var t;(t=be(this,me,ge).call(this))===null||t===void 0?void 0:t.destroy()}},{key:"isShown",value:function e(){var t;(t=be(this,me,ge).call(this))===null||t===void 0?void 0:t.isShown()}},{key:"show",value:function e(){var t;(t=be(this,me,ge).call(this))===null||t===void 0?void 0:t.show()}},{key:"apply",value:function e(t){var l=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";var a=be(this,me,ge).call(this).getPopupContainer().querySelector(".popup-window-close-icon");switch(t){case fe.LOADING:{r.Dom.addClass(a,"--hidden");babelHelpers.classPrivateFieldGet(this,Ee).innerText="";if(!babelHelpers.classPrivateFieldGet(this,Te)){babelHelpers.classPrivateFieldSet(this,Te,new c.ProgressBar({color:c.ProgressBar.Color.PRIMARY,size:10,maxValue:100,value:30,infiniteLoading:true}))}be(this,me,ge).call(this).setHeight(75);babelHelpers.classPrivateFieldGet(this,Te).renderTo(babelHelpers.classPrivateFieldGet(this,Ee));break}case fe.SUCCESS:{be(this,me,ge).call(this).setHeight(null);be(this,me,ge).call(this).setAutoHide(true);babelHelpers.classPrivateFieldGet(this,Ee).innerText=l;r.Dom.removeClass(a,"--hidden");r.Dom.addClass(babelHelpers.classPrivateFieldGet(this,Ee),"--loaded");break}case fe.FAILED:{be(this,me,ge).call(this).destroy();o.UI.Notification.Center.notify({content:r.Text.encode(l),autoHideDelay:5e3});break}default:throw new TypeError("Unsupported preview popup content status ".concat(t))}}}]);return e}();function ge(){if(babelHelpers.classPrivateFieldGet(this,Pe)===null){babelHelpers.classPrivateFieldSet(this,Pe,n.PopupWindowManager.create({id:"crm-template-editor-preview-popup-".concat(babelHelpers.classPrivateFieldGet(this,Fe),"-").concat(babelHelpers.classPrivateFieldGet(this,He)),bindElement:babelHelpers.classPrivateFieldGet(this,we),closeIcon:{top:"10px"},cacheable:false,closeByEsc:false,autoHide:false,angle:{position:"top",offset:70},content:be(this,Se,ke).call(this)}))}return babelHelpers.classPrivateFieldGet(this,Pe)}function ke(){babelHelpers.classPrivateFieldSet(this,Ee,r.Tag.render(he||(he=babelHelpers.taggedTemplateLiteral(['<div class="crm-template-editor-preview-popup-content"></div>']))));return r.Tag.render(de||(de=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="crm-template-editor-preview-popup-wrapper">\n\t\t\t\t<div class="crm-template-editor-preview-popup-title">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t\t","\n\t\t\t</div>\n\t\t"])),r.Loc.getMessage("CRM_TEMPLATE_EDITOR_PREVIEW_POPUP_TITLE"),babelHelpers.classPrivateFieldGet(this,Ee))}var Le,Ie,Ge,De,Ce,Me;function _e(e,t){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),l.push.apply(l,a)}return l}function We(e){for(var t=1;t<arguments.length;t++){var l=null!=arguments[t]?arguments[t]:{};t%2?_e(Object(l),!0).forEach((function(t){babelHelpers.defineProperty(e,t,l[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):_e(Object(l)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(l,t))}))}return e}function Ae(e,t){Re(e,t);t.add(e)}function Oe(e,t,l){Re(e,t);t.set(e,l)}function Re(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Be(e,t,l){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return l}var xe="update";var Xe="delete";var Ne="HEADER";var Ue="PREVIEW";var je="FOOTER";var Ve=new WeakMap;var ze=new WeakMap;var Ye=new WeakMap;var qe=new WeakMap;var Ke=new WeakMap;var Je=new WeakMap;var Qe=new WeakMap;var Ze=new WeakMap;var $e=new WeakMap;var et=new WeakMap;var tt=new WeakMap;var lt=new WeakMap;var at=new WeakMap;var it=new WeakMap;var st=new WeakMap;var rt=new WeakMap;var nt=new WeakMap;var ct=new WeakMap;var ot=new WeakMap;var ht=new WeakMap;var dt=new WeakMap;var pt=new WeakSet;var vt=new WeakSet;var ut=new WeakSet;var bt=new WeakSet;var ft=new WeakSet;var Pt=new WeakSet;var wt=new WeakSet;var Et=new WeakSet;var Tt=new WeakSet;var Ft=new WeakSet;var Ht=new WeakSet;var mt=new WeakSet;var St=new WeakSet;var yt=new WeakSet;var gt=new WeakSet;var kt=new WeakSet;var Lt=new WeakSet;var It=function(){function e(t){var l,a,i;babelHelpers.classCallCheck(this,e);Ae(this,Lt);Ae(this,kt);Ae(this,gt);Ae(this,yt);Ae(this,St);Ae(this,mt);Ae(this,Ht);Ae(this,Ft);Ae(this,Tt);Ae(this,Et);Ae(this,wt);Ae(this,Pt);Ae(this,ft);Ae(this,bt);Ae(this,ut);Ae(this,vt);Ae(this,pt);Oe(this,Ve,{writable:true,value:void 0});Oe(this,ze,{writable:true,value:null});Oe(this,Ye,{writable:true,value:null});Oe(this,qe,{writable:true,value:null});Oe(this,Ke,{writable:true,value:null});Oe(this,Je,{writable:true,value:true});Oe(this,Qe,{writable:true,value:true});Oe(this,Ze,{writable:true,value:false});Oe(this,$e,{writable:true,value:false});Oe(this,et,{writable:true,value:null});Oe(this,tt,{writable:true,value:null});Oe(this,lt,{writable:true,value:null});babelHelpers.defineProperty(this,"placeholders",[]);babelHelpers.defineProperty(this,"filledPlaceholders",[]);babelHelpers.defineProperty(this,"onSelect",(function(){}));Oe(this,at,{writable:true,value:null});Oe(this,it,{writable:true,value:null});Oe(this,st,{writable:true,value:null});Oe(this,rt,{writable:true,value:null});Oe(this,nt,{writable:true,value:null});Oe(this,ct,{writable:true,value:null});Oe(this,ot,{writable:true,value:null});Oe(this,ht,{writable:true,value:null});Oe(this,dt,{writable:true,value:null});Be(this,kt,Vt).call(this,t);babelHelpers.classPrivateFieldSet(this,Ve,t.id||"crm-template-editor-".concat(r.Text.getRandom()));babelHelpers.classPrivateFieldSet(this,ze,t.target);babelHelpers.classPrivateFieldSet(this,Ye,t.entityTypeId);babelHelpers.classPrivateFieldSet(this,qe,t.entityId);babelHelpers.classPrivateFieldSet(this,Ke,r.Type.isNumber(t.categoryId)?t.categoryId:null);this.onSelect=t.onSelect;babelHelpers.classPrivateFieldSet(this,Je,Boolean((l=t.canUseFieldsDialog)!==null&&l!==void 0?l:true));babelHelpers.classPrivateFieldSet(this,Qe,Boolean((a=t.canUseFieldValueInput)!==null&&a!==void 0?a:true));babelHelpers.classPrivateFieldSet(this,Ze,Boolean((i=t.canUsePreview)!==null&&i!==void 0?i:false));this.onPlaceholderClick=this.onPlaceholderClick.bind(this);this.onShowInputPopup=this.onShowInputPopup.bind(this);babelHelpers.classPrivateFieldSet(this,rt,{multiple:false,showAvatars:false,dropdownMode:true,compactView:true,enableSearch:true,tagSelectorOptions:{textBoxWidth:"100%"}});if(Be(this,Lt,zt).call(this,t.usePlaceholderProvider)){var s;babelHelpers.classPrivateFieldGet(this,rt).entities=[{id:"placeholder",options:{entityTypeId:babelHelpers.classPrivateFieldGet(this,Ye),entityId:babelHelpers.classPrivateFieldGet(this,qe),categoryId:(s=babelHelpers.classPrivateFieldGet(this,Ke))!==null&&s!==void 0?s:null}}]}if(r.Type.isPlainObject(t.dialogOptions)){babelHelpers.classPrivateFieldSet(this,rt,We(We({},babelHelpers.classPrivateFieldGet(this,rt)),t.dialogOptions))}Be(this,pt,Gt).call(this)}babelHelpers.createClass(e,[{key:"setPlaceholders",value:function e(t){this.placeholders=t;return this}},{key:"setFilledPlaceholders",value:function e(t){this.filledPlaceholders=t;return this}},{key:"setHeader",value:function e(t){if(!r.Type.isStringFilled(t)){return}babelHelpers.classPrivateFieldSet(this,nt,t);r.Dom.append(Be(this,vt,Dt).call(this,t),babelHelpers.classPrivateFieldGet(this,at))}},{key:"setBody",value:function e(t){if(!r.Type.isStringFilled(t)){return}babelHelpers.classPrivateFieldSet(this,ct,t);r.Dom.append(Be(this,vt,Dt).call(this,t),babelHelpers.classPrivateFieldGet(this,it))}},{key:"setFooter",value:function e(t){if(!r.Type.isStringFilled(t)){return}babelHelpers.classPrivateFieldSet(this,ot,t);r.Dom.append(Be(this,vt,Dt).call(this,t),babelHelpers.classPrivateFieldGet(this,st))}},{key:"getData",value:function e(){if(this.placeholders===null){return null}return{header:Be(this,yt,Ut).call(this,Ne),body:Be(this,yt,Ut).call(this,Ue),footer:Be(this,yt,Ut).call(this,je)}}},{key:"getRawData",value:function e(){return{header:babelHelpers.classPrivateFieldGet(this,nt),body:babelHelpers.classPrivateFieldGet(this,ct),footer:babelHelpers.classPrivateFieldGet(this,ot)}}},{key:"onPlaceholderClick",value:function e(t){var l,a=this;var i=t.dialog,s=t.event;(l=babelHelpers.classPrivateFieldGet(this,dt))===null||l===void 0?void 0:l.destroy();var n=Be(this,Ht,xt).call(this,s.target,Ue);var c=r.Type.isStringFilled(n===null||n===void 0?void 0:n.FIELD_VALUE);if(babelHelpers.classPrivateFieldGet(this,Je)&&babelHelpers.classPrivateFieldGet(this,Qe)){babelHelpers.classPrivateFieldSet(this,ht,new S({bindElement:s.target,isTextItemFirst:c,onEditorItemClick:function e(){a.onShowDialogPopup(n,i)},onTextItemClick:function e(t){a.onShowInputPopup(t)}}));babelHelpers.classPrivateFieldGet(this,ht).show()}else if(babelHelpers.classPrivateFieldGet(this,Je)){this.onShowDialogPopup(n,i)}else if(babelHelpers.classPrivateFieldGet(this,Qe)){this.onShowInputPopup(s.target)}}},{key:"onShowDialogPopup",value:function e(t,l){if(r.Type.isStringFilled(t===null||t===void 0?void 0:t.FIELD_VALUE)){l.getPreselectedItems().forEach((function(e){var t=l.getItem(e);if(t){t.deselect()}}))}l.show()}},{key:"onShowInputPopup",value:function e(t){var l=this;var a=Be(this,Ht,xt).call(this,t);var i=r.Type.isStringFilled(a===null||a===void 0?void 0:a.FIELD_VALUE)?a.FIELD_VALUE:"";babelHelpers.classPrivateFieldSet(this,dt,new Z({bindElement:t,value:i,onApply:function e(a){Be(l,ut,Ct).call(l,a,t)}}));babelHelpers.classPrivateFieldGet(this,dt).show()}}]);return e}();function Gt(){if(!babelHelpers.classPrivateFieldGet(this,ze)){return}var e=r.Tag.render(Le||(Le=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div id="','" class="crm-template-editor crm-template-editor__scope"></div>\n\t\t'])),babelHelpers.classPrivateFieldGet(this,Ve));babelHelpers.classPrivateFieldSet(this,at,r.Tag.render(Ie||(Ie=babelHelpers.taggedTemplateLiteral(['<div class="crm-template-editor-header"></div>']))));r.Dom.append(babelHelpers.classPrivateFieldGet(this,at),e);babelHelpers.classPrivateFieldSet(this,it,r.Tag.render(Ge||(Ge=babelHelpers.taggedTemplateLiteral(['<div class="crm-template-editor-body"></div>']))));r.Dom.append(babelHelpers.classPrivateFieldGet(this,it),e);babelHelpers.classPrivateFieldSet(this,st,r.Tag.render(De||(De=babelHelpers.taggedTemplateLiteral(['<div class="crm-template-editor-footer"></div>']))));r.Dom.append(babelHelpers.classPrivateFieldGet(this,st),e);if(babelHelpers.classPrivateFieldGet(this,Ze)){var t=r.Tag.render(Ce||(Ce=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="crm-template-editor-preview-link" href="#">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t"])),r.Loc.getMessage("CRM_TEMPLATE_EDITOR_PREVIEW_LINK_TITLE"));r.Event.bind(t,"click",Be(this,bt,Mt).bind(this));r.Dom.append(t,e)}r.Dom.clean(babelHelpers.classPrivateFieldGet(this,ze));r.Dom.append(e,babelHelpers.classPrivateFieldGet(this,ze))}function Dt(e){var l=this;var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Ue;var i=Be(this,Pt,Wt).call(this,a);if(i===null){return null}var s=Be(this,ft,_t).call(this,e,a);i.forEach((function(e,i){var n=babelHelpers.toConsumableArray(s.childNodes).find((function(e){return e.dataset&&Number(e.dataset.templatePlaceholder)===i}));if(!n){return}var c=r.Runtime.clone(babelHelpers.classPrivateFieldGet(l,rt));Be(l,wt,At).call(l,c,n,a);var o=new t.Dialog(c);r.Event.bind(n,"click",(function(e){l.onPlaceholderClick({dialog:o,event:e})}))}));return s}function Ct(e,t){var l=Be(this,mt,Xt).call(this,t,Ue);var a={id:l,parentTitle:null,text:e,title:e,entityType:BX.CrmEntityType.resolveName(babelHelpers.classPrivateFieldGet(this,Ye)).toLowerCase()};t.textContent=e;r.Dom.addClass(t,"--selected");Be(this,Et,Ot).call(this,a);this.onSelect(a)}function Mt(e){var t,l,a=this;if((t=babelHelpers.classPrivateFieldGet(this,lt))!==null&&t!==void 0&&t.isShown()){return}if(babelHelpers.classPrivateFieldGet(this,$e)){var i;(i=babelHelpers.classPrivateFieldGet(this,lt))===null||i===void 0?void 0:i.show();return}if(babelHelpers.classPrivateFieldGet(this,qe)<=0){var s;(s=babelHelpers.classPrivateFieldGet(this,lt))===null||s===void 0?void 0:s.show();return}(l=babelHelpers.classPrivateFieldGet(this,lt))===null||l===void 0?void 0:l.destroy();var n=this.placeholders===null?this.getRawData().body:this.getData().body;var c=BX.util.hashCode(n);if(babelHelpers.classPrivateFieldGet(this,tt)===c){babelHelpers.classPrivateFieldSet(this,lt,new ye(e.target,babelHelpers.classPrivateFieldGet(this,Ye),babelHelpers.classPrivateFieldGet(this,qe)));babelHelpers.classPrivateFieldGet(this,lt).apply(fe.SUCCESS,babelHelpers.classPrivateFieldGet(this,et));babelHelpers.classPrivateFieldGet(this,lt).show();return}babelHelpers.classPrivateFieldSet(this,lt,new ye(e.target,babelHelpers.classPrivateFieldGet(this,Ye),babelHelpers.classPrivateFieldGet(this,qe)));babelHelpers.classPrivateFieldGet(this,lt).apply(fe.LOADING);babelHelpers.classPrivateFieldGet(this,lt).show();babelHelpers.classPrivateFieldSet(this,$e,true);r.ajax.runAction("crm.activity.smsplaceholder.preview",{data:{entityTypeId:babelHelpers.classPrivateFieldGet(this,Ye),entityId:babelHelpers.classPrivateFieldGet(this,qe),message:n,entityCategoryId:babelHelpers.classPrivateFieldGet(this,Ke)}}).then((function(e){babelHelpers.classPrivateFieldGet(a,lt).apply(fe.SUCCESS,e.data.preview);babelHelpers.classPrivateFieldSet(a,$e,false);babelHelpers.classPrivateFieldSet(a,tt,c);babelHelpers.classPrivateFieldSet(a,et,e.data.preview)}))["catch"]((function(e){var t;babelHelpers.classPrivateFieldGet(a,lt).apply(fe.FAILED,(t=e.errors[0].message)!==null&&t!==void 0?t:"Unknown error");babelHelpers.classPrivateFieldSet(a,$e,false)}))}function _t(e,t){var l=this;var a=Be(this,Pt,Wt).call(this,t);if(a===null){return null}var i=0;a.forEach((function(t){var a=Be(l,St,Nt).call(l,t);var s=r.Loc.getMessage("CRM_TEMPLATE_EDITOR_EMPTY_PLACEHOLDER_LABEL");var n="crm-template-editor-element-pill";if(a){if(r.Type.isStringFilled(a.PARENT_TITLE)&&r.Type.isStringFilled(a.TITLE)){s="".concat(a.PARENT_TITLE,": ").concat(a.TITLE)}else if(r.Type.isStringFilled(a.TITLE)){s=a.TITLE}else if(r.Type.isStringFilled(a.FIELD_NAME)){s=a.FIELD_NAME}else{s=a.FIELD_VALUE}s=r.Text.encode(s);n+=" --selected"}var c='<span class="'.concat(n,'" data-template-placeholder="').concat(i++,'">').concat(s,"</span>");e=e.replace(t,c)}));return r.Tag.render(Me||(Me=babelHelpers.taggedTemplateLiteral(["<div>","</div>"])),e)}function Wt(e){var t=r.Type.isPlainObject(this.placeholders)?this.placeholders:{};var l=r.Type.isArrayFilled(t[e])?t[e]:[];return r.Type.isArrayLike(l)?l:null}function At(e,t,l){var a,i=this;var s=Be(this,Pt,Wt).call(this,l);var n=(a=s[t.dataset.templatePlaceholder])!==null&&a!==void 0?a:null;if(n){var c=Be(this,St,Nt).call(this,n);if(c){e.preselectedItems=[[c.FIELD_ENTITY_TYPE,c.FIELD_NAME]]}}e.events={onShow:function e(){var l=[{transform:"rotate(0)"},{transform:"rotate(90deg)"},{transform:"rotate(180deg)"}];var a={duration:200,pseudoElement:"::after"};t.animate(l,a);r.Dom.addClass(t,"--flipped")},onHide:function e(){var l=[{transform:"rotate(180deg)"},{transform:"rotate(90deg)"},{transform:"rotate(0)"}];var a={duration:200,pseudoElement:"::after"};t.animate(l,a);r.Dom.removeClass(t,"--flipped")},"Item:onSelect":function e(l){r.Dom.addClass(t,"--selected");var a=l.getData().item;var s=a.supertitle.text;var c=a.title.text;t.textContent="".concat(s,": ").concat(c);var o=a.id;var h=a.entityId;var d={id:n,value:o,parentTitle:s,title:c,entityType:h};Be(i,Et,Ot).call(i,d);i.onSelect(d)}};e.targetNode=t}function Ot(e){var t=e.id,l=e.value,a=e.text,i=e.parentTitle,s=e.title;var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:xe;if(r===Xe){Be(this,Tt,Rt).call(this,t,l);return}Be(this,Ft,Bt).call(this,{id:t,value:l,text:a,parentTitle:i,title:s})}function Rt(e,t){this.filledPlaceholders=this.filledPlaceholders.filter((function(l){return l.PLACEHOLDER_ID!==e||l.FIELD_NAME!==t}))}function Bt(e){var t=e.id,l=e.value,a=e.text,i=e.parentTitle,s=e.title;var r=Be(this,St,Nt).call(this,t);if(r){r.FIELD_NAME=l!==null&&l!==void 0?l:null;r.FIELD_VALUE=a!==null&&a!==void 0?a:null;r.PARENT_TITLE=i;r.TITLE=s}else{this.filledPlaceholders.push({PLACEHOLDER_ID:t,FIELD_NAME:l,FIELD_VALUE:a,PARENT_TITLE:i,TITLE:s})}}function xt(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Ue;var l=Be(this,mt,Xt).call(this,e,t);return Be(this,St,Nt).call(this,l)}function Xt(e){var t;var l=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Ue;var a=Be(this,Pt,Wt).call(this,l);return(t=a[e.dataset.templatePlaceholder])!==null&&t!==void 0?t:null}function Nt(e){return this.filledPlaceholders.find((function(t){return t.PLACEHOLDER_ID===e}))}function Ut(e){var t=Be(this,gt,jt).call(this,e);if(t===null){return null}if(r.Type.isArrayFilled(this.filledPlaceholders)){this.filledPlaceholders.forEach((function(e){if(r.Type.isStringFilled(e.FIELD_NAME)){t=t.replace(e.PLACEHOLDER_ID,"{".concat(e.FIELD_NAME,"}"))}else if(r.Type.isStringFilled(e.FIELD_VALUE)){t=t.replace(e.PLACEHOLDER_ID,e.FIELD_VALUE)}}))}var l=this.placeholders[e];if(r.Type.isArrayFilled(l)){l.forEach((function(e){t=t.replace(e," ")}))}return t}function jt(e){if(e===Ne){return babelHelpers.classPrivateFieldGet(this,nt)}if(e===Ue){return babelHelpers.classPrivateFieldGet(this,ct)}if(e===je){return babelHelpers.classPrivateFieldGet(this,ot)}return null}function Vt(e){if(!r.Type.isPlainObject(e)){throw new TypeError('BX.Crm.Template.Editor: The "params" argument must be object')}if(!r.Type.isDomNode(e.target)){throw new Error('BX.Crm.Template.Editor: The "target" argument must be DOM node')}if(Be(this,Lt,zt).call(this,e.usePlaceholderProvider)&&!BX.CrmEntityType.isDefined(e.entityTypeId)){throw new TypeError('BX.Crm.Template.Editor: The "entityTypeId" argument is not correct')}if(!r.Type.isFunction(e.onSelect)){throw new TypeError('BX.Crm.Template.Editor: The "onSelect" argument is not correct')}}function zt(e){return r.Type.isNil(e)||e===true}e.Editor=It})(this.BX.Crm.Template=this.BX.Crm.Template||{},BX.Crm.EntitySelectorEx,BX.Event,BX,BX.UI.EntitySelector,BX.UI,BX,BX.Main,BX.UI,BX);
//# sourceMappingURL=editor.bundle.map.js