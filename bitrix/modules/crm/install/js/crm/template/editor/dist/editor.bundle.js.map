{"version":3,"file":"editor.bundle.js","sources":["../src/menu-popup.js","../src/text-popup.js","../src/preview-popup.js","../src/editor.js"],"sourcesContent":["import { Loc, Text } from 'main.core';\nimport { Menu, MenuItemOptions, MenuManager } from 'main.popup';\n\nexport default class MenuPopup\n{\n\t#menu: Menu = null;\n\t#bindElement: HTMLElement = null;\n\t#isTextItemFirst: boolean = false;\n\t#onEditorItemClick: Function = () => {};\n\t#onTextItemClick: Function = () => {};\n\n\tconstructor({ bindElement, isTextItemFirst, onEditorItemClick, onTextItemClick })\n\t{\n\t\tthis.#bindElement = bindElement;\n\t\tthis.#isTextItemFirst = isTextItemFirst;\n\t\tthis.#onEditorItemClick = onEditorItemClick;\n\t\tthis.#onTextItemClick = onTextItemClick;\n\t}\n\n\tshow(): void\n\t{\n\t\tthis.#getMenuPopup().show();\n\t}\n\n\t#getMenuPopup(): Menu\n\t{\n\t\tif (this.#menu === null)\n\t\t{\n\t\t\tthis.#menu = MenuManager.create({\n\t\t\t\tid: 'crm-template-editor-placeholder-selector',\n\t\t\t\tbindElement: this.#bindElement,\n\t\t\t\tautoHide: true,\n\t\t\t\toffsetLeft: 20,\n\t\t\t\tangle: true,\n\t\t\t\tcloseByEsc: false,\n\t\t\t\tcacheable: false,\n\t\t\t\titems: this.#getItems(),\n\t\t\t});\n\t\t}\n\n\t\treturn this.#menu;\n\t}\n\n\t#getItems(): Object[]\n\t{\n\t\tconst editorItem = this.#getEditorItem();\n\t\tconst textItem = this.#getTextItem();\n\n\t\tif (this.#isTextItemFirst)\n\t\t{\n\t\t\treturn [\n\t\t\t\ttextItem,\n\t\t\t\teditorItem,\n\t\t\t];\n\t\t}\n\n\t\treturn [\n\t\t\teditorItem,\n\t\t\ttextItem,\n\t\t];\n\t}\n\n\t#getEditorItem(): MenuItemOptions\n\t{\n\t\treturn {\n\t\t\thtml: this.#getItemTitle('CRM_TEMPLATE_EDITOR_SELECT_FIELD'),\n\t\t\tonclick: () => {\n\t\t\t\tthis.#onEditorItemClick(this.#bindElement);\n\t\t\t},\n\t\t};\n\t}\n\n\t#getTextItem(): MenuItemOptions\n\t{\n\t\tconst code = (\n\t\t\tthis.#isTextItemFirst\n\t\t\t\t? 'CRM_TEMPLATE_EDITOR_UPDATE_TEXT'\n\t\t\t\t: 'CRM_TEMPLATE_EDITOR_CREATE_TEXT'\n\t\t);\n\n\t\treturn {\n\t\t\thtml: this.#getItemTitle(code),\n\t\t\tonclick: () => {\n\t\t\t\tthis.#getMenuPopup().close();\n\t\t\t\tthis.#onTextItemClick(this.#bindElement);\n\t\t\t},\n\t\t};\n\t}\n\n\t#getItemTitle(code: string): string\n\t{\n\t\tconst placeholder = '<span class=\"crm-template-editor-placeholder-selector-menu-item\">#ITEM_TEXT#</span>';\n\n\t\treturn placeholder.replace('#ITEM_TEXT#', Text.encode(Loc.getMessage(code)));\n\t}\n}\n","import { Dom, Event, Loc, Tag, Text, Type } from 'main.core';\nimport { Popup, PopupWindowManager } from 'main.popup';\nimport { Button, ButtonState } from 'ui.buttons';\n\nexport default class TextPopup\n{\n\t#popup: Popup = null;\n\t#input: HTMLInputElement = null;\n\t#bindElement: HTMLElement = null;\n\t#value: string = null;\n\t#onApply: Function = () => {};\n\n\tconstructor({ bindElement, value, onApply })\n\t{\n\t\tthis.#bindElement = bindElement;\n\t\tthis.#value = value;\n\t\tthis.#onApply = onApply;\n\t}\n\n\tdestroy(): void\n\t{\n\t\tthis.#popup?.destroy();\n\t}\n\n\tshow(): void\n\t{\n\t\tthis.#getPopup().show();\n\t}\n\n\t#getPopup(): Popup\n\t{\n\t\tif (this.#popup === null)\n\t\t{\n\t\t\tthis.#popup = PopupWindowManager.create(\n\t\t\t\t'crm-template-editor-text-popup',\n\t\t\t\tthis.#bindElement,\n\t\t\t\t{\n\t\t\t\t\tautoHide: true,\n\t\t\t\t\tcontent: this.#getContent(),\n\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\tcloseIcon: false,\n\t\t\t\t\tbuttons: this.#getMenuButtons(),\n\t\t\t\t\tcacheable: false,\n\t\t\t\t},\n\t\t\t);\n\n\t\t\tthis.#popup.subscribe('onShow', () => {\n\t\t\t\t// Give time for input to render before setting focus.\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.#input.focus();\n\t\t\t\t\tthis.#setCursorToEnd();\n\t\t\t\t}, 0);\n\t\t\t});\n\t\t}\n\n\t\treturn this.#popup;\n\t}\n\n\t#getContent(): HTMLElement\n\t{\n\t\tconst content = Tag.render`<div class=\"crm-template-editor-text-popup-wrapper\"></div>`;\n\n\t\tthis.#input = Tag.render`\n\t\t\t<input \n\t\t\t\ttype=\"text\" \n\t\t\t\tvalue=\"${Text.encode(this.#value)}\"\n\t\t\t\tplaceholder=\"${Loc.getMessage('CRM_TEMPLATE_EDITOR_SELECT_FIELD_PLACEHOLDER')}\n\t\t\t\">\n\t\t`;\n\t\tDom.append(this.#input, content);\n\n\t\tthis.#bindInputEvents();\n\n\t\treturn content;\n\t}\n\n\t#bindInputEvents(): void\n\t{\n\t\tEvent.bind(this.#input, 'keyup', (event: Event) => {\n\t\t\tconst button = this.#getApplyButtonInstance();\n\t\t\tif (!button)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { value } = event.target;\n\t\t\tthis.#adjustButtonState(button, value);\n\t\t});\n\t}\n\n\t#getMenuButtons(): Button[]\n\t{\n\t\treturn [\n\t\t\tthis.#getApplyButton(),\n\t\t\tthis.#getCancelButton(),\n\t\t];\n\t}\n\n\t#getApplyButton(): Button\n\t{\n\t\tconst button = new Button({\n\t\t\tid: 'apply-button',\n\t\t\ttext: this.#getApplyButtonText(),\n\t\t\tclassName: 'ui-btn ui-btn-xs ui-btn-primary ui-btn-round',\n\t\t\tonclick: () => {\n\t\t\t\tthis.#onApplyButtonClick();\n\t\t\t},\n\t\t});\n\n\t\tconst { value } = this.#input;\n\t\tthis.#adjustButtonState(button, value);\n\n\t\treturn button;\n\t}\n\n\t#adjustButtonState(button: Button, value: string): void\n\t{\n\t\tbutton.setState(\n\t\t\t(Type.isStringFilled(value) && Type.isStringFilled(value.trim()))\n\t\t\t\t? ButtonState.ACTIVE\n\t\t\t\t: ButtonState.DISABLED\n\t\t);\n\t}\n\n\t#getApplyButtonText(): string\n\t{\n\t\tif (Type.isStringFilled(this.#value))\n\t\t{\n\t\t\treturn Loc.getMessage('CRM_TEMPLATE_EDITOR_TEXT_POPUP_UPDATE');\n\t\t}\n\n\t\treturn Loc.getMessage('CRM_TEMPLATE_EDITOR_TEXT_POPUP_ADD');\n\t}\n\n\t#onApplyButtonClick(): void\n\t{\n\t\tconst button = this.#getApplyButtonInstance();\n\t\tif (button.getState() !== ButtonState.ACTIVE)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.destroy();\n\n\t\tconst { value } = this.#input;\n\t\tthis.#bindElement.textContent = Text.encode(value);\n\n\t\tthis.#onApply(value.trim());\n\t}\n\n\t#getApplyButtonInstance(): Button\n\t{\n\t\treturn this.#popup.getButton('apply-button');\n\t}\n\n\t#getCancelButton(): Button\n\t{\n\t\treturn new Button({\n\t\t\ttext: Loc.getMessage('CRM_TEMPLATE_EDITOR_TEXT_POPUP_CANCEL'),\n\t\t\tclassName: 'ui-btn ui-btn-xs ui-btn-light ui-btn-round',\n\t\t\tonclick: () => {\n\t\t\t\tthis.destroy();\n\t\t\t},\n\t\t});\n\t}\n\n\t#setCursorToEnd(): void\n\t{\n\t\tconst { length } = this.#input.value;\n\n\t\tthis.#input.selectionStart = length;\n\t\tthis.#input.selectionEnd = length;\n\t}\n}\n","import { Dom, Loc, Tag, Text } from 'main.core';\nimport { Popup, PopupWindowManager } from 'main.popup';\nimport { ProgressBar } from 'ui.progressbar';\nimport { UI } from 'ui.notification';\n\nexport const PREVIEW_POPUP_CONTENT_STATUS = {\n\tLOADING: 1,\n\tSUCCESS: 2,\n\tFAILED: 3,\n};\n\nexport default class PreviewPopup\n{\n\t#popup: Popup = null;\n\t#bindElement: HTMLElement = null;\n\t#previewContentContainer: HTMLElement = null;\n\t#previewLoader: ProgressBar = null;\n\t#entityTypeId: number = null;\n\t#entityId: number = null;\n\n\tconstructor(bindElement: HTMLElement, entityTypeId: number, entityId: number)\n\t{\n\t\tthis.#bindElement = bindElement;\n\t\tthis.#entityTypeId = entityTypeId;\n\t\tthis.#entityId = entityId;\n\t}\n\n\tdestroy(): void\n\t{\n\t\tthis.#getPopup()?.destroy();\n\t}\n\n\tisShown(): boolean\n\t{\n\t\tthis.#getPopup()?.isShown();\n\t}\n\n\tshow(): void\n\t{\n\t\tthis.#getPopup()?.show();\n\t}\n\n\tapply(status: number, data: string = ''): void\n\t{\n\t\tconst closeIconElement = this\n\t\t\t.#getPopup()\n\t\t\t.getPopupContainer()\n\t\t\t.querySelector('.popup-window-close-icon')\n\t\t;\n\n\t\tswitch (status)\n\t\t{\n\t\t\tcase PREVIEW_POPUP_CONTENT_STATUS.LOADING:\n\t\t\t{\n\t\t\t\tDom.addClass(closeIconElement, '--hidden');\n\n\t\t\t\tthis.#previewContentContainer.innerText = '';\n\n\t\t\t\tif (!this.#previewLoader)\n\t\t\t\t{\n\t\t\t\t\tthis.#previewLoader = new ProgressBar({\n\t\t\t\t\t\tcolor: ProgressBar.Color.PRIMARY,\n\t\t\t\t\t\tsize: 10,\n\t\t\t\t\t\tmaxValue: 100,\n\t\t\t\t\t\tvalue: 30,\n\t\t\t\t\t\tinfiniteLoading: true,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tthis.#getPopup().setHeight(75);\n\t\t\t\tthis.#previewLoader.renderTo(this.#previewContentContainer);\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase PREVIEW_POPUP_CONTENT_STATUS.SUCCESS:\n\t\t\t{\n\t\t\t\tthis.#getPopup().setHeight(null);\n\t\t\t\tthis.#getPopup().setAutoHide(true);\n\t\t\t\tthis.#previewContentContainer.innerText = data;\n\n\t\t\t\tDom.removeClass(closeIconElement, '--hidden');\n\t\t\t\tDom.addClass(this.#previewContentContainer, '--loaded');\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase PREVIEW_POPUP_CONTENT_STATUS.FAILED:\n\t\t\t{\n\t\t\t\tthis.#getPopup().destroy();\n\n\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\tcontent: Text.encode(data),\n\t\t\t\t\tautoHideDelay: 5000,\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tdefault:\n\t\t\t\tthrow new TypeError(`Unsupported preview popup content status ${status}`);\n\t\t}\n\t}\n\n\t#getPopup(): Popup\n\t{\n\t\tif (this.#popup === null)\n\t\t{\n\t\t\tthis.#popup = PopupWindowManager.create({\n\t\t\t\tid: `crm-template-editor-preview-popup-${this.#entityTypeId}-${this.#entityId}`,\n\t\t\t\tbindElement: this.#bindElement,\n\t\t\t\tcloseIcon: { top: '10px' },\n\t\t\t\tcacheable: false,\n\t\t\t\tcloseByEsc: false,\n\t\t\t\tautoHide: false,\n\t\t\t\tangle: {\n\t\t\t\t\tposition: 'top',\n\t\t\t\t\toffset: 70,\n\t\t\t\t},\n\t\t\t\tcontent: this.#getContent(),\n\t\t\t});\n\t\t}\n\n\t\treturn this.#popup;\n\t}\n\n\t#getContent(): HTMLElement\n\t{\n\t\tthis.#previewContentContainer = Tag.render`<div class=\"crm-template-editor-preview-popup-content\"></div>`;\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-template-editor-preview-popup-wrapper\">\n\t\t\t\t<div class=\"crm-template-editor-preview-popup-title\">\n\t\t\t\t\t${Loc.getMessage('CRM_TEMPLATE_EDITOR_PREVIEW_POPUP_TITLE')}\n\t\t\t\t</div>\n\t\t\t\t${this.#previewContentContainer}\n\t\t\t</div>\n\t\t`;\n\t}\n}\n","import { Dialog } from 'crm.entity-selector';\nimport { ajax as Ajax, Dom, Event, Loc, Runtime, Tag, Text, Type } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport { Menu, Popup } from 'main.popup';\n\nimport 'ui.design-tokens';\nimport { DialogOptions } from 'ui.entity-selector';\nimport type { EditorOptions } from './editor-options';\nimport './editor.css';\nimport MenuPopup from './menu-popup';\nimport TextPopup from './text-popup';\nimport PreviewPopup, { PREVIEW_POPUP_CONTENT_STATUS } from './preview-popup';\nimport type { FilledPlaceholder } from './types';\n\nconst UPDATE_ACTION = 'update';\nconst DELETE_ACTION = 'delete';\n\nconst HEADER_POSITION = 'HEADER';\nconst PREVIEW_POSITION = 'PREVIEW';\nconst FOOTER_POSITION = 'FOOTER';\n\nexport class Editor\n{\n\t#id: ?string;\n\t#target: HTMLElement = null;\n\t#entityTypeId: number = null;\n\t#entityId: number = null;\n\t#categoryId: ?number = null;\n\t#canUseFieldsDialog: boolean = true;\n\t#canUseFieldValueInput: boolean = true;\n\n\t#canUsePreview: boolean = false;\n\t#isUsePreviewRequestRunning: boolean = false;\n\t#lastPreview: ?string = null;\n\t#lastPreviewTemplateHash: ?number = null;\n\t#previewPopup: ?PreviewPopup = null;\n\tplaceholders: string[] = [];\n\tfilledPlaceholders: FilledPlaceholder[] = [];\n\tonSelect = () => {};\n\n\t// @todo replace this variables with a generic container\n\t#headerContainerEl: ?HTMLElement = null;\n\t#bodyContainerEl: ?HTMLElement = null;\n\t#footerContainerEl: ?HTMLElement = null;\n\n\t#placeHoldersDialogDefaultOptions: ?DialogOptions = null;\n\n\t#headerRaw: ?string = null;\n\t#bodyRaw: ?string = null;\n\t#footerRaw: ?string = null;\n\n\t#popupMenu: ?Menu = null;\n\t#inputPopup: ?Popup = null;\n\n\tconstructor(params: EditorOptions)\n\t{\n\t\tthis.#assertValidParams(params);\n\n\t\tthis.#id = params.id || `crm-template-editor-${Text.getRandom()}`;\n\t\tthis.#target = params.target;\n\t\tthis.#entityTypeId = params.entityTypeId;\n\t\tthis.#entityId = params.entityId;\n\t\tthis.#categoryId = Type.isNumber(params.categoryId) ? params.categoryId : null;\n\t\tthis.onSelect = params.onSelect;\n\n\t\tthis.#canUseFieldsDialog = Boolean(params.canUseFieldsDialog ?? true);\n\t\tthis.#canUseFieldValueInput = Boolean(params.canUseFieldValueInput ?? true);\n\t\tthis.#canUsePreview = Boolean(params.canUsePreview ?? false);\n\n\t\tthis.onPlaceholderClick = this.onPlaceholderClick.bind(this);\n\t\tthis.onShowInputPopup = this.onShowInputPopup.bind(this);\n\n\t\tthis.#placeHoldersDialogDefaultOptions = {\n\t\t\tmultiple: false,\n\t\t\tshowAvatars: false,\n\t\t\tdropdownMode: true,\n\t\t\tcompactView: true,\n\t\t\tenableSearch: true,\n\t\t\ttagSelectorOptions: {\n\t\t\t\ttextBoxWidth: '100%',\n\t\t\t},\n\t\t};\n\n\t\tif (this.#canUsePlaceholderProvider(params.usePlaceholderProvider))\n\t\t{\n\t\t\tthis.#placeHoldersDialogDefaultOptions.entities = [{\n\t\t\t\tid: 'placeholder',\n\t\t\t\toptions: {\n\t\t\t\t\tentityTypeId: this.#entityTypeId,\n\t\t\t\t\tentityId: this.#entityId,\n\t\t\t\t\tcategoryId: this.#categoryId ?? null,\n\t\t\t\t},\n\t\t\t}];\n\t\t}\n\n\t\tif (Type.isPlainObject(params.dialogOptions))\n\t\t{\n\t\t\tthis.#placeHoldersDialogDefaultOptions = { ...this.#placeHoldersDialogDefaultOptions, ...params.dialogOptions };\n\t\t}\n\n\t\tthis.#createContainer();\n\t}\n\n\tsetPlaceholders(placeholders: string[]): this\n\t{\n\t\tthis.placeholders = placeholders;\n\n\t\treturn this;\n\t}\n\n\tsetFilledPlaceholders(filledPlaceholders: FilledPlaceholder[]): this\n\t{\n\t\tthis.filledPlaceholders = filledPlaceholders;\n\n\t\treturn this;\n\t}\n\n\t// region Public methods\n\tsetHeader(input: string): void\n\t{\n\t\tif (!Type.isStringFilled(input))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#headerRaw = input;\n\t\tDom.append(this.#createContainerWithSelectors(input), this.#headerContainerEl);\n\t}\n\n\tsetBody(input: string): void\n\t{\n\t\tif (!Type.isStringFilled(input))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#bodyRaw = input;\n\t\tDom.append(this.#createContainerWithSelectors(input), this.#bodyContainerEl);\n\t}\n\n\tsetFooter(input: string): void\n\t{\n\t\tif (!Type.isStringFilled(input))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#footerRaw = input;\n\t\tDom.append(this.#createContainerWithSelectors(input), this.#footerContainerEl);\n\t}\n\n\tgetData(): ?Object\n\t{\n\t\tif (this.placeholders === null)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\theader: this.#getPlainText(HEADER_POSITION),\n\t\t\tbody: this.#getPlainText(PREVIEW_POSITION),\n\t\t\tfooter: this.#getPlainText(FOOTER_POSITION),\n\t\t};\n\t}\n\n\tgetRawData(): Object\n\t{\n\t\treturn {\n\t\t\theader: this.#headerRaw,\n\t\t\tbody: this.#bodyRaw,\n\t\t\tfooter: this.#footerRaw,\n\t\t};\n\t}\n\t// endregion\n\n\t#createContainer(): void\n\t{\n\t\tif (!this.#target)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst containerEl = Tag.render`\n\t\t\t<div id=\"${this.#id}\" class=\"crm-template-editor crm-template-editor__scope\"></div>\n\t\t`;\n\n\t\tthis.#headerContainerEl = Tag.render`<div class=\"crm-template-editor-header\"></div>`;\n\t\tDom.append(this.#headerContainerEl, containerEl);\n\t\tthis.#bodyContainerEl = Tag.render`<div class=\"crm-template-editor-body\"></div>`;\n\t\tDom.append(this.#bodyContainerEl, containerEl);\n\t\tthis.#footerContainerEl = Tag.render`<div class=\"crm-template-editor-footer\"></div>`;\n\t\tDom.append(this.#footerContainerEl, containerEl);\n\n\t\tif (this.#canUsePreview)\n\t\t{\n\t\t\tconst previewLink = Tag.render`\n\t\t\t\t<div class=\"crm-template-editor-preview-link\" href=\"#\">\n\t\t\t\t\t${Loc.getMessage('CRM_TEMPLATE_EDITOR_PREVIEW_LINK_TITLE')}\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tEvent.bind(previewLink, 'click', this.#onPreviewTemplate.bind(this));\n\t\t\tDom.append(previewLink, containerEl);\n\t\t}\n\n\t\tDom.clean(this.#target);\n\t\tDom.append(containerEl, this.#target);\n\t}\n\n\t#createContainerWithSelectors(input: string, position: string = PREVIEW_POSITION): ?HTMLElement\n\t{\n\t\tconst placeholders = this.#getPlaceholders(position);\n\t\tif (placeholders === null)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst container = this.#getInputContainer(input, position);\n\n\t\tplaceholders.forEach((placeholder, key) => {\n\t\t\tconst element = [...container.childNodes].find(\n\t\t\t\t(node) => node.dataset && Number(node.dataset.templatePlaceholder) === key,\n\t\t\t);\n\n\t\t\tif (!element)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst dlgOptions = Runtime.clone(this.#placeHoldersDialogDefaultOptions);\n\t\t\tthis.#prepareDlgOptions(dlgOptions, element, position);\n\n\t\t\tconst dialog = new Dialog(dlgOptions);\n\n\t\t\tEvent.bind(element, 'click', (event) => {\n\t\t\t\tthis.onPlaceholderClick({ dialog, event });\n\t\t\t});\n\t\t});\n\n\t\treturn container;\n\t}\n\n\tonPlaceholderClick({ dialog, event }): void\n\t{\n\t\tthis.#inputPopup?.destroy();\n\n\t\tconst filledPlaceholder = this.#getFilledPlaceholderByElement(event.target, PREVIEW_POSITION);\n\t\tconst isTextItemFirst = Type.isStringFilled(filledPlaceholder?.FIELD_VALUE);\n\n\t\tif (this.#canUseFieldsDialog && this.#canUseFieldValueInput)\n\t\t{\n\t\t\tthis.#popupMenu = new MenuPopup({\n\t\t\t\tbindElement: event.target,\n\t\t\t\tisTextItemFirst,\n\t\t\t\tonEditorItemClick: () => {\n\t\t\t\t\tthis.onShowDialogPopup(filledPlaceholder, dialog);\n\t\t\t\t},\n\t\t\t\tonTextItemClick: (element: HTMLElement) => {\n\t\t\t\t\tthis.onShowInputPopup(element);\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tthis.#popupMenu.show();\n\t\t}\n\t\telse if (this.#canUseFieldsDialog)\n\t\t{\n\t\t\tthis.onShowDialogPopup(filledPlaceholder, dialog);\n\t\t}\n\t\telse if (this.#canUseFieldValueInput)\n\t\t{\n\t\t\tthis.onShowInputPopup(event.target);\n\t\t}\n\t}\n\n\tonShowDialogPopup(filledPlaceholder: FilledPlaceholder, dialog: Dialog): void\n\t{\n\t\tif (Type.isStringFilled(filledPlaceholder?.FIELD_VALUE))\n\t\t{\n\t\t\tdialog.getPreselectedItems().forEach((preselectedItem) => {\n\t\t\t\tconst item = dialog.getItem(preselectedItem);\n\t\t\t\tif (item)\n\t\t\t\t{\n\t\t\t\t\titem.deselect();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tdialog.show();\n\t}\n\n\tonShowInputPopup(bindElement: HTMLElement): void\n\t{\n\t\tconst filledPlaceholder = this.#getFilledPlaceholderByElement(bindElement);\n\t\tconst value = Type.isStringFilled(filledPlaceholder?.FIELD_VALUE) ? filledPlaceholder.FIELD_VALUE : '';\n\n\t\tthis.#inputPopup = new TextPopup({\n\t\t\tbindElement,\n\t\t\tvalue,\n\t\t\tonApply: (newValue: string) => {\n\t\t\t\tthis.#onApplyInputPopup(newValue, bindElement);\n\t\t\t},\n\t\t});\n\n\t\tthis.#inputPopup.show();\n\t}\n\n\t#onApplyInputPopup(value: string, bindElement: HTMLElement): void\n\t{\n\t\tconst placeholderId = this.#getPlaceholderIdByElement(bindElement, PREVIEW_POSITION);\n\n\t\tconst params = {\n\t\t\tid: placeholderId,\n\t\t\tparentTitle: null,\n\t\t\ttext: value,\n\t\t\ttitle: value,\n\t\t\tentityType: BX.CrmEntityType.resolveName(this.#entityTypeId).toLowerCase(),\n\t\t};\n\n\t\t// eslint-disable-next-line no-param-reassign\n\t\tbindElement.textContent = value;\n\t\tDom.addClass(bindElement, '--selected');\n\n\t\tthis.#adjustFilledPlaceholders(params);\n\t\tthis.onSelect(params);\n\t}\n\n\t#onPreviewTemplate(event: BaseEvent): void\n\t{\n\t\tif (this.#previewPopup?.isShown())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#isUsePreviewRequestRunning)\n\t\t{\n\t\t\tthis.#previewPopup?.show();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#entityId <= 0)\n\t\t{\n\t\t\tthis.#previewPopup?.show();\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#previewPopup?.destroy();\n\n\t\tconst currentTemplate = this.placeholders === null\n\t\t\t? this.getRawData().body\n\t\t\t: this.getData().body; // TODO: implement header and footer processing\n\t\tconst currentTemplateHash = BX.util.hashCode(currentTemplate);\n\t\tif (this.#lastPreviewTemplateHash === currentTemplateHash)\n\t\t{\n\t\t\tthis.#previewPopup = new PreviewPopup(event.target, this.#entityTypeId, this.#entityId);\n\t\t\tthis.#previewPopup.apply(PREVIEW_POPUP_CONTENT_STATUS.SUCCESS, this.#lastPreview);\n\t\t\tthis.#previewPopup.show();\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#previewPopup = new PreviewPopup(event.target, this.#entityTypeId, this.#entityId);\n\t\tthis.#previewPopup.apply(PREVIEW_POPUP_CONTENT_STATUS.LOADING);\n\t\tthis.#previewPopup.show();\n\t\tthis.#isUsePreviewRequestRunning = true;\n\n\t\tAjax.runAction(\n\t\t\t'crm.activity.smsplaceholder.preview',\n\t\t\t{\n\t\t\t\tdata: {\n\t\t\t\t\tentityTypeId: this.#entityTypeId,\n\t\t\t\t\tentityId: this.#entityId,\n\t\t\t\t\tmessage: currentTemplate,\n\t\t\t\t\tentityCategoryId: this.#categoryId,\n\t\t\t\t},\n\t\t\t},\n\t\t).then((response) => {\n\t\t\tthis.#previewPopup.apply(\n\t\t\t\tPREVIEW_POPUP_CONTENT_STATUS.SUCCESS,\n\t\t\t\tresponse.data.preview,\n\t\t\t);\n\t\t\tthis.#isUsePreviewRequestRunning = false;\n\t\t\tthis.#lastPreviewTemplateHash = currentTemplateHash;\n\t\t\tthis.#lastPreview = response.data.preview;\n\t\t}).catch((response) => {\n\t\t\tthis.#previewPopup.apply(\n\t\t\t\tPREVIEW_POPUP_CONTENT_STATUS.FAILED,\n\t\t\t\tresponse.errors[0].message ?? 'Unknown error',\n\t\t\t);\n\t\t\tthis.#isUsePreviewRequestRunning = false;\n\t\t});\n\t}\n\n\t#getInputContainer(input: string, position: string): ?HTMLElement\n\t{\n\t\tconst placeholders = this.#getPlaceholders(position);\n\t\tif (placeholders === null)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tlet i = 0;\n\t\tplaceholders.forEach((placeholder) => {\n\t\t\tconst filledPlaceholder = this.#getFilledPlaceholderById(placeholder);\n\n\t\t\tlet title = Loc.getMessage('CRM_TEMPLATE_EDITOR_EMPTY_PLACEHOLDER_LABEL');\n\t\t\tlet spanClass = 'crm-template-editor-element-pill';\n\t\t\tif (filledPlaceholder)\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\tType.isStringFilled(filledPlaceholder.PARENT_TITLE)\n\t\t\t\t\t&& Type.isStringFilled(filledPlaceholder.TITLE))\n\t\t\t\t{\n\t\t\t\t\ttitle = `${filledPlaceholder.PARENT_TITLE}: ${filledPlaceholder.TITLE}`;\n\t\t\t\t}\n\t\t\t\telse if (Type.isStringFilled(filledPlaceholder.TITLE))\n\t\t\t\t{\n\t\t\t\t\ttitle = filledPlaceholder.TITLE;\n\t\t\t\t}\n\t\t\t\telse if (Type.isStringFilled(filledPlaceholder.FIELD_NAME))\n\t\t\t\t{\n\t\t\t\t\ttitle = filledPlaceholder.FIELD_NAME;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ttitle = filledPlaceholder.FIELD_VALUE;\n\t\t\t\t}\n\n\t\t\t\ttitle = Text.encode(title);\n\t\t\t\tspanClass += ' --selected';\n\t\t\t}\n\n\t\t\tconst replaceValue = `<span class=\"${spanClass}\" data-template-placeholder=\"${i++}\">${title}</span>`;\n\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\tinput = input.replace(placeholder, replaceValue);\n\t\t});\n\n\t\treturn Tag.render`<div>${input}</div>`;\n\t}\n\n\t#getPlaceholders(position: string): ?[]\n\t{\n\t\tconst allPlaceholders = Type.isPlainObject(this.placeholders) ? this.placeholders : {};\n\t\tconst placeholders = Type.isArrayFilled(allPlaceholders[position]) ? allPlaceholders[position] : [];\n\n\t\treturn Type.isArrayLike(placeholders) ? placeholders : null;\n\t}\n\n\t#prepareDlgOptions(dlgOptions: DialogOptions, element: HTMLElement, position: string): void\n\t{\n\t\tconst placeholders = this.#getPlaceholders(position);\n\t\tconst placeholderId = placeholders[element.dataset.templatePlaceholder] ?? null;\n\t\tif (placeholderId)\n\t\t{\n\t\t\tconst filledPlaceholder = this.#getFilledPlaceholderById(placeholderId);\n\t\t\tif (filledPlaceholder)\n\t\t\t{\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tdlgOptions.preselectedItems = [\n\t\t\t\t\t[\n\t\t\t\t\t\tfilledPlaceholder.FIELD_ENTITY_TYPE,\n\t\t\t\t\t\tfilledPlaceholder.FIELD_NAME,\n\t\t\t\t\t],\n\t\t\t\t];\n\t\t\t}\n\t\t}\n\n\t\t// eslint-disable-next-line no-param-reassign\n\t\tdlgOptions.events = {\n\t\t\tonShow: () => {\n\t\t\t\tconst keyframes = [\n\t\t\t\t\t{ transform: 'rotate(0)' },\n\t\t\t\t\t{ transform: 'rotate(90deg)' },\n\t\t\t\t\t{ transform: 'rotate(180deg)' },\n\t\t\t\t];\n\t\t\t\tconst options = {\n\t\t\t\t\tduration: 200,\n\t\t\t\t\tpseudoElement: '::after',\n\t\t\t\t};\n\n\t\t\t\telement.animate(keyframes, options);\n\t\t\t\tDom.addClass(element, '--flipped');\n\t\t\t},\n\t\t\tonHide: () => {\n\t\t\t\tconst keyframes = [\n\t\t\t\t\t{ transform: 'rotate(180deg)' },\n\t\t\t\t\t{ transform: 'rotate(90deg)' },\n\t\t\t\t\t{ transform: 'rotate(0)' },\n\t\t\t\t];\n\t\t\t\tconst options = {\n\t\t\t\t\tduration: 200,\n\t\t\t\t\tpseudoElement: '::after',\n\t\t\t\t};\n\n\t\t\t\telement.animate(keyframes, options);\n\t\t\t\tDom.removeClass(element, '--flipped');\n\t\t\t},\n\t\t\t'Item:onSelect': (event: BaseEvent): void => {\n\t\t\t\tDom.addClass(element, '--selected');\n\n\t\t\t\tconst item = event.getData().item;\n\t\t\t\tconst parentTitle = item.supertitle.text;\n\t\t\t\tconst title = item.title.text;\n\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\telement.textContent = `${parentTitle}: ${title}`;\n\n\t\t\t\tconst value = item.id;\n\t\t\t\tconst entityType = item.entityId;\n\n\t\t\t\tconst params = {\n\t\t\t\t\tid: placeholderId,\n\t\t\t\t\tvalue,\n\t\t\t\t\tparentTitle,\n\t\t\t\t\ttitle,\n\t\t\t\t\tentityType,\n\t\t\t\t};\n\n\t\t\t\tthis.#adjustFilledPlaceholders(params);\n\t\t\t\tthis.onSelect(params);\n\t\t\t},\n\t\t};\n\n\t\t// eslint-disable-next-line no-param-reassign\n\t\tdlgOptions.targetNode = element;\n\t}\n\n\t#adjustFilledPlaceholders({ id, value, text, parentTitle, title }, action: string = UPDATE_ACTION): void\n\t{\n\t\tif (action === DELETE_ACTION)\n\t\t{\n\t\t\tthis.#deleteFromFilledPlaceholders(id, value);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#updateForFilledPlaceholders({ id, value, text, parentTitle, title });\n\t}\n\n\t#deleteFromFilledPlaceholders(id: string, value: string): void\n\t{\n\t\tthis.filledPlaceholders = this.filledPlaceholders.filter(\n\t\t\t(filledPlaceholder) => {\n\t\t\t\treturn filledPlaceholder.PLACEHOLDER_ID !== id || filledPlaceholder.FIELD_NAME !== value;\n\t\t\t},\n\t\t);\n\t}\n\n\t#updateForFilledPlaceholders({ id, value, text, parentTitle, title }): void\n\t{\n\t\tconst filledPlaceholder = this.#getFilledPlaceholderById(id);\n\n\t\tif (filledPlaceholder)\n\t\t{\n\t\t\tfilledPlaceholder.FIELD_NAME = value ?? null;\n\t\t\tfilledPlaceholder.FIELD_VALUE = text ?? null;\n\t\t\tfilledPlaceholder.PARENT_TITLE = parentTitle;\n\t\t\tfilledPlaceholder.TITLE = title;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.filledPlaceholders.push({\n\t\t\t\tPLACEHOLDER_ID: id,\n\t\t\t\tFIELD_NAME: value,\n\t\t\t\tFIELD_VALUE: text,\n\t\t\t\tPARENT_TITLE: parentTitle,\n\t\t\t\tTITLE: title,\n\t\t\t});\n\t\t}\n\t}\n\n\t#getFilledPlaceholderByElement(element: HTMLElement, position: string = PREVIEW_POSITION): ?FilledPlaceholder\n\t{\n\t\tconst placeholderId = this.#getPlaceholderIdByElement(element, position);\n\n\t\treturn this.#getFilledPlaceholderById(placeholderId);\n\t}\n\n\t#getPlaceholderIdByElement(element: HTMLElement, position: string = PREVIEW_POSITION): ?string\n\t{\n\t\tconst placeholders = this.#getPlaceholders(position);\n\n\t\treturn placeholders[element.dataset.templatePlaceholder] ?? null;\n\t}\n\n\t#getFilledPlaceholderById(placeholderId: string): ?FilledPlaceholder\n\t{\n\t\treturn this.filledPlaceholders.find(\n\t\t\t(filledPlaceholderItem) => filledPlaceholderItem.PLACEHOLDER_ID === placeholderId,\n\t\t);\n\t}\n\n\t#getPlainText(position: string): ?string\n\t{\n\t\tlet text = this.#getRawTextByPosition(position);\n\t\tif (text === null)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tif (Type.isArrayFilled(this.filledPlaceholders))\n\t\t{\n\t\t\tthis.filledPlaceholders.forEach((filledPlaceholder) => {\n\t\t\t\tif (Type.isStringFilled(filledPlaceholder.FIELD_NAME))\n\t\t\t\t{\n\t\t\t\t\ttext = text.replace(filledPlaceholder.PLACEHOLDER_ID, `{${filledPlaceholder.FIELD_NAME}}`);\n\t\t\t\t}\n\t\t\t\telse if (Type.isStringFilled(filledPlaceholder.FIELD_VALUE))\n\t\t\t\t{\n\t\t\t\t\ttext = text.replace(filledPlaceholder.PLACEHOLDER_ID, filledPlaceholder.FIELD_VALUE);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tconst placeholders = this.placeholders[position];\n\t\tif (Type.isArrayFilled(placeholders))\n\t\t{\n\t\t\tplaceholders.forEach((placeholder) => {\n\t\t\t\ttext = text.replace(placeholder, ' ');\n\t\t\t});\n\t\t}\n\n\t\treturn text;\n\t}\n\n\t#getRawTextByPosition(position: string): ?string\n\t{\n\t\tif (position === HEADER_POSITION)\n\t\t{\n\t\t\treturn this.#headerRaw;\n\t\t}\n\n\t\tif (position === PREVIEW_POSITION)\n\t\t{\n\t\t\treturn this.#bodyRaw;\n\t\t}\n\n\t\tif (position === FOOTER_POSITION)\n\t\t{\n\t\t\treturn this.#footerRaw;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t#assertValidParams(params: EditorOptions): void\n\t{\n\t\tif (!Type.isPlainObject(params))\n\t\t{\n\t\t\tthrow new TypeError('BX.Crm.Template.Editor: The \"params\" argument must be object');\n\t\t}\n\n\t\tif (!Type.isDomNode(params.target))\n\t\t{\n\t\t\tthrow new Error('BX.Crm.Template.Editor: The \"target\" argument must be DOM node');\n\t\t}\n\n\t\tif (\n\t\t\tthis.#canUsePlaceholderProvider(params.usePlaceholderProvider)\n\t\t\t&& !BX.CrmEntityType.isDefined(params.entityTypeId)\n\t\t)\n\t\t{\n\t\t\tthrow new TypeError('BX.Crm.Template.Editor: The \"entityTypeId\" argument is not correct');\n\t\t}\n\n\t\tif (!Type.isFunction(params.onSelect))\n\t\t{\n\t\t\tthrow new TypeError('BX.Crm.Template.Editor: The \"onSelect\" argument is not correct');\n\t\t}\n\t}\n\n\t#canUsePlaceholderProvider(value): boolean\n\t{\n\t\treturn (Type.isNil(value) || value === true);\n\t}\n}\n"],"names":["MenuPopup","bindElement","isTextItemFirst","onEditorItemClick","onTextItemClick","show","MenuManager","create","id","autoHide","offsetLeft","angle","closeByEsc","cacheable","items","editorItem","textItem","html","onclick","code","close","placeholder","replace","Text","encode","Loc","getMessage","TextPopup","value","onApply","_classPrivateMethodInitSpec","_classPrivateFieldInitSpec","destroy","_classPrivateMethodGet","PopupWindowManager","content","closeIcon","buttons","subscribe","setTimeout","focus","Tag","render","Dom","append","Event","bind","event","button","target","Button","text","className","setState","Type","isStringFilled","trim","ButtonState","ACTIVE","DISABLED","getState","textContent","getButton","length","selectionStart","selectionEnd","PREVIEW_POPUP_CONTENT_STATUS","LOADING","SUCCESS","FAILED","PreviewPopup","entityTypeId","entityId","isShown","status","data","closeIconElement","getPopupContainer","querySelector","addClass","innerText","ProgressBar","color","Color","PRIMARY","size","maxValue","infiniteLoading","setHeight","renderTo","setAutoHide","removeClass","UI","Notification","Center","notify","autoHideDelay","TypeError","top","position","offset","UPDATE_ACTION","DELETE_ACTION","HEADER_POSITION","PREVIEW_POSITION","FOOTER_POSITION","Editor","params","getRandom","isNumber","categoryId","onSelect","Boolean","canUseFieldsDialog","canUseFieldValueInput","canUsePreview","onPlaceholderClick","onShowInputPopup","multiple","showAvatars","dropdownMode","compactView","enableSearch","tagSelectorOptions","textBoxWidth","usePlaceholderProvider","entities","options","isPlainObject","dialogOptions","placeholders","filledPlaceholders","input","header","body","footer","dialog","filledPlaceholder","FIELD_VALUE","onShowDialogPopup","element","getPreselectedItems","forEach","preselectedItem","item","getItem","deselect","newValue","containerEl","previewLink","clean","container","key","childNodes","find","node","dataset","Number","templatePlaceholder","dlgOptions","Runtime","clone","Dialog","placeholderId","parentTitle","title","entityType","BX","CrmEntityType","resolveName","toLowerCase","currentTemplate","getRawData","getData","currentTemplateHash","util","hashCode","apply","Ajax","runAction","message","entityCategoryId","then","response","preview","errors","i","spanClass","PARENT_TITLE","TITLE","FIELD_NAME","replaceValue","allPlaceholders","isArrayFilled","isArrayLike","preselectedItems","FIELD_ENTITY_TYPE","events","onShow","keyframes","transform","duration","pseudoElement","animate","onHide","supertitle","targetNode","action","filter","PLACEHOLDER_ID","push","filledPlaceholderItem","isDomNode","Error","isDefined","isFunction","isNil"],"mappings":"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"}