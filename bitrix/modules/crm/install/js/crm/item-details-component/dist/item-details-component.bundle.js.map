{"version":3,"file":"item-details-component.bundle.js","sources":["../src/item-details-component.js"],"sourcesContent":["import { ReceiverRepository } from 'crm.messagesender';\nimport type { StageModelData } from 'crm.stage-model';\nimport { StageModel } from 'crm.stage-model';\nimport { PermissionChecker as StagePermissionChecker } from 'crm.stage.permission-checker';\nimport { ajax as Ajax, Dom, Loc, Reflection, Runtime, Tag, Text, Type, Uri } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Loader } from 'main.loader';\nimport { PopupMenu } from 'main.popup';\nimport { MessageBox, MessageBoxButtons } from 'ui.dialogs.messagebox';\nimport { StageFlow } from 'ui.stageflow';\nimport { Chart as ItemDetailsChart } from 'crm.item-details-component.stage-flow';\n\nexport type ItemDetailsComponentParams = {\n\tentityTypeId: number,\n\tentityTypeName: string,\n\tserviceUrl: string,\n\tid: number,\n\tcategoryId?: number,\n\tcategories?: Category[],\n\terrorTextContainer: HTMLElement,\n\tstages: StageModelData[],\n\tcurrentStageId: number,\n\tmessages: Object,\n\tsignedParameters: ?string,\n\tdocumentButtonParameters: ?Object,\n\tisPageTitleEditable: boolean,\n\tuserFieldCreateUrl: ?string,\n\teditorGuid: ?string,\n\tisStageFlowActive: ?boolean,\n\tpullTag: ?string,\n\tbizprocStarterConfig: ?Object,\n\tautomationCheckAutomationTourGuideData: ?Object,\n\treceiversJSONString: string,\n};\n\ndeclare type Category = {\n\tid: string,\n\tcategoryId: number,\n\ttext: string,\n\thref: string,\n};\n\nconst BACKGROUND_COLOR = 'd3d7dc';\n\nexport class ItemDetailsComponent\n{\n\tentityTypeId: number;\n\tentityTypeName: string;\n\tid: number;\n\tcategoryId: ?number = null;\n\tcategories: ?Category[];\n\terrorTextContainer: HTMLElement;\n\tstages: StageModel[];\n\tpermissionChecker: ?StagePermissionChecker = null;\n\tstageflowChart: ItemDetailsChart;\n\tcurrentStageId: number;\n\tisProgress: boolean;\n\tcontainer: HTMLElement;\n\tmessages: {[code: string]: string};\n\tsignedParameters: ?string;\n\tdocumentButtonParameters: ?Object;\n\tisPageTitleEditable: boolean;\n\tpartialEntityEditor: ?BX.Crm.PartialEditorDialog;\n\tpartialEditorId: ?string;\n\teditorContext: Object;\n\tuserFieldCreateUrl: ?string;\n\teditorGuid: ?string;\n\tisStageFlowActive: ?boolean;\n\tpullTag: ?string;\n\tbizprocStarterConfig: ?Object;\n\tautomationCheckAutomationTourGuideData: ?Object;\n\treceiversJSONString: string = '';\n\ttargetUpdateStage: ?StageModel = null;\n\tstageBeforeUpdate: ?StageModel = null;\n\n\tconstructor(params: ItemDetailsComponentParams): void\n\t{\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tthis.entityTypeId = Text.toInteger(params.entityTypeId);\n\t\t\tthis.entityTypeName = params.entityTypeName;\n\t\t\tthis.id = Text.toInteger(params.id);\n\t\t\tif (BX.Crm.PartialEditorDialog && params.serviceUrl)\n\t\t\t{\n\t\t\t\tthis.partialEditorId = 'partial_editor_' + this.entityTypeId + '_' + this.id;\n\t\t\t\tBX.Crm.PartialEditorDialog.registerEntityEditorUrl(this.entityTypeId, params.serviceUrl);\n\t\t\t}\n\t\t\tif (params.hasOwnProperty('editorContext'))\n\t\t\t{\n\t\t\t\tthis.editorContext = params.editorContext;\n\t\t\t}\n\t\t\tif (params.hasOwnProperty('categoryId'))\n\t\t\t{\n\t\t\t\tthis.categoryId = Text.toInteger(params.categoryId);\n\t\t\t\tthis.categories = params.categories;\n\t\t\t}\n\t\t\tif (Type.isElementNode(params.errorTextContainer))\n\t\t\t{\n\t\t\t\tthis.errorTextContainer = params.errorTextContainer;\n\t\t\t}\n\n\t\t\tif (Type.isArray(params.stages))\n\t\t\t{\n\t\t\t\tthis.stages = [];\n\t\t\t\tparams.stages.forEach((data) => {\n\t\t\t\t\tthis.stages.push(new StageModel(data));\n\t\t\t\t});\n\n\t\t\t\tthis.permissionChecker = StagePermissionChecker.createFromStageModels(this.stages);\n\t\t\t}\n\n\t\t\tthis.currentStageId = params.currentStageId;\n\t\t\tthis.messages = params.messages;\n\t\t\tthis.signedParameters = params.signedParameters;\n\t\t\tthis.documentButtonParameters = params.documentButtonParameters;\n\t\t\tthis.userFieldCreateUrl = params.userFieldCreateUrl;\n\t\t\tthis.editorGuid = params.editorGuid;\n\t\t\tthis.isStageFlowActive = params.isStageFlowActive;\n\t\t\tthis.pullTag = params.pullTag;\n\t\t\tthis.bizprocStarterConfig = params.bizprocStarterConfig;\n\t\t\tthis.automationCheckAutomationTourGuideData =\n\t\t\t\tType.isPlainObject(params.automationCheckAutomationTourGuideData)\n\t\t\t\t\t? params.automationCheckAutomationTourGuideData\n\t\t\t\t\t: null\n\t\t\t;\n\t\t\tif (Type.isString(params.receiversJSONString))\n\t\t\t{\n\t\t\t\tthis.receiversJSONString = params.receiversJSONString;\n\t\t\t}\n\n\t\t\tthis.isPageTitleEditable = Boolean(params.isPageTitleEditable);\n\t\t}\n\n\t\tthis.container = document.querySelector('[data-role=\"crm-item-detail-container\"]');\n\t\tthis.handleClosePartialEntityEditor = this.handleClosePartialEntityEditor.bind(this);\n\t\tthis.handleErrorPartialEntityEditor = this.handleErrorPartialEntityEditor.bind(this);\n\t}\n\n\tisNew(): boolean\n\t{\n\t\treturn this.id <= 0;\n\t}\n\n\tgetCurrentCategory(): ?Category\n\t{\n\t\tlet currentCategory = null\n\t\tif(this.categories && this.categoryId)\n\t\t{\n\t\t\tthis.categories.forEach((category) => {\n\t\t\t\tif(category.categoryId === this.categoryId)\n\t\t\t\t{\n\t\t\t\t\tcurrentCategory = category;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn currentCategory;\n\t}\n\n\tgetLoader()\n\t{\n\t\tif(!this.loader)\n\t\t{\n\t\t\tthis.loader = new Loader({\n\t\t\t\tsize: 200,\n\t\t\t\toffset: {\n\t\t\t\t\tleft: '-100px',\n\t\t\t\t\ttop: '-200px',\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.loader.layout.style.zIndex = 300;\n\t\t}\n\n\t\treturn this.loader;\n\t}\n\n\tstartProgress()\n\t{\n\t\tthis.isProgress = true;\n\t\tif(!this.getLoader().isShown() && this.container)\n\t\t{\n\t\t\tthis.getLoader().show(this.container);\n\t\t}\n\t\tthis.hideErrors();\n\t}\n\n\tstopProgress()\n\t{\n\t\tthis.isProgress = false;\n\t\tthis.getLoader().hide();\n\t}\n\n\tstartStageUpdateProgress(stage: StageModel): void\n\t{\n\t\tthis.isProgress = true;\n\t\tthis.targetUpdateStage = stage;\n\n\t\tthis.stageflowChart.adjust();\n\t}\n\n\tstopStageUpdateProgress(): void\n\t{\n\t\tthis.isProgress = false;\n\t\tthis.targetUpdateStage = null;\n\n\t\tthis.stageflowChart.adjust();\n\t}\n\n\tshowStageUpdatingNotification(): void\n\t{\n\t\tif (this.targetUpdateStage === null || !this.messages.stageLoadingMessage)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst stageName = Text.encode(this.targetUpdateStage.getName());\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: this.messages.stageLoadingMessage.replace('#stage#', stageName),\n\t\t\tautoHideDelay: 3000,\n\t\t});\n\t}\n\n\tisStageUpdating(): boolean\n\t{\n\t\treturn this.targetUpdateStage !== null && this.isProgress;\n\t}\n\n\tgetStageById(id: number): ?StageModel\n\t{\n\t\tlet result = null;\n\t\tlet key = 0;\n\t\twhile(true)\n\t\t{\n\t\t\tif(!this.stages[key])\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tconst stage = this.stages[key];\n\t\t\tif(stage.getId() === id)\n\t\t\t{\n\t\t\t\tresult = stage;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tkey++;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetStageByStatusId(statusId: string): ?StageModel\n\t{\n\t\tlet result = null;\n\t\tlet key = 0;\n\t\twhile(true)\n\t\t{\n\t\t\tif(!this.stages[key])\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tconst stage = this.stages[key];\n\t\t\tif(stage.getStatusId() === statusId)\n\t\t\t{\n\t\t\t\tresult = stage;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tkey++;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tinit(): void\n\t{\n\t\tthis.initStageFlow();\n\t\tthis.bindEvents();\n\t\tthis.initDocumentButton();\n\t\tthis.initReceiversRepository();\n\n\t\tif (this.isNew())\n\t\t{\n\t\t\tconst pageTitleElement = document.getElementById('pagetitle');\n\t\t\tDom.style(pageTitleElement, 'padding-right', '15px');\n\n\t\t\tthis.initCategoriesSelector(pageTitleElement);\n\n\t\t\t// beautify element\n\t\t\tconst categorySelectorElement = document.getElementById('pagetitle_sub');\n\t\t\tDom.style(categorySelectorElement, {\n\t\t\t\tposition: 'relative',\n\t\t\t\tpadding: '10px',\n\t\t\t\t'z-index': 1000,\n\t\t\t\t'background-size': 'contain',\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.initPageTitleButtons();\n\t\t\tthis.initPull();\n\t\t\tthis.initTours();\n\t\t}\n\t}\n\n\tinitDocumentButton(): void\n\t{\n\t\tif(\n\t\t\tType.isPlainObject(this.documentButtonParameters)\n\t\t\t&& this.documentButtonParameters.buttonId\n\t\t\t&& BX.DocumentGenerator\n\t\t\t&& BX.DocumentGenerator.Button\n\t\t)\n\t\t{\n\t\t\tthis.documentButton = new BX.DocumentGenerator.Button(this.documentButtonParameters.buttonId, this.documentButtonParameters);\n\t\t\tthis.documentButton.init();\n\t\t}\n\t}\n\n\tinitReceiversRepository(): void\n\t{\n\t\tReceiverRepository.onDetailsLoad(this.entityTypeId, this.id, this.receiversJSONString);\n\t}\n\n\tinitPageTitleButtons(): void\n\t{\n\t\tconst pageTitleButtons = Tag.render`\n\t\t\t<span id=\"pagetitle_btn_wrapper\" class=\"pagetitile-button-container\">\n\t\t\t\t<span id=\"page_url_copy_btn\" class=\"crm-page-link-btn\"></span>\n\t\t\t</span>\n\t\t`;\n\n\t\tif (this.isPageTitleEditable)\n\t\t{\n\t\t\tconst editButton = Tag.render`\n\t\t\t\t<span id=\"pagetitle_edit\" class=\"pagetitle-edit-button\"></span>\n\t\t\t`;\n\t\t\tDom.prepend(editButton, pageTitleButtons);\n\t\t}\n\n\t\tconst pageTitle = document.getElementById('pagetitle');\n\t\tDom.insertAfter(pageTitleButtons, pageTitle);\n\n\t\tthis.initCategoriesSelector(pageTitleButtons);\n\t}\n\n\tinitCategoriesSelector(target: HTMLElement): void\n\t{\n\t\tif (Type.isArray(this.categories) && this.categories.length > 0)\n\t\t{\n\t\t\tconst currentCategory = this.getCurrentCategory();\n\t\t\tif (currentCategory)\n\t\t\t{\n\t\t\t\tconst categoriesSelector = Tag.render`\n\t\t\t\t\t<div id=\"pagetitle_sub\" class=\"pagetitle-sub\">\n\t\t\t\t\t\t<a href=\"#\" onclick=\"${this.onCategorySelectorClick.bind(this)}\">\n\t\t\t\t\t\t\t${currentCategory.text}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\n\t\t\t\tDom.insertAfter(categoriesSelector, target);\n\t\t\t}\n\t\t}\n\t}\n\n\tonCategorySelectorClick(event: BaseEvent)\n\t{\n\t\tif (!this.categoryId || !this.categories)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst notCurrentCategories = this.categories.filter((category) => {\n\t\t\treturn category.categoryId !== this.categoryId;\n\t\t});\n\n\t\tnotCurrentCategories.forEach((category: Category) => {\n\t\t\tdelete category.href;\n\n\t\t\tcategory.onclick = () => {\n\t\t\t\tthis.onCategorySelect(category.categoryId);\n\t\t\t};\n\t\t});\n\n\t\tPopupMenu.show({\n\t\t\tid: `item-detail-${this.entityTypeId}-${this.id}`,\n\t\t\tbindElement: event.target,\n\t\t\titems: notCurrentCategories,\n\t\t});\n\t}\n\n\tonCategorySelect(categoryId)\n\t{\n\t\tif (this.isProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isNew())\n\t\t{\n\t\t\tif (\n\t\t\t\tthis.getEditor()?.hasChangedControls()\n\t\t\t\t|| this.getEditor()?.hasChangedControllers()\n\t\t\t)\n\t\t\t{\n\t\t\t\tMessageBox.show({\n\t\t\t\t\tmodal: true,\n\t\t\t\t\ttitle: Loc.getMessage('CRM_ITEM_DETAIL_CHANGE_FUNNEL_CONFIRM_DIALOG_TITLE'),\n\t\t\t\t\tmessage: Loc.getMessage('CRM_ITEM_DETAIL_CHANGE_FUNNEL_CONFIRM_DIALOG_MESSAGE'),\n\t\t\t\t\tminHeight: 100,\n\t\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t\t\tokCaption: Loc.getMessage('CRM_ITEM_DETAIL_CHANGE_FUNNEL_CONFIRM_DIALOG_OK_BTN'),\n\t\t\t\t\tonOk: (messageBox) => {\n\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t\tthis.reloadPageWhenCategoryChanged(categoryId);\n\t\t\t\t\t},\n\t\t\t\t\tonCancel: (messageBox) => messageBox.close(),\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.reloadPageWhenCategoryChanged(categoryId);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.startProgress();\n\n\t\tAjax.runAction('crm.controller.item.update', {\n\t\t\tanalyticsLabel: 'crmItemDetailsChangeCategory',\n\t\t\tdata: {\n\t\t\t\tentityTypeId: this.entityTypeId,\n\t\t\t\tid: this.id,\n\t\t\t\tfields: {\n\t\t\t\t\tcategoryId,\n\t\t\t\t},\n\t\t\t},\n\t\t}).then(() => {\n\t\t\tsetTimeout(() => {\n\t\t\t\t// @todo: what if editor is changed ?\n\t\t\t\twindow.location.reload();\n\t\t\t}, 500);\n\t\t}).catch(this.showErrorsFromResponse.bind(this));\n\t}\n\n\treloadPageWhenCategoryChanged(categoryId: number): void\n\t{\n\t\tconst url = new Uri(window.location.href);\n\t\turl.setQueryParam('categoryId', categoryId);\n\t\twindow.location.href = url.toString();\n\t}\n\n\tinitStageFlow()\n\t{\n\t\tif (!this.stages)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst flowStagesData = this.prepareStageFlowStagesData();\n\t\tconst stageFlowContainer = document.querySelector('[data-role=\"stageflow-wrap\"]');\n\t\tif (!stageFlowContainer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst chartParams = {\n\t\t\tbackgroundColor: BACKGROUND_COLOR,\n\t\t\tcurrentStage: this.currentStageId,\n\t\t\tisActive: this.isStageFlowActive === true,\n\t\t\tonStageChange: this.onStageChange.bind(this),\n\t\t\tlabels: {\n\t\t\t\tfinalStageName: Loc.getMessage('CRM_ITEM_DETAIL_STAGEFLOW_FINAL_STAGE_NAME'),\n\t\t\t\tfinalStagePopupTitle: Loc.getMessage('CRM_ITEM_DETAIL_STAGEFLOW_FINAL_STAGE_POPUP'),\n\t\t\t\tfinalStagePopupFail: Loc.getMessage('CRM_ITEM_DETAIL_STAGEFLOW_FINAL_STAGE_POPUP_FAIL'),\n\t\t\t\tfinalStageSelectorTitle: Loc.getMessage('CRM_ITEM_DETAIL_STAGEFLOW_FINAL_STAGE_SELECTOR'),\n\t\t\t},\n\t\t};\n\n\t\tthis.stageflowChart = new ItemDetailsChart(\n\t\t\tchartParams,\n\t\t\tflowStagesData,\n\t\t\tthis.permissionChecker,\n\t\t\tthis.getStageById.bind(this),\n\t\t\tthis.isStageUpdating.bind(this),\n\t\t\tRuntime.throttle(this.showStageUpdatingNotification.bind(this), 300),\n\t\t\tthis.isNew(),\n\t\t);\n\n\t\tDom.append(this.stageflowChart.render(), stageFlowContainer);\n\t}\n\n\tprepareStageFlowStagesData(): Array\n\t{\n\t\tconst flowStagesData = [];\n\t\tthis.stages.forEach((stage: StageModel) => {\n\t\t\tconst data = stage.getData();\n\t\t\tlet color = (stage.getColor().indexOf('#') === 0) ? stage.getColor().substr(1) : stage.getColor();\n\t\t\tif (this.isNew())\n\t\t\t{\n\t\t\t\tcolor = BACKGROUND_COLOR;\n\t\t\t}\n\t\t\tdata.isSuccess = stage.isSuccess();\n\t\t\tdata.isFail = stage.isFailure();\n\t\t\tdata.color = color;\n\t\t\tflowStagesData.push(data);\n\t\t});\n\n\t\treturn flowStagesData;\n\t}\n\n\tbindEvents(): void\n\t{\n\t\tEventEmitter.subscribe('BX.Crm.ItemDetailsComponent:onClickDelete', this.handleItemDelete.bind(this));\n\t\tif (this.bizprocStarterConfig)\n\t\t{\n\t\t\tEventEmitter.subscribe(\n\t\t\t\t'BX.Crm.ItemDetailsComponent:onClickBizprocTemplates',\n\t\t\t\tthis.handleBPTemplatesShow.bind(this),\n\t\t\t);\n\t\t}\n\t\tif (this.editorGuid && this.userFieldCreateUrl && BX.SidePanel && BX.Crm.EntityEditor)\n\t\t{\n\t\t\tEventEmitter.subscribe(\n\t\t\t\t'BX.UI.EntityConfigurationManager:onCreateClick',\n\t\t\t\tthis.handleUserFieldCreationUrlClick.bind(this)\n\t\t\t);\n\t\t}\n\t}\n\n\tinitPull()\n\t{\n\t\tconst Pull = BX.PULL;\n\t\tif (!Pull)\n\t\t{\n\t\t\tconsole.error('pull is not initialized');\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.pullTag)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tPull.subscribe({\n\t\t\tmoduleId: 'crm',\n\t\t\tcommand: this.pullTag,\n\t\t\tcallback: (params) => {\n\t\t\t\tif (!params?.item?.data)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst columnId = params.item.data.columnId;\n\t\t\t\tif (this.stageflowChart?.isActive)\n\t\t\t\t{\n\t\t\t\t\tconst currentStage = this.getStageById(this.stageflowChart.currentStage);\n\t\t\t\t\tif (currentStage?.statusId !== columnId)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst newStage = this.getStageByStatusId(columnId);\n\t\t\t\t\t\tif (newStage)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.updateStage(newStage);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t\tPull.extendWatch(this.pullTag);\n\t}\n\n\tgetEditor(): ?BX.Crm.EntityEditor\n\t{\n\t\tif (BX.Crm.EntityEditor)\n\t\t{\n\t\t\tif (this.editorGuid)\n\t\t\t{\n\t\t\t\treturn BX.Crm.EntityEditor.get(this.editorGuid);\n\t\t\t}\n\n\t\t\treturn BX.Crm.EntityEditor.getDefault();\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tbindPartialEntityEditorEvents()\n\t{\n\t\tEventEmitter.subscribe('Crm.PartialEditorDialog.Close', this.handleClosePartialEntityEditor);\n\t\tEventEmitter.subscribe('Crm.PartialEditorDialog.Error', this.handleErrorPartialEntityEditor);\n\t}\n\n\tunBindPartialEntityEditorEvents()\n\t{\n\t\tEventEmitter.unsubscribe('Crm.PartialEditorDialog.Close', this.handleClosePartialEntityEditor);\n\t\tEventEmitter.unsubscribe('Crm.PartialEditorDialog.Error', this.handleErrorPartialEntityEditor);\n\t}\n\n\tonStageChange(stageFlowStage: StageFlow.Stage)\n\t{\n\t\tif(this.isProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst stage = this.getStageById(stageFlowStage.getId());\n\t\tif(!stage)\n\t\t{\n\t\t\tconsole.error('Wrong stage');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.stageBeforeUpdate = this.getStageById(this.currentStageId);\n\t\tthis.setStageToFlowChart(stage);\n\n\t\tthis.startStageUpdateProgress(stage);\n\t\tAjax.runAction('crm.controller.item.update', {\n\t\t\tanalyticsLabel: 'crmItemDetailsMoveItem',\n\t\t\tdata: {\n\t\t\t\tentityTypeId: this.entityTypeId,\n\t\t\t\tid: this.id,\n\t\t\t\tfields: {\n\t\t\t\t\tstageId: stage.getStatusId()\n\t\t\t\t}\n\t\t\t}\n\t\t}).then( () => {\n\t\t\tthis.stopStageUpdateProgress();\n\n\t\t\tlet currentSlider: ?BX.SidePanel.Slider = null;\n\t\t\tif (Reflection.getClass('BX.SidePanel.Instance.getTopSlider'))\n\t\t\t{\n\t\t\t\tcurrentSlider = BX.SidePanel.Instance.getTopSlider();\n\t\t\t}\n\t\t\tif (currentSlider !== null)\n\t\t\t{\n\t\t\t\tif (Reflection.getClass('BX.Crm.EntityEvent'))\n\t\t\t\t{\n\t\t\t\t\tlet eventParams = null;\n\t\t\t\t\tif(currentSlider)\n\t\t\t\t\t{\n\t\t\t\t\t\teventParams = { \"sliderUrl\": currentSlider.getUrl() };\n\t\t\t\t\t}\n\t\t\t\t\tBX.Crm.EntityEvent.fireUpdate(this.entityTypeId, this.id, '', eventParams);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.stageBeforeUpdate = null;\n\t\t\tthis.updateStage(stage);\n\t\t}).catch((response) => {\n\t\t\tthis.stopStageUpdateProgress();\n\n\t\t\tif (this.stageBeforeUpdate !== null)\n\t\t\t{\n\t\t\t\tthis.setStageToFlowChart(this.stageBeforeUpdate);\n\t\t\t\tthis.stageBeforeUpdate = null;\n\t\t\t}\n\n\t\t\tif (!this.partialEditorId)\n\t\t\t{\n\t\t\t\tthis.showErrorsFromResponse(response);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst requiredFields = [];\n\t\t\tresponse.errors.forEach(({code, customData}) => {\n\t\t\t\tif (code === 'CRM_FIELD_ERROR_REQUIRED' && customData.fieldName)\n\t\t\t\t{\n\t\t\t\t\trequiredFields.push(customData.fieldName);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif(requiredFields.length > 0)\n\t\t\t{\n\t\t\t\tBX.Crm.PartialEditorDialog.close(this.partialEditorId);\n\n\t\t\t\tthis.partialEntityEditor = BX.Crm.PartialEditorDialog.create(\n\t\t\t\t\tthis.partialEditorId,\n\t\t\t\t\t{\n\t\t\t\t\t\ttitle: BX.prop.getString(this.messages, \"partialEditorTitle\", \"Please fill in all required fields\"),\n\t\t\t\t\t\tentityTypeName: this.entityTypeName,\n\t\t\t\t\t\tentityTypeId: this.entityTypeId,\n\t\t\t\t\t\tentityId: this.id,\n\t\t\t\t\t\tfieldNames: requiredFields,\n\t\t\t\t\t\thelpData: null,\n\t\t\t\t\t\tcontext: this.editorContext || null,\n\t\t\t\t\t\tisController: true,\n\t\t\t\t\t\tstageId: stage.getStatusId(),\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\tthis.bindPartialEntityEditorEvents();\n\t\t\t\tthis.partialEntityEditor.open();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showErrorsFromResponse(response);\n\t\t\t}\n\t\t})\n\t}\n\n\tupdateStage(stage: StageModel)\n\t{\n\t\tconst currentStage = this.getStageById(this.stageflowChart.currentStage);\n\t\tthis.setStageToFlowChart(stage);\n\t\tEventEmitter.emit(\n\t\t\t'BX.Crm.ItemDetailsComponent:onStageChange',\n\t\t\t{\n\t\t\t\tentityTypeId: this.entityTypeId,\n\t\t\t\tid: this.id,\n\t\t\t\tstageId: stage.getStatusId(),\n\t\t\t\tpreviousStageId: currentStage ? currentStage.getStatusId() : null,\n\t\t\t},\n\t\t);\n\t}\n\n\tsetStageToFlowChart(stage: StageModel): void\n\t{\n\t\tthis.stageflowChart.setCurrentStageId(stage.getId());\n\t}\n\n\tshowError(error: string): void\n\t{\n\t\tif (Type.isElementNode(this.errorTextContainer))\n\t\t{\n\t\t\tthis.errorTextContainer.innerText = error;\n\t\t\tthis.errorTextContainer.parentElement.style.display = 'block';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconsole.error(error);\n\t\t}\n\t}\n\n\tshowErrors(errors: string[]): void\n\t{\n\t\tlet severalErrorsText = '';\n\t\terrors.forEach((message) => {\n\t\t\tseveralErrorsText = severalErrorsText + message + ' ';\n\t\t});\n\n\t\tthis.showError(severalErrorsText);\n\t}\n\n\thideErrors(): void\n\t{\n\t\tif (Type.isElementNode(this.errorTextContainer))\n\t\t{\n\t\t\tthis.errorTextContainer.innerText = '';\n\t\t\tthis.errorTextContainer.parentElement.style.display = 'none';\n\t\t}\n\t}\n\n\tshowErrorsFromResponse({errors}): void\n\t{\n\t\tthis.stopProgress();\n\t\tconst messages = [];\n\t\terrors.forEach(({message}) => messages.push(message));\n\t\tthis.showErrors(messages);\n\t}\n\n\tnormalizeUrl(url: Uri): Uri\n\t{\n\t\t// Allow redirects only in the current domain\n\t\treturn url.setHost('');\n\t}\n\n\t// region EventHandlers\n\thandleItemDelete(): void\n\t{\n\t\tif(this.isProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tMessageBox.show({\n\t\t\ttitle: this.messages.deleteItemTitle,\n\t\t\tmessage: this.messages.deleteItemMessage,\n\t\t\tmodal: true,\n\t\t\tbuttons: MessageBoxButtons.YES_CANCEL,\n\t\t\tonYes: (messageBox) => {\n\t\t\t\tthis.startProgress();\n\t\t\t\tAjax.runAction(\n\t\t\t\t\t'crm.controller.item.delete', {\n\t\t\t\t\t\tanalyticsLabel: 'crmItemDetailsDeleteItem',\n\t\t\t\t\t\tdata:\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tentityTypeId: this.entityTypeId,\n\t\t\t\t\t\t\t\tid: this.id,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t}).then( ({data}) => {\n\t\t\t\t\tthis.stopProgress();\n\n\t\t\t\t\tlet currentSlider: ?BX.SidePanel.Slider = null;\n\t\t\t\t\tif (Reflection.getClass('BX.SidePanel.Instance.getTopSlider'))\n\t\t\t\t\t{\n\t\t\t\t\t\tcurrentSlider = BX.SidePanel.Instance.getTopSlider();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (currentSlider !== null)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (Reflection.getClass('BX.Crm.EntityEvent'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlet eventParams = null;\n\t\t\t\t\t\t\tif(currentSlider)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\teventParams = { \"sliderUrl\": currentSlider.getUrl() };\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tBX.Crm.EntityEvent.fireDelete(this.entityTypeId, this.id, '', eventParams);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcurrentSlider.close();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tconst link = data.redirectUrl;\n\t\t\t\t\t\tif (Type.isStringFilled(link))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst url = this.normalizeUrl(new Uri(link));\n\t\t\t\t\t\t\tlocation.href = url.toString();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}).catch(this.showErrorsFromResponse.bind(this));\n\n\t\t\t\tmessageBox.close();\n\t\t\t}\n\t\t});\n\t}\n\n\thandleBPTemplatesShow(event)\n\t{\n\t\tif (this.bizprocStarterConfig.availabilityLock)\n\t\t{\n\t\t\t// eslint-disable-next-line no-eval\n\t\t\teval(this.bizprocStarterConfig.availabilityLock);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst starter = new BX.Bizproc.Starter(this.bizprocStarterConfig);\n\t\tstarter.showTemplatesMenu(event.data.button.button);\n\t}\n\n\thandleClosePartialEntityEditor(event: BaseEvent)\n\t{\n\t\tthis.unBindPartialEntityEditorEvents();\n\t\tthis.stopProgress();\n\n\t\tconst data = event.getData();\n\t\tif(Type.isArray(data) && data.length === 2)\n\t\t{\n\t\t\tconst parameters = data[1];\n\n\t\t\tif(parameters.isCancelled)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst stage = this.getStageByStatusId(parameters.stageId);\n\t\t\tif(!stage)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.updateStage(stage);\n\t\t}\n\t}\n\n\thandleErrorPartialEntityEditor(event: BaseEvent)\n\t{\n\t\tthis.unBindPartialEntityEditorEvents();\n\n\t\tthis.stopProgress();\n\n\t\tconst data = event.getData();\n\t\tif(Type.isArray(data) && data[1] && Type.isArray(data[1].errors))\n\t\t{\n\t\t\tthis.showErrorsFromResponse({errors: data[1].errors});\n\t\t}\n\t}\n\n\thandleUserFieldCreationUrlClick(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\t\tif (data.hasOwnProperty('isCanceled'))\n\t\t{\n\t\t\tevent.setData({ ...data, ...{isCanceled: true}});\n\t\t\tBX.SidePanel.Instance.open(this.userFieldCreateUrl, {\n\t\t\t\tallowChangeHistory: false,\n\t\t\t\tcacheable: false,\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: this.onCreateUserFieldSliderClose.bind(this)\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tonCreateUserFieldSliderClose(event: BX.SidePanel.Event)\n\t{\n\t\tconst slider = event.getSlider();\n\t\tconst sliderData = slider.getData();\n\t\tconst userFieldData = sliderData.get('userFieldData');\n\t\tif (userFieldData && Type.isString(userFieldData))\n\t\t{\n\t\t\tthis.reloadPageIfNotChanged();\n\t\t}\n\t}\n\t//endregion\n\n\treloadPageIfNotChanged()\n\t{\n\t\tconst editor = this.getEditor();\n\t\tif (editor)\n\t\t{\n\t\t\tif(editor.isChanged())\n\t\t\t{\n\t\t\t\tMessageBox.alert(this.messages.onCreateUserFieldAddMessage);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\twindow.location.reload();\n\t\t\t}\n\t\t}\n\t}\n\n\tinitTours()\n\t{\n\t\tif (this.automationCheckAutomationTourGuideData)\n\t\t{\n\t\t\tRuntime.loadExtension('bizproc.automation.guide')\n\t\t\t\t.then((exports) => {\n\t\t\t\t\tconst {CrmCheckAutomationGuide} = exports;\n\t\t\t\t\tif (CrmCheckAutomationGuide)\n\t\t\t\t\t{\n\t\t\t\t\t\tCrmCheckAutomationGuide.showCheckAutomation(\n\t\t\t\t\t\t\tthis.entityTypeName,\n\t\t\t\t\t\t\tthis.categoryId ?? 0,\n\t\t\t\t\t\t\tthis.automationCheckAutomationTourGuideData['options']\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t;\n\t\t}\n\t}\n}\n"],"names":["BACKGROUND_COLOR","ItemDetailsComponent","params","Type","isPlainObject","entityTypeId","Text","toInteger","entityTypeName","id","BX","Crm","PartialEditorDialog","serviceUrl","partialEditorId","registerEntityEditorUrl","hasOwnProperty","editorContext","categoryId","categories","isElementNode","errorTextContainer","isArray","stages","forEach","data","push","StageModel","permissionChecker","StagePermissionChecker","createFromStageModels","currentStageId","messages","signedParameters","documentButtonParameters","userFieldCreateUrl","editorGuid","isStageFlowActive","pullTag","bizprocStarterConfig","automationCheckAutomationTourGuideData","isString","receiversJSONString","isPageTitleEditable","Boolean","container","document","querySelector","handleClosePartialEntityEditor","bind","handleErrorPartialEntityEditor","currentCategory","category","loader","Loader","size","offset","left","top","layout","style","zIndex","isProgress","getLoader","isShown","show","hideErrors","hide","stage","targetUpdateStage","stageflowChart","adjust","stageLoadingMessage","stageName","encode","getName","UI","Notification","Center","notify","content","replace","autoHideDelay","result","key","getId","statusId","getStatusId","initStageFlow","bindEvents","initDocumentButton","initReceiversRepository","isNew","pageTitleElement","getElementById","Dom","initCategoriesSelector","categorySelectorElement","position","padding","initPageTitleButtons","initPull","initTours","buttonId","DocumentGenerator","Button","documentButton","init","ReceiverRepository","onDetailsLoad","pageTitleButtons","Tag","render","editButton","prepend","pageTitle","insertAfter","target","length","getCurrentCategory","categoriesSelector","onCategorySelectorClick","text","event","notCurrentCategories","filter","href","onclick","onCategorySelect","PopupMenu","bindElement","items","getEditor","hasChangedControls","hasChangedControllers","MessageBox","modal","title","Loc","getMessage","message","minHeight","buttons","MessageBoxButtons","OK_CANCEL","okCaption","onOk","messageBox","close","reloadPageWhenCategoryChanged","onCancel","startProgress","Ajax","runAction","analyticsLabel","fields","then","setTimeout","window","location","reload","showErrorsFromResponse","url","Uri","setQueryParam","toString","flowStagesData","prepareStageFlowStagesData","stageFlowContainer","chartParams","backgroundColor","currentStage","isActive","onStageChange","labels","finalStageName","finalStagePopupTitle","finalStagePopupFail","finalStageSelectorTitle","ItemDetailsChart","getStageById","isStageUpdating","Runtime","throttle","showStageUpdatingNotification","append","getData","color","getColor","indexOf","substr","isSuccess","isFail","isFailure","EventEmitter","subscribe","handleItemDelete","handleBPTemplatesShow","SidePanel","EntityEditor","handleUserFieldCreationUrlClick","Pull","PULL","console","error","moduleId","command","callback","item","columnId","newStage","getStageByStatusId","updateStage","extendWatch","get","getDefault","unsubscribe","stageFlowStage","stageBeforeUpdate","setStageToFlowChart","startStageUpdateProgress","stageId","stopStageUpdateProgress","currentSlider","Reflection","getClass","Instance","getTopSlider","eventParams","getUrl","EntityEvent","fireUpdate","response","requiredFields","errors","code","customData","fieldName","partialEntityEditor","create","prop","getString","entityId","fieldNames","helpData","context","isController","bindPartialEntityEditorEvents","open","emit","previousStageId","setCurrentStageId","innerText","parentElement","display","severalErrorsText","showError","stopProgress","showErrors","setHost","deleteItemTitle","deleteItemMessage","YES_CANCEL","onYes","fireDelete","link","redirectUrl","isStringFilled","normalizeUrl","availabilityLock","eval","starter","Bizproc","Starter","showTemplatesMenu","button","unBindPartialEntityEditorEvents","parameters","isCancelled","setData","isCanceled","allowChangeHistory","cacheable","events","onClose","onCreateUserFieldSliderClose","slider","getSlider","sliderData","userFieldData","reloadPageIfNotChanged","editor","isChanged","alert","onCreateUserFieldAddMessage","loadExtension","exports","CrmCheckAutomationGuide","showCheckAutomation"],"mappings":"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"}