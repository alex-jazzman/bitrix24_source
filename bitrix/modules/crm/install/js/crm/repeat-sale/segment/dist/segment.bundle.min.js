this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};(function(t,e,s,i,n,a,l,r,o,d,c,u,g,m){"use strict";const h={props:{title:{type:String,required:true}},mounted(){this.popup=null;this.region=u.Extension.getSettings("crm.repeat-sale.segment").get("region");u.Event.EventEmitter.subscribe("UI.PromoVideoPopup:accept",(t=>{var e;(e=this.popup)==null?void 0:e.hide()}))},methods:{onClick(){if(this.popup===null){this.popup=new r.PromoVideoPopup({angleOptions:null,targetOptions:"1",useOverlay:true,videoSrc:this.videoSrc,videoContainerMinHeight:255,title:u.Loc.getMessage("CRM_REPEAT_SALE_SEGMENT_HOW_IT_WORK_TITLE"),colors:{title:"var(--ui-color-palette-black-base)"}})}this.popup.show()}},computed:{videoSrc(){let t="how-it-work-en";if(["kz","ru","by"].includes(this.region)){t="how-it-work-ru"}return`/bitrix/js/crm/repeat-sale/segment/video/${t}.webm`}},template:`\n\t\t<div class="crm-repeat-sale__segment-field-info">\n\t\t\t<span @click="onClick">\n\t\t\t\t{{title}}\n\t\t\t</span>\n\t\t</div>\n\t`};const p={emits:["change"],components:{AdditionalInfoComponent:h},props:{checked:{type:Boolean,required:true},readOnly:{type:Boolean,default:false}},mounted(){this.renderSwitcher()},methods:{renderSwitcher(){if(!this.switcher){this.switcher=new o.Switcher({checked:this.checked,disabled:this.readOnly,size:o.SwitcherSize.small,showStateTitle:false,handlers:{checked:t=>{this.emitChange(false)},unchecked:t=>{this.emitChange(true)}}});this.switcher.renderTo(this.$refs.switcher)}},emitChange(t){this.$emit("change",t)}},computed:{badgeClassList(){return{"--enabled":this.checked}},badgeTitle(){if(this.checked){return this.$Bitrix.Loc.getMessage("CRM_REPEAT_SALE_SEGMENT_COPILOT_ENABLED")}return this.$Bitrix.Loc.getMessage("CRM_REPEAT_SALE_SEGMENT_COPILOT_DISABLED")}},watch:{checked(t){this.switcher.check(t,false)}},template:`\n\t\t<div class="crm-repeat-sale__segment-ai-switcher-wrapper">\n\t\t\t<div>\n\t\t\t\t<div class="crm-repeat-sale__segment-ai-switcher-title">\n\t\t\t\t\t{{this.$Bitrix.Loc.getMessage('CRM_REPEAT_SALE_SEGMENT_COPILOT_TITLE')}}\n\t\t\t\t\t<span :class="badgeClassList">{{badgeTitle}}</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="crm-repeat-sale__segment-ai-switcher-description">\n\t\t\t\t\t{{this.$Bitrix.Loc.getMessage('CRM_REPEAT_SALE_SEGMENT_COPILOT_DESCRIPTION')}}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="crm-repeat-sale__segment-ai-switcher" ref="switcher"></div>\n\t\t</div>\n\t`};const E={components:{TextEditorComponent:d.TextEditorComponent,AiSwitcherComponent:p},emits:["change"],props:{textEditor:d.TextEditor},data(){return{textEditorEvents:{onChange:this.emitChangeData}}},mounted(){this.setTextEditorHeight();this.windowResizeHandler=this.windowResizeHandler.bind(this);u.Event.bind(window,"resize",this.windowResizeHandler)},unmounted(){u.Event.unbind(window,"resize",this.windowResizeHandler)},methods:{emitChangeData(){if(!u.Type.isFunction(this.onChangeDebounce)){this.onChangeDebounce=u.Runtime.debounce(this.onChange,100,this)}this.onChangeDebounce()},onChange(){this.$emit("change",{prompt:this.textEditor.getText()})},windowResizeHandler(){this.setTextEditorHeight()},setTextEditorHeight(){var t,e,s;const i=this.$el.parentNode.offsetTop;const n=".crm-repeat-sale__segment_navigation-container";const a=(t=(e=document.querySelector(n))==null?void 0:e.offsetTop)!=null?t:0;const l=20;const r=a-i-l;const o=Math.round(r*.5);const d=Math.round(r*.8);if(o<200){var c;(c=this.textEditor)==null?void 0:c.setMinHeight(d)}else{var u;(u=this.textEditor)==null?void 0:u.setMinHeight(o)}(s=this.textEditor)==null?void 0:s.setMaxHeight(d)}},template:`\n\t\t<TextEditorComponent\n\t\t\t:events="textEditorEvents"\n\t\t\t:editor-instance="textEditor"\n\t\t/>\n\t`};const v={click:"crm:repeat-sale:segment:navigation-button-click"};const y={props:{id:{type:String,required:true}},mounted(){this.initButton()},methods:{initButton(){this.button=new c.Button({useAirDesign:true,text:u.Loc.getMessage(`CRM_REPEAT_SALE_SEGMENT_NAVIGATION_BUTTON_${this.id.toUpperCase()}`),round:true,style:this.buttonStyle,onclick:()=>{this.emitClickEvent()}});this.button.setDataSet({id:`crm-repeat-sale-segment-buttons-${this.id.toLowerCase()}`});if(this.$refs.button){this.button.renderTo(this.$refs.button)}},emitClickEvent(){this.$Bitrix.eventEmitter.emit(v.click,{id:this.id})}},computed:{buttonStyle(){if(this.id==="update"){return c.AirButtonStyle.FILLED}return c.AirButtonStyle.OUTLINE}},template:`\n\t\t<div ref="button" class="crm-repeat-sale__segment_button"></div>\n\t`};const S={props:{callAssessments:{type:Object,required:true},currentCallAssessmentId:{type:Number,required:true},readOnly:{type:Boolean,default:false}},created(){this.dialog=null;this.tabs=[{id:"call_assessments",title:""}];this.items=[];this.callAssessments.forEach(((t,e)=>{this.items.push({id:t.id,title:t.name,entityId:"call_assessment",tabs:"call_assessments",selected:t.id===this.currentCallAssessmentId})}))},methods:{toggleDialog(){const t=this.getDialog();if(t.isOpen()){t.hide()}else{t.show()}},getDialog(){if(this.dialog===null){const t=this.$refs.dialog;const e=t.closest("body");this.dialog=new m.Dialog({targetNode:t,context:"CRM_REPEAT_SALE_CALL_ASSESSMENT",multiple:false,dropdownMode:true,showAvatars:false,enableSearch:true,width:450,zIndex:2500,tabs:this.tabs,items:this.items,searchOptions:{allowCreateItem:false},events:{"Item:onSelect":t=>{const{item:{id:e}}=t.getData();this.emitSelectItem(e)},onShow:t=>{u.Event.bindOnce(e,"click",this.onPopupContainerClick.bind(this))}}})}return this.dialog},emitSelectItem(t){this.$emit("onSelectItem",t)},onPopupContainerClick(){this.getDialog().hide()}},template:`\n\t\t<div\n\t\t\tref="dialog"\n\t\t\t@click="toggleDialog"\n\t\t\tclass="crm-repeat-sale__segment_call-assessment"\n\t\t>\n\t\t\t{{ this.$Bitrix.Loc.getMessage('CRM_REPEAT_SALE_SEGMENT_CALL_ASSESSMENT_SELECTOR') }}\n\t\t</div>\n\t`};const _={emits:["change","onSelectItem","onDeselectItem"],props:{items:{type:Array,default:[]},tabs:{type:Array,default:[]},entities:{type:Array,default:[]},showAvatars:{type:Boolean},multiple:{type:Boolean},context:{type:String,default:""},events:{type:Object,default:{}},readOnly:{type:Boolean}},methods:{getDialog(){if(!this.dialog){const t=this.$refs.dialog;const e=t.closest("body");this.dialog=new m.Dialog({targetNode:t,context:this.context,multiple:this.multiple,dropdownMode:true,showAvatars:this.showAvatars,enableSearch:true,width:450,zIndex:2500,items:this.items,entities:this.entities,tabs:this.tabs,searchOptions:{allowCreateItem:false},events:{"Item:onSelect":t=>{const{item:e}=t.getData();this.emitSelectItem(e)},"Item:onDeselect":t=>{const{item:e}=t.getData();this.emitDeselectItem(e)},onShow:t=>{u.Event.bindOnce(e,"click",this.onPopupContainerClick.bind(this))}}})}return this.dialog},emitSelectItem(t){this.$emit("onSelectItem",t)},emitDeselectItem(t){this.$emit("onDeselectItem",t)},selectItem(t){const e=this.dialog.getItem(t);e==null?void 0:e.select()},onPopupContainerClick(){this.getDialog().hide()},show(){this.getDialog().show()},toggleDialog(){if(this.readOnly){return}const t=this.getDialog();if(t.isOpen()){t.hide()}else{t.show()}},destroy(){var t;(t=this.dialog)==null?void 0:t.destroy();this.dialog=null}},computed:{elementTitle(){var t,e;return(t=(e=this.items.find((t=>t.selected)))==null?void 0:e.title)!=null?t:""},customData(){var t,e;return(t=(e=this.items.find((t=>t.selected)))==null?void 0:e.customData)!=null?t:""},controlClassList(){return["ui-ctl","ui-ctl-after-icon",{"ui-ctl-dropdown":!this.readOnly}]},iconClassList(){var t;return["crm-repeat-sale__segment-dialog-field-icon",{"--color":Boolean((t=this.customData)==null?void 0:t.color)}]},iconStyleList(){var t;if(((t=this.customData)==null?void 0:t.color)===null){return{}}return{backgroundColor:this.customData.color}}},template:`\n\t\t<div\n\t\t\t:class="controlClassList"\n\t\t\tref="dialog"\n\t\t\t@click="toggleDialog"\n\t\t>\n    \t\t<div \n\t\t\t\tv-if="!readOnly"\n\t\t\t\tclass="ui-ctl-after ui-ctl-icon-angle"\n\t\t\t></div>\n\t\t\t<div class="ui-ctl-element">\n\t\t\t\t<span class="crm-repeat-sale__segment-dialog-field">\n\t\t\t\t\t<span \n\t\t\t\t\t\t:class="iconClassList"\n\t\t\t\t\t\t:style="iconStyleList"\n\t\t\t\t\t></span>\n\t\t\t\t\t<span class="crm-repeat-sale__segment-dialog-field-value">\n\t\t\t\t\t\t{{elementTitle}}\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\t`};const b={emits:["change","onSelectItem","onDeselectItem"],props:{items:{type:Array,default:[]},preselectedItems:{type:Array,default:[]},tabs:{type:Array,default:[]},entities:{type:Array,default:[]},showAvatars:{type:Boolean,default:false},multiple:{type:Boolean,default:false},context:{type:String,default:""},events:{type:Object,default:{}},readOnly:{type:Boolean,default:false}},mounted(){this.initDialog()},watch:{items(t){this.tagSelector.getDialog().destroy();u.Dom.clean(this.$refs.dialog);this.initDialog()}},methods:{initDialog(){const t=this.$refs.dialog;const e=t.closest("body");this.tagSelector=new m.TagSelector({multiple:this.multiple,readonly:this.readOnly,hideOnSelect:false,dialogOptions:{targetNode:t,context:this.context,multiple:this.multiple,hideOnSelect:false,dropdownMode:true,showAvatars:this.showAvatars,enableSearch:true,width:450,zIndex:2500,items:this.items,preselectedItems:this.preselectedItems,entities:this.entities,tabs:this.tabs,searchOptions:{allowCreateItem:false},events:{"Item:onSelect":t=>{const{item:e}=t.getData();this.emitSelectItem(e)},"Item:onDeselect":t=>{const{item:e}=t.getData();this.emitDeselectItem(e)}}}});this.tagSelector.renderTo(this.$refs.dialog)},emitSelectItem(t){this.$emit("onSelectItem",t)},emitDeselectItem(t){this.$emit("onDeselectItem",t)},selectItem(t){const e=this.tagSelector.getDialog().getItem(t);e==null?void 0:e.select()}},template:`\n\t\t<div ref="dialog"></div>\n\t`};const f={components:{TagSelectorWrapperComponent:b,DialogWrapperComponent:_},props:{categories:{type:Object,required:true},currentCategoryId:{type:Number,required:true},readOnly:{type:Boolean,default:false}},data(){const t=[];this.categories.forEach(((e,s)=>{t.push({id:e.id,title:e.name,entityId:"category",tabs:"categories",selected:e.id===this.currentCategoryId})}));return{items:t}},created(){this.tabs=[{id:"categories",title:""}]},watch:{currentCategoryId(t){this.items.forEach((e=>{e.selected=e.id===t}))}},template:`\n\t\t<DialogWrapperComponent\n\t\t\t:items="items"\n\t\t\t:tabs="tabs"\n\t\t\t:read-only="readOnly"\n\t\t/>\n\t`};const A={components:{DialogWrapperComponent:_},props:{category:{type:Object},currentStageId:{type:String,required:true},readOnly:{type:Boolean,default:false}},data(){return{items:this.getPreparedItems()}},created(){this.tabs=[{id:"stages",title:""}]},methods:{destroy(){this.$refs.dialog.destroy()},getPreparedItems(t=false){const e=[];if(this.category===null){return e}let s=true;Object.values(this.category.items).forEach((i=>{e.push({id:i.id,title:i.name,entityId:"stage",tabs:"stages",selected:t?s:i.id===this.currentStageId,avatarOptions:{bgColor:i.color,borderRadius:6,bgSize:20,bgImage:"none"},customData:{color:i.color}});s=false}));if(!e.some((t=>t.selected===true))){e.find(Boolean).selected=true}return e}},watch:{category(t){this.items=this.getPreparedItems(true)},currentStageId(t){this.items.forEach((e=>{e.selected=e.id===t}))}},template:`\n\t\t<DialogWrapperComponent\n\t\t\tref="dialog"\n\t\t\t:items="items"\n\t\t\t:tabs="tabs"\n\t\t\t:showAvatars="true"\n\t\t\t:read-only="readOnly"\n\t\t/>\n\t`};const C={components:{TagSelectorWrapperComponent:b},props:{userIds:{type:Array,required:true},readOnly:{type:Boolean,default:false}},data(){return{preselectedItems:this.userIds.map((t=>["user",t]))}},created(){this.entities=[{id:"user",options:{inviteEmployeeLink:false,emailUsers:false,inviteGuestLink:false,intranetUsersOnly:true}},{id:"structure-node",options:{selectMode:"usersOnly"}}]},template:`\n\t\t<TagSelectorWrapperComponent \n\t\t\t:entities="entities"\n\t\t\t:preselected-items="preselectedItems"\n\t\t\t:show-avatars="true"\n\t\t\t:multiple="true"\n\t\t\t:read-only="readOnly"\n\t\t/>\n\t`};const I={components:{Button:y,AdditionalInfoComponent:h,AiSwitcherComponent:p,TextEditorWrapperComponent:E,CallAssessmentSelector:S,CategorySelector:f,StageSelector:A,UserSelector:C},props:{settings:{type:Object,default:{}},segment:{type:Object,required:true},categories:{type:Object,required:true},callAssessments:{type:Object,required:true},events:{type:Object,default:{}},analytics:{type:Object,default:{}},textEditor:d.TextEditor},data(){var t,e,s,i,a,l,r,o,d,c;const{segment:u,textEditor:g,categories:m,settings:h}=this;const p=(t=u==null?void 0:u.id)!=null?t:null;const E=(e=u==null?void 0:u.isEnabled)!=null?e:null;const v=m[0];let y=false;if((s=h.ai)!=null&&s.isAvailable&&((i=h.ai)!=null&&i.isSponsored||(a=h.baas)!=null&&a.hasPackage)){var S;y=(S=u.isAiEnabled)!=null?S:true}return{id:p,isEnabled:E,text:g.getText(),parser:new n.BBCodeParser,currentCategoryId:(l=u.entityCategoryId)!=null?l:v.id,currentStageId:(r=u.entityStageId)!=null?r:this.getFirstAvailableCategoryStageId(v),assignmentUserIds:new Set((o=u.assignmentUserIds)!=null?o:[]),currentEntityTitlePattern:(d=u.entityTitlePattern)!=null?d:null,currentCallAssessmentId:(c=u.callAssessmentId)!=null?c:null,currentIsAiEnabled:y}},mounted(){this.$Bitrix.eventEmitter.subscribe(v.click,this.onNavigationButtonClick);this.sendViewAnalytics()},beforeUnmount(){this.$Bitrix.eventEmitter.unsubscribe(v.click,this.onNavigationButtonClick)},methods:{onSaveCallback(){var t;if(u.Type.isFunction((t=this.events)==null?void 0:t.onSave)){this.events.onSave()}},onNavigationButtonClick({data:t}){const{id:e}=t;if(e==="cancel"||e==="close"){this.sendCancelAnalytics();this.closeSlider();return}this.sendData()},sendData(){const t={entityTypeId:2,entityCategoryId:this.currentCategoryId,entityStageId:this.currentStageId,assignmentUserIds:[...this.assignmentUserIds.values()],entityTitlePattern:this.currentEntityTitlePattern,callAssessmentId:this.currentCallAssessmentId,isAiEnabled:this.currentIsAiEnabled};if(!this.currentIsAiEnabled){t.prompt=this.textEditor.getText()}if(!this.validate(t)){return}const e={id:this.id,data:t};top.BX.Event.EventEmitter.emit("crm:repeatSale:segment:beforeSave",e);u.ajax.runAction("crm.repeatsale.segment.save",{json:e}).then((t=>{top.BX.Event.EventEmitter.emit("crm:repeatSale.segment:save",{...e,status:t==null?void 0:t.status});if((t==null?void 0:t.status)!=="success"){l.UI.Notification.Center.notify({content:u.Text.encode(t.errors[0].message),autoHideDelay:6e3});return}this.onSaveCallback();this.sendEditAnalytics();this.closeSlider()}),(t=>{const e="CRM_REPEAT_SALE_SEGMENT_SAVE_ERROR";l.UI.Notification.Center.notify({content:this.$Bitrix.Loc.getMessage(e),autoHideDelay:6e3})})).catch((t=>{l.UI.Notification.Center.notify({content:u.Text.encode(t.errors[0].message),autoHideDelay:6e3});throw t}))},validate(t){if(!u.Type.isArrayFilled(t.assignmentUserIds)){l.UI.Notification.Center.notify({content:this.$Bitrix.Loc.getMessage("CRM_REPEAT_SALE_SEGMENT_VALIDATE_ASSIGNMENT_USERS_ERROR"),autoHideDelay:6e3});return false}if(!this.currentIsAiEnabled&&!u.Type.isStringFilled(this.getPlainText())){l.UI.Notification.Center.notify({content:this.$Bitrix.Loc.getMessage("CRM_REPEAT_SALE_SEGMENT_VALIDATE_TEXT_ERROR"),autoHideDelay:6e3});return false}return true},closeSlider(){top.BX.SidePanel.Instance.getSliderByWindow(window).close()},getPlainText(){return this.parser.parse(this.textEditor.getText()).toPlainText().trim()},onSelectCategory(t){if(this.currentCategoryId===t.id){return}this.$refs.stageSelector.destroy();this.currentCategoryId=t.id;void this.$nextTick((()=>{const t=this.getCategoryById(this.currentCategoryId);this.currentStageId=this.getFirstAvailableCategoryStageId(t)}))},onSelectStage(t){this.currentStageId=t.id},getCategoryById(t){return this.categories.find((e=>e.id===t))},getFirstAvailableCategoryStageId(t){return t.items[0].id},onSelectAssignmentUser(t){this.assignmentUserIds.add(t.id)},onDeselectAssignmentUser(t){this.assignmentUserIds.delete(t.id)},setCurrentCallAssessmentId(t){this.currentCallAssessmentId=t},getMessageByCode(t){return this.$Bitrix.Loc.getMessage(t)},setCurrentIsAiEnabled(t){this.currentIsAiEnabled=t},sendViewAnalytics(){var t;const e=(t=this.analytics.section)!=null?t:"";const n=s.Builder.RepeatSale.Segment.ViewEvent.createDefault(e);i.sendData(n.buildData())},sendCancelAnalytics(){var t;const e=(t=this.analytics.section)!=null?t:"";const n=s.Builder.RepeatSale.Segment.CancelEvent.createDefault(e);i.sendData(n.buildData())},sendEditAnalytics(){var t;const e=(t=this.analytics.section)!=null?t:"";const n=s.Builder.RepeatSale.Segment.EditEvent.createDefault(e);if(!this.currentIsAiEnabled&&this.getPlainPromptText()!==this.getPlainSegmentText()){n.setIsActivityTextChanged(true)}if(this.segment.entityTitlePattern!==this.currentEntityTitlePattern){n.setIsEntityTitlePatternChanged(true)}if(this.segment.isAiEnabled!==this.currentIsAiEnabled){n.setIsCopilotEnabled(this.currentIsAiEnabled)}n.setSegmentCode(this.segment.code);i.sendData(n.buildData())},getPlainPromptText(){return this.parseText(this.textEditor.getText())},getPlainSegmentText(){return this.parseText(this.segment.prompt)},parseText(t){return this.parser.parse(t).toPlainText().trim()}},computed:{readOnly(){return this.settings.isReadOnly},isSponsored(){var t,e;return(t=(e=this.settings.ai)==null?void 0:e.isSponsored)!=null?t:false},isAiAvailable(){var t,e;return(t=(e=this.settings.ai)==null?void 0:e.isAvailable)!=null?t:false},aiDisabledSliderCode(){var t,e;return(t=(e=this.settings.ai)==null?void 0:e.aiDisabledSliderCode)!=null?t:null},isBaasAvailable(){var t,e;return(t=(e=this.settings.baas)==null?void 0:e.isAvailable)!=null?t:false},isBaasHasPackage(){var t,e;return(t=(e=this.settings.baas)==null?void 0:e.hasPackage)!=null?t:false},packageEmptySliderCode(){var t,e;return(t=(e=this.settings.baas)==null?void 0:e.aiPackagesEmptySliderCode)!=null?t:null},aiCallEnabled(){return this.settings.isAiCallEnabled},repeatSaleSegmentSection(){return["crm-repeat-sale__segment-section"]},title(){return this.$Bitrix.Loc.getMessage("CRM_REPEAT_SALE_SEGMENT_TITLE")},currentCategory(){var t;return(t=this.categories.find((t=>t.id===this.currentCategoryId)))!=null?t:null},messages(){return{textAreaTitle:this.getMessageByCode("CRM_REPEAT_SALE_SEGMENT_MANUAL_TEXTAREA_TITLE"),dealHelp:this.getMessageByCode("CRM_REPEAT_SALE_SEGMENT_DEAL_HELP"),sectionTitle:this.getMessageByCode("CRM_REPEAT_SALE_SEGMENT_MANUAL_SECTION_TITLE"),stageTitle:this.getMessageByCode("CRM_REPEAT_SALE_SEGMENT_MANUAL_STAGE_TITLE"),dealAssignedTitle:this.getMessageByCode("CRM_REPEAT_SALE_SEGMENT_DEAL_ASSIGNED_TITLE"),dealTitlePattern:this.getMessageByCode("CRM_REPEAT_SALE_SEGMENT_DEAL_NAME_PATTERN_TITLE"),assessmentTitle:this.getMessageByCode("CRM_REPEAT_SALE_SEGMENT_CALL_ASSESSMENT_TITLE"),assessmentDescription:this.getMessageByCode("CRM_REPEAT_SALE_SEGMENT_CALL_ASSESSMENT_DESCRIPTION")}}},watch:{currentIsAiEnabled(t){if(this.isAiAvailable&&(this.isSponsored||this.isBaasHasPackage)){this.currentIsAiEnabled=t;return}if(t===true){if(!this.isAiAvailable&&this.aiDisabledSliderCode){a.InfoHelper.show(this.aiDisabledSliderCode)}else if(!this.isBaasHasPackage&&this.packageEmptySliderCode){a.InfoHelper.show(this.packageEmptySliderCode)}void this.$nextTick((()=>{this.currentIsAiEnabled=false}))}}},template:`\n\t\t<div class="crm-repeat-sale__segment_container">\n\t\t\t<div class="crm-repeat-sale__segment-wrapper">\n\t\t\t\t<header class="crm-repeat-sale__segment-section-header">\n\t\t\t\t\t<div class="crm-repeat-sale__segment-section-header-title">\n\t\t\t\t\t\t<span>{{title}}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</header>\n\t\t\t\t<div class="crm-repeat-sale__segment-section-body">\n\t\t\t\t\t<section class="crm-repeat-sale__segment-section --main --active">\n\t\t\t\t\t\t<h1 class="crm-repeat-sale__segment-section-title">\n\t\t\t\t\t\t\t{{segment.title}}\n\t\t\t\t\t\t</h1>\n\t\t\t\t\t\t<div class="crm-repeat-sale__segment-section-description">\n\t\t\t\t\t\t\t{{segment.description}}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<AdditionalInfoComponent\n\t\t\t\t\t\t\t:title="messages.dealHelp"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</section>\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\t<section class="crm-repeat-sale__segment-section --active">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass="crm-repeat-sale__segment-fields-row"\n\t\t\t\t\t\t\tv-if="isBaasAvailable || isSponsored"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class="crm-repeat-sale__segment-field">\n\t\t\t\t\t\t\t\t<AiSwitcherComponent\n\t\t\t\t\t\t\t\t\tref="aiSwitcher"\n\t\t\t\t\t\t\t\t\t:checked="currentIsAiEnabled"\n\t\t\t\t\t\t\t\t\t:read-only="readOnly"\n\t\t\t\t\t\t\t\t\t@change="setCurrentIsAiEnabled"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-if="!currentIsAiEnabled"\n\t\t\t\t\t\t\tclass="crm-repeat-sale__segment-fields-row"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class="crm-repeat-sale__segment-field">\n\t\t\t\t\t\t\t\t<div class="crm-repeat-sale__segment-field-title">\n\t\t\t\t\t\t\t\t\t{{messages.textAreaTitle}}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<TextEditorWrapperComponent\n\t\t\t\t\t\t\t\t\t:textEditor="textEditor"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<div class="crm-repeat-sale__segment-fields-row">\n\t\t\t\t\t\t\t<div class="crm-repeat-sale__segment-field">\n\t\t\t\t\t\t\t\t<div class="crm-repeat-sale__segment-field-title">\n\t\t\t\t\t\t\t\t\t{{messages.sectionTitle}}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<CategorySelector \n\t\t\t\t\t\t\t\t\t:current-category-id="currentCategoryId"\n\t\t\t\t\t\t\t\t\t:categories="categories"\n\t\t\t\t\t\t\t\t\t:read-only="readOnly"\n\t\t\t\t\t\t\t\t\t@onSelectItem="onSelectCategory"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="crm-repeat-sale__segment-field">\n\t\t\t\t\t\t\t\t<div class="crm-repeat-sale__segment-field-title">\n\t\t\t\t\t\t\t\t\t{{messages.stageTitle}}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<StageSelector \n\t\t\t\t\t\t\t\t\tref="stageSelector"\n\t\t\t\t\t\t\t\t\t:current-stage-id="currentStageId"\n\t\t\t\t\t\t\t\t\t:category="currentCategory"\n\t\t\t\t\t\t\t\t\t:read-only="readOnly"\n\t\t\t\t\t\t\t\t\t@onSelectItem="onSelectStage"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="crm-repeat-sale__segment-fields-row">\n\t\t\t\t\t\t\t<div class="crm-repeat-sale__segment-field">\n\t\t\t\t\t\t\t\t<div class="crm-repeat-sale__segment-field-title">\n\t\t\t\t\t\t\t\t\t{{messages.dealAssignedTitle}}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<UserSelector\n\t\t\t\t\t\t\t\t\t:user-ids="[...assignmentUserIds.values()]"\n\t\t\t\t\t\t\t\t\t:read-only="readOnly"\n\t\t\t\t\t\t\t\t\t@onSelectItem="onSelectAssignmentUser"\n\t\t\t\t\t\t\t\t\t@onDeselectItem="onDeselectAssignmentUser"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<div class="crm-repeat-sale__segment-fields-row">\n\t\t\t\t\t\t\t<div class="crm-repeat-sale__segment-field">\n\t\t\t\t\t\t\t\t<div class="crm-repeat-sale__segment-field-title">\n\t\t\t\t\t\t\t\t\t{{messages.dealTitlePattern}}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\t\t\tv-model="currentEntityTitlePattern"\n\t\t\t\t\t\t\t\t\t:readonly="readOnly"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</section>\n\n\t\t\t\t\t<section \n\t\t\t\t\t\t:class="repeatSaleSegmentSection"\n\t\t\t\t\t\tv-if="aiCallEnabled && false"\n\t\t\t\t\t>\n\t\t\t\t\t\t<h1 class="crm-repeat-sale__segment-section-title --level2">\n\t\t\t\t\t\t\t{{messages.assessmentTitle}}\n\t\t\t\t\t\t</h1>\n\t\t\t\t\t\t<div class="crm-repeat-sale__segment-section-description">\n\t\t\t\t\t\t\t{{messages.assessmentDescription}}\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="crm-repeat-sale__segment-field">\n\t\t\t\t\t\t\t<CallAssessmentSelector \n\t\t\t\t\t\t\t\t:call-assessments="callAssessments"\n\t\t\t\t\t\t\t\t:current-call-assessment-id="currentCallAssessmentId"\n\t\t\t\t\t\t\t\t:read-only="readOnly"\n\t\t\t\t\t\t\t\t@onSelectItem="setCurrentCallAssessmentId"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t{{currentCallAssessmentId}}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</section>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="crm-repeat-sale__segment_navigation-container">\n\t\t\t\t<div class="crm-repeat-sale__segment_navigation-buttons-wrapper">\n\t\t\t\t\t<Button v-if="!readOnly" id="update" />\n\t\t\t\t\t<Button v-if="!readOnly" id="cancel" />\n\t\t\t\t\t<Button v-if="readOnly" id="close" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};var T=babelHelpers.classPrivateFieldLooseKey("container");var B=babelHelpers.classPrivateFieldLooseKey("app");var L=babelHelpers.classPrivateFieldLooseKey("textEditor");var w=babelHelpers.classPrivateFieldLooseKey("isReadOnly");var P=babelHelpers.classPrivateFieldLooseKey("getTextEditor");class D{constructor(t,s={}){var i,n,a,l,r,o,d;Object.defineProperty(this,P,{value:O});Object.defineProperty(this,T,{writable:true,value:void 0});Object.defineProperty(this,B,{writable:true,value:null});Object.defineProperty(this,L,{writable:true,value:null});Object.defineProperty(this,w,{writable:true,value:true});babelHelpers.classPrivateFieldLooseBase(this,T)[T]=document.getElementById(t);if(!u.Type.isDomNode(babelHelpers.classPrivateFieldLooseBase(this,T)[T])){throw new Error("container not found")}babelHelpers.classPrivateFieldLooseBase(this,w)[w]=(i=(n=s.config)==null?void 0:n.readOnly)!=null?i:true;babelHelpers.classPrivateFieldLooseBase(this,B)[B]=e.BitrixVue.createApp(I,{textEditor:babelHelpers.classPrivateFieldLooseBase(this,P)[P](s.data.segment,(a=s.config)!=null?a:{}),title:(l=(r=s.config)==null?void 0:r.title)!=null?l:"",settings:{isReadOnly:babelHelpers.classPrivateFieldLooseBase(this,w)[w],isCopy:(o=(d=s.config)==null?void 0:d.isCopy)!=null?o:false,ai:s.data.aiSettings,baas:s.data.baasSettings,isAiCallEnabled:s.data.isAiCallEnabled},segment:s.data.segment,categories:s.data.categories,callAssessments:s.data.callAssessments,events:s.events,analytics:s.analytics});babelHelpers.classPrivateFieldLooseBase(this,B)[B].mount(babelHelpers.classPrivateFieldLooseBase(this,T)[T])}}function O({prompt:t},{copilotSettings:e}){if(babelHelpers.classPrivateFieldLooseBase(this,L)[L]!==null){return babelHelpers.classPrivateFieldLooseBase(this,L)[L]}const s=babelHelpers.classPrivateFieldLooseBase(this,w)[w]?[]:["bold","italic","underline","strikethrough","|","numbered-list","bulleted-list","copilot"];babelHelpers.classPrivateFieldLooseBase(this,L)[L]=new d.BasicEditor({editable:!babelHelpers.classPrivateFieldLooseBase(this,w)[w],removePlugins:["BlockToolbar"],minHeight:250,maxHeight:400,content:t,placeholder:u.Loc.getMessage("CRM_REPEAT_SALE_SEGMENT_PLACEHOLDER"),paragraphPlaceholder:u.Loc.getMessage(u.Type.isPlainObject(e)?"CRM_REPEAT_SALE_SEGMENT_PLACEHOLDER_WITH_COPILOT":null),toolbar:[],floatingToolbar:s,collapsingMode:false,copilot:{copilotOptions:u.Type.isPlainObject(e)?e:null,triggerBySpace:true}});return babelHelpers.classPrivateFieldLooseBase(this,L)[L]}t.Segment=D})(this.BX.Crm.RepeatSale=this.BX.Crm.RepeatSale||{},BX.Vue3,BX.Crm.Integration.Analytics,BX.UI.Analytics,BX.UI.BBCode,BX.UI,BX,BX.UI,BX.UI,BX.UI.TextEditor,BX.UI,BX,BX.Event,BX.UI.EntitySelector);
//# sourceMappingURL=segment.bundle.map.js