{"version":3,"file":"widget.bundle.js","sources":["../src/content/base.js","../src/footer.js","../src/content/start.js","../src/content/statistics.js","../src/content-factory.js","../src/widget.js"],"sourcesContent":["import { Builder } from 'crm.integration.analytics';\nimport { ajax as Ajax, Dom, Loc, Tag, Type } from 'main.core';\nimport 'ui.design-tokens';\nimport type { PopupOptions } from 'main.popup';\nimport { Popup } from 'main.popup';\nimport { sendData } from 'ui.analytics';\nimport { Confetti } from 'ui.confetti';\nimport { Lottie } from 'ui.lottie';\nimport { UI } from 'ui.notification';\nimport type { WidgetParams, WidgetTypeEnum } from '../widget';\n\nexport class Base\n{\n\t#data: ?Object = null;\n\t#popup: ?Popup = null;\n\t#bindElement: ?HTMLElement = null;\n\t#isConfettiShowed: boolean = true;\n\t#isPreparing: boolean = false;\n\tparams: WidgetParams = {};\n\n\tconstructor(params: WidgetParams = {})\n\t{\n\t\tthis.params = params;\n\n\t\tif (Type.isBoolean(this.params.showConfetti))\n\t\t{\n\t\t\tthis.#isConfettiShowed = !this.params.showConfetti;\n\t\t}\n\t}\n\n\tgetType(): WidgetTypeEnum\n\t{\n\t\tthrow new Error('Must be implement in child class');\n\t}\n\n\tasync show(forceShowConfetti: boolean = false, onCloseCallback: ?Function = null): void\n\t{\n\t\tconst data = await this.getData();\n\n\t\tif (data === null)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#popup === null)\n\t\t{\n\t\t\tthis.#popup = new Popup(this.getPopupParams(data, { forceShowConfetti, onCloseCallback }));\n\t\t}\n\n\t\tthis.#popup.show();\n\t\tthis.#popup.adjustPosition();\n\t}\n\n\tgetPopupParams(data: Object, params: Object = {}): PopupOptions\n\t{\n\t\treturn {\n\t\t\tid: `crm_repeat_sale_widget_${this.getType()}`,\n\t\t\tbindElement: this.#getBindElementData(),\n\t\t\tcontent: this.getPopupContent(data),\n\t\t\tcacheable: false,\n\t\t\tisScrollBlock: false,\n\t\t\tclassName: `crm-repeat-sale-widget-popup --${this.getType()}`,\n\t\t\tcloseByEsc: true,\n\t\t\tcloseIcon: true,\n\t\t\tpadding: 16,\n\t\t\twidth: this.getPopupWidth(),\n\t\t\tmaxHeight: 500,\n\t\t\toverlay: null,\n\t\t\tautoHide: this.isAutoHidePopup(),\n\t\t\tevents: {\n\t\t\t\tonclose: () => {\n\t\t\t\t\tthis.onClose();\n\n\t\t\t\t\tif (Type.isFunction(params?.onCloseCallback))\n\t\t\t\t\t{\n\t\t\t\t\t\tparams.onCloseCallback();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonFirstShow: () => {\n\t\t\t\t\tthis.onFirstShow();\n\n\t\t\t\t\tif (this.#isConfettiShowed && params?.forceShowConfetti !== true)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tthis.#showConfetti();\n\t\t\t\t\t\tthis.#isConfettiShowed = true;\n\t\t\t\t\t}, 100);\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\n\t#getBindElementData(): Object\n\t{\n\t\tconst bindElement = this.#getParentBindElement();\n\n\t\tconst bindElementRect = bindElement.getBoundingClientRect();\n\n\t\treturn {\n\t\t\ttop: bindElementRect.top + bindElementRect.height + 5 + window.pageYOffset,\n\t\t\tleft: bindElementRect.right - (bindElement.clientWidth / 2) - (this.getPopupWidth() / 2) + window.pageXOffset,\n\t\t};\n\t}\n\n\t#getParentBindElement(): HTMLElement\n\t{\n\t\tconst hasParentButton = Boolean(this.#bindElement.closest('button'));\n\t\tconst hasParentLink = Boolean(this.#bindElement.closest('a'));\n\n\t\tif (hasParentButton)\n\t\t{\n\t\t\treturn this.#bindElement.closest('button');\n\t\t}\n\n\t\tif (hasParentLink)\n\t\t{\n\t\t\treturn this.#bindElement.closest('a');\n\t\t}\n\n\t\treturn this.#bindElement;\n\t}\n\n\tgetPopupWidth(): number\n\t{\n\t\treturn 469;\n\t}\n\n\tisAutoHidePopup(): boolean\n\t{\n\t\treturn false;\n\t}\n\n\tonFirstShow(): void\n\t{\n\t\t// may be implement in child class\n\t}\n\n\tgetPopupContent(data: ?Object = null): HTMLElement\n\t{\n\t\tthrow new Error('Must be implement in child class');\n\t}\n\n\tsetPopupContent(content: HTMLElement): void\n\t{\n\t\tthis.#popup.setContent(content);\n\t}\n\n\tonClose(): void\n\t{\n\t\tthis.#sendAnalyticsCloseEvent();\n\n\t\tif (this.params.showConfetti)\n\t\t{\n\t\t\tvoid Ajax.runAction('crm.repeatsale.widget.incrementShowedConfettiCount');\n\t\t}\n\n\t\tthis.#popup = null;\n\t}\n\n\t#sendAnalyticsCloseEvent(): void\n\t{\n\t\tconst type = this.getAnalyticsType();\n\t\tconst subSection = this.getAnalyticsSubSection();\n\n\t\tsendData(Builder.RepeatSale.Banner.CloseEvent.createDefault(type, subSection).buildData());\n\t}\n\n\tgetAnalyticsType(): string\n\t{\n\t\treturn '';\n\t}\n\n\t#showConfetti(): void\n\t{\n\t\tconst container = this.#popup?.getPopupContainer();\n\t\tif (!container)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet canvas = null;\n\n\t\tif (container.getElementsByTagName('canvas').length === 0)\n\t\t{\n\t\t\tcanvas = Tag.render`<canvas></canvas>`;\n\n\t\t\tDom.style(canvas, {\n\t\t\t\tposition: 'fixed',\n\t\t\t\ttop: 0,\n\t\t\t\tleft: 0,\n\t\t\t\tpointerEvents: 'none',\n\t\t\t\tzIndex: '9',\n\t\t\t\twidth: '100%',\n\t\t\t\theight: '100%',\n\t\t\t});\n\n\t\t\tDom.append(canvas, this.#popup.getPopupContainer());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcanvas = container.getElementsByTagName('canvas')[0];\n\t\t}\n\n\t\tconst confetti = Confetti.create(canvas, {\n\t\t\tresize: true,\n\t\t\tuseWorker: true,\n\t\t});\n\n\t\tconfetti({\n\t\t\tparticleCount: 400,\n\t\t\torigin: {\n\t\t\t\ty: 1.2,\n\t\t\t\tx: 0,\n\t\t\t},\n\t\t\tspread: 100,\n\t\t});\n\t}\n\n\tasync getData(): Object\n\t{\n\t\tthis.#data = await this.fetchData();\n\n\t\treturn this.#data;\n\t}\n\n\tasync fetchData(): Promise\n\t{\n\t\tif (this.#isPreparing)\n\t\t{\n\t\t\treturn Promise.resolve(null);\n\t\t}\n\n\t\tthis.#isPreparing = true;\n\n\t\treturn new Promise((resolve) => {\n\t\t\tAjax\n\t\t\t\t.runAction(this.getFetchUrl(), { data: this.getFetchParams() })\n\t\t\t\t.then(\n\t\t\t\t\t(response) => {\n\t\t\t\t\t\tthis.#isPreparing = false;\n\t\t\t\t\t\tif (response.status === 'success')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tresolve(response.data);\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.showError();\n\t\t\t\t\t},\n\t\t\t\t\t() => {\n\t\t\t\t\t\tthis.#isPreparing = false;\n\t\t\t\t\t\tthis.showError();\n\t\t\t\t\t},\n\t\t\t\t)\n\t\t\t\t.catch((response) => {\n\t\t\t\t\tthis.#isPreparing = false;\n\t\t\t\t\tthis.showError();\n\n\t\t\t\t\tthrow response;\n\t\t\t\t})\n\t\t\t;\n\t\t});\n\t}\n\n\tgetFetchUrl(): string\n\t{\n\t\tthrow new Error('Must be implement in child class');\n\t}\n\n\tgetFetchParams(): Object\n\t{\n\t\treturn {};\n\t}\n\n\tshowError(): void\n\t{\n\t\tconst messageCode = 'CRM_REPEAT_SALE_WIDGET_ERROR';\n\n\t\tUI.Notification.Center.notify({\n\t\t\tcontent: Loc.getMessage(messageCode),\n\t\t\tautoHideDelay: 6000,\n\t\t});\n\t}\n\n\tsetBindElement(element: HTMLElement): Base\n\t{\n\t\tthis.#bindElement = element;\n\n\t\treturn this;\n\t}\n\n\tgetAnalyticsSubSection(): ?string\n\t{\n\t\treturn this.#getParentBindElement().dataset.subsection ?? null;\n\t}\n\n\tisShown(): boolean\n\t{\n\t\treturn this.#popup?.isShown();\n\t}\n\n\tclose(): void\n\t{\n\t\tthis.#popup?.close();\n\t}\n\n\trenderLottieAnimation(): HTMLElement\n\t{\n\t\tconst container = Tag.render`\n\t\t\t<div class=\"crm-rs__w-lottie-container\">\n\t\t\t\t<div ref=\"lottie\" class=\"crm-rs__w-lottie\"></div>\n\t\t\t</div>\n\t\t`;\n\n\t\tconst mainAnimation = Lottie.loadAnimation({\n\t\t\tpath: '/bitrix/js/crm/repeat-sale/widget/lottie/animation.json',\n\t\t\tcontainer: container.lottie,\n\t\t\trenderer: 'svg',\n\t\t\tloop: true,\n\t\t\tautoplay: true,\n\t\t});\n\n\t\tmainAnimation.setSpeed(0.75);\n\n\t\treturn container.root;\n\t}\n}\n","import { Builder } from 'crm.integration.analytics';\nimport { Extension, Loc, Tag, Type } from 'main.core';\nimport { sendData } from 'ui.analytics';\nimport 'ui.feedback.form';\n\ntype Analytics = {\n\ttype: string,\n\tsubSection: string,\n}\n\nexport class Footer\n{\n\t#showSettingsButton: boolean = false;\n\t#analytics: Analytics = {};\n\n\tconstructor(showSettingsButton: boolean = false, analytics: Analytics = {})\n\t{\n\t\tthis.#showSettingsButton = showSettingsButton;\n\t\tthis.#analytics = analytics;\n\t}\n\n\tgetFooterContent(): HTMLElement\n\t{\n\t\tconst settingsButton = this.#showSettingsButton ? Tag.render`\n\t\t\t<div\n\t\t\t\tonclick=\"${this.#onSettingsClick.bind(this)}\"\n\t\t\t \tclass=\"crm-rs__w-footer-button --settings\"\n\t\t\t >\n\t\t\t\t${Loc.getMessage('CRM_REPEAT_SALE_WIDGET_POPUP_FOOTER_SETTINGS')}\n\t\t\t</div>\n\t\t` : '';\n\n\t\tconst feedbackButton = Tag.render`\n\t\t\t<div\n\t\t\t\tonclick=\"${this.#onFeedbackClick.bind(this)}\"\n\t\t\t\tclass=\"crm-rs__w-footer-button --feedback\"\n\t\t\t>\n\t\t\t\t${Loc.getMessage('CRM_REPEAT_SALE_WIDGET_POPUP_FOOTER_FEEDBACK')}\n\t\t\t</div>\n\t\t`;\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-rs__w-footer-row\">\n\t\t\t\t${Type.isArrayFilled(this.#getFeedbackFormParams()) ? feedbackButton : '<div></div>'}\n\t\t\t\t${settingsButton}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#onSettingsClick(): void\n\t{\n\t\tconst eventBuilder = this.#getClickEventBuilder();\n\t\teventBuilder.setElement('config');\n\t\tsendData(eventBuilder.buildData());\n\n\t\twindow.location.href = '/crm/repeat-sale-segment/';\n\t}\n\n\t#onFeedbackClick(): void\n\t{\n\t\tconst eventBuilder = this.#getClickEventBuilder();\n\t\teventBuilder.setElement('feedback');\n\t\tsendData(eventBuilder.buildData());\n\n\t\tthis.#showFeedbackCrmForm();\n\t}\n\n\t#showFeedbackCrmForm(): void\n\t{\n\t\tBX.UI.Feedback.Form.open({\n\t\t\tid: Math.random().toString(),\n\t\t\tforms: this.#getFeedbackFormParams(),\n\t\t});\n\t}\n\n\t#getFeedbackFormParams(): Array\n\t{\n\t\treturn Extension.getSettings('crm.repeat-sale.widget').get('feedbackFormParams');\n\t}\n\n\t#getClickEventBuilder(): Builder.RepeatSale.Banner.ClickEvent\n\t{\n\t\tconst type = this.#analytics.type;\n\t\tconst subSection = this.#analytics.subSection;\n\n\t\treturn Builder.RepeatSale.Banner.ClickEvent.createDefault(type, subSection);\n\t}\n}\n","import { Builder, Dictionary } from 'crm.integration.analytics';\nimport { ajax as Ajax, Loc, Tag, Type } from 'main.core';\nimport 'ui.design-tokens';\nimport { sendData } from 'ui.analytics';\nimport { Footer } from '../footer';\nimport type { WidgetParams, WidgetTypeEnum } from '../widget';\nimport { WidgetType } from '../widget';\nimport { Base } from './base';\n\nexport class Start extends Base\n{\n\t#isFlowStarted: ?boolean = null;\n\t#showSettingsButton: boolean = true;\n\t#hasClients: boolean = false;\n\n\tconstructor(params: WidgetParams)\n\t{\n\t\tsuper(params);\n\n\t\tthis.#showSettingsButton = params.showSettingsButton ?? true;\n\t}\n\n\tgetType(): WidgetTypeEnum\n\t{\n\t\treturn WidgetType.start;\n\t}\n\n\tonClose(): void\n\t{\n\t\tsuper.onClose();\n\n\t\tvoid Ajax.runAction('crm.repeatsale.widget.incrementShowedFlowStartCount');\n\t}\n\n\tgetPopupContent(data: ?Object = null): HTMLElement\n\t{\n\t\tif (Type.isObject(data))\n\t\t{\n\t\t\tif (this.#isFlowStarted === null)\n\t\t\t{\n\t\t\t\tconst { isFlowStarted } = data;\n\t\t\t\tthis.#isFlowStarted = isFlowStarted;\n\t\t\t}\n\n\t\t\tthis.#hasClients = this.#isHasClients(data);\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div>\n\t\t\t\t<header class=\"crm-rs__w-header\">\n\t\t\t\t\t${this.#getTitle()}\n\t\t\t\t</header>\n\t\t\t\t${this.#hasClients ? this.#getBodyContentWithClients() : this.#getBodyContent()}\n\t\t\t\t${this.#hasClients ? this.#getFooterContent() : null}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getBodyContent(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-rs__w-body\">\n\t\t\t\t<div class=\"crm-rs__w-body-content\">\n\t\t\t\t\t<div class=\"crm-rs__w-body-title\">\n\t\t\t\t\t\t${this.#getBodyTitle()}\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.#getDescription()}\n\t\t\t\t</div>\n\t\t\t\t${this.#getBubble()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getBodyContentWithClients(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-rs__w-body\">\n\t\t\t\t<div class=\"crm-rs__w-body-content --has-clients\">\n\t\t\t\t\t<div class=\"crm-rs__w-body-title\">\n\t\t\t\t\t\t${this.#getBodyTitle()}\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.#getButton()}\n\t\t\t\t</div>\n\t\t\t\t${this.#getBubble()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getBubble(): HTMLElement\n\t{\n\t\tconst hasClients = this.#hasClients;\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-rs__w-body-bubble ${this.#isFlowStarted ? '--flow-started' : ''} ${hasClients ? '--has-clients' : ''}\">\n\t\t\t\t${this.renderLottieAnimation()}\n\t\t\t\t<div class=\"crm-rs__w-body-icon\"></div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getFooterContent(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<footer class=\"crm-rs__w-footer\">\n\t\t\t\t${this.#getDescription()}\n\t\t\t</footer>\n\t\t`;\n\t}\n\n\t#getTitle(): string | HTMLElement\n\t{\n\t\tif (this.#isFlowStarted)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<span>${Loc.getMessage('CRM_REPEAT_SALE_WIDGET_START_FLOW_STARTED_POPUP_TITLE')}</span>\n\t\t\t`;\n\t\t}\n\n\t\treturn Loc.getMessage('CRM_REPEAT_SALE_WIDGET_START_POPUP_TITLE');\n\t}\n\n\t#getBodyTitle(): string | HTMLElement\n\t{\n\t\tif (this.#isFlowStarted)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<span>${Loc.getMessage('CRM_REPEAT_SALE_WIDGET_START_POPUP_BODY_FLOW_STARTED_TITLE')}</span>\n\t\t\t`;\n\t\t}\n\n\t\tconst code = (\n\t\t\tthis.#hasClients\n\t\t\t\t? 'CRM_REPEAT_SALE_WIDGET_START_POPUP_BODY_TITLE_WITH_CLIENTS'\n\t\t\t\t: 'CRM_REPEAT_SALE_WIDGET_START_POPUP_BODY_TITLE_WITHOUT_CLIENTS'\n\t\t);\n\n\t\treturn Loc.getMessage(code);\n\t}\n\n\t#getButton(): ?string\n\t{\n\t\tif (this.#isFlowStarted)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-rs__w-body-title-btn --has-clients\">\n\t\t\t\t<span\n\t\t\t\t\tonclick=\"${this.#onButtonClick.bind(this)}\"\n\t\t\t\t>${Loc.getMessage('CRM_REPEAT_SALE_WIDGET_START_POPUP_BTN')}</span>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getDescription(): HTMLElement\n\t{\n\t\tif (this.#isFlowStarted)\n\t\t{\n\t\t\tconst footer = new Footer(this.#showSettingsButton, {\n\t\t\t\ttype: this.getAnalyticsType(),\n\t\t\t\tsubSection: this.getAnalyticsSubSection(),\n\t\t\t});\n\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-rs__w-buttons-wrapper\">\n\t\t\t\t\t${footer.getFooterContent()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\tconst hasClients = this.#hasClients;\n\t\tconst code = (\n\t\t\thasClients\n\t\t\t\t? 'CRM_REPEAT_SALE_WIDGET_START_POPUP_DESC_WITH_CLIENTS'\n\t\t\t\t: 'CRM_REPEAT_SALE_WIDGET_START_POPUP_DESC_WITHOUT_CLIENTS'\n\t\t);\n\n\t\tconst content = Loc.getMessage(code);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-rs__w-body-description ${hasClients ? '--has-clients' : ''}\">\n\t\t\t\t${hasClients ? null : '<div class=\"crm-rs__w-body-description-border\"></div>'}\n\t\t\t\t<div class=\"crm-rs__w-body-description-text ${hasClients ? '--has-clients' : ''}\">\n\t\t\t\t\t${content}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"crm-rs__w-body-description-btn\">\n\t\t\t\t\t<span\n\t\t\t\t\t\tonclick=\"${this.#onReadMoreButtonClick.bind(this)}\"\n\t\t\t\t\t>${Loc.getMessage('CRM_REPEAT_SALE_WIDGET_START_POPUP_BTN_READ_MORE')}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#onButtonClick(): void\n\t{\n\t\tif (this.#hasClients)\n\t\t{\n\t\t\tAjax\n\t\t\t\t.runAction('crm.repeatsale.flow.enable')\n\t\t\t\t.then(\n\t\t\t\t\t(response) => {\n\t\t\t\t\t\tif (response.status === 'success')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.#isFlowStarted = true;\n\t\t\t\t\t\t\tthis.setPopupContent(this.getPopupContent());\n\n\t\t\t\t\t\t\tconst instance = this.#getClickEventBuilder();\n\t\t\t\t\t\t\tinstance.setElement('start_flow');\n\t\t\t\t\t\t\tsendData(instance.buildData());\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.showError();\n\t\t\t\t\t\tthis.close();\n\t\t\t\t\t},\n\t\t\t\t\t(response) => {\n\t\t\t\t\t\tthis.showError();\n\t\t\t\t\t\tthis.close();\n\t\t\t\t\t},\n\t\t\t\t)\n\t\t\t\t.catch((response) => {\n\t\t\t\t\tthis.showError();\n\t\t\t\t\tthis.close();\n\t\t\t\t})\n\t\t\t;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#showReadMore();\n\n\t\t\tvoid Ajax.runAction('crm.repeatsale.widget.finalizeShowedFlowStart');\n\t\t}\n\t}\n\n\t#onReadMoreButtonClick(): void\n\t{\n\t\tconst instance = this.#getClickEventBuilder();\n\t\tinstance.setElement('info_button');\n\t\tsendData(instance.buildData());\n\n\t\tthis.#showReadMore();\n\t}\n\n\t#showReadMore(): void\n\t{\n\t\ttop.BX?.Helper?.show('redirect=detail&code=25376986');\n\t}\n\n\t#isHasClients(data: Object): boolean\n\t{\n\t\treturn data.count > 0;\n\t}\n\n\tgetFetchUrl(): string\n\t{\n\t\treturn 'crm.repeatsale.statistics.getInitData';\n\t}\n\n\tgetFetchParams(): Object\n\t{\n\t\treturn {};\n\t}\n\n\t#getClickEventBuilder(): Builder.RepeatSale.Banner.ClickEvent\n\t{\n\t\tconst type = this.getAnalyticsType();\n\t\tconst subSection = this.getAnalyticsSubSection();\n\n\t\treturn Builder.RepeatSale.Banner.ClickEvent.createDefault(type, subSection);\n\t}\n\n\tonFirstShow(): void\n\t{\n\t\tconst type = this.getAnalyticsType();\n\t\tconst subSection = this.getAnalyticsSubSection();\n\n\t\tthis.#sendShowAnalytics(type, subSection);\n\t}\n\n\t#sendShowAnalytics(type: string, subSection: string): void\n\t{\n\t\tconst instance = Builder.RepeatSale.Banner.ViewEvent.createDefault(type, subSection);\n\t\tsendData(instance.buildData());\n\t}\n\n\tgetAnalyticsType(): string\n\t{\n\t\treturn (\n\t\t\tthis.#hasClients\n\t\t\t\t? Dictionary.TYPE_REPEAT_SALE_BANNER_START_EMPTY\n\t\t\t\t: Dictionary.TYPE_REPEAT_SALE_BANNER_START\n\t\t);\n\t}\n}\n","import { Builder, Dictionary } from 'crm.integration.analytics';\nimport 'ui.design-tokens';\nimport { ajax as Ajax, Loc, Tag } from 'main.core';\nimport { PopupManager } from 'main.popup';\nimport { sendData } from 'ui.analytics';\nimport { Lottie } from 'ui.lottie';\nimport { Footer } from '../footer';\nimport type { WidgetParams, WidgetTypeEnum } from '../widget';\nimport { PeriodType, WidgetType } from '../widget';\nimport { Base } from './base';\n\nimport 'ui.hint';\n\nexport class Statistics extends Base\n{\n\t#periodType: number = PeriodType.day30;\n\t#showSettingsButton: boolean = true;\n\t#hint: ?Manager = null;\n\n\tconstructor(params: WidgetParams)\n\t{\n\t\tsuper(params);\n\n\t\tthis.#showSettingsButton = params.showSettingsButton ?? true;\n\t}\n\n\tgetType(): WidgetTypeEnum\n\t{\n\t\treturn WidgetType.statistics;\n\t}\n\n\tgetPopupWidth(): number\n\t{\n\t\treturn 489;\n\t}\n\n\tisAutoHidePopup(): boolean\n\t{\n\t\treturn true;\n\t}\n\n\t#getLoadingPopupContent(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div>\n\t\t\t\t<header class=\"crm-rs__w-header --statistics\">\n\t\t\t\t\t${Loc.getMessage('CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_TITLE')}\n\t\t\t\t</header>\n\t\t\t\t<div class=\"crm-rs__w-body\">\n\t\t\t\t\t<div class=\"crm-rs__w-body-loading-bubble\">\n\t\t\t\t\t\t<div class=\"crm-rs__w-body-loading-bubble-wrapper\">\n\t\t\t\t\t\t\t${this.renderLottieAnimation()}\n\t\t\t\t\t\t\t${this.#renderLoadingLottieAnimation()}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"crm-rs__w-body-bubble-subtitle\">\n\t\t\t\t\t\t\t${Loc.getMessage('CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_LOADING')}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<footer class=\"crm-rs__w-footer --statistics\">\n\t\t\t\t\t${this.#getFooterContent()}\n\t\t\t\t</footer>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#renderLoadingLottieAnimation(): HTMLElement\n\t{\n\t\tconst container = Tag.render`\n\t\t\t<div class=\"crm-rs__w-loading-lottie-container\">\n\t\t\t\t<div ref=\"lottie\" class=\"crm-rs__w-lottie\"></div>\n\t\t\t</div>\n\t\t`;\n\n\t\tconst mainAnimation = Lottie.loadAnimation({\n\t\t\tpath: '/bitrix/js/crm/repeat-sale/widget/lottie/loading.json',\n\t\t\tcontainer: container.lottie,\n\t\t\trenderer: 'svg',\n\t\t\tloop: true,\n\t\t\tautoplay: true,\n\t\t});\n\n\t\tmainAnimation.setSpeed(0.75);\n\n\t\treturn container.root;\n\t}\n\n\tgetPopupContent(data: ?Object = null): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div>\n\t\t\t\t<header class=\"crm-rs__w-header --statistics\">\n\t\t\t\t\t${this.#getPopupTitle(data)}\n\t\t\t\t</header>\n\t\t\t\t<div class=\"crm-rs__w-body\">\n\t\t\t\t\t<div class=\"crm-rs__w-body-content --statistics\">\n\t\t\t\t\t\t<div class=\"crm-rs__w-body-statistics-table-container\">\n\t\t\t\t\t\t\t<table class=\"crm-rs__w-body-statistics-table\">\n\t\t\t\t\t\t\t\t<thead>\n\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t<th></th>\n\t\t\t\t\t\t\t\t\t\t<th>${Loc.getMessage('CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_COUNT')}</th>\n\t\t\t\t\t\t\t\t\t\t<th>${Loc.getMessage('CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_SUM')}</th>\n\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t</thead>\n\t\t\t\t\t\t\t\t<tbody class=\"crm-rs__w-body-statistics-table-body\">\n\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t<td><span>${Loc.getMessage('CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_DEALS_IN_WORK')}</span></td>\n\t\t\t\t\t\t\t\t\t\t<td><span>${data.repeatSaleProcessCount ?? 0}</span></td>\n\t\t\t\t\t\t\t\t\t\t<td><span>${data.repeatSaleProcessSum ?? 0}</span></td>\n\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t<td>${Loc.getMessage('CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_WIN_DEALS')}</td>\n\t\t\t\t\t\t\t\t\t\t<td>${data.repeatSaleWinCount ?? 0}</td>\n\t\t\t\t\t\t\t\t\t\t<td>${data.repeatSaleWinSum ?? 0}</td>\n\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t</tbody>\n\t\t\t\t\t\t\t\t<tfoot class=\"crm-rs__w-body-statistics-table-footer\">\n\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t\t${Loc.getMessage('CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_CONVERSION')}\n\t\t\t\t\t\t\t\t\t\t\t\t<span \n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"crm-rs__w-body-statistics-hint\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonmouseenter=\"${this.#showHint.bind(this)}\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonmouseleave=\"${this.#hideHint.bind(this)}\"\n\t\t\t\t\t\t\t\t\t\t\t\t></span>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t<td><span>${data.conversionByCount}${data.conversionByCount > 0 ? '%' : ''}</span></td>\n\t\t\t\t\t\t\t\t\t\t<td>${data.conversionBySum}${data.conversionBySum > 0 ? '%' : ''}</td>\n\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t</tfoot>\n\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<footer class=\"crm-rs__w-footer --statistics\">\n\t\t\t\t\t${this.#getFooterContent()}\n\t\t\t\t</footer>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getPopupTitle(data: Object): HTMLElement\n\t{\n\t\tconst repeatSaleForPeriodText = Tag.render`\n\t\t\t<span>\n\t\t\t\t${Loc.getMessagePlural(\n\t\t\t\t\t'CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_TITLE_TOTAL_DEALS',\n\t\t\t\t\tdata.repeatSaleTotalCount ?? 0,\n\t\t\t\t\t{\n\t\t\t\t\t\t'#COUNT#': data.repeatSaleTotalCount ?? 0,\n\t\t\t\t\t},\n\t\t\t\t)}\n\t\t\t</span>\n\t\t`;\n\n\t\tconst repeatSaleTodayCount = data.repeatSaleTodayCount ?? 0;\n\n\t\tlet repeatSaleTodayText = null;\n\t\tif (repeatSaleTodayCount > 0)\n\t\t{\n\t\t\trepeatSaleTodayText = Tag.render`\n\t\t\t\t<span>\n\t\t\t\t\t${Loc.getMessagePlural(\n\t\t\t\t\t\t'CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_TITLE_TODAY_DEALS',\n\t\t\t\t\t\tdata.repeatSaleTodayCount ?? 0,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'#COUNT#': data.repeatSaleTodayCount ?? 0,\n\t\t\t\t\t\t},\n\t\t\t\t\t)}\n\t\t\t\t</span>\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst todayNoDealsMessage = Loc.getMessage('CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_TITLE_TODAY_NO_DEALS');\n\t\t\tif (todayNoDealsMessage)\n\t\t\t{\n\t\t\t\trepeatSaleTodayText = Tag.render`<span>${todayNoDealsMessage}</span>`;\n\t\t\t}\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div>\n\t\t\t\t${Loc.getMessage('CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_TITLE')}\n\t\t\t\t<div class=\"crm-rs__w-header-span-wrapper\">\n\t\t\t\t\t${repeatSaleForPeriodText}\n\t\t\t\t\t${repeatSaleTodayText}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div \n\t\t\t\tclass=\"crm-rs__w-period-selector\"\n\t\t\t\tonclick=\"${this.#onPeriodChange.bind(this, this.#periodType)}\"\n\t\t\t>\n\t\t\t\t${this.#getSelectorTitle()}\n\t\t\t\t<span class=\"crm-rs__w-period-selector-icon\"></span>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getSelectorTitle(): string\n\t{\n\t\tlet code = null;\n\n\t\tswitch (this.#periodType)\n\t\t{\n\t\t\tcase PeriodType.day30:\n\t\t\t\tcode = 'CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_PERIOD_DAY_30';\n\t\t\t\tbreak;\n\t\t\tcase PeriodType.quarter:\n\t\t\t\tcode = 'CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_PERIOD_QUARTER';\n\t\t\t\tbreak;\n\t\t\tcase PeriodType.halfYear:\n\t\t\t\tcode = 'CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_PERIOD_HALF_YEAR';\n\t\t\t\tbreak;\n\t\t\tcase PeriodType.year:\n\t\t\t\tcode = 'CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_PERIOD_YEAR';\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthrow new RangeError('unknown period type');\n\t\t}\n\n\t\treturn Loc.getMessage(code);\n\t}\n\n\t#getFooterContent(): HTMLElement\n\t{\n\t\tconst footer = new Footer(this.#showSettingsButton, {\n\t\t\ttype: this.getAnalyticsType(),\n\t\t\tsubSection: this.getAnalyticsSubSection(),\n\t\t});\n\n\t\treturn footer.getFooterContent();\n\t}\n\n\tgetAnalyticsType(): string\n\t{\n\t\treturn Dictionary.TYPE_REPEAT_SALE_BANNER_STATISTICS;\n\t}\n\n\tgetFetchUrl(): string\n\t{\n\t\treturn 'crm.repeatsale.statistics.getData';\n\t}\n\n\tgetFetchParams(): Object\n\t{\n\t\treturn {\n\t\t\tperiodType: this.#periodType,\n\t\t};\n\t}\n\n\t#onPeriodChange(periodTypeId: number): void\n\t{\n\t\tlet nextPeriodTypeId = PeriodType.day30;\n\n\t\tconst periodTypeIds = Object.values(PeriodType);\n\n\t\tif (periodTypeIds.includes(periodTypeId))\n\t\t{\n\t\t\tconst index = periodTypeIds.indexOf(periodTypeId);\n\t\t\tif (index + 1 < periodTypeIds.length)\n\t\t\t{\n\t\t\t\tnextPeriodTypeId = index + 1;\n\t\t\t}\n\t\t}\n\n\t\tconst data = {\n\t\t\tperiodTypeId: nextPeriodTypeId,\n\t\t};\n\n\t\tconst eventBuilder = this.#getClickEventBuilder();\n\t\teventBuilder.setElement('change_period');\n\t\teventBuilder.setPeriod(nextPeriodTypeId);\n\t\tsendData(eventBuilder.buildData());\n\n\t\t// @todo maybe pointless loader\n\t\t// const popup = PopupManager.getPopupById(`crm_repeat_sale_widget_${this.getType()}`);\n\t\t// if (popup)\n\t\t// {\n\t\t// \tpopup.setContent(this.#getLoadingPopupContent());\n\t\t// }\n\n\t\tAjax\n\t\t\t.runAction(this.getFetchUrl(), { data })\n\t\t\t.then(\n\t\t\t\t(response) => {\n\t\t\t\t\tif (response.status === 'success')\n\t\t\t\t\t{\n\t\t\t\t\t\tconst popup = PopupManager.getPopupById(`crm_repeat_sale_widget_${this.getType()}`);\n\t\t\t\t\t\tif (popup === null)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.data = response.data;\n\t\t\t\t\t\tthis.#periodType = nextPeriodTypeId;\n\n\t\t\t\t\t\tpopup.setContent(this.getPopupContent(this.data));\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.showError();\n\t\t\t\t},\n\t\t\t\t(response) => {\n\t\t\t\t\t//popup.setContent(this.getPopupContent(this.data));\n\t\t\t\t\tthis.showError();\n\t\t\t\t},\n\t\t\t)\n\t\t\t.catch((response) => {\n\t\t\t\t//popup.setContent(this.getPopupContent(this.data));\n\t\t\t\tthis.showError();\n\t\t\t})\n\t\t;\n\t}\n\n\t#showHint(event: Event): void\n\t{\n\t\tif (this.#getHintInstance().popup?.isShown())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#getHintInstance().show(\n\t\t\tevent.target,\n\t\t\tLoc.getMessage('CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_CONVERSION_HINT'),\n\t\t\ttrue,\n\t\t);\n\t}\n\n\t#hideHint(): void\n\t{\n\t\tif (this.#getHintInstance().popup?.isShown())\n\t\t{\n\t\t\tthis.#getHintInstance().hide();\n\t\t}\n\t}\n\n\t#getHintInstance(): Manager\n\t{\n\t\tif (this.#hint === null)\n\t\t{\n\t\t\tthis.#hint = BX.UI.Hint.createInstance({\n\t\t\t\tpopupParameters: {\n\t\t\t\t\tautoHide: true,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonFirstShow: () => {\n\t\t\t\t\t\t\tthis.#hint.popup.setOffset({ offsetLeft: 9 });\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\treturn this.#hint;\n\t}\n\n\t#getClickEventBuilder(): Builder.RepeatSale.Banner.ClickEvent\n\t{\n\t\tconst type = this.getAnalyticsType();\n\t\tconst subSection = this.getAnalyticsSubSection();\n\n\t\treturn Builder.RepeatSale.Banner.ClickEvent.createDefault(type, subSection);\n\t}\n}\n","import { Base } from './content/base';\nimport { Start } from './content/start';\nimport { Statistics } from './content/statistics';\nimport type { WidgetParams, WidgetTypeEnum } from './widget';\nimport { WidgetType } from './widget';\n\nexport class ContentFactory\n{\n\tstatic getContentInstance(widgetType: WidgetTypeEnum, params: WidgetParams = {}): Base\n\t{\n\t\tswitch (widgetType)\n\t\t{\n\t\t\tcase WidgetType.start:\n\t\t\t\treturn new Start(params);\n\t\t\tcase WidgetType.statistics:\n\t\t\t\treturn new Statistics(params);\n\t\t\tdefault:\n\t\t\t\treturn null;\n\t\t}\n\t}\n}\n","import { ContentFactory } from './content-factory';\nimport { Base } from './content/base';\nimport 'ui.design-tokens';\nimport 'ui.design-tokens.air';\nimport './widget.css';\n\nexport type WidgetTypeEnum = WidgetType.start | WidgetType.statistics;\n\nexport const PeriodType = Object.freeze({\n\tday30: 0,\n\tquarter: 1,\n\thalfYear: 2,\n\tyear: 3,\n});\n\nexport const WidgetType = Object.freeze({\n\tstart: 'start',\n\tstatistics: 'statistics',\n});\n\nexport type WidgetParams = {\n\tshowSettingsButton?: boolean,\n\tshowConfetti?: boolean,\n}\n\nexport class Widget\n{\n\tstatic instance: Array = [];\n\t#contentPopupInstance: ?Base = null;\n\n\tstatic execute(\n\t\twidgetType: WidgetTypeEnum,\n\t\tbindElement: ?HTMLElement = null,\n\t\tparams: WidgetParams = {},\n\t\tevent: ?Event = null,\n\t\tonCloseCallback: ?Function = null,\n\t): void\n\t{\n\t\tif (!this.instance[widgetType])\n\t\t{\n\t\t\tthis.instance[widgetType] = new Widget(widgetType, bindElement, params);\n\t\t}\n\n\t\tif (this.instance[widgetType].isShown())\n\t\t{\n\t\t\tthis.instance[widgetType].close();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst forceShowConfetti = (event?.altKey && event?.ctrlKey) ?? false;\n\n\t\t\tthis.instance[widgetType].show(forceShowConfetti, onCloseCallback);\n\t\t}\n\t}\n\n\tconstructor(widgetType: WidgetTypeEnum, bindElement: ?HTMLElement = null, params: WidgetParams = {})\n\t{\n\t\tthis.#contentPopupInstance = ContentFactory.getContentInstance(widgetType, params);\n\n\t\tif (bindElement)\n\t\t{\n\t\t\tthis.#contentPopupInstance.setBindElement(bindElement);\n\t\t}\n\t}\n\n\tshow(forceShowConfetti: boolean = false, onCloseCallback: ?Function = null): void\n\t{\n\t\tthis.#contentPopupInstance.show(forceShowConfetti, onCloseCallback);\n\t}\n\n\tisShown(): boolean\n\t{\n\t\treturn this.#contentPopupInstance.isShown();\n\t}\n\n\tclose(): void\n\t{\n\t\tthis.#contentPopupInstance.close();\n\t}\n}"],"names":["Base","constructor","params","Type","isBoolean","showConfetti","getType","Error","show","forceShowConfetti","onCloseCallback","data","getData","Popup","getPopupParams","adjustPosition","id","bindElement","content","getPopupContent","cacheable","isScrollBlock","className","closeByEsc","closeIcon","padding","width","getPopupWidth","maxHeight","overlay","autoHide","isAutoHidePopup","events","onclose","onClose","isFunction","onFirstShow","setTimeout","setPopupContent","setContent","Ajax","runAction","getAnalyticsType","fetchData","Promise","resolve","getFetchUrl","getFetchParams","then","response","status","showError","catch","messageCode","UI","Notification","Center","notify","Loc","getMessage","autoHideDelay","setBindElement","element","getAnalyticsSubSection","dataset","subsection","isShown","close","renderLottieAnimation","container","Tag","render","mainAnimation","Lottie","loadAnimation","path","lottie","renderer","loop","autoplay","setSpeed","root","bindElementRect","getBoundingClientRect","top","height","window","pageYOffset","left","right","clientWidth","pageXOffset","hasParentButton","Boolean","closest","hasParentLink","type","subSection","sendData","Builder","RepeatSale","Banner","CloseEvent","createDefault","buildData","getPopupContainer","canvas","getElementsByTagName","length","Dom","style","position","pointerEvents","zIndex","append","confetti","Confetti","create","resize","useWorker","particleCount","origin","y","x","spread","Footer","showSettingsButton","analytics","getFooterContent","settingsButton","bind","feedbackButton","isArrayFilled","eventBuilder","setElement","location","href","BX","Feedback","Form","open","Math","random","toString","forms","Extension","getSettings","get","ClickEvent","Start","WidgetType","start","isObject","isFlowStarted","Dictionary","TYPE_REPEAT_SALE_BANNER_START_EMPTY","TYPE_REPEAT_SALE_BANNER_START","hasClients","code","footer","instance","Helper","count","ViewEvent","Statistics","PeriodType","day30","statistics","repeatSaleProcessCount","repeatSaleProcessSum","repeatSaleWinCount","repeatSaleWinSum","conversionByCount","conversionBySum","TYPE_REPEAT_SALE_BANNER_STATISTICS","periodType","repeatSaleForPeriodText","getMessagePlural","repeatSaleTotalCount","repeatSaleTodayCount","repeatSaleTodayText","todayNoDealsMessage","quarter","halfYear","year","RangeError","periodTypeId","nextPeriodTypeId","periodTypeIds","Object","values","includes","index","indexOf","setPeriod","popup","PopupManager","getPopupById","event","target","hide","Hint","createInstance","popupParameters","setOffset","offsetLeft","ContentFactory","getContentInstance","widgetType","freeze","Widget","execute","altKey","ctrlKey"],"mappings":"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"}