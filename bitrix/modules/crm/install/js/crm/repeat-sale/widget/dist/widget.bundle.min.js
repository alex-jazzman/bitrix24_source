this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};(function(e,s,t,a,l,i,r,o,n,c){"use strict";let d=e=>e,b,p;var v=babelHelpers.classPrivateFieldLooseKey("data");var u=babelHelpers.classPrivateFieldLooseKey("popup");var P=babelHelpers.classPrivateFieldLooseKey("bindElement");var h=babelHelpers.classPrivateFieldLooseKey("isConfettiShowed");var _=babelHelpers.classPrivateFieldLooseKey("isPreparing");var T=babelHelpers.classPrivateFieldLooseKey("getBindElementData");var L=babelHelpers.classPrivateFieldLooseKey("getParentBindElement");var E=babelHelpers.classPrivateFieldLooseKey("sendAnalyticsCloseEvent");var y=babelHelpers.classPrivateFieldLooseKey("showConfetti");class F{constructor(e={}){Object.defineProperty(this,y,{value:H});Object.defineProperty(this,E,{value:g});Object.defineProperty(this,L,{value:S});Object.defineProperty(this,T,{value:f});Object.defineProperty(this,v,{writable:true,value:null});Object.defineProperty(this,u,{writable:true,value:null});Object.defineProperty(this,P,{writable:true,value:null});Object.defineProperty(this,h,{writable:true,value:true});Object.defineProperty(this,_,{writable:true,value:false});this.params={};this.params=e;if(r.Type.isBoolean(this.params.showConfetti)){babelHelpers.classPrivateFieldLooseBase(this,h)[h]=!this.params.showConfetti}}getType(){throw new Error("Must be implement in child class")}async show(e=false,s=null){const t=await this.getData();if(t===null){return}if(babelHelpers.classPrivateFieldLooseBase(this,u)[u]===null){babelHelpers.classPrivateFieldLooseBase(this,u)[u]=new o.Popup(this.getPopupParams(t,{forceShowConfetti:e,onCloseCallback:s}))}babelHelpers.classPrivateFieldLooseBase(this,u)[u].show();babelHelpers.classPrivateFieldLooseBase(this,u)[u].adjustPosition()}getPopupParams(e,s={}){return{id:`crm_repeat_sale_widget_${this.getType()}`,bindElement:babelHelpers.classPrivateFieldLooseBase(this,T)[T](),content:this.getPopupContent(e),cacheable:false,isScrollBlock:false,className:`crm-repeat-sale-widget-popup --${this.getType()}`,closeByEsc:true,closeIcon:true,padding:16,width:this.getPopupWidth(),maxHeight:500,overlay:null,autoHide:this.isAutoHidePopup(),events:{onclose:()=>{this.onClose();if(r.Type.isFunction(s==null?void 0:s.onCloseCallback)){s.onCloseCallback()}},onFirstShow:()=>{this.onFirstShow();if(babelHelpers.classPrivateFieldLooseBase(this,h)[h]&&(s==null?void 0:s.forceShowConfetti)!==true){return}setTimeout((()=>{babelHelpers.classPrivateFieldLooseBase(this,y)[y]();babelHelpers.classPrivateFieldLooseBase(this,h)[h]=true}),100)}}}}getPopupWidth(){return 469}isAutoHidePopup(){return false}onFirstShow(){}getPopupContent(e=null){throw new Error("Must be implement in child class")}setPopupContent(e){babelHelpers.classPrivateFieldLooseBase(this,u)[u].setContent(e)}onClose(){babelHelpers.classPrivateFieldLooseBase(this,E)[E]();if(this.params.showConfetti){void r.ajax.runAction("crm.repeatsale.widget.incrementShowedConfettiCount")}babelHelpers.classPrivateFieldLooseBase(this,u)[u]=null}getAnalyticsType(){return""}async getData(){babelHelpers.classPrivateFieldLooseBase(this,v)[v]=await this.fetchData();return babelHelpers.classPrivateFieldLooseBase(this,v)[v]}async fetchData(){if(babelHelpers.classPrivateFieldLooseBase(this,_)[_]){return Promise.resolve(null)}babelHelpers.classPrivateFieldLooseBase(this,_)[_]=true;return new Promise((e=>{r.ajax.runAction(this.getFetchUrl(),{data:this.getFetchParams()}).then((s=>{babelHelpers.classPrivateFieldLooseBase(this,_)[_]=false;if(s.status==="success"){e(s.data);return}this.showError()}),(()=>{babelHelpers.classPrivateFieldLooseBase(this,_)[_]=false;this.showError()})).catch((e=>{babelHelpers.classPrivateFieldLooseBase(this,_)[_]=false;this.showError();throw e}))}))}getFetchUrl(){throw new Error("Must be implement in child class")}getFetchParams(){return{}}showError(){const e="CRM_REPEAT_SALE_WIDGET_ERROR";t.UI.Notification.Center.notify({content:r.Loc.getMessage(e),autoHideDelay:6e3})}setBindElement(e){babelHelpers.classPrivateFieldLooseBase(this,P)[P]=e;return this}getAnalyticsSubSection(){var e;return(e=babelHelpers.classPrivateFieldLooseBase(this,L)[L]().dataset.subsection)!=null?e:null}isShown(){var e;return(e=babelHelpers.classPrivateFieldLooseBase(this,u)[u])==null?void 0:e.isShown()}close(){var e;(e=babelHelpers.classPrivateFieldLooseBase(this,u)[u])==null?void 0:e.close()}renderLottieAnimation(){const e=r.Tag.render(b||(b=d`
			<div class="crm-rs__w-lottie-container">
				<div ref="lottie" class="crm-rs__w-lottie"></div>
			</div>
		`));const s=c.Lottie.loadAnimation({path:"/bitrix/js/crm/repeat-sale/widget/lottie/animation.json",container:e.lottie,renderer:"svg",loop:true,autoplay:true});s.setSpeed(.75);return e.root}}function f(){const e=babelHelpers.classPrivateFieldLooseBase(this,L)[L]();const s=e.getBoundingClientRect();return{top:s.top+s.height+5+window.pageYOffset,left:s.right-e.clientWidth/2-this.getPopupWidth()/2+window.pageXOffset}}function S(){const e=Boolean(babelHelpers.classPrivateFieldLooseBase(this,P)[P].closest("button"));const s=Boolean(babelHelpers.classPrivateFieldLooseBase(this,P)[P].closest("a"));if(e){return babelHelpers.classPrivateFieldLooseBase(this,P)[P].closest("button")}if(s){return babelHelpers.classPrivateFieldLooseBase(this,P)[P].closest("a")}return babelHelpers.classPrivateFieldLooseBase(this,P)[P]}function g(){const e=this.getAnalyticsType();const s=this.getAnalyticsSubSection();n.sendData(i.Builder.RepeatSale.Banner.CloseEvent.createDefault(e,s).buildData())}function H(){var e;const t=(e=babelHelpers.classPrivateFieldLooseBase(this,u)[u])==null?void 0:e.getPopupContainer();if(!t){return}let a=null;if(t.getElementsByTagName("canvas").length===0){a=r.Tag.render(p||(p=d`<canvas></canvas>`));r.Dom.style(a,{position:"fixed",top:0,left:0,pointerEvents:"none",zIndex:"9",width:"100%",height:"100%"});r.Dom.append(a,babelHelpers.classPrivateFieldLooseBase(this,u)[u].getPopupContainer())}else{a=t.getElementsByTagName("canvas")[0]}const l=s.Confetti.create(a,{resize:true,useWorker:true});l({particleCount:400,origin:{y:1.2,x:0},spread:100})}let B=e=>e,A,w,C;var m=babelHelpers.classPrivateFieldLooseKey("showSettingsButton");var R=babelHelpers.classPrivateFieldLooseKey("analytics");var O=babelHelpers.classPrivateFieldLooseKey("onSettingsClick");var I=babelHelpers.classPrivateFieldLooseKey("onFeedbackClick");var D=babelHelpers.classPrivateFieldLooseKey("showFeedbackCrmForm");var M=babelHelpers.classPrivateFieldLooseKey("getFeedbackFormParams");var j=babelHelpers.classPrivateFieldLooseKey("getClickEventBuilder");class ${constructor(e=false,s={}){Object.defineProperty(this,j,{value:k});Object.defineProperty(this,M,{value:G});Object.defineProperty(this,D,{value:U});Object.defineProperty(this,I,{value:W});Object.defineProperty(this,O,{value:K});Object.defineProperty(this,m,{writable:true,value:false});Object.defineProperty(this,R,{writable:true,value:{}});babelHelpers.classPrivateFieldLooseBase(this,m)[m]=e;babelHelpers.classPrivateFieldLooseBase(this,R)[R]=s}getFooterContent(){const e=babelHelpers.classPrivateFieldLooseBase(this,m)[m]?r.Tag.render(A||(A=B`
			<div
				onclick="${0}"
			 	class="crm-rs__w-footer-button --settings"
			 >
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,O)[O].bind(this),r.Loc.getMessage("CRM_REPEAT_SALE_WIDGET_POPUP_FOOTER_SETTINGS")):"";const s=r.Tag.render(w||(w=B`
			<div
				onclick="${0}"
				class="crm-rs__w-footer-button --feedback"
			>
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,I)[I].bind(this),r.Loc.getMessage("CRM_REPEAT_SALE_WIDGET_POPUP_FOOTER_FEEDBACK"));return r.Tag.render(C||(C=B`
			<div class="crm-rs__w-footer-row">
				${0}
				${0}
			</div>
		`),r.Type.isArrayFilled(babelHelpers.classPrivateFieldLooseBase(this,M)[M]())?s:"<div></div>",e)}}function K(){const e=babelHelpers.classPrivateFieldLooseBase(this,j)[j]();e.setElement("config");n.sendData(e.buildData());window.location.href="/crm/repeat-sale-segment/"}function W(){const e=babelHelpers.classPrivateFieldLooseBase(this,j)[j]();e.setElement("feedback");n.sendData(e.buildData());babelHelpers.classPrivateFieldLooseBase(this,D)[D]()}function U(){BX.UI.Feedback.Form.open({id:Math.random().toString(),forms:babelHelpers.classPrivateFieldLooseBase(this,M)[M]()})}function G(){return r.Extension.getSettings("crm.repeat-sale.widget").get("feedbackFormParams")}function k(){const e=babelHelpers.classPrivateFieldLooseBase(this,R)[R].type;const s=babelHelpers.classPrivateFieldLooseBase(this,R)[R].subSection;return i.Builder.RepeatSale.Banner.ClickEvent.createDefault(e,s)}let N=e=>e,x,X,Y,z,V,q,Q,J,Z;var ee=babelHelpers.classPrivateFieldLooseKey("isFlowStarted");var se=babelHelpers.classPrivateFieldLooseKey("showSettingsButton");var te=babelHelpers.classPrivateFieldLooseKey("hasClients");var ae=babelHelpers.classPrivateFieldLooseKey("canEnableFeature");var le=babelHelpers.classPrivateFieldLooseKey("flowExpectedEnableTimestamp");var ie=babelHelpers.classPrivateFieldLooseKey("getBodyContentWithClients");var re=babelHelpers.classPrivateFieldLooseKey("getBubble");var oe=babelHelpers.classPrivateFieldLooseKey("getFooterContent");var ne=babelHelpers.classPrivateFieldLooseKey("getTitle");var ce=babelHelpers.classPrivateFieldLooseKey("getBodyTitle");var de=babelHelpers.classPrivateFieldLooseKey("getButton");var be=babelHelpers.classPrivateFieldLooseKey("getDescription");var pe=babelHelpers.classPrivateFieldLooseKey("getDescriptionContent");var ve=babelHelpers.classPrivateFieldLooseKey("onButtonClick");var ue=babelHelpers.classPrivateFieldLooseKey("onReadMoreButtonClick");var Pe=babelHelpers.classPrivateFieldLooseKey("showReadMore");var he=babelHelpers.classPrivateFieldLooseKey("isHasClients");var _e=babelHelpers.classPrivateFieldLooseKey("getClickEventBuilder");var Te=babelHelpers.classPrivateFieldLooseKey("sendShowAnalytics");class Le extends F{constructor(e){var s;super(e);Object.defineProperty(this,Te,{value:Oe});Object.defineProperty(this,_e,{value:Re});Object.defineProperty(this,he,{value:me});Object.defineProperty(this,Pe,{value:Ce});Object.defineProperty(this,ue,{value:we});Object.defineProperty(this,ve,{value:Ae});Object.defineProperty(this,pe,{value:Be});Object.defineProperty(this,be,{value:He});Object.defineProperty(this,de,{value:ge});Object.defineProperty(this,ce,{value:Se});Object.defineProperty(this,ne,{value:fe});Object.defineProperty(this,oe,{value:Fe});Object.defineProperty(this,re,{value:ye});Object.defineProperty(this,ie,{value:Ee});Object.defineProperty(this,ee,{writable:true,value:null});Object.defineProperty(this,se,{writable:true,value:true});Object.defineProperty(this,te,{writable:true,value:false});Object.defineProperty(this,ae,{writable:true,value:false});Object.defineProperty(this,le,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,se)[se]=(s=e.showSettingsButton)!=null?s:true}getType(){return rt.forceStart}onClose(){super.onClose();void r.ajax.runAction("crm.repeatsale.widget.incrementShowedFlowStartCount");if(!babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]&&babelHelpers.classPrivateFieldLooseBase(this,le)[le]===null&&babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]){void r.ajax.runAction("crm.repeatsale.flow.saveExpectedEnableDate")}}getPopupContent(e=null){if(r.Type.isObject(e)){if(babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]===null){const{isFlowStarted:s,canEnableFeature:t,flowExpectedEnableTimestamp:a}=e;babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]=s;babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]=t!=null?t:false;babelHelpers.classPrivateFieldLooseBase(this,le)[le]=a!=null?a:null}babelHelpers.classPrivateFieldLooseBase(this,te)[te]=babelHelpers.classPrivateFieldLooseBase(this,he)[he](e)}return r.Tag.render(x||(x=N`
			<div>
				<header class="crm-rs__w-header">
					${0}
				</header>
				${0}
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,ne)[ne](),babelHelpers.classPrivateFieldLooseBase(this,ie)[ie](),babelHelpers.classPrivateFieldLooseBase(this,oe)[oe]())}getFetchUrl(){return"crm.repeatsale.start.getData"}getFetchParams(){return{}}onFirstShow(){const e=this.getAnalyticsType();const s=this.getAnalyticsSubSection();babelHelpers.classPrivateFieldLooseBase(this,Te)[Te](e,s)}getAnalyticsType(){return i.Dictionary.TYPE_REPEAT_SALE_BANNER_START_FORCE}}function Ee(){return r.Tag.render(X||(X=N`
			<div class="crm-rs__w-body">
				<div class="crm-rs__w-body-content">
					<div class="crm-rs__w-body-title">
						${0}
					</div>
					${0}
				</div>
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,ce)[ce](),babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]?babelHelpers.classPrivateFieldLooseBase(this,de)[de]():null,babelHelpers.classPrivateFieldLooseBase(this,re)[re]())}function ye(){const e=babelHelpers.classPrivateFieldLooseBase(this,te)[te];return r.Tag.render(Y||(Y=N`
			<div class="crm-rs__w-body-bubble ${0} ${0}">
				${0}
				<div class="crm-rs__w-body-icon"></div>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]?"--flow-started":"",e?"--has-clients":"",this.renderLottieAnimation())}function Fe(){return r.Tag.render(z||(z=N`
			<footer class="crm-rs__w-footer">
				${0}
			</footer>
		`),babelHelpers.classPrivateFieldLooseBase(this,be)[be]())}function fe(){if(babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]){return r.Tag.render(V||(V=N`
				<span>${0}</span>
			`),r.Loc.getMessage("CRM_REPEAT_SALE_WIDGET_START_FLOW_STARTED_POPUP_TITLE"))}return r.Loc.getMessage("CRM_REPEAT_SALE_WIDGET_START_POPUP_TITLE")}function Se(){if(babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]){return r.Tag.render(q||(q=N`
				<span>${0}</span>
			`),r.Loc.getMessage("CRM_REPEAT_SALE_WIDGET_START_POPUP_BODY_FLOW_STARTED_TITLE"))}return r.Loc.getMessage("CRM_REPEAT_SALE_WIDGET_START_POPUP_BODY_TITLE")}function ge(){if(babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]){return null}return r.Tag.render(Q||(Q=N`
			<div class="crm-rs__w-body-title-btn">
				<span
					onclick="${0}"
				>${0}</span>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].bind(this),r.Loc.getMessage("CRM_REPEAT_SALE_WIDGET_START_POPUP_BTN_FORCE"))}function He(){if(babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]){const e=new $(babelHelpers.classPrivateFieldLooseBase(this,se)[se],{type:this.getAnalyticsType(),subSection:this.getAnalyticsSubSection()});return r.Tag.render(J||(J=N`
				<div class="crm-rs__w-buttons-wrapper">
					${0}
				</div>
			`),e.getFooterContent())}const e=babelHelpers.classPrivateFieldLooseBase(this,te)[te];const s=babelHelpers.classPrivateFieldLooseBase(this,pe)[pe]();return r.Tag.render(Z||(Z=N`
			<div class="crm-rs__w-body-description ${0}">
				${0}
				<div class="crm-rs__w-body-description-text ${0}">
					<span>${0}</span>
				</div>
				<div class="crm-rs__w-body-description-btn">
					<span
						onclick="${0}"
					>${0}</span>
				</div>
			</div>
		`),e?"--has-clients":"",e?null:'<div class="crm-rs__w-body-description-border"></div>',e?"--has-clients":"",s,babelHelpers.classPrivateFieldLooseBase(this,ue)[ue].bind(this),r.Loc.getMessage("CRM_REPEAT_SALE_WIDGET_START_POPUP_BTN_READ_MORE"))}function Be(){let e=null;const s={};let t=false;let l=false;if(babelHelpers.classPrivateFieldLooseBase(this,le)[le]===null&&babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]){if(this.params.isRepeatSaleGrid){e="CRM_REPEAT_SALE_WIDGET_START_POPUP_DESC_WITHOUT_TIME_IN_RS_GRID"}else{e="CRM_REPEAT_SALE_WIDGET_START_POPUP_DESC_WITHOUT_TIME";t=true}t=true}else if(babelHelpers.classPrivateFieldLooseBase(this,le)[le]===null){e="CRM_REPEAT_SALE_WIDGET_START_POPUP_DESC_WITHOUT_TIME_AND_PERMISSIONS";l=true}else if(babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]){if(this.params.isRepeatSaleGrid){e="CRM_REPEAT_SALE_WIDGET_START_POPUP_DESC_WITHOUT_TIME_IN_RS_GRID"}else{e="CRM_REPEAT_SALE_WIDGET_START_POPUP_DESC_WITH_TIME_AND_PERMISSIONS";t=true}l=true}else{e="CRM_REPEAT_SALE_WIDGET_START_POPUP_DESC_WITH_TIME";l=true}if(t){s["[link]"]='<a class="ui-link" href="/crm/repeat-sale-segment/">';s["[/link]"]="</a>"}if(l){const e=a.DatetimeConverter.createFromServerTimestamp(babelHelpers.classPrivateFieldLooseBase(this,le)[le]).toUserTime();s["#DATE#"]=e.toDateString();s["#TIME#"]=e.toTimeString()}return r.Loc.getMessage(e,s)}function Ae(){r.ajax.runAction("crm.repeatsale.flow.enable").then((e=>{if(e.status==="success"){babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]=true;this.setPopupContent(this.getPopupContent());const e=babelHelpers.classPrivateFieldLooseBase(this,_e)[_e]();e.setElement("start_flow");n.sendData(e.buildData());return}this.showError();this.close()}),(e=>{this.showError();this.close()})).catch((e=>{this.showError();this.close()}))}function we(){const e=babelHelpers.classPrivateFieldLooseBase(this,_e)[_e]();e.setElement("info_button");n.sendData(e.buildData());babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]()}function Ce(){var e,s;(e=top.BX)==null?void 0:(s=e.Helper)==null?void 0:s.show("redirect=detail&code=25376986")}function me(e){return e.count>0}function Re(){const e=this.getAnalyticsType();const s=this.getAnalyticsSubSection();return i.Builder.RepeatSale.Banner.ClickEvent.createDefault(e,s)}function Oe(e,s){const t=i.Builder.RepeatSale.Banner.ViewEvent.createDefault(e,s);n.sendData(t.buildData())}let Ie=e=>e,De,Me,je,$e,Ke,We,Ue,Ge,ke,Ne;var xe=babelHelpers.classPrivateFieldLooseKey("isFlowStarted");var Xe=babelHelpers.classPrivateFieldLooseKey("showSettingsButton");var Ye=babelHelpers.classPrivateFieldLooseKey("hasClients");var ze=babelHelpers.classPrivateFieldLooseKey("getBodyContent");var Ve=babelHelpers.classPrivateFieldLooseKey("getBodyContentWithClients");var qe=babelHelpers.classPrivateFieldLooseKey("getBubble");var Qe=babelHelpers.classPrivateFieldLooseKey("getFooterContent");var Je=babelHelpers.classPrivateFieldLooseKey("getTitle");var Ze=babelHelpers.classPrivateFieldLooseKey("getBodyTitle");var es=babelHelpers.classPrivateFieldLooseKey("getButton");var ss=babelHelpers.classPrivateFieldLooseKey("getDescription");var ts=babelHelpers.classPrivateFieldLooseKey("onButtonClick");var as=babelHelpers.classPrivateFieldLooseKey("onReadMoreButtonClick");var ls=babelHelpers.classPrivateFieldLooseKey("showReadMore");var is=babelHelpers.classPrivateFieldLooseKey("isHasClients");var rs=babelHelpers.classPrivateFieldLooseKey("getClickEventBuilder");var os=babelHelpers.classPrivateFieldLooseKey("sendShowAnalytics");class ns extends F{constructor(e){var s;super(e);Object.defineProperty(this,os,{value:Fs});Object.defineProperty(this,rs,{value:ys});Object.defineProperty(this,is,{value:Es});Object.defineProperty(this,ls,{value:Ls});Object.defineProperty(this,as,{value:Ts});Object.defineProperty(this,ts,{value:_s});Object.defineProperty(this,ss,{value:hs});Object.defineProperty(this,es,{value:Ps});Object.defineProperty(this,Ze,{value:us});Object.defineProperty(this,Je,{value:vs});Object.defineProperty(this,Qe,{value:ps});Object.defineProperty(this,qe,{value:bs});Object.defineProperty(this,Ve,{value:ds});Object.defineProperty(this,ze,{value:cs});Object.defineProperty(this,xe,{writable:true,value:null});Object.defineProperty(this,Xe,{writable:true,value:true});Object.defineProperty(this,Ye,{writable:true,value:false});babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe]=(s=e.showSettingsButton)!=null?s:true}getType(){return rt.start}onClose(){super.onClose();void r.ajax.runAction("crm.repeatsale.widget.incrementShowedFlowStartCount")}getPopupContent(e=null){if(r.Type.isObject(e)){if(babelHelpers.classPrivateFieldLooseBase(this,xe)[xe]===null){const{isFlowStarted:s}=e;babelHelpers.classPrivateFieldLooseBase(this,xe)[xe]=s}babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]=babelHelpers.classPrivateFieldLooseBase(this,is)[is](e)}return r.Tag.render(De||(De=Ie`
			<div>
				<header class="crm-rs__w-header">
					${0}
				</header>
				${0}
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,Je)[Je](),babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]?babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve]():babelHelpers.classPrivateFieldLooseBase(this,ze)[ze](),babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]?babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe]():null)}getFetchUrl(){return"crm.repeatsale.start.getData"}getFetchParams(){return{}}onFirstShow(){const e=this.getAnalyticsType();const s=this.getAnalyticsSubSection();babelHelpers.classPrivateFieldLooseBase(this,os)[os](e,s)}getAnalyticsType(){return babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]?i.Dictionary.TYPE_REPEAT_SALE_BANNER_START_EMPTY:i.Dictionary.TYPE_REPEAT_SALE_BANNER_START}}function cs(){return r.Tag.render(Me||(Me=Ie`
			<div class="crm-rs__w-body">
				<div class="crm-rs__w-body-content">
					<div class="crm-rs__w-body-title">
						${0}
					</div>
					${0}
				</div>
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,Ze)[Ze](),babelHelpers.classPrivateFieldLooseBase(this,ss)[ss](),babelHelpers.classPrivateFieldLooseBase(this,qe)[qe]())}function ds(){return r.Tag.render(je||(je=Ie`
			<div class="crm-rs__w-body">
				<div class="crm-rs__w-body-content --has-clients">
					<div class="crm-rs__w-body-title">
						${0}
					</div>
					${0}
				</div>
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,Ze)[Ze](),babelHelpers.classPrivateFieldLooseBase(this,es)[es](),babelHelpers.classPrivateFieldLooseBase(this,qe)[qe]())}function bs(){const e=babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye];return r.Tag.render($e||($e=Ie`
			<div class="crm-rs__w-body-bubble ${0} ${0}">
				${0}
				<div class="crm-rs__w-body-icon"></div>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,xe)[xe]?"--flow-started":"",e?"--has-clients":"",this.renderLottieAnimation())}function ps(){return r.Tag.render(Ke||(Ke=Ie`
			<footer class="crm-rs__w-footer">
				${0}
			</footer>
		`),babelHelpers.classPrivateFieldLooseBase(this,ss)[ss]())}function vs(){if(babelHelpers.classPrivateFieldLooseBase(this,xe)[xe]){return r.Tag.render(We||(We=Ie`
				<span>${0}</span>
			`),r.Loc.getMessage("CRM_REPEAT_SALE_WIDGET_START_FLOW_STARTED_POPUP_TITLE"))}return r.Loc.getMessage("CRM_REPEAT_SALE_WIDGET_START_POPUP_TITLE")}function us(){if(babelHelpers.classPrivateFieldLooseBase(this,xe)[xe]){return r.Tag.render(Ue||(Ue=Ie`
				<span>${0}</span>
			`),r.Loc.getMessage("CRM_REPEAT_SALE_WIDGET_START_POPUP_BODY_FLOW_STARTED_TITLE"))}const e=babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]?"CRM_REPEAT_SALE_WIDGET_START_POPUP_BODY_TITLE_WITH_CLIENTS":"CRM_REPEAT_SALE_WIDGET_START_POPUP_BODY_TITLE_WITHOUT_CLIENTS";return r.Loc.getMessage(e)}function Ps(){if(babelHelpers.classPrivateFieldLooseBase(this,xe)[xe]){return null}return r.Tag.render(Ge||(Ge=Ie`
			<div class="crm-rs__w-body-title-btn --has-clients">
				<span
					onclick="${0}"
				>${0}</span>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,ts)[ts].bind(this),r.Loc.getMessage("CRM_REPEAT_SALE_WIDGET_START_POPUP_BTN"))}function hs(){if(babelHelpers.classPrivateFieldLooseBase(this,xe)[xe]){const e=new $(babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe],{type:this.getAnalyticsType(),subSection:this.getAnalyticsSubSection()});return r.Tag.render(ke||(ke=Ie`
				<div class="crm-rs__w-buttons-wrapper">
					${0}
				</div>
			`),e.getFooterContent())}const e=babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye];const s=e?"CRM_REPEAT_SALE_WIDGET_START_POPUP_DESC_WITH_CLIENTS":"CRM_REPEAT_SALE_WIDGET_START_POPUP_DESC_WITHOUT_CLIENTS";const t=r.Loc.getMessage(s);return r.Tag.render(Ne||(Ne=Ie`
			<div class="crm-rs__w-body-description ${0}">
				${0}
				<div class="crm-rs__w-body-description-text ${0}">
					${0}
				</div>
				<div class="crm-rs__w-body-description-btn">
					<span
						onclick="${0}"
					>${0}</span>
				</div>
			</div>
		`),e?"--has-clients":"",e?null:'<div class="crm-rs__w-body-description-border"></div>',e?"--has-clients":"",t,babelHelpers.classPrivateFieldLooseBase(this,as)[as].bind(this),r.Loc.getMessage("CRM_REPEAT_SALE_WIDGET_START_POPUP_BTN_READ_MORE"))}function _s(){if(babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]){r.ajax.runAction("crm.repeatsale.flow.enable").then((e=>{if(e.status==="success"){babelHelpers.classPrivateFieldLooseBase(this,xe)[xe]=true;this.setPopupContent(this.getPopupContent());const e=babelHelpers.classPrivateFieldLooseBase(this,rs)[rs]();e.setElement("start_flow");n.sendData(e.buildData());return}this.showError();this.close()}),(e=>{this.showError();this.close()})).catch((e=>{this.showError();this.close()}))}else{babelHelpers.classPrivateFieldLooseBase(this,ls)[ls]()}}function Ts(){const e=babelHelpers.classPrivateFieldLooseBase(this,rs)[rs]();e.setElement("info_button");n.sendData(e.buildData());babelHelpers.classPrivateFieldLooseBase(this,ls)[ls]()}function Ls(){var e,s;(e=top.BX)==null?void 0:(s=e.Helper)==null?void 0:s.show("redirect=detail&code=25376986")}function Es(e){return e.count>0}function ys(){const e=this.getAnalyticsType();const s=this.getAnalyticsSubSection();return i.Builder.RepeatSale.Banner.ClickEvent.createDefault(e,s)}function Fs(e,s){const t=i.Builder.RepeatSale.Banner.ViewEvent.createDefault(e,s);n.sendData(t.buildData())}let fs=e=>e,Ss,gs,Hs,Bs,As,ws,Cs;const ms=r.Reflection.namespace("BX.userOptions");var Rs=babelHelpers.classPrivateFieldLooseKey("periodType");var Os=babelHelpers.classPrivateFieldLooseKey("showSettingsButton");var Is=babelHelpers.classPrivateFieldLooseKey("hint");var Ds=babelHelpers.classPrivateFieldLooseKey("getLoadingPopupContent");var Ms=babelHelpers.classPrivateFieldLooseKey("renderLoadingLottieAnimation");var js=babelHelpers.classPrivateFieldLooseKey("getPopupTitle");var $s=babelHelpers.classPrivateFieldLooseKey("getSelectorTitle");var Ks=babelHelpers.classPrivateFieldLooseKey("getFooterContent");var Ws=babelHelpers.classPrivateFieldLooseKey("onPeriodChange");var Us=babelHelpers.classPrivateFieldLooseKey("savePeriodTypeId");var Gs=babelHelpers.classPrivateFieldLooseKey("showHint");var ks=babelHelpers.classPrivateFieldLooseKey("hideHint");var Ns=babelHelpers.classPrivateFieldLooseKey("getHintInstance");var xs=babelHelpers.classPrivateFieldLooseKey("getClickEventBuilder");class Xs extends F{constructor(e){var s,t;super(e);Object.defineProperty(this,xs,{value:at});Object.defineProperty(this,Ns,{value:tt});Object.defineProperty(this,ks,{value:st});Object.defineProperty(this,Gs,{value:et});Object.defineProperty(this,Us,{value:Zs});Object.defineProperty(this,Ws,{value:Js});Object.defineProperty(this,Ks,{value:Qs});Object.defineProperty(this,$s,{value:qs});Object.defineProperty(this,js,{value:Vs});Object.defineProperty(this,Ms,{value:zs});Object.defineProperty(this,Ds,{value:Ys});Object.defineProperty(this,Rs,{writable:true,value:it.day30});Object.defineProperty(this,Os,{writable:true,value:true});Object.defineProperty(this,Is,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,Os)[Os]=(s=e.showSettingsButton)!=null?s:true;babelHelpers.classPrivateFieldLooseBase(this,Rs)[Rs]=(t=e.periodTypeId)!=null?t:it.day30}getType(){return rt.statistics}getPopupWidth(){return 489}isAutoHidePopup(){return true}getPopupContent(e=null){var s,t,a,l;return r.Tag.render(Ss||(Ss=fs`
			<div>
				<header class="crm-rs__w-header --statistics">
					${0}
				</header>
				<div class="crm-rs__w-body">
					<div class="crm-rs__w-body-content --statistics">
						<div class="crm-rs__w-body-statistics-table-container">
							<table class="crm-rs__w-body-statistics-table">
								<thead>
									<tr>
										<th></th>
										<th>${0}</th>
										<th>${0}</th>
									</tr>
								</thead>
								<tbody class="crm-rs__w-body-statistics-table-body">
									<tr>
										<td><span>${0}</span></td>
										<td><span>${0}</span></td>
										<td><span>${0}</span></td>
									</tr>
									<tr>
										<td>${0}</td>
										<td>${0}</td>
										<td>${0}</td>
									</tr>
								</tbody>
								<tfoot class="crm-rs__w-body-statistics-table-footer">
									<tr>
										<td>
											<div>
												${0}
												<span 
													class="crm-rs__w-body-statistics-hint"
													onmouseenter="${0}"
													onmouseleave="${0}"
												></span>
											</div>
										</td>
										<td><span>${0}${0}</span></td>
										<td>${0}${0}</td>
									</tr>
								</tfoot>
							</table>
						</div>
					</div>
				</div>
				<footer class="crm-rs__w-footer --statistics">
					${0}
				</footer>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,js)[js](e),r.Loc.getMessage("CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_COUNT"),r.Loc.getMessage("CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_SUM"),r.Loc.getMessage("CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_DEALS_IN_WORK"),(s=e.repeatSaleProcessCount)!=null?s:0,(t=e.repeatSaleProcessSum)!=null?t:0,r.Loc.getMessage("CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_WIN_DEALS"),(a=e.repeatSaleWinCount)!=null?a:0,(l=e.repeatSaleWinSum)!=null?l:0,r.Loc.getMessage("CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_CONVERSION"),babelHelpers.classPrivateFieldLooseBase(this,Gs)[Gs].bind(this),babelHelpers.classPrivateFieldLooseBase(this,ks)[ks].bind(this),e.conversionByCount,e.conversionByCount>0?"%":"",e.conversionBySum,e.conversionBySum>0?"%":"",babelHelpers.classPrivateFieldLooseBase(this,Ks)[Ks]())}getAnalyticsType(){return i.Dictionary.TYPE_REPEAT_SALE_BANNER_STATISTICS}getFetchUrl(){return"crm.repeatsale.statistics.getData"}getFetchParams(){return{periodType:babelHelpers.classPrivateFieldLooseBase(this,Rs)[Rs]}}}function Ys(){return r.Tag.render(gs||(gs=fs`
			<div>
				<header class="crm-rs__w-header --statistics">
					${0}
				</header>
				<div class="crm-rs__w-body">
					<div class="crm-rs__w-body-loading-bubble">
						<div class="crm-rs__w-body-loading-bubble-wrapper">
							${0}
							${0}
						</div>
						<div class="crm-rs__w-body-bubble-subtitle">
							${0}
						</div>
					</div>
				</div>
				<footer class="crm-rs__w-footer --statistics">
					${0}
				</footer>
			</div>
		`),r.Loc.getMessage("CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_TITLE"),this.renderLottieAnimation(),babelHelpers.classPrivateFieldLooseBase(this,Ms)[Ms](),r.Loc.getMessage("CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_LOADING"),babelHelpers.classPrivateFieldLooseBase(this,Ks)[Ks]())}function zs(){const e=r.Tag.render(Hs||(Hs=fs`
			<div class="crm-rs__w-loading-lottie-container">
				<div ref="lottie" class="crm-rs__w-lottie"></div>
			</div>
		`));const s=c.Lottie.loadAnimation({path:"/bitrix/js/crm/repeat-sale/widget/lottie/loading.json",container:e.lottie,renderer:"svg",loop:true,autoplay:true});s.setSpeed(.75);return e.root}function Vs(e){var s,t,a;const l=r.Tag.render(Bs||(Bs=fs`
			<span>
				${0}
			</span>
		`),r.Loc.getMessagePlural("CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_TITLE_TOTAL_DEALS",(s=e.repeatSaleTotalCount)!=null?s:0,{"#COUNT#":(t=e.repeatSaleTotalCount)!=null?t:0}));const i=(a=e.repeatSaleTodayCount)!=null?a:0;let o=null;if(i>0){var n,c;o=r.Tag.render(As||(As=fs`
				<span>
					${0}
				</span>
			`),r.Loc.getMessagePlural("CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_TITLE_TODAY_DEALS",(n=e.repeatSaleTodayCount)!=null?n:0,{"#COUNT#":(c=e.repeatSaleTodayCount)!=null?c:0}))}else{const e=r.Loc.getMessage("CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_TITLE_TODAY_NO_DEALS");if(e){o=r.Tag.render(ws||(ws=fs`<span>${0}</span>`),e)}}return r.Tag.render(Cs||(Cs=fs`
			<div>
				${0}
				<div class="crm-rs__w-header-span-wrapper">
					${0}
					${0}
				</div>
			</div>
			<div 
				class="crm-rs__w-period-selector"
				onclick="${0}"
			>
				${0}
				<span class="crm-rs__w-period-selector-icon"></span>
			</div>
		`),r.Loc.getMessage("CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_TITLE"),l,o,babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws].bind(this,babelHelpers.classPrivateFieldLooseBase(this,Rs)[Rs]),babelHelpers.classPrivateFieldLooseBase(this,$s)[$s]())}function qs(){let e=null;const s=Number(babelHelpers.classPrivateFieldLooseBase(this,Rs)[Rs]);switch(s){case it.day30:e="CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_PERIOD_DAY_30";break;case it.quarter:e="CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_PERIOD_QUARTER";break;case it.halfYear:e="CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_PERIOD_HALF_YEAR";break;case it.year:e="CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_PERIOD_YEAR";break;default:throw new RangeError(`Unknown period type: ${s}`)}return r.Loc.getMessage(e)}function Qs(){const e=new $(babelHelpers.classPrivateFieldLooseBase(this,Os)[Os],{type:this.getAnalyticsType(),subSection:this.getAnalyticsSubSection()});return e.getFooterContent()}function Js(e){let s=it.day30;const t=Object.values(it);if(t.includes(e)){const a=t.indexOf(e);if(a+1<t.length){s=a+1}}babelHelpers.classPrivateFieldLooseBase(this,Us)[Us](s);const a={periodTypeId:s};const l=babelHelpers.classPrivateFieldLooseBase(this,xs)[xs]();l.setElement("change_period");l.setPeriod(s);n.sendData(l.buildData());r.ajax.runAction(this.getFetchUrl(),{data:a}).then((e=>{if(e.status==="success"){const t=o.PopupManager.getPopupById(`crm_repeat_sale_widget_${this.getType()}`);if(t===null){return}this.data=e.data;babelHelpers.classPrivateFieldLooseBase(this,Rs)[Rs]=s;t.setContent(this.getPopupContent(this.data));return}this.showError()}),(e=>{this.showError()})).catch((e=>{this.showError()}))}function Zs(e){ms.save("crm","repeat-sale","statistics-period-type-id",e)}function et(e){var s;if((s=babelHelpers.classPrivateFieldLooseBase(this,Ns)[Ns]().popup)!=null&&s.isShown()){return}babelHelpers.classPrivateFieldLooseBase(this,Ns)[Ns]().show(e.target,r.Loc.getMessage("CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_CONVERSION_HINT"),true)}function st(){var e;if((e=babelHelpers.classPrivateFieldLooseBase(this,Ns)[Ns]().popup)!=null&&e.isShown()){babelHelpers.classPrivateFieldLooseBase(this,Ns)[Ns]().hide()}}function tt(){if(babelHelpers.classPrivateFieldLooseBase(this,Is)[Is]===null){babelHelpers.classPrivateFieldLooseBase(this,Is)[Is]=BX.UI.Hint.createInstance({popupParameters:{autoHide:true,events:{onFirstShow:()=>{babelHelpers.classPrivateFieldLooseBase(this,Is)[Is].popup.setOffset({offsetLeft:9})}}}})}return babelHelpers.classPrivateFieldLooseBase(this,Is)[Is]}function at(){const e=this.getAnalyticsType();const s=this.getAnalyticsSubSection();return i.Builder.RepeatSale.Banner.ClickEvent.createDefault(e,s)}class lt{static getContentInstance(e,s={}){switch(e){case rt.start:return new ns(s);case rt.forceStart:return new Le(s);case rt.statistics:return new Xs(s);default:return null}}}const it=Object.freeze({day30:0,quarter:1,halfYear:2,year:3});const rt=Object.freeze({start:"start",forceStart:"forceStart",statistics:"statistics"});var ot=babelHelpers.classPrivateFieldLooseKey("contentPopupInstance");class nt{static execute(e,s=null,t={},a=null,l=null){if(!this.instance[e]){this.instance[e]=new nt(e,s,t)}if(this.instance[e].isShown()){this.instance[e].close()}else{var i;const s=(i=(a==null?void 0:a.altKey)&&(a==null?void 0:a.ctrlKey))!=null?i:false;this.instance[e].show(s,l)}}constructor(e,s=null,t={}){Object.defineProperty(this,ot,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,ot)[ot]=lt.getContentInstance(e,t);if(s){babelHelpers.classPrivateFieldLooseBase(this,ot)[ot].setBindElement(s)}}show(e=false,s=null){babelHelpers.classPrivateFieldLooseBase(this,ot)[ot].show(e,s)}isShown(){return babelHelpers.classPrivateFieldLooseBase(this,ot)[ot].isShown()}close(){babelHelpers.classPrivateFieldLooseBase(this,ot)[ot].close()}}nt.instance=[];e.PeriodType=it;e.WidgetType=rt;e.Widget=nt})(this.BX.Crm.RepeatSale=this.BX.Crm.RepeatSale||{},BX.UI,BX,BX.Crm.Timeline,BX.UI.Feedback,BX.Crm.Integration.Analytics,BX,BX.Main,BX.UI.Analytics,BX.UI);
//# sourceMappingURL=widget.bundle.map.js