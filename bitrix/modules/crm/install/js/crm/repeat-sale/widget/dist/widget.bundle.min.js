this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};(function(e,s,t,a,i,l,r,o,n){"use strict";let c=e=>e,d,b;var p=babelHelpers.classPrivateFieldLooseKey("data");var u=babelHelpers.classPrivateFieldLooseKey("popup");var v=babelHelpers.classPrivateFieldLooseKey("bindElement");var P=babelHelpers.classPrivateFieldLooseKey("isConfettiShowed");var h=babelHelpers.classPrivateFieldLooseKey("isPreparing");var _=babelHelpers.classPrivateFieldLooseKey("getBindElementData");var T=babelHelpers.classPrivateFieldLooseKey("getParentBindElement");var L=babelHelpers.classPrivateFieldLooseKey("sendAnalyticsCloseEvent");var E=babelHelpers.classPrivateFieldLooseKey("showConfetti");class y{constructor(e={}){Object.defineProperty(this,E,{value:S});Object.defineProperty(this,L,{value:f});Object.defineProperty(this,T,{value:F});Object.defineProperty(this,_,{value:g});Object.defineProperty(this,p,{writable:true,value:null});Object.defineProperty(this,u,{writable:true,value:null});Object.defineProperty(this,v,{writable:true,value:null});Object.defineProperty(this,P,{writable:true,value:true});Object.defineProperty(this,h,{writable:true,value:false});this.params={};this.params=e;if(l.Type.isBoolean(this.params.showConfetti)){babelHelpers.classPrivateFieldLooseBase(this,P)[P]=!this.params.showConfetti}}getType(){throw new Error("Must be implement in child class")}async show(e=false,s=null){const t=await this.getData();if(t===null){return}if(babelHelpers.classPrivateFieldLooseBase(this,u)[u]===null){babelHelpers.classPrivateFieldLooseBase(this,u)[u]=new r.Popup(this.getPopupParams(t,{forceShowConfetti:e,onCloseCallback:s}))}babelHelpers.classPrivateFieldLooseBase(this,u)[u].show();babelHelpers.classPrivateFieldLooseBase(this,u)[u].adjustPosition()}getPopupParams(e,s={}){return{id:`crm_repeat_sale_widget_${this.getType()}`,bindElement:babelHelpers.classPrivateFieldLooseBase(this,_)[_](),content:this.getPopupContent(e),cacheable:false,isScrollBlock:false,className:`crm-repeat-sale-widget-popup --${this.getType()}`,closeByEsc:true,closeIcon:true,padding:16,width:this.getPopupWidth(),maxHeight:500,overlay:null,autoHide:this.isAutoHidePopup(),events:{onclose:()=>{this.onClose();if(l.Type.isFunction(s==null?void 0:s.onCloseCallback)){s.onCloseCallback()}},onFirstShow:()=>{this.onFirstShow();if(babelHelpers.classPrivateFieldLooseBase(this,P)[P]&&(s==null?void 0:s.forceShowConfetti)!==true){return}setTimeout((()=>{babelHelpers.classPrivateFieldLooseBase(this,E)[E]();babelHelpers.classPrivateFieldLooseBase(this,P)[P]=true}),100)}}}}getPopupWidth(){return 469}isAutoHidePopup(){return false}onFirstShow(){}getPopupContent(e=null){throw new Error("Must be implement in child class")}setPopupContent(e){babelHelpers.classPrivateFieldLooseBase(this,u)[u].setContent(e)}onClose(){babelHelpers.classPrivateFieldLooseBase(this,L)[L]();if(this.params.showConfetti){void l.ajax.runAction("crm.repeatsale.widget.incrementShowedConfettiCount")}babelHelpers.classPrivateFieldLooseBase(this,u)[u]=null}getAnalyticsType(){return""}async getData(){babelHelpers.classPrivateFieldLooseBase(this,p)[p]=await this.fetchData();return babelHelpers.classPrivateFieldLooseBase(this,p)[p]}async fetchData(){if(babelHelpers.classPrivateFieldLooseBase(this,h)[h]){return Promise.resolve(null)}babelHelpers.classPrivateFieldLooseBase(this,h)[h]=true;return new Promise((e=>{l.ajax.runAction(this.getFetchUrl(),{data:this.getFetchParams()}).then((s=>{babelHelpers.classPrivateFieldLooseBase(this,h)[h]=false;if(s.status==="success"){e(s.data);return}this.showError()}),(()=>{babelHelpers.classPrivateFieldLooseBase(this,h)[h]=false;this.showError()})).catch((e=>{babelHelpers.classPrivateFieldLooseBase(this,h)[h]=false;this.showError();throw e}))}))}getFetchUrl(){throw new Error("Must be implement in child class")}getFetchParams(){return{}}showError(){const e="CRM_REPEAT_SALE_WIDGET_ERROR";t.UI.Notification.Center.notify({content:l.Loc.getMessage(e),autoHideDelay:6e3})}setBindElement(e){babelHelpers.classPrivateFieldLooseBase(this,v)[v]=e;return this}getAnalyticsSubSection(){var e;return(e=babelHelpers.classPrivateFieldLooseBase(this,T)[T]().dataset.subsection)!=null?e:null}isShown(){var e;return(e=babelHelpers.classPrivateFieldLooseBase(this,u)[u])==null?void 0:e.isShown()}close(){var e;(e=babelHelpers.classPrivateFieldLooseBase(this,u)[u])==null?void 0:e.close()}renderLottieAnimation(){const e=l.Tag.render(d||(d=c`
			<div class="crm-rs__w-lottie-container">
				<div ref="lottie" class="crm-rs__w-lottie"></div>
			</div>
		`));const s=n.Lottie.loadAnimation({path:"/bitrix/js/crm/repeat-sale/widget/lottie/animation.json",container:e.lottie,renderer:"svg",loop:true,autoplay:true});s.setSpeed(.75);return e.root}}function g(){const e=babelHelpers.classPrivateFieldLooseBase(this,T)[T]();const s=e.getBoundingClientRect();return{top:s.top+s.height+5+window.pageYOffset,left:s.right-e.clientWidth/2-this.getPopupWidth()/2+window.pageXOffset}}function F(){const e=Boolean(babelHelpers.classPrivateFieldLooseBase(this,v)[v].closest("button"));const s=Boolean(babelHelpers.classPrivateFieldLooseBase(this,v)[v].closest("a"));if(e){return babelHelpers.classPrivateFieldLooseBase(this,v)[v].closest("button")}if(s){return babelHelpers.classPrivateFieldLooseBase(this,v)[v].closest("a")}return babelHelpers.classPrivateFieldLooseBase(this,v)[v]}function f(){const e=this.getAnalyticsType();const s=this.getAnalyticsSubSection();o.sendData(i.Builder.RepeatSale.Banner.CloseEvent.createDefault(e,s).buildData())}function S(){var e;const t=(e=babelHelpers.classPrivateFieldLooseBase(this,u)[u])==null?void 0:e.getPopupContainer();if(!t){return}let a=null;if(t.getElementsByTagName("canvas").length===0){a=l.Tag.render(b||(b=c`<canvas></canvas>`));l.Dom.style(a,{position:"fixed",top:0,left:0,pointerEvents:"none",zIndex:"9",width:"100%",height:"100%"});l.Dom.append(a,babelHelpers.classPrivateFieldLooseBase(this,u)[u].getPopupContainer())}else{a=t.getElementsByTagName("canvas")[0]}const i=s.Confetti.create(a,{resize:true,useWorker:true});i({particleCount:400,origin:{y:1.2,x:0},spread:100})}let B=e=>e,H,w,A;var C=babelHelpers.classPrivateFieldLooseKey("showSettingsButton");var m=babelHelpers.classPrivateFieldLooseKey("analytics");var O=babelHelpers.classPrivateFieldLooseKey("onSettingsClick");var I=babelHelpers.classPrivateFieldLooseKey("onFeedbackClick");var R=babelHelpers.classPrivateFieldLooseKey("showFeedbackCrmForm");var D=babelHelpers.classPrivateFieldLooseKey("getFeedbackFormParams");var $=babelHelpers.classPrivateFieldLooseKey("getClickEventBuilder");class j{constructor(e=false,s={}){Object.defineProperty(this,$,{value:k});Object.defineProperty(this,D,{value:U});Object.defineProperty(this,R,{value:W});Object.defineProperty(this,I,{value:K});Object.defineProperty(this,O,{value:M});Object.defineProperty(this,C,{writable:true,value:false});Object.defineProperty(this,m,{writable:true,value:{}});babelHelpers.classPrivateFieldLooseBase(this,C)[C]=e;babelHelpers.classPrivateFieldLooseBase(this,m)[m]=s}getFooterContent(){const e=babelHelpers.classPrivateFieldLooseBase(this,C)[C]?l.Tag.render(H||(H=B`
			<div
				onclick="${0}"
			 	class="crm-rs__w-footer-button --settings"
			 >
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,O)[O].bind(this),l.Loc.getMessage("CRM_REPEAT_SALE_WIDGET_POPUP_FOOTER_SETTINGS")):"";const s=l.Tag.render(w||(w=B`
			<div
				onclick="${0}"
				class="crm-rs__w-footer-button --feedback"
			>
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,I)[I].bind(this),l.Loc.getMessage("CRM_REPEAT_SALE_WIDGET_POPUP_FOOTER_FEEDBACK"));return l.Tag.render(A||(A=B`
			<div class="crm-rs__w-footer-row">
				${0}
				${0}
			</div>
		`),l.Type.isArrayFilled(babelHelpers.classPrivateFieldLooseBase(this,D)[D]())?s:"<div></div>",e)}}function M(){const e=babelHelpers.classPrivateFieldLooseBase(this,$)[$]();e.setElement("config");o.sendData(e.buildData());window.location.href="/crm/repeat-sale-segment/"}function K(){const e=babelHelpers.classPrivateFieldLooseBase(this,$)[$]();e.setElement("feedback");o.sendData(e.buildData());babelHelpers.classPrivateFieldLooseBase(this,R)[R]()}function W(){BX.UI.Feedback.Form.open({id:Math.random().toString(),forms:babelHelpers.classPrivateFieldLooseBase(this,D)[D]()})}function U(){return l.Extension.getSettings("crm.repeat-sale.widget").get("feedbackFormParams")}function k(){const e=babelHelpers.classPrivateFieldLooseBase(this,m)[m].type;const s=babelHelpers.classPrivateFieldLooseBase(this,m)[m].subSection;return i.Builder.RepeatSale.Banner.ClickEvent.createDefault(e,s)}let G=e=>e,N,x,X,Y,z,V,q,Q,J,Z;var ee=babelHelpers.classPrivateFieldLooseKey("isFlowStarted");var se=babelHelpers.classPrivateFieldLooseKey("showSettingsButton");var te=babelHelpers.classPrivateFieldLooseKey("hasClients");var ae=babelHelpers.classPrivateFieldLooseKey("getBodyContent");var ie=babelHelpers.classPrivateFieldLooseKey("getBodyContentWithClients");var le=babelHelpers.classPrivateFieldLooseKey("getBubble");var re=babelHelpers.classPrivateFieldLooseKey("getFooterContent");var oe=babelHelpers.classPrivateFieldLooseKey("getTitle");var ne=babelHelpers.classPrivateFieldLooseKey("getBodyTitle");var ce=babelHelpers.classPrivateFieldLooseKey("getButton");var de=babelHelpers.classPrivateFieldLooseKey("getDescription");var be=babelHelpers.classPrivateFieldLooseKey("onButtonClick");var pe=babelHelpers.classPrivateFieldLooseKey("onReadMoreButtonClick");var ue=babelHelpers.classPrivateFieldLooseKey("showReadMore");var ve=babelHelpers.classPrivateFieldLooseKey("isHasClients");var Pe=babelHelpers.classPrivateFieldLooseKey("getClickEventBuilder");var he=babelHelpers.classPrivateFieldLooseKey("sendShowAnalytics");class _e extends y{constructor(e){var s;super(e);Object.defineProperty(this,he,{value:me});Object.defineProperty(this,Pe,{value:Ce});Object.defineProperty(this,ve,{value:Ae});Object.defineProperty(this,ue,{value:we});Object.defineProperty(this,pe,{value:He});Object.defineProperty(this,be,{value:Be});Object.defineProperty(this,de,{value:Se});Object.defineProperty(this,ce,{value:fe});Object.defineProperty(this,ne,{value:Fe});Object.defineProperty(this,oe,{value:ge});Object.defineProperty(this,re,{value:ye});Object.defineProperty(this,le,{value:Ee});Object.defineProperty(this,ie,{value:Le});Object.defineProperty(this,ae,{value:Te});Object.defineProperty(this,ee,{writable:true,value:null});Object.defineProperty(this,se,{writable:true,value:true});Object.defineProperty(this,te,{writable:true,value:false});babelHelpers.classPrivateFieldLooseBase(this,se)[se]=(s=e.showSettingsButton)!=null?s:true}getType(){return ps.start}onClose(){super.onClose();void l.ajax.runAction("crm.repeatsale.widget.incrementShowedFlowStartCount")}getPopupContent(e=null){if(l.Type.isObject(e)){if(babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]===null){const{isFlowStarted:s}=e;babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]=s}babelHelpers.classPrivateFieldLooseBase(this,te)[te]=babelHelpers.classPrivateFieldLooseBase(this,ve)[ve](e)}return l.Tag.render(N||(N=G`
			<div>
				<header class="crm-rs__w-header">
					${0}
				</header>
				${0}
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,oe)[oe](),babelHelpers.classPrivateFieldLooseBase(this,te)[te]?babelHelpers.classPrivateFieldLooseBase(this,ie)[ie]():babelHelpers.classPrivateFieldLooseBase(this,ae)[ae](),babelHelpers.classPrivateFieldLooseBase(this,te)[te]?babelHelpers.classPrivateFieldLooseBase(this,re)[re]():null)}getFetchUrl(){return"crm.repeatsale.statistics.getInitData"}getFetchParams(){return{}}onFirstShow(){const e=this.getAnalyticsType();const s=this.getAnalyticsSubSection();babelHelpers.classPrivateFieldLooseBase(this,he)[he](e,s)}getAnalyticsType(){return babelHelpers.classPrivateFieldLooseBase(this,te)[te]?i.Dictionary.TYPE_REPEAT_SALE_BANNER_START_EMPTY:i.Dictionary.TYPE_REPEAT_SALE_BANNER_START}}function Te(){return l.Tag.render(x||(x=G`
			<div class="crm-rs__w-body">
				<div class="crm-rs__w-body-content">
					<div class="crm-rs__w-body-title">
						${0}
					</div>
					${0}
				</div>
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,ne)[ne](),babelHelpers.classPrivateFieldLooseBase(this,de)[de](),babelHelpers.classPrivateFieldLooseBase(this,le)[le]())}function Le(){return l.Tag.render(X||(X=G`
			<div class="crm-rs__w-body">
				<div class="crm-rs__w-body-content --has-clients">
					<div class="crm-rs__w-body-title">
						${0}
					</div>
					${0}
				</div>
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,ne)[ne](),babelHelpers.classPrivateFieldLooseBase(this,ce)[ce](),babelHelpers.classPrivateFieldLooseBase(this,le)[le]())}function Ee(){const e=babelHelpers.classPrivateFieldLooseBase(this,te)[te];return l.Tag.render(Y||(Y=G`
			<div class="crm-rs__w-body-bubble ${0} ${0}">
				${0}
				<div class="crm-rs__w-body-icon"></div>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]?"--flow-started":"",e?"--has-clients":"",this.renderLottieAnimation())}function ye(){return l.Tag.render(z||(z=G`
			<footer class="crm-rs__w-footer">
				${0}
			</footer>
		`),babelHelpers.classPrivateFieldLooseBase(this,de)[de]())}function ge(){if(babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]){return l.Tag.render(V||(V=G`
				<span>${0}</span>
			`),l.Loc.getMessage("CRM_REPEAT_SALE_WIDGET_START_FLOW_STARTED_POPUP_TITLE"))}return l.Loc.getMessage("CRM_REPEAT_SALE_WIDGET_START_POPUP_TITLE")}function Fe(){if(babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]){return l.Tag.render(q||(q=G`
				<span>${0}</span>
			`),l.Loc.getMessage("CRM_REPEAT_SALE_WIDGET_START_POPUP_BODY_FLOW_STARTED_TITLE"))}const e=babelHelpers.classPrivateFieldLooseBase(this,te)[te]?"CRM_REPEAT_SALE_WIDGET_START_POPUP_BODY_TITLE_WITH_CLIENTS":"CRM_REPEAT_SALE_WIDGET_START_POPUP_BODY_TITLE_WITHOUT_CLIENTS";return l.Loc.getMessage(e)}function fe(){if(babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]){return null}return l.Tag.render(Q||(Q=G`
			<div class="crm-rs__w-body-title-btn --has-clients">
				<span
					onclick="${0}"
				>${0}</span>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,be)[be].bind(this),l.Loc.getMessage("CRM_REPEAT_SALE_WIDGET_START_POPUP_BTN"))}function Se(){if(babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]){const e=new j(babelHelpers.classPrivateFieldLooseBase(this,se)[se],{type:this.getAnalyticsType(),subSection:this.getAnalyticsSubSection()});return l.Tag.render(J||(J=G`
				<div class="crm-rs__w-buttons-wrapper">
					${0}
				</div>
			`),e.getFooterContent())}const e=babelHelpers.classPrivateFieldLooseBase(this,te)[te];const s=e?"CRM_REPEAT_SALE_WIDGET_START_POPUP_DESC_WITH_CLIENTS":"CRM_REPEAT_SALE_WIDGET_START_POPUP_DESC_WITHOUT_CLIENTS";const t=l.Loc.getMessage(s);return l.Tag.render(Z||(Z=G`
			<div class="crm-rs__w-body-description ${0}">
				${0}
				<div class="crm-rs__w-body-description-text ${0}">
					${0}
				</div>
				<div class="crm-rs__w-body-description-btn">
					<span
						onclick="${0}"
					>${0}</span>
				</div>
			</div>
		`),e?"--has-clients":"",e?null:'<div class="crm-rs__w-body-description-border"></div>',e?"--has-clients":"",t,babelHelpers.classPrivateFieldLooseBase(this,pe)[pe].bind(this),l.Loc.getMessage("CRM_REPEAT_SALE_WIDGET_START_POPUP_BTN_READ_MORE"))}function Be(){if(babelHelpers.classPrivateFieldLooseBase(this,te)[te]){l.ajax.runAction("crm.repeatsale.flow.enable").then((e=>{if(e.status==="success"){babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]=true;this.setPopupContent(this.getPopupContent());const e=babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]();e.setElement("start_flow");o.sendData(e.buildData());return}this.showError();this.close()}),(e=>{this.showError();this.close()})).catch((e=>{this.showError();this.close()}))}else{babelHelpers.classPrivateFieldLooseBase(this,ue)[ue]();void l.ajax.runAction("crm.repeatsale.widget.finalizeShowedFlowStart")}}function He(){const e=babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]();e.setElement("info_button");o.sendData(e.buildData());babelHelpers.classPrivateFieldLooseBase(this,ue)[ue]()}function we(){var e,s;(e=top.BX)==null?void 0:(s=e.Helper)==null?void 0:s.show("redirect=detail&code=25376986")}function Ae(e){return e.count>0}function Ce(){const e=this.getAnalyticsType();const s=this.getAnalyticsSubSection();return i.Builder.RepeatSale.Banner.ClickEvent.createDefault(e,s)}function me(e,s){const t=i.Builder.RepeatSale.Banner.ViewEvent.createDefault(e,s);o.sendData(t.buildData())}let Oe=e=>e,Ie,Re,De,$e,je,Me,Ke;var We=babelHelpers.classPrivateFieldLooseKey("periodType");var Ue=babelHelpers.classPrivateFieldLooseKey("showSettingsButton");var ke=babelHelpers.classPrivateFieldLooseKey("hint");var Ge=babelHelpers.classPrivateFieldLooseKey("getLoadingPopupContent");var Ne=babelHelpers.classPrivateFieldLooseKey("renderLoadingLottieAnimation");var xe=babelHelpers.classPrivateFieldLooseKey("getPopupTitle");var Xe=babelHelpers.classPrivateFieldLooseKey("getSelectorTitle");var Ye=babelHelpers.classPrivateFieldLooseKey("getFooterContent");var ze=babelHelpers.classPrivateFieldLooseKey("onPeriodChange");var Ve=babelHelpers.classPrivateFieldLooseKey("showHint");var qe=babelHelpers.classPrivateFieldLooseKey("hideHint");var Qe=babelHelpers.classPrivateFieldLooseKey("getHintInstance");var Je=babelHelpers.classPrivateFieldLooseKey("getClickEventBuilder");class Ze extends y{constructor(e){var s;super(e);Object.defineProperty(this,Je,{value:cs});Object.defineProperty(this,Qe,{value:ns});Object.defineProperty(this,qe,{value:os});Object.defineProperty(this,Ve,{value:rs});Object.defineProperty(this,ze,{value:ls});Object.defineProperty(this,Ye,{value:is});Object.defineProperty(this,Xe,{value:as});Object.defineProperty(this,xe,{value:ts});Object.defineProperty(this,Ne,{value:ss});Object.defineProperty(this,Ge,{value:es});Object.defineProperty(this,We,{writable:true,value:bs.day30});Object.defineProperty(this,Ue,{writable:true,value:true});Object.defineProperty(this,ke,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue]=(s=e.showSettingsButton)!=null?s:true}getType(){return ps.statistics}getPopupWidth(){return 489}isAutoHidePopup(){return true}getPopupContent(e=null){var s,t,a,i;return l.Tag.render(Ie||(Ie=Oe`
			<div>
				<header class="crm-rs__w-header --statistics">
					${0}
				</header>
				<div class="crm-rs__w-body">
					<div class="crm-rs__w-body-content --statistics">
						<div class="crm-rs__w-body-statistics-table-container">
							<table class="crm-rs__w-body-statistics-table">
								<thead>
									<tr>
										<th></th>
										<th>${0}</th>
										<th>${0}</th>
									</tr>
								</thead>
								<tbody class="crm-rs__w-body-statistics-table-body">
									<tr>
										<td><span>${0}</span></td>
										<td><span>${0}</span></td>
										<td><span>${0}</span></td>
									</tr>
									<tr>
										<td>${0}</td>
										<td>${0}</td>
										<td>${0}</td>
									</tr>
								</tbody>
								<tfoot class="crm-rs__w-body-statistics-table-footer">
									<tr>
										<td>
											<div>
												${0}
												<span 
													class="crm-rs__w-body-statistics-hint"
													onmouseenter="${0}"
													onmouseleave="${0}"
												></span>
											</div>
										</td>
										<td><span>${0}${0}</span></td>
										<td>${0}${0}</td>
									</tr>
								</tfoot>
							</table>
						</div>
					</div>
				</div>
				<footer class="crm-rs__w-footer --statistics">
					${0}
				</footer>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,xe)[xe](e),l.Loc.getMessage("CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_COUNT"),l.Loc.getMessage("CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_SUM"),l.Loc.getMessage("CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_DEALS_IN_WORK"),(s=e.repeatSaleProcessCount)!=null?s:0,(t=e.repeatSaleProcessSum)!=null?t:0,l.Loc.getMessage("CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_WIN_DEALS"),(a=e.repeatSaleWinCount)!=null?a:0,(i=e.repeatSaleWinSum)!=null?i:0,l.Loc.getMessage("CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_CONVERSION"),babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve].bind(this),babelHelpers.classPrivateFieldLooseBase(this,qe)[qe].bind(this),e.conversionByCount,e.conversionByCount>0?"%":"",e.conversionBySum,e.conversionBySum>0?"%":"",babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]())}getAnalyticsType(){return i.Dictionary.TYPE_REPEAT_SALE_BANNER_STATISTICS}getFetchUrl(){return"crm.repeatsale.statistics.getData"}getFetchParams(){return{periodType:babelHelpers.classPrivateFieldLooseBase(this,We)[We]}}}function es(){return l.Tag.render(Re||(Re=Oe`
			<div>
				<header class="crm-rs__w-header --statistics">
					${0}
				</header>
				<div class="crm-rs__w-body">
					<div class="crm-rs__w-body-loading-bubble">
						<div class="crm-rs__w-body-loading-bubble-wrapper">
							${0}
							${0}
						</div>
						<div class="crm-rs__w-body-bubble-subtitle">
							${0}
						</div>
					</div>
				</div>
				<footer class="crm-rs__w-footer --statistics">
					${0}
				</footer>
			</div>
		`),l.Loc.getMessage("CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_TITLE"),this.renderLottieAnimation(),babelHelpers.classPrivateFieldLooseBase(this,Ne)[Ne](),l.Loc.getMessage("CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_LOADING"),babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]())}function ss(){const e=l.Tag.render(De||(De=Oe`
			<div class="crm-rs__w-loading-lottie-container">
				<div ref="lottie" class="crm-rs__w-lottie"></div>
			</div>
		`));const s=n.Lottie.loadAnimation({path:"/bitrix/js/crm/repeat-sale/widget/lottie/loading.json",container:e.lottie,renderer:"svg",loop:true,autoplay:true});s.setSpeed(.75);return e.root}function ts(e){var s,t,a;const i=l.Tag.render($e||($e=Oe`
			<span>
				${0}
			</span>
		`),l.Loc.getMessagePlural("CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_TITLE_TOTAL_DEALS",(s=e.repeatSaleTotalCount)!=null?s:0,{"#COUNT#":(t=e.repeatSaleTotalCount)!=null?t:0}));const r=(a=e.repeatSaleTodayCount)!=null?a:0;let o=null;if(r>0){var n,c;o=l.Tag.render(je||(je=Oe`
				<span>
					${0}
				</span>
			`),l.Loc.getMessagePlural("CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_TITLE_TODAY_DEALS",(n=e.repeatSaleTodayCount)!=null?n:0,{"#COUNT#":(c=e.repeatSaleTodayCount)!=null?c:0}))}else{const e=l.Loc.getMessage("CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_TITLE_TODAY_NO_DEALS");if(e){o=l.Tag.render(Me||(Me=Oe`<span>${0}</span>`),e)}}return l.Tag.render(Ke||(Ke=Oe`
			<div>
				${0}
				<div class="crm-rs__w-header-span-wrapper">
					${0}
					${0}
				</div>
			</div>
			<div 
				class="crm-rs__w-period-selector"
				onclick="${0}"
			>
				${0}
				<span class="crm-rs__w-period-selector-icon"></span>
			</div>
		`),l.Loc.getMessage("CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_TITLE"),i,o,babelHelpers.classPrivateFieldLooseBase(this,ze)[ze].bind(this,babelHelpers.classPrivateFieldLooseBase(this,We)[We]),babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe]())}function as(){let e=null;switch(babelHelpers.classPrivateFieldLooseBase(this,We)[We]){case bs.day30:e="CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_PERIOD_DAY_30";break;case bs.quarter:e="CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_PERIOD_QUARTER";break;case bs.halfYear:e="CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_PERIOD_HALF_YEAR";break;case bs.year:e="CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_PERIOD_YEAR";break;default:throw new RangeError("unknown period type")}return l.Loc.getMessage(e)}function is(){const e=new j(babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue],{type:this.getAnalyticsType(),subSection:this.getAnalyticsSubSection()});return e.getFooterContent()}function ls(e){let s=bs.day30;const t=Object.values(bs);if(t.includes(e)){const a=t.indexOf(e);if(a+1<t.length){s=a+1}}const a={periodTypeId:s};const i=babelHelpers.classPrivateFieldLooseBase(this,Je)[Je]();i.setElement("change_period");i.setPeriod(s);o.sendData(i.buildData());l.ajax.runAction(this.getFetchUrl(),{data:a}).then((e=>{if(e.status==="success"){const t=r.PopupManager.getPopupById(`crm_repeat_sale_widget_${this.getType()}`);if(t===null){return}this.data=e.data;babelHelpers.classPrivateFieldLooseBase(this,We)[We]=s;t.setContent(this.getPopupContent(this.data));return}this.showError()}),(e=>{this.showError()})).catch((e=>{this.showError()}))}function rs(e){var s;if((s=babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe]().popup)!=null&&s.isShown()){return}babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe]().show(e.target,l.Loc.getMessage("CRM_REPEAT_SALE_WIDGET_STATISTICS_POPUP_CONVERSION_HINT"),true)}function os(){var e;if((e=babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe]().popup)!=null&&e.isShown()){babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe]().hide()}}function ns(){if(babelHelpers.classPrivateFieldLooseBase(this,ke)[ke]===null){babelHelpers.classPrivateFieldLooseBase(this,ke)[ke]=BX.UI.Hint.createInstance({popupParameters:{autoHide:true,events:{onFirstShow:()=>{babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].popup.setOffset({offsetLeft:9})}}}})}return babelHelpers.classPrivateFieldLooseBase(this,ke)[ke]}function cs(){const e=this.getAnalyticsType();const s=this.getAnalyticsSubSection();return i.Builder.RepeatSale.Banner.ClickEvent.createDefault(e,s)}class ds{static getContentInstance(e,s={}){switch(e){case ps.start:return new _e(s);case ps.statistics:return new Ze(s);default:return null}}}const bs=Object.freeze({day30:0,quarter:1,halfYear:2,year:3});const ps=Object.freeze({start:"start",statistics:"statistics"});var us=babelHelpers.classPrivateFieldLooseKey("contentPopupInstance");class vs{static execute(e,s=null,t={},a=null,i=null){if(!this.instance[e]){this.instance[e]=new vs(e,s,t)}if(this.instance[e].isShown()){this.instance[e].close()}else{var l;const s=(l=(a==null?void 0:a.altKey)&&(a==null?void 0:a.ctrlKey))!=null?l:false;this.instance[e].show(s,i)}}constructor(e,s=null,t={}){Object.defineProperty(this,us,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,us)[us]=ds.getContentInstance(e,t);if(s){babelHelpers.classPrivateFieldLooseBase(this,us)[us].setBindElement(s)}}show(e=false,s=null){babelHelpers.classPrivateFieldLooseBase(this,us)[us].show(e,s)}isShown(){return babelHelpers.classPrivateFieldLooseBase(this,us)[us].isShown()}close(){babelHelpers.classPrivateFieldLooseBase(this,us)[us].close()}}vs.instance=[];e.PeriodType=bs;e.WidgetType=ps;e.Widget=vs})(this.BX.Crm.RepeatSale=this.BX.Crm.RepeatSale||{},BX.UI,BX,BX.UI.Feedback,BX.Crm.Integration.Analytics,BX,BX.Main,BX.UI.Analytics,BX.UI);
//# sourceMappingURL=widget.bundle.map.js