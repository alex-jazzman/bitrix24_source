this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};(function(t,e,i,s,a,n,l,r,o,c,d,p,u,v,h,_){"use strict";const g={itemClick:"crm:copilot:call-assessment:breadcrumb-item-click"};const T={props:{activeTabId:{type:String}},data(){return{tabs:this.getTabsData()}},methods:{itemTitleClassList(t,e){return["crm-copilot__call-assessment_breadcrumbs-item-title",{"--active":t===this.activeTabId},{"--soon":e}]},getTab(t){return this.getTabsData().find((e=>e.id===t))},getTabsData(){return[{id:"about",title:_.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_ABOUT")},{id:"client",title:_.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT")},{id:"settings",title:_.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS")},{id:"control",title:_.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CONTROL")}]},emitClickEvent(t){const e=this.getTab(t);if(!e.soon){this.$Bitrix.eventEmitter.emit(g.itemClick,{itemId:t})}}},computed:{soonTitle(){return _.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_BREADCRUMBS_SOON")}},template:`\n\t\t<div class="crm-copilot__call-assessment_breadcrumbs-wrapper">\n\t\t\t<div\n\t\t\t\tv-for="(tab, index) in tabs"\n\t\t\t\t@click="emitClickEvent(tab.id)"\n\t\t\t\tclass="crm-copilot__call-assessment_breadcrumbs-item"\n\t\t\t>\n\t\t\t\t<span v-if="tab.soon" class="crm-copilot__call-assessment_breadcrumbs-soon">\n\t\t\t\t\t{{ soonTitle }}\n\t\t\t\t</span>\n\t\t\t\t<span :class="itemTitleClassList(tab.id, tab.soon)">\n\t\t\t\t\t{{ tab.title }}\n\t\t\t\t</span>\n\t\t\t\t<span \n\t\t\t\t\tv-if="index+1 < tabs.length"\n\t\t\t\t\tclass="crm-copilot__call-assessment_breadcrumbs-divider"\n\t\t\t\t></span>\n\t\t\t</div>\n\t\t</div>\n\t`};const b={click:"crm:copilot:call-assessment:navigation-button-click"};const m={props:{id:{type:String,required:true},isEnabled:{type:Boolean,default:true}},mounted(){this.initButton()},watch:{isEnabled(t){this.button.setState(t?s.ButtonState.ACTIVE:s.ButtonState.DISABLED)}},methods:{initButton(){this.button=new s.Button({text:_.Loc.getMessage(`CRM_COPILOT_CALL_ASSESSMENT_NAVIGATION_BUTTON_${this.id.toUpperCase()}`),color:this.buttonColor,round:true,size:BX.UI.Button.Size.LARGE,onclick:()=>{this.emitClickEvent()}});if(this.isEnabled!==true){this.button.setState(s.ButtonState.DISABLED)}this.button.setDataSet({id:`crm-copilot-call-assessment-buttons-${this.id.toLowerCase()}`});if(this.$refs.button){this.button.renderTo(this.$refs.button)}},emitClickEvent(){if(this.isEnabled){this.$Bitrix.eventEmitter.emit(b.click,{id:this.id})}}},computed:{buttonColor(){if(this.id==="continue"||this.id==="submit"||this.id==="close"){return s.Button.Color.SUCCESS}if(this.id==="update"){return s.Button.Color.LIGHT_BORDER}return s.Button.Color.LIGHT}},template:`\n\t\t<div ref="button" class="crm-copilot-call-assessment-button"></div>\n\t`};const y="23240682";const L={components:{Button:m},props:{activeTabId:{type:String},isEnabled:{type:Boolean},readOnly:{type:Boolean,default:false},showSaveButton:{type:Boolean,default:false}},data(){return{firstPage:"about",lastPage:"control"}},computed:{help(){return _.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_NAVIGATION_HELP")},buttons(){return["cancel","back","continue","submit","close","update"]}},methods:{showArticle(){var t,e;(t=window.top.BX)==null?void 0:(e=t.Helper)==null?void 0:e.show(`redirect=detail&code=${y}`)}},template:`\n\t\t<div class="crm-copilot__call-assessment_navigation-container">\n\t\t\t<div class="crm-copilot__call-assessment_navigation-buttons-wrapper">\n\t\t\t\t<Button v-if="activeTabId !== lastPage" id="continue" :is-enabled="isEnabled" />\n\t\t\t\t<Button v-if="activeTabId === lastPage && !readOnly" id="submit" />\n\t\t\t\t<Button v-if="activeTabId === lastPage && readOnly" id="close" />\n\t\t\t\t<Button v-if="activeTabId === firstPage" id="cancel" />\n\t\t\t\t<Button v-if="activeTabId !== firstPage" id="back" />\n\t\t\t</div>\n\t\t\t<div v-if="showSaveButton && activeTabId !== lastPage">\n\t\t\t\t<Button id="update" :is-enabled="isEnabled" />\n\t\t\t</div>\n\t\t\t<div v-else class="crm-copilot__call-assessment_article" @click="showArticle">\n\t\t\t\t<span class="ui-icon-set --help"></span>\n\t\t\t\t{{ help }}\n\t\t\t</div>\n\t\t</div>\n\t`};const E={components:{TextEditorComponent:n.TextEditorComponent},emits:["change"],props:{textEditor:n.TextEditor},data(){return{textEditorEvents:{onChange:this.emitChangeData}}},mounted(){this.setTextEditorHeight();this.windowResizeHandler=this.windowResizeHandler.bind(this);_.Event.bind(window,"resize",this.windowResizeHandler)},unmounted(){_.Event.unbind(window,"resize",this.windowResizeHandler)},methods:{emitChangeData(){if(!_.Type.isFunction(this.onChangeDebounce)){this.onChangeDebounce=_.Runtime.debounce(this.onChange,100,this)}this.onChangeDebounce()},onChange(){this.$emit("change",{prompt:this.textEditor.getText()})},windowResizeHandler(){this.setTextEditorHeight()},setTextEditorHeight(){var t,e,i;const s=this.$el.parentNode.offsetTop;const a=".crm-copilot__call-assessment_navigation-container";const n=(t=(e=document.querySelector(a))==null?void 0:e.offsetTop)!=null?t:0;const l=20;const r=n-s-l;const o=Math.round(r*.5);const c=Math.round(r*.8);if(o<200){var d;(d=this.textEditor)==null?void 0:d.setMinHeight(c)}else{var p;(p=this.textEditor)==null?void 0:p.setMinHeight(o)}(i=this.textEditor)==null?void 0:i.setMaxHeight(c)}},template:`\n\t\t<TextEditorComponent \n\t\t\t:events="textEditorEvents"\n\t\t\t:editor-instance="textEditor"\n\t\t/>\n\t`};const S={MIN:100,MAX:5e3};var C=babelHelpers.classPrivateFieldLooseKey("errorMessage");class P{constructor(){Object.defineProperty(this,C,{writable:true,value:null})}validate(t){if(t.length<S.MIN){babelHelpers.classPrivateFieldLooseBase(this,C)[C]=_.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_ABOUT_PROMPT_LENGTH_MIN_ERROR",{"#MIN_VALUE#":S.MIN});return false}if(t.length>S.MAX){babelHelpers.classPrivateFieldLooseBase(this,C)[C]=_.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_ABOUT_PROMPT_LENGTH_MAX_ERROR",{"#MAX_VALUE#":S.MAX});return false}babelHelpers.classPrivateFieldLooseBase(this,C)[C]=null;return true}getError(){return babelHelpers.classPrivateFieldLooseBase(this,C)[C]}}const I={methods:{showLimitCopilotOffSlider(){var t,e;(t=top.BX.UI)==null?void 0:(e=t.InfoHelper)==null?void 0:e.show("limit_v2_crm_copilot_call_assessment_off")}},computed:{message(){return _.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_AI_DISABLED")}},template:`\n\t\t<div class="crm-copilot__call-assessment-ai-disabled">\n\t\t\t<span v-html="message"></span>\n\t\t\t<span\n\t\t\t\t@click="showLimitCopilotOffSlider"\n\t\t\t\tclass="ui-icon-set --help"\n\t\t\t></span>\n\t\t</div>\n\t`};const A={components:{Breadcrumbs:T,AiDisabledInSettings:I},props:{readOnly:{type:Boolean,default:false},isEnabled:{type:Boolean,default:true},isActive:{type:Boolean},data:{type:Object,default:{}},settings:{type:Object,default:{}}},data(){return{id:null}},methods:{getId(){return this.id},getData(){return{}},isReadyToMoveOn(){return this.validate()},validate(){return true},onValidationFailed(){r.UI.Notification.Center.notify({content:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_VALIDATION_ERROR"),autoHideDelay:3e3})},emitChangeData(){if(!_.Type.isFunction(this.onChangeDebounce)){this.onChangeDebounce=_.Runtime.debounce(this.onChange,100,this)}this.onChangeDebounce()},onChange(){this.$emit("onChange",{id:this.id,data:this.getData()})},getBodyFieldClassList(t=[]){return["crm-copilot__call-assessment_page-section-body-field",...t,{"--read-only":this.isEnabled!==true}]}}};const O={extends:A,components:{TextEditorComponent:n.TextEditorComponent,TextEditorWrapperComponent:E},props:{textEditor:n.TextEditor},data(){return{id:"about",parser:new a.BBCodeParser,promptLengthValidator:new P,promptLengthError:null}},methods:{getData(){return{prompt:this.textEditor.getText()}},isReadyToMoveOn(){return _.Type.isStringFilled(this.textEditor.getText())},validate(){return this.promptLengthValidator.validate(this.getPlainPromptText())},onValidationFailed(){this.promptLengthError=this.promptLengthValidator.getError()},onChange(){this.promptLengthError=null;A.methods.onChange.call(this)},getPlainPromptText(){return this.parser.parse(this.textEditor.getText()).toPlainText().trim()}},computed:{pageTitle(){return _.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_ABOUT_TITLE")},pageDescription(){return _.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_ABOUT_DESCRIPTION")}},template:`\n\t\t<div v-if="isActive">\n\t\t\t<div class="crm-copilot__call-assessment_page-section">\n\t\t\t\t<Breadcrumbs :active-tab-id="id" />\n\t\t\t\t<header class="crm-copilot__call-assessment_page-section-header">\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-header-title">\n\t\t\t\t\t\t{{ pageTitle }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-header-description">\n\t\t\t\t\t\t{{ pageDescription }}\n\t\t\t\t\t</div>\n\t\t\t\t</header>\n\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body">\n\t\t\t\t\t<AiDisabledInSettings v-if="!isEnabled" />\n\t\t\t\t\t<div :class="this.getBodyFieldClassList()">\n\t\t\t\t\t\t<TextEditorWrapperComponent\n\t\t\t\t\t\t\t:textEditor="textEditor"\n\t\t\t\t\t\t\t@change="onChange"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div v-if="promptLengthError" class="crm-copilot__call-assessment_page-section-body-field-error">\n\t\t\t\t\t\t\t{{ promptLengthError }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const f=Object.freeze({new:1,inWork:2,return:3,repeated:4});const B={extends:A,data(){var t;return{id:"client",activeClientTypeIds:(t=this.data.activeClientTypeIds)!=null?t:[]}},methods:{getData(){return{clientTypeIds:[...this.activeClientTypeIds]}},getClientTypeClassList(t){const e=this.clientTypes.find((e=>e.id===t));return["crm-copilot__call-assessment_page-section-body-field-client-type",`--client-${e.id}`,{"--active":this.activeClientTypeIds.includes(t)},{"--readonly":this.readOnly}]},onClientTypeSelect(t){if(this.readOnly){return}if(this.activeClientTypeIds.includes(t)){const e=this.activeClientTypeIds.indexOf(t);this.activeClientTypeIds.splice(e,1)}else{this.activeClientTypeIds.push(t)}this.emitChangeData()},onCheckboxClick(){return!this.readOnly},validate(){return _.Type.isArrayFilled(this.activeClientTypeIds)}},computed:{pageTitle(){return _.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT_TITLE")},pageDescription(){return _.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT_DESCRIPTION")},clientTypes(){return[{id:f.new,title:_.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT_TYPE_NEW_TITLE"),description:_.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT_TYPE_NEW_DESCRIPTION")},{id:f.inWork,title:_.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT_TYPE_IN_WORK_TITLE"),description:_.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT_TYPE_IN_WORK_DESCRIPTION")},{id:f.return,title:_.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT_TYPE_RETURN_CUSTOMER_TITLE"),description:_.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT_TYPE_RETURN_CUSTOMER_DESCRIPTION")},{id:f.repeated,title:_.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT_TYPE_REPEATED_APPROACH_TITLE"),description:_.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CLIENT_TYPE_REPEATED_APPROACH_DESCRIPTION")}]}},template:`\n\t\t<div v-if="isActive">\n\t\t\t<div class="crm-copilot__call-assessment_page-section">\n\t\t\t\t<Breadcrumbs :active-tab-id="id" />\n\t\t\t\t<header class="crm-copilot__call-assessment_page-section-header">\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-header-title">\n\t\t\t\t\t\t{{ pageTitle }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-header-description">\n\t\t\t\t\t\t{{ pageDescription }}\n\t\t\t\t\t</div>\n\t\t\t\t</header>\n\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body">\n\t\t\t\t\t<AiDisabledInSettings v-if="!isEnabled" />\n\t\t\t\t\t<div :class="this.getBodyFieldClassList()">\n\t\t\t\t\t\t<div v-for="(clientType, index) in clientTypes">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t:class=getClientTypeClassList(clientType.id)\n\t\t\t\t\t\t\t\t@click="onClientTypeSelect(clientType.id)"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-client-type-avatar">\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-client-type-info">\n\t\t\t\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-client-type-title">\n\t\t\t\t\t\t\t\t\t\t{{ clientType.title }}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-client-type-description">\n\t\t\t\t\t\t\t\t\t\t{{ clientType.description }}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t:class="(readOnly ? 'readonly' : '')"\n\t\t\t\t\t\t\t\t\t:onclick="onCheckboxClick"\n\t\t\t\t\t\t\t\t\ttype="checkbox"\n\t\t\t\t\t\t\t\t\tv-model="activeClientTypeIds"\n\t\t\t\t\t\t\t\t\t:value="clientType.id"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<hr\n\t\t\t\t\t\t\t\tv-if="index + 1 < clientTypes.length"\n\t\t\t\t\t\t\t\tclass="crm-copilot__call-assessment_page-section-body-field-client-type-divider"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};var M=babelHelpers.classPrivateFieldLooseKey("errorMessage");class D{constructor(){Object.defineProperty(this,M,{writable:true,value:null})}validate(t,e){if(e<t){babelHelpers.classPrivateFieldLooseBase(this,M)[M]=_.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CONTROL_VALIDATION_ERROR");return false}babelHelpers.classPrivateFieldLooseBase(this,M)[M]=null;return true}getError(){return babelHelpers.classPrivateFieldLooseBase(this,M)[M]}}const R=10;const N={emits:["change"],props:{value:{type:Number,required:true},additionalClass:{type:String}},data(){return{currentValue:this.value}},methods:{onInlineValueKeyDown(t){const{key:e,code:i,ctrlKey:s,metaKey:a}=t;if(a||s){const e=["KeyA","KeyZ","KeyC","KeyV","KeyR","KeyX"];if(!e.includes(i)){t.preventDefault();return false}return true}const n=["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Backspace","Delete"];if(n.includes(i)){return true}if(e===" "||Number.isNaN(Number(e))){t.preventDefault();return false}return true},onInlineValueChange(t){const e=Number(this.$refs.input.innerText);this.executeValueChange(e);this.$nextTick((()=>{const t=document.createRange();const e=window.getSelection();t.selectNodeContents(this.$refs.input);t.collapse(false);e.removeAllRanges();e.addRange(t);this.$refs.input.focus()}))},onInlineValueBlur(){const t=this.$refs.input.innerText.replaceAll(/\D/g,"");if(t===""){this.executeValueChange(0)}},changeValue(t){let e=t==="plus"?this.value+R:this.value-R;if(e%R>0){e=Math.ceil(e/R)*10}this.executeValueChange(e)},executeValueChange(t,e=null){this.currentValue=t;this.$refs.input.innerText=t===0?0:this.$refs.input.innerText.replace(/^0+/,"");_.Runtime.debounce((()=>{this.$emit("change",this.currentValue)}),300,this)()}},computed:{title(){return _.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PILL_TITLE")},classList(){return["crm-copilot__call-assessment-pill",this.additionalClass]},minusButtonClassList(){return["crm-copilot__call-assessment-pill-minus",{"--disabled":this.currentValue<=0}]},plusButtonClassList(){return["crm-copilot__call-assessment-pill-plus",{"--disabled":this.currentValue>=100}]}},watch:{currentValue(t){if(t<=0){this.currentValue=0}if(t>=100){this.currentValue=100}if(Number.isNaN(t)){this.currentValue=0}this.$refs.input.innerText=this.currentValue}},template:`\n\t\t<div :class="classList">\n\t\t\t<div class="crm-copilot__call-assessment-pill-title" v-html="title">\n\t\t\t</div>\n\t\t\t<div class="crm-copilot__call-assessment-pill-control">\n\t\t\t\t<div\n\t\t\t\t\t:class="minusButtonClassList"\n\t\t\t\t\t@click="changeValue('minus')"\n\t\t\t\t\tref="minus"\n\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t\t<div class="crm-copilot__call-assessment-pill-value-container">\n\t\t\t\t\t<div \n\t\t\t\t\t\tclass="crm-copilot__call-assessment-pill-value"\n\t\t\t\t\t\tcontenteditable="true"\n\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t@keydown="onInlineValueKeyDown"\n\t\t\t\t\t\t@input="onInlineValueChange"\n\t\t\t\t\t\t@blur="onInlineValueBlur"\n\t\t\t\t\t\tref="input"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ currentValue }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="crm-copilot__call-assessment-pill-percent">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\t:class="plusButtonClassList"\n\t\t\t\t\t@click="changeValue('plus')"\n\t\t\t\t\tref="plus"\n\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const w={props:{articleCode:{type:String,required:true}},methods:{onClick(){var t,e;(t=window.top.BX)==null?void 0:(e=t.Helper)==null?void 0:e.show(`redirect=detail&code=${this.articleCode}`)}},template:`\n\t\t<span class="crm-copilot__call-assessment-help-link" ref="container" @click="onClick">\n\t\t\t${_.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_HELP")}\n\t\t</span>\n\t`};const x={components:{HelpLink:w},props:{id:{type:String,required:true},content:{type:String,required:true},dialogTargetId:{type:String,required:false,default:null},articleCode:{type:String,required:true},value:{type:Number},items:{type:Array},tabs:{type:Array},selectedItems:{type:Array}},data(){var t,e;return{status:(t=this.isChecked)!=null?t:false,currentValue:(e=this.value)!=null?e:null}},mounted(){this.initDialog()},updated(){this.initDialog()},watch:{currentValue(t){this.emitSelectItem(t)}},methods:{initDialog(){var t,e,i;if(this.dialogTargetId===null){return}const s=document.getElementById(this.dialogTargetId);this.clientSelectorDialog=new o.Dialog({targetNode:s,context:`CRM_COPILOT_CALL_ASSESSMENT_DIALOG_${this.id}`,multiple:false,dropdownMode:true,showAvatars:false,enableSearch:false,width:450,zIndex:2500,items:(t=this.items)!=null?t:[],tabs:(e=this.tabs)!=null?e:[],selectedItems:(i=this.selectedItems)!=null?i:[],events:{"Item:onSelect":t=>{const{item:{id:e}}=t.getData();this.currentValue=e}}});_.Event.bind(s,"click",(()=>{this.clientSelectorDialog.show()}))},emitSelectItem(t){this.$emit("onSelectItem",t)}},template:`\n\t\t<div>\n\t\t\t<span\n\t\t\t\tclass="crm-copilot__call-assessment_call_count"\n\t\t\t\tv-html="content"\n\t\t\t></span>\n\t\t\t<HelpLink :articleCode="articleCode" />\n\t\t</div>\n\t`};const F={extends:A,components:{TextWithDialog:x,Pill:N},data(){return{id:"control",lowBorder:this.data.lowBorder,highBorder:this.data.highBorder,validator:new D}},methods:{getData(){return{lowBorder:this.lowBorder,highBorder:this.highBorder}},setLowBorder(t){this.lowBorder=t},setHighBorder(t){this.highBorder=t},validate(){return this.validator.validate(this.lowBorder,this.highBorder)},onValidationFailed(){r.UI.Notification.Center.notify({content:this.validator.getError(),autoHideDelay:3e3})}},computed:{pageTitle(){return _.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CONTROL_TITLE")},pageDescription(){return _.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_CONTROL_DESCRIPTION")}},template:`\n\t\t<div v-if="isActive">\n\t\t\t<div class="crm-copilot__call-assessment_page-section">\n\t\t\t\t<Breadcrumbs :active-tab-id="id"/>\n\t\t\t\t<header class="crm-copilot__call-assessment_page-section-header">\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-header-title">\n\t\t\t\t\t\t{{ pageTitle }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-header-description">\n\t\t\t\t\t\t{{ pageDescription }}\n\t\t\t\t\t</div>\n\t\t\t\t</header>\n\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body">\n\t\t\t\t\t<AiDisabledInSettings v-if="!isEnabled" />\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-container">\n\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-title --low-icon">\n\t\t\t\t\t\t\t{{ this.$Bitrix.Loc.getMessage('CRM_COPILOT_CALL_ASSESSMENT_PAGE_CONTROL_LOW_BORDER_TITLE') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-content">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass="crm-copilot__call-assessment_page-section-body-field-subtitle"\n\t\t\t\t\t\t\t\tv-html="this.$Bitrix.Loc.getMessage('CRM_COPILOT_CALL_ASSESSMENT_PAGE_CONTROL_LOW_BORDER_DESCRIPTION')"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<Pill\n\t\t\t\t\t\t\t\tadditionalClass="--low"\n\t\t\t\t\t\t\t\t:value="lowBorder"\n\t\t\t\t\t\t\t\t@change="setLowBorder"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-additional">\n\t\t\t\t\t\t\t\t{{ this.$Bitrix.Loc.getMessage('CRM_COPILOT_CALL_ASSESSMENT_PAGE_CONTROL_LOW_BORDER_ADDITIONAL') }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-container">\n\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-title --high-icon">\n\t\t\t\t\t\t\t{{ this.$Bitrix.Loc.getMessage('CRM_COPILOT_CALL_ASSESSMENT_PAGE_CONTROL_HIGH_BORDER_TITLE') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-content">\n\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\tclass="crm-copilot__call-assessment_page-section-body-field-subtitle"\n\t\t\t\t\t\t\t\tv-html="this.$Bitrix.Loc.getMessage('CRM_COPILOT_CALL_ASSESSMENT_PAGE_CONTROL_HIGH_BORDER_DESCRIPTION')"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<Pill\n\t\t\t\t\t\t\t\tadditionalClass="--high"\n\t\t\t\t\t\t\t\t:value="highBorder"\n\t\t\t\t\t\t\t\t@change="setHighBorder"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-additional">\n\t\t\t\t\t\t\t\t{{ this.$Bitrix.Loc.getMessage('CRM_COPILOT_CALL_ASSESSMENT_PAGE_CONTROL_HIGH_BORDER_ADDITIONAL') }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const H={props:{action:{type:String,required:true},index:{type:Number,required:true}},computed:{classList(){return{"crm-copilot__call-assessment-availability-selector-button":true,"--add":this.action==="add","--remove":this.action!=="add"}}},methods:{onClick(){const{action:t,index:e}=this;this.$emit("button-click",{index:e,action:t})}},template:`\n\t\t<div :class="classList" @click="onClick"></div>\n\t`};const k={props:{isExpanded:{type:Boolean,default:false}},computed:{classList(){return{"crm-copilot__call-assessment-availability-selector-chevron":true,"--expanded":this.isExpanded}}},template:`\n\t\t<div :class="classList"></div>\n\t`};const $={components:{Chevron:k},props:{startPoint:{type:String,required:true},endPoint:{type:String,required:true},modelValue:{type:Object,default:{}}},emits:["update:modelValue"],data(){return{currentStartPoint:this.startPoint,currentEndPoint:this.endPoint,isExpanded:false}},created(){this.datePicker=new h.DatePicker({rangeStartInput:this.$refs.start,rangeEndInput:this.$refs.end,selectionMode:"range",defaultTime:"08:00",dateFormat:u.DatetimeConverter.getSiteDateTimeFormat(true),timeFormat:u.DatetimeConverter.getSiteShortTimeFormat(),selectedDates:[this.currentStartPoint,this.currentEndPoint],enableTime:true,events:{onSelectChange:t=>{const e=t.getTarget().getSelectedDates().map((e=>t.getTarget().formatDate(e,u.DatetimeConverter.getSiteDateTimeFormat(true))));if(e[0]){this.currentStartPoint=e[0]}if(e[1]){this.currentEndPoint=e[1]}this.$emit("update:modelValue",{startPoint:this.currentStartPoint,endPoint:this.currentEndPoint})},onShow:()=>{this.isExpanded=true},onHide:()=>{this.isExpanded=false}}})},mounted(){this.datePicker.setTargetNode(this.$refs.wrapper);this.datePicker.selectRange(this.currentStartPoint,this.currentEndPoint)},beforeUnmount(){this.datePicker.destroy()},methods:{showPicker(t){t.preventDefault();t.stopPropagation();this.datePicker.show()}},template:`\n\t\t<div\n\t\t\tclass="crm-copilot__call-assessment-availability-selector-row"\n\t\t\tref="wrapper"\n\t\t>\n\t\t\t<div class="crm-copilot__call-assessment-availability-selector-row-wrapper">\n\t\t\t\t<input\n\t\t\t\t\ttype="text"\n\t\t\t\t\tref="start"\n\t\t\t\t\tclass="crm-copilot__call-assessment-availability-selector-input"\n\t\t\t\t\tautocomplete="off"\n\t\t\t\t\treadonly="readonly"\n\t\t\t\t\t@click="showPicker"\n\t\t\t\t\t:value="currentStartPoint"\n\t\t\t\t>\n\t\t\t\t<Chevron \n\t\t\t\t\t:isExpanded="isExpanded"\n\t\t\t\t\t@click="showPicker"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class="crm-copilot__call-assessment-availability-selector-delimiter"></div>\n\t\t\t<div class="crm-copilot__call-assessment-availability-selector-row-wrapper">\n\t\t\t\t<input\n\t\t\t\t\ttype="text"\n\t\t\t\t\tref="end"\n\t\t\t\t\tclass="crm-copilot__call-assessment-availability-selector-input"\n\t\t\t\t\tautocomplete="off"\n\t\t\t\t\treadonly="readonly"\n\t\t\t\t\t@click="showPicker"\n\t\t\t\t\t:value="currentEndPoint"\n\t\t\t\t>\n\t\t\t\t<Chevron \n\t\t\t\t\t:isExpanded="isExpanded"\n\t\t\t\t\t@click="showPicker"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`};const G=Object.freeze({monday:"monday",tuesday:"tuesday",wednesday:"wednesday",thursday:"thursday",friday:"friday",saturday:"saturday",sunday:"sunday",working:"working",weekends:"weekends"});var V=babelHelpers.classPrivateFieldLooseKey("errorMessage");class K{constructor(){Object.defineProperty(this,V,{writable:true,value:null})}validate(t,e){const i=t=>{const[,e]=t.split(" ");const[i,s]=e.split(":").map(Number);return new Date(9999,11,31,i,s)};const s=i(t);const a=i(e);if(Number.isNaN(s)||Number.isNaN(a)){babelHelpers.classPrivateFieldLooseBase(this,V)[V]=_.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_VALIDATION_TIME_ERROR_1");return false}if(s.getTime()>=a.getTime()){babelHelpers.classPrivateFieldLooseBase(this,V)[V]=_.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_VALIDATION_TIME_ERROR_2");return false}babelHelpers.classPrivateFieldLooseBase(this,V)[V]=null;return true}getError(){return babelHelpers.classPrivateFieldLooseBase(this,V)[V]}}const U={components:{Chevron:k},props:{weekdayType:{type:String,required:true},startPoint:{type:String,required:true},endPoint:{type:String,required:true},modelValue:{type:Object,default:{}}},emits:["update:modelValue"],data(){var t;return{currentWeekdayType:(t=this.weekdayType)!=null?t:G.working,currentStartPoint:this.startPoint,currentEndPoint:this.endPoint,isExpandedStartPoint:false,isExpandedEndPoint:false,timePeriodValidator:new K}},created(){this.datePicker=new h.DatePicker({type:"time",dateFormat:u.DatetimeConverter.getSiteDateTimeFormat(true),timeFormat:u.DatetimeConverter.getSiteShortTimeFormat(),minuteStep:5,events:{onSelectChange:t=>{const e=t.getTarget().getInputField().parentNode;if(!_.Type.isDomNode(e)){return}const i=t.getTarget().getSelectedDates().map((e=>t.getTarget().formatDate(e,u.DatetimeConverter.getSiteDateTimeFormat(true))));if(!i[0]){return}if((e==null?void 0:e.getAttribute("id"))==="start-point-selector"){this.currentStartPoint=i[0]}else if((e==null?void 0:e.getAttribute("id"))==="end-point-selector"){this.currentEndPoint=i[0]}const s=this.timePeriodValidator.validate(this.currentStartPoint,this.currentEndPoint);if(s){_.Dom.removeClass(this.$refs.start,"--invalid");_.Dom.removeClass(this.$refs.end,"--invalid")}else{_.Dom.addClass(this.$refs.start,"--invalid");_.Dom.addClass(this.$refs.end,"--invalid")}this.$emit("update:modelValue",{weekdayType:this.currentWeekdayType,startPoint:this.currentStartPoint,endPoint:this.currentEndPoint})},onHide:()=>{this.isExpandedStartPoint=false;this.isExpandedEndPoint=false}}})},beforeUnmount(){this.datePicker.destroy()},computed:{weekdayTypeList(){return[{value:G.monday,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PERIOD_SELECTOR_PERIOD_MONDAY")},{value:G.tuesday,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PERIOD_SELECTOR_PERIOD_TUESDAY")},{value:G.wednesday,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PERIOD_SELECTOR_PERIOD_WEDNESDAY")},{value:G.thursday,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PERIOD_SELECTOR_PERIOD_THURSDAY")},{value:G.friday,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PERIOD_SELECTOR_PERIOD_FRIDAY")},{value:G.saturday,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PERIOD_SELECTOR_PERIOD_SATURDAY")},{value:G.sunday,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PERIOD_SELECTOR_PERIOD_SUNDAY")},{value:G.working,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PERIOD_SELECTOR_PERIOD_WORKING_DAYS")},{value:G.weekends,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PERIOD_SELECTOR_PERIOD_WEEKENDS")}]},startTimeString(){return this.currentStartPoint.split(" ")[1]},endTimeString(){return this.currentEndPoint.split(" ")[1]}},watch:{currentWeekdayType(t){this.currentWeekdayType=t;this.$emit("update:modelValue",{weekdayType:this.currentWeekdayType,startPoint:this.currentStartPoint,endPoint:this.currentEndPoint})}},methods:{showPicker(t){t.preventDefault();t.stopPropagation();const e=t.target.parentNode;if(!_.Type.isDomNode(e)){return}this.datePicker.setTargetNode(e);if((e==null?void 0:e.getAttribute("id"))==="start-point-selector"){this.datePicker.setInputField(this.$refs.start);this.datePicker.selectDate(this.currentStartPoint);this.isExpandedStartPoint=true}else if((e==null?void 0:e.getAttribute("id"))==="end-point-selector"){this.datePicker.setInputField(this.$refs.end);this.datePicker.selectDate(this.currentEndPoint);this.isExpandedEndPoint=true}this.datePicker.show()}},template:`\n\t\t<div class="crm-copilot__call-assessment-availability-selector-row">\n\t\t\t<div \n\t\t\t\tclass="crm-copilot__call-assessment-availability-selector-row-wrapper"\n\t\t\t\tstyle="padding-right: 15px;"\n\t\t\t>\n\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-after-icon ui-ctl-dropdown">\n\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t<select\n\t\t\t\t\t\tclass="ui-ctl-element crm-copilot__call-assessment-availability-selector-input  --weekday-type"\n\t\t\t\t\t\tv-model="currentWeekdayType"\n\t\t\t\t\t\t:value="currentWeekdayType"\n\t\t\t\t\t>\n\t\t\t\t\t\t<option\n\t\t\t\t\t\t\tv-for="typeItem in weekdayTypeList"\n\t\t\t\t\t\t\t:value="typeItem.value"\n\t\t\t\t\t\t\t:disabled="currentWeekdayType === typeItem.value"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{typeItem.title}}\n\t\t\t\t\t\t</option>\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div \n\t\t\t\tid="start-point-selector"\n\t\t\t\tclass="crm-copilot__call-assessment-availability-selector-row-wrapper"\n\t\t\t>\n\t\t\t\t<input \n\t\t\t\t\ttype="text"\n\t\t\t\t\tref="start"\n\t\t\t\t\tclass="crm-copilot__call-assessment-availability-selector-input --time"\n\t\t\t\t\tautocomplete="off"\n\t\t\t\t\treadonly="readonly"\n\t\t\t\t\t@click="showPicker"\n\t\t\t\t\t:value="startTimeString"\n\t\t\t\t>\n\t\t\t\t<Chevron\n\t\t\t\t\t:isExpanded="isExpandedStartPoint"\n\t\t\t\t\t@click="showPicker"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class="crm-copilot__call-assessment-availability-selector-delimiter"></div>\n\t\t\t<div\n\t\t\t\tid="end-point-selector"\n\t\t\t\tclass="crm-copilot__call-assessment-availability-selector-row-wrapper"\n\t\t\t>\n\t\t\t\t<input\n\t\t\t\t\ttype="text"\n\t\t\t\t\tref="end"\n\t\t\t\t\tclass="crm-copilot__call-assessment-availability-selector-input --time"\n\t\t\t\t\tautocomplete="off"\n\t\t\t\t\treadonly="readonly"\n\t\t\t\t\t@click="showPicker"\n\t\t\t\t\t:value="endTimeString"\n\t\t\t\t>\n\t\t\t\t<Chevron\n\t\t\t\t\t:isExpanded="isExpandedEndPoint"\n\t\t\t\t\t@click="showPicker"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`};const j=Object.freeze({always_active:"always_active",inactive:"inactive",period:"period",custom:"custom"});const X={components:{Button:H,PeriodRow:$,CustomRow:U},props:{availabilityType:{type:String,required:true},readOnly:{type:Boolean}},data(){return{currentAvailabilityType:this.availabilityType,availabilityTypeData:{}}},beforeCreate(){this.availabilityTypeList=j;this.dateTimeFormat=u.DatetimeConverter.getSiteDateTimeFormat(true)},computed:{typeList(){return[{value:j.always_active,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_AVAILABILITY_SELECTOR_ALWAYS_ACTIVE")},{value:j.period,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_AVAILABILITY_SELECTOR_PERIOD")},{value:j.custom,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_AVAILABILITY_SELECTOR_CUSTOM")},{value:j.inactive,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_AVAILABILITY_SELECTOR_INACTIVE")}]},hasRows(){return _.Type.isArrayFilled(this.availabilityTypeData[this.currentAvailabilityType])},rowsForCurrentType(){var t;return(t=this.availabilityTypeData[this.currentAvailabilityType])!=null?t:[]},isExtendedAvailabilityType(){return this.currentAvailabilityType!==j.always_active&&this.currentAvailabilityType!==j.inactive}},watch:{currentAvailabilityType(t){this.$emit("type-change",{availabilityType:t})}},methods:{onActionButtonClick({action:t,index:e}){if(this.currentAvailabilityType===j.always_active||this.currentAvailabilityType===j.inactive){return}if(t==="add"){const t=this.currentAvailabilityType===j.period?this.getDefaultDatePeriodItem():this.getDefaultCustomItem();this.rowsForCurrentType.push(t)}else{this.rowsForCurrentType.splice(e,1)}},onUpdateCustomRow(t){this.$emit("data-change",{availabilityType:this.currentAvailabilityType,availabilityTypeData:this.getAvailabilityData(),updatedRow:t})},getDefaultDatePeriodItem(){const t=this.getRoundedToNearestMinuteDate(new Date,15);const e=this.getRoundedToNearestMinuteDate(new Date,15);e.setDate(e.getDate()+7);return{startPoint:p.DateTimeFormat.format(this.dateTimeFormat,t),endPoint:p.DateTimeFormat.format(this.dateTimeFormat,e)}},getDefaultCustomItem(){const t=Math.round((new Date).setHours(8,0,0,0)/1e3);const e=Math.round((new Date).setHours(18,0,0,0)/1e3);return{weekdayType:G.working,startPoint:p.DateTimeFormat.format(this.dateTimeFormat,t),endPoint:p.DateTimeFormat.format(this.dateTimeFormat,e)}},getRoundedToNearestMinuteDate(t,e){const i=t.getTime();const s=e*60*1e3;const a=Math.round(i/s)*s;return new Date(a)},getAvailabilityData(){var t;return(t=this.availabilityTypeData[this.currentAvailabilityType])!=null?t:[]},setAvailabilityData(t){if(_.Type.isArrayFilled(t)){this.availabilityTypeData[this.currentAvailabilityType]=t;if(this.currentAvailabilityType===this.availabilityTypeList.period){this.availabilityTypeData[this.availabilityTypeList.custom]=[this.getDefaultCustomItem()]}else if(this.currentAvailabilityType===this.availabilityTypeList.custom){this.availabilityTypeData[this.availabilityTypeList.period]=[this.getDefaultDatePeriodItem()]}return}this.availabilityTypeData={[this.availabilityTypeList.period]:[this.getDefaultDatePeriodItem()],[this.availabilityTypeList.custom]:[this.getDefaultCustomItem()]}}},template:`\n\t\t<div class="crm-copilot__call-assessment-availability-selector">\n\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-after-icon ui-ctl-dropdown">\n\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t<select\n\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\tv-model="currentAvailabilityType"\n\t\t\t\t\t:value="currentAvailabilityType"\n\t\t\t\t>\n\t\t\t\t\t<option\n\t\t\t\t\t\tv-for="typeItem in typeList"\n\t\t\t\t\t\t:value="typeItem.value"\n\t\t\t\t\t\t:disabled="readOnly && currentAvailabilityType !== typeItem.value"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{typeItem.title}}\n\t\t\t\t\t</option>\n\t\t\t\t</select>\n\t\t\t</div>\n\t\t\t<div \n\t\t\t\tclass="crm-copilot__call-assessment-availability-rows"\n\t\t\t\tv-if="isExtendedAvailabilityType"\n\t\t\t>\n\t\t\t\t<div\n\t\t\t\t\tclass="crm-copilot__call-assessment-availability-row"\n\t\t\t\t\tv-if="currentAvailabilityType === availabilityTypeList.period"\n\t\t\t\t\tv-for="(row, index) in rowsForCurrentType"\n\t\t\t\t>\n\t\t\t\t\t<PeriodRow\n\t\t\t\t\t\t:start-point="row.startPoint"\n\t\t\t\t\t\t:end-point="row.endPoint"\n\t\t\t\t\t\tv-model="availabilityTypeData[availabilityTypeList.period][index]"\n\t\t\t\t\t/>\n\t\t\t\t\t<Button\n\t\t\t\t\t\t:action="(index < rowsForCurrentType.length - 1 ? 'remove' : 'add')"\n\t\t\t\t\t\t:index="index"\n\t\t\t\t\t\t@button-click="onActionButtonClick"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tclass="crm-copilot__call-assessment-availability-row"\n\t\t\t\t\tv-if="currentAvailabilityType === availabilityTypeList.custom"\n\t\t\t\t\tv-for="(row, index) in rowsForCurrentType"\n\t\t\t\t>\n\t\t\t\t\t<CustomRow\n\t\t\t\t\t\t:weekday-type="row.weekdayType"\n\t\t\t\t\t\t:start-point="row.startPoint"\n\t\t\t\t\t\t:end-point="row.endPoint"\n\t\t\t\t\t\tv-model="availabilityTypeData[availabilityTypeList.custom][index]"\n\t\t\t\t\t\tv-on:update:modelValue="onUpdateCustomRow"\n\t\t\t\t\t/>\n\t\t\t\t\t<Button\n\t\t\t\t\t\t:action="(index < rowsForCurrentType.length - 1 ? 'remove' : 'add')"\n\t\t\t\t\t\t:index="index"\n\t\t\t\t\t\t@button-click="onActionButtonClick"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const Y={extends:A,components:{TypeSelector:X},data(){var t,e,i,s;let a=0;if((t=this.settings.baas)!=null&&t.hasPackage){var n;a=(n=this.data.autoCheckTypeId)!=null?n:1}return{id:"settings",callTypeId:(e=this.data.callTypeId)!=null?e:1,autoCheckTypeId:a,availabilityType:(i=this.data.availabilityType)!=null?i:j.always_active,availabilityData:(s=this.data.availabilityData)!=null?s:[],timePeriodValidator:new K,timePeriodError:null}},methods:{getData(){var t,e;return{callTypeId:this.callTypeId,autoCheckTypeId:this.autoCheckTypeId,availabilityType:this.availabilityType,availabilityData:(t=(e=this.$refs.typeSelector)==null?void 0:e.getAvailabilityData())!=null?t:[]}},onAutoCheckTypeIdChange(t){if(this.isBaasHasPackage){return}const{value:e}=t.target;if(e!==0){if(this.packageEmptySliderCode){c.InfoHelper.show(this.packageEmptySliderCode)}void this.$nextTick((()=>{this.autoCheckTypeId=0}))}},onAvailabilityTypeChange(t){this.availabilityType=t.availabilityType;this.timePeriodError=null},onAvailabilityDataChange(t){this.validate();this.onValidationFailed()},validate(){if(this.availabilityType===j.custom){var t,e;const i=(t=(e=this.$refs.typeSelector)==null?void 0:e.getAvailabilityData())!=null?t:[];const s=i.filter((t=>!this.timePeriodValidator.validate(t.startPoint,t.endPoint)));return s.length===0}return true},onValidationFailed(){this.timePeriodError=this.timePeriodValidator.getError()}},mounted(){var t;(t=this.$refs.typeSelector)==null?void 0:t.setAvailabilityData(this.availabilityData)},computed:{pageTitle(){return this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_TITLE")},pageDescription(){return this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_DESCRIPTION")},pageSectionSettingsCallType(){return this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CALL_TYPE")},pageSectionSettingsCallTypeDescription(){return this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CALL_TYPE_DESCRIPTION")},pageSectionSettingsCheck(){return this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CHECK")},pageSectionSettingsCheckDescription(){return this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CHECK_DESCRIPTION")},callTypes(){return[{id:1,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CALL_TYPE_ALL")},{id:2,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CALL_TYPE_INCOMING")},{id:3,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CALL_TYPE_OUTGOING")}]},checkTypes(){return[{value:1,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CHECK_FIRST_INCOMING")},{value:2,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CHECK_ALL_INCOMING")},{value:3,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CHECK_ALL_OUTGOING")},{value:4,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CHECK_ALL")},{value:0,title:this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_CHECK_DISABLED")}]},isBaasAvailable(){var t,e;return(t=(e=this.settings.baas)==null?void 0:e.isAvailable)!=null?t:false},isBaasHasPackage(){var t,e;return(t=(e=this.settings.baas)==null?void 0:e.hasPackage)!=null?t:false},packageEmptySliderCode(){var t,e;return(t=(e=this.settings.baas)==null?void 0:e.aiPackagesEmptySliderCode)!=null?t:null},pageSectionSettingsAvailability(){return this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_AVAILABILITY")},pageSectionSettingsAvailabilityDescription(){return this.$Bitrix.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PAGE_SETTINGS_AVAILABILITY_DESCRIPTION")},isCallAssessmentAvailabilityEnabled(){return _.Extension.getSettings("crm.copilot.call-assessment").get("callAssessmentAvailabilityEnabled")}},template:`\n\t\t<div v-show="isActive">\n\t\t\t<div class="crm-copilot__call-assessment_page-section">\n\t\t\t\t<Breadcrumbs :active-tab-id="id" />\n\t\t\t\t<header class="crm-copilot__call-assessment_page-section-header">\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-header-title">\n\t\t\t\t\t\t{{ pageTitle }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-header-description">\n\t\t\t\t\t\t{{ pageDescription }}\n\t\t\t\t\t</div>\n\t\t\t\t</header>\n\n\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body">\n\t\t\t\t\t<AiDisabledInSettings v-if="!isEnabled" />\n\t\t\t\t\t<div :class="this.getBodyFieldClassList(['ui-ctl', 'ui-ctl-after-icon', 'ui-ctl-dropdown', 'ui-ctl-w100'])">\n\t\t\t\t\t\t<label>{{ pageSectionSettingsCallType }}</label>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-after-icon ui-ctl-dropdown">\n\t\t\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t\t\t<select class="ui-ctl-element" v-model="callTypeId">\n\t\t\t\t\t\t\t\t<option \n\t\t\t\t\t\t\t\t\tv-for="callType in callTypes"\n\t\t\t\t\t\t\t\t\t:value="callType.id"\n\t\t\t\t\t\t\t\t\t:disabled="readOnly && callTypeId !== callType.id"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{{callType.title}}\n\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-description">\n\t\t\t\t\t\t\t{{ pageSectionSettingsCallTypeDescription }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div \n\t\t\t\t\tv-if="isBaasAvailable"\n\t\t\t\t\tclass="crm-copilot__call-assessment_page-section-body"\n\t\t\t\t>\n\t\t\t\t\t<div :class="this.getBodyFieldClassList(['ui-ctl', 'ui-ctl-after-icon', 'ui-ctl-dropdown', 'ui-ctl-w100'])">\n\t\t\t\t\t\t<label>{{ pageSectionSettingsCheck }}</label>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-after-icon ui-ctl-dropdown">\n\t\t\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t\t\t<select \n\t\t\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t\t\tv-model="autoCheckTypeId"\n\t\t\t\t\t\t\t\t@change="onAutoCheckTypeIdChange"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<option \n\t\t\t\t\t\t\t\t\tv-for="checkType in checkTypes"\n\t\t\t\t\t\t\t\t\t:value="checkType.value"\n\t\t\t\t\t\t\t\t\t:disabled="readOnly && autoCheckTypeId !== checkType.value"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{{checkType.title}}\n\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-description">\n\t\t\t\t\t\t\t{{ pageSectionSettingsCheckDescription }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div\n\t\t\t\t\tv-if="isCallAssessmentAvailabilityEnabled"\n\t\t\t\t\tclass="crm-copilot__call-assessment_page-section-body"\n\t\t\t\t>\n\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field">\n\t\t\t\t\t\t<label>{{ pageSectionSettingsAvailability }}</label>\n\t\t\t\t\t\t<TypeSelector\n\t\t\t\t\t\t\tref="typeSelector"\n\t\t\t\t\t\t\t:availabilityType="availabilityType"\n\t\t\t\t\t\t\t:readOnly="readOnly"\n\t\t\t\t\t\t\t@typeChange="onAvailabilityTypeChange"\n\t\t\t\t\t\t\t@dataChange="onAvailabilityDataChange"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div class="crm-copilot__call-assessment_page-section-body-field-description">\n\t\t\t\t\t\t\t{{ pageSectionSettingsAvailabilityDescription }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-if="timePeriodError" class="crm-copilot__call-assessment_page-section-body-field-error">\n\t\t\t\t\t\t\t{{ timePeriodError }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const W={components:{AboutPage:O,ClientPage:B,SettingsPage:Y,ControlPage:F,Navigation:L},props:{settings:{type:Object,default:{}},params:{type:Object,default:{}},textEditor:n.TextEditor},data(){var t;const{data:e}=this.params;let i=null;if(this.settings.isCopy){i=null}else{var s;i=(s=e==null?void 0:e.id)!=null?s:null}return{id:i,pagesData:this.initPagesData(e),activePageId:"about",title:(t=e.title)!=null?t:null,canShowNextPage:false}},watch:{activePageId(t){this.onPageDataChange({id:t,data:this.getPageData(t)})}},methods:{initPagesData(t){var e,i,s,a;return{client:{data:{activeClientTypeIds:t==null?void 0:t.clientTypeIds}},settings:{data:{callTypeId:t==null?void 0:t.callTypeId,autoCheckTypeId:t==null?void 0:t.autoCheckTypeId,availabilityType:(e=t==null?void 0:t.availabilityType)!=null?e:j.always_active,availabilityData:(i=t==null?void 0:t.availabilityData)!=null?i:[]}},control:{data:{lowBorder:(s=t==null?void 0:t.lowBorder)!=null?s:0,highBorder:(a=t==null?void 0:t.highBorder)!=null?a:100}}}},onNavigationButtonClick({data:t}){const{id:e}=t;if(e==="cancel"||e==="close"){this.closeSlider();return}if(e==="back"){const t=this.pagesList.indexOf(this.activePageId);if(t>0){this.activePageId=this.pagesList[t-1]}return}if(!this.isActivePageValid()){this.onActivePageValidationFailed();return}if(e==="continue"){const t=this.pagesList.indexOf(this.activePageId);if(t<this.pagesList.length-1){this.activePageId=this.pagesList[t+1]}return}if(e==="submit"||e==="update"){this.sendData()}},sendData(){let t={title:this.title};this.pagesList.forEach((e=>{var i;t={...t,...(i=this.$refs[e])==null?void 0:i.getData()}}));const e={id:this.id,data:t,eventId:i.QueueManager.registerRandomEventId("crm-copilot-call-assessment")};top.BX.Event.EventEmitter.emit("crm:copilot:callAssessment:beforeSave",e);_.ajax.runAction("crm.copilot.callassessment.save",{data:e}).then((t=>{top.BX.Event.EventEmitter.emit("crm:copilot:callAssessment:save",{...e,status:t==null?void 0:t.status});if((t==null?void 0:t.status)!=="success"){r.UI.Notification.Center.notify({content:_.Text.encode(t.errors[0].message),autoHideDelay:6e3});return}this.onSaveCallback();this.closeSlider()}),(t=>{var e;const i=((e=t.errors[0])==null?void 0:e.code)==="AI_NOT_AVAILABLE"?"CRM_COPILOT_CALL_ASSESSMENT_PAGE_COPILOT_ERROR":"CRM_COPILOT_CALL_ASSESSMENT_PAGE_SAVE_ERROR";r.UI.Notification.Center.notify({content:_.Loc.getMessage(i),autoHideDelay:6e3})})).catch((t=>{r.UI.Notification.Center.notify({content:_.Text.encode(t.errors[0].message),autoHideDelay:6e3});throw t}))},closeSlider(){top.BX.SidePanel.Instance.getSliderByWindow(window).close()},onSaveCallback(){var t,e;if(_.Type.isFunction((t=this.params)==null?void 0:(e=t.events)==null?void 0:e.onSave)){this.params.events.onSave()}},setActivePageId({data:t}){const e=t.itemId;const i=this.pagesList.indexOf(this.activePageId);const s=this.pagesList.indexOf(e);if(i===s){return}if(s>i&&!this.isActivePageValid()){this.onActivePageValidationFailed();return}this.activePageId=e},isPageActive(t){return this.activePageId===t},onPageDataChange({id:t,data:e}){this.pagesData[t]=e;this.canShowNextPage=this.isActivePageReadyToMoveOn()},getPageData(t){if(_.Type.isObjectLike(this.pagesData[t])){return this.pagesData[t].data}return{}},getPageSettings(t){if(t==="settings"){var e;return{baas:(e=this.settings.baas)!=null?e:{}}}return{}},setTitle(t){this.title=t},isActivePageValid(){return this.getActivePage().validate()},onActivePageValidationFailed(){return this.getActivePage().onValidationFailed()},isActivePageReadyToMoveOn(){return this.getActivePage().isReadyToMoveOn()},getActivePage(){return this.$refs[this.activePageId]}},computed:{pagesList(){return["about","client","settings","control"]},isNew(){var t;return((t=this.params.data)==null?void 0:t.id)<=0},readOnly(){return this.settings.readOnly},isEnabled(){return this.settings.isEnabled}},mounted(){this.canShowNextPage=this.isActivePageReadyToMoveOn();this.$Bitrix.eventEmitter.subscribe(g.itemClick,this.setActivePageId);this.$Bitrix.eventEmitter.subscribe(b.click,this.onNavigationButtonClick)},beforeUnmount(){this.$Bitrix.eventEmitter.unsubscribe(g.itemClick,this.setActivePageId);this.$Bitrix.eventEmitter.unsubscribe(b.click,this.onNavigationButtonClick)},template:`\n\t\t<div class="crm-copilot__call-assessment_container">\n\t\t\t<div class="crm-copilot__call-assessment_page-wrapper">\n\t\t\t\t<AboutPage \n\t\t\t\t\t:is-active="isPageActive('about')"\n\t\t\t\t\t:is-enabled="isEnabled"\n\t\t\t\t\t:data="getPageData('about')"\n\t\t\t\t\t:text-editor="textEditor"\n\t\t\t\t\t@onChange="onPageDataChange"\n\t\t\t\t\tref="about"\n\t\t\t\t/>\n\t\t\t\t<ClientPage \n\t\t\t\t\t:is-active="isPageActive('client')"\n\t\t\t\t\t:is-enabled="isEnabled"\n\t\t\t\t\t:data="getPageData('client')"\n\t\t\t\t\t:read-only="readOnly"\n\t\t\t\t\t@onChange="onPageDataChange"\n\t\t\t\t\tref="client"\n\t\t\t\t/>\n\t\t\t\t<SettingsPage\n\t\t\t\t\t:is-active="isPageActive('settings')"\n\t\t\t\t\t:is-enabled="isEnabled"\n\t\t\t\t\t:data="getPageData('settings')"\n\t\t\t\t\t:settings="getPageSettings('settings')"\n\t\t\t\t\t:read-only="readOnly"\n\t\t\t\t\t@onChange="onPageDataChange"\n\t\t\t\t\tref="settings"\n\t\t\t\t/>\n\t\t\t\t<ControlPage\n\t\t\t\t\t:is-active="isPageActive('control')"\n\t\t\t\t\t:is-enabled="isEnabled"\n\t\t\t\t\t:data="getPageData('control')"\n\t\t\t\t\t:read-only="readOnly"\n\t\t\t\t\t@onChange="onPageDataChange"\n\t\t\t\t\tref="control"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<Navigation \n\t\t\t\t:active-tab-id="activePageId"\n\t\t\t\t:is-enabled="canShowNextPage"\n\t\t\t\t:read-only="readOnly"\n\t\t\t\t:show-save-button="!isNew && !readOnly"\n\t\t\t/>\n\t\t</div>\n\t`};let q=t=>t,z,Q;var Z=babelHelpers.classPrivateFieldLooseKey("container");var J=babelHelpers.classPrivateFieldLooseKey("app");var tt=babelHelpers.classPrivateFieldLooseKey("layoutComponent");var et=babelHelpers.classPrivateFieldLooseKey("titleId");var it=babelHelpers.classPrivateFieldLooseKey("titleEditButtonId");var st=babelHelpers.classPrivateFieldLooseKey("titleInputContainer");var at=babelHelpers.classPrivateFieldLooseKey("titleNode");var nt=babelHelpers.classPrivateFieldLooseKey("titleInput");var lt=babelHelpers.classPrivateFieldLooseKey("inputEditButton");var rt=babelHelpers.classPrivateFieldLooseKey("title");var ot=babelHelpers.classPrivateFieldLooseKey("textEditor");var ct=babelHelpers.classPrivateFieldLooseKey("isReadOnly");var dt=babelHelpers.classPrivateFieldLooseKey("isEnabled");var pt=babelHelpers.classPrivateFieldLooseKey("initTitleInlineEditing");var ut=babelHelpers.classPrivateFieldLooseKey("bindTitleInlineEditingStart");var vt=babelHelpers.classPrivateFieldLooseKey("appendTitleInput");var ht=babelHelpers.classPrivateFieldLooseKey("hideTitle");var _t=babelHelpers.classPrivateFieldLooseKey("bindTitleInlineEditingFinish");var gt=babelHelpers.classPrivateFieldLooseKey("getInputEditButton");var Tt=babelHelpers.classPrivateFieldLooseKey("hideInputAndShowTitle");var bt=babelHelpers.classPrivateFieldLooseKey("getTitleNode");var mt=babelHelpers.classPrivateFieldLooseKey("getTextEditor");class yt{constructor(t,i={}){var s,a,n,l,r,o,c,d,p;Object.defineProperty(this,mt,{value:ft});Object.defineProperty(this,bt,{value:Ot});Object.defineProperty(this,Tt,{value:At});Object.defineProperty(this,gt,{value:It});Object.defineProperty(this,_t,{value:Pt});Object.defineProperty(this,ht,{value:Ct});Object.defineProperty(this,vt,{value:St});Object.defineProperty(this,ut,{value:Et});Object.defineProperty(this,pt,{value:Lt});Object.defineProperty(this,Z,{writable:true,value:void 0});Object.defineProperty(this,J,{writable:true,value:null});Object.defineProperty(this,tt,{writable:true,value:null});Object.defineProperty(this,et,{writable:true,value:null});Object.defineProperty(this,it,{writable:true,value:null});Object.defineProperty(this,st,{writable:true,value:null});Object.defineProperty(this,at,{writable:true,value:null});Object.defineProperty(this,nt,{writable:true,value:null});Object.defineProperty(this,lt,{writable:true,value:null});Object.defineProperty(this,rt,{writable:true,value:null});Object.defineProperty(this,ot,{writable:true,value:null});Object.defineProperty(this,ct,{writable:true,value:true});Object.defineProperty(this,dt,{writable:true,value:true});babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]=document.getElementById(t);if(!_.Type.isDomNode(babelHelpers.classPrivateFieldLooseBase(this,Z)[Z])){throw new Error("container not found")}babelHelpers.classPrivateFieldLooseBase(this,ct)[ct]=(s=(a=i.config)==null?void 0:a.readOnly)!=null?s:true;babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]=(n=(l=i.config)==null?void 0:l.isEnabled)!=null?n:true;babelHelpers.classPrivateFieldLooseBase(this,pt)[pt](i);babelHelpers.classPrivateFieldLooseBase(this,J)[J]=e.BitrixVue.createApp(W,{textEditor:babelHelpers.classPrivateFieldLooseBase(this,mt)[mt](i.data,(r=i.config)!=null?r:{}),settings:{readOnly:babelHelpers.classPrivateFieldLooseBase(this,ct)[ct],isEnabled:babelHelpers.classPrivateFieldLooseBase(this,dt)[dt],isCopy:(o=(c=i.config)==null?void 0:c.isCopy)!=null?o:false,baas:(d=(p=i.config)==null?void 0:p.baasSettings)!=null?d:false},params:{data:i.data,events:i.events}});babelHelpers.classPrivateFieldLooseBase(this,tt)[tt]=babelHelpers.classPrivateFieldLooseBase(this,J)[J].mount(babelHelpers.classPrivateFieldLooseBase(this,Z)[Z])}onTitleInlineEditingStart(){if(babelHelpers.classPrivateFieldLooseBase(this,st)[st]!==null){return}babelHelpers.classPrivateFieldLooseBase(this,vt)[vt]();babelHelpers.classPrivateFieldLooseBase(this,ht)[ht]();babelHelpers.classPrivateFieldLooseBase(this,_t)[_t]()}onTitleInputBlur(t){this.onTitleInlineEditingFinish(t,false)}onTitleInputEnterPressed(t){if(t.key==="Enter"){this.onTitleInlineEditingFinish(t,false)}}onTitleInlineEditingFinish(t,e=true){if(babelHelpers.classPrivateFieldLooseBase(this,st)[st]===null||babelHelpers.classPrivateFieldLooseBase(this,nt)[nt]===null){return}if(e&&(t.target===babelHelpers.classPrivateFieldLooseBase(this,nt)[nt]||t.target===babelHelpers.classPrivateFieldLooseBase(this,gt)[gt]())){return}const i=babelHelpers.classPrivateFieldLooseBase(this,nt)[nt].value;if(!_.Type.isStringFilled(i)){babelHelpers.classPrivateFieldLooseBase(this,nt)[nt].focus();return}babelHelpers.classPrivateFieldLooseBase(this,rt)[rt]=i;babelHelpers.classPrivateFieldLooseBase(this,tt)[tt].setTitle(babelHelpers.classPrivateFieldLooseBase(this,rt)[rt]);_.Event.unbind(document,"mousedown",this.onTitleInlineEditingFinish);_.Event.unbind(babelHelpers.classPrivateFieldLooseBase(this,nt)[nt],"keyup",this.onTitleInputEnterPressed);_.Event.unbind(babelHelpers.classPrivateFieldLooseBase(this,nt)[nt],"blur",this.onTitleInputBlur);babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt]()}}function Lt(t){if(babelHelpers.classPrivateFieldLooseBase(this,ct)[ct]){return}this.onTitleInlineEditingStart=this.onTitleInlineEditingStart.bind(this);this.onTitleInlineEditingFinish=this.onTitleInlineEditingFinish.bind(this);this.onTitleInputEnterPressed=this.onTitleInputEnterPressed.bind(this);this.onTitleInputBlur=this.onTitleInputBlur.bind(this);const{config:e,data:i}=t;const{titleId:s,titleEditButtonId:a}=e!=null?e:{};if(!_.Type.isStringFilled(s)||!_.Type.isStringFilled(a)){return}babelHelpers.classPrivateFieldLooseBase(this,it)[it]=a;babelHelpers.classPrivateFieldLooseBase(this,et)[et]=s;if(_.Type.isString(i==null?void 0:i.title)){babelHelpers.classPrivateFieldLooseBase(this,rt)[rt]=i.title}babelHelpers.classPrivateFieldLooseBase(this,ut)[ut]()}function Et(){_.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,gt)[gt](),"click",this.onTitleInlineEditingStart)}function St(){babelHelpers.classPrivateFieldLooseBase(this,nt)[nt]=_.Tag.render(z||(z=q`
			<input value="${0}" type="text" class="crm-copilot__call-assessment_title-item" />
		`),_.Text.encode(babelHelpers.classPrivateFieldLooseBase(this,rt)[rt]));babelHelpers.classPrivateFieldLooseBase(this,st)[st]=_.Tag.render(Q||(Q=q`
			<div class="crm-copilot__call-assessment_title-wrapper">
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,nt)[nt]);_.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,st)[st],babelHelpers.classPrivateFieldLooseBase(this,bt)[bt]().parentNode);babelHelpers.classPrivateFieldLooseBase(this,nt)[nt].focus();const t=babelHelpers.classPrivateFieldLooseBase(this,nt)[nt].value.length;babelHelpers.classPrivateFieldLooseBase(this,nt)[nt].selectionStart=t;babelHelpers.classPrivateFieldLooseBase(this,nt)[nt].selectionEnd=t;_.Dom.addClass(document.querySelector(".copilot-call-assessment-pagetitle-description"),"--title-edit")}function Ct(){_.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,bt)[bt](),{display:"none"});_.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,gt)[gt](),{display:"none"})}function Pt(){_.Event.bind(document,"mousedown",this.onTitleInlineEditingFinish);_.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,nt)[nt],"keyup",this.onTitleInputEnterPressed);_.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,nt)[nt],"blur",this.onTitleInputBlur)}function It(){if(babelHelpers.classPrivateFieldLooseBase(this,lt)[lt]===null){babelHelpers.classPrivateFieldLooseBase(this,lt)[lt]=document.getElementById(babelHelpers.classPrivateFieldLooseBase(this,it)[it])}return babelHelpers.classPrivateFieldLooseBase(this,lt)[lt]}function At(){const t=babelHelpers.classPrivateFieldLooseBase(this,bt)[bt]();t.innerText=babelHelpers.classPrivateFieldLooseBase(this,rt)[rt];_.Dom.style(t,{display:"inline-block"});_.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,gt)[gt](),{display:"inline-block"});_.Dom.remove(babelHelpers.classPrivateFieldLooseBase(this,st)[st]);babelHelpers.classPrivateFieldLooseBase(this,st)[st]=null;_.Dom.removeClass(document.querySelector(".copilot-call-assessment-pagetitle-description"),"--title-edit")}function Ot(){if(babelHelpers.classPrivateFieldLooseBase(this,at)[at]===null){babelHelpers.classPrivateFieldLooseBase(this,at)[at]=document.getElementById(babelHelpers.classPrivateFieldLooseBase(this,et)[et])}return babelHelpers.classPrivateFieldLooseBase(this,at)[at]}function ft({prompt:t},{copilotSettings:e}){if(babelHelpers.classPrivateFieldLooseBase(this,ot)[ot]!==null){return babelHelpers.classPrivateFieldLooseBase(this,ot)[ot]}const i=babelHelpers.classPrivateFieldLooseBase(this,ct)[ct]?[]:["bold","italic","underline","strikethrough","|","numbered-list","bulleted-list","copilot"];babelHelpers.classPrivateFieldLooseBase(this,ot)[ot]=new n.BasicEditor({editable:!babelHelpers.classPrivateFieldLooseBase(this,ct)[ct],removePlugins:["BlockToolbar"],minHeight:250,maxHeight:400,content:t,placeholder:_.Loc.getMessage("CRM_COPILOT_CALL_ASSESSMENT_PLACEHOLDER"),paragraphPlaceholder:_.Loc.getMessage(_.Type.isPlainObject(e)?"CRM_COPILOT_CALL_ASSESSMENT_PLACEHOLDER_WITH_COPILOT":null),toolbar:i,floatingToolbar:[],collapsingMode:false,copilot:{copilotOptions:_.Type.isPlainObject(e)?e:null,triggerBySpace:true}});return babelHelpers.classPrivateFieldLooseBase(this,ot)[ot]}t.CallAssessment=yt})(this.BX.Crm.Copilot=this.BX.Crm.Copilot||{},BX.Vue3,BX.Pull,BX.UI,BX.UI.BBCode,BX.UI.TextEditor,BX,BX,BX.UI.EntitySelector,BX.UI,BX,BX.Main,BX.Crm.Timeline,BX.Event,BX.UI.DatePicker,BX);
//# sourceMappingURL=call-assessment.bundle.map.js