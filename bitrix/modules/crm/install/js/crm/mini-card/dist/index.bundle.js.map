{"version":3,"file":"index.bundle.js","sources":["../src/lib/model/component.js","../src/lib/model/mini-card-item.js","../src/components/loader/loader.js","../src/components/avatar/layout/avatar/avatar.js","../src/components/avatar/avatar-list/image-avatar/image-avatar.js","../src/components/avatar/avatar-list/icon-avatar/icon-avatar.js","../src/components/control/control-list/button-control/button-control.js","../src/components/control/layout/control/control.js","../src/components/field/layout/field-layout/field/field.js","../src/components/field/layout/field-layout/field-title/field-title.js","../src/components/field/layout/field-layout/field-value/field-value.js","../src/components/field/layout/field-layout/field-value-list/field-value-list.js","../src/components/field/layout/value-decorator/value-ellipsis/value-ellipsis.js","../src/components/field/field-list/common-field/common-field.js","../src/lib/service/activity-editor-service.js","../src/lib/service/communication-service.js","../src/lib/service/event-service.js","../src/lib/service-locator.js","../src/components/field/show-more/show-more.js","../src/components/field/show-more/show-more-menu.js","../src/components/field/field-list/phone-field/phone-field.js","../src/components/field/field-list/email-field/email-field.js","../src/components/field/field-list/link-field/link-field.js","../src/components/field/field-list/money-field/money-field.js","../src/components/field/field-list/stage-field/stage-field.js","../src/components/field/field-list/client-field/components/communication-control.js","../src/components/mini-card-component.js","../src/components/mini-card-content.js","../src/components/field/field-list/client-field/client-field.js","../src/components/field/field-list/product-field/product-field.js","../src/components/footer-note/footer-note-list/common-footer-note/common-footer-note.js","../src/components/footer-note/layout/footer-note/footer-note.js","../src/mini-card.js","../src/entity-mini-card.js"],"sourcesContent":["import { Type } from 'main.core';\n\nexport type ComponentOptions = {\n\tcomponentName: string,\n\tcomponentProps: Object,\n};\n\nexport class Component\n{\n\t#componentName: string;\n\t#componentProps: Object;\n\n\tconstructor(options: ComponentOptions)\n\t{\n\t\tif (!Type.isStringFilled(options.componentName))\n\t\t{\n\t\t\tthrow new RangeError('BX.Crm.MiniCard.Component: options.componentName must be a string filled');\n\t\t}\n\n\t\tif (!Type.isPlainObject(options.componentProps))\n\t\t{\n\t\t\tthrow new RangeError('BX.Crm.MiniCard.Component: options.componentProps must be a plain object');\n\t\t}\n\n\t\tthis.#componentName = options.componentName;\n\t\tthis.#componentProps = options.componentProps;\n\t}\n\n\tcomponentName(): string\n\t{\n\t\treturn this.#componentName;\n\t}\n\n\tcomponentProps(): Object\n\t{\n\t\treturn this.#componentProps;\n\t}\n}\n","import { Type, Text } from 'main.core';\n\nimport { type ComponentOptions, Component } from './component';\n\nexport type MiniCardItemOptions = {\n\tid?: string,\n\ttitle: string,\n\tavatar: ComponentOptions,\n\tcontrols: ComponentOptions[],\n\tfields: ComponentOptions[],\n\tfooterNotes: ComponentOptions[],\n};\n\nexport class MiniCardItem\n{\n\t#id: string;\n\t#title: string;\n\t#avatar: Component;\n\t#controls: Component[];\n\t#fields: Component[];\n\t#footerNotes: Component[];\n\n\tconstructor(options: MiniCardItemOptions)\n\t{\n\t\tthis.#id = Type.isStringFilled(options.id) ? options.id : Text.getRandom(16);\n\n\t\tif (!Type.isStringFilled(options.title))\n\t\t{\n\t\t\tthrow new RangeError('BX.Crm.MiniCard.MiniCardItem: options.title must be a string filled');\n\t\t}\n\n\t\tthis.#title = options.title;\n\t\tthis.#avatar = new Component(options.avatar);\n\n\t\tthis.#controls = [];\n\t\toptions.controls.forEach((controlOptions: ComponentOptions) => {\n\t\t\tthis.#controls.push(new Component(controlOptions));\n\t\t});\n\n\t\tthis.#fields = [];\n\t\toptions.fields.forEach((fieldOptions: ComponentOptions) => {\n\t\t\tthis.#fields.push(new Component(fieldOptions));\n\t\t});\n\n\t\tthis.#footerNotes = [];\n\t\toptions.footerNotes.forEach((footerNoteOptions: ComponentOptions) => {\n\t\t\tthis.#footerNotes.push(new Component(footerNoteOptions));\n\t\t});\n\t}\n\n\tid(): string\n\t{\n\t\treturn this.#id;\n\t}\n\n\ttitle(): string\n\t{\n\t\treturn this.#title;\n\t}\n\n\tavatar(): Component\n\t{\n\t\treturn this.#avatar;\n\t}\n\n\tcontrols(): Component[]\n\t{\n\t\treturn this.#controls;\n\t}\n\n\tfields(): Component[]\n\t{\n\t\treturn this.#fields;\n\t}\n\n\tfooterNotes(): Component[]\n\t{\n\t\treturn this.#footerNotes;\n\t}\n}\n","import { BitrixVueComponentProps } from 'ui.vue3';\n\nimport './loader.css';\nexport const Loader: BitrixVueComponentProps = {\n\tname: 'Loader',\n\ttemplate: `\n\t\t<div class=\"crm-mini-card__loader\"></div>\n\t`,\n};\n","import { BitrixVueComponentProps } from 'ui.vue3';\n\nimport './avatar.css';\n\nexport const Avatar: BitrixVueComponentProps = {\n\tname: 'Avatar',\n\n\ttemplate: `\n\t\t<div class=\"crm-mini-card__avatar\">\n\t\t\t<slot />\n\t\t</div>\n\t`,\n};\n","import { BitrixVueComponentProps } from 'ui.vue3';\n\nimport { Avatar } from '../../layout/avatar/avatar';\n\nimport './image-avatar.css';\n\nexport const ImageAvatar: BitrixVueComponentProps = {\n\tname: 'ImageAvatar',\n\n\tcomponents: {\n\t\tAvatar,\n\t},\n\n\tprops: {\n\t\turl: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tcomputed: {\n\t\tencodeUri(): string\n\t\t{\n\t\t\treturn encodeURI(this.url);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<Avatar class=\"--image\">\n\t\t\t<img :src=\"encodeUri\" alt=\"\"/>\n\t\t</Avatar>\n\t`,\n};\n","import { BitrixVueComponentProps } from 'ui.vue3';\nimport { BIcon } from 'ui.icon-set.api.vue';\n\nimport { Avatar } from '../../layout/avatar/avatar';\n\nimport 'ui.icon-set.crm';\nimport 'ui.icon-set.outline';\n\nimport './icon-avatar.css';\n\nexport const IconAvatar: BitrixVueComponentProps = {\n\tname: 'IconAvatar',\n\n\tcomponents: {\n\t\tBIcon,\n\t\tAvatar,\n\t},\n\n\tprops: {\n\t\ticonOptions: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tbgColor: {\n\t\t\ttype: String,\n\t\t\tdefault: null,\n\t\t},\n\t},\n\n\tcomputed: {\n\t\tcontainerStyles(): Object\n\t\t{\n\t\t\tconst styleBgColor = this.styleBgColor();\n\t\t\tif (styleBgColor === null)\n\t\t\t{\n\t\t\t\treturn {};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tbackgroundColor: styleBgColor,\n\t\t\t};\n\t\t},\n\t},\n\n\tmethods: {\n\t\tstyleBgColor(): ?string\n\t\t{\n\t\t\tif (!this.bgColor)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (this.bgColor.startsWith('--'))\n\t\t\t{\n\t\t\t\treturn `var(${this.bgColor})`;\n\t\t\t}\n\n\t\t\treturn this.bgColor;\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<Avatar class=\"--icon\" :style=\"containerStyles\">\n\t\t\t<BIcon v-bind=\"iconOptions\" />\n\t\t</Avatar>\n\t`,\n};\n","import { BitrixVueComponentProps } from 'ui.vue3';\nimport { Button } from 'ui.buttons';\n\nimport { Control } from '../../layout/control/control';\n\nimport './button-control.css';\n\nexport const ButtonControl: BitrixVueComponentProps = {\n\tname: 'ButtonControl',\n\n\tcomponents: {\n\t\tControl,\n\t},\n\n\tprops: {\n\t\tbuttonOptions: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tmounted(): void\n\t{\n\t\t(new Button(this.buttonOptions))\n\t\t\t.renderTo(this.$refs.button.$el)\n\t\t;\n\t},\n\n\ttemplate: `\n\t\t<Control class=\"--button\" ref=\"button\" />\n\t`,\n};\n","import { BitrixVueComponentProps } from 'ui.vue3';\n\nimport './control.css';\n\nexport const Control: BitrixVueComponentProps = {\n\tname: 'Control',\n\ttemplate: `\n\t\t<div class=\"crm-mini-card__control\">\n\t\t\t<slot />\n\t\t</div>\n\t`,\n};\n","import { BitrixVueComponentProps } from 'ui.vue3';\n\nimport './field.css';\n\nexport const Field: BitrixVueComponentProps = {\n\ttemplate: `\n\t\t<div class=\"crm-mini-card__field\">\n\t\t\t<slot />\n\t\t</div>\n\t`,\n};\n","import { BitrixVueComponentProps } from 'ui.vue3';\n\nimport './field-title.css';\nexport const FieldTitle: BitrixVueComponentProps = {\n\ttemplate: `\n\t\t<div class=\"crm-mini-card__field-title\">\n\t\t\t<slot />\n\t\t</div>\n\t`,\n};\n","import { BitrixVueComponentProps } from 'ui.vue3';\n\nimport './field-value.css';\n\nexport const FieldValue: BitrixVueComponentProps = {\n\ttemplate: `\n\t\t<div class=\"crm-mini-card__field-value\">\n\t\t\t<slot />\n\t\t</div>\n\t`,\n};\n","import { BitrixVueComponentProps } from 'ui.vue3';\n\nimport './field-value-list.css';\nexport const FieldValueList: BitrixVueComponentProps = {\n\ttemplate: `\n\t\t<div class=\"crm-mini-card__field-value-list\">\n\t\t\t<slot />\n\t\t</div>\n\t`,\n};\n","import { BitrixVueComponentProps } from 'ui.vue3';\n\nimport './value-ellipsis.css';\n\nexport const ValueEllipsis: BitrixVueComponentProps = {\n\tname: 'ValueEllipsis',\n\ttemplate: `\n\t\t<span class=\"crm-mini-card__value-ellipsis\">\n\t\t\t<slot/>\n\t\t</span>\n\t`,\n};\n","import { BitrixVueComponentProps } from 'ui.vue3';\nimport {\n\tField,\n\tFieldTitle,\n\tFieldValue,\n\tFieldValueList,\n\tValueEllipsis,\n} from '../../layout/index';\n\nimport './common-field.css';\n\nexport const CommonField: BitrixVueComponentProps = {\n\tname: 'CommonField',\n\tcomponents: {\n\t\tField,\n\t\tFieldTitle,\n\t\tFieldValueList,\n\t\tFieldValue,\n\t\tValueEllipsis,\n\t},\n\tprops: {\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tvalues: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<Field class=\"--common\">\n\t\t\t<FieldTitle>{{ title }}</FieldTitle>\n\t\t\t<FieldValueList>\n\t\t\t\t<FieldValue v-for=\"value in values\">\n\t\t\t\t\t<ValueEllipsis :title=\"value\">{{ value }}</ValueEllipsis>\n\t\t\t\t</FieldValue>\n\t\t\t</FieldValueList>\n\t\t</Field>\n\t`,\n};\n","import { ajax as Ajax, Runtime, Text } from 'main.core';\n\nexport class ActivityEditorService\n{\n\t#cache: Object;\n\n\tconstructor()\n\t{\n\t\tthis.#cache = {};\n\t}\n\n\tasync loadActivityEditor(\n\t\townerTypeId: number,\n\t\townerId: number,\n\t\tactivityEditorContainer: HTMLElement,\n\t): Promise<?BX.CrmActivityEditor>\n\t{\n\t\tif (this.#cache[ownerTypeId]?.[ownerId])\n\t\t{\n\t\t\treturn this.#cache[ownerTypeId][ownerId];\n\t\t}\n\n\t\tconst editorId = Text.getRandom(16);\n\n\t\ttry\n\t\t{\n\t\t\tconst response = await Ajax.runAction('crm.item.minicard.getActivityEditor', {\n\t\t\t\tdata: {\n\t\t\t\t\townerTypeId,\n\t\t\t\t\townerId,\n\t\t\t\t\teditorId,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tawait Runtime.html(activityEditorContainer, response?.data?.html ?? '');\n\n\t\t\tthis.#cache[ownerTypeId] ??= {};\n\t\t\tthis.#cache[ownerTypeId][ownerId] = BX.CrmActivityEditor.items[editorId];\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error('BX.Crm.MiniCard.ActivityEditorService: Cannot load activity editor:', error);\n\n\t\t\tthis.#cache[ownerTypeId] ??= {};\n\t\t\tthis.#cache[ownerTypeId][ownerId] = BX.CrmActivityEditor.getDefault();\n\t\t}\n\n\t\treturn this.#cache[ownerTypeId][ownerId];\n\t}\n}\n","import { Loc } from 'main.core';\nimport { MessageBox } from 'ui.dialogs.messagebox';\nimport { ServiceLocator } from '../service-locator';\n\ndeclare type PhoneCommunicationOptions = {\n\tphone: string,\n\townerTypeId: number,\n\townerId: number,\n\tentityTypeId: number,\n\tentityId: number,\n};\n\ndeclare type EmailCommunicationOptions = {\n\temail: string,\n\townerTypeId: number,\n\townerId: number,\n\tentityTypeId: number,\n\tentityId: number,\n\tactivityEditorContainer: HTMLElement,\n};\n\ndeclare type IMCommunicationOptions = {\n\tdialogId: string,\n};\n\nexport class CommunicationService\n{\n\tcommunicateByPhone(options: PhoneCommunicationOptions): void\n\t{\n\t\tif (!window.top.BXIM)\n\t\t{\n\t\t\tMessageBox.alert(Loc.getMessage('CRM_MINI_CARD_COMMUNICATION_PHONE_NOT_SUPPORTS'));\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst phoneToParams = {\n\t\t\tENTITY_TYPE_NAME: BX.CrmEntityType.resolveName(options.entityTypeId),\n\t\t\tENTITY_ID: options.entityId,\n\t\t};\n\n\t\tif (\n\t\t\toptions.ownerTypeId !== options.entityTypeId\n\t\t\t&& options.ownerId !== options.entityId\n\t\t)\n\t\t{\n\t\t\tphoneToParams.BINDINGS = {\n\t\t\t\tOWNER_TYPE_NAME: BX.CrmEntityType.resolveName(options.ownerTypeId),\n\t\t\t\tOWNER_TYPE_ID: options.ownerTypeId,\n\t\t\t};\n\t\t}\n\n\t\twindow.top.BXIM.phoneTo(options.phone, phoneToParams);\n\t}\n\n\tcommunicateByEmail(options: EmailCommunicationOptions): Promise<void>\n\t{\n\t\tconst error = () => {\n\t\t\tMessageBox.alert(Loc.getMessage('CRM_MINI_CARD_COMMUNICATION_EMAIL_NOT_SUPPORTS'));\n\t\t};\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tServiceLocator\n\t\t\t\t.getInstance()\n\t\t\t\t.getActivityEditorService()\n\t\t\t\t.loadActivityEditor(\n\t\t\t\t\toptions.ownerTypeId,\n\t\t\t\t\toptions.ownerId,\n\t\t\t\t\toptions.activityEditorContainer,\n\t\t\t\t)\n\t\t\t\t.then((editor: ?BX.CrmActivityEditor) => {\n\t\t\t\t\tif (!editor)\n\t\t\t\t\t{\n\t\t\t\t\t\terror();\n\n\t\t\t\t\t\treject();\n\t\t\t\t\t}\n\n\t\t\t\t\tconst isEmailAdded = editor.addEmail({\n\t\t\t\t\t\townerID: options.ownerId,\n\t\t\t\t\t\townerType: BX.CrmEntityType.resolveName(options.ownerTypeId),\n\t\t\t\t\t\tcommunicationsLoaded: true,\n\t\t\t\t\t\tcommunications: [{\n\t\t\t\t\t\t\ttype: 'EMAIL',\n\t\t\t\t\t\t\tentityType: BX.CrmEntityType.resolveName(options.entityTypeId),\n\t\t\t\t\t\t\tentityId: options.entityId,\n\t\t\t\t\t\t\tvalue: options.email,\n\t\t\t\t\t\t}],\n\t\t\t\t\t});\n\n\t\t\t\t\tif (!isEmailAdded)\n\t\t\t\t\t{\n\t\t\t\t\t\twindow.location.href = `mailto:${options.email}`;\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve();\n\t\t\t\t})\n\t\t\t\t.catch(() => {\n\t\t\t\t\treject();\n\t\t\t\t});\n\t\t});\n\t}\n\n\tcommunicateByIM(options: IMCommunicationOptions): void\n\t{\n\t\tif (!window.top.BXIM)\n\t\t{\n\t\t\tMessageBox.alert(Loc.getMessage('CRM_MINI_CARD_COMMUNICATION_IM_NOT_SUPPORTS'));\n\n\t\t\treturn;\n\t\t}\n\n\t\twindow.top.BXIM.openMessengerSlider(options.dialogId, {\n\t\t\tRECENT: 'N',\n\t\t\tMENU: 'N',\n\t\t});\n\t}\n}\n","import { Event } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Popup } from 'main.popup';\n\nimport { EVENTS } from '../../mini-card';\n\nexport class EventService\n{\n\tregisterChildPopup(eventEmitter: EventEmitter, popup: Popup): void\n\t{\n\t\tconst popupContainer = popup.getPopupContainer();\n\n\t\tEvent.bind(popupContainer, 'mouseenter', () => {\n\t\t\teventEmitter.emit(EVENTS.INTERNAL_ON_MOUSE_ENTER_CHILD_POPUP);\n\t\t});\n\n\t\tEvent.bind(popupContainer, 'mouseleave', () => {\n\t\t\teventEmitter.emit(EVENTS.INTERNAL_ON_MOUSE_LEAVE_CHILD_POPUP);\n\t\t});\n\n\t\teventEmitter.subscribe(EVENTS.INTERNAL_ON_CLOSE_MAIN_POPUP, () => {\n\t\t\tpopup.close();\n\t\t});\n\t}\n}\n","import { ActivityEditorService } from './service/activity-editor-service';\nimport { CommunicationService } from './service/communication-service';\nimport { EventService } from './service/event-service';\n\nexport class ServiceLocator\n{\n\tstatic #instance = null;\n\n\t#activityEditorService = null;\n\t#communicationService = null;\n\t#eventService = null;\n\n\tstatic getInstance(): ServiceLocator\n\t{\n\t\tthis.#instance = new ServiceLocator();\n\n\t\treturn this.#instance;\n\t}\n\n\tgetActivityEditorService(): ActivityEditorService\n\t{\n\t\tthis.#activityEditorService ??= new ActivityEditorService();\n\n\t\treturn this.#activityEditorService;\n\t}\n\n\tgetCommunicationService(): CommunicationService\n\t{\n\t\tthis.#communicationService ??= new CommunicationService();\n\n\t\treturn this.#communicationService;\n\t}\n\n\tgetEventService(): EventService\n\t{\n\t\tthis.#eventService ??= new EventService();\n\n\t\treturn this.#eventService;\n\t}\n}\n","import { BitrixVueComponentProps } from 'ui.vue3';\n\nimport './show-more.css';\n\nexport const ShowMore: BitrixVueComponentProps = {\n\tname: 'ShowMore',\n\n\tprops: {\n\t\tcount: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tcomputed: {\n\t\tshowMoreTitle(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('CRM_MINI_CARD_SHOW_MORE', {\n\t\t\t\t'#COUNT#': this.count,\n\t\t\t});\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<span class=\"crm-mini-card__show-more\">\n\t\t\t{{ showMoreTitle }}\n\t\t</span>\n\t`,\n};\n","import { BitrixVueComponentProps } from 'ui.vue3';\nimport { Menu, type MenuOptions } from 'main.popup';\n\nimport { ServiceLocator } from '../../../lib/service-locator';\nimport { ShowMore } from './show-more';\n\nexport const ShowMoreMenu: BitrixVueComponentProps = {\n\tname: 'ShowMoreMenu',\n\n\tcomponents: {\n\t\tShowMore,\n\t},\n\n\tprops: {\n\t\titems: {\n\t\t\t/** @type MenuOptions[] */\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\t/** @type Menu */\n\t\t\tmenu: null,\n\t\t};\n\t},\n\n\tmethods: {\n\t\tgetMenu(): Menu\n\t\t{\n\t\t\tif (this.menu === null)\n\t\t\t{\n\t\t\t\tthis.menu = new Menu({\n\t\t\t\t\titems: this.items,\n\t\t\t\t\tbindElement: this.$refs.showMoreContainer.$el,\n\t\t\t\t\tangle: {\n\t\t\t\t\t\toffset: this.$refs.showMoreContainer.$el.offsetWidth / 2,\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tServiceLocator\n\t\t\t\t\t.getInstance()\n\t\t\t\t\t.getEventService()\n\t\t\t\t\t.registerChildPopup(this.$Bitrix.eventEmitter, this.menu.getPopupWindow());\n\t\t\t}\n\n\t\t\treturn this.menu;\n\t\t},\n\n\t\ttoggleMenu(): void\n\t\t{\n\t\t\tthis.getMenu().toggle();\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<ShowMore ref=\"showMoreContainer\" :count=\"items.length\" @click=\"toggleMenu\"/>\n\t`,\n};\n","import { BitrixVueComponentProps } from 'ui.vue3';\nimport { type MenuOptions } from 'main.popup';\n\nimport {\n\tField,\n\tFieldTitle,\n\tFieldValue,\n\tFieldValueList,\n\tValueEllipsis,\n} from '../../layout/index';\n\nimport { ShowMoreMenu } from '../../show-more/show-more-menu';\n\ndeclare type Phone = {\n\tvalue: string,\n\thref: string,\n\tonclick: string,\n};\n\nconst SHOWABLE_PHONES_LIMIT = 2;\n\nimport './phone-field.css';\n\nexport const PhoneField: BitrixVueComponentProps = {\n\tname: 'PhoneField',\n\n\tcomponents: {\n\t\tField,\n\t\tFieldTitle,\n\t\tFieldValue,\n\t\tFieldValueList,\n\t\tValueEllipsis,\n\t\tShowMoreMenu,\n\t},\n\n\tprops: {\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\t/** @type Phone[] */\n\t\tphones: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tcomputed: {\n\t\tshowablePhones(): Phone[]\n\t\t{\n\t\t\treturn this.phones.slice(0, SHOWABLE_PHONES_LIMIT);\n\t\t},\n\t\thiddenPhones(): Phone[]\n\t\t{\n\t\t\treturn this.phones.slice(SHOWABLE_PHONES_LIMIT);\n\t\t},\n\t\thiddenPhoneItems(): MenuOptions[]\n\t\t{\n\t\t\treturn this.hiddenPhones.map((phone: Phone): MenuOptions => {\n\t\t\t\treturn {\n\t\t\t\t\ttext: phone.value,\n\t\t\t\t\thref: phone.href,\n\t\t\t\t\tonclick: phone.onclick,\n\t\t\t\t};\n\t\t\t});\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<Field class=\"--phone\">\n\t\t\t<FieldTitle>{{ title }}</FieldTitle>\n\t\t\t<FieldValueList>\n\t\t\t\t<FieldValue v-for=\"phone in showablePhones\">\n\t\t\t\t\t<a class=\"--value-link\" :href=\"phone.href\" :onclick=\"phone.onclick\">\n\t\t\t\t\t\t<ValueEllipsis :title=\"phone.value\">{{ phone.value }}</ValueEllipsis>\n\t\t\t\t\t</a>\n\t\t\t\t</FieldValue>\n\t\t\t\t<ShowMoreMenu\n\t\t\t\t\tv-if=\"hiddenPhones.length > 0\"\n\t\t\t\t\t:items=\"hiddenPhoneItems\" \n\t\t\t\t/>\n\t\t\t</FieldValueList>\n\t\t</Field>\n\t`,\n};\n","import { BitrixVueComponentProps } from 'ui.vue3';\nimport { type MenuOptions } from 'main.popup';\n\nimport {\n\tField,\n\tFieldTitle,\n\tFieldValue,\n\tFieldValueList,\n\tValueEllipsis,\n} from '../../layout/index';\nimport { ShowMoreMenu } from '../../show-more/show-more-menu';\nimport { ServiceLocator } from '../../../../lib/service-locator';\n\ndeclare type Email = {\n\tvalue: String,\n\townerTypeId: number,\n\townerId: number,\n};\n\nconst SHOWABLE_EMAILS_LIMIT = 2;\n\nimport './email-field.css';\n\nexport const EmailField: BitrixVueComponentProps = {\n\tname: 'EmailField',\n\tcomponents: {\n\t\tField,\n\t\tFieldTitle,\n\t\tFieldValue,\n\t\tFieldValueList,\n\t\tValueEllipsis,\n\n\t\tShowMoreMenu,\n\t},\n\tprops: {\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\temails: {\n\t\t\t/** @type Email[] */\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed: {\n\t\tshowableEmails(): Email[]\n\t\t{\n\t\t\treturn this.emails.slice(0, SHOWABLE_EMAILS_LIMIT);\n\t\t},\n\t\thiddenEmails(): Email[]\n\t\t{\n\t\t\treturn this.emails.slice(SHOWABLE_EMAILS_LIMIT);\n\t\t},\n\t\thiddenEmailItems(): MenuOptions[]\n\t\t{\n\t\t\treturn this.hiddenEmails.map((email: Email) => {\n\t\t\t\treturn {\n\t\t\t\t\ttext: email.value,\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tthis.addEmail(email);\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t});\n\t\t},\n\t},\n\tmethods: {\n\t\taddEmail(email: Email): void\n\t\t{\n\t\t\tvoid ServiceLocator\n\t\t\t\t.getInstance()\n\t\t\t\t.getCommunicationService()\n\t\t\t\t.communicateByEmail({\n\t\t\t\t\temail: email.value,\n\t\t\t\t\townerTypeId: email.ownerTypeId,\n\t\t\t\t\townerId: email.ownerId,\n\t\t\t\t\tentityTypeId: email.ownerTypeId,\n\t\t\t\t\tentityId: email.ownerId,\n\t\t\t\t\tactivityEditorContainer: this.$refs.activityEditorContainer,\n\t\t\t\t})\n\t\t\t;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Field class=\"--email\">\n\t\t\t<FieldTitle>{{ title }}</FieldTitle>\n\t\t\t<FieldValueList>\n\t\t\t\t<FieldValue v-for=\"email in showableEmails\">\n\t\t\t\t\t<a class=\"--value-link\" @click=\"addEmail(email)\">\n\t\t\t\t\t\t<ValueEllipsis :title=\"email.value\">{{ email.value }}</ValueEllipsis>\n\t\t\t\t\t</a>\n\t\t\t\t</FieldValue>\n\t\t\t\t<ShowMoreMenu\n\t\t\t\t\tv-if=\"hiddenEmails.length > 0\"\n\t\t\t\t\t:items=\"hiddenEmailItems\"\n\t\t\t\t/>\n\t\t\t</FieldValueList>\n\t\t\t<div ref=\"activityEditorContainer\" hidden></div>\n\t\t</Field>\n\t`,\n};\n","import { BitrixVueComponentProps } from 'ui.vue3';\nimport { type MenuOptions } from 'main.popup';\n\nimport {\n\tField,\n\tFieldTitle,\n\tFieldValue,\n\tFieldValueList,\n\tValueEllipsis,\n} from '../../layout/index';\n\nimport { ShowMoreMenu } from '../../show-more/show-more-menu';\n\ndeclare type Link = {\n\thref: string,\n\ttitle: string,\n\ttarget: string,\n};\n\nconst SHOWABLE_LINKS_LIMIT = 2;\n\nimport './link-field.css';\n\nexport const LinkField: BitrixVueComponentProps = {\n\tname: 'LinkField',\n\tcomponents: {\n\t\tField,\n\t\tFieldTitle,\n\t\tFieldValueList,\n\t\tFieldValue,\n\t\tValueEllipsis,\n\t\tShowMoreMenu,\n\t},\n\tprops: {\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tlinks: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed: {\n\t\tshowableLinks(): Link[]\n\t\t{\n\t\t\treturn this.links.slice(0, SHOWABLE_LINKS_LIMIT);\n\t\t},\n\t\thiddenLinks(): Link[]\n\t\t{\n\t\t\treturn this.links.slice(SHOWABLE_LINKS_LIMIT);\n\t\t},\n\t\thiddenLinkItems(): MenuOptions[]\n\t\t{\n\t\t\treturn this.hiddenLinks.map((link: Link) => {\n\t\t\t\treturn {\n\t\t\t\t\ttext: link.title,\n\t\t\t\t\thref: link.href,\n\t\t\t\t\ttarget: link.target,\n\t\t\t\t};\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Field class=\"--link\">\n\t\t\t<FieldTitle>{{ title }}</FieldTitle>\n\t\t\t<FieldValueList>\n\t\t\t\t<FieldValue v-for=\"link in showableLinks\">\n\t\t\t\t\t<a\n\t\t\t\t\t\tclass=\"--value-link\"\n\t\t\t\t\t\t:href=\"link.href\"\n\t\t\t\t\t\t:target=\"link.target\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<ValueEllipsis :title=\"link.title\">{{ link.title }}</ValueEllipsis>\n\t\t\t\t\t</a>\n\t\t\t\t</FieldValue>\n\t\t\t\t<ShowMoreMenu\n\t\t\t\t\tv-if=\"hiddenLinks.length > 0\"\n\t\t\t\t\t:items=\"hiddenLinkItems\"\n\t\t\t\t/>\n\t\t\t</FieldValueList>\n\t\t</Field>\n\t`,\n};\n","import { BitrixVueComponentProps } from 'ui.vue3';\n\nimport {\n\tField,\n\tFieldTitle,\n\tFieldValue,\n\tFieldValueList,\n\tValueEllipsis,\n} from '../../layout/index';\n\nimport './money-field.css';\n\nexport const MoneyField: BitrixVueComponentProps = {\n\tname: 'MoneyField',\n\tcomponents: {\n\t\tField,\n\t\tFieldTitle,\n\t\tFieldValueList,\n\t\tFieldValue,\n\t\tValueEllipsis,\n\t},\n\tprops: {\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tmoneyList: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Field class=\"--money\">\n\t\t\t<FieldTitle>{{ title }}</FieldTitle>\n\t\t\t<FieldValueList>\n\t\t\t\t<FieldValue v-for=\"money in moneyList\">\n\t\t\t\t\t<ValueEllipsis v-html=\"money\"/>\n\t\t\t\t</FieldValue>\n\t\t\t</FieldValueList>\n\t\t</Field>\n\t`,\n};\n","import { BitrixVueComponentProps } from 'ui.vue3';\n\nimport {\n\tField,\n\tFieldTitle,\n\tFieldValue,\n\tValueEllipsis,\n} from '../../layout/index';\n\ndeclare type StageItem = {\n\tname: string,\n\tcolor: string,\n};\n\nimport './stage-field.css';\n\nexport const StageField: BitrixVueComponentProps = {\n\tname: 'StageField',\n\tcomponents: {\n\t\tField,\n\t\tFieldTitle,\n\t\tFieldValue,\n\t\tValueEllipsis,\n\t},\n\tprops: {\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tstage: {\n\t\t\t/** @type StageItem */\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<Field class=\"--stage\">\n\t\t\t<FieldTitle>{{ title }}</FieldTitle>\n\t\t\t<FieldValue>\n\t\t\t\t<div class=\"crm-mini-card__stage-color\" :style=\"{ backgroundColor: stage.color }\"></div>\n\t\t\t\t<ValueEllipsis :title=\"stage.name\">{{ stage.name }}</ValueEllipsis>\n\t\t\t</FieldValue>\n\t\t</Field>\n\t`,\n};\n","import { BitrixVueComponentProps } from 'ui.vue3';\nimport { Text } from 'main.core';\nimport { Button, ButtonSize, AirButtonStyle, type ButtonOptions } from 'ui.buttons';\nimport { Outline } from 'ui.icon-set.api.core';\nimport { ServiceLocator } from '../../../../../lib/service-locator';\n\nconst CommunicationType = Object.freeze({\n\tPhone: 'PHONE',\n\tEmail: 'EMAIL',\n\tIm: 'IM',\n});\n\ndeclare type CommunicationTypeValue = $Values<typeof CommunicationType>;\n\nexport const BUTTON_CONFIGURATION: Object<CommunicationTypeValue, ButtonOptions> = Object.freeze({\n\t[CommunicationType.Phone]: {\n\t\ticon: Outline.PHONE_UP,\n\t\tremoveRightCorners: true,\n\t},\n\t[CommunicationType.Email]: {\n\t\ticon: Outline.MAIL,\n\t\tremoveLeftCorners: true,\n\t\tremoveRightCorners: true,\n\t},\n\t[CommunicationType.Im]: {\n\t\ticon: Outline.OPEN_CHANNELS,\n\t\tremoveLeftCorners: true,\n\t},\n});\n\nexport type Communication = {\n\ttypeId: string,\n\tvalueTypeCaption: string,\n\tvalueType: string,\n\tvalue: string,\n};\n\nexport type Entity = {\n\tentityTypeId: number,\n\tentityId: number,\n\townerTypeId: number,\n\townerId: number,\n};\n\nexport const CommunicationControl: BitrixVueComponentProps = {\n\tname: 'CommunicationControl',\n\n\tprops: {\n\t\tcommunications: {\n\t\t\t/** @type Communication[] */\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tentity: {\n\t\t\t/** @type Entity */\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tbuttons: null,\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tCommunicationType,\n\t\t\tcommunicationsByType: {\n\t\t\t\t[CommunicationType.Phone]: this.filterCommunication(CommunicationType.Phone),\n\t\t\t\t[CommunicationType.Email]: this.filterCommunication(CommunicationType.Email),\n\t\t\t\t[CommunicationType.Im]: this.filterCommunication(CommunicationType.Im),\n\t\t\t},\n\t\t};\n\t},\n\n\tmounted(): void\n\t{\n\t\tthis.createButton(CommunicationType.Phone);\n\t\tthis.createButton(CommunicationType.Email);\n\t\tthis.createButton(CommunicationType.Im);\n\t},\n\n\tmethods: {\n\t\tcreateButton(typeId: CommunicationTypeValue): Button\n\t\t{\n\t\t\tconst communicationButtonOptions = BUTTON_CONFIGURATION[typeId];\n\t\t\tconst communicationsByType = this.communicationsByType[typeId];\n\n\t\t\tconst buttonOptions: ButtonOptions = {\n\t\t\t\tsize: ButtonSize.EXTRA_SMALL,\n\t\t\t\tstyle: AirButtonStyle.OUTLINE,\n\t\t\t\tuseAirDesign: true,\n\t\t\t\tdropdown: false,\n\t\t\t\t...communicationButtonOptions,\n\t\t\t};\n\n\t\t\tif (communicationsByType.length === 1)\n\t\t\t{\n\t\t\t\tbuttonOptions.onclick = () => {\n\t\t\t\t\tthis.communicate(communicationsByType[0]);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (communicationsByType.length > 1)\n\t\t\t{\n\t\t\t\tbuttonOptions.menu = {\n\t\t\t\t\titems: communicationsByType.map((communication: Communication) => {\n\t\t\t\t\t\tconst itemHtmlContent = this.$Bitrix.Loc.getMessage('CRM_MINI_CARD_FIELD_CLIENT_COMMUNICATION_CONTROL_MENU_ITEM')\n\t\t\t\t\t\t\t.replace('#VALUE#', Text.encode(communication.value))\n\t\t\t\t\t\t\t.replace('[VALUE_TYPE_TAG]', '<span style=\"opacity: .5;\">')\n\t\t\t\t\t\t\t.replace('#VALUE_TYPE#', Text.encode(communication.valueTypeCaption))\n\t\t\t\t\t\t\t.replace('[/VALUE_TYPE_TAG]', '</span>')\n\t\t\t\t\t\t;\n\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\thtml: `<span>${itemHtmlContent}</span>`,\n\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\tthis.communicate(communication);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t};\n\t\t\t\t\t}),\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tconst button = new Button(buttonOptions);\n\n\t\t\tif (communicationsByType.length === 0)\n\t\t\t{\n\t\t\t\tbutton.setDisabled(true);\n\t\t\t\tbutton.setState(Button.State.DISABLED);\n\t\t\t}\n\n\t\t\tconst menuWindow = button.getMenuWindow();\n\t\t\tif (menuWindow)\n\t\t\t{\n\t\t\t\tServiceLocator\n\t\t\t\t\t.getInstance()\n\t\t\t\t\t.getEventService()\n\t\t\t\t\t.registerChildPopup(this.$Bitrix.eventEmitter, menuWindow.getPopupWindow());\n\t\t\t}\n\n\t\t\tbutton.renderTo(this.$refs[typeId]);\n\n\t\t\tthis.buttons ??= {};\n\t\t\tthis.buttons[typeId] = button;\n\t\t},\n\t\tcommunicate(communication: Communication): void\n\t\t{\n\t\t\tconst communicationService = ServiceLocator.getInstance().getCommunicationService();\n\n\t\t\tif (communication.typeId === CommunicationType.Phone)\n\t\t\t{\n\t\t\t\tcommunicationService\n\t\t\t\t\t.communicateByPhone({\n\t\t\t\t\t\tphone: communication.value,\n\t\t\t\t\t\tentityTypeId: this.entity.entityTypeId,\n\t\t\t\t\t\tentityId: this.entity.entityId,\n\t\t\t\t\t\townerTypeId: this.entity.ownerTypeId,\n\t\t\t\t\t\townerId: this.entity.ownerId,\n\t\t\t\t\t})\n\t\t\t\t;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (communication.typeId === CommunicationType.Email)\n\t\t\t{\n\t\t\t\tthis.buttons[CommunicationType.Email].setState(Button.State.WAITING);\n\n\t\t\t\tvoid communicationService\n\t\t\t\t\t.communicateByEmail({\n\t\t\t\t\t\temail: communication.value,\n\t\t\t\t\t\townerTypeId: this.entity.ownerTypeId,\n\t\t\t\t\t\townerId: this.entity.ownerId,\n\t\t\t\t\t\tentityTypeId: this.entity.entityTypeId,\n\t\t\t\t\t\tentityId: this.entity.entityId,\n\t\t\t\t\t\tactivityEditorContainer: this.$refs.activityEditorContainer,\n\t\t\t\t\t})\n\t\t\t\t\t.finally(() => {\n\t\t\t\t\t\tthis.buttons[CommunicationType.Email].setState(null);\n\t\t\t\t\t})\n\t\t\t\t;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (communication.typeId === CommunicationType.Im)\n\t\t\t{\n\t\t\t\tcommunicationService\n\t\t\t\t\t.communicateByIM({\n\t\t\t\t\t\tdialogId: communication.value,\n\t\t\t\t\t})\n\t\t\t\t;\n\t\t\t}\n\t\t},\n\t\tfilterCommunication(typeId: CommunicationTypeValue): Communication[]\n\t\t{\n\t\t\treturn this.communications.filter((communication: Communication) => communication.typeId === typeId);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"crm-mini-card__communication-control\">\n\t\t\t<div class=\"crm-mini-card__communication-phone\" :ref=\"CommunicationType.Phone\"></div>\n\t\t\t<div class=\"crm-mini-card__communication-mail\" :ref=\"CommunicationType.Email\"></div>\n\t\t\t<div class=\"crm-mini-card__communication-im\" :ref=\"CommunicationType.Im\"></div>\n\t\t\t<div hidden ref=\"activityEditorContainer\"></div>\n\t\t</div>\n\t`,\n};\n","import { BitrixVueComponentProps } from 'ui.vue3';\nimport { Text, Event } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport { MiniCardItem } from '../lib/model/mini-card-item';\nimport { Loader } from './loader/loader';\nimport { MiniCardContent } from './mini-card-content';\nimport { EVENTS } from '../mini-card';\n\nimport '../styles.css';\n\n// @vue/component\nexport const MiniCardComponent: BitrixVueComponentProps = {\n\tname: 'MiniCardComponent',\n\n\tcomponents: {\n\t\tMiniCardContent,\n\t\tLoader,\n\t},\n\n\tprops: {\n\t\tstate: {\n\t\t\ttype: Object,\n\t\t\tdefault: () => {\n\t\t\t\treturn {\n\t\t\t\t\tappId: Text.getRandom(16),\n\t\t\t\t\tminiCardItem: null,\n\t\t\t\t\tisLoaded: false,\n\t\t\t\t\tpopup: null,\n\t\t\t\t};\n\t\t\t},\n\t\t},\n\t},\n\n\tcomputed: {\n\t\tminiCardItem(): ?MiniCardItem\n\t\t{\n\t\t\treturn this.state.miniCardItem;\n\t\t},\n\n\t\tisLoading(): boolean\n\t\t{\n\t\t\treturn !this.state.isLoaded;\n\t\t},\n\t},\n\n\tmounted(): void\n\t{\n\t\tthis.subscribeInternalEvents();\n\t},\n\n\tmethods: {\n\t\tsubscribeInternalEvents() {\n\t\t\tthis.$Bitrix.eventEmitter.subscribe(\n\t\t\t\tEVENTS.INTERNAL_ON_MOUSE_ENTER_CHILD_POPUP,\n\t\t\t\tthis.onMouseEnterChildPopup.bind(this),\n\t\t\t);\n\n\t\t\tthis.$Bitrix.eventEmitter.subscribe(\n\t\t\t\tEVENTS.INTERNAL_ON_MOUSE_LEAVE_CHILD_POPUP,\n\t\t\t\tthis.onMouseLeaveChildPopup.bind(this),\n\t\t\t);\n\n\t\t\tEvent.EventEmitter.subscribe(EVENTS.GLOBAL_ON_CLOSE_MAIN_POPUP, this.onCloseMainPopup.bind(this));\n\t\t},\n\n\t\tonCloseMainPopup(event: BaseEvent): void\n\t\t{\n\t\t\tconst appId = event.getData().appId;\n\t\t\tif (appId !== this.state.appId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$Bitrix.eventEmitter.emit(EVENTS.INTERNAL_ON_CLOSE_MAIN_POPUP);\n\t\t},\n\n\t\tonMouseEnterChildPopup(): void\n\t\t{\n\t\t\tconst event = new BaseEvent({\n\t\t\t\tdata: {\n\t\t\t\t\tappId: this.state.appId,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tEvent.EventEmitter.emit(EVENTS.GLOBAL_ON_MOUSE_ENTER_CHILD_POPUP, event);\n\t\t},\n\n\t\tonMouseLeaveChildPopup(): void\n\t\t{\n\t\t\tconst event = new BaseEvent({\n\t\t\t\tdata: {\n\t\t\t\t\tappId: this.state.appId,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tEvent.EventEmitter.emit(EVENTS.GLOBAL_ON_MOUSE_LEAVE_CHILD_POPUP, event);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"crm-mini-card\">\n\t\t\t<Loader v-if=\"isLoading\" />\n\t\t\t<MiniCardContent v-else-if=\"miniCardItem !== null\" :mini-card=\"miniCardItem\" :popup=\"state.popup\" />\n\t\t</div>\n\t`,\n};\n","import { BitrixVueComponentProps } from 'ui.vue3';\nimport { MiniCardItem } from '../lib/model/mini-card-item';\n\nimport { ImageAvatar } from './avatar/avatar-list/image-avatar/image-avatar';\nimport { IconAvatar } from './avatar/avatar-list/icon-avatar/icon-avatar';\n\nimport { ButtonControl } from './control/control-list/button-control/button-control';\n\nimport { CommonField } from './field/field-list/common-field/common-field';\nimport { PhoneField } from './field/field-list/phone-field/phone-field';\nimport { EmailField } from './field/field-list/email-field/email-field';\nimport { LinkField } from './field/field-list/link-field/link-field';\nimport { MoneyField } from './field/field-list/money-field/money-field';\nimport { StageField } from './field/field-list/stage-field/stage-field';\nimport { ClientField } from './field/field-list/client-field/client-field';\nimport { ProductField } from './field/field-list/product-field/product-field';\n\nimport { CommonFooterNote } from './footer-note/footer-note-list/common-footer-note/common-footer-note';\n\nexport const MiniCardContent: BitrixVueComponentProps = {\n\tname: 'MiniCardContent',\n\n\tcomponents: {\n\t\tImageAvatar,\n\t\tIconAvatar,\n\n\t\tButtonControl,\n\n\t\tCommonField,\n\t\tPhoneField,\n\t\tEmailField,\n\t\tLinkField,\n\t\tMoneyField,\n\t\tStageField,\n\t\tClientField,\n\t\tProductField,\n\n\t\tCommonFooterNote,\n\t},\n\n\tprops: {\n\t\tminiCard: {\n\t\t\ttype: MiniCardItem,\n\t\t\trequired: true,\n\t\t},\n\t\tpopup: {\n\t\t\ttype: Object,\n\t\t\tdefault: () => null,\n\t\t},\n\t},\n\n\tmounted()\n\t{\n\t\tthis.adjustPopup();\n\t},\n\n\tmethods: {\n\t\tadjustPopup(): void\n\t\t{\n\t\t\tif (!this.popup)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.popup.adjustPosition({\n\t\t\t\tforceBindPosition: true,\n\t\t\t\tforceTop: true,\n\t\t\t});\n\n\t\t\tthis.popup.bindOptions = {\n\t\t\t\tforceBindPosition: true,\n\t\t\t};\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"crm-mini-card-content\" :id=\"miniCard.id()\">\n\t\t\t<div class=\"crm-mini-card-content__header\">\n\t\t\t\t<div class=\"crm-mini-card-content__header-info\">\n\t\t\t\t\t<div class=\"crm-mini-card-content__header-icon\">\n\t\t\t\t\t\t<component :is=\"miniCard.avatar().componentName()\" v-bind=\"miniCard.avatar().componentProps()\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"crm-mini-card-content__header-title\">\n\t\t\t\t\t\t{{ miniCard.title() }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"crm-mini-card-content__header-control-container\">\n\t\t\t\t\t<div class=\"crm-mini-card-content__header-control-list\">\n\t\t\t\t\t\t<div class=\"crm-mini-card-content__header-control-item\" v-for=\"control in miniCard.controls()\">\n\t\t\t\t\t\t\t<component :is=\"control.componentName()\" v-bind=\"control.componentProps()\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"crm-mini-card-content__body\">\n\t\t\t\t<div class=\"crm-mini-card-content__body-field-container\">\n\t\t\t\t\t<div class=\"crm-mini-card-content__body-field-list\">\n\t\t\t\t\t\t<div class=\"crm-mini-card-content__body-field-item\" v-for=\"field in miniCard.fields()\">\n\t\t\t\t\t\t\t<component :is=\"field.componentName()\" v-bind=\"field.componentProps()\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"crm-mini-card-content__footer\">\n\t\t\t\t<div class=\"crm-mini-card-content__footer-notes-list\">\n\t\t\t\t\t<div v-for=\"footerNote in miniCard.footerNotes()\" class=\"crm-mini-card-content__footer-note-item\">\n\t\t\t\t\t\t<component :is=\"footerNote.componentName()\" v-bind=\"footerNote.componentProps()\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { BitrixVueComponentProps } from 'ui.vue3';\n\nimport {\n\tField,\n\tFieldValue,\n\tFieldValueList,\n\tFieldTitle,\n\tValueEllipsis,\n} from '../../layout/index';\n\nimport { CommunicationControl } from './components/communication-control';\n\ndeclare type Entity = {\n\tentityTypeId: number,\n\tentityId: number,\n\townerTypeId: number,\n\townerId: number,\n};\n\ndeclare type Client = {\n\tfullName: string,\n\topenUrl: string,\n\tcommunications: Array,\n\tentity: Entity,\n};\n\nimport './client-field.css';\n\nexport const ClientField: BitrixVueComponentProps = {\n\tname: 'ClientField',\n\n\tcomponents: {\n\t\tField,\n\t\tFieldTitle,\n\t\tFieldValue,\n\t\tFieldValueList,\n\t\tValueEllipsis,\n\n\t\tCommunicationControl,\n\t},\n\n\tprops: {\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tclients: {\n\t\t\t/** @type Array<Client> */\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tcomputed: {\n\t\tclientsWithOpenUrlFirst(): Client[]\n\t\t{\n\t\t\treturn this.clients.sort((client: Client) => {\n\t\t\t\tif (client.openUrl === null)\n\t\t\t\t{\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\n\t\t\t\treturn 0;\n\t\t\t});\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<Field class=\"--client\">\n\t\t\t<FieldTitle>{{ title }}</FieldTitle>\n\t\t\t<FieldValueList>\n\t\t\t\t<FieldValue v-for=\"client in clientsWithOpenUrlFirst\">\n\t\t\t\t\t<ValueEllipsis\n\t\t\t\t\t\tv-if=\"client.openUrl === null\"\n\t\t\t\t\t\t:title=\"client.fullName\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ client.fullName }}\n\t\t\t\t\t</ValueEllipsis>\n\t\t\t\t\t<a v-else class=\"--value-link\" :href=\"client.openUrl\">\n\t\t\t\t\t\t<ValueEllipsis :title=\"client.fullName\">{{ client.fullName }}</ValueEllipsis>\n\t\t\t\t\t</a>\n\n\t\t\t\t\t<CommunicationControl\n\t\t\t\t\t\tv-if=\"client.entity !== null\"\n\t\t\t\t\t\t:communications=\"client.communications\"\n\t\t\t\t\t\t:entity=\"client.entity\"\n\t\t\t\t\t/>\n\t\t\t\t</FieldValue>\n\t\t\t</FieldValueList>\n\t\t</Field>\n\t`,\n};\n","import { BitrixVueComponentProps } from 'ui.vue3';\nimport { Type } from 'main.core';\n\nimport {\n\tField,\n\tFieldTitle,\n\tFieldValue,\n\tFieldValueList,\n\tValueEllipsis,\n} from '../../layout/index';\n\nimport { ShowMore } from '../../show-more/show-more';\n\ndeclare type Product = {\n\ttitle: string,\n\turl: string,\n};\n\nexport const ProductField: BitrixVueComponentProps = {\n\tname: 'ProductField',\n\tcomponents: {\n\t\tField,\n\t\tFieldTitle,\n\t\tFieldValue,\n\t\tFieldValueList,\n\t\tValueEllipsis,\n\t\tShowMore,\n\t},\n\tprops: {\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tproducts: {\n\t\t\t/** @type Product[] */\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tproductsLeftCount: Number,\n\t\tproductsLeftUrl: String,\n\t},\n\tcomputed: {\n\t\tisDisplayShowMore(): boolean\n\t\t{\n\t\t\treturn Type.isNumber(this.productsLeftCount)\n\t\t\t\t&& this.productsLeftCount > 0\n\t\t\t\t&& Type.isStringFilled(this.productsLeftUrl);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Field class=\"--product\">\n\t\t\t<FieldTitle>{{ title }}</FieldTitle>\n\t\t\t<FieldValueList>\n\t\t\t\t<FieldValue v-for=\"product in products\">\n\t\t\t\t\t<a class=\"--value-link\" :href=\"product.url\">\n\t\t\t\t\t\t<ValueEllipsis :title=\"product.title\">{{ product.title }}</ValueEllipsis>\n\t\t\t\t\t</a>\n\t\t\t\t</FieldValue>\n\t\t\t\t<a\n\t\t\t\t\tv-if=\"isDisplayShowMore\"\n\t\t\t\t\t:href=\"productsLeftUrl\"\n\t\t\t\t>\n\t\t\t\t\t<ShowMore :count=\"productsLeftCount\" />\n\t\t\t\t</a>\n\t\t\t</FieldValueList>\n\t\t</Field>\n\t`,\n};\n","import { BitrixVueComponentProps } from 'ui.vue3';\n\nimport { FooterNote } from '../../layout/footer-note/footer-note';\n\nimport './common-footer-note.css';\n\nexport const CommonFooterNote: BitrixVueComponentProps = {\n\tname: 'CommonFooterNote',\n\n\tcomponents: {\n\t\tFooterNote,\n\t},\n\n\tprops: {\n\t\tcontent: String,\n\t},\n\n\ttemplate: `\n\t\t<FooterNote class=\"--common\">\n\t\t\t{{ content }}\n\t\t</FooterNote>\n\t`,\n};\n","import { BitrixVueComponentProps } from 'ui.vue3';\n\nimport './footer-note.css';\n\nexport const FooterNote: BitrixVueComponentProps = {\n\tname: 'FooterNote',\n\ttemplate: `\n\t\t<div class=\"crm-mini-card-content__footer-note\">\n\t\t\t<slot />\n\t\t</div>\n\t`,\n};\n","import { Event, Tag, Type, Text, Loc } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport { Popup } from 'main.popup';\nimport { UI } from 'ui.notification';\nimport { BitrixVue, VueCreateAppResult, reactive } from 'ui.vue3';\nimport { MiniCardComponent } from './components/mini-card-component';\nimport { MiniCardItem } from './lib/model/mini-card-item';\n\nexport type MiniCardOptions = {\n\tminiCardResolver: Promise<?MiniCard>,\n\tbindElement: HTMLElement,\n};\n\nexport const EVENTS = {\n\tGLOBAL_ON_CLOSE_MAIN_POPUP: 'BX.Crm.MiniCard:OnMainPopupClose',\n\tGLOBAL_ON_MOUSE_ENTER_CHILD_POPUP: 'BX.Crm.MiniCard:onMouseEnterChildPopup',\n\tGLOBAL_ON_MOUSE_LEAVE_CHILD_POPUP: 'BX.Crm.MiniCard:onMouseLeaveChildPopup',\n\tINTERNAL_ON_CLOSE_MAIN_POPUP: 'crm:mini-card:on-close-main-popup',\n\tINTERNAL_ON_MOUSE_ENTER_CHILD_POPUP: 'crm:mini-card:on-mouse-enter-child-popup',\n\tINTERNAL_ON_MOUSE_LEAVE_CHILD_POPUP: 'crm:mini-card:on-mouse-leave-child-popup',\n};\n\nexport class MiniCard\n{\n\t#appId: string;\n\t#miniCardResolver: Promise<?MiniCard>;\n\t#bindElement: HTMLElement;\n\n\t#application: VueCreateAppResult = null;\n\t#popup: Popup = null;\n\t#container: HTMLElement = null;\n\n\t#hidePopupTimeout: number | undefined = undefined;\n\t#showPopupTimeout: number | undefined = undefined;\n\n\t#state: {\n\t\tappId: string,\n\t\tminiCardItem: ?MiniCardItem,\n\t\tisLoaded: boolean,\n\t};\n\n\tconstructor(options: MiniCardOptions)\n\t{\n\t\tthis.#appId = Text.getRandom(16);\n\t\tthis.#setBindElement(options.bindElement);\n\t\tthis.#setMiniCardResolver(options.miniCardResolver);\n\n\t\tthis.#state = reactive({\n\t\t\tappId: this.#appId,\n\t\t\tminiCardItem: null,\n\t\t\tisLoaded: false,\n\t\t\tpopup: null,\n\t\t});\n\n\t\tthis.#initializeSipManager();\n\t\tthis.#bindEvents();\n\t}\n\n\t#setBindElement(bindElement: HTMLElement): void\n\t{\n\t\tif (!Type.isElementNode(bindElement))\n\t\t{\n\t\t\tthrow new RangeError('BX.Crm.MiniCard: bindElement must be an element node');\n\t\t}\n\n\t\tthis.#bindElement = bindElement;\n\t}\n\n\t#setMiniCardResolver(miniCardResolver: Promise<?MiniCardItem>): void\n\t{\n\t\tthis.#miniCardResolver = miniCardResolver;\n\t}\n\n\tpopup(): Popup\n\t{\n\t\tif (this.#popup !== null)\n\t\t{\n\t\t\treturn this.#popup;\n\t\t}\n\n\t\tthis.#popup = new Popup({\n\t\t\tbindElement: this.#bindElement,\n\t\t\tcontent: this.container(),\n\t\t\tpadding: 0,\n\t\t\tcloseIcon: true,\n\t\t\tangle: {\n\t\t\t\toffset: 150,\n\t\t\t},\n\t\t\tbindOptions: {\n\t\t\t\tforceBindPosition: true,\n\t\t\t\tforceTop: true,\n\t\t\t},\n\t\t\toffsetLeft: (this.#bindElement.offsetWidth / 2) - 130,\n\t\t\tanimation: 'fading',\n\t\t\tautoHide: true,\n\t\t\tevents: {\n\t\t\t\tonShow: () => {\n\t\t\t\t\tif (this.#state.isLoaded)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvoid this.#miniCardResolver()\n\t\t\t\t\t\t.then((miniCard: ?MiniCardItem) => {\n\t\t\t\t\t\t\tthis.#state.miniCardItem = miniCard;\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\t\tconsole.error('BX.Crm.MiniCard: Error while resolve mini card element', response.errors);\n\n\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\tcontent: Text.encode(response.errors[0].message),\n\t\t\t\t\t\t\t\tautoHideDelay: 3000,\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tthis.popup().destroy();\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.finally(() => {\n\t\t\t\t\t\t\tthis.#state.isLoaded = true;\n\t\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tonClose: () => {\n\t\t\t\t\tclearTimeout(this.#showPopupTimeout);\n\t\t\t\t\tconst event = new BaseEvent({\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tappId: this.#appId,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\n\t\t\t\t\tEvent.EventEmitter.emit(EVENTS.GLOBAL_ON_CLOSE_MAIN_POPUP, event);\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tthis.#state.popup = this.#popup;\n\n\t\tEvent.bind(this.#popup.getPopupContainer(), 'mouseenter', this.#startShowPopup.bind(this));\n\t\tEvent.bind(this.#popup.getPopupContainer(), 'mouseleave', this.#startHidePopup.bind(this));\n\n\t\treturn this.#popup;\n\t}\n\n\t#bindEvents(): void\n\t{\n\t\tEvent.bind(this.#bindElement, 'mouseenter', this.#startShowPopup.bind(this));\n\t\tEvent.bind(this.#bindElement, 'mouseleave', this.#startHidePopup.bind(this));\n\t\tEvent.bind(this.#bindElement, 'click', this.#hidePopup.bind(this));\n\t}\n\n\t#startHidePopup(): void\n\t{\n\t\tclearTimeout(this.#showPopupTimeout);\n\t\tthis.#hidePopupTimeout = setTimeout(() => {\n\t\t\tthis.popup().close();\n\t\t}, 500);\n\t}\n\n\t#startShowPopup(): void\n\t{\n\t\tclearTimeout(this.#hidePopupTimeout);\n\t\tthis.#showPopupTimeout = setTimeout(() => {\n\t\t\tif (Type.isDomNode(this.#bindElement) && document.body.contains(this.#bindElement))\n\t\t\t{\n\t\t\t\tthis.popup().show();\n\t\t\t}\n\t\t}, 1000);\n\t}\n\n\t#hidePopup(): void\n\t{\n\t\tclearTimeout(this.#showPopupTimeout);\n\t\tif (this.popup().isShown())\n\t\t{\n\t\t\tthis.popup().close();\n\t\t}\n\t}\n\n\tcontainer(): HTMLElement\n\t{\n\t\tif (this.#container === null)\n\t\t{\n\t\t\tthis.#container = Tag.render`\n\t\t\t\t<div class=\"crm-mini-card-container\"></div>\n\t\t\t`;\n\n\t\t\tthis.application().mount(this.#container);\n\t\t}\n\n\t\treturn this.#container;\n\t}\n\n\tapplication(): VueCreateAppResult\n\t{\n\t\tif (this.#application === null)\n\t\t{\n\t\t\tthis.#application = BitrixVue.createApp(MiniCardComponent, {\n\t\t\t\tstate: this.#state,\n\t\t\t});\n\n\t\t\tEvent.EventEmitter.subscribe(EVENTS.GLOBAL_ON_MOUSE_ENTER_CHILD_POPUP, (event: BaseEvent) => {\n\t\t\t\tconst data = event.getData();\n\t\t\t\tif (data.appId !== this.#appId)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.#startShowPopup();\n\t\t\t});\n\n\t\t\tEvent.EventEmitter.subscribe(EVENTS.GLOBAL_ON_MOUSE_LEAVE_CHILD_POPUP, (event: BaseEvent) => {\n\t\t\t\tconst data = event.getData();\n\t\t\t\tif (data.appId !== this.#appId)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.#startHidePopup();\n\t\t\t});\n\t\t}\n\n\t\treturn this.#application;\n\t}\n\n\t#initializeSipManager(): void\n\t{\n\t\tif (!window.BXIM || !BX.CrmSipManager)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!BX.CrmSipManager.messages)\n\t\t{\n\t\t\tBX.CrmSipManager.messages = {\n\t\t\t\tunknownRecipient: Loc.getMessage('CRM_SIP_MGR_UNKNOWN_RECIPIENT'),\n\t\t\t\tmakeCall: Loc.getMessage('CRM_SIP_MGR_MAKE_CALL'),\n\t\t\t};\n\t\t}\n\n\t\tconst sipMgr = BX.CrmSipManager.getCurrent();\n\n\t\t// eslint-disable-next-line @bitrix24/bitrix24-rules/no-bx\n\t\tconst sessid = BX.bitrix_sessid();\n\n\t\tsipMgr.setServiceUrl(\n\t\t\t'CRM_LEAD',\n\t\t\t`/bitrix/components/bitrix/crm.lead.show/ajax.php?sessid=${sessid}`,\n\t\t);\n\n\t\tsipMgr.setServiceUrl(\n\t\t\t'CRM_CONTACT',\n\t\t\t`/bitrix/components/bitrix/crm.contact.show/ajax.php?sessid=${sessid}`,\n\t\t);\n\n\t\tsipMgr.setServiceUrl(\n\t\t\t'CRM_COMPANY',\n\t\t\t`/bitrix/components/bitrix/crm.company.show/ajax.php?sessid=${sessid}`,\n\t\t);\n\t}\n}\n","import { Type, ajax as Ajax } from 'main.core';\nimport { MiniCardItem } from './lib/model/mini-card-item';\nimport { MiniCard } from './mini-card';\n\nconst EntityTypeEnum = BX.CrmEntityType.enumeration;\nconst EntityType = BX.CrmEntityType;\n\nexport type EntityMiniCardOptions = {\n\tentityTypeId: number,\n\tentityId: number,\n\tbindElement: HTMLElement,\n};\n\nexport class EntityMiniCard\n{\n\t#entityTypeId: number;\n\t#entityId: number;\n\t#bindElement: HTMLElement;\n\n\t#miniCard: MiniCard;\n\n\tconstructor(options: EntityMiniCardOptions)\n\t{\n\t\tthis.#setEntityTypeId(options.entityTypeId);\n\t\tthis.#setEntityId(options.entityId);\n\t\tthis.#setBindElement(options.bindElement);\n\n\t\tthis.#miniCard = new MiniCard({\n\t\t\tbindElement: this.#bindElement,\n\t\t\tminiCardResolver: this.fetchEntityMiniCard.bind(this),\n\t\t});\n\t}\n\n\tgetMiniCard(): MiniCard\n\t{\n\t\treturn this.#miniCard;\n\t}\n\n\t#setEntityTypeId(entityTypeId: number): void\n\t{\n\t\tconst availableEntityTypeIds = [\n\t\t\tEntityTypeEnum.lead,\n\t\t\tEntityTypeEnum.deal,\n\t\t\tEntityTypeEnum.contact,\n\t\t\tEntityTypeEnum.company,\n\t\t\tEntityTypeEnum.quote,\n\t\t\tEntityTypeEnum.order,\n\t\t\tEntityTypeEnum.smartinvoice,\n\t\t];\n\n\t\tconst isAvailableEntityType = availableEntityTypeIds.includes(entityTypeId)\n\t\t\t|| EntityType.isDynamicTypeByTypeId(entityTypeId);\n\n\t\tif (!Type.isNumber(entityTypeId))\n\t\t{\n\t\t\tthrow new RangeError(`BX.Crm.EntityMiniCard: entityTypeId ${entityTypeId} must be number`);\n\t\t}\n\n\t\tif (!isAvailableEntityType)\n\t\t{\n\t\t\tthrow new RangeError(`BX.Crm.EntityMiniCard: entityTypeId ${entityTypeId} is not supported`);\n\t\t}\n\n\t\tthis.#entityTypeId = entityTypeId;\n\t}\n\n\t#setEntityId(entityId: number): void\n\t{\n\t\tif (!Type.isNumber(entityId) || entityId <= 0)\n\t\t{\n\t\t\tthrow new RangeError('BX.Crm.EntityMiniCard: entityId must be a number and greater than 0');\n\t\t}\n\n\t\tthis.#entityId = entityId;\n\t}\n\n\t#setBindElement(element: HTMLElement): void\n\t{\n\t\tif (!Type.isElementNode(element))\n\t\t{\n\t\t\tthrow new RangeError('BX.Crm.EntityMiniCard: bindElement must be an element node');\n\t\t}\n\n\t\tthis.#bindElement = element;\n\t}\n\n\tasync fetchEntityMiniCard(): Promise<?MiniCardItem>\n\t{\n\t\tconst config = {\n\t\t\tdata: {\n\t\t\t\tentityTypeId: this.#entityTypeId,\n\t\t\t\tentityId: this.#entityId,\n\t\t\t},\n\t\t};\n\n\t\tconst response = await Ajax.runAction('crm.item.minicard.get', config);\n\t\tif (response?.data)\n\t\t{\n\t\t\treturn new MiniCardItem(response.data);\n\t\t}\n\n\t\treturn null;\n\t}\n}\n"],"names":["Component","constructor","options","Object","writable","value","Type","isStringFilled","componentName","RangeError","isPlainObject","componentProps","babelHelpers","this","MiniCardItem","id","Text","getRandom","title","avatar","controls","forEach","controlOptions","push","fields","fieldOptions","footerNotes","footerNoteOptions","Loader","name","template","Avatar","ImageAvatar","components","props","url","type","String","required","computed","encodeUri","encodeURI","IconAvatar","BIcon","iconOptions","bgColor","default","containerStyles","styleBgColor","backgroundColor","methods","startsWith","ButtonControl","Control","buttonOptions","mounted","Button","renderTo","$refs","button","$el","Field","FieldTitle","FieldValue","FieldValueList","ValueEllipsis","CommonField","values","Array","ActivityEditorService","[object Object]","ownerTypeId","ownerId","activityEditorContainer","_babelHelpers$classPr","editorId","response","Ajax","runAction","data","Runtime","html","_response$data","_babelHelpers$classPr2","BX","CrmActivityEditor","items","error","console","_babelHelpers$classPr4","getDefault","CommunicationService","communicateByPhone","window","top","BXIM","MessageBox","alert","Loc","getMessage","phoneToParams","ENTITY_TYPE_NAME","CrmEntityType","resolveName","entityTypeId","ENTITY_ID","entityId","BINDINGS","OWNER_TYPE_NAME","OWNER_TYPE_ID","phoneTo","phone","communicateByEmail","Promise","resolve","reject","ServiceLocator","getInstance","getActivityEditorService","loadActivityEditor","then","editor","addEmail","ownerID","ownerType","communicationsLoaded","communications","entityType","email","location","href","catch","communicateByIM","openMessengerSlider","dialogId","RECENT","MENU","EventService","registerChildPopup","eventEmitter","popup","popupContainer","getPopupContainer","Event","bind","emit","EVENTS","INTERNAL_ON_MOUSE_ENTER_CHILD_POPUP","INTERNAL_ON_MOUSE_LEAVE_CHILD_POPUP","subscribe","INTERNAL_ON_CLOSE_MAIN_POPUP","close","getCommunicationService","getEventService","ShowMore","count","Number","showMoreTitle","$Bitrix","#COUNT#","ShowMoreMenu","menu","getMenu","Menu","bindElement","showMoreContainer","angle","offset","offsetWidth","getPopupWindow","toggleMenu","toggle","PhoneField","phones","showablePhones","slice","hiddenPhones","hiddenPhoneItems","map","text","onclick","EmailField","emails","showableEmails","hiddenEmails","hiddenEmailItems","LinkField","links","showableLinks","hiddenLinks","hiddenLinkItems","link","target","MoneyField","moneyList","StageField","stage","CommunicationType","freeze","Phone","Email","Im","BUTTON_CONFIGURATION","icon","Outline","PHONE_UP","removeRightCorners","MAIL","removeLeftCorners","OPEN_CHANNELS","MiniCardComponent","MiniCardContent","ClientField","CommunicationControl","entity","buttons","communicationsByType","filterCommunication","createButton","typeId","communicationButtonOptions","size","ButtonSize","EXTRA_SMALL","style","AirButtonStyle","OUTLINE","useAirDesign","dropdown","length","communicate","communication","replace","encode","valueTypeCaption","setDisabled","setState","State","DISABLED","menuWindow","getMenuWindow","communicationService","WAITING","finally","filter","clients","clientsWithOpenUrlFirst","sort","client","openUrl","ProductField","products","productsLeftCount","productsLeftUrl","isDisplayShowMore","isNumber","CommonFooterNote","FooterNote","content","miniCard","adjustPopup","adjustPosition","forceBindPosition","forceTop","bindOptions","state","appId","miniCardItem","isLoaded","isLoading","subscribeInternalEvents","onMouseEnterChildPopup","onMouseLeaveChildPopup","EventEmitter","GLOBAL_ON_CLOSE_MAIN_POPUP","onCloseMainPopup","event","getData","BaseEvent","GLOBAL_ON_MOUSE_ENTER_CHILD_POPUP","GLOBAL_ON_MOUSE_LEAVE_CHILD_POPUP","MiniCard","undefined","miniCardResolver","reactive","Popup","container","padding","closeIcon","offsetLeft","animation","autoHide","events","onShow","errors","UI","Notification","Center","notify","message","autoHideDelay","destroy","onClose","clearTimeout","Tag","render","application","mount","BitrixVue","createApp","isElementNode","setTimeout","isDomNode","document","body","contains","show","isShown","CrmSipManager","messages","unknownRecipient","makeCall","sipMgr","getCurrent","sessid","bitrix_sessid","setServiceUrl","EntityTypeEnum","enumeration","EntityType","isAvailableEntityType","lead","deal","contact","company","quote","order","smartinvoice","includes","isDynamicTypeByTypeId","element","fetchEntityMiniCard","getMiniCard","config"],"mappings":"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"}