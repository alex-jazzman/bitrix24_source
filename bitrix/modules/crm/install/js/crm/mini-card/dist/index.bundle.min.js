this.BX=this.BX||{},function(e,t,i,s,l,n,a,o,r,d,c,p){"use strict";var m=babelHelpers.classPrivateFieldLooseKey("componentName"),u=babelHelpers.classPrivateFieldLooseKey("componentProps");class b{constructor(e){if(Object.defineProperty(this,m,{writable:!0,value:void 0}),Object.defineProperty(this,u,{writable:!0,value:void 0}),!p.Type.isStringFilled(e.componentName))throw new RangeError("BX.Crm.MiniCard.Component: options.componentName must be a string filled");if(!p.Type.isPlainObject(e.componentProps))throw new RangeError("BX.Crm.MiniCard.Component: options.componentProps must be a plain object");babelHelpers.classPrivateFieldLooseBase(this,m)[m]=e.componentName,babelHelpers.classPrivateFieldLooseBase(this,u)[u]=e.componentProps}componentName(){return babelHelpers.classPrivateFieldLooseBase(this,m)[m]}componentProps(){return babelHelpers.classPrivateFieldLooseBase(this,u)[u]}}var v=babelHelpers.classPrivateFieldLooseKey("id"),h=babelHelpers.classPrivateFieldLooseKey("title"),P=babelHelpers.classPrivateFieldLooseKey("avatar"),y=babelHelpers.classPrivateFieldLooseKey("controls"),L=babelHelpers.classPrivateFieldLooseKey("fields"),F=babelHelpers.classPrivateFieldLooseKey("footerNotes");class E{constructor(e){if(Object.defineProperty(this,v,{writable:!0,value:void 0}),Object.defineProperty(this,h,{writable:!0,value:void 0}),Object.defineProperty(this,P,{writable:!0,value:void 0}),Object.defineProperty(this,y,{writable:!0,value:void 0}),Object.defineProperty(this,L,{writable:!0,value:void 0}),Object.defineProperty(this,F,{writable:!0,value:void 0}),babelHelpers.classPrivateFieldLooseBase(this,v)[v]=p.Type.isStringFilled(e.id)?e.id:p.Text.getRandom(16),!p.Type.isStringFilled(e.title))throw new RangeError("BX.Crm.MiniCard.MiniCardItem: options.title must be a string filled");babelHelpers.classPrivateFieldLooseBase(this,h)[h]=e.title,babelHelpers.classPrivateFieldLooseBase(this,P)[P]=new b(e.avatar),babelHelpers.classPrivateFieldLooseBase(this,y)[y]=[],e.controls.forEach((e=>{babelHelpers.classPrivateFieldLooseBase(this,y)[y].push(new b(e))})),babelHelpers.classPrivateFieldLooseBase(this,L)[L]=[],e.fields.forEach((e=>{babelHelpers.classPrivateFieldLooseBase(this,L)[L].push(new b(e))})),babelHelpers.classPrivateFieldLooseBase(this,F)[F]=[],e.footerNotes.forEach((e=>{babelHelpers.classPrivateFieldLooseBase(this,F)[F].push(new b(e))}))}id(){return babelHelpers.classPrivateFieldLooseBase(this,v)[v]}title(){return babelHelpers.classPrivateFieldLooseBase(this,h)[h]}avatar(){return babelHelpers.classPrivateFieldLooseBase(this,P)[P]}controls(){return babelHelpers.classPrivateFieldLooseBase(this,y)[y]}fields(){return babelHelpers.classPrivateFieldLooseBase(this,L)[L]}footerNotes(){return babelHelpers.classPrivateFieldLooseBase(this,F)[F]}}const C={name:"Loader",template:'\n\t\t<div class="crm-mini-card__loader"></div>\n\t'},B={name:"Avatar",template:'\n\t\t<div class="crm-mini-card__avatar">\n\t\t\t<slot />\n\t\t</div>\n\t'},_={name:"ImageAvatar",components:{Avatar:B},props:{url:{type:String,required:!0}},computed:{encodeUri(){return encodeURI(this.url)}},template:'\n\t\t<Avatar class="--image">\n\t\t\t<img :src="encodeUri" alt=""/>\n\t\t</Avatar>\n\t'},I={name:"IconAvatar",components:{BIcon:i.BIcon,Avatar:B},props:{iconOptions:{type:Object,required:!0},bgColor:{type:String,default:null}},computed:{containerStyles(){const e=this.styleBgColor();return null===e?{}:{backgroundColor:e}}},methods:{styleBgColor(){return this.bgColor?this.bgColor.startsWith("--")?`var(${this.bgColor})`:this.bgColor:null}},template:'\n\t\t<Avatar class="--icon" :style="containerStyles">\n\t\t\t<BIcon v-bind="iconOptions" />\n\t\t</Avatar>\n\t'},f={name:"ButtonControl",components:{Control:{name:"Control",template:'\n\t\t<div class="crm-mini-card__control">\n\t\t\t<slot />\n\t\t</div>\n\t'}},props:{buttonOptions:{type:Object,required:!0}},mounted(){new r.Button(this.buttonOptions).renderTo(this.$refs.button.$el)},template:'\n\t\t<Control class="--button" ref="button" />\n\t'},H={template:'\n\t\t<div class="crm-mini-card__field">\n\t\t\t<slot />\n\t\t</div>\n\t'},M={template:'\n\t\t<div class="crm-mini-card__field-title">\n\t\t\t<slot />\n\t\t</div>\n\t'},T={template:'\n\t\t<div class="crm-mini-card__field-value">\n\t\t\t<slot />\n\t\t</div>\n\t'},O={template:'\n\t\t<div class="crm-mini-card__field-value-list">\n\t\t\t<slot />\n\t\t</div>\n\t'},g={name:"ValueEllipsis",template:'\n\t\t<span class="crm-mini-card__value-ellipsis">\n\t\t\t<slot/>\n\t\t</span>\n\t'},w={name:"CommonField",components:{Field:H,FieldTitle:M,FieldValueList:O,FieldValue:T,ValueEllipsis:g},props:{title:{type:String,required:!0},values:{type:Array,required:!0}},template:'\n\t\t<Field class="--common">\n\t\t\t<FieldTitle>{{ title }}</FieldTitle>\n\t\t\t<FieldValueList>\n\t\t\t\t<FieldValue v-for="value in values">\n\t\t\t\t\t<ValueEllipsis :title="value">{{ value }}</ValueEllipsis>\n\t\t\t\t</FieldValue>\n\t\t\t</FieldValueList>\n\t\t</Field>\n\t'};var N=babelHelpers.classPrivateFieldLooseKey("cache");class S{constructor(){Object.defineProperty(this,N,{writable:!0,value:void 0}),babelHelpers.classPrivateFieldLooseBase(this,N)[N]={}}async loadActivityEditor(e,t,i){var s;if(null!=(s=babelHelpers.classPrivateFieldLooseBase(this,N)[N][e])&&s[t])return babelHelpers.classPrivateFieldLooseBase(this,N)[N][e][t];const l=p.Text.getRandom(16);try{var n,a,o;const s=await p.ajax.runAction("crm.item.minicard.getActivityEditor",{data:{ownerTypeId:e,ownerId:t,editorId:l}});await p.Runtime.html(i,null!=(n=null==s||null==(a=s.data)?void 0:a.html)?n:""),null!=(o=babelHelpers.classPrivateFieldLooseBase(this,N)[N])[e]||(o[e]={}),babelHelpers.classPrivateFieldLooseBase(this,N)[N][e][t]=BX.CrmActivityEditor.items[l]}catch(i){var r;console.error("BX.Crm.MiniCard.ActivityEditorService: Cannot load activity editor:",i),null!=(r=babelHelpers.classPrivateFieldLooseBase(this,N)[N])[e]||(r[e]={}),babelHelpers.classPrivateFieldLooseBase(this,N)[N][e][t]=BX.CrmActivityEditor.getDefault()}return babelHelpers.classPrivateFieldLooseBase(this,N)[N][e][t]}}class A{communicateByPhone(e){if(!window.top.BXIM)return void n.MessageBox.alert(p.Loc.getMessage("CRM_MINI_CARD_COMMUNICATION_PHONE_NOT_SUPPORTS"));const t={ENTITY_TYPE_NAME:BX.CrmEntityType.resolveName(e.entityTypeId),ENTITY_ID:e.entityId};e.ownerTypeId!==e.entityTypeId&&e.ownerId!==e.entityId&&(t.BINDINGS={OWNER_TYPE_NAME:BX.CrmEntityType.resolveName(e.ownerTypeId),OWNER_TYPE_ID:e.ownerTypeId}),window.top.BXIM.phoneTo(e.phone,t)}communicateByEmail(e){return new Promise(((t,i)=>{K.getInstance().getActivityEditorService().loadActivityEditor(e.ownerTypeId,e.ownerId,e.activityEditorContainer).then((s=>{s||(n.MessageBox.alert(p.Loc.getMessage("CRM_MINI_CARD_COMMUNICATION_EMAIL_NOT_SUPPORTS")),i());s.addEmail({ownerID:e.ownerId,ownerType:BX.CrmEntityType.resolveName(e.ownerTypeId),communicationsLoaded:!0,communications:[{type:"EMAIL",entityType:BX.CrmEntityType.resolveName(e.entityTypeId),entityId:e.entityId,value:e.email}]})||(window.location.href="mailto:"+e.email),t()})).catch((()=>{i()}))}))}communicateByIM(e){window.top.BXIM?window.top.BXIM.openMessengerSlider(e.dialogId,{RECENT:"N",MENU:"N"}):n.MessageBox.alert(p.Loc.getMessage("CRM_MINI_CARD_COMMUNICATION_IM_NOT_SUPPORTS"))}}class V{registerChildPopup(e,t){const i=t.getPopupContainer();p.Event.bind(i,"mouseenter",(()=>{e.emit(ee.INTERNAL_ON_MOUSE_ENTER_CHILD_POPUP)})),p.Event.bind(i,"mouseleave",(()=>{e.emit(ee.INTERNAL_ON_MOUSE_LEAVE_CHILD_POPUP)})),e.subscribe(ee.INTERNAL_ON_CLOSE_MAIN_POPUP,(()=>{t.close()}))}}var U=babelHelpers.classPrivateFieldLooseKey("instance"),R=babelHelpers.classPrivateFieldLooseKey("activityEditorService"),j=babelHelpers.classPrivateFieldLooseKey("communicationService"),X=babelHelpers.classPrivateFieldLooseKey("eventService");class K{constructor(){Object.defineProperty(this,R,{writable:!0,value:null}),Object.defineProperty(this,j,{writable:!0,value:null}),Object.defineProperty(this,X,{writable:!0,value:null})}static getInstance(){return babelHelpers.classPrivateFieldLooseBase(this,U)[U]=new K,babelHelpers.classPrivateFieldLooseBase(this,U)[U]}getActivityEditorService(){var e;return null!=(e=babelHelpers.classPrivateFieldLooseBase(this,R))[R]||(e[R]=new S),babelHelpers.classPrivateFieldLooseBase(this,R)[R]}getCommunicationService(){var e;return null!=(e=babelHelpers.classPrivateFieldLooseBase(this,j))[j]||(e[j]=new A),babelHelpers.classPrivateFieldLooseBase(this,j)[j]}getEventService(){var e;return null!=(e=babelHelpers.classPrivateFieldLooseBase(this,X))[X]||(e[X]=new V),babelHelpers.classPrivateFieldLooseBase(this,X)[X]}}Object.defineProperty(K,U,{writable:!0,value:null});const k={name:"ShowMore",props:{count:{type:Number,required:!0}},computed:{showMoreTitle(){return this.$Bitrix.Loc.getMessage("CRM_MINI_CARD_SHOW_MORE",{"#COUNT#":this.count})}},template:'\n\t\t<span class="crm-mini-card__show-more">\n\t\t\t{{ showMoreTitle }}\n\t\t</span>\n\t'},D={name:"ShowMoreMenu",components:{ShowMore:k},props:{items:{type:Array,required:!0}},data:()=>({menu:null}),methods:{getMenu(){return null===this.menu&&(this.menu=new o.Menu({items:this.items,bindElement:this.$refs.showMoreContainer.$el,angle:{offset:this.$refs.showMoreContainer.$el.offsetWidth/2}}),K.getInstance().getEventService().registerChildPopup(this.$Bitrix.eventEmitter,this.menu.getPopupWindow())),this.menu},toggleMenu(){this.getMenu().toggle()}},template:'\n\t\t<ShowMore ref="showMoreContainer" :count="items.length" @click="toggleMenu"/>\n\t'},x={name:"PhoneField",components:{Field:H,FieldTitle:M,FieldValue:T,FieldValueList:O,ValueEllipsis:g,ShowMoreMenu:D},props:{title:{type:String,required:!0},phones:{type:Array,required:!0}},computed:{showablePhones(){return this.phones.slice(0,2)},hiddenPhones(){return this.phones.slice(2)},hiddenPhoneItems(){return this.hiddenPhones.map((e=>({text:e.value,href:e.href,onclick:e.onclick})))}},template:'\n\t\t<Field class="--phone">\n\t\t\t<FieldTitle>{{ title }}</FieldTitle>\n\t\t\t<FieldValueList>\n\t\t\t\t<FieldValue v-for="phone in showablePhones">\n\t\t\t\t\t<a class="--value-link" :href="phone.href" :onclick="phone.onclick">\n\t\t\t\t\t\t<ValueEllipsis :title="phone.value">{{ phone.value }}</ValueEllipsis>\n\t\t\t\t\t</a>\n\t\t\t\t</FieldValue>\n\t\t\t\t<ShowMoreMenu\n\t\t\t\t\tv-if="hiddenPhones.length > 0"\n\t\t\t\t\t:items="hiddenPhoneItems" \n\t\t\t\t/>\n\t\t\t</FieldValueList>\n\t\t</Field>\n\t'},q={name:"EmailField",components:{Field:H,FieldTitle:M,FieldValue:T,FieldValueList:O,ValueEllipsis:g,ShowMoreMenu:D},props:{title:{type:String,required:!0},emails:{type:Array,required:!0}},computed:{showableEmails(){return this.emails.slice(0,2)},hiddenEmails(){return this.emails.slice(2)},hiddenEmailItems(){return this.hiddenEmails.map((e=>({text:e.value,onclick:()=>{this.addEmail(e)}})))}},methods:{addEmail(e){K.getInstance().getCommunicationService().communicateByEmail({email:e.value,ownerTypeId:e.ownerTypeId,ownerId:e.ownerId,entityTypeId:e.ownerTypeId,entityId:e.ownerId,activityEditorContainer:this.$refs.activityEditorContainer})}},template:'\n\t\t<Field class="--email">\n\t\t\t<FieldTitle>{{ title }}</FieldTitle>\n\t\t\t<FieldValueList>\n\t\t\t\t<FieldValue v-for="email in showableEmails">\n\t\t\t\t\t<a class="--value-link" @click="addEmail(email)">\n\t\t\t\t\t\t<ValueEllipsis :title="email.value">{{ email.value }}</ValueEllipsis>\n\t\t\t\t\t</a>\n\t\t\t\t</FieldValue>\n\t\t\t\t<ShowMoreMenu\n\t\t\t\t\tv-if="hiddenEmails.length > 0"\n\t\t\t\t\t:items="hiddenEmailItems"\n\t\t\t\t/>\n\t\t\t</FieldValueList>\n\t\t\t<div ref="activityEditorContainer" hidden></div>\n\t\t</Field>\n\t'},$={name:"LinkField",components:{Field:H,FieldTitle:M,FieldValueList:O,FieldValue:T,ValueEllipsis:g,ShowMoreMenu:D},props:{title:{type:String,required:!0},links:{type:Array,required:!0}},computed:{showableLinks(){return this.links.slice(0,2)},hiddenLinks(){return this.links.slice(2)},hiddenLinkItems(){return this.hiddenLinks.map((e=>({text:e.title,href:e.href,target:e.target})))}},template:'\n\t\t<Field class="--link">\n\t\t\t<FieldTitle>{{ title }}</FieldTitle>\n\t\t\t<FieldValueList>\n\t\t\t\t<FieldValue v-for="link in showableLinks">\n\t\t\t\t\t<a\n\t\t\t\t\t\tclass="--value-link"\n\t\t\t\t\t\t:href="link.href"\n\t\t\t\t\t\t:target="link.target"\n\t\t\t\t\t>\n\t\t\t\t\t\t<ValueEllipsis :title="link.title">{{ link.title }}</ValueEllipsis>\n\t\t\t\t\t</a>\n\t\t\t\t</FieldValue>\n\t\t\t\t<ShowMoreMenu\n\t\t\t\t\tv-if="hiddenLinks.length > 0"\n\t\t\t\t\t:items="hiddenLinkItems"\n\t\t\t\t/>\n\t\t\t</FieldValueList>\n\t\t</Field>\n\t'},G={name:"MoneyField",components:{Field:H,FieldTitle:M,FieldValueList:O,FieldValue:T,ValueEllipsis:g},props:{title:{type:String,required:!0},moneyList:{type:Array,required:!0}},template:'\n\t\t<Field class="--money">\n\t\t\t<FieldTitle>{{ title }}</FieldTitle>\n\t\t\t<FieldValueList>\n\t\t\t\t<FieldValue v-for="money in moneyList">\n\t\t\t\t\t<ValueEllipsis v-html="money"/>\n\t\t\t\t</FieldValue>\n\t\t\t</FieldValueList>\n\t\t</Field>\n\t'},W={name:"StageField",components:{Field:H,FieldTitle:M,FieldValue:T,ValueEllipsis:g},props:{title:{type:String,required:!0},stage:{type:Object,required:!0}},template:'\n\t\t<Field class="--stage">\n\t\t\t<FieldTitle>{{ title }}</FieldTitle>\n\t\t\t<FieldValue>\n\t\t\t\t<div class="crm-mini-card__stage-color" :style="{ backgroundColor: stage.color }"></div>\n\t\t\t\t<ValueEllipsis :title="stage.name">{{ stage.name }}</ValueEllipsis>\n\t\t\t</FieldValue>\n\t\t</Field>\n\t'},Y=Object.freeze({Phone:"PHONE",Email:"EMAIL",Im:"IM"}),z=Object.freeze({[Y.Phone]:{icon:d.Outline.PHONE_UP,removeRightCorners:!0},[Y.Email]:{icon:d.Outline.MAIL,removeLeftCorners:!0,removeRightCorners:!0},[Y.Im]:{icon:d.Outline.OPEN_CHANNELS,removeLeftCorners:!0}}),J={name:"MiniCardComponent",components:{MiniCardContent:{name:"MiniCardContent",components:{ImageAvatar:_,IconAvatar:I,ButtonControl:f,CommonField:w,PhoneField:x,EmailField:q,LinkField:$,MoneyField:G,StageField:W,ClientField:{name:"ClientField",components:{Field:H,FieldTitle:M,FieldValue:T,FieldValueList:O,ValueEllipsis:g,CommunicationControl:{name:"CommunicationControl",props:{communications:{type:Array,required:!0},entity:{type:Object,required:!0}},buttons:null,data(){return{CommunicationType:Y,communicationsByType:{[Y.Phone]:this.filterCommunication(Y.Phone),[Y.Email]:this.filterCommunication(Y.Email),[Y.Im]:this.filterCommunication(Y.Im)}}},mounted(){this.createButton(Y.Phone),this.createButton(Y.Email),this.createButton(Y.Im)},methods:{createButton(e){const t=z[e],i=this.communicationsByType[e],s={size:r.ButtonSize.EXTRA_SMALL,style:r.AirButtonStyle.OUTLINE,useAirDesign:!0,dropdown:!1,...t};1===i.length&&(s.onclick=()=>{this.communicate(i[0])}),i.length>1&&(s.menu={items:i.map((e=>({html:`<span>${this.$Bitrix.Loc.getMessage("CRM_MINI_CARD_FIELD_CLIENT_COMMUNICATION_CONTROL_MENU_ITEM").replace("#VALUE#",p.Text.encode(e.value)).replace("[VALUE_TYPE_TAG]",'<span style="opacity: .5;">').replace("#VALUE_TYPE#",p.Text.encode(e.valueTypeCaption)).replace("[/VALUE_TYPE_TAG]","</span>")}</span>`,onclick:()=>{this.communicate(e)}})))});const l=new r.Button(s);0===i.length&&(l.setDisabled(!0),l.setState(r.Button.State.DISABLED));const n=l.getMenuWindow();n&&K.getInstance().getEventService().registerChildPopup(this.$Bitrix.eventEmitter,n.getPopupWindow()),l.renderTo(this.$refs[e]),null!=this.buttons||(this.buttons={}),this.buttons[e]=l},communicate(e){const t=K.getInstance().getCommunicationService();if(e.typeId!==Y.Phone)return e.typeId===Y.Email?(this.buttons[Y.Email].setState(r.Button.State.WAITING),void t.communicateByEmail({email:e.value,ownerTypeId:this.entity.ownerTypeId,ownerId:this.entity.ownerId,entityTypeId:this.entity.entityTypeId,entityId:this.entity.entityId,activityEditorContainer:this.$refs.activityEditorContainer}).finally((()=>{this.buttons[Y.Email].setState(null)}))):void(e.typeId===Y.Im&&t.communicateByIM({dialogId:e.value}));t.communicateByPhone({phone:e.value,entityTypeId:this.entity.entityTypeId,entityId:this.entity.entityId,ownerTypeId:this.entity.ownerTypeId,ownerId:this.entity.ownerId})},filterCommunication(e){return this.communications.filter((t=>t.typeId===e))}},template:'\n\t\t<div class="crm-mini-card__communication-control">\n\t\t\t<div class="crm-mini-card__communication-phone" :ref="CommunicationType.Phone"></div>\n\t\t\t<div class="crm-mini-card__communication-mail" :ref="CommunicationType.Email"></div>\n\t\t\t<div class="crm-mini-card__communication-im" :ref="CommunicationType.Im"></div>\n\t\t\t<div hidden ref="activityEditorContainer"></div>\n\t\t</div>\n\t'}},props:{title:{type:String,required:!0},clients:{type:Array,required:!0}},computed:{clientsWithOpenUrlFirst(){return this.clients.sort((e=>null===e.openUrl?1:0))}},template:'\n\t\t<Field class="--client">\n\t\t\t<FieldTitle>{{ title }}</FieldTitle>\n\t\t\t<FieldValueList>\n\t\t\t\t<FieldValue v-for="client in clientsWithOpenUrlFirst">\n\t\t\t\t\t<ValueEllipsis\n\t\t\t\t\t\tv-if="client.openUrl === null"\n\t\t\t\t\t\t:title="client.fullName"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ client.fullName }}\n\t\t\t\t\t</ValueEllipsis>\n\t\t\t\t\t<a v-else class="--value-link" :href="client.openUrl">\n\t\t\t\t\t\t<ValueEllipsis :title="client.fullName">{{ client.fullName }}</ValueEllipsis>\n\t\t\t\t\t</a>\n\n\t\t\t\t\t<CommunicationControl\n\t\t\t\t\t\tv-if="client.entity !== null"\n\t\t\t\t\t\t:communications="client.communications"\n\t\t\t\t\t\t:entity="client.entity"\n\t\t\t\t\t/>\n\t\t\t\t</FieldValue>\n\t\t\t</FieldValueList>\n\t\t</Field>\n\t'},ProductField:{name:"ProductField",components:{Field:H,FieldTitle:M,FieldValue:T,FieldValueList:O,ValueEllipsis:g,ShowMore:k},props:{title:{type:String,required:!0},products:{type:Array,required:!0},productsLeftCount:Number,productsLeftUrl:String},computed:{isDisplayShowMore(){return p.Type.isNumber(this.productsLeftCount)&&this.productsLeftCount>0&&p.Type.isStringFilled(this.productsLeftUrl)}},template:'\n\t\t<Field class="--product">\n\t\t\t<FieldTitle>{{ title }}</FieldTitle>\n\t\t\t<FieldValueList>\n\t\t\t\t<FieldValue v-for="product in products">\n\t\t\t\t\t<a class="--value-link" :href="product.url">\n\t\t\t\t\t\t<ValueEllipsis :title="product.title">{{ product.title }}</ValueEllipsis>\n\t\t\t\t\t</a>\n\t\t\t\t</FieldValue>\n\t\t\t\t<a\n\t\t\t\t\tv-if="isDisplayShowMore"\n\t\t\t\t\t:href="productsLeftUrl"\n\t\t\t\t>\n\t\t\t\t\t<ShowMore :count="productsLeftCount" />\n\t\t\t\t</a>\n\t\t\t</FieldValueList>\n\t\t</Field>\n\t'},CommonFooterNote:{name:"CommonFooterNote",components:{FooterNote:{name:"FooterNote",template:'\n\t\t<div class="crm-mini-card-content__footer-note">\n\t\t\t<slot />\n\t\t</div>\n\t'}},props:{content:String},template:'\n\t\t<FooterNote class="--common">\n\t\t\t{{ content }}\n\t\t</FooterNote>\n\t'}},props:{miniCard:{type:E,required:!0},popup:{type:Object,default:()=>null}},mounted(){this.adjustPopup()},methods:{adjustPopup(){this.popup&&(this.popup.adjustPosition({forceBindPosition:!0,forceTop:!0}),this.popup.bindOptions={forceBindPosition:!0})}},template:'\n\t\t<div class="crm-mini-card-content" :id="miniCard.id()">\n\t\t\t<div class="crm-mini-card-content__header">\n\t\t\t\t<div class="crm-mini-card-content__header-info">\n\t\t\t\t\t<div class="crm-mini-card-content__header-icon">\n\t\t\t\t\t\t<component :is="miniCard.avatar().componentName()" v-bind="miniCard.avatar().componentProps()" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="crm-mini-card-content__header-title">\n\t\t\t\t\t\t{{ miniCard.title() }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="crm-mini-card-content__header-control-container">\n\t\t\t\t\t<div class="crm-mini-card-content__header-control-list">\n\t\t\t\t\t\t<div class="crm-mini-card-content__header-control-item" v-for="control in miniCard.controls()">\n\t\t\t\t\t\t\t<component :is="control.componentName()" v-bind="control.componentProps()" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="crm-mini-card-content__body">\n\t\t\t\t<div class="crm-mini-card-content__body-field-container">\n\t\t\t\t\t<div class="crm-mini-card-content__body-field-list">\n\t\t\t\t\t\t<div class="crm-mini-card-content__body-field-item" v-for="field in miniCard.fields()">\n\t\t\t\t\t\t\t<component :is="field.componentName()" v-bind="field.componentProps()" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="crm-mini-card-content__footer">\n\t\t\t\t<div class="crm-mini-card-content__footer-notes-list">\n\t\t\t\t\t<div v-for="footerNote in miniCard.footerNotes()" class="crm-mini-card-content__footer-note-item">\n\t\t\t\t\t\t<component :is="footerNote.componentName()" v-bind="footerNote.componentProps()" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'},Loader:C},props:{state:{type:Object,default:()=>({appId:p.Text.getRandom(16),miniCardItem:null,isLoaded:!1,popup:null})}},computed:{miniCardItem(){return this.state.miniCardItem},isLoading(){return!this.state.isLoaded}},mounted(){this.subscribeInternalEvents()},methods:{subscribeInternalEvents(){this.$Bitrix.eventEmitter.subscribe(ee.INTERNAL_ON_MOUSE_ENTER_CHILD_POPUP,this.onMouseEnterChildPopup.bind(this)),this.$Bitrix.eventEmitter.subscribe(ee.INTERNAL_ON_MOUSE_LEAVE_CHILD_POPUP,this.onMouseLeaveChildPopup.bind(this)),p.Event.EventEmitter.subscribe(ee.GLOBAL_ON_CLOSE_MAIN_POPUP,this.onCloseMainPopup.bind(this))},onCloseMainPopup(e){e.getData().appId===this.state.appId&&this.$Bitrix.eventEmitter.emit(ee.INTERNAL_ON_CLOSE_MAIN_POPUP)},onMouseEnterChildPopup(){const e=new a.BaseEvent({data:{appId:this.state.appId}});p.Event.EventEmitter.emit(ee.GLOBAL_ON_MOUSE_ENTER_CHILD_POPUP,e)},onMouseLeaveChildPopup(){const e=new a.BaseEvent({data:{appId:this.state.appId}});p.Event.EventEmitter.emit(ee.GLOBAL_ON_MOUSE_LEAVE_CHILD_POPUP,e)}},template:'\n\t\t<div class="crm-mini-card">\n\t\t\t<Loader v-if="isLoading" />\n\t\t\t<MiniCardContent v-else-if="miniCardItem !== null" :mini-card="miniCardItem" :popup="state.popup" />\n\t\t</div>\n\t'};let Q,Z=e=>e;const ee={GLOBAL_ON_CLOSE_MAIN_POPUP:"BX.Crm.MiniCard:OnMainPopupClose",GLOBAL_ON_MOUSE_ENTER_CHILD_POPUP:"BX.Crm.MiniCard:onMouseEnterChildPopup",GLOBAL_ON_MOUSE_LEAVE_CHILD_POPUP:"BX.Crm.MiniCard:onMouseLeaveChildPopup",INTERNAL_ON_CLOSE_MAIN_POPUP:"crm:mini-card:on-close-main-popup",INTERNAL_ON_MOUSE_ENTER_CHILD_POPUP:"crm:mini-card:on-mouse-enter-child-popup",INTERNAL_ON_MOUSE_LEAVE_CHILD_POPUP:"crm:mini-card:on-mouse-leave-child-popup"};var te=babelHelpers.classPrivateFieldLooseKey("appId"),ie=babelHelpers.classPrivateFieldLooseKey("miniCardResolver"),se=babelHelpers.classPrivateFieldLooseKey("bindElement"),le=babelHelpers.classPrivateFieldLooseKey("application"),ne=babelHelpers.classPrivateFieldLooseKey("popup"),ae=babelHelpers.classPrivateFieldLooseKey("container"),oe=babelHelpers.classPrivateFieldLooseKey("hidePopupTimeout"),re=babelHelpers.classPrivateFieldLooseKey("showPopupTimeout"),de=babelHelpers.classPrivateFieldLooseKey("state"),ce=babelHelpers.classPrivateFieldLooseKey("setBindElement"),pe=babelHelpers.classPrivateFieldLooseKey("setMiniCardResolver"),me=babelHelpers.classPrivateFieldLooseKey("bindEvents"),ue=babelHelpers.classPrivateFieldLooseKey("startHidePopup"),be=babelHelpers.classPrivateFieldLooseKey("startShowPopup"),ve=babelHelpers.classPrivateFieldLooseKey("hidePopup"),he=babelHelpers.classPrivateFieldLooseKey("initializeSipManager");class Pe{constructor(e){Object.defineProperty(this,he,{value:_e}),Object.defineProperty(this,ve,{value:Be}),Object.defineProperty(this,be,{value:Ce}),Object.defineProperty(this,ue,{value:Ee}),Object.defineProperty(this,me,{value:Fe}),Object.defineProperty(this,pe,{value:Le}),Object.defineProperty(this,ce,{value:ye}),Object.defineProperty(this,te,{writable:!0,value:void 0}),Object.defineProperty(this,ie,{writable:!0,value:void 0}),Object.defineProperty(this,se,{writable:!0,value:void 0}),Object.defineProperty(this,le,{writable:!0,value:null}),Object.defineProperty(this,ne,{writable:!0,value:null}),Object.defineProperty(this,ae,{writable:!0,value:null}),Object.defineProperty(this,oe,{writable:!0,value:void 0}),Object.defineProperty(this,re,{writable:!0,value:void 0}),Object.defineProperty(this,de,{writable:!0,value:void 0}),babelHelpers.classPrivateFieldLooseBase(this,te)[te]=p.Text.getRandom(16),babelHelpers.classPrivateFieldLooseBase(this,ce)[ce](e.bindElement),babelHelpers.classPrivateFieldLooseBase(this,pe)[pe](e.miniCardResolver),babelHelpers.classPrivateFieldLooseBase(this,de)[de]=c.reactive({appId:babelHelpers.classPrivateFieldLooseBase(this,te)[te],miniCardItem:null,isLoaded:!1,popup:null}),babelHelpers.classPrivateFieldLooseBase(this,he)[he](),babelHelpers.classPrivateFieldLooseBase(this,me)[me]()}popup(){return null!==babelHelpers.classPrivateFieldLooseBase(this,ne)[ne]||(babelHelpers.classPrivateFieldLooseBase(this,ne)[ne]=new o.Popup({bindElement:babelHelpers.classPrivateFieldLooseBase(this,se)[se],content:this.container(),padding:0,closeIcon:!0,angle:{offset:150},bindOptions:{forceBindPosition:!0,forceTop:!0},offsetLeft:babelHelpers.classPrivateFieldLooseBase(this,se)[se].offsetWidth/2-130,animation:"fading",autoHide:!0,events:{onShow:()=>{babelHelpers.classPrivateFieldLooseBase(this,de)[de].isLoaded||babelHelpers.classPrivateFieldLooseBase(this,ie)[ie]().then((e=>{babelHelpers.classPrivateFieldLooseBase(this,de)[de].miniCardItem=e})).catch((e=>{console.error("BX.Crm.MiniCard: Error while resolve mini card element",e.errors),t.UI.Notification.Center.notify({content:p.Text.encode(e.errors[0].message),autoHideDelay:3e3}),this.popup().destroy()})).finally((()=>{babelHelpers.classPrivateFieldLooseBase(this,de)[de].isLoaded=!0}))},onClose:()=>{clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,re)[re]);const e=new a.BaseEvent({data:{appId:babelHelpers.classPrivateFieldLooseBase(this,te)[te]}});p.Event.EventEmitter.emit(ee.GLOBAL_ON_CLOSE_MAIN_POPUP,e)}}}),babelHelpers.classPrivateFieldLooseBase(this,de)[de].popup=babelHelpers.classPrivateFieldLooseBase(this,ne)[ne],p.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,ne)[ne].getPopupContainer(),"mouseenter",babelHelpers.classPrivateFieldLooseBase(this,be)[be].bind(this)),p.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,ne)[ne].getPopupContainer(),"mouseleave",babelHelpers.classPrivateFieldLooseBase(this,ue)[ue].bind(this))),babelHelpers.classPrivateFieldLooseBase(this,ne)[ne]}container(){return null===babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]&&(babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]=p.Tag.render(Q||(Q=Z`
				<div class="crm-mini-card-container"></div>
			`)),this.application().mount(babelHelpers.classPrivateFieldLooseBase(this,ae)[ae])),babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]}application(){return null===babelHelpers.classPrivateFieldLooseBase(this,le)[le]&&(babelHelpers.classPrivateFieldLooseBase(this,le)[le]=c.BitrixVue.createApp(J,{state:babelHelpers.classPrivateFieldLooseBase(this,de)[de]}),p.Event.EventEmitter.subscribe(ee.GLOBAL_ON_MOUSE_ENTER_CHILD_POPUP,(e=>{e.getData().appId===babelHelpers.classPrivateFieldLooseBase(this,te)[te]&&babelHelpers.classPrivateFieldLooseBase(this,be)[be]()})),p.Event.EventEmitter.subscribe(ee.GLOBAL_ON_MOUSE_LEAVE_CHILD_POPUP,(e=>{e.getData().appId===babelHelpers.classPrivateFieldLooseBase(this,te)[te]&&babelHelpers.classPrivateFieldLooseBase(this,ue)[ue]()}))),babelHelpers.classPrivateFieldLooseBase(this,le)[le]}}function ye(e){if(!p.Type.isElementNode(e))throw new RangeError("BX.Crm.MiniCard: bindElement must be an element node");babelHelpers.classPrivateFieldLooseBase(this,se)[se]=e}function Le(e){babelHelpers.classPrivateFieldLooseBase(this,ie)[ie]=e}function Fe(){p.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,se)[se],"mouseenter",babelHelpers.classPrivateFieldLooseBase(this,be)[be].bind(this)),p.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,se)[se],"mouseleave",babelHelpers.classPrivateFieldLooseBase(this,ue)[ue].bind(this)),p.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,se)[se],"click",babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].bind(this))}function Ee(){clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,re)[re]),babelHelpers.classPrivateFieldLooseBase(this,oe)[oe]=setTimeout((()=>{this.popup().close()}),500)}function Ce(){clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,oe)[oe]),babelHelpers.classPrivateFieldLooseBase(this,re)[re]=setTimeout((()=>{p.Type.isDomNode(babelHelpers.classPrivateFieldLooseBase(this,se)[se])&&document.body.contains(babelHelpers.classPrivateFieldLooseBase(this,se)[se])&&this.popup().show()}),1e3)}function Be(){clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,re)[re]),this.popup().isShown()&&this.popup().close()}function _e(){if(!window.BXIM||!BX.CrmSipManager)return;BX.CrmSipManager.messages||(BX.CrmSipManager.messages={unknownRecipient:p.Loc.getMessage("CRM_SIP_MGR_UNKNOWN_RECIPIENT"),makeCall:p.Loc.getMessage("CRM_SIP_MGR_MAKE_CALL")});const e=BX.CrmSipManager.getCurrent(),t=BX.bitrix_sessid();e.setServiceUrl("CRM_LEAD","/bitrix/components/bitrix/crm.lead.show/ajax.php?sessid="+t),e.setServiceUrl("CRM_CONTACT","/bitrix/components/bitrix/crm.contact.show/ajax.php?sessid="+t),e.setServiceUrl("CRM_COMPANY","/bitrix/components/bitrix/crm.company.show/ajax.php?sessid="+t)}const Ie=BX.CrmEntityType.enumeration,fe=BX.CrmEntityType;var He=babelHelpers.classPrivateFieldLooseKey("entityTypeId"),Me=babelHelpers.classPrivateFieldLooseKey("entityId"),Te=babelHelpers.classPrivateFieldLooseKey("bindElement"),Oe=babelHelpers.classPrivateFieldLooseKey("miniCard"),ge=babelHelpers.classPrivateFieldLooseKey("setEntityTypeId"),we=babelHelpers.classPrivateFieldLooseKey("setEntityId"),Ne=babelHelpers.classPrivateFieldLooseKey("setBindElement");function Se(e){const t=[Ie.lead,Ie.deal,Ie.contact,Ie.company,Ie.quote,Ie.order,Ie.smartinvoice].includes(e)||fe.isDynamicTypeByTypeId(e);if(!p.Type.isNumber(e))throw new RangeError(`BX.Crm.EntityMiniCard: entityTypeId ${e} must be number`);if(!t)throw new RangeError(`BX.Crm.EntityMiniCard: entityTypeId ${e} is not supported`);babelHelpers.classPrivateFieldLooseBase(this,He)[He]=e}function Ae(e){if(!p.Type.isNumber(e)||e<=0)throw new RangeError("BX.Crm.EntityMiniCard: entityId must be a number and greater than 0");babelHelpers.classPrivateFieldLooseBase(this,Me)[Me]=e}function Ve(e){if(!p.Type.isElementNode(e))throw new RangeError("BX.Crm.EntityMiniCard: bindElement must be an element node");babelHelpers.classPrivateFieldLooseBase(this,Te)[Te]=e}e.MiniCard=Pe,e.EntityMiniCard=class{constructor(e){Object.defineProperty(this,Ne,{value:Ve}),Object.defineProperty(this,we,{value:Ae}),Object.defineProperty(this,ge,{value:Se}),Object.defineProperty(this,He,{writable:!0,value:void 0}),Object.defineProperty(this,Me,{writable:!0,value:void 0}),Object.defineProperty(this,Te,{writable:!0,value:void 0}),Object.defineProperty(this,Oe,{writable:!0,value:void 0}),babelHelpers.classPrivateFieldLooseBase(this,ge)[ge](e.entityTypeId),babelHelpers.classPrivateFieldLooseBase(this,we)[we](e.entityId),babelHelpers.classPrivateFieldLooseBase(this,Ne)[Ne](e.bindElement),babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe]=new Pe({bindElement:babelHelpers.classPrivateFieldLooseBase(this,Te)[Te],miniCardResolver:this.fetchEntityMiniCard.bind(this)})}getMiniCard(){return babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe]}async fetchEntityMiniCard(){const e={data:{entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,He)[He],entityId:babelHelpers.classPrivateFieldLooseBase(this,Me)[Me]}},t=await p.ajax.runAction("crm.item.minicard.get",e);return null!=t&&t.data?new E(t.data):null}},e.MiniCardItem=E,e.Component=b,e.MiniCardComponent=J}(this.BX.Crm=this.BX.Crm||{},BX,BX.UI.IconSet,BX,BX,BX.UI.Dialogs,BX.Event,BX.Main,BX.UI,BX.UI.IconSet,BX.Vue3,BX);
//# sourceMappingURL=index.bundle.map.js