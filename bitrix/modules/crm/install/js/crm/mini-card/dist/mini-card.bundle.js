this.BX=this.BX||{},function(e,s,t,i){"use strict";var a=babelHelpers.classPrivateFieldLooseKey("componentName"),l=babelHelpers.classPrivateFieldLooseKey("componentOptions");class o{constructor(e){if(Object.defineProperty(this,a,{writable:!0,value:void 0}),Object.defineProperty(this,l,{writable:!0,value:void 0}),!t.Type.isStringFilled(e.componentName))throw new RangeError("control component name not valid (todo)");if(!t.Type.isPlainObject(e.componentOptions))throw new RangeError("control component options not valid");babelHelpers.classPrivateFieldLooseBase(this,a)[a]=e.componentName,babelHelpers.classPrivateFieldLooseBase(this,l)[l]=e.componentOptions}componentName(){return babelHelpers.classPrivateFieldLooseBase(this,a)[a]}componentOptions(){return babelHelpers.classPrivateFieldLooseBase(this,l)[l]}}var r=babelHelpers.classPrivateFieldLooseKey("componentName"),n=babelHelpers.classPrivateFieldLooseKey("componentOptions");class d{constructor(e){if(Object.defineProperty(this,r,{writable:!0,value:void 0}),Object.defineProperty(this,n,{writable:!0,value:void 0}),!t.Type.isStringFilled(e.componentName))throw new RangeError("field component name not valid (todo)");if(!t.Type.isPlainObject(e.componentOptions))throw new RangeError("field component options not valid");babelHelpers.classPrivateFieldLooseBase(this,r)[r]=e.componentName,babelHelpers.classPrivateFieldLooseBase(this,n)[n]=e.componentOptions}componentName(){return babelHelpers.classPrivateFieldLooseBase(this,r)[r]}componentOptions(){return babelHelpers.classPrivateFieldLooseBase(this,n)[n]}}var c=babelHelpers.classPrivateFieldLooseKey("title"),b=babelHelpers.classPrivateFieldLooseKey("avatar"),p=babelHelpers.classPrivateFieldLooseKey("controls"),v=babelHelpers.classPrivateFieldLooseKey("fields");class h{constructor(e){if(Object.defineProperty(this,c,{writable:!0,value:void 0}),Object.defineProperty(this,b,{writable:!0,value:void 0}),Object.defineProperty(this,p,{writable:!0,value:void 0}),Object.defineProperty(this,v,{writable:!0,value:void 0}),!t.Type.isStringFilled(e.title))throw new RangeError("mini card model title not valid (todo)");if(!t.Type.isStringFilled(e.avatar))throw new RangeError("mini card avatar not valid (todo)");babelHelpers.classPrivateFieldLooseBase(this,c)[c]=e.title,babelHelpers.classPrivateFieldLooseBase(this,b)[b]=e.avatar,babelHelpers.classPrivateFieldLooseBase(this,p)[p]=[],e.controls.forEach(e=>{babelHelpers.classPrivateFieldLooseBase(this,p)[p].push(new o(e))}),babelHelpers.classPrivateFieldLooseBase(this,v)[v]=[],e.fields.forEach(e=>{babelHelpers.classPrivateFieldLooseBase(this,v)[v].push(new d(e))})}title(){return babelHelpers.classPrivateFieldLooseBase(this,c)[c]}avatar(){return babelHelpers.classPrivateFieldLooseBase(this,b)[b]}controls(){return babelHelpers.classPrivateFieldLooseBase(this,p)[p]}fields(){return babelHelpers.classPrivateFieldLooseBase(this,v)[v]}}const P="crm.item.minicard.get";class u{async getAction(e,s){const i=await t.ajax.runAction(P,{data:{entityTypeId:e,entityId:s}});return new h(null==i?void 0:i.data)}}const F={name:"MiniCardState",props:{state:{type:Object,required:!0}},computed:{miniCard(){return this.state.value.miniCard},loading(){return!this.state.value.isLoad},error(){return this.state.value.error}},template:'\n\t\t<div class="crm-mini-card">\n\t\t\t<div v-if="loading">\n\t\t\t\tloading...\n\t\t\t</div>\n\t\t\t<div v-else-if="error !== null">\n\t\t\t\t{{ error }}\n\t\t\t</div>\n\t\t\t<div v-else>\n\t\t\t\t<div>{{ miniCard.title() }}</div>\n\t\t\t\t<div>\n\t\t\t\t\t<span v-for="control in miniCard.controls()">{{ control.componentOptions().title }} and {{ control.componentOptions().href }}</span>\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<span v-for="field in miniCard.fields()"> {{ field.componentOptions().title }} and {{ field.componentOptions().value }} </span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'};let m,L=e=>e;var H=babelHelpers.classPrivateFieldLooseKey("entityTypeId"),y=babelHelpers.classPrivateFieldLooseKey("entityId"),B=babelHelpers.classPrivateFieldLooseKey("bindElement"),f=babelHelpers.classPrivateFieldLooseKey("controller"),w=babelHelpers.classPrivateFieldLooseKey("application"),O=babelHelpers.classPrivateFieldLooseKey("popup"),j=babelHelpers.classPrivateFieldLooseKey("container"),g=babelHelpers.classPrivateFieldLooseKey("state"),K=babelHelpers.classPrivateFieldLooseKey("createPopup");function E(){const e=new s.Popup({bindElement:babelHelpers.classPrivateFieldLooseBase(this,B)[B],content:this.container(),events:{onShow:()=>{babelHelpers.classPrivateFieldLooseBase(this,f)[f].getAction(babelHelpers.classPrivateFieldLooseBase(this,H)[H],babelHelpers.classPrivateFieldLooseBase(this,y)[y]).then(e=>{babelHelpers.classPrivateFieldLooseBase(this,g)[g].value.miniCard=e}).catch(e=>{console.error(e),babelHelpers.classPrivateFieldLooseBase(this,g)[g].value.error=e}).finally(()=>{babelHelpers.classPrivateFieldLooseBase(this,g)[g].value.isLoad=!0})}}});t.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,B)[B],"mouseenter",()=>{e.show()}),t.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,B)[B],"mouseleave",()=>{e.close()})}e.MiniCard=class{constructor(e){Object.defineProperty(this,K,{value:E}),Object.defineProperty(this,H,{writable:!0,value:void 0}),Object.defineProperty(this,y,{writable:!0,value:void 0}),Object.defineProperty(this,B,{writable:!0,value:void 0}),Object.defineProperty(this,f,{writable:!0,value:void 0}),Object.defineProperty(this,w,{writable:!0,value:null}),Object.defineProperty(this,O,{writable:!0,value:null}),Object.defineProperty(this,j,{writable:!0,value:null}),Object.defineProperty(this,g,{writable:!0,value:void 0}),babelHelpers.classPrivateFieldLooseBase(this,H)[H]=e.entityTypeId,babelHelpers.classPrivateFieldLooseBase(this,y)[y]=e.entityId,babelHelpers.classPrivateFieldLooseBase(this,B)[B]=e.bindElement,babelHelpers.classPrivateFieldLooseBase(this,g)[g]=i.ref({miniCard:null,error:null,isLoad:!1}),babelHelpers.classPrivateFieldLooseBase(this,f)[f]=new u,babelHelpers.classPrivateFieldLooseBase(this,O)[O]=babelHelpers.classPrivateFieldLooseBase(this,K)[K]()}popup(){return babelHelpers.classPrivateFieldLooseBase(this,O)[O]}container(){return null===babelHelpers.classPrivateFieldLooseBase(this,j)[j]&&(babelHelpers.classPrivateFieldLooseBase(this,j)[j]=t.Tag.render(m||(m=L`
				<div class="crm-item-mini-card-container"></div>
			`)),this.application().mount(babelHelpers.classPrivateFieldLooseBase(this,j)[j])),babelHelpers.classPrivateFieldLooseBase(this,j)[j]}application(){return null===babelHelpers.classPrivateFieldLooseBase(this,w)[w]&&(babelHelpers.classPrivateFieldLooseBase(this,w)[w]=i.BitrixVue.createApp(F,{state:babelHelpers.classPrivateFieldLooseBase(this,g)[g]})),babelHelpers.classPrivateFieldLooseBase(this,w)[w]}}}(this.BX.Crm=this.BX.Crm||{},BX.Main,BX,BX.Vue3);
//# sourceMappingURL=mini-card.bundle.js.map
