{"version":3,"file":"mini-card.bundle.js","sources":["../src/lib/model/control.js","../src/lib/model/field.js","../src/lib/model/mini-card.js","../src/lib/ajax/controller.js","../src/components/mini-card-state.js","../src/mini-card.js"],"sourcesContent":["import { Type } from 'main.core';\n\nexport type ControlOptions = {\n\tcomponentName: string,\n\tcomponentOptions: Object,\n};\n\nexport class Control\n{\n\t#componentName: string;\n\t#componentOptions: Object;\n\n\tconstructor(options: ControlOptions)\n\t{\n\t\tif (!Type.isStringFilled(options.componentName))\n\t\t{\n\t\t\tthrow new RangeError('control component name not valid (todo)');\n\t\t}\n\n\t\tif (!Type.isPlainObject(options.componentOptions))\n\t\t{\n\t\t\tthrow new RangeError('control component options not valid');\n\t\t}\n\n\t\tthis.#componentName = options.componentName;\n\t\tthis.#componentOptions = options.componentOptions;\n\t}\n\n\tcomponentName(): string\n\t{\n\t\treturn this.#componentName;\n\t}\n\n\tcomponentOptions(): Object\n\t{\n\t\treturn this.#componentOptions;\n\t}\n}\n","import { Type } from 'main.core';\n\nexport type FieldOptions = {\n\tcomponentName: string,\n\tcomponentOptions: Object,\n};\n\nexport class Field\n{\n\t#componentName: string;\n\t#componentOptions: Object;\n\n\tconstructor(options: FieldOptions)\n\t{\n\t\tif (!Type.isStringFilled(options.componentName))\n\t\t{\n\t\t\tthrow new RangeError('field component name not valid (todo)');\n\t\t}\n\n\t\tif (!Type.isPlainObject(options.componentOptions))\n\t\t{\n\t\t\tthrow new RangeError('field component options not valid');\n\t\t}\n\n\t\tthis.#componentName = options.componentName;\n\t\tthis.#componentOptions = options.componentOptions;\n\t}\n\n\tcomponentName(): string\n\t{\n\t\treturn this.#componentName;\n\t}\n\n\tcomponentOptions(): Object\n\t{\n\t\treturn this.#componentOptions;\n\t}\n}\n","import { Type } from 'main.core';\n\nimport { type ControlOptions, Control } from './control';\nimport { type FieldOptions, Field } from './field';\n\nexport type MiniCardOptions = {\n\ttitle: string,\n\tavatar: string,\n\tcontrols: ControlOptions[],\n\tfields: FieldOptions[],\n};\n\nexport class MiniCard\n{\n\t#title: string;\n\t#avatar: string;\n\t#controls: Control[];\n\t#fields: Field[];\n\n\tconstructor(options: MiniCardOptions)\n\t{\n\t\tif (!Type.isStringFilled(options.title))\n\t\t{\n\t\t\tthrow new RangeError('mini card model title not valid (todo)');\n\t\t}\n\n\t\tif (!Type.isStringFilled(options.avatar))\n\t\t{\n\t\t\tthrow new RangeError('mini card avatar not valid (todo)');\n\t\t}\n\n\t\tthis.#title = options.title;\n\t\tthis.#avatar = options.avatar;\n\n\t\tthis.#controls = [];\n\t\toptions.controls.forEach((controlOptions: ControlOptions) => {\n\t\t\tthis.#controls.push(new Control(controlOptions));\n\t\t});\n\n\t\tthis.#fields = [];\n\t\toptions.fields.forEach((fieldOptions: FieldOptions) => {\n\t\t\tthis.#fields.push(new Field(fieldOptions));\n\t\t});\n\t}\n\n\ttitle(): string\n\t{\n\t\treturn this.#title;\n\t}\n\n\tavatar(): string\n\t{\n\t\treturn this.#avatar;\n\t}\n\n\tcontrols(): Control[]\n\t{\n\t\treturn this.#controls;\n\t}\n\n\tfields(): Field[]\n\t{\n\t\treturn this.#fields;\n\t}\n}\n","import { ajax as Ajax } from 'main.core';\nimport { MiniCard } from '../model/mini-card';\n\nconst ENDPOINT = {\n\tGET: 'crm.item.minicard.get',\n};\n\nexport class Controller\n{\n\tasync getAction(entityTypeId: number, entityId: number): Promise<MiniCard>\n\t{\n\t\tconst response = await Ajax.runAction(ENDPOINT.GET, {\n\t\t\tdata: {\n\t\t\t\tentityTypeId,\n\t\t\t\tentityId,\n\t\t\t},\n\t\t});\n\n\t\t// todo: validate errors\n\n\t\treturn new MiniCard(response?.data);\n\t}\n}\n","import { BitrixVueComponentProps } from 'ui.vue3';\nimport type { MiniCard } from '../lib/model/mini-card';\n\n// @vue/component\nexport const MiniCardState: BitrixVueComponentProps = {\n\tname: 'MiniCardState',\n\tprops: {\n\t\tstate: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed: {\n\t\tminiCard(): ?MiniCard\n\t\t{\n\t\t\treturn this.state.value.miniCard;\n\t\t},\n\t\tloading(): boolean\n\t\t{\n\t\t\treturn !this.state.value.isLoad;\n\t\t},\n\t\terror(): ?string\n\t\t{\n\t\t\treturn this.state.value.error;\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"crm-mini-card\">\n\t\t\t<div v-if=\"loading\">\n\t\t\t\tloading...\n\t\t\t</div>\n\t\t\t<div v-else-if=\"error !== null\">\n\t\t\t\t{{ error }}\n\t\t\t</div>\n\t\t\t<div v-else>\n\t\t\t\t<div>{{ miniCard.title() }}</div>\n\t\t\t\t<div>\n\t\t\t\t\t<span v-for=\"control in miniCard.controls()\">{{ control.componentOptions().title }} and {{ control.componentOptions().href }}</span>\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<span v-for=\"field in miniCard.fields()\"> {{ field.componentOptions().title }} and {{ field.componentOptions().value }} </span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Event, Tag } from 'main.core';\nimport { Popup } from 'main.popup';\nimport { BitrixVue, VueCreateAppResult, ref } from 'ui.vue3';\nimport { Controller } from './lib/ajax/controller';\nimport { MiniCardState } from './components/mini-card-state';\n\ndeclare type MiniCardOptions = {\n\tentityTypeId: number,\n\tentityId: number,\n\tbindElement: HTMLElement,\n};\n\nexport class MiniCard\n{\n\t#entityTypeId: number;\n\t#entityId: number;\n\t#bindElement: HTMLElement;\n\n\t#controller: Controller;\n\t#application: VueCreateAppResult = null;\n\t#popup: Popup = null;\n\t#container: HTMLElement = null;\n\n\t#state: {\n\t\tvalue: {\n\t\t\tminiCard: ?MiniCard,\n\t\t\terror: ?string,\n\t\t\tisLoad: boolean,\n\t\t},\n\t};\n\n\tconstructor(options: MiniCardOptions)\n\t{\n\t\t// todo: validation\n\n\t\tthis.#entityTypeId = options.entityTypeId;\n\t\tthis.#entityId = options.entityId;\n\t\tthis.#bindElement = options.bindElement;\n\n\t\tthis.#state = ref({\n\t\t\tminiCard: null,\n\t\t\terror: null,\n\t\t\tisLoad: false,\n\t\t});\n\n\t\tthis.#controller = new Controller();\n\n\t\tthis.#popup = this.#createPopup();\n\t}\n\n\t#createPopup(): Popup\n\t{\n\t\tconst popup = new Popup({\n\t\t\tbindElement: this.#bindElement,\n\t\t\tcontent: this.container(),\n\t\t\tevents: {\n\t\t\t\tonShow: () => {\n\t\t\t\t\tvoid this.#controller\n\t\t\t\t\t\t.getAction(this.#entityTypeId, this.#entityId)\n\t\t\t\t\t\t.then((miniCard: ?MiniCard) => {\n\t\t\t\t\t\t\tthis.#state.value.miniCard = miniCard;\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((error) => {\n\t\t\t\t\t\t\tconsole.error(error);\n\t\t\t\t\t\t\tthis.#state.value.error = error;\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.finally(() => {\n\t\t\t\t\t\t\tthis.#state.value.isLoad = true;\n\t\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tEvent.bind(this.#bindElement, 'mouseenter', () => {\n\t\t\tpopup.show();\n\t\t});\n\n\t\tEvent.bind(this.#bindElement, 'mouseleave', () => {\n\t\t\tpopup.close();\n\t\t});\n\t}\n\n\tpopup(): Popup\n\t{\n\t\treturn this.#popup;\n\t}\n\n\tcontainer(): HTMLElement\n\t{\n\t\tif (this.#container === null)\n\t\t{\n\t\t\tthis.#container = Tag.render`\n\t\t\t\t<div class=\"crm-item-mini-card-container\"></div>\n\t\t\t`;\n\n\t\t\tthis.application().mount(this.#container);\n\t\t}\n\n\t\treturn this.#container;\n\t}\n\n\tapplication(): VueCreateAppResult\n\t{\n\t\tif (this.#application === null)\n\t\t{\n\t\t\tthis.#application = BitrixVue.createApp(MiniCardState, {\n\t\t\t\tstate: this.#state,\n\t\t\t});\n\t\t}\n\n\t\treturn this.#application;\n\t}\n}\n"],"names":["Control","constructor","options","Object","writable","value","Type","isStringFilled","componentName","RangeError","isPlainObject","componentOptions","babelHelpers","this","Field","MiniCard","title","avatar","controls","forEach","controlOptions","push","fields","fieldOptions","ENDPOINT","Controller","[object Object]","entityTypeId","entityId","response","Ajax","runAction","data","MiniCardState","name","props","state","type","required","computed","miniCard","loading","isLoad","error","template","popup","Popup","bindElement","content","container","events","onShow","getAction","then","catch","console","finally","Event","bind","show","close","ref","Tag","render","application","mount","BitrixVue","createApp"],"mappings":"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"}