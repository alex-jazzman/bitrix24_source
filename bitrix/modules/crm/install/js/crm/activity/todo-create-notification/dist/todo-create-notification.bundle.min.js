this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};(function(e,s,t,i,a,l,o,r,n){"use strict";let b=e=>e,c,d,v,p;const u="save";const P="cancel";const h="skip";var B=babelHelpers.classPrivateFieldLooseKey("timeline");var L=babelHelpers.classPrivateFieldLooseKey("entityTypeId");var F=babelHelpers.classPrivateFieldLooseKey("entityId");var H=babelHelpers.classPrivateFieldLooseKey("entityStageId");var y=babelHelpers.classPrivateFieldLooseKey("stageIdField");var I=babelHelpers.classPrivateFieldLooseKey("finalStages");var T=babelHelpers.classPrivateFieldLooseKey("allowCloseSlider");var f=babelHelpers.classPrivateFieldLooseKey("isSkipped");var O=babelHelpers.classPrivateFieldLooseKey("popup");var C=babelHelpers.classPrivateFieldLooseKey("toDoEditor");var _=babelHelpers.classPrivateFieldLooseKey("skipProvider");var g=babelHelpers.classPrivateFieldLooseKey("skipMenu");var S=babelHelpers.classPrivateFieldLooseKey("sliderIsMinimizing");var m=babelHelpers.classPrivateFieldLooseKey("useTodoEditorV2");var A=babelHelpers.classPrivateFieldLooseKey("bindEvents");var D=babelHelpers.classPrivateFieldLooseKey("getSliderInstance");var E=babelHelpers.classPrivateFieldLooseKey("isSliderMinimizeAvailable");var N=babelHelpers.classPrivateFieldLooseKey("onCloseSlider");var w=babelHelpers.classPrivateFieldLooseKey("onEntityUpdate");var K=babelHelpers.classPrivateFieldLooseKey("onEntityDelete");var j=babelHelpers.classPrivateFieldLooseKey("onEntityModelChange");var M=babelHelpers.classPrivateFieldLooseKey("onSkippedPeriodChange");var k=babelHelpers.classPrivateFieldLooseKey("onToolbarMenuBuild");var V=babelHelpers.classPrivateFieldLooseKey("onChangeDescription");var R=babelHelpers.classPrivateFieldLooseKey("onSaveHotkeyPressed");var X=babelHelpers.classPrivateFieldLooseKey("onChangeUploaderContainerSize");var Y=babelHelpers.classPrivateFieldLooseKey("onSkipMenuItemSelect");var $=babelHelpers.classPrivateFieldLooseKey("saveTodo");var x=babelHelpers.classPrivateFieldLooseKey("revertButtonsState");var W=babelHelpers.classPrivateFieldLooseKey("closePopup");var U=babelHelpers.classPrivateFieldLooseKey("closeSlider");var z=babelHelpers.classPrivateFieldLooseKey("showTodoCreationNotification");var G=babelHelpers.classPrivateFieldLooseKey("getPopupDescription");var q=babelHelpers.classPrivateFieldLooseKey("getPopupContent");var J=babelHelpers.classPrivateFieldLooseKey("getNotificationTitle");var Q=babelHelpers.classPrivateFieldLooseKey("getPreparedForV2NotificationSkipButton");var Z=babelHelpers.classPrivateFieldLooseKey("createToDoEditor");var ee=babelHelpers.classPrivateFieldLooseKey("getPopupButtons");var se=babelHelpers.classPrivateFieldLooseKey("createSaveButton");var te=babelHelpers.classPrivateFieldLooseKey("createCancelButton");var ie=babelHelpers.classPrivateFieldLooseKey("createNotificationSkipButton");var ae=babelHelpers.classPrivateFieldLooseKey("getSkipMenuItems");var le=babelHelpers.classPrivateFieldLooseKey("showCancelNotificationInParentWindow");class oe{constructor(e){Object.defineProperty(this,le,{value:we});Object.defineProperty(this,ae,{value:Ne});Object.defineProperty(this,ie,{value:Ee});Object.defineProperty(this,te,{value:De});Object.defineProperty(this,se,{value:Ae});Object.defineProperty(this,ee,{value:me});Object.defineProperty(this,Z,{value:Se});Object.defineProperty(this,Q,{value:ge});Object.defineProperty(this,J,{value:_e});Object.defineProperty(this,q,{value:Ce});Object.defineProperty(this,G,{value:Oe});Object.defineProperty(this,z,{value:fe});Object.defineProperty(this,U,{value:Te});Object.defineProperty(this,W,{value:Ie});Object.defineProperty(this,x,{value:ye});Object.defineProperty(this,$,{value:He});Object.defineProperty(this,Y,{value:Fe});Object.defineProperty(this,X,{value:Le});Object.defineProperty(this,R,{value:Be});Object.defineProperty(this,V,{value:he});Object.defineProperty(this,k,{value:Pe});Object.defineProperty(this,M,{value:ue});Object.defineProperty(this,j,{value:pe});Object.defineProperty(this,K,{value:ve});Object.defineProperty(this,w,{value:de});Object.defineProperty(this,N,{value:ce});Object.defineProperty(this,E,{value:be});Object.defineProperty(this,D,{value:ne});Object.defineProperty(this,A,{value:re});Object.defineProperty(this,B,{writable:true,value:null});Object.defineProperty(this,L,{writable:true,value:null});Object.defineProperty(this,F,{writable:true,value:null});Object.defineProperty(this,H,{writable:true,value:null});Object.defineProperty(this,y,{writable:true,value:null});Object.defineProperty(this,I,{writable:true,value:null});Object.defineProperty(this,T,{writable:true,value:false});Object.defineProperty(this,f,{writable:true,value:false});Object.defineProperty(this,O,{writable:true,value:null});Object.defineProperty(this,C,{writable:true,value:null});Object.defineProperty(this,_,{writable:true,value:null});Object.defineProperty(this,g,{writable:true,value:null});Object.defineProperty(this,S,{writable:true,value:false});Object.defineProperty(this,m,{writable:true,value:false});babelHelpers.classPrivateFieldLooseBase(this,L)[L]=e.entityTypeId;babelHelpers.classPrivateFieldLooseBase(this,F)[F]=e.entityId;babelHelpers.classPrivateFieldLooseBase(this,H)[H]=e.entityStageId;babelHelpers.classPrivateFieldLooseBase(this,y)[y]=e.stageIdField;babelHelpers.classPrivateFieldLooseBase(this,I)[I]=e.finalStages;babelHelpers.classPrivateFieldLooseBase(this,f)[f]=Boolean(e.skipPeriod);babelHelpers.classPrivateFieldLooseBase(this,m)[m]=e.useTodoEditorV2===true;if(BX.CrmTimelineManager){babelHelpers.classPrivateFieldLooseBase(this,B)[B]=BX.CrmTimelineManager.getDefault()}babelHelpers.classPrivateFieldLooseBase(this,A)[A]();babelHelpers.classPrivateFieldLooseBase(this,_)[_]=new i.TodoNotificationSkip({entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,L)[L],onSkippedPeriodChange:babelHelpers.classPrivateFieldLooseBase(this,M)[M].bind(this)});babelHelpers.classPrivateFieldLooseBase(this,g)[g]=new a.TodoNotificationSkipMenu({entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,L)[L],selectedValue:e.skipPeriod})}}function re(){if(babelHelpers.classPrivateFieldLooseBase(this,D)[D]()){o.EventEmitter.subscribe(babelHelpers.classPrivateFieldLooseBase(this,D)[D](),"SidePanel.Slider:onClose",babelHelpers.classPrivateFieldLooseBase(this,N)[N].bind(this));o.EventEmitter.subscribe("Crm.EntityModel.Change",babelHelpers.classPrivateFieldLooseBase(this,j)[j].bind(this));o.EventEmitter.subscribe("onCrmEntityUpdate",babelHelpers.classPrivateFieldLooseBase(this,w)[w].bind(this));o.EventEmitter.subscribe("onCrmEntityDelete",babelHelpers.classPrivateFieldLooseBase(this,K)[K].bind(this))}o.EventEmitter.subscribe("Crm.InterfaceToolbar.MenuBuild",babelHelpers.classPrivateFieldLooseBase(this,k)[k].bind(this))}function ne(){if(top.BX&&top.BX.SidePanel){const e=top.BX.SidePanel.Instance.getSliderByWindow(window);if(e&&e.isOpen()){return e}}return null}function be(){return Object.hasOwn(BX.SidePanel.Slider.prototype,"minimize")&&Object.hasOwn(BX.SidePanel.Slider.prototype,"isMinimizing")}function ce(e){var s;if(babelHelpers.classPrivateFieldLooseBase(this,T)[T]||babelHelpers.classPrivateFieldLooseBase(this,f)[f]){return}const[t]=e.getCompatData();if(t.getSlider()!==top.BX.SidePanel.Instance.getSliderByWindow(window)){return}if(!t.isActionAllowed()){return}if(!babelHelpers.classPrivateFieldLooseBase(this,B)[B]||babelHelpers.classPrivateFieldLooseBase(this,B)[B].hasScheduledItems()){return}if(babelHelpers.classPrivateFieldLooseBase(this,I)[I].includes(babelHelpers.classPrivateFieldLooseBase(this,H)[H])){return}babelHelpers.classPrivateFieldLooseBase(this,S)[S]=babelHelpers.classPrivateFieldLooseBase(this,E)[E]()&&((s=t.getSlider())==null?void 0:s.isMinimizing());t.denyAction();setTimeout((()=>{babelHelpers.classPrivateFieldLooseBase(this,z)[z]()}),100)}function de(e){const[s]=e.getCompatData();if(Object.hasOwn(s,"entityData")&&Object.hasOwn(s.entityData,babelHelpers.classPrivateFieldLooseBase(this,y)[y])){babelHelpers.classPrivateFieldLooseBase(this,H)[H]=s.entityData[babelHelpers.classPrivateFieldLooseBase(this,y)[y]]}}function ve(e){const[s]=e.getCompatData();if(Object.hasOwn(s,"id")&&Text.toString(s.id)===Text.toString(babelHelpers.classPrivateFieldLooseBase(this,F)[F])){babelHelpers.classPrivateFieldLooseBase(this,T)[T]=true}}function pe(e){const[s,t]=e.getCompatData();if(t.fieldName===babelHelpers.classPrivateFieldLooseBase(this,y)[y]){babelHelpers.classPrivateFieldLooseBase(this,H)[H]=s.getStringField(babelHelpers.classPrivateFieldLooseBase(this,y)[y],babelHelpers.classPrivateFieldLooseBase(this,H)[H])}}function ue(e){babelHelpers.classPrivateFieldLooseBase(this,f)[f]=Boolean(e)}function Pe(e){const[,{items:s}]=e.getData();s.push({delimiter:true});for(const e of babelHelpers.classPrivateFieldLooseBase(this,g)[g].getItems()){s.push(e)}}function he(e){var s;const{description:t}=e.getData();const i=(s=babelHelpers.classPrivateFieldLooseBase(this,O)[O])==null?void 0:s.getButton(u);if(t.length===0&&!i.getState()){i.setState(n.ButtonState.DISABLED)}else if(t.length>0&&i.getState()===n.ButtonState.DISABLED){i.setState(null)}}function Be(){var e;const s=(e=babelHelpers.classPrivateFieldLooseBase(this,O)[O])==null?void 0:e.getButton(u);if(!s.getState()){babelHelpers.classPrivateFieldLooseBase(this,$)[$]()}}function Le(){if(babelHelpers.classPrivateFieldLooseBase(this,O)[O]){babelHelpers.classPrivateFieldLooseBase(this,O)[O].adjustPosition()}}function Fe(e){var s,t,i,a,l,o,r,b,c;(s=babelHelpers.classPrivateFieldLooseBase(this,O)[O])==null?void 0:(t=s.getButton(h))==null?void 0:(i=t.getMenuWindow())==null?void 0:i.close();(a=babelHelpers.classPrivateFieldLooseBase(this,O)[O])==null?void 0:(l=a.getButton(u))==null?void 0:l.setState(n.ButtonState.DISABLED);(o=babelHelpers.classPrivateFieldLooseBase(this,O)[O])==null?void 0:(r=o.getButton(P))==null?void 0:r.setState(n.ButtonState.DISABLED);(b=babelHelpers.classPrivateFieldLooseBase(this,O)[O])==null?void 0:(c=b.getButton(h))==null?void 0:c.setState(n.ButtonState.WAITING);babelHelpers.classPrivateFieldLooseBase(this,_)[_].saveSkippedPeriod(e).then((()=>{var s;babelHelpers.classPrivateFieldLooseBase(this,f)[f]=Boolean(e);babelHelpers.classPrivateFieldLooseBase(this,g)[g].setSelectedValue(e);babelHelpers.classPrivateFieldLooseBase(this,x)[x]();babelHelpers.classPrivateFieldLooseBase(this,T)[T]=true;babelHelpers.classPrivateFieldLooseBase(this,le)[le]();(s=babelHelpers.classPrivateFieldLooseBase(this,D)[D]())==null?void 0:s.close()})).catch((()=>{babelHelpers.classPrivateFieldLooseBase(this,x)[x]()}))}function He(){var e,s,t,i,a,l;(e=babelHelpers.classPrivateFieldLooseBase(this,O)[O])==null?void 0:(s=e.getButton(u))==null?void 0:s.setState(n.ButtonState.WAITING);(t=babelHelpers.classPrivateFieldLooseBase(this,O)[O])==null?void 0:(i=t.getButton(P))==null?void 0:i.setState(n.ButtonState.DISABLED);(a=babelHelpers.classPrivateFieldLooseBase(this,O)[O])==null?void 0:(l=a.getButton(h))==null?void 0:l.setState(n.ButtonState.DISABLED);babelHelpers.classPrivateFieldLooseBase(this,C)[C].save().then((e=>{babelHelpers.classPrivateFieldLooseBase(this,x)[x]();if(!(Object.hasOwn(e,"errors")&&e.errors.length>0)){var s;babelHelpers.classPrivateFieldLooseBase(this,T)[T]=true;babelHelpers.classPrivateFieldLooseBase(this,W)[W]();(s=babelHelpers.classPrivateFieldLooseBase(this,D)[D]())==null?void 0:s.close()}})).catch((()=>{babelHelpers.classPrivateFieldLooseBase(this,x)[x]()}))}function ye(){var e,s,t,i,a,l;(e=babelHelpers.classPrivateFieldLooseBase(this,O)[O])==null?void 0:(s=e.getButton(u))==null?void 0:s.setState(null);(t=babelHelpers.classPrivateFieldLooseBase(this,O)[O])==null?void 0:(i=t.getButton(P))==null?void 0:i.setState(null);(a=babelHelpers.classPrivateFieldLooseBase(this,O)[O])==null?void 0:(l=a.getButton(h))==null?void 0:l.setState(null)}function Ie(){var e;(e=babelHelpers.classPrivateFieldLooseBase(this,O)[O])==null?void 0:e.close()}function Te(){var e;babelHelpers.classPrivateFieldLooseBase(this,T)[T]=true;if(babelHelpers.classPrivateFieldLooseBase(this,E)[E]()&&babelHelpers.classPrivateFieldLooseBase(this,S)[S]){var s;(s=babelHelpers.classPrivateFieldLooseBase(this,D)[D]())==null?void 0:s.minimize();return}(e=babelHelpers.classPrivateFieldLooseBase(this,D)[D]())==null?void 0:e.close()}function fe(){if(!babelHelpers.classPrivateFieldLooseBase(this,O)[O]){const e=getComputedStyle(document.documentElement);const s=e.getPropertyValue("--ui-space-inset-sm");const t=parseFloat(s)||12;const i=e.getPropertyValue("--ui-color-base-solid")||"#000000";const{innerWidth:a}=window;babelHelpers.classPrivateFieldLooseBase(this,O)[O]=r.PopupManager.create({id:`todo-create-confirm-${babelHelpers.classPrivateFieldLooseBase(this,L)[L]}-${babelHelpers.classPrivateFieldLooseBase(this,F)[F]}`,closeIcon:!babelHelpers.classPrivateFieldLooseBase(this,m)[m],padding:t,overlay:{opacity:40,backgroundColor:i},content:babelHelpers.classPrivateFieldLooseBase(this,q)[q](),buttons:babelHelpers.classPrivateFieldLooseBase(this,ee)[ee](),minWidth:537,width:Math.round(a*.45),maxWidth:737,events:{onClose:babelHelpers.classPrivateFieldLooseBase(this,U)[U].bind(this)},className:"crm-activity__todo-create-notification-popup"})}babelHelpers.classPrivateFieldLooseBase(this,O)[O].show();setTimeout((()=>{babelHelpers.classPrivateFieldLooseBase(this,C)[C].setFocused()}),10);setTimeout((()=>{babelHelpers.classPrivateFieldLooseBase(this,O)[O].setClosingByEsc(true)}),300)}function Oe(){let e;switch(babelHelpers.classPrivateFieldLooseBase(this,L)[L]){case BX.CrmEntityType.enumeration.lead:e="CRM_ACTIVITY_TODO_NOTIFICATION_DESCRIPTION_LEAD";break;case BX.CrmEntityType.enumeration.deal:e="CRM_ACTIVITY_TODO_NOTIFICATION_DESCRIPTION_DEAL";break;default:e="CRM_ACTIVITY_TODO_NOTIFICATION_DESCRIPTION"}return l.Loc.getMessage(e)}function Ce(){const e=l.Tag.render(c||(c=b`<div></div>`));let s=null;if(babelHelpers.classPrivateFieldLooseBase(this,m)[m]){const t=l.Tag.render(d||(d=b`
				<div class="crm-activity__todo-create-notification_footer">
					<div class="crm-activity__todo-create-notification_buttons-container">
						<button 
							class="ui-btn ui-btn-xs ui-btn-primary ui-btn-round"
							onclick="${0}"
						>
							${0}
						</button>
						<button
							class="ui-btn ui-btn-xs ui-btn-link"
							onclick="${0}"
						>
							${0}
						</button>
					</div>
					${0}
				</div>
			`),babelHelpers.classPrivateFieldLooseBase(this,$)[$].bind(this),l.Loc.getMessage("CRM_ACTIVITY_TODO_NOTIFICATION_OK_BUTTON_V2"),babelHelpers.classPrivateFieldLooseBase(this,W)[W].bind(this),l.Loc.getMessage("CRM_ACTIVITY_TODO_NOTIFICATION_CANCEL_BUTTON_V2"),babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]().render());s=l.Tag.render(v||(v=b`
				<div>
					<div class="crm-activity__todo-create-notification_title --v2">
						${0}
					</div>
					<div>
						${0}
					</div>
					${0}
				</div>
			`),babelHelpers.classPrivateFieldLooseBase(this,J)[J](),e,t)}else{s=l.Tag.render(p||(p=b`
				<div class="crm-activity__todo-create-notification">
					<div class="crm-activity__todo-create-notification_title">
						${0}
					</div>
					<div class="crm-activity__todo-create-notification_content">
						<div class="crm-activity__todo-create-notification_description">
							${0}
						</div>
						${0}
					</div>
				</div>
			`),l.Loc.getMessage("CRM_ACTIVITY_TODO_NOTIFICATION_TITLE"),babelHelpers.classPrivateFieldLooseBase(this,G)[G](),e)}babelHelpers.classPrivateFieldLooseBase(this,Z)[Z](e).show();return s}function _e(){let e=null;switch(babelHelpers.classPrivateFieldLooseBase(this,L)[L]){case BX.CrmEntityType.enumeration.lead:e="CRM_ACTIVITY_TODO_NOTIFICATION_TITLE_V2_LEAD";break;case BX.CrmEntityType.enumeration.deal:e="CRM_ACTIVITY_TODO_NOTIFICATION_TITLE_V2_DEAL";break;default:e="CRM_ACTIVITY_TODO_NOTIFICATION_TITLE_V2"}return l.Loc.getMessage(e)}function ge(){return babelHelpers.classPrivateFieldLooseBase(this,ie)[ie]().setNoCaps().addClass("crm-activity__todo-create-notification_skip-button")}function Se(e){const i={container:e,ownerTypeId:babelHelpers.classPrivateFieldLooseBase(this,L)[L],ownerId:babelHelpers.classPrivateFieldLooseBase(this,F)[F],currentUser:babelHelpers.classPrivateFieldLooseBase(this,B)[B].getCurrentUser(),pingSettings:babelHelpers.classPrivateFieldLooseBase(this,B)[B].getPingSettings(),events:{onSaveHotkeyPressed:babelHelpers.classPrivateFieldLooseBase(this,R)[R].bind(this),onChangeUploaderContainerSize:babelHelpers.classPrivateFieldLooseBase(this,X)[X].bind(this)},borderColor:s.TodoEditor.BorderColor.PRIMARY};if(babelHelpers.classPrivateFieldLooseBase(this,m)[m]){i.calendarSettings=babelHelpers.classPrivateFieldLooseBase(this,B)[B].getCalendarSettings();i.colorSettings=babelHelpers.classPrivateFieldLooseBase(this,B)[B].getColorSettings();i.defaultDescription="";babelHelpers.classPrivateFieldLooseBase(this,C)[C]=new t.TodoEditorV2(i)}else{i.events.onChangeDescription=babelHelpers.classPrivateFieldLooseBase(this,V)[V].bind(this);babelHelpers.classPrivateFieldLooseBase(this,C)[C]=new s.TodoEditor(i)}return babelHelpers.classPrivateFieldLooseBase(this,C)[C]}function me(){if(babelHelpers.classPrivateFieldLooseBase(this,m)[m]){return[]}return[babelHelpers.classPrivateFieldLooseBase(this,se)[se](),babelHelpers.classPrivateFieldLooseBase(this,te)[te](),babelHelpers.classPrivateFieldLooseBase(this,ie)[ie]()]}function Ae(){return new n.SaveButton({id:u,round:true,state:babelHelpers.classPrivateFieldLooseBase(this,C)[C].getDescription()?null:n.ButtonState.DISABLED,events:{click:babelHelpers.classPrivateFieldLooseBase(this,$)[$].bind(this)}})}function De(){return new n.CancelButton({text:l.Loc.getMessage("CRM_ACTIVITY_TODO_NOTIFICATION_CANCEL"),color:n.ButtonColor.LIGHT_BORDER,id:P,round:true,events:{click:babelHelpers.classPrivateFieldLooseBase(this,W)[W].bind(this)}})}function Ee(){return new n.Button({text:l.Loc.getMessage(babelHelpers.classPrivateFieldLooseBase(this,m)[m]?"CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_V2":"CRM_ACTIVITY_TODO_NOTIFICATION_SKIP"),color:n.ButtonColor.LINK,id:h,dropdown:true,menu:{closeByEsc:true,items:babelHelpers.classPrivateFieldLooseBase(this,ae)[ae](),minWidth:233}})}function Ne(){return[{id:"day",text:l.Loc.getMessage("CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_FOR_DAY"),onclick:babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].bind(this,"day")},{id:"week",text:l.Loc.getMessage("CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_FOR_WEEK"),onclick:babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].bind(this,"week")},{id:"month",text:l.Loc.getMessage("CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_FOR_MONTH"),onclick:babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].bind(this,"month")},{id:"forever",text:l.Loc.getMessage("CRM_ACTIVITY_TODO_NOTIFICATION_SKIP_FOREVER"),onclick:babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].bind(this,"forever")}]}function we(){if(top.BX&&top.BX.Runtime){const e=babelHelpers.classPrivateFieldLooseBase(this,L)[L];void top.BX.Runtime.loadExtension("crm.activity.todo-notification-skip").then((s=>{const t=new s.TodoNotificationSkip({entityTypeId:e});t.showCancelPeriodNotification()}))}}e.TodoCreateNotification=oe})(this.BX.Crm.Activity=this.BX.Crm.Activity||{},BX.Crm.Activity,BX.Crm.Activity,BX.Crm.Activity,BX.Crm.Activity,BX,BX.Event,BX.Main,BX.UI);
//# sourceMappingURL=todo-create-notification.bundle.map.js