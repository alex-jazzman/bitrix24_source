{"version":3,"file":"todo-editor-v2.bundle.js","sources":["../src/components/block/address/input-popup.js","../src/components/block/address/address.js","../src/components/block/calendar/location-selector.js","../src/components/block/calendar/calendar.js","../src/components/block/client.js","../src/components/block/file/file.js","../src/components/block/link/input-popup.js","../src/components/block/link/link.js","../src/components/block-factory.js","../src/components/color-selector/todo-editor-color-selector.js","../src/components/todo-editor-ping-selector.js","../src/components/todo-editor-responsible-user-selector.js","../src/components/todo-editor.js","../src/actions-popup.js","../src/enums/border-color.js","../src/todo-editor.js"],"sourcesContent":["import { Address, ControlMode } from 'location.core';\nimport { Factory } from 'location.widget';\nimport { Tag, Text, Type } from 'main.core';\nimport { Popup } from 'main.popup';\n\nexport class InputPopup\n{\n\t#popup: Popup = null;\n\t#bindElement: HTMLElement = null;\n\t#title: string = null;\n\t#buttonTitle: string = null;\n\t#onSubmit: Function = null;\n\t#address: Object = null;\n\t#addressFormatted: string = '';\n\t#addressWidget: Object = null;\n\t#searchInput: HTMLElement = null;\n\t#detailsContainer: HTMLElement = null;\n\t#addressContainer: HTMLElement = null;\n\n\tconstructor(params: Object)\n\t{\n\t\tthis.#bindElement = params.bindElement;\n\t\tthis.#title = params.title;\n\t\tthis.#buttonTitle = params.buttonTitle || 'OK';\n\t\tthis.#address = Type.isStringFilled(params.addressJson) ? new Address(JSON.parse(params.addressJson)) : null;\n\t\tthis.#addressFormatted = Type.isStringFilled(params.addressFormatted) ? params.addressFormatted : null;\n\n\t\tthis.#onSubmit = params.onSubmit;\n\t\tthis.onClickHandler = this.onClickHandler.bind(this);\n\t\tthis.onKeyUpHandler = this.onKeyUpHandler.bind(this);\n\t}\n\n\tshow(): void\n\t{\n\t\tthis.#getPopup().show();\n\n\t\tsetTimeout(() => {\n\t\t\tthis.#searchInput.focus();\n\t\t});\n\t}\n\n\tdestroy(): void\n\t{\n\t\tif (this.#popup)\n\t\t{\n\t\t\tthis.#popup.destroy();\n\t\t}\n\t}\n\n\t#getPopup(): Popup\n\t{\n\t\tif (!this.#popup)\n\t\t{\n\t\t\tthis.#popup = new Popup({\n\t\t\t\tid: `crm-todo-address-input-popup-${Text.getRandom()}`,\n\t\t\t\tbindElement: this.#bindElement,\n\t\t\t\tcontent: this.#getContent(),\n\t\t\t\tcloseByEsc: false,\n\t\t\t\tcloseIcon: false,\n\t\t\t\tdraggable: false,\n\t\t\t\twidth: 466,\n\t\t\t\tpadding: 0,\n\t\t\t\tevents: {\n\t\t\t\t\tonFirstShow: () => {\n\t\t\t\t\t\tthis.initAddress();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\treturn this.#popup;\n\t}\n\n\t#getContent(): HTMLElement\n\t{\n\t\tthis.#searchInput = Tag.render`\n\t\t\t<input \n\t\t\t\ttype=\"text\" \n\t\t\t\tclass=\"ui-ctl-element ui-ctl-textbox crm-activity__todo-editor-v2_block-popup-address-input-container\" \n\t\t\t\tvalue=\"${this.#addressFormatted}\" \n\t\t\t>\n\t\t`;\n\t\tthis.#detailsContainer = Tag.render`<div class=\"location-fields-control-block\"></div>`;\n\t\tthis.#addressContainer = Tag.render`<div></div>`;\n\n\t\treturn Tag.render`\n\t\t\t<div>\n\t\t\t\t<div class=\"crm-activity__todo-editor-v2_block-popup-wrapper --address\">\n\t\t\t\t\t<div class=\"crm-activity__todo-editor-v2_block-popup-title\">\n\t\t\t\t\t\t${Text.encode(this.#title)}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"crm-activity__todo-editor-v2_block-popup-content\">\n\t\t\t\t\t\t${this.#searchInput}\n\t\t\t\t\t\t<button \n\t\t\t\t\t\t\tonclick=\"${this.onClickHandler}\" \n\t\t\t\t\t\t\tclass=\"ui-btn ui-btn-primary\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t${Text.encode(this.#buttonTitle)}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.#detailsContainer}\n\t\t\t\t\t${this.#addressContainer}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tinitAddress()\n\t{\n\t\tconst widgetFactory = new Factory();\n\n\t\tthis.#addressWidget = widgetFactory.createAddressWidget({\n\t\t\taddress: this.#address,\n\t\t\tmode: ControlMode.edit,\n\t\t});\n\n\t\tthis.#addressWidget.subscribeOnAddressChangedEvent((event) => {\n\t\t\tconst data = event.getData();\n\n\t\t\tthis.#address = Type.isObject(data.address) ? data.address : null;\n\t\t});\n\n\t\tconst addressWidgetParams = {\n\t\t\tmode: ControlMode.edit,\n\t\t\tinputNode: this.#searchInput,\n\t\t\tmapBindElement: this.#searchInput,\n\t\t\tfieldsContainer: this.#detailsContainer,\n\t\t\tcontrolWrapper: this.#addressContainer,\n\t\t};\n\n\t\tthis.#addressWidget.render(addressWidgetParams);\n\t\tthis.#setFocus();\n\t}\n\n\t#setFocus(): void\n\t{\n\t\tthis.#searchInput.focus();\n\t}\n\n\tonClickHandler(): void\n\t{\n\t\tthis.#getPopup().close();\n\t\tthis.#onSubmit(this.#address);\n\t}\n\n\tonKeyUpHandler(event): void\n\t{\n\t\tif (event.keyCode === 13)\n\t\t{\n\t\t\tthis.onClickHandler();\n\t\t}\n\t}\n}\n","import { Address, Format } from 'location.core';\nimport { Loc, Text, Type } from 'main.core';\nimport { InputPopup } from './input-popup';\n\nexport const TodoEditorBlocksAddress = {\n\tprops: {\n\t\tid: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\ticon: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsettings: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tfilledValues: {\n\t\t\ttype: Object,\n\t\t},\n\t\tcontext: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tisFocused: {\n\t\t\ttype: Boolean,\n\t\t},\n\t},\n\n\temits: [\n\t\t'close',\n\t\t'updateFilledValues',\n\t],\n\n\tdata(): Object\n\t{\n\t\tconst data = {\n\t\t\taddress: null,\n\t\t\taddressFormatted: null,\n\t\t\taddressJson: null,\n\t\t};\n\n\t\treturn this.getPreparedData(data);\n\t},\n\n\tmounted(): void\n\t{\n\t\tif (this.isFocused)\n\t\t{\n\t\t\tvoid this.$nextTick(this.onShowAddressPopup);\n\t\t}\n\t},\n\n\tbeforeUnmount(): void\n\t{\n\t\tthis.inputPopup?.destroy();\n\t},\n\n\tmethods: {\n\t\tgetId(): string\n\t\t{\n\t\t\treturn 'address';\n\t\t},\n\t\tgetPreparedData(data: Object): Object\n\t\t{\n\t\t\tthis.format = new Format(JSON.parse(Loc.getMessage('CRM_ACTIVITY_TODO_ADDRESS_FORMAT')));\n\n\t\t\tconst { filledValues, format } = this;\n\t\t\tlet addressInstance = null;\n\n\t\t\tif (Type.isStringFilled(filledValues?.addressFormatted))\n\t\t\t{\n\t\t\t\taddressInstance = new Address({\n\t\t\t\t\tlanguageId: format.languageId,\n\t\t\t\t});\n\n\t\t\t\taddressInstance.setFieldValue(format.fieldForUnRecognized, filledValues.addressFormatted);\n\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tdata.address = addressInstance;\n\t\t\t\tdata.addressFormatted = addressInstance?.toString(format).replaceAll('<br />', ', ');;\n\t\t\t}\n\n\t\t\tif (Type.isStringFilled(filledValues?.addressJson))\n\t\t\t{\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tdata.addressJson = filledValues.addressJson;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tdata.addressJson = addressInstance?.toJson();\n\t\t\t}\n\n\t\t\treturn data;\n\t\t},\n\t\tgetExecutedData(): Object\n\t\t{\n\t\t\tconst { addressFormatted, addressJson } = this;\n\n\t\t\treturn {\n\t\t\t\taddressFormatted,\n\t\t\t\taddress: addressJson,\n\t\t\t};\n\t\t},\n\t\temitUpdateFilledValues(): void\n\t\t{\n\t\t\tlet { filledValues } = this;\n\t\t\tconst { addressFormatted, addressJson } = this;\n\n\t\t\tconst newFilledValues = {\n\t\t\t\taddressFormatted,\n\t\t\t\taddressJson,\n\t\t\t};\n\t\t\tfilledValues = { ...filledValues, ...newFilledValues };\n\t\t\tthis.$emit('updateFilledValues', this.getId(), filledValues);\n\t\t},\n\t\tonShowAddressPopup(): void\n\t\t{\n\t\t\tif (Type.isNil(this.inputPopup))\n\t\t\t{\n\t\t\t\tthis.inputPopup = new InputPopup({\n\t\t\t\t\tbindElement: this.$refs.address,\n\t\t\t\t\ttitle: this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_ADDRESS_BLOCK_POPUP_TITLE'),\n\t\t\t\t\taddressFormatted: this.addressFormatted ?? '',\n\t\t\t\t\taddressJson: this.addressJson ?? '',\n\t\t\t\t\tformat: this.format,\n\t\t\t\t\tonSubmit: (value: string) => {\n\t\t\t\t\t\tthis.setAddress(value);\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.inputPopup.show();\n\t\t},\n\t\tsetAddress(address: Address): void\n\t\t{\n\t\t\tthis.address = address;\n\n\t\t\tif (Type.isObject(address))\n\t\t\t{\n\t\t\t\tthis.addressJson = address.toJson();\n\t\t\t\tthis.addressFormatted = address.toString(this.format).replaceAll('<br />', ', ');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.addressJson = '';\n\t\t\t\tthis.addressFormatted = '';\n\t\t\t}\n\t\t},\n\t},\n\n\tcomputed: {\n\t\tencodedTitle(): string\n\t\t{\n\t\t\treturn Text.encode(this.title);\n\t\t},\n\t\ticonStyles(): Object\n\t\t{\n\t\t\tif (!this.icon)\n\t\t\t{\n\t\t\t\treturn {};\n\t\t\t}\n\n\t\t\tconst path = `/bitrix/js/crm/activity/todo-editor-v2/images/${this.icon}`;\n\n\t\t\treturn {\n\t\t\t\tbackground: `url('${encodeURI(Text.encode(path))}') center center`,\n\t\t\t};\n\t\t},\n\t\tactionTitle(): string\n\t\t{\n\t\t\treturn this.hasAddress ? this.changeTitle : this.addTitle;\n\t\t},\n\t\tchangeTitle(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_ADDRESS_BLOCK_CHANGE_ACTION');\n\t\t},\n\t\taddTitle(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_ADDRESS_BLOCK_ADD_ACTION');\n\t\t},\n\t\thasAddress(): boolean\n\t\t{\n\t\t\treturn Type.isStringFilled(this.addressFormatted);\n\t\t},\n\t\tpreparedAddress(): string\n\t\t{\n\t\t\treturn Type.isStringFilled(this.addressFormatted) ? this.addressFormatted : '';\n\t\t},\n\t},\n\n\tcreated()\n\t{\n\t\tthis.$watch(\n\t\t\t'address',\n\t\t\tthis.emitUpdateFilledValues,\n\t\t\t{\n\t\t\t\tdeep: true,\n\t\t\t},\n\t\t);\n\n\t\tthis.$watch('addressFormatted', this.emitUpdateFilledValues);\n\t},\n\n\ttemplate: `\n\t\t<div class=\"crm-activity__todo-editor-v2_block-header --address\">\n\t\t\t<span\n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-icon\"\n\t\t\t\t:style=\"iconStyles\"\n\t\t\t></span>\n\t\t\t<span>{{ encodedTitle }}</span>\n\t\t\t<span \n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-data\"\n\t\t\t\tv-html=\"preparedAddress\"\n\t\t\t>\n\t\t\t</span>\n\t\t\t<span\n\t\t\t\t@click=\"onShowAddressPopup\"\n\t\t\t\tref=\"address\"\n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-action\"\n\t\t\t>\n\t\t\t\t{{ actionTitle }}\n\t\t\t</span>\n\t\t\t<div\n\t\t\t\t@click=\"$emit('close', id)\"\n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-close\"\n\t\t\t></div>\n\t\t</div>\n\t`,\n};\n","import { ajax as Ajax, Type } from 'main.core';\nimport { Dialog } from 'ui.entity-selector';\n\nconst DEFAULT_TAB_ID = 'location';\n\nexport const LocationSelector = {\n\tprops: {\n\t\tlocationId: {\n\t\t\ttype: Number,\n\t\t},\n\t\tforceShowLocationSelectorDialog: {\n\t\t\ttype: Boolean,\n\t\t},\n\t},\n\n\temits: [\n\t\t'change',\n\t\t'close',\n\t],\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tlocations: null,\n\t\t};\n\t},\n\n\tasync mounted()\n\t{\n\t\tthis.locations = await this.fetchRoomsManagerData();\n\n\t\tif (this.forceShowLocationSelectorDialog)\n\t\t{\n\t\t\tthis.showLocationSelectorDialog();\n\t\t}\n\t},\n\n\tmethods: {\n\t\tshowLocationSelectorDialog(): void\n\t\t{\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.getLocationSelectorDialog()?.show();\n\t\t\t}, 5);\n\t\t},\n\t\tgetLocationSelectorDialog(): ?Dialog\n\t\t{\n\t\t\tif (this.locations === null)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (Type.isNil(this.locationSelectorDialog))\n\t\t\t{\n\t\t\t\tconst tabs = [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: DEFAULT_TAB_ID,\n\t\t\t\t\t\ttitle: this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_CALENDAR_BLOCK_ROOMS_ENTITY_TITLE'),\n\t\t\t\t\t},\n\t\t\t\t];\n\n\t\t\t\tconst items = [];\n\n\t\t\t\tthis.locations.rooms?.forEach((room) => {\n\t\t\t\t\titems.push({\n\t\t\t\t\t\tid: room.ID,\n\t\t\t\t\t\ttitle: room.NAME,\n\t\t\t\t\t\tsubtitle: this.getCapacityTitle(room.CAPACITY ?? null),\n\t\t\t\t\t\tentityId: DEFAULT_TAB_ID,\n\t\t\t\t\t\ttabs: DEFAULT_TAB_ID,\n\t\t\t\t\t\tavatarOptions: {\n\t\t\t\t\t\t\tbgColor: room.COLOR,\n\t\t\t\t\t\t\tbgSize: '22px',\n\t\t\t\t\t\t\tbgImage: 'none',\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcustomData: {\n\t\t\t\t\t\t\tlocationId: room.LOCATION_ID,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tthis.locationSelectorDialog = new Dialog({\n\t\t\t\t\tid: 'todo-editor-calendar-room-selector-dialog',\n\t\t\t\t\ttargetNode: this.$refs.locationSelector,\n\t\t\t\t\tcontext: 'CRM_ACTIVITY_TODO_CALENDAR_ROOM',\n\t\t\t\t\tmultiple: false,\n\t\t\t\t\tdropdownMode: true,\n\t\t\t\t\tshowAvatars: true,\n\t\t\t\t\tenableSearch: true,\n\t\t\t\t\twidth: 450,\n\t\t\t\t\theight: 300,\n\t\t\t\t\tzIndex: 2500,\n\t\t\t\t\titems,\n\t\t\t\t\ttabs,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\t'Item:onSelect': this.onSelectLocation,\n\t\t\t\t\t\t'Item:onDeselect': this.onDeselectLocation,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn this.locationSelectorDialog;\n\t\t},\n\t\tgetCapacityTitle(value: ?number): string\n\t\t{\n\t\t\tif (Type.isNil(value) || value <= 0)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\treturn this.$Bitrix.Loc.getMessage(\n\t\t\t\t'CRM_ACTIVITY_TODO_CALENDAR_BLOCK_ROOMS_CAPACITY',\n\t\t\t\t{ '#CAPACITY_VALUE#': value },\n\t\t\t);\n\t\t},\n\t\tasync fetchRoomsManagerData(): Object\n\t\t{\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tAjax\n\t\t\t\t\t.runAction('calendar.api.locationajax.getRoomsManagerData')\n\t\t\t\t\t.then((response) => {\n\t\t\t\t\t\tresolve(response.data);\n\t\t\t\t\t})\n\t\t\t\t\t.catch((errors) => {\n\t\t\t\t\t\tconsole.log(errors);\n\t\t\t\t\t})\n\t\t\t\t;\n\t\t\t});\n\t\t},\n\t\tonSelectLocation({ data }): void\n\t\t{\n\t\t\tthis.emitChangeEvent('select', data.item);\n\t\t},\n\t\tonDeselectLocation({ data }): void\n\t\t{\n\t\t\tthis.emitChangeEvent('deselect', data.item);\n\t\t},\n\t\temitChangeEvent(action: string, item: ?Object = null): void\n\t\t{\n\t\t\tthis.$emit('change', {\n\t\t\t\taction,\n\t\t\t\tid: Number(item?.id),\n\t\t\t});\n\t\t},\n\t\tgetLocationById(id: number): ?Object\n\t\t{\n\t\t\treturn (this.locations.rooms.find((location) => Number(location.ID) === id) ?? null);\n\t\t},\n\t},\n\tcomputed: {\n\t\tblockTitle(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_CALENDAR_BLOCK_ROOMS_TITLE');\n\t\t},\n\t\tlocationsListTitle(): string\n\t\t{\n\t\t\tif (Type.isNil(this.locationId))\n\t\t\t{\n\t\t\t\treturn this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_CALENDAR_BLOCK_ROOMS_LIST');\n\t\t\t}\n\n\t\t\treturn this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_CLIENT_BLOCK_CHANGE_ACTION');\n\t\t},\n\t\tselectedLocationTitle(): string\n\t\t{\n\t\t\tconst location = this.getLocationById(this.locationId);\n\t\t\tif (!location)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\treturn location.NAME;\n\t\t},\n\t\thasSelectedLocation(): boolean\n\t\t{\n\t\t\treturn Type.isNumber(this.locationId);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div v-if=\"locations\" class=\"crm-activity__todo-editor-v2_block-header\">\n\t\t\t<span\n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-icon --calendar-room\"\n\t\t\t></span>\n\t\t\t<span>\n\t\t\t\t{{ blockTitle }}\n\t\t\t</span>\n\t\t\t<span \n\t\t\t\tv-if=\"hasSelectedLocation\" \n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-data\"\n\t\t\t>\n\t\t\t\t{{ selectedLocationTitle }}\n\t\t\t</span>\n\t\t\t<span\n\t\t\t\tref=\"locationSelector\"\n\t\t\t\t@click=\"showLocationSelectorDialog\"\n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-action\"\n\t\t\t>\n\t\t\t\t{{ locationsListTitle }}\n\t\t\t</span>\n\t\t\t<div\n\t\t\t\t@click=\"$emit('close')\"\n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-close\"\n\t\t\t></div>\n\t\t</div>\n\t\t<div v-else class=\"crm-activity__todo-editor-v2_block-header --skeleton\"></div>\n\t`,\n};\n","import { Planner } from 'calendar.planner';\nimport 'ui.design-tokens';\nimport { ajax as Ajax, Text, Type } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport { DateTimeFormat, Timezone } from 'main.date';\nimport { Dialog } from 'ui.entity-selector';\nimport type { BlockSettings } from '../../../todo-editor';\nimport { Events } from '../../todo-editor';\nimport { LocationSelector } from './location-selector';\n\nexport const TodoEditorBlocksCalendar = {\n\tcomponents: {\n\t\tLocationSelector,\n\t},\n\n\tprops: {\n\t\tid: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\ticon: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsettings: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tcontext: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tfilledValues: {\n\t\t\ttype: Object,\n\t\t},\n\t\tisFocused: {\n\t\t\ttype: Boolean,\n\t\t},\n\t},\n\n\temits: [\n\t\t'close',\n\t\t'updateFilledValues',\n\t],\n\n\tdata(): Object\n\t{\n\t\tconst ownerId = this.settings.ownerId || this.context.ownerId;\n\n\t\tconst selectedUserIds: Set<number> = new Set();\n\t\tselectedUserIds.add(ownerId);\n\n\t\tconst timestamp = (this.settings.from || Timezone.UserTime.getTimestamp()) * 1000;\n\t\tconst millisecondsInFiveMinutes = 5 * 60 * 1000;\n\n\t\t// round timestamp to 5 minutes\n\t\tconst from = Math.ceil(timestamp / millisecondsInFiveMinutes) * millisecondsInFiveMinutes;\n\n\t\tconst duration = Number(this.settings.duration ?? 60 * 60) * 1000;\n\t\tconst to = from + duration;\n\n\t\tconst data = {\n\t\t\tselectedUserIds,\n\t\t\tfrom,\n\t\t\tto,\n\t\t\tduration,\n\t\t\tplannerInstance: null,\n\t\t\tshowLocation: this.settings.showLocation ?? false,\n\t\t\tlocationId: null,\n\t\t\ttimezoneName: this.settings.timezoneName,\n\t\t\townerId,\n\t\t};\n\n\t\treturn this.getPreparedData(data);\n\t},\n\n\tmounted(): void\n\t{\n\t\tthis.$Bitrix.eventEmitter.subscribe(Events.EVENT_RESPONSIBLE_USER_CHANGE, this.onResponsibleUserChange);\n\t\tthis.$Bitrix.eventEmitter.subscribe(Events.EVENT_DEADLINE_CHANGE, this.onDeadlineChange);\n\n\t\tthis.showPlanner();\n\n\t\tthis.getPlanner().selector.subscribe('onChange', this.handlePlannerSelectorChanges.bind(this));\n\n\t\tconst userIds = this.selectedUsersIdsArray;\n\t\tconst data = this.prepareUpdatePlannerData(userIds);\n\t\tthis.updatePlanner(userIds, data);\n\n\t\tif (this.settings.showUserSelector && this.isFocused)\n\t\t{\n\t\t\tthis.showUserSelectorDialog();\n\t\t}\n\t},\n\n\tbeforeUnmount()\n\t{\n\t\tthis.$Bitrix.eventEmitter.unsubscribe(Events.EVENT_DEADLINE_CHANGE, this.onDeadlineChange);\n\t},\n\n\tmethods: {\n\t\tgetPreparedData(data: Object): Object\n\t\t{\n\t\t\tconst { filledValues } = this;\n\n\t\t\tif (Type.isObject(filledValues))\n\t\t\t{\n\t\t\t\tif (Type.isObject(filledValues.attendeesEntityList))\n\t\t\t\t{\n\t\t\t\t\tObject\n\t\t\t\t\t\t.values(filledValues.attendeesEntityList)\n\t\t\t\t\t\t.filter(({ entityId }) => entityId === 'user')\n\t\t\t\t\t\t.forEach(({ id }) => data.selectedUserIds.add(id))\n\t\t\t\t\t;\n\t\t\t\t}\n\n\t\t\t\tif (Type.isStringFilled(filledValues.location))\n\t\t\t\t{\n\t\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\t\tdata.showLocation = true;\n\t\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\t\tdata.locationId = Number(filledValues.location.split('_')[1]); //calendar_7_123, need 7 as id\n\t\t\t\t}\n\n\t\t\t\tif (Type.isObject(filledValues.selectedUserIds))\n\t\t\t\t{\n\t\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\t\tdata.selectedUserIds = filledValues.selectedUserIds;\n\t\t\t\t}\n\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tdata.from = Number(filledValues.from);\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tdata.to = Number(filledValues.to);\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tdata.duration = Number(filledValues.duration);\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tdata.timezoneName = filledValues.timezoneFrom;\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tdata.ownerId = filledValues.ownerId;\n\t\t\t}\n\n\t\t\treturn data;\n\t\t},\n\t\tgetId(): string\n\t\t{\n\t\t\treturn 'calendar';\n\t\t},\n\t\tshowPlanner(): void\n\t\t{\n\t\t\tthis.getPlanner().show();\n\t\t},\n\t\tgetPlanner(): Planner\n\t\t{\n\t\t\tif (this.plannerInstance === null)\n\t\t\t{\n\t\t\t\tthis.plannerInstance = new Planner({\n\t\t\t\t\twrap: this.$refs.plannerContainer,\n\t\t\t\t\tcompactMode: false,\n\t\t\t\t\tshowEntryName: false,\n\t\t\t\t\tminWidth: 770,\n\t\t\t\t\tminHeight: 104,\n\t\t\t\t\theight: 104,\n\t\t\t\t\twidth: 770,\n\t\t\t\t\tentryTimezone: this.timezoneName,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn this.plannerInstance;\n\t\t},\n\t\tprepareUpdatePlannerData(newUserIds: number[], oldUserIds: number[] = []): Object\n\t\t{\n\t\t\tconst location = (this.locationId ? this.location : '');\n\n\t\t\tconst data = {\n\t\t\t\townerId: this.ownerId,\n\t\t\t\ttype: 'user',\n\t\t\t\tentityList: [],\n\t\t\t\tdateFrom: this.getFormattedDate('beforeOneWeek'),\n\t\t\t\tdateTo: this.getFormattedDate('afterTwoWeeks'),\n\t\t\t\ttimezone: this.timezoneName,\n\t\t\t\tlocation,\n\t\t\t\tentries: false,\n\t\t\t\tprevUserList: oldUserIds,\n\t\t\t};\n\n\t\t\tnewUserIds.forEach((userId) => {\n\t\t\t\tdata.entityList.push({\n\t\t\t\t\tentityId: 'user',\n\t\t\t\t\tid: userId,\n\t\t\t\t\tentityType: 'employee',\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn data;\n\t\t},\n\t\tupdatePlanner(userIds: number[], data: Object): void\n\t\t{\n\t\t\tthis.getPlanner().showLoader();\n\n\t\t\tAjax\n\t\t\t\t.runAction('calendar.api.calendarajax.updatePlanner', { data })\n\t\t\t\t.then(\n\t\t\t\t\t(response) => {\n\t\t\t\t\t\tconst accessibility = {};\n\t\t\t\t\t\tuserIds.forEach((userId) => {\n\t\t\t\t\t\t\tif (response.data.accessibility[userId])\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\taccessibility[userId] = response.data.accessibility[userId];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\taccessibility[userId] = [];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (this.locationId)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst roomId = `room_${this.locationId}`;\n\t\t\t\t\t\t\taccessibility[roomId] = response.data.accessibility[roomId];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.getPlanner().hideLoader();\n\t\t\t\t\t\tthis.getPlanner().update(response.data.entries, accessibility);\n\n\t\t\t\t\t\tthis.onDataUpdate();\n\n\t\t\t\t\t\t// @todo check this\n\t\t\t\t\t\t// this.plannerInstance.updateSelector(\n\t\t\t\t\t\t// \tUtil.adjustDateForTimezoneOffset(\n\t\t\t\t\t\t// \t\ttestData.entry.from,\n\t\t\t\t\t\t// \t\ttestData.entry.userTimezoneOffsetFrom,\n\t\t\t\t\t\t// \t\ttestData.entry.fullDay),\n\t\t\t\t\t\t// \tUtil.adjustDateForTimezoneOffset(\n\t\t\t\t\t\t// \t\ttestData.entry.to,\n\t\t\t\t\t\t// \t\ttestData.entry.userTimezoneOffsetTo,\n\t\t\t\t\t\t// \t\ttestData.entry.fullDay\n\t\t\t\t\t\t// \t),\n\t\t\t\t\t\t// \ttestData.entry.fullDay\n\t\t\t\t\t\t//\n\t\t\t\t\t\t// );\n\t\t\t\t\t},\n\t\t\t\t\t(response) => {\n\t\t\t\t\t\tconsole.error(response);\n\t\t\t\t\t},\n\t\t\t\t)\n\t\t\t\t.catch((errors) => {\n\t\t\t\t\tconsole.error(errors);\n\t\t\t\t})\n\t\t\t;\n\t\t},\n\t\tonDataUpdate(): void\n\t\t{\n\t\t\tthis.updatePlannerSelector();\n\n\t\t\tthis.$Bitrix.eventEmitter.emit(Events.EVENT_CALENDAR_CHANGE, {\n\t\t\t\tfrom: this.from,\n\t\t\t\tto: this.from + this.duration,\n\t\t\t});\n\n\t\t\tthis.emitUpdateFilledValues();\n\t\t},\n\t\temitUpdateFilledValues(): void\n\t\t{\n\t\t\tlet { filledValues } = this;\n\t\t\tconst { to, from, duration, location, selectedUserIds, ownerId } = this;\n\n\t\t\tconst newFilledValues = {\n\t\t\t\tto,\n\t\t\t\tfrom,\n\t\t\t\tduration,\n\t\t\t\tlocation,\n\t\t\t\tselectedUserIds,\n\t\t\t\townerId,\n\t\t\t};\n\t\t\tfilledValues = { ...filledValues, ...newFilledValues };\n\t\t\tthis.$emit('updateFilledValues', this.getId(), filledValues);\n\t\t},\n\t\tupdatePlannerSelector(): void\n\t\t{\n\t\t\tconst dateFrom = this.createDateInstance(this.from);\n\t\t\tconst dateTo = this.createDateInstance(this.from + this.duration);\n\n\t\t\tthis.getPlanner().updateSelector(dateFrom, dateTo);\n\t\t},\n\t\tcreateDateInstance(timestamp: number | null = null, startOfDay: boolean = false): Date\n\t\t{\n\t\t\tif (!timestamp)\n\t\t\t{\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\ttimestamp = Date.now();\n\t\t\t}\n\n\t\t\tconst date = new Date(timestamp);\n\t\t\tif (startOfDay)\n\t\t\t{\n\t\t\t\tdate.setHours(0, 0, 0, 0);\n\t\t\t}\n\n\t\t\treturn date;\n\t\t},\n\t\tgetFormattedDate(id: string): string\n\t\t{\n\t\t\treturn this.getFormattedValue(id, DateTimeFormat.getFormat('SHORT_DATE_FORMAT'));\n\t\t},\n\t\tgetFormattedValue(id: string, format: string): string\n\t\t{\n\t\t\tlet timestamp = 0;\n\n\t\t\tswitch (id)\n\t\t\t{\n\t\t\t\tcase 'beforeOneWeek':\n\t\t\t\t{\n\t\t\t\t\ttimestamp = this.from - 8 * 24 * 60 * 60 * 1000;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tcase 'from':\n\t\t\t\t{\n\t\t\t\t\ttimestamp = this.from;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tcase 'to':\n\t\t\t\t{\n\t\t\t\t\ttimestamp = this.from + this.duration;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tcase 'afterTwoWeeks':\n\t\t\t\t{\n\t\t\t\t\ttimestamp = this.from + 14 * 24 * 60 * 60 * 1000;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tdefault:\n\t\t\t\t\ttimestamp = 0;\n\t\t\t}\n\n\t\t\treturn DateTimeFormat.format(format, timestamp / 1000);\n\t\t},\n\t\tshowUserSelectorDialog(): void\n\t\t{\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.getUserSelectorDialog().show();\n\t\t\t}, 5);\n\t\t},\n\t\tgetUserSelectorDialog(): Dialog\n\t\t{\n\t\t\tif (Type.isNil(this.userSelectorDialog))\n\t\t\t{\n\t\t\t\tconst preselectedItems = [];\n\t\t\t\tthis.selectedUsersIdsArray.forEach((id) => {\n\t\t\t\t\tpreselectedItems.push(['user', id]);\n\t\t\t\t});\n\n\t\t\t\tconst undeselectedItems = [\n\t\t\t\t\t['user', this.context.userId],\n\t\t\t\t];\n\n\t\t\t\tthis.userSelectorDialog = new Dialog({\n\t\t\t\t\tid: 'todo-editor-calendar-user-selector-dialog',\n\t\t\t\t\ttargetNode: this.$refs.userSelector,\n\t\t\t\t\tcontext: 'CRM_ACTIVITY_TODO_CALENDAR_RESPONSIBLE_USER',\n\t\t\t\t\tmultiple: true,\n\t\t\t\t\tdropdownMode: true,\n\t\t\t\t\tshowAvatars: true,\n\t\t\t\t\tenableSearch: true,\n\t\t\t\t\twidth: 450,\n\t\t\t\t\tzIndex: 2500,\n\t\t\t\t\tentities: [{ id: 'user' }],\n\t\t\t\t\tpreselectedItems,\n\t\t\t\t\tundeselectedItems,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\t'Item:onSelect': this.onSelectUser,\n\t\t\t\t\t\t'Item:onDeselect': this.onDeselectUser,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn this.userSelectorDialog;\n\t\t},\n\t\tonSelectUser({ data: { item } }): void\n\t\t{\n\t\t\tthis.selectedUserIds.add(item.id);\n\t\t},\n\t\tonDeselectUser({ data: { item } }): void\n\t\t{\n\t\t\tthis.selectedUserIds.delete(item.id);\n\t\t},\n\t\tgetSelectedUserIds(): Number[]\n\t\t{\n\t\t\treturn this.selectedUserIds ?? [];\n\t\t},\n\t\tonResponsibleUserChange(event: BaseEvent): void\n\t\t{\n\t\t\tconst { responsibleUserId } = event.getData();\n\n\t\t\tthis.ownerId = responsibleUserId;\n\t\t\tthis.selectedUserIds.add(responsibleUserId);\n\t\t},\n\t\tonDeadlineChange(event: BaseEvent): void\n\t\t{\n\t\t\tconst data = event.getData();\n\t\t\tif (data)\n\t\t\t{\n\t\t\t\tconst deadline = data.deadline.getTime();\n\t\t\t\tthis.from = deadline;\n\t\t\t\tthis.to = this.from + deadline;\n\t\t\t}\n\t\t},\n\t\thandlePlannerSelectorChanges({ data: { dateFrom, dateTo } }): void\n\t\t{\n\t\t\tthis.from = dateFrom.getTime();\n\t\t\tthis.duration = dateTo.getTime() - this.from;\n\n\t\t\tthis.$Bitrix.eventEmitter.emit(Events.EVENT_CALENDAR_CHANGE, {\n\t\t\t\tfrom: this.from,\n\t\t\t\tto: this.from + this.duration,\n\t\t\t});\n\t\t},\n\t\t// @todo\n\t\t/* getAccessibilityForUsers(): Promise\n\t\t{\n\t\t\tconst offset = 12 * 24 * 3600; //12 days\n\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tconst config = {\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tfrom: this.from - offset,\n\t\t\t\t\t\tto: this.from + offset,\n\t\t\t\t\t\t// @todo add currentEventId\n\t\t\t\t\t\t//currentEventId:\n\t\t\t\t\t},\n\t\t\t\t};\n\n\t\t\t\tAjax.runAction('crm.activity.settings.calendar.getAccessibilityForUsers', config)\n\t\t\t\t\t.then((response) => resolve(response))\n\t\t\t\t\t.catch((errors) => {\n\t\t\t\t\t\tconsole.log(errors);\n\t\t\t\t\t})\n\t\t\t\t;\n\t\t\t});\n\t\t}, */\n\t\tupdateSettings(data: Object | null): void\n\t\t{\n\t\t\tif (!data || !data.deadline)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.from = data.deadline.getTime();\n\t\t},\n\t\tonSelectLocation({ action, id }): void\n\t\t{\n\t\t\tthis.locationId = (action === 'select' ? id : null);\n\t\t},\n\t\tonCloseLocationBlock(): void\n\t\t{\n\t\t\tthis.locationId = null;\n\t\t\tthis.showLocation = false;\n\t\t},\n\t\tgetExecutedData(): Object\n\t\t{\n\t\t\tconst { duration } = this;\n\n\t\t\treturn {\n\t\t\t\tfrom: this.from,\n\t\t\t\tto: this.from + duration,\n\t\t\t\tduration,\n\t\t\t\tselectedUserIds: [...this.getSelectedUserIds()],\n\t\t\t\tlocation: this.location,\n\t\t\t};\n\t\t},\n\t\tprepareDataOnBlockConstruct(data: BlockSettings, params: Object): Object\n\t\t{\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\tdata.settings.from = params.currentDeadline.getTime() / 1000;\n\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\tdata.settings.ownerId = params.responsibleUserId;\n\t\t},\n\t},\n\n\tcomputed: {\n\t\tencodedTitle(): string\n\t\t{\n\t\t\treturn Text.encode(this.title);\n\t\t},\n\t\ticonStyles(): Object\n\t\t{\n\t\t\tif (!this.icon)\n\t\t\t{\n\t\t\t\treturn {};\n\t\t\t}\n\n\t\t\tconst path = `/bitrix/js/crm/activity/todo-editor-v2/images/${this.icon}`;\n\n\t\t\treturn {\n\t\t\t\tbackground: `url('${encodeURI(Text.encode(path))}') center center`,\n\t\t\t};\n\t\t},\n\t\tusersList(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_CALENDAR_BLOCK_USERS_LIST');\n\t\t},\n\t\tlocation(): string\n\t\t{\n\t\t\treturn this.locationId ? `calendar_${this.locationId}` : '';\n\t\t},\n\t\tselectedUsersIdsArray(): number[]\n\t\t{\n\t\t\treturn [...this.selectedUserIds];\n\t\t},\n\t},\n\n\tcreated()\n\t{\n\t\tthis.$watch(\n\t\t\t'ownerId',\n\t\t\t(newOwnerId: number, oldOwnerId: number) => {\n\t\t\t\tif (this.selectedUserIds.has(newOwnerId))\n\t\t\t\t{\n\t\t\t\t\tconst userIds = this.selectedUsersIdsArray;\n\t\t\t\t\tconst data = this.prepareUpdatePlannerData(userIds);\n\t\t\t\t\tthis.updatePlanner(userIds, data);\n\t\t\t\t}\n\t\t\t},\n\t\t);\n\n\t\tthis.$watch(\n\t\t\t'selectedUserIds',\n\t\t\t(newUserIds, oldUserIds) => {\n\t\t\t\tconst data = this.prepareUpdatePlannerData(newUserIds, oldUserIds);\n\t\t\t\tthis.updatePlanner(newUserIds, data);\n\t\t\t},\n\t\t\t{\n\t\t\t\tdeep: true,\n\t\t\t},\n\t\t);\n\n\t\tthis.$watch(\n\t\t\t'settings',\n\t\t\t(newSettings, oldSettings) => {\n\t\t\t\tconst showLocation = Boolean(newSettings.showLocation ?? false);\n\t\t\t\tthis.showLocation = Type.isStringFilled(this.filledValues.location) || showLocation;\n\n\t\t\t\tif (oldSettings.showUserSelector !== newSettings.showUserSelector && newSettings.showUserSelector)\n\t\t\t\t{\n\t\t\t\t\tthis.showUserSelectorDialog();\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tdeep: true,\n\t\t\t},\n\t\t);\n\t},\n\n\twatch: {\n\t\tduration(): void\n\t\t{\n\t\t\tthis.onDataUpdate();\n\t\t},\n\t\tfrom(): void\n\t\t{\n\t\t\tthis.onDataUpdate();\n\t\t},\n\t\tto(): void\n\t\t{\n\t\t\tthis.onDataUpdate();\n\t\t},\n\t\tlocationId(newLocationId, oldLocationId): void\n\t\t{\n\t\t\tconst newUserIds = this.selectedUsersIdsArray;\n\n\t\t\tconst data = this.prepareUpdatePlannerData(newUserIds);\n\n\t\t\tthis.updatePlanner(newUserIds, data);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"crm-activity__todo-editor-v2_block-header\">\n\t\t\t<span\n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-icon\"\n\t\t\t\t:style=\"iconStyles\"\n\t\t\t></span>\n\t\t\t<span>{{ encodedTitle }}</span>\n\t\t\t<span \n\t\t\t\tref=\"userSelector\"\n\t\t\t\t@click=\"showUserSelectorDialog\"\n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-action\"\n\t\t\t>\n\t\t\t\t{{ usersList }}\n\t\t\t</span>\n\t\t\t<div\n\t\t\t\t@click=\"$emit('close', id)\"\n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-close\"\n\t\t\t></div>\n\t\t</div>\n\t\t<div class=\"crm-activity__todo-editor-v2_block-body\">\n\t\t\t<div class=\"crm-activity__settings_popup__calendar-container\">\n\t\t\t\t<div ref=\"plannerContainer\" class=\"crm-activity__settings_popup__calendar__planner-container\"></div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div v-if=\"showLocation\">\n\t\t\t<LocationSelector\n\t\t\t\t@change=\"onSelectLocation\"\n\t\t\t\t@close=\"onCloseLocationBlock\"\n\t\t\t\t:locationId=\"locationId\"\n\t\t\t\t:forceShowLocationSelectorDialog=\"isFocused && !this.settings.showUserSelector\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { ClientSelector } from 'crm.client-selector';\nimport { ajax as Ajax, Text, Type } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Dialog } from 'ui.entity-selector';\nimport { UI } from 'ui.notification';\n\nexport const TodoEditorBlocksClient = {\n\tprops: {\n\t\tid: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\ticon: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsettings: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tfilledValues: {\n\t\t\ttype: Object,\n\t\t},\n\t\tcontext: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tisFocused: {\n\t\t\ttype: Boolean,\n\t\t},\n\t},\n\n\temits: [\n\t\t'close',\n\t\t'updateFilledValues',\n\t],\n\n\tdata(): Object\n\t{\n\t\tconst data = {\n\t\t\tselectedClients: new Set(),\n\t\t\tisFetchedConfig: false,\n\t\t\tclients: [],\n\t\t};\n\n\t\treturn this.getPreparedData(data);\n\t},\n\n\tmounted()\n\t{\n\t\tthis.fetchConfig();\n\t\tthis.subscribeToReceiversChanges();\n\t},\n\n\tmethods: {\n\t\tgetId(): string\n\t\t{\n\t\t\treturn 'client';\n\t\t},\n\t\tgetPreparedData(data: Object): Object\n\t\t{\n\t\t\tconst { filledValues } = this;\n\n\t\t\tif (Type.isObject(filledValues?.clients))\n\t\t\t{\n\t\t\t\tfilledValues.clients.forEach(({ entityId, entityTypeId, isAvailable }) => {\n\t\t\t\t\tdata.selectedClients.add({\n\t\t\t\t\t\tentityId: Number(entityId),\n\t\t\t\t\t\tentityTypeId: Number(entityTypeId),\n\t\t\t\t\t\tisAvailable,\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (Type.isObject(filledValues?.selectedClients))\n\t\t\t{\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tdata.selectedClients = filledValues.selectedClients;\n\t\t\t}\n\n\t\t\treturn data;\n\t\t},\n\t\tsubscribeToReceiversChanges(): void\n\t\t{\n\t\t\tEventEmitter.subscribe('BX.Crm.MessageSender.ReceiverRepository:OnReceiversChanged', this.onReceiversChanged);\n\t\t},\n\t\tonReceiversChanged(event: BaseEvent): void\n\t\t{\n\t\t\tconst { item } = event.getData();\n\n\t\t\tif (this.entityTypeId !== item?.entityTypeId || this.entityId !== item?.entityId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.fetchConfig(true);\n\t\t},\n\t\tonShowAddClientPhoneSelector(): void\n\t\t{\n\t\t\tconst id = 'client-selector-dialog';\n\t\t\tconst context = `CRM_TIMELINE_TODO-${this.entityTypeId}`;\n\n\t\t\tif (!this.userSelectorDialog)\n\t\t\t{\n\t\t\t\tthis.userSelectorDialog = new Dialog({\n\t\t\t\t\tid,\n\t\t\t\t\tcontext,\n\t\t\t\t\ttargetNode: this.$refs.addClientsSelector,\n\t\t\t\t\tmultiple: false,\n\t\t\t\t\tdropdownMode: false,\n\t\t\t\t\tshowAvatars: true,\n\t\t\t\t\tenableSearch: true,\n\t\t\t\t\twidth: 450,\n\t\t\t\t\tzIndex: 2500,\n\t\t\t\t\tentities: this.getClientSelectorEntities(),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\t'Item:onSelect': this.onAddClient,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (this.userSelectorDialog.isOpen())\n\t\t\t{\n\t\t\t\tthis.userSelectorDialog.hide();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.userSelectorDialog.setTargetNode(this.$refs.addClientsSelector);\n\t\t\t\t\tthis.userSelectorDialog.show();\n\t\t\t\t}, 5);\n\t\t\t}\n\t\t},\n\t\tasync onAddClient(event: BaseEvent): void\n\t\t{\n\t\t\tif (this.isClientBindingInProgress)\n\t\t\t{\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isClientBindingInProgress = true;\n\n\t\t\tconst { item } = event.getData();\n\n\t\t\tconst entityId = item.id;\n\t\t\tconst entityTypeId = BX.CrmEntityType.resolveId(item.entityId);\n\n\t\t\tconst isBound = await this.bindClient(entityId, entityTypeId);\n\t\t\tif (isBound)\n\t\t\t{\n\t\t\t\tBX.Crm.EntityEditor?.getDefault()?.reload();\n\t\t\t}\n\t\t},\n\t\tasync bindClient(clientId: number, clientTypeId: number): Promise\n\t\t{\n\t\t\tconst ajaxParams = {\n\t\t\t\tentityId: this.entityId,\n\t\t\t\tentityTypeId: this.entityTypeId,\n\t\t\t\tclientId,\n\t\t\t\tclientTypeId,\n\t\t\t};\n\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tAjax.runAction('crm.activity.todo.bindClient', { data: ajaxParams })\n\t\t\t\t\t.then(({ data }) => {\n\t\t\t\t\t\tthis.isClientBindingInProgress = false;\n\n\t\t\t\t\t\tif (!data)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tresolve(false);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (Type.isArrayFilled(data.clients))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.clients = data.clients;\n\n\t\t\t\t\t\t\tthis.selectedClients.add({\n\t\t\t\t\t\t\t\tentityId: clientId,\n\t\t\t\t\t\t\t\tentityTypeId: clientTypeId,\n\t\t\t\t\t\t\t\tisAvailable: true,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresolve(true);\n\t\t\t\t\t})\n\t\t\t\t\t.catch((data) => {\n\t\t\t\t\t\tthis.isClientBindingInProgress = false;\n\n\t\t\t\t\t\tif (data.errors.length > 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.showNotify(data.errors[0].message);\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.showNotify(this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_BIND_CLIENT_ERROR'));\n\t\t\t\t\t})\n\t\t\t\t;\n\t\t\t});\n\t\t},\n\t\tshowNotify(content: string): void\n\t\t{\n\t\t\tUI.Notification.Center.notify({ content });\n\t\t},\n\t\tonShowClientSelector(): void\n\t\t{\n\t\t\tif (this.clientSelector && this.clientSelector.isOpen())\n\t\t\t{\n\t\t\t\tthis.clientSelector.hide();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst targetNode = this.$refs.clientsContainer;\n\n\t\t\t\tthis.clientSelector = ClientSelector.createFromItems({\n\t\t\t\t\ttargetNode,\n\t\t\t\t\tmultiple: true,\n\t\t\t\t\titems: this.clients,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonSelect: this.onSelectClient,\n\t\t\t\t\t\tonDeselect: this.onDeselectClient,\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.availableSelectedClients.forEach(({ entityId, entityTypeId }) => {\n\t\t\t\t\t\tthis.clientSelector.setSelectedItemByEntityData(entityId, entityTypeId);\n\t\t\t\t\t});\n\t\t\t\t\tthis.clientSelector.show();\n\t\t\t\t}, 5);\n\t\t\t}\n\t\t},\n\t\tgetClientSelectorEntities(): []\n\t\t{\n\t\t\tconst contact = {\n\t\t\t\tid: 'contact',\n\t\t\t\tdynamicLoad: true,\n\t\t\t\tdynamicSearch: true,\n\t\t\t\toptions: {\n\t\t\t\t\tshowTab: true,\n\t\t\t\t\tshowPhones: true,\n\t\t\t\t\tshowMails: true,\n\t\t\t\t\thideReadMoreLink: true,\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tconst company = {\n\t\t\t\tid: 'company',\n\t\t\t\tdynamicLoad: true,\n\t\t\t\tdynamicSearch: true,\n\t\t\t\toptions: {\n\t\t\t\t\texcludeMyCompany: true,\n\t\t\t\t\tshowTab: true,\n\t\t\t\t\tshowPhones: true,\n\t\t\t\t\tshowMails: true,\n\t\t\t\t\thideReadMoreLink: true,\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tif (this.entityTypeId === BX.CrmEntityType.enumeration.contact)\n\t\t\t{\n\t\t\t\treturn [company];\n\t\t\t}\n\n\t\t\tif (this.entityTypeId === BX.CrmEntityType.enumeration.company)\n\t\t\t{\n\t\t\t\treturn [contact];\n\t\t\t}\n\n\t\t\treturn [contact, company];\n\t\t},\n\t\tonSelectClient({ data: { item } }): void\n\t\t{\n\t\t\tthis.selectedClients.add({\n\t\t\t\tentityId: item.customData.get('entityId'),\n\t\t\t\tentityTypeId: item.customData.get('entityTypeId'),\n\t\t\t\tisAvailable: true,\n\t\t\t});\n\t\t},\n\t\tonDeselectClient({ data: { item } }): void\n\t\t{\n\t\t\tthis.selectedClients.forEach((client) => {\n\t\t\t\tif (\n\t\t\t\t\tclient.entityId === item.customData.get('entityId')\n\t\t\t\t\t&& client.entityTypeId === item.customData.get('entityTypeId')\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.selectedClients.delete(client);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tfetchConfig(force: boolean = false): void\n\t\t{\n\t\t\tif (this.isFetchedConfig && !force)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isFetchedConfig = false;\n\n\t\t\tif (!this.entityTypeId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst ajaxParameters = {\n\t\t\t\tentityTypeId: this.entityTypeId,\n\t\t\t\tentityId: this.entityId,\n\t\t\t};\n\n\t\t\tAjax.runAction('crm.activity.todo.getClientConfig', { data: ajaxParameters })\n\t\t\t\t.then(({ data }) => {\n\t\t\t\t\tthis.isFetchedConfig = true;\n\n\t\t\t\t\tif (Type.isArrayFilled(data.clients))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.clients = data.clients;\n\n\t\t\t\t\t\tif (this.selectedClients.size === 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst { entityId, entityTypeId } = data.clients[0].customData;\n\n\t\t\t\t\t\t\tthis.selectedClients.add({\n\t\t\t\t\t\t\t\tentityId,\n\t\t\t\t\t\t\t\tentityTypeId,\n\t\t\t\t\t\t\t\tisAvailable: true,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch(() => {\n\t\t\t\t\tBX.UI.Notification.Center.notify({ content: this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_ERROR') });\n\t\t\t\t})\n\t\t\t;\n\t\t},\n\t\tonShowClient({ entityId, entityTypeId }): void\n\t\t{\n\t\t\tlet path = '';\n\t\t\tif (entityTypeId === BX.CrmEntityType.enumeration.company)\n\t\t\t{\n\t\t\t\tpath = `/crm/company/details/${Number(entityId)}/`;\n\t\t\t}\n\n\t\t\tif (entityTypeId === BX.CrmEntityType.enumeration.contact)\n\t\t\t{\n\t\t\t\tpath = `/crm/contact/details/${Number(entityId)}/`;\n\t\t\t}\n\n\t\t\tif (!Type.isStringFilled(path))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (BX.SidePanel)\n\t\t\t{\n\t\t\t\tBX.SidePanel.Instance.open(path);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\twindow.top.location.href = path;\n\t\t\t}\n\t\t},\n\t\tgetClientTitleFormatted(entityId: number, entityTypeId: number, showComma: boolean = false): string\n\t\t{\n\t\t\tconst clientInfo = this.getClientInfo(entityId, entityTypeId);\n\n\t\t\tif (!clientInfo)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tconst comma = showComma ? ', ' : '';\n\n\t\t\treturn `${clientInfo.title}${comma}`;\n\t\t},\n\t\tgetClientInfo(entityId: number, entityTypeId: number): Object | undefined\n\t\t{\n\t\t\treturn this.clients.find(\n\t\t\t\t({ customData }) => {\n\t\t\t\t\treturn customData.entityId === entityId && customData.entityTypeId === entityTypeId;\n\t\t\t\t},\n\t\t\t);\n\t\t},\n\t\tgetExecutedData(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\tselectedClients: [...this.selectedClients],\n\t\t\t};\n\t\t},\n\t\temitUpdateFilledValues(): void\n\t\t{\n\t\t\tlet { filledValues } = this;\n\t\t\tconst { selectedClients } = this;\n\n\t\t\tconst newFilledValues = {\n\t\t\t\tselectedClients,\n\t\t\t};\n\t\t\tfilledValues = { ...filledValues, ...newFilledValues };\n\t\t\tthis.$emit('updateFilledValues', this.getId(), filledValues);\n\t\t},\n\t},\n\n\tcomputed: {\n\t\tencodedTitle(): string\n\t\t{\n\t\t\treturn Text.encode(this.title);\n\t\t},\n\t\ticonStyles(): Object\n\t\t{\n\t\t\tif (!this.icon)\n\t\t\t{\n\t\t\t\treturn {};\n\t\t\t}\n\n\t\t\tconst path = `/bitrix/js/crm/activity/todo-editor-v2/images/${this.icon}`;\n\n\t\t\treturn {\n\t\t\t\tbackground: `url('${encodeURI(Text.encode(path))}') center center`,\n\t\t\t};\n\t\t},\n\t\tchangeTitle(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_CLIENT_BLOCK_CHANGE_ACTION');\n\t\t},\n\t\taddTitle(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_CLIENT_BLOCK_ADD_ACTION');\n\t\t},\n\t\thasClients(): boolean\n\t\t{\n\t\t\treturn Type.isArrayFilled(this.availableSelectedClients);\n\t\t},\n\t\tentityTypeId(): number\n\t\t{\n\t\t\treturn this.settings.entityTypeId;\n\t\t},\n\t\tentityId(): number\n\t\t{\n\t\t\treturn this.settings.entityId;\n\t\t},\n\t\tavailableSelectedClients(): []\n\t\t{\n\t\t\treturn [...this.selectedClients].filter((client) => client.isAvailable);\n\t\t},\n\t},\n\n\tcreated()\n\t{\n\t\tthis.$watch(\n\t\t\t'selectedClients',\n\t\t\tthis.emitUpdateFilledValues,\n\t\t\t{\n\t\t\t\tdeep: true,\n\t\t\t},\n\t\t);\n\t},\n\n\ttemplate: `\n\t\t<div v-if=\"isFetchedConfig\" class=\"crm-activity__todo-editor-v2_block-header\">\n\t\t\t<span\n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-icon\"\n\t\t\t\t:style=\"iconStyles\"\n\t\t\t></span>\n\t\t\t<span>{{ encodedTitle }}</span>\n\t\t\t<span \n\t\t\t\tv-if=\"hasClients\"\n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-data\"\n\t\t\t>\n\t\t\t\t<span\n\t\t\t\t\tv-for=\"(client, index) in availableSelectedClients\"\n\t\t\t\t\t:key=\"client.entityTypeId + '-' + client.entityId\"\n\t\t\t\t\t@click=\"onShowClient(client)\"\n\t\t\t\t>\n\t\t\t\t\t<template v-if=\"Boolean(getClientInfo(client.entityId, client.entityTypeId))\">\n\t\t\t\t\t\t{{ getClientTitleFormatted(client.entityId, client.entityTypeId, index !== availableSelectedClients.length - 1) }}\n\t\t\t\t\t</template>\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t\t<span ref=\"clientsContainer\">\n\t\t\t\t<span\n\t\t\t\t\tv-if=\"hasClients\"\n\t\t\t\t\tref=\"clientsSelector\"\n\t\t\t\t\t@click=\"onShowClientSelector\"\n\t\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-action\"\n\t\t\t\t>\n\t\t\t\t\t{{ changeTitle }}\n\t\t\t\t</span>\n\t\t\t\t<span\n\t\t\t\t\tv-else\n\t\t\t\t\tref=\"addClientsSelector\"\n\t\t\t\t\t@click=\"onShowAddClientPhoneSelector\"\n\t\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-action\"\n\t\t\t\t>\n\t\t\t\t\t{{ addTitle }}\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t\t<div\n\t\t\t\t@click=\"$emit('close', id)\"\n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-close\"\n\t\t\t></div>\n\t\t</div>\n\t\t<div v-else class=\"crm-activity__todo-editor-v2_block-header --skeleton\"></div>\n\t`,\n};\n","import { Text, Type } from 'main.core';\nimport { TileWidgetComponent } from 'ui.uploader.tile-widget';\n\nconst MAX_UPLOAD_FILE_SIZE = 1024 * 1024 * 50; // 50M;\n\nexport const TodoEditorBlocksFile = {\n\tcomponents: {\n\t\tTileWidgetComponent,\n\t},\n\n\tprops: {\n\t\tid: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\ticon: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsettings: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tfilledValues: {\n\t\t\ttype: Object,\n\t\t},\n\t\tcontext: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tisFocused: {\n\t\t\ttype: Boolean,\n\t\t},\n\t},\n\n\temits: [\n\t\t'close',\n\t\t'updateFilledValues',\n\t],\n\n\tdata(): Object\n\t{\n\t\tconst data = {\n\t\t\tfileTokens: [],\n\t\t};\n\n\t\treturn this.getPreparedData(data);\n\t},\n\n\tmounted(): void\n\t{\n\t\tconst needShowLoaderPopup = !(BX.localStorage && BX.localStorage.get('skip_autoshow_file_selector'));\n\t\tif (this.isFocused && needShowLoaderPopup)\n\t\t{\n\t\t\tvoid this.$nextTick(this.onShowUploaderPopup);\n\t\t}\n\n\t\tthis.deleteFilesFromServerWhenDestroy = false;\n\t},\n\n\tmethods: {\n\t\tgetId(): string\n\t\t{\n\t\t\treturn 'file';\n\t\t},\n\t\tgetPreparedData(data: Object): Object\n\t\t{\n\t\t\tconst { filledValues } = this;\n\n\t\t\tif (Type.isArray(filledValues?.fileTokens))\n\t\t\t{\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tdata.fileTokens = filledValues.fileTokens;\n\t\t\t}\n\n\t\t\treturn data;\n\t\t},\n\t\tgetExecutedData(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\tfileTokens: this.getFileTokenList(),\n\t\t\t};\n\t\t},\n\t\temitUpdateFilledValues(): void\n\t\t{\n\t\t\tlet { filledValues } = this;\n\t\t\tconst { fileTokens } = this;\n\n\t\t\tconst newFilledValues = {\n\t\t\t\tfileTokens,\n\t\t\t};\n\t\t\tfilledValues = { ...filledValues, ...newFilledValues };\n\t\t\tthis.$emit('updateFilledValues', this.getId(), filledValues);\n\t\t},\n\t\tonShowUploaderPopup(): void\n\t\t{\n\t\t\tthis.$refs.fileBody.querySelector('.ui-tile-uploader-drop-label').click();\n\t\t},\n\t\treset(): void\n\t\t{\n\t\t\tthis.deleteFilesFromServerWhenDestroy = true;\n\t\t},\n\t\tgetFileTokenList(): string[]\n\t\t{\n\t\t\tconst tokens = [];\n\n\t\t\tthis.$refs.uploader.uploader.getFiles().forEach((file) => {\n\t\t\t\tif (file.isComplete())\n\t\t\t\t{\n\t\t\t\t\ttokens.push(file.getServerFileId());\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn tokens;\n\t\t},\n\t},\n\n\tcomputed: {\n\t\tencodedTitle(): string\n\t\t{\n\t\t\treturn Text.encode(this.title);\n\t\t},\n\t\ticonStyles(): Object\n\t\t{\n\t\t\tif (!this.icon)\n\t\t\t{\n\t\t\t\treturn {};\n\t\t\t}\n\n\t\t\tconst path = `/bitrix/js/crm/activity/todo-editor-v2/images/${this.icon}`;\n\n\t\t\treturn {\n\t\t\t\tbackground: `url('${encodeURI(Text.encode(path))}') center center`,\n\t\t\t};\n\t\t},\n\t\tactionTitle(): string\n\t\t{\n\t\t\treturn this.hasFileTokens ? this.changeTitle : this.addTitle;\n\t\t},\n\t\tchangeTitle(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_LINK_BLOCK_CHANGE_ACTION');\n\t\t},\n\t\taddTitle(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_FILE_BLOCK_UPLOAD_ACTION');\n\t\t},\n\t\thasFileTokens(): boolean\n\t\t{\n\t\t\treturn Type.isArrayFilled(this.fileTokens);\n\t\t},\n\t\tuploaderOptions(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\tcontroller: 'crm.fileUploader.todoActivityUploaderController',\n\t\t\t\tcontrollerOptions: {\n\t\t\t\t\tentityId: this.settings.entityId,\n\t\t\t\t\tentityTypeId: this.settings.entityTypeId,\n\t\t\t\t\tactivityId: this.context.activityId,\n\t\t\t\t},\n\t\t\t\tfiles: this.fileTokens,\n\t\t\t\tevents: {\n\t\t\t\t\t/* 'File:onRemove': (event) => {\n\n\t\t\t\t\t},\n\t\t\t\t\tonUploadStart: (event) => {\n\n\t\t\t\t\t},\n\t\t\t\t\t'File:onComplete': (event) => {\n\n\t\t\t\t\t}, */\n\t\t\t\t\tonUploadComplete: () => {\n\t\t\t\t\t\tvoid this.$nextTick(() => {\n\t\t\t\t\t\t\tthis.fileTokens = this.getFileTokenList();\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tmultiple: true,\n\t\t\t\tautoUpload: true,\n\t\t\t\tmaxFileSize: MAX_UPLOAD_FILE_SIZE,\n\t\t\t};\n\t\t},\n\t\twidgetOptions(): Object\n\t\t{\n\t\t\treturn {};\n\t\t},\n\t},\n\n\tcreated()\n\t{\n\t\tthis.$watch(\n\t\t\t'fileTokens',\n\t\t\tthis.emitUpdateFilledValues,\n\t\t\t{\n\t\t\t\tdeep: true,\n\t\t\t},\n\t\t);\n\t},\n\n\tbeforeUnmount()\n\t{\n\t\tthis.$refs.uploader.adapter.setRemoveFilesFromServerWhenDestroy(this.deleteFilesFromServerWhenDestroy);\n\t},\n\n\ttemplate: `\n\t\t<div class=\"crm-activity__todo-editor-v2_block-header --file\">\n\t\t\t<span\n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-icon\"\n\t\t\t\t:style=\"iconStyles\"\n\t\t\t></span>\n\t\t\t<span>{{ encodedTitle }}</span>\n\t\t\t<span\n\t\t\t\t@click=\"onShowUploaderPopup\"\n\t\t\t\tref=\"file\"\n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-action\"\n\t\t\t>\n\t\t\t\t{{ actionTitle }}\n\t\t\t</span>\n\t\t\t<div\n\t\t\t\t@click=\"$emit('close', id)\"\n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-close\"\n\t\t\t></div>\n\t\t</div>\n\t\t<div ref=\"fileBody\" class=\"crm-activity__todo-editor-v2_block-body --file\">\n\t\t\t<TileWidgetComponent \n\t\t\t\tref=\"uploader\"\n\t\t\t\t:uploaderOptions=\"uploaderOptions\"\n\t\t\t\t:widgetOptions=\"widgetOptions\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { Tag, Text } from 'main.core';\nimport { Popup } from 'main.popup';\n\nexport class InputPopup\n{\n\t#popup: Popup = null;\n\t#bindElement: HTMLElement = null;\n\t#title: string = null;\n\t#placeholder: string = null;\n\t#buttonTitle: string = null;\n\t#input: HTMLInputElement = null;\n\t#onSubmit: Function = null;\n\n\tconstructor(params: Object)\n\t{\n\t\tthis.#bindElement = params.bindElement;\n\t\tthis.#title = params.title;\n\t\tthis.#placeholder = params.placeholder;\n\t\tthis.#buttonTitle = params.buttonTitle || 'OK';\n\t\tthis.#onSubmit = params.onSubmit;\n\n\t\tthis.onClickHandler = this.onClickHandler.bind(this);\n\t\tthis.onKeyUpHandler = this.onKeyUpHandler.bind(this);\n\t}\n\n\tshow(): void\n\t{\n\t\tthis.#getPopup().show();\n\n\t\tsetTimeout(() => {\n\t\t\tthis.#input.focus();\n\t\t});\n\t}\n\n\tdestroy(): void\n\t{\n\t\tif (this.#popup)\n\t\t{\n\t\t\tthis.#popup.destroy();\n\t\t}\n\t}\n\n\tsetValue(value: string): InputPopup\n\t{\n\t\tif (this.#input)\n\t\t{\n\t\t\tthis.#input.value = value;\n\t\t}\n\t}\n\n\t#getPopup(): Popup\n\t{\n\t\tif (!this.#popup)\n\t\t{\n\t\t\tthis.#popup = new Popup({\n\t\t\t\tid: `crm-todo-link-input-popup-${Text.getRandom()}`,\n\t\t\t\tbindElement: this.#bindElement,\n\t\t\t\tcontent: this.#getContent(),\n\t\t\t\tcloseByEsc: false,\n\t\t\t\tcloseIcon: false,\n\t\t\t\tdraggable: false,\n\t\t\t\twidth: 466,\n\t\t\t\tpadding: 0,\n\t\t\t});\n\t\t}\n\n\t\treturn this.#popup;\n\t}\n\n\t#getContent(): HTMLElement\n\t{\n\t\tthis.#input = Tag.render`\n\t\t\t<input \n\t\t\t\ttype=\"text\" \n\t\t\t\tplaceholder=\"${Text.encode(this.#placeholder)}\"\n\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\tonkeyup=\"${this.onKeyUpHandler}\"\n\t\t\t>\n\t\t`;\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-activity__todo-editor-v2_block-popup-wrapper --link\">\n\t\t\t\t<div class=\"crm-activity__todo-editor-v2_block-popup-title\">\n\t\t\t\t\t${Text.encode(this.#title)}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"crm-activity__todo-editor-v2_block-popup-content\">\n\t\t\t\t\t${this.#input}\n\t\t\t\t\t<button \n\t\t\t\t\t\tonclick=\"${this.onClickHandler}\" \n\t\t\t\t\t\tclass=\"ui-btn ui-btn-primary\"\n\t\t\t\t\t>\n\t\t\t\t\t\t${Text.encode(this.#buttonTitle)}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tonClickHandler(event): void\n\t{\n\t\tthis.#getPopup().close();\n\t\tthis.#onSubmit(this.#input.value);\n\t}\n\n\tonKeyUpHandler(event): void\n\t{\n\t\tif (event.keyCode === 13)\n\t\t{\n\t\t\tthis.onClickHandler();\n\t\t}\n\t}\n}\n","import { Dom, Text, Type } from 'main.core';\nimport { InputPopup } from './input-popup';\n\nexport const TodoEditorBlocksLink = {\n\tprops: {\n\t\tid: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\ticon: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsettings: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tfilledValues: {\n\t\t\ttype: Object,\n\t\t},\n\t\tcontext: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tisFocused: {\n\t\t\ttype: Boolean,\n\t\t},\n\t},\n\n\temits: [\n\t\t'close',\n\t\t'updateFilledValues',\n\t],\n\n\tdata(): Object\n\t{\n\t\tconst data = {\n\t\t\tlink: null,\n\t\t};\n\n\t\treturn this.getPreparedData(data);\n\t},\n\n\tmounted(): void\n\t{\n\t\tif (this.isFocused)\n\t\t{\n\t\t\tvoid this.$nextTick(this.onShowLinkPopup);\n\t\t}\n\t},\n\n\tbeforeUnmount(): void\n\t{\n\t\tthis.inputPopup?.destroy();\n\t},\n\n\tmethods: {\n\t\tgetId(): string\n\t\t{\n\t\t\treturn 'link';\n\t\t},\n\t\tgetPreparedData(data: Object): Object\n\t\t{\n\t\t\tconst { filledValues } = this;\n\n\t\t\tif (Type.isStringFilled(filledValues?.link))\n\t\t\t{\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tdata.link = filledValues.link;\n\t\t\t}\n\n\t\t\treturn data;\n\t\t},\n\t\tgetExecutedData(): Object\n\t\t{\n\t\t\tconst { link } = this;\n\n\t\t\treturn {\n\t\t\t\tlink,\n\t\t\t};\n\t\t},\n\t\temitUpdateFilledValues(): void\n\t\t{\n\t\t\tlet { filledValues } = this;\n\t\t\tconst { link } = this;\n\n\t\t\tconst newFilledValues = {\n\t\t\t\tlink,\n\t\t\t};\n\t\t\tfilledValues = { ...filledValues, ...newFilledValues };\n\t\t\tthis.$emit('updateFilledValues', this.getId(), filledValues);\n\t\t},\n\t\tonLinkClick(): void\n\t\t{\n\t\t\tconst a = document.createElement('a');\n\t\t\ta.href = this.link;\n\t\t\ta.target = '_blank';\n\t\t\tDom.append(a, document.body);\n\t\t\ta.click();\n\t\t\tDom.remove(a);\n\t\t},\n\t\tonShowLinkPopup(): void\n\t\t{\n\t\t\tif (Type.isNil(this.inputPopup))\n\t\t\t{\n\t\t\t\tthis.inputPopup = new InputPopup({\n\t\t\t\t\tbindElement: this.$refs.link,\n\t\t\t\t\ttitle: this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_LINK_BLOCK_POPUP_TITLE'),\n\t\t\t\t\tplaceholder: 'https://',\n\t\t\t\t\tonSubmit: (value: string) => {\n\t\t\t\t\t\tthis.setLink(value);\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.inputPopup.show();\n\t\t\tthis.inputPopup.setValue(this.link);\n\t\t},\n\t\tsetLink(value: string): void\n\t\t{\n\t\t\tthis.link = value;\n\t\t},\n\t},\n\n\tcomputed: {\n\t\tencodedTitle(): string\n\t\t{\n\t\t\treturn Text.encode(this.title);\n\t\t},\n\t\ticonStyles(): Object\n\t\t{\n\t\t\tif (!this.icon)\n\t\t\t{\n\t\t\t\treturn {};\n\t\t\t}\n\n\t\t\tconst path = `/bitrix/js/crm/activity/todo-editor-v2/images/${this.icon}`;\n\n\t\t\treturn {\n\t\t\t\tbackground: `url('${encodeURI(Text.encode(path))}') center center`,\n\t\t\t};\n\t\t},\n\t\tactionTitle(): string\n\t\t{\n\t\t\treturn this.hasLink ? this.changeTitle : this.addTitle;\n\t\t},\n\t\tchangeTitle(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_LINK_BLOCK_CHANGE_ACTION');\n\t\t},\n\t\taddTitle(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_LINK_BLOCK_ADD_ACTION');\n\t\t},\n\t\thasLink(): boolean\n\t\t{\n\t\t\treturn Type.isStringFilled(this.link);\n\t\t},\n\t},\n\n\tcreated()\n\t{\n\t\tthis.$watch(\n\t\t\t'link',\n\t\t\tthis.emitUpdateFilledValues,\n\t\t\t{\n\t\t\t\tdeep: true,\n\t\t\t},\n\t\t);\n\t},\n\n\ttemplate: `\n\t\t<div class=\"crm-activity__todo-editor-v2_block-header --link\">\n\t\t\t<span\n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-icon\"\n\t\t\t\t:style=\"iconStyles\"\n\t\t\t></span>\n\t\t\t<span>{{ encodedTitle }}</span>\n\t\t\t<span \n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-data\"\n\t\t\t\t@click=\"onLinkClick\"\n\t\t\t>\n\t\t\t\t{{ link }}\n\t\t\t</span>\n\t\t\t<span\n\t\t\t\t@click=\"onShowLinkPopup\"\n\t\t\t\tref=\"link\"\n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-action\"\n\t\t\t>\n\t\t\t\t{{ actionTitle }}\n\t\t\t</span>\n\t\t\t<div\n\t\t\t\t@click=\"$emit('close', id)\"\n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-header-close\"\n\t\t\t></div>\n\t\t</div>\n\t`,\n};\n","import {\n\tTodoEditorBlocksAddress,\n\tTodoEditorBlocksCalendar,\n\tTodoEditorBlocksClient,\n\tTodoEditorBlocksFile,\n\tTodoEditorBlocksLink,\n} from './block/index';\n\nexport default class BlockFactory\n{\n\tstatic getInstance(id: string)\n\t{\n\t\tif (id === TodoEditorBlocksCalendar.methods.getId())\n\t\t{\n\t\t\treturn TodoEditorBlocksCalendar;\n\t\t}\n\n\t\tif (id === TodoEditorBlocksClient.methods.getId())\n\t\t{\n\t\t\treturn TodoEditorBlocksClient;\n\t\t}\n\n\t\tif (id === TodoEditorBlocksLink.methods.getId())\n\t\t{\n\t\t\treturn TodoEditorBlocksLink;\n\t\t}\n\n\t\tif (id === TodoEditorBlocksFile.methods.getId())\n\t\t{\n\t\t\treturn TodoEditorBlocksFile;\n\t\t}\n\n\t\tif (id === TodoEditorBlocksAddress.methods.getId())\n\t\t{\n\t\t\treturn TodoEditorBlocksAddress;\n\t\t}\n\n\t\tthrow new Error(`Unknown block id: ${id}`);\n\t}\n}\n","import { ColorSelector, ColorSelectorEvents } from 'crm.field.color-selector';\nimport { EventEmitter } from 'main.core.events';\nimport { hint } from 'ui.vue3.directives.hint';\n\nconst DEFAULT_COLOR_ID = 'default';\n\nexport const TodoEditorColorSelector = {\n\tdirectives: { hint },\n\tprops: {\n\t\tvaluesList: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tselectedValueId: {\n\t\t\ttype: String,\n\t\t\tdefault: DEFAULT_COLOR_ID,\n\t\t},\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tcurrentValueId: this.selectedValueId || DEFAULT_COLOR_ID,\n\t\t};\n\t},\n\n\tmethods: {\n\t\tgetValue(): Array\n\t\t{\n\t\t\treturn this.currentValueId;\n\t\t},\n\t\tsetValue(value: ?string): void\n\t\t{\n\t\t\tif (value === null)\n\t\t\t{\n\t\t\t\tthis.resetToDefault();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.currentValueId = value;\n\t\t\tthis.itemSelector?.setValue(value);\n\t\t},\n\t\tonColorSelectorValueChange({ data }): void\n\t\t{\n\t\t\tthis.currentValueId = data.value;\n\t\t},\n\t\tresetToDefault(): void\n\t\t{\n\t\t\tthis.setValue(DEFAULT_COLOR_ID);\n\t\t\tthis.itemSelector?.setValue(DEFAULT_COLOR_ID);\n\t\t},\n\t},\n\n\tcomputed: {\n\t\thint(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\ttext: this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_COLOR_SELECTOR_HINT'),\n\t\t\t\tpopupOptions: {\n\t\t\t\t\tangle: {\n\t\t\t\t\t\toffset: 30,\n\t\t\t\t\t\tposition: 'top',\n\t\t\t\t\t},\n\t\t\t\t\toffsetTop: 2,\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t},\n\n\tmounted(): void\n\t{\n\t\tvoid this.$nextTick(() => {\n\t\t\tthis.itemSelector = new ColorSelector({\n\t\t\t\ttarget: this.$refs.itemSelectorRef,\n\t\t\t\tcolorList: this.valuesList,\n\t\t\t\tselectedColorId: this.currentValueId,\n\t\t\t});\n\n\t\t\tEventEmitter.subscribe(\n\t\t\t\tthis.itemSelector,\n\t\t\t\tColorSelectorEvents.EVENT_COLORSELECTOR_VALUE_CHANGE,\n\t\t\t\tthis.onColorSelectorValueChange,\n\t\t\t);\n\t\t});\n\t},\n\n\ttemplate: `\n\t\t<div class=\"crm-activity__todo-editor-v2_color-selector\">\n\t\t\t<div ref=\"itemSelectorRef\" v-hint=\"hint\"></div>\n\t\t</div>\n\t`,\n};\n","import { CompactIcons, ItemSelector } from 'crm.field.item-selector';\nimport { hint } from 'ui.vue3.directives.hint';\n\nexport const TodoEditorPingSelector = {\n\tdirectives: { hint },\n\tprops: {\n\t\tvaluesList: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t\tdefault: [],\n\t\t},\n\t\tselectedValues: {\n\t\t\ttype: Array,\n\t\t\tdefault: [],\n\t\t},\n\t},\n\n\tcomputed: {\n\t\thint(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\ttext: this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_PING_SELECTOR_HINT'),\n\t\t\t\tpopupOptions: {\n\t\t\t\t\tangle: {\n\t\t\t\t\t\toffset: 34,\n\t\t\t\t\t\tposition: 'top',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t},\n\n\tmethods: {\n\t\tgetValue(): Array\n\t\t{\n\t\t\tif (this.itemSelector)\n\t\t\t{\n\t\t\t\treturn this.itemSelector.getValue();\n\t\t\t}\n\n\t\t\treturn [];\n\t\t},\n\n\t\tsetValue(values: Array): void\n\t\t{\n\t\t\tif (this.itemSelector)\n\t\t\t{\n\t\t\t\tthis.itemSelector.setValue(values);\n\t\t\t}\n\t\t},\n\t},\n\n\tmounted(): void\n\t{\n\t\tthis.itemSelector = new ItemSelector({\n\t\t\ttarget: this.$refs.container,\n\t\t\tvaluesList: this.valuesList,\n\t\t\tselectedValues: this.selectedValues,\n\t\t\tcompactMode: true,\n\t\t\ticon: CompactIcons.BELL,\n\t\t});\n\t},\n\n\ttemplate: '<div style=\"width: 100%;\"><div ref=\"container\" v-hint=\"hint\"></div></div>',\n};\n","import { Text } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport { Dialog } from 'ui.entity-selector';\nimport { hint } from 'ui.vue3.directives.hint';\nimport { Events } from './todo-editor';\n\nexport const TodoEditorResponsibleUserSelector = {\n\tdirectives: { hint },\n\tprops: {\n\t\tuserId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t\tdefault: 0,\n\t\t},\n\t\tuserName: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t\tdefault: '',\n\t\t},\n\t\timageUrl: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tuserAvatarUrl: this.imageUrl,\n\t\t};\n\t},\n\n\tcomputed: {\n\t\tuserIconClassName(): Array\n\t\t{\n\t\t\treturn [\n\t\t\t\t'ui-icon',\n\t\t\t\t'ui-icon-common-user',\n\t\t\t\t'crm-timeline__user-icon',\n\t\t\t];\n\t\t},\n\n\t\tuserIconStyles(): Object\n\t\t{\n\t\t\tif (!this.userAvatarUrl)\n\t\t\t{\n\t\t\t\treturn {};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tbackgroundImage: `url('${encodeURI(Text.encode(this.userAvatarUrl))}')`,\n\t\t\t\tbackgroundSize: '21px',\n\t\t\t};\n\t\t},\n\n\t\thint(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\ttext: this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_CHANGE_RESPONSIBLE'),\n\t\t\t\tpopupOptions: {\n\t\t\t\t\tangle: {\n\t\t\t\t\t\toffset: 35,\n\t\t\t\t\t\tposition: 'top',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t},\n\n\tmethods: {\n\t\tonSelectUser(event: BaseEvent): void\n\t\t{\n\t\t\tconst selectedItem = event.getData().item.getDialog().getSelectedItems()[0];\n\t\t\tif (selectedItem)\n\t\t\t{\n\t\t\t\tthis.userAvatarUrl = selectedItem.getAvatar();\n\t\t\t\tthis.$Bitrix.eventEmitter.emit(\n\t\t\t\t\tEvents.EVENT_RESPONSIBLE_USER_CHANGE,\n\t\t\t\t\t{\n\t\t\t\t\t\tresponsibleUserId: selectedItem.getId(),\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\n\t\tonDeselectUser(): void\n\t\t{\n\t\t\tsetTimeout(() => {\n\t\t\t\tconst selectedItems = this.userSelectorDialog.getSelectedItems();\n\t\t\t\tif (selectedItems.length === 0)\n\t\t\t\t{\n\t\t\t\t\tthis.userAvatarUrl = this.imageUrl;\n\t\t\t\t\tthis.userSelectorDialog.hide();\n\t\t\t\t\tthis.$Bitrix.eventEmitter.emit(\n\t\t\t\t\t\tEvents.EVENT_RESPONSIBLE_USER_CHANGE,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tresponsibleUserId: this.userId,\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}, 100);\n\t\t},\n\n\t\tshowUserDialog(): void\n\t\t{\n\t\t\tif (this.userSelectorDialog)\n\t\t\t{\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.userSelectorDialog.show();\n\t\t\t\t}, 5);\n\t\t\t}\n\t\t},\n\n\t\tresetToDefault(): void\n\t\t{\n\t\t\tthis.userAvatarUrl = this.imageUrl;\n\t\t\tif (this.userSelectorDialog)\n\t\t\t{\n\t\t\t\tconst defaultUserItem = this.userSelectorDialog.getItem({\n\t\t\t\t\tid: this.userId,\n\t\t\t\t\tentityId: 'user',\n\t\t\t\t});\n\t\t\t\tif (defaultUserItem)\n\t\t\t\t{\n\t\t\t\t\tdefaultUserItem.select(true);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t},\n\n\tmounted(): void\n\t{\n\t\tthis.userSelectorDialog = new Dialog({\n\t\t\tid: 'responsible-user-selector-dialog',\n\t\t\ttargetNode: this.$refs.userSelector,\n\t\t\tcontext: 'CRM_ACTIVITY_TODO_RESPONSIBLE_USER',\n\t\t\tmultiple: false,\n\t\t\tdropdownMode: true,\n\t\t\tshowAvatars: true,\n\t\t\tenableSearch: true,\n\t\t\twidth: 450,\n\t\t\tzIndex: 2500,\n\t\t\tentities: [{\n\t\t\t\tid: 'user',\n\t\t\t}],\n\t\t\tpreselectedItems: [\n\t\t\t\t['user', this.userId],\n\t\t\t],\n\t\t\tundeselectedItems: [\n\t\t\t\t['user', this.userId],\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\t'Item:onSelect': this.onSelectUser,\n\t\t\t\t'Item:onDeselect': this.onDeselectUser,\n\t\t\t},\n\t\t});\n\t},\n\n\ttemplate: `\n\t\t<div \n\t\t\tclass=\"crm-activity__todo-editor-v2_responsible-user-selector\"\n\t\t\tref=\"userSelector\"\n\t\t\t@click=\"showUserDialog\"\n\t\t\tv-hint=\"hint\"\n\t\t>\n\t\t\t<span :class=\"userIconClassName\">\n\t\t\t\t<i :style=\"userIconStyles\"></i>\n\t\t\t</span>\n\t\t</div>\n\t`,\n};\n","import { CopilotTextarea, Events as CopilotTextareaEvents } from 'crm.ai.copilot-textarea';\nimport { DatetimeConverter } from 'crm.timeline.tools';\nimport { Browser, Dom, Runtime, Text, Type } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { DateTimeFormat } from 'main.date';\nimport type { BlockSettings } from '../todo-editor';\nimport BlockFactory from './block-factory';\nimport {\n\tTodoEditorBlocksAddress,\n\tTodoEditorBlocksCalendar,\n\tTodoEditorBlocksClient,\n\tTodoEditorBlocksFile,\n\tTodoEditorBlocksLink,\n} from './block/index';\nimport { TodoEditorColorSelector } from './color-selector/todo-editor-color-selector';\nimport { TodoEditorPingSelector } from './todo-editor-ping-selector';\nimport { TodoEditorResponsibleUserSelector } from './todo-editor-responsible-user-selector';\n\nconst TEXTAREA_MAX_HEIGHT = 126;\nconst ADD_MODE = 'add';\n\nexport const Events = {\n\tEVENT_RESPONSIBLE_USER_CHANGE: 'crm:timeline:todo:responsible-user-changed',\n\tEVENT_DEADLINE_CHANGE: 'crm:timeline:todo:deadline-changed',\n\tEVENT_CALENDAR_CHANGE: 'crm:timeline:todo:calendar-changed',\n\tEVENT_ACTIONS_POPUP_ITEM_CLICK: 'crm:timeline:todo:actions-popup-item-click',\n\tEVENT_UPDATE_CLICK: 'crm:timeline:todo:update',\n\tEVENT_REPEAT_CLICK: 'crm:timeline:todo:repeat',\n};\n\nconst CALENDAR_BLOCK_ID = TodoEditorBlocksCalendar.methods.getId();\n\nexport const TodoEditor = {\n\tcomponents: {\n\t\tTodoEditorResponsibleUserSelector,\n\t\tTodoEditorPingSelector,\n\t\tTodoEditorBlocksCalendar,\n\t\tTodoEditorBlocksClient,\n\t\tTodoEditorBlocksLink,\n\t\tTodoEditorBlocksFile,\n\t\tTodoEditorBlocksAddress,\n\t\tTodoEditorColorSelector,\n\t},\n\n\tprops: {\n\t\tonFocus: Function,\n\t\tonSaveHotkeyPressed: Function,\n\t\tdeadline: Date,\n\t\tdefaultTitle: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: '',\n\t\t},\n\t\tdefaultDescription: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: '',\n\t\t},\n\t\tpopupMode: Boolean,\n\t\tcurrentUser: Object,\n\t\tpingSettings: Object,\n\t\tcopilotSettings: Object,\n\t\tcolorSettings: Object,\n\t\tmode: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: ADD_MODE,\n\t\t},\n\t\tactionsPopup: Object,\n\t\tblocks: {\n\t\t\ttype: Array,\n\t\t\tdefault: [],\n\t\t},\n\t\tactivityId: {\n\t\t\ttype: Number,\n\t\t\tdefault: null,\n\t\t\trequired: false,\n\t\t},\n\t},\n\n\tdata(): Object\n\t{\n\t\tconst isCopilotEnabled = Type.isPlainObject(this.copilotSettings);\n\n\t\tconst currentDeadline = this.deadline ?? new Date();\n\t\tconst calendarDateTo = Runtime.clone(currentDeadline);\n\t\tcalendarDateTo.setHours(currentDeadline.getHours() + 1);\n\n\t\tconst blocksData = Runtime.clone(this.blocks);\n\n\t\tObject.keys(blocksData).forEach((blockId: string) => {\n\t\t\tthis.prepareBlockDataWithEditorParams(blocksData[blockId], { currentDeadline });\n\t\t});\n\n\t\treturn {\n\t\t\tcurrentActivityId: this.activityId,\n\t\t\ttitle: this.defaultTitle,\n\t\t\tdescription: this.defaultDescription,\n\t\t\tcurrentDeadline,\n\t\t\tcalendarDateTo,\n\t\t\tpingOffsets: this.pingSettings.selectedValues,\n\t\t\tcolorId: this.colorSettings.selectedValueId,\n\t\t\tresponsibleUserId: this.currentUser.userId,\n\t\t\tisTextareaToLong: false,\n\t\t\twasUsed: false,\n\t\t\tisCopilotEnabled,\n\t\t\tblocksData,\n\t\t\tmodeData: this.mode,\n\t\t\tcurrentUserData: this.currentUser,\n\t\t};\n\t},\n\n\tcomputed: {\n\t\tdeadlineFormatted(): string\n\t\t{\n\t\t\tlet converter = new DatetimeConverter(this.currentDeadline);\n\n\t\t\tlet deadlineFormatted = converter.toDatetimeString({\n\t\t\t\twithDayOfWeek: true,\n\t\t\t\tdelimiter: ', ',\n\t\t\t});\n\n\t\t\t// @todo use event here\n\t\t\tconst calendarBlock = this.getBlockDataById(CALENDAR_BLOCK_ID);\n\t\t\tif (calendarBlock?.active)\n\t\t\t{\n\t\t\t\tconverter = new DatetimeConverter(this.calendarDateTo);\n\t\t\t\tconst calendarDateTo = converter.toTimeString();\n\t\t\t\tdeadlineFormatted = `${deadlineFormatted}-${calendarDateTo}`;\n\t\t\t}\n\n\t\t\treturn deadlineFormatted;\n\t\t},\n\t\tcontext(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\tuserId: this.responsibleUserId,\n\t\t\t\tactivityId: this.currentActivityId,\n\t\t\t};\n\t\t},\n\t\tplaceholderDescription(): string\n\t\t{\n\t\t\tlet code = '';\n\n\t\t\tif (this.wasUsed)\n\t\t\t{\n\t\t\t\tcode = (\n\t\t\t\t\tthis.isCopilotEnabled\n\t\t\t\t\t\t? 'CRM_ACTIVITY_TODO_ADD_PLACEHOLDER_WITH_COPILOT_MSGVER_1'\n\t\t\t\t\t\t: 'CRM_ACTIVITY_TODO_ADD_PLACEHOLDER_MSGVER_1'\n\t\t\t\t);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcode = 'CRM_ACTIVITY_TODO_ADD_PLACEHOLDER_ROLLED';\n\t\t\t}\n\n\t\t\treturn this.$Bitrix.Loc.getMessage(code);\n\t\t},\n\t\tplaceholderTitle(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_ADD_TITLE_PLACEHOLDER');\n\t\t},\n\t\tpopupMenuButtonTitle(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('CRM_ACTIVITY_TODO_SHOW_ACTIONS_POPUP');\n\t\t},\n\t\torderedBlocksData(): BlockSettings[]\n\t\t{\n\t\t\treturn this.blocksData.sort((a, b) => b.sort - a.sort);\n\t\t},\n\t},\n\n\twatch: {\n\t\tdescription(): void\n\t\t{\n\t\t\tDom.style(this.$refs.textarea, 'height', 'auto');\n\t\t\tvoid this.$nextTick(() => {\n\t\t\t\tconst currentTextareaHeight = this.$refs.textarea.scrollHeight;\n\t\t\t\tDom.style(this.$refs.textarea, 'height', `${currentTextareaHeight}px`);\n\t\t\t\tif (this.popupMode === true)\n\t\t\t\t{\n\t\t\t\t\tthis.isTextareaToLong = currentTextareaHeight > TEXTAREA_MAX_HEIGHT;\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t},\n\n\tmethods: {\n\t\t/* @internal */\n\t\tprepareBlockDataWithEditorParams(blocksData: BlockSettings, { currentDeadline }): void\n\t\t{\n\t\t\tthis.prepareBlockData(blocksData, {\n\t\t\t\tcurrentDeadline,\n\t\t\t\tresponsibleUserId: this.responsibleUserId || this.currentUser.userId,\n\t\t\t});\n\t\t},\n\n\t\tprepareBlockData(blockData: BlockSettings, params: Object): void\n\t\t{\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\tblockData.active = Type.isBoolean(blockData.active) ? blockData.active : false;\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\tblockData.sort = Type.isNil(blockData.sort) ? 0 : blockData.sort;\n\n\t\t\tconst blockInstance = BlockFactory.getInstance(blockData.id);\n\t\t\tif (Type.isFunction(blockInstance.methods.prepareDataOnBlockConstruct))\n\t\t\t{\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tblockData = {\n\t\t\t\t\t...blockData,\n\t\t\t\t\t...blockInstance.methods.prepareDataOnBlockConstruct(blockData, params),\n\t\t\t\t};\n\t\t\t}\n\t\t},\n\n\t\tsetData({ title, description, deadline, id, colorId, currentUser, pingOffsets }): void\n\t\t{\n\t\t\tthis.title = title;\n\t\t\tthis.description = description;\n\t\t\tthis.currentDeadline = new Date(deadline);\n\t\t\tthis.currentActivityId = id;\n\n\t\t\tthis.currentUserData = currentUser;\n\t\t\tthis.responsibleUserId = currentUser.userId;\n\n\t\t\tvoid this.$nextTick(() => {\n\t\t\t\tthis.$refs.userSelector?.resetToDefault();\n\t\t\t});\n\n\t\t\tthis.setPingOffsets(pingOffsets);\n\t\t\tthis.$refs.pingSelector?.setValue(pingOffsets);\n\n\t\t\tthis.$refs.colorSelector.setValue(colorId);\n\t\t},\n\n\t\tsetMode(mode: string): void\n\t\t{\n\t\t\tthis.modeData = mode;\n\t\t},\n\n\t\tresetCurrentActivityId(): void\n\t\t{\n\t\t\tthis.currentActivityId = null;\n\t\t},\n\n\t\tsetBlockFilledValues(id: string, filledValues: Object): void\n\t\t{\n\t\t\tconst blockData = this.getBlockDataById(id);\n\n\t\t\tif (blockData)\n\t\t\t{\n\t\t\t\tblockData.filledValues = filledValues;\n\t\t\t}\n\t\t},\n\n\t\tsetBlockActive(id: string, value: boolean = true): void\n\t\t{\n\t\t\tconst blockData = this.getBlockDataById(id);\n\n\t\t\tif (blockData)\n\t\t\t{\n\t\t\t\tblockData.active = value;\n\t\t\t}\n\t\t},\n\n\t\tresetTitleAndDescription(): void\n\t\t{\n\t\t\tthis.setTitle(this.defaultTitle);\n\t\t\tthis.setDescription(this.defaultDescription);\n\n\t\t\tDom.style(this.$refs.textarea, 'height', 'auto');\n\t\t},\n\n\t\tsetTitle(title: string): void\n\t\t{\n\t\t\tthis.title = title;\n\t\t},\n\n\t\tsetDescription(description: string): void\n\t\t{\n\t\t\tthis.description = description;\n\t\t},\n\n\t\tonTextareaFocus(): void\n\t\t{\n\t\t\tthis.setWasUsed(true);\n\t\t\tthis.onFocus();\n\t\t},\n\n\t\tonTextareaKeydown(event): void\n\t\t{\n\t\t\tif (event.keyCode !== 13)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst isMacCtrlKeydown = Browser.isMac() && (event.metaKey === true || event.altKey === true);\n\n\t\t\tif (event.ctrlKey === true || isMacCtrlKeydown)\n\t\t\t{\n\t\t\t\tthis.onSaveHotkeyPressed();\n\t\t\t}\n\t\t},\n\n\t\tsetTextareaFocused(): void\n\t\t{\n\t\t\tthis.setWasUsed(true);\n\t\t\tthis.$refs.textarea.focus();\n\t\t},\n\n\t\tsetWasUsed(value: boolean): void\n\t\t{\n\t\t\tthis.wasUsed = value;\n\t\t},\n\n\t\tonDeadlineClick(): void\n\t\t{\n\t\t\t// eslint-disable-next-line @bitrix24/bitrix24-rules/no-bx\n\t\t\tBX.calendar({\n\t\t\t\tnode: this.$refs.deadline,\n\t\t\t\tbTime: true,\n\t\t\t\tbHideTime: false,\n\t\t\t\tbSetFocus: false,\n\t\t\t\tvalue: DateTimeFormat.format(DatetimeConverter.getSiteDateTimeFormat(), this.currentDeadline),\n\t\t\t\tcallback: this.setDeadline.bind(this),\n\t\t\t});\n\t\t},\n\n\t\tsetDeadline(deadline: Date): void\n\t\t{\n\t\t\tthis.currentDeadline = deadline;\n\n\t\t\tthis.$Bitrix.eventEmitter.emit(Events.EVENT_DEADLINE_CHANGE, { deadline });\n\t\t},\n\n\t\tonResponsibleUserChange(event: BaseEvent): void\n\t\t{\n\t\t\tconst data = event.getData();\n\t\t\tif (data)\n\t\t\t{\n\t\t\t\tthis.setResponsibleUserId(data.responsibleUserId);\n\t\t\t}\n\t\t},\n\n\t\tonCalendarChange(event: BaseEvent): void\n\t\t{\n\t\t\tconst data = event.getData();\n\t\t\tif (data)\n\t\t\t{\n\t\t\t\tthis.currentDeadline = new Date(data.from);\n\t\t\t\tthis.calendarDateTo = new Date(data.to);\n\t\t\t}\n\t\t},\n\n\t\tsetPingOffsets(offsets: number[]): void\n\t\t{\n\t\t\tthis.pingOffsets = offsets;\n\t\t},\n\n\t\tsetResponsibleUserId(userId: number): void\n\t\t{\n\t\t\tthis.responsibleUserId = userId;\n\t\t},\n\n\t\tresetPingOffsetsToDefault(): void\n\t\t{\n\t\t\tthis.setPingOffsets(this.pingSettings.selectedValues);\n\t\t\tthis.$refs.pingSelector?.setValue(this.pingSettings.selectedValues);\n\t\t},\n\n\t\tresetResponsibleUserToDefault(): void\n\t\t{\n\t\t\tthis.setResponsibleUserId(this.currentUser.userId);\n\n\t\t\tconst userSelector = this.$refs.userSelector;\n\t\t\tif (userSelector)\n\t\t\t{\n\t\t\t\tuserSelector.resetToDefault();\n\t\t\t}\n\t\t},\n\n\t\tresetColorSelectorToDefault(): void\n\t\t{\n\t\t\tconst colorSelector = this.$refs.colorSelector;\n\t\t\tif (colorSelector)\n\t\t\t{\n\t\t\t\tcolorSelector.resetToDefault();\n\t\t\t}\n\t\t},\n\n\t\tgetData(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\ttitle: (\n\t\t\t\t\t(Type.isString(this.title) && Type.isStringFilled(this.title.trim()))\n\t\t\t\t\t\t? this.title.trim()\n\t\t\t\t\t\t: null\n\t\t\t\t),\n\t\t\t\tdescription: this.description,\n\t\t\t\tdeadline: this.currentDeadline,\n\t\t\t\tresponsibleUserId: this.responsibleUserId,\n\t\t\t\tpingOffsets: this.$refs.pingSelector?.getValue(),\n\t\t\t\tcolorId: this.$refs.colorSelector?.getValue(),\n\t\t\t};\n\t\t},\n\n\t\tonTitleInput(event: InputEvent): void\n\t\t{\n\t\t\tconst { value } = event.target;\n\n\t\t\tthis.setTitle(value);\n\t\t},\n\n\t\tonTextareaInput(event: InputEvent): void\n\t\t{\n\t\t\tconst { value } = event.target;\n\n\t\t\tthis.setDescription(value);\n\t\t},\n\n\t\tonActionsPopupItemClick({ data: { id, componentId, componentParams } }): void\n\t\t{\n\t\t\tconst actionId = Type.isNil(componentId) ? id : componentId;\n\n\t\t\tif (!Type.isStringFilled(actionId))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.blocksData.forEach((block: BlockSettings) => {\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tblock.focused = false;\n\t\t\t});\n\n\t\t\tconst block = this.getBlockDataById(actionId);\n\n\t\t\tif (Type.isPlainObject(componentParams))\n\t\t\t{\n\t\t\t\tblock.settings = {\n\t\t\t\t\t...componentParams,\n\t\t\t\t\t...this.getBlockDataFromPropsById(actionId).settings,\n\t\t\t\t};\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tblock.settings = Runtime.clone(this.getBlockDataFromPropsById(actionId).settings);\n\t\t\t}\n\n\t\t\tthis.prepareBlockDataWithEditorParams(\n\t\t\t\tblock,\n\t\t\t\t{\n\t\t\t\t\tcurrentDeadline: this.currentDeadline,\n\t\t\t\t},\n\t\t\t);\n\n\t\t\tblock.active = true;\n\t\t\tblock.focused = true;\n\t\t\tblock.sort = this.getNextBlockSortValue();\n\n\t\t\tthis.setTextareaFocused();\n\t\t},\n\n\t\tgetNextBlockSortValue(): number\n\t\t{\n\t\t\tlet maxSortValue = 0;\n\n\t\t\tthis.blocksData.forEach((data) => {\n\t\t\t\tif (maxSortValue < data.sort)\n\t\t\t\t{\n\t\t\t\t\tmaxSortValue = data.sort;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn ++maxSortValue;\n\t\t},\n\n\t\tonCopilotTextareaValueChange(event: BaseEvent): void\n\t\t{\n\t\t\tconst copilotId = this.isCopilotEnabled ? this.copilotTextarea.getId() : '';\n\t\t\tconst id = event.getData().id;\n\n\t\t\tif (this.wasUsed && copilotId === id)\n\t\t\t{\n\t\t\t\tconst value = event.getData().value;\n\n\t\t\t\tthis.setDescription(value);\n\t\t\t}\n\t\t},\n\n\t\tshowActionsPopup(event: BaseEvent): void\n\t\t{\n\t\t\tthis.actionsPopup.bindElement(event.target).show();\n\t\t},\n\n\t\tonBlockCloseClick(id: string): void\n\t\t{\n\t\t\tconst block = this.getBlockDataById(id);\n\n\t\t\tthis.resetBlock(block);\n\t\t},\n\n\t\tcloseBlocks(): void\n\t\t{\n\t\t\tthis.blocksData.forEach((block: BlockSettings) => {\n\t\t\t\tthis.resetBlock(block);\n\t\t\t});\n\t\t},\n\n\t\tresetBlock(block: BlockSettings): void\n\t\t{\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\tblock.active = false;\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\tblock.focused = false;\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\tblock.sort = 0;\n\n\t\t\tif (Type.isFunction(this.$refs[block.id]?.reset))\n\t\t\t{\n\t\t\t\tthis.$refs[block.id].reset();\n\t\t\t}\n\n\t\t\tconst blockData = this.getBlockDataById(block.id);\n\t\t\tif (Type.isObject(blockData))\n\t\t\t{\n\t\t\t\tdelete blockData.filledValues;\n\t\t\t}\n\t\t},\n\n\t\tgetExecutedBlocksData(): Object[]\n\t\t{\n\t\t\tconst data = [];\n\t\t\tthis.blocksData.filter((block) => block.active).forEach((block: BlockSettings) => {\n\t\t\t\tdata.push({\n\t\t\t\t\t...this.$refs[block.id][0].getExecutedData(),\n\t\t\t\t\tid: block.id,\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn data;\n\t\t},\n\n\t\tgetBlockComponentName(blockId: string): string\n\t\t{\n\t\t\treturn `TodoEditorBlocks${blockId.charAt(0).toUpperCase()}${blockId.slice(1)}`;\n\t\t},\n\n\t\tgetBlockDataById(blockId: string): BlockSettings\n\t\t{\n\t\t\treturn this.blocksData.find((block) => block.id === blockId);\n\t\t},\n\n\t\tgetBlockDataFromPropsById(blockId: string): BlockSettings\n\t\t{\n\t\t\treturn this.blocks.find((block) => block.id === blockId);\n\t\t},\n\n\t\tupdateFilledValues(blockId: string, data: Object): void\n\t\t{\n\t\t\tconst blockData = this.getBlockDataById(blockId);\n\n\t\t\tif (blockData)\n\t\t\t{\n\t\t\t\tblockData.filledValues = { ...blockData.filledValues, ...data };\n\t\t\t}\n\t\t},\n\t},\n\n\tmounted()\n\t{\n\t\tthis.$Bitrix.eventEmitter.subscribe(Events.EVENT_RESPONSIBLE_USER_CHANGE, this.onResponsibleUserChange);\n\t\tthis.$Bitrix.eventEmitter.subscribe(Events.EVENT_CALENDAR_CHANGE, this.onCalendarChange);\n\n\t\tEventEmitter.subscribe(this.actionsPopup, Events.EVENT_ACTIONS_POPUP_ITEM_CLICK, this.onActionsPopupItemClick);\n\n\t\tif (this.isCopilotEnabled)\n\t\t{\n\t\t\tthis.copilotTextarea = new CopilotTextarea({\n\t\t\t\tid: Text.getRandom(),\n\t\t\t\ttarget: this.$refs.textarea,\n\t\t\t\tcopilotParams: this.copilotSettings,\n\t\t\t});\n\n\t\t\tEventEmitter.subscribe(CopilotTextareaEvents.EVENT_VALUE_CHANGE, this.onCopilotTextareaValueChange);\n\t\t}\n\t},\n\n\tbeforeUnmount()\n\t{\n\t\tthis.$Bitrix.eventEmitter.unsubscribe(Events.EVENT_RESPONSIBLE_USER_CHANGE, this.onResponsibleUserChange);\n\t\tthis.$Bitrix.eventEmitter.unsubscribe(Events.EVENT_CALENDAR_CHANGE, this.onCalendarChange);\n\n\t\tEventEmitter.unsubscribe(this.actionsPopup, Events.EVENT_ACTIONS_POPUP_ITEM_CLICK, this.onActionsPopupItemClick);\n\n\t\tif (this.isCopilotEnabled)\n\t\t{\n\t\t\tEventEmitter.unsubscribe(CopilotTextareaEvents.EVENT_VALUE_CHANGE, this.onCopilotTextareaValueChange);\n\t\t}\n\t},\n\n\ttemplate: `\n\t\t<label>\n\t\t\t<div class=\"crm-activity__todo-editor-v2_container\">\n\t\t\t\t<div class=\"crm-activity__todo-editor-v2_header\">\n\t\t\t\t\t<input\n\t\t\t\t\t\tv-if=\"wasUsed\"\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\tref=\"title\"\n\t\t\t\t\t\tclass=\"crm-activity__todo-editor-v2_input_control --title\"\n\t\t\t\t\t\t:value=\"title\"\n\t\t\t\t\t\t:placeholder=\"placeholderTitle\"\n\t\t\t\t\t\tmaxlength=\"40\"\n\t\t\t\t\t\t@input=\"onTitleInput\"\n\t\t\t\t\t>\n\t\t\t\t\t<TodoEditorColorSelector\n\t\t\t\t\t\tref=\"colorSelector\"\n\t\t\t\t\t\t:valuesList=\"colorSettings.valuesList\"\n\t\t\t\t\t\t:selectedValueId=\"colorSettings.selectedValueId\"\n\t\t\t\t\t/>\n\t\t\t\t\t<TodoEditorResponsibleUserSelector\n\t\t\t\t\t\t:userId=\"currentUserData.userId\"\n\t\t\t\t\t\t:userName=\"currentUserData.title\"\n\t\t\t\t\t\t:imageUrl=\"currentUserData.imageUrl\"\n\t\t\t\t\t\tref=\"userSelector\"\n\t\t\t\t\t\tclass=\"crm-activity__todo-editor-v2_action-btn\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"crm-activity__todo-editor-v2_body\">\n\t\t\t\t\t<textarea\n\t\t\t\t\t\trows=\"2\"\n\t\t\t\t\t\tref=\"textarea\"\n\t\t\t\t\t\t@focus=\"onTextareaFocus\"\n\t\t\t\t\t\t@keydown=\"onTextareaKeydown\"\n\t\t\t\t\t\tclass=\"crm-activity__todo-editor-v2_input_control\"\n\t\t\t\t\t\t:placeholder=\"placeholderDescription\"\n\t\t\t\t\t\t@input=\"onTextareaInput\"\n\t\t\t\t\t\t:value=\"description\"\n\t\t\t\t\t\t:class=\"{ '--has-scroll': isTextareaToLong }\"\n\t\t\t\t\t></textarea>\n\t\t\t\t\t<button \n\t\t\t\t\t\tclass=\"crm-activity__todo-show-actions-popup-button ui-btn ui-btn-sm ui-btn-base-light\"\n\t\t\t\t\t\t@click=\"showActionsPopup\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ popupMenuButtonTitle }}\n\t\t\t\t\t\t<span class=\"crm-activity__todo-show-actions-popup-button-arrow\"></span>\n\t\t\t\t\t</button>\n\t\t\t\t\t<div class=\"crm-activity__todo-editor-v2_tools\" v-if=\"wasUsed\">\n\t\t\t\t\t\t<div class=\"crm-activity__todo-editor-v2_left_tools\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tref=\"deadline\"\n\t\t\t\t\t\t\t\t@click=\"onDeadlineClick\"\n\t\t\t\t\t\t\t\tclass=\"crm-activity__todo-editor-v2_deadline\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span class=\"crm-activity__todo-editor-v2_deadline-pill\">\n\t\t\t\t\t\t\t\t\t<span class=\"crm-activity__todo-editor-v2_deadline-icon\"></span>\n\t\t\t\t\t\t\t\t\t<span class=\"crm-activity__todo-editor-v2_deadline-text\">{{ deadlineFormatted }}</span>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<TodoEditorPingSelector\n\t\t\t\t\t\t\t\tref=\"pingSelector\"\n\t\t\t\t\t\t\t\t:valuesList=\"pingSettings.valuesList\"\n\t\t\t\t\t\t\t\t:selectedValues=\"pingOffsets\"\n\t\t\t\t\t\t\t\tclass=\"crm-activity__todo-editor-v2_ping_selector\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div\n\t\t\t\tclass=\"crm-activity__todo-editor-v2_block-wrapper\"\n\t\t\t\tv-for=\"block in orderedBlocksData\"\n\t\t\t\tkey=\"block.id\"\n\t\t\t\tv-show=\"block?.active\"\n\t\t\t>\n\t\t\t\t<component\n\t\t\t\t\tv-if=\"block?.active\"\n\t\t\t\t\tv-bind:is=\"getBlockComponentName(block.id)\"\n\t\t\t\t\t:ref=\"block.id\"\n\t\t\t\t\t@close=\"onBlockCloseClick\"\n\t\t\t\t\t:id=\"getBlockDataById(block.id).id\"\n\t\t\t\t\t:title=\"getBlockDataById(block.id).title\"\n\t\t\t\t\t:icon=\"getBlockDataById(block.id).icon\"\n\t\t\t\t\t:settings=\"getBlockDataById(block.id).settings ?? {}\"\n\t\t\t\t\t:filledValues=\"getBlockDataById(block.id).filledValues\"\n\t\t\t\t\t:isFocused=\"getBlockDataById(block.id).focused\"\n\t\t\t\t\t:context=\"context\"\n\t\t\t\t\t@updateFilledValues=\"updateFilledValues\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</label>\n\t`,\n};\n","import { Loc, Text, Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Menu, MenuManager } from 'main.popup';\nimport { Events } from './components/todo-editor';\nimport type { ActionMenuItem } from './todo-editor';\n\nconst DELIMITER_TYPE = 'delimiter';\n\nexport default class ActionsPopup\n{\n\t#menu: Menu = null;\n\t#items: ActionMenuItem[] = [];\n\t#bindElement: HTMLElement = null;\n\n\tconstructor(items: Object[])\n\t{\n\t\tthis.#items = items;\n\t}\n\n\tbindElement(bindElement: HTMLElement): ActionsPopup\n\t{\n\t\tthis.#bindElement = bindElement;\n\n\t\treturn this;\n\t}\n\n\tshow(): void\n\t{\n\t\tthis.#getMenuPopup().show();\n\t}\n\n\t#getMenuPopup(): Menu\n\t{\n\t\tif (Type.isNil(this.#menu))\n\t\t{\n\t\t\tthis.#menu = MenuManager.create({\n\t\t\t\tid: `crm-activity__todo-editor-v2-actions-menu_${Text.getRandom()}`,\n\t\t\t\tbindElement: this.#bindElement,\n\t\t\t\tautoHide: true,\n\t\t\t\toffsetLeft: 50,\n\t\t\t\tangle: true,\n\t\t\t\tcloseByEsc: false,\n\t\t\t\titems: this.#getPreparedItems(),\n\t\t\t});\n\t\t}\n\n\t\treturn this.#menu;\n\t}\n\n\t#getPreparedItems(): Object[]\n\t{\n\t\tconst result = [];\n\n\t\tthis.#items.forEach((itemData) => {\n\t\t\tif (itemData.hidden)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tresult.push(this.#getActionItem(itemData));\n\t\t});\n\n\t\treturn result;\n\t}\n\n\t#getActionItem(itemData: Object): Object\n\t{\n\t\tconst { svgData, messageCode, id, onClick, type, componentId, componentParams } = itemData;\n\n\t\tif (type === DELIMITER_TYPE)\n\t\t{\n\t\t\treturn {\n\t\t\t\tdelimiter: true,\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\thtml: this.#getActionItemHtml(svgData, messageCode),\n\t\t\tonclick: this.onItemClick.bind(this, { id, componentId, componentParams, onClick }),\n\t\t};\n\t}\n\n\tonItemClick({ id, componentId, componentParams, onClick }): void\n\t{\n\t\tif (Type.isFunction(onClick))\n\t\t{\n\t\t\tonClick();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#onClickActionItem({\n\t\t\t\tid,\n\t\t\t\tcomponentId,\n\t\t\t\tcomponentParams,\n\t\t\t});\n\t\t}\n\n\t\tthis.#menu.close();\n\t}\n\n\t#getActionItemHtml(svgData: string, messageCode: string): string\n\t{\n\t\treturn `\n\t\t\t<span class=\"crm-activity__todo-editor-v2-actions-menu-item\">\n\t\t\t\t<span \n\t\t\t\t\tclass=\"crm-activity__todo-editor-v2-actions-menu-item-icon\"\n\t\t\t\t\tstyle=\"background-image: url('data:image/svg+xml,${encodeURIComponent(svgData)}')\"\n\t\t\t\t></span>\n\t\t\t\t${Loc.getMessage(messageCode)}\n\t\t\t</span>\n\t\t`;\n\t}\n\n\t#onClickActionItem({ id, componentId, componentParams }): void\n\t{\n\t\tconst data = {\n\t\t\tid,\n\t\t\tcomponentId,\n\t\t\tcomponentParams,\n\t\t};\n\n\t\tEventEmitter.emit(this, Events.EVENT_ACTIONS_POPUP_ITEM_CLICK, data);\n\t}\n}\n","export class TodoEditorBorderColor {\n\tstatic DEFAULT = 'default';\n\tstatic PRIMARY = 'primary';\n}","import { DatetimeConverter } from 'crm.timeline.tools';\nimport { ajax as Ajax, Dom, Loc, Type } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { DateTimeFormat } from 'main.date';\nimport { UI } from 'ui.notification';\nimport { BitrixVue } from 'ui.vue3';\nimport ActionsPopup from './actions-popup';\nimport {\n\tTodoEditorBlocksAddress,\n\tTodoEditorBlocksCalendar,\n\tTodoEditorBlocksClient,\n\tTodoEditorBlocksFile,\n\tTodoEditorBlocksLink,\n} from './components/block/index';\nimport { Events, TodoEditor as TodoEditorComponent } from './components/todo-editor';\nimport { TodoEditorBorderColor } from './enums/border-color';\n\nimport './todo-editor.css';\n\ndeclare type TodoEditorParams = {\n\tcontainer: HTMLElement,\n\tdeadline?: Date,\n\tdefaultDescription?: string,\n\tevents?: { [event: string]: (event) => {} },\n\townerId: number,\n\tcurrentUser?: Object,\n\tpingSettings: Object,\n\tcopilotSettings?: Object,\n\tcolorSettings: ColorSettings,\n\tcalendarSettings?: Object,\n\tactionMenuSettings?: ActionMenuSettings,\n\townerTypeId: number,\n\tborderColor: string,\n\tpopupMode: boolean,\n};\n\nexport type ColorSettings = {\n\tvaluesList: ColorItem[],\n\tcurrentValueId: ?string,\n}\n\ntype ColorItem = {\n\tid: string,\n\ttitle: string,\n\tcolor: string,\n\ticonBackground: string,\n\titemBackground: string,\n\tlogoBackground: string,\n}\n\ntype ActionMenuSettings = {\n\thiddenActionItems: string[],\n}\n\nexport type BlockSettings = {\n\tid: string,\n\ttitle: string,\n\ticon: string,\n\tsort: number,\n\tsettings?: Object,\n\tactive?: boolean,\n\tfocused?: boolean,\n\tfilledValues?: Object,\n}\n\nexport const TodoEditorMode = {\n\tADD: 'add',\n\tUPDATE: 'update',\n\tCOPY: 'copy',\n};\n\nexport type ActionMenuItem = {\n\tid?: string,\n\thidden?: boolean,\n\tmessageCode?: string,\n\tsvgData?: string,\n\tcomponentId?: string,\n\tcomponentParams?: Object,\n\ttype?: string,\n\tonClick?: Function,\n}\n\n/**\n * @memberOf BX.Crm.Activity\n */\nexport class TodoEditorV2\n{\n/**\n * @event onFocus\n * @event onSaveHotkeyPressed\n */\n\tstatic BorderColor = TodoEditorBorderColor;\n\n\t#container: HTMLElement = null;\n\t#layoutApp = null;\n\t#layoutComponent = null;\n\t#loadingPromise: ?Promise = null;\n\n\t#mode: String = TodoEditorMode.ADD;\n\t#ownerTypeId: Number = null;\n\t#ownerId: Number = null;\n\t#currentUser: Object = null;\n\t#pingSettings: Object = null;\n\t#copilotSettings: ?Object = null;\n\t#colorSettings: ?ColorSettings = null;\n\t#calendarSettings: ?Object = null;\n\t#defaultTitle: String = null;\n\t#defaultDescription: String = null;\n\t#deadline: Date = null;\n\t#parentActivityId: Number = null;\n\t#borderColor = '';\n\t#activityId: Number = null;\n\t#eventEmitter: EventEmitter = null;\n\t#popupMode: boolean = false;\n\t#hiddenActionItems: string[] = [];\n\t#actionsPopup: ?ActionsPopup = null;\n\n\tconstructor(params: TodoEditorParams)\n\t{\n\t\tthis.#checkParams(params);\n\t\tthis.#initParams(params);\n\t\tthis.#prepareContainer();\n\n\t\tthis.onUpdateHandler = this.onUpdateHandler.bind(this);\n\t\tthis.onRepeatHandler = this.onRepeatHandler.bind(this);\n\n\t\tthis.#bindEvents(params);\n\t}\n\n\t#checkParams(params: TodoEditorParams): void\n\t{\n\t\tif (!Type.isDomNode(params.container))\n\t\t{\n\t\t\tthrow new Error('TodoEditor container must be a DOM Node');\n\t\t}\n\n\t\tif (!Type.isNumber(params.ownerTypeId))\n\t\t{\n\t\t\tthrow new TypeError('OwnerTypeId must be set');\n\t\t}\n\n\t\tif (!Type.isNumber(params.ownerId))\n\t\t{\n\t\t\tthrow new TypeError('OwnerId must be set');\n\t\t}\n\n\t\tif (!Type.isObjectLike(params.currentUser))\n\t\t{\n\t\t\tthrow new TypeError('Current user must be set');\n\t\t}\n\n\t\tif (!Type.isObjectLike(params.pingSettings) || Object.keys(params.pingSettings).length === 0)\n\t\t{\n\t\t\tthrow new TypeError('Ping settings must be set');\n\t\t}\n\n\t\tif (!Type.isObjectLike(params.calendarSettings) || Object.keys(params.calendarSettings).length === 0)\n\t\t{\n\t\t\tthrow new TypeError('Calendar settings must be set');\n\t\t}\n\n\t\tif (!Type.isObjectLike(params.colorSettings) || Object.keys(params.colorSettings).length === 0)\n\t\t{\n\t\t\tthrow new TypeError('Color settings must be set');\n\t\t}\n\t}\n\n\t#initParams(params): void\n\t{\n\t\tthis.#container = params.container;\n\t\tthis.#borderColor = this.#isValidBorderColor(params.borderColor)\n\t\t\t? params.borderColor\n\t\t\t: TodoEditorV2.BorderColor.DEFAULT\n\t\t;\n\n\t\tthis.#ownerTypeId = params.ownerTypeId;\n\t\tthis.#ownerId = params.ownerId;\n\t\tthis.#currentUser = params.currentUser;\n\t\tthis.#pingSettings = params.pingSettings || {};\n\t\tthis.#copilotSettings = params.copilotSettings || null;\n\t\tthis.#colorSettings = params.colorSettings;\n\t\tthis.#calendarSettings = params.calendarSettings || {};\n\t\tthis.#defaultTitle = this.#getDefaultTitle();\n\t\tthis.#defaultDescription = Type.isString(params.defaultDescription)\n\t\t\t? params.defaultDescription\n\t\t\t: this.#getDefaultDescription()\n\t\t;\n\t\tthis.#deadline = Type.isDate(params.deadline) ? params.deadline : null;\n\t\tif (!this.#deadline)\n\t\t{\n\t\t\tthis.setDefaultDeadLine(false);\n\t\t}\n\n\t\tif (Type.isArrayFilled(params.actionMenuSettings?.hiddenActionItems))\n\t\t{\n\t\t\tthis.#hiddenActionItems = params.actionMenuSettings.hiddenActionItems;\n\t\t}\n\n\t\tthis.#popupMode = Type.isBoolean(params.popupMode) ? params.popupMode : false;\n\t}\n\n\t#prepareContainer(): void\n\t{\n\t\tDom.addClass(this.#container, this.#getClassname());\n\t}\n\n\tsetMode(mode: String): TodoEditorV2\n\t{\n\t\tif (!Object.values(TodoEditorMode).includes(mode))\n\t\t{\n\t\t\tthrow new Error(`Unknown TodoEditor mode ${mode}`);\n\t\t}\n\n\t\tthis.#mode = mode;\n\n\t\tif (this.#layoutComponent)\n\t\t{\n\t\t\tthis.#layoutComponent.setMode(mode);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tshow(): void\n\t{\n\t\tthis.#layoutApp = BitrixVue.createApp(TodoEditorComponent, {\n\t\t\tdeadline: this.#deadline,\n\t\t\tdefaultTitle: this.#defaultTitle,\n\t\t\tdefaultDescription: this.#defaultDescription,\n\t\t\tonFocus: this.#onInputFocus.bind(this),\n\t\t\tonSaveHotkeyPressed: this.#onSaveHotkeyPressed.bind(this),\n\t\t\tpopupMode: this.#popupMode,\n\t\t\tcurrentUser: this.#currentUser,\n\t\t\tpingSettings: this.#pingSettings,\n\t\t\tcopilotSettings: this.#copilotSettings,\n\t\t\tcolorSettings: this.#colorSettings,\n\t\t\tactionsPopup: this.#getActionsPopup(),\n\t\t\tblocks: this.#getBlocks(),\n\t\t\tmode: this.#mode,\n\t\t});\n\n\t\tthis.#layoutComponent = this.#layoutApp.mount(this.#container);\n\t}\n\n\t#getActionsPopup(): ActionsPopup\n\t{\n\t\tif (this.#actionsPopup === null)\n\t\t{\n\t\t\tconst items: ActionMenuItem[] = [\n\t\t\t\t{\n\t\t\t\t\tid: 'calendar',\n\t\t\t\t\tmessageCode: 'CRM_ACTIVITY_TODO_ACTIONS_CALENDAR',\n\t\t\t\t\tsvgData: '<svg width=\"25\" height=\"24\" viewBox=\"0 0 25 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M11.9907 10.3123H13.1133C13.3394 10.3123 13.5227 10.4944 13.5227 10.7191V11.8343C13.5227 12.0589 13.3394 12.241 13.1133 12.241H11.9907C11.7646 12.241 11.5813 12.0589 11.5813 11.8343V10.7191C11.5813 10.4944 11.7646 10.3123 11.9907 10.3123Z\" fill=\"#A8ADB4\"/><path d=\"M10.2021 10.3126H9.07947C8.85336 10.3126 8.67007 10.4947 8.67007 10.7193V11.8345C8.67007 12.0591 8.85336 12.2412 9.07947 12.2412H10.2021C10.4282 12.2412 10.6115 12.0591 10.6115 11.8345V10.7193C10.6115 10.4947 10.4282 10.3126 10.2021 10.3126Z\" fill=\"#A8ADB4\"/><path d=\"M10.2011 13.2054H9.07852C8.85242 13.2054 8.66912 13.3874 8.66912 13.6121V14.7273C8.66912 14.9519 8.85242 15.134 9.07852 15.134H10.2011C10.4272 15.134 10.6105 14.9519 10.6105 14.7273V13.6121C10.6105 13.3874 10.4272 13.2054 10.2011 13.2054Z\" fill=\"#A8ADB4\"/><path d=\"M13.1133 13.2054H11.9907C11.7646 13.2054 11.5813 13.3874 11.5813 13.6121V14.7273C11.5813 14.9519 11.7646 15.134 11.9907 15.134H13.1133C13.3394 15.134 13.5227 14.9519 13.5227 14.7273V13.6121C13.5227 13.3874 13.3394 13.2054 13.1133 13.2054Z\" fill=\"#A8ADB4\"/><path d=\"M14.9029 10.3123H16.0255C16.2516 10.3123 16.4349 10.4944 16.4349 10.7191V11.8343C16.4349 12.0589 16.2516 12.241 16.0255 12.241H14.9029C14.6768 12.241 14.4935 12.0589 14.4935 11.8343V10.7191C14.4935 10.4944 14.6768 10.3123 14.9029 10.3123Z\" fill=\"#A8ADB4\"/><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M17.1486 5.691V5.15946H18.3308C19.4103 5.2275 20.2467 6.16407 20.2272 7.28562V17.9164C20.2272 18.5032 19.7685 18.9795 19.201 18.9795H5.80482C5.23836 18.9795 4.77862 18.5032 4.77862 17.9164V7.28562C4.77451 7.23034 4.77246 7.17612 4.77246 7.12191C4.77451 6.03544 5.62627 5.15734 6.67505 5.15946H7.85724V5.691C7.85724 6.57123 8.54582 7.28562 9.39654 7.28562C10.2473 7.28562 10.9359 6.57123 10.9359 5.691V5.15946H14.07V5.691C14.07 6.57123 14.7596 7.28562 15.6093 7.28562C16.459 7.28562 17.1486 6.57123 17.1486 5.691ZM18.1748 16.8533H6.83106V8.40898H18.1748V16.8533Z\" fill=\"#A8ADB4\"/><path d=\"M10.1507 4.31111V5.4805C10.1507 5.91211 9.81308 6.26186 9.39644 6.26186C8.9798 6.26186 8.64218 5.91211 8.64218 5.4805V4.31111L8.64771 4.20959C8.69329 3.82206 9.01469 3.52246 9.40157 3.52442C9.81821 3.52762 10.1528 3.8795 10.1507 4.31111Z\" fill=\"#A8ADB4\"/><path d=\"M16.3215 4.33979V5.44858C16.3215 5.85574 16.0024 6.18636 15.6083 6.18636C15.2142 6.1853 14.8971 5.85468 14.8971 5.44752V4.33979C14.8971 3.93157 15.2163 3.60201 15.6093 3.60201C16.0024 3.60201 16.3215 3.93157 16.3215 4.33979Z\" fill=\"#A8ADB4\"/></svg>',\n\t\t\t\t},\n\t\t\t\t// temporary commented\n\t\t\t\t// {\n\t\t\t\t// \tid: 'slot',\n\t\t\t\t// \tmessageCode: 'CRM_ACTIVITY_TODO_ACTIONS_SLOT',\n\t\t\t\t// \tsvgData: '<svg width=\"25\" height=\"25\" viewBox=\"0 0 25 25\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M6.48621 17.5597H9.71158L8.73957 19.6426H5.48731C4.93592 19.6426 4.48842 19.1759 4.48842 18.601V8.18467C4.48442 8.13051 4.48242 8.07738 4.48242 8.02426C4.48442 6.95972 5.3135 6.09933 6.33437 6.10142H7.4851V6.62223C7.4851 7.4847 8.15536 8.18467 8.98344 8.18467C9.81152 8.18467 10.4818 7.4847 10.4818 6.62223V6.10142H13.5351V6.62223C13.5351 7.4847 14.2064 8.18467 15.0334 8.18467C15.8605 8.18467 16.5318 7.4847 16.5318 6.62223V6.10142H17.7853C18.8361 6.16808 19.6502 7.08575 19.6313 8.18467V11.9389L17.6335 10.274V9.28577H6.48621V17.5597ZM9.71763 6.41636V5.27057C9.71963 4.84767 9.39399 4.50289 8.98844 4.49977C8.58288 4.49768 8.25125 4.83829 8.24925 5.26015V5.27057V6.41636C8.24925 6.83926 8.57789 7.18196 8.98344 7.18196C9.38899 7.18196 9.71763 6.83926 9.71763 6.41636ZM15.7266 6.38426V5.29784C15.7266 4.89786 15.4159 4.57495 15.0333 4.57495C14.6507 4.57495 14.3401 4.89786 14.3401 5.29784V6.38322C14.3401 6.78216 14.6487 7.10611 15.0323 7.10715C15.4159 7.10715 15.7266 6.7832 15.7266 6.38426ZM8.77829 11.1139C8.50215 11.1139 8.27829 11.3377 8.27829 11.6139V12.5036C8.27829 12.7797 8.50215 13.0036 8.77829 13.0036H9.66803C9.94418 13.0036 10.168 12.7797 10.168 12.5036V11.6139C10.168 11.3377 9.94418 11.1139 9.66803 11.1139H8.77829ZM11.1129 11.6511C11.1129 11.375 11.3368 11.1511 11.6129 11.1511H12.5027C12.7788 11.1511 13.0027 11.375 13.0027 11.6511V12.5409C13.0027 12.817 12.7788 13.0409 12.5027 13.0409H11.6129C11.3368 13.0409 11.1129 12.817 11.1129 12.5409V11.6511ZM16.9787 12.1586C16.9787 11.9791 17.2088 11.8845 17.3531 12.0046L22.4009 16.205C22.5328 16.3148 22.5328 16.506 22.4009 16.6158L17.3531 20.8162C17.2088 20.9363 16.9787 20.8417 16.9787 20.6622V17.9552C16.9513 17.9654 16.9214 17.971 16.8903 17.971C13.9663 17.9713 11.4309 19.8957 10.3896 20.8119C10.23 20.9523 9.96759 20.8299 10.0157 20.6312C10.4226 18.9502 11.9512 14.6044 16.8959 14.4746C16.9249 14.4738 16.9529 14.4784 16.9787 14.4873V12.1586Z\" fill=\"#A8ADB4\"/></svg>',\n\t\t\t\t// },\n\t\t\t\t{\n\t\t\t\t\ttype: 'delimiter',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'client',\n\t\t\t\t\tmessageCode: 'CRM_ACTIVITY_TODO_ACTIONS_CLIENT',\n\t\t\t\t\tsvgData: '<svg width=\"25\" height=\"24\" viewBox=\"0 0 25 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M19.1102 18.7826C19.5562 18.6205 19.8037 18.1517 19.7122 17.686L19.3963 16.0768C19.3963 15.4053 18.5019 14.6382 16.7409 14.1912C16.1442 14.0278 15.577 13.7745 15.0596 13.4403C14.9464 13.3768 14.9636 12.7904 14.9636 12.7904L14.3964 12.7056C14.3964 12.658 14.3479 11.9547 14.3479 11.9547C15.0265 11.7309 14.9567 10.4105 14.9567 10.4105C15.3877 10.6451 15.6684 9.60016 15.6684 9.60016C16.1781 8.14839 15.4145 8.23617 15.4145 8.23617C15.5481 7.34989 15.5481 6.44915 15.4145 5.56287C15.075 2.62285 9.96373 3.42099 10.5698 4.38119C9.07596 4.11109 9.41682 7.44748 9.41682 7.44748L9.74084 8.31146C9.29173 8.5974 9.37993 8.92555 9.47844 9.29212C9.51952 9.44494 9.56238 9.60443 9.56886 9.77033C9.60016 10.6029 10.1192 10.4304 10.1192 10.4304C10.1512 11.8045 10.8415 11.9834 10.8415 11.9834C10.9712 12.8464 10.8904 12.6995 10.8904 12.6995L10.276 12.7725C10.2844 12.9687 10.2681 13.1652 10.2275 13.3576C9.87062 13.5137 9.6521 13.638 9.43575 13.761C9.21426 13.8869 8.99503 14.0116 8.6319 14.1679C7.24504 14.7644 5.73779 15.5403 5.46984 16.5849C5.3915 16.8903 5.31478 17.3009 5.24543 17.729C5.17275 18.1776 5.42217 18.6168 5.84907 18.7728C7.71183 19.4533 9.81409 19.8566 12.0441 19.9044H12.942C15.1614 19.8568 17.2541 19.4572 19.1102 18.7826Z\" fill=\"#A8ADB4\"/></svg>',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'colleague',\n\t\t\t\t\tmessageCode: 'CRM_ACTIVITY_TODO_ACTIONS_COLLEAGUE',\n\t\t\t\t\tsvgData: '<svg width=\"25\" height=\"24\" viewBox=\"0 0 25 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M15.3717 14.7295C15.3717 14.7295 15.8697 16.6051 16.1536 17.9919C16.2039 18.2372 16.0599 18.4795 15.8198 18.5503C14.2716 19.0067 12.5157 19.2655 10.6546 19.268H10.5989C8.33167 19.2649 6.22074 18.8816 4.45101 18.2238C4.09757 18.0925 3.90181 17.7203 3.97453 17.3503C4.14815 16.467 4.33844 15.5288 4.43784 15.1361C4.64903 14.3016 5.83236 13.6816 6.92075 13.205C7.20527 13.0805 7.37691 12.9811 7.55037 12.8806C7.72026 12.7822 7.89189 12.6828 8.17301 12.5578C8.20474 12.4044 8.21749 12.2477 8.21099 12.0911L8.69326 12.0328C8.69326 12.0328 8.75664 12.1501 8.6547 11.4606C8.6547 11.4606 8.11342 11.3162 8.0883 10.2184C8.0883 10.2184 7.68169 10.3563 7.65715 9.69107C7.65216 9.55801 7.61854 9.43016 7.58634 9.30774C7.50923 9.0145 7.4403 8.75241 7.79269 8.52443L7.53826 7.83494C7.53826 7.83494 7.27128 5.168 8.4438 5.38499C7.96824 4.6188 11.98 3.98123 12.2465 6.33026C12.3513 7.03836 12.3513 7.758 12.2465 8.46609C12.2465 8.46609 12.8459 8.39609 12.4457 9.55574C12.4457 9.55574 12.2254 10.3893 11.8872 10.2012C11.8872 10.2012 11.9421 11.2561 11.4093 11.4349C11.4093 11.4349 11.4472 11.9966 11.4472 12.0349L11.8927 12.104C11.8927 12.104 11.8804 12.5724 11.9681 12.6231C12.3741 12.8901 12.8192 13.0925 13.2875 13.2231C14.6706 13.5801 15.3717 14.1928 15.3717 14.7295Z\" fill=\"#A8ADB4\"/><path d=\"M21.5203 15.2542C21.5307 15.4621 21.5426 15.6981 21.5546 15.9373C21.5725 16.2952 21.3506 16.6229 21.0072 16.7257C19.8897 17.0604 18.6226 17.3309 17.2483 17.5217H16.816C16.7901 17.1556 16.4584 15.8876 16.266 15.1519C16.1897 14.8602 16.1352 14.6521 16.1304 14.6171C16.1056 13.9241 15.496 13.3052 14.4537 12.8823C14.5326 12.7757 14.6001 12.6612 14.6553 12.5407C14.8014 12.3594 14.992 12.2187 15.2085 12.1324L15.2252 11.5899L14.081 11.2324C14.081 11.2324 13.7869 11.095 13.7576 11.095C13.7915 11.0115 13.8339 10.9318 13.8841 10.857C13.906 10.7987 14.0445 10.3635 14.0445 10.3635C13.8779 10.5775 13.6825 10.7675 13.4638 10.9282C13.6639 10.5746 13.8337 10.2047 13.9712 9.82247C14.0619 9.45455 14.1226 9.07991 14.1529 8.7022C14.2312 8.01581 14.3536 7.33514 14.5192 6.66437C14.638 6.32965 14.8474 6.03436 15.1241 5.81126C15.533 5.5276 16.0102 5.35795 16.5067 5.31982H16.5651C17.0624 5.35763 17.5406 5.52729 17.9503 5.81126C18.2273 6.03393 18.4368 6.32909 18.5555 6.66379C18.7209 7.33461 18.8433 8.01526 18.9221 8.70162C18.9574 9.07094 19.0211 9.437 19.1128 9.79651C19.2503 10.1855 19.4171 10.5635 19.6118 10.9273C19.3927 10.7671 19.1969 10.5773 19.0299 10.3635C19.0299 10.3635 19.1377 10.7584 19.1593 10.8167C19.2185 10.9049 19.2712 10.9972 19.317 11.0929C19.2887 11.0929 18.9937 11.2303 18.9937 11.2303L17.8495 11.5879L17.8658 12.1307C18.0825 12.2167 18.2731 12.3574 18.4191 12.539C18.4883 12.7133 18.5979 12.8687 18.7389 12.9925C19.015 13.0885 19.2812 13.2108 19.5338 13.3577C19.9163 13.5702 20.149 13.6309 20.5105 13.8534C21.1937 14.2737 21.4835 14.5246 21.5201 15.2515L21.5203 15.2542Z\" fill=\"#A8ADB4\"/></svg>',\n\t\t\t\t\tcomponentId: 'calendar',\n\t\t\t\t\tcomponentParams: {\n\t\t\t\t\t\tshowUserSelector: true,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: 'delimiter',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'address',\n\t\t\t\t\tmessageCode: 'CRM_ACTIVITY_TODO_ACTIONS_ADDRESS',\n\t\t\t\t\tsvgData: '<svg width=\"25\" height=\"24\" viewBox=\"0 0 25 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M12.5059 3.50928C9.12771 3.50928 6.41309 6.22284 6.41309 9.6021C6.41309 13.2243 10.1465 18.3027 11.7684 20.338C12.1493 20.816 12.8582 20.8132 13.2357 20.3325C14.8534 18.2721 18.5987 13.1219 18.5987 9.6021C18.5987 6.22284 15.8841 3.50928 12.5059 3.50928ZM12.506 12.3707C10.9556 12.3707 9.73636 11.1526 9.73636 9.60108C9.73636 8.05063 10.9545 6.83142 12.506 6.83142C14.0565 6.83142 15.2757 8.04956 15.2757 9.60108C15.2757 11.1526 14.0565 12.3707 12.506 12.3707Z\" fill=\"#A8ADB4\"/></svg>',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'room',\n\t\t\t\t\tmessageCode: 'CRM_ACTIVITY_TODO_ACTIONS_ROOM',\n\t\t\t\t\tsvgData: '<svg width=\"25\" height=\"25\" viewBox=\"0 0 25 25\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M5.23231 5.98876C6.98167 4.03949 18.4413 4.15905 20.0081 5.98876C21.5749 7.81847 21.8554 15.3273 20.0081 17.0395C19.6571 17.3648 18.9666 17.6131 18.0668 17.793C18.0471 18.8982 17.9669 21.1391 17.6418 21.1391C17.3455 21.1391 15.2474 19.3102 13.962 18.1643C10.2879 18.232 6.19211 17.778 5.23231 17.0395C3.55525 15.7491 3.48296 7.93803 5.23231 5.98876ZM6.27368 14.5419C6.87367 14.6452 7.7036 14.7319 8.66214 14.7982C8.72234 14.54 8.79838 14.2423 8.8529 14.029C8.89254 13.8739 8.9208 13.7633 8.92333 13.7447C8.93599 13.3759 9.43469 13.0463 9.97766 12.8211C9.93653 12.7643 9.90135 12.7034 9.87269 12.6394C9.79701 12.5432 9.69766 12.4684 9.58444 12.4221L9.57579 12.1334L10.172 11.9424C10.172 11.9424 10.3259 11.8694 10.3407 11.8694C10.3231 11.825 10.301 11.7825 10.2747 11.7426C10.2656 11.718 10.218 11.5663 10.1989 11.5056L10.191 11.4805C10.2773 11.5942 10.3789 11.6955 10.4928 11.7814C10.3883 11.593 10.2999 11.3962 10.2283 11.1929C10.181 10.997 10.1494 10.7976 10.1336 10.5966C10.0927 10.2313 10.029 9.86897 9.94254 9.51169C9.88118 9.33425 9.77217 9.17712 9.62748 9.05751C9.41503 8.90666 9.16566 8.81625 8.90592 8.7959H8.87605C8.61632 8.81632 8.36698 8.90673 8.15451 9.05751C8.0096 9.17698 7.9005 9.33415 7.83924 9.51169C7.75307 9.86902 7.68931 10.2313 7.64834 10.5966C7.62998 10.7932 7.59675 10.988 7.54893 11.1796C7.47744 11.3864 7.39056 11.5877 7.28902 11.7816C7.40367 11.6961 7.50591 11.5951 7.59282 11.4815C7.59282 11.4815 7.53662 11.6922 7.52531 11.7229C7.49449 11.7699 7.46708 11.819 7.44328 11.8699C7.4583 11.8699 7.61206 11.9429 7.61206 11.9429L8.20819 12.1334L8.19958 12.4221C8.08625 12.4682 7.98689 12.543 7.9113 12.6392C7.87548 12.7316 7.81841 12.8143 7.74472 12.8805C7.60094 12.9315 7.46246 12.9964 7.33121 13.0741C7.13253 13.187 6.91378 13.2603 6.68715 13.2896C6.45896 13.328 6.31499 13.7045 6.31499 13.7045C6.31464 13.7106 6.29359 14.1341 6.27368 14.5419ZM9.28982 14.8373C11.3578 14.9552 13.8758 14.9842 15.9706 14.8924C15.848 14.3765 15.7382 13.954 15.7382 13.954C15.7382 13.954 15.3331 13.2757 14.5348 13.0651C14.2636 12.9878 14.0063 12.8682 13.7724 12.7109C13.7348 12.6134 13.72 12.5086 13.729 12.4045L13.4731 12.3645C13.4731 12.342 13.4512 12.0104 13.4512 12.0104C13.7587 11.9049 13.7271 11.2824 13.7271 11.2824C13.9224 11.3929 14.0496 10.901 14.0496 10.901C14.2806 10.217 13.9345 10.2581 13.9345 10.2581C13.9951 9.84024 13.9951 9.41586 13.9345 8.99799C13.7808 7.61217 11.4644 7.98794 11.7391 8.44097C11.0622 8.31303 11.2167 9.88648 11.2167 9.88648L11.3636 10.2933C11.1602 10.4278 11.2001 10.5825 11.2446 10.7553C11.2632 10.8274 11.2825 10.9027 11.2854 10.9811C11.2996 11.3739 11.5343 11.2923 11.5343 11.2923C11.5489 11.9401 11.8615 12.0252 11.8615 12.0252C11.9202 12.432 11.8838 12.3618 11.8838 12.3618L11.6054 12.3963C11.6092 12.4887 11.6019 12.5813 11.5835 12.672C11.4219 12.7457 11.3229 12.8042 11.2252 12.8619C11.1246 12.9214 11.0254 12.98 10.8604 13.0537C10.232 13.3343 9.54886 13.7007 9.42766 14.193C9.39512 14.3251 9.34534 14.5617 9.28982 14.8373ZM16.6009 14.86C17.5258 14.806 18.3408 14.7254 18.9595 14.6151C18.9386 14.1847 18.9145 13.6995 18.914 13.693C18.914 13.693 18.7709 13.3189 18.5442 13.2808C18.3191 13.2516 18.1018 13.1789 17.9044 13.0667C17.774 12.9895 17.6364 12.925 17.4936 12.8744C17.4204 12.8085 17.3637 12.7264 17.328 12.6346C17.253 12.5391 17.1543 12.4647 17.0416 12.419L17.0333 12.1321L17.6255 11.9429C17.6255 11.9429 17.7783 11.8703 17.7932 11.8703C17.7695 11.8198 17.7422 11.7709 17.7115 11.7242C17.7003 11.6937 17.6445 11.4845 17.6445 11.4845C17.7308 11.5974 17.8324 11.6977 17.9463 11.7826C17.8454 11.59 17.7591 11.39 17.6881 11.1845C17.6406 10.9942 17.6075 10.8007 17.5893 10.6053C17.5486 10.2425 17.4853 9.88251 17.3997 9.52753C17.3388 9.35114 17.2304 9.195 17.0864 9.07631C16.8754 8.92651 16.6276 8.8367 16.3696 8.81641H16.3399C16.0819 8.83662 15.8342 8.92644 15.6231 9.07631C15.4793 9.19514 15.371 9.35125 15.31 9.52753C15.2242 9.88246 15.1609 10.2425 15.1202 10.6053C15.1046 10.805 15.0731 11.0031 15.0262 11.1978C14.9551 11.3996 14.8672 11.5952 14.7634 11.7825C14.8767 11.6971 15.0035 11.4835 15.0035 11.4835C15.0035 11.4835 14.9918 11.7131 14.9804 11.7437C14.9543 11.7834 14.9323 11.8256 14.9149 11.8697C14.9296 11.8697 15.0825 11.9423 15.0825 11.9423L15.6746 12.1321L15.6661 12.419C15.5535 12.4649 15.3162 12.6391 15.2754 12.6955C15.8148 12.9192 16.3102 13.3665 16.323 13.7329C16.3255 13.7515 16.3539 13.8629 16.3938 14.0188C16.4536 14.2532 16.5393 14.5883 16.6009 14.86Z\" fill=\"#A8ADB4\"/></svg>',\n\t\t\t\t\tcomponentId: 'calendar',\n\t\t\t\t\tcomponentParams: {\n\t\t\t\t\t\tshowLocation: true,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: 'delimiter',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'link',\n\t\t\t\t\tmessageCode: 'CRM_ACTIVITY_TODO_ACTIONS_LINK',\n\t\t\t\t\tsvgData: '<svg width=\"25\" height=\"25\" viewBox=\"0 0 25 25\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M16.4859 14.0353L17.7859 15.3353C18.5909 16.1402 18.5914 17.4575 17.7865 18.2624C16.9815 19.0674 15.6637 19.0674 14.8588 18.2624L13.5588 16.9624C12.9846 16.3883 12.8287 15.5561 13.0731 14.8323L13.474 15.2332C13.8267 15.586 14.4045 15.587 14.7578 15.2338C15.111 14.8805 15.1105 14.3022 14.7578 13.9494L14.3569 13.5485C15.0802 13.3046 15.9118 13.4611 16.4859 14.0353ZM7.27004 10.6737L5.97001 9.37368C5.16509 8.56875 5.16561 7.25145 5.97054 6.44652C6.77547 5.64159 8.09224 5.64159 8.89717 6.44652L10.1972 7.74655C10.7713 8.32068 10.9283 9.15282 10.6839 9.87558L10.047 9.23865C9.69373 8.88538 9.11594 8.88538 8.76267 9.23865C8.4094 9.59192 8.40992 10.1692 8.76319 10.5225L9.40012 11.1594C8.67684 11.4043 7.84417 11.2478 7.27004 10.6737ZM11.4334 6.67575L9.96797 5.21034C8.52873 3.7711 6.1736 3.7711 4.73436 5.21034C3.29512 6.64959 3.29512 9.00471 4.73436 10.444L6.19977 11.9094C7.41658 13.1262 9.28184 13.302 10.7022 12.4615L11.7715 13.5307C10.9304 14.9506 11.1068 16.8164 12.3231 18.0327L13.789 19.4986C15.2283 20.9379 17.5834 20.9379 19.0226 19.4986C20.4619 18.0594 20.4619 15.7043 19.0226 14.265L17.5567 12.7991C16.3404 11.5828 14.4746 11.4064 13.0553 12.2469L11.9861 11.1777C12.826 9.75783 12.6502 7.89257 11.4334 6.67575Z\" fill=\"#A8ADB4\"/></svg>',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'file',\n\t\t\t\t\tmessageCode: 'CRM_ACTIVITY_TODO_ACTIONS_FILE',\n\t\t\t\t\tsvgData: '<svg width=\"25\" height=\"24\" viewBox=\"0 0 25 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M18.6123 10.7026C18.7309 10.8212 18.7309 11.0135 18.6123 11.1321L17.8165 11.9279C17.6979 12.0465 17.5056 12.0465 17.387 11.9279L12.7007 7.24153C11.3529 5.89374 9.14743 5.89374 7.79963 7.24153C6.45184 8.58932 6.45184 10.7948 7.79963 12.1426L13.5486 17.8916C14.3938 18.7368 15.7665 18.7368 16.6118 17.8916C17.457 17.0463 17.457 15.6736 16.6118 14.8284L11.4754 9.69206C11.1323 9.34889 10.5933 9.34889 10.2502 9.69206C9.90699 10.0352 9.90699 10.5742 10.2502 10.9173L14.3239 14.991C14.4425 15.1096 14.4425 15.3019 14.3239 15.4205L13.5281 16.2163C13.4095 16.3349 13.2172 16.3349 13.0986 16.2163L9.0249 12.1426C8.00783 11.1255 8.00783 9.48386 9.0249 8.46679C10.042 7.44973 11.6836 7.44973 12.7007 8.46679L17.837 13.6031C19.3561 15.1222 19.3561 17.5977 17.837 19.1168C16.3179 20.6359 13.8424 20.6359 12.3233 19.1168L6.57437 13.3679C4.55268 11.3462 4.55268 8.03795 6.57437 6.01626C8.59606 3.99458 11.9043 3.99458 13.926 6.01626L18.6123 10.7026Z\" fill=\"#A8ADB4\"/></svg>',\n\t\t\t\t},\n\t\t\t];\n\n\t\t\tthis.#prepareActionItems(items);\n\n\t\t\tthis.#actionsPopup = new ActionsPopup(items);\n\t\t}\n\n\t\treturn this.#actionsPopup;\n\t}\n\n\t#prepareActionItems(items: ActionMenuItem[]): void\n\t{\n\t\titems.forEach((item) => {\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\titem.hidden = (item.id && this.#hiddenActionItems.includes(item.id));\n\t\t});\n\t}\n\n\t#bindEvents(params: TodoEditorParams): void\n\t{\n\t\tthis.#eventEmitter = new EventEmitter();\n\t\tthis.#eventEmitter.setEventNamespace('Crm.Activity.TodoEditor');\n\n\t\tif (Type.isObject(params.events))\n\t\t{\n\t\t\tObject.keys(params.events).forEach((eventName) => {\n\t\t\t\tif (Type.isFunction(params.events[eventName]))\n\t\t\t\t{\n\t\t\t\t\tthis.#eventEmitter.subscribe(eventName, params.events[eventName]);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tEventEmitter.subscribe(Events.EVENT_UPDATE_CLICK, this.onUpdateHandler);\n\t\tEventEmitter.subscribe(Events.EVENT_REPEAT_CLICK, this.onRepeatHandler);\n\t}\n\n\tasync onUpdateHandler(event: BaseEvent): void\n\t{\n\t\tconst canShowPrefilledComponent = await this.#canShowPrefilledComponent();\n\t\tif (!canShowPrefilledComponent)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst menuBar = BX.Crm?.Timeline?.MenuBar?.getDefault();\n\t\tif (!menuBar)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tmenuBar.setActiveItemById('todo');\n\n\t\tconst { entityData, blocksData } = await this.#getUpdateOrRepeatActionData(event.getData());\n\n\t\tthis\n\t\t\t.setActivityId(entityData.id)\n\t\t\t.setCurrentUser(entityData.currentUser)\n\t\t;\n\n\t\tawait this.#showPrefilledComponent(entityData, blocksData, TodoEditorMode.UPDATE);\n\t}\n\n\tasync #canShowPrefilledComponent(): Promise\n\t{\n\t\tif (Dom.hasClass(this.#container, '--is-edit'))\n\t\t{\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tUI.Dialogs.MessageBox.show({\n\t\t\t\t\tmodal: true,\n\t\t\t\t\ttitle: Loc.getMessage('CRM_ACTIVITY_TODO_CONFIRM_DIALOG_TITLE'),\n\t\t\t\t\tmessage: Loc.getMessage('CRM_ACTIVITY_TODO_CONFIRM_DIALOG_MESSAGE'),\n\t\t\t\t\tbuttons: BX.UI.Dialogs.MessageBoxButtons.OK_CANCEL,\n\t\t\t\t\tokCaption: Loc.getMessage('CRM_ACTIVITY_TODO_CONFIRM_DIALOG_OK_BUTTON'),\n\t\t\t\t\tonOk: (messageBox) => {\n\t\t\t\t\t\tresolve(true);\n\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t},\n\t\t\t\t\tonCancel: (messageBox) => {\n\t\t\t\t\t\tresolve(false);\n\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\treturn Promise.resolve(true);\n\t}\n\n\tasync onRepeatHandler(event: BaseEvent): void\n\t{\n\t\tconst canShowPrefilledComponent = await this.#canShowPrefilledComponent();\n\t\tif (!canShowPrefilledComponent)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst { entityData, blocksData } = await this.#getUpdateOrRepeatActionData(event.getData());\n\n\t\tthis.#setActiveMenuBarItem();\n\t\tthis\n\t\t\t.setActivityId(null)\n\t\t\t.setCurrentUser(entityData.currentUser)\n\t\t\t.setDefaultDeadLine()\n\t\t;\n\n\t\tentityData.deadline = this.#deadline;\n\t\tconst calendar = blocksData?.find((blockData) => blockData.id === 'calendar');\n\t\tif (Type.isObject(calendar))\n\t\t{\n\t\t\tcalendar.data.from = this.#deadline.getTime();\n\t\t}\n\n\t\tawait this.#showPrefilledComponent(entityData, blocksData, TodoEditorMode.COPY);\n\t}\n\n\t#setActiveMenuBarItem(): void\n\t{\n\t\tconst menuBar = BX.Crm?.Timeline?.MenuBar?.getDefault();\n\t\tif (menuBar)\n\t\t{\n\t\t\tmenuBar.setActiveItemById('todo');\n\t\t}\n\t}\n\n\tasync #getUpdateOrRepeatActionData(data: Object): Promise\n\t{\n\t\tconst { activityId, ownerTypeId, ownerId } = data;\n\t\tconst { data: { entityData, blocksData } } = await this.#fetchSettings({\n\t\t\tid: activityId,\n\t\t\townerTypeId,\n\t\t\townerId,\n\t\t});\n\n\t\treturn {\n\t\t\tentityData,\n\t\t\tblocksData,\n\t\t};\n\t}\n\n\tasync #showPrefilledComponent(entityData: Object, blocksData: Object, mode: string = TodoEditorMode.ADD): void\n\t{\n\t\tawait this.#initLayoutComponentForEdit(entityData, blocksData);\n\t\tthis.#scrollToTop();\n\n\t\tthis.setMode(mode);\n\t\tthis.setFocused();\n\t}\n\n\tasync #initLayoutComponentForEdit(entityData: Object, blocksData: Object[]): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tvoid this.clearValue().then(() => {\n\t\t\t\tthis.#layoutComponent.setData(entityData);\n\n\t\t\t\tblocksData.forEach(({ id, data }) => {\n\t\t\t\t\tif (Type.isBoolean(data.active) && data.active === false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.#layoutComponent.setBlockFilledValues(id, data);\n\t\t\t\t\tthis.#layoutComponent.setBlockActive(id);\n\t\t\t\t});\n\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t}\n\n\t#scrollToTop(): void\n\t{\n\t\twindow.scrollTo({\n\t\t\ttop: 0,\n\t\t\tbehavior: 'smooth',\n\t\t});\n\t}\n\n\tasync #fetchSettings({ id, ownerId, ownerTypeId }): Promise\n\t{\n\t\tconst data = {\n\t\t\tid,\n\t\t\townerId,\n\t\t\townerTypeId,\n\t\t};\n\n\t\treturn new Promise((resolve) => {\n\t\t\tAjax\n\t\t\t\t.runAction(this.#getConfigActionPath(), { data })\n\t\t\t\t.then(resolve)\n\t\t\t\t.catch((errors) => {\n\t\t\t\t\tconsole.error(errors);\n\t\t\t\t})\n\t\t\t;\n\t\t});\n\t}\n\n\t#getConfigActionPath(): String\n\t{\n\t\treturn 'crm.activity.todo.fetchSettings';\n\t}\n\n\tsave(): Promise\n\t{\n\t\tif (this.#loadingPromise)\n\t\t{\n\t\t\treturn this.#loadingPromise;\n\t\t}\n\n\t\t// wrap BX.Promise in native js promise\n\t\tthis.#loadingPromise = new Promise((resolve, reject) => {\n\t\t\tthis.#getSaveActionData().then((data) => {\n\t\t\t\tAjax\n\t\t\t\t\t.runAction(this.#getSaveActionPath(), { data })\n\t\t\t\t\t.then(resolve)\n\t\t\t\t\t.catch(reject)\n\t\t\t\t;\n\t\t\t}).catch(reject);\n\t\t}).catch((response) => {\n\t\t\tUI.Notification.Center.notify({\n\t\t\t\tcontent: response.errors[0].message,\n\t\t\t\tautoHideDelay: 5000,\n\t\t\t});\n\n\t\t\t// so that on error returned promise is marked as rejected\n\t\t\tthrow response;\n\t\t}).finally(() => {\n\t\t\tthis.#loadingPromise = null;\n\t\t});\n\n\t\treturn this.#loadingPromise;\n\t}\n\n\t#getSaveActionData(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tvoid this.#getSaveActionDataSettings().then((settings) => {\n\t\t\t\tconst userData = this.#layoutComponent.getData();\n\t\t\t\tconst data = {\n\t\t\t\t\townerTypeId: this.#ownerTypeId,\n\t\t\t\t\townerId: this.#ownerId,\n\t\t\t\t\ttitle: userData.title,\n\t\t\t\t\tdescription: userData.description,\n\t\t\t\t\tresponsibleId: userData.responsibleUserId,\n\t\t\t\t\tdeadline: DateTimeFormat.format(DatetimeConverter.getSiteDateTimeFormat(), userData.deadline),\n\t\t\t\t\tparentActivityId: this.#parentActivityId,\n\t\t\t\t\tsettings,\n\t\t\t\t\tpingOffsets: userData.pingOffsets,\n\t\t\t\t\tcolorId: userData.colorId,\n\t\t\t\t};\n\n\t\t\t\tif (this.#mode === TodoEditorMode.UPDATE)\n\t\t\t\t{\n\t\t\t\t\tdata.id = this.#activityId;\n\t\t\t\t}\n\t\t\t\telse if (this.#mode === TodoEditorMode.COPY)\n\t\t\t\t{\n\t\t\t\t\tdata.isCopy = true;\n\t\t\t\t}\n\n\t\t\t\tresolve(data);\n\t\t\t});\n\t\t});\n\t}\n\n\t#getSaveActionPath(): String\n\t{\n\t\treturn (this.#mode === TodoEditorMode.UPDATE ? 'crm.activity.todo.update' : 'crm.activity.todo.add');\n\t}\n\n\t#getSaveActionDataSettings(): Promise\n\t{\n\t\tconst result = this.#layoutComponent.getExecutedBlocksData();\n\n\t\treturn Promise.resolve(result);\n\t}\n\n\t#getBlocks(): BlockSettings[]\n\t{\n\t\treturn [\n\t\t\tthis.#getCalendarBlockSettings(),\n\t\t\tthis.#getClientBlockSettings(),\n\t\t\tthis.#getLinkBlockSettings(),\n\t\t\tthis.#getFileBlockSettings(),\n\t\t\tthis.#getAddressBlockSettings(),\n\t\t];\n\t}\n\n\t#getCalendarBlockSettings(): BlockSettings\n\t{\n\t\treturn {\n\t\t\tid: TodoEditorBlocksCalendar.methods.getId(),\n\t\t\ttitle: Loc.getMessage('CRM_ACTIVITY_TODO_CALENDAR_BLOCK_TITLE'),\n\t\t\ticon: 'crm-activity__todo-editor-v2_calendar-icon.svg',\n\t\t\tsettings: this.#calendarSettings,\n\t\t};\n\t}\n\n\t#getClientBlockSettings(): BlockSettings\n\t{\n\t\treturn {\n\t\t\tid: TodoEditorBlocksClient.methods.getId(),\n\t\t\ttitle: Loc.getMessage('CRM_ACTIVITY_TODO_CLIENT_BLOCK_TITLE'),\n\t\t\ticon: 'crm-activity__todo-editor-v2_client-icon.svg',\n\t\t\tsettings: {\n\t\t\t\tentityTypeId: this.#ownerTypeId,\n\t\t\t\tentityId: this.#ownerId,\n\t\t\t},\n\t\t};\n\t}\n\n\t#getLinkBlockSettings(): BlockSettings\n\t{\n\t\treturn {\n\t\t\tid: TodoEditorBlocksLink.methods.getId(),\n\t\t\ttitle: Loc.getMessage('CRM_ACTIVITY_TODO_LINK_BLOCK_TITLE'),\n\t\t\ticon: 'crm-activity__todo-editor-v2_link-icon.svg',\n\t\t};\n\t}\n\n\t#getFileBlockSettings(): BlockSettings\n\t{\n\t\treturn {\n\t\t\tid: TodoEditorBlocksFile.methods.getId(),\n\t\t\ttitle: Loc.getMessage('CRM_ACTIVITY_TODO_FILE_BLOCK_TITLE'),\n\t\t\ticon: 'crm-activity__todo-editor-v2_file-icon.svg',\n\t\t\tsettings: {\n\t\t\t\tentityTypeId: this.#ownerTypeId,\n\t\t\t\tentityId: this.#ownerId,\n\t\t\t},\n\t\t};\n\t}\n\n\t#getAddressBlockSettings(): BlockSettings\n\t{\n\t\treturn {\n\t\t\tid: TodoEditorBlocksAddress.methods.getId(),\n\t\t\ttitle: Loc.getMessage('CRM_ACTIVITY_TODO_ADDRESS_BLOCK_TITLE'),\n\t\t\ticon: 'crm-activity__todo-editor-v2_address-icon.svg',\n\t\t\tsettings: {\n\t\t\t\tentityTypeId: this.#ownerTypeId,\n\t\t\t\tentityId: this.#ownerId,\n\t\t\t},\n\t\t};\n\t}\n\n\tgetDeadline(): ?Date\n\t{\n\t\treturn this.#layoutComponent?.getData()['deadline'] ?? null;\n\t}\n\n\tgetDescription(): String\n\t{\n\t\treturn this.#layoutComponent?.getData()['description'] ?? '';\n\t}\n\n\tsetParentActivityId(activityId: Number): TodoEditorV2\n\t{\n\t\tthis.#parentActivityId = activityId;\n\n\t\treturn this;\n\t}\n\n\tsetActivityId(activityId: ?Number): TodoEditorV2\n\t{\n\t\tthis.#activityId = activityId;\n\n\t\treturn this;\n\t}\n\n\tsetCurrentUser(currentUser: Object): TodoEditorV2\n\t{\n\t\tthis.#currentUser = Object;\n\n\t\treturn this;\n\t}\n\n\tsetDeadline(deadLine: String): TodoEditorV2\n\t{\n\t\tconst value = DateTimeFormat.parse(deadLine);\n\t\tif (Type.isDate(value))\n\t\t{\n\t\t\tthis.#layoutComponent.setDeadline(value);\n\t\t\tthis.#deadline = value;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tsetDefaultDeadLine(isNeedUpdateLayout: Boolean = true): TodoEditorV2\n\t{\n\t\t// eslint-disable-next-line @bitrix24/bitrix24-rules/no-bx\n\t\tlet defaultDate = BX.parseDate(Loc.getMessage('CRM_TIMELINE_TODO_EDITOR_DEFAULT_DATETIME'));\n\t\tif (Type.isDate(defaultDate))\n\t\t{\n\t\t\tthis.#deadline = defaultDate;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#deadline = new Date();\n\t\t\tthis.#deadline.setMinutes(0);\n\t\t\tthis.#deadline.setTime(this.#deadline.getTime() + 60 * 60 * 1000); // next hour\n\t\t}\n\n\t\tif (isNeedUpdateLayout)\n\t\t{\n\t\t\tthis.#layoutComponent.setDeadline(this.#deadline);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tsetFocused(): void\n\t{\n\t\tthis.#layoutComponent.setTextareaFocused();\n\t}\n\n\tsetDescription(description: String): TodoEditorV2\n\t{\n\t\tthis.#layoutComponent.setDescription(description);\n\n\t\treturn this;\n\t}\n\n\tclearValue(): Promise\n\t{\n\t\tthis.#parentActivityId = null;\n\n\t\treturn this.#clearData();\n\t}\n\n\tresetToDefaults(): Promise\n\t{\n\t\tthis.#layoutComponent.setDescription(this.#getDefaultDescription());\n\n\t\treturn this.#clearData();\n\t}\n\n\t#clearData(): Promise\n\t{\n\t\tthis.setDefaultDeadLine();\n\t\tthis.setMode(TodoEditorMode.ADD);\n\n\t\tthis.#layoutComponent.setWasUsed(false);\n\t\tthis.#layoutComponent.resetTitleAndDescription();\n\t\tthis.#layoutComponent.resetPingOffsetsToDefault();\n\t\tthis.#layoutComponent.resetResponsibleUserToDefault();\n\t\tthis.#layoutComponent.resetColorSelectorToDefault();\n\t\tthis.#layoutComponent.resetCurrentActivityId();\n\n\t\tDom.removeClass(this.#container, '--is-edit');\n\n\t\tthis.#layoutComponent.closeBlocks();\n\n\t\treturn new Promise((resolve) => {\n\t\t\tsetTimeout(resolve, 10);\n\t\t});\n\t}\n\n\t#getDefaultTitle(): String\n\t{\n\t\treturn Loc.getMessage('CRM_ACTIVITY_TODO_ADD_TITLE_DEFAULT');\n\t}\n\n\t#getDefaultDescription(): String\n\t{\n\t\tlet messagePhrase = 'CRM_ACTIVITY_TODO_NOTIFICATION_DEFAULT_TEXT';\n\t\tswitch (this.#ownerTypeId)\n\t\t{\n\t\t\tcase BX.CrmEntityType.enumeration.deal:\n\t\t\t\tmessagePhrase = 'CRM_ACTIVITY_TODO_NOTIFICATION_DEFAULT_TEXT_DEAL';\n\t\t}\n\n\t\treturn Loc.getMessage(messagePhrase);\n\t}\n\n\t#onInputFocus(): void\n\t{\n\t\tDom.addClass(this.#container, '--is-edit');\n\t\tthis.#eventEmitter.emit('onFocus');\n\t}\n\n\t#onSaveHotkeyPressed(): void\n\t{\n\t\tthis.#eventEmitter.emit('onSaveHotkeyPressed');\n\t}\n\n\t#isValidBorderColor(borderColor: string): boolean\n\t{\n\t\treturn Type.isString(borderColor) && TodoEditorV2.BorderColor[borderColor.toUpperCase()];\n\t}\n\n\t#getClassname(): string\n\t{\n\t\treturn `crm-activity__todo-editor-v2 --border-${this.#borderColor}`;\n\t}\n}\n"],"names":["InputPopup","params","bindElement","title","buttonTitle","Type","isStringFilled","addressJson","Address","JSON","parse","addressFormatted","onSubmit","onClickHandler","bind","onKeyUpHandler","show","setTimeout","focus","destroy","widgetFactory","Factory","createAddressWidget","address","mode","ControlMode","edit","subscribeOnAddressChangedEvent","event","data","getData","isObject","addressWidgetParams","inputNode","mapBindElement","fieldsContainer","controlWrapper","render","close","keyCode","Popup","id","Text","getRandom","content","closeByEsc","closeIcon","draggable","width","padding","events","onFirstShow","initAddress","Tag","encode","TodoEditorBlocksAddress","props","type","String","required","icon","settings","Object","filledValues","context","isFocused","Boolean","emits","getPreparedData","mounted","$nextTick","onShowAddressPopup","beforeUnmount","inputPopup","methods","getId","format","Format","Loc","getMessage","addressInstance","languageId","setFieldValue","fieldForUnRecognized","toString","replaceAll","toJson","getExecutedData","emitUpdateFilledValues","newFilledValues","$emit","isNil","$refs","$Bitrix","value","setAddress","computed","encodedTitle","iconStyles","path","background","encodeURI","actionTitle","hasAddress","changeTitle","addTitle","preparedAddress","created","$watch","deep","template","DEFAULT_TAB_ID","LocationSelector","locationId","Number","forceShowLocationSelectorDialog","locations","fetchRoomsManagerData","showLocationSelectorDialog","getLocationSelectorDialog","locationSelectorDialog","tabs","items","rooms","forEach","room","push","ID","NAME","subtitle","getCapacityTitle","CAPACITY","entityId","avatarOptions","bgColor","COLOR","bgSize","bgImage","customData","LOCATION_ID","Dialog","targetNode","locationSelector","multiple","dropdownMode","showAvatars","enableSearch","height","zIndex","onSelectLocation","onDeselectLocation","Promise","resolve","Ajax","runAction","then","response","catch","errors","console","log","emitChangeEvent","item","action","getLocationById","find","location","blockTitle","locationsListTitle","selectedLocationTitle","hasSelectedLocation","isNumber","TodoEditorBlocksCalendar","components","ownerId","selectedUserIds","Set","add","timestamp","from","Timezone","UserTime","getTimestamp","millisecondsInFiveMinutes","Math","ceil","duration","to","plannerInstance","showLocation","timezoneName","eventEmitter","subscribe","Events","EVENT_RESPONSIBLE_USER_CHANGE","onResponsibleUserChange","EVENT_DEADLINE_CHANGE","onDeadlineChange","showPlanner","getPlanner","selector","handlePlannerSelectorChanges","userIds","selectedUsersIdsArray","prepareUpdatePlannerData","updatePlanner","showUserSelector","showUserSelectorDialog","unsubscribe","attendeesEntityList","values","filter","split","timezoneFrom","Planner","wrap","plannerContainer","compactMode","showEntryName","minWidth","minHeight","entryTimezone","newUserIds","oldUserIds","entityList","dateFrom","getFormattedDate","dateTo","timezone","entries","prevUserList","userId","entityType","showLoader","accessibility","roomId","hideLoader","update","onDataUpdate","error","updatePlannerSelector","emit","EVENT_CALENDAR_CHANGE","createDateInstance","updateSelector","startOfDay","Date","now","date","setHours","getFormattedValue","DateTimeFormat","getFormat","getUserSelectorDialog","userSelectorDialog","preselectedItems","undeselectedItems","userSelector","entities","onSelectUser","onDeselectUser","delete","getSelectedUserIds","responsibleUserId","deadline","getTime","updateSettings","onCloseLocationBlock","prepareDataOnBlockConstruct","currentDeadline","usersList","newOwnerId","oldOwnerId","has","newSettings","oldSettings","watch","newLocationId","oldLocationId","TodoEditorBlocksClient","selectedClients","isFetchedConfig","clients","fetchConfig","subscribeToReceiversChanges","entityTypeId","isAvailable","EventEmitter","onReceiversChanged","onShowAddClientPhoneSelector","addClientsSelector","getClientSelectorEntities","onAddClient","isOpen","hide","setTargetNode","isClientBindingInProgress","preventDefault","BX","CrmEntityType","resolveId","isBound","bindClient","Crm","EntityEditor","getDefault","reload","clientId","clientTypeId","ajaxParams","isArrayFilled","length","showNotify","message","UI","Notification","Center","notify","onShowClientSelector","clientSelector","clientsContainer","ClientSelector","createFromItems","onSelect","onSelectClient","onDeselect","onDeselectClient","availableSelectedClients","setSelectedItemByEntityData","contact","dynamicLoad","dynamicSearch","options","showTab","showPhones","showMails","hideReadMoreLink","company","excludeMyCompany","enumeration","get","client","force","ajaxParameters","size","onShowClient","SidePanel","Instance","open","window","top","href","getClientTitleFormatted","showComma","clientInfo","getClientInfo","comma","hasClients","MAX_UPLOAD_FILE_SIZE","TodoEditorBlocksFile","TileWidgetComponent","fileTokens","needShowLoaderPopup","localStorage","onShowUploaderPopup","deleteFilesFromServerWhenDestroy","isArray","getFileTokenList","fileBody","querySelector","click","reset","tokens","uploader","getFiles","file","isComplete","getServerFileId","hasFileTokens","uploaderOptions","controller","controllerOptions","activityId","files","onUploadComplete","autoUpload","maxFileSize","widgetOptions","adapter","setRemoveFilesFromServerWhenDestroy","_classPrivateMethodInitSpec","_classPrivateFieldInitSpec","placeholder","_classPrivateMethodGet","TodoEditorBlocksLink","link","onShowLinkPopup","onLinkClick","a","document","createElement","target","Dom","append","body","remove","setLink","setValue","hasLink","BlockFactory","Error","DEFAULT_COLOR_ID","TodoEditorColorSelector","directives","hint","valuesList","selectedValueId","default","currentValueId","getValue","resetToDefault","itemSelector","onColorSelectorValueChange","text","popupOptions","angle","offset","position","offsetTop","ColorSelector","itemSelectorRef","colorList","selectedColorId","ColorSelectorEvents","EVENT_COLORSELECTOR_VALUE_CHANGE","TodoEditorPingSelector","Array","selectedValues","ItemSelector","container","CompactIcons","BELL","TodoEditorResponsibleUserSelector","userName","imageUrl","userAvatarUrl","userIconClassName","userIconStyles","backgroundImage","backgroundSize","selectedItem","getDialog","getSelectedItems","getAvatar","selectedItems","showUserDialog","defaultUserItem","getItem","select","TEXTAREA_MAX_HEIGHT","ADD_MODE","EVENT_ACTIONS_POPUP_ITEM_CLICK","EVENT_UPDATE_CLICK","EVENT_REPEAT_CLICK","CALENDAR_BLOCK_ID","TodoEditor","onFocus","Function","onSaveHotkeyPressed","defaultTitle","defaultDescription","popupMode","currentUser","pingSettings","copilotSettings","colorSettings","actionsPopup","blocks","isCopilotEnabled","isPlainObject","calendarDateTo","Runtime","clone","getHours","blocksData","keys","blockId","prepareBlockDataWithEditorParams","currentActivityId","description","pingOffsets","colorId","isTextareaToLong","wasUsed","modeData","currentUserData","deadlineFormatted","converter","DatetimeConverter","toDatetimeString","withDayOfWeek","delimiter","calendarBlock","getBlockDataById","active","toTimeString","placeholderDescription","code","placeholderTitle","popupMenuButtonTitle","orderedBlocksData","sort","b","style","textarea","currentTextareaHeight","scrollHeight","prepareBlockData","blockData","isBoolean","blockInstance","getInstance","isFunction","setData","setPingOffsets","pingSelector","colorSelector","setMode","resetCurrentActivityId","setBlockFilledValues","setBlockActive","resetTitleAndDescription","setTitle","setDescription","onTextareaFocus","setWasUsed","onTextareaKeydown","isMacCtrlKeydown","Browser","isMac","metaKey","altKey","ctrlKey","setTextareaFocused","onDeadlineClick","calendar","node","bTime","bHideTime","bSetFocus","getSiteDateTimeFormat","callback","setDeadline","setResponsibleUserId","onCalendarChange","offsets","resetPingOffsetsToDefault","resetResponsibleUserToDefault","resetColorSelectorToDefault","isString","trim","onTitleInput","onTextareaInput","onActionsPopupItemClick","componentId","componentParams","actionId","block","focused","getBlockDataFromPropsById","getNextBlockSortValue","maxSortValue","onCopilotTextareaValueChange","copilotId","copilotTextarea","showActionsPopup","onBlockCloseClick","resetBlock","closeBlocks","getExecutedBlocksData","getBlockComponentName","charAt","toUpperCase","slice","updateFilledValues","CopilotTextarea","copilotParams","CopilotTextareaEvents","EVENT_VALUE_CHANGE","DELIMITER_TYPE","ActionsPopup","onClick","MenuManager","create","autoHide","offsetLeft","result","itemData","hidden","svgData","messageCode","html","onclick","onItemClick","encodeURIComponent","TodoEditorBorderColor","TodoEditorMode","ADD","UPDATE","COPY","TodoEditorV2","onUpdateHandler","onRepeatHandler","includes","BitrixVue","createApp","TodoEditorComponent","mount","canShowPrefilledComponent","menuBar","Timeline","MenuBar","setActiveItemById","entityData","setActivityId","setCurrentUser","setDefaultDeadLine","reject","autoHideDelay","finally","deadLine","isDate","isNeedUpdateLayout","defaultDate","parseDate","setMinutes","setTime","isDomNode","ownerTypeId","TypeError","isObjectLike","calendarSettings","borderColor","BorderColor","DEFAULT","actionMenuSettings","hiddenActionItems","addClass","setEventNamespace","eventName","hasClass","Dialogs","MessageBox","modal","buttons","MessageBoxButtons","OK_CANCEL","okCaption","onOk","messageBox","onCancel","setFocused","clearValue","scrollTo","behavior","userData","responsibleId","parentActivityId","isCopy","removeClass","messagePhrase","deal"],"mappings":"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"}