this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};(function(e,t,i,s,l,a,r,n){"use strict";let o=e=>e,c,d,b;function h(e,t){u(e,t);t.add(e)}function v(e,t,i){u(e,t);t.set(e,i)}function u(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function p(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var P=new WeakMap;var H=new WeakMap;var F=new WeakMap;var f=new WeakMap;var w=new WeakMap;var S=new WeakMap;var G=new WeakMap;var g=new WeakMap;var m=new WeakMap;var y=new WeakMap;var T=new WeakMap;var k=new WeakMap;var B=new WeakSet;var W=new WeakSet;var E=new WeakSet;var A=new WeakSet;var M=new WeakSet;var I=new WeakSet;var C=new WeakSet;var D=new WeakSet;var X=new WeakSet;var L=new WeakSet;var _=new WeakSet;var j=new WeakSet;let z=function(){function e(t,i,a,r,n){var o;babelHelpers.classCallCheck(this,e);h(this,j);h(this,_);h(this,L);h(this,X);h(this,D);h(this,C);h(this,I);h(this,M);h(this,A);h(this,E);h(this,W);h(this,B);v(this,P,{writable:true,value:null});v(this,H,{writable:true,value:null});v(this,F,{writable:true,value:null});v(this,f,{writable:true,value:null});v(this,w,{writable:true,value:null});v(this,S,{writable:true,value:null});v(this,G,{writable:true,value:false});v(this,g,{writable:true,value:null});v(this,m,{writable:true,value:null});v(this,y,{writable:true,value:null});v(this,T,{writable:true,value:null});v(this,k,{writable:true,value:null});babelHelpers.classPrivateFieldSet(this,P,s.Text.toInteger(i));babelHelpers.classPrivateFieldSet(this,H,s.Text.toInteger(t));babelHelpers.classPrivateFieldSet(this,F,a);babelHelpers.classPrivateFieldSet(this,k,new l.EventEmitter);babelHelpers.classPrivateFieldGet(this,k).setEventNamespace("Crm.Activity.AddingPopup");if(s.Type.isObject(r)){var c,d,b;babelHelpers.classPrivateFieldSet(this,f,(c=r.pingSettings)!==null&&c!==void 0?c:null);babelHelpers.classPrivateFieldSet(this,w,(d=r.calendarSettings)!==null&&d!==void 0?d:null);babelHelpers.classPrivateFieldSet(this,S,(b=r.colorSettings)!==null&&b!==void 0?b:null)}if(!s.Type.isPlainObject(n)){n={}}if(s.Type.isObject(n.events)){for(const e in n.events){if(s.Type.isFunction(n.events[e])){babelHelpers.classPrivateFieldGet(this,k).subscribe(e,n.events[e])}}}babelHelpers.classPrivateFieldSet(this,G,(o=n.useTodoEditorV2)!==null&&o!==void 0?o:null)}babelHelpers.createClass(e,[{key:"show",value:function e(t,l=i.TodoEditorMode.ADD){const a=p(this,A,O).call(this);if(!babelHelpers.classPrivateFieldGet(this,G)){a.setBindElement(t)}if(a.isShown()){return}if(!babelHelpers.classPrivateFieldGet(this,y).hasChildNodes()){p(this,B,x).call(this);a.setButtons([new r.SaveButton({id:"save",color:r.ButtonColor.PRIMARY,size:r.ButtonSize.EXTRA_SMALL,round:true,events:{click:p(this,C,V).bind(this)}}),new r.CancelButton({id:"cancel",size:r.ButtonSize.EXTRA_SMALL,round:true,events:{click:()=>a.close()}})]);a.subscribeOnce("onFirstShow",(e=>{e.target.getZIndexComponent().setZIndex(1400);babelHelpers.classPrivateFieldGet(this,T).show()}));a.subscribe("onAfterShow",(()=>{p(this,D,Y).call(this,babelHelpers.classPrivateFieldGet(this,T).getDescription());babelHelpers.classPrivateFieldGet(this,T).setFocused()}));a.subscribe("onAfterClose",(()=>{void babelHelpers.classPrivateFieldGet(this,T).resetToDefaults().then((()=>{babelHelpers.classPrivateFieldGet(this,k).emit("onClose")}))}));a.subscribe("onShow",(()=>{const{mode:e,activity:t}=a.params;if(e===i.TodoEditorMode.UPDATE&&t){babelHelpers.classPrivateFieldGet(this,T).setMode(e).setActivityId(t.id).setDescription(t.description).setDeadline(t.deadline);if(s.Type.isArrayFilled(t.storageElementIds)){babelHelpers.classPrivateFieldGet(this,T).setStorageElementIds(t.storageElementIds)}}}))}p(this,W,U).call(this,a,l)}},{key:"bindPopup",value:function e(t){if(!babelHelpers.classPrivateFieldGet(this,g)||babelHelpers.classPrivateFieldGet(this,G)){return}if(t!==babelHelpers.classPrivateFieldGet(this,g).bindElement){babelHelpers.classPrivateFieldGet(this,g).setBindElement(t)}}}]);return e}();function x(){const e={container:babelHelpers.classPrivateFieldGet(this,y),ownerTypeId:babelHelpers.classPrivateFieldGet(this,H),ownerId:babelHelpers.classPrivateFieldGet(this,P),currentUser:babelHelpers.classPrivateFieldGet(this,F),pingSettings:babelHelpers.classPrivateFieldGet(this,f),events:{onSaveHotkeyPressed:p(this,L,q).bind(this),onChangeUploaderContainerSize:p(this,_,J).bind(this),onFocus:p(this,j,K).bind(this)},popupMode:true};if(babelHelpers.classPrivateFieldGet(this,G)){e.calendarSettings=babelHelpers.classPrivateFieldGet(this,w);e.colorSettings=babelHelpers.classPrivateFieldGet(this,S);e.defaultDescription="";babelHelpers.classPrivateFieldSet(this,T,new i.TodoEditorV2(e))}else{e.events.onChangeDescription=p(this,X,Z).bind(this);babelHelpers.classPrivateFieldSet(this,T,new t.TodoEditor(e))}}function U(e,t=i.TodoEditorMode.ADD){e.params.mode=t;if(t===i.TodoEditorMode.ADD){e.show();return}if(t===i.TodoEditorMode.UPDATE){void p(this,E,N).call(this).then((t=>{if(t){e.params.activity=t;e.show()}}));return}console.error("Wrong TodoEditor mode")}function N(){const e={ownerTypeId:babelHelpers.classPrivateFieldGet(this,H),ownerId:babelHelpers.classPrivateFieldGet(this,P)};return new Promise(((t,i)=>{s.ajax.runAction("crm.activity.todo.getNearest",{data:e}).then((({data:e})=>t(e))).catch((e=>{n.UI.Notification.Center.notify({content:e.errors[0].message,autoHideDelay:5e3});i()}))}))}function O(){if(!babelHelpers.classPrivateFieldGet(this,g)||babelHelpers.classPrivateFieldGet(this,g).isDestroyed()){babelHelpers.classPrivateFieldSet(this,y,s.Tag.render(c||(c=o`<div></div>`)));babelHelpers.classPrivateFieldSet(this,m,s.Tag.render(d||(d=o`
				<div class="crm-activity-adding-popup-container">
					${0}
					${0}
				</div>
			`),p(this,M,R).call(this),babelHelpers.classPrivateFieldGet(this,y)));babelHelpers.classPrivateFieldSet(this,g,new a.Popup(p(this,I,$).call(this)))}return babelHelpers.classPrivateFieldGet(this,g)}function R(){if(babelHelpers.classPrivateFieldGet(this,G)){return s.Tag.render(b||(b=o`
				<div class="crm-activity-adding-popup-title">
					${0}
				</div>
			`),s.Loc.getMessage("CRM_ACTIVITY_ADDING_POPUP_TITLE"))}return null}function $(){const{innerWidth:e}=window;const t={id:`kanban_planner_menu_${babelHelpers.classPrivateFieldGet(this,P)}`,content:babelHelpers.classPrivateFieldGet(this,m),cacheable:false,isScrollBlock:true,className:"crm-activity-adding-popup",closeByEsc:true,closeIcon:false,padding:16,minWidth:537,width:Math.round(e*.45),maxWidth:737,minHeight:150,maxHeight:482};if(babelHelpers.classPrivateFieldGet(this,G)){t.overlay={opacity:50}}else{t.angle={offset:27}}return t}function V(){if(babelHelpers.classPrivateFieldGet(this,g)){const e=babelHelpers.classPrivateFieldGet(this,g).getButton("save");if(e.getState()){return}e===null||e===void 0?void 0:e.setWaiting(true);babelHelpers.classPrivateFieldGet(this,T).save().then((()=>{babelHelpers.classPrivateFieldGet(this,g).close();babelHelpers.classPrivateFieldGet(this,k).emit("onSave")})).catch((()=>{})).finally((()=>e===null||e===void 0?void 0:e.setWaiting(false)))}}function Y(e){if(babelHelpers.classPrivateFieldGet(this,g)&&babelHelpers.classPrivateFieldGet(this,g).isShown()){babelHelpers.classPrivateFieldGet(this,k).emit("onActualizePopupLayout",{entityId:babelHelpers.classPrivateFieldGet(this,P)});babelHelpers.classPrivateFieldGet(this,g).adjustPosition({forceBindPosition:true});const t=babelHelpers.classPrivateFieldGet(this,g).getButton("save");if(babelHelpers.classPrivateFieldGet(this,G)){return}if(e.length===0&&t&&!t.getState()){t.setState(r.ButtonState.DISABLED)}else if(e.length>0&&t&&t.getState()===r.ButtonState.DISABLED){t.setState(null)}}}function Z(e){const{description:t}=e.getData();p(this,D,Y).call(this,t)}function q(){p(this,C,V).call(this)}function J(){if(babelHelpers.classPrivateFieldGet(this,g)){babelHelpers.classPrivateFieldGet(this,k).emit("onActualizePopupLayout",{entityId:babelHelpers.classPrivateFieldGet(this,P)});babelHelpers.classPrivateFieldGet(this,g).adjustPosition()}}function K(){setTimeout((()=>{const e=p(this,A,O).call(this);e.adjustPosition({forceBindPosition:true})}),0)}e.AddingPopup=z})(this.BX.Crm.Activity=this.BX.Crm.Activity||{},BX.Crm.Activity,BX.Crm.Activity,BX,BX.Event,BX.Main,BX.UI,BX);
//# sourceMappingURL=adding-popup.bundle.map.js