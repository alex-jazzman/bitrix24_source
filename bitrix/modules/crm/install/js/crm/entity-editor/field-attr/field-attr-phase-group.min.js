BX.namespace("BX.Crm");if(typeof BX.Crm.EntityFieldAttributePhaseGroup==="undefined"){BX.Crm.EntityFieldAttributePhaseGroup=function(){this._id="";this._settings=null;this._phases=null;this._phaseGroupTypeId=BX.UI.EntityFieldAttributePhaseGroupType.undefined;this._title="";this._isReadOnly=false;this._configurator=null;this._container=null;this._phaseCheckBoxes=null};BX.Crm.EntityFieldAttributePhaseGroup.prototype={initialize:function(e,t){this._id=BX.type.isNotEmptyString(e)?e:BX.util.getRandomString(4);this._settings=t?t:{};this._phases=BX.prop.getArray(this._settings,"phases",[]);this._phaseGroupTypeId=BX.prop.getInteger(this._settings,"phaseGroupTypeId",BX.UI.EntityFieldAttributePhaseGroupType.undefined);this._isReadOnly=BX.prop.getBoolean(this._settings,"isReadOnly",false);this._title=BX.prop.getString(this._settings,"title",this._id);this._configurator=BX.prop.get(this._settings,"configurator",null);this._container=BX.prop.getElementNode(this._settings,"container",null)},getId:function(){return this._id},getPhaseGroupTypeId:function(){return this._phaseGroupTypeId},isReadOnly:function(){return this._isReadOnly},isSelected:function(){for(var e=0,t=this._phaseCheckBoxes.length;e<t;e++){if(this._phaseCheckBoxes[e].checked){return true}}return false},isFullySelected:function(){for(var e=0,t=this._phaseCheckBoxes.length;e<t;e++){if(!this._phaseCheckBoxes[e].checked){return false}}return true},setSelected:function(e){e=!!e;for(var t=0,i=this._phaseCheckBoxes.length;t<i;t++){this._phaseCheckBoxes[t].checked=e}},applyConfiguration:function(e){this.setSelected(false);var t=BX.prop.getArray(e,"groups",[]);for(var i=0,s=t.length;i<s;i++){var r=t[i];var h=BX.prop.getArray(r,"items",[]);var n=BX.prop.getInteger(r,"phaseGroupTypeId",BX.UI.EntityFieldAttributePhaseGroupType.undefined);if(n===BX.UI.EntityFieldAttributePhaseGroupType.undefined&&h.length>0){n=this._configurator.resolvePhaseGroupType(BX.prop.getString(h[0],"startPhaseId",""))}if(n===BX.UI.EntityFieldAttributePhaseGroupType.general){this.setSelected(true)}else if(n===this._phaseGroupTypeId&&h.length>0){var a;if(this._phaseGroupTypeId===BX.UI.EntityFieldAttributePhaseGroupType.pipeline){var p=[];for(a=0,itemQty=h.length;a<itemQty;a++){var o=BX.prop.getString(h[a],"startPhaseId","");var c=BX.prop.getString(h[a],"finishPhaseId","");if(BX.Type.isStringFilled(o)&&BX.Type.isStringFilled(c)){var l=false;var u=false;var d=[];var f;for(f=0;f<this._phases.length;f++){if(!l&&this._phases[f]["id"]===o){l=true}if(l&&!u){d.push(this._phases[f]["id"]);if(this._phases[f]["id"]===c){u=true}}}if(l&&u){for(f=0;f<d.length;f++){if(p.indexOf(d[f])<0){p.push(d[f])}}}}}for(f=0;f<p.length;f++){this.selectPhaseCheckBox(p[f])}}else if(this._phaseGroupTypeId===BX.UI.EntityFieldAttributePhaseGroupType.junk){for(a=0,itemQty=h.length;a<itemQty;a++){this.selectPhaseCheckBox(BX.prop.getString(h[a],"startPhaseId",""))}}}}},acceptChanges:function(e){var t,i,s;var r=[];if(this._phaseGroupTypeId===BX.UI.EntityFieldAttributePhaseGroupType.pipeline){var h;var n;var a=false;var p="";var o="";var c=this._phaseCheckBoxes.length-1;for(t=0;t<=c;t++){h=this._phaseCheckBoxes[t].checked;n=t===c?false:this._phaseCheckBoxes[t+1].checked;if(!a&&h){a=true;p=this._phaseCheckBoxes[t]["id"]}if(a&&!n){a=false;o=this._phaseCheckBoxes[t]["id"];r.push({startPhaseId:p,finishPhaseId:o})}}}else if(this._phaseGroupTypeId===BX.UI.EntityFieldAttributePhaseGroupType.junk){for(t=0,i=this._phaseCheckBoxes.length;t<i;t++){s=this._phaseCheckBoxes[t];if(!s.checked){continue}r.push({startPhaseId:s["id"],finishPhaseId:s["id"]})}}if(r.length>0){e["groups"].push({phaseGroupTypeId:this._phaseGroupTypeId,items:r})}},getContainer:function(){return this._container},setContainer:function(e){this._container=e},createPhaseCheckBox:function(e){if(!this._phaseCheckBoxes){this._phaseCheckBoxes=[]}var t=BX.create("input",{props:{id:e,type:"checkbox"},events:{click:BX.delegate(this.onCheckBoxClick,this)}});this._phaseCheckBoxes.push(t);return t},findCheckBox:function(e){for(var t=0,i=this._phaseCheckBoxes.length;t<i;t++){var s=this._phaseCheckBoxes[t];if(s["id"]===e){return s}}return null},selectPhaseCheckBox:function(e){var t=this.findCheckBox(e);if(!t){return}t.checked=true;this.processCheckBoxChange(t,false)},layout:function(){if(!this._container){return}this._phaseCheckBoxes=[];if(this._title!==""){this._container.appendChild(BX.create("div",{props:{className:"crm-entity-popup-field-addiction-steps-list-title"},children:[BX.create("div",{props:{className:"crm-entity-popup-field-addiction-steps-list-title-line"}}),BX.create("div",{props:{className:"crm-entity-popup-field-addiction-steps-list-title-text"},text:this._title}),BX.create("div",{props:{className:"crm-entity-popup-field-addiction-steps-list-title-line"}})]}))}var e=BX.Crm.EntityPhaseLayout.getCurrent();var t=BX.create("div",{props:{className:"crm-entity-popup-field-addiction-steps-list"}});for(var i=0,s=this._phases.length;i<s;i++){var r=this._phases[i];var h=BX.create("label",{props:{className:"crm-entity-popup-field-addiction-step-item"},children:[this.createPhaseCheckBox(r["id"]),BX.create("span",{props:{className:"crm-entity-popup-field-addiction-step-item-text"},text:r["name"]})]});var n=BX.prop.getString(r,"color","");if(n===""){var a=BX.prop.getString(r,"semantics","");if(a!==""){n=e.getBackgroundColor(a)}}if(n!==""){h.style.backgroundColor=n;h.style.color=e.calculateTextColor(n)}else{BX.addClass(h,"crm-entity-popup-field-addiction-step-item-default")}t.appendChild(h)}this._container.appendChild(t)},onCheckBoxClick:function(e){this.processCheckBoxChange(BX.getEventTarget(e),true)},processCheckBoxChange:function(e,t){if(this._isReadOnly){e.checked=!e.checked}if(t){this._configurator.processGroupChange(this)}}};BX.Crm.EntityFieldAttributePhaseGroup.create=function(e,t){var i=new BX.Crm.EntityFieldAttributePhaseGroup;i.initialize(e,t);return i}}
//# sourceMappingURL=field-attr-phase-group.map.js