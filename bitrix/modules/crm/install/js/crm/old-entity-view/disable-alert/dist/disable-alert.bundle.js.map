{"version":3,"file":"disable-alert.bundle.js","sources":["../src/disable-alert.js"],"sourcesContent":["import { Loc, Event, Type, Tag, Text } from 'main.core';\nimport { MessageBox } from 'ui.dialogs.messagebox';\nimport { UI } from 'ui.notification';\nimport { Button } from 'ui.buttons';\nimport { Router } from 'crm.router';\nimport 'ui.design-tokens';\nimport 'ui.design-tokens.air';\nimport './disable-alert.css';\n\nexport type DisableAlertOptions = {\n\talertContainer: HTMLElement,\n\tdaysUntilDisable: number,\n\tisAdmin: boolean,\n\tlastTimeShownField: string,\n\tlastTimeShownOptionName: string,\n\tpreviewHref: string,\n};\n\nexport class DisableAlert\n{\n\t#alertContainer: HTMLElement;\n\t#daysUntilDisable: number;\n\t#isAdmin: boolean;\n\t#lastTimeShownField: string;\n\t#lastTimeShownOptionName: string;\n\t#previewHref: string;\n\n\tconstructor(options: DisableAlertOptions): void\n\t{\n\t\tif (!Type.isElementNode(options.alertContainer))\n\t\t{\n\t\t\tthrow new Error('OldCardLayout.DisableAlert: \\'alertContainer\\' must be a DOM element.');\n\t\t}\n\n\t\tif (!Type.isInteger(options.daysUntilDisable))\n\t\t{\n\t\t\tthrow new TypeError('OldCardLayout.DisableAlert: \\'daysUntilDisable\\' must be integer');\n\t\t}\n\n\t\tif (!Type.isBoolean(options.isAdmin))\n\t\t{\n\t\t\tthrow new TypeError('OldCardLayout.DisableAlert: \\'isAdmin\\' must be boolean');\n\t\t}\n\n\t\tif (!Type.isString(options.lastTimeShownField))\n\t\t{\n\t\t\tthrow new TypeError('OldCardLayout.DisableAlert: \\'lastTimeShownField\\' must be string');\n\t\t}\n\n\t\tif (!Type.isString(options.lastTimeShownOptionName))\n\t\t{\n\t\t\tthrow new TypeError('OldCardLayout.DisableAlert: \\'lastTimeShownOptionName\\' must be string');\n\t\t}\n\n\t\tif (!Type.isString(options.previewHref))\n\t\t{\n\t\t\tthrow new TypeError('OldCardLayout.DisableAlert: \\'previewHref\\' must be string');\n\t\t}\n\n\t\tthis.#alertContainer = options.alertContainer;\n\t\tthis.#daysUntilDisable = options.daysUntilDisable;\n\t\tthis.#isAdmin = options.isAdmin;\n\t\tthis.#lastTimeShownField = options.lastTimeShownField;\n\t\tthis.#lastTimeShownOptionName = options.lastTimeShownOptionName;\n\t\tthis.#previewHref = options.previewHref;\n\t}\n\n\trender(): void\n\t{\n\t\tconst previewButton = new Button({\n\t\t\ttext: Loc.getMessage('CRM_OLD_CARD_LAYOUT_DISABLE_ALERT_SHOW_PREVIEW_TEXT'),\n\t\t\tuseAirDesign: true,\n\t\t\tstyle: Button.AirStyle.OUTLINE,\n\t\t\tsize: Button.Size.SMALL,\n\t\t\tonclick: () => {\n\t\t\t\tRouter.openSlider(this.#previewHref, { allowChangeHistory: false });\n\t\t\t},\n\t\t});\n\n\t\tconst { root, buttonContainer, closeButton } = Tag.render`\n\t\t\t<div class=\"crm-old-layout-disable-alert\">\n\t\t\t\t<div class=\"crm-old-layout-left-part\">\n\t\t\t\t\t<span class=\"crm-old-layout-icon\"></span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"crm-old-layout-right-part\">\n\t\t\t\t\t<h4 class=\"crm-old-layout-title ui-typography-heading-h4\">\n\t\t\t\t\t\t${this.#getTitleText()}\n\t\t\t\t\t</h4>\n\t\t\t\t\t<p class=\"crm-old-layout-text ui-typography-text-md\">\n\t\t\t\t\t\t${this.#getText()}\n\t\t\t\t\t</p>\n\t\t\t\t\t<div class=\"crm-old-layout-buttons\" ref=\"buttonContainer\">\n\t\t\t\t\t\t${previewButton.getContainer()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<button class=\"crm-old-layout-close-button\" ref=\"closeButton\">\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\n\t\tif (this.#isAdmin)\n\t\t{\n\t\t\tconst showConfirmationButton = new Button({\n\t\t\t\ttext: Loc.getMessage('CRM_OLD_CARD_LAYOUT_DISABLE_ALERT_ENABLE_NEW_LAYOUT_TEXT'),\n\t\t\t\tuseAirDesign: true,\n\t\t\t\tstyle: Button.AirStyle.OUTLINE,\n\t\t\t\tsize: Button.Size.SMALL,\n\t\t\t\tonclick: () => {\n\t\t\t\t\tthis.#showConfirmationPopup();\n\t\t\t\t},\n\t\t\t});\n\t\t\tshowConfirmationButton.renderTo(buttonContainer);\n\t\t}\n\n\t\tEvent.bind(closeButton, 'click', () => {\n\t\t\tBX.userOptions.save(\n\t\t\t\t'crm',\n\t\t\t\tthis.#lastTimeShownField,\n\t\t\t\tthis.#lastTimeShownOptionName,\n\t\t\t\tDate.now(),\n\t\t\t);\n\t\t\tthis.#alertContainer.remove();\n\t\t});\n\n\t\tthis.#alertContainer.append(root);\n\t}\n\n\t#sendEnableNewLayoutRequest(): void\n\t{\n\t\tBX.ajax.runAction('crm.oldentityview.sunset.enableNewCardLayout')\n\t\t\t.then(() => {\n\t\t\t\twindow.location.reload();\n\t\t\t})\n\t\t\t.catch(() => {\n\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\tcontent: Loc.getMessage('CRM_OLD_CARD_LAYOUT_DISABLE_ALERT_ENABLE_NEW_LAYOUT_ERROR_MESSAGE'),\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\t#showConfirmationPopup(): void\n\t{\n\t\tconst confirmationPopup = MessageBox.create({\n\t\t\tmessage: Loc.getMessage('CRM_OLD_CARD_LAYOUT_DISABLE_ALERT_ENABLE_NEW_LAYOUT_ASSERT'),\n\t\t\tuseAirDesign: true,\n\t\t\tbuttons: [\n\t\t\t\tnew Button({\n\t\t\t\t\ttext: Loc.getMessage('CRM_OLD_CARD_LAYOUT_DISABLE_ALERT_ENABLE_NEW_LAYOUT_ASSERT_CONFIRM'),\n\t\t\t\t\tuseAirDesign: true,\n\t\t\t\t\tstyle: Button.AirStyle.FILLED,\n\t\t\t\t\tonclick: (button) => {\n\t\t\t\t\t\tthis.#sendEnableNewLayoutRequest(button);\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tnew Button({\n\t\t\t\t\ttext: Loc.getMessage('CRM_OLD_CARD_LAYOUT_DISABLE_ALERT_ENABLE_NEW_LAYOUT_ASSERT_CANCEL'),\n\t\t\t\t\tuseAirDesign: true,\n\t\t\t\t\tstyle: Button.AirStyle.OUTLINE,\n\t\t\t\t\tonclick: (button) => {\n\t\t\t\t\t\tbutton.context.close();\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\t\tconfirmationPopup.show();\n\t}\n\n\t#getTitleText(): string\n\t{\n\t\tif (this.#daysUntilDisable === 0)\n\t\t{\n\t\t\treturn Loc.getMessage('CRM_OLD_CARD_LAYOUT_DISABLE_ALERT_TITLE_LESS_THAN_DAY');\n\t\t}\n\n\t\treturn Loc.getMessagePlural(\n\t\t\t'CRM_OLD_CARD_LAYOUT_DISABLE_ALERT_TITLE',\n\t\t\tthis.#daysUntilDisable,\n\t\t\t{\n\t\t\t\t'#DAYS_UNTIL_DISABLE#': this.#daysUntilDisable,\n\t\t\t},\n\t\t);\n\t}\n\n\t#getText(): string\n\t{\n\t\tconst helpdeskLink = '<a class=\"crm-old-layout-helpdesk-link\" href=\"javascript:top.BX.Helper.show(\\'redirect=detail&code=26179574\\');\">';\n\t\tconst localPhraseCode = this.#isAdmin\n\t\t\t? 'CRM_OLD_CARD_LAYOUT_DISABLE_ALERT_TEXT'\n\t\t\t: 'CRM_OLD_CARD_LAYOUT_DISABLE_ALERT_ENABLE_NEW_LAYOUT_CONTACT_ADMIN'\n\t\t;\n\n\t\treturn Loc.getMessage(\n\t\t\tlocalPhraseCode,\n\t\t\t{\n\t\t\t\t'[helpdeskLink]': helpdeskLink,\n\t\t\t\t'[/helpdeskLink]': '</a>',\n\t\t\t},\n\t\t);\n\t}\n}\n"],"names":["DisableAlert","options","Type","isElementNode","alertContainer","Error","isInteger","daysUntilDisable","TypeError","isBoolean","isAdmin","isString","lastTimeShownField","lastTimeShownOptionName","previewHref","previewButton","Button","text","Loc","getMessage","useAirDesign","style","AirStyle","OUTLINE","size","Size","SMALL","onclick","Router","openSlider","allowChangeHistory","Tag","render","getContainer","root","buttonContainer","closeButton","showConfirmationButton","renderTo","Event","bind","BX","userOptions","save","Date","now","remove","append","ajax","runAction","then","window","location","reload","UI","Notification","Center","notify","content","confirmationPopup","MessageBox","create","message","buttons","FILLED","button","context","close","show","getMessagePlural","helpdeskLink","localPhraseCode"],"mappings":"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"}