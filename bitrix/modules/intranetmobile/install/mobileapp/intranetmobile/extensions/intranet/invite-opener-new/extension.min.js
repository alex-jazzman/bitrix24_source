jn.define("intranet/invite-opener-new",((e,n,t)=>{const{Notify:i}=e("notify");const{Invite:r,IntranetInviteAnalytics:o,AnalyticsEvent:a}=e("intranet/invite-new");const{Alert:s}=e("alert");const{Loc:I}=e("loc");const{InviteStatusBox:l}=e("intranet/invite-status-box");const{Tourist:T}=e("tourist");const E={POSSIBILITIES_RESTRICTED:"Invite possibilities restricted",PERMISSIONS_RESTRICTED:"Invite permissions restricted"};const c=e=>{if(env.isCollaber||env.extranet){return}i.showIndicatorLoading();m().then((n=>g(n,e)),(n=>d(n,e))).catch((e=>console.error(e))).finally((()=>i.hideCurrentIndicator()))};const d=(e,n)=>{const t=e.errors&&e.errors.length>0;if(t){f(e.errors,n.onInviteError)}};const g=(e,n)=>{v();const t=e.errors&&e.errors.length>0;if(t){f(e.errors,n.onInviteError);return}const{canCurrentUserInvite:i,canInviteByPhone:r,canInviteByLink:o,isBitrix24Included:a,adminInBoxRedirectLink:s}=e.data;if(!a){if(env.isAdmin){u(n.onInviteError,s,n.parentLayout)}else{_(n.onInviteError,n.parentLayout)}return}if(!i||!r&&!o){N(n.onInviteError,n.parentLayout);return}y({...p(e.data),...n})};const v=()=>{T.ready().then((()=>{if(T.firstTime("visit_invitations")){return T.remember("visit_invitations").then((()=>{BX.postComponentEvent("onSetUserCounters",[{[String(env.siteId)]:{menu_invite:0}}])})).catch(console.error)}return Promise.resolve()})).catch(console.error)};const u=(e,n,t=PageManager)=>{l.open({backdropTitle:I.getMessage("INTRANET_INVITE_OPENER_TITLE"),testId:"status-box-invite-in-web",imageName:"user-locked.svg",description:I.getMessage("INTRANET_INVITE_ADMIN_ONLY_IN_WEB_BOX_TEXT"),buttonText:I.getMessage("INTRANET_INVITE_GO_TO_WEB_BUTTON_TEXT"),parentWidget:t,onButtonClick:()=>{setTimeout((()=>{qrauth.open({redirectUrl:n,showHint:true,analyticsSection:"userList"})}),500)}});if(e){e([new Error(E.POSSIBILITIES_RESTRICTED)])}};const _=(e,n=PageManager)=>{l.open({backdropTitle:I.getMessage("INTRANET_INVITE_OPENER_TITLE"),testId:"status-box-no-permission",imageName:"user-locked.svg",parentWidget:n,description:I.getMessage("INTRANET_INVITE_ADMIN_ONLY_BOX_TEXT"),buttonText:I.getMessage("INTRANET_INVITE_DISABLED_BOX_BUTTON_TEXT")});if(e){e([new Error(E.PERMISSIONS_RESTRICTED)])}};const N=(e,n=PageManager)=>{l.open({backdropTitle:I.getMessage("INTRANET_INVITE_OPENER_TITLE"),testId:"status-box-no-invitation",imageName:"no-invitation.svg",parentWidget:n,description:I.getMessage("INTRANET_INVITE_DISABLED_BOX_TEXT"),buttonText:I.getMessage("INTRANET_INVITE_DISABLED_BOX_BUTTON_TEXT")});if(e){e([new Error(E.PERMISSIONS_RESTRICTED)])}};const f=(e,n)=>{s.alert("",r.getAjaxErrorText(e));if(n){n(e)}};const m=()=>BX.ajax.runAction("intranetmobile.invite.getInviteSettings");const p=e=>({adminConfirm:e.adminConfirm??false,inviteLink:e.inviteLink??"",creatorEmailConfirmed:e.creatorEmailConfirmed??false,sharingMessage:e.sharingMessage??"",canInviteByPhone:e.canInviteByPhone??false,canInviteByLink:e.canInviteByLink??false});const y=({parentLayout:e=null,openWidgetConfig:n={},analytics:t={},onInviteSentHandler:i=null,onInviteError:a=null,onViewHiddenWithoutInvitingHandler:s=null,inviteLink:l="",canInviteByPhone:T=false,canInviteByLink:E=false,creatorEmailConfirmed:c=false,sharingMessage:d="",multipleInvite:g=true,adminConfirm:v=false})=>{const u=new o({analytics:t});u.sendDrawerOpenEvent();u.setDepartmentParam(false);const _={enableNavigationBarBorder:false,titleParams:{text:I.getMessage("INTRANET_INVITE_OPENER_TITLE"),type:"dialog"},modal:true,backdrop:{showOnTop:false,onlyMediumPosition:false,mediumPositionHeight:516,bounceEnable:true,swipeAllowed:true,swipeContentAllowed:false,horizontalSwipeAllowed:false,shouldResizeContent:true,adoptHeightByKeyboard:true},...n,onReady:t=>{let o=false;let I=false;t.showComponent(new r({layout:t,parentLayout:e,openWidgetConfig:n,analytics:u,onInviteSentHandler:e=>{o=true;if(i){i(e)}},onInviteError:e=>{I=true;if(a){a(e)}},inviteLink:l,canInviteByPhone:T,canInviteByLink:E,creatorEmailConfirmed:c,sharingMessage:d,multipleInvite:g,adminConfirm:v}));t.on("onViewRemoved",(()=>{if(!o&&!I&&s){s()}}))}};if(e){e.openWidget("layout",_);return}PageManager.openWidget("layout",_)};t.exports={openIntranetInviteWidget:c,AnalyticsEvent:a,ErrorCode:E}}));
//# sourceMappingURL=extension.map.js