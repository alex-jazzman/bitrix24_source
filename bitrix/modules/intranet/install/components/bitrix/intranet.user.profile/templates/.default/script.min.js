(function(){const e=BX.namespace("BX.Intranet.UserProfile");if(e.Manager){return}e.Manager=function(e){this.init(e)};e.Manager.prototype={init(t){this.signedParameters=t.signedParameters;this.componentName=t.componentName;this.canEditProfile=t.canEditProfile==="Y";this.userId=t.userId||"";this.userStatus=t.userStatus||"";this.isCollaber=t.isCollaber==="Y";this.userFullName=t.userFullName||"";this.userPhoto=t.userPhoto||"";this.isIntegratorUser=t.isIntegratorUser==="Y";this.isOwnProfile=t.isOwnProfile==="Y";this.isSessionAdmin=t.isSessionAdmin==="Y";this.urls=t.urls;this.isExtranetUser=t.isExtranetUser==="Y";this.adminRightsRestricted=t.adminRightsRestricted==="Y";this.delegateAdminRightsRestricted=t.delegateAdminRightsRestricted==="Y";this.isFireUserEnabled=t.isFireUserEnabled==="Y";this.showSonetAdmin=t.showSonetAdmin==="Y";this.languageId=t.languageId;this.siteId=t.siteId;this.isCloud=t.isCloud==="Y";this.isRusCloud=t.isRusCloud==="Y";this.isCurrentUserIntegrator=t.isCurrentUserIntegrator==="Y";this.personalMobile=t.personalMobile;this.personalPhoto=t.personalPhoto;this.isCurrentUserAdmin=t.isCurrentUserAdmin;this.avatarUri=BX.type.isNotEmptyString(t.photo)?t.photo:null;this.userpicUploadAttribute=t.userpicUploadAttribute??"";this.actionsAvailability=t.actionsAvailability;this.rootDepartment=t.rootDepartment;this.entityEditorInstance=new e.EntityEditor({managerInstance:this,params:t});BX.ready((()=>{this.tagsManagerInstance=new e.Tags({managerInstance:this,inputNode:document.getElementById("intranet-user-profile-tags-input"),tagsNode:document.getElementById("intranet-user-profile-tags")});this.stressLevelManagerInstance=new e.StressLevel({managerInstance:this,options:t});this.gratsManagerInstance=new e.Grats({managerInstance:this,options:t});this.profilePostManagerInstance=new e.ProfilePost({managerInstance:this,options:t});this.initAvatar();this.initAvailableActions();this.initAvatarLoader();if(this.isCloud){this.initGdpr()}const i=BX("intranet-user-profile-subordinate-more");if(BX.type.isDomNode(i)){BX.bind(i,"click",(()=>{this.loadMoreUsers(i)}))}const s=BX("intranet-user-profile-manages-more");if(BX.type.isDomNode(i)){BX.bind(s,"click",(()=>{this.loadMoreUsers(s)}))}const o=document.querySelector(".intranet-user-profile-bottom-controls");const r=document.getElementById("intranet-user-profile_buttons");if(BX.type.isDomNode(o)&&BX.type.isDomNode(r)){const e=r.querySelector(".ui-entity-settings-link");e.setAttribute("class","ui-btn ui-btn-sm ui-btn-light-border ui-btn-themes");r.parentNode.removeChild(r);o.appendChild(e)}BX.addCustomEvent("BX.UI.EntityEditorAjax:onSubmit",BX.proxy((e=>{this.userFullName=e.FULL_NAME}),this))}))},initAvatar(){const e={size:212,userpicPath:this.avatarUri?encodeURI(this.avatarUri):null};if(this.userStatus==="collaber"){this.avatar=new BX.UI.AvatarRoundGuest(e)}else if(this.userStatus==="extranet"){this.avatar=new BX.UI.AvatarRoundExtranet(e)}else{this.avatar=new BX.UI.AvatarRound(e)}const t=BX.Tag.render`<div class="intranet-user-profile-photo" id="intranet-user-profile-photo"></div>`;this.avatar.renderTo(t);const i=BX("intranet-user-profile-userpic-avatar");BX.Dom.append(t,i);if(this.canEditProfile||this.isOwnProfile){BX.Dom.append(this.getAvatarEditorButtons(),i);BX.Dom.append(this.getAvatarRemoveButton(),i)}},getAvatarEditorButtons(){return BX.Tag.render`
				<div class="intranet-user-profile-userpic-load">
					<div class="intranet-user-profile-userpic-create" id="intranet-user-profile-photo-camera">
						${BX.message("INTRANET_USER_PROFILE_AVATAR_CAMERA")}
					</div>
					<div class="intranet-user-profile-userpic-upload" id="intranet-user-profile-photo-file" ${this.userpicUploadAttribute}>
						${BX.message("INTRANET_USER_PROFILE_AVATAR_LOAD")}
					</div>
				</div>
			`},getAvatarRemoveButton(){return BX.Tag.render`
				<div class="intranet-user-profile-userpic-remove" id="intranet-user-profile-photo-remove"
					${this.personalPhoto?"":"hidden"}>
				</div>
			`},initAvailableActions(){const e=document.querySelector("[data-role='user-profile-actions-button']");if(BX.type.isDomNode(e)){BX.bind(e,"click",BX.proxy((function(){this.showActionPopup(BX.proxy_context)}),this))}},initGdpr(){const e=document.querySelectorAll("[data-role='gdpr-input']");e.forEach(((e,t,i)=>{BX.bind(e,"change",(()=>{this.changeGdpr(e)}))}));const t=document.querySelector(".intranet-user-profile-column-block-title-dropdown");BX.bind(t,"click",(()=>{this.animateGdprBlock(t)}))},initAvatarLoader(){if(BX("intranet-user-profile-photo-camera")&&BX("intranet-user-profile-photo-file")){if(BX.AvatarEditor){setTimeout((()=>{if(BX.AvatarEditor.isCameraAvailable()!==true){BX.hide(BX("intranet-user-profile-photo-camera"))}}),0);const e=function(){let e=BX.AvatarEditor.getInstanceById("intranet-user-profile-photo-file");if(e===null){e=BX.AvatarEditor.createInstance("intranet-user-profile-photo-file",{enableCamera:true,enableMask:true});e.subscribeOnFormIsReady("newPhoto",this.changePhoto.bind(this))}return e}.bind(this);BX.bind(BX("intranet-user-profile-photo-camera"),"click",(()=>{e().show("camera")}));BX.bind(BX("intranet-user-profile-photo-file"),"click",(()=>{e().show("file")}));BX.bind(BX("intranet-user-profile-photo-mask"),"click",(()=>{e().show("mask")}))}else{BX.hide(BX("intranet-user-profile-photo-camera"));BX.hide(BX("intranet-user-profile-photo-file"));BX.hide(BX("intranet-user-profile-photo-mask"))}}BX.bind(BX("intranet-user-profile-photo-remove"),"click",(()=>{if(this.avatar.picPath){this.showConfirmPopup(BX.message("INTRANET_USER_PROFILE_PHOTO_DELETE_CONFIRM"),this.deletePhoto.bind(this))}}))},showActionPopup(e){const t=[];if(this.showSonetAdmin){t.push({text:BX.message(this.isSessionAdmin?"INTRANET_USER_PROFILE_QUIT_ADMIN_MODE":"INTRANET_USER_PROFILE_ADMIN_MODE"),className:"menu-popup-no-icon",onclick(){this.popupWindow.close();__SASSetAdmin()}})}if(this.userStatus==="admin"&&this.canEditProfile&&!this.isOwnProfile){t.push({text:BX.message("INTRANET_USER_PROFILE_REMOVE_ADMIN_RIGHTS"),className:"menu-popup-no-icon",onclick:BX.proxy((function(){BX.proxy_context.popupWindow.close();this.removeAdminRights()}),this)})}if(this.userStatus==="employee"&&this.canEditProfile&&!this.isOwnProfile&&!this.isCurrentUserIntegrator){var i=BX.message("INTRANET_USER_PROFILE_SET_ADMIN_RIGHTS");if(this.delegateAdminRightsRestricted){i+="<span class='intranet-user-profile-lock-icon'></span>"}t.push({html:i,onclick:BX.proxy((function(){BX.proxy_context.popupWindow.close();if(this.adminRightsRestricted){if(this.delegateAdminRightsRestricted){top.BX.UI.InfoHelper.show("limit_admin_admins")}else{this.showConfirmPopup(BX.message("INTRANET_USER_PROFILE_MOVE_ADMIN_RIGHTS_CONFIRM"),this.setAdminRights.bind(this))}}else if(this.isCloud){this.getAdminConfirmPopup().show()}else{this.setAdminRights()}}),this)})}if(this.actionsAvailability.fire&&!BX.util.in_array(this.userStatus,["email","shop"])){i=BX.message("INTRANET_USER_PROFILE_FIRE");if(!this.isFireUserEnabled&&!this.isIntegratorUser){i+="<span class='intranet-user-profile-lock-icon'></span>"}t.push({text:i,className:"menu-popup-no-icon",onclick:BX.proxy((function(){BX.proxy_context.popupWindow.close();if(!this.isFireUserEnabled&&!this.isIntegratorUser){top.BX.UI.InfoHelper.show("limit_dismiss")}else{this.showConfirmPopup(BX.message("INTRANET_USER_PROFILE_FIRE_CONFIRM"),this.fireUser.bind(this))}}),this)})}if(this.actionsAvailability.restore){t.push({text:BX.message("INTRANET_USER_PROFILE_HIRE"),className:"menu-popup-no-icon",onclick:BX.proxy((function(){BX.proxy_context.popupWindow.close();this.showConfirmPopup(BX.message("INTRANET_USER_PROFILE_HIRE_CONFIRM"),this.hireUser.bind(this))}),this)})}if(this.actionsAvailability.confirm){t.push({text:BX.message("INTRANET_USER_PROFILE_ACTION_CONFIRM"),className:"menu-popup-no-icon",onclick:BX.proxy((function(){BX.proxy_context.popupWindow.close();this.confirmUserRequest("Y")}),this)})}if(this.actionsAvailability.decline){t.push({text:BX.message("INTRANET_USERPROFILE_ACTION_REFUSE"),className:"menu-popup-no-icon",onclick:BX.proxy((function(){BX.proxy_context.popupWindow.close();this.confirmUserRequest("N")}),this)})}if(this.userStatus==="invited"&&this.canEditProfile&&!this.isOwnProfile){t.push({text:BX.message("INTRANET_USER_PROFILE_REINVITE"),className:"menu-popup-no-icon",onclick:BX.proxy((function(){BX.proxy_context.popupWindow.close();this.reinviteUser()}),this)})}if(this.actionsAvailability.delete){t.push({text:BX.message("INTRANET_USER_PROFILE_DELETE"),className:"menu-popup-no-icon",onclick:BX.proxy((function(){BX.proxy_context.popupWindow.close();this.showConfirmPopup(BX.message("INTRANET_USER_PROFILE_DELETE_CONFIRM"),this.deleteUser.bind(this))}),this)})}if(this.isExtranetUser&&this.canEditProfile&&!this.isOwnProfile&&this.isCloud){t.push({text:BX.message("INTRANET_USER_PROFILE_MOVE_TO_INTRANET"),className:"menu-popup-no-icon",onclick:BX.proxy((function(){BX.proxy_context.popupWindow.close();if(this.transferToIntranet){this.transferToIntranet.destroy();this.transferToIntranet=null}const e={userType:this.isCollaber?"collaber":"extranet",userName:this.userFullName,userPhoto:this.userPhoto,componentName:this.componentName,signedParameters:this.signedParameters,rootDepartment:this.rootDepartment};this.transferToIntranet=new BX.Intranet.TransferToIntranetPopup(e);this.transferToIntranet.show()}),this)})}if(this.isCloud&&this.canEditProfile&&!this.isOwnProfile&&!this.isIntegratorUser&&this.userStatus!=="fired"&&this.userStatus!=="waiting"){t.push({text:BX.message("INTRANET_USER_PROFILE_SET_INEGRATOR_RIGHTS"),className:"menu-popup-no-icon",onclick:BX.proxy((function(){BX.proxy_context.popupWindow.close();this.showConfirmPopup(BX.message("INTRANET_USER_PROFILE_SET_INTEGRATOR_RIGHTS_CONFIRM"),this.setIntegratorRights.bind(this))}),this)})}BX.PopupMenu.show("user-profile-action-popup",e,t,{offsetTop:0,offsetLeft:10,angle:true,events:{onPopupClose(){BX.PopupMenu.destroy()}}})},showConfirmPopup(e,t){BX.PopupWindowManager.create({id:"intranet-user-profile-confirm-popup",content:BX.create("div",{props:{style:"max-width: 450px"},html:e}),closeIcon:false,lightShadow:true,offsetLeft:100,overlay:true,contentPadding:10,buttons:[new BX.UI.CreateButton({text:BX.message("INTRANET_USER_PROFILE_YES"),events:{click(e,i){t();i.stopPropagation();this.context.close()}}}),new BX.UI.CancelButton({text:BX.message("INTRANET_USER_PROFILE_NO"),events:{click(){this.context.close()}}})],events:{onPopupClose(){this.destroy()}}}).show()},getAdminConfirmPopup(){const e=BX.PopupWindowManager.create({id:"intranet-user-profile-admin-confirm-popup",content:BX.create("div",{props:{style:"max-width: 450px"},html:BX.message("INTRANET_USER_PROFILE_MOVE_ADMIN_RIGHTS_SECURITY_CONFIRM_DESCRIPTION_MSGVER_1")}),closeIcon:false,lightShadow:true,offsetLeft:100,overlay:true,titleBar:BX.message("INTRANET_USER_PROFILE_MOVE_ADMIN_RIGHTS_SECURITY_CONFIRM_TITLE"),contentPadding:10,buttons:[new BX.UI.CreateButton({text:BX.message("INTRANET_USER_PROFILE_CONFIRM_YES_MSGVER_1"),events:{click:(t,i)=>{this.setAdminRights();i.stopPropagation();e.close()}}}),new BX.UI.CreateButton({text:BX.message("INTRANET_USER_PROFILE_CONFIRM_YES_INTEGRATOR"),events:{click:()=>{this.setIntegratorRights();e.close()}}}),new BX.UI.CancelButton({text:BX.message("INTRANET_USER_PROFILE_CONFIRM_NO_MSGVER_1"),events:{click:()=>{e.close()}}})],events:{onPopupClose:()=>{e.destroy()}}});return e},showFireInvitedUserPopup(e){BX.PopupWindowManager.create({id:"intranet-user-profile-fire-invited-popup",content:BX.create("div",{props:{style:"max-width: 450px"},html:BX.message("INTRANET_USER_PROFILE_FIRE_INVITED_USER")}),closeIcon:true,lightShadow:true,offsetLeft:100,overlay:false,contentPadding:10,buttons:[new BX.UI.CreateButton({text:BX.message("INTRANET_USER_PROFILE_YES"),events:{click(t){t.setWaiting();this.context.close();e()}}}),new BX.UI.CancelButton({text:BX.message("INTRANET_USER_PROFILE_NO"),events:{click(){this.context.close()}}})]}).show()},showIntegratorPartnerErrorPopup(){const e=BX.PopupWindowManager.create("popup-message",null,{id:"intranet-user-profile-error-popup",content:BX.create("div",{props:{style:"max-width: 450px"},html:BX.message("INTRANET_USER_PROFILE_INTEGRATOR_ERROR_NOT_PARTNER")}),closeIcon:false,lightShadow:true,offsetLeft:100,overlay:true,contentPadding:10,buttons:[new BX.UI.CreateButton({text:BX.message("INTRANET_USER_PROFILE_INTEGRATOR_ERROR_NOT_PARTNER_CLOSE"),events:{click(){this.context.close()}}})]});e.show()},showErrorPopup(e){if(!e){return}BX.PopupWindowManager.create({id:"intranet-user-profile-error-popup",content:BX.create("div",{props:{style:"max-width: 450px"},html:e}),closeIcon:true,lightShadow:true,offsetLeft:100,overlay:false,contentPadding:10}).show()},loadMoreUsers(e){if(!BX.type.isDomNode(e)){return}const t=e.parentNode;const i=t.querySelectorAll("[data-role='user-profile-item']");const s=i.length;for(let e=0;e<4&&e<s;e++){i[e].style.display="inline-block";i[e].setAttribute("data-role","")}if(s-4<=0){e.style.display="none"}else{BX.findChild(e).innerHTML=s-4}},changePhoto(e){const t=e.getData().form;const i=this.showLoader({node:BX("intranet-user-profile-photo"),loader:null,size:100});BX.ajax.runComponentAction(this.componentName,"loadPhoto",{signedParameters:this.signedParameters,mode:"ajax",data:t}).then((e=>{if(e.data){this.avatar.setUserPic(encodeURI(e.data));(top||window).BX.onCustomEvent("BX.Intranet.UserProfile:Avatar:changed",[{userId:this.userId,url:e.data}])}this.hideLoader({loader:i})})).catch((e=>{this.hideLoader({loader:i});this.showErrorPopup(e.errors[0].message)}));BX("intranet-user-profile-photo-remove").hidden=false},deletePhoto(){const e=this.showLoader({node:BX("intranet-user-profile-photo"),loader:null,size:100});BX.ajax.runComponentAction(this.componentName,"deletePhoto",{signedParameters:this.signedParameters,mode:"ajax",data:{}}).then((t=>{this.avatar.removeUserPic();this.hideLoader({loader:e});BX("intranet-user-profile-photo-remove").hidden=true})).catch((t=>{this.hideLoader({loader:e});this.showErrorPopup(t.errors[0].message)}))},setAdminRights(){const e=this.showLoader({node:BX("intranet-user-profile-wrap"),loader:null,size:100});BX.ajax.runComponentAction(this.componentName,"setAdminRights",{signedParameters:this.signedParameters,mode:"ajax",data:{}}).then((t=>{if(t.data===true){BX.SidePanel.Instance.postMessageTop(window,"userProfileSlider::reloadList",{});location.reload()}else{this.hideLoader({loader:e});BX.UI.Notification.Center.notify({content:"Error",position:"top-right",autoHideDelay:1e4});BX.PopupWindowManager.getPopupById("intranet-user-profile-confirm-popup").close()}})).catch((t=>{this.hideLoader({loader:e});BX.UI.Notification.Center.notify({content:t.errors[0].message,position:"top-right",autoHideDelay:1e4});BX.PopupWindowManager.getPopupById("intranet-user-profile-confirm-popup").close()}))},setIntegratorRights(){const e=this.showLoader({node:BX("intranet-user-profile-wrap"),loader:null,size:100});BX.ajax.runComponentAction(this.componentName,"setIntegratorRights",{signedParameters:this.signedParameters,mode:"ajax",data:{}}).then((function(t){if(t.data===true){location.reload()}else{this.hideLoader({loader:e});this.showErrorPopup("Error")}}),(t=>{this.hideLoader({loader:e});if(t.errors[0].code==="INTEGRATOR_ERROR_NOT_PARTNER"){this.showIntegratorPartnerErrorPopup()}else{this.showErrorPopup(t.errors[0].message)}}))},removeAdminRights(){const e=this.showLoader({node:BX("intranet-user-profile-wrap"),loader:null,size:100});BX.ajax.runComponentAction(this.componentName,"removeAdminRights",{signedParameters:this.signedParameters,mode:"ajax",data:{}}).then((function(t){if(t.data===true){BX.SidePanel.Instance.postMessageTop(window,"userProfileSlider::reloadList",{});location.reload()}else{this.hideLoader({loader:e});this.showErrorPopup("Error")}}),(t=>{this.hideLoader({loader:e});this.showErrorPopup(t.errors[0].message)}))},fireUser(){const e=this.showLoader({node:BX("intranet-user-profile-wrap"),loader:null,size:100});BX.ajax.runAction("intranet.v2.User.fire",{data:{userId:this.userId}}).then((t=>{if(t.data===true){BX.SidePanel.Instance.postMessageTop(window,"userProfileSlider::reloadList",{});location.reload()}else{this.hideLoader({loader:e});this.showErrorPopup("Error")}})).catch((t=>{this.hideLoader({loader:e});this.showErrorPopup(t.errors[0].message)}))},hireUser(){const e=this.showLoader({node:BX("intranet-user-profile-wrap"),loader:null,size:100});BX.ajax.runAction("intranet.v2.User.restore",{data:{userId:this.userId}}).then((t=>{if(t.data===true){location.reload()}else{this.hideLoader({loader:e});this.showErrorPopup("Error")}})).catch((t=>{this.hideLoader({loader:e})}))},confirmUserRequest(e){const t=this.showLoader({node:BX("intranet-user-profile-wrap"),loader:null,size:100});BX.ajax.runAction("intranet.controller.invite.confirmUserRequest",{signedParameters:this.signedParameters,data:{userId:this.userId,isAccept:e}}).then((function(i){if(i.data===true){if(e==="Y"){location.reload()}else{BX.SidePanel.Instance.postMessageTop(window,"userProfileSlider::reloadList",{});BX.SidePanel.Instance.close()}}else{this.hideLoader({loader:t});this.showErrorPopup("Error")}}),(e=>{this.hideLoader({loader:t})}))},deleteUser(){const e=this.showLoader({node:BX("intranet-user-profile-wrap"),loader:null,size:100});BX.ajax.runAction("intranet.v2.User.delete",{data:{userId:this.userId}}).then((t=>{if(t.data===true){BX.SidePanel.Instance.postMessageTop(window,"userProfileSlider::reloadList",{});BX.SidePanel.Instance.close()}else{this.hideLoader({loader:e});this.showErrorPopup("Error")}})).catch((t=>{this.hideLoader({loader:e});this.showFireInvitedUserPopup(this.fireUser.bind(this))}))},reinviteUser(){const e=this.showLoader({node:BX("intranet-user-profile-wrap"),loader:null,size:100});BX.ajax.runAction("intranet.controller.invite.reinvite",{data:{params:{userId:this.userId,extranet:this.isExtranetUser=="Y"?"Y":"N"}}}).then((t=>{this.hideLoader({loader:e});if(t.data.result){BX.PopupWindowManager.create("intranet-user-profile-invited-popup",null,{content:`<p>${BX.message("INTRANET_USER_PROFILE_REINVITE_SUCCESS")}</p>`,offsetLeft:27,offsetTop:7,autoHide:true}).show();BX.SidePanel.Instance.postMessageTop(window,"BX.Bitrix24.EmailConfirmation:showPopup")}}),(t=>{this.hideLoader({loader:e})}))},showLoader(e){let t=null;if(e.node){if(e.loader===null){t=new BX.Loader({target:e.node,size:e.hasOwnProperty("size")?e.size:40})}else{t=e.loader}t.show()}return t},hideLoader(e){if(e.loader!==null){e.loader.hide()}if(e.node){BX.cleanNode(e.node)}if(e.loader!==null){e.loader=null}},processSliderCloseEvent(e){BX.addCustomEvent("SidePanel.Slider:onMessage",(t=>{if(t.getSlider()!=BX.SidePanel.Instance.getSliderByWindow(window)){return}if(t.getEventId()!="SidePanel.Wrapper:onClose"){return}const i=t.getData();if(!BX.type.isNotEmptyObject(i.sliderData)){return}const s=i.sliderData.get("entityType");const o=i.sliderData.get("entityId");if(BX.type.isNotEmptyString(s)&&s==e.entityType&&o==this.userId){e.callback()}}))},changeGdpr(e){const t={type:e.name,value:e.checked?"Y":"N"};BX.ajax.runComponentAction(this.componentName,"changeGdpr",{signedParameters:this.signedParameters,mode:"class",data:t}).then((e=>{}),(e=>{}))},animateGdprBlock(e){const t=document.querySelector(`[data-role="${e.getAttribute("for")}"]`);if(e.classList.contains("intranet-user-profile-column-block-title-dropdown--open")){e.classList.remove("intranet-user-profile-column-block-title-dropdown--open");t.style.height=null}else{e.classList.add("intranet-user-profile-column-block-title-dropdown--open");t.style.height=`${t.firstElementChild.offsetHeight}px`}}}})();
//# sourceMappingURL=script.map.js