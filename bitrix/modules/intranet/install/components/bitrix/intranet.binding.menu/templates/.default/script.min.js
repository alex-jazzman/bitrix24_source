(function(){"use strict";BX.namespace("BX.Intranet.Binding.Menu");BX.Intranet.Binding.Menu=function(i,t,e){e=e||{};this.id=i||"intranet_binding_menu";this.idTop=this.id+"_top";this.items=t;this.menu=null;this.menuShowed=false;this.sections=e.sections||{};this.frequencyItem=e.frequencyItem||{};this.ajaxPath=e.ajaxPath||"";this.bindingId=e.bindingId||""};BX.Intranet.Binding.Menu.prototype={binding:function(){if(BX(this.id)){BX.bind(BX(this.id),"click",BX.delegate(this.clickMenuButton,this));if(BX(this.idTop)&&!BX.Type.isStringFilled(this.frequencyItem.href)&&!BX.Type.isStringFilled(this.frequencyItem.onclick)){BX.bind(BX(this.idTop),"click",BX.delegate(this.clickMenuButton,this))}}},onItemClick:function(id,onclick){this.menu.close();if(BX.type.isString(onclick)){eval(onclick)}BX.ajax({url:this.ajaxPath,method:"POST",data:{action:"openingLog",payload:{bindingId:this.bindingId,menuItemId:id},sessid:BX.message("bitrix_sessid")},dataType:"json",onsuccess:function(i){}.bind(this)})},buildMenu:function(i){var t=[];for(var e=0,n=i.length;e<n;e++){i[e]["text"]=i[e]["text"];if(typeof i[e]["items"]!=="undefined"){i[e]["items"]=this.buildMenu(i[e]["items"])}else if(!i[e]["system"]){i[e]["onclick"]=this.onItemClick.bind(this,i[e]["id"],i[e]["onclick"])}t.push(i[e])}return t},clickMenuButton:function(i){if(!this.menu){this.menu=new BX.PopupMenuWindow(this.id,i.target===BX(this.idTop)?BX(this.idTop):BX(this.id),this.buildMenu(this.items),{autoHide:true,events:{onClose:function(){this.menuShowed=false;if(i&&i.target){i.target.blur()}}.bind(this)}})}if(this.menu){if(this.menuShowed){this.menu.close()}else{this.menuShowed=true;this.menu.show()}}BX.PreventDefault()}}})();
//# sourceMappingURL=script.map.js