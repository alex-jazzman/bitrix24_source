{"version":3,"file":"script.js","sources":["src/account/account.js","src/api/counters.js","src/items/item.js","src/items/item-admin-shared.js","src/items/item-admin-custom.js","src/items/item-user-favorites.js","src/items/item-user-self.js","src/items/item-system.js","src/items/index.js","src/controllers/items-controller.js","src/history/browser-history.js","src/desktop-menu.js"],"sourcesContent":["import { Dom, Event, Loc, Tag, Type } from 'main.core';\nimport { DesktopApi, DesktopAccount } from 'im.v2.lib.desktop-api';\nimport { showDesktopDeleteConfirm } from 'im.v2.lib.confirm';\nimport { Menu, Popup, PopupManager } from 'main.popup';\nimport { PopupType } from 'im.v2.const';\nimport { Loader } from 'main.loader';\n\nexport class Account\n{\n\tstatic defaultAvatar = '/bitrix/js/im/images/blank.gif';\n\tstatic defaultAvatarDesktop = '/bitrix/js/ui/icons/b24/images/ui-user.svg?v2';\n\n\taccounts: DesktopAccount[] = [];\n\tcurrentUser: ?Object = null;\n\tcontextPopup: BX.Main.Popup[] = [];\n\tpopup: BX.Main.Popup = null;\n\tallCounters: Object = {};\n\twrapper: HTMLElement = null;\n\tloader: Loader = null;\n\n\tconstructor(allCounters: Object)\n\t{\n\t\tthis.wrapper = document.getElementById('history-items');\n\t\tthis.loader = null;\n\n\t\tthis.checkCounters(allCounters);\n\t\tthis.reload();\n\n\t\tthis.viewDesktopUser();\n\t\tthis.initPopup();\n\t}\n\n\t#getLoader(): Loader\n\t{\n\t\tif (this.loader)\n\t\t{\n\t\t\treturn this.loader;\n\t\t}\n\n\t\tthis.loader = new Loader({\n\t\t\ttarget: document.querySelector('.intranet__desktop-menu_popup'),\n\t\t\tsize: 80,\n\t\t\tmode: 'absolute',\n\t\t\tstrokeWidth: 4,\n\t\t});\n\n\t\treturn this.loader;\n\t}\n\n\thideLoader(): void\n\t{\n\t\tthis.#getLoader().hide();\n\t}\n\n\tcheckCounters(allCounters: Object): void\n\t{\n\t\tfor (const counterId of Object.keys(allCounters))\n\t\t{\n\t\t\tlet key = counterId;\n\t\t\tif (counterId === '**')\n\t\t\t{\n\t\t\t\tkey = 'live-feed';\n\t\t\t}\n\t\t\tthis.allCounters[key] = allCounters[counterId];\n\t\t}\n\t}\n\n\tgetSumCounters(): number\n\t{\n\t\tlet sum = 0;\n\t\tfor (const counterId of Object.keys(this.allCounters))\n\t\t{\n\t\t\tif (counterId === 'tasks_effective' || counterId === 'invited_users')\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst val = this.allCounters[counterId] ? parseInt(this.allCounters[counterId], 10) : 0;\n\t\t\tsum += val;\n\t\t}\n\n\t\treturn sum;\n\t}\n\n\tgetTabUsers(): []\n\t{\n\t\t// eslint-disable-next-line no-undef\n\t\treturn Type.isUndefined(BXDesktopSystem) ? [] : BXDesktopSystem?.TabList();\n\t}\n\n\treload(): void\n\t{\n\t\tthis.reloadAccounts();\n\t\tthis.viewPopupAccounts();\n\t}\n\n\treloadAccounts(): void\n\t{\n\t\tconst currentUserId = parseInt(Loc.getMessage('USER_ID'), 10);\n\t\t// eslint-disable-next-line no-undef\n\t\tthis.accounts = Type.isUndefined(BXDesktopSystem) ? [] : DesktopApi.getAccountList();\n\t\tthis.currentUser = this.accounts.find(\n\t\t\t(account) => parseInt(account.id, 10) === currentUserId\n\t\t\t\t&& account.portal === location.hostname,\n\t\t);\n\t}\n\n\tgetAccountBy(account: DesktopAccount): DesktopAccount\n\t{\n\t\treturn this.accounts.find(\n\t\t\t(x) => parseInt(x.id, 10) === parseInt(account.id, 10)\n\t\t\t\t&& x.portal === account.portal,\n\t\t);\n\t}\n\n\tinitPopup(): void\n\t{\n\t\tconst menuContent = document.querySelector('.intranet__desktop-menu_popup');\n\t\tconst userNode = document.querySelector('.intranet__desktop-menu_user-block');\n\n\t\tthis.popup = new Popup({\n\t\t\tcontent: menuContent,\n\t\t\tbindElement: userNode,\n\t\t\twidth: 320,\n\t\t\tbackground: '#282e39',\n\t\t\tcloseIcon: true,\n\t\t\tcloseByEsc: true,\n\t\t});\n\n\t\tEvent.bind(userNode, 'click', (event) => {\n\t\t\tif (this.popup.isShown())\n\t\t\t{\n\t\t\t\tthis.popup.close();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tthis.popup.show();\n\t\t\t\tthis.#getLoader().hide();\n\t\t\t\tthis.reload();\n\t\t\t}\n\t\t});\n\n\t\tEvent.bind(document, 'click', (event) => {\n\t\t\tconst withinBoundaries = event.composedPath().includes(menuContent);\n\n\t\t\tif (!withinBoundaries)\n\t\t\t{\n\t\t\t\tthis.popup.close();\n\t\t\t}\n\t\t});\n\t}\n\n\tsetCounters(counters: Object): void\n\t{\n\t\tlet newCounters = counters;\n\n\t\tif (counters.data)\n\t\t{\n\t\t\tnewCounters = counters.data;\n\t\t\tif (newCounters[0] && Type.isObject(newCounters[0]))\n\t\t\t{\n\t\t\t\tnewCounters = newCounters[0];\n\t\t\t}\n\t\t}\n\n\t\tfor (const counterId of Object.keys(newCounters))\n\t\t{\n\t\t\tlet cId = counterId;\n\t\t\tif (counterId === '**')\n\t\t\t{\n\t\t\t\tcId = 'live-feed';\n\t\t\t}\n\t\t\tthis.allCounters[cId] = newCounters[counterId];\n\t\t}\n\n\t\tconst sumCounters = this.getSumCounters();\n\t\tconst block = document.getElementsByClassName('intranet__desktop-menu_user-block')[0];\n\t\tconst counterNode = block?.querySelector('[data-role=\"counter\"]');\n\n\t\tif (counterNode)\n\t\t{\n\t\t\tif (sumCounters > 0)\n\t\t\t{\n\t\t\t\tcounterNode.innerHTML = sumCounters > 99 ? '99+' : sumCounters;\n\t\t\t\tif (!Dom.hasClass(block, 'intranet__desktop-menu_item_counters'))\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(block, 'intranet__desktop-menu_item_counters');\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcounterNode.innerHTML = '';\n\t\t\t\tDom.addClass(block, 'intranet__desktop-menu_item_counters');\n\t\t\t}\n\t\t}\n\t}\n\n\tremoveElements(className: string): void\n\t{\n\t\tconst elements = document.getElementsByClassName(className);\n\n\t\t[...elements].forEach((element) => {\n\t\t\telement.remove();\n\t\t});\n\t}\n\n\tviewDesktopUser(): void\n\t{\n\t\tif (this.currentUser === null)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst block = document.getElementsByClassName('intranet__desktop-menu_user')[0];\n\t\tconst counters = this.getSumCounters();\n\n\t\tlet counterBlock = null;\n\t\tif (counters > 0)\n\t\t{\n\t\t\tconst countersView = counters > 99 ? '99+' : counters;\n\t\t\tcounterBlock = Tag.render`\n\t\t\t\t<div class=\"intranet__desktop-menu_user-counter ui-counter ui-counter-md ui-counter-danger\">\n\t\t\t\t\t<div class=\"ui-counter-inner\" data-role=\"counter\">${countersView}</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\tthis.removeElements('intranet__desktop-menu_user-block');\n\n\t\tconst userData = Tag.render`\n\t\t\t<div class=\"intranet__desktop-menu_user-block ${counters > 0 ? 'intranet__desktop-menu_item_counters' : ''}\">\n\t\t\t\t\t\t\t<span class=\"intranet__desktop-menu_user-avatar ui-icon ui-icon-common-user ui-icon-common-user-desktop\">\n\t\t\t\t\t\t\t\t<i></i>\n\t\t\t\t\t\t\t\t${counterBlock}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span class=\"intranet__desktop-menu_user-inner\">\n\t\t\t\t\t\t\t\t<span class=\"intranet__desktop-menu_user-name\">${this.currentUser.portal}</span>\n\t\t\t\t\t\t\t\t<span class=\"intranet__desktop-menu_user-post\">${this.currentUser.work_position}</span>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span class=\"intranet__desktop-menu_user-inner-after\"></span>\n\t\t\t\t\t\t</div>\n\t\t`;\n\n\t\tDom.append(userData, block);\n\n\t\tconst avatar = document.getElementsByClassName('ui-icon-common-user-desktop')[0];\n\t\tconst previewImage = this.getAvatarUrl(this.currentUser);\n\t\tDom.style(avatar, '--ui-icon-service-bg-image', previewImage);\n\t}\n\n\tgetAvatarUrl(account): string\n\t{\n\t\tlet avatarUrl = '';\n\n\t\tif (account.avatar.includes('http://') || account.avatar.includes('https://'))\n\t\t{\n\t\t\tavatarUrl = account.avatar;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tavatarUrl = `${account.protocol}://${account.portal}${account.avatar}`;\n\t\t}\n\n\t\treturn `url('${BX.util.htmlspecialchars(account.avatar === Account.defaultAvatar ? Account.defaultAvatarDesktop : BX.util.htmlspecialchars(avatarUrl))}')`;\n\t}\n\n\tviewPopupAccounts(): void\n\t{\n\t\tif (this.currentUser === null)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst menuPopup = document.getElementsByClassName('intranet__desktop-menu_popup')[0];\n\t\tlet position = '';\n\n\t\tif (Type.isStringFilled(this.currentUser.work_position))\n\t\t{\n\t\t\tposition = `<span class=\"intranet__desktop-menu_popup-post\">${this.currentUser.work_position}</span>`;\n\t\t}\n\n\t\tthis.removeElements('intranet__desktop-menu_popup-header');\n\n\t\tconst item = Tag.render`\n\t\t\t<div class=\"intranet__desktop-menu_popup-header\">\n\t\t\t\t<span class=\"intranet__desktop-menu_user-avatar ui-icon ui-icon-common-user ui-icon-common-user-popup\">\n\t\t\t\t\t<i></i>\n\t\t\t\t</span>\n\t\t\t\t<span class=\"intranet__desktop-menu_popup-label\">${this.currentUser.portal}</span>\n\t\t\t\t<div class=\"intranet__desktop-menu_popup-header-user\" onclick=\"BX.SidePanel.Instance.open('${this.currentUser.profile}')\">\n\t\t\t\t\t<span class=\"intranet__desktop-menu_popup-name intranet__desktop-menu_popup-name--chevron\">\n\t\t\t\t\t\t${`${this.currentUser.first_name} ${this.currentUser.last_name}`}\n\t\t\t\t\t</span>\n\t\t\t\t\t${position}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tDom.insertBefore(item, menuPopup.firstElementChild);\n\n\t\tconst avatar = document.getElementsByClassName('ui-icon-common-user-popup')[0];\n\t\tconst previewImage = this.getAvatarUrl(this.currentUser);\n\t\tDom.style(avatar, '--ui-icon-service-bg-image', previewImage);\n\n\t\tconst block = document.getElementsByClassName('intranet__desktop-menu_popup-list')[0];\n\n\t\tthis.removeElements('intranet__desktop-menu_popup-item-account');\n\n\t\tlet index = 0;\n\t\tconst users = this.getTabUsers();\n\t\tfor (const account of this.accounts)\n\t\t{\n\t\t\tlet currentUserClass = '';\n\t\t\tlet currentUserConnected = '';\n\t\t\tlet counters = 0;\n\t\t\tconst isSelected = users.some(\n\t\t\t\t(x) => parseInt(x.id, 10) === parseInt(account.id, 10)\n\t\t\t\t\t&& x.portal === account.portal,\n\t\t\t);\n\t\t\tif (isSelected)\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\tparseInt(account.id, 10) === parseInt(this.currentUser.id, 10)\n\t\t\t\t\t&& account.portal === this.currentUser.portal\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tcounters = this.getSumCounters();\n\t\t\t\t\tcurrentUserConnected = '--selected';\n\t\t\t\t}\n\t\t\t\tcurrentUserClass = '--connected';\n\t\t\t}\n\n\t\t\tconst countersView = counters > 99 ? '99+' : counters;\n\n\t\t\tconst item = Tag.render`\n\t\t\t\t<li class=\"intranet__desktop-menu_popup-item intranet__desktop-menu_popup-item-account ${counters > 0 ? 'intranet__desktop-menu_item_counters' : ''} ${currentUserClass} ${currentUserConnected}\">\n\t\t\t\t\t<span class=\"intranet__desktop-menu_user-avatar ui-icon ui-icon-common-user ui-icon-common-user-${index}\">\n\t\t\t\t\t\t<i></i>\n\t\t\t\t\t\t<div class=\"intranet__desktop-menu_user-counter ui-counter ui-counter-md ui-counter-danger\">\n\t\t\t\t\t\t\t<div class=\"ui-counter-inner\">${countersView}</div>\n\t\t\t\t\t\t</div>\t\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class=\"intranet__desktop-menu_popup-user\">\n\t\t\t\t\t\t<span class=\"intranet__desktop-menu_popup-name\">${account.portal}</span>\n\t\t\t\t\t\t<span class=\"intranet__desktop-menu_popup-post\">${account.login}</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class=\"intranet__desktop-menu_popup-btn ui-icon-set --more\" id=\"ui-icon-set-${index}\"></span>\n\t\t\t\t</li>\n\t\t\t`;\n\n\t\t\tDom.insertBefore(item, block.children[index]);\n\n\t\t\tthis.openTabOrConnectAccount(account, item);\n\t\t\tthis.addContextMenu(account, index, isSelected);\n\n\t\t\tconst userAvatar = document.getElementsByClassName(`ui-icon-common-user-${index}`)[0];\n\t\t\tconst previewUserImage = this.getAvatarUrl(account);\n\t\t\tDom.style(userAvatar, '--ui-icon-service-bg-image', previewUserImage);\n\n\t\t\tindex++;\n\t\t}\n\t}\n\n\topenTabOrConnectAccount(account: DesktopAccount, item: any): void\n\t{\n\t\tconst block = item.querySelector('.intranet__desktop-menu_popup-user');\n\t\tEvent.bind(block, 'click', () => {\n\t\t\tconst siteUrl = `${account.protocol}://${account.portal}`;\n\n\t\t\tif (this.isAccountConnected(account))\n\t\t\t{\n\t\t\t\twindow.open(siteUrl, '_blank');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#getLoader().show();\n\t\t\tthis.connectAccount(account, () => {\n\t\t\t\tthis.checkConnectedAccountAndStopLoader(account, 0, this.hideLoader);\n\t\t\t});\n\t\t});\n\t}\n\n\tconnectAccount(account: DesktopAccount, callback: Function): void\n\t{\n\t\tconst { host, login, protocol } = account;\n\t\tconst userLang = navigator.language;\n\t\tDesktopApi.connectAccount(host, login, protocol, userLang);\n\t\tcallback();\n\t}\n\n\tisAccountConnected(account: DesktopAccount): boolean\n\t{\n\t\tconst users = this.getTabUsers();\n\n\t\treturn users.some(\n\t\t\t(user) => parseInt(user.id, 10) === parseInt(account.id, 10) && user.portal === account.portal,\n\t\t);\n\t}\n\n\tcheckConnectedAccountAndStopLoader(account: DesktopAccount, counter: number, callback: Function): void\n\t{\n\t\tif (counter >= 5)\n\t\t{\n\t\t\tthis.reload();\n\t\t\tcallback();\n\n\t\t\treturn;\n\t\t}\n\n\t\tsetTimeout(() => {\n\t\t\tthis.reloadAccounts();\n\t\t\tconst upAccount = this.getAccountBy(account);\n\t\t\tif (upAccount.connected)\n\t\t\t{\n\t\t\t\tcallback();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.checkConnectedAccountAndStopLoader(account, counter + 1, callback);\n\t\t\t}\n\t\t}, 1000);\n\t}\n\n\taddContextMenu(account: DesktopAccount, index: number, isSelected: boolean): void\n\t{\n\t\tconst button = document.getElementById(`ui-icon-set-${index}`);\n\t\tif (this.contextPopup[index])\n\t\t{\n\t\t\tthis.contextPopup[index].destroy();\n\t\t}\n\t\tthis.contextPopup[index] = new Menu({\n\t\t\tbindElement: button,\n\t\t\tclassName: 'intranet__desktop-menu_context',\n\t\t\titems: [\n\t\t\t\tisSelected\n\t\t\t\t\t? {\n\t\t\t\t\t\ttext: Loc.getMessage('MENU_ACCOUNT_POPUP_DISCONNECT'),\n\t\t\t\t\t\tonclick: () => this.disconnectAccount(account, index),\n\t\t\t\t\t}\n\t\t\t\t\t:\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('MENU_ACCOUNT_POPUP_CONNECT'),\n\t\t\t\t\t\tonclick: (event) => this.connectAccountFromMenu(account, event, index),\n\t\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttext: Loc.getMessage('MENU_ACCOUNT_POPUP_REMOVE'),\n\t\t\t\t\tonclick: async () => this.removeAccount(account, index),\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\n\t\tEvent.bind(button, 'click', (event) => this.handleContextMenu(event));\n\t}\n\n\tremoveAccount(account: DesktopAccount, index: number): void\n\t{\n\t\tshowDesktopDeleteConfirm().then((userChoice) => {\n\t\t\tif (userChoice)\n\t\t\t{\n\t\t\t\tconst { host, login } = account;\n\t\t\t\tDesktopApi.deleteAccount(host, login);\n\t\t\t\tPopupManager.getPopupById(PopupType.userProfile)?.close();\n\t\t\t\tthis.reload();\n\t\t\t}\n\t\t\tthis.closeContextMenu(index);\n\t\t});\n\t}\n\n\tdisconnectAccount(account: DesktopAccount, index: number): void\n\t{\n\t\tconst { host } = account;\n\t\t// eslint-disable-next-line no-undef\n\t\tBXDesktopSystem?.AccountDisconnect(host);\n\t\tthis.closeContextMenu(index);\n\t}\n\n\tconnectAccountFromMenu(account: DesktopAccount, event: Event, index: number): void\n\t{\n\t\tconst { host, login, protocol } = account;\n\t\tconst userLang = navigator.language;\n\t\tthis.#getLoader().show();\n\t\tDesktopApi.connectAccount(host, login, protocol, userLang);\n\t\tevent.stopPropagation();\n\n\t\tthis.checkConnectedAccountAndStopLoader(account, 0, () => {\n\t\t\tthis.#getLoader().hide();\n\t\t\tthis.closeContextMenu(index);\n\t\t});\n\t}\n\n\thandleContextMenu(event: Event): void\n\t{\n\t\tconst index: number = parseInt(event.target.id.replace('ui-icon-set-', ''), 10);\n\t\tif (this.contextPopup[index])\n\t\t{\n\t\t\tthis.contextPopup[index].show();\n\t\t}\n\t}\n\n\tcloseContextMenu(index: number): void\n\t{\n\t\tif (this.contextPopup[index])\n\t\t{\n\t\t\tthis.contextPopup[index].close();\n\t\t}\n\t\tthis.popup.close();\n\t}\n\n\topenLoginTab(): void\n\t{\n\t\tDesktopApi.openAddAccountTab();\n\t}\n}\n","import { BaseEvent, EventEmitter } from 'main.core.events';\n\nexport default class Counters\n{\n\tinit()\n\t{\n\t\t// All Counters\n\t\tEventEmitter.subscribe('onPullEvent-main', (event: BaseEvent) => {\n\t\t\tconst [command, params] = event.getCompatData();\n\t\t\tif (command === 'user_counter' && params[Loc.getMessage('SITE_ID')])\n\t\t\t{\n\t\t\t\tconst counters = { ...params[Loc.getMessage('SITE_ID')] };\n\t\t\t\tthis.updateCounters(counters, false);\n\t\t\t}\n\t\t});\n\n\t\tBX.addCustomEvent(\"onPullEvent-tasks\", (command, params) => {\n\t\t\tif (\n\t\t\t\tcommand === \"user_counter\"\n\t\t\t\t&& Number(params.userId) === Number(BX.Loc.getMessage('USER_ID'))\n\t\t\t)\n\t\t\t{\n\t\t\t\tlet counters = {};\n\t\t\t\tif (!BX.Type.isUndefined(params.projects_major))\n\t\t\t\t{\n\t\t\t\t\tcounters.projects_major = params.projects_major;\n\t\t\t\t}\n\t\t\t\tif (!BX.Type.isUndefined(params.scrum_total_comments))\n\t\t\t\t{\n\t\t\t\t\tcounters.scrum_total_comments = params.scrum_total_comments;\n\t\t\t\t}\n\n\t\t\t\tthis.updateCounters(counters, false);\n\t\t\t}\n\t\t});\n\n\t\t// All Counters from IM\n\t\tEventEmitter.subscribe('onImUpdateCounter', (event: BaseEvent) => {\n\t\t\tconst [counters] = event.getCompatData();\n\t\t\tthis.updateCounters(counters, false);\n\t\t});\n\n\t\t// Messenger counter\n\t\tEventEmitter.subscribe('onImUpdateCounterMessage', (event: BaseEvent) => {\n\t\t\tconst [counter] = event.getCompatData();\n\t\t\tthis.updateCounters({ 'im-message': counter }, false);\n\t\t});\n\n\t\tif (BX.browser.SupportLocalStorage())\n\t\t{\n\t\t\tBX.addCustomEvent(window, 'onLocalStorageSet', (params) =>\n\t\t\t{\n\t\t\t\tif (params.key.substring(0, 4) === 'lmc-')\n\t\t\t\t{\n\t\t\t\t\tlet counters = {};\n\t\t\t\t\tcounters[params.key.substring(4)] = params.value;\n\t\t\t\t\tthis.updateCounters(counters, false);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// Live Feed Counter\n\t\tEventEmitter.subscribe('onCounterDecrement', (event: BaseEvent) => {\n\t\t\tconst [decrement] = event.getCompatData();\n\t\t\tthis.decrementCounter(document.getElementById('menu-counter-live-feed'), decrement);\n\t\t});\n\t}\n\n\tupdateCounters(counters, send)\n\t{\n\t\tBX.ready(function ()\n\t\t{\n\t\t\tif (BX.getClass(\"BX.Intranet.DescktopLeftMenu\"))\n\t\t\t{\n\t\t\t\tBX.Intranet.DescktopLeftMenu.updateCounters(counters, send);\n\t\t\t}\n\t\t});\n\t}\n\n\tdecrementCounter(node, iDecrement)\n\t{\n\t\tBX.ready(function ()\n\t\t{\n\t\t\tif (BX.getClass(\"BX.Intranet.DescktopLeftMenu\"))\n\t\t\t{\n\t\t\t\tBX.Intranet.DescktopLeftMenu.decrementCounter(node, iDecrement);\n\t\t\t}\n\t\t});\n\t}\n}\n","import {Type} from 'main.core';\n\nexport default class Item\n{\n\tparentContainer: Element;\n\tcontainer: Element;\n\n\tconstructor(parentContainer, container)\n\t{\n\t\tthis.parentContainer = parentContainer;\n\t\tthis.container = container;\n\t\tthis.init();\n\t}\n\n\tinit(): void\n\t{\n\t\tthis.makeTextIcons();\n\t}\n\n\tgetId(): string\n\t{\n\t\treturn this.container.dataset.id;\n\t}\n\n\tgetCode(): string\n\t{\n\t\treturn this.constructor.code;\n\t}\n\n\tgetName(): string\n\t{\n\t\treturn this.container.querySelector(\"[data-role='item-text']\").textContent;\n\t}\n\n\tstatic detect(node: Element)\n\t{\n\t\treturn node.getAttribute(\"data-role\") !== 'group' &&\n\t\t\tnode.getAttribute(\"data-type\") === this.code;\n\t}\n\n\tmakeTextIcons(): void\n\t{\n\t\tif (!this.container.classList.contains(\"menu-item-no-icon-state\"))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst icon = this.container.querySelector(\".menu-item-icon\");\n\t\tconst text = this.container.querySelector(\".menu-item-link-text\");\n\n\t\tif (icon && text)\n\t\t{\n\t\t\ticon.textContent = this.getShortName(text.textContent);\n\t\t}\n\t}\n\n\tgetCounterValue(): ?number\n\t{\n\t\tconst node = this.container.querySelector('[data-role=\"counter\"]');\n\t\tif (!node)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\treturn parseInt(node.dataset.counterValue);\n\t}\n\n\tupdateCounter(counterValue): undefined|Object\n\t{\n\t\tconst node = this.container.querySelector('[data-role=\"counter\"]');\n\t\tif (!node)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst oldValue = parseInt(node.dataset.counterValue) || 0;\n\t\tnode.dataset.counterValue = counterValue;\n\n\t\tif (counterValue > 0)\n\t\t{\n\t\t\tnode.innerHTML = (counterValue > 99 ? '99+' : counterValue);\n\t\t\tthis.container.classList.add('intranet__desktop-menu_item_counters');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tnode.innerHTML = '';\n\t\t\tthis.container.classList.remove('menu-item-with-index');\n\t\t}\n\n\t\treturn {oldValue, newValue: counterValue};\n\t}\n\n\tgetShortName(name): string\n\t{\n\t\tif (!Type.isStringFilled(name))\n\t\t{\n\t\t\treturn \"...\";\n\t\t}\n\n\t\tname = name.replace(/['`\".,:;~|{}*^$#@&+\\-=?!()[\\]<>\\n\\r]+/g, \"\").trim();\n\t\tif (name.length <= 0)\n\t\t{\n\t\t\treturn '...';\n\t\t}\n\n\t\tlet shortName;\n\t\tlet words = name.split(/[\\s,]+/);\n\t\tif (words.length <= 1)\n\t\t{\n\t\t\tshortName = name.substring(0, 1);\n\t\t}\n\t\telse if (words.length === 2)\n\t\t{\n\t\t\tshortName = words[0].substring(0, 1) + words[1].substring(0, 1);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet firstWord = words[0];\n\t\t\tlet secondWord = words[1];\n\n\t\t\tfor (let i = 1; i < words.length; i++)\n\t\t\t{\n\t\t\t\tif (words[i].length > 3)\n\t\t\t\t{\n\t\t\t\t\tsecondWord = words[i];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tshortName = firstWord.substring(0, 1) + secondWord.substring(0, 1);\n\t\t}\n\n\t\treturn shortName.toUpperCase();\n\t}\n}","import Item from './item';\n\nexport default class ItemAdminShared extends Item\n{\n\tstatic code = 'admin';\n}","import Item from './item';\n\nexport default class ItemAdminShared extends Item\n{\n\tstatic code = 'custom';\n}","import Item from './item';\n\nexport default class ItemUserFavorites extends Item\n{\n\tstatic code = 'standard';\n}","import Item from './item';\n\nexport default class ItemUserSelf extends Item\n{\n\tstatic code = 'self';\n}","import Item from './item';\n\nexport default class ItemSystem extends Item\n{\n\tstatic code = 'default';\n}","import Item from './item';\nimport ItemAdminShared from './item-admin-shared';\nimport ItemAdminCustom from './item-admin-custom';\nimport ItemUserFavorites from './item-user-favorites';\nimport ItemUserSelf from './item-user-self';\nimport ItemSystem from './item-system';\n\nconst itemMappings = [\n\tItem,\n\tItemAdminShared,\n\tItemUserFavorites,\n\tItemAdminCustom,\n\tItemUserSelf,\n\tItemSystem,\n];\n\nexport default function getItem(itemData: Element): Item\n{\n\tlet itemClassName = Item;\n\titemMappings.forEach((itemClass) => {\n\t\tif (itemClass.detect(itemData))\n\t\t{\n\t\t\titemClassName = itemClass;\n\t\t}\n\t});\n\treturn itemClassName;\n}","import getItem from '../items';\nimport Item from '../items/item';\nimport { DesktopApi } from 'im.v2.lib.desktop-api';\n\nexport default class ItemsController\n{\n\tparentContainer: Element;\n\tcontainer: Element;\n\titems: Map = new Map();\n\t#updateCountersLastValue = null\n\n\tconstructor(container: Element)\n\t{\n\t\tthis.parentContainer = container;\n\t\tthis.container = container.querySelector(\".menu-items\");\n\n\t\tcontainer\n\t\t\t.querySelectorAll('li.menu-item-block')\n\t\t\t.forEach(this.registerItem.bind(this))\n\t\t;\n\t}\n\n\tregisterItem(node: Element): Item\n\t{\n\t\tconst itemClass = getItem(node);\n\t\tconst item = new itemClass(this.container, node);\n\t\tthis.items.set(item.getId(), item);\n\n\t\treturn item;\n\t}\n\n\tupdateCounters(counters: Object, send: boolean): void\n\t{\n\t\tlet countersDynamic = null;\n\t\tsend = send !== false;\n\t\t[...Object.entries(counters)]\n\t\t\t.forEach(([counterId, counterValue]) => {\n\t\t\t\t[...this.#getItemsByCounterId(counterId)]\n\t\t\t\t\t.forEach((item) => {\n\t\t\t\t\t\tconst {oldValue, newValue} = item.updateCounter(counterValue);\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t(counterId.indexOf('crm_') < 0 || counterId.indexOf('crm_all') >= 0)\n\t\t\t\t\t\t\t&&\n\t\t\t\t\t\t\t(counterId.indexOf('tasks_') < 0 || counterId.indexOf('tasks_total') >= 0)\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcountersDynamic = countersDynamic || 0;\n\t\t\t\t\t\t\tcountersDynamic+= (newValue - oldValue);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t;\n\n\t\t\t\tif (send)\n\t\t\t\t{\n\t\t\t\t\tBX.localStorage.set('lmc-' + counterId, counterValue, 5);\n\t\t\t\t}\n\n\t\t\t\tif (typeof BXIM !== 'undefined')\n\t\t\t\t{\n\t\t\t\t\tif (this.#updateCountersLastValue === null)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#updateCountersLastValue = 0;\n\t\t\t\t\t\t[...this.items.entries()]\n\t\t\t\t\t\t\t.forEach(([id, item]) => {\n\t\t\t\t\t\t\t\tconst res = item.getCounterValue();\n\n\t\t\t\t\t\t\t\tif (res > 0)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tlet counterId = 'doesNotMatter';\n\t\t\t\t\t\t\t\t\tif (id.indexOf('menu_crm') >= 0 || id.indexOf('menu_tasks') >= 0)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tconst counterNode = item.container.querySelector('[data-role=\"counter\"]');\n\t\t\t\t\t\t\t\t\t\tif (counterNode)\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tcounterId = counterNode.id;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\tcounterId === 'doesNotMatter'\n\t\t\t\t\t\t\t\t\t\t|| counterId.indexOf('crm_all') >= 0\n\t\t\t\t\t\t\t\t\t\t|| counterId.indexOf('tasks_total') >= 0\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tthis.#updateCountersLastValue += res;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#updateCountersLastValue += (countersDynamic !== null ? countersDynamic : 0);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst visibleValue = (this.#updateCountersLastValue > 99 ? '99+' : (\n\t\t\t\t\t\tthis.#updateCountersLastValue < 0 ? '0' : this.#updateCountersLastValue\n\t\t\t\t\t));\n\n\t\t\t\t\tif (DesktopApi.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\tDesktopApi.setBrowserIconBadge(visibleValue);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\n\t}\n\n\t#getItemsByCounterId(counterId: string): []\n\t{\n\t\tconst result = [];\n\t\t[...this.items.values()]\n\t\t\t.forEach((item: Item) => {\n\t\t\t\tconst node = item.container.querySelector('[data-role=\"counter\"]');\n\t\t\t\tif (node && node.id.indexOf(counterId) >= 0)\n\t\t\t\t{\n\t\t\t\t\tresult.push(item);\n\t\t\t\t}\n\t\t\t});\n\t\treturn result;\n\t}\n\n\tdecrementCounter(counters: Object): void\n\t{\n\t\t[...Object.entries(counters)]\n\t\t\t.forEach(([counterId, counterValue]) => {\n\t\t\t\tconst item = this.#getItemsByCounterId(counterId).shift();\n\t\t\t\tif (item)\n\t\t\t\t{\n\t\t\t\t\tconst value = item.getCounterValue();\n\t\t\t\t\tcounters[counterId] = value > counterValue ? (value - counterValue) : 0;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tdelete counters[counterId];\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\t\tthis.updateCounters(counters, false);\n\t}\n}","import {Tag, Type, Text } from 'main.core';\n\nexport class BrowserHistory\n{\n\twrapper: HTMLElement;\n\titems = [];\n\n\tconstructor()\n\t{\n\t\tthis.wrapper = document.getElementById(\"history-items\");\n\t}\n\n\tinit(): void\n\t{\n\t\tif ('object' != typeof BXDesktopSystem)\n\t\t{\n\t\t\tconsole.log('BXDesktopSystem is empty');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.items = BXDesktopSystem?.BrowserHistory();\n\n\t\tthis.showHistory();\n\t}\n\n\tshowHistory(): void\n\t{\n\t\tlet i = 0;\n\t\tthis.items.forEach((item) => {\n\t\t\tif (i > 15 || !item.url.startsWith(location.origin)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tlet icoName = '';\n\t\t\tlet title = '';\n\t\t\tif (Type.isStringFilled(item.title))\n\t\t\t{\n\t\t\t\ticoName = this.getShortName(Text.encode(item.title));\n\t\t\t\ttitle = Text.encode(item.title);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (item.url.includes('/desktop_app/'))\n\t\t\t\t{\n\t\t\t\t\ticoName = Loc.getMessage('MENU_HISTORY_ITEM_ICON');\n\t\t\t\t\ttitle = Loc.getMessage('MENU_HISTORY_ITEM_NAME');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (item.url.includes('/desktop/menu'))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet url = Text.encode(item.url);\n\n\t\t\tlet li = Tag.render`\n\t\t\t\t<li class=\"intranet__desktop-menu_item\">\n\t\t\t\t\t<a class=\"intranet__desktop-menu_item-link\" href=\"${url}\">\n\t\t\t\t\t\t<span class=\"intranet__desktop-menu_item-icon --custom\">${icoName}</span>\n\t\t\t\t\t\t<span class=\"intranet__desktop-menu_item-title\">${title}</span>\n\t\t\t\t\t</a>\n\t\t\t\t</li>\n\t\t\t`;\n\n\t\t\tthis.wrapper.appendChild(li);\n\t\t\ti++;\n\t\t});\n\t}\n\n\tgetShortName(name): string\n\t{\n\t\tif (!Type.isStringFilled(name))\n\t\t{\n\t\t\treturn \"...\";\n\t\t}\n\n\t\tname = name.replace(/['`\".,:;~|{}*^$#@&+\\-=?!()[\\]<>\\n\\r]+/g, \"\").trim();\n\t\tif (name.length <= 0)\n\t\t{\n\t\t\treturn '...';\n\t\t}\n\n\t\tlet shortName;\n\t\tlet words = name.split(/[\\s,]+/);\n\t\tif (words.length <= 1)\n\t\t{\n\t\t\tshortName = name.substring(0, 1);\n\t\t}\n\t\telse if (words.length === 2)\n\t\t{\n\t\t\tshortName = words[0].substring(0, 1) + words[1].substring(0, 1);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet firstWord = words[0];\n\t\t\tlet secondWord = words[1];\n\n\t\t\tfor (let i = 1; i < words.length; i++)\n\t\t\t{\n\t\t\t\tif (words[i].length > 3)\n\t\t\t\t{\n\t\t\t\t\tsecondWord = words[i];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tshortName = firstWord.substring(0, 1) + secondWord.substring(0, 1);\n\t\t}\n\n\t\treturn shortName.toUpperCase();\n\t}\n\n}\n","import {Cache } from 'main.core';\nimport { Account } from './account/account';\nimport Counters from './api/counters';\nimport ItemsController from './controllers/items-controller';\nimport { BrowserHistory } from './history/browser-history';\n\nexport default class DesktopMenu\n{\n\tcache = new Cache.MemoryCache();\n\tbrowserHistory = null;\n\taccount = null;\n\ttheme = null;\n\t#specialLiveFeedDecrement = 0;\n\n\tconstructor(allCounters: Object)\n\t{\n\t\tthis.menuContainer = document.getElementById(\"menu-items-block\");\n\t\tif (!this.menuContainer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getItemsController();\n\t\tthis.getHistoryItems();\n\t\tthis.showAccount(allCounters);\n\t\tthis.runAPICounters();\n\t}\n\n\tgetItemsController(): ItemsController\n\t{\n\t\treturn this.cache.remember('itemsMenuController', () => {\n\t\t\treturn new ItemsController(this.menuContainer);\n\t\t});\n\t}\n\n\tgetHistoryItems(): void\n\t{\n\t\tthis.browserHistory = new BrowserHistory();\n\t\tthis.browserHistory.init();\n\t}\n\n\tshowAccount(allCounters): void\n\t{\n\t\tthis.account = new Account(allCounters);\n\t\tBX.Intranet.Account = this.account;\n\t}\n\n\trunAPICounters(): void\n\t{\n\t\tBX.Intranet.Counters = new Counters();\n\t\tBX.Intranet.Counters.init();\n\t}\n\n\tdecrementCounter(node, iDecrement): void\n\t{\n\t\tif (!node || node.id !== 'menu-counter-live-feed')\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.#specialLiveFeedDecrement += parseInt(iDecrement);\n\t\tthis.getItemsController().decrementCounter({\n\t\t\t'live-feed' : parseInt(iDecrement)\n\t\t});\n\t}\n\n\tupdateCounters(counters, send): void\n\t{\n\t\tif (!counters)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (counters['**'] !== undefined)\n\t\t{\n\t\t\tcounters['live-feed'] = counters['**'];\n\t\t\tdelete counters['**'];\n\t\t}\n\n\t\tif (counters['live-feed'])\n\t\t{\n\t\t\tif (counters['live-feed'] <= 0)\n\t\t\t{\n\t\t\t\tthis.#specialLiveFeedDecrement = 0;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcounters['live-feed'] -= this.#specialLiveFeedDecrement;\n\t\t\t}\n\t\t}\n\n\t\tthis.getItemsController().updateCounters(counters, send);\n\t\tBX.Intranet.Account.setCounters(counters);\n\t}\n}\n"],"names":["Account","constructor","allCounters","accounts","currentUser","contextPopup","popup","wrapper","loader","document","getElementById","checkCounters","reload","viewDesktopUser","initPopup","hideLoader","hide","counterId","Object","keys","key","getSumCounters","sum","val","parseInt","getTabUsers","Type","isUndefined","BXDesktopSystem","TabList","reloadAccounts","viewPopupAccounts","currentUserId","Loc","getMessage","DesktopApi","getAccountList","find","account","id","portal","location","hostname","getAccountBy","x","menuContent","querySelector","userNode","Popup","content","bindElement","width","background","closeIcon","closeByEsc","Event","bind","event","isShown","close","stopPropagation","show","withinBoundaries","composedPath","includes","setCounters","counters","newCounters","data","isObject","cId","sumCounters","block","getElementsByClassName","counterNode","innerHTML","Dom","hasClass","addClass","removeElements","className","elements","forEach","element","remove","counterBlock","countersView","Tag","render","userData","work_position","append","avatar","previewImage","getAvatarUrl","style","avatarUrl","protocol","BX","util","htmlspecialchars","defaultAvatar","defaultAvatarDesktop","menuPopup","position","isStringFilled","item","profile","first_name","last_name","insertBefore","firstElementChild","index","users","currentUserClass","currentUserConnected","isSelected","some","login","children","openTabOrConnectAccount","addContextMenu","userAvatar","previewUserImage","siteUrl","isAccountConnected","window","open","connectAccount","checkConnectedAccountAndStopLoader","callback","host","userLang","navigator","language","user","counter","setTimeout","upAccount","connected","button","destroy","Menu","items","text","onclick","disconnectAccount","connectAccountFromMenu","removeAccount","handleContextMenu","showDesktopDeleteConfirm","then","userChoice","deleteAccount","PopupManager","getPopupById","PopupType","userProfile","closeContextMenu","AccountDisconnect","target","replace","openLoginTab","openAddAccountTab","Loader","size","mode","strokeWidth","Counters","init","EventEmitter","subscribe","command","params","getCompatData","updateCounters","addCustomEvent","Number","userId","projects_major","scrum_total_comments","browser","SupportLocalStorage","substring","value","decrement","decrementCounter","send","ready","getClass","Intranet","DescktopLeftMenu","node","iDecrement","Item","parentContainer","container","makeTextIcons","getId","dataset","getCode","code","getName","textContent","detect","getAttribute","classList","contains","icon","getShortName","getCounterValue","counterValue","updateCounter","oldValue","add","newValue","name","trim","length","shortName","words","split","firstWord","secondWord","i","toUpperCase","ItemAdminShared","ItemUserFavorites","ItemUserSelf","ItemSystem","itemMappings","ItemAdminCustom","getItem","itemData","itemClassName","itemClass","ItemsController","Map","querySelectorAll","registerItem","set","countersDynamic","entries","indexOf","localStorage","BXIM","res","visibleValue","isDesktop","setBrowserIconBadge","shift","result","values","push","BrowserHistory","console","log","showHistory","url","startsWith","origin","icoName","title","Text","encode","li","appendChild","DesktopMenu","cache","Cache","MemoryCache","browserHistory","theme","menuContainer","getItemsController","getHistoryItems","showAccount","runAPICounters","remember","undefined"],"mappings":"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"}