this.BX=this.BX||{};(function(e,t,n,r,i,a,o){"use strict";var s,u,l;function c(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */c=function t(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function e(t,n,r){return t[n]=r}}function l(e,t,n,i){var a=t&&t.prototype instanceof f?t:f,o=Object.create(a.prototype),s=new T(i||[]);return r(o,"_invoke",{value:C(e,n,s)}),o}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var d={};function f(){}function h(){}function v(){}var m={};u(m,a,(function(){return this}));var b=Object.getPrototypeOf,y=b&&b(b(S([])));y&&y!==t&&n.call(y,a)&&(m=y);var g=v.prototype=f.prototype=Object.create(m);function _(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function i(r,a,o,s){var u=p(e[r],e,a);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==babelHelpers["typeof"](c)&&n.call(c,"__await")?t.resolve(c.__await).then((function(e){i("next",e,o,s)}),(function(e){i("throw",e,o,s)})):t.resolve(c).then((function(e){l.value=e,o(l)}),(function(e){return i("throw",e,o,s)}))}s(u.arg)}var a;r(this,"_invoke",{value:function e(n,r){function o(){return new t((function(e,t){i(n,r,e,t)}))}return a=a?a.then(o,o):o()}})}function C(e,t,n){var r="suspendedStart";return function(i,a){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw a;return P()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var s=w(o,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=p(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===d)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}function w(e,t){var n=t.method,r=e.iterator[n];if(undefined===r)return t.delegate=null,"throw"===n&&e.iterator["return"]&&(t.method="return",t.arg=undefined,w(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=p(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,d;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=undefined),t.delegate=null,d):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function H(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function S(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=undefined,t.done=!0,t};return i.next=i}}return{next:P}}function P(){return{value:undefined,done:!0}}return h.prototype=v,r(g,"constructor",{value:v,configurable:!0}),r(v,"constructor",{value:h,configurable:!0}),h.displayName=u(v,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,u(e,s,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},_(k.prototype),u(k.prototype,o,(function(){return this})),e.AsyncIterator=k,e.async=function(t,n,r,i,a){void 0===a&&(a=Promise);var o=new k(l(t,n,r,i),a);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},_(g),u(g,s,"Generator"),u(g,a,(function(){return this})),u(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=S,T.prototype={constructor:T,reset:function e(t){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method="next",this.arg=undefined,this.tryEntries.forEach(H),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=undefined)},stop:function e(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function e(t){if(this.done)throw t;var r=this;function i(e,n){return s.type="throw",s.arg=t,r.next=e,n&&(r.method="next",r.arg=undefined),!!n}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function e(t,r){for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=r&&r<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=t,s.arg=r,o?(this.method="next",this.next=o.finallyLoc,d):this.complete(s)},complete:function e(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),d},finish:function e(t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),H(r),d}},catch:function e(t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc===t){var i=r.completion;if("throw"===i.type){var a=i.arg;H(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function e(t,n,r){return this.delegate={iterator:S(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=undefined),d}},e}function p(e,t){var n=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=d(e))||t&&e&&typeof e.length==="number"){if(n)e=n;var r=0;var i=function e(){};return{s:i,n:function t(){if(r>=e.length)return{done:true};return{done:false,value:e[r++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a=true,o=false,s;return{s:function t(){n=n.call(e)},n:function e(){var t=n.next();a=t.done;return t},e:function e(t){o=true;s=t},f:function e(){try{if(!a&&n["return"]!=null)n["return"]()}finally{if(o)throw s}}}}function d(e,t){if(!e)return;if(typeof e==="string")return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor)n=e.constructor.name;if(n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return f(e,t)}function f(e,t){if(t==null||t>e.length)t=e.length;for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var h=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"accounts",[]);babelHelpers.defineProperty(this,"currentUser",null);babelHelpers.defineProperty(this,"contextPopup",[]);babelHelpers.defineProperty(this,"popup",null);babelHelpers.defineProperty(this,"allCounters",{});babelHelpers.defineProperty(this,"wrapper",null);this.wrapper=document.getElementById("history-items");this.checkCounters(t);this.reload();this.viewDesktopUser();this.initPopup()}babelHelpers.createClass(e,[{key:"checkCounters",value:function e(t){for(var n=0,r=Object.keys(t);n<r.length;n++){var i=r[n];var a=i;if(i==="**"){a="live-feed"}this.allCounters[a]=t[i]}}},{key:"getSumCounters",value:function e(){var t=0;for(var n=0,r=Object.keys(this.allCounters);n<r.length;n++){var i=r[n];if(i==="tasks_effective"||i==="invited_users"){continue}var a=this.allCounters[i]?parseInt(this.allCounters[i],10):0;t+=a}return t}},{key:"reload",value:function e(){var t=o.Loc.getMessage("USER_ID");this.accounts="undefined"!==typeof BXDesktopSystem?a.DesktopApi.getAccountList():[];this.currentUser=this.accounts.find((function(e){return e.id===t&&e.portal===location.hostname}));this.viewPopupAccounts()}},{key:"initPopup",value:function e(){var t=this;var r=document.querySelector(".intranet__desktop-menu_user-block");this.popup=new n.Popup({content:document.querySelector(".intranet__desktop-menu_popup"),bindElement:r,width:320,background:"#282e39",closeIcon:true,closeByEsc:true});o.Event.bind(r,"click",(function(){if(t.popup.isShown()){t.popup.close()}else{t.popup.show();t.reload()}}))}},{key:"setCounters",value:function e(t){var n=t;if(t["data"]){n=t.data;if(n[0]&&babelHelpers["typeof"](n[0])==="object"){n=n[0]}}for(var r=0,i=Object.keys(n);r<i.length;r++){var a=i[r];var s=a;if(a==="**"){s="live-feed"}this.allCounters[s]=n[a]}var u=this.getSumCounters();var l=document.getElementsByClassName("intranet__desktop-menu_user-block")[0];var c=l.querySelector('[data-role="counter"]');if(u>0){c.innerHTML=u>99?"99+":u;if(!o.Dom.hasClass(l,"intranet__desktop-menu_item_counters")){o.Dom.addClass(l,"intranet__desktop-menu_item_counters")}}else{c.innerHTML="";o.Dom.addClass(l,"intranet__desktop-menu_item_counters")}}},{key:"removeElements",value:function e(t){var n=document.getElementsByClassName(t);babelHelpers.toConsumableArray(n).forEach((function(e){e.remove()}))}},{key:"viewDesktopUser",value:function e(){var t=document.getElementsByClassName("intranet__desktop-menu_user")[0];var n=this.getSumCounters();var r=n>99?"99+":n;this.removeElements("intranet__desktop-menu_user-block");var i=o.Tag.render(s||(s=babelHelpers.taggedTemplateLiteral(['<div class="intranet__desktop-menu_user-block ','">\n\t\t\t\t<span class="intranet__desktop-menu_user-avatar ui-icon ui-icon-common-user ui-icon-common-user-desktop">\n\t\t\t\t\t<i></i>\n\t\t\t\t\t<div class="intranet__desktop-menu_user-counter ui-counter ui-counter-md ui-counter-danger">\n\t\t\t\t\t\t<div class="ui-counter-inner" data-role="counter">','</div>\n\t\t\t\t\t</div>\n\t\t\t\t</span>\n\t\t\t\t<span class="intranet__desktop-menu_user-inner">\n\t\t\t\t\t<span class="intranet__desktop-menu_user-name">','</span>\n\t\t\t\t\t<span class="intranet__desktop-menu_user-post">',"</span>\n\t\t\t\t</span>\n\t\t\t</div>"])),n>0?"intranet__desktop-menu_item_counters":"",r,this.currentUser.portal,this.currentUser.work_position);o.Dom.append(i,t);var a=document.getElementsByClassName("ui-icon-common-user-desktop")[0];var u=this.getAvatarUrl(this.currentUser);o.Dom.style(a,"--ui-icon-service-bg-image",u)}},{key:"getAvatarUrl",value:function t(n){var r="";if(n.avatar.includes("http://")||n.avatar.includes("https://")){r=n.avatar}else{r=n.protocol+"://"+n.portal+n.avatar}return"url('".concat(o.Text.encode(n.avatar===e.defaultAvatar?e.defaultAvatarDesctop:r),"')")}},{key:"viewPopupAccounts",value:function e(){var t=document.getElementsByClassName("intranet__desktop-menu_popup")[0];var n="";if(this.currentUser.work_position!==""){n='<span class="intranet__desktop-menu_popup-post">'.concat(this.currentUser.work_position,"</span>")}this.removeElements("intranet__desktop-menu_popup-header");var r=o.Tag.render(u||(u=babelHelpers.taggedTemplateLiteral(['<div class="intranet__desktop-menu_popup-header">\n\t\t\t<span class="intranet__desktop-menu_user-avatar ui-icon ui-icon-common-user ui-icon-common-user-popup">\n\t\t\t\t<i></i>\n\t\t\t</span>\n\t\t\t<span class="intranet__desktop-menu_popup-label">','</span>\n\t\t\t<div class="intranet__desktop-menu_popup-header-user">\n\t\t\t\t<span class="intranet__desktop-menu_popup-name">',"</span>\n\t\t\t\t","\n\t\t\t</div>\n\t\t</div>"])),this.currentUser.portal,this.currentUser.first_name+" "+this.currentUser.last_name,n);o.Dom.insertBefore(r,t.firstElementChild);var i=document.getElementsByClassName("ui-icon-common-user-popup")[0];var a=this.getAvatarUrl(this.currentUser);o.Dom.style(i,"--ui-icon-service-bg-image",a);var s=document.getElementsByClassName("intranet__desktop-menu_popup-list")[0];this.removeElements("intranet__desktop-menu_popup-item-account");var c=0;var d=p(this.accounts),f;try{for(d.s();!(f=d.n()).done;){var h=f.value;var v="";var m=0;if(h.id===this.currentUser.id&&h.portal===this.currentUser.portal){m=this.getSumCounters();v="--selected"}var b=m>99?"99+":m;var y=o.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['<li class="intranet__desktop-menu_popup-item intranet__desktop-menu_popup-item-account '," ",'">\n\t\t\t\t\t<span class="intranet__desktop-menu_user-avatar ui-icon ui-icon-common-user ui-icon-common-user-','">\n\t\t\t\t\t\t<i></i>\n\t\t\t\t\t\t<div class="intranet__desktop-menu_user-counter ui-counter ui-counter-md ui-counter-danger">\n\t\t\t\t\t\t\t<div class="ui-counter-inner">','</div>\n\t\t\t\t\t\t</div>\t\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class="intranet__desktop-menu_popup-user">\n\t\t\t\t\t\t<span class="intranet__desktop-menu_popup-name">','</span>\n\t\t\t\t\t\t<span class="intranet__desktop-menu_popup-post">','</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class="intranet__desktop-menu_popup-btn ui-icon-set --more" id="ui-icon-set-','"></span>\n\t\t\t\t</li>'])),m>0?"intranet__desktop-menu_item_counters":"",v,c,b,h.portal,h.login,c);o.Dom.insertBefore(y,s.children[c]);this.addContextMenu(h,c);var g=document.getElementsByClassName("ui-icon-common-user-"+c)[0];var _=this.getAvatarUrl(h);o.Dom.style(g,"--ui-icon-service-bg-image",_);c++}}catch(e){d.e(e)}finally{d.f()}}},{key:"addContextMenu",value:function e(i,s){var u=document.getElementById("ui-icon-set-".concat(s));var l=this.popup;var p=this.contextPopup;if(p[s]){p[s].destroy()}p[s]=new n.Menu({bindElement:u,className:"intranet__desktop-menu_context",items:[i.id===this.currentUser.id&&i.portal===this.currentUser.portal?{text:o.Loc.getMessage("MENU_ACCOUNT_POPUP_DISCONNECT"),onclick:function e(t,n){var r;var a=i.host;(r=BXDesktopSystem)===null||r===void 0?void 0:r.AccountDisconnect(a);if(p[s]){p[s].close()}l.close()}}:{text:o.Loc.getMessage("MENU_ACCOUNT_POPUP_CONNECT"),onclick:function e(t,n){var r=i.host,o=i.login,u=i.protocol;var c=navigator.language;a.DesktopApi.connectAccount(r,o,u,c);if(p[s]){p[s].close()}l.close()}},{text:o.Loc.getMessage("MENU_ACCOUNT_POPUP_REMOVE"),onclick:function(){var e=babelHelpers.asyncToGenerator(c().mark((function e(o,u){var d,f,h,v;return c().wrap((function e(o){while(1)switch(o.prev=o.next){case 0:o.next=2;return t.showDesktopDeleteConfirm();case 2:d=o.sent;if(d===true){h=i.host,v=i.login;a.DesktopApi.deleteAccount(h,v);(f=n.PopupManager.getPopupById(r.PopupType.userProfile))===null||f===void 0?void 0:f.close()}if(p[s]){p[s].close()}l.close();case 6:case"end":return o.stop()}}),e)})));function o(t,n){return e.apply(this,arguments)}return o}()}]});o.Event.bind(u,"click",(function(e){var t=parseInt(e.target.id.replace("ui-icon-set-",""));if(p[t]){p[t].show()}}))}},{key:"openLoginTab",value:function e(){a.DesktopApi.openAddAccountTab()}}]);return e}();babelHelpers.defineProperty(h,"defaultAvatar","/bitrix/js/im/images/blank.gif");babelHelpers.defineProperty(h,"defaultAvatarDesctop","/bitrix/js/ui/icons/b24/images/ui-user.svg?v2");function v(e,t){m(e,t);t.add(e)}function m(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function b(e,t,n){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return n}var y=new WeakSet;var g=new WeakSet;var _=new WeakSet;var k=new WeakSet;var C=function e(){var t,n=this;babelHelpers.classCallCheck(this,e);v(this,k);v(this,_);v(this,g);v(this,y);babelHelpers.defineProperty(this,"backgroundNode",null);var r=(t=b(this,y,w).call(this))===null||t===void 0?void 0:t.getAppliedTheme();this.backgroundNode=document.querySelector("body");if(r){b(this,g,E).call(this,r)}i.EventEmitter.subscribe("BX.Intranet.Bitrix24:ThemePicker:onThemeApply",(function(e){b(n,g,E).call(n,e.data.theme)}))};function w(){var e,t,n,r,i;return(e=(t=BX.Intranet)===null||t===void 0?void 0:(n=t.Bitrix24)===null||n===void 0?void 0:n.ThemePicker.Singleton)!==null&&e!==void 0?e:(r=top.BX.Intranet)===null||r===void 0?void 0:(i=r.Bitrix24)===null||i===void 0?void 0:i.ThemePicker.Singleton}function E(e){e.video?b(this,k,T).call(this,e):b(this,_,H).call(this,e);o.Dom.removeClass(this.backgroundNode,"bitrix24-theme-default bitrix24-theme-dark bitrix24-theme-light");var t="bitrix24-theme-default";if(e.id!=="default"&&String(e.id).indexOf("default:")!==0){t=String(e.id).indexOf("dark:")===0?"bitrix24-theme-dark":"bitrix24-theme-light"}o.Dom.addClass(this.backgroundNode,t)}function H(e){var t=e.previewImage;if(o.Type.isArrayFilled(e.prefetchImages)){t=e.prefetchImages[e.prefetchImages.length-1]}var n="url('".concat(o.Text.encode(t),"')");o.Dom.style(this.backgroundNode,"backgroundImage",n)}function T(e){var t=[];for(var n in e.video.sources){t.push(BX.create("source",{attrs:{type:"video/".concat(n),src:e.video.sources[n]}}))}var r=o.Dom.create("div",{props:{className:"theme-video-container"},dataset:{themeId:e.id},children:[o.Dom.create("video",{props:{className:"theme-video"},attrs:{poster:e.video.poster,autoplay:true,loop:true,muted:true,playsinline:true},dataset:{themeId:e.id},children:t})]});o.Dom.prepend(r,this.backgroundNode)}var S=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,[{key:"init",value:function e(){var t=this;BX.addCustomEvent("onPullEvent-main",(function(e,n){var r="SITE_ID";var i=BX.message(r);if(e==="user_counter"&&n[i]){var a=BX.clone(n[i]);t.updateCounters(a,false)}}));BX.addCustomEvent("onPullEvent-tasks",(function(e,n){if(e==="user_counter"&&Number(n.userId)===Number(BX.Loc.getMessage("USER_ID"))){var r={};if(!BX.Type.isUndefined(n.projects_major)){r.projects_major=n.projects_major}if(!BX.Type.isUndefined(n.scrum_total_comments)){r.scrum_total_comments=n.scrum_total_comments}t.updateCounters(r,false)}}));BX.addCustomEvent(window,"onImUpdateCounter",(function(e){if(!e)return;t.updateCounters(BX.clone(e),false)}));BX.addCustomEvent("onImUpdateCounterMessage",(function(e){t.updateCounters({"im-message":e},false)}));if(BX.browser.SupportLocalStorage()){BX.addCustomEvent(window,"onLocalStorageSet",(function(e){if(e.key.substring(0,4)==="lmc-"){var n={};n[e.key.substring(4)]=e.value;t.updateCounters(n,false)}}))}BX.addCustomEvent("onCounterDecrement",(function(e){t.decrementCounter(BX("menu-counter-live-feed"),e)}))}},{key:"updateCounters",value:function e(t,n){BX.ready((function(){if(BX.getClass("BX.Intranet.DescktopLeftMenu")){BX.Intranet.DescktopLeftMenu.updateCounters(t,n)}}))}},{key:"decrementCounter",value:function e(t,n){BX.ready((function(){if(BX.getClass("BX.Intranet.DescktopLeftMenu")){BX.Intranet.DescktopLeftMenu.decrementCounter(t,n)}}))}}]);return e}();var P=function(){function e(t,n){babelHelpers.classCallCheck(this,e);this.parentContainer=t;this.container=n;this.init()}babelHelpers.createClass(e,[{key:"init",value:function e(){this.makeTextIcons()}},{key:"getId",value:function e(){return this.container.dataset.id}},{key:"getCode",value:function e(){return this.constructor.code}},{key:"getName",value:function e(){return this.container.querySelector("[data-role='item-text']").textContent}},{key:"makeTextIcons",value:function e(){if(!this.container.classList.contains("menu-item-no-icon-state")){return}var t=this.container.querySelector(".menu-item-icon");var n=this.container.querySelector(".menu-item-link-text");if(t&&n){t.textContent=this.getShortName(n.textContent)}}},{key:"getCounterValue",value:function e(){var t=this.container.querySelector('[data-role="counter"]');if(!t){return null}return parseInt(t.dataset.counterValue)}},{key:"updateCounter",value:function e(t){var n=this.container.querySelector('[data-role="counter"]');if(!n){return}var r=parseInt(n.dataset.counterValue)||0;n.dataset.counterValue=t;if(t>0){n.innerHTML=t>99?"99+":t;this.container.classList.add("intranet__desktop-menu_item_counters")}else{n.innerHTML="";this.container.classList.remove("menu-item-with-index")}return{oldValue:r,newValue:t}}},{key:"getShortName",value:function e(t){if(!o.Type.isStringFilled(t)){return"..."}t=t.replace(/['`".,:;~|{}*^$#@&+\-=?!()[\]<>\n\r]+/g,"").trim();if(t.length<=0){return"..."}var n;var r=t.split(/[\s,]+/);if(r.length<=1){n=t.substring(0,1)}else if(r.length===2){n=r[0].substring(0,1)+r[1].substring(0,1)}else{var i=r[0];var a=r[1];for(var s=1;s<r.length;s++){if(r[s].length>3){a=r[s];break}}n=i.substring(0,1)+a.substring(0,1)}return n.toUpperCase()}}],[{key:"detect",value:function e(t){return t.getAttribute("data-role")!=="group"&&t.getAttribute("data-type")===this.code}}]);return e}();var O=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(P);babelHelpers.defineProperty(O,"code","admin");var x=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(P);babelHelpers.defineProperty(x,"code","custom");var B=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(P);babelHelpers.defineProperty(B,"code","standard");var L=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(P);babelHelpers.defineProperty(L,"code","self");var I=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(P);babelHelpers.defineProperty(I,"code","default");var M=[P,O,B,x,L,I];function A(e){var t=P;M.forEach((function(n){if(n.detect(e)){t=n}}));return t}function N(e,t){D(e,t);t.add(e)}function U(e,t,n){D(e,t);t.set(e,n)}function D(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function X(e,t,n){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return n}var j=new WeakMap;var R=new WeakSet;var F=function(){function e(t){babelHelpers.classCallCheck(this,e);N(this,R);babelHelpers.defineProperty(this,"items",new Map);U(this,j,{writable:true,value:null});this.parentContainer=t;this.container=t.querySelector(".menu-items");t.querySelectorAll("li.menu-item-block").forEach(this.registerItem.bind(this))}babelHelpers.createClass(e,[{key:"registerItem",value:function e(t){var n=A(t);var r=new n(this.container,t);this.items.set(r.getId(),r);return r}},{key:"updateCounters",value:function e(t,n){var r=this;var i=null;n=n!==false;babelHelpers.toConsumableArray(Object.entries(t)).forEach((function(e){var t=babelHelpers.slicedToArray(e,2),o=t[0],s=t[1];babelHelpers.toConsumableArray(X(r,R,G).call(r,o)).forEach((function(e){var t=e.updateCounter(s),n=t.oldValue,r=t.newValue;if((o.indexOf("crm_")<0||o.indexOf("crm_all")>=0)&&(o.indexOf("tasks_")<0||o.indexOf("tasks_total")>=0)){i=i||0;i+=r-n}}));if(n){BX.localStorage.set("lmc-"+o,s,5)}if(typeof BXIM!=="undefined"){if(babelHelpers.classPrivateFieldGet(r,j)===null){babelHelpers.classPrivateFieldSet(r,j,0);babelHelpers.toConsumableArray(r.items.entries()).forEach((function(e){var t=babelHelpers.slicedToArray(e,2),n=t[0],i=t[1];var a=i.getCounterValue();if(a>0){var o="doesNotMatter";if(n.indexOf("menu_crm")>=0||n.indexOf("menu_tasks")>=0){var s=i.container.querySelector('[data-role="counter"]');if(s){o=s.id}}if(o==="doesNotMatter"||o.indexOf("crm_all")>=0||o.indexOf("tasks_total")>=0){babelHelpers.classPrivateFieldSet(r,j,babelHelpers.classPrivateFieldGet(r,j)+a)}}}))}else{babelHelpers.classPrivateFieldSet(r,j,babelHelpers.classPrivateFieldGet(r,j)+(i!==null?i:0))}var u=babelHelpers.classPrivateFieldGet(r,j)>99?"99+":babelHelpers.classPrivateFieldGet(r,j)<0?"0":babelHelpers.classPrivateFieldGet(r,j);if(a.DesktopApi.isDesktop()){a.DesktopApi.setBrowserIconBadge(u)}}}))}},{key:"decrementCounter",value:function e(t){var n=this;babelHelpers.toConsumableArray(Object.entries(t)).forEach((function(e){var r=babelHelpers.slicedToArray(e,2),i=r[0],a=r[1];var o=X(n,R,G).call(n,i).shift();if(o){var s=o.getCounterValue();t[i]=s>a?s-a:0}else{delete t[i]}}));this.updateCounters(t,false)}}]);return e}();function G(e){var t=[];babelHelpers.toConsumableArray(this.items.values()).forEach((function(n){var r=n.container.querySelector('[data-role="counter"]');if(r&&r.id.indexOf(e)>=0){t.push(n)}}));return t}var q;var V=function(){function e(){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"items",[]);this.wrapper=document.getElementById("history-items")}babelHelpers.createClass(e,[{key:"init",value:function e(){var t;if("object"!=(typeof BXDesktopSystem==="undefined"?"undefined":babelHelpers["typeof"](BXDesktopSystem))){console.log("BXDesktopSystem is empty");return}this.items=(t=BXDesktopSystem)===null||t===void 0?void 0:t.BrowserHistory();this.showHistory()}},{key:"showHistory",value:function e(){var t=this;var n=0;this.items.forEach((function(e){if(n>15){return true}var r="";var i="";if(o.Type.isStringFilled(e.title)){r=t.getShortName(e.title);i=e.title}else{if(e.url.includes("/desktop_app/")){r=Loc.getMessage("MENU_HISTORY_ITEM_ICON");i=Loc.getMessage("MENU_HISTORY_ITEM_NAME")}else{return}}if(e.url.includes("/desktop/menu")){return}var a=e.url;if(e.url.includes("/online/")){a="bx://v2/"+location.hostname+"/chat/"}var s=o.Tag.render(q||(q=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<li class="intranet__desktop-menu_item">\n\t\t\t\t\t<a class="intranet__desktop-menu_item-link" href="','">\n\t\t\t\t\t\t<span class="intranet__desktop-menu_item-icon --custom">','</span>\n\t\t\t\t\t\t<span class="intranet__desktop-menu_item-title">',"</span>\n\t\t\t\t\t</a>\n\t\t\t\t</li>\n\t\t\t"])),a,r,i);t.wrapper.appendChild(s);n++}))}},{key:"getShortName",value:function e(t){if(!o.Type.isStringFilled(t)){return"..."}t=t.replace(/['`".,:;~|{}*^$#@&+\-=?!()[\]<>\n\r]+/g,"").trim();if(t.length<=0){return"..."}var n;var r=t.split(/[\s,]+/);if(r.length<=1){n=t.substring(0,1)}else if(r.length===2){n=r[0].substring(0,1)+r[1].substring(0,1)}else{var i=r[0];var a=r[1];for(var s=1;s<r.length;s++){if(r[s].length>3){a=r[s];break}}n=i.substring(0,1)+a.substring(0,1)}return n.toUpperCase()}}]);return e}();function J(e,t,n){W(e,t);t.set(e,n)}function W(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var Y=new WeakMap;var z=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"cache",new o.Cache.MemoryCache);babelHelpers.defineProperty(this,"browserHistory",null);babelHelpers.defineProperty(this,"account",null);babelHelpers.defineProperty(this,"theme",null);J(this,Y,{writable:true,value:0});this.menuContainer=document.getElementById("menu-items-block");if(!this.menuContainer){return false}this.initTheme();this.getItemsController();this.getHistoryItems();this.showAccount(t);this.runAPICounters()}babelHelpers.createClass(e,[{key:"initTheme",value:function e(){this.theme=new C}},{key:"getItemsController",value:function e(){var t=this;return this.cache.remember("itemsMenuController",(function(){return new F(t.menuContainer)}))}},{key:"getHistoryItems",value:function e(){this.browserHistory=new V;this.browserHistory.init()}},{key:"showAccount",value:function e(t){this.account=new h(t);BX.Intranet.Account=this.account}},{key:"runAPICounters",value:function e(){BX.Intranet.Counters=new S;BX.Intranet.Counters.init()}},{key:"decrementCounter",value:function e(t,n){if(!t||t.id!=="menu-counter-live-feed"){return}babelHelpers.classPrivateFieldSet(this,Y,babelHelpers.classPrivateFieldGet(this,Y)+parseInt(n));this.getItemsController().decrementCounter({"live-feed":parseInt(n)})}},{key:"updateCounters",value:function e(t,n){if(!t){return}if(t["**"]!==undefined){t["live-feed"]=t["**"];delete t["**"]}var r=false;if(!o.Type.isUndefined(t["**SG0"])){this.workgroupsCounterData["livefeed"]=t["**SG0"];delete t["**SG0"];r=true}if(!o.Type.isUndefined(t[o.Loc.getMessage("COUNTER_PROJECTS_MAJOR")])){this.workgroupsCounterData[o.Loc.getMessage("COUNTER_PROJECTS_MAJOR")]=t[o.Loc.getMessage("COUNTER_PROJECTS_MAJOR")];delete t[o.Loc.getMessage("COUNTER_PROJECTS_MAJOR")];r=true}if(!o.Type.isUndefined(t[o.Loc.getMessage("COUNTER_SCRUM_TOTAL_COMMENTS")])){this.workgroupsCounterData[o.Loc.getMessage("COUNTER_SCRUM_TOTAL_COMMENTS")]=t[o.Loc.getMessage("COUNTER_SCRUM_TOTAL_COMMENTS")];delete t[o.Loc.getMessage("COUNTER_SCRUM_TOTAL_COMMENTS")];r=true}if(r){t["workgroups"]=Object.entries(this.workgroupsCounterData).reduce((function(e,t){var n=babelHelpers.slicedToArray(t,2),r=n[1];return e+Number(r)}),0)}if(t["live-feed"]){if(t["live-feed"]<=0){babelHelpers.classPrivateFieldSet(this,Y,0)}else{t["live-feed"]-=babelHelpers.classPrivateFieldGet(this,Y)}}this.getItemsController().updateCounters(t,n);BX.Intranet.Account.setCounters(t)}}]);return e}();e.DesktopMenu=z})(this.BX.Intranet=this.BX.Intranet||{},BX.Messenger.v2.Lib,BX.Main,BX.Messenger.v2.Const,BX.Event,BX.Messenger.v2.Lib,BX);
//# sourceMappingURL=script.map.js