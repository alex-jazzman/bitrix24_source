{"version":3,"file":"mobile-popup.bundle.js","sources":["../src/mobile-popup.js"],"sourcesContent":["import { Tag, Extension, Loc, Event } from 'main.core';\nimport { PopupWindowManager } from 'main.popup';\nimport { EventEmitter } from 'main.core.events';\nimport { Button, CloseButton } from 'ui.buttons';\nimport { sendData } from 'ui.analytics';\nimport { BannerDispatcher } from 'ui.banner-dispatcher';\nimport './style.css';\nimport 'ui.fonts.montserrat';\n\ntype PopupPosition = {\n\tminHeight: number,\n\tminWidth: number,\n\toffsetTop: number,\n\toffsetLeft: number,\n}\nexport class MobilePopup extends EventEmitter\n{\n\t#popup: ?Popup = null;\n\t#authLink: string = null;\n\t#isTablet: boolean = false;\n\t#continueInMobileBrowserClicked: boolean = false;\n\t#continueInTabletBrowserClicked: boolean = false;\n\t#collabId: ?int = null;\n\t#isCollaber: boolean = false;\n\t#isMobileContinueButton: boolean = false;\n\t#isTabletContinueButton: boolean = false;\n\t#position: PopupPosition;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Intranet.MobilePopup');\n\t\tthis.#authLink = Extension.getSettings('intranet.mobile-popup').authLink;\n\t\tthis.#collabId = Extension.getSettings('intranet.mobile-popup').collabId;\n\t\tthis.#isCollaber = Extension.getSettings('intranet.mobile-popup').isCollaber;\n\t\tthis.#continueInMobileBrowserClicked = Extension.getSettings('intranet.mobile-popup').continueInMobileBrowserClicked;\n\t\tthis.#continueInTabletBrowserClicked = Extension.getSettings('intranet.mobile-popup').continueInTabletBrowserClicked;\n\t\tthis.#isMobileContinueButton = Extension.getSettings('intranet.mobile-popup').isMobileContinueButton;\n\t\tthis.#isTabletContinueButton = Extension.getSettings('intranet.mobile-popup').isTabletContinueButton;\n\t\tthis.#isTablet = window.screen.width >= 768;\n\n\t\tthis.#sendAnalytics('push_mobapp_show');\n\t}\n\n\t#calculatePopupPosition(): void\n\t{\n\t\tconst isAirTemplate = BX.Reflection.getClass('BX.Intranet.Bitrix24.Template') !== null;\n\t\tconst minHeight = 602;\n\t\tconst minWidth = this.#isTablet ? 375 : 321;\n\t\tconst height = (window.screen.height - minHeight) >= 0 ? (window.screen.height - minHeight) / 2 : 0;\n\t\tconst width = (window.screen.width - minWidth) >= 0 ? (window.screen.width - minWidth) / 2 : 0;\n\t\tlet offsetTop = height - window.screen.height;\n\n\t\tif (isAirTemplate)\n\t\t{\n\t\t\toffsetTop = height - document.body.scrollHeight;\n\t\t}\n\n\t\tthis.#position = {\n\t\t\tminHeight,\n\t\t\tminWidth,\n\t\t\toffsetTop,\n\t\t\toffsetLeft: width,\n\t\t};\n\t}\n\n\t#createPopup(onDone: function): Popup\n\t{\n\t\treturn PopupWindowManager.create(\n\t\t\t'main-intranet-mobile-popup',\n\t\t\tdocument.body,\n\t\t\t{\n\t\t\t\toverlay: true,\n\t\t\t\tborderRadius: '24px',\n\t\t\t\tcontentBorderRadius: '24px',\n\t\t\t\tcloseIcon: false,\n\t\t\t\tminWidth: this.#position.minWidth,\n\t\t\t\tminHeight: this.#position.minHeight,\n\t\t\t\tcontent: this.#getContent(),\n\t\t\t\t//disableScroll: true,\n\t\t\t\tpadding: 0,\n\t\t\t\toffsetTop: this.#position.offsetTop,\n\t\t\t\toffsetLeft: this.#position.offsetLeft,\n\t\t\t\tclassName: 'intranet-mobile-popup-wrapper',\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: () => {\n\t\t\t\t\t\tthis.emit('onClose');\n\t\t\t\t\t\tonDone();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\t}\n\n\tshow(): void\n\t{\n\t\tif (\n\t\t\t(this.#isTablet && this.#continueInTabletBrowserClicked)\n\t\t\t|| (!this.#isTablet && this.#continueInMobileBrowserClicked)\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tBannerDispatcher.critical.toQueue((onDone) => {\n\t\t\tthis.#calculatePopupPosition();\n\t\t\tthis.#popup ??= this.#createPopup(onDone);\n\t\t\tthis.#popup?.show();\n\t\t\tdocument.body.scrollIntoView();\n\t\t});\n\t}\n\n\t#getContent(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"intranet-mobile-popup\">\n\t\t\t\t<div class=\"intranet-mobile-popup__content-wrapper\">\n\t\t\t\t\t<div class=\"intranet-mobile-popup__main\">\n\t\t\t\t\t\t<span class=\"intranet-mobile-popup__title\">${Loc.getMessage('INTRANET_RECOGNIZE_LINKS_TITLE')}</span>\n\t\t\t\t\t\t${this.#renderImage()}\n\t\t\t\t\t\t<p class=\"intranet-mobile-popup__description\">${Loc.getMessage('INTRANET_RECOGNIZE_LINKS_DESCRIPTION')}</p>\n\t\t\t\t\t\t${this.#renderContinueButton()}\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.#renderFooter()}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#renderImage(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"intranet-mobile-popup__image\"></div>\n\t\t`;\n\t}\n\n\t#renderFooter(): ?HTMLElement\n\t{\n\t\tif (\n\t\t\t(this.#isTablet && this.#isTabletContinueButton)\n\t\t\t|| (!this.#isTablet && this.#isMobileContinueButton)\n\t\t)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"intranet-mobile-popup__footer\">\n\t\t\t\t\t${this.#renderHideButton()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t#renderContinueButton(): HTMLElement\n\t{\n\t\tlet text = Loc.getMessage('INTRANET_RECOGNIZE_LINKS_CONTINUE');\n\t\tif (\n\t\t\t(this.#isTablet && this.#isTabletContinueButton)\n\t\t\t|| (!this.#isTablet && this.#isMobileContinueButton)\n\t\t)\n\t\t{\n\t\t\ttext = Loc.getMessage('INTRANET_RECOGNIZE_LINKS_OPEN_APP');\n\t\t}\n\n\t\treturn new Button({\n\t\t\ttext,\n\t\t\tclassName: 'intranet-mobile-popup__button intranet-mobile-popup__button--continue',\n\t\t\tsize: Button.Size.LARGE,\n\t\t\tcolor: Button.Color.SUCCESS,\n\t\t\tround: true,\n\t\t\tonclick: () => {\n\t\t\t\tthis.#popup?.close();\n\t\t\t\tthis.#sendAnalytics('push_mobapp_click_start');\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\twindow.location.href = this.#authLink;\n\t\t\t\t});\n\t\t\t},\n\t\t}).render();\n\t}\n\n\t#renderHideButton(): HTMLElement\n\t{\n\t\treturn new CloseButton({\n\t\t\ttext: Loc.getMessage('INTRANET_RECOGNIZE_LINKS_CONTINUE_IN_BROWSER'),\n\t\t\tclassName: 'intranet-mobile-popup__button intranet-mobile-popup__button--hide',\n\t\t\tsize: Button.Size.SMALL,\n\t\t\tonclick: () => {\n\t\t\t\tthis.#popup?.close();\n\t\t\t\tthis.#sendAnalytics('push_mobapp_click_stay_browser');\n\t\t\t\tconst optionName = this.#isTablet ? 'tabletPopupContinueToApp' : 'mobilePopupContinueToApp';\n\t\t\t\tBX.userOptions.save('intranet', optionName, null, 'Y');\n\t\t\t},\n\t\t}).render();\n\t}\n\n\t#sendAnalytics(event: string): void\n\t{\n\t\tconst params = {\n\t\t\ttool: 'intranet',\n\t\t\tcategory: 'activation',\n\t\t\tevent,\n\t\t\ttype: 'inside_portal',\n\t\t\tc_sub_section: 'push_to_mobapp',\n\t\t\tp2: `popupClosable_${this.#isTablet ? 'Y' : 'N'}`,\n\t\t};\n\n\t\tif (this.#isCollaber)\n\t\t{\n\t\t\tparams.p5 = `collabId_${this.#collabId}`;\n\t\t}\n\n\t\tsendData(params);\n\t}\n}\n"],"names":["MobilePopup","EventEmitter","constructor","setEventNamespace","Extension","getSettings","authLink","collabId","isCollaber","continueInMobileBrowserClicked","continueInTabletBrowserClicked","isMobileContinueButton","isTabletContinueButton","window","screen","width","show","BannerDispatcher","critical","toQueue","onDone","document","body","scrollIntoView","isAirTemplate","BX","Reflection","getClass","minHeight","minWidth","height","offsetTop","scrollHeight","offsetLeft","PopupWindowManager","create","overlay","borderRadius","contentBorderRadius","closeIcon","content","padding","className","events","onClose","emit","Tag","render","Loc","getMessage","text","Button","size","Size","LARGE","color","Color","SUCCESS","round","onclick","close","setTimeout","location","href","CloseButton","SMALL","optionName","userOptions","save","event","params","tool","category","type","c_sub_section","p2","p5","sendData"],"mappings":"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"}