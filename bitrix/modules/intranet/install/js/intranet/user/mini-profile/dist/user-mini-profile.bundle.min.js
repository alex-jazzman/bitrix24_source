this.BX=this.BX||{};this.BX.Intranet=this.BX.Intranet||{};(function(t,e,n,i,s,r,a,l,o,d,c,u,p,m,h,f){"use strict";class v{static load(t){return new Promise(((e,n)=>{h.ajax.runAction("intranet.user.miniProfile.load",{data:{userId:t}}).then((t=>{e(t.data)})).catch((t=>{var e,i;n((e=(i=t.errors[0])==null?void 0:i.code)!=null?e:null)}))}))}}const _={RightSideExpand:"right-side-expand"};const b="intranet-user-mini-profile";var I=babelHelpers.classPrivateFieldLooseKey("getKeyByType");class E{static getValue(t){const e=babelHelpers.classPrivateFieldLooseBase(this,I)[I](t);return localStorage.getItem(e)}static save(t,e){const n=babelHelpers.classPrivateFieldLooseBase(this,I)[I](t);if(!Object.values(_).includes(t)){return}localStorage.setItem(n,e)}}function T(t){return b+t}Object.defineProperty(E,I,{value:T});const P={name:"UserMiniProfileDivider",props:{isVertical:{type:Boolean,default:false}},template:`\n\t\t<div \n\t\t\tclass="intranet-user-mini-profile__divider"\n\t\t\t:class="isVertical ? '--vertical' : '--horizontal'"\n\t\t>\n\t\t\t<div class="intranet-user-mini-profile__divider-inner"></div>\n\t\t</div>\n\t`};const L={default:{class:"--default",title:h.Loc.getMessage("INTRANET_USER_MINI_ERROR_STATE_TITLE"),description:h.Loc.getMessage("INTRANET_USER_MINI_ERROR_STATE_DESCRIPTION")},"access-denied":{class:"--access-denied",title:h.Loc.getMessage("INTRANET_USER_MINI_ERROR_STATE_ACCESS_DENIED_TITLE"),description:h.Loc.getMessage("INTRANET_USER_MINI_ERROR_STATE_ACCESS_DENIED_DESCRIPTION")}};const g=Object.freeze({AccessDenied:"access-denied",Default:"default"});const S={name:"ErrorState",props:{type:{type:String,default:g.Default,validator:t=>Object.values(g).includes(t)}},computed:{setting(){var t;return(t=L[this.type])!=null?t:null}},template:`\n\t\t<div \n\t\t\tclass="intranet-user-mini-profile__error-state"\n\t\t\t:class="setting?.class"\n\t\t>\n\t\t\t<div class="intranet-user-mini-profile__error-state-content">\n\t\t\t\t<div class="intranet-user-mini-profile__error-state__icon"></div>\n\t\t\t\t<div class="intranet-user-mini-profile__error-state__title">\n\t\t\t\t\t{{ setting?.title }}\n\t\t\t\t</div>\n\t\t\t\t<div class="intranet-user-mini-profile__error-state__description">\n\t\t\t\t\t{{ setting?.description }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const B={name:"UserMiniProfileLoader",props:{isShort:{type:Boolean,default:false}},template:`\n\t\t<div class="intranet-user-mini-profile-loader" :class="{ '--short': isShort }"></div>\n\t`};const y={name:"LoaderTransition",components:{UserMiniProfileLoader:B},props:{isLoading:{type:Boolean,required:true},isShowContent:{type:Boolean,required:true},isLoaderShort:{type:Boolean,default:false}},emits:["end"],methods:{resetSize(){h.Dom.style(this.$el,{width:"",height:""})},onEnd(){this.resetSize();this.$emit("end")},onEnter(t){requestAnimationFrame((()=>{h.Dom.style(this.$el,{width:`${t.offsetWidth}px`,height:`${t.offsetHeight}px`})}))},onBeforeLeave(t){h.Dom.style(this.$el,{width:`${t.offsetWidth}px`,height:`${t.offsetHeight}px`})},onAfterLeave(){this.onEnd()},onAfterEnter(){this.onEnd()}},template:`\n\t\t<TransitionGroup \n\t\t\tname="intranet-user-mini-profile-fade"\n\t\t\ttag="div"\n\t\t\tclass="intranet-user-mini-profile__loader-transition-wrapper"\n\t\t\t@enter="onEnter"\n\t\t\t@beforeLeave="onBeforeLeave"\n\t\t\t@afterLeave="onAfterLeave"\n\t\t\t@afterEnter="onAfterEnter"\n\t\t>\n\t\t\t<div v-if="isLoading"\n                 class="intranet-user-mini-profile__loader-transition-wrapper__loader"\n\t\t\t\t key="loader"\n\t\t\t>\n\t\t\t\t<UserMiniProfileLoader\n\t\t\t\t   :isShort="isLoaderShort"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<slot v-else-if="isShowContent"></slot>\n\t\t</TransitionGroup>\n\t`};const N={components:{Button:n.Button},computed:{buttonSize:()=>n.ButtonSize,buttonStyle:()=>n.AirButtonStyle,buttonIcon:()=>n.ButtonIcon}};const D={computed:{set:()=>u.Set,outlineSet:()=>u.Outline}};const F={methods:{loc(t,e=null){return h.Loc.getMessage(t,e)},locPlural(t,e,n=null){return h.Loc.getMessagePlural(t,e,n)}}};const H={name:"DepartmentConnector",props:{topBindElement:{type:HTMLElement,required:true},bottomBindElement:{type:HTMLElement,required:true},offsetLeft:{type:Number,default:11}},computed:{top(){const{height:t}=this.topBindElement.getBoundingClientRect();const e=this.topBindElement.offsetTop+t;return`${e}px`},left(){const t=this.topBindElement.offsetLeft+this.offsetLeft;return`${t}px`},height(){const t=this.topBindElement.offsetTop+this.topBindElement.offsetHeight;const e=this.bottomBindElement.offsetTop+this.bottomBindElement.offsetHeight/2;return Math.round(e-t)},pathD(){const t=this.height;const e=["M 1 0",`V ${t-5}`,`C 1 ${t-3}.2091 2.7909 ${t-1} 5 ${t-1}`,"H 9"];return e.join("")},viewBox(){return`0 0 9 ${this.height}`}},template:`\n\t\t<div class="intranet-user-mini-profile__structure-view-connector" \n\t\t\t :style="{ 'top': top, 'left': left }"\n\t\t>\n\t\t\t<svg width="9" :height="height" :viewBox="viewBox" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t<path :d="pathD" stroke="#F0F0F0"/>\n\t\t\t</svg>\n\t\t</div>\n\t`};class O{static openStructureNodeId(t){r.Structure==null?void 0:r.Structure.open({focusNodeId:t})}static openUserProfile(t){if(!h.Type.isStringFilled(t)){return}BX.SidePanel.Instance.open(t)}}const R={name:"DepartmentBlock",components:{BIcon:u.BIcon,Avatar:p.Avatar},mixins:[F,D],props:{nodeId:{type:Number,required:true},highlighted:{type:Boolean,default:false},title:{type:String,required:true},employeeCount:{type:Number,required:true},user:{type:[Object,null],default:()=>{}},head:{type:[Object,null],default:()=>{}}},computed:{employeeCountTitle(){const{employeeCount:t}=this;return this.locPlural("INTRANET_USER_MINI_PROFILE_EMPLOYEES_COUNT",t,{"#COUNT#":t})},isShowHead(){const{head:t,user:e}=this;return t&&t.id!==(e==null?void 0:e.id)}},methods:{onTitleClick(){O.openStructureNodeId(this.nodeId)},onUserClick(t){O.openUserProfile(t.url)}},template:`\n\t\t<div \n\t\t\tclass="intranet-user-mini-profile__structure-view-department-block"\n\t\t\t:class="{'--highlighted': highlighted }"\n\t\t>\n\t\t\t<div class="intranet-user-mini-profile__structure-view-department-block__title"\n\t\t\t\t :title="title"\n\t\t\t\t @click="onTitleClick"\n\t\t\t>\n\t\t\t\t<span>{{ title }}</span>\n\t\t\t\t<div class="intranet-user-mini-profile__structure-view-department-block__title-chevron">\n\t\t\t\t\t<div class="intranet-user-mini-profile__structure-view-department-block__title-chevron-icon">\n\t\t\t\t\t\t<BIcon\n\t\t\t\t\t\t\t:name="outlineSet.CHEVRON_RIGHT_S"\n\t\t\t\t\t\t\t:size="20"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="intranet-user-mini-profile__structure-view-department-block__employee-count">\n\t\t\t\t{{ employeeCountTitle }}\n\t\t\t</div>\n\t\t\t<div v-if="user"\n\t\t\t\tclass="intranet-user-mini-profile__structure-view-department-block__user"\n\t\t\t\t@click="onUserClick(user)"\n\t\t\t>\n\t\t\t\t<div class="intranet-user-mini-profile__structure-view-department-block__user-avatar">\n\t\t\t\t\t<Avatar :options="{ \n\t\t\t\t\t\tpicPath: user.avatar ? encodeURI(user.avatar) : undefined,\n\t\t\t\t\t\tsize: 28, \n\t\t\t\t\t\ttitle: user.name \n\t\t\t\t\t}"/>\n\t\t\t\t</div>\n\t\t\t\t<div class="intranet-user-mini-profile__structure-view-department-block__user-info">\n\t\t\t\t\t<div \n\t\t\t\t\t\tclass="intranet-user-mini-profile__structure-view-department-block__user-info__name"\n\t\t\t\t\t\t:title="user.name"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ user.name }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if="user.workPosition"\n\t\t\t\t\t\tclass="intranet-user-mini-profile__structure-view-department-block__user-info__position"\n\t\t\t\t\t\t:title="user.workPosition"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ user.workPosition }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if="isShowHead" \n\t\t\t\tclass="intranet-user-mini-profile__structure-view-department-block__head"\n\t\t\t>\n\t\t\t\t<div class="intranet-user-mini-profile__structure-view-department-block__head-title">\n\t\t\t\t\t{{ loc('INTRANET_USER_MINI_DETAILED_INFO_HEAD') }}\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tclass="intranet-user-mini-profile__structure-view-department-block__head-info"\n\t\t\t\t\t@click="onUserClick(head)"\n\t\t\t\t>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="intranet-user-mini-profile__structure-view-department-block__head-info__avatar"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Avatar :options="{ picPath: head.avatar, size: 20, title: head.name }"/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="intranet-user-mini-profile__structure-view-department-block__head-info__name"\n\t\t\t\t\t\t:title="head.name"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ head.name }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const M={name:"LockedDepartmentBlock",components:{BIcon:u.BIcon},mixins:[D],template:`\n\t\t<div \n\t\t\tclass="intranet-user-mini-profile__structure-view-department-block --locked"\n\t\t>\n\t\t\t<div class="intranet-user-mini-profile__structure-view-department-block-lock">\n\t\t\t\t<BIcon \n\t\t\t\t\t:size="30" \n\t\t\t\t\t:name="outlineSet.LOCK_L"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`};const A={name:"DepartmentSpacer",props:{value:{type:Number,required:true},isVertical:{type:Boolean,default:false}},computed:{style(){const t=`${this.value}px`;if(!this.isVertical){return{width:t,minWidth:t}}return{height:t,minHeight:t}}},template:`\n\t\t<div :style="style"/>\n\t`};const C="locked-department";const w={name:"StructureView",components:{BIcon:u.BIcon,DepartmentBlock:R,LockedDepartmentBlock:M,DepartmentConnector:H,DepartmentSpacer:A},mixins:[F,D],props:{title:{type:String,default:""},branch:{type:Array,required:true},headDictionary:{type:Object,required:true},userDepartmentId:{type:Number,default:null},user:{type:Object,default:null}},data(){return{blocks:[],connectorBindElementPairs:[]}},computed:{LockedDepartment:()=>C},mounted(){this.$nextTick((()=>{this.makeConnectors()}))},methods:{makeConnectors(){this.connectorBindElementPairs=[];const t=this.blocks.length-2;for(let e=0;e<=t;++e){const t=this.blocks[e].$el;const n=this.blocks[e+1].$el;this.connectorBindElementPairs.push([t,n])}},getHeadForDepartment(t){var e;const{id:n}=t;if(n!==this.userDepartmentId){return null}const{headIds:i}=t;const s=i.includes(this.user.id);if(s){return null}const r=i[0];if(!r){return null}return(e=this.headDictionary[r])!=null?e:null},getUserForDepartment(t){var e;const{id:n}=t;if(n===this.userDepartmentId){return this.user}const{headIds:i}=t;const s=i[0];if(!s){return null}return(e=this.headDictionary[s])!=null?e:null}},template:`\n\t\t<div class="intranet-user-mini-profile__structure-view">\n\t\t\t<div class="intranet-user-mini-profile__structure-view__title">\n\t\t\t\t<div class="intranet-user-mini-profile__structure-view__title-icon">\n\t\t\t\t\t<BIcon :name="outlineSet.COMPANY" :size="18"/>\n\t\t\t\t</div>\n\t\t\t\t<span>{{ title }}</span>\n\t\t\t</div>\n\t\t\t<div class="intranet-user-mini-profile__structure-view__preview" v-if="branch.length">\n\t\t\t\t<div v-for="(department, index) in branch"\n\t\t\t\t\t class="intranet-user-mini-profile__structure-view__preview-row"\n\t\t\t\t>\n\t\t\t\t\t<DepartmentSpacer :value="index * 20"/>\n\t\t\t\t\t<template v-if="department === LockedDepartment">\n\t\t\t\t\t\t<LockedDepartmentBlock\n\t\t\t\t\t\t\t:ref="el => { blocks[index] = el}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t<DepartmentBlock\n\t\t\t\t\t\t\t:ref="el => { blocks[index] = el}"\n\t\t\t\t\t\t\t:key="'department-' + department.id"\n\t\t\t\t\t\t\t:title="department.title"\n\t\t\t\t\t\t\t:nodeId="department.id"\n\t\t\t\t\t\t\t:employee-count="department.employeeCount"\n\t\t\t\t\t\t\t:user="getUserForDepartment(department)"\n\t\t\t\t\t\t\t:head="getHeadForDepartment(department)"\n\t\t\t\t\t\t\t:highlighted="department.id === userDepartmentId"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</template>\n\t\t\t\t</div>\n\t\t\t\t<template\n\t\t\t\t\tv-for="elementPair in connectorBindElementPairs"\n\t\t\t\t>\n\t\t\t\t\t<DepartmentConnector\n\t\t\t\t\t\t:topBindElement="elementPair[0]"\n\t\t\t\t\t\t:bottomBindElement="elementPair[1]"\n\t\t\t\t\t\t:offsetLeft="11"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t`};const U=Object.freeze({next:"intranet-user-mini-profile-structure-view-carousel-next",prev:"intranet-user-mini-profile-structure-view-carousel-prev"});const k=3;const x={name:"StructureViewList",components:{StructureView:w,BIcon:u.BIcon},mixins:[D,N],props:{structure:{type:Object,required:true},user:{type:Object,required:true}},data(){return{index:0,animationName:"",isTransitionInProgress:false}},computed:{isPrevDisabled(){return this.isTransitionInProgress||this.index===0},isNextDisabled(){return this.isTransitionInProgress||this.index>=this.structure.userDepartmentIds.length-1},hasManyUserDepartments(){return this.structure.userDepartmentIds.length>1},maxBranchHeight(){let t=0;for(const e of this.structure.userDepartmentIds){const n=this.makeDepartmentBranch(e).length;if(n===k){return k}t=Math.max(t,n)}return t},missingMaxDepartmentCount(){return k-this.maxBranchHeight}},methods:{makeDepartmentBranch(t){const{departmentDictionary:e}=this.structure;const n=e[t];if(!n){return[]}const i=[];let s=n;while(s&&i.length<k){i.push(s);if(s.parentId===null){break}s=e[s.parentId]}if(i.length<k&&i[i.length-1].parentId!==0){i.push(C)}return i.reverse()},next(){if(this.isNextDisabled){return}this.animationName=U.next;this.index+=1},prev(){if(this.isPrevDisabled){return}this.animationName=U.prev;this.index-=1}},template:`\n\t\t<div class="intranet-user-mini-profile__structure-view-list">\n\t\t\t<div\n\t\t\t\tclass="intranet-user-mini-profile__structure-view-list__preview-zone"\n\t\t\t\t:class="{ '--one-branch': !hasManyUserDepartments }"\n\t\t\t\t:style="{ '--missing-max-department-count': missingMaxDepartmentCount }"\n\t\t\t>\n\t\t\t\t<TransitionGroup \n\t\t\t\t\ttype="transition" \n\t\t\t\t\t:name="animationName"\n\t\t\t\t\t@beforeEnter="isTransitionInProgress = true"\n\t\t\t\t\t@afterLeave="isTransitionInProgress = false"\n\t\t\t\t>\n\t\t\t\t\t<template v-for="(departmentId, index) in structure.userDepartmentIds">\n\t\t\t\t\t\t<StructureView\n\t\t\t\t\t\t\tstyle="height: 100%;"\n\t\t\t\t\t\t\tv-if="index === this.index"\n\t\t\t\t\t\t\t:title="structure.title"\n\t\t\t\t\t\t\t:branch="makeDepartmentBranch(departmentId)"\n\t\t\t\t\t\t\t:key="departmentId"\n\t\t\t\t\t\t\t:userDepartmentId="departmentId"\n\t\t\t\t\t\t\t:headDictionary="structure.headDictionary"\n\t\t\t\t\t\t\t:user="user"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</template>\n\t\t\t\t</TransitionGroup>\n\t\t\t</div>\n\t\t\t<div v-if="hasManyUserDepartments"\n\t\t\t\tclass="intranet-user-mini-profile__structure-view-control"\n\t\t\t>\n\t\t\t\t<Button \n\t\t\t\t\t:leftIcon="buttonIcon.CHEVRON_LEFT_S"\n\t\t\t\t\t:style="buttonStyle.PLAIN_NO_ACCENT"\n\t\t\t\t\t:size="buttonSize.EXTRA_SMALL"\n\t\t\t\t\t:removeRightCorners="true"\n\t\t\t\t\t:disabled="isPrevDisabled"\n\t\t\t\t\t@click="prev"\n\t\t\t\t/>\n\t\t\t\t<Button \n\t\t\t\t\t:leftIcon="buttonIcon.CHEVRON_RIGHT_S"\n\t\t\t\t\t:style="buttonStyle.PLAIN_NO_ACCENT"\n\t\t\t\t\t:size="buttonSize.EXTRA_SMALL"\n\t\t\t\t\t:removeLeftCorners="true"\n\t\t\t\t\t:disabled="isNextDisabled"\n\t\t\t\t\t@click="next"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`};const j={name:"CollapseTransition",props:{initialHeight:{type:Number,default:0}},emits:["start","end"],created(){if(!this.$slots.default){throw new Error("Slot is required")}},methods:{onEnter(t){this.targetWidth=t.offsetWidth;this.targetHeight=Math.max(t.offsetHeight,this.initialHeight);const e=Math.min(t.offsetHeight,this.initialHeight);h.Dom.style(t,{width:0,height:`${e}px`});requestAnimationFrame((()=>{h.Dom.style(t,{width:`${this.targetWidth}px`,height:`${this.targetHeight}px`})}))},onBeforeLeave(t){const e=Math.min(this.initialHeight,t.offsetHeight);h.Dom.style(t,{width:`${t.offsetWidth}px`,height:`${t.offsetHeight}px`});requestAnimationFrame((()=>{h.Dom.style(t,{width:0,height:`${e}px`})}));this.$emit("start")}},template:`\n\t\t<Transition\n\t\t\tname="intranet-user-mini-profile-collapse"\n\t\t\t@enter="onEnter"\n\t\t\t@beforeLeave="onBeforeLeave"\n\t\t\t@afterEnter="this.$emit('end')"\n\t\t\t@afterLeave="this.$emit('end')"\n\t\t\t@beforeEnter="this.$emit('start')"\n\t\t>\n\t\t\t<slot></slot>\n\t\t</Transition>\n\t`};class V{static openMessenger(t){var e;(e=top.BX.Messenger.Public)==null?void 0:e.openChat(String(t))}static call(t,e){var n;(n=top.BX.Messenger.Public)==null?void 0:n.startVideoCall(String(t),e)}static isMessengerAvailable(){return Boolean(top.BX.Messenger.Public)}}const $={shop:h.Loc.getMessage("INTRANET_USER_MINI_PROFILE_ROLE_SHOP"),email:h.Loc.getMessage("INTRANET_USER_MINI_PROFILE_ROLE_EMAIL"),integrator:h.Loc.getMessage("INTRANET_USER_MINI_PROFILE_ROLE_INTEGRATOR"),visitor:h.Loc.getMessage("INTRANET_USER_MINI_PROFILE_ROLE_VISITOR")};const q={name:"UserRole",mixins:[F],props:{role:{type:[String,null],required:true}},computed:{title(){var t;if(!this.role){return null}return(t=$[this.role])!=null?t:null}},template:`\n\t\t<div v-if="title"\n\t\t\tclass="intranet-user-mini-profile__role"\n\t\t>\n\t\t\t<div class="intranet-user-mini-profile__role-inner-text">\n\t\t\t\t{{ title }}\n\t\t\t</div>\n\t\t</div>\n\t`};const K={online:{iconName:l.Outline.EARTH_WITH_CHECK,colorVar:"--ui-color-accent-main-success"},offline:{iconName:l.Outline.EARTH_WITH_CLOCK,colorVar:"--ui-color-accent-main-warning"},dnd:{iconName:l.Outline.EARTH_WITH_STOP,colorVar:"--ui-color-accent-main-alert"},vacation:{iconName:l.Outline.EARTH_WITH_TREE,colorVar:"--ui-color-accent-extra-aqua"},fired:{iconName:l.Outline.EARTH_WITH_CROSS,colorVar:"--ui-color-gray-50"}};const X=Object.freeze({Online:"online",Offline:"offline",DoNotDisturb:"dnd",Vacation:"vacation",Fired:"fired"});class z{static isSupported(t){return Object.values(X).includes(t)}static getFailoverStatus(){return X.Offline}}const W={name:"UserStatusIcon",components:{BIcon:u.BIcon},mixins:[D],props:{status:{type:String,default:"offline"}},computed:{iconSetting(){var t;let e=this.status;if(!h.Type.isStringFilled(e)){return null}if(!z.isSupported(e)){e=z.getFailoverStatus()}return(t=K[e])!=null?t:null}},template:`\n\t\t<div v-if="iconSetting"\n\t\t\tclass="intranet-user-mini-profile__user-status" \n\t\t\t:style="{ '--ui-icon-set__icon-color': 'var(' + iconSetting.colorVar + ')' }"\n\t\t>\n\t\t\t<BIcon\n\t\t\t\t:size="24"\n\t\t\t\t:name="iconSetting.iconName"\n\t\t\t/>\n\t\t</div>\n\t`};const G={online:h.Loc.getMessage("INTRANET_USER_MINI_PROFILE_USER_STATUS_ONLINE"),dnd:h.Loc.getMessage("INTRANET_USER_MINI_PROFILE_USER_STATUS_DND"),fired:h.Loc.getMessage("INTRANET_USER_MINI_PROFILE_USER_STATUS_FIRED")};const Y={name:"UserStatusDescription",mixins:[F],props:{status:{type:Object,required:true}},computed:{text(){var t;let{code:e}=this.status;if(!h.Type.isStringFilled(e)){return""}if(!z.isSupported(e)){e=z.getFailoverStatus()}const n=(t=G[e])!=null?t:null;if(n){return n}if(e===X.Offline){return this.formatTextForOfflineStatus({...this.status,code:e})}if(e===X.Vacation){return this.formatTextForVacationStatus({...this.status,code:e})}return""}},methods:{formatTextForOfflineStatus(t){if(!h.Type.isNumber(t.lastSeenTs)||t.lastSeenTs===0){return this.loc("INTRANET_USER_MINI_PROFILE_USER_STATUS_OFFLINE")}const e=o.DateTimeFormat.getFormat("DAY_MONTH_FORMAT");const n=o.DateTimeFormat.getFormat("SHORT_TIME_FORMAT");return this.loc("INTRANET_USER_MINI_PROFILE_USER_STATUS_OFFLINE_LAST_SEEN_TEMPLATE",{"#DATE#":o.DateTimeFormat.format(e,t.lastSeenTs),"#TIME#":o.DateTimeFormat.format(n,t.lastSeenTs)})},formatTextForVacationStatus(t){if(!h.Type.isNumber(t.vacationTs)){return this.loc("INTRANET_USER_MINI_PROFILE_USER_STATUS_VACATION")}const e=o.DateTimeFormat.getFormat("DAY_MONTH_FORMAT");return this.loc("INTRANET_USER_MINI_PROFILE_USER_STATUS_VACATION_TEMPLATE",{"#DATE#":o.DateTimeFormat.format(e,t.vacationTs)})}},template:`\n\t\t<span v-if="text"\n\t\t\tclass="intranet-user-mini-profile__user-status-description"\n\t\t>\n\t\t\t{{ text }}\n\t\t</span>\n\t`};const Z={name:"UserTime",mixins:[F],props:{utcOffset:{type:Number,required:true}},data(){return{date:new Date,tickInterval:null}},computed:{formattedTime(){const t=this.date;const e=t.getTimezoneOffset()*60*1e3;const n=this.utcOffset*1e3;const i=e+n;t.setTime(t.getTime()+i);const s=this.utcOffset>=0?"+":"-";const r=Math.abs(this.utcOffset);const a=Math.floor(r/3600);const l=Math.floor(r%3600/60);const o=[this.loc("INTRANET_USER_MINI_PROFILE_USER_TZ_TEMPLATE",{"#VALUE#":`${s}${a.toString()}`})];if(l>0){o.push(`:${l.toString().padStart(2,0)}`)}return`${o.join("")} (${this.formatDate(t)})`}},created(){this.tickInterval=setInterval((()=>{this.date=new Date}),1e3)},unmounted(){clearInterval(this.tickInterval)},methods:{formatDate(t){const e=o.DateTimeFormat.getFormat("SHORT_TIME_FORMAT");return o.DateTimeFormat.format(e,t)}},template:`\n\t\t<span class="intranet-user-mini-profile__user-time">\n\t\t\t{{ formattedTime }}\n\t\t</span>\n\t`};const J=Object.freeze({collaber:"round-guest",extranet:"round-extranet",employee:"round"});const Q={name:"UserBaseInfo",components:{BIcon:u.BIcon,UserRole:q,UserStatusIcon:W,UserStatusDescription:Y,RichMenuPopup:c.RichMenuPopup,UserTime:Z,Avatar:p.Avatar,BMenu:a.BMenu},mixins:[F,D],props:{isShowExpand:{type:Boolean,default:false},isExpanded:{type:Boolean,required:true},userId:{type:Number,required:true},info:{type:Object,required:true},canChat:{type:Boolean,default:false}},emits:["expand"],data(){return{isShowCallMenu:false}},computed:{callMenuPopupOptions(){return{id:`${Rt}call-menu`,autoHide:true,bindElement:this.$refs.callActionMenu,bindOptions:{forceBindPosition:true},minWidth:190,width:190,items:[{title:this.loc("INTRANET_USER_MINI_PROFILE_ACTION_CALL_WITH_VIDEO"),icon:this.outlineSet.RECORD_VIDEO,onClick:()=>this.onCallMenuItemClick()},{title:this.loc("INTRANET_USER_MINI_PROFILE_ACTION_CALL"),icon:this.outlineSet.HEADSET,onClick:()=>this.onCallMenuItemClick(false)}]}},shouldShowUserTime(){return[X.Online,X.DoNotDisturb].includes(this.info.status.code)},shouldShowMessengerActionButtons(){return V.isMessengerAvailable()&&this.canChat},avatarType(){var t;return(t=J[this.info.role])!=null?t:"round"}},methods:{openChat(){V.openMessenger(this.userId)},call(t=true){V.call(this.userId,t)},onCallMenuItemClick(t=true){this.isShowCallMenu=false;this.call(t)},openProfile(){O.openUserProfile(this.info.url)}},template:`\n\t\t<div class="intranet-user-mini-profile__base-info">\n\t\t\t<div class="intranet-user-mini-profile__base-info__user">\n\t\t\t\t<div class="intranet-user-mini-profile__base-info__user-avatar-wrapper">\n\t\t\t\t\t<div \n\t\t\t\t\t\tclass="intranet-user-mini-profile__base-info__user-avatar"\n\t\t\t\t\t\t@click="openProfile"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Avatar \n\t\t\t\t\t\t\t:type="avatarType"\n\t\t\t\t\t\t\t:options="{\n\t\t\t\t\t\t\t\tuserName: info.name, \n\t\t\t\t\t\t\t\tsize: 72, \n\t\t\t\t\t\t\t\ttitle: info.name, \n\t\t\t\t\t\t\t\tpicPath: info.avatar ? encodeURI(info.avatar) : undefined,\n\t\t\t\t\t\t\t}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<UserStatusIcon v-if="info.status" \n\t\t\t\t\t\t:status="info.status.code"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class="intranet-user-mini-profile__base-info__user-data">\n\t\t\t\t\t<div class="intranet-user-mini-profile__base-info__user-data__name"\n\t\t\t\t\t\t :title="info.name"\n\t\t\t\t\t\t @click="openProfile"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ info.name }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="intranet-user-mini-profile__base-info__user-data__position"\n\t\t\t\t\t\t :title="info.workPosition"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ info.workPosition }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="intranet-user-mini-profile__base-info__user-data__status">\n\t\t\t\t\t\t<UserStatusDescription v-if="info.status"\n\t\t\t\t\t\t\t:status="info.status"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<UserTime v-if="shouldShowUserTime" \n\t\t\t\t\t\t\t:utcOffset="info.utcOffset"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if="shouldShowMessengerActionButtons"\n\t\t\t\tclass="intranet-user-mini-profile__base-info__actions"\n\t\t\t>\n\t\t\t\t<div class="intranet-user-mini-profile__base-info__action">\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass="ui-btn ui-btn-sm ui-btn-no-caps --air --wide --style-outline-accent-2"\n\t\t\t\t\t\t@click="openChat"\n\t\t\t\t\t>\n\t\t\t\t\t<span class="ui-btn-text">\n\t\t\t\t\t\t{{ loc('INTRANET_USER_MINI_PROFILE_ACTION_CHAT') }}\n\t\t\t\t\t</span>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t\t<div class="intranet-user-mini-profile__base-info__action">\n\t\t\t\t\t<div class="ui-btn-split --air ui-btn-sm --style-filled ui-btn-no-caps">\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass="ui-btn-main --air"\n\t\t\t\t\t\t\t@click="call()"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span class="ui-btn-text">\n\t\t\t\t\t\t\t\t{{ loc('INTRANET_USER_MINI_PROFILE_ACTION_CALL_WITH_VIDEO') }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tref="callActionMenu"\n\t\t\t\t\t\t\tclass="ui-btn-menu"\n\t\t\t\t\t\t\t@click="isShowCallMenu = !isShowCallMenu"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<BMenu v-if="isShowCallMenu"\n\t\t\t\t\t\t\t\t:options="callMenuPopupOptions"\n\t\t\t\t\t\t\t\t@close="isShowCallMenu = false"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if="isShowExpand"\n\t\t\t\tclass="intranet-user-mini-profile__expand"\n\t\t\t\t@click="() => $emit('expand')"\n\t\t\t>\n\t\t\t\t<BIcon :name="!isExpanded ? outlineSet.OPEN_CHAT : outlineSet.CLOSE_CHAT"/>\n\t\t\t</div>\n\t\t\t<div class="intranet-user-mini-profile__base-info__role">\n\t\t\t\t<UserRole \n\t\t\t\t\t:role="info.role"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`};const tt=Object.freeze({Mail:"mail",Phone:"phone"});const et={name:"UserDetailedInfoContactItemValue",props:{type:{type:String,required:true},value:{type:String,required:true}},computed:{href(){if(this.type===tt.Mail){return`mailto:${this.value}`}return null}},methods:{onClick(t){if(this.type===tt.Phone){t.preventDefault();if(navigator.clipboard){navigator.clipboard.writeText(this.value).then((()=>{d.UI.Notification.Center.notify({content:this.$Bitrix.Loc.getMessage("INTRANET_USER_MINI_PROFILE_ACTION_CLIPBOARD_COPY_PHONE_SUCCESS")})})).catch((()=>{d.UI.Notification.Center.notify({content:this.$Bitrix.Loc.getMessage("INTRANET_USER_MINI_PROFILE_ACTION_CLIPBOARD_COPY_PHONE_ERROR")})}))}else{d.UI.Notification.Center.notify({content:this.$Bitrix.Loc.getMessage("INTRANET_USER_MINI_PROFILE_ACTION_CLIPBOARD_COPY_PHONE_ERROR")})}}}},template:`\n\t\t<a \n\t\t\tclass="intranet-user-mini-profile__detailed-info__contact-item-value"\n\t\t\t:href="href"\n\t\t\ttarget\n\t\t\t@click="onClick"\n\t\t> \n\t\t\t{{ value }}\n\t\t</a>\n\t`};const nt={name:"UserDetailedInfoItem",props:{title:{type:String,required:true}},template:`\n\t\t<div class="intranet-user-mini-profile__detailed-info-item">\n\t\t\t<div class="intranet-user-mini-profile__detailed-info-item__title">\n\t\t\t\t{{ title }}\n\t\t\t</div>\n\t\t\t<div class="intranet-user-mini-profile__detailed-info-item__value">\n\t\t\t\t<slot></slot>\n\t\t\t</div>\n\t\t</div>\n\t`};const it={components:{BIcon:u.BIcon,Avatar:p.Avatar},mixins:[D],props:{title:{type:String,required:true},image:{type:Object,default:()=>({})}},template:`\n\t\t<div class="intranet-user-mini-profile__entity-menu-item">\n\t\t\t<div class="intranet-user-mini-profile__entity-menu-item-content">\n\t\t\t\t<div v-if="image"\n\t\t\t\t\tclass="intranet-user-mini-profile__entity-menu-item__icon"\n\t\t\t\t\t:class="image.iconClass ?? null"\n\t\t\t\t>\n\t\t\t\t\t<BIcon v-if="image.bIconName" \n\t\t\t\t\t\t:name="image.bIconName"\n\t\t\t\t\t\t:size="18"\n\t\t\t\t\t/>\n\t\t\t\t\t<Avatar v-else\n\t\t\t\t\t\t:options="{\n\t\t\t\t\t\t\tsize: 24,\n\t\t\t\t\t\t\ttitle,\n\t\t\t\t\t\t\tpicPath: image.imageSrc ? encodeURI(image.imageSrc) : undefined,\n\t\t\t\t\t\t}"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div \n\t\t\t\t\tclass="intranet-user-mini-profile__entity-menu-item__title"\n\t\t\t\t\t:title="title"\n\t\t\t\t>\n\t\t\t\t\t{{ title }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const st={name:"UserDetailedInfoEntityListValue",components:{RichMenuPopup:c.RichMenuPopup,EntityMenuItem:it},props:{items:{type:Array,required:true},entityType:{type:String,required:false,default:""}},emits:["click"],data(){return{isMenuShow:false}},computed:{popupOptions(){const t=t=>h.Type.isStringFilled(t)?`${Rt}entity-list-${t}`:undefined;return{id:t(this.entityType),bindElement:this.$refs.counter,width:240,maxHeight:270,autoHide:true}},firstItem(){var t;return(t=this.items[0])!=null?t:null},isCounterShow(){return this.items.length>1},counterTitle(){return this.items.length-1}},methods:{openMenu(){this.isMenuShow=true},onElementClick(t){this.$emit("click",t)}},template:`\n\t\t<div class="intranet-user-mini-profile__user-detailed-info__list-value" v-if="items.length">\n\t\t\t<div class="intranet-user-mini-profile__user-detailed-info__list-value__element-container">\n\t\t\t\t\t<div v-if="this.$slots.default"\n\t\t\t\t\t\tclass="intranet-user-mini-profile__user-detailed-info__list-value__before-element"\n\t\t\t\t\t>\n\t\t\t\t\t\t<slot \n\t\t\t\t\t\t\t:item="firstItem"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t</slot>\n\t\t\t\t\t</div>\n\t\t\t\t<div class="intranet-user-mini-profile__user-detailed-info__list-value__element">\n\t\t\t\t\t<a\n\t\t\t\t\t\tclass="intranet-user-mini-profile__user-detailed-info__list-value__element-text"\n\t\t\t\t\t\t:title="firstItem.title"\n\t\t\t\t\t\t@click="onElementClick(firstItem.id)"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ firstItem.title }}\n\t\t\t\t\t</a>\n\t\t\t\t\t<div v-if="isCounterShow"\n\t\t\t\t\t\t class="intranet-user-mini-profile__user-detailed-info__list-value__counter ui-counter"\n\t\t\t\t\t\t ref="counter"\n\t\t\t\t\t\t @click="openMenu"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="ui-counter-inner">\n\t\t\t\t\t\t\t+{{ counterTitle }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<RichMenuPopup v-if="isMenuShow"\n\t\t\t\tclass="intranet-user-mini-profile__user-detailed-info__list-value__entity-menu"\n\t\t\t\t:popup-options="popupOptions"\n\t\t\t\t@close="isMenuShow = false"\n\t\t\t>\n\t\t\t\t<EntityMenuItem v-for="item in items"\n\t\t\t\t\t:title="item.title"\n\t\t\t\t\t:image="item.image"\n\t\t\t\t\t@click="onElementClick(item.id)"\n\t\t\t\t/>\n\t\t\t</RichMenuPopup>\n\t\t</div>\n\t`};const rt={name:"UserDetailedInfo",components:{BIcon:u.BIcon,UserDetailedInfoItem:nt,UserDetailedInfoContactItemValue:et,UserDetailedInfoEntityListValue:st},mixins:[F,D],props:{info:{type:Object,required:true},heads:{type:Array,default:()=>[]},userDepartments:{type:Array,default:()=>[]},departments:{type:Array,default:()=>[]},teams:{type:Array,default:()=>[]}},computed:{departmentItems(){return this.userDepartments.map((t=>({id:t.id,title:t.title,parentId:t.parentId,image:{bIconName:this.outlineSet.GROUP,iconClass:"--department"}})))},headItems(){return this.heads.map((t=>({id:t.id,title:t.name,image:{imageSrc:t.avatar},href:t.url})))},teamItems(){return this.teams.map((t=>({id:t.id,title:t.title,image:{bIconName:this.outlineSet.MY_PLAN,iconClass:"--team"}})))},headTitle(){return this.headItems.length<2?this.loc("INTRANET_USER_MINI_DETAILED_INFO_HEAD"):this.loc("INTRANET_USER_MINI_DETAILED_INFO_HEAD_MULTIPLE")},teamTitle(){return this.teamItems.length<2?this.loc("INTRANET_USER_MINI_DETAILED_INFO_FC_SINGLE"):this.loc("INTRANET_USER_MINI_DETAILED_INFO_FC")},departmentTitle(){return this.departmentItems.length<2?this.loc("INTRANET_USER_MINI_DETAILED_INFO_DEPARTMENT"):this.loc("INTRANET_USER_MINI_DETAILED_INFO_DEPARTMENT_MULTIPLE")}},methods:{onHeadClicked(t){const e=this.heads.find((e=>e.id===t));if(e!=null&&e.url){O.openUserProfile(e.url)}},onStructureNodeClicked(t){O.openStructureNodeId(t)},getParentDepartmentById(t){return this.departments.find((e=>e.id===t))}},template:`\n\t\t<div class="intranet-user-mini-profile__detailed-info">\n\t\t\t<UserDetailedInfoItem v-if="info.personalMobile"\n\t\t\t\t:title="loc('INTRANET_USER_MINI_DETAILED_INFO_PERSONAL_MOBILE')"\n\t\t\t>\n\t\t\t\t<UserDetailedInfoContactItemValue :value="info.personalMobile" type="phone"/>\n\t\t\t</UserDetailedInfoItem>\n\t\t\t<UserDetailedInfoItem v-if="info.innerPhone"\n\t\t\t\t:title="loc('INTRANET_USER_MINI_DETAILED_INFO_PHONE_INNER')"\n\t\t\t>\n\t\t\t\t{{ info.innerPhone }}\n\t\t\t</UserDetailedInfoItem>\n\t\t\t<UserDetailedInfoItem v-if="info.email"\n\t\t\t\t:title="loc('INTRANET_USER_MINI_DETAILED_INFO_EMAIL')"\n\t\t\t>\n\t\t\t\t<UserDetailedInfoContactItemValue :value="info.email" type="mail"/>\n\t\t\t</UserDetailedInfoItem>\n\t\t\t<UserDetailedInfoItem v-if="headItems.length"\n\t\t\t\t:title="headTitle"\n\t\t\t>\n\t\t\t\t<UserDetailedInfoEntityListValue\n\t\t\t\t\tentityType="user"\n\t\t\t\t\t:items="headItems"\n\t\t\t\t\t@click="(id) => onHeadClicked(id)"\n\t\t\t\t/>\n\t\t\t</UserDetailedInfoItem>\n\t\t\t<UserDetailedInfoItem v-if="departmentItems.length"\n\t\t\t\t:title="departmentTitle"\n\t\t\t>\n\t\t\t\t<UserDetailedInfoEntityListValue \n\t\t\t\t\t:items="departmentItems"\n\t\t\t\t\tentityType="department"\n\t\t\t\t\t@click="(id) => onStructureNodeClicked(id)"\n\t\t\t\t\tv-slot="{ item }"\n\t\t\t\t>\n\t\t\t\t\t<template v-if="getParentDepartmentById(item.parentId)">\n\t\t\t\t\t\t<div class="intranet-user-mini-profile__detailed-info-item__parent-department">\n\t\t\t\t\t\t\t<div class="intranet-user-mini-profile__detailed-info-item__parent-department-text"\n\t\t\t\t\t\t\t\t :title="getParentDepartmentById(item.parentId)?.title"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{{ getParentDepartmentById(item.parentId)?.title }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="intranet-user-mini-profile__detailed-info-item__parent-department-arrow">\n\t\t\t\t\t\t\t\t<div class="intranet-user-mini-profile__detailed-info-item__parent-department-arrow-icon">\n\t\t\t\t\t\t\t\t\t<BIcon :name="outlineSet.CHEVRON_RIGHT_L" :size="16"/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t</UserDetailedInfoEntityListValue>\n\t\t\t</UserDetailedInfoItem>\n\t\t\t<UserDetailedInfoItem v-if="teamItems.length"\n\t\t\t\t:title="teamTitle"\n\t\t\t>\n\t\t\t\t<UserDetailedInfoEntityListValue \n\t\t\t\t\t:items="teamItems"\n\t\t\t\t\tentityType="team"\n\t\t\t\t\t@click="(id) => onStructureNodeClicked(id)"\n\t\t\t\t/>\n\t\t\t</UserDetailedInfoItem>\n\t\t</div>\n\t`};const at={name:"UserMiniProfile",components:{UserMiniProfileLoader:B,UserBaseInfo:Q,UserDetailedInfo:rt,Divider:P,StructureViewList:x,CollapseTransition:j,ErrorState:S,LoaderTransition:y},props:{popup:{type:Object,required:true},userId:{type:Number,required:true}},data(){return{isError:false,errorType:g.Default,isLoaded:false,isLoading:false,isExpanded:true,isExpandBlocked:false,backendData:null}},computed:{userDepartments(){var t,e,n,i;const s=(t=(e=this.backendData.structure)==null?void 0:e.userDepartmentIds)!=null?t:[];const r=(n=(i=this.backendData.structure)==null?void 0:i.departmentDictionary)!=null?n:[];const a=[];s.forEach((t=>{const e=r[t];if(!e){return}a.push(e)}));return a},departments(){var t,e;return Object.values((t=(e=this.backendData.structure)==null?void 0:e.departmentDictionary)!=null?t:{})},heads(){var t,e,n,i,s,r;const a=(t=(e=this.backendData.structure)==null?void 0:e.userDepartmentIds)!=null?t:[];const l=(n=(i=this.backendData.structure)==null?void 0:i.departmentDictionary)!=null?n:[];const o=(s=(r=this.backendData.structure)==null?void 0:r.headDictionary)!=null?s:[];const d=[];const c=new Set;a.forEach((t=>{const e=l[t];if(!e){return}const{headIds:n}=e;if(n.includes(this.userId)){return}n.forEach((t=>{if(!c.has(t)&&o[t]){d.push(o[t]);c.add(t)}}))}));return d.filter((t=>t.id!==this.userId))},canShowDepartments(){return this.userDepartments.length>0},isShouldBeExpandedByInitial(){return E.getValue(_.RightSideExpand)==="Y"},canChat(){var t,e;return(t=(e=this.backendData)==null?void 0:e.access.canChat)!=null?t:false},isShowStructure(){return this.canShowDepartments&&this.isExpanded}},created(){if(!this.isLoaded){this.isLoading=true;void v.load(this.userId).then((t=>{this.backendData=t;this.isLoaded=true})).catch((t=>{if(t==="ACCESS_DENIED"){this.errorType=g.AccessDenied}this.isError=true})).finally((()=>{this.isLoading=false;this.adjustPopup()}))}this.isExpanded=this.isShouldBeExpandedByInitial},mounted(){this.adjustPopup()},methods:{onExpand(){if(this.isExpandBlocked){return}this.isExpanded=!this.isExpanded;E.save(_.RightSideExpand,this.isExpanded?"Y":"N")},adjustPopup(){var t;(t=this.popup)==null?void 0:t.adjustPosition()},onCollapseStart(){this.isExpandBlocked=true;this.adjustPopup()},onCollapseEnd(){this.isExpandBlocked=false;this.adjustPopup()},getUserData(){const{avatar:t,name:e,workPosition:n,url:i}=this.backendData.baseInfo;return{id:this.userId,avatar:t,name:e,workPosition:n,url:i}}},template:`\n\t\t<div class="intranet-user-mini-profile-wrapper">\n\t\t\t<template v-if="!isError">\n\t\t\t\t<LoaderTransition \n\t\t\t\t\t:isLoading="isLoading" \n\t\t\t\t\t:isShowContent="!!backendData"\n\t\t\t\t\t:isLoaderShort="!isShouldBeExpandedByInitial"\n\t\t\t\t\t@end="() => this.adjustPopup()"\n\t\t\t\t>\n\t\t\t\t\t<div class="intranet-user-mini-profile-wrapper__content">\n\t\t\t\t\t\t<div class="intranet-user-mini-profile-wrapper__column --left"\n\t\t\t\t\t\t\t ref="leftColumn"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<UserBaseInfo\n\t\t\t\t\t\t\t\t:userId="userId"\n\t\t\t\t\t\t\t\t:info="backendData.baseInfo"\n\t\t\t\t\t\t\t\t:isShowExpand="canShowDepartments"\n\t\t\t\t\t\t\t\t:isExpanded="isExpanded"\n\t\t\t\t\t\t\t\t:canChat="canChat"\n\t\t\t\t\t\t\t\t@expand="onExpand"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<template v-if="backendData.detailInfo">\n\t\t\t\t\t\t\t\t<Divider style="margin-top: 18px; margin-bottom: 14px"/>\n\t\t\t\t\t\t\t\t<UserDetailedInfo\n\t\t\t\t\t\t\t\t  :info="backendData.detailInfo"\n\t\t\t\t\t\t\t\t  :userDepartments="userDepartments"\n\t\t\t\t\t\t\t\t  :departments="departments"\n\t\t\t\t\t\t\t\t  :heads="heads"\n\t\t\t\t\t\t\t\t  :teams="backendData.structure.teams"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<CollapseTransition\n\t\t\t\t\t\t\t@start="onCollapseStart"\n\t\t\t\t\t\t\t@end="onCollapseEnd"\n\t\t\t\t\t\t\t:initialHeight="$refs.leftColumn?.offsetHeight"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div v-if="isShowStructure" \n\t\t\t\t\t\t\t\tclass="intranet-user-mini-profile-wrapper__content__right-wrapper"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Divider isVertical style="margin: 0 18px"/>\n\t\t\t\t\t\t\t\t<div class="intranet-user-mini-profile-wrapper__column --right">\n\t\t\t\t\t\t\t\t\t<StructureViewList\n\t\t\t\t\t\t\t\t\t\t:structure="backendData.structure"\n\t\t\t\t\t\t\t\t\t\t:user="getUserData()"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</CollapseTransition>\n\t\t\t\t\t</div>\n\t\t\t\t</LoaderTransition>\n\t\t\t</template>\n\t\t\t<ErrorState v-if="isError"\n\t\t\t\t:type="errorType"\n\t\t\t/>\n\t\t</div>\n\t`};const lt=1e3;const ot=500;var dt=babelHelpers.classPrivateFieldLooseKey("popup");var ct=babelHelpers.classPrivateFieldLooseKey("bindElement");var ut=babelHelpers.classPrivateFieldLooseKey("showOrCloseTimeout");var pt=babelHelpers.classPrivateFieldLooseKey("haveToCloseCheckInterval");var mt=babelHelpers.classPrivateFieldLooseKey("handler");var ht=babelHelpers.classPrivateFieldLooseKey("onBindElementClick");var ft=babelHelpers.classPrivateFieldLooseKey("onMouseEnter");var vt=babelHelpers.classPrivateFieldLooseKey("onMouseLeave");var _t=babelHelpers.classPrivateFieldLooseKey("haveToClose");var bt=babelHelpers.classPrivateFieldLooseKey("isPopupOnTop");var It=babelHelpers.classPrivateFieldLooseKey("scheduleClose");var Et=babelHelpers.classPrivateFieldLooseKey("scheduleShow");var Tt=babelHelpers.classPrivateFieldLooseKey("getTrackingElements");class Pt extends m.EventEmitter{constructor(t){super();Object.defineProperty(this,Tt,{value:Ft});Object.defineProperty(this,Et,{value:Dt});Object.defineProperty(this,It,{value:Nt});Object.defineProperty(this,bt,{value:yt});Object.defineProperty(this,_t,{value:Bt});Object.defineProperty(this,vt,{value:St});Object.defineProperty(this,ft,{value:gt});Object.defineProperty(this,ht,{value:Lt});Object.defineProperty(this,dt,{writable:true,value:void 0});Object.defineProperty(this,ct,{writable:true,value:null});Object.defineProperty(this,ut,{writable:true,value:null});Object.defineProperty(this,pt,{writable:true,value:null});Object.defineProperty(this,mt,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]=t.popup;babelHelpers.classPrivateFieldLooseBase(this,ct)[ct]=t.bindElement;babelHelpers.classPrivateFieldLooseBase(this,mt)[mt]={onMouseEnter:t=>babelHelpers.classPrivateFieldLooseBase(this,ft)[ft](t),onMouseLeave:t=>babelHelpers.classPrivateFieldLooseBase(this,vt)[vt](t),onBindElementClick:t=>babelHelpers.classPrivateFieldLooseBase(this,ht)[ht](t)};this.setEventNamespace("Intranet.User.MiniProfile.Tracking")}setBindElement(t){if(babelHelpers.classPrivateFieldLooseBase(this,ct)[ct]===t){return}this.unbindTracking();babelHelpers.classPrivateFieldLooseBase(this,ct)[ct]=t;if(babelHelpers.classPrivateFieldLooseBase(this,ct)[ct]){this.setupTracking()}}setupTracking(){const{onMouseEnter:t,onMouseLeave:e,onBindElementClick:n}=babelHelpers.classPrivateFieldLooseBase(this,mt)[mt];h.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,ct)[ct],"click",n);babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt]().forEach((n=>{h.Event.bind(n,"mouseenter",t);h.Event.bind(n,"mouseleave",e)}))}unbindTracking(){const{onMouseEnter:t,onMouseLeave:e,onBindElementClick:n}=babelHelpers.classPrivateFieldLooseBase(this,mt)[mt];h.Event.unbind(babelHelpers.classPrivateFieldLooseBase(this,ct)[ct],"click",n);babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt]().forEach((n=>{h.Event.unbind(n,"mouseenter",t);h.Event.unbind(n,"mouseleave",e)}));clearInterval(babelHelpers.classPrivateFieldLooseBase(this,ut)[ut]);clearInterval(babelHelpers.classPrivateFieldLooseBase(this,pt)[pt])}}function Lt(){clearInterval(babelHelpers.classPrivateFieldLooseBase(this,pt)[pt]);clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,ut)[ut]);this.emit("close")}function gt(t){clearInterval(babelHelpers.classPrivateFieldLooseBase(this,pt)[pt]);babelHelpers.classPrivateFieldLooseBase(this,Et)[Et]()}function St(t){clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,ut)[ut]);if(babelHelpers.classPrivateFieldLooseBase(this,_t)[_t]()){babelHelpers.classPrivateFieldLooseBase(this,It)[It]()}else if(!babelHelpers.classPrivateFieldLooseBase(this,bt)[bt]()){babelHelpers.classPrivateFieldLooseBase(this,pt)[pt]=setInterval((()=>{if(!babelHelpers.classPrivateFieldLooseBase(this,_t)[_t]()){return}this.emit("close");clearInterval(babelHelpers.classPrivateFieldLooseBase(this,pt)[pt])}),ot*2)}}function Bt(){if(babelHelpers.classPrivateFieldLooseBase(this,dt)[dt].isShown()&&babelHelpers.classPrivateFieldLooseBase(this,bt)[bt]()){return true}return false}function yt(){const t=f.PopupManager.getPopups();for(let e=t.length-1;e>=0;--e){const n=t[e];if(n.getId()===babelHelpers.classPrivateFieldLooseBase(this,dt)[dt].getId()){return true}if(n.isShown()&&n.getId().includes(Rt)){return false}}return true}function Nt(){clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,ut)[ut]);babelHelpers.classPrivateFieldLooseBase(this,ut)[ut]=setTimeout((()=>{this.emit("close")}),ot)}function Dt(){clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,ut)[ut]);babelHelpers.classPrivateFieldLooseBase(this,ut)[ut]=setTimeout((()=>{this.emit("show")}),lt)}function Ft(){return[babelHelpers.classPrivateFieldLooseBase(this,ct)[ct],babelHelpers.classPrivateFieldLooseBase(this,dt)[dt].getPopupContainer()]}let Ht=t=>t,Ot;const Rt="intranet-user-mini-profile-";const Mt=33;var At=babelHelpers.classPrivateFieldLooseKey("options");var Ct=babelHelpers.classPrivateFieldLooseKey("cache");var wt=babelHelpers.classPrivateFieldLooseKey("tracking");var Ut=babelHelpers.classPrivateFieldLooseKey("app");var kt=babelHelpers.classPrivateFieldLooseKey("closeHandler");var xt=babelHelpers.classPrivateFieldLooseKey("getPopup");var jt=babelHelpers.classPrivateFieldLooseKey("getContainer");var Vt=babelHelpers.classPrivateFieldLooseKey("createAppIfNeed");var $t=babelHelpers.classPrivateFieldLooseKey("bindEvents");class qt{constructor(t){Object.defineProperty(this,$t,{value:Wt});Object.defineProperty(this,Vt,{value:zt});Object.defineProperty(this,jt,{value:Xt});Object.defineProperty(this,xt,{value:Kt});Object.defineProperty(this,At,{writable:true,value:void 0});Object.defineProperty(this,Ct,{writable:true,value:new e.MemoryCache});Object.defineProperty(this,wt,{writable:true,value:void 0});Object.defineProperty(this,Ut,{writable:true,value:null});Object.defineProperty(this,kt,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,At)[At]=t;babelHelpers.classPrivateFieldLooseBase(this,wt)[wt]=new Pt({popup:babelHelpers.classPrivateFieldLooseBase(this,xt)[xt](),bindElement:t.bindElement});babelHelpers.classPrivateFieldLooseBase(this,kt)[kt]=()=>this.close();babelHelpers.classPrivateFieldLooseBase(this,$t)[$t]()}destroy(){var t;babelHelpers.classPrivateFieldLooseBase(this,wt)[wt].unbindTracking();babelHelpers.classPrivateFieldLooseBase(this,xt)[xt]().destroy();(t=babelHelpers.classPrivateFieldLooseBase(this,Ut)[Ut])==null?void 0:t.unmount();m.EventEmitter.unsubscribe("SidePanel.Slider:onOpen",babelHelpers.classPrivateFieldLooseBase(this,kt)[kt]);m.EventEmitter.unsubscribe("Intranet.User.MiniProfile:close",babelHelpers.classPrivateFieldLooseBase(this,kt)[kt])}show(){babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt]();babelHelpers.classPrivateFieldLooseBase(this,xt)[xt]().show()}close(){babelHelpers.classPrivateFieldLooseBase(this,xt)[xt]().close();f.PopupManager.getPopups().filter((t=>t.isShown()&&t.getId().includes(Rt))).forEach((t=>{t.close()}))}setBindElement(t){if(babelHelpers.classPrivateFieldLooseBase(this,At)[At].bindElement===t){return}const e=babelHelpers.classPrivateFieldLooseBase(this,xt)[xt]();e.close();e.setBindElement(t);babelHelpers.classPrivateFieldLooseBase(this,wt)[wt].setBindElement(t);babelHelpers.classPrivateFieldLooseBase(this,At)[At].bindElement=t}getBindElement(){return babelHelpers.classPrivateFieldLooseBase(this,At)[At].bindElement}}function Kt(){return babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct].remember("popup",(()=>new f.Popup({className:"intranet-user-mini-profile-popup",content:babelHelpers.classPrivateFieldLooseBase(this,jt)[jt](),targetContainer:document.body,bindElement:babelHelpers.classPrivateFieldLooseBase(this,At)[At].bindElement,maxWidth:643,maxHeight:497,padding:0,contentNoPaddings:true,angle:{offset:babelHelpers.classPrivateFieldLooseBase(this,At)[At].bindElement.offsetWidth/2+Mt/2},animation:"fading",bindOptions:{forceBindPosition:true,forceTop:true}})))}function Xt(){return babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct].remember("container",(()=>h.Tag.render(Ot||(Ot=Ht`
				<div class="intranet-user-mini-profile --ui-context-content-light"></div>
			`))))}function zt(){if(babelHelpers.classPrivateFieldLooseBase(this,Ut)[Ut]){return}const{userId:t}=babelHelpers.classPrivateFieldLooseBase(this,At)[At];const e=babelHelpers.classPrivateFieldLooseBase(this,xt)[xt]();babelHelpers.classPrivateFieldLooseBase(this,Ut)[Ut]=i.BitrixVue.createApp(at,{userId:t,popup:e});babelHelpers.classPrivateFieldLooseBase(this,Ut)[Ut].mount(babelHelpers.classPrivateFieldLooseBase(this,jt)[jt]())}function Wt(){babelHelpers.classPrivateFieldLooseBase(this,wt)[wt].setupTracking();babelHelpers.classPrivateFieldLooseBase(this,wt)[wt].subscribe("close",(()=>this.close()));babelHelpers.classPrivateFieldLooseBase(this,wt)[wt].subscribe("show",(()=>this.show()));m.EventEmitter.subscribe("SidePanel.Slider:onOpen",babelHelpers.classPrivateFieldLooseBase(this,kt)[kt]);m.EventEmitter.subscribe("Intranet.User.MiniProfile:close",babelHelpers.classPrivateFieldLooseBase(this,kt)[kt])}var Gt=babelHelpers.classPrivateFieldLooseKey("instanceByIdMap");var Yt=babelHelpers.classPrivateFieldLooseKey("instanceByBindElementMap");class Zt{static getById(t){return babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].get(t)}static create(t){const{id:e,bindElement:n}=t;if(babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt].has(n)){const t=babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt].get(n);const i=babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].get(e);if(i!==t){t.setBindElement(null);babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt].delete(n)}}if(babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].has(e)){const t=babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].get(e);const i=t.getBindElement();if(i!==n){babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt].delete(i);t.setBindElement(n)}babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt].set(n,t);return t}const i=new qt(t);babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].set(e,i);babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt].set(n,i);return i}}Object.defineProperty(Zt,Gt,{writable:true,value:new Map});Object.defineProperty(Zt,Yt,{writable:true,value:new Map});t.UserMiniProfileManager=Zt})(this.BX.Intranet.User=this.BX.Intranet.User||{},BX.Cache,BX.Vue3.Components,BX.Vue3,BX,BX.Humanresources.CompanyStructure,BX.UI.Vue3.Components,BX.UI.IconSet,BX.Main,BX,BX.UI.Vue3.Components,BX.UI.IconSet,BX.UI.Vue3.Components,BX.Event,BX,BX.Main);
//# sourceMappingURL=user-mini-profile.bundle.map.js