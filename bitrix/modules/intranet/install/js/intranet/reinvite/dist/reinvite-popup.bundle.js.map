{"version":3,"file":"reinvite-popup.bundle.js","sources":["../src/form.js","../src/phone-form.js","../src/email-form.js","../src/types.js","../src/form-factory.js","../src/reinvite-popup.js"],"sourcesContent":["import { Tag } from 'main.core';\nexport class Form\n{\n\t#id: string;\n\t#value: string;\n\t#userId: number;\n\t#content: HTMLElement;\n\t#formNode: HTMLElement;\n\n\tconstructor(options)\n\t{\n\t\tthis.#id = `form-${options.id}`;\n\t\tthis.#value = options.inputValue;\n\t\tthis.#userId = options.userId;\n\t}\n\tgetTitleRender(): HTMLElement\n\t{\n\t\treturn new HTMLElement();\n\t}\n\n\tgetFieldRender(): HTMLElement\n\t{\n\t\treturn new HTMLElement();\n\t}\n\n\tgetFormNode(): HTMLElement\n\t{\n\t\treturn this.render().querySelector('form#' + this.#id);\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tif (this.#content)\n\t\t{\n\t\t\treturn this.#content;\n\t\t}\n\t\tthis.#content = Tag.render`\n\t\t<div class=\"intranet-reinvite-popup-wrapper\">\n\t\t\t<form method=\"POST\" id=\"${this.#id}\">\n\t\t\t\t<input type=\"hidden\" name=\"userId\" value=\"${this.#userId}\">\n\t\t\t\t${this.getTitleRender()}\n\t\t\t\t${this.getFieldRender()}\n\t\t\t</form>\n\t\t</div>`;\n\n\t\treturn this.#content;\n\t}\n\n\tgetValue(): string\n\t{\n\t\treturn this.#value;\n\t}\n\n\tgetData(): FormData\n\t{\n\t\treturn new FormData(this.getFormNode());\n\t}\n}\n","import { Form } from './form';\nimport { Tag, Type, Loc } from 'main.core';\n\nexport class PhoneForm extends Form\n{\n\tgetTitleRender(): HTMLElement\n\t{\n\t\treturn Tag.render`<div class=\"intranet-reinvite-popup-title\">\n\t\t\t${Loc.getMessage('INTRANET_JS_PHONE_POPUP_TITLE', {'#CODE#': 'redirect=detail&code=17729332'})}\n\t\t</div>`;\n\t}\n\n\tgetFieldRender(): HTMLElement\n\t{\n\t\tconst form = Tag.render`\n\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-before-icon ui-ctl-after-icon intranet-reinvite-popup-field-row\">\n\t\t\t\t<div class=\"intranet-reinvite-popup-field-label\">\n\t\t\t\t\t<label>${Loc.getMessage('INTRANET_JS_PHONE_FIELD_LABEL')}</label>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox\">\n\t\t\t\t\t<div id=\"intranet_reinvite_phone_flag\" class=\"ui-ctl-before --flag\"></div>\n\t\t\t\t\t<input id=\"intranet_reinvite_phone_input\" type=\"text\" name=\"newPhone\" value=\"${this.getValue()}\" class=\"ui-ctl-element\">\n\t\t\t\t</div>\n\t\t\t</div>`;\n\n\t\tnew BX.PhoneNumber.Input({\n\t\t\tnode: form.querySelector('#intranet_reinvite_phone_input'),\n\t\t\tdefaultCountry: 'ru',\n\t\t\tflagNode: form.querySelector('#intranet_reinvite_phone_flag'),\n\t\t\tflagSize: 24,\n\t\t\tonChange: function(e) {},\n\t\t});\n\n\t\treturn form;\n\t}\n}\n","import { Form } from './form';\nimport { Tag, Type, Loc, Event } from 'main.core';\n\nexport class EmailForm extends Form\n{\n\t#onButtonStateChange: ?Function;\n\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\t\tthis.#onButtonStateChange = Type.isFunction(options.onButtonStateChange) ? options.onButtonStateChange : null;\n\t}\n\n\tgetTitleRender(): HTMLElement\n\t{\n\t\treturn Tag.render`<div class=\"intranet-reinvite-popup-title\">\n\t\t\t${Loc.getMessage('INTRANET_JS_EMAIL_POPUP_TITLE', {'#CODE#': 'redirect=detail&code=17729332'})}\n\t\t\t</div>`;\n\t}\n\n\tgetFieldRender(): HTMLElement\n\t{\n\t\tconst field = Tag.render`\n\t\t\t<div class=\"intranet-reinvite-popup-field-row\">\n\t\t\t\t<div class=\"intranet-reinvite-popup-field-label\">\n\t\t\t\t\t<label>${Loc.getMessage('INTRANET_JS_EMAIL_FIELD_LABEL')}</label>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox\">\n\t\t\t\t\t<input type=\"text\" name=\"newEmail\" value=\"${this.getValue()}\" class=\"ui-ctl-element\"> \n\t\t\t\t</div>\n\t\t\t</div>`;\n\n\t\tconst input = field.querySelector('input[name=\"newEmail\"]');\n\t\tif (input && this.#onButtonStateChange)\n\t\t{\n\t\t\tEvent.bind(input, 'input', (event) => {\n\t\t\t\tconst value = event.target.value.trim();\n\t\t\t\tthis.#onButtonStateChange(Type.isStringFilled(value));\n\t\t\t});\n\t\t}\n\n\t\treturn field;\n\t}\n}","export const FormType = {\n\tEMAIL: 'email',\n\tPHONE: 'phone',\n};\n\nexport type ReinvitePopupOptions = {\n\tuserId: number,\n\tformType: FormType,\n\tbindElement?: Element,\n\ttransport?: function,\n\tinputValue?: string\n};","import { Form } from './form';\nimport { PhoneForm } from './phone-form';\nimport { EmailForm } from './email-form';\nimport { FormType } from './types';\n\nexport class FormFactory\n{\n\tconstructor() {}\n\n\tstatic create(type: FormType, options): Form\n\t{\n\t\tswitch (type)\n\t\t{\n\t\t\tcase FormType.EMAIL:\n\t\t\t\treturn new EmailForm(options);\n\t\t\tcase FormType.PHONE:\n\t\t\t\treturn new PhoneForm(options);\n\t\t\tdefault:\n\t\t\t\tthrow new Error('Unknown ContextType value: ' + type);\n\t\t}\n\t}\n}","import { Tag, Type, Loc } from 'main.core';\nimport { Popup, PopupManager } from 'main.popup';\nimport { Button } from 'ui.buttons';\nimport { Form } from './form';\nimport type { ReinvitePopupOptions } from './types';\nimport { FormFactory } from './form-factory';\nimport './style.css';\n\nexport class ReinvitePopup\n{\n\t#popup: Popup;\n\t#transport: function;\n\t#userId: number;\n\t#id: string;\n\t#inputValue: string;\n\t#bindElement: ?HTMLElement;\n\t#form: Form;\n\t#width: number;\n\t#sendButton: Button;\n\n\tconstructor(options: ReinvitePopupOptions)\n\t{\n\t\tif (options.userId <= 0)\n\t\t{\n\t\t\tthrow new Error('Invalide \"userId\" parameter');\n\t\t}\n\t\tthis.#userId = options.userId;\n\t\tthis.#id = 'reinvite-popup-' + options.userId;\n\t\tthis.#bindElement = Type.isElementNode(options.bindElement) ? options.bindElement : null;\n\t\tthis.#transport = Type.isFunction(options.transport) ? options.transport : null;\n\t\tthis.#width = 348;\n\n\t\tthis.#form = FormFactory.create(options.formType, {\n\t\t\tid: this.#id,\n\t\t\tuserId: this.#userId,\n\t\t\tinputValue: options.inputValue,\n\t\t\tonButtonStateChange: this.#handleButtonStateChange.bind(this),\n\t\t});\n\t}\n\n\t#handleButtonStateChange(isEnabled: boolean): void\n\t{\n\t\tif (this.#sendButton)\n\t\t{\n\t\t\tthis.#sendButton.setDisabled(!isEnabled);\n\t\t}\n\t}\n\n\tshow(): void\n\t{\n\t\tthis.getPopup().show();\n\t}\n\n\tgetPopup(): Popup\n\t{\n\t\tif (this.#popup)\n\t\t{\n\t\t\treturn this.#popup;\n\t\t}\n\n\t\tthis.#popup = this.#createPopup();\n\n\t\treturn this.#popup;\n\t}\n\n\t#createPopup(options): Popup\n\t{\n\t\tif (PopupManager.isPopupExists(this.#id))\n\t\t{\n\t\t\treturn PopupManager.getPopupById(this.#id);\n\t\t}\n\n\t\tconst popup = new Popup(\n\t\t\tthis.#id,\n\t\t\tthis.#bindElement,\n\t\t\t{\n\t\t\t\tcontent: this.#form.render(),\n\t\t\t\tautoHide: true,\n\t\t\t\tangle: {\n\t\t\t\t\toffset: this.#width / 2 - 16.5,\n\t\t\t\t},\n\t\t\t\twidth: this.#width,\n\t\t\t\tpadding: 18,\n\t\t\t\toffsetLeft: (((this.#bindElement.offsetWidth / 2) - this.#width / 2) / 2) - 10,\n\t\t\t\tcloseIcon: false,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\toverlay: false,\n\t\t\t\tclassName: 'reinvite-popup-container',\n\t\t\t\tbindOptions: { position: 'top' },\n\t\t\t\tanimation: \"fading-slide\",\n\t\t\t\tbuttons: [\n\t\t\t\t\tthis.#sendButton = new Button({\n\t\t\t\t\t\ttext: Loc.getMessage('INTRANET_JS_BTN_SEND'),\n\t\t\t\t\t\tcolor: Button.Color.PRIMARY,\n\t\t\t\t\t\tround: true,\n\t\t\t\t\t\tnoCaps: true,\n\t\t\t\t\t\tonclick: (button: Button) => {\n\t\t\t\t\t\t\tthis.send();\n\t\t\t\t\t\t\tthis.getPopup().close();\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t\tnew Button({\n\t\t\t\t\t\ttext: Loc.getMessage('INTRANET_JS_BTN_CANCEL'),\n\t\t\t\t\t\tcolor: Button.Color.LIGHT_BORDER,\n\t\t\t\t\t\tround: true,\n\t\t\t\t\t\tnoCaps: true,\n\t\t\t\t\t\tonclick: (button: Button) => {\n\t\t\t\t\t\t\tthis.getPopup().close();\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t},\n\t\t);\n\n\t\tconst inputValue = this.#form.getValue()?.trim() || '';\n\t\tthis.#handleButtonStateChange(inputValue !== '');\n\n\t\treturn popup;\n\t}\n\n\tsend(): void\n\t{\n\t\tthis.#transport(this.#form.getData());\n\t}\n}\n"],"names":["Form","constructor","options","id","inputValue","userId","getTitleRender","HTMLElement","getFieldRender","getFormNode","render","querySelector","Tag","getValue","getData","FormData","PhoneForm","Loc","getMessage","form","BX","PhoneNumber","Input","node","defaultCountry","flagNode","flagSize","onChange","e","EmailForm","Type","isFunction","onButtonStateChange","field","input","Event","bind","event","value","target","trim","isStringFilled","FormType","EMAIL","PHONE","FormFactory","create","type","Error","ReinvitePopup","isElementNode","bindElement","transport","formType","show","getPopup","send","isEnabled","setDisabled","PopupManager","isPopupExists","getPopupById","popup","Popup","content","autoHide","angle","offset","width","padding","offsetLeft","offsetWidth","closeIcon","closeByEsc","overlay","className","bindOptions","position","animation","buttons","Button","text","color","Color","PRIMARY","round","noCaps","onclick","button","close","LIGHT_BORDER"],"mappings":"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"}