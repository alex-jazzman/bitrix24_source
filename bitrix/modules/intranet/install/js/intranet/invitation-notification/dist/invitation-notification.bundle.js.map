{"version":3,"file":"invitation-notification.bundle.js","sources":["../src/invitation-notification.js"],"sourcesContent":["import { Extension, Type, Dom, Loc } from 'main.core';\nimport { BannerDispatcher } from 'ui.banner-dispatcher';\nimport { Popup, PopupManager } from 'main.popup';\nimport { Button } from 'ui.buttons';\nimport { sendData } from 'ui.analytics';\nimport './style.css';\n\nexport type NotificationOptions = {\n\ttitle: string;\n\tdescription: string;\n\ttype: number;\n}\n\nexport class InvitationNotification\n{\n\t#popup: Popup = null;\n\t#options: NotificationOptions = null;\n\t#invitationLink: ?string = null;\n\tinvitationButton: ?Element = null;\n\n\tconstructor(options: NotificationOptions)\n\t{\n\t\tif (Type.isObject(options))\n\t\t{\n\t\t\tthis.#options = options;\n\t\t}\n\n\t\tthis.#invitationLink = Extension.getSettings('intranet.invitation-notification').inviteWidgetLink;\n\t\tthis.invitationButton = document.querySelector('[data-id=\"invitationButton\"]');\n\t}\n\n\tcreateNotificationBalloon(onDone: Function): BX.UI.Notification.Balloon\n\t{\n\t\tconst isAirTemplate = BX.Reflection.getClass('BX.Intranet.Bitrix24.Template') !== null;\n\n\t\treturn PopupManager.create({\n\t\t\tid: 'push-invitations',\n\t\t\tclassName: 'popup-window-dark',\n\t\t\tbackground: 'rgb(8, 93, 193)',\n\t\t\tcloseIcon: true,\n\t\t\tautoHide: false,\n\t\t\tcloseByEsc: true,\n\t\t\tpadding: 12,\n\t\t\tborderRadius: 20,\n\t\t\tcontentPadding: 0,\n\t\t\toffsetTop: 10,\n\t\t\toffsetLeft: isAirTemplate ? -310 : -277,\n\t\t\tangle: {\n\t\t\t\toffset: 360,\n\t\t\t\tposition: 'top',\n\t\t\t},\n\t\t\tbindElement: this.invitationButton,\n\t\t\tbindOptions: {\n\t\t\t\tforceBindPosition: false,\n\t\t\t},\n\t\t\twidth: 440,\n\t\t\tminHeight: 120,\n\t\t\tcontent: this.getContent(),\n\t\t\tevents: {\n\t\t\t\tonClose: () => {\n\t\t\t\t\tonDone();\n\t\t\t\t\tBX.userOptions.save('intranet.invitation', 'invitationNotificationTransitionBalloonTs', null, Math.floor(Date.now() / 1000));\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\tgetContent(): HTMLElement\n\t{\n\t\tconst title = this.#options.title;\n\t\tconst description = this.#options.description;\n\n\t\treturn Dom.create('div', {\n\t\t\tprops: {\n\t\t\t\tclassName: 'intranet-notification-container',\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'intranet-notification-container__image-wrapper',\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.#renderImage(),\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'intranet-notification-content',\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.#getMessageContainer(title, description),\n\t\t\t\t\t\tthis.#getButtonContainer(),\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\t}\n\n\t#renderImage(): HTMLElement\n\t{\n\t\treturn Dom.create('div', {\n\t\t\tprops: {\n\t\t\t\tclassName: 'intranet-notification-container__image',\n\t\t\t},\n\t\t});\n\t}\n\n\t#getMessageContainer(title, description): HTMLElement\n\t{\n\t\treturn Dom.create('div', {\n\t\t\tprops: {\n\t\t\t\tclassName: 'intranet-notification-content-wrapper',\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create('h4', {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'intranet-notification-content__title',\n\t\t\t\t\t},\n\t\t\t\t\thtml: title,\n\t\t\t\t}),\n\t\t\t\tDom.create('span', {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'intranet-notification-content__description',\n\t\t\t\t\t},\n\t\t\t\t\thtml: description,\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\t}\n\n\t#getButtonContainer(): HTMLElement\n\t{\n\t\tconst isReInviteNotification = this.#options.type === 7;\n\t\tconst text = isReInviteNotification\n\t\t\t? Loc.getMessage('INTRANET_INVITATION_NOTIFICATION_BALLON_BUTTON_REINVITE')\n\t\t\t: Loc.getMessage('INTRANET_INVITATION_NOTIFICATION_BALLON_BUTTON_INVITE');\n\n\t\treturn (new Button({\n\t\t\ttext,\n\t\t\tround: true,\n\t\t\tnoCaps: true,\n\t\t\tclassName: 'intranet-notification-content__action',\n\t\t\tonclick: () => {\n\t\t\t\tthis.#popup.close();\n\t\t\t\tthis.#sendAnalytics('button_click');\n\t\t\t\tif (isReInviteNotification)\n\t\t\t\t{\n\t\t\t\t\twindow.location.href = '/company/?INVITED=Y';\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tconst link = document.createElement('a');\n\t\t\t\t\tlink.setAttribute('onclick', this.#invitationLink);\n\t\t\t\t\tlink.click();\n\t\t\t\t}\n\t\t\t},\n\t\t})).render();\n\t}\n\n\tshow(): void\n\t{\n\t\tif (!this.invitationButton)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tBannerDispatcher.critical.toQueue((onDone) => {\n\t\t\tthis.#popup = this.createNotificationBalloon(onDone);\n\t\t\tthis.#popup.show();\n\t\t\tthis.#popup.zIndexComponent.setZIndex(400);\n\t\t\tthis.#sendAnalytics('push_show');\n\n\t\t\tthis.invitationButton.addEventListener('click', () => {\n\t\t\t\tthis.#popup?.close();\n\t\t\t});\n\t\t});\n\t}\n\n\t#sendAnalytics(event: string): void\n\t{\n\t\tconst typeMap = {\n\t\t\t1: \"common\",\n\t\t\t3: \"tasks\",\n\t\t\t4: \"crm\",\n\t\t\t5: \"automatization\",\n\t\t\t6: \"common\",\n\t\t\t7: \"repeat_invite\"\n\t\t};\n\t\tconst type = typeMap[this.#options.type] || \"unknown\";\n\n\t\tconst params = {\n\t\t\ttool: 'invitation',\n\t\t\tcategory: 'onboarding',\n\t\t\tevent,\n\t\t\ttype: type,\n\t\t};\n\n\t\tsendData(params);\n\t}\n}\n"],"names":["InvitationNotification","options","babelHelpers","_classPrivateMethodInitSpec","_classPrivateFieldInitSpec","writable","value","Type","isObject","Extension","getSettings","inviteWidgetLink","this","invitationButton","document","querySelector","key","onDone","isAirTemplate","BX","Reflection","getClass","PopupManager","create","id","className","background","closeIcon","autoHide","closeByEsc","padding","borderRadius","contentPadding","offsetTop","offsetLeft","angle","offset","position","bindElement","bindOptions","forceBindPosition","width","minHeight","content","getContent","events","onClose","userOptions","save","Math","floor","Date","now","title","description","Dom","props","children","BannerDispatcher","critical","toQueue","createNotificationBalloon","show","zIndexComponent","setZIndex","_classPrivateMethodGet","addEventListener","_babelHelpers$classPr","close","html","isReInviteNotification","type","text","Loc","getMessage","Button","round","noCaps","onclick","window","location","href","link","createElement","setAttribute","click","render","event","params","tool","category","1","3","4","5","6","7","sendData"],"mappings":"2VAKqB,0GAQRA,aAOZ,WAAYC,GACZC,oCAAAC,UAAAA,UAAAA,UAAAA,UAAAC,UAAAC,YAAAC,MANgB,OAAIF,UAAAC,YAAAC,MACY,OAAIF,UAAAC,YAAAC,MACT,OAAIJ,oDACF,MAIxBK,OAAKC,SAASP,IAEjBC,yCAAgBD,GAGjBC,yCAAuBO,YAAUC,YAAY,oCAAoCC,kBACjFC,KAAKC,iBAAmBC,SAASC,cAAc,gCAoJ/C,OAnJAb,6BAAAc,gCAAAV,eAEyBW,GAEzB,MAAMC,EAA4E,OAA5DC,GAAGC,WAAWC,SAAS,iCAE7C,OAAOC,eAAaC,OAAO,CAC1BC,GAAI,mBACJC,UAAW,oBACXC,WAAY,kBACZC,WAAW,EACXC,UAAU,EACVC,YAAY,EACZC,QAAS,GACTC,aAAc,GACdC,eAAgB,EAChBC,UAAW,GACXC,WAAYhB,GAAiB,KAAO,IACpCiB,MAAO,CACNC,OAAQ,IACRC,SAAU,OAEXC,YAAa1B,KAAKC,iBAClB0B,YAAa,CACZC,mBAAmB,GAEpBC,MAAO,IACPC,UAAW,IACXC,QAAS/B,KAAKgC,aACdC,OAAQ,CACPC,QAAS,KACR7B,IACAE,GAAG4B,YAAYC,KAAK,sBAAuB,4CAA6C,KAAMC,KAAKC,MAAMC,KAAKC,MAAQ,aAIzHpC,iBAAAV,iBAIA,MAAM+C,EAAQnD,0CAAcmD,MACtBC,EAAcpD,0CAAcoD,YAElC,OAAOC,MAAIhC,OAAO,MAAO,CACxBiC,MAAO,CACN/B,UAAW,mCAEZgC,SAAU,CACTF,MAAIhC,OAAO,MAAO,CACjBiC,MAAO,CACN/B,UAAW,kDAEZgC,SAAU,GACT7C,eAAAA,SAGF2C,MAAIhC,OAAO,MAAO,CACjBiC,MAAO,CACN/B,UAAW,iCAEZgC,SAAU,GACT7C,eAAAA,KAA0ByC,EAAOC,KACjC1C,eAAAA,eAKJI,WAAAV,iBAiEKM,KAAKC,kBAKV6C,mBAAiBC,SAASC,QAAS3C,IAClCf,yCAAcU,KAAKiD,0BAA0B5C,IAC7Cf,0CAAY4D,OACZ5D,0CAAY6D,gBAAgBC,UAAU,KACtCC,iBAAArD,KAAoB,aAEpBA,KAAKC,iBAAiBqD,iBAAiB,QAAS,KAAM,wEACrDC,EAAaC,qBA0BhB,aAnGC,OAAOb,MAAIhC,OAAO,MAAO,CACxBiC,MAAO,CACN/B,UAAW,4CAGb,WAEoB4B,EAAOC,GAE3B,OAAOC,MAAIhC,OAAO,MAAO,CACxBiC,MAAO,CACN/B,UAAW,yCAEZgC,SAAU,CACTF,MAAIhC,OAAO,KAAM,CAChBiC,MAAO,CACN/B,UAAW,wCAEZ4C,KAAMhB,IAEPE,MAAIhC,OAAO,OAAQ,CAClBiC,MAAO,CACN/B,UAAW,8CAEZ4C,KAAMf,OAIT,aAIA,MAAMgB,EAAgD,IAAvBpE,0CAAcqE,KACvCC,EAAOF,EACVG,MAAIC,WAAW,2DACfD,MAAIC,WAAW,yDAElB,OAAQ,IAAIC,SAAO,CAClBH,KAAAA,EACAI,OAAO,EACPC,QAAQ,EACRpD,UAAW,wCACXqD,QAAS,KAGR,GAFA5E,0CAAYkE,QACZH,iBAAArD,KAAoB,gBAChB0D,EAEHS,OAAOC,SAASC,KAAO,0BAGxB,CACC,MAAMC,EAAOpE,SAASqE,cAAc,KACpCD,EAAKE,aAAa,4CAAWxE,SAC7BsE,EAAKG,YAGJC,SACJ,WAqBcC,GAEd,MAUMC,EAAS,CACdC,KAAM,aACNC,SAAU,aACVH,MAAAA,EACAhB,KAde,CACfoB,EAAG,SACHC,EAAG,QACHC,EAAG,MACHC,EAAG,iBACHC,EAAG,SACHC,EAAG,iBAEiB9F,0CAAcqE,OAAS,WAS5C0B,WAAST"}