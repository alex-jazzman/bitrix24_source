{"version":3,"file":"department-control.bundle.js","sources":["../src/department-control.js"],"sourcesContent":["import { Loc, Type, Tag, Dom } from 'main.core';\nimport { TagSelector } from 'ui.entity-selector';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport './style.css';\n\nexport type DepartmentControlType = {\n\trootDepartment: Object,\n\tdepartmentList: any | [],\n\ttitle: string,\n\tdescription: string,\n}\n\nexport default class DepartmentControl extends EventEmitter\n{\n\t#tagSelector: TagSelector;\n\t#rootDepartment: Object;\n\t#departmentList: Array;\n\t#title: string;\n\t#description: string;\n\n\tconstructor(options: DepartmentControlType)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Intranet.DepartmentControl');\n\t\tthis.#rootDepartment = Type.isNil(options?.rootDepartment) ? null : options?.rootDepartment;\n\t\tthis.#departmentList = Type.isArray(options?.departmentList) ? options?.departmentList : [];\n\t\tthis.#title = options.title ?? Loc.getMessage('INTRANET_INVITE_DIALOG_DEPARTMENT_CONTROL_LABEL');\n\t\tthis.#description = options.description ?? Loc.getMessage('INTRANET_INVITE_DIALOG_DEPARTMENT_CONTROL_DESCRIPTION');\n\n\t\tthis.#tagSelector = this.#initTagSelector(options);\n\t}\n\n\t#initTagSelector(options: DepartmentControlType): TagSelector\n\t{\n\t\treturn new TagSelector({\n\t\t\ttagTextColor: '#1E8D36',\n\t\t\ttagBgColor: '#D4FDB0',\n\t\t\titems: this.getDefaultItems(),\n\t\t\tevents: {\n\t\t\t\tonBeforeTagRemove: (event: BaseEvent) => {\n\t\t\t\t\tconst selector = event.getTarget();\n\t\t\t\t\tconst { tag } = event.getData();\n\t\t\t\t\tif (selector.getTags().length === 1 && this.#isRootItem(tag))\n\t\t\t\t\t{\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonAfterTagAdd: this.onAfterTagChange.bind(this),\n\t\t\t\tonAfterTagRemove: this.onAfterTagChange.bind(this),\n\t\t\t},\n\t\t\tdialogOptions: {\n\t\t\t\tcontext: 'INVITATION_STRUCTURE',\n\t\t\t\twidth: 350,\n\t\t\t\tenableSearch: true,\n\t\t\t\tmultiple: true,\n\t\t\t\tentities: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'structure-node',\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tselectMode: 'departmentsOnly',\n\t\t\t\t\t\t\trestricted: 'inviteUser',\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onBeforeDeselect': (event: BaseEvent) => {\n\t\t\t\t\t\tconst dialog: Dialog = event.getTarget();\n\t\t\t\t\t\tconst selectedItems: Item[] = dialog.getSelectedItems();\n\t\t\t\t\t\tif (selectedItems.length === 1 && this.#isRootItem(selectedItems[0]))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t'Item:onDeselect': (event: BaseEvent) => {\n\t\t\t\t\t\tconst dialog: Dialog = event.getTarget();\n\t\t\t\t\t\tconst selectedItems: Item[] = dialog.getSelectedItems();\n\t\t\t\t\t\tif (selectedItems.length <= 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst item = dialog.getItem(['structure-node', options?.rootDepartment.id]);\n\t\t\t\t\t\t\titem?.select();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tonLoad: (event: BaseEvent) => {\n\t\t\t\t\t\tconst dialog: Dialog = event.getTarget();\n\t\t\t\t\t\tdialog.selectTab('structure-departments-tab');\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\tgetDefaultItems(): Array\n\t{\n\t\tlet items = [];\n\n\t\tif (\n\t\t\t!Type.isNil(this.#rootDepartment)\n\t\t\t&& Type.isArray(this.#departmentList)\n\t\t\t&& this.#departmentList.length > 0\n\t\t)\n\t\t{\n\t\t\titems = this.#departmentList.map((department) => {\n\t\t\t\treturn {\n\t\t\t\t\tid: parseInt(department.id, 10),\n\t\t\t\t\tavatar: '/bitrix/js/humanresources/entity-selector/src/images/company.svg',\n\t\t\t\t\tentityId: 'structure-node',\n\t\t\t\t\ttextColor: '#006E7C',\n\t\t\t\t\tbgColor: '#DDF6F9',\n\t\t\t\t\ttitle: department.name,\n\t\t\t\t\tcustomData: {\n\t\t\t\t\t\taccessCode: department.accessCode,\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\t\telse if (!Type.isNil(this.#rootDepartment))\n\t\t{\n\t\t\tconst rootDep = {\n\t\t\t\tid: parseInt(this.#rootDepartment.id, 10),\n\t\t\t\tavatar: '/bitrix/js/humanresources/entity-selector/src/images/company.svg',\n\t\t\t\tentityId: 'structure-node',\n\t\t\t\ttextColor: '#006E7C',\n\t\t\t\tbgColor: '#DDF6F9',\n\t\t\t\ttitle: this.#rootDepartment.name,\n\t\t\t\tcustomData: {\n\t\t\t\t\taccessCode: this.#rootDepartment.accessCode,\n\t\t\t\t},\n\t\t\t};\n\t\t\titems.push(rootDep);\n\t\t}\n\n\t\treturn items;\n\t}\n\n\treset()\n\t{\n\t\tthis.#tagSelector.removeTags();\n\t\tthis.getDefaultItems().forEach((item) => {\n\t\t\tthis.#tagSelector.addTag(item);\n\t\t});\n\t}\n\n\t#isRootItem(item: Object): boolean\n\t{\n\t\tconst itemId = Type.isNil(item?.id) ? null : parseInt(item?.id, 10);\n\t\tconst rootId = Type.isNil(this.#rootDepartment?.id) ? null : parseInt(this.#rootDepartment?.id, 10);\n\n\t\treturn !Type.isNil(itemId) && !Type.isNil(rootId) && itemId === rootId;\n\t}\n\n\trenderTo(container: HTMLElement): void\n\t{\n\t\tDom.append(this.render(), container);\n\t}\n\n\tgetValues(): Array\n\t{\n\t\tconst tagSelectorItems = this.#tagSelector.getDialog().getSelectedItems();\n\t\tconst collection = [];\n\t\ttagSelectorItems.forEach((item) => {\n\t\t\tconst departmentId = parseInt(item?.id, 10);\n\t\t\tif (departmentId > 0)\n\t\t\t{\n\t\t\t\tcollection.push(departmentId);\n\t\t\t}\n\t\t});\n\n\t\treturn collection;\n\t}\n\n\trender(): HTMLElament\n\t{\n\t\tconst title = Tag.render`<label class=\"department-control__dialog-title\">${this.#title}</label>`;\n\t\tconst description = Tag.render`<div class=\"department-control__dialog-description\">${this.#description}</div>`;\n\t\tconst fieldContainer = Tag.render`<div></div>`;\n\t\tthis.#tagSelector.renderTo(fieldContainer);\n\n\t\treturn Tag.render`<div>${title}${description}${fieldContainer}</div>`;\n\t}\n\n\tonAfterTagChange(event: BaseEvent): void\n\t{\n\t\tconst selector = event.getTarget();\n\t\tthis.emit('onChange', { tags: selector.getTags() });\n\t}\n}\n"],"names":["DepartmentControl","EventEmitter","constructor","options","super","Object","value","writable","this","setEventNamespace","babelHelpers","Type","isNil","rootDepartment","isArray","departmentList","title","Loc","getMessage","description","getDefaultItems","items","length","map","department","id","parseInt","avatar","entityId","textColor","bgColor","name","customData","accessCode","rootDep","push","reset","removeTags","forEach","item","addTag","renderTo","container","Dom","append","render","getValues","tagSelectorItems","getDialog","getSelectedItems","collection","departmentId","Tag","fieldContainer","onAfterTagChange","event","selector","getTarget","emit","tags","getTags","TagSelector","tagTextColor","tagBgColor","events","onBeforeTagRemove","tag","getData","preventDefault","onAfterTagAdd","bind","onAfterTagRemove","dialogOptions","context","width","enableSearch","multiple","entities","selectMode","restricted","Item:onBeforeDeselect","selectedItems","Item:onDeselect","dialog","getItem","select","onLoad","selectTab","itemId","rootId","_babelHelpers$classPr","_babelHelpers$classPr2"],"mappings":"sEAGqB,+YASN,MAAMA,UAA0BC,eAQ9CC,YAAYC,GACZ,QACCC,QAAQC,8BAAAC,UAAAD,8BAAAC,UAAAD,8BAAAE,YAAAD,eAAAD,8BAAAE,YAAAD,eAAAD,8BAAAE,YAAAD,eAAAD,8BAAAE,YAAAD,eAAAD,8BAAAE,YAAAD,eACRE,KAAKC,kBAAkB,iCACvBC,mDAAuBC,OAAKC,YAAMT,SAAAA,EAASU,gBAAkB,WAAOV,SAAAA,EAASU,eAC7EH,mDAAuBC,OAAKG,cAAQX,SAAAA,EAASY,sBAAkBZ,SAAAA,EAASY,eAAiB,GACzFL,4DAAcP,EAAQa,SAASC,MAAIC,WAAW,mDAC9CR,4DAAoBP,EAAQgB,eAAeF,MAAIC,WAAW,yDAE1DR,2FAAoBF,WAAsBL,GA8D3CiB,kBAEC,IAAIC,EAAQ,GAEZ,IACEV,OAAKC,8CAAMJ,aACTG,OAAKG,gDAAQN,aACbE,mDAAqBY,OAAS,EAGjCD,EAAQX,mDAAqBa,IAAKC,IAC1B,CACNC,GAAIC,SAASF,EAAWC,GAAI,IAC5BE,OAAQ,mEACRC,SAAU,iBACVC,UAAW,UACXC,QAAS,UACTd,MAAOQ,EAAWO,KAClBC,WAAY,CACXC,WAAYT,EAAWS,oBAKtB,IAAKtB,OAAKC,8CAAMJ,YACrB,CACC,MAAM0B,EAAU,CACfT,GAAIC,SAAShB,mDAAqBe,GAAI,IACtCE,OAAQ,mEACRC,SAAU,iBACVC,UAAW,UACXC,QAAS,UACTd,MAAON,mDAAqBqB,KAC5BC,WAAY,CACXC,WAAYvB,mDAAqBuB,aAGnCZ,EAAMc,KAAKD,GAGZ,OAAOb,EAGRe,QAEC1B,mDAAkB2B,aAClB7B,KAAKY,kBAAkBkB,QAASC,IAC/B7B,mDAAkB8B,OAAOD,KAY3BE,SAASC,GAERC,MAAIC,OAAOpC,KAAKqC,SAAUH,GAG3BI,YAEC,MAAMC,EAAmBrC,mDAAkBsC,YAAYC,mBACjDC,EAAa,GASnB,OARAH,EAAiBT,QAASC,IACzB,MAAMY,EAAezB,eAASa,SAAAA,EAAMd,GAAI,IACpC0B,EAAe,GAElBD,EAAWf,KAAKgB,KAIXD,EAGRL,SAEC,MAAM7B,EAAQoC,MAAIP,cAAO,mDAAgD,qDAAErC,YACrEW,EAAciC,MAAIP,cAAO,uDAAoD,mDAAErC,YAC/E6C,EAAiBD,MAAIP,cAAO,gBAGlC,OAFAnC,mDAAkB+B,SAASY,GAEpBD,MAAIP,cAAO,QAAK,mBAAE7B,EAAQG,EAAckC,GAGhDC,iBAAiBC,GAEhB,MAAMC,EAAWD,EAAME,YACvBjD,KAAKkD,KAAK,WAAY,CAAEC,KAAMH,EAASI,aAExC,WAzJiBzD,GAEhB,OAAO,IAAI0D,cAAY,CACtBC,aAAc,UACdC,WAAY,UACZ1C,MAAOb,KAAKY,kBACZ4C,OAAQ,CACPC,kBAAoBV,IACnB,MAAMC,EAAWD,EAAME,aACjBS,IAAEA,GAAQX,EAAMY,UACY,IAA9BX,EAASI,UAAUtC,gDAAgBd,WAAiB0D,IAEvDX,EAAMa,kBAGRC,cAAe7D,KAAK8C,iBAAiBgB,KAAK9D,MAC1C+D,iBAAkB/D,KAAK8C,iBAAiBgB,KAAK9D,OAE9CgE,cAAe,CACdC,QAAS,uBACTC,MAAO,IACPC,cAAc,EACdC,UAAU,EACVC,SAAU,CACT,CACCpD,GAAI,iBACJtB,QAAS,CACR2E,WAAY,kBACZC,WAAY,gBAIff,OAAQ,CACPgB,wBAA0BzB,IACzB,MACM0B,EADiB1B,EAAME,YACQR,mBACR,IAAzBgC,EAAc3D,gDAAgBd,WAAiByE,EAAc,KAEhE1B,EAAMa,kBAGRc,kBAAoB3B,IACnB,MAAM4B,EAAiB5B,EAAME,YAE7B,GAD8B0B,EAAOlC,mBACnB3B,QAAU,EAC5B,CACC,MAAMiB,EAAO4C,EAAOC,QAAQ,CAAC,uBAAkBjF,SAAAA,EAASU,eAAeY,WACvEc,GAAAA,EAAM8C,WAGRC,OAAS/B,IACeA,EAAME,YACtB8B,UAAU,kCAKrB,WAqDWhD,GACZ,QACC,MAAMiD,EAAS7E,OAAKC,YAAM2B,SAAAA,EAAMd,IAAM,KAAOC,eAASa,SAAAA,EAAMd,GAAI,IAC1DgE,EAAS9E,OAAKC,uDAAMJ,mBAAAkF,EAAsBjE,IAAM,KAAOC,0DAASlB,mBAAAmF,EAAsBlE,GAAI,IAEhG,OAAQd,OAAKC,MAAM4E,KAAY7E,OAAKC,MAAM6E,IAAWD,IAAWC"}