{"version":3,"file":"department-control.bundle.js","sources":["../src/department-control.js"],"sourcesContent":["import { Loc, Type, Tag, Dom } from 'main.core';\nimport { TagSelector } from 'ui.entity-selector';\nimport './style.css';\n\nexport type DepartmentControlType = {\n\trootDepartment: Object,\n\tdepartmentList: any | [],\n\ttitle: string,\n\tdescription: string,\n}\n\nexport default class DepartmentControl\n{\n\t#tagSelector: TagSelector;\n\t#rootDepartment: Object;\n\t#departmentList: Array;\n\t#title: string;\n\t#description: string;\n\n\tconstructor(options: DepartmentControlType)\n\t{\n\t\tthis.#rootDepartment = Type.isNil(options?.rootDepartment) ? null : options?.rootDepartment;\n\t\tthis.#departmentList = !Type.isArray(options?.departmentList) ? [] : options?.departmentList;\n\t\tthis.#title = options.title ?? Loc.getMessage('INTRANET_INVITE_DIALOG_DEPARTMENT_CONTROL_LABEL');\n\t\tthis.#description = options.description ?? Loc.getMessage('INTRANET_INVITE_DIALOG_DEPARTMENT_CONTROL_DESCRIPTION');\n\n\t\tthis.#tagSelector = this.#initTagSelector(options);\n\t}\n\n\t#initTagSelector(options: DepartmentControlType): TagSelector\n\t{\n\t\treturn new TagSelector({\n\t\t\ttagTextColor: '#1E8D36',\n\t\t\ttagBgColor: '#D4FDB0',\n\t\t\titems: this.getDefaultItems(),\n\t\t\tevents: {\n\t\t\t\tonBeforeTagRemove: (event: BaseEvent) => {\n\t\t\t\t\tconst selector = event.getTarget();\n\t\t\t\t\tconst { tag } = event.getData();\n\t\t\t\t\tif (selector.getTags().length === 1 && this.#isRootItem(tag))\n\t\t\t\t\t{\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\tdialogOptions: {\n\t\t\t\tcontext: 'INVITATION_STRUCTURE',\n\t\t\t\twidth: 350,\n\t\t\t\tenableSearch: true,\n\t\t\t\tmultiple: true,\n\t\t\t\tentities: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'structure-node',\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tselectMode: 'departmentsOnly',\n\t\t\t\t\t\t\trestricted: 'inviteUser',\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onBeforeDeselect': (event: BaseEvent) => {\n\t\t\t\t\t\tconst dialog: Dialog = event.getTarget();\n\t\t\t\t\t\tconst selectedItems: Item[] = dialog.getSelectedItems();\n\t\t\t\t\t\tif (selectedItems.length === 1 && this.#isRootItem(selectedItems[0]))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t'Item:onDeselect': (event: BaseEvent) => {\n\t\t\t\t\t\tconst dialog: Dialog = event.getTarget();\n\t\t\t\t\t\tconst selectedItems: Item[] = dialog.getSelectedItems();\n\t\t\t\t\t\tif (selectedItems.length <= 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst item = dialog.getItem(['structure-node', options?.rootDepartment.id]);\n\t\t\t\t\t\t\titem?.select();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\tgetDefaultItems(): Array\n\t{\n\t\tlet items = [];\n\t\tif (!Type.isNil(this.#rootDepartment) && Type.isArray(this.#departmentList))\n\t\t{\n\t\t\titems = this.#departmentList.map((department) => {\n\t\t\t\treturn {\n\t\t\t\t\tid: parseInt(department.id, 10),\n\t\t\t\t\tavatar: '/bitrix/js/humanresources/entity-selector/src/images/company.svg',\n\t\t\t\t\tentityId: 'structure-node',\n\t\t\t\t\ttextColor: '#006E7C',\n\t\t\t\t\tbgColor: '#DDF6F9',\n\t\t\t\t\ttitle: department.name,\n\t\t\t\t\tcustomData: {\n\t\t\t\t\t\taccessCode: department.accessCode,\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\t\telse if (!Type.isNil(this.#rootDepartment))\n\t\t{\n\t\t\tconst rootDep = {\n\t\t\t\tid: parseInt(this.#rootDepartment.id, 10),\n\t\t\t\tavatar: '/bitrix/js/humanresources/entity-selector/src/images/company.svg',\n\t\t\t\tentityId: 'structure-node',\n\t\t\t\ttextColor: '#006E7C',\n\t\t\t\tbgColor: '#DDF6F9',\n\t\t\t\ttitle: this.#rootDepartment.name,\n\t\t\t\tcustomData: {\n\t\t\t\t\taccessCode: this.#rootDepartment.accessCode,\n\t\t\t\t},\n\t\t\t};\n\t\t\titems.push(rootDep);\n\t\t}\n\n\t\treturn items;\n\t}\n\n\treset()\n\t{\n\t\tthis.#tagSelector.removeTags();\n\t\tthis.getDefaultItems().forEach((item) => {\n\t\t\tthis.#tagSelector.addTag(item);\n\t\t})\n\t}\n\n\t#isRootItem(item: Object): boolean\n\t{\n\t\tconst itemId = Type.isNil(item?.id) ? null : parseInt(item?.id, 10);\n\t\tconst rootId = Type.isNil(this.#rootDepartment?.id) ? null : parseInt(this.#rootDepartment?.id, 10);\n\n\t\treturn !Type.isNil(itemId) && !Type.isNil(rootId) && itemId === rootId;\n\t}\n\n\trenderTo(container: HTMLElement): void\n\t{\n\t\tDom.append(this.render(), container);\n\t}\n\n\tgetValues(): Array\n\t{\n\t\tconst tagSelectorItems = this.#tagSelector.getDialog().getSelectedItems();\n\t\tconst collection = [];\n\t\ttagSelectorItems.forEach((item) => {\n\t\t\tconst departmentId = parseInt(item?.id, 10);\n\t\t\tif (departmentId > 0)\n\t\t\t{\n\t\t\t\tcollection.push(departmentId);\n\t\t\t}\n\t\t});\n\n\t\treturn collection;\n\t}\n\n\trender(): HTMLElament\n\t{\n\t\tconst title = Tag.render`<label class=\"department-control__dialog-title\">${this.#title}</label>`;\n\t\tconst description = Tag.render`<div class=\"department-control__dialog-description\">${this.#description}</div>`;\n\t\tconst fieldContainer = Tag.render`<div></div>`;\n\t\tthis.#tagSelector.renderTo(fieldContainer);\n\n\t\treturn Tag.render`<div>${title}${description}${fieldContainer}</div>`;\n\t}\n}\n"],"names":["options","TagSelector","tagTextColor","tagBgColor","items","this","getDefaultItems","events","onBeforeTagRemove","event","selector","getTarget","tag","getData","getTags","length","preventDefault","dialogOptions","context","width","enableSearch","multiple","entities","id","selectMode","restricted","Item:onBeforeDeselect","selectedItems","getSelectedItems","Item:onDeselect","dialog","item","getItem","rootDepartment","select","itemId","Type","isNil","parseInt","rootId","_babelHelpers$classPr","_babelHelpers$classPr2","constructor","Object","value","writable","babelHelpers","isArray","departmentList","title","Loc","getMessage","description","map","department","avatar","entityId","textColor","bgColor","name","customData","accessCode","rootDep","push","reset","removeTags","forEach","addTag","renderTo","container","Dom","append","render","getValues","tagSelectorItems","getDialog","collection","departmentId","Tag","fieldContainer"],"mappings":"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"}