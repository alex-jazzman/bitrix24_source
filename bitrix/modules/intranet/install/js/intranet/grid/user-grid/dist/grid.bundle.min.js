this.BX=this.BX||{};this.BX.Intranet=this.BX.Intranet||{};(function(e,t,s,r,i,o,a,n,l,d,c){"use strict";var T=babelHelpers.classPrivateFieldLooseKey("fieldId");var _=babelHelpers.classPrivateFieldLooseKey("gridId");class E{constructor(e){var t;Object.defineProperty(this,T,{writable:true,value:void 0});Object.defineProperty(this,_,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,T)[T]=e.fieldId;babelHelpers.classPrivateFieldLooseBase(this,_)[_]=(t=e.gridId)!=null?t:null}getGridId(){return babelHelpers.classPrivateFieldLooseBase(this,_)[_]}getFieldId(){return babelHelpers.classPrivateFieldLooseBase(this,T)[T]}getGrid(){var e;let t=null;if(babelHelpers.classPrivateFieldLooseBase(this,_)[_]){t=BX.Main.gridManager.getById(babelHelpers.classPrivateFieldLooseBase(this,_)[_])}return(e=t)==null?void 0:e.instance}getFieldNode(){return document.getElementById(this.getFieldId())}appendToFieldNode(e){c.Dom.append(e,this.getFieldNode())}}class I extends E{render(e){var s;const r={size:40,userpicPath:e.photoUrl?e.photoUrl:null};let i=null;if(e.role==="collaber"){i=new t.AvatarRoundGuest(r)}else if(e.role==="extranet"){i=new t.AvatarRoundExtranet(r)}else{i=new t.AvatarRound(r)}(s=i)==null?void 0:s.renderTo(this.getFieldNode());c.Dom.addClass(this.getFieldNode(),"user-grid_user-photo")}}let g=e=>e,u,N,p,A,S,R,L;var h=babelHelpers.classPrivateFieldLooseKey("getFullNameLink");var O=babelHelpers.classPrivateFieldLooseKey("getInvitedLabelContainer");var C=babelHelpers.classPrivateFieldLooseKey("getWaitingConfirmationLabelContainer");var U=babelHelpers.classPrivateFieldLooseKey("getPositionLabelContainer");var M=babelHelpers.classPrivateFieldLooseKey("getIntegratorBalloonContainer");var P=babelHelpers.classPrivateFieldLooseKey("getAdminBalloonContainer");var b=babelHelpers.classPrivateFieldLooseKey("getExtranetBalloonContainer");var v=babelHelpers.classPrivateFieldLooseKey("getCollaberBalloonContainer");class B extends E{constructor(...e){super(...e);Object.defineProperty(this,v,{value:x});Object.defineProperty(this,b,{value:y});Object.defineProperty(this,P,{value:G});Object.defineProperty(this,M,{value:w});Object.defineProperty(this,U,{value:D});Object.defineProperty(this,C,{value:F});Object.defineProperty(this,O,{value:m});Object.defineProperty(this,h,{value:f})}render(e){const t=c.Tag.render(u||(u=g`
			<div class="user-grid_full-name-container">${0}</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,h)[h](e.fullName,e.profileLink));if(e.position){c.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,U)[U](c.Text.encode(e.position)),t)}switch(e.role){case"integrator":c.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,M)[M](),t);break;case"admin":c.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,P)[P](),t);break;case"extranet":c.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,b)[b](),t);break;case"collaber":c.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,v)[v](),t);break;default:break}switch(e.inviteStatus){case"INVITE_AWAITING_APPROVE":c.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,C)[C](),t);break;case"INVITED":c.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,O)[O](),t);break;default:break}this.appendToFieldNode(t)}}function f(e,t){return c.Tag.render(N||(N=g`
			<a class="user-grid_full-name-label" href="${0}">
				${0}
			</a>
		`),t,e)}function m(){const e=new s.Label({text:c.Loc.getMessage("INTRANET_JS_CONTROL_BALLOON_INVITATION_NOT_ACCEPTED"),color:s.LabelColor.LIGHT_BLUE,fill:true,size:s.Label.Size.MD,customClass:"user-grid_label"});return e.render()}function F(){const e=new s.Label({text:c.Loc.getMessage("INTRANET_JS_CONTROL_BALLOON_NOT_CONFIRMED"),color:s.LabelColor.YELLOW,fill:true,size:s.Label.Size.MD,customClass:"user-grid_label"});return e.render()}function D(e){return c.Tag.render(p||(p=g`<div class="user-grid_position-label">${0}</div>`),e)}function w(){return c.Tag.render(A||(A=g`
			<span class="user-grid_role-label --integrator">
				${0}
			</span>
		`),c.Loc.getMessage("INTRANET_JS_CONTROL_BALLOON_INTEGRATOR"))}function G(){return c.Tag.render(S||(S=g`
			<span class="user-grid_role-label --admin">
				${0}
			</span>
		`),c.Loc.getMessage("INTRANET_JS_CONTROL_BALLOON_ADMIN"))}function y(){return c.Tag.render(R||(R=g`
			<span class="user-grid_role-label --extranet">
				${0}
			</span>
		`),c.Loc.getMessage("INTRANET_JS_CONTROL_BALLOON_EXTRANET"))}function x(){return c.Tag.render(L||(L=g`
			<span class="user-grid_role-label --collaber">
				${0}
			</span>
		`),c.Loc.getMessage("INTRANET_JS_CONTROL_BALLOON_COLLABER"))}let k=e=>e,H,j;class X extends E{render(e){const t=c.Text.getRandom(6);const s=c.Text.getRandom(6);this.appendToFieldNode(c.Tag.render(H||(H=k`<span id="${0}"></span>`),t));this.appendToFieldNode(c.Tag.render(j||(j=k`<span class="user-grid_full-name-wrapper" id="${0}"></span>`),s));new I({fieldId:t}).render(e);new B({fieldId:s}).render(e);c.Dom.addClass(this.getFieldNode(),"user-grid_employee-card-container")}}var K=babelHelpers.classPrivateFieldLooseKey("grid");class Y{constructor(e){var t;Object.defineProperty(this,K,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,K)[K]=(t=BX.Main.gridManager.getById(e))==null?void 0:t.instance}static getInstance(e){if(!this.instances[e]){this.instances[e]=new Y(e)}return this.instances[e]}static setSort(e){var t;const s=(t=BX.Main.gridManager.getById(e.gridId))==null?void 0:t.instance;if(c.Type.isObject(s)){s.tableFade();s.getUserOptions().setSort(e.sortBy,e.order,(()=>{s.reload()}))}}static setFilter(e){var t;const s=(t=BX.Main.gridManager.getById(e.gridId))==null?void 0:t.instance;const r=BX.Main.filterManager.getById(e.gridId);if(c.Type.isObject(s)&&c.Type.isObject(r)){r.getApi().extendFilter(e.filter)}}static reinviteCloudAction(e){return c.ajax.runAction("intranet.invite.reinviteWithChangeContact",{data:e}).then((e=>{if(e.data.result){const e=new BX.PopupWindow({content:`<p>${c.Loc.getMessage("INTRANET_USER_LIST_ACTION_REINVITE_SUCCESS")}</p>`,autoHide:true});e.show()}return e}),(e=>{const t=e.errors.map((e=>e.message));r.ErrorCollection.showSystemError(t.join("<br>"));return e}))}static reinviteAction(e,t){return c.ajax.runAction("intranet.controller.invite.reinvite",{data:{params:{userId:e,extranet:t?"Y":"N"}}}).then((e=>{if(e.data.result){const e=new BX.PopupWindow({content:`<p>${c.Loc.getMessage("INTRANET_USER_LIST_ACTION_REINVITE_SUCCESS")}</p>`,autoHide:true});e.show()}return e}))}getGrid(){return babelHelpers.classPrivateFieldLooseBase(this,K)[K]}confirmAction(e){if(e.userId){this.confirmUser(e.isAccept?"confirm":"decline",(()=>{const t=babelHelpers.classPrivateFieldLooseBase(this,K)[K].getRows().getById(e.userId);t==null?void 0:t.stateLoad();c.ajax.runAction("intranet.controller.invite.confirmUserRequest",{data:{userId:e.userId,isAccept:e.isAccept?"Y":"N"}}).then((s=>{if(s.data===true){t==null?void 0:t.update()}else if(e.isAccept){t==null?void 0:t.stateUnload()}else{this.activityAction({userId:e.userId,action:"deleteOrFire"})}})).catch((()=>{if(e.isAccept){t==null?void 0:t.stateUnload()}else{this.activityAction({userId:e.userId,action:"deleteOrFire"})}}))}))}}activityAction(e){var t,s;const i=(t=e.userId)!=null?t:null;const o=(s=e.action)!=null?s:null;if(i){this.confirmUser(o,(()=>{const t=babelHelpers.classPrivateFieldLooseBase(this,K)[K].getRows().getById(e.userId);t==null?void 0:t.stateLoad();if(["fire","restore","deleteOrFire"].includes(o)){c.ajax.runAction(`intranet.v2.User.${o}`,{data:{userId:i}}).then((()=>{t==null?void 0:t.update()})).catch((e=>{t==null?void 0:t.stateUnload();const s=e.errors.map((e=>e.message));r.ErrorCollection.showSystemError(s.join("<br>"))}))}}))}}confirmUser(e,t){var s,r;n.MessageBox.show({title:(s=this.getConfirmTitle(e))!=null?s:"",message:(r=this.getConfirmMessage(e))!=null?r:"",buttons:n.MessageBoxButtons.YES_CANCEL,yesCaption:this.getConfirmButtonText(e),onYes:e=>{t();e.close()}})}getConfirmTitle(e){switch(e){case"restore":return c.Loc.getMessage("INTRANET_USER_LIST_ACTION_RESTORE_TITLE");case"confirm":return c.Loc.getMessage("INTRANET_USER_LIST_ACTION_CONFIRM_TITLE");case"delete":case"deleteOrFire":return c.Loc.getMessage("INTRANET_USER_LIST_ACTION_DELETE_TITLE");case"fire":return c.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_TITLE");case"deactivateInvited":return c.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_INVITED_TITLE");case"decline":return c.Loc.getMessage("INTRANET_USER_LIST_ACTION_DECLINE_TITLE");default:return""}}getConfirmMessage(e){switch(e){case"restore":case"confirm":return c.Loc.getMessage("INTRANET_USER_LIST_ACTION_CONFIRM_MESSAGE");case"delete":case"deleteOrFire":return c.Loc.getMessage("INTRANET_USER_LIST_ACTION_DELETE_MESSAGE");case"fire":return c.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_MESSAGE");case"deactivateInvited":return c.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_INVITED_MESSAGE");case"decline":return c.Loc.getMessage("INTRANET_USER_LIST_ACTION_DECLINE_MESSAGE");default:return""}}getConfirmButtonText(e){switch(e){case"restore":return c.Loc.getMessage("INTRANET_USER_LIST_ACTION_RESTORE_BUTTON");case"confirm":return c.Loc.getMessage("INTRANET_USER_LIST_ACTION_CONFIRM_BUTTON");case"delete":case"deleteOrFire":return c.Loc.getMessage("INTRANET_USER_LIST_ACTION_DELETE_BUTTON");case"fire":return c.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_BUTTON");case"deactivateInvited":return c.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_INVITED_BUTTON");case"decline":return c.Loc.getMessage("INTRANET_USER_LIST_ACTION_DECLINE_BUTTON");default:return null}}}Y.instances=[];let V=e=>e,W;var $=babelHelpers.classPrivateFieldLooseKey("updateData");var z=babelHelpers.classPrivateFieldLooseKey("onClick");var J=babelHelpers.classPrivateFieldLooseKey("actionFactory");var q=babelHelpers.classPrivateFieldLooseKey("inviteAction");var Q=babelHelpers.classPrivateFieldLooseKey("acceptAction");class Z extends E{constructor(...e){super(...e);Object.defineProperty(this,Q,{value:ie});Object.defineProperty(this,q,{value:re});Object.defineProperty(this,J,{value:se});Object.defineProperty(this,z,{value:te});Object.defineProperty(this,$,{value:ee})}render(e){var t;let s="";let r="";switch((t=e.action)!=null?t:"invite"){case"accept":s=c.Loc.getMessage("INTRANET_JS_CONTROL_BUTTON_ACCEPT_ENTER");r=BX.UI.Button.Color.PRIMARY;break;case"invite":default:s=c.Loc.getMessage("INTRANET_JS_CONTROL_BUTTON_INVITE_AGAIN");r=BX.UI.Button.Color.LIGHT_BORDER;break}const i=c.Tag.render(W||(W=V`
			<div class="ui-counter user-grid_invitation-counter">
				<div class="ui-counter-inner">1</div>
			</div>
		`));c.Dom.append(i,this.getFieldNode());const o=new BX.UI.Button({text:s,color:r,noCaps:true,size:BX.UI.Button.Size.EXTRA_SMALL,tag:BX.UI.Button.Tag.INPUT,round:true,onclick:()=>{babelHelpers.classPrivateFieldLooseBase(this,z)[z](e,o)}});o.renderTo(this.getFieldNode())}}function ee(e){var t;if(!c.Type.isStringFilled(e.get("newEmail"))&&!c.Type.isBoolean(e.get("newPhone"))){top.console.error("Empty new email or phone");return}const s=(t=Y.getInstance(this.gridId).getGrid())==null?void 0:t.getRows().getById(this.userId);s==null?void 0:s.stateLoad();Y.reinviteCloudAction(e).then((e=>{s==null?void 0:s.update();s==null?void 0:s.stateUnload()}))}function te(e,t){if(!e.enabled){const e=BX.PopupWindowManager.create("intranet-user-grid-invitation-disabled",null,{darkMode:true,content:c.Loc.getMessage("INTRANET_USER_LIST_ACTION_REINVITE_DISABLED"),closeByEsc:true,angle:true,offsetLeft:40,maxWidth:300,overlay:false,autoHide:true});e.setBindElement(t.getContainer());e.show()}else{babelHelpers.classPrivateFieldLooseBase(this,J)[J](e.action).call(this,e,t)}}function se(e){switch(e){case"accept":return babelHelpers.classPrivateFieldLooseBase(this,Q)[Q];break;case"invite":return babelHelpers.classPrivateFieldLooseBase(this,q)[q];default:return babelHelpers.classPrivateFieldLooseBase(this,q)[q];break}}function re(e,t){if(e.isCloud===true){var s,r;const i=new o.ReinvitePopup({userId:e.userId,formType:e.email?o.FormType.EMAIL:o.FormType.PHONE,bindElement:t.getContainer(),inputValue:(s=(r=e.email)!=null?r:e.phoneNumber)!=null?s:"",transport:babelHelpers.classPrivateFieldLooseBase(this,$)[$].bind(e)});i.getPopup().setBindElement(t.getContainer());i.show()}else{t.setWaiting(true);Y.reinviteAction(e.userId,e.isExtranet).then((()=>{t.setWaiting(false)}))}}function ie(e,t){Y.getInstance(e.gridId).confirmAction({isAccept:true,userId:e.userId})}let oe=e=>e,ae,ne,le;class de extends E{render(e){c.Dom.addClass(this.getFieldNode(),"user-grid_department-container");if(e.departments.length===0&&e.canEdit){return;const e=()=>{const e=new d.Dialog({width:300,height:300,targetNode:t,compactView:true,multiple:false,entities:[{id:"department",options:{selectMode:"departmentsOnly",allowSelectRootDepartment:true}}]});e.show()};const t=c.Tag.render(ae||(ae=oe`
				<div class="user-grid_department-btn" onclick="${0}">
					<div class="user-grid_department-icon-container">
						<div class="ui-icon-set --plus-30" style="--ui-icon-set__icon-size: 18px; --ui-icon-set__icon-color: #2fc6f6;"></div>
					</div>
					<div class="user-grid_department-name-container">
						${0}
					</div>
				</div>
			`),e,c.Loc.getMessage("INTRANET_JS_CONTROL_BALLOON_ADD_DEPARTMENT"));this.appendToFieldNode(t)}else{Object.values(e.departments).forEach((t=>{const s=t.id===e.selectedDepartment;const r=()=>{Y.setFilter({gridId:this.getGridId(),filter:{DEPARTMENT:s?"":t.id,DEPARTMENT_label:s?"":t.name}})};const i=c.Tag.render(ne||(ne=oe`
					<div
						class="user-grid_department-btn ${0}"
						onclick="${0}"
						>
						<div class="user-grid_department-name-container">
							${0}
						</div>
					</div>
				`),s?"--selected":"",r,t.name);if(s){c.Dom.append(c.Tag.render(le||(le=oe`
						<div class="user-grid_department-btn-remove ui-icon-set --cross-60"></div>
					`)),i)}this.appendToFieldNode(i)}))}}}class ce{static getActionId(){throw new Error("not implemented")}getAjaxMethod(){throw new Error("not implemented")}constructor(e){var t;this.grid=e.grid;this.userFilter=e.filter;this.selectedUsers=e.selectedUsers;this.showPopups=(t=e.showPopups)!=null?t:true;this.isCloud=e.isCloud}execute(){const e=this.showPopups?this.getConfirmationPopup():null;if(e){e.setOkCallback((()=>{this.sendActionRequest();e.close()}));e.show()}else{this.sendActionRequest()}}getConfirmationPopup(){return null}sendActionRequest(){var e;this.grid.tableFade();const t=(e=this.selectedUsers)!=null?e:this.grid.getRows().getSelectedIds();const s=this.grid.getRows().isAllSelected()?"Y":"N";BX.ajax.runAction(this.getAjaxMethod(),{data:{fields:{userIds:t,isSelectedAllRows:s,filter:this.userFilter}}}).then((e=>this.handleSuccess(e))).catch((e=>this.handleError(e)))}handleSuccess(e){this.grid.reload();if(this.showPopups){const{skippedActiveUsers:t,skippedFiredUsers:s}=e.data;if(t&&Object.keys(t).length>0){this.showActiveUsersPopup(t)}else if(s&&Object.keys(s).length>0){this.showFiredUsersPopup(s)}}}handleError(e){this.grid.tableUnfade();this.unselectRows(this.grid);console.error(e);if(this.showPopups&&e.errors&&e.errors.length>0){const t=e.errors.map((e=>e.message)).join(", ");n.MessageBox.show({message:t,buttons:n.MessageBoxButtons.YES,yesCaption:c.Loc.getMessage("INTRANET_USER_LIST_ACTION_UNDERSTOOD_BUTTON"),onYes:e=>{e.close()}})}}showActiveUsersPopup(e){n.MessageBox.show({title:c.Loc.getMessage(this.getSkippedUsersTitleCode()),message:this.getMessageWithProfileNames(this.getSkippedUsersMessageCode(),e),buttons:n.MessageBoxButtons.YES,yesCaption:c.Loc.getMessage("INTRANET_USER_LIST_ACTION_UNDERSTOOD_BUTTON"),onYes:e=>{e.close()}})}showFiredUsersPopup(e){n.MessageBox.show({title:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_FIRE_SKIPPED_TITLE"),message:this.getMessageWithProfileNames("INTRANET_USER_LIST_GROUP_ACTION_FIRE_SKIPPED_MESSAGE",e),buttons:n.MessageBoxButtons.YES,yesCaption:c.Loc.getMessage("INTRANET_USER_LIST_ACTION_UNDERSTOOD_BUTTON"),onYes:e=>{e.close()}})}getMessageWithProfileNames(e,t){const s=5;const r=Object.values(t);const i=r.slice(0,s).map((e=>e.fullName));const o=r.length-s;const a=i.join(", ");if(i.length<2&&o<1){return c.Loc.getMessage(`${e}_SINGLE`,{"#USER#":a})}if(o>0){return c.Loc.getMessage(`${e}_REMAINING`,{"#USER_LIST#":a,"#USER_REMAINING#":o})}return c.Loc.getMessage(e,{"#USER_LIST#":a})}getSkippedUsersTitleCode(){return""}getSkippedUsersMessageCode(){return""}unselectRows(e){e.getRows().unselectAll();e.updateCounterDisplayed();e.updateCounterSelected();e.disableActionsPanel();BX.onCustomEvent(window,"Grid::allRowsUnselected",[])}}class Te extends ce{static getActionId(){return"fire"}getConfirmationPopup(){return new n.MessageBox({message:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_FIRE_MESSAGE"),title:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_FIRE_MESSAGE_TITLE"),buttons:n.MessageBoxButtons.OK_CANCEL,okCaption:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_FIRE_MESSAGE_BUTTON")})}getAjaxMethod(){return"intranet.controller.user.userlist.groupFire"}getSkippedUsersMessageCode(){return"INTRANET_USER_LIST_GROUP_ACTION_FIRE_SKIPPED_MESSAGE"}getSkippedUsersTitleCode(){return"INTRANET_USER_LIST_GROUP_ACTION_FIRE_SKIPPED_TITLE"}}class _e extends ce{static getActionId(){return"delete"}getAjaxMethod(){return"intranet.controller.user.userlist.groupDelete"}getConfirmationPopup(){return new n.MessageBox({message:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_DELETE_MESSAGE"),title:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_DELETE_MESSAGE_TITLE"),buttons:n.MessageBoxButtons.OK_CANCEL,okCaption:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_DELETE_MESSAGE_BUTTON")})}showActiveUsersPopup(e){n.MessageBox.show({title:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_DELETE_SKIPPED_TITLE"),message:this.getMessageWithProfileNames("INTRANET_USER_LIST_GROUP_ACTION_DELETE_SKIPPED_MESSAGE",e),buttons:n.MessageBoxButtons.YES_CANCEL,yesCaption:c.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_INVITED_BUTTON"),onYes:t=>{t.close();new Te({selectedUsers:Object.keys(e),grid:this.grid,filter:this.userFilter,showPopups:false}).execute()},onNo:()=>{this.grid.reload()}})}showFiredUsersPopup(e){n.MessageBox.show({title:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_DELETE_FIRED_TITLE"),message:this.getMessageWithProfileNames("INTRANET_USER_LIST_GROUP_ACTION_DELETE_FIRED_MESSAGE",e),buttons:n.MessageBoxButtons.YES,yesCaption:c.Loc.getMessage("INTRANET_USER_LIST_ACTION_UNDERSTOOD_BUTTON"),onYes:e=>{e.close()}})}getSkippedUsersTitleCode(){return"INTRANET_USER_LIST_GROUP_ACTION_DELETE_SKIPPED_TITLE"}getSkippedUsersMessageCode(){return"INTRANET_USER_LIST_GROUP_ACTION_DELETE_SKIPPED_MESSAGE"}}class Ee extends ce{static getActionId(){return"confirm"}getConfirmationPopup(){return new n.MessageBox({message:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_CONFIRM_MESSAGE"),title:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_CONFIRM_MESSAGE_TITLE"),buttons:n.MessageBoxButtons.OK_CANCEL,okCaption:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_CONFIRM_MESSAGE_BUTTON")})}handleSuccess(e){this.grid.reload();if(this.showPopups){const{skippedFiredUsers:t}=e.data;if(t&&Object.keys(t).length>0){this.showFiredUsersPopup(t)}}}showFiredUsersPopup(e){n.MessageBox.show({title:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_ACCEPT_FIRED_TITLE"),message:this.getMessageWithProfileNames("INTRANET_USER_LIST_GROUP_ACTION_ACCEPT_FIRED_MESSAGE",e),buttons:n.MessageBoxButtons.YES,yesCaption:c.Loc.getMessage("INTRANET_USER_LIST_ACTION_UNDERSTOOD_BUTTON"),onYes:e=>{e.close()}})}getAjaxMethod(){return"intranet.controller.user.userlist.groupConfirm"}getSkippedUsersMessageCode(){return"INTRANET_USER_LIST_GROUP_ACTION_CONFIRM_SKIPPED_MESSAGE"}getSkippedUsersTitleCode(){return"INTRANET_USER_LIST_GROUP_ACTION_CONFIRM_SKIPPED_TITLE"}}class Ie extends ce{static getActionId(){return"decline"}getConfirmationPopup(){return new n.MessageBox({message:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_DECLINE_MESSAGE"),title:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_DECLINE_MESSAGE_TITLE"),buttons:n.MessageBoxButtons.OK_CANCEL,okCaption:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_DECLINE_MESSAGE_BUTTON")})}showActiveUsersPopup(e){n.MessageBox.show({title:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_DELETE_SKIPPED_TITLE"),message:this.getMessageWithProfileNames("INTRANET_USER_LIST_GROUP_ACTION_DELETE_SKIPPED_MESSAGE",e),buttons:n.MessageBoxButtons.YES_CANCEL,yesCaption:c.Loc.getMessage("INTRANET_USER_LIST_ACTION_DEACTIVATE_INVITED_BUTTON"),onYes:t=>{t.close();new Te({selectedUsers:Object.keys(e),grid:this.grid,filter:this.userFilter,showPopups:false}).execute()}})}getAjaxMethod(){return"intranet.controller.user.userlist.groupDecline"}getSkippedUsersMessageCode(){return"INTRANET_USER_LIST_GROUP_ACTION_CONFIRM_SKIPPED_MESSAGE"}getSkippedUsersTitleCode(){return"INTRANET_USER_LIST_GROUP_ACTION_CONFIRM_SKIPPED_TITLE"}}class ge extends ce{static getActionId(){return"reInvite"}getAjaxMethod(){return"intranet.controller.user.userlist.groupReInvite"}handleSuccess(e){this.grid.tableUnfade();const{skippedActiveUsers:t,skippedFiredUsers:s,skippedWaitingUsers:r}=e.data;if(t&&Object.keys(t).length>0){this.showActiveUsersPopup(t)}else if(r&&Object.keys(r).length>0){this.showWaitingUsersPopup(r)}else if(s&&Object.keys(s).length>0){this.showFiredUsersPopup(s)}else{var i,o;BX.UI.Notification.Center.notify({content:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_REINVITE_SUCCESS"),autoHide:true,position:"bottom-right",category:"menu-self-item-popup",autoHideDelay:3e3});(i=BX.Bitrix24)==null?void 0:(o=i.EmailConfirmation)==null?void 0:o.showPopupDispatched()}this.unselectRows(this.grid)}showWaitingUsersPopup(e){n.MessageBox.show({title:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_ALREADY_ACCEPT_INVITE_TITLE"),message:this.getMessageWithProfileNames("INTRANET_USER_LIST_GROUP_ACTION_ALREADY_ACCEPT_INVITE_MESSAGE",e),buttons:n.MessageBoxButtons.YES_CANCEL,yesCaption:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_CONFIRM_MESSAGE_BUTTON"),onYes:t=>{t.close();new Ee({grid:this.grid,filter:this.userFilter,selectedUsers:Object.keys(e),showPopups:false}).execute()}})}showFiredUsersPopup(e){n.MessageBox.show({title:c.Loc.getMessage("INTRANET_USER_LIST_GROUP_ACTION_ACCEPT_FIRED_TITLE"),message:this.getMessageWithProfileNames("INTRANET_USER_LIST_GROUP_ACTION_ACCEPT_FIRED_MESSAGE",e),buttons:n.MessageBoxButtons.YES,yesCaption:c.Loc.getMessage("INTRANET_USER_LIST_ACTION_UNDERSTOOD_BUTTON"),onYes:e=>{e.close()}})}getSkippedUsersMessageCode(){return"INTRANET_USER_LIST_GROUP_ACTION_CONFIRM_SKIPPED_MESSAGE"}getSkippedUsersTitleCode(){return"INTRANET_USER_LIST_GROUP_ACTION_CONFIRM_SKIPPED_TITLE"}}class ue extends ce{static getActionId(){return"createChat"}getAjaxMethod(){return"intranet.controller.user.userlist.createChat"}handleSuccess(e){this.grid.tableUnfade();const t=e.data;l.Messenger.openChat(`chat${t}`);this.unselectRows(this.grid)}}let Ne=e=>e,pe;class Ae extends ce{static getActionId(){return"changeDepartment"}getAjaxMethod(){return"intranet.controller.user.userlist.groupChangeDepartment"}execute(){const e=new BX.UI.SaveButton({onclick:()=>{const e=r.getSelectedItems().map((e=>e.id));r.hide();if(e.length>0){this.sendChangeDepartmentRequest(e)}else{this.unselectRows(this.grid)}},size:BX.UI.Button.Size.SMALL});const t=new BX.UI.CancelButton({onclick:()=>{r.hide()},size:BX.UI.Button.Size.SMALL});const s=c.Tag.render(pe||(pe=Ne`<span></span>`));e.renderTo(s);t.renderTo(s);const r=new d.Dialog({dropdownMode:true,enableSearch:true,compactView:true,multiple:true,footer:s,entities:[{id:"department",options:{selectMode:"departmentsOnly",allowSelectRootDepartment:true}}]});r.show()}sendChangeDepartmentRequest(e){var t;this.grid.tableFade();const s=(t=this.selectedUsers)!=null?t:this.grid.getRows().getSelectedIds();const r=this.grid.getRows().isAllSelected()?"Y":"N";BX.ajax.runAction(this.getAjaxMethod(),{data:{fields:{userIds:s,isSelectedAllRows:r,filter:this.userFilter,departmentIds:e}}}).then((e=>this.handleSuccess(e))).catch((e=>this.handleError(e)))}getSkippedUsersTitleCode(){return"INTRANET_USER_LIST_GROUP_ACTION_EXTRANET_CHANGE_DEPARTMENT_TITLE"}getSkippedUsersMessageCode(){return this.isCloud?"INTRANET_USER_LIST_GROUP_ACTION_EXTRANET_CHANGE_DEPARTMENT_MESSAGE_CLOUD":"INTRANET_USER_LIST_GROUP_ACTION_EXTRANET_CHANGE_DEPARTMENT_MESSAGE"}}const Se=[_e,Te,Ee,Ie,ge,ue,Ae];class Re{static createAction(e,t){const s=Se.find((t=>t.getActionId()===e));if(!s){throw new Error(`Unknown actionId: ${e}`)}return new s(t)}}class Le{static executeAction(e){try{var t;const s=Re.createAction(e.actionId,{grid:(t=BX.Main.gridManager.getById(e.gridId))==null?void 0:t.instance,filter:e.filter,isCloud:e.isCloud});s.execute()}catch(e){console.error("Error executing action:",e)}}}e.BaseField=E;e.PhotoField=I;e.FullNameField=B;e.EmployeeField=X;e.ActivityField=Z;e.DepartmentField=de;e.GridManager=Y;e.Panel=Le})(this.BX.Intranet.UserList=this.BX.Intranet.UserList||{},BX.UI,BX.UI,BX.UI.FormElements,BX.UI,BX.Intranet.Reinvite,BX,BX.UI.Dialogs,BX.Messenger.v2.Lib,BX.UI.EntitySelector,BX);
//# sourceMappingURL=grid.bundle.map.js