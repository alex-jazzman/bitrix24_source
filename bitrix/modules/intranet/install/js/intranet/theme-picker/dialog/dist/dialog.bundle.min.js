this.BX=this.BX||{};this.BX.Intranet=this.BX.Intranet||{};this.BX.Intranet.Bitrix24=this.BX.Intranet.Bitrix24||{};(function(e,s,t,a,l,i,o,r){"use strict";let d=e=>e,n,c,b;var h=babelHelpers.classPrivateFieldLooseKey("themePicker");var p=babelHelpers.classPrivateFieldLooseKey("checkbox");var v=babelHelpers.classPrivateFieldLooseKey("handleCheckboxClick");class u extends l.PopupWindowButton{constructor(e){super({id:"checkbox"});Object.defineProperty(this,v,{value:m});Object.defineProperty(this,h,{writable:true,value:void 0});Object.defineProperty(this,p,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,h)[h]=e;babelHelpers.classPrivateFieldLooseBase(this,p)[p]=o.Tag.render(n||(n=d`
			<input
				id="theme-dialog-checkbox-input"
				class="theme-dialog-checkbox-input"
				type="checkbox"
				name="defaultTheme"
				value="Y"
				onclick="${0}"
			>
		`),babelHelpers.classPrivateFieldLooseBase(this,v)[v].bind(this));this.buttonNode=o.Tag.render(c||(c=d`
			<div class="theme-dialog-checkbox-button">
				${0}
				<label for="theme-dialog-checkbox-input" class="theme-dialog-checkbox-label">
					${0}
				</label>
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,p)[p],o.Loc.getMessage("BITRIX24_THEME_DEFAULT_THEME_FOR_ALL"),babelHelpers.classPrivateFieldLooseBase(this,h)[h].canSetDefaultTheme()?"":o.Tag.render(b||(b=d`<span class="tariff-lock"></span>`)))}isChecked(){return babelHelpers.classPrivateFieldLooseBase(this,p)[p].checked}check(){babelHelpers.classPrivateFieldLooseBase(this,p)[p].checked=true}uncheck(){babelHelpers.classPrivateFieldLooseBase(this,p)[p].checked=false}}function m(){if(babelHelpers.classPrivateFieldLooseBase(this,h)[h].canSetDefaultTheme()){return}s.InfoHelper.show("limit_office_background_to_all");this.uncheck()}async function g(e,s=7){const{image:t,width:a,height:l}=o.Type.isFile(e)?await r.Helpers.loadImage(e):{image:e,width:e.naturalWidth||e.width,height:e.naturalHeight||e.height};const i=document.createElement("canvas");i.width=a;i.height=l;const d=i.getContext("2d");if("filter"in d){const e=Math.ceil(s)*2;const a=document.createElement("canvas");const l=a.getContext("2d");const i=t.width;const o=t.height;a.width=i+e*2;a.height=o+e*2;l.drawImage(t,0,0,i,1,e,0,i,e);l.drawImage(t,0,o-1,i,1,e,o+e,i,e);l.drawImage(t,0,0,1,o,0,e,e,o);l.drawImage(t,i-1,0,1,o,i+e,e,e,o);l.drawImage(t,0,0,1,1,0,0,e,e);l.drawImage(t,i-1,0,1,1,i+e,0,e,e);l.drawImage(t,0,o-1,1,1,0,o+e,e,e);l.drawImage(t,i-1,o-1,1,1,i+e,o+e,e,e);l.drawImage(t,e,e);l.filter=`blur(${s}px)`;l.drawImage(a,0,0,a.width,a.height,0,0,a.width,a.height);d.drawImage(a,e,e,i,o,0,0,i,o)}else{console.log("blur manually");d.drawImage(t,0,0);const e=d.getImageData(0,0,i.width,i.height);const a=P(e,s);d.putImageData(a,0,0)}const n=d.getImageData(0,0,10,10);const[c,b,h]=n.data;const p=`#${[c,b,h].map((e=>e.toString(16).padStart(2,"0"))).join("")}`;const v=o.Browser.isSafari()?"image/jpeg":"image/webp";const u=o.Browser.isSafari()?"jpg":"webp";const m=await new Promise((e=>{i.toBlob(e,v)}));const g=e.name?`blurred_${r.Helpers.getFilenameWithoutExtension(e.name)}.${u}`:`blurred_${o.Text.getRandom()}.${u}`;return{file:new File([m],g,{type:v}),color:p}}function P(e,s){if(s<1){return e}const t=e.data;const a=e.width;const l=e.height;const i=Math.round(s);const o=B(i,3);const r=new Uint8ClampedArray(t);let d=t;let n=r;for(let e=0;e<3;e++){const s=Math.floor((o[e]-1)/2);L(d,n,a,l,s);[d,n]=[n,d]}if(d!==t){t.set(d)}return e}function L(e,s,t,a,l){const i=new Uint8ClampedArray(e.length);H(e,i,t,a,l);f(i,s,t,a,l)}function B(e,s){const t=Math.sqrt(12*e*e/s+1);let a=Math.floor(t);if(a%2===0){a--}const l=a+2;const i=(12*e*e-s*a*a-4*s*a-3*s)/(-4*a-4);const o=Math.round(i);const r=[];for(let e=0;e<s;e++){r.push(e<o?a:l)}return r}function H(e,s,t,a,l){if(l===0){s.set(e);return}const i=l*2+1;const o=1/i;for(let i=0;i<a;i++){const a=i*t*4;let r=0;let d=0;let n=0;let c=0;for(let s=-l;s<=l;s++){const l=Math.max(0,Math.min(t-1,s));const i=a+l*4;r+=e[i];d+=e[i+1];n+=e[i+2];c+=e[i+3]}let b=a;s[b]=Math.round(r*o);s[b+1]=Math.round(d*o);s[b+2]=Math.round(n*o);s[b+3]=Math.round(c*o);for(let i=1;i<t;i++){const h=Math.max(0,Math.min(t-1,i-l-1));const p=a+h*4;r-=e[p];d-=e[p+1];n-=e[p+2];c-=e[p+3];const v=Math.max(0,Math.min(t-1,i+l));const u=a+v*4;r+=e[u];d+=e[u+1];n+=e[u+2];c+=e[u+3];b=a+i*4;s[b]=Math.round(r*o);s[b+1]=Math.round(d*o);s[b+2]=Math.round(n*o);s[b+3]=Math.round(c*o)}}}function f(e,s,t,a,l){if(l===0){s.set(e);return}const i=l*2+1;const o=1/i;const r=t*4;for(let i=0;i<t;i++){const t=i*4;let d=0;let n=0;let c=0;let b=0;for(let s=-l;s<=l;s++){const l=Math.max(0,Math.min(a-1,s));const i=l*r+t;d+=e[i];n+=e[i+1];c+=e[i+2];b+=e[i+3]}let h=t;s[h]=Math.round(d*o);s[h+1]=Math.round(n*o);s[h+2]=Math.round(c*o);s[h+3]=Math.round(b*o);for(let i=1;i<a;i++){const p=Math.max(0,Math.min(a-1,i-l-1));const v=p*r+t;d-=e[v];n-=e[v+1];c-=e[v+2];b-=e[v+3];const u=Math.max(0,Math.min(a-1,i+l));const m=u*r+t;d+=e[m];n+=e[m+1];c+=e[m+2];b+=e[m+3];h=i*r+t;s[h]=Math.round(d*o);s[h+1]=Math.round(n*o);s[h+2]=Math.round(c*o);s[h+3]=Math.round(b*o)}}}let F=e=>e,y,T,I,w,E;var C=babelHelpers.classPrivateFieldLooseKey("themePicker");var M=babelHelpers.classPrivateFieldLooseKey("listDialog");var O=babelHelpers.classPrivateFieldLooseKey("colorPicker");var _=babelHelpers.classPrivateFieldLooseKey("popup");var x=babelHelpers.classPrivateFieldLooseKey("previewApplied");var D=babelHelpers.classPrivateFieldLooseKey("origAppliedThemeId");var j=babelHelpers.classPrivateFieldLooseKey("uploader");var k=babelHelpers.classPrivateFieldLooseKey("refs");var K=babelHelpers.classPrivateFieldLooseKey("previewLoader");var R=babelHelpers.classPrivateFieldLooseKey("resetResources");var $=babelHelpers.classPrivateFieldLooseKey("getBgImage");var A=babelHelpers.classPrivateFieldLooseKey("getBgImageUrl");var U=babelHelpers.classPrivateFieldLooseKey("getBgImageBlurred");var X=babelHelpers.classPrivateFieldLooseKey("getBgImageBlurredUrl");var S=babelHelpers.classPrivateFieldLooseKey("getBgColor");var N=babelHelpers.classPrivateFieldLooseKey("getTextColor");var W=babelHelpers.classPrivateFieldLooseKey("getControl");var G=babelHelpers.classPrivateFieldLooseKey("getControls");var z=babelHelpers.classPrivateFieldLooseKey("getPopup");var q=babelHelpers.classPrivateFieldLooseKey("getColorPicker");var V=babelHelpers.classPrivateFieldLooseKey("handleCreateButtonClick");var Y=babelHelpers.classPrivateFieldLooseKey("getContent");var Q=babelHelpers.classPrivateFieldLooseKey("showError");var Z=babelHelpers.classPrivateFieldLooseKey("hideError");var J=babelHelpers.classPrivateFieldLooseKey("createField");var ee=babelHelpers.classPrivateFieldLooseKey("getBgColorField");var se=babelHelpers.classPrivateFieldLooseKey("getBgImageField");var te=babelHelpers.classPrivateFieldLooseKey("validateForm");var ae=babelHelpers.classPrivateFieldLooseKey("validateBgColor");var le=babelHelpers.classPrivateFieldLooseKey("showPreview");var ie=babelHelpers.classPrivateFieldLooseKey("hidePreview");var oe=babelHelpers.classPrivateFieldLooseKey("handleBgImageEnter");var re=babelHelpers.classPrivateFieldLooseKey("handleBgImageLeave");var de=babelHelpers.classPrivateFieldLooseKey("handleBgImageOver");var ne=babelHelpers.classPrivateFieldLooseKey("handleBgColorClick");var ce=babelHelpers.classPrivateFieldLooseKey("handleBgColorChange");var be=babelHelpers.classPrivateFieldLooseKey("handleBgColorClear");var he=babelHelpers.classPrivateFieldLooseKey("handleBgColorSelect");var pe=babelHelpers.classPrivateFieldLooseKey("setBgColor");var ve=babelHelpers.classPrivateFieldLooseKey("setTextColor");var ue=babelHelpers.classPrivateFieldLooseKey("getTextColorField");var me=babelHelpers.classPrivateFieldLooseKey("handleSwitcherClick");var ge=babelHelpers.classPrivateFieldLooseKey("applyThemePreview");var Pe=babelHelpers.classPrivateFieldLooseKey("removeThemePreview");var Le=babelHelpers.classPrivateFieldLooseKey("getPreviewThemeId");var Be=babelHelpers.classPrivateFieldLooseKey("chooseTextColor");class He extends a.EventEmitter{constructor(e,s){super();Object.defineProperty(this,Be,{value:ls});Object.defineProperty(this,Le,{value:as});Object.defineProperty(this,Pe,{value:ts});Object.defineProperty(this,ge,{value:ss});Object.defineProperty(this,me,{value:es});Object.defineProperty(this,ue,{value:Je});Object.defineProperty(this,ve,{value:Ze});Object.defineProperty(this,pe,{value:Qe});Object.defineProperty(this,he,{value:Ye});Object.defineProperty(this,be,{value:Ve});Object.defineProperty(this,ce,{value:qe});Object.defineProperty(this,ne,{value:ze});Object.defineProperty(this,de,{value:Ge});Object.defineProperty(this,re,{value:We});Object.defineProperty(this,oe,{value:Ne});Object.defineProperty(this,ie,{value:Se});Object.defineProperty(this,le,{value:Xe});Object.defineProperty(this,ae,{value:Ue});Object.defineProperty(this,te,{value:Ae});Object.defineProperty(this,se,{value:$e});Object.defineProperty(this,ee,{value:Re});Object.defineProperty(this,J,{value:Ke});Object.defineProperty(this,Z,{value:ke});Object.defineProperty(this,Q,{value:je});Object.defineProperty(this,Y,{value:De});Object.defineProperty(this,V,{value:xe});Object.defineProperty(this,q,{value:_e});Object.defineProperty(this,z,{value:Oe});Object.defineProperty(this,G,{value:Me});Object.defineProperty(this,W,{value:Ce});Object.defineProperty(this,N,{value:Ee});Object.defineProperty(this,S,{value:we});Object.defineProperty(this,X,{value:Ie});Object.defineProperty(this,U,{value:Te});Object.defineProperty(this,A,{value:ye});Object.defineProperty(this,$,{value:Fe});Object.defineProperty(this,R,{value:fe});Object.defineProperty(this,C,{writable:true,value:void 0});Object.defineProperty(this,M,{writable:true,value:void 0});Object.defineProperty(this,O,{writable:true,value:null});Object.defineProperty(this,_,{writable:true,value:null});Object.defineProperty(this,x,{writable:true,value:false});Object.defineProperty(this,D,{writable:true,value:null});Object.defineProperty(this,j,{writable:true,value:null});Object.defineProperty(this,k,{writable:true,value:new t.MemoryCache});Object.defineProperty(this,K,{writable:true,value:null});this.setEventNamespace("BX.Intranet.Bitrix24.ThemePicker.NewThemeDialog");babelHelpers.classPrivateFieldLooseBase(this,C)[C]=e;babelHelpers.classPrivateFieldLooseBase(this,M)[M]=s}show(){babelHelpers.classPrivateFieldLooseBase(this,z)[z]().setContent(babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]());babelHelpers.classPrivateFieldLooseBase(this,z)[z]().show();babelHelpers.classPrivateFieldLooseBase(this,C)[C].disableThemeListDialog()}destroy(){babelHelpers.classPrivateFieldLooseBase(this,R)[R]();babelHelpers.classPrivateFieldLooseBase(this,z)[z]().destroy();babelHelpers.classPrivateFieldLooseBase(this,_)[_]=null;babelHelpers.classPrivateFieldLooseBase(this,k)[k]=null}getUploader(){var e,s;(s=(e=babelHelpers.classPrivateFieldLooseBase(this,j))[j])!=null?s:e[j]=new r.Uploader({multiple:false,acceptOnlyImages:true,allowReplaceSingle:true,imagePreviewWidth:1920,imagePreviewHeight:1080,imagePreviewMimeType:"image/webp",imagePreviewMimeTypeMode:"force",imagePreviewQuality:.85,imageMinWidth:300,imageMinHeight:200,imageMaxWidth:1e4,imageMaxHeight:1e4,imageMaxFileSize:20*1024*1024,events:{[r.UploaderEvent.FILE_LOAD_START]:()=>{babelHelpers.classPrivateFieldLooseBase(this,ie)[ie]();babelHelpers.classPrivateFieldLooseBase(this,K)[K]=new i.Loader({size:40});babelHelpers.classPrivateFieldLooseBase(this,K)[K].show(babelHelpers.classPrivateFieldLooseBase(this,W)[W]("field-file-preview"))},[r.UploaderEvent.FILE_ERROR]:e=>{var s;const t=e.getData().error;babelHelpers.classPrivateFieldLooseBase(this,Q)[Q](`${t.getMessage()}<br>${t.getDescription()}`);(s=babelHelpers.classPrivateFieldLooseBase(this,K)[K])==null?void 0:s.destroy();babelHelpers.classPrivateFieldLooseBase(this,K)[K]=null},[r.UploaderEvent.FILE_COMPLETE]:async e=>{var s;babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]();const t=e.getData().file;const a=t.getClientPreview();const{file:l,color:i}=await g(a,7);const o=URL.createObjectURL(l);t.setCustomData("bgImageBlurred",l);t.setCustomData("bgImageBlurredUrl",o);(s=babelHelpers.classPrivateFieldLooseBase(this,K)[K])==null?void 0:s.destroy();babelHelpers.classPrivateFieldLooseBase(this,K)[K]=null;babelHelpers.classPrivateFieldLooseBase(this,pe)[pe](i);babelHelpers.classPrivateFieldLooseBase(this,ve)[ve](babelHelpers.classPrivateFieldLooseBase(this,Be)[Be](i));babelHelpers.classPrivateFieldLooseBase(this,le)[le](babelHelpers.classPrivateFieldLooseBase(this,A)[A]());babelHelpers.classPrivateFieldLooseBase(this,ge)[ge]()}}});return babelHelpers.classPrivateFieldLooseBase(this,j)[j]}}function fe(){var e;if(babelHelpers.classPrivateFieldLooseBase(this,X)[X]()!==null){URL.revokeObjectURL(babelHelpers.classPrivateFieldLooseBase(this,X)[X]())}(e=babelHelpers.classPrivateFieldLooseBase(this,j)[j])==null?void 0:e.destroy();babelHelpers.classPrivateFieldLooseBase(this,j)[j]=null;if(babelHelpers.classPrivateFieldLooseBase(this,x)[x]){babelHelpers.classPrivateFieldLooseBase(this,M)[M].applyTheme(babelHelpers.classPrivateFieldLooseBase(this,D)[D])}babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]();babelHelpers.classPrivateFieldLooseBase(this,C)[C].enableThemeListDialog()}function Fe(){return this.getUploader().getFiles()[0]||null}function ye(){var e;return((e=babelHelpers.classPrivateFieldLooseBase(this,$)[$]())==null?void 0:e.getPreviewUrl())||null}function Te(){var e;return((e=babelHelpers.classPrivateFieldLooseBase(this,$)[$]())==null?void 0:e.getCustomData("bgImageBlurred"))||null}function Ie(){var e;return((e=babelHelpers.classPrivateFieldLooseBase(this,$)[$]())==null?void 0:e.getCustomData("bgImageBlurredUrl"))||null}function we(){const e=babelHelpers.classPrivateFieldLooseBase(this,W)[W]("field-bg-color").value;return babelHelpers.classPrivateFieldLooseBase(this,ae)[ae](e)?e:null}function Ee(){return babelHelpers.classPrivateFieldLooseBase(this,W)[W]("field-text-color").value}function Ce(e){return babelHelpers.classPrivateFieldLooseBase(this,z)[z]().getContentContainer().querySelector(`.theme-dialog-${e}`)}function Me(e){return babelHelpers.classPrivateFieldLooseBase(this,z)[z]().getContentContainer().querySelectorAll(`.theme-dialog-${e}`)}function Oe(){if(babelHelpers.classPrivateFieldLooseBase(this,_)[_]){return babelHelpers.classPrivateFieldLooseBase(this,_)[_]}babelHelpers.classPrivateFieldLooseBase(this,_)[_]=new l.Popup({width:500,height:560,fixed:true,titleBar:o.Loc.getMessage("BITRIX24_THEME_CREATE_YOUR_OWN_THEME"),closeByEsc:true,bindOnResize:false,closeIcon:true,draggable:true,cacheable:false,events:{onClose:()=>{babelHelpers.classPrivateFieldLooseBase(this,R)[R]()},onDestroy:()=>{this.emit("onDestroy")}},buttons:[new l.PopupWindowButton({id:"theme-dialog-create-button",text:o.Loc.getMessage("BITRIX24_THEME_DIALOG_CREATE_BUTTON"),className:"popup-window-button-accept",events:{click:babelHelpers.classPrivateFieldLooseBase(this,V)[V].bind(this)}}),new l.PopupWindowButtonLink({text:o.Loc.getMessage("BITRIX24_THEME_DIALOG_CANCEL_BUTTON"),className:"popup-window-button-link theme-dialog-button-link",events:{click:()=>{babelHelpers.classPrivateFieldLooseBase(this,_)[_].close()}}})]});return babelHelpers.classPrivateFieldLooseBase(this,_)[_]}function _e(){if(babelHelpers.classPrivateFieldLooseBase(this,O)[O]){return babelHelpers.classPrivateFieldLooseBase(this,O)[O]}const e=o.Reflection.getClass("BX.ColorPicker");if(e){babelHelpers.classPrivateFieldLooseBase(this,O)[O]=new e({onColorSelected:babelHelpers.classPrivateFieldLooseBase(this,he)[he].bind(this),popupOptions:{fixed:true}})}return babelHelpers.classPrivateFieldLooseBase(this,O)[O]}function xe(){const e=babelHelpers.classPrivateFieldLooseBase(this,te)[te]();if(e!==null){babelHelpers.classPrivateFieldLooseBase(this,Q)[Q](e);return}const s=babelHelpers.classPrivateFieldLooseBase(this,z)[z]().getButton("theme-dialog-create-button");if(o.Dom.hasClass(s.getContainer(),"popup-window-button-wait")){return}const t=new FormData;t.append("bgImage",babelHelpers.classPrivateFieldLooseBase(this,$)[$]()?babelHelpers.classPrivateFieldLooseBase(this,$)[$]().getClientPreview():"");t.append("bgImageBlurred",babelHelpers.classPrivateFieldLooseBase(this,U)[U]()||"");t.append("bgColor",babelHelpers.classPrivateFieldLooseBase(this,S)[S]()||"");t.append("textColor",babelHelpers.classPrivateFieldLooseBase(this,N)[N]()||"");t.append("action","create");t.append("sessid",o.Loc.getMessage("bitrix_sessid"));t.append("siteId",babelHelpers.classPrivateFieldLooseBase(this,C)[C].getSiteId());t.append("templateId",babelHelpers.classPrivateFieldLooseBase(this,C)[C].getTemplateId());let a=0;for(const[e,s]of t.entries()){a+=e.length;a+=s instanceof Blob?s.size:s.length}if(a>babelHelpers.classPrivateFieldLooseBase(this,C)[C].getMaxUploadSize()){const e=babelHelpers.classPrivateFieldLooseBase(this,C)[C].getMaxUploadSize()/1024/1024;babelHelpers.classPrivateFieldLooseBase(this,Q)[Q](o.Loc.getMessage("BITRIX24_THEME_FILE_SIZE_EXCEEDED",{"#LIMIT#":`${e.toFixed(0)}Mb`}));return}const l=document.forms["theme-new-theme-form"];s.addClassName("popup-window-button-wait");o.Dom.addClass(l,"theme-dialog-form-disabled");o.ajax({url:babelHelpers.classPrivateFieldLooseBase(this,C)[C].getAjaxHandlerPath(),method:"POST",dataType:"json",preparePost:false,data:t,onsuccess:e=>{if(e&&e.success&&e.theme){babelHelpers.classPrivateFieldLooseBase(this,M)[M].addItem(e.theme);babelHelpers.classPrivateFieldLooseBase(this,M)[M].preloadTheme(e.theme.id,(()=>{s.removeClassName("popup-window-button-wait");o.Dom.removeClass(l,"theme-dialog-form-disabled");babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]();babelHelpers.classPrivateFieldLooseBase(this,z)[z]().close()}))}else{s.removeClassName("popup-window-button-wait");o.Dom.removeClass(l,"theme-dialog-form-disabled");babelHelpers.classPrivateFieldLooseBase(this,Q)[Q](e.error||o.Loc.getMessage("BITRIX24_THEME_UNKNOWN_ERROR"))}},onfailure:()=>{s.removeClassName("popup-window-button-wait");o.Dom.removeClass(l,"theme-dialog-form-disabled");babelHelpers.classPrivateFieldLooseBase(this,Q)[Q](o.Loc.getMessage("BITRIX24_THEME_UNKNOWN_ERROR"))}})}function De(){return o.Tag.render(y||(y=F`
			<form name="theme-new-theme-form" method="post" onsubmit="${0}">
				<div class="theme-dialog-form-alert">
					<div class="theme-dialog-form-alert-content"></div>
					<div
						class="theme-dialog-form-alert-remove"
						onclick="${0}"
					></div>
				</div>
				<div class="theme-dialog-form">
					${0}
					${0}
					${0}
				</div>
			</form>
		`),(e=>e.preventDefault()),babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].bind(this),babelHelpers.classPrivateFieldLooseBase(this,J)[J](o.Loc.getMessage("BITRIX24_THEME_THEME_BG_IMAGE"),babelHelpers.classPrivateFieldLooseBase(this,se)[se]()),babelHelpers.classPrivateFieldLooseBase(this,J)[J](o.Loc.getMessage("BITRIX24_THEME_THEME_BG_COLOR"),babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]()),babelHelpers.classPrivateFieldLooseBase(this,J)[J](o.Loc.getMessage("BITRIX24_THEME_THEME_TEXT_COLOR"),babelHelpers.classPrivateFieldLooseBase(this,ue)[ue]()))}function je(e){o.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,W)[W]("form-alert"),"theme-dialog-form-alert-show");babelHelpers.classPrivateFieldLooseBase(this,W)[W]("form-alert-content").innerHTML=e}function ke(){o.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,W)[W]("form-alert"),"theme-dialog-form-alert-show")}function Ke(e,s){return o.Tag.render(T||(T=F`
			<div class="theme-dialog-field">
				<div class="theme-dialog-field-label">${0}</div>
				<div class="theme-dialog-field-value">${0}</div>
			</div>
		`),e,s)}function Re(){return o.Tag.render(I||(I=F`
			<div class="theme-dialog-field-textbox-wrapper" onclick="${0}">
				<div class="theme-dialog-field-textbox-color"></div>
				<input
					type="text"
					placeholder=""
					name="bgColor"
					maxlength="7"
					class="theme-dialog-field-textbox theme-dialog-field-bg-color"
					oninput="${0}"
					autocomplete="off"
				>
				<div
					class="theme-dialog-field-textbox-remove"
					onclick="${0}"
				></div>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,ne)[ne].bind(this),babelHelpers.classPrivateFieldLooseBase(this,ce)[ce].bind(this),babelHelpers.classPrivateFieldLooseBase(this,be)[be].bind(this))}function $e(){return babelHelpers.classPrivateFieldLooseBase(this,k)[k].remember("image-field",(()=>{const e=o.Tag.render(w||(w=F`
				<div class="theme-dialog-field-file">
					<div
						class="theme-dialog-field-button"
						ondragenter="${0}"
						ondragleave="${0}"
						ondragover="${0}"
					>
						<div class="theme-dialog-field-file-preview"></div>
						<div class="theme-dialog-field-file-text">
							<span class="theme-dialog-field-file-add">
								${0}
							</span>
							<span class="theme-dialog-field-file-add-info">
								${0}
							</span>
						</div>
					</div>
				</div>
			`),babelHelpers.classPrivateFieldLooseBase(this,oe)[oe].bind(this),babelHelpers.classPrivateFieldLooseBase(this,re)[re].bind(this),babelHelpers.classPrivateFieldLooseBase(this,de)[de].bind(this),o.Loc.getMessage("BITRIX24_THEME_UPLOAD_BG_IMAGE"),o.Loc.getMessage("BITRIX24_THEME_DRAG_BG_IMAGE"));this.getUploader().assignBrowse(e);this.getUploader().assignDropzone(e);return e}))}function Ae(){const e=babelHelpers.classPrivateFieldLooseBase(this,$)[$]();const s=babelHelpers.classPrivateFieldLooseBase(this,W)[W]("field-bg-color").value;if(o.Type.isStringFilled(s)&&!babelHelpers.classPrivateFieldLooseBase(this,ae)[ae](s)){return o.Loc.getMessage("BITRIX24_THEME_WRONG_BG_COLOR")}if(!e&&!o.Type.isStringFilled(s)){return o.Loc.getMessage("BITRIX24_THEME_EMPTY_FORM_DATA")}if(e&&e.isFailed()){return`${e.getError().getMessage()}<br>${e.getError().getDescription()}`}return null}function Ue(e){return o.Type.isStringFilled(e)&&e.match(/^#([\dA-Fa-f]{6})$/)}function Xe(e){const s=babelHelpers.classPrivateFieldLooseBase(this,W)[W]("field-file-preview");o.Dom.style(s,"background-image",`url("${encodeURI(e)}")`)}function Se(){const e=babelHelpers.classPrivateFieldLooseBase(this,W)[W]("field-file-preview");o.Dom.style(e,"background-image",null)}function Ne(e){o.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,W)[W]("field-button"),"theme-dialog-field-button-hover");e.stopPropagation();e.preventDefault()}function We(e){o.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,W)[W]("field-button"),"theme-dialog-field-button-hover");e.stopPropagation();e.preventDefault()}function Ge(e){e.stopPropagation();e.preventDefault()}function ze(){babelHelpers.classPrivateFieldLooseBase(this,q)[q]().open({bindElement:babelHelpers.classPrivateFieldLooseBase(this,W)[W]("field-bg-color")})}function qe(){if(babelHelpers.classPrivateFieldLooseBase(this,S)[S]()){babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]()}babelHelpers.classPrivateFieldLooseBase(this,ge)[ge]()}function Ve(e){babelHelpers.classPrivateFieldLooseBase(this,q)[q]().close();o.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,W)[W]("field-bg-color"),"theme-dialog-field-textbox-not-empty");babelHelpers.classPrivateFieldLooseBase(this,W)[W]("field-bg-color").value="";o.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,W)[W]("field-textbox-color"),"backgroundColor",null);babelHelpers.classPrivateFieldLooseBase(this,ge)[ge]();e.stopPropagation()}function Ye(e){babelHelpers.classPrivateFieldLooseBase(this,pe)[pe](e);babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]();babelHelpers.classPrivateFieldLooseBase(this,ge)[ge]()}function Qe(e){babelHelpers.classPrivateFieldLooseBase(this,W)[W]("field-bg-color").value=e;o.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,W)[W]("field-bg-color"),"theme-dialog-field-textbox-not-empty");o.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,W)[W]("field-textbox-color"),"backgroundColor",e)}function Ze(e){const s=babelHelpers.classPrivateFieldLooseBase(this,G)[G]("field-button-switcher-item");[].forEach.call(s,(s=>{if(s.dataset.textColor===e){o.Dom.addClass(s,"theme-dialog-field-button-switcher-item-pressed")}else{o.Dom.removeClass(s,"theme-dialog-field-button-switcher-item-pressed")}}));babelHelpers.classPrivateFieldLooseBase(this,W)[W]("field-text-color").value=e}function Je(){return o.Tag.render(E||(E=F`
			<div class="theme-dialog-field-button-switcher">
				<div
					class="theme-dialog-field-button-switcher-item theme-dialog-field-button-switcher-item-left theme-dialog-field-button-switcher-item-pressed"
					data-text-color="light"
					onclick="${0}"
				>
					${0}
				</div>
				<div
					class="theme-dialog-field-button-switcher-item theme-dialog-field-button-switcher-item-right"
					data-text-color="dark"
					onclick="${0}"
				>
					${0}
				</div>
				<input
					type="hidden"
					name="textColor"
					value="light"
					class="theme-dialog-field-text-color"
				>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,me)[me].bind(this),o.Loc.getMessage("BITRIX24_THEME_THEME_LIGHT_COLOR"),babelHelpers.classPrivateFieldLooseBase(this,me)[me].bind(this),o.Loc.getMessage("BITRIX24_THEME_THEME_DARK_COLOR"))}function es(e){const s=e.target.dataset.textColor;babelHelpers.classPrivateFieldLooseBase(this,ve)[ve](s);babelHelpers.classPrivateFieldLooseBase(this,ge)[ge]()}function ss(){if(babelHelpers.classPrivateFieldLooseBase(this,$)[$]()===null&&babelHelpers.classPrivateFieldLooseBase(this,S)[S]()===null){if(babelHelpers.classPrivateFieldLooseBase(this,x)[x]){babelHelpers.classPrivateFieldLooseBase(this,M)[M].applyTheme(babelHelpers.classPrivateFieldLooseBase(this,D)[D])}return}const e=babelHelpers.classPrivateFieldLooseBase(this,C)[C].getBaseThemes();const s=babelHelpers.classPrivateFieldLooseBase(this,N)[N]();if(!e[s]||!o.Type.isArray(e[s].css)){return}let t=":root { ";if(babelHelpers.classPrivateFieldLooseBase(this,A)[A]()!==null){t+="--air-theme-bg-size: cover;";t+="--air-theme-bg-repeat: no-repeat;";t+="--air-theme-bg-position: 0 0;";t+="--air-theme-bg-attachment: fixed;";t+=`--air-theme-bg-image: url("${encodeURI(babelHelpers.classPrivateFieldLooseBase(this,A)[A]())}");`;if(babelHelpers.classPrivateFieldLooseBase(this,X)[X]()!==null){t+=`--air-theme-bg-image-blurred: url("${encodeURI(babelHelpers.classPrivateFieldLooseBase(this,X)[X]())}");`}}if(babelHelpers.classPrivateFieldLooseBase(this,S)[S]()){t+=`--air-theme-bg-color: ${babelHelpers.classPrivateFieldLooseBase(this,S)[S]()}; `}t+=" }";if(!babelHelpers.classPrivateFieldLooseBase(this,x)[x]){babelHelpers.classPrivateFieldLooseBase(this,D)[D]=babelHelpers.classPrivateFieldLooseBase(this,C)[C].getAppliedThemeId()}babelHelpers.classPrivateFieldLooseBase(this,M)[M].removeThemeAssets(babelHelpers.classPrivateFieldLooseBase(this,C)[C].getAppliedThemeId());babelHelpers.classPrivateFieldLooseBase(this,M)[M].applyThemeAssets({id:babelHelpers.classPrivateFieldLooseBase(this,Le)[Le](),css:e[s].css,style:t});babelHelpers.classPrivateFieldLooseBase(this,C)[C].setAppliedThemeId(babelHelpers.classPrivateFieldLooseBase(this,Le)[Le]());babelHelpers.classPrivateFieldLooseBase(this,x)[x]=true}function ts(){babelHelpers.classPrivateFieldLooseBase(this,M)[M].removeThemeAssets(babelHelpers.classPrivateFieldLooseBase(this,Le)[Le]());babelHelpers.classPrivateFieldLooseBase(this,x)[x]=false}function as(){return`${babelHelpers.classPrivateFieldLooseBase(this,N)[N]()}:custom_live_preview`}function ls(e){let s=e.replace(/^#/,"");if(s.length===3){s=[...s].map((e=>e+e)).join("")}const t=parseInt(s.slice(0,2),16);const a=parseInt(s.slice(2,4),16);const l=parseInt(s.slice(4,6),16);const i=(t*299+a*587+l*114)/1e3;return i>186?"dark":"light"}let is=e=>e,os,rs,ds,ns,cs,bs,hs,ps,vs,us,ms,gs;var Ps=babelHelpers.classPrivateFieldLooseKey("themePicker");var Ls=babelHelpers.classPrivateFieldLooseKey("newThemeDialog");var Bs=babelHelpers.classPrivateFieldLooseKey("checkboxButton");var Hs=babelHelpers.classPrivateFieldLooseKey("loadImage");var fs=babelHelpers.classPrivateFieldLooseKey("urnEncode");var Fs=babelHelpers.classPrivateFieldLooseKey("ajax");var ys=babelHelpers.classPrivateFieldLooseKey("loadThemes");var Ts=babelHelpers.classPrivateFieldLooseKey("setButtons");var Is=babelHelpers.classPrivateFieldLooseKey("getCheckboxButton");var ws=babelHelpers.classPrivateFieldLooseKey("showFatalError");var Es=babelHelpers.classPrivateFieldLooseKey("hideLoader");var Cs=babelHelpers.classPrivateFieldLooseKey("getSaveButton");var Ms=babelHelpers.classPrivateFieldLooseKey("handleSaveButtonClick");var Os=babelHelpers.classPrivateFieldLooseKey("isCheckboxChecked");var _s=babelHelpers.classPrivateFieldLooseKey("getCancelButton");var xs=babelHelpers.classPrivateFieldLooseKey("getCreateButton");var Ds=babelHelpers.classPrivateFieldLooseKey("renderLayout");var js=babelHelpers.classPrivateFieldLooseKey("saveTheme");var ks=babelHelpers.classPrivateFieldLooseKey("createDefaultLabel");var Ks=babelHelpers.classPrivateFieldLooseKey("createNewLabel");var Rs=babelHelpers.classPrivateFieldLooseKey("selectItem");var $s=babelHelpers.classPrivateFieldLooseKey("preloadCss");class As{constructor(e){Object.defineProperty(this,$s,{value:it});Object.defineProperty(this,Rs,{value:lt});Object.defineProperty(this,Ks,{value:at});Object.defineProperty(this,ks,{value:tt});Object.defineProperty(this,js,{value:st});Object.defineProperty(this,Ds,{value:et});Object.defineProperty(this,xs,{value:Js});Object.defineProperty(this,_s,{value:Zs});Object.defineProperty(this,Os,{value:Qs});Object.defineProperty(this,Ms,{value:Ys});Object.defineProperty(this,Cs,{value:Vs});Object.defineProperty(this,Es,{value:qs});Object.defineProperty(this,ws,{value:zs});Object.defineProperty(this,Is,{value:Gs});Object.defineProperty(this,Ts,{value:Ws});Object.defineProperty(this,ys,{value:Ns});Object.defineProperty(this,Fs,{value:Ss});Object.defineProperty(this,fs,{value:Xs});Object.defineProperty(this,Hs,{value:Us});Object.defineProperty(this,Ps,{writable:true,value:void 0});Object.defineProperty(this,Ls,{writable:true,value:null});Object.defineProperty(this,Bs,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps]=e}show(){babelHelpers.classPrivateFieldLooseBase(this,ys)[ys]()}close(){var e;(e=babelHelpers.classPrivateFieldLooseBase(this,Ls)[Ls])==null?void 0:e.destroy();babelHelpers.classPrivateFieldLooseBase(this,Ls)[Ls]=null;if(!babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].needReturnValue()){this.applyTheme(babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].getThemeId())}babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].setThemes([])}async makeCustomThemeBlurred(e,s={}){var t;if(!o.Type.isStringFilled(e.bgImageUrlToBlur)){return Promise.resolve()}const a="custom_themes_errors";const l=o.Reflection.getClass("BX.localStorage");if(l&&(t=l.get(a))!=null&&t.includes(e.id)){console.log("Skipping blurred image for theme",e.id);return Promise.resolve()}const i=(s=3600)=>{if(l){const t=l.get(a)||"";l.set(a,`${t}|${e.id}`,s)}};let r=null;let d=null;try{const{image:s}=await babelHelpers.classPrivateFieldLooseBase(this,Hs)[Hs](e.bgImageUrlToBlur);const t=await g(s,7);r=t.file;d=t.color}catch(e){i();return Promise.reject(e)}const{ignoreErrors:n=false,applyTheme:c=false}=s;const b=new FormData;b.append("action","save-blurred-image");b.append("themeId",e.id);b.append("bgImageBlurred",r);b.append("bgColor",d);b.append("ignoreErrors",n);return babelHelpers.classPrivateFieldLooseBase(this,Fs)[Fs](b).then((s=>{if(s&&s.success&&s.theme){babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].updateTheme(s.theme.id,{bgImageUrlToBlur:null});babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].updateTheme(s.theme.id,s.theme);this.preloadTheme(s.theme.id,(()=>{if(c){this.removeThemeAssets(babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].getAppliedThemeId());this.applyThemeAssets(s.theme)}}))}else{console.log("Error while saving blurred image for theme",e.id);i()}})).catch((e=>{console.error(e);i()}))}addItem(e){const s=babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].getThemes();s.unshift(e);babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].setThemes(s);const t=this.createItem(e);o.Dom.prepend(t,this.getContentContainer());babelHelpers.classPrivateFieldLooseBase(this,Rs)[Rs](t)}createItem(e){let s="theme-dialog-item";if(e.video){s+=" theme-dialog-item-video"}if(babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].getAppliedThemeId()===e.id){s+=" theme-dialog-item-selected"}const t=o.Tag.render(os||(os=is`
			<div
				class="${0}"
				data-theme-id="${0}"
				onclick="${0}"
			>
				<div class="theme-dialog-item-title">
					<span class="theme-dialog-item-title-text">${0}</span>
					${0}
				</div>
				${0}
				${0}
			</div>
		`),s,e.id,this.handleItemClick.bind(this),e.title,e.removable?o.Tag.render(rs||(rs=is`
						<div
							class="theme-dialog-item-remove"
							data-theme-id="${0}"
							title="${0}"
							onclick="${0}"
						></div>
					`),e.id,o.Loc.getMessage("BITRIX24_THEME_REMOVE_THEME"),this.handleRemoveBtnClick.bind(this)):"",e.default===true?babelHelpers.classPrivateFieldLooseBase(this,ks)[ks]():"",e.new===true?babelHelpers.classPrivateFieldLooseBase(this,Ks)[Ks]():"");if(o.Type.isStringFilled(e.previewImage)){const s=o.Tag.render(ds||(ds=is`
				<img 
					src="${0}" 
					alt="${0}" 
					class="theme-dialog-item-preview-img" 
					loading="lazy"
				>
			`),encodeURI(e.previewImage),e.title);o.Dom.append(s,t)}if(o.Type.isStringFilled(e.previewColor)){o.Dom.style(t,"background-color",e.previewColor)}return t}getNewThemeDialog(){if(!babelHelpers.classPrivateFieldLooseBase(this,Ls)[Ls]){babelHelpers.classPrivateFieldLooseBase(this,Ls)[Ls]=new He(babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps],this);babelHelpers.classPrivateFieldLooseBase(this,Ls)[Ls].subscribe("onDestroy",(()=>{babelHelpers.classPrivateFieldLooseBase(this,Ls)[Ls]=null}))}return babelHelpers.classPrivateFieldLooseBase(this,Ls)[Ls]}handleItemClick(e){babelHelpers.classPrivateFieldLooseBase(this,Rs)[Rs](this.getItemNode(e))}handleRemoveBtnClick(e){const s=this.getItemNode(e);if(!s){return}const t=s.dataset.themeId;const a=babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].getTheme(t);if(a&&a.default){const e=this.getContentContainer().querySelector('[data-theme-id="default"]');if(e){o.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,ks)[ks](),e)}}babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].removeTheme(t);o.Dom.remove(s);if(babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].getAppliedThemeId()===t){const e=this.getContentContainer().children[0];babelHelpers.classPrivateFieldLooseBase(this,Rs)[Rs](e);if(babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].getThemeId()===t&&e&&e.dataset.themeId){babelHelpers.classPrivateFieldLooseBase(this,js)[js](e.dataset.themeId)}}else if(babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].getThemeId()===t){babelHelpers.classPrivateFieldLooseBase(this,js)[js](babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].getAppliedThemeId())}void babelHelpers.classPrivateFieldLooseBase(this,Fs)[Fs]({action:"remove",themeId:t});e.stopPropagation()}getItemNode(e){if(!e||!e.target){return null}const s=e.target.closest(".theme-dialog-item");return o.Type.isDomNode(s)?s:null}getContentContainer(){return babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].getDialogPopup().getContentContainer().querySelector(".theme-dialog-content")}applyTheme(e){if(!o.Type.isStringFilled(e)||e===babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].getAppliedThemeId()){return}const s=babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].getTheme(e);if(!s){return}const t={id:e,theme:s};a.EventEmitter.emit("BX.Intranet.Bitrix24:ThemePicker:onThemeApply",new a.BaseEvent({data:t,compatData:[t]}));this.applyThemeAssets(s);this.removeThemeAssets(babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].getAppliedThemeId());babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].setAppliedThemeId(e);this.appliedTheme=s;a.EventEmitter.emit("BX.Intranet.Bitrix24:ThemePicker:onThemeAfterApply",{id:e,theme:s})}applyThemeAssets(e){if(!e||!o.Type.isArray(e.css)||!o.Type.isStringFilled(e.id)){return}const s=document.head;const t=e.id;e.css.forEach((e=>{const a=o.Tag.render(ns||(ns=is`
				<link type="text/css" rel="stylesheet" href="${0}" data-theme-id="${0}">
			`),e,t);s.appendChild(a)}));if(o.Type.isStringFilled(e.style)){const a=o.Tag.render(cs||(cs=is`
				<style type="text/css" data-theme-id="${0}">
					${0}
				</style>
			`),t,e.style);s.appendChild(a)}if(e.video&&o.Type.isPlainObject(e.video.sources)){const s=[];for(const t in e.video.sources){s.push(o.Tag.render(bs||(bs=is`<source type="video/${0}" src="${0}">`),t,e.video.sources[t]))}const a=o.Tag.render(hs||(hs=is`
				<div class="theme-video-container" data-theme-id="${0}">
					<video
						class="theme-video"
						poster="${0}"
						autoplay
						loop
						muted
						playsinline
						data-theme-id="${0}"
					>
						${0}
					</video>
				</div>
			`),t,e.video.poster,t,s);document.body.insertBefore(a,document.body.firstElementChild)}const a=babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].getAppliedThemeId().split(":")[0];const l=t.split(":")[0];const i={light:"--ui-context-edge-dark",dark:"--ui-context-edge-light",default:"--ui-context-edge-light"};if(a!==l){o.Dom.removeClass(document.body,[`bitrix24-${a}-theme`,i[a]]);o.Dom.addClass(document.body,[`bitrix24-${l}-theme`,i[l]])}}removeThemeAssets(e){const s=document.head.querySelectorAll(`[data-theme-id="${e}"]`);for(const e of s){o.Dom.remove(e)}o.Dom.remove(document.querySelector(`body > [data-theme-id="${e}"]`))}preloadTheme(e,s){const t=o.Type.isFunction(s)?s:()=>{};const a=babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].getTheme(e);if(!a){t();return}let l=2;const i=()=>{l--;if(l===0){t()}};this.preloadImages(a.prefetchImages,i);babelHelpers.classPrivateFieldLooseBase(this,$s)[$s](a.css,i)}preloadImages(e,s){const t=o.Type.isFunction(s)?s:()=>{};if(!o.Type.isArrayFilled(e)){t();return}let a=0;e.forEach((s=>{const l=new Image;l.src=encodeURI(s);l.onload=l.onerror=()=>{a++;if(a===e.length){t()}}}))}}function Us(e){return new Promise(((s,t)=>{const a=document.createElement("img");let l=e;if(l.startsWith("http")&&!l.startsWith(window.location.origin)){l="/bitrix/tools/landing/proxy.php";l+=`?sessid=${o.Loc.getMessage("bitrix_sessid")}&url=${encodeURIComponent(babelHelpers.classPrivateFieldLooseBase(this,fs)[fs](e))}`}a.src=l;a.onerror=e=>{t(e)};a.onload=()=>{s({width:a.naturalWidth,height:a.naturalHeight,image:a})}}))}function Xs(e){let s="";const t=e.split(/(:\/\/|:\d+\/|\/|\?|=|&)/);for(const[e,a]of t.entries()){s+=e%2===1?a:encodeURIComponent(a)}return s}function Ss(e){const s=o.Type.isFormData(e)?e:new FormData;if(o.Type.isPlainObject(e)){for(const[t,a]of Object.entries(e)){s.append(t,a)}}s.append("sessid",o.Loc.getMessage("bitrix_sessid"));s.append("templateId",babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].getTemplateId());s.append("siteId",babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].getSiteId());s.append("entityType",babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].getEntityType());s.append("entityId",babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].getEntityId());return new Promise(((e,t)=>{o.ajax({method:"POST",dataType:"json",preparePost:false,url:babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].getAjaxHandlerPath(),data:s,onsuccess:e,onfailure:t})}))}function Ns(){babelHelpers.classPrivateFieldLooseBase(this,Fs)[Fs]({action:"getlist"}).then((e=>{if(!e||!e.success||!o.Type.isArray(e.themes)||e.themes.length===0){babelHelpers.classPrivateFieldLooseBase(this,ws)[ws]();return}babelHelpers.classPrivateFieldLooseBase(this,Es)[Es]();babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].setThemes(e.themes);babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].setBaseThemes(e.baseThemes);babelHelpers.classPrivateFieldLooseBase(this,Ts)[Ts]();babelHelpers.classPrivateFieldLooseBase(this,Ds)[Ds]()})).catch((()=>{babelHelpers.classPrivateFieldLooseBase(this,ws)[ws]()}))}function Ws(){const e=[];if(babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].isCurrentUserAdmin()&&babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].getEntityType()==="USER"){e.push(babelHelpers.classPrivateFieldLooseBase(this,Is)[Is]())}e.push(babelHelpers.classPrivateFieldLooseBase(this,Cs)[Cs](),babelHelpers.classPrivateFieldLooseBase(this,_s)[_s](),babelHelpers.classPrivateFieldLooseBase(this,xs)[xs]());babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].getDialogPopup().setButtons(e)}function Gs(){if(!babelHelpers.classPrivateFieldLooseBase(this,Bs)[Bs]){babelHelpers.classPrivateFieldLooseBase(this,Bs)[Bs]=new u(babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps])}return babelHelpers.classPrivateFieldLooseBase(this,Bs)[Bs]}function zs(){babelHelpers.classPrivateFieldLooseBase(this,Es)[Es]();babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].getDialogPopup().setContent(o.Loc.getMessage("BITRIX24_THEME_UNKNOWN_ERROR"));babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].getDialogPopup().setButtons([babelHelpers.classPrivateFieldLooseBase(this,_s)[_s]()])}function qs(){babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].hideLoader()}function Vs(){return new l.PopupWindowButton({id:"save-button",text:o.Loc.getMessage("BITRIX24_THEME_DIALOG_SAVE_BUTTON"),className:"popup-window-button-accept",events:{click:()=>{babelHelpers.classPrivateFieldLooseBase(this,Ms)[Ms]()}}})}function Ys(){if(babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].needReturnValue()){const e={theme:babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].getTheme(babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].getReturnValue())};a.EventEmitter.emit("Intranet.ThemePicker:onSave",new a.BaseEvent({data:[e],compatData:[e]}))}else if(babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].getThemeId()!==babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].getAppliedThemeId()||babelHelpers.classPrivateFieldLooseBase(this,Os)[Os]()){babelHelpers.classPrivateFieldLooseBase(this,js)[js](babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].getAppliedThemeId())}babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].closeDialog()}function Qs(){return babelHelpers.classPrivateFieldLooseBase(this,Bs)[Bs]?babelHelpers.classPrivateFieldLooseBase(this,Bs)[Bs].isChecked():false}function Zs(){return new l.PopupWindowButtonLink({id:"cancel-button",text:o.Loc.getMessage("BITRIX24_THEME_DIALOG_CANCEL_BUTTON"),className:"popup-window-button-link theme-dialog-button-link",events:{click:()=>{babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].closeDialog()}}})}function Js(){return new l.PopupWindowButtonLink({id:"create-button",text:o.Loc.getMessage("BITRIX24_THEME_DIALOG_NEW_THEME"),className:"popup-window-button-link theme-dialog-button-link theme-dialog-new-theme-btn",events:{click:()=>{this.getNewThemeDialog().show()}}})}function et(){const e=o.Tag.render(ps||(ps=is`
			<div class="theme-dialog-content"></div>
		`));babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].getThemes().forEach((s=>{o.Dom.append(this.createItem(s),e)}));babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].getDialogPopup().setContent(o.Tag.render(vs||(vs=is`
				<div class="theme-dialog-container">${0}</div>
			`),e))}function st(e){const s=babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].getTheme(e);const t={theme:s,themeId:e,setDefaultTheme:babelHelpers.classPrivateFieldLooseBase(this,Os)[Os]()};a.EventEmitter.emit("Intranet.ThemePicker:onSaveTheme",new a.BaseEvent({data:t,compatData:[t]}));const l=new FormData;l.append("action","save");l.append("themeId",e);l.append("setDefaultTheme",babelHelpers.classPrivateFieldLooseBase(this,Os)[Os]());void babelHelpers.classPrivateFieldLooseBase(this,Fs)[Fs](l);babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].setThemeId(e)}function tt(){return o.Tag.render(us||(us=is`
			<div class="theme-dialog-item-default">
				${0}
			</div>
		`),o.Loc.getMessage("BITRIX24_THEME_DEFAULT_THEME"))}function at(){return o.Tag.render(ms||(ms=is`
			<div class="theme-dialog-item-new">
				${0}
			</div>
		`),o.Loc.getMessage("BITRIX24_THEME_NEW_THEME"))}function lt(e){if(!o.Type.isDomNode(e)||!o.Dom.hasClass(e,"theme-dialog-item")){return}const s=e.dataset.themeId;this.getContentContainer().querySelectorAll("div.theme-dialog-item[data-theme-id]").forEach((e=>o.Dom.removeClass(e,"theme-dialog-item-selected")));o.Dom.addClass(e,"theme-dialog-item-selected");if(babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].needReturnValue()){babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].setReturnValue(s)}else{const t=new i.Loader({size:100});t.show(e);this.preloadTheme(s,(async()=>{const a=babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].getTheme(s);if(o.Type.isStringFilled(a.bgImageUrlToBlur)){try{await this.makeCustomThemeBlurred(a)}catch(e){console.error(e)}}if(o.Dom.hasClass(e,"theme-dialog-item-selected")){t.hide();this.applyTheme(s)}}))}}function it(e,s){if(!o.Type.isArray(e)){if(o.Type.isFunction(s)){s()}return}const t=o.Tag.render(gs||(gs=is`<iframe src="javascript:void(0)" style="display: none"></iframe>`));document.body.appendChild(t);const a=t.contentWindow.document;if(!a.body){a.write("<body></body>")}a.body.style.cssText="background: #fff !important";BX.load(e,(()=>{o.Dom.remove(t);if(o.Type.isFunction(s)){s()}}),a)}e.ThemePickerDialog=As})(this.BX.Intranet.Bitrix24.ThemePicker=this.BX.Intranet.Bitrix24.ThemePicker||{},BX.UI,BX.Cache,BX.Event,BX.Main,BX,BX,BX.UI.Uploader);
//# sourceMappingURL=dialog.bundle.map.js