this.BX=this.BX||{};this.BX.Intranet=this.BX.Intranet||{};(function(e,s,t,i,a,l,o,r){"use strict";var n=babelHelpers.classPrivateFieldLooseKey("cache");var d=babelHelpers.classPrivateFieldLooseKey("dialog");var h=babelHelpers.classPrivateFieldLooseKey("getCurrentSlider");var b=babelHelpers.classPrivateFieldLooseKey("handleSliderLoad");var c=babelHelpers.classPrivateFieldLooseKey("handleThemeApply");var p=babelHelpers.classPrivateFieldLooseKey("handleThemeAfterApply");var u=babelHelpers.classPrivateFieldLooseKey("applySliderTheme");var m=babelHelpers.classPrivateFieldLooseKey("resetSliderTheme");var v=babelHelpers.classPrivateFieldLooseKey("getOptions");var P=babelHelpers.classPrivateFieldLooseKey("setVideoEventHandlers");var y=babelHelpers.classPrivateFieldLooseKey("setPrintEventHandlers");var B=babelHelpers.classPrivateFieldLooseKey("loadThemeDialog");var g=babelHelpers.classPrivateFieldLooseKey("getLoader");var f=babelHelpers.classPrivateFieldLooseKey("trySaveBlurredImage");class L{constructor(e){Object.defineProperty(this,f,{value:j});Object.defineProperty(this,g,{value:O});Object.defineProperty(this,B,{value:x});Object.defineProperty(this,y,{value:E});Object.defineProperty(this,P,{value:D});Object.defineProperty(this,v,{value:S});Object.defineProperty(this,m,{value:I});Object.defineProperty(this,u,{value:C});Object.defineProperty(this,p,{value:T});Object.defineProperty(this,c,{value:w});Object.defineProperty(this,b,{value:H});Object.defineProperty(this,h,{value:F});Object.defineProperty(this,n,{writable:true,value:new t.MemoryCache});Object.defineProperty(this,d,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,n)[n].set("options",{themeId:e.themeId,templateId:e.templateId,appliedThemeId:e.themeId,appliedTheme:s.Type.isPlainObject(e.theme)?e.theme:null,siteId:e.siteId,entityType:e.entityType,entityId:e.entityId,maxUploadSize:s.Type.isNumber(e.maxUploadSize)?e.maxUploadSize:5*1024*1024,ajaxHandlerPath:s.Type.isStringFilled(e.ajaxHandlerPath)?e.ajaxHandlerPath:null,isAdmin:e.isAdmin===true,allowSetDefaultTheme:e.allowSetDefaultTheme===true,isVideo:e.isVideo===true,behaviour:s.Type.isStringFilled(e.behaviour)?e.behaviour:"apply",returnValue:e.behaviour==="return"?e.themeId:null,isBodyClassRemoved:false});if(s.Type.isStringFilled(e==null?void 0:e.theme.bgImageUrlToBlur)){babelHelpers.classPrivateFieldLooseBase(this,f)[f](e.theme)}if(babelHelpers.classPrivateFieldLooseBase(this,v)[v]().isVideo){babelHelpers.classPrivateFieldLooseBase(this,P)[P]()}const a=window!==window.top;if(a){i.EventEmitter.subscribe("SidePanel.Slider:onLoad",babelHelpers.classPrivateFieldLooseBase(this,b)[b].bind(this));i.EventEmitter.subscribe("BX.Intranet.Bitrix24:ThemePicker:onThemeApply",babelHelpers.classPrivateFieldLooseBase(this,c)[c].bind(this));i.EventEmitter.subscribe("BX.Intranet.Bitrix24:ThemePicker:onThemeAfterApply",babelHelpers.classPrivateFieldLooseBase(this,p)[p].bind(this))}babelHelpers.classPrivateFieldLooseBase(this,y)[y]()}showDialog(e=true){if(e){window.scrollTo({top:0,left:0})}const s=this.getDialogPopup();if(s.isShown()){return}s.show();babelHelpers.classPrivateFieldLooseBase(this,g)[g]().show(s.getContentContainer());babelHelpers.classPrivateFieldLooseBase(this,B)[B]()}closeDialog(){var e;(e=babelHelpers.classPrivateFieldLooseBase(this,d)[d])==null?void 0:e.close();babelHelpers.classPrivateFieldLooseBase(this,d)[d]=null;this.getDialogPopup().close()}enableThemeListDialog(){s.Dom.removeClass(this.getDialogPopup().popupContainer,"theme-dialog-popup-window-container-disabled")}disableThemeListDialog(){s.Dom.addClass(this.getDialogPopup().popupContainer,"theme-dialog-popup-window-container-disabled")}getDialogPopup(){return babelHelpers.classPrivateFieldLooseBase(this,n)[n].remember("dialogPopup",(()=>new a.Popup({width:800,height:500,titleBar:s.Loc.getMessage("BITRIX24_THEME_DIALOG_TITLE"),fixed:true,closeByEsc:true,cacheable:false,bindOnResize:false,closeIcon:true,draggable:true,events:{onAfterClose:()=>{this.closeDialog()},onDestroy:()=>{babelHelpers.classPrivateFieldLooseBase(this,n)[n].delete("dialogPopup")}}})))}hideLoader(){babelHelpers.classPrivateFieldLooseBase(this,g)[g]().hide()}getTemplateId(){return babelHelpers.classPrivateFieldLooseBase(this,v)[v]().templateId}getSiteId(){return babelHelpers.classPrivateFieldLooseBase(this,v)[v]().siteId}getEntityType(){return babelHelpers.classPrivateFieldLooseBase(this,v)[v]().entityType}getEntityId(){return babelHelpers.classPrivateFieldLooseBase(this,v)[v]().entityId}getAjaxHandlerPath(){return babelHelpers.classPrivateFieldLooseBase(this,v)[v]().ajaxHandlerPath}getVideoElement(){return document.querySelector(".theme-video")}getMaxUploadSize(){return babelHelpers.classPrivateFieldLooseBase(this,v)[v]().maxUploadSize}isCurrentUserAdmin(){return babelHelpers.classPrivateFieldLooseBase(this,v)[v]().isAdmin}canSetDefaultTheme(){return babelHelpers.classPrivateFieldLooseBase(this,v)[v]().allowSetDefaultTheme}getThemeId(){return babelHelpers.classPrivateFieldLooseBase(this,v)[v]().themeId}setThemeId(e){const s=babelHelpers.classPrivateFieldLooseBase(this,v)[v]();s.themeId=e}getAppliedThemeId(){return babelHelpers.classPrivateFieldLooseBase(this,v)[v]().appliedThemeId}setAppliedThemeId(e){const s=babelHelpers.classPrivateFieldLooseBase(this,v)[v]();s.appliedThemeId=e}getAppliedTheme(){return babelHelpers.classPrivateFieldLooseBase(this,v)[v]().appliedTheme}setThemes(e){if(s.Type.isArray(e)){babelHelpers.classPrivateFieldLooseBase(this,n)[n].set("themes",e)}}getThemes(){return babelHelpers.classPrivateFieldLooseBase(this,n)[n].get("themes",[])}setBaseThemes(e){if(s.Type.isPlainObject(e)){babelHelpers.classPrivateFieldLooseBase(this,n)[n].set("baseTheme",e)}}getBaseThemes(){return babelHelpers.classPrivateFieldLooseBase(this,n)[n].get("baseTheme",{})}getTheme(e){const s=this.getThemes();for(const t of s){if(t.id===e){return t}}return null}removeTheme(e){this.setThemes(this.getThemes().filter((s=>s.id!==e)))}updateTheme(e,t){const i=this.getThemes();const a=i.findIndex((s=>s.id===e));if(a===-1||!s.Type.isPlainObject(t)){return}for(const[e,s]of Object.entries(t)){i[a][e]=s}}setReturnValue(e){const s=babelHelpers.classPrivateFieldLooseBase(this,v)[v]();s.returnValue=e}getReturnValue(){return babelHelpers.classPrivateFieldLooseBase(this,v)[v]().returnValue}needReturnValue(){return babelHelpers.classPrivateFieldLooseBase(this,v)[v]().behaviour==="return"}shouldPlayVideo(){const e=window!==window.top;if(e){return r.SidePanel.Instance.getSliderByWindow(window)===r.SidePanel.Instance.getTopSlider()}return!r.SidePanel.Instance.isOpen()}playVideo(){const e=this.getVideoElement();if(e){e.play().catch((()=>{}))}}pauseVideo(){const e=this.getVideoElement();if(e){e.pause()}}handleWindowFocus(){if(this.shouldPlayVideo()){this.playVideo()}}handleWindowBlur(){this.pauseVideo()}handleSliderOpen(){this.handleWindowBlur()}handleSliderClose(){this.handleWindowFocus()}handleVisibilityChange(){const e=this.getVideoElement();if(e){if(document.visibilityState==="hidden"){this.handleWindowBlur()}else{this.handleWindowFocus()}}}handleBeforePrint(e){window.scroll(0,0);if(s.Dom.hasClass(document.body,"bitrix24-light-theme")){s.Dom.removeClass(document.body,"bitrix24-light-theme");babelHelpers.classPrivateFieldLooseBase(this,v)[v]().isBodyClassRemoved=true}const t=["--ui-context-edge-dark","--ui-context-edge-light","--ui-context-content-dark"];t.forEach((e=>{if(s.Dom.hasClass(document.body,e)){s.Dom.removeClass(document.body,e);babelHelpers.classPrivateFieldLooseBase(this,v)[v]().removedContextClassname=e}}));if(babelHelpers.classPrivateFieldLooseBase(this,v)[v]().removedContextClassname){s.Dom.addClass(document.body,"--ui-context-content-light")}}handleAfterPrint(){if(babelHelpers.classPrivateFieldLooseBase(this,v)[v]().isBodyClassRemoved){s.Dom.addClass(document.body,"bitrix24-light-theme");babelHelpers.classPrivateFieldLooseBase(this,v)[v]().isBodyClassRemoved=false}if(babelHelpers.classPrivateFieldLooseBase(this,v)[v]().removedContextClassname){s.Dom.removeClass(document.body,"ui-context-content-light");s.Dom.addClass(document.body,babelHelpers.classPrivateFieldLooseBase(this,v)[v]().removedContextClassname);babelHelpers.classPrivateFieldLooseBase(this,v)[v]().removedContextClassname=null}}handleMediaPrint(e){if(e.matches){this.handleBeforePrint()}else{this.handleAfterPrint()}}getVideoContainer(){return document.querySelector(".theme-video-container")}}function F(){const e=s.Reflection.getClass("top.BX.SidePanel.Instance");if(e===null){return null}return e.getSliderByWindow(window)}function H(){babelHelpers.classPrivateFieldLooseBase(this,u)[u]()}function w(){babelHelpers.classPrivateFieldLooseBase(this,m)[m]()}function T(){babelHelpers.classPrivateFieldLooseBase(this,u)[u]()}function C(){const e=babelHelpers.classPrivateFieldLooseBase(this,h)[h]();if(e===null){return}const t=s.Dom.style(document.body,"--air-theme-background");if(s.Type.isStringFilled(t)){s.Dom.style(e.getContentContainer(),"background",t);s.Dom.style(document.body,"--air-theme-background","transparent")}else{s.Dom.style(e.getContentContainer(),"background",null)}}function I(){const e=babelHelpers.classPrivateFieldLooseBase(this,h)[h]();if(e===null){return}s.Dom.style(document.body,"--air-theme-background",null);s.Dom.style(e.getContentContainer(),"background",null)}function S(){return babelHelpers.classPrivateFieldLooseBase(this,n)[n].get("options",{})}function D(){s.Event.bind(window,"focus",this.handleWindowFocus.bind(this));s.Event.bind(window,"blur",this.handleWindowBlur.bind(this));i.EventEmitter.subscribe("OnIframeFocus",this.handleWindowFocus.bind(this));i.EventEmitter.subscribe("SidePanel.Slider:onOpenComplete",this.handleSliderOpen.bind(this));i.EventEmitter.subscribe("SidePanel.Slider:onCloseComplete",this.handleSliderClose.bind(this));const e=this.handleVisibilityChange.bind(this);s.Event.bind(window,"load",e);s.Event.bind(document,"visibilitychange",e)}function E(){if("onbeforeprint"in window){s.Event.bind(window,"beforeprint",this.handleBeforePrint.bind(this));s.Event.bind(window,"afterprint",this.handleAfterPrint.bind(this))}else if(window.matchMedia){window.matchMedia("print").addListener(this.handleMediaPrint.bind(this))}}function x(){s.Runtime.loadExtension("intranet.theme-picker.dialog").then((e=>{var s,t;const{ThemePickerDialog:i}=e;(t=(s=babelHelpers.classPrivateFieldLooseBase(this,d))[d])!=null?t:s[d]=new i(this);babelHelpers.classPrivateFieldLooseBase(this,d)[d].show()})).catch((e=>{console.error(e)}))}function O(){return babelHelpers.classPrivateFieldLooseBase(this,n)[n].remember("loader",(()=>new o.Loader({size:120})))}function j(e){const t=async()=>{try{const{ThemePickerDialog:t}=await s.Runtime.loadExtension("intranet.theme-picker.dialog");const i=new t(this);await i.makeCustomThemeBlurred(e,{ignoreErrors:true,applyTheme:true});await new Promise((()=>{}))}catch(e){console.error(e)}};if(window.navigator.locks){window.navigator.locks.request("save-blurred-image",t)}else{void t()}}e.ThemePicker=L})(this.BX.Intranet.Bitrix24=this.BX.Intranet.Bitrix24||{},BX,BX.Cache,BX.Event,BX.Main,BX.Intranet.Bitrix24.ThemePicker,BX,BX.SidePanel);
//# sourceMappingURL=theme-picker.bundle.map.js