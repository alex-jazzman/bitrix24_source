this.BX=this.BX||{};this.BX.Bizproc=this.BX.Bizproc||{};(function(e,s,i,t,a,l,r,o,c,n){"use strict";var d=babelHelpers.classPrivateFieldLooseKey("data");class p{constructor(e){Object.defineProperty(this,d,{writable:true,value:{}});if(c.Type.isPlainObject(e)){babelHelpers.classPrivateFieldLooseBase(this,d)[d]=e}}canView(){return c.Type.isBoolean(babelHelpers.classPrivateFieldLooseBase(this,d)[d].canView)?babelHelpers.classPrivateFieldLooseBase(this,d)[d].canView:false}get status(){return new n.TaskStatus(babelHelpers.classPrivateFieldLooseBase(this,d)[d].status)}get id(){return c.Type.isInteger(babelHelpers.classPrivateFieldLooseBase(this,d)[d].id)?babelHelpers.classPrivateFieldLooseBase(this,d)[d].id:0}get name(){return c.Type.isString(babelHelpers.classPrivateFieldLooseBase(this,d)[d].name)?babelHelpers.classPrivateFieldLooseBase(this,d)[d].name:""}get modified(){return c.Type.isInteger(babelHelpers.classPrivateFieldLooseBase(this,d)[d].modified)?Math.max(babelHelpers.classPrivateFieldLooseBase(this,d)[d].modified,0):0}get users(){return c.Type.isArray(babelHelpers.classPrivateFieldLooseBase(this,d)[d].users)?babelHelpers.classPrivateFieldLooseBase(this,d)[d].users:[]}get executionTime(){return c.Type.isInteger(babelHelpers.classPrivateFieldLooseBase(this,d)[d].executionTime)?Math.max(babelHelpers.classPrivateFieldLooseBase(this,d)[d].executionTime,0):null}get approveType(){return c.Type.isString(babelHelpers.classPrivateFieldLooseBase(this,d)[d].approveType)?babelHelpers.classPrivateFieldLooseBase(this,d)[d].approveType:""}get url(){return c.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,d)[d].url)?babelHelpers.classPrivateFieldLooseBase(this,d)[d].url:null}}let b=e=>e,v,u,L,P,f,h,F,m,I,B,_,O,E,T,H,R,g,w;var y=babelHelpers.classPrivateFieldLooseKey("getFormatString");class S{static formatTimestamp(e){return o.DateTimeFormat.format(babelHelpers.classPrivateFieldLooseBase(this,y)[y](Date.now()/1e3-e),e)}static formatTimeInterval(e){if(c.Type.isNil(e)){return c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_AVERAGE_PROCESS_TIME_UNKNOWN")}if(e===0){return c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_ZERO_SECOND_INTERVAL")}return o.DateTimeFormat.format(babelHelpers.classPrivateFieldLooseBase(this,y)[y](e),0,e)}static formatDate(e,s){return o.DateTimeFormat.format(s,e)}}function M(e){const s=[[3600*24*366,"Ydiff"],[3600*24*31,"mdiff"],[3600*24,"ddiff"],[3600,"Hdiff"],[60,"idiff"]];for(const i of s){if(e>i[0]){return i[1]}}return"sdiff"}Object.defineProperty(S,y,{value:M});var k=babelHelpers.classPrivateFieldLooseKey("workflowId");var N=babelHelpers.classPrivateFieldLooseKey("data");var W=babelHelpers.classPrivateFieldLooseKey("isLoaded");var D=babelHelpers.classPrivateFieldLooseKey("errors");var K=babelHelpers.classPrivateFieldLooseKey("container");var C=babelHelpers.classPrivateFieldLooseKey("biPopup");var z=babelHelpers.classPrivateFieldLooseKey("dateFormat");var j=babelHelpers.classPrivateFieldLooseKey("loadTimeline");var $=babelHelpers.classPrivateFieldLooseKey("setDataFromResponse");var x=babelHelpers.classPrivateFieldLooseKey("renderHTMLElements");var Z=babelHelpers.classPrivateFieldLooseKey("renderItemTitle");var A=babelHelpers.classPrivateFieldLooseKey("renderSubject");var X=babelHelpers.classPrivateFieldLooseKey("renderProceedTaskButton");var U=babelHelpers.classPrivateFieldLooseKey("renderUser");var V=babelHelpers.classPrivateFieldLooseKey("renderDoc");var G=babelHelpers.classPrivateFieldLooseKey("renderCaption");var Y=babelHelpers.classPrivateFieldLooseKey("renderNotice");var q=babelHelpers.classPrivateFieldLooseKey("renderStatus");var Q=babelHelpers.classPrivateFieldLooseKey("renderMore");var J=babelHelpers.classPrivateFieldLooseKey("renderContent");var ee=babelHelpers.classPrivateFieldLooseKey("renderItem");var se=babelHelpers.classPrivateFieldLooseKey("renderUserList");var ie=babelHelpers.classPrivateFieldLooseKey("renderVoteCaption");var te=babelHelpers.classPrivateFieldLooseKey("renderItemsList");var ae=babelHelpers.classPrivateFieldLooseKey("renderFirstBlock");var le=babelHelpers.classPrivateFieldLooseKey("renderContainer");var re=babelHelpers.classPrivateFieldLooseKey("textCrop");var oe=babelHelpers.classPrivateFieldLooseKey("createEfficiencyPopup");var ce=babelHelpers.classPrivateFieldLooseKey("getEfficiencyData");var ne=babelHelpers.classPrivateFieldLooseKey("renderEfficiencyInlineContent");var de=babelHelpers.classPrivateFieldLooseKey("renderEfficiencyPopupContent");var pe=babelHelpers.classPrivateFieldLooseKey("getBiPopup");var be=babelHelpers.classPrivateFieldLooseKey("createBiPopup");var ve=babelHelpers.classPrivateFieldLooseKey("renderBiPopupContent");var ue=babelHelpers.classPrivateFieldLooseKey("renderLoadingStub");var Le=babelHelpers.classPrivateFieldLooseKey("renderErrors");var Pe=babelHelpers.classPrivateFieldLooseKey("hasErrors");class fe{constructor(e,s){Object.defineProperty(this,Pe,{value:Ue});Object.defineProperty(this,Le,{value:Xe});Object.defineProperty(this,ue,{value:Ae});Object.defineProperty(this,ve,{value:Ze});Object.defineProperty(this,be,{value:xe});Object.defineProperty(this,pe,{value:$e});Object.defineProperty(this,de,{value:je});Object.defineProperty(this,ne,{value:ze});Object.defineProperty(this,ce,{value:Ce});Object.defineProperty(this,oe,{value:Ke});Object.defineProperty(this,re,{value:De});Object.defineProperty(this,le,{value:We});Object.defineProperty(this,ae,{value:Ne});Object.defineProperty(this,te,{value:ke});Object.defineProperty(this,ie,{value:Me});Object.defineProperty(this,se,{value:Se});Object.defineProperty(this,ee,{value:ye});Object.defineProperty(this,J,{value:we});Object.defineProperty(this,Q,{value:ge});Object.defineProperty(this,q,{value:Re});Object.defineProperty(this,Y,{value:He});Object.defineProperty(this,G,{value:Te});Object.defineProperty(this,V,{value:Ee});Object.defineProperty(this,U,{value:Oe});Object.defineProperty(this,X,{value:_e});Object.defineProperty(this,A,{value:Be});Object.defineProperty(this,Z,{value:Ie});Object.defineProperty(this,x,{value:me});Object.defineProperty(this,$,{value:Fe});Object.defineProperty(this,j,{value:he});Object.defineProperty(this,k,{writable:true,value:void 0});Object.defineProperty(this,N,{writable:true,value:void 0});Object.defineProperty(this,W,{writable:true,value:void 0});Object.defineProperty(this,D,{writable:true,value:[]});Object.defineProperty(this,K,{writable:true,value:void 0});Object.defineProperty(this,C,{writable:true,value:void 0});Object.defineProperty(this,z,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,K)[K]=babelHelpers.classPrivateFieldLooseBase(this,le)[le]();setTimeout((()=>{babelHelpers.classPrivateFieldLooseBase(this,re)[re]()}),500);if(c.Type.isPlainObject(e)){babelHelpers.classPrivateFieldLooseBase(this,k)[k]=e.workflowId;babelHelpers.classPrivateFieldLooseBase(this,W)[W]=false;babelHelpers.classPrivateFieldLooseBase(this,j)[j]()}if(c.Type.isPlainObject(s)){babelHelpers.classPrivateFieldLooseBase(this,z)[z]=`${s.dateFormat||"j F Y"} ${s.timeFormat||"H:i"}`}}static open(e){c.Runtime.loadExtension("sidepanel").then((()=>{BX.SidePanel.Instance.open(c.Uri.addParam("/bitrix/components/bitrix/bizproc.workflow.timeline.slider/index.php",c.Type.isPlainObject(e)?e:{}),{width:950,allowChangeHistory:false,cacheable:false,loader:"/bitrix/js/bizproc/workflow/timeline/img/skeleton.svg"})})).catch((e=>console.error(e.errors)))}render(){c.Dom.clean(babelHelpers.classPrivateFieldLooseBase(this,K)[K]);if(!babelHelpers.classPrivateFieldLooseBase(this,W)[W]||babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]()){c.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,Le)[Le](),babelHelpers.classPrivateFieldLooseBase(this,K)[K]);c.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,ue)[ue](),babelHelpers.classPrivateFieldLooseBase(this,K)[K])}if(c.Type.isPlainObject(babelHelpers.classPrivateFieldLooseBase(this,N)[N])){c.Dom.replace(babelHelpers.classPrivateFieldLooseBase(this,K)[K],babelHelpers.classPrivateFieldLooseBase(this,le)[le]());babelHelpers.classPrivateFieldLooseBase(this,oe)[oe]().show()}return babelHelpers.classPrivateFieldLooseBase(this,K)[K]}getStatusName(e){if(e.isYes()||e.isOk()){return c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_PERFORMED")}if(e.isNo()||e.isCancel()){return c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_DECLINED")}if(e.isWaiting()){return c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_PERFORMING")}return e.name}showBiPopup(){babelHelpers.classPrivateFieldLooseBase(this,pe)[pe]().show()}}function he(){c.ajax.runAction("bizproc.workflow.getTimeline",{data:{workflowId:babelHelpers.classPrivateFieldLooseBase(this,k)[k]}}).then((e=>{babelHelpers.classPrivateFieldLooseBase(this,$)[$](e);babelHelpers.classPrivateFieldLooseBase(this,W)[W]=true;this.render()})).catch((e=>{babelHelpers.classPrivateFieldLooseBase(this,$)[$](e);babelHelpers.classPrivateFieldLooseBase(this,W)[W]=true;this.render()}))}function Fe(e){if(c.Type.isPlainObject(e)){const i=(e,s="")=>c.Type.isString(e)?e:s;const t=(e,s=[])=>c.Type.isArray(e)?e:s;const a=(e,s=false)=>c.Type.isBoolean(e)?e:s;const l=(e,s=0)=>c.Type.isInteger(e)?e:s;if(c.Type.isPlainObject(e.data)){babelHelpers.classPrivateFieldLooseBase(this,N)[N]={document:new s.DocumentId({documentId:t(e.data.documentType),entityName:i(e.data.entityName),documentName:i(e.data.documentName),documentUrl:i(e.data.documentUrl),moduleName:i(e.data.moduleName)}),isWorkflowRunning:a(e.data.isWorkflowRunning),timeToStart:l(e.data.timeToStart,null),executionTime:l(e.data.executionTime,null),started:l(e.data.started,null),startedBy:l(e.data.startedBy),tasks:t(e.data.tasks).map((e=>new p(e))),users:new Map,stats:{averageDuration:l(e.data.stats.averageDuration,null),efficiency:i(e.data.stats.efficiency)}};for(const s of t(e.data.users)){babelHelpers.classPrivateFieldLooseBase(this,N)[N].users.set(c.Text.toInteger(s.id),s)}}babelHelpers.classPrivateFieldLooseBase(this,D)[D]=t(e.errors)}}function me(e){let s="";e.forEach((e=>{s+=e.outerHTML}));return s}function Ie(e,s,i,t){const a=c.Type.isString(s)?` ${s}`:"";const l=c.Type.isString(i)?i:"";const r=t?' data-crop="crop"':"";return c.Tag.render(v||(v=b`
			<div>
				<span class="bizproc-workflow-timeline-icon${0}">${0}</span>
				<div class="bizproc-workflow-timeline-title"${0}>${0}</div>
			</div>
		`),a,l,r,c.Text.encode(e))}function Be(e){return c.Tag.render(u||(u=b`
			<div class="bizproc-workflow-timeline-subject">${0}</div>
		`),c.Text.encode(e))}function _e(e){const s=e.url||new c.Uri("/bitrix/components/bitrix/bizproc.workflow.info/").setQueryParams({workflow:babelHelpers.classPrivateFieldLooseBase(this,k)[k],task:e.id}).toString();return c.Tag.render(L||(L=b`
			<div class="task-button --hidden">
				<a class="ui-btn ui-btn-xs ui-btn-primary ui-btn-round" href="${0}">
					${0}
				</a>
			</div>
		`),c.Text.encode(s),c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_BUTTON_PROCEED"))}function Oe(e,s=null,i=null){const t=babelHelpers.classPrivateFieldLooseBase(this,N)[N].users.get(e||s.id);let a="";let l=false;if(s){const e=new n.TaskStatus(s.status);if(e.isYes()||e.isOk()){a=" --voted-up"}if(e.isNo()){a=" --voted-down"}if(e.isWaiting()){l=true}}const r=c.Type.isString(t.workPosition)?`<div class="bizproc-workflow-timeline-user-pos">${c.Text.encode(t.workPosition)}</div>`:"";let o="<i></i>";if(c.Type.isString(t.avatarSize100)){o=`<i style="background-image: url('${t.avatarSize100}')"></i>`}const d=i!=null&&i.id&&l?babelHelpers.classPrivateFieldLooseBase(this,X)[X](i):"";return c.Tag.render(P||(P=b`
			<div class="bizproc-workflow-timeline-user${0}">
				<div class="bizproc-workflow-timeline-userlogo ui-icon ui-icon-common-user">
					${0}
				</div>
				<div class="bizproc-workflow-timeline-user-block">
					<a class="bizproc-workflow-timeline-link" href="${0}">${0}</a>
					${0}
				</div>
				${0}
			</div>
		`),a,o,t.link,c.Text.encode(t.fullName),r,d)}function Ee(e,s,i,t){return c.Tag.render(f||(f=b`
			<div class="bizproc-workflow-timeline-doc">
				${0}
				<div class="bizproc-workflow-timeline-type">
					<span class="ui-icon-set ${0}"></span>
					<span class="bizproc-workflow-timeline-type-text">${0}</span>
				</div>
				<a class="bizproc-workflow-timeline-link" href="${0}" target="_top">${0}</a>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,G)[G](c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_START_DOC")),t,i,s,c.Text.encode(e))}function Te(e){return c.Tag.render(h||(h=b`
			<div class="bizproc-workflow-timeline-caption">${0}</div>
		`),e)}function He(e,s){return c.Tag.render(F||(F=b`
			<div class="bizproc-workflow-timeline-notice">
				<div class="bizproc-workflow-timeline-subject">${0}</div>
				<span class="bizproc-workflow-timeline-text">${0}</span>
			</div>
		`),c.Text.encode(e),c.Text.encode(s))}function Re(e,s){const i=c.Type.isString(s)?` ${s}`:"";return c.Tag.render(m||(m=b`
			<div class="bizproc-workflow-timeline-status${0}">${0}</div>
		`),i,c.Text.encode(e))}function ge(){return c.Tag.render(I||(I=b`
			<div class="bizproc-workflow-timeline-item --more">
				<div class="bizproc-workflow-timeline-item-inner">
					<span class="bizproc-workflow-timeline-icon"></span>
					<button class="ui-btn ui-btn-light-border ui-btn-xs" type="button" onclick="expandMore(event)">
						<span class="ui-btn-text">
							${0}
						</span>
					</button>
					<script type="text/javascript">
						function expandMore(event)
						{
							const moreItemBlock = event.target.closest('.--more');
							const hiddenBlocks = document.querySelectorAll('.bizproc-workflow-timeline-item.--hidden:not(.--efficiency)');
							BX.Dom.addClass(moreItemBlock, '--hidden');
							hiddenBlocks.forEach((hiddenBlock) => BX.Dom.removeClass(hiddenBlock, '--hidden'));
						}
					</script>
				</div>
			</div>
		`),c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_MORE_TASKS"))}function we(e){return c.Tag.render(B||(B=b`
			<div class="bizproc-workflow-timeline-content">
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,x)[x](e))}function ye(e,s,i){const t=c.Type.isString(s)?` ${s}`:"";const a=c.Type.isString(i)?` data-efficiency-class="${i}"`:"";return c.Tag.render(_||(_=b`
			<div class="bizproc-workflow-timeline-item${0}"${0}>
				<div class="bizproc-workflow-timeline-item-inner">
					${0}
				</div>
			</div>
		`),t,a,e)}function Se(e){let s="";if(e.length===1){s=c.Tag.render(O||(O=b`
				<script type="text/javascript">
					(function () {
						for (let userItem of document
							.currentScript
							.closest('.bizproc-workflow-timeline-user-list')
							.querySelectorAll('.bizproc-workflow-timeline-user')
						)
						{
							BX.Dom.removeClass(userItem, ['--voted-up', '--voted-down']);
						}
					}
					)();
				</script>
			`))}return c.Tag.render(E||(E=b`
			<div class="bizproc-workflow-timeline-user-list">
				${0}
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,x)[x](e),s)}function Me(e,s){return babelHelpers.classPrivateFieldLooseBase(this,G)[G](c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_VOTED",{"#VOTED#":e,"#TOTAL#":s}))}function ke(e){return c.Tag.render(T||(T=b`
			<div class="bizproc-workflow-timeline-wrapper">
				<div class="bizproc-workflow-timeline-inner">
					<div class="bizproc-workflow-timeline-list">
						${0}
					</div>
					<script type="text/javascript">
						(function() {
							const buttons = document.querySelectorAll('.task-button.--hidden');
							const showButtons = buttons.length > 1;
							buttons.forEach(function (button) {
								BX.Dom.insertBefore(
									button.closest('.bizproc-workflow-timeline-user'),
									button.closest('.bizproc-workflow-timeline-user-list').firstChild
								);
								if (showButtons)
								{
									BX.Dom.removeClass(button, '--hidden')									
								}
							});
						})();
					</script>
				</div>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,x)[x](e))}function Ne(){const e=[];if(babelHelpers.classPrivateFieldLooseBase(this,N)[N].startedBy){e.push(babelHelpers.classPrivateFieldLooseBase(this,G)[G](c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_FROM")),babelHelpers.classPrivateFieldLooseBase(this,U)[U](babelHelpers.classPrivateFieldLooseBase(this,N)[N].startedBy))}e.push(babelHelpers.classPrivateFieldLooseBase(this,V)[V](babelHelpers.classPrivateFieldLooseBase(this,N)[N].document.name,babelHelpers.classPrivateFieldLooseBase(this,N)[N].document.url,babelHelpers.classPrivateFieldLooseBase(this,N)[N].document.moduleName,"--file-2"));if(!c.Type.isNil(babelHelpers.classPrivateFieldLooseBase(this,N)[N].timeToStart)){e.push(babelHelpers.classPrivateFieldLooseBase(this,Y)[Y](c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_EXECUTION_TIME"),S.formatTimeInterval(babelHelpers.classPrivateFieldLooseBase(this,N)[N].timeToStart)))}return babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]([babelHelpers.classPrivateFieldLooseBase(this,Z)[Z](babelHelpers.classPrivateFieldLooseBase(this,N)[N].document.entityName,"--success","1"),babelHelpers.classPrivateFieldLooseBase(this,N)[N].started&&babelHelpers.classPrivateFieldLooseBase(this,A)[A](S.formatDate(babelHelpers.classPrivateFieldLooseBase(this,N)[N].started,babelHelpers.classPrivateFieldLooseBase(this,z)[z])),babelHelpers.classPrivateFieldLooseBase(this,J)[J](e)],"--selected")}function We(){const e=[];let s="";let i=false;if(babelHelpers.classPrivateFieldLooseBase(this,N)[N]){let t=1;let a=null;let l=false;let r=c.Loc.getMessage("USER_ID");r=r?parseInt(r,10):null;e.push(babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]());for(const s of Object.keys(babelHelpers.classPrivateFieldLooseBase(this,N)[N].tasks)){a=babelHelpers.classPrivateFieldLooseBase(this,N)[N].tasks[s];let o=null;let d=true;i=a.status.isWaiting();if(a.canView()){const s=[];if(i){if(l){e.push(babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]());l=false}o="--processing";d=false;if(a.approveType==="vote"){let e=0;for(const s of a.users){if(!new n.TaskStatus(s.status).isWaiting()){e++}}s.push(babelHelpers.classPrivateFieldLooseBase(this,ie)[ie](e,a.users.length))}else{s.push(babelHelpers.classPrivateFieldLooseBase(this,G)[G](this.getStatusName(a.status)))}}else{l=true;if(a.status.isOk()||a.status.isYes()){o="--success"}s.push(babelHelpers.classPrivateFieldLooseBase(this,G)[G](this.getStatusName(a.status)))}const p=[];for(const e of Object.values(a.users)){p.push(babelHelpers.classPrivateFieldLooseBase(this,U)[U](null,e,e.id===r?a:null))}if(p.length>0){s.push(babelHelpers.classPrivateFieldLooseBase(this,se)[se](p))}if(!c.Type.isNil(a.executionTime)){s.push(babelHelpers.classPrivateFieldLooseBase(this,Y)[Y](c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_EXECUTION_TIME"),S.formatTimeInterval(a.executionTime)))}e.push(babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]([babelHelpers.classPrivateFieldLooseBase(this,Z)[Z](a.name,o,d?(++t).toString():null),babelHelpers.classPrivateFieldLooseBase(this,A)[A](S.formatDate(a.modified,babelHelpers.classPrivateFieldLooseBase(this,z)[z])),babelHelpers.classPrivateFieldLooseBase(this,J)[J](s)],i?"--processing":"--hidden"))}else{let s="--tech";if(i&&babelHelpers.classPrivateFieldLooseBase(this,N)[N].tasks.length>1){s+=" --hidden";l=true}e.push(babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]([babelHelpers.classPrivateFieldLooseBase(this,Z)[Z](c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_NO_RIGHTS_TO_VIEW")),babelHelpers.classPrivateFieldLooseBase(this,A)[A](c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_NO_RIGHTS_TO_VIEW_TIP"))],s))}}if(l){e.push(babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]())}if(babelHelpers.classPrivateFieldLooseBase(this,N)[N].isWorkflowRunning){if(i){e.push(babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]([babelHelpers.classPrivateFieldLooseBase(this,Z)[Z](c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_IN_PROGRESS")),babelHelpers.classPrivateFieldLooseBase(this,A)[A](c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_IN_PROGRESS_TIP"))],"--tech --previous-item"))}else{e.push(babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]([babelHelpers.classPrivateFieldLooseBase(this,Z)[Z](c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_IN_PROGRESS_INTERMEDIATE")),babelHelpers.classPrivateFieldLooseBase(this,A)[A](c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_IN_PROGRESS_INTERMEDIATE_TIP"))],"--tech --previous-item"))}}else{const i=!a||a.status.isOk()||a.status.isYes();const t=[babelHelpers.classPrivateFieldLooseBase(this,G)[G](c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_PROCESS_FINISHED"))];if(babelHelpers.classPrivateFieldLooseBase(this,N)[N].startedBy){t.push(i?babelHelpers.classPrivateFieldLooseBase(this,q)[q](c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_APPROVED_FOR")):babelHelpers.classPrivateFieldLooseBase(this,q)[q](c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_DECLINED"),"--failure"),babelHelpers.classPrivateFieldLooseBase(this,U)[U](babelHelpers.classPrivateFieldLooseBase(this,N)[N].startedBy))}t.push(babelHelpers.classPrivateFieldLooseBase(this,Y)[Y](c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_PROCESS_EXECUTED"),S.formatTimeInterval(babelHelpers.classPrivateFieldLooseBase(this,N)[N].executionTime)));s=i?"--success":"--declined";e.push(babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]([babelHelpers.classPrivateFieldLooseBase(this,Z)[Z](babelHelpers.classPrivateFieldLooseBase(this,N)[N].document.entityName,i?"--success":null),babelHelpers.classPrivateFieldLooseBase(this,N)[N].started&&babelHelpers.classPrivateFieldLooseBase(this,A)[A](S.formatDate(babelHelpers.classPrivateFieldLooseBase(this,N)[N].started+babelHelpers.classPrivateFieldLooseBase(this,N)[N].executionTime,babelHelpers.classPrivateFieldLooseBase(this,z)[z])),babelHelpers.classPrivateFieldLooseBase(this,J)[J](t)],i?"--success --previous":"--declined --selected --previous",s),babelHelpers.classPrivateFieldLooseBase(this,ne)[ne]())}}return babelHelpers.classPrivateFieldLooseBase(this,te)[te](e)}function De(){const e=document.querySelectorAll('[data-crop="crop"]');for(const s of e){const e=new l.TextCrop({rows:2,target:s});e.init()}}function Ke(){return new r.Popup({width:403,minHeight:345,closeIcon:true,content:babelHelpers.classPrivateFieldLooseBase(this,de)[de](),bindElement:{left:555,top:130},padding:26,borderRadius:"18px",className:"--bizproc-timeline-popup",events:{onPopupClose:()=>{let e=document.querySelector(".--previous-item");if(!e){e=document.querySelector(".bizproc-workflow-timeline-item.--processing")}if(!e){return}BX.Dom.addClass(e,"--previous");let s=e.getAttribute("data-efficiency-class");if(!s){s=""}e.after(babelHelpers.classPrivateFieldLooseBase(this,ne)[ne](s))}}})}function Ce(){let e="--first";let s=c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_NO_STATS");switch(babelHelpers.classPrivateFieldLooseBase(this,N)[N].stats.efficiency){case"fast":if(S.formatTimeInterval(babelHelpers.classPrivateFieldLooseBase(this,N)[N].stats.averageDuration)===S.formatTimeInterval(babelHelpers.classPrivateFieldLooseBase(this,N)[N].executionTime)){e="--slow";s=c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_PERFORMED_SLOWLY")}else{e="--fast";s=c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_PERFORMED_QUICKLY")}break;case"slow":e="--slow";s=c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_PERFORMED_SLOWLY");break;case"stopped":e="--stopped";s=c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_PERFORMED_NO_PROGRESS");break;default:break}return[e,s]}function ze(e){const[s,i]=babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]();return c.Tag.render(H||(H=b`
			<div class="bizproc-workflow-timeline-item --efficiency ${0}">
				<div class="bizproc-workflow-timeline-item-inner">
					<div class="bizproc-workflow-timeline-title">
						${0}
					</div>
					<div class="bizproc-workflow-timeline-content">
						<div class="bizproc-workflow-timeline-eff-icon ${0}"></div>
						<div class="bizproc-workflow-timeline-content-inner">
							<div class="bizproc-workflow-timeline-caption">${0}</div>
							<div class="bizproc-workflow-timeline-notice">
								<div class="bizproc-workflow-timeline-subject">
									${0}
								</div>
								<span class="bizproc-workflow-timeline-text">
									${0}
								</span>
							</div>
							<div class="bizproc-workflow-timeline-notice">
								<div class="bizproc-workflow-timeline-subject">
									${0}
								</div>
								<span class="bizproc-workflow-timeline-text">
									${0}
								</span>
							</div>
						</div>
					</div>
				</div>	
			</div>
		`),e,c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_EFFECTIVITY_MARK"),s,i,c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_CURRENT_PROCESS_TIME"),S.formatTimeInterval(babelHelpers.classPrivateFieldLooseBase(this,N)[N].executionTime),c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_AVERAGE_PROCESS_TIME"),babelHelpers.classPrivateFieldLooseBase(this,N)[N].stats.averageDuration===null?c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_AVERAGE_PROCESS_TIME_UNKNOWN"):S.formatTimeInterval(babelHelpers.classPrivateFieldLooseBase(this,N)[N].stats.averageDuration))}function je(){const[e,s]=babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]();return c.Tag.render(R||(R=b`
			<div class="bizproc-timeline-popup">
				<div class="bizproc-timeline-popup-title">
					${0}
				</div>
				<div class="bizproc-timeline-popup-main">
					<div class="bizproc-timeline-popup-status">
						<div class="bizproc-timeline-popup-logo ${0}"></div>
						<div class="bizproc-timeline-popup-notice">${0}</div>
					</div>
					<div class="bizproc-timeline-popup-content">
						<div class="bizproc-timeline-popup-block">
							<span class="bizproc-timeline-popup-val">
								${0}
							</span>
							<div class="bizproc-timeline-popup-prop">
								${0}
							</div>
						</div>
						<div class="bizproc-timeline-popup-block">
							<span class="bizproc-timeline-popup-val">
								${0}
							</span>
							<div class="bizproc-timeline-popup-prop">
								${0}
							</div>
						</div>
					</div>
				</div>
				<div class="bizproc-timeline-popup-footer">
					<p class="bizproc-timeline-popup-text">
						${0}
					</p>
					<a class="bizproc-timeline-popup-text" href="javascript:top.BX.Helper.show('redirect=detail&code=18783714')">
						${0}
					</a>
				</div>
			</div>
		`),c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_EFFECTIVITY_MARK"),e,s,S.formatTimeInterval(babelHelpers.classPrivateFieldLooseBase(this,N)[N].executionTime),c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_CURRENT_PROCESS_TIME"),S.formatTimeInterval(babelHelpers.classPrivateFieldLooseBase(this,N)[N].stats.averageDuration),c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_AVERAGE_PROCESS_TIME"),c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_PERFORMANCE_TUNING_TIP"),c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_PERFORMANCE_TUNING_LINK"))}function $e(){if(!babelHelpers.classPrivateFieldLooseBase(this,C)[C]){return babelHelpers.classPrivateFieldLooseBase(this,be)[be]()}return babelHelpers.classPrivateFieldLooseBase(this,C)[C]}function xe(){babelHelpers.classPrivateFieldLooseBase(this,C)[C]=new r.Popup({width:403,minHeight:183,closeIcon:true,content:babelHelpers.classPrivateFieldLooseBase(this,ve)[ve](),bindElement:{left:207,top:482},padding:17,borderRadius:"18px",className:"--bizproc-timeline-popup --bi"});return babelHelpers.classPrivateFieldLooseBase(this,C)[C]}function Ze(){return c.Tag.render(g||(g=b`
			<div class="bizproc-timeline-popup">
				<div class="bizproc-timeline-popup-title">${0}</div>
				<p class="bizproc-timeline-popup-info">${0}</p>
				<button class="ui-btn ui-btn-light-border ui-btn-round ui-btn-xs">
					<span class="ui-btn-text">${0}</span>
				</button>
			</div>
		`),c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_BI_ANALYTICS_TITLE"),c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_BI_ANALYTICS_TIP"),c.Loc.getMessage("BIZPROC_WORKFLOW_TIMELINE_SLIDER_BI_ANALYTICS_LINK"))}function Ae(){return c.Tag.render(w||(w=b`
			<img src="/bitrix/js/bizproc/workflow/timeline/img/skeleton.svg"
				 style="width:100%; margin: 0; padding: 0;"/>
		`))}function Xe(){const e=c.Dom.create("div");for(const s of babelHelpers.classPrivateFieldLooseBase(this,D)[D]){const i=new t.Alert({text:c.Text.encode(s.message),color:t.AlertColor.DANGER,closeBtn:true,animated:true});i.renderTo(e)}return e}function Ue(){return babelHelpers.classPrivateFieldLooseBase(this,D)[D].length>0}e.DurationFormatter=S;e.Timeline=fe})(this.BX.Bizproc.Workflow=this.BX.Bizproc.Workflow||{},BX.Bizproc,BX.Bizproc,BX.UI,BX,BX.UI,BX.Main,BX.Main,BX,BX.Bizproc);
//# sourceMappingURL=timeline.bundle.map.js