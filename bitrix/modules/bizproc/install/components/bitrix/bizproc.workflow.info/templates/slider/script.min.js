this.BX=this.BX||{};this.BX.Bizproc=this.BX.Bizproc||{};(function(e,t,s,a,o,i){"use strict";var n=babelHelpers.classPrivateFieldLooseKey("renderButtons");var r=babelHelpers.classPrivateFieldLooseKey("handleTaskButtonClick");var l=babelHelpers.classPrivateFieldLooseKey("handleDelegateButtonClick");var d=babelHelpers.classPrivateFieldLooseKey("delegateTask");var c=babelHelpers.classPrivateFieldLooseKey("sendMarkAsRead");class u{constructor(e){Object.defineProperty(this,c,{value:k});Object.defineProperty(this,d,{value:B});Object.defineProperty(this,l,{value:b});Object.defineProperty(this,r,{value:p});Object.defineProperty(this,n,{value:h});this.currentUserId=e.currentUserId;this.workflowId=e.workflowId;this.taskId=e.taskId;this.taskUserId=e.taskUserId;this.taskButtons=e.taskButtons;this.taskForm=e.taskForm;this.buttonsPanel=e.buttonsPanel;this.canDelegateTask=e.canDelegateTask;this.handleMarkAsRead=t.Runtime.debounce(babelHelpers.classPrivateFieldLooseBase(this,c)[c],100,this)}init(){if(this.buttonsPanel){babelHelpers.classPrivateFieldLooseBase(this,n)[n]()}this.handleMarkAsRead();s.EventEmitter.subscribe("OnUCCommentWasRead",(e=>{const[t]=e.getData();if(t===`WF_${this.workflowId}`){this.handleMarkAsRead()}}))}}function h(){if(this.taskButtons){this.taskButtons.forEach((e=>{const s=new o.UserStatus(e.TARGET_USER_STATUS);const i=s.isNo()||s.isCancel();const n=new a.Button({color:i?a.ButtonColor.LIGHT_BORDER:a.ButtonColor.SUCCESS,round:true,size:a.ButtonSize.MEDIUM,text:e.TEXT,onclick:t=>babelHelpers.classPrivateFieldLooseBase(this,r)[r](e,t)});t.Dom.style(n.getContainer(),"minWidth","160px");t.Dom.style(n.getContainer(),"maxWidth","200px");t.Dom.attr(n.getContainer(),"title",e.TEXT);t.Dom.append(n.getContainer(),this.buttonsPanel)}))}if(this.canDelegateTask){const e=new a.Button({color:a.ButtonColor.LINK,size:a.ButtonSize.MEDIUM,text:t.Loc.getMessage("BPWFI_SLIDER_BUTTON_DELEGATE"),onclick:e=>babelHelpers.classPrivateFieldLooseBase(this,l)[l](e)});t.Dom.style(e.getContainer(),"minWidth","160px");t.Dom.style(e.getContainer(),"maxWidth","200px");t.Dom.append(e.getContainer(),this.buttonsPanel)}}function p(e,s){const a=new FormData(this.taskForm);a.append("taskId",this.taskId);a.append(e.NAME,e.VALUE);s.setDisabled(true);t.ajax.runAction("bizproc.task.do",{data:a}).then((()=>{var e;s.setDisabled(false);(e=BX.SidePanel.Instance.getSliderByWindow(window))==null?void 0:e.close()})).catch((e=>{i.MessageBox.alert(e.errors.pop().message);s.setDisabled(false)}))}function b(e){e.setDisabled(true);t.Runtime.loadExtension("ui.entity-selector").then((t=>{const{Dialog:s}=t;e.setDisabled(false);const a=new s({targetNode:e.getContainer(),context:"bp-task-delegation",entities:[{id:"user",options:{intranetUsersOnly:true,emailUsers:false,inviteEmployeeLink:false,inviteGuestLink:false}},{id:"department",options:{selectMode:"usersOnly"}}],popupOptions:{bindOptions:{forceBindPosition:true}},enableSearch:true,events:{"Item:onSelect":e=>{const t=e.getData().item;babelHelpers.classPrivateFieldLooseBase(this,d)[d](t.getId())},onHide:e=>{e.getTarget().destroy()}},hideOnSelect:true,offsetTop:3,clearUnavailableItems:true,multiple:false});a.show()})).catch((t=>{console.error(t);e.setDisabled(false)}))}function B(e){const s={taskIds:[this.taskId],fromUserId:this.taskUserId||this.currentUserId,toUserId:e};t.ajax.runAction("bizproc.task.delegate",{data:s}).then((e=>{var t;(t=BX.SidePanel.Instance.getSliderByWindow(window))==null?void 0:t.close()})).catch((e=>{i.MessageBox.alert(e.errors.pop().message)}))}function k(){t.ajax.runAction("bizproc.workflow.comment.markAsRead",{data:{workflowId:this.workflowId,userId:this.currentUserId}})}e.WorkflowInfo=u})(this.BX.Bizproc.Component=this.BX.Bizproc.Component||{},BX,BX.Event,BX.UI,BX.Bizproc,BX.UI.Dialogs);
//# sourceMappingURL=script.map.js