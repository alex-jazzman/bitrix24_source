{"version":3,"file":"file-export.bundle.js","sources":["../src/file-export.js"],"sourcesContent":["import { ajax as Ajax, Dom } from 'main.core';\n\ntype Dataset = {\n\tid: number,\n\ttitle: ?string,\n};\n\nexport class FileExport\n{\n\tstatic #instance: FileExport;\n\t#exportDownloadLinks: Map<number, string>;\n\n\tconstructor()\n\t{\n\t\tthis.#exportDownloadLinks = new Map();\n\t}\n\n\tstatic getInstance(): FileExport\n\t{\n\t\tif (!FileExport.#instance)\n\t\t{\n\t\t\tFileExport.#instance = new FileExport();\n\t\t}\n\n\t\treturn FileExport.#instance;\n\t}\n\n\tdownloadOnce(dataset: Dataset): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.#getDownloadLink(dataset.id)\n\t\t\t\t.then((link) => {\n\t\t\t\t\tthis.#downloadDatasetFromLink(link, dataset);\n\t\t\t\t\tURL.revokeObjectURL(link);\n\t\t\t\t\tthis.#exportDownloadLinks.delete(dataset.id);\n\n\t\t\t\t\tresolve();\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\treject(error);\n\t\t\t\t});\n\t\t});\n\t}\n\n\tdownload(dataset: Dataset): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.#getDownloadLink(dataset.id)\n\t\t\t\t.then((link) => {\n\t\t\t\t\tthis.#downloadDatasetFromLink(link, dataset);\n\n\t\t\t\t\tresolve();\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\treject(error);\n\t\t\t\t});\n\t\t});\n\t}\n\n\t#getDownloadLink(datasetId: number): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (this.#exportDownloadLinks.has(datasetId))\n\t\t\t{\n\t\t\t\tresolve(this.#exportDownloadLinks.get(datasetId));\n\t\t\t}\n\n\t\t\tAjax.runAction(\n\t\t\t\t'biconnector.externalsource.dataset.export',\n\t\t\t\t{\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tid: datasetId,\n\t\t\t\t\t\texportFormat: 'csv',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t)\n\t\t\t\t.then((response) => {\n\t\t\t\t\tconst blob = new Blob([response.data], { type: 'text/csv' });\n\t\t\t\t\tconst link = URL.createObjectURL(blob);\n\t\t\t\t\tthis.#exportDownloadLinks.set(datasetId, link);\n\n\t\t\t\t\tresolve(link);\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\treject(error);\n\t\t\t\t});\n\t\t});\n\t}\n\n\t#downloadDatasetFromLink(link: string, dataset: Dataset): void\n\t{\n\t\tconst anchorElement = document.createElement('a');\n\t\tanchorElement.href = link;\n\t\tanchorElement.download = `${dataset.title ?? 'csv_dataset'}.csv`;\n\t\tDom.append(anchorElement, document.body);\n\t\tanchorElement.click();\n\t\tDom.remove(anchorElement);\n\t}\n}\n"],"names":["FileExport","constructor","Map","getInstance","downloadOnce","dataset","Promise","resolve","reject","id","then","link","URL","revokeObjectURL","delete","catch","error","download","datasetId","has","get","Ajax","runAction","data","exportFormat","response","blob","Blob","type","createObjectURL","set","anchorElement","document","createElement","href","title","Dom","append","body","click","remove"],"mappings":";;;;;;CAA8C;CAAA;CAAA;CAAA;AAO9C,CAAO,MAAMA,UAAU,CACvB;GAICC,WAAW,GACX;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA;;KACC,4CAAI,gDAAwB,IAAIC,GAAG,EAAE;;GAGtC,OAAOC,WAAW,GAClB;KACC,IAAI,yCAACH,UAAU,uBAAU,EACzB;OACC,wCAAAA,UAAU,0BAAa,IAAIA,UAAU,EAAE;;KAGxC,+CAAOA,UAAU;;GAGlBI,YAAY,CAACC,OAAgB,EAC7B;KACC,OAAO,IAAIC,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;OACvC,4CAAI,sCAAkBH,OAAO,CAACI,EAAE,EAC9BC,IAAI,CAAEC,IAAI,IAAK;SACf,4CAAI,sDAA0BA,IAAI,EAAEN,OAAO;SAC3CO,GAAG,CAACC,eAAe,CAACF,IAAI,CAAC;SACzB,4CAAI,8CAAsBG,MAAM,CAACT,OAAO,CAACI,EAAE,CAAC;SAE5CF,OAAO,EAAE;QACT,CAAC,CACDQ,KAAK,CAAEC,KAAK,IAAK;SACjBR,MAAM,CAACQ,KAAK,CAAC;QACb,CAAC;MACH,CAAC;;GAGHC,QAAQ,CAACZ,OAAgB,EACzB;KACC,OAAO,IAAIC,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;OACvC,4CAAI,sCAAkBH,OAAO,CAACI,EAAE,EAC9BC,IAAI,CAAEC,IAAI,IAAK;SACf,4CAAI,sDAA0BA,IAAI,EAAEN,OAAO;SAE3CE,OAAO,EAAE;QACT,CAAC,CACDQ,KAAK,CAAEC,KAAK,IAAK;SACjBR,MAAM,CAACQ,KAAK,CAAC;QACb,CAAC;MACH,CAAC;;CA0CJ;CAAC,2BAvCiBE,SAAiB,EAClC;GACC,OAAO,IAAIZ,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;KACvC,IAAI,4CAAI,8CAAsBW,GAAG,CAACD,SAAS,CAAC,EAC5C;OACCX,OAAO,CAAC,4CAAI,8CAAsBa,GAAG,CAACF,SAAS,CAAC,CAAC;;KAGlDG,cAAI,CAACC,SAAS,CACb,2CAA2C,EAC3C;OACCC,IAAI,EAAE;SACLd,EAAE,EAAES,SAAS;SACbM,YAAY,EAAE;;MAEf,CACD,CACCd,IAAI,CAAEe,QAAQ,IAAK;OACnB,MAAMC,IAAI,GAAG,IAAIC,IAAI,CAAC,CAACF,QAAQ,CAACF,IAAI,CAAC,EAAE;SAAEK,IAAI,EAAE;QAAY,CAAC;OAC5D,MAAMjB,IAAI,GAAGC,GAAG,CAACiB,eAAe,CAACH,IAAI,CAAC;OACtC,4CAAI,8CAAsBI,GAAG,CAACZ,SAAS,EAAEP,IAAI,CAAC;OAE9CJ,OAAO,CAACI,IAAI,CAAC;MACb,CAAC,CACDI,KAAK,CAAEC,KAAK,IAAK;OACjBR,MAAM,CAACQ,KAAK,CAAC;MACb,CAAC;IACH,CAAC;CACH;CAAC,mCAEwBL,IAAY,EAAEN,OAAgB,EACvD;GAAA;GACC,MAAM0B,aAAa,GAAGC,QAAQ,CAACC,aAAa,CAAC,GAAG,CAAC;GACjDF,aAAa,CAACG,IAAI,GAAGvB,IAAI;GACzBoB,aAAa,CAACd,QAAQ,GAAI,qBAAEZ,OAAO,CAAC8B,KAAK,6BAAI,aAAc,MAAK;GAChEC,aAAG,CAACC,MAAM,CAACN,aAAa,EAAEC,QAAQ,CAACM,IAAI,CAAC;GACxCP,aAAa,CAACQ,KAAK,EAAE;GACrBH,aAAG,CAACI,MAAM,CAACT,aAAa,CAAC;CAC1B;CAAC,sBA1FW/B,UAAU;GAAA;GAAA;CAAA;;;;;;;;"}