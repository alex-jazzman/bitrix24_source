this.BX=this.BX||{},function(t,n,e,a,o){"use strict";var r;function i(t,n){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=function(t,n){if(!t)return;if("string"==typeof t)return c(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return c(t,n)}(t))||n&&t&&"number"==typeof t.length){e&&(t=e);var a=0,o=function(){};return{s:o,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i=!0,s=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return i=t.done,t},e:function(t){s=!0,r=t},f:function(){try{i||null==e.return||e.return()}finally{if(s)throw r}}}}function c(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,a=new Array(n);e<n;e++)a[e]=t[e];return a}var s=function(){function t(){babelHelpers.classCallCheck(this,t),this.subscribeOnEvents()}return babelHelpers.createClass(t,[{key:"subscribeOnEvents",value:function(){BX.PULL&&BX.PULL.extendWatch("superset_dashboard",!0),o.EventEmitter.subscribe("onPullEvent-biconnector",(function(t){var n=babelHelpers.slicedToArray(t.data,2),e=n[0],a=n[1];if("onDashboardStatusUpdated"===e&&a){var r=null==a?void 0:a.dashboardList;r&&o.EventEmitter.emit("BIConnector.Superset.DashboardManager:onDashboardBatchStatusUpdate",{dashboardList:r})}}))}},{key:"processEditDashboard",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};"CUSTOM"===t.type?this.processLoginDashboard(t,n,e,a):this.processCopyDashboard(t,n,e,a)}},{key:"processCopyDashboard",value:function(t){var o=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},d="SYSTEM"===t.type?n.Loc.getMessage("SUPERSET_DASHBOARD_DETAIL_LOGIN_POPUP_COPY_SYSTEM_DASHBOARD_ATTENTION"):n.Loc.getMessage("SUPERSET_DASHBOARD_DETAIL_LOGIN_POPUP_COPY_MARKET_DASHBOARD_ATTENTION"),u=n.Tag.render(r||(r=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="dashboard-login-popup-copy-attention">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),d),l="popup_copy",h=new a.Button({text:n.Loc.getMessage("SUPERSET_DASHBOARD_DETAIL_LOGIN_POPUP_CONTINUE_BTN"),color:a.Button.Color.PRIMARY,onclick:function(){h.setWaiting(!0),o.duplicateDashboard(t.id).then((function(t){c(l);var e=t.data.dashboard;e?window.open(e.detail_url,"_top"):BX.UI.Notification.Center.notify({content:BX.util.htmlspecialchars(n.Loc.getMessage("SUPERSET_DASHBOARD_DETAIL_COPY_ERROR"))})})).catch((function(t){var e;s(l),t.errors&&n.Type.isStringFilled(null===(e=t.errors[0])||void 0===e?void 0:e.message)&&BX.UI.Notification.Center.notify({content:n.Text.encode(t.errors[0].message)})}))}}),b=new e.Popup({content:u,overlay:!0,width:620,className:"dashboard-login-popup",closeIcon:!0,closeByEsc:!0,disableScroll:!0,titleBar:n.Loc.getMessage("SUPERSET_DASHBOARD_DETAIL_LOGIN_POPUP_TITLE"),buttons:[h,new a.Button({text:n.Loc.getMessage("SUPERSET_DASHBOARD_DETAIL_LOGIN_POPUP_CANCEL_BTN"),color:a.Button.Color.LIGHT,onclick:function(){b.close()}})],events:{onClose:function(){i("popup_copy")}}});b.show()}},{key:"processLoginDashboard",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},o="popup_login";this.getEditUrl(t).then((function(t){e(o),t&&window.open(t,"_blank").focus()})).catch((function(){a(o),window.open(t.editLink,"_blank").focus()})).finally((function(){n()}))}},{key:"duplicateDashboard",value:function(t){return n.ajax.runAction("biconnector.dashboard.copy",{data:{id:t}})}},{key:"exportDashboard",value:function(t,e,a){return n.ajax.runAction("biconnector.dashboard.export",{data:{id:t}}).then((function(t){var a=t.data.filePath;a&&window.open(a,"_self"),n.Type.isFunction(e)&&e()})).catch((function(t){BX.UI.Notification.Center.notify({content:BX.util.htmlspecialchars(t.errors[0].message)}),n.Type.isFunction(a)&&a()}))}},{key:"deleteDashboard",value:function(t){return n.ajax.runAction("biconnector.dashboard.delete",{data:{id:t}})}},{key:"renameDashboard",value:function(t,e){return n.ajax.runAction("biconnector.dashboard.rename",{data:{id:t,title:e}})}},{key:"restartDashboardImport",value:function(t){return n.ajax.runAction("biconnector.dashboard.restartImport",{data:{id:t}}).then((function(t){var n,e=null==t||null===(n=t.data)||void 0===n?void 0:n.restartedDashboardIds;if(e){var a,r=[],c=i(e);try{for(c.s();!(a=c.n()).done;){var s=a.value;r.push({id:Number(s),status:"L"})}}catch(t){c.e(t)}finally{c.f()}o.EventEmitter.emit(window,"BIConnector.Superset.DashboardManager:onDashboardBatchStatusUpdate",{dashboardList:r})}}))}},{key:"setDashboardTags",value:function(t,e){return n.ajax.runAction("biconnector.dashboard.setDashboardTags",{data:{id:t,tags:e}})}},{key:"addTag",value:function(t){return n.ajax.runAction("biconnector.dashboardTag.add",{data:{title:t}})}},{key:"createEmptyDashboard",value:function(){return n.ajax.runAction("biconnector.dashboard.createEmptyDashboard",{data:{}})}},{key:"getEditUrl",value:function(t){return new Promise((function(e,a){n.ajax.runAction("biconnector.dashboard.getEditUrl",{data:{dashboardId:t.id,editUrl:t.editLink}}).then((function(t){var n=t.data;n&&e(n)})).catch((function(t){a(t)}))}))}},{key:"addToTopMenu",value:function(t){return n.ajax.runAction("biconnector.dashboard.addToTopMenu",{data:{dashboardId:t}})}},{key:"deleteFromTopMenu",value:function(t){return n.ajax.runAction("biconnector.dashboard.deleteFromTopMenu",{data:{dashboardId:t}})}},{key:"pin",value:function(t){return n.ajax.runAction("biconnector.dashboard.pin",{data:{dashboardId:t}})}},{key:"unpin",value:function(t){return n.ajax.runAction("biconnector.dashboard.unpin",{data:{dashboardId:t}})}}],[{key:"openSettingsSlider",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=null===t?"/bitrix/components/bitrix/biconnector.apachesuperset.setting/slider.php":"/bitrix/components/bitrix/biconnector.apachesuperset.dashboard.setting/slider.php",a=new n.Uri(e);null!==t&&a.setQueryParam("DASHBOARD_ID",n.Text.toNumber(t)),BX.SidePanel.Instance.open(a.toString(),{width:790,allowChangeHistory:!1,cacheable:!1})}}]),t}();babelHelpers.defineProperty(s,"DASHBOARD_STATUS_LOAD","L"),babelHelpers.defineProperty(s,"DASHBOARD_STATUS_READY","R"),babelHelpers.defineProperty(s,"DASHBOARD_STATUS_FAILED","F"),t.DashboardManager=s}(this.BX.BIConnector=this.BX.BIConnector||{},BX,BX.Main,BX.UI,BX.Event);
