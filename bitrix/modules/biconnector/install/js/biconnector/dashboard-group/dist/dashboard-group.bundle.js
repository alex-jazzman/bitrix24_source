this.BX=this.BX||{},function(t,e,o,n,r,s,i,a,c){"use strict";var d={system:"SYSTEM",custom:"CUSTOM"},p="SYSTEM",u="MARKET";function l(t,e){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function(t,e){if(!t)return;if("string"==typeof t)return h(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return h(t,e)}(t))||e&&t&&"number"==typeof t.length){o&&(t=o);var n=0,r=function(){};return{s:r,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,a=!1;return{s:function(){o=o.call(t)},n:function(){var t=o.next();return i=t.done,t},e:function(t){a=!0,s=t},f:function(){try{i||null==o.return||o.return()}finally{if(a)throw s}}}}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=new Array(e);o<e;o++)n[o]=t[o];return n}var f=function(){function t(){babelHelpers.classCallCheck(this,t)}return babelHelpers.createClass(t,null,[{key:"buildStore",value:function(t){return o.createStore({state:function(){return t},mutations:{setIsLoading:function(t,e){t.isLoading=e},setGroupName:function(t,e){t.group.name=e},addDashboard:function(t,e){t.group.dashboardIds.unshift(e.id);var o=t.group.scopes;t.dashboards.get(e.id)&&(e.scopes=t.dashboards.get(e.id).scopes);var n,r=new Set(e.scopes.map((function(t){return t.code}))),s=l(o);try{for(s.s();!(n=s.n()).done;){var i=n.value;r.has(i.code)||e.scopes.push(i)}}catch(t){s.e(t)}finally{s.f()}t.dashboards.set(e.id,e)},removeDashboard:function(t,e){var o=t.dashboards.get(e);if(o){t.group.dashboardIds=t.group.dashboardIds.filter((function(t){return t!==e}));var n,r=l(t.group.scopes);try{var s=function(){var r,s=n.value,i=!1,a=l(t.otherGroups);try{for(a.s();!(r=a.n()).done;){var c=r.value;c.dashboardIds.includes(e)&&c.scopes.some((function(t){return t.code===s.code}))&&(i=!0)}}catch(t){a.e(t)}finally{a.f()}!i&&o.scopes.some((function(t){return t.code===s.code}))&&(o.scopes=o.scopes.filter((function(t){return t.code!==s.code})),t.dashboards.set(e,o))};for(r.s();!(n=r.n()).done;)s()}catch(t){r.e(t)}finally{r.f()}}},setDashboardScopes:function(t,e){var o=e.dashboardId,n=e.scopes;t.dashboards.get(o).scopes=n},addGroupScope:function(t,e){t.group.scopes.push(e);var o,n=e.code,r=l(t.group.dashboardIds);try{for(r.s();!(o=r.n()).done;){var s=o.value,i=t.dashboards.get(s);i.scopes.some((function(t){return t.code===n}))||(i.scopes.push(e),t.dashboards.set(s,i))}}catch(t){r.e(t)}finally{r.f()}},removeGroupScope:function(t,e){t.group.scopes=t.group.scopes.filter((function(t){return t.code!==e.code}));var o,n=e.code,r=l(t.group.dashboardIds);try{for(r.s();!(o=r.n()).done;){var s,i=o.value,a=!1,c=l(t.otherGroups);try{for(c.s();!(s=c.n()).done;){var d=s.value;d.dashboardIds.includes(i)&&d.scopes.some((function(t){return t.code===n}))&&(a=!0)}}catch(t){c.e(t)}finally{c.f()}if(!a){var p=t.dashboards.get(i);p.scopes.some((function(t){return t.code===n}))&&(p.scopes=p.scopes.filter((function(t){return t.code!==n})),t.dashboards.set(i,p))}}}catch(t){r.e(t)}finally{r.f()}},setShowDeletionWarningPopup:function(t,e){t.isNeedShowDeletionWarningPopup=e}},getters:{groupName:function(t){return t.group.name},groupScopes:function(t){return t.group.scopes},dashboards:function(t){return t.dashboards},groupDashboardsData:function(t){var e,o=[],n=l(t.group.dashboardIds);try{for(n.s();!(e=n.n()).done;){var r=e.value;o.push(t.dashboards.get(r))}}catch(t){n.e(t)}finally{n.f()}return o},isSystemGroup:function(t){return t.group.type===d.system},groupData:function(t){return{id:t.group.id,name:t.group.name,type:t.group.type,scopes:t.group.scopes,dashboardIds:t.group.dashboardIds}},isSaveEnabled:function(t){return t.saveEnabled},isLoading:function(t){return t.isLoading},isGroupScope:function(t){return function(e,o){if(t.group.scopes.some((function(t){return t.code===o})))return!0;var n,r=l(t.otherGroups);try{for(r.s();!(n=r.n()).done;){var s=n.value;if(s.dashboardIds.includes(e)&&s.scopes.some((function(t){return t.code===o})))return!0}}catch(t){r.e(t)}finally{r.f()}return!1}},isNeedShowDeletionWarningPopup:function(t){return t.isNeedShowDeletionWarningPopup}}})}}]),t}();function g(t,e){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function(t,e){if(!t)return;if("string"==typeof t)return m(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return m(t,e)}(t))||e&&t&&"number"==typeof t.length){o&&(t=o);var n=0,r=function(){};return{s:r,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,a=!1;return{s:function(){o=o.call(t)},n:function(){var t=o.next();return i=t.done,t},e:function(t){a=!0,s=t},f:function(){try{i||null==o.return||o.return()}finally{if(a)throw s}}}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=new Array(e);o<e;o++)n[o]=t[o];return n}var b={props:{dashboard:{type:Object,required:!0}},data:function(){return{scopeNameLengthLimit:30}},beforeUnmount:function(){this.dialog&&this.dialog.destroy(),this.dialog=null},computed:{visibleScopes:function(){return this.scopes.slice(0,3)},moreScopesText:function(){return this.$Bitrix.Loc.getMessage("BI_GROUP_SCOPES_MORE").replace("#NUMBER#",this.dashboard.scopes.length-3)},showMoreScopes:function(){return this.dashboard.scopes.length>3},scopes:function(){return babelHelpers.toConsumableArray(this.dashboard.scopes)},isGroupScope:function(){var t=this;return function(e){return t.$store.getters.isGroupScope(t.dashboard.id,e)}}},emits:["onScopeChange"],methods:{formatScopeName:function(t){return t.length<this.scopeNameLengthLimit?t:"".concat(t.slice(0,this.scopeNameLengthLimit),"...")},openSelector:function(){this.dialog||this.initDialog(),this.dialog.show()},initDialog:function(){var t,e=[],o=[],n=g(this.dashboard.scopes);try{for(n.s();!(t=n.n()).done;){var s=t.value;e.push(["biconnector-superset-scope",s.code]),this.isGroupScope(s.code)&&o.push(["biconnector-superset-scope",s.code])}}catch(t){n.e(t)}finally{n.f()}this.dialog=new i.Dialog({id:"dashboard-scope-selector",targetNode:this.$refs.dashboardScopes,width:350,height:300,dropdownMode:!0,compactView:!0,showAvatars:!1,enableSearch:!0,preload:!0,preselectedItems:e,undeselectedItems:o,entities:[{id:"biconnector-superset-scope",dynamicLoad:!0,dynamicSearch:!0}],events:{"Item:onSelect":this.handleScopeAdd,"Item:onDeselect":this.handleScopeRemove}}),this.dialog.getPopup().setOffset({offsetLeft:-320}),this.dialog.adjustPosition(),r.Dom.addClass(this.dialog.getContainer(),"biconnector-scope-selector")},handleScopeAdd:function(t){var e=t.getData().item,o=this.scopes;o.push({code:e.getId(),name:e.getTitle()}),this.$store.commit("setDashboardScopes",{dashboardId:this.dashboard.id,scopes:o}),this.$emit("onScopeChange")},handleScopeRemove:function(t){var e=t.getData().item,o=this.scopes.filter((function(t){return t.code!==e.id}));this.$store.commit("setDashboardScopes",{dashboardId:this.dashboard.id,scopes:o}),this.$emit("onScopeChange")},showMoreScopesHint:function(){var t=this.$refs.moreScopesHint;this.hintManager.show(t,this.scopes.slice(3).map((function(t){return t.name})).join(", "),!1)},hideMoreScopesHint:function(){this.hintManager.hide()},onGroupScopeChanged:function(){var t;null===(t=this.dialog)||void 0===t||t.destroy(),this.dialog=null}},mounted:function(){this.hintManager=r.UI.Hint.createInstance({id:"dashboard-scope-hint-".concat(Date.now()),popupParameters:{bindOptions:{position:"bottom"},width:190,offsetLeft:-80,angle:{position:"top",offset:130}}})},template:'\n\t\t<div class="group-dashboard-scopes-container">\n\t\t\t<span class="scope-list scope-list-dashboard" @click="openSelector">\n\t\t\t\t<span\n\t\t\t\t\tv-if="scopes.length > 0"\n\t\t\t\t\tv-for="(scope, index) of visibleScopes"\n\t\t\t\t\tclass="scope-name"\n\t\t\t\t\t:title="scope.name.length > scopeNameLengthLimit ? scope.name : null"\n\t\t\t\t>\n\t\t\t\t\t{{formatScopeName(scope.name)}}{{ index < visibleScopes.length - 1 ? \', \' : \'\' }}\n\t\t\t\t</span>\n\t\t\t\t<span v-else>\n\t\t\t\t\t{{$Bitrix.Loc.getMessage(\'BI_GROUP_DASHBOARD_SCOPES_EMPTY\')}}\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t\t<span\n\t\t\t\tv-if="showMoreScopes"\n\t\t\t\tclass="scope-list scope-list-more"\n\t\t\t\t@click="openSelector"\n\t\t\t\tref="moreScopesHint"\n\t\t\t\t@mouseenter="showMoreScopesHint"\n\t\t\t\t@mouseleave="hideMoreScopesHint"\n\t\t\t>\n\t\t\t\t{{moreScopesText}}\n\t\t\t</span>\n\t\t\t<span ref="dashboardScopes"></span>\n\t\t</div>\n\t'},v={props:{dashboard:{type:Object,required:!0}},computed:{iconPath:function(){return this.dashboard.type===p?"/bitrix/images/biconnector/superset-dashboard-selector/icon-type-system.png":this.dashboard.type===u?"/bitrix/images/biconnector/superset-dashboard-selector/icon-type-market.png":"/bitrix/images/biconnector/superset-dashboard-selector/icon-type-custom.png"},set:function(){return a.Set}},methods:{onRemoveClick:function(){this.$emit("onDashboardRemove",{dashboardId:this.dashboard.id}),this.emitDashboardChange()},emitDashboardChange:function(){this.$emit("onDashboardChange")},onGroupScopeChanged:function(){this.$refs.scopeSelector.onGroupScopeChanged()}},emits:["onDashboardChange","onDashboardRemove"],components:{BIcon:a.BIcon,DashboardScopeSelector:b},template:'\n\t\t<div class="group-dashboard">\n\t\t\t<img class="group-dashboard-icon" :src="iconPath" width="32" height="32" alt="Dashboard icon">\n\t\t\t<div class="group-dashboard-name" :title="dashboard.name">{{dashboard.name}}</div>\n\t\t\t<DashboardScopeSelector :dashboard="dashboard" ref="scopeSelector" @on-scope-change="emitDashboardChange"/>\n\t\t\t<BIcon\n\t\t\t\t:name="set.CROSS_20"\n\t\t\t\t:size="20"\n\t\t\t\tcolor="#BDC1C6"\n\t\t\t\t:class="\'group-dashboard-remove-icon\'"\n\t\t\t\t@click="onRemoveClick"\n\t\t\t></BIcon>\n\t\t</div>\n\t'};function S(t,e){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function(t,e){if(!t)return;if("string"==typeof t)return y(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return y(t,e)}(t))||e&&t&&"number"==typeof t.length){o&&(t=o);var n=0,r=function(){};return{s:r,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,a=!1;return{s:function(){o=o.call(t)},n:function(){var t=o.next();return i=t.done,t},e:function(t){a=!0,s=t},f:function(){try{i||null==o.return||o.return()}finally{if(a)throw s}}}}function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=new Array(e);o<e;o++)n[o]=t[o];return n}var I={props:{dashboards:{type:Array,required:!0}},mounted:function(){this.initDialog()},methods:{onAddDashboardClick:function(){this.dialog.show()},initDialog:function(){var t,e=this,o=[],n=S(this.dashboards);try{for(n.s();!(t=n.n()).done;){var r=t.value;o.push(["biconnector-superset-dashboard",r.id])}}catch(t){n.e(t)}finally{n.f()}this.dialog=new i.Dialog({id:"group-dashboard-selector",targetNode:this.$refs.addDashboardButton,width:400,height:300,dropdownMode:!0,enableSearch:!0,preload:!0,preselectedItems:o,entities:[{id:"biconnector-superset-dashboard",dynamicLoad:!0,dynamicSearch:!0,options:{loadProxyData:!1,checkAccessRights:this.$store.getters.isSaveEnabled}}],events:{"Item:onSelect":function(t){var o,n,r=t.data.item,s={id:r.getId(),name:r.getTitle(),type:null!==(o=r.getCustomData().get("type"))&&void 0!==o?o:p,scopes:null!==(n=r.getCustomData().get("scopes"))&&void 0!==n?n:[]};e.$store.commit("addDashboard",s),e.$emit("onDashboardsChange")},"Item:onDeselect":function(t){var o=t.data.item;e.$store.commit("removeDashboard",o.getId()),e.$emit("onDashboardsChange")}}})}},emits:["onDashboardsChange"],watch:{dashboards:function(t,e){var o,n=this.dialog,r=S(e);try{for(r.s();!(o=r.n()).done;){var s,i=o.value;if(!t.includes(i))null===(s=n.getItem(["biconnector-superset-dashboard",i.id]))||void 0===s||s.deselect()}}catch(t){r.e(t)}finally{r.f()}}},template:'\n\t\t<div class="ui-btn ui-btn-primary ui-btn-sm ui-btn-round ui-btn-icon-add ui-btn-no-caps group-add-dashboards-button"\n\t\t\t@click="onAddDashboardClick"\n\t\t\tref="addDashboardButton"\n\t\t>\n\t\t\t{{ $Bitrix.Loc.getMessage(\'BI_GROUP_ADD_DASHBOARD\') }}\n\t\t</div>\n\t'},w={emits:["confirm","close"],props:{},data:function(){return{popupInstance:null,popupId:"biconnector-dashboard-deletion",dontShow:!1}},computed:{popupOptions:function(){return{id:this.popupId,content:this.$refs.content,width:400,padding:18,autoHide:!0,overlay:!0,events:{onPopupClose:this.closePopup,onPopupDestroy:this.closePopup},fixed:!0}},set:function(){return a.Set}},methods:{closePopup:function(){var t;null===(t=n.PopupManager.getPopupById(this.popupId))||void 0===t||t.destroy(),this.popupInstance=null,this.$emit("close")},onConfirm:function(){this.$emit("confirm",{dontShow:this.dontShow}),this.closePopup()},getPopupText:function(){return this.$Bitrix.Loc.getMessage("BI_GROUP_SAVE_WARN_TEXT").replace("[link]",'<a class="ui-link ui-link-primary ui-link-dashed group-warn-popup-box-link" onclick="top.BX.Helper.show(`redirect=detail&code=25556500`)">').replace("[/link]","</a>")}},mounted:function(){this.popupInstance||(this.popupInstance=new n.Popup(this.popupOptions)),this.popupInstance.show()},beforeUnmount:function(){this.closePopup()},components:{BIcon:a.BIcon},template:'\n\t\t<div ref="content" class="group-warn-popup">\n\t\t\t<div class="group-warn-popup-title-block">\n\t\t\t\t<div class="group-warn-popup-title">{{ $Bitrix.Loc.getMessage(\'BI_GROUP_SAVE_WARN_TITLE\') }}</div>\n\t\t\t\t<BIcon\n\t\t\t\t\t:name="set.CROSS_30"\n\t\t\t\t\t:size="18"\n\t\t\t\t\tcolor="#BDC1C6"\n\t\t\t\t\t:class="\'group-warn-popup-close\'"\n\t\t\t\t\t@click="closePopup"\n\t\t\t\t></BIcon>\n\t\t\t</div>\n\t\t\t<div class="group-warn-popup-box" v-html="getPopupText()"></div>\n\t\t\t<label class="group-warn-popup-checkbox">\n\t\t\t\t<input type="checkbox" v-model="dontShow"/>\n\t\t\t\t<span class="group-warn-popup-checkbox-text">{{ $Bitrix.Loc.getMessage(\'BI_GROUP_SAVE_WARN_DONT_SHOW\') }}</span>\n\t\t\t</label>\n\t\t\t<div class="group-warn-popup-separator"></div>\n\t\t\t<div class="group-warn-popup-buttons">\n\t\t\t\t<div class="ui-btn ui-btn-sm ui-btn-primary" @click="onConfirm">{{ $Bitrix.Loc.getMessage(\'BI_GROUP_SAVE_WARN_YES\') }}</div>\n\t\t\t\t<div class="ui-btn ui-btn-sm ui-btn-light-border" @click="closePopup">{{ $Bitrix.Loc.getMessage(\'BI_GROUP_SAVE_WARN_NO\') }}</div>\n\t\t\t</div>\n\t\t</div>\n\t'};function D(t,e){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function(t,e){if(!t)return;if("string"==typeof t)return B(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return B(t,e)}(t))||e&&t&&"number"==typeof t.length){o&&(t=o);var n=0,r=function(){};return{s:r,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,a=!1;return{s:function(){o=o.call(t)},n:function(){var t=o.next();return i=t.done,t},e:function(t){a=!0,s=t},f:function(){try{i||null==o.return||o.return()}finally{if(a)throw s}}}}function B(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=new Array(e);o<e;o++)n[o]=t[o];return n}var P={props:{canEdit:{type:Boolean,required:!0}},directives:{hint:c.hint},data:function(){return{scopeNameLengthLimit:30}},computed:{scopes:function(){return this.$store.getters.groupScopes},moreScopesText:function(){return this.$Bitrix.Loc.getMessage("BI_GROUP_SCOPES_MORE").replace("#NUMBER#",this.scopes.length-1)},showMoreScopes:function(){return this.scopes.length>1},hintOptions:function(){return{html:this.$Bitrix.Loc.getMessage("BI_GROUP_SCOPE_HINT").replace("[link]",'<a class="scope-hint-link" onclick="top.BX.Helper.show(`redirect=detail&code=25556500`)">').replace("[/link]","</a>"),interactivity:!0,popupOptions:{bindOptions:{position:"bottom"},autoHide:!1,width:244,offsetTop:-4,angle:{position:"top",offset:34}}}},systemScopeHintOptions:function(){return this.canEdit?null:{text:this.$Bitrix.Loc.getMessage("BI_GROUP_SYSTEM_SCOPES_HINT"),popupOptions:{bindOptions:{position:"bottom"},width:244,offsetLeft:-140,angle:{position:"top",offset:180}}}},set:function(){return a.Set}},methods:{openScopeSelector:function(){this.canEdit&&(this.dialog||this.initDialog(),this.dialog.show())},initDialog:function(){var t,e=[],o=D(this.scopes);try{for(o.s();!(t=o.n()).done;){var n=t.value;e.push(["biconnector-superset-scope",n.code])}}catch(t){o.e(t)}finally{o.f()}this.dialog=new i.Dialog({id:"group-scope-selector",targetNode:this.$refs.groupScopes,width:350,height:300,dropdownMode:!0,compactView:!0,showAvatars:!1,enableSearch:!0,preload:!0,preselectedItems:e,entities:[{id:"biconnector-superset-scope",dynamicLoad:!0,dynamicSearch:!0}],events:{"Item:onSelect":this.onGroupScopeAdd,"Item:onDeselect":this.onGroupScopeRemove}}),this.dialog.getPopup().setOffset({offsetLeft:-320}),this.dialog.adjustPosition(),r.Dom.addClass(this.dialog.getContainer(),"biconnector-scope-selector")},onGroupScopeAdd:function(t){var e=t.getData().item,o={code:e.getId(),name:e.getTitle()};this.$emit("onGroupScopeAdd",o)},onGroupScopeRemove:function(t){var e=t.getData().item,o={code:e.getId(),name:e.getTitle()};this.$emit("onGroupScopeRemove",o)},showMoreScopesHint:function(){var t=this.$refs.moreScopesHint;this.hintManager.show(t,this.scopes.slice(1).map((function(t){return t.name})).join(", "),!1)},hideMoreScopesHint:function(){this.hintManager.hide()},formatScopeName:function(t){return t.length<this.scopeNameLengthLimit?t:"".concat(t.slice(0,this.scopeNameLengthLimit),"...")}},mounted:function(){this.hintManager=r.UI.Hint.createInstance({id:"group-scope-hint",popupParameters:{bindOptions:{position:"bottom"},width:190,offsetLeft:-80,angle:{position:"top",offset:130}}})},emits:["onGroupScopeAdd","onGroupScopeRemove"],components:{BIcon:a.BIcon},template:'\n\t\t<span class="scopes-title">\n\t\t\t{{$Bitrix.Loc.getMessage(\'BI_GROUP_SCOPES\')}}\n\t\t</span>\n\t\t<span\n\t\t\tv-if="scopes.length > 0"\n\t\t\t@click="openScopeSelector"\n\t\t\tclass="scope-list scope-list-group"\n\t\t\t:class="{\'scope-list-system\': !canEdit}"\n\t\t\tv-hint="systemScopeHintOptions"\n\t\t\t:title="scopes[0].name.length > scopeNameLengthLimit ? scopes[0].name : null"\n\t\t>\n\t\t\t{{formatScopeName(scopes[0].name)}}\n\t\t</span>\n\t\t<span\n\t\t\tv-else\n\t\t\tclass="scope-list scope-list-group"\n\t\t\t:class="{\'scope-list-system\': !canEdit}"\n\t\t\t@click="openScopeSelector"\n\t\t>\n\t\t\t{{$Bitrix.Loc.getMessage(\'BI_GROUP_SCOPES_EMPTY\')}}\n\t\t</span>\n\t\t<span\n\t\t\tv-if="showMoreScopes"\n\t\t\t@click="openScopeSelector"\n\t\t\tclass="scope-list scope-list-more"\n\t\t\tref="moreScopesHint"\n\t\t\t@mouseenter="showMoreScopesHint"\n\t\t\t@mouseleave="hideMoreScopesHint"\n\t\t>\n\t\t\t{{moreScopesText}}\n\t\t</span>\n\t\t<div class="group-scope-list-hint" ref="groupScopes" v-hint="hintOptions">\n\t\t\t<BIcon\n\t\t\t\t:name="set.HELP"\n\t\t\t\t:size="20"\n\t\t\t\tcolor="#D5D7DB"\n\t\t\t></BIcon>\n\t\t</div>\n\t'},$={props:{canEdit:{type:Boolean,required:!0}},data:function(){return{editMode:!1}},directives:{hint:c.hint},computed:{groupName:{get:function(){return this.$store.getters.groupName},set:function(t){this.$store.commit("setGroupName",t)}},set:function(){return a.Set},nameHintOptions:function(){return{text:this.$Bitrix.Loc.getMessage("BI_GROUP_SYSTEM_NAME_HINT"),popupOptions:{bindOptions:{position:"bottom"},width:220,offsetLeft:40,angle:{position:"top",offset:0}}}}},methods:{setEditMode:function(){var t=this;this.editMode=!0,this.$nextTick((function(){t.$refs.nameInput.focus()}))},setViewMode:function(){this.editMode=!1,this.groupName||this.$store.commit("setGroupName",this.$Bitrix.Loc.getMessage("BI_GROUP_NAME_NEW")),this.$emit("onNameUpdate")}},emits:["onNameUpdate"],components:{BIcon:a.BIcon},template:'\n\t\t<div class="group-header-title" :style="{ width: editMode ? \'80%\' : \'auto\' }">\n\t\t\t<template v-if="canEdit">\n\t\t\t\t<input v-if="editMode" class="group-name-input" @blur="setViewMode" v-model="groupName" ref="nameInput">\n\t\t\t\t<template v-else>\n\t\t\t\t\t<div class="group-name">{{groupName}}</div>\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\t:name="set.PENCIL_40"\n\t\t\t\t\t\t:size="20"\n\t\t\t\t\t\tcolor="#BDC1C6"\n\t\t\t\t\t\t:class="\'group-name-edit-icon\'"\n\t\t\t\t\t\t@click="setEditMode"\n\t\t\t\t\t></BIcon>\n\t\t\t\t</template>\n\t\t\t</template>\n\t\t\t<template v-else>\n\t\t\t\t<div class="group-name" v-hint="nameHintOptions">{{groupName}}</div>\n\t\t\t</template>\n\t\t</div>\n\t'};function A(t,e){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function(t,e){if(!t)return;if("string"==typeof t)return M(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return M(t,e)}(t))||e&&t&&"number"==typeof t.length){o&&(t=o);var n=0,r=function(){};return{s:r,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,a=!1;return{s:function(){o=o.call(t)},n:function(){var t=o.next();return i=t.done,t},e:function(t){a=!0,s=t},f:function(){try{i||null==o.return||o.return()}finally{if(a)throw s}}}}function M(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=new Array(e);o<e;o++)n[o]=t[o];return n}var E={mounted:function(){},data:function(){return{deletionWarning:{popupShown:!1,dashboardId:null}}},computed:{isNoDashboards:function(){return 0===this.$store.state.group.dashboardIds.length},dashboards:function(){return this.$store.getters.groupDashboardsData},isSystemGroup:function(){return this.$store.getters.isSystemGroup},isSaveEnabled:function(){return this.$store.getters.isSaveEnabled},isLoading:function(){return this.$store.getters.isLoading},isDashboardListScrollable:function(){return this.isSaveEnabled?this.dashboards.length>6:this.dashboards.length>7},set:function(){return a.Set}},methods:{updateRight:function(){s.EventEmitter.emit("BIConnector.GroupPopup:onGroupUpdated",{group:r.Runtime.clone(this.$store.getters.groupData),dashboards:r.Runtime.clone(this.$store.getters.dashboards)})},onGroupScopeAdd:function(t){var e;this.$store.commit("addGroupScope",t),this.updateRight();var o,n=A(null!==(e=this.$refs.dashboardItem)&&void 0!==e?e:[]);try{for(n.s();!(o=n.n()).done;){o.value.onGroupScopeChanged()}}catch(t){n.e(t)}finally{n.f()}},onGroupScopeRemove:function(t){var e;this.$store.commit("removeGroupScope",t),this.updateRight();var o,n=A(null!==(e=this.$refs.dashboardItem)&&void 0!==e?e:[]);try{for(n.s();!(o=n.n()).done;){o.value.onGroupScopeChanged()}}catch(t){n.e(t)}finally{n.f()}},onDashboardRemove:function(t){this.isSaveEnabled&&this.$store.getters.isNeedShowDeletionWarningPopup?(this.deletionWarning.dashboardId=t.dashboardId,this.deletionWarning.popupShown=!0):(this.$store.commit("removeDashboard",t.dashboardId),this.updateRight())},confirmDashboardDeletion:function(t){this.$store.commit("removeDashboard",this.deletionWarning.dashboardId),t.dontShow&&(BX.userOptions.save("biconnector","deleteDashboardFromGroupPopup","needShow",!1),this.$store.commit("setShowDeletionWarningPopup",!1)),this.deletionWarning.dashboardId=null,this.deletionWarning.popupShown=!1,this.updateRight()},cancelDashboardDeletion:function(){this.deletionWarning.dashboardId=null,this.deletionWarning.popupShown=!1},saveGroup:function(){var t=this;this.$store.commit("setIsLoading",!0),r.ajax.runAction("biconnector.group.save",{data:{group:this.$store.getters.groupData,dashboards:babelHelpers.toConsumableArray(this.$store.getters.dashboards.values())}}).then((function(){t.$store.commit("setIsLoading",!1),t.closePopup(),s.EventEmitter.emit("BIConnector.GroupPopup:onGroupSaved",{group:r.Runtime.clone(t.$store.getters.groupData),dashboards:r.Runtime.clone(t.$store.getters.dashboards)})})).catch((function(e){var o;BX.UI.Notification.Center.notify({content:null===(o=e.errors[0])||void 0===o?void 0:o.message}),t.$store.commit("setIsLoading",!1)}))},closePopup:function(){n.PopupManager.getPopupById("biconnector-dashboard-group").close()}},components:{BIcon:a.BIcon,DashboardItem:v,DashboardSelector:I,GroupScopeSelector:P,TitleEditor:$,DeletionWarningPopup:w},template:'\n\t\t<div class="group-header">\n\t\t\t<TitleEditor @on-name-update="updateRight" :can-edit="!isSystemGroup"/>\n\t\t\t<div class="group-header-controls">\n\t\t\t\t<BIcon\n\t\t\t\t\t:name="set.CROSS_25"\n\t\t\t\t\t:size="25"\n\t\t\t\t\tcolor="#BDC1C6"\n\t\t\t\t\t:class="\'group-close\'"\n\t\t\t\t\t@click="closePopup"\n\t\t\t\t></BIcon>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="group-button-panel">\n\t\t\t<div class="group-button-wrapper">\n\t\t\t\t<DashboardSelector :dashboards="dashboards" @on-dashboards-change="updateRight"/>\n\t\t\t</div>\n\t\t\t<div class="group-scope-selector">\n\t\t\t\t<GroupScopeSelector @on-group-scope-add="onGroupScopeAdd" @on-group-scope-remove="onGroupScopeRemove" :can-edit="!isSystemGroup"/>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="group-dashboard-empty" v-if="isNoDashboards">\n\t\t\t<img class="group-dashboard-empty-image" src="/bitrix/images/biconnector/dashboard-groups/empty-state.svg" alt="No dashboards">\n\t\t\t<div class="group-dashboard-empty-title">{{ $Bitrix.Loc.getMessage(\'BI_GROUP_EMPTY_TITLE\') }}</div>\n\t\t\t<div class="group-dashboard-empty-subtitle">{{ $Bitrix.Loc.getMessage(\'BI_GROUP_EMPTY_SUBTITLE\') }}</div>\n\t\t</div>\n\t\t<div class="group-dashboard-list" :class="{\'group-dashboard-list-scroll\': isDashboardListScrollable}" v-else>\n\t\t\t<DashboardItem \n\t\t\t\tv-for="dashboard of dashboards" \n\t\t\t\tref="dashboardItem" \n\t\t\t\t:dashboard="dashboard" \n\t\t\t\t@on-dashboard-change="updateRight"\n\t\t\t\t@on-dashboard-remove="onDashboardRemove"\n\t\t\t/>\n\t\t</div>\n\t\t<div class="group-footer" v-if="isSaveEnabled">\n\t\t\t<div\n\t\t\t\t:class="[\'ui-btn ui-btn-primary ui-btn-md ui-btn-round ui-btn-no-caps group-footer-button\', {\'ui-btn-disabled ui-btn-clock\': isLoading}]" \n\t\t\t\t@click="saveGroup"\n\t\t\t>\n\t\t\t\t{{ $Bitrix.Loc.getMessage(\'BI_GROUP_SAVE\') }}\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tclass="ui-btn ui-btn-light-border ui-btn-md ui-btn-round ui-btn-no-caps group-footer-button"\n\t\t\t\t@click="closePopup"\n\t\t\t>\n\t\t\t\t{{ $Bitrix.Loc.getMessage(\'BI_GROUP_SAVE_CANCEL\') }}\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="group-loader" v-if="isLoading"></div>\n\t\t<DeletionWarningPopup \n\t\t\tv-if="deletionWarning.popupShown" \n\t\t\t@confirm="confirmDashboardDeletion" \n\t\t\t@close="cancelDashboardDeletion"\n\t\t/>\n\t'},_=function(){function t(){babelHelpers.classCallCheck(this,t)}return babelHelpers.createClass(t,null,[{key:"open",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.getApp(t),o=new n.Popup({id:"biconnector-dashboard-group",width:800,height:560,overlay:!0,closeIcon:!1,autoHide:!0,padding:0,cacheable:!1,content:'<div id="app"></div>',events:{onPopupClose:function(){e.unmount()}}});o.show(),e.mount("#app")}},{key:"getApp",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=t.groups.find((function(e){return e.id===t.groupId}));o||(o={id:"new_G0",name:r.Loc.getMessage("BI_GROUP_NAME_NEW"),type:d.custom,scopes:[],dashboardIds:[]});var n={group:o,otherGroups:t.groups.filter((function(e){return e.id!==t.groupId})),dashboards:t.dashboards,saveEnabled:t.saveEnabled,isLoading:!1,isNeedShowDeletionWarningPopup:t.isNeedShowDeletionWarningPopup},s=e.BitrixVue.createApp({name:"GroupPopupApp",data:function(){return{}},components:{App:E},computed:{componentName:function(){return E}},template:"\n\t\t\t\t<App/>\n\t\t\t"}),i=f.buildStore(n);return s.use(i),s}}]),t}();t.DashboardGroup=_,t.GroupType=d}(this.BX.BIConnector=this.BX.BIConnector||{},BX.Vue3,BX.Vue3.Vuex,BX.Main,BX,BX.Event,BX.UI.EntitySelector,BX.UI.IconSet,BX.Vue3.Directives);
//# sourceMappingURL=dashboard-group.bundle.js.map
