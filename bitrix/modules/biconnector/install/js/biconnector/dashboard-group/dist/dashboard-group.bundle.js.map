{"version":3,"file":"dashboard-group.bundle.js","sources":["../src/type.js","../src/store.js","../src/components/dashboard-scope-selector.js","../src/components/dashboard-item.js","../src/components/dashboard-selector.js","../src/components/deletion-warning-popup.js","../src/components/group-scope-selector.js","../src/components/title-editor.js","../src/app.js","../src/dashboard-group.js"],"sourcesContent":["export type User = {\n\tid: number,\n\tisAdmin: boolean,\n\thasAccessToPermission: boolean,\n\taccessibleGroupIds: string[],\n};\n\nexport type GroupAppParams = {\n\tgroupId: string,\n\tgroups: Group[],\n\tdashboards: Map<number, Dashboard>,\n\tsaveEnabled: boolean,\n\tuser: User,\n};\n\nexport type GroupAppState = {\n\tgroup: Group,\n\totherGroups: Group[],\n\tdashboards: Map<number, Dashboard>,\n\tsaveEnabled: boolean,\n\tisLoading: boolean,\n\tuser: User,\n};\n\nexport const GroupType = {\n\tsystem: 'SYSTEM',\n\tcustom: 'CUSTOM',\n};\n\nexport const DashboardType = {\n\tsystem: 'SYSTEM',\n\tmarket: 'MARKET',\n\tcustom: 'CUSTOM',\n};\n\nexport type Group = {\n\tid: string,\n\tname: string,\n\ttype: GroupType.system | GroupType.custom,\n\tscopes: Scope[],\n\tdashboardIds: number[],\n}\n\nexport type Dashboard = {\n\tid: number,\n\tname: string,\n\ttype: DashboardType.system | DashboardType.market | DashboardType.custom,\n\tscopes: Scope[],\n\tcreatedById: number,\n\townerId: number,\n};\n\nexport type Scope = {\n\tcode: string,\n\tname: string,\n};\n","/* eslint-disable no-param-reassign */\nimport { Runtime } from 'main.core';\nimport { createStore } from 'ui.vue3.vuex';\nimport { type Group, type Dashboard, type Scope, GroupType, GroupAppState } from './type';\n\nexport class Store\n{\n\tstatic initialGroup: Group;\n\n\t// eslint-disable-next-line max-lines-per-function\n\tstatic buildStore(defaultValues: GroupAppState)\n\t{\n\t\tStore.initialGroup = Runtime.clone(defaultValues.group);\n\n\t\treturn createStore({\n\t\t\tstate(): GroupAppState\n\t\t\t{\n\t\t\t\treturn defaultValues;\n\t\t\t},\n\t\t\tmutations: {\n\t\t\t\tsetIsLoading(state: GroupAppState, isLoading: boolean)\n\t\t\t\t{\n\t\t\t\t\tstate.isLoading = isLoading;\n\t\t\t\t},\n\t\t\t\tsetGroupName(state: GroupAppState, groupName: string)\n\t\t\t\t{\n\t\t\t\t\tstate.group.name = groupName;\n\t\t\t\t},\n\t\t\t\taddDashboard(state: GroupAppState, dashboard: Dashboard)\n\t\t\t\t{\n\t\t\t\t\tstate.group.dashboardIds.unshift(dashboard.id);\n\n\t\t\t\t\tconst groupScopes = state.group.scopes;\n\t\t\t\t\tif (state.dashboards.get(dashboard.id))\n\t\t\t\t\t{\n\t\t\t\t\t\tdashboard.scopes = state.dashboards.get(dashboard.id).scopes;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst dashboardScopeCodes = new Set(dashboard.scopes.map((dashScope: Scope) => dashScope.code));\n\t\t\t\t\tfor (const groupScope: Scope of groupScopes)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!dashboardScopeCodes.has(groupScope.code))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdashboard.scopes.push(groupScope);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tstate.dashboards.set(dashboard.id, dashboard);\n\t\t\t\t},\n\t\t\t\tremoveDashboard(state: GroupAppState, dashboardId: number)\n\t\t\t\t{\n\t\t\t\t\tconst dashboard: Dashboard = state.dashboards.get(dashboardId);\n\t\t\t\t\tif (!dashboard)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tstate.group.dashboardIds = state.group.dashboardIds.filter((id) => id !== dashboardId);\n\t\t\t\t\tfor (const groupScope: Scope of state.group.scopes)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet dashboardIsInOtherGroupWithScope = false;\n\t\t\t\t\t\tfor (const otherGroup: Group of state.otherGroups)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\totherGroup.dashboardIds.includes(dashboardId)\n\t\t\t\t\t\t\t\t&& otherGroup.scopes.some((item: Scope) => item.code === groupScope.code)\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tdashboardIsInOtherGroupWithScope = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t!dashboardIsInOtherGroupWithScope\n\t\t\t\t\t\t\t&& dashboard.scopes.some((item: Scope) => item.code === groupScope.code)\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdashboard.scopes = dashboard.scopes.filter((item: Scope) => item.code !== groupScope.code);\n\t\t\t\t\t\t\tstate.dashboards.set(dashboardId, dashboard);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetDashboardScopes(state: GroupAppState, data: {dashboardId: number, scopes: Scope[]})\n\t\t\t\t{\n\t\t\t\t\tconst { dashboardId, scopes } = data;\n\t\t\t\t\tconst dashboard: Dashboard = state.dashboards.get(dashboardId);\n\t\t\t\t\tdashboard.scopes = scopes;\n\t\t\t\t},\n\t\t\t\taddGroupScope(state: GroupAppState, scope: Scope)\n\t\t\t\t{\n\t\t\t\t\tstate.group.scopes.push(scope);\n\t\t\t\t\tconst newScopeCode = scope.code;\n\t\t\t\t\tfor (const dashboardId: number of state.group.dashboardIds)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst dashboard = state.dashboards.get(dashboardId);\n\t\t\t\t\t\tif (!dashboard.scopes.some((item: Scope) => item.code === newScopeCode))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdashboard.scopes.push(scope);\n\t\t\t\t\t\t\tstate.dashboards.set(dashboardId, dashboard);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tremoveGroupScope(state: GroupAppState, scope: Scope)\n\t\t\t\t{\n\t\t\t\t\tstate.group.scopes = state.group.scopes.filter((existingScope: Scope) => existingScope.code !== scope.code);\n\t\t\t\t\tconst deletedScopeCode = scope.code;\n\t\t\t\t\tfor (const dashboardId: number of state.group.dashboardIds)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet dashboardIsInOtherGroupWithScope = false;\n\t\t\t\t\t\tfor (const otherGroup: Group of state.otherGroups)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\totherGroup.dashboardIds.includes(dashboardId)\n\t\t\t\t\t\t\t\t&& otherGroup.scopes.some((item: Scope) => item.code === deletedScopeCode)\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tdashboardIsInOtherGroupWithScope = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!dashboardIsInOtherGroupWithScope)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst dashboard = state.dashboards.get(dashboardId);\n\t\t\t\t\t\t\tif (dashboard.scopes.some((item: Scope) => item.code === deletedScopeCode))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tdashboard.scopes = dashboard.scopes.filter((item: Scope) => item.code !== deletedScopeCode);\n\t\t\t\t\t\t\t\tstate.dashboards.set(dashboardId, dashboard);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\tgetters: {\n\t\t\t\tuser(state: GroupAppState): User\n\t\t\t\t{\n\t\t\t\t\treturn state.user;\n\t\t\t\t},\n\t\t\t\tgroupName(state: GroupAppState): string\n\t\t\t\t{\n\t\t\t\t\treturn state.group.name;\n\t\t\t\t},\n\t\t\t\tgroupScopes(state: GroupAppState): Scope[]\n\t\t\t\t{\n\t\t\t\t\treturn state.group.scopes;\n\t\t\t\t},\n\t\t\t\tdashboards(state: GroupAppState): Map<number, Dashboard>\n\t\t\t\t{\n\t\t\t\t\treturn state.dashboards;\n\t\t\t\t},\n\t\t\t\totherGroups(state: GroupAppState): Group[]\n\t\t\t\t{\n\t\t\t\t\treturn state.otherGroups;\n\t\t\t\t},\n\t\t\t\tgroupDashboardsData(state: GroupAppState): Dashboard[]\n\t\t\t\t{\n\t\t\t\t\tconst result = [];\n\t\t\t\t\tfor (const dashboardId of state.group.dashboardIds)\n\t\t\t\t\t{\n\t\t\t\t\t\tresult.push(state.dashboards.get(dashboardId));\n\t\t\t\t\t}\n\n\t\t\t\t\treturn result;\n\t\t\t\t},\n\t\t\t\tisSystemGroup(state: GroupAppState): boolean\n\t\t\t\t{\n\t\t\t\t\treturn state.group.type === GroupType.system;\n\t\t\t\t},\n\t\t\t\tgroupData(state: GroupAppState): Group\n\t\t\t\t{\n\t\t\t\t\treturn {\n\t\t\t\t\t\tid: state.group.id,\n\t\t\t\t\t\tname: state.group.name,\n\t\t\t\t\t\ttype: state.group.type,\n\t\t\t\t\t\tscopes: state.group.scopes,\n\t\t\t\t\t\tdashboardIds: state.group.dashboardIds,\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\tisSaveEnabled(state: GroupAppState): boolean\n\t\t\t\t{\n\t\t\t\t\treturn state.saveEnabled;\n\t\t\t\t},\n\t\t\t\tisLoading(state: GroupAppState): boolean\n\t\t\t\t{\n\t\t\t\t\treturn state.isLoading;\n\t\t\t\t},\n\t\t\t\tisGroupScope(state: GroupAppState): (dashboardId: number, scopeCode: string) => boolean\n\t\t\t\t{\n\t\t\t\t\treturn (dashboardId: number, scopeCode: string) => {\n\t\t\t\t\t\tif (state.group.scopes.some((groupScope: Scope) => groupScope.code === scopeCode))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfor (const otherGroup of state.otherGroups)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\totherGroup.dashboardIds.includes(dashboardId)\n\t\t\t\t\t\t\t\t&& otherGroup.scopes.some((groupScope: Scope) => groupScope.code === scopeCode)\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\taccessibleDashboardIdsSet(state: GroupAppState): Set\n\t\t\t\t{\n\t\t\t\t\treturn new Set(\n\t\t\t\t\t\tstate.otherGroups\n\t\t\t\t\t\t\t.filter((group) => state.user.accessibleGroupIds.includes(group.id))\n\t\t\t\t\t\t\t.flatMap((group) => group.dashboardIds),\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t\tshouldShowDeleteWarning(state: GroupAppState, getters): (dashboardId: number) => boolean\n\t\t\t\t{\n\t\t\t\t\treturn (dashboardId: number) => {\n\t\t\t\t\t\tconst user = state.user;\n\n\t\t\t\t\t\tif (user.isAdmin || user.hasAccessToPermission)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst dashboard: Dashboard = state.dashboards.get(dashboardId);\n\n\t\t\t\t\t\tif (!dashboard)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tdashboard.createdById === user.id\n\t\t\t\t\t\t\t|| dashboard.ownerId === user.id\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn !getters.accessibleDashboardIdsSet.has(dashboardId);\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\tisTitleEdited(state: GroupAppState): boolean\n\t\t\t\t{\n\t\t\t\t\treturn state.group.name !== Store.initialGroup.name;\n\t\t\t\t},\n\t\t\t\tisDashboardListEdited(state: GroupAppState): boolean\n\t\t\t\t{\n\t\t\t\t\treturn !Store.areSetsEqual(\n\t\t\t\t\t\tnew Set(Store.initialGroup.dashboardIds),\n\t\t\t\t\t\tnew Set(state.group.dashboardIds),\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t\tisScopeListEdited(state: GroupAppState): boolean\n\t\t\t\t{\n\t\t\t\t\treturn !Store.areSetsEqual(\n\t\t\t\t\t\tnew Set(Store.initialGroup.scopes.map((scope: Scope) => scope.code)),\n\t\t\t\t\t\tnew Set(state.group.scopes.map((scope: Scope) => scope.code)),\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\tstatic areSetsEqual(setA: Set, setB: Set): boolean\n\t{\n\t\tif (setA.size !== setB.size)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tfor (const item of setA)\n\t\t{\n\t\t\tif (!setB.has(item))\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n}\n","import type { BitrixVueComponentProps } from 'ui.vue3';\nimport { Dom, Event, UI, Text } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Dialog, Item } from 'ui.entity-selector';\nimport { Store } from '../store';\n// eslint-disable-next-line no-unused-vars\nimport type { Scope, Dashboard } from '../type';\n\nexport const DashboardScopeSelector: BitrixVueComponentProps = {\n\tprops: {\n\t\tdashboard: {\n\t\t\t/** @type Dashboard */\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): Object {\n\t\treturn {\n\t\t\tscopeNameLengthLimit: 30,\n\t\t\tinitialScopedIds: [],\n\t\t};\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tif (this.dialog)\n\t\t{\n\t\t\tthis.dialog.destroy();\n\t\t}\n\t\tthis.dialog = null;\n\n\t\tconst node: ?HTMLElement = this.$el.querySelector('.scope-hint');\n\t\tif (node)\n\t\t{\n\t\t\tEvent.unbindAll(node);\n\t\t}\n\t},\n\tcomputed: {\n\t\tvisibleScopes(): Scope[]\n\t\t{\n\t\t\treturn this.scopes.slice(0, 3);\n\t\t},\n\t\tscopes(): Scope[]\n\t\t{\n\t\t\treturn [...this.dashboard.scopes];\n\t\t},\n\t\tisGroupScope(): (scopeCode: string) => boolean\n\t\t{\n\t\t\treturn (scopeCode: string) => this.$store.getters.isGroupScope(this.dashboard.id, scopeCode);\n\t\t},\n\t\tscopeText(): string\n\t\t{\n\t\t\tconst formattedScopes = [];\n\t\t\tfor (const [index: number, scope: Scope] of this.visibleScopes.entries())\n\t\t\t{\n\t\t\t\tconst name = this.formatScopeName(scope.name);\n\t\t\t\tconst suffix: string = index < this.visibleScopes.length - 1 ? ', ' : '';\n\n\t\t\t\tconst element: string = `\n\t\t\t\t\t<span \n\t\t\t\t\t\tclass=\"scope-name\"\n\t\t\t\t\t\ttitle=\"${scope.name.length > this.scopeNameLengthLimit ? Text.encode(scope.name) : ''}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t${Text.encode(name + suffix)}\n\t\t\t\t\t</span>\n\t\t\t\t`;\n\n\t\t\t\tformattedScopes.push(element);\n\t\t\t}\n\n\t\t\tif (this.scopes.length <= 3)\n\t\t\t{\n\t\t\t\treturn formattedScopes.join('');\n\t\t\t}\n\n\t\t\treturn this.$Bitrix.Loc.getMessage('BI_GROUP_SCOPES_DASHBOARD')\n\t\t\t\t.replace('#FIRST_SCOPES#', formattedScopes.join(''))\n\t\t\t\t.replace('[hint]', '<span class=\"scope-list scope-list-more scope-hint\">')\n\t\t\t\t.replace('[/hint]', '</span>')\n\t\t\t\t.replace('#NUMBER#', this.dashboard.scopes.length - 3)\n\t\t\t;\n\t\t},\n\t},\n\temits: [\n\t\t'onScopeChange',\n\t],\n\tmethods: {\n\t\tformatScopeName(scopeName: string): string\n\t\t{\n\t\t\tif (scopeName.length < this.scopeNameLengthLimit)\n\t\t\t{\n\t\t\t\treturn scopeName;\n\t\t\t}\n\n\t\t\treturn `${scopeName.slice(0, this.scopeNameLengthLimit)}...`;\n\t\t},\n\t\topenSelector(): void\n\t\t{\n\t\t\tif (!this.dialog)\n\t\t\t{\n\t\t\t\tthis.initDialog();\n\t\t\t}\n\n\t\t\tthis.initialScopedIds = this.dashboard.scopes.map((scope: Scope) => scope.code);\n\n\t\t\tthis.dialog.show();\n\t\t},\n\t\tinitDialog(): void\n\t\t{\n\t\t\tconst preselectedItems = [];\n\t\t\tconst undeselectedItems = [];\n\t\t\tfor (const scope: Scope of this.dashboard.scopes)\n\t\t\t{\n\t\t\t\tpreselectedItems.push(['biconnector-superset-scope', scope.code]);\n\t\t\t\tif (this.isGroupScope(scope.code))\n\t\t\t\t{\n\t\t\t\t\tundeselectedItems.push(['biconnector-superset-scope', scope.code]);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.dialog = new Dialog({\n\t\t\t\tid: 'dashboard-scope-selector',\n\t\t\t\ttargetNode: this.$refs.dashboardScopes,\n\t\t\t\twidth: 350,\n\t\t\t\theight: 300,\n\t\t\t\tdropdownMode: true,\n\t\t\t\tcompactView: true,\n\t\t\t\tshowAvatars: false,\n\t\t\t\tenableSearch: true,\n\t\t\t\tpreload: true,\n\t\t\t\tpreselectedItems,\n\t\t\t\tundeselectedItems,\n\t\t\t\tentities: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'biconnector-superset-scope',\n\t\t\t\t\t\tdynamicLoad: true,\n\t\t\t\t\t\tdynamicSearch: true,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onSelect': this.handleScopeAdd,\n\t\t\t\t\t'Item:onDeselect': this.handleScopeRemove,\n\t\t\t\t\tonHide: this.handleDialogHide,\n\t\t\t\t},\n\t\t\t});\n\t\t\tthis.dialog.getPopup().setOffset({ offsetLeft: -320 });\n\t\t\tthis.dialog.adjustPosition();\n\t\t\tDom.addClass(this.dialog.getContainer(), 'biconnector-scope-selector');\n\t\t},\n\t\thandleScopeAdd(event: BaseEvent): void\n\t\t{\n\t\t\tconst addedItem: Item = event.getData().item;\n\t\t\tconst scopes: Scope[] = this.scopes;\n\t\t\tscopes.push({\n\t\t\t\tcode: addedItem.getId(),\n\t\t\t\tname: addedItem.getTitle(),\n\t\t\t});\n\t\t\tthis.$store.commit('setDashboardScopes', {\n\t\t\t\tdashboardId: this.dashboard.id,\n\t\t\t\tscopes,\n\t\t\t});\n\t\t\tthis.$emit('onScopeChange');\n\t\t},\n\t\thandleScopeRemove(event: BaseEvent): void\n\t\t{\n\t\t\tconst removedItem: Item = event.getData().item;\n\t\t\tconst scopes = this.scopes.filter((item: Scope) => item.code !== removedItem.id);\n\t\t\tthis.$store.commit('setDashboardScopes', {\n\t\t\t\tdashboardId: this.dashboard.id,\n\t\t\t\tscopes,\n\t\t\t});\n\t\t\tthis.$emit('onScopeChange');\n\t\t},\n\t\thandleDialogHide(event: BaseEvent): void\n\t\t{\n\t\t\tconst wasChanged: boolean = !Store.areSetsEqual(\n\t\t\t\tnew Set(this.initialScopedIds),\n\t\t\t\tnew Set(this.dashboard.scopes.map((scope: Scope) => scope.code)),\n\t\t\t);\n\n\t\t\tEventEmitter.emit(\n\t\t\t\t'BIConnector.GroupPopup.DashboardScopeSelector:onDialogHide',\n\t\t\t\t{\n\t\t\t\t\tisScopeListEdited: wasChanged,\n\t\t\t\t},\n\t\t\t);\n\t\t},\n\t\tshowMoreScopesHint(): void\n\t\t{\n\t\t\tconst hintNode = this.$el.querySelector('.scope-hint');\n\t\t\tthis.hintManager.show(hintNode, this.scopes.slice(3).map((scope: Scope) => scope.name).join(', '), false);\n\t\t},\n\t\thideMoreScopesHint(): void\n\t\t{\n\t\t\tthis.hintManager.hide();\n\t\t\tthis.hintManager.popup = null;\n\t\t},\n\t\tonGroupScopeChanged(): void\n\t\t{\n\t\t\tthis.dialog?.destroy();\n\t\t\tthis.dialog = null;\n\t\t},\n\t\tattachHintHandlers(): void\n\t\t{\n\t\t\tconst node: ?HTMLElement = this.$el.querySelector('.scope-hint');\n\t\t\tif (node)\n\t\t\t{\n\t\t\t\tEvent.unbindAll(node);\n\t\t\t\tEvent.bind(node, 'mouseenter', this.showMoreScopesHint);\n\t\t\t\tEvent.bind(node, 'mouseleave', this.hideMoreScopesHint);\n\t\t\t}\n\t\t},\n\t},\n\tmounted(): void\n\t{\n\t\tthis.hintManager = UI.Hint.createInstance({\n\t\t\tid: `dashboard-scope-hint-${Date.now()}`,\n\t\t\tpopupParameters: {\n\t\t\t\tbindOptions: {\n\t\t\t\t\tposition: 'bottom',\n\t\t\t\t},\n\t\t\t\twidth: 190,\n\t\t\t\toffsetLeft: -80,\n\t\t\t\tangle: {\n\t\t\t\t\tposition: 'top',\n\t\t\t\t\toffset: 130,\n\t\t\t\t},\n\t\t\t\tcacheable: false,\n\t\t\t},\n\t\t});\n\t\tthis.attachHintHandlers();\n\t},\n\tupdated(): void\n\t{\n\t\tthis.attachHintHandlers();\n\t},\n\ttemplate: `\n\t\t<div class=\"group-dashboard-scopes-container\">\n\t\t\t<span class=\"scope-list scope-list-dashboard\" @click=\"openSelector\">\n\t\t\t\t<span\n\t\t\t\t\tv-if=\"scopes.length > 0\"\n\t\t\t\t\tv-html=\"scopeText\"\n\t\t\t\t></span>\n\t\t\t\t<span v-else class=\"scope-list-empty\">\n\t\t\t\t\t{{$Bitrix.Loc.getMessage('BI_GROUP_DASHBOARD_SCOPES_EMPTY')}}\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t\t<span ref=\"dashboardScopes\"></span>\n\t\t</div>\n\t`,\n};\n","import { EventEmitter } from 'main.core.events';\nimport type { BitrixVueComponentProps } from 'ui.vue3';\n// eslint-disable-next-line no-unused-vars\nimport { DashboardType, type Dashboard } from '../type';\nimport { DashboardScopeSelector } from './dashboard-scope-selector';\nimport { BIcon, Set } from 'ui.icon-set.api.vue';\n\nexport const DashboardItem: BitrixVueComponentProps = {\n\tprops: {\n\t\tdashboard: {\n\t\t\t/** @type Dashboard */\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed: {\n\t\ticonPath(): string\n\t\t{\n\t\t\tif (this.dashboard.type === DashboardType.system)\n\t\t\t{\n\t\t\t\treturn '/bitrix/images/biconnector/superset-dashboard-selector/icon-type-system.png';\n\t\t\t}\n\n\t\t\tif (this.dashboard.type === DashboardType.market)\n\t\t\t{\n\t\t\t\treturn '/bitrix/images/biconnector/superset-dashboard-selector/icon-type-market.png';\n\t\t\t}\n\n\t\t\treturn '/bitrix/images/biconnector/superset-dashboard-selector/icon-type-custom.png';\n\t\t},\n\t\tset(): Set\n\t\t{\n\t\t\treturn Set;\n\t\t},\n\t},\n\tmethods: {\n\t\tonRemoveClick(): void\n\t\t{\n\t\t\tEventEmitter.emit(\n\t\t\t\t'BIConnector.GroupPopup.DashboardList:onDashboardRemove',\n\t\t\t\t{\n\t\t\t\t\tisDashboardListEdited: true,\n\t\t\t\t},\n\t\t\t);\n\t\t\tthis.$emit('onDashboardRemove', { dashboardId: this.dashboard.id });\n\t\t\tthis.emitDashboardChange();\n\t\t},\n\t\temitDashboardChange(): void\n\t\t{\n\t\t\tthis.$emit('onDashboardChange');\n\t\t},\n\t\tonGroupScopeChanged(): void\n\t\t{\n\t\t\tthis.$refs.scopeSelector.onGroupScopeChanged();\n\t\t},\n\t},\n\temits: [\n\t\t'onDashboardChange',\n\t\t'onDashboardRemove',\n\t],\n\tcomponents: {\n\t\tBIcon,\n\t\tDashboardScopeSelector,\n\t},\n\ttemplate: `\n\t\t<div class=\"group-dashboard\">\n\t\t\t<img class=\"group-dashboard-icon\" :src=\"iconPath\" width=\"32\" height=\"32\" alt=\"Dashboard icon\">\n\t\t\t<div class=\"group-dashboard-name\" :title=\"dashboard.name\">{{dashboard.name}}</div>\n\t\t\t<DashboardScopeSelector :dashboard=\"dashboard\" ref=\"scopeSelector\" @on-scope-change=\"emitDashboardChange\"/>\n\t\t\t<BIcon\n\t\t\t\t:name=\"set.CROSS_20\"\n\t\t\t\t:size=\"20\"\n\t\t\t\tcolor=\"#BDC1C6\"\n\t\t\t\t:class=\"'group-dashboard-remove-icon'\"\n\t\t\t\t@click=\"onRemoveClick\"\n\t\t\t></BIcon>\n\t\t</div>\n\t`,\n};\n","import type { BitrixVueComponentProps } from 'ui.vue3';\nimport { DashboardType, type Dashboard } from '../type';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Dialog, Item } from 'ui.entity-selector';\nimport { Store } from '../store';\n\nexport const DashboardSelector: BitrixVueComponentProps = {\n\tprops: {\n\t\tdashboards: {\n\t\t\t/** @type Dashboard[] */\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata()\n\t{\n\t\treturn {\n\t\t\tinitialDashboardIds: [],\n\t\t\tbypassDeselectHandler: false,\n\t\t};\n\t},\n\tmounted()\n\t{\n\t\tthis.initDialog();\n\t},\n\tmethods: {\n\t\tonAddDashboardClick()\n\t\t{\n\t\t\tthis.initialDashboardIds = this.dashboards.map((dashboard: Dashboard) => dashboard.id);\n\t\t\tthis.dialog.show();\n\t\t},\n\t\tinitDialog()\n\t\t{\n\t\t\tconst preselectedItems = [];\n\t\t\tfor (const dashboard: Dashboard of this.dashboards)\n\t\t\t{\n\t\t\t\tpreselectedItems.push(['biconnector-superset-dashboard', dashboard.id]);\n\t\t\t}\n\t\t\tthis.dialog = new Dialog({\n\t\t\t\tid: 'group-dashboard-selector',\n\t\t\t\ttargetNode: this.$refs.addDashboardButton,\n\t\t\t\twidth: 400,\n\t\t\t\theight: 300,\n\t\t\t\tdropdownMode: true,\n\t\t\t\tenableSearch: true,\n\t\t\t\tpreload: true,\n\t\t\t\tpreselectedItems,\n\t\t\t\tentities: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'biconnector-superset-dashboard',\n\t\t\t\t\t\tdynamicLoad: true,\n\t\t\t\t\t\tdynamicSearch: true,\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tloadProxyData: false,\n\t\t\t\t\t\t\tcheckAccessRights: this.$store.getters.isSaveEnabled,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\ttagSelectorOptions: {\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonBeforeTagRemove: (event: BaseEvent) => {\n\t\t\t\t\t\t\tif (this.bypassDeselectHandler)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst tag = event.data.tag;\n\t\t\t\t\t\t\tconst dashboardId = tag.getId();\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\tthis.$store.getters.isSaveEnabled\n\t\t\t\t\t\t\t\t&& this.$store.getters.shouldShowDeleteWarning(dashboardId)\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\t\tthis.dialog.setAutoHide(false);\n\t\t\t\t\t\t\t\tthis.$emit('onBeforeRemoveConfirmation', { dashboardId });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onSelect': (event: BaseEvent) => {\n\t\t\t\t\t\tconst item: Item = event.data.item;\n\t\t\t\t\t\tconst dashboard: Dashboard = {\n\t\t\t\t\t\t\tid: item.getId(),\n\t\t\t\t\t\t\tname: item.getTitle(),\n\t\t\t\t\t\t\ttype: item.getCustomData().get('type') ?? DashboardType.system,\n\t\t\t\t\t\t\tcreatedById: item.getCustomData().get('createdById'),\n\t\t\t\t\t\t\townerId: item.getCustomData().get('ownerId'),\n\t\t\t\t\t\t\tscopes: item.getCustomData().get('scopes') ?? [],\n\t\t\t\t\t\t};\n\t\t\t\t\t\tthis.$store.commit('addDashboard', dashboard);\n\t\t\t\t\t\tthis.$emit('onDashboardsChange');\n\t\t\t\t\t},\n\t\t\t\t\t'Item:onBeforeDeselect': (event: BaseEvent) => {\n\t\t\t\t\t\tif (this.bypassDeselectHandler)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst item: Item = event.data.item;\n\t\t\t\t\t\tconst dashboardId = item.getId();\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tthis.$store.getters.isSaveEnabled\n\t\t\t\t\t\t\t&& this.$store.getters.shouldShowDeleteWarning(dashboardId)\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\tthis.dialog.setAutoHide(false);\n\t\t\t\t\t\t\tthis.$emit('onBeforeRemoveConfirmation', { dashboardId });\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t'Item:onDeselect': (event: BaseEvent) => {\n\t\t\t\t\t\tconst item: Item = event.data.item;\n\t\t\t\t\t\tthis.$store.commit('removeDashboard', item.getId());\n\t\t\t\t\t\tthis.$emit('onDashboardsChange');\n\t\t\t\t\t},\n\t\t\t\t\tonHide: (event: BaseEvent): void => {\n\t\t\t\t\t\tconst wasChanged: boolean = !Store.areSetsEqual(\n\t\t\t\t\t\t\tnew Set(this.initialDashboardIds),\n\t\t\t\t\t\t\tnew Set(this.dashboards.map((dashboard: Dashboard) => dashboard.id)),\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tEventEmitter.emit(\n\t\t\t\t\t\t\t'BIConnector.GroupPopup.DashboardSelector:onDialogHide',\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tisDashboardListEdited: wasChanged,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t\tdeselect(dashboardId: number)\n\t\t{\n\t\t\tthis.bypassDeselectHandler = true;\n\t\t\tthis.dialog.getItem({ entityId: 'biconnector-superset-dashboard', id: dashboardId })?.deselect();\n\t\t},\n\t\tresetDialog()\n\t\t{\n\t\t\tthis.dialog.setAutoHide(true);\n\t\t\tthis.bypassDeselectHandler = false;\n\t\t},\n\t},\n\temits: [\n\t\t'onBeforeRemoveConfirmation',\n\t\t'onDashboardsChange',\n\t],\n\twatch: {\n\t\tdashboards(newValue, oldValue)\n\t\t{\n\t\t\tconst dialog: Dialog = this.dialog;\n\t\t\tfor (const oldItem of oldValue)\n\t\t\t{\n\t\t\t\tif (!newValue.includes(oldItem))\n\t\t\t\t{\n\t\t\t\t\tdialog.getItem(['biconnector-superset-dashboard', oldItem.id])?.deselect();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"ui-btn ui-btn-primary ui-btn-sm ui-btn-round ui-btn-icon-add ui-btn-no-caps group-add-dashboards-button\"\n\t\t\t@click=\"onAddDashboardClick\"\n\t\t\tref=\"addDashboardButton\"\n\t\t>\n\t\t\t{{ $Bitrix.Loc.getMessage('BI_GROUP_ADD_DASHBOARD') }}\n\t\t</div>\n\t`,\n};\n","import type { BitrixVueComponentProps } from 'ui.vue3';\nimport { Popup as MainPopup, PopupManager, type PopupOptions } from 'main.popup';\nimport { BIcon } from 'ui.icon-set.api.vue';\nimport { Outline } from 'ui.icon-set.api.core';\nimport { Button as UiButton, AirButtonStyle, ButtonSize } from 'ui.vue3.components.button';\n\nexport const DeletionWarningPopup: BitrixVueComponentProps = {\n\temits: ['confirm', 'close'],\n\tprops: {},\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tButtonSize,\n\t\t\tAirButtonStyle,\n\t\t\tOutline,\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tpopupInstance: null,\n\t\t\tpopupId: 'biconnector-dashboard-deletion',\n\t\t\tdontShow: false,\n\t\t};\n\t},\n\tcomputed: {\n\t\tpopupOptions(): PopupOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tid: this.popupId,\n\t\t\t\tcontent: this.$refs.content,\n\t\t\t\twidth: 410,\n\t\t\t\tpadding: 12,\n\t\t\t\tborderRadius: '16px',\n\t\t\t\tautoHide: true,\n\t\t\t\toverlay: true,\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose: this.closePopup,\n\t\t\t\t},\n\t\t\t\tfixed: true,\n\t\t\t};\n\t\t},\n\t},\n\tmethods: {\n\t\tclosePopup(): void\n\t\t{\n\t\t\tif (this.popupInstance)\n\t\t\t{\n\t\t\t\tPopupManager.getPopupById(this.popupId)?.destroy();\n\t\t\t\tthis.popupInstance = null;\n\t\t\t\tthis.$emit('close');\n\t\t\t}\n\t\t},\n\t\tonConfirm(): void\n\t\t{\n\t\t\tthis.$emit('confirm', { dontShow: this.dontShow });\n\t\t\tthis.closePopup();\n\t\t},\n\t\tgetPopupText(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('BI_GROUP_SAVE_WARN_TEXT_MSGVER_1');\n\t\t},\n\t},\n\tmounted(): void\n\t{\n\t\tif (!this.popupInstance)\n\t\t{\n\t\t\tthis.popupInstance = new MainPopup(this.popupOptions);\n\t\t}\n\n\t\tthis.popupInstance.show();\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tthis.closePopup();\n\t},\n\tcomponents: {\n\t\tBIcon,\n\t\tUiButton,\n\t},\n\ttemplate: `\n\t\t<div ref=\"content\" class=\"group-warn-popup\">\n\t\t\t<div class=\"group-warn-popup-title-block\">\n\t\t\t\t<div class=\"group-warn-popup-title\">{{ $Bitrix.Loc.getMessage('BI_GROUP_SAVE_WARN_TITLE') }}</div>\n\t\t\t\t<BIcon\n\t\t\t\t\t:name=\"Outline.CROSS_L\"\n\t\t\t\t\t:size=\"24\"\n\t\t\t\t\tcolor=\"#A7A7A7\"\n\t\t\t\t\t:class=\"'group-warn-popup-close'\"\n\t\t\t\t\t@click=\"closePopup\"\n\t\t\t\t></BIcon>\n\t\t\t</div>\n\t\t\t<div class=\"group-warn-popup-box\" v-html=\"getPopupText()\"></div>\n\t\t\t<div class=\"group-warn-popup-buttons\">\n\t\t\t\t<UiButton\n\t\t\t\t\t:text=\"$Bitrix.Loc.getMessage('BI_GROUP_SAVE_WARN_YES')\"\n\t\t\t\t\t:size=\"ButtonSize.MEDIUM\"\n\t\t\t\t\t:style=\"AirButtonStyle.FILLED\"\n\t\t\t\t\t@click=\"onConfirm\"\n\t\t\t\t/>\n\t\t\t\t<UiButton\n\t\t\t\t\t:text=\"$Bitrix.Loc.getMessage('BI_GROUP_SAVE_WARN_NO')\"\n\t\t\t\t\t:size=\"ButtonSize.MEDIUM\"\n\t\t\t\t\t:style=\"AirButtonStyle.PLAIN\"\n\t\t\t\t\t@click=\"closePopup\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Dom, Event, Text, UI } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Dialog, Item } from 'ui.entity-selector';\nimport type { BitrixVueComponentProps } from 'ui.vue3';\nimport { BIcon, Set as IconSet } from 'ui.icon-set.api.vue';\nimport { hint } from 'ui.vue3.directives.hint';\nimport type { Scope } from '../type';\nimport { Store } from '../store';\n\nexport const GroupScopeSelector: BitrixVueComponentProps = {\n\tprops: {\n\t\tcanEdit: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdirectives: {\n\t\thint,\n\t},\n\tdata(): Object {\n\t\treturn {\n\t\t\tscopeNameLengthLimit: 30,\n\t\t\tinitialScopedIds: [],\n\t\t};\n\t},\n\tcomputed: {\n\t\tscopes(): Scope[]\n\t\t{\n\t\t\treturn this.$store.getters.groupScopes;\n\t\t},\n\t\thintOptions(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\thtml: this.$Bitrix.Loc.getMessage('BI_GROUP_SCOPE_HINT')\n\t\t\t\t\t.replace('[link]', '<a class=\"scope-hint-link\" onclick=\"top.BX.Helper.show(`redirect=detail&code=25556500`)\">')\n\t\t\t\t\t.replace('[/link]', '</a>'),\n\t\t\t\tinteractivity: true,\n\t\t\t\tpopupOptions: {\n\t\t\t\t\tbindOptions: {\n\t\t\t\t\t\tposition: 'bottom',\n\t\t\t\t\t},\n\t\t\t\t\tautoHide: false,\n\t\t\t\t\twidth: 244,\n\t\t\t\t\toffsetTop: -4,\n\t\t\t\t\tangle: {\n\t\t\t\t\t\tposition: 'top',\n\t\t\t\t\t\toffset: 34,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\tscopeText(): string\n\t\t{\n\t\t\tconst element: string = `\n\t\t\t\t<span\n\t\t\t\t\tclass=\"scope-name ${this.canEdit ? '' : 'scope-list-system'}\"\n\t\t\t\t\ttitle=\"${this.scopes[0].name.length > this.scopeNameLengthLimit ? Text.encode(this.scopes[0].name) : ''}\"\n\t\t\t\t>\n\t\t\t\t\t${Text.encode(this.formatScopeName(this.scopes[0].name))}\n\t\t\t\t</span>\n\t\t\t`;\n\n\t\t\tif (this.scopes.length <= 1)\n\t\t\t{\n\t\t\t\treturn this.$Bitrix.Loc.getMessage('BI_GROUP_SCOPES_GROUP')\n\t\t\t\t\t.replace('[title]', '<span class=\"group-scope-title\">')\n\t\t\t\t\t.replace('[/title]', '</span>')\n\t\t\t\t\t.replace('#SCOPE#', element)\n\t\t\t\t;\n\t\t\t}\n\n\t\t\treturn this.$Bitrix.Loc.getMessage('BI_GROUP_SCOPES_GROUP_MANY')\n\t\t\t\t.replace('[title]', '<span class=\"group-scope-title\">')\n\t\t\t\t.replace('[/title]', '</span>')\n\t\t\t\t.replace('#FIRST_SCOPES#', element)\n\t\t\t\t.replace('[hint]', '<span class=\"scope-list scope-list-more group-scope-hint\">')\n\t\t\t\t.replace('[/hint]', '</span>')\n\t\t\t\t.replace('#NUMBER#', this.scopes.length - 1)\n\t\t\t;\n\t\t},\n\t\temptyScopesText(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('BI_GROUP_SCOPES_GROUP_EMPTY')\n\t\t\t\t.replace('[title]', '<span class=\"group-scope-title\">')\n\t\t\t\t.replace('[/title]', '</span>')\n\t\t\t;\n\t\t},\n\t\tset(): IconSet\n\t\t{\n\t\t\treturn IconSet;\n\t\t},\n\t},\n\tmethods: {\n\t\topenScopeSelector(): void\n\t\t{\n\t\t\tif (!this.canEdit)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.dialog)\n\t\t\t{\n\t\t\t\tthis.initDialog();\n\t\t\t}\n\n\t\t\tthis.initialScopedIds = this.scopes.map((scope: Scope) => scope.code);\n\n\t\t\tthis.dialog.show();\n\t\t},\n\t\tinitDialog(): void\n\t\t{\n\t\t\tconst preselectedItems = [];\n\t\t\tfor (const scope: Scope of this.scopes)\n\t\t\t{\n\t\t\t\tpreselectedItems.push(['biconnector-superset-scope', scope.code]);\n\t\t\t}\n\t\t\tthis.dialog = new Dialog({\n\t\t\t\tid: 'group-scope-selector',\n\t\t\t\ttargetNode: this.$refs.groupScopes,\n\t\t\t\twidth: 350,\n\t\t\t\theight: 300,\n\t\t\t\tdropdownMode: true,\n\t\t\t\tcompactView: true,\n\t\t\t\tshowAvatars: false,\n\t\t\t\tenableSearch: true,\n\t\t\t\tpreload: true,\n\t\t\t\tpreselectedItems,\n\t\t\t\tentities: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'biconnector-superset-scope',\n\t\t\t\t\t\tdynamicLoad: true,\n\t\t\t\t\t\tdynamicSearch: true,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onSelect': this.onGroupScopeAdd,\n\t\t\t\t\t'Item:onDeselect': this.onGroupScopeRemove,\n\t\t\t\t\tonHide: this.onDialogHide,\n\t\t\t\t},\n\t\t\t});\n\t\t\tthis.dialog.getPopup().setOffset({ offsetLeft: -320 });\n\t\t\tthis.dialog.adjustPosition();\n\t\t\tDom.addClass(this.dialog.getContainer(), 'biconnector-scope-selector');\n\t\t},\n\t\tonGroupScopeAdd(event: BaseEvent): void\n\t\t{\n\t\t\tconst item: Item = event.getData().item;\n\t\t\tconst scope: Scope = { code: item.getId(), name: item.getTitle() };\n\t\t\tthis.$emit('onGroupScopeAdd', scope);\n\t\t},\n\t\tonGroupScopeRemove(event: BaseEvent): void\n\t\t{\n\t\t\tconst item: Item = event.getData().item;\n\t\t\tconst scope: Scope = { code: item.getId(), name: item.getTitle() };\n\t\t\tthis.$emit('onGroupScopeRemove', scope);\n\t\t},\n\t\tonDialogHide(event: BaseEvent): void\n\t\t{\n\t\t\tconst wasChanged: boolean = !Store.areSetsEqual(\n\t\t\t\tnew Set(this.initialScopedIds),\n\t\t\t\tnew Set(this.scopes.map((scope: Scope) => scope.code)),\n\t\t\t);\n\n\t\t\tEventEmitter.emit(\n\t\t\t\t'BIConnector.GroupPopup.ScopeSelector:onDialogHide',\n\t\t\t\t{\n\t\t\t\t\tisScopeListEdited: wasChanged,\n\t\t\t\t},\n\t\t\t);\n\t\t},\n\t\tshowMoreScopesHint(): void\n\t\t{\n\t\t\tconst hintNode: HTMLElement = this.$el.querySelector('.group-scope-hint');\n\t\t\tthis.hintManager.show(hintNode, this.scopes.slice(1).map((scope: Scope) => scope.name).join(', '), false);\n\t\t},\n\t\thideMoreScopesHint(): void\n\t\t{\n\t\t\tthis.hintManager.hide();\n\t\t\tthis.hintManager.popup = null;\n\t\t},\n\t\tshowSystemScopesHint(): void\n\t\t{\n\t\t\tconst hintNode: HTMLElement = this.$el.querySelector('.scope-list-system');\n\t\t\tthis.systemScopeHintManager.show(hintNode, this.$Bitrix.Loc.getMessage('BI_GROUP_SYSTEM_SCOPES_HINT'), false);\n\t\t},\n\t\thideSystemScopesHint(): void\n\t\t{\n\t\t\tthis.systemScopeHintManager.hide();\n\t\t\tthis.systemScopeHintManager.popup = null;\n\t\t},\n\t\tformatScopeName(scopeName: string): string\n\t\t{\n\t\t\tif (scopeName.length < this.scopeNameLengthLimit)\n\t\t\t{\n\t\t\t\treturn scopeName;\n\t\t\t}\n\n\t\t\treturn `${scopeName.slice(0, this.scopeNameLengthLimit)}...`;\n\t\t},\n\t\tattachHintHandlers(): void\n\t\t{\n\t\t\tconst node: ?HTMLElement = this.$el.querySelector('.group-scope-hint');\n\t\t\tif (node)\n\t\t\t{\n\t\t\t\tEvent.unbindAll(node);\n\t\t\t\tEvent.bind(node, 'mouseenter', this.showMoreScopesHint);\n\t\t\t\tEvent.bind(node, 'mouseleave', this.hideMoreScopesHint);\n\t\t\t}\n\n\t\t\tif (!this.canEdit)\n\t\t\t{\n\t\t\t\tconst scopeName: ?HTMLElement = this.$el.querySelector('.scope-list-system');\n\t\t\t\tif (scopeName)\n\t\t\t\t{\n\t\t\t\t\tEvent.unbindAll(scopeName);\n\t\t\t\t\tEvent.bind(scopeName, 'mouseenter', this.showSystemScopesHint);\n\t\t\t\t\tEvent.bind(scopeName, 'mouseleave', this.hideSystemScopesHint);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t},\n\tmounted(): void\n\t{\n\t\tthis.hintManager = UI.Hint.createInstance({\n\t\t\tid: 'group-scope-hint',\n\t\t\tpopupParameters: {\n\t\t\t\tbindOptions: {\n\t\t\t\t\tposition: 'bottom',\n\t\t\t\t},\n\t\t\t\twidth: 190,\n\t\t\t\toffsetLeft: -80,\n\t\t\t\tangle: {\n\t\t\t\t\tposition: 'top',\n\t\t\t\t\toffset: 130,\n\t\t\t\t},\n\t\t\t\tcacheable: false,\n\t\t\t},\n\t\t});\n\t\tthis.systemScopeHintManager = UI.Hint.createInstance({\n\t\t\tid: 'system-scope-hint',\n\t\t\tpopupParameters: {\n\t\t\t\tbindOptions: {\n\t\t\t\t\tposition: 'bottom',\n\t\t\t\t},\n\t\t\t\twidth: 244,\n\t\t\t\toffsetLeft: -140,\n\t\t\t\tangle: {\n\t\t\t\t\tposition: 'top',\n\t\t\t\t\toffset: 180,\n\t\t\t\t},\n\t\t\t\tcacheable: false,\n\t\t\t},\n\t\t});\n\t\tthis.attachHintHandlers();\n\t},\n\tupdated(): void\n\t{\n\t\tthis.attachHintHandlers();\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tif (this.dialog)\n\t\t{\n\t\t\tthis.dialog.destroy();\n\t\t}\n\t\tthis.dialog = null;\n\n\t\tconst node: ?HTMLElement = this.$el.querySelector('.group-scope-hint');\n\t\tif (node)\n\t\t{\n\t\t\tEvent.unbindAll(node);\n\t\t}\n\n\t\tconst scopeName: ?HTMLElement = this.$el.querySelector('.scope-list-system');\n\t\tif (scopeName)\n\t\t{\n\t\t\tEvent.unbindAll(scopeName);\n\t\t}\n\t},\n\temits: [\n\t\t'onGroupScopeAdd',\n\t\t'onGroupScopeRemove',\n\t],\n\tcomponents: {\n\t\tBIcon,\n\t},\n\ttemplate: `\n\t\t<div class=\"group-scope-selector\">\n\t\t\t<span\n\t\t\t\tv-if=\"scopes.length > 0\"\n\t\t\t\t@click=\"openScopeSelector\"\n\t\t\t\tclass=\"scope-list scope-list-group\"\n\t\t\t\tv-html=\"scopeText\"\n\t\t\t></span>\n\t\t\t<span\n\t\t\t\tv-else\n\t\t\t\t@click=\"openScopeSelector\"\n\t\t\t\tclass=\"scope-list scope-list-group\"\n\t\t\t\tv-html=\"emptyScopesText\"\n\t\t\t></span>\n\t\t\t<div class=\"group-scope-list-hint\" ref=\"groupScopes\" v-hint=\"hintOptions\">\n\t\t\t\t<BIcon\n\t\t\t\t\t:name=\"set.HELP\"\n\t\t\t\t\t:size=\"20\"\n\t\t\t\t\tcolor=\"#D5D7DB\"\n\t\t\t\t></BIcon>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import type { BitrixVueComponentProps } from 'ui.vue3';\nimport { BIcon, Set } from 'ui.icon-set.api.vue';\nimport { hint } from 'ui.vue3.directives.hint';\n\nexport const TitleEditor: BitrixVueComponentProps = {\n\tprops: {\n\t\tcanEdit: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\teditMode: false,\n\t\t};\n\t},\n\tdirectives: {\n\t\thint,\n\t},\n\tcomputed: {\n\t\tgroupName: {\n\t\t\tget(): string\n\t\t\t{\n\t\t\t\treturn this.$store.getters.groupName;\n\t\t\t},\n\t\t\tset(value): void\n\t\t\t{\n\t\t\t\tthis.$store.commit('setGroupName', value);\n\t\t\t},\n\t\t},\n\t\tset(): Set\n\t\t{\n\t\t\treturn Set;\n\t\t},\n\t\tnameHintOptions(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\ttext: this.$Bitrix.Loc.getMessage('BI_GROUP_SYSTEM_NAME_HINT'),\n\t\t\t\tpopupOptions: {\n\t\t\t\t\tbindOptions: {\n\t\t\t\t\t\tposition: 'bottom',\n\t\t\t\t\t},\n\t\t\t\t\twidth: 220,\n\t\t\t\t\toffsetLeft: 40,\n\t\t\t\t\tangle: {\n\t\t\t\t\t\tposition: 'top',\n\t\t\t\t\t\toffset: 0,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t},\n\tmethods: {\n\t\tsetEditMode()\n\t\t{\n\t\t\tthis.editMode = true;\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.$refs.nameInput.focus();\n\t\t\t});\n\t\t},\n\t\tsetViewMode()\n\t\t{\n\t\t\tthis.editMode = false;\n\t\t\tif (!this.groupName)\n\t\t\t{\n\t\t\t\tthis.$store.commit('setGroupName', this.$Bitrix.Loc.getMessage('BI_GROUP_NAME_NEW'));\n\t\t\t}\n\t\t\tthis.$emit('onNameUpdate');\n\t\t},\n\t},\n\temits: [\n\t\t'onNameUpdate',\n\t],\n\tcomponents: {\n\t\tBIcon,\n\t},\n\ttemplate: `\n\t\t<div class=\"group-header-title\" :style=\"{ width: editMode ? '80%' : 'auto' }\">\n\t\t\t<template v-if=\"canEdit\">\n\t\t\t\t<input v-if=\"editMode\" class=\"group-name-input\" @blur=\"setViewMode\" v-model=\"groupName\" ref=\"nameInput\">\n\t\t\t\t<template v-else>\n\t\t\t\t\t<div class=\"group-name\">{{groupName}}</div>\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\t:name=\"set.PENCIL_40\"\n\t\t\t\t\t\t:size=\"20\"\n\t\t\t\t\t\tcolor=\"#BDC1C6\"\n\t\t\t\t\t\t:class=\"'group-name-edit-icon'\"\n\t\t\t\t\t\t@click=\"setEditMode\"\n\t\t\t\t\t></BIcon>\n\t\t\t\t</template>\n\t\t\t</template>\n\t\t\t<template v-else>\n\t\t\t\t<div class=\"group-name\" v-hint=\"nameHintOptions\">{{groupName}}</div>\n\t\t\t</template>\n\t\t</div>\n\t`,\n};\n","import { ajax as Ajax, Runtime } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Popup, PopupManager } from 'main.popup';\nimport { BIcon, Set } from 'ui.icon-set.api.vue';\nimport type { BitrixVueComponentProps } from 'ui.vue3';\nimport { DashboardItem } from './components/dashboard-item';\nimport { DashboardSelector } from './components/dashboard-selector';\nimport { DeletionWarningPopup } from './components/deletion-warning-popup';\nimport { GroupScopeSelector } from './components/group-scope-selector';\nimport { TitleEditor } from './components/title-editor';\nimport type { Dashboard } from './type';\n\nexport const App: BitrixVueComponentProps = {\n\tmounted(): void\n\t{\n\t\tEventEmitter.subscribe('BIConnector.Internal.GroupPopup:onPopupClose', this.onGroupPopupClose);\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tEventEmitter.unsubscribe('BIConnector.Internal.GroupPopup:onPopupClose', this.onGroupPopupClose);\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tdeletionWarning: {\n\t\t\t\tpopupShown: false,\n\t\t\t\tdashboardId: null,\n\t\t\t},\n\t\t};\n\t},\n\tcomputed: {\n\t\tisNoDashboards(): boolean\n\t\t{\n\t\t\treturn this.$store.state.group.dashboardIds.length === 0;\n\t\t},\n\t\tdashboards(): Dashboard[]\n\t\t{\n\t\t\treturn this.$store.getters.groupDashboardsData;\n\t\t},\n\t\tisSystemGroup(): boolean\n\t\t{\n\t\t\treturn this.$store.getters.isSystemGroup;\n\t\t},\n\t\tisSaveEnabled(): boolean\n\t\t{\n\t\t\treturn this.$store.getters.isSaveEnabled;\n\t\t},\n\t\tisLoading(): boolean\n\t\t{\n\t\t\treturn this.$store.getters.isLoading;\n\t\t},\n\t\tisDashboardListScrollable(): boolean\n\t\t{\n\t\t\tif (this.isSaveEnabled)\n\t\t\t{\n\t\t\t\treturn this.dashboards.length > 6;\n\t\t\t}\n\n\t\t\treturn this.dashboards.length > 7;\n\t\t},\n\t\tset(): Set\n\t\t{\n\t\t\treturn Set;\n\t\t},\n\t},\n\tmethods: {\n\t\thandleDeletionConfirmationRequest(event): void\n\t\t{\n\t\t\tthis.deletionWarning.dashboardId = event.dashboardId;\n\t\t\tthis.deletionWarning.popupShown = true;\n\t\t},\n\t\tupdateRight(): void\n\t\t{\n\t\t\tEventEmitter.emit('BIConnector.GroupPopup:onGroupUpdated', {\n\t\t\t\tgroup: Runtime.clone(this.$store.getters.groupData),\n\t\t\t\tdashboards: Runtime.clone(this.$store.getters.dashboards),\n\t\t\t});\n\t\t},\n\t\tonGroupScopeAdd(event): void\n\t\t{\n\t\t\tthis.$store.commit('addGroupScope', event);\n\t\t\tthis.updateRight();\n\t\t\tfor (const dashboardItem of this.$refs.dashboardItem ?? [])\n\t\t\t{\n\t\t\t\tdashboardItem.onGroupScopeChanged();\n\t\t\t}\n\t\t},\n\t\tonGroupScopeRemove(event): void\n\t\t{\n\t\t\tthis.$store.commit('removeGroupScope', event);\n\t\t\tthis.updateRight();\n\t\t\tfor (const dashboardItem of this.$refs.dashboardItem ?? [])\n\t\t\t{\n\t\t\t\tdashboardItem.onGroupScopeChanged();\n\t\t\t}\n\t\t},\n\t\tonDashboardRemove(event): void\n\t\t{\n\t\t\tconst dashboardId = event.dashboardId;\n\t\t\tif (\n\t\t\t\tthis.isSaveEnabled\n\t\t\t\t&& this.$store.getters.shouldShowDeleteWarning(dashboardId)\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.deletionWarning.dashboardId = dashboardId;\n\t\t\t\tthis.deletionWarning.popupShown = true;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.$store.commit('removeDashboard', dashboardId);\n\t\t\t\tthis.updateRight();\n\t\t\t}\n\t\t},\n\t\tconfirmDashboardDeletion(): void\n\t\t{\n\t\t\tthis.$store.commit('removeDashboard', this.deletionWarning.dashboardId);\n\t\t\tthis.$refs.dashboardSelector.deselect(this.deletionWarning.dashboardId);\n\t\t\tthis.deletionWarning.dashboardId = null;\n\t\t\tthis.deletionWarning.popupShown = false;\n\t\t\tthis.updateRight();\n\t\t},\n\t\tcancelDashboardDeletion(): void\n\t\t{\n\t\t\tthis.$refs.dashboardSelector.resetDialog();\n\t\t\tthis.deletionWarning.dashboardId = null;\n\t\t\tthis.deletionWarning.popupShown = false;\n\t\t},\n\t\tsaveGroup(): void\n\t\t{\n\t\t\tthis.$store.commit('setIsLoading', true);\n\t\t\tAjax.runAction('biconnector.group.save', {\n\t\t\t\tdata: {\n\t\t\t\t\tgroup: this.$store.getters.groupData,\n\t\t\t\t\tdashboards: [...this.$store.getters.dashboards.values()],\n\t\t\t\t},\n\t\t\t})\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.$store.commit('setIsLoading', false);\n\t\t\t\t\tthis.closePopup();\n\t\t\t\t\tEventEmitter.emit('BIConnector.GroupPopup:onGroupSaved', {\n\t\t\t\t\t\tgroup: Runtime.clone(this.$store.getters.groupData),\n\t\t\t\t\t\tdashboards: Runtime.clone(this.$store.getters.dashboards),\n\t\t\t\t\t\tisTitleEdited: this.$store.getters.isTitleEdited,\n\t\t\t\t\t\tisDashboardListEdited: this.$store.getters.isDashboardListEdited,\n\t\t\t\t\t\tisScopeListEdited: this.$store.getters.isScopeListEdited,\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch((response) => {\n\t\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: response.errors[0]?.message,\n\t\t\t\t\t});\n\t\t\t\t\tthis.$store.commit('setIsLoading', false);\n\t\t\t\t})\n\t\t\t;\n\t\t},\n\t\tclosePopup(): void\n\t\t{\n\t\t\tconst popup: Popup = PopupManager.getPopupById('biconnector-dashboard-group');\n\t\t\tpopup.close();\n\t\t},\n\t\tonGroupPopupClose(): void\n\t\t{\n\t\t\tEventEmitter.emit('BIConnector.GroupPopup:onPopupClose', {\n\t\t\t\tgroup: this.$store.getters.groupData,\n\t\t\t\tisTitleEdited: this.$store.getters.isTitleEdited,\n\t\t\t\tisDashboardListEdited: this.$store.getters.isDashboardListEdited,\n\t\t\t\tisScopeListEdited: this.$store.getters.isScopeListEdited,\n\t\t\t});\n\t\t},\n\t},\n\tcomponents: {\n\t\tBIcon,\n\t\tDashboardItem,\n\t\tDashboardSelector,\n\t\tGroupScopeSelector,\n\t\tTitleEditor,\n\t\tDeletionWarningPopup,\n\t},\n\ttemplate: `\n\t\t<div class=\"group-header\">\n\t\t\t<TitleEditor @on-name-update=\"updateRight\" :can-edit=\"!isSystemGroup\"/>\n\t\t\t<div class=\"group-header-controls\">\n\t\t\t\t<BIcon\n\t\t\t\t\t:name=\"set.CROSS_25\"\n\t\t\t\t\t:size=\"25\"\n\t\t\t\t\tcolor=\"#BDC1C6\"\n\t\t\t\t\t:class=\"'group-close'\"\n\t\t\t\t\t@click=\"closePopup\"\n\t\t\t\t></BIcon>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"group-button-panel\">\n\t\t\t<div class=\"group-button-wrapper\">\n\t\t\t\t<DashboardSelector\n\t\t\t\t\t:dashboards=\"dashboards\"\n\t\t\t\t\t@on-dashboards-change=\"updateRight\"\n\t\t\t\t\t@on-before-remove-confirmation=\"handleDeletionConfirmationRequest\"\n\t\t\t\t\tref=\"dashboardSelector\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<GroupScopeSelector @on-group-scope-add=\"onGroupScopeAdd\" @on-group-scope-remove=\"onGroupScopeRemove\" :can-edit=\"!isSystemGroup\"/>\n\t\t</div>\n\t\t<div class=\"group-dashboard-empty\" v-if=\"isNoDashboards\">\n\t\t\t<img class=\"group-dashboard-empty-image\" src=\"/bitrix/images/biconnector/dashboard-groups/empty-state.svg\" alt=\"No dashboards\">\n\t\t\t<div class=\"group-dashboard-empty-title\">{{ $Bitrix.Loc.getMessage('BI_GROUP_EMPTY_TITLE') }}</div>\n\t\t\t<div class=\"group-dashboard-empty-subtitle\">{{ $Bitrix.Loc.getMessage('BI_GROUP_EMPTY_SUBTITLE') }}</div>\n\t\t</div>\n\t\t<div class=\"group-dashboard-list\" :class=\"{'group-dashboard-list-scroll': isDashboardListScrollable}\" v-else>\n\t\t\t<DashboardItem\n\t\t\t\tv-for=\"dashboard of dashboards\"\n\t\t\t\t:key=\"dashboard.id\"\n\t\t\t\tref=\"dashboardItem\"\n\t\t\t\t:dashboard=\"dashboard\"\n\t\t\t\t@on-dashboard-change=\"updateRight\"\n\t\t\t\t@on-dashboard-remove=\"onDashboardRemove\"\n\t\t\t/>\n\t\t</div>\n\t\t<div class=\"group-footer\" v-if=\"isSaveEnabled\">\n\t\t\t<div\n\t\t\t\t:class=\"['ui-btn ui-btn-primary ui-btn-md ui-btn-round ui-btn-no-caps group-footer-button', {'ui-btn-disabled ui-btn-clock': isLoading}]\" \n\t\t\t\t@click=\"saveGroup\"\n\t\t\t>\n\t\t\t\t{{ $Bitrix.Loc.getMessage('BI_GROUP_SAVE') }}\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tclass=\"ui-btn ui-btn-light-border ui-btn-md ui-btn-round ui-btn-no-caps group-footer-button\"\n\t\t\t\t@click=\"closePopup\"\n\t\t\t>\n\t\t\t\t{{ $Bitrix.Loc.getMessage('BI_GROUP_SAVE_CANCEL_MSGVER_1') }}\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"group-loader\" v-if=\"isLoading\"></div>\n\t\t<DeletionWarningPopup \n\t\t\tv-if=\"deletionWarning.popupShown\" \n\t\t\t@confirm=\"confirmDashboardDeletion\" \n\t\t\t@close=\"cancelDashboardDeletion\"\n\t\t/>\n\t`,\n};\n","import { EventEmitter } from 'main.core.events';\nimport { Popup } from 'main.popup';\nimport { Loc } from 'main.core';\nimport { BitrixVue } from 'ui.vue3';\nimport { Store } from './store';\nimport { App } from './app';\nimport { type Group, GroupAppParams, GroupAppState, GroupType } from './type';\n\nexport class DashboardGroup\n{\n\tstatic open(appParams: GroupAppParams = {})\n\t{\n\t\tconst app = this.getApp(appParams);\n\n\t\tconst popup = new Popup({\n\t\t\tid: 'biconnector-dashboard-group',\n\t\t\twidth: 800,\n\t\t\theight: 560,\n\t\t\toverlay: true,\n\t\t\tcloseIcon: false,\n\t\t\tautoHide: true,\n\t\t\tpadding: 0,\n\t\t\tcacheable: false,\n\t\t\tcontent: '<div id=\"app\"></div>',\n\t\t\tevents: {\n\t\t\t\tonPopupClose: () => {\n\t\t\t\t\tEventEmitter.emit('BIConnector.Internal.GroupPopup:onPopupClose');\n\n\t\t\t\t\tapp.unmount();\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t\tpopup.show();\n\t\tapp.mount('#app');\n\t}\n\n\tstatic getApp(appParams: GroupAppParams = {})\n\t{\n\t\tlet group: Group = appParams.groups.find((item: Group) => item.id === appParams.groupId);\n\t\tif (!group)\n\t\t{\n\t\t\tgroup = {\n\t\t\t\tid: 'new_G0',\n\t\t\t\tname: Loc.getMessage('BI_GROUP_NAME_NEW'),\n\t\t\t\ttype: GroupType.custom,\n\t\t\t\tscopes: [],\n\t\t\t\tdashboardIds: [],\n\t\t\t};\n\t\t}\n\t\tconst state: GroupAppState = {\n\t\t\tgroup,\n\t\t\totherGroups: appParams.groups.filter((item: Group) => item.id !== appParams.groupId),\n\t\t\tdashboards: appParams.dashboards,\n\t\t\tsaveEnabled: appParams.saveEnabled,\n\t\t\tisLoading: false,\n\t\t\tuser: appParams.user,\n\t\t};\n\n\t\tconst app = BitrixVue.createApp({\n\t\t\tname: 'GroupPopupApp',\n\t\t\tdata()\n\t\t\t{\n\t\t\t\treturn {};\n\t\t\t},\n\t\t\tcomponents: {\n\t\t\t\tApp,\n\t\t\t},\n\t\t\tcomputed: {\n\t\t\t\tcomponentName()\n\t\t\t\t{\n\t\t\t\t\treturn App;\n\t\t\t\t},\n\t\t\t},\n\t\t\t// language=Vue\n\t\t\ttemplate: `\n\t\t\t\t<App/>\n\t\t\t`,\n\t\t});\n\n\t\tconst store = Store.buildStore(state);\n\t\tapp.use(store);\n\n\t\treturn app;\n\t}\n}\n"],"names":["GroupType","system","custom","DashboardType","Store","babelHelpers","key","value","defaultValues","initialGroup","Runtime","clone","group","createStore","state","mutations","setIsLoading","isLoading","setGroupName","groupName","name","addDashboard","dashboard","dashboardIds","unshift","id","groupScopes","scopes","dashboards","get","_step","dashboardScopeCodes","Set","map","dashScope","code","groupScope","has","push","_iterator","set","removeDashboard","dashboardId","filter","_step2","_step3","dashboardIsInOtherGroupWithScope","otherGroups","otherGroup","includes","some","item","_iterator3","_loop","_iterator2","setDashboardScopes","data","addGroupScope","scope","_step4","newScopeCode","_iterator4","removeGroupScope","existingScope","_step5","deletedScopeCode","_step6","_iterator6","_iterator5","getters","user","groupDashboardsData","_step7","result","_iterator7","isSystemGroup","type","groupData","isSaveEnabled","saveEnabled","isGroupScope","scopeCode","_step8","_iterator8","accessibleDashboardIdsSet","accessibleGroupIds","flatMap","shouldShowDeleteWarning","isAdmin","hasAccessToPermission","createdById","ownerId","isTitleEdited","isDashboardListEdited","areSetsEqual","isScopeListEdited","setA","setB","size","_step9","_iterator9","DashboardScopeSelector","props","Object","required","scopeNameLengthLimit","initialScopedIds","beforeUnmount","this","dialog","destroy","node","$el","querySelector","Event","unbindAll","computed","visibleScopes","slice","_this","$store","scopeText","formattedScopes","entries","index","formatScopeName","suffix","length","element","Text","encode","join","$Bitrix","Loc","getMessage","replace","emits","methods","scopeName","openSelector","initDialog","show","preselectedItems","undeselectedItems","Dialog","targetNode","$refs","dashboardScopes","width","height","dropdownMode","compactView","showAvatars","enableSearch","preload","entities","dynamicLoad","dynamicSearch","events","Item:onSelect","handleScopeAdd","Item:onDeselect","handleScopeRemove","onHide","handleDialogHide","getPopup","setOffset","offsetLeft","adjustPosition","Dom","addClass","getContainer","event","addedItem","getData","getId","getTitle","commit","$emit","removedItem","wasChanged","EventEmitter","emit","showMoreScopesHint","hintNode","hintManager","hideMoreScopesHint","hide","popup","onGroupScopeChanged","_this$dialog","attachHintHandlers","bind","mounted","UI","Hint","createInstance","Date","now","popupParameters","bindOptions","position","angle","offset","cacheable","updated","template","DashboardItem","iconPath","onRemoveClick","emitDashboardChange","scopeSelector","components","BIcon","DashboardSelector","Array","initialDashboardIds","bypassDeselectHandler","onAddDashboardClick","addDashboardButton","options","loadProxyData","checkAccessRights","tagSelectorOptions","onBeforeTagRemove","tag","preventDefault","setAutoHide","getCustomData","Item:onBeforeDeselect","deselect","getItem","entityId","_this$dialog$getItem","resetDialog","watch","newValue","oldValue","oldItem","_dialog$getItem","DeletionWarningPopup","setup","ButtonSize","AirButtonStyle","Outline","popupInstance","popupId","dontShow","popupOptions","content","padding","borderRadius","autoHide","overlay","onPopupClose","closePopup","fixed","PopupManager","getPopupById","_PopupManager$getPopu","onConfirm","getPopupText","MainPopup","UiButton","GroupScopeSelector","canEdit","Boolean","directives","hint","hintOptions","html","interactivity","offsetTop","emptyScopesText","IconSet","openScopeSelector","onGroupScopeAdd","onGroupScopeRemove","onDialogHide","showSystemScopesHint","systemScopeHintManager","hideSystemScopesHint","TitleEditor","editMode","nameHintOptions","text","setEditMode","$nextTick","nameInput","focus","setViewMode","App","subscribe","onGroupPopupClose","unsubscribe","deletionWarning","popupShown","isNoDashboards","isDashboardListScrollable","handleDeletionConfirmationRequest","updateRight","dashboardItem","onDashboardRemove","confirmDashboardDeletion","dashboardSelector","cancelDashboardDeletion","saveGroup","Ajax","runAction","values","then","response","BX","Notification","Center","notify","errors","_response$errors$","message","close","DashboardGroup","appParams","app","getApp","Popup","closeIcon","unmount","mount","groups","find","groupId","BitrixVue","createApp","componentName","store","buildStore","use"],"mappings":"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"}