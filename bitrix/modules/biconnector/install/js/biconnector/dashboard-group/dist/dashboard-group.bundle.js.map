{"version":3,"file":"dashboard-group.bundle.js","sources":["../src/type.js","../src/store.js","../src/components/dashboard-scope-selector.js","../src/components/dashboard-item.js","../src/components/dashboard-selector.js","../src/components/deletion-warning-popup.js","../src/components/group-scope-selector.js","../src/components/title-editor.js","../src/app.js","../src/dashboard-group.js"],"sourcesContent":["export type GroupAppParams = {\n\tgroupId: string,\n\tgroups: Group[],\n\tdashboards: Map<number, Dashboard>,\n\tsaveEnabled: boolean,\n\tisNeedShowDeletionWarningPopup: boolean,\n};\n\nexport type GroupAppState = {\n\tgroup: Group,\n\totherGroups: Group[],\n\tdashboards: Map<number, Dashboard>,\n\tsaveEnabled: boolean,\n\tisLoading: boolean,\n\tisNeedShowDeletionWarningPopup: boolean,\n};\n\nexport const GroupType = {\n\tsystem: 'SYSTEM',\n\tcustom: 'CUSTOM',\n};\n\nexport const DashboardType = {\n\tsystem: 'SYSTEM',\n\tmarket: 'MARKET',\n\tcustom: 'CUSTOM',\n};\n\nexport type Group = {\n\tid: string,\n\tname: string,\n\ttype: GroupType.system | GroupType.custom,\n\tscopes: Scope[],\n\tdashboardIds: number[],\n}\n\nexport type Dashboard = {\n\tid: number,\n\tname: string,\n\ttype: DashboardType.system | DashboardType.market | DashboardType.custom,\n\tscopes: Scope[],\n};\n\nexport type Scope = {\n\tcode: string,\n\tname: string,\n};\n","/* eslint-disable no-param-reassign */\nimport { Runtime } from 'main.core';\nimport { createStore } from 'ui.vue3.vuex';\nimport { type Group, type Dashboard, type Scope, GroupType, GroupAppState } from './type';\n\nexport class Store\n{\n\tstatic initialGroup: Group;\n\n\t// eslint-disable-next-line max-lines-per-function\n\tstatic buildStore(defaultValues: GroupAppState)\n\t{\n\t\tStore.initialGroup = Runtime.clone(defaultValues.group);\n\n\t\treturn createStore({\n\t\t\tstate(): GroupAppState\n\t\t\t{\n\t\t\t\treturn defaultValues;\n\t\t\t},\n\t\t\tmutations: {\n\t\t\t\tsetIsLoading(state: GroupAppState, isLoading: boolean)\n\t\t\t\t{\n\t\t\t\t\tstate.isLoading = isLoading;\n\t\t\t\t},\n\t\t\t\tsetGroupName(state: GroupAppState, groupName: string)\n\t\t\t\t{\n\t\t\t\t\tstate.group.name = groupName;\n\t\t\t\t},\n\t\t\t\taddDashboard(state: GroupAppState, dashboard: Dashboard)\n\t\t\t\t{\n\t\t\t\t\tstate.group.dashboardIds.unshift(dashboard.id);\n\n\t\t\t\t\tconst groupScopes = state.group.scopes;\n\t\t\t\t\tif (state.dashboards.get(dashboard.id))\n\t\t\t\t\t{\n\t\t\t\t\t\tdashboard.scopes = state.dashboards.get(dashboard.id).scopes;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst dashboardScopeCodes = new Set(dashboard.scopes.map((dashScope: Scope) => dashScope.code));\n\t\t\t\t\tfor (const groupScope: Scope of groupScopes)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!dashboardScopeCodes.has(groupScope.code))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdashboard.scopes.push(groupScope);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tstate.dashboards.set(dashboard.id, dashboard);\n\t\t\t\t},\n\t\t\t\tremoveDashboard(state: GroupAppState, dashboardId: number)\n\t\t\t\t{\n\t\t\t\t\tconst dashboard: Dashboard = state.dashboards.get(dashboardId);\n\t\t\t\t\tif (!dashboard)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tstate.group.dashboardIds = state.group.dashboardIds.filter((id) => id !== dashboardId);\n\t\t\t\t\tfor (const groupScope: Scope of state.group.scopes)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet dashboardIsInOtherGroupWithScope = false;\n\t\t\t\t\t\tfor (const otherGroup: Group of state.otherGroups)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\totherGroup.dashboardIds.includes(dashboardId)\n\t\t\t\t\t\t\t\t&& otherGroup.scopes.some((item: Scope) => item.code === groupScope.code)\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tdashboardIsInOtherGroupWithScope = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t!dashboardIsInOtherGroupWithScope\n\t\t\t\t\t\t\t&& dashboard.scopes.some((item: Scope) => item.code === groupScope.code)\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdashboard.scopes = dashboard.scopes.filter((item: Scope) => item.code !== groupScope.code);\n\t\t\t\t\t\t\tstate.dashboards.set(dashboardId, dashboard);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetDashboardScopes(state: GroupAppState, data: {dashboardId: number, scopes: Scope[]})\n\t\t\t\t{\n\t\t\t\t\tconst { dashboardId, scopes } = data;\n\t\t\t\t\tconst dashboard: Dashboard = state.dashboards.get(dashboardId);\n\t\t\t\t\tdashboard.scopes = scopes;\n\t\t\t\t},\n\t\t\t\taddGroupScope(state: GroupAppState, scope: Scope)\n\t\t\t\t{\n\t\t\t\t\tstate.group.scopes.push(scope);\n\t\t\t\t\tconst newScopeCode = scope.code;\n\t\t\t\t\tfor (const dashboardId: number of state.group.dashboardIds)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst dashboard = state.dashboards.get(dashboardId);\n\t\t\t\t\t\tif (!dashboard.scopes.some((item: Scope) => item.code === newScopeCode))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdashboard.scopes.push(scope);\n\t\t\t\t\t\t\tstate.dashboards.set(dashboardId, dashboard);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tremoveGroupScope(state: GroupAppState, scope: Scope)\n\t\t\t\t{\n\t\t\t\t\tstate.group.scopes = state.group.scopes.filter((existingScope: Scope) => existingScope.code !== scope.code);\n\t\t\t\t\tconst deletedScopeCode = scope.code;\n\t\t\t\t\tfor (const dashboardId: number of state.group.dashboardIds)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet dashboardIsInOtherGroupWithScope = false;\n\t\t\t\t\t\tfor (const otherGroup: Group of state.otherGroups)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\totherGroup.dashboardIds.includes(dashboardId)\n\t\t\t\t\t\t\t\t&& otherGroup.scopes.some((item: Scope) => item.code === deletedScopeCode)\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tdashboardIsInOtherGroupWithScope = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!dashboardIsInOtherGroupWithScope)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst dashboard = state.dashboards.get(dashboardId);\n\t\t\t\t\t\t\tif (dashboard.scopes.some((item: Scope) => item.code === deletedScopeCode))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tdashboard.scopes = dashboard.scopes.filter((item: Scope) => item.code !== deletedScopeCode);\n\t\t\t\t\t\t\t\tstate.dashboards.set(dashboardId, dashboard);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetShowDeletionWarningPopup(state: GroupAppState, isShow: boolean): void\n\t\t\t\t{\n\t\t\t\t\tstate.isNeedShowDeletionWarningPopup = isShow;\n\t\t\t\t},\n\t\t\t},\n\t\t\tgetters: {\n\t\t\t\tgroupName(state: GroupAppState): string\n\t\t\t\t{\n\t\t\t\t\treturn state.group.name;\n\t\t\t\t},\n\t\t\t\tgroupScopes(state: GroupAppState): Scope[]\n\t\t\t\t{\n\t\t\t\t\treturn state.group.scopes;\n\t\t\t\t},\n\t\t\t\tdashboards(state: GroupAppState): Map<number, Dashboard>\n\t\t\t\t{\n\t\t\t\t\treturn state.dashboards;\n\t\t\t\t},\n\t\t\t\tgroupDashboardsData(state: GroupAppState): Dashboard[]\n\t\t\t\t{\n\t\t\t\t\tconst result = [];\n\t\t\t\t\tfor (const dashboardId of state.group.dashboardIds)\n\t\t\t\t\t{\n\t\t\t\t\t\tresult.push(state.dashboards.get(dashboardId));\n\t\t\t\t\t}\n\n\t\t\t\t\treturn result;\n\t\t\t\t},\n\t\t\t\tisSystemGroup(state: GroupAppState): boolean\n\t\t\t\t{\n\t\t\t\t\treturn state.group.type === GroupType.system;\n\t\t\t\t},\n\t\t\t\tgroupData(state: GroupAppState): Group\n\t\t\t\t{\n\t\t\t\t\treturn {\n\t\t\t\t\t\tid: state.group.id,\n\t\t\t\t\t\tname: state.group.name,\n\t\t\t\t\t\ttype: state.group.type,\n\t\t\t\t\t\tscopes: state.group.scopes,\n\t\t\t\t\t\tdashboardIds: state.group.dashboardIds,\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\tisSaveEnabled(state: GroupAppState): boolean\n\t\t\t\t{\n\t\t\t\t\treturn state.saveEnabled;\n\t\t\t\t},\n\t\t\t\tisLoading(state: GroupAppState): boolean\n\t\t\t\t{\n\t\t\t\t\treturn state.isLoading;\n\t\t\t\t},\n\t\t\t\tisGroupScope(state: GroupAppState): (dashboardId: number, scopeCode: string) => boolean\n\t\t\t\t{\n\t\t\t\t\treturn (dashboardId: number, scopeCode: string) => {\n\t\t\t\t\t\tif (state.group.scopes.some((groupScope: Scope) => groupScope.code === scopeCode))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfor (const otherGroup of state.otherGroups)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\totherGroup.dashboardIds.includes(dashboardId)\n\t\t\t\t\t\t\t\t&& otherGroup.scopes.some((groupScope: Scope) => groupScope.code === scopeCode)\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\tisNeedShowDeletionWarningPopup(state: GroupAppState): boolean\n\t\t\t\t{\n\t\t\t\t\treturn state.isNeedShowDeletionWarningPopup;\n\t\t\t\t},\n\t\t\t\tisTitleEdited(state: GroupAppState): boolean\n\t\t\t\t{\n\t\t\t\t\treturn state.group.name !== Store.initialGroup.name;\n\t\t\t\t},\n\t\t\t\tisDashboardListEdited(state: GroupAppState): boolean\n\t\t\t\t{\n\t\t\t\t\treturn !Store.areSetsEqual(\n\t\t\t\t\t\tnew Set(Store.initialGroup.dashboardIds),\n\t\t\t\t\t\tnew Set(state.group.dashboardIds),\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t\tisScopeListEdited(state: GroupAppState): boolean\n\t\t\t\t{\n\t\t\t\t\treturn !Store.areSetsEqual(\n\t\t\t\t\t\tnew Set(Store.initialGroup.scopes.map((scope: Scope) => scope.code)),\n\t\t\t\t\t\tnew Set(state.group.scopes.map((scope: Scope) => scope.code)),\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\tstatic areSetsEqual(setA: Set, setB: Set): boolean\n\t{\n\t\tif (setA.size !== setB.size)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tfor (const item of setA)\n\t\t{\n\t\t\tif (!setB.has(item))\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n}\n","import type { BitrixVueComponentProps } from 'ui.vue3';\nimport { Dom, Event, UI, Text } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Dialog, Item } from 'ui.entity-selector';\nimport { Store } from '../store';\n// eslint-disable-next-line no-unused-vars\nimport type { Scope, Dashboard } from '../type';\n\nexport const DashboardScopeSelector: BitrixVueComponentProps = {\n\tprops: {\n\t\tdashboard: {\n\t\t\t/** @type Dashboard */\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): Object {\n\t\treturn {\n\t\t\tscopeNameLengthLimit: 30,\n\t\t\tinitialScopedIds: [],\n\t\t};\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tif (this.dialog)\n\t\t{\n\t\t\tthis.dialog.destroy();\n\t\t}\n\t\tthis.dialog = null;\n\n\t\tconst node: ?HTMLElement = this.$el.querySelector('.scope-hint');\n\t\tif (node)\n\t\t{\n\t\t\tEvent.unbindAll(node);\n\t\t}\n\t},\n\tcomputed: {\n\t\tvisibleScopes(): Scope[]\n\t\t{\n\t\t\treturn this.scopes.slice(0, 3);\n\t\t},\n\t\tscopes(): Scope[]\n\t\t{\n\t\t\treturn [...this.dashboard.scopes];\n\t\t},\n\t\tisGroupScope(): (scopeCode: string) => boolean\n\t\t{\n\t\t\treturn (scopeCode: string) => this.$store.getters.isGroupScope(this.dashboard.id, scopeCode);\n\t\t},\n\t\tscopeText(): string\n\t\t{\n\t\t\tconst formattedScopes = [];\n\t\t\tfor (const [index: number, scope: Scope] of this.visibleScopes.entries())\n\t\t\t{\n\t\t\t\tconst name = this.formatScopeName(scope.name);\n\t\t\t\tconst suffix: string = index < this.visibleScopes.length - 1 ? ', ' : '';\n\n\t\t\t\tconst element: string = `\n\t\t\t\t\t<span \n\t\t\t\t\t\tclass=\"scope-name\"\n\t\t\t\t\t\ttitle=\"${scope.name.length > this.scopeNameLengthLimit ? Text.encode(scope.name) : ''}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t${Text.encode(name + suffix)}\n\t\t\t\t\t</span>\n\t\t\t\t`;\n\n\t\t\t\tformattedScopes.push(element);\n\t\t\t}\n\n\t\t\tif (this.scopes.length <= 3)\n\t\t\t{\n\t\t\t\treturn formattedScopes.join('');\n\t\t\t}\n\n\t\t\treturn this.$Bitrix.Loc.getMessage('BI_GROUP_SCOPES_DASHBOARD')\n\t\t\t\t.replace('#FIRST_SCOPES#', formattedScopes.join(''))\n\t\t\t\t.replace('[hint]', '<span class=\"scope-list scope-list-more scope-hint\">')\n\t\t\t\t.replace('[/hint]', '</span>')\n\t\t\t\t.replace('#NUMBER#', this.dashboard.scopes.length - 3)\n\t\t\t;\n\t\t},\n\t},\n\temits: [\n\t\t'onScopeChange',\n\t],\n\tmethods: {\n\t\tformatScopeName(scopeName: string): string\n\t\t{\n\t\t\tif (scopeName.length < this.scopeNameLengthLimit)\n\t\t\t{\n\t\t\t\treturn scopeName;\n\t\t\t}\n\n\t\t\treturn `${scopeName.slice(0, this.scopeNameLengthLimit)}...`;\n\t\t},\n\t\topenSelector(): void\n\t\t{\n\t\t\tif (!this.dialog)\n\t\t\t{\n\t\t\t\tthis.initDialog();\n\t\t\t}\n\n\t\t\tthis.initialScopedIds = this.dashboard.scopes.map((scope: Scope) => scope.code);\n\n\t\t\tthis.dialog.show();\n\t\t},\n\t\tinitDialog(): void\n\t\t{\n\t\t\tconst preselectedItems = [];\n\t\t\tconst undeselectedItems = [];\n\t\t\tfor (const scope: Scope of this.dashboard.scopes)\n\t\t\t{\n\t\t\t\tpreselectedItems.push(['biconnector-superset-scope', scope.code]);\n\t\t\t\tif (this.isGroupScope(scope.code))\n\t\t\t\t{\n\t\t\t\t\tundeselectedItems.push(['biconnector-superset-scope', scope.code]);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.dialog = new Dialog({\n\t\t\t\tid: 'dashboard-scope-selector',\n\t\t\t\ttargetNode: this.$refs.dashboardScopes,\n\t\t\t\twidth: 350,\n\t\t\t\theight: 300,\n\t\t\t\tdropdownMode: true,\n\t\t\t\tcompactView: true,\n\t\t\t\tshowAvatars: false,\n\t\t\t\tenableSearch: true,\n\t\t\t\tpreload: true,\n\t\t\t\tpreselectedItems,\n\t\t\t\tundeselectedItems,\n\t\t\t\tentities: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'biconnector-superset-scope',\n\t\t\t\t\t\tdynamicLoad: true,\n\t\t\t\t\t\tdynamicSearch: true,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onSelect': this.handleScopeAdd,\n\t\t\t\t\t'Item:onDeselect': this.handleScopeRemove,\n\t\t\t\t\tonHide: this.handleDialogHide,\n\t\t\t\t},\n\t\t\t});\n\t\t\tthis.dialog.getPopup().setOffset({ offsetLeft: -320 });\n\t\t\tthis.dialog.adjustPosition();\n\t\t\tDom.addClass(this.dialog.getContainer(), 'biconnector-scope-selector');\n\t\t},\n\t\thandleScopeAdd(event: BaseEvent): void\n\t\t{\n\t\t\tconst addedItem: Item = event.getData().item;\n\t\t\tconst scopes: Scope[] = this.scopes;\n\t\t\tscopes.push({\n\t\t\t\tcode: addedItem.getId(),\n\t\t\t\tname: addedItem.getTitle(),\n\t\t\t});\n\t\t\tthis.$store.commit('setDashboardScopes', {\n\t\t\t\tdashboardId: this.dashboard.id,\n\t\t\t\tscopes,\n\t\t\t});\n\t\t\tthis.$emit('onScopeChange');\n\t\t},\n\t\thandleScopeRemove(event: BaseEvent): void\n\t\t{\n\t\t\tconst removedItem: Item = event.getData().item;\n\t\t\tconst scopes = this.scopes.filter((item: Scope) => item.code !== removedItem.id);\n\t\t\tthis.$store.commit('setDashboardScopes', {\n\t\t\t\tdashboardId: this.dashboard.id,\n\t\t\t\tscopes,\n\t\t\t});\n\t\t\tthis.$emit('onScopeChange');\n\t\t},\n\t\thandleDialogHide(event: BaseEvent): void\n\t\t{\n\t\t\tconst wasChanged: boolean = !Store.areSetsEqual(\n\t\t\t\tnew Set(this.initialScopedIds),\n\t\t\t\tnew Set(this.dashboard.scopes.map((scope: Scope) => scope.code)),\n\t\t\t);\n\n\t\t\tEventEmitter.emit(\n\t\t\t\t'BIConnector.GroupPopup.DashboardScopeSelector:onDialogHide',\n\t\t\t\t{\n\t\t\t\t\tisScopeListEdited: wasChanged,\n\t\t\t\t},\n\t\t\t);\n\t\t},\n\t\tshowMoreScopesHint(): void\n\t\t{\n\t\t\tconst hintNode = this.$el.querySelector('.scope-hint');\n\t\t\tthis.hintManager.show(hintNode, this.scopes.slice(3).map((scope: Scope) => scope.name).join(', '), false);\n\t\t},\n\t\thideMoreScopesHint(): void\n\t\t{\n\t\t\tthis.hintManager.hide();\n\t\t\tthis.hintManager.popup = null;\n\t\t},\n\t\tonGroupScopeChanged(): void\n\t\t{\n\t\t\tthis.dialog?.destroy();\n\t\t\tthis.dialog = null;\n\t\t},\n\t\tattachHintHandlers(): void\n\t\t{\n\t\t\tconst node: ?HTMLElement = this.$el.querySelector('.scope-hint');\n\t\t\tif (node)\n\t\t\t{\n\t\t\t\tEvent.unbindAll(node);\n\t\t\t\tEvent.bind(node, 'mouseenter', this.showMoreScopesHint);\n\t\t\t\tEvent.bind(node, 'mouseleave', this.hideMoreScopesHint);\n\t\t\t}\n\t\t},\n\t},\n\tmounted(): void\n\t{\n\t\tthis.hintManager = UI.Hint.createInstance({\n\t\t\tid: `dashboard-scope-hint-${Date.now()}`,\n\t\t\tpopupParameters: {\n\t\t\t\tbindOptions: {\n\t\t\t\t\tposition: 'bottom',\n\t\t\t\t},\n\t\t\t\twidth: 190,\n\t\t\t\toffsetLeft: -80,\n\t\t\t\tangle: {\n\t\t\t\t\tposition: 'top',\n\t\t\t\t\toffset: 130,\n\t\t\t\t},\n\t\t\t\tcacheable: false,\n\t\t\t},\n\t\t});\n\t\tthis.attachHintHandlers();\n\t},\n\tupdated(): void\n\t{\n\t\tthis.attachHintHandlers();\n\t},\n\ttemplate: `\n\t\t<div class=\"group-dashboard-scopes-container\">\n\t\t\t<span class=\"scope-list scope-list-dashboard\" @click=\"openSelector\">\n\t\t\t\t<span\n\t\t\t\t\tv-if=\"scopes.length > 0\"\n\t\t\t\t\tv-html=\"scopeText\"\n\t\t\t\t></span>\n\t\t\t\t<span v-else class=\"scope-list-empty\">\n\t\t\t\t\t{{$Bitrix.Loc.getMessage('BI_GROUP_DASHBOARD_SCOPES_EMPTY')}}\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t\t<span ref=\"dashboardScopes\"></span>\n\t\t</div>\n\t`,\n};\n","import { EventEmitter } from 'main.core.events';\nimport type { BitrixVueComponentProps } from 'ui.vue3';\n// eslint-disable-next-line no-unused-vars\nimport { DashboardType, type Dashboard } from '../type';\nimport { DashboardScopeSelector } from './dashboard-scope-selector';\nimport { BIcon, Set } from 'ui.icon-set.api.vue';\n\nexport const DashboardItem: BitrixVueComponentProps = {\n\tprops: {\n\t\tdashboard: {\n\t\t\t/** @type Dashboard */\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed: {\n\t\ticonPath(): string\n\t\t{\n\t\t\tif (this.dashboard.type === DashboardType.system)\n\t\t\t{\n\t\t\t\treturn '/bitrix/images/biconnector/superset-dashboard-selector/icon-type-system.png';\n\t\t\t}\n\n\t\t\tif (this.dashboard.type === DashboardType.market)\n\t\t\t{\n\t\t\t\treturn '/bitrix/images/biconnector/superset-dashboard-selector/icon-type-market.png';\n\t\t\t}\n\n\t\t\treturn '/bitrix/images/biconnector/superset-dashboard-selector/icon-type-custom.png';\n\t\t},\n\t\tset(): Set\n\t\t{\n\t\t\treturn Set;\n\t\t},\n\t},\n\tmethods: {\n\t\tonRemoveClick(): void\n\t\t{\n\t\t\tEventEmitter.emit(\n\t\t\t\t'BIConnector.GroupPopup.DashboardList:onDashboardRemove',\n\t\t\t\t{\n\t\t\t\t\tisDashboardListEdited: true,\n\t\t\t\t},\n\t\t\t);\n\t\t\tthis.$emit('onDashboardRemove', { dashboardId: this.dashboard.id });\n\t\t\tthis.emitDashboardChange();\n\t\t},\n\t\temitDashboardChange(): void\n\t\t{\n\t\t\tthis.$emit('onDashboardChange');\n\t\t},\n\t\tonGroupScopeChanged(): void\n\t\t{\n\t\t\tthis.$refs.scopeSelector.onGroupScopeChanged();\n\t\t},\n\t},\n\temits: [\n\t\t'onDashboardChange',\n\t\t'onDashboardRemove',\n\t],\n\tcomponents: {\n\t\tBIcon,\n\t\tDashboardScopeSelector,\n\t},\n\ttemplate: `\n\t\t<div class=\"group-dashboard\">\n\t\t\t<img class=\"group-dashboard-icon\" :src=\"iconPath\" width=\"32\" height=\"32\" alt=\"Dashboard icon\">\n\t\t\t<div class=\"group-dashboard-name\" :title=\"dashboard.name\">{{dashboard.name}}</div>\n\t\t\t<DashboardScopeSelector :dashboard=\"dashboard\" ref=\"scopeSelector\" @on-scope-change=\"emitDashboardChange\"/>\n\t\t\t<BIcon\n\t\t\t\t:name=\"set.CROSS_20\"\n\t\t\t\t:size=\"20\"\n\t\t\t\tcolor=\"#BDC1C6\"\n\t\t\t\t:class=\"'group-dashboard-remove-icon'\"\n\t\t\t\t@click=\"onRemoveClick\"\n\t\t\t></BIcon>\n\t\t</div>\n\t`,\n};\n","import type { BitrixVueComponentProps } from 'ui.vue3';\nimport { DashboardType, type Dashboard } from '../type';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Dialog, Item } from 'ui.entity-selector';\nimport { Store } from '../store';\n\nexport const DashboardSelector: BitrixVueComponentProps = {\n\tprops: {\n\t\tdashboards: {\n\t\t\t/** @type Dashboard[] */\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata()\n\t{\n\t\treturn {\n\t\t\tinitialDashboardIds: [],\n\t\t};\n\t},\n\tmounted()\n\t{\n\t\tthis.initDialog();\n\t},\n\tmethods: {\n\t\tonAddDashboardClick()\n\t\t{\n\t\t\tthis.initialDashboardIds = this.dashboards.map((dashboard: Dashboard) => dashboard.id);\n\t\t\tthis.dialog.show();\n\t\t},\n\t\tinitDialog()\n\t\t{\n\t\t\tconst preselectedItems = [];\n\t\t\tfor (const dashboard: Dashboard of this.dashboards)\n\t\t\t{\n\t\t\t\tpreselectedItems.push(['biconnector-superset-dashboard', dashboard.id]);\n\t\t\t}\n\t\t\tthis.dialog = new Dialog({\n\t\t\t\tid: 'group-dashboard-selector',\n\t\t\t\ttargetNode: this.$refs.addDashboardButton,\n\t\t\t\twidth: 400,\n\t\t\t\theight: 300,\n\t\t\t\tdropdownMode: true,\n\t\t\t\tenableSearch: true,\n\t\t\t\tpreload: true,\n\t\t\t\tpreselectedItems,\n\t\t\t\tentities: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'biconnector-superset-dashboard',\n\t\t\t\t\t\tdynamicLoad: true,\n\t\t\t\t\t\tdynamicSearch: true,\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tloadProxyData: false,\n\t\t\t\t\t\t\tcheckAccessRights: this.$store.getters.isSaveEnabled,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onSelect': (event: BaseEvent) => {\n\t\t\t\t\t\tconst item: Item = event.data.item;\n\t\t\t\t\t\tconst dashboard: Dashboard = {\n\t\t\t\t\t\t\tid: item.getId(),\n\t\t\t\t\t\t\tname: item.getTitle(),\n\t\t\t\t\t\t\ttype: item.getCustomData().get('type') ?? DashboardType.system,\n\t\t\t\t\t\t\tscopes: item.getCustomData().get('scopes') ?? [],\n\t\t\t\t\t\t};\n\t\t\t\t\t\tthis.$store.commit('addDashboard', dashboard);\n\t\t\t\t\t\tthis.$emit('onDashboardsChange');\n\t\t\t\t\t},\n\t\t\t\t\t'Item:onDeselect': (event: BaseEvent) => {\n\t\t\t\t\t\tconst item = event.data.item;\n\t\t\t\t\t\tthis.$store.commit('removeDashboard', item.getId());\n\t\t\t\t\t\tthis.$emit('onDashboardsChange');\n\t\t\t\t\t},\n\t\t\t\t\tonHide: (event: BaseEvent): void => {\n\t\t\t\t\t\tconst wasChanged: boolean = !Store.areSetsEqual(\n\t\t\t\t\t\t\tnew Set(this.initialDashboardIds),\n\t\t\t\t\t\t\tnew Set(this.dashboards.map((dashboard: Dashboard) => dashboard.id)),\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tEventEmitter.emit(\n\t\t\t\t\t\t\t'BIConnector.GroupPopup.DashboardSelector:onDialogHide',\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tisDashboardListEdited: wasChanged,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t},\n\temits: [\n\t\t'onDashboardsChange',\n\t],\n\twatch: {\n\t\tdashboards(newValue, oldValue)\n\t\t{\n\t\t\tconst dialog: Dialog = this.dialog;\n\t\t\tfor (const oldItem of oldValue)\n\t\t\t{\n\t\t\t\tif (!newValue.includes(oldItem))\n\t\t\t\t{\n\t\t\t\t\tdialog.getItem(['biconnector-superset-dashboard', oldItem.id])?.deselect();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"ui-btn ui-btn-primary ui-btn-sm ui-btn-round ui-btn-icon-add ui-btn-no-caps group-add-dashboards-button\"\n\t\t\t@click=\"onAddDashboardClick\"\n\t\t\tref=\"addDashboardButton\"\n\t\t>\n\t\t\t{{ $Bitrix.Loc.getMessage('BI_GROUP_ADD_DASHBOARD') }}\n\t\t</div>\n\t`,\n};\n","import type { BitrixVueComponentProps } from 'ui.vue3';\nimport { Popup as MainPopup, PopupManager, type PopupOptions } from 'main.popup';\nimport { BIcon, Set } from 'ui.icon-set.api.vue';\n\nexport const DeletionWarningPopup: BitrixVueComponentProps = {\n\temits: ['confirm', 'close'],\n\tprops: {},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tpopupInstance: null,\n\t\t\tpopupId: 'biconnector-dashboard-deletion',\n\t\t\tdontShow: false,\n\t\t};\n\t},\n\tcomputed: {\n\t\tpopupOptions(): PopupOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tid: this.popupId,\n\t\t\t\tcontent: this.$refs.content,\n\t\t\t\twidth: 400,\n\t\t\t\tpadding: 18,\n\t\t\t\tautoHide: true,\n\t\t\t\toverlay: true,\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose: this.closePopup,\n\t\t\t\t\tonPopupDestroy: this.closePopup,\n\t\t\t\t},\n\t\t\t\tfixed: true,\n\t\t\t};\n\t\t},\n\t\tset(): Set\n\t\t{\n\t\t\treturn Set;\n\t\t},\n\t},\n\tmethods: {\n\t\tclosePopup(): void\n\t\t{\n\t\t\tPopupManager.getPopupById(this.popupId)?.destroy();\n\t\t\tthis.popupInstance = null;\n\t\t\tthis.$emit('close');\n\t\t},\n\t\tonConfirm(): void\n\t\t{\n\t\t\tthis.$emit('confirm', { dontShow: this.dontShow });\n\t\t\tthis.closePopup();\n\t\t},\n\t\tgetPopupText(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('BI_GROUP_SAVE_WARN_TEXT')\n\t\t\t\t.replace('[link]', '<a class=\"ui-link ui-link-primary ui-link-dashed group-warn-popup-box-link\" onclick=\"top.BX.Helper.show(`redirect=detail&code=25556500`)\">')\n\t\t\t\t.replace('[/link]', '</a>')\n\t\t\t;\n\t\t},\n\t},\n\tmounted(): void\n\t{\n\t\tif (!this.popupInstance)\n\t\t{\n\t\t\tthis.popupInstance = new MainPopup(this.popupOptions);\n\t\t}\n\n\t\tthis.popupInstance.show();\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tthis.closePopup();\n\t},\n\tcomponents: {\n\t\tBIcon,\n\t},\n\ttemplate: `\n\t\t<div ref=\"content\" class=\"group-warn-popup\">\n\t\t\t<div class=\"group-warn-popup-title-block\">\n\t\t\t\t<div class=\"group-warn-popup-title\">{{ $Bitrix.Loc.getMessage('BI_GROUP_SAVE_WARN_TITLE') }}</div>\n\t\t\t\t<BIcon\n\t\t\t\t\t:name=\"set.CROSS_30\"\n\t\t\t\t\t:size=\"18\"\n\t\t\t\t\tcolor=\"#BDC1C6\"\n\t\t\t\t\t:class=\"'group-warn-popup-close'\"\n\t\t\t\t\t@click=\"closePopup\"\n\t\t\t\t></BIcon>\n\t\t\t</div>\n\t\t\t<div class=\"group-warn-popup-box\" v-html=\"getPopupText()\"></div>\n\t\t\t<label class=\"group-warn-popup-checkbox\">\n\t\t\t\t<input type=\"checkbox\" v-model=\"dontShow\"/>\n\t\t\t\t<span class=\"group-warn-popup-checkbox-text\">{{ $Bitrix.Loc.getMessage('BI_GROUP_SAVE_WARN_DONT_SHOW') }}</span>\n\t\t\t</label>\n\t\t\t<div class=\"group-warn-popup-separator\"></div>\n\t\t\t<div class=\"group-warn-popup-buttons\">\n\t\t\t\t<div class=\"ui-btn ui-btn-sm ui-btn-primary\" @click=\"onConfirm\">{{ $Bitrix.Loc.getMessage('BI_GROUP_SAVE_WARN_YES') }}</div>\n\t\t\t\t<div class=\"ui-btn ui-btn-sm ui-btn-light-border\" @click=\"closePopup\">{{ $Bitrix.Loc.getMessage('BI_GROUP_SAVE_WARN_NO') }}</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Dom, Event, Text, UI } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Dialog, Item } from 'ui.entity-selector';\nimport type { BitrixVueComponentProps } from 'ui.vue3';\nimport { BIcon, Set as IconSet } from 'ui.icon-set.api.vue';\nimport { hint } from 'ui.vue3.directives.hint';\nimport type { Scope } from '../type';\nimport { Store } from '../store';\n\nexport const GroupScopeSelector: BitrixVueComponentProps = {\n\tprops: {\n\t\tcanEdit: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdirectives: {\n\t\thint,\n\t},\n\tdata(): Object {\n\t\treturn {\n\t\t\tscopeNameLengthLimit: 30,\n\t\t\tinitialScopedIds: [],\n\t\t};\n\t},\n\tcomputed: {\n\t\tscopes(): Scope[]\n\t\t{\n\t\t\treturn this.$store.getters.groupScopes;\n\t\t},\n\t\thintOptions(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\thtml: this.$Bitrix.Loc.getMessage('BI_GROUP_SCOPE_HINT')\n\t\t\t\t\t.replace('[link]', '<a class=\"scope-hint-link\" onclick=\"top.BX.Helper.show(`redirect=detail&code=25556500`)\">')\n\t\t\t\t\t.replace('[/link]', '</a>'),\n\t\t\t\tinteractivity: true,\n\t\t\t\tpopupOptions: {\n\t\t\t\t\tbindOptions: {\n\t\t\t\t\t\tposition: 'bottom',\n\t\t\t\t\t},\n\t\t\t\t\tautoHide: false,\n\t\t\t\t\twidth: 244,\n\t\t\t\t\toffsetTop: -4,\n\t\t\t\t\tangle: {\n\t\t\t\t\t\tposition: 'top',\n\t\t\t\t\t\toffset: 34,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\tscopeText(): string\n\t\t{\n\t\t\tconst element: string = `\n\t\t\t\t<span\n\t\t\t\t\tclass=\"scope-name ${this.canEdit ? '' : 'scope-list-system'}\"\n\t\t\t\t\ttitle=\"${this.scopes[0].name.length > this.scopeNameLengthLimit ? Text.encode(this.scopes[0].name) : ''}\"\n\t\t\t\t>\n\t\t\t\t\t${Text.encode(this.formatScopeName(this.scopes[0].name))}\n\t\t\t\t</span>\n\t\t\t`;\n\n\t\t\tif (this.scopes.length <= 1)\n\t\t\t{\n\t\t\t\treturn this.$Bitrix.Loc.getMessage('BI_GROUP_SCOPES_GROUP')\n\t\t\t\t\t.replace('[title]', '<span class=\"group-scope-title\">')\n\t\t\t\t\t.replace('[/title]', '</span>')\n\t\t\t\t\t.replace('#SCOPE#', element)\n\t\t\t\t;\n\t\t\t}\n\n\t\t\treturn this.$Bitrix.Loc.getMessage('BI_GROUP_SCOPES_GROUP_MANY')\n\t\t\t\t.replace('[title]', '<span class=\"group-scope-title\">')\n\t\t\t\t.replace('[/title]', '</span>')\n\t\t\t\t.replace('#FIRST_SCOPES#', element)\n\t\t\t\t.replace('[hint]', '<span class=\"scope-list scope-list-more group-scope-hint\">')\n\t\t\t\t.replace('[/hint]', '</span>')\n\t\t\t\t.replace('#NUMBER#', this.scopes.length - 1)\n\t\t\t;\n\t\t},\n\t\temptyScopesText(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('BI_GROUP_SCOPES_GROUP_EMPTY')\n\t\t\t\t.replace('[title]', '<span class=\"group-scope-title\">')\n\t\t\t\t.replace('[/title]', '</span>')\n\t\t\t;\n\t\t},\n\t\tset(): IconSet\n\t\t{\n\t\t\treturn IconSet;\n\t\t},\n\t},\n\tmethods: {\n\t\topenScopeSelector(): void\n\t\t{\n\t\t\tif (!this.canEdit)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.dialog)\n\t\t\t{\n\t\t\t\tthis.initDialog();\n\t\t\t}\n\n\t\t\tthis.initialScopedIds = this.scopes.map((scope: Scope) => scope.code);\n\n\t\t\tthis.dialog.show();\n\t\t},\n\t\tinitDialog(): void\n\t\t{\n\t\t\tconst preselectedItems = [];\n\t\t\tfor (const scope: Scope of this.scopes)\n\t\t\t{\n\t\t\t\tpreselectedItems.push(['biconnector-superset-scope', scope.code]);\n\t\t\t}\n\t\t\tthis.dialog = new Dialog({\n\t\t\t\tid: 'group-scope-selector',\n\t\t\t\ttargetNode: this.$refs.groupScopes,\n\t\t\t\twidth: 350,\n\t\t\t\theight: 300,\n\t\t\t\tdropdownMode: true,\n\t\t\t\tcompactView: true,\n\t\t\t\tshowAvatars: false,\n\t\t\t\tenableSearch: true,\n\t\t\t\tpreload: true,\n\t\t\t\tpreselectedItems,\n\t\t\t\tentities: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'biconnector-superset-scope',\n\t\t\t\t\t\tdynamicLoad: true,\n\t\t\t\t\t\tdynamicSearch: true,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onSelect': this.onGroupScopeAdd,\n\t\t\t\t\t'Item:onDeselect': this.onGroupScopeRemove,\n\t\t\t\t\tonHide: this.onDialogHide,\n\t\t\t\t},\n\t\t\t});\n\t\t\tthis.dialog.getPopup().setOffset({ offsetLeft: -320 });\n\t\t\tthis.dialog.adjustPosition();\n\t\t\tDom.addClass(this.dialog.getContainer(), 'biconnector-scope-selector');\n\t\t},\n\t\tonGroupScopeAdd(event: BaseEvent): void\n\t\t{\n\t\t\tconst item: Item = event.getData().item;\n\t\t\tconst scope: Scope = { code: item.getId(), name: item.getTitle() };\n\t\t\tthis.$emit('onGroupScopeAdd', scope);\n\t\t},\n\t\tonGroupScopeRemove(event: BaseEvent): void\n\t\t{\n\t\t\tconst item: Item = event.getData().item;\n\t\t\tconst scope: Scope = { code: item.getId(), name: item.getTitle() };\n\t\t\tthis.$emit('onGroupScopeRemove', scope);\n\t\t},\n\t\tonDialogHide(event: BaseEvent): void\n\t\t{\n\t\t\tconst wasChanged: boolean = !Store.areSetsEqual(\n\t\t\t\tnew Set(this.initialScopedIds),\n\t\t\t\tnew Set(this.scopes.map((scope: Scope) => scope.code)),\n\t\t\t);\n\n\t\t\tEventEmitter.emit(\n\t\t\t\t'BIConnector.GroupPopup.ScopeSelector:onDialogHide',\n\t\t\t\t{\n\t\t\t\t\tisScopeListEdited: wasChanged,\n\t\t\t\t},\n\t\t\t);\n\t\t},\n\t\tshowMoreScopesHint(): void\n\t\t{\n\t\t\tconst hintNode: HTMLElement = this.$el.querySelector('.group-scope-hint');\n\t\t\tthis.hintManager.show(hintNode, this.scopes.slice(1).map((scope: Scope) => scope.name).join(', '), false);\n\t\t},\n\t\thideMoreScopesHint(): void\n\t\t{\n\t\t\tthis.hintManager.hide();\n\t\t\tthis.hintManager.popup = null;\n\t\t},\n\t\tshowSystemScopesHint(): void\n\t\t{\n\t\t\tconst hintNode: HTMLElement = this.$el.querySelector('.scope-list-system');\n\t\t\tthis.systemScopeHintManager.show(hintNode, this.$Bitrix.Loc.getMessage('BI_GROUP_SYSTEM_SCOPES_HINT'), false);\n\t\t},\n\t\thideSystemScopesHint(): void\n\t\t{\n\t\t\tthis.systemScopeHintManager.hide();\n\t\t\tthis.systemScopeHintManager.popup = null;\n\t\t},\n\t\tformatScopeName(scopeName: string): string\n\t\t{\n\t\t\tif (scopeName.length < this.scopeNameLengthLimit)\n\t\t\t{\n\t\t\t\treturn scopeName;\n\t\t\t}\n\n\t\t\treturn `${scopeName.slice(0, this.scopeNameLengthLimit)}...`;\n\t\t},\n\t\tattachHintHandlers(): void\n\t\t{\n\t\t\tconst node: ?HTMLElement = this.$el.querySelector('.group-scope-hint');\n\t\t\tif (node)\n\t\t\t{\n\t\t\t\tEvent.unbindAll(node);\n\t\t\t\tEvent.bind(node, 'mouseenter', this.showMoreScopesHint);\n\t\t\t\tEvent.bind(node, 'mouseleave', this.hideMoreScopesHint);\n\t\t\t}\n\n\t\t\tif (!this.canEdit)\n\t\t\t{\n\t\t\t\tconst scopeName: ?HTMLElement = this.$el.querySelector('.scope-list-system');\n\t\t\t\tif (scopeName)\n\t\t\t\t{\n\t\t\t\t\tEvent.unbindAll(scopeName);\n\t\t\t\t\tEvent.bind(scopeName, 'mouseenter', this.showSystemScopesHint);\n\t\t\t\t\tEvent.bind(scopeName, 'mouseleave', this.hideSystemScopesHint);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t},\n\tmounted(): void\n\t{\n\t\tthis.hintManager = UI.Hint.createInstance({\n\t\t\tid: 'group-scope-hint',\n\t\t\tpopupParameters: {\n\t\t\t\tbindOptions: {\n\t\t\t\t\tposition: 'bottom',\n\t\t\t\t},\n\t\t\t\twidth: 190,\n\t\t\t\toffsetLeft: -80,\n\t\t\t\tangle: {\n\t\t\t\t\tposition: 'top',\n\t\t\t\t\toffset: 130,\n\t\t\t\t},\n\t\t\t\tcacheable: false,\n\t\t\t},\n\t\t});\n\t\tthis.systemScopeHintManager = UI.Hint.createInstance({\n\t\t\tid: 'system-scope-hint',\n\t\t\tpopupParameters: {\n\t\t\t\tbindOptions: {\n\t\t\t\t\tposition: 'bottom',\n\t\t\t\t},\n\t\t\t\twidth: 244,\n\t\t\t\toffsetLeft: -140,\n\t\t\t\tangle: {\n\t\t\t\t\tposition: 'top',\n\t\t\t\t\toffset: 180,\n\t\t\t\t},\n\t\t\t\tcacheable: false,\n\t\t\t},\n\t\t});\n\t\tthis.attachHintHandlers();\n\t},\n\tupdated(): void\n\t{\n\t\tthis.attachHintHandlers();\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tif (this.dialog)\n\t\t{\n\t\t\tthis.dialog.destroy();\n\t\t}\n\t\tthis.dialog = null;\n\n\t\tconst node: ?HTMLElement = this.$el.querySelector('.group-scope-hint');\n\t\tif (node)\n\t\t{\n\t\t\tEvent.unbindAll(node);\n\t\t}\n\n\t\tconst scopeName: ?HTMLElement = this.$el.querySelector('.scope-list-system');\n\t\tif (scopeName)\n\t\t{\n\t\t\tEvent.unbindAll(scopeName);\n\t\t}\n\t},\n\temits: [\n\t\t'onGroupScopeAdd',\n\t\t'onGroupScopeRemove',\n\t],\n\tcomponents: {\n\t\tBIcon,\n\t},\n\ttemplate: `\n\t\t<div class=\"group-scope-selector\">\n\t\t\t<span\n\t\t\t\tv-if=\"scopes.length > 0\"\n\t\t\t\t@click=\"openScopeSelector\"\n\t\t\t\tclass=\"scope-list scope-list-group\"\n\t\t\t\tv-html=\"scopeText\"\n\t\t\t></span>\n\t\t\t<span\n\t\t\t\tv-else\n\t\t\t\t@click=\"openScopeSelector\"\n\t\t\t\tclass=\"scope-list scope-list-group\"\n\t\t\t\tv-html=\"emptyScopesText\"\n\t\t\t></span>\n\t\t\t<div class=\"group-scope-list-hint\" ref=\"groupScopes\" v-hint=\"hintOptions\">\n\t\t\t\t<BIcon\n\t\t\t\t\t:name=\"set.HELP\"\n\t\t\t\t\t:size=\"20\"\n\t\t\t\t\tcolor=\"#D5D7DB\"\n\t\t\t\t></BIcon>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import type { BitrixVueComponentProps } from 'ui.vue3';\nimport { BIcon, Set } from 'ui.icon-set.api.vue';\nimport { hint } from 'ui.vue3.directives.hint';\n\nexport const TitleEditor: BitrixVueComponentProps = {\n\tprops: {\n\t\tcanEdit: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\teditMode: false,\n\t\t};\n\t},\n\tdirectives: {\n\t\thint,\n\t},\n\tcomputed: {\n\t\tgroupName: {\n\t\t\tget(): string\n\t\t\t{\n\t\t\t\treturn this.$store.getters.groupName;\n\t\t\t},\n\t\t\tset(value): void\n\t\t\t{\n\t\t\t\tthis.$store.commit('setGroupName', value);\n\t\t\t},\n\t\t},\n\t\tset(): Set\n\t\t{\n\t\t\treturn Set;\n\t\t},\n\t\tnameHintOptions(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\ttext: this.$Bitrix.Loc.getMessage('BI_GROUP_SYSTEM_NAME_HINT'),\n\t\t\t\tpopupOptions: {\n\t\t\t\t\tbindOptions: {\n\t\t\t\t\t\tposition: 'bottom',\n\t\t\t\t\t},\n\t\t\t\t\twidth: 220,\n\t\t\t\t\toffsetLeft: 40,\n\t\t\t\t\tangle: {\n\t\t\t\t\t\tposition: 'top',\n\t\t\t\t\t\toffset: 0,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t},\n\tmethods: {\n\t\tsetEditMode()\n\t\t{\n\t\t\tthis.editMode = true;\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.$refs.nameInput.focus();\n\t\t\t});\n\t\t},\n\t\tsetViewMode()\n\t\t{\n\t\t\tthis.editMode = false;\n\t\t\tif (!this.groupName)\n\t\t\t{\n\t\t\t\tthis.$store.commit('setGroupName', this.$Bitrix.Loc.getMessage('BI_GROUP_NAME_NEW'));\n\t\t\t}\n\t\t\tthis.$emit('onNameUpdate');\n\t\t},\n\t},\n\temits: [\n\t\t'onNameUpdate',\n\t],\n\tcomponents: {\n\t\tBIcon,\n\t},\n\ttemplate: `\n\t\t<div class=\"group-header-title\" :style=\"{ width: editMode ? '80%' : 'auto' }\">\n\t\t\t<template v-if=\"canEdit\">\n\t\t\t\t<input v-if=\"editMode\" class=\"group-name-input\" @blur=\"setViewMode\" v-model=\"groupName\" ref=\"nameInput\">\n\t\t\t\t<template v-else>\n\t\t\t\t\t<div class=\"group-name\">{{groupName}}</div>\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\t:name=\"set.PENCIL_40\"\n\t\t\t\t\t\t:size=\"20\"\n\t\t\t\t\t\tcolor=\"#BDC1C6\"\n\t\t\t\t\t\t:class=\"'group-name-edit-icon'\"\n\t\t\t\t\t\t@click=\"setEditMode\"\n\t\t\t\t\t></BIcon>\n\t\t\t\t</template>\n\t\t\t</template>\n\t\t\t<template v-else>\n\t\t\t\t<div class=\"group-name\" v-hint=\"nameHintOptions\">{{groupName}}</div>\n\t\t\t</template>\n\t\t</div>\n\t`,\n};\n","import { ajax as Ajax, Runtime } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Popup, PopupManager } from 'main.popup';\nimport { BIcon, Set } from 'ui.icon-set.api.vue';\nimport type { BitrixVueComponentProps } from 'ui.vue3';\nimport { DashboardItem } from './components/dashboard-item';\nimport { DashboardSelector } from './components/dashboard-selector';\nimport { DeletionWarningPopup } from './components/deletion-warning-popup';\nimport { GroupScopeSelector } from './components/group-scope-selector';\nimport { TitleEditor } from './components/title-editor';\nimport type { Dashboard } from './type';\n\nexport const App: BitrixVueComponentProps = {\n\tmounted(): void\n\t{\n\t\tEventEmitter.subscribe('BIConnector.Internal.GroupPopup:onPopupClose', this.onGroupPopupClose);\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tEventEmitter.unsubscribe('BIConnector.Internal.GroupPopup:onPopupClose', this.onGroupPopupClose);\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tdeletionWarning: {\n\t\t\t\tpopupShown: false,\n\t\t\t\tdashboardId: null,\n\t\t\t},\n\t\t};\n\t},\n\tcomputed: {\n\t\tisNoDashboards(): boolean\n\t\t{\n\t\t\treturn this.$store.state.group.dashboardIds.length === 0;\n\t\t},\n\t\tdashboards(): Dashboard[]\n\t\t{\n\t\t\treturn this.$store.getters.groupDashboardsData;\n\t\t},\n\t\tisSystemGroup(): boolean\n\t\t{\n\t\t\treturn this.$store.getters.isSystemGroup;\n\t\t},\n\t\tisSaveEnabled(): boolean\n\t\t{\n\t\t\treturn this.$store.getters.isSaveEnabled;\n\t\t},\n\t\tisLoading(): boolean\n\t\t{\n\t\t\treturn this.$store.getters.isLoading;\n\t\t},\n\t\tisDashboardListScrollable(): boolean\n\t\t{\n\t\t\tif (this.isSaveEnabled)\n\t\t\t{\n\t\t\t\treturn this.dashboards.length > 6;\n\t\t\t}\n\n\t\t\treturn this.dashboards.length > 7;\n\t\t},\n\t\tset(): Set\n\t\t{\n\t\t\treturn Set;\n\t\t},\n\t},\n\tmethods: {\n\t\tupdateRight(): void\n\t\t{\n\t\t\tEventEmitter.emit('BIConnector.GroupPopup:onGroupUpdated', {\n\t\t\t\tgroup: Runtime.clone(this.$store.getters.groupData),\n\t\t\t\tdashboards: Runtime.clone(this.$store.getters.dashboards),\n\t\t\t});\n\t\t},\n\t\tonGroupScopeAdd(event): void\n\t\t{\n\t\t\tthis.$store.commit('addGroupScope', event);\n\t\t\tthis.updateRight();\n\t\t\tfor (const dashboardItem of this.$refs.dashboardItem ?? [])\n\t\t\t{\n\t\t\t\tdashboardItem.onGroupScopeChanged();\n\t\t\t}\n\t\t},\n\t\tonGroupScopeRemove(event): void\n\t\t{\n\t\t\tthis.$store.commit('removeGroupScope', event);\n\t\t\tthis.updateRight();\n\t\t\tfor (const dashboardItem of this.$refs.dashboardItem ?? [])\n\t\t\t{\n\t\t\t\tdashboardItem.onGroupScopeChanged();\n\t\t\t}\n\t\t},\n\t\tonDashboardRemove(event): void\n\t\t{\n\t\t\tif (\n\t\t\t\tthis.isSaveEnabled\n\t\t\t\t&& this.$store.getters.isNeedShowDeletionWarningPopup\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.deletionWarning.dashboardId = event.dashboardId;\n\t\t\t\tthis.deletionWarning.popupShown = true;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.$store.commit('removeDashboard', event.dashboardId);\n\t\t\t\tthis.updateRight();\n\t\t\t}\n\t\t},\n\t\tconfirmDashboardDeletion(event): void\n\t\t{\n\t\t\tthis.$store.commit('removeDashboard', this.deletionWarning.dashboardId);\n\t\t\tif (event.dontShow)\n\t\t\t{\n\t\t\t\tBX.userOptions.save('biconnector', 'deleteDashboardFromGroupPopup', 'needShow', false);\n\t\t\t\tthis.$store.commit('setShowDeletionWarningPopup', false);\n\t\t\t}\n\t\t\tthis.deletionWarning.dashboardId = null;\n\t\t\tthis.deletionWarning.popupShown = false;\n\t\t\tthis.updateRight();\n\t\t},\n\t\tcancelDashboardDeletion(): void\n\t\t{\n\t\t\tthis.deletionWarning.dashboardId = null;\n\t\t\tthis.deletionWarning.popupShown = false;\n\t\t},\n\t\tsaveGroup(): void\n\t\t{\n\t\t\tthis.$store.commit('setIsLoading', true);\n\t\t\tAjax.runAction('biconnector.group.save', {\n\t\t\t\tdata: {\n\t\t\t\t\tgroup: this.$store.getters.groupData,\n\t\t\t\t\tdashboards: [...this.$store.getters.dashboards.values()],\n\t\t\t\t},\n\t\t\t})\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.$store.commit('setIsLoading', false);\n\t\t\t\t\tthis.closePopup();\n\t\t\t\t\tEventEmitter.emit('BIConnector.GroupPopup:onGroupSaved', {\n\t\t\t\t\t\tgroup: Runtime.clone(this.$store.getters.groupData),\n\t\t\t\t\t\tdashboards: Runtime.clone(this.$store.getters.dashboards),\n\t\t\t\t\t\tisTitleEdited: this.$store.getters.isTitleEdited,\n\t\t\t\t\t\tisDashboardListEdited: this.$store.getters.isDashboardListEdited,\n\t\t\t\t\t\tisScopeListEdited: this.$store.getters.isScopeListEdited,\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch((response) => {\n\t\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: response.errors[0]?.message,\n\t\t\t\t\t});\n\t\t\t\t\tthis.$store.commit('setIsLoading', false);\n\t\t\t\t})\n\t\t\t;\n\t\t},\n\t\tclosePopup(): void\n\t\t{\n\t\t\tconst popup: Popup = PopupManager.getPopupById('biconnector-dashboard-group');\n\t\t\tpopup.close();\n\t\t},\n\t\tonGroupPopupClose(): void\n\t\t{\n\t\t\tEventEmitter.emit('BIConnector.GroupPopup:onPopupClose', {\n\t\t\t\tgroup: this.$store.getters.groupData,\n\t\t\t\tisTitleEdited: this.$store.getters.isTitleEdited,\n\t\t\t\tisDashboardListEdited: this.$store.getters.isDashboardListEdited,\n\t\t\t\tisScopeListEdited: this.$store.getters.isScopeListEdited,\n\t\t\t});\n\t\t},\n\t},\n\tcomponents: {\n\t\tBIcon,\n\t\tDashboardItem,\n\t\tDashboardSelector,\n\t\tGroupScopeSelector,\n\t\tTitleEditor,\n\t\tDeletionWarningPopup,\n\t},\n\ttemplate: `\n\t\t<div class=\"group-header\">\n\t\t\t<TitleEditor @on-name-update=\"updateRight\" :can-edit=\"!isSystemGroup\"/>\n\t\t\t<div class=\"group-header-controls\">\n\t\t\t\t<BIcon\n\t\t\t\t\t:name=\"set.CROSS_25\"\n\t\t\t\t\t:size=\"25\"\n\t\t\t\t\tcolor=\"#BDC1C6\"\n\t\t\t\t\t:class=\"'group-close'\"\n\t\t\t\t\t@click=\"closePopup\"\n\t\t\t\t></BIcon>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"group-button-panel\">\n\t\t\t<div class=\"group-button-wrapper\">\n\t\t\t\t<DashboardSelector :dashboards=\"dashboards\" @on-dashboards-change=\"updateRight\"/>\n\t\t\t</div>\n\t\t\t<GroupScopeSelector @on-group-scope-add=\"onGroupScopeAdd\" @on-group-scope-remove=\"onGroupScopeRemove\" :can-edit=\"!isSystemGroup\"/>\n\t\t</div>\n\t\t<div class=\"group-dashboard-empty\" v-if=\"isNoDashboards\">\n\t\t\t<img class=\"group-dashboard-empty-image\" src=\"/bitrix/images/biconnector/dashboard-groups/empty-state.svg\" alt=\"No dashboards\">\n\t\t\t<div class=\"group-dashboard-empty-title\">{{ $Bitrix.Loc.getMessage('BI_GROUP_EMPTY_TITLE') }}</div>\n\t\t\t<div class=\"group-dashboard-empty-subtitle\">{{ $Bitrix.Loc.getMessage('BI_GROUP_EMPTY_SUBTITLE') }}</div>\n\t\t</div>\n\t\t<div class=\"group-dashboard-list\" :class=\"{'group-dashboard-list-scroll': isDashboardListScrollable}\" v-else>\n\t\t\t<DashboardItem\n\t\t\t\tv-for=\"dashboard of dashboards\"\n\t\t\t\t:key=\"dashboard.id\"\n\t\t\t\tref=\"dashboardItem\"\n\t\t\t\t:dashboard=\"dashboard\"\n\t\t\t\t@on-dashboard-change=\"updateRight\"\n\t\t\t\t@on-dashboard-remove=\"onDashboardRemove\"\n\t\t\t/>\n\t\t</div>\n\t\t<div class=\"group-footer\" v-if=\"isSaveEnabled\">\n\t\t\t<div\n\t\t\t\t:class=\"['ui-btn ui-btn-primary ui-btn-md ui-btn-round ui-btn-no-caps group-footer-button', {'ui-btn-disabled ui-btn-clock': isLoading}]\" \n\t\t\t\t@click=\"saveGroup\"\n\t\t\t>\n\t\t\t\t{{ $Bitrix.Loc.getMessage('BI_GROUP_SAVE') }}\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tclass=\"ui-btn ui-btn-light-border ui-btn-md ui-btn-round ui-btn-no-caps group-footer-button\"\n\t\t\t\t@click=\"closePopup\"\n\t\t\t>\n\t\t\t\t{{ $Bitrix.Loc.getMessage('BI_GROUP_SAVE_CANCEL') }}\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"group-loader\" v-if=\"isLoading\"></div>\n\t\t<DeletionWarningPopup \n\t\t\tv-if=\"deletionWarning.popupShown\" \n\t\t\t@confirm=\"confirmDashboardDeletion\" \n\t\t\t@close=\"cancelDashboardDeletion\"\n\t\t/>\n\t`,\n};\n","import { EventEmitter } from 'main.core.events';\nimport { Popup } from 'main.popup';\nimport { Loc } from 'main.core';\nimport { BitrixVue } from 'ui.vue3';\nimport { Store } from './store';\nimport { App } from './app';\nimport { type Group, GroupAppParams, GroupAppState, GroupType } from './type';\n\nexport class DashboardGroup\n{\n\tstatic open(appParams: GroupAppParams = {})\n\t{\n\t\tconst app = this.getApp(appParams);\n\n\t\tconst popup = new Popup({\n\t\t\tid: 'biconnector-dashboard-group',\n\t\t\twidth: 800,\n\t\t\theight: 560,\n\t\t\toverlay: true,\n\t\t\tcloseIcon: false,\n\t\t\tautoHide: true,\n\t\t\tpadding: 0,\n\t\t\tcacheable: false,\n\t\t\tcontent: '<div id=\"app\"></div>',\n\t\t\tevents: {\n\t\t\t\tonPopupClose: () => {\n\t\t\t\t\tEventEmitter.emit('BIConnector.Internal.GroupPopup:onPopupClose');\n\n\t\t\t\t\tapp.unmount();\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t\tpopup.show();\n\t\tapp.mount('#app');\n\t}\n\n\tstatic getApp(appParams: GroupAppParams = {})\n\t{\n\t\tlet group: Group = appParams.groups.find((item: Group) => item.id === appParams.groupId);\n\t\tif (!group)\n\t\t{\n\t\t\tgroup = {\n\t\t\t\tid: 'new_G0',\n\t\t\t\tname: Loc.getMessage('BI_GROUP_NAME_NEW'),\n\t\t\t\ttype: GroupType.custom,\n\t\t\t\tscopes: [],\n\t\t\t\tdashboardIds: [],\n\t\t\t};\n\t\t}\n\t\tconst state: GroupAppState = {\n\t\t\tgroup,\n\t\t\totherGroups: appParams.groups.filter((item: Group) => item.id !== appParams.groupId),\n\t\t\tdashboards: appParams.dashboards,\n\t\t\tsaveEnabled: appParams.saveEnabled,\n\t\t\tisLoading: false,\n\t\t\tisNeedShowDeletionWarningPopup: appParams.isNeedShowDeletionWarningPopup,\n\t\t};\n\n\t\tconst app = BitrixVue.createApp({\n\t\t\tname: 'GroupPopupApp',\n\t\t\tdata()\n\t\t\t{\n\t\t\t\treturn {};\n\t\t\t},\n\t\t\tcomponents: {\n\t\t\t\tApp,\n\t\t\t},\n\t\t\tcomputed: {\n\t\t\t\tcomponentName()\n\t\t\t\t{\n\t\t\t\t\treturn App;\n\t\t\t\t},\n\t\t\t},\n\t\t\t// language=Vue\n\t\t\ttemplate: `\n\t\t\t\t<App/>\n\t\t\t`,\n\t\t});\n\n\t\tconst store = Store.buildStore(state);\n\t\tapp.use(store);\n\n\t\treturn app;\n\t}\n}\n"],"names":["GroupType","system","custom","DashboardType","Store","babelHelpers","key","value","defaultValues","initialGroup","Runtime","clone","group","createStore","state","mutations","setIsLoading","isLoading","setGroupName","groupName","name","addDashboard","dashboard","dashboardIds","unshift","id","groupScopes","scopes","dashboards","get","_step","dashboardScopeCodes","Set","map","dashScope","code","groupScope","has","push","_iterator","set","removeDashboard","dashboardId","filter","_step2","_step3","dashboardIsInOtherGroupWithScope","otherGroups","otherGroup","includes","some","item","_iterator3","_loop","_iterator2","setDashboardScopes","data","addGroupScope","scope","_step4","newScopeCode","_iterator4","removeGroupScope","existingScope","_step5","deletedScopeCode","_step6","_iterator6","_iterator5","setShowDeletionWarningPopup","isShow","isNeedShowDeletionWarningPopup","getters","groupDashboardsData","_step7","result","_iterator7","isSystemGroup","type","groupData","isSaveEnabled","saveEnabled","isGroupScope","scopeCode","_step8","_iterator8","isTitleEdited","isDashboardListEdited","areSetsEqual","isScopeListEdited","setA","setB","size","_step9","_iterator9","DashboardScopeSelector","props","Object","required","scopeNameLengthLimit","initialScopedIds","beforeUnmount","this","dialog","destroy","node","$el","querySelector","Event","unbindAll","computed","visibleScopes","slice","_this","$store","scopeText","formattedScopes","entries","index","formatScopeName","suffix","length","element","Text","encode","join","$Bitrix","Loc","getMessage","replace","emits","methods","scopeName","openSelector","initDialog","show","preselectedItems","undeselectedItems","Dialog","targetNode","$refs","dashboardScopes","width","height","dropdownMode","compactView","showAvatars","enableSearch","preload","entities","dynamicLoad","dynamicSearch","events","Item:onSelect","handleScopeAdd","Item:onDeselect","handleScopeRemove","onHide","handleDialogHide","getPopup","setOffset","offsetLeft","adjustPosition","Dom","addClass","getContainer","event","addedItem","getData","getId","getTitle","commit","$emit","removedItem","wasChanged","EventEmitter","emit","showMoreScopesHint","hintNode","hintManager","hideMoreScopesHint","hide","popup","onGroupScopeChanged","_this$dialog","attachHintHandlers","bind","mounted","UI","Hint","createInstance","Date","now","popupParameters","bindOptions","position","angle","offset","cacheable","updated","template","DashboardItem","iconPath","onRemoveClick","emitDashboardChange","scopeSelector","components","BIcon","DashboardSelector","Array","initialDashboardIds","onAddDashboardClick","addDashboardButton","options","loadProxyData","checkAccessRights","getCustomData","watch","newValue","oldValue","oldItem","getItem","_dialog$getItem","deselect","DeletionWarningPopup","popupInstance","popupId","dontShow","popupOptions","content","padding","autoHide","overlay","onPopupClose","closePopup","onPopupDestroy","fixed","PopupManager","getPopupById","_PopupManager$getPopu","onConfirm","getPopupText","MainPopup","GroupScopeSelector","canEdit","Boolean","directives","hint","hintOptions","html","interactivity","offsetTop","emptyScopesText","IconSet","openScopeSelector","onGroupScopeAdd","onGroupScopeRemove","onDialogHide","showSystemScopesHint","systemScopeHintManager","hideSystemScopesHint","TitleEditor","editMode","nameHintOptions","text","setEditMode","$nextTick","nameInput","focus","setViewMode","App","subscribe","onGroupPopupClose","unsubscribe","deletionWarning","popupShown","isNoDashboards","isDashboardListScrollable","updateRight","dashboardItem","onDashboardRemove","confirmDashboardDeletion","BX","userOptions","save","cancelDashboardDeletion","saveGroup","Ajax","runAction","values","then","response","Notification","Center","notify","errors","_response$errors$","message","close","DashboardGroup","appParams","app","getApp","Popup","closeIcon","unmount","mount","groups","find","groupId","BitrixVue","createApp","componentName","store","buildStore","use"],"mappings":"iEAiBaA,EAAY,CACxBC,OAAQ,SACRC,OAAQ,UAGIC,EACJ,SADIA,EAEJ,iiCCnBIC,aAAK,aAAAC,oCAgPhB,OAhPgBA,kCAAAC,iBAIjBC,eACkBC,GAIjB,OAFAJ,EAAMK,aAAeC,UAAQC,MAAMH,EAAcI,OAE1CC,cAAY,CAClBC,iBAEC,OAAON,GAERO,UAAW,CACVC,sBAAaF,EAAsBG,GAElCH,EAAMG,UAAYA,GAEnBC,sBAAaJ,EAAsBK,GAElCL,EAAMF,MAAMQ,KAAOD,GAEpBE,sBAAaP,EAAsBQ,GAElCR,EAAMF,MAAMW,aAAaC,QAAQF,EAAUG,IAE3C,IAAMC,EAAcZ,EAAMF,MAAMe,OAC5Bb,EAAMc,WAAWC,IAAIP,EAAUG,MAElCH,EAAUK,OAASb,EAAMc,WAAWC,IAAIP,EAAUG,IAAIE,QAGvD,IAC2CG,EADrCC,EAAsB,IAAIC,IAAIV,EAAUK,OAAOM,KAAI,SAACC,GAAgB,OAAKA,EAAUC,aACzDT,GAAW,IAA3C,2BACA,CAAA,IADWU,UAELL,EAAoBM,IAAID,EAAWD,OAEvCb,EAAUK,OAAOW,KAAKF,aAEvBG,eAAAA,MAEDzB,EAAMc,WAAWY,IAAIlB,EAAUG,GAAIH,IAEpCmB,yBAAgB3B,EAAsB4B,GAErC,IAAMpB,EAAuBR,EAAMc,WAAWC,IAAIa,GAClD,GAAKpB,EAAL,CAKAR,EAAMF,MAAMW,aAAeT,EAAMF,MAAMW,aAAaoB,QAAO,SAAClB,GAAE,OAAKA,IAAOiB,KAAa,IACrCE,MAAlB9B,EAAMF,MAAMe,QAAM,IAAA,iBAClD,IAEkDkB,EAHvCT,UAENU,GAAmC,MACPhC,EAAMiC,aAAW,IAAjD,2BACA,CAAA,IADWC,UAGTA,EAAWzB,aAAa0B,SAASP,IAC9BM,EAAWrB,OAAOuB,MAAK,SAACC,GAAW,OAAKA,EAAKhB,OAASC,EAAWD,UAGpEW,GAAmC,aAEpCM,eAAAA,OAGCN,GACExB,EAAUK,OAAOuB,MAAK,SAACC,GAAW,OAAKA,EAAKhB,OAASC,EAAWD,UAGnEb,EAAUK,OAASL,EAAUK,OAAOgB,QAAO,SAACQ,GAAW,OAAKA,EAAKhB,OAASC,EAAWD,QACrFrB,EAAMc,WAAWY,IAAIE,EAAapB,KApBpC,2BAAA+B,aAsBCC,eAAAA,SAEFC,4BAAmBzC,EAAsB0C,GAExC,IAAQd,EAAwBc,EAAxBd,YAAaf,EAAW6B,EAAX7B,OACQb,EAAMc,WAAWC,IAAIa,GACxCf,OAASA,GAEpB8B,uBAAc3C,EAAsB4C,GAEnC5C,EAAMF,MAAMe,OAAOW,KAAKoB,GACxB,IAC0DC,EADpDC,EAAeF,EAAMvB,SACOrB,EAAMF,MAAMW,cAAY,IAA1D,2BACA,CAAA,IADWmB,UAEJpB,EAAYR,EAAMc,WAAWC,IAAIa,GAClCpB,EAAUK,OAAOuB,MAAK,SAACC,GAAW,OAAKA,EAAKhB,OAASyB,OAEzDtC,EAAUK,OAAOW,KAAKoB,GACtB5C,EAAMc,WAAWY,IAAIE,EAAapB,cAEnCuC,eAAAA,QAEFC,0BAAiBhD,EAAsB4C,GAEtC5C,EAAMF,MAAMe,OAASb,EAAMF,MAAMe,OAAOgB,QAAO,SAACoB,GAAoB,OAAKA,EAAc5B,OAASuB,EAAMvB,QACtG,IAC0D6B,EADpDC,EAAmBP,EAAMvB,SACGrB,EAAMF,MAAMW,cAAY,IAA1D,2BACA,CAAA,IAEkD2C,EAHvCxB,UAENI,GAAmC,MACPhC,EAAMiC,aAAW,IAAjD,2BACA,CAAA,IADWC,UAGTA,EAAWzB,aAAa0B,SAASP,IAC9BM,EAAWrB,OAAOuB,MAAK,SAACC,GAAW,OAAKA,EAAKhB,OAAS8B,OAGzDnB,GAAmC,aAEpCqB,eAAAA,MAED,IAAKrB,EACL,CACC,IAAMxB,EAAYR,EAAMc,WAAWC,IAAIa,GACnCpB,EAAUK,OAAOuB,MAAK,SAACC,GAAW,OAAKA,EAAKhB,OAAS8B,OAExD3C,EAAUK,OAASL,EAAUK,OAAOgB,QAAO,SAACQ,GAAW,OAAKA,EAAKhB,OAAS8B,KAC1EnD,EAAMc,WAAWY,IAAIE,EAAapB,eAGpC8C,eAAAA,QAEFC,qCAA4BvD,EAAsBwD,GAEjDxD,EAAMyD,+BAAiCD,IAGzCE,QAAS,CACRrD,mBAAUL,GAET,OAAOA,EAAMF,MAAMQ,MAEpBM,qBAAYZ,GAEX,OAAOA,EAAMF,MAAMe,QAEpBC,oBAAWd,GAEV,OAAOA,EAAMc,YAEd6C,6BAAoB3D,GAEnB,IACkD4D,EAD5CC,EAAS,OACW7D,EAAMF,MAAMW,cAAY,IAAlD,2BACA,CAAA,IADWmB,UAEViC,EAAOrC,KAAKxB,EAAMc,WAAWC,IAAIa,cACjCkC,eAAAA,MAED,OAAOD,GAERE,uBAAc/D,GAEb,OAAOA,EAAMF,MAAMkE,OAAS9E,EAAUC,QAEvC8E,mBAAUjE,GAET,MAAO,CACNW,GAAIX,EAAMF,MAAMa,GAChBL,KAAMN,EAAMF,MAAMQ,KAClB0D,KAAMhE,EAAMF,MAAMkE,KAClBnD,OAAQb,EAAMF,MAAMe,OACpBJ,aAAcT,EAAMF,MAAMW,eAG5ByD,uBAAclE,GAEb,OAAOA,EAAMmE,aAEdhE,mBAAUH,GAET,OAAOA,EAAMG,WAEdiE,sBAAapE,GAEZ,OAAO,SAAC4B,EAAqByC,GAC5B,GAAIrE,EAAMF,MAAMe,OAAOuB,MAAK,SAACd,GAAiB,OAAKA,EAAWD,OAASgD,KAEtE,OAAO,EACP,IAEyCC,MAAjBtE,EAAMiC,aAAW,IAA1C,2BACA,CAAA,IADWC,UAEV,GACCA,EAAWzB,aAAa0B,SAASP,IAC9BM,EAAWrB,OAAOuB,MAAK,SAACd,GAAiB,OAAKA,EAAWD,OAASgD,KAGrE,OAAO,YAERE,eAAAA,MAED,OAAO,IAGTd,wCAA+BzD,GAE9B,OAAOA,EAAMyD,gCAEde,uBAAcxE,GAEb,OAAOA,EAAMF,MAAMQ,OAAShB,EAAMK,aAAaW,MAEhDmE,+BAAsBzE,GAErB,OAAQV,EAAMoF,aACb,IAAIxD,IAAI5B,EAAMK,aAAac,cAC3B,IAAIS,IAAIlB,EAAMF,MAAMW,gBAGtBkE,2BAAkB3E,GAEjB,OAAQV,EAAMoF,aACb,IAAIxD,IAAI5B,EAAMK,aAAakB,OAAOM,KAAI,SAACyB,GAAY,OAAKA,EAAMvB,SAC9D,IAAIH,IAAIlB,EAAMF,MAAMe,OAAOM,KAAI,SAACyB,GAAY,OAAKA,EAAMvB,iBAK3D7B,mBAAAC,eAEmBmF,EAAWC,GAE9B,GAAID,EAAKE,OAASD,EAAKC,KAEtB,OAAO,EACP,IAEsBC,MAAJH,GAAI,IAAvB,2BACA,CAAA,IADWvC,UAEV,IAAKwC,EAAKtD,IAAIc,GAEb,OAAO,YAER2C,eAAAA,MAED,OAAO,+hCC5OF,IAAMC,EAAkD,CAC9DC,MAAO,CACN1E,UAAW,CAEVwD,KAAMmB,OACNC,UAAU,IAGZ1C,gBACC,MAAO,CACN2C,qBAAsB,GACtBC,iBAAkB,KAGpBC,yBAEKC,KAAKC,QAERD,KAAKC,OAAOC,UAEbF,KAAKC,OAAS,KAEd,IAAME,EAAqBH,KAAKI,IAAIC,cAAc,eAC9CF,GAEHG,QAAMC,UAAUJ,IAGlBK,SAAU,CACTC,yBAEC,OAAOT,KAAK3E,OAAOqF,MAAM,EAAG,IAE7BrF,kBAEC,sCAAW2E,KAAKhF,UAAUK,SAE3BuD,wBACA,WACC,OAAO,SAACC,GAAiB,OAAK8B,EAAKC,OAAO1C,QAAQU,aAAa+B,EAAK3F,UAAUG,GAAI0D,KAEnFgC,qBAEC,IACwErF,EADlEsF,EAAkB,OACoBd,KAAKS,cAAcM,WAAS,IAAxE,2BACA,CAAA,4CADYC,OAAe5D,OAEpBtC,EAAOkF,KAAKiB,gBAAgB7D,EAAMtC,MAClCoG,EAAiBF,EAAQhB,KAAKS,cAAcU,OAAS,EAAI,KAAO,GAEhEC,mFAGKhE,EAAMtC,KAAKqG,OAASnB,KAAKH,qBAAuBwB,OAAKC,OAAOlE,EAAMtC,MAAQ,0CAEjFuG,OAAKC,OAAOxG,EAAOoG,oCAIvBJ,EAAgB9E,KAAKoF,aACrBnF,eAAAA,MAED,OAAI+D,KAAK3E,OAAO8F,QAAU,EAElBL,EAAgBS,KAAK,IAGtBvB,KAAKwB,QAAQC,IAAIC,WAAW,6BACjCC,QAAQ,iBAAkBb,EAAgBS,KAAK,KAC/CI,QAAQ,SAAU,wDAClBA,QAAQ,UAAW,WACnBA,QAAQ,WAAY3B,KAAKhF,UAAUK,OAAO8F,OAAS,KAIvDS,MAAO,CACN,iBAEDC,QAAS,CACRZ,yBAAgBa,GAEf,OAAIA,EAAUX,OAASnB,KAAKH,qBAEpBiC,YAGEA,EAAUpB,MAAM,EAAGV,KAAKH,8BAEnCkC,wBAEM/B,KAAKC,QAETD,KAAKgC,aAGNhC,KAAKF,iBAAmBE,KAAKhF,UAAUK,OAAOM,KAAI,SAACyB,GAAY,OAAKA,EAAMvB,QAE1EmE,KAAKC,OAAOgC,QAEbD,sBAEC,IAEgD1F,EAF1C4F,EAAmB,GACnBC,EAAoB,OACCnC,KAAKhF,UAAUK,QAAM,IAAhD,2BACA,CAAA,IADW+B,UAEV8E,EAAiBlG,KAAK,CAAC,6BAA8BoB,EAAMvB,OACvDmE,KAAKpB,aAAaxB,EAAMvB,OAE3BsG,EAAkBnG,KAAK,CAAC,6BAA8BoB,EAAMvB,iBAE7DmB,eAAAA,MACDgD,KAAKC,OAAS,IAAImC,SAAO,CACxBjH,GAAI,2BACJkH,WAAYrC,KAAKsC,MAAMC,gBACvBC,MAAO,IACPC,OAAQ,IACRC,cAAc,EACdC,aAAa,EACbC,aAAa,EACbC,cAAc,EACdC,SAAS,EACTZ,iBAAAA,EACAC,kBAAAA,EACAY,SAAU,CACT,CACC5H,GAAI,6BACJ6H,aAAa,EACbC,eAAe,IAGjBC,OAAQ,CACPC,gBAAiBnD,KAAKoD,eACtBC,kBAAmBrD,KAAKsD,kBACxBC,OAAQvD,KAAKwD,oBAGfxD,KAAKC,OAAOwD,WAAWC,UAAU,CAAEC,YAAa,MAChD3D,KAAKC,OAAO2D,iBACZC,MAAIC,SAAS9D,KAAKC,OAAO8D,eAAgB,+BAE1CX,wBAAeY,GAEd,IAAMC,EAAkBD,EAAME,UAAUrH,KAClCxB,EAAkB2E,KAAK3E,OAC7BA,EAAOW,KAAK,CACXH,KAAMoI,EAAUE,QAChBrJ,KAAMmJ,EAAUG,aAEjBpE,KAAKY,OAAOyD,OAAO,qBAAsB,CACxCjI,YAAa4D,KAAKhF,UAAUG,GAC5BE,OAAAA,IAED2E,KAAKsE,MAAM,kBAEZhB,2BAAkBU,GAEjB,IAAMO,EAAoBP,EAAME,UAAUrH,KACpCxB,EAAS2E,KAAK3E,OAAOgB,QAAO,SAACQ,GAAW,OAAKA,EAAKhB,OAAS0I,EAAYpJ,MAC7E6E,KAAKY,OAAOyD,OAAO,qBAAsB,CACxCjI,YAAa4D,KAAKhF,UAAUG,GAC5BE,OAAAA,IAED2E,KAAKsE,MAAM,kBAEZd,0BAAiBQ,GAEhB,IAAMQ,GAAuB1K,EAAMoF,aAClC,IAAIxD,IAAIsE,KAAKF,kBACb,IAAIpE,IAAIsE,KAAKhF,UAAUK,OAAOM,KAAI,SAACyB,GAAY,OAAKA,EAAMvB,UAG3D4I,eAAaC,KACZ,6DACA,CACCvF,kBAAmBqF,KAItBG,8BAEC,IAAMC,EAAW5E,KAAKI,IAAIC,cAAc,eACxCL,KAAK6E,YAAY5C,KAAK2C,EAAU5E,KAAK3E,OAAOqF,MAAM,GAAG/E,KAAI,SAACyB,GAAY,OAAKA,EAAMtC,QAAMyG,KAAK,OAAO,IAEpGuD,8BAEC9E,KAAK6E,YAAYE,OACjB/E,KAAK6E,YAAYG,MAAQ,MAE1BC,+BACA,qBACMhF,qBAALiF,EAAahF,UACbF,KAAKC,OAAS,MAEfkF,8BAEC,IAAMhF,EAAqBH,KAAKI,IAAIC,cAAc,eAC9CF,IAEHG,QAAMC,UAAUJ,GAChBG,QAAM8E,KAAKjF,EAAM,aAAcH,KAAK2E,oBACpCrE,QAAM8E,KAAKjF,EAAM,aAAcH,KAAK8E,uBAIvCO,mBAECrF,KAAK6E,YAAcS,KAAGC,KAAKC,eAAe,CACzCrK,kCAA4BsK,KAAKC,OACjCC,gBAAiB,CAChBC,YAAa,CACZC,SAAU,UAEXrD,MAAO,IACPmB,YAAa,GACbmC,MAAO,CACND,SAAU,MACVE,OAAQ,KAETC,WAAW,KAGbhG,KAAKmF,sBAENc,mBAECjG,KAAKmF,sBAENe,scCnOYC,EAAyC,CACrDzG,MAAO,CACN1E,UAAW,CAEVwD,KAAMmB,OACNC,UAAU,IAGZY,SAAU,CACT4F,oBAEC,OAAIpG,KAAKhF,UAAUwD,OAAS3E,EAEpB,8EAGJmG,KAAKhF,UAAUwD,OAAS3E,EAEpB,8EAGD,+EAERqC,eAEC,OAAOR,QAGTmG,QAAS,CACRwE,yBAEC5B,eAAaC,KACZ,yDACA,CACCzF,uBAAuB,IAGzBe,KAAKsE,MAAM,oBAAqB,CAAElI,YAAa4D,KAAKhF,UAAUG,KAC9D6E,KAAKsG,uBAENA,+BAECtG,KAAKsE,MAAM,sBAEZW,+BAECjF,KAAKsC,MAAMiE,cAActB,wBAG3BrD,MAAO,CACN,oBACA,qBAED4E,WAAY,CACXC,MAAAA,QACAhH,uBAAAA,GAEDyG,mkDC1DM,IAAMQ,EAA6C,CACzDhH,MAAO,CACNpE,WAAY,CAEXkD,KAAMmI,MACN/G,UAAU,IAGZ1C,gBAEC,MAAO,CACN0J,oBAAqB,KAGvBvB,mBAECrF,KAAKgC,cAENH,QAAS,CACRgF,+BAEC7G,KAAK4G,oBAAsB5G,KAAK1E,WAAWK,KAAI,SAACX,GAAoB,OAAKA,EAAUG,MACnF6E,KAAKC,OAAOgC,QAEbD,sBACA,IAEmDxG,SAD5C0G,EAAmB,OACUlC,KAAK1E,YAAU,IAAlD,2BACA,CAAA,IADWN,UAEVkH,EAAiBlG,KAAK,CAAC,iCAAkChB,EAAUG,eACnEc,eAAAA,MACD+D,KAAKC,OAAS,IAAImC,SAAO,CACxBjH,GAAI,2BACJkH,WAAYrC,KAAKsC,MAAMwE,mBACvBtE,MAAO,IACPC,OAAQ,IACRC,cAAc,EACdG,cAAc,EACdC,SAAS,EACTZ,iBAAAA,EACAa,SAAU,CACT,CACC5H,GAAI,iCACJ6H,aAAa,EACbC,eAAe,EACf8D,QAAS,CACRC,eAAe,EACfC,kBAAmBjH,KAAKY,OAAO1C,QAAQQ,iBAI1CwE,OAAQ,CACPC,gBAAiB,SAACa,GAAqB,QAChCnH,EAAamH,EAAM9G,KAAKL,KACxB7B,EAAuB,CAC5BG,GAAI0B,EAAKsH,QACTrJ,KAAM+B,EAAKuH,WACX5F,eAAM3B,EAAKqK,gBAAgB3L,IAAI,uBAAW1B,EAC1CwB,iBAAQwB,EAAKqK,gBAAgB3L,IAAI,yBAAa,IAE/CoF,EAAKC,OAAOyD,OAAO,eAAgBrJ,GACnC2F,EAAK2D,MAAM,uBAEZjB,kBAAmB,SAACW,GACnB,IAAMnH,EAAOmH,EAAM9G,KAAKL,KACxB8D,EAAKC,OAAOyD,OAAO,kBAAmBxH,EAAKsH,SAC3CxD,EAAK2D,MAAM,uBAEZf,OAAQ,SAACS,GACR,IAAMQ,GAAuB1K,EAAMoF,aAClC,IAAIxD,IAAIiF,EAAKiG,qBACb,IAAIlL,IAAIiF,EAAKrF,WAAWK,KAAI,SAACX,GAAoB,OAAKA,EAAUG,QAGjEsJ,eAAaC,KACZ,wDACA,CACCzF,sBAAuBuF,UAQ9B5C,MAAO,CACN,sBAEDuF,MAAO,CACN7L,oBAAW8L,EAAUC,GAEpB,IAC8B/K,EADxB2D,EAAiBD,KAAKC,WACNoH,GAAQ,IAA9B,2BACA,CAAA,MADWC,UAEV,IAAKF,EAASzK,SAAS2K,aAEtBrH,EAAOsH,QAAQ,CAAC,iCAAkCD,EAAQnM,mBAA1DqM,EAAgEC,qBAEjEzK,eAAAA,SAGHkJ,kSCvGYwB,EAAgD,CAC5D9F,MAAO,CAAC,UAAW,SACnBlC,MAAO,GACPxC,gBAEC,MAAO,CACNyK,cAAe,KACfC,QAAS,iCACTC,UAAU,IAGZrH,SAAU,CACTsH,wBAEC,MAAO,CACN3M,GAAI6E,KAAK4H,QACTG,QAAS/H,KAAKsC,MAAMyF,QACpBvF,MAAO,IACPwF,QAAS,GACTC,UAAU,EACVC,SAAS,EACThF,OAAQ,CACPiF,aAAcnI,KAAKoI,WACnBC,eAAgBrI,KAAKoI,YAEtBE,OAAO,IAGTpM,eAEC,OAAOR,QAGTmG,QAAS,CACRuG,sBACA,gBACCG,eAAaC,aAAaxI,KAAK4H,uBAA/Ba,EAAyCvI,UACzCF,KAAK2H,cAAgB,KACrB3H,KAAKsE,MAAM,UAEZoE,qBAEC1I,KAAKsE,MAAM,UAAW,CAAEuD,SAAU7H,KAAK6H,WACvC7H,KAAKoI,cAENO,wBAEC,OAAO3I,KAAKwB,QAAQC,IAAIC,WAAW,2BACjCC,QAAQ,SAAU,8IAClBA,QAAQ,UAAW,UAIvB0D,mBAEMrF,KAAK2H,gBAET3H,KAAK2H,cAAgB,IAAIiB,QAAU5I,KAAK8H,eAGzC9H,KAAK2H,cAAc1F,QAEpBlC,yBAECC,KAAKoI,cAEN5B,WAAY,CACXC,MAAAA,SAEDP,opEChEM,IAAM2C,EAA8C,CAC1DnJ,MAAO,CACNoJ,QAAS,CACRtK,KAAMuK,QACNnJ,UAAU,IAGZoJ,WAAY,CACXC,KAAAA,QAED/L,gBACC,MAAO,CACN2C,qBAAsB,GACtBC,iBAAkB,KAGpBU,SAAU,CACTnF,kBAEC,OAAO2E,KAAKY,OAAO1C,QAAQ9C,aAE5B8N,uBAEC,MAAO,CACNC,KAAMnJ,KAAKwB,QAAQC,IAAIC,WAAW,uBAChCC,QAAQ,SAAU,6FAClBA,QAAQ,UAAW,QACrByH,eAAe,EACftB,aAAc,CACblC,YAAa,CACZC,SAAU,UAEXoC,UAAU,EACVzF,MAAO,IACP6G,WAAY,EACZvD,MAAO,CACND,SAAU,MACVE,OAAQ,OAKZlF,qBAEC,IAAMO,yDAEgBpB,KAAK8I,QAAU,GAAK,mDAC/B9I,KAAK3E,OAAO,GAAGP,KAAKqG,OAASnB,KAAKH,qBAAuBwB,OAAKC,OAAOtB,KAAK3E,OAAO,GAAGP,MAAQ,sCAEnGuG,OAAKC,OAAOtB,KAAKiB,gBAAgBjB,KAAK3E,OAAO,GAAGP,oCAIpD,OAAIkF,KAAK3E,OAAO8F,QAAU,EAElBnB,KAAKwB,QAAQC,IAAIC,WAAW,yBACjCC,QAAQ,UAAW,oCACnBA,QAAQ,WAAY,WACpBA,QAAQ,UAAWP,GAIfpB,KAAKwB,QAAQC,IAAIC,WAAW,8BACjCC,QAAQ,UAAW,oCACnBA,QAAQ,WAAY,WACpBA,QAAQ,iBAAkBP,GAC1BO,QAAQ,SAAU,8DAClBA,QAAQ,UAAW,WACnBA,QAAQ,WAAY3B,KAAK3E,OAAO8F,OAAS,IAG5CmI,2BAEC,OAAOtJ,KAAKwB,QAAQC,IAAIC,WAAW,+BACjCC,QAAQ,UAAW,oCACnBA,QAAQ,WAAY,YAGvBzF,eAEC,OAAOqN,QAGT1H,QAAS,CACR2H,6BAEMxJ,KAAK8I,UAKL9I,KAAKC,QAETD,KAAKgC,aAGNhC,KAAKF,iBAAmBE,KAAK3E,OAAOM,KAAI,SAACyB,GAAY,OAAKA,EAAMvB,QAEhEmE,KAAKC,OAAOgC,SAEbD,sBAEC,IACsCxG,EADhC0G,EAAmB,OACElC,KAAK3E,QAAM,IAAtC,2BACA,CAAA,IADW+B,UAEV8E,EAAiBlG,KAAK,CAAC,6BAA8BoB,EAAMvB,iBAC3DI,eAAAA,MACD+D,KAAKC,OAAS,IAAImC,SAAO,CACxBjH,GAAI,uBACJkH,WAAYrC,KAAKsC,MAAMlH,YACvBoH,MAAO,IACPC,OAAQ,IACRC,cAAc,EACdC,aAAa,EACbC,aAAa,EACbC,cAAc,EACdC,SAAS,EACTZ,iBAAAA,EACAa,SAAU,CACT,CACC5H,GAAI,6BACJ6H,aAAa,EACbC,eAAe,IAGjBC,OAAQ,CACPC,gBAAiBnD,KAAKyJ,gBACtBpG,kBAAmBrD,KAAK0J,mBACxBnG,OAAQvD,KAAK2J,gBAGf3J,KAAKC,OAAOwD,WAAWC,UAAU,CAAEC,YAAa,MAChD3D,KAAKC,OAAO2D,iBACZC,MAAIC,SAAS9D,KAAKC,OAAO8D,eAAgB,+BAE1C0F,yBAAgBzF,GAEf,IAAMnH,EAAamH,EAAME,UAAUrH,KAC7BO,EAAe,CAAEvB,KAAMgB,EAAKsH,QAASrJ,KAAM+B,EAAKuH,YACtDpE,KAAKsE,MAAM,kBAAmBlH,IAE/BsM,4BAAmB1F,GAElB,IAAMnH,EAAamH,EAAME,UAAUrH,KAC7BO,EAAe,CAAEvB,KAAMgB,EAAKsH,QAASrJ,KAAM+B,EAAKuH,YACtDpE,KAAKsE,MAAM,qBAAsBlH,IAElCuM,sBAAa3F,GAEZ,IAAMQ,GAAuB1K,EAAMoF,aAClC,IAAIxD,IAAIsE,KAAKF,kBACb,IAAIpE,IAAIsE,KAAK3E,OAAOM,KAAI,SAACyB,GAAY,OAAKA,EAAMvB,UAGjD4I,eAAaC,KACZ,oDACA,CACCvF,kBAAmBqF,KAItBG,8BAEC,IAAMC,EAAwB5E,KAAKI,IAAIC,cAAc,qBACrDL,KAAK6E,YAAY5C,KAAK2C,EAAU5E,KAAK3E,OAAOqF,MAAM,GAAG/E,KAAI,SAACyB,GAAY,OAAKA,EAAMtC,QAAMyG,KAAK,OAAO,IAEpGuD,8BAEC9E,KAAK6E,YAAYE,OACjB/E,KAAK6E,YAAYG,MAAQ,MAE1B4E,gCAEC,IAAMhF,EAAwB5E,KAAKI,IAAIC,cAAc,sBACrDL,KAAK6J,uBAAuB5H,KAAK2C,EAAU5E,KAAKwB,QAAQC,IAAIC,WAAW,gCAAgC,IAExGoI,gCAEC9J,KAAK6J,uBAAuB9E,OAC5B/E,KAAK6J,uBAAuB7E,MAAQ,MAErC/D,yBAAgBa,GAEf,OAAIA,EAAUX,OAASnB,KAAKH,qBAEpBiC,YAGEA,EAAUpB,MAAM,EAAGV,KAAKH,8BAEnCsF,8BAEC,IAAMhF,EAAqBH,KAAKI,IAAIC,cAAc,qBAQlD,GAPIF,IAEHG,QAAMC,UAAUJ,GAChBG,QAAM8E,KAAKjF,EAAM,aAAcH,KAAK2E,oBACpCrE,QAAM8E,KAAKjF,EAAM,aAAcH,KAAK8E,sBAGhC9E,KAAK8I,QACV,CACC,IAAMhH,EAA0B9B,KAAKI,IAAIC,cAAc,sBACnDyB,IAEHxB,QAAMC,UAAUuB,GAChBxB,QAAM8E,KAAKtD,EAAW,aAAc9B,KAAK4J,sBACzCtJ,QAAM8E,KAAKtD,EAAW,aAAc9B,KAAK8J,0BAK7CzE,mBAECrF,KAAK6E,YAAcS,KAAGC,KAAKC,eAAe,CACzCrK,GAAI,mBACJwK,gBAAiB,CAChBC,YAAa,CACZC,SAAU,UAEXrD,MAAO,IACPmB,YAAa,GACbmC,MAAO,CACND,SAAU,MACVE,OAAQ,KAETC,WAAW,KAGbhG,KAAK6J,uBAAyBvE,KAAGC,KAAKC,eAAe,CACpDrK,GAAI,oBACJwK,gBAAiB,CAChBC,YAAa,CACZC,SAAU,UAEXrD,MAAO,IACPmB,YAAa,IACbmC,MAAO,CACND,SAAU,MACVE,OAAQ,KAETC,WAAW,KAGbhG,KAAKmF,sBAENc,mBAECjG,KAAKmF,sBAENpF,yBAEKC,KAAKC,QAERD,KAAKC,OAAOC,UAEbF,KAAKC,OAAS,KAEd,IAAME,EAAqBH,KAAKI,IAAIC,cAAc,qBAC9CF,GAEHG,QAAMC,UAAUJ,GAGjB,IAAM2B,EAA0B9B,KAAKI,IAAIC,cAAc,sBACnDyB,GAEHxB,QAAMC,UAAUuB,IAGlBF,MAAO,CACN,kBACA,sBAED4E,WAAY,CACXC,MAAAA,SAEDP,imBC1RY6D,EAAuC,CACnDrK,MAAO,CACNoJ,QAAS,CACRtK,KAAMuK,QACNnJ,UAAU,IAGZ1C,gBAEC,MAAO,CACN8M,UAAU,IAGZhB,WAAY,CACXC,KAAAA,QAEDzI,SAAU,CACT3F,UAAW,CACVU,eAEC,OAAOyE,KAAKY,OAAO1C,QAAQrD,WAE5BqB,aAAIjC,GAEH+F,KAAKY,OAAOyD,OAAO,eAAgBpK,KAGrCiC,eAEC,OAAOR,OAERuO,2BAEC,MAAO,CACNC,KAAMlK,KAAKwB,QAAQC,IAAIC,WAAW,6BAClCoG,aAAc,CACblC,YAAa,CACZC,SAAU,UAEXrD,MAAO,IACPmB,WAAY,GACZmC,MAAO,CACND,SAAU,MACVE,OAAQ,OAMblE,QAAS,CACRsI,uBACA,WACCnK,KAAKgK,UAAW,EAChBhK,KAAKoK,WAAU,WACdzJ,EAAK2B,MAAM+H,UAAUC,YAGvBC,uBAECvK,KAAKgK,UAAW,EACXhK,KAAKnF,WAETmF,KAAKY,OAAOyD,OAAO,eAAgBrE,KAAKwB,QAAQC,IAAIC,WAAW,sBAEhE1B,KAAKsE,MAAM,kBAGb1C,MAAO,CACN,gBAED4E,WAAY,CACXC,MAAAA,SAEDP,guDCjEM,IAAMsE,EAA+B,CAC3CnF,mBAECZ,eAAagG,UAAU,+CAAgDzK,KAAK0K,oBAE7E3K,yBAEC0E,eAAakG,YAAY,+CAAgD3K,KAAK0K,oBAE/ExN,gBAEC,MAAO,CACN0N,gBAAiB,CAChBC,YAAY,EACZzO,YAAa,QAIhBoE,SAAU,CACTsK,0BAEC,OAAuD,IAAhD9K,KAAKY,OAAOpG,MAAMF,MAAMW,aAAakG,QAE7C7F,sBAEC,OAAO0E,KAAKY,OAAO1C,QAAQC,qBAE5BI,yBAEC,OAAOyB,KAAKY,OAAO1C,QAAQK,eAE5BG,yBAEC,OAAOsB,KAAKY,OAAO1C,QAAQQ,eAE5B/D,qBAEC,OAAOqF,KAAKY,OAAO1C,QAAQvD,WAE5BoQ,qCAEC,OAAI/K,KAAKtB,cAEDsB,KAAK1E,WAAW6F,OAAS,EAG1BnB,KAAK1E,WAAW6F,OAAS,GAEjCjF,eAEC,OAAOR,QAGTmG,QAAS,CACRmJ,uBAECvG,eAAaC,KAAK,wCAAyC,CAC1DpK,MAAOF,UAAQC,MAAM2F,KAAKY,OAAO1C,QAAQO,WACzCnD,WAAYlB,UAAQC,MAAM2F,KAAKY,OAAO1C,QAAQ5C,eAGhDmO,yBAAgBzF,GAChB,MACChE,KAAKY,OAAOyD,OAAO,gBAAiBL,GACpChE,KAAKgL,cAAc,IACuCxP,gBAA9BwE,KAAKsC,MAAM2I,6BAAiB,IAAE,IAA1D,2BACA,SACehG,gCACdhJ,eAAAA,QAEFyN,4BAAmB1F,GACnB,MACChE,KAAKY,OAAOyD,OAAO,mBAAoBL,GACvChE,KAAKgL,cAAc,IACuC1O,gBAA9B0D,KAAKsC,MAAM2I,6BAAiB,IAAE,IAA1D,2BACA,SACehG,gCACdjI,eAAAA,QAEFkO,2BAAkBlH,GAGhBhE,KAAKtB,eACFsB,KAAKY,OAAO1C,QAAQD,gCAGvB+B,KAAK4K,gBAAgBxO,YAAc4H,EAAM5H,YACzC4D,KAAK4K,gBAAgBC,YAAa,IAIlC7K,KAAKY,OAAOyD,OAAO,kBAAmBL,EAAM5H,aAC5C4D,KAAKgL,gBAGPG,kCAAyBnH,GAExBhE,KAAKY,OAAOyD,OAAO,kBAAmBrE,KAAK4K,gBAAgBxO,aACvD4H,EAAM6D,WAETuD,GAAGC,YAAYC,KAAK,cAAe,gCAAiC,YAAY,GAChFtL,KAAKY,OAAOyD,OAAO,+BAA+B,IAEnDrE,KAAK4K,gBAAgBxO,YAAc,KACnC4D,KAAK4K,gBAAgBC,YAAa,EAClC7K,KAAKgL,eAENO,mCAECvL,KAAK4K,gBAAgBxO,YAAc,KACnC4D,KAAK4K,gBAAgBC,YAAa,GAEnCW,qBACA,WACCxL,KAAKY,OAAOyD,OAAO,gBAAgB,GACnCoH,OAAKC,UAAU,yBAA0B,CACxCxO,KAAM,CACL5C,MAAO0F,KAAKY,OAAO1C,QAAQO,UAC3BnD,0CAAgB0E,KAAKY,OAAO1C,QAAQ5C,WAAWqQ,aAG/CC,MAAK,WACLjL,EAAKC,OAAOyD,OAAO,gBAAgB,GACnC1D,EAAKyH,aACL3D,eAAaC,KAAK,sCAAuC,CACxDpK,MAAOF,UAAQC,MAAMsG,EAAKC,OAAO1C,QAAQO,WACzCnD,WAAYlB,UAAQC,MAAMsG,EAAKC,OAAO1C,QAAQ5C,YAC9C0D,cAAe2B,EAAKC,OAAO1C,QAAQc,cACnCC,sBAAuB0B,EAAKC,OAAO1C,QAAQe,sBAC3CE,kBAAmBwB,EAAKC,OAAO1C,QAAQiB,8BAGlC,SAAC0M,GAAa,MACpBT,GAAG9F,GAAGwG,aAAaC,OAAOC,OAAO,CAChCjE,kBAAS8D,EAASI,OAAO,uBAAhBC,EAAoBC,UAE9BxL,EAAKC,OAAOyD,OAAO,gBAAgB,OAItC+D,sBAEsBG,eAAaC,aAAa,+BACzC4D,SAEP1B,6BAECjG,eAAaC,KAAK,sCAAuC,CACxDpK,MAAO0F,KAAKY,OAAO1C,QAAQO,UAC3BO,cAAegB,KAAKY,OAAO1C,QAAQc,cACnCC,sBAAuBe,KAAKY,OAAO1C,QAAQe,sBAC3CE,kBAAmBa,KAAKY,OAAO1C,QAAQiB,sBAI1CqH,WAAY,CACXC,MAAAA,QACAN,cAAAA,EACAO,kBAAAA,EACAmC,mBAAAA,EACAkB,YAAAA,EACArC,qBAAAA,GAEDxB,+wECvKYmG,aAAc,aAAAtS,oCA2EzB,OA3EyBA,kCAAAC,WAAAC,iBAG1B,IADYqS,yDAA4B,GAEjCC,EAAMvM,KAAKwM,OAAOF,GAElBtH,EAAQ,IAAIyH,QAAM,CACvBtR,GAAI,8BACJqH,MAAO,IACPC,OAAQ,IACRyF,SAAS,EACTwE,WAAW,EACXzE,UAAU,EACVD,QAAS,EACThC,WAAW,EACX+B,QAAS,uBACT7E,OAAQ,CACPiF,aAAc,WACb1D,eAAaC,KAAK,gDAElB6H,EAAII,l//DAIP3H,EAAM/C,OACNsK,EAAIK,MAAM,WACV5S,aAAAC,iBAGD,IADcqS,yDAA4B,GAErChS,EAAegS,EAAUO,OAAOC,MAAK,SAACjQ,GAAW,OAAKA,EAAK1B,KAAOmR,EAAUS,WAC3EzS,IAEJA,EAAQ,CACPa,GAAI,SACJL,KAAM2G,MAAIC,WAAW,qBACrBlD,KAAM9E,EAAUE,OAChByB,OAAQ,GACRJ,aAAc,KAGhB,IAAMT,EAAuB,CAC5BF,MAAAA,EACAmC,YAAa6P,EAAUO,OAAOxQ,QAAO,SAACQ,GAAW,OAAKA,EAAK1B,KAAOmR,EAAUS,WAC5EzR,WAAYgR,EAAUhR,WACtBqD,YAAa2N,EAAU3N,YACvBhE,WAAW,EACXsD,+BAAgCqO,EAAUrO,gCAGrCsO,EAAMS,YAAUC,UAAU,CAC/BnS,KAAM,gBACNoC,gBAEC,MAAO,IAERsJ,WAAY,CACXgE,IAAAA,GAEDhK,SAAU,CACT0M,yBAEC,OAAO1C,IAITtE,sCAKKiH,EAAQrT,EAAMsT,WAAW5S,GAG/B,OAFA+R,EAAIc,IAAIF,GAEDZ"}