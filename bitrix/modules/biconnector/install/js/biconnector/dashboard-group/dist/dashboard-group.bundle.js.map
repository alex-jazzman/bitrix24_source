{"version":3,"file":"dashboard-group.bundle.js","sources":["../src/type.js","../src/store.js","../src/components/dashboard-scope-selector.js","../src/components/dashboard-item.js","../src/components/dashboard-selector.js","../src/components/deletion-warning-popup.js","../src/components/group-scope-selector.js","../src/components/title-editor.js","../src/app.js","../src/dashboard-group.js"],"sourcesContent":["export type GroupAppParams = {\n\tgroupId: string,\n\tgroups: Group[],\n\tdashboards: Map<number, Dashboard>,\n\tsaveEnabled: boolean,\n\tisNeedShowDeletionWarningPopup: boolean,\n};\n\nexport type GroupAppState = {\n\tgroup: Group,\n\totherGroups: Group[],\n\tdashboards: Map<number, Dashboard>,\n\tsaveEnabled: boolean,\n\tisLoading: boolean,\n\tisNeedShowDeletionWarningPopup: boolean,\n};\n\nexport const GroupType = {\n\tsystem: 'SYSTEM',\n\tcustom: 'CUSTOM',\n};\n\nexport const DashboardType = {\n\tsystem: 'SYSTEM',\n\tmarket: 'MARKET',\n\tcustom: 'CUSTOM',\n};\n\nexport type Group = {\n\tid: string,\n\tname: string,\n\ttype: GroupType.system | GroupType.custom,\n\tscopes: Scope[],\n\tdashboardIds: number[],\n}\n\nexport type Dashboard = {\n\tid: number,\n\tname: string,\n\ttype: DashboardType.system | DashboardType.market | DashboardType.custom,\n\tscopes: Scope[],\n};\n\nexport type Scope = {\n\tcode: string,\n\tname: string,\n};\n","/* eslint-disable no-param-reassign */\nimport { createStore } from 'ui.vue3.vuex';\nimport { type Group, type Dashboard, type Scope, GroupType, GroupAppState } from './type';\n\nexport class Store\n{\n\t// eslint-disable-next-line max-lines-per-function\n\tstatic buildStore(defaultValues: GroupAppState)\n\t{\n\t\treturn createStore({\n\t\t\tstate(): GroupAppState\n\t\t\t{\n\t\t\t\treturn defaultValues;\n\t\t\t},\n\t\t\tmutations: {\n\t\t\t\tsetIsLoading(state: GroupAppState, isLoading: boolean)\n\t\t\t\t{\n\t\t\t\t\tstate.isLoading = isLoading;\n\t\t\t\t},\n\t\t\t\tsetGroupName(state: GroupAppState, groupName: string)\n\t\t\t\t{\n\t\t\t\t\tstate.group.name = groupName;\n\t\t\t\t},\n\t\t\t\taddDashboard(state: GroupAppState, dashboard: Dashboard)\n\t\t\t\t{\n\t\t\t\t\tstate.group.dashboardIds.unshift(dashboard.id);\n\n\t\t\t\t\tconst groupScopes = state.group.scopes;\n\t\t\t\t\tif (state.dashboards.get(dashboard.id))\n\t\t\t\t\t{\n\t\t\t\t\t\tdashboard.scopes = state.dashboards.get(dashboard.id).scopes;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst dashboardScopeCodes = new Set(dashboard.scopes.map((dashScope: Scope) => dashScope.code));\n\t\t\t\t\tfor (const groupScope: Scope of groupScopes)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!dashboardScopeCodes.has(groupScope.code))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdashboard.scopes.push(groupScope);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tstate.dashboards.set(dashboard.id, dashboard);\n\t\t\t\t},\n\t\t\t\tremoveDashboard(state: GroupAppState, dashboardId: number)\n\t\t\t\t{\n\t\t\t\t\tconst dashboard: Dashboard = state.dashboards.get(dashboardId);\n\t\t\t\t\tif (!dashboard)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tstate.group.dashboardIds = state.group.dashboardIds.filter((id) => id !== dashboardId);\n\t\t\t\t\tfor (const groupScope: Scope of state.group.scopes)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet dashboardIsInOtherGroupWithScope = false;\n\t\t\t\t\t\tfor (const otherGroup: Group of state.otherGroups)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\totherGroup.dashboardIds.includes(dashboardId)\n\t\t\t\t\t\t\t\t&& otherGroup.scopes.some((item: Scope) => item.code === groupScope.code)\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tdashboardIsInOtherGroupWithScope = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t!dashboardIsInOtherGroupWithScope\n\t\t\t\t\t\t\t&& dashboard.scopes.some((item: Scope) => item.code === groupScope.code)\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdashboard.scopes = dashboard.scopes.filter((item: Scope) => item.code !== groupScope.code);\n\t\t\t\t\t\t\tstate.dashboards.set(dashboardId, dashboard);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetDashboardScopes(state: GroupAppState, data: {dashboardId: number, scopes: Scope[]})\n\t\t\t\t{\n\t\t\t\t\tconst { dashboardId, scopes } = data;\n\t\t\t\t\tconst dashboard: Dashboard = state.dashboards.get(dashboardId);\n\t\t\t\t\tdashboard.scopes = scopes;\n\t\t\t\t},\n\t\t\t\taddGroupScope(state: GroupAppState, scope: Scope)\n\t\t\t\t{\n\t\t\t\t\tstate.group.scopes.push(scope);\n\t\t\t\t\tconst newScopeCode = scope.code;\n\t\t\t\t\tfor (const dashboardId: number of state.group.dashboardIds)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst dashboard = state.dashboards.get(dashboardId);\n\t\t\t\t\t\tif (!dashboard.scopes.some((item: Scope) => item.code === newScopeCode))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdashboard.scopes.push(scope);\n\t\t\t\t\t\t\tstate.dashboards.set(dashboardId, dashboard);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tremoveGroupScope(state: GroupAppState, scope: Scope)\n\t\t\t\t{\n\t\t\t\t\tstate.group.scopes = state.group.scopes.filter((existingScope: Scope) => existingScope.code !== scope.code);\n\t\t\t\t\tconst deletedScopeCode = scope.code;\n\t\t\t\t\tfor (const dashboardId: number of state.group.dashboardIds)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet dashboardIsInOtherGroupWithScope = false;\n\t\t\t\t\t\tfor (const otherGroup: Group of state.otherGroups)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\totherGroup.dashboardIds.includes(dashboardId)\n\t\t\t\t\t\t\t\t&& otherGroup.scopes.some((item: Scope) => item.code === deletedScopeCode)\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tdashboardIsInOtherGroupWithScope = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!dashboardIsInOtherGroupWithScope)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst dashboard = state.dashboards.get(dashboardId);\n\t\t\t\t\t\t\tif (dashboard.scopes.some((item: Scope) => item.code === deletedScopeCode))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tdashboard.scopes = dashboard.scopes.filter((item: Scope) => item.code !== deletedScopeCode);\n\t\t\t\t\t\t\t\tstate.dashboards.set(dashboardId, dashboard);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetShowDeletionWarningPopup(state: GroupAppState, isShow: boolean): void\n\t\t\t\t{\n\t\t\t\t\tstate.isNeedShowDeletionWarningPopup = isShow;\n\t\t\t\t},\n\t\t\t},\n\t\t\tgetters: {\n\t\t\t\tgroupName(state: GroupAppState): string\n\t\t\t\t{\n\t\t\t\t\treturn state.group.name;\n\t\t\t\t},\n\t\t\t\tgroupScopes(state: GroupAppState): Scope[]\n\t\t\t\t{\n\t\t\t\t\treturn state.group.scopes;\n\t\t\t\t},\n\t\t\t\tdashboards(state: GroupAppState): Map<number, Dashboard>\n\t\t\t\t{\n\t\t\t\t\treturn state.dashboards;\n\t\t\t\t},\n\t\t\t\tgroupDashboardsData(state: GroupAppState): Dashboard[]\n\t\t\t\t{\n\t\t\t\t\tconst result = [];\n\t\t\t\t\tfor (const dashboardId of state.group.dashboardIds)\n\t\t\t\t\t{\n\t\t\t\t\t\tresult.push(state.dashboards.get(dashboardId));\n\t\t\t\t\t}\n\n\t\t\t\t\treturn result;\n\t\t\t\t},\n\t\t\t\tisSystemGroup(state: GroupAppState): boolean\n\t\t\t\t{\n\t\t\t\t\treturn state.group.type === GroupType.system;\n\t\t\t\t},\n\t\t\t\tgroupData(state: GroupAppState): Group\n\t\t\t\t{\n\t\t\t\t\treturn {\n\t\t\t\t\t\tid: state.group.id,\n\t\t\t\t\t\tname: state.group.name,\n\t\t\t\t\t\ttype: state.group.type,\n\t\t\t\t\t\tscopes: state.group.scopes,\n\t\t\t\t\t\tdashboardIds: state.group.dashboardIds,\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\tisSaveEnabled(state: GroupAppState): boolean\n\t\t\t\t{\n\t\t\t\t\treturn state.saveEnabled;\n\t\t\t\t},\n\t\t\t\tisLoading(state: GroupAppState): boolean\n\t\t\t\t{\n\t\t\t\t\treturn state.isLoading;\n\t\t\t\t},\n\t\t\t\tisGroupScope(state: GroupAppState): (dashboardId: number, scopeCode: string) => boolean\n\t\t\t\t{\n\t\t\t\t\treturn (dashboardId: number, scopeCode: string) => {\n\t\t\t\t\t\tif (state.group.scopes.some((groupScope: Scope) => groupScope.code === scopeCode))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfor (const otherGroup of state.otherGroups)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\totherGroup.dashboardIds.includes(dashboardId)\n\t\t\t\t\t\t\t\t&& otherGroup.scopes.some((groupScope: Scope) => groupScope.code === scopeCode)\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\tisNeedShowDeletionWarningPopup(state: GroupAppState): boolean\n\t\t\t\t{\n\t\t\t\t\treturn state.isNeedShowDeletionWarningPopup;\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n}\n","import type { BitrixVueComponentProps } from 'ui.vue3';\nimport { Dom, UI } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport { Dialog, Item } from 'ui.entity-selector';\n// eslint-disable-next-line no-unused-vars\nimport type { Scope, Dashboard } from '../type';\n\nexport const DashboardScopeSelector: BitrixVueComponentProps = {\n\tprops: {\n\t\tdashboard: {\n\t\t\t/** @type Dashboard */\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): Object {\n\t\treturn {\n\t\t\tscopeNameLengthLimit: 30,\n\t\t};\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tif (this.dialog)\n\t\t{\n\t\t\tthis.dialog.destroy();\n\t\t}\n\t\tthis.dialog = null;\n\t},\n\tcomputed: {\n\t\tvisibleScopes(): Scope[]\n\t\t{\n\t\t\treturn this.scopes.slice(0, 3);\n\t\t},\n\t\tmoreScopesText(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('BI_GROUP_SCOPES_MORE').replace('#NUMBER#', this.dashboard.scopes.length - 3);\n\t\t},\n\t\tshowMoreScopes(): boolean\n\t\t{\n\t\t\treturn this.dashboard.scopes.length > 3;\n\t\t},\n\t\tscopes(): Scope[]\n\t\t{\n\t\t\treturn [...this.dashboard.scopes];\n\t\t},\n\t\tisGroupScope(): (scopeCode: string) => boolean\n\t\t{\n\t\t\treturn (scopeCode: string) => this.$store.getters.isGroupScope(this.dashboard.id, scopeCode);\n\t\t},\n\t},\n\temits: [\n\t\t'onScopeChange',\n\t],\n\tmethods: {\n\t\tformatScopeName(scopeName: string): string\n\t\t{\n\t\t\tif (scopeName.length < this.scopeNameLengthLimit)\n\t\t\t{\n\t\t\t\treturn scopeName;\n\t\t\t}\n\n\t\t\treturn `${scopeName.slice(0, this.scopeNameLengthLimit)}...`;\n\t\t},\n\t\topenSelector(): void\n\t\t{\n\t\t\tif (!this.dialog)\n\t\t\t{\n\t\t\t\tthis.initDialog();\n\t\t\t}\n\t\t\tthis.dialog.show();\n\t\t},\n\t\tinitDialog(): void\n\t\t{\n\t\t\tconst preselectedItems = [];\n\t\t\tconst undeselectedItems = [];\n\t\t\tfor (const scope: Scope of this.dashboard.scopes)\n\t\t\t{\n\t\t\t\tpreselectedItems.push(['biconnector-superset-scope', scope.code]);\n\t\t\t\tif (this.isGroupScope(scope.code))\n\t\t\t\t{\n\t\t\t\t\tundeselectedItems.push(['biconnector-superset-scope', scope.code]);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.dialog = new Dialog({\n\t\t\t\tid: 'dashboard-scope-selector',\n\t\t\t\ttargetNode: this.$refs.dashboardScopes,\n\t\t\t\twidth: 350,\n\t\t\t\theight: 300,\n\t\t\t\tdropdownMode: true,\n\t\t\t\tcompactView: true,\n\t\t\t\tshowAvatars: false,\n\t\t\t\tenableSearch: true,\n\t\t\t\tpreload: true,\n\t\t\t\tpreselectedItems,\n\t\t\t\tundeselectedItems,\n\t\t\t\tentities: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'biconnector-superset-scope',\n\t\t\t\t\t\tdynamicLoad: true,\n\t\t\t\t\t\tdynamicSearch: true,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onSelect': this.handleScopeAdd,\n\t\t\t\t\t'Item:onDeselect': this.handleScopeRemove,\n\t\t\t\t},\n\t\t\t});\n\t\t\tthis.dialog.getPopup().setOffset({ offsetLeft: -320 });\n\t\t\tthis.dialog.adjustPosition();\n\t\t\tDom.addClass(this.dialog.getContainer(), 'biconnector-scope-selector');\n\t\t},\n\t\thandleScopeAdd(event: BaseEvent): void\n\t\t{\n\t\t\tconst addedItem: Item = event.getData().item;\n\t\t\tconst scopes: Scope[] = this.scopes;\n\t\t\tscopes.push({\n\t\t\t\tcode: addedItem.getId(),\n\t\t\t\tname: addedItem.getTitle(),\n\t\t\t});\n\t\t\tthis.$store.commit('setDashboardScopes', {\n\t\t\t\tdashboardId: this.dashboard.id,\n\t\t\t\tscopes,\n\t\t\t});\n\t\t\tthis.$emit('onScopeChange');\n\t\t},\n\t\thandleScopeRemove(event: BaseEvent): void\n\t\t{\n\t\t\tconst removedItem: Item = event.getData().item;\n\t\t\tconst scopes = this.scopes.filter((item: Scope) => item.code !== removedItem.id);\n\t\t\tthis.$store.commit('setDashboardScopes', {\n\t\t\t\tdashboardId: this.dashboard.id,\n\t\t\t\tscopes,\n\t\t\t});\n\t\t\tthis.$emit('onScopeChange');\n\t\t},\n\t\tshowMoreScopesHint(): void\n\t\t{\n\t\t\tconst hintNode = this.$refs.moreScopesHint;\n\t\t\tthis.hintManager.show(hintNode, this.scopes.slice(3).map((scope: Scope) => scope.name).join(', '), false);\n\t\t},\n\t\thideMoreScopesHint(): void\n\t\t{\n\t\t\tthis.hintManager.hide();\n\t\t},\n\t\tonGroupScopeChanged(): void\n\t\t{\n\t\t\tthis.dialog?.destroy();\n\t\t\tthis.dialog = null;\n\t\t},\n\t},\n\tmounted(): void\n\t{\n\t\tthis.hintManager = UI.Hint.createInstance({\n\t\t\tid: `dashboard-scope-hint-${Date.now()}`,\n\t\t\tpopupParameters: {\n\t\t\t\tbindOptions: {\n\t\t\t\t\tposition: 'bottom',\n\t\t\t\t},\n\t\t\t\twidth: 190,\n\t\t\t\toffsetLeft: -80,\n\t\t\t\tangle: {\n\t\t\t\t\tposition: 'top',\n\t\t\t\t\toffset: 130,\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t},\n\ttemplate: `\n\t\t<div class=\"group-dashboard-scopes-container\">\n\t\t\t<span class=\"scope-list scope-list-dashboard\" @click=\"openSelector\">\n\t\t\t\t<span\n\t\t\t\t\tv-if=\"scopes.length > 0\"\n\t\t\t\t\tv-for=\"(scope, index) of visibleScopes\"\n\t\t\t\t\tclass=\"scope-name\"\n\t\t\t\t\t:title=\"scope.name.length > scopeNameLengthLimit ? scope.name : null\"\n\t\t\t\t>\n\t\t\t\t\t{{formatScopeName(scope.name)}}{{ index < visibleScopes.length - 1 ? ', ' : '' }}\n\t\t\t\t</span>\n\t\t\t\t<span v-else>\n\t\t\t\t\t{{$Bitrix.Loc.getMessage('BI_GROUP_DASHBOARD_SCOPES_EMPTY')}}\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t\t<span\n\t\t\t\tv-if=\"showMoreScopes\"\n\t\t\t\tclass=\"scope-list scope-list-more\"\n\t\t\t\t@click=\"openSelector\"\n\t\t\t\tref=\"moreScopesHint\"\n\t\t\t\t@mouseenter=\"showMoreScopesHint\"\n\t\t\t\t@mouseleave=\"hideMoreScopesHint\"\n\t\t\t>\n\t\t\t\t{{moreScopesText}}\n\t\t\t</span>\n\t\t\t<span ref=\"dashboardScopes\"></span>\n\t\t</div>\n\t`,\n};\n","import type { BitrixVueComponentProps } from 'ui.vue3';\n// eslint-disable-next-line no-unused-vars\nimport { DashboardType, type Dashboard } from '../type';\nimport { DashboardScopeSelector } from './dashboard-scope-selector';\nimport { BIcon, Set } from 'ui.icon-set.api.vue';\n\nexport const DashboardItem: BitrixVueComponentProps = {\n\tprops: {\n\t\tdashboard: {\n\t\t\t/** @type Dashboard */\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed: {\n\t\ticonPath(): string\n\t\t{\n\t\t\tif (this.dashboard.type === DashboardType.system)\n\t\t\t{\n\t\t\t\treturn '/bitrix/images/biconnector/superset-dashboard-selector/icon-type-system.png';\n\t\t\t}\n\n\t\t\tif (this.dashboard.type === DashboardType.market)\n\t\t\t{\n\t\t\t\treturn '/bitrix/images/biconnector/superset-dashboard-selector/icon-type-market.png';\n\t\t\t}\n\n\t\t\treturn '/bitrix/images/biconnector/superset-dashboard-selector/icon-type-custom.png';\n\t\t},\n\t\tset(): Set\n\t\t{\n\t\t\treturn Set;\n\t\t},\n\t},\n\tmethods: {\n\t\tonRemoveClick(): void\n\t\t{\n\t\t\tthis.$emit('onDashboardRemove', { dashboardId: this.dashboard.id });\n\t\t\tthis.emitDashboardChange();\n\t\t},\n\t\temitDashboardChange(): void\n\t\t{\n\t\t\tthis.$emit('onDashboardChange');\n\t\t},\n\t\tonGroupScopeChanged(): void\n\t\t{\n\t\t\tthis.$refs.scopeSelector.onGroupScopeChanged();\n\t\t},\n\t},\n\temits: [\n\t\t'onDashboardChange',\n\t\t'onDashboardRemove',\n\t],\n\tcomponents: {\n\t\tBIcon,\n\t\tDashboardScopeSelector,\n\t},\n\ttemplate: `\n\t\t<div class=\"group-dashboard\">\n\t\t\t<img class=\"group-dashboard-icon\" :src=\"iconPath\" width=\"32\" height=\"32\" alt=\"Dashboard icon\">\n\t\t\t<div class=\"group-dashboard-name\" :title=\"dashboard.name\">{{dashboard.name}}</div>\n\t\t\t<DashboardScopeSelector :dashboard=\"dashboard\" ref=\"scopeSelector\" @on-scope-change=\"emitDashboardChange\"/>\n\t\t\t<BIcon\n\t\t\t\t:name=\"set.CROSS_20\"\n\t\t\t\t:size=\"20\"\n\t\t\t\tcolor=\"#BDC1C6\"\n\t\t\t\t:class=\"'group-dashboard-remove-icon'\"\n\t\t\t\t@click=\"onRemoveClick\"\n\t\t\t></BIcon>\n\t\t</div>\n\t`,\n};\n","import type { BitrixVueComponentProps } from 'ui.vue3';\nimport { DashboardType, type Dashboard } from '../type';\nimport { BaseEvent } from 'main.core.events';\nimport { Dialog, Item } from 'ui.entity-selector';\n\nexport const DashboardSelector: BitrixVueComponentProps = {\n\tprops: {\n\t\tdashboards: {\n\t\t\t/** @type Dashboard[] */\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tmounted()\n\t{\n\t\tthis.initDialog();\n\t},\n\tmethods: {\n\t\tonAddDashboardClick()\n\t\t{\n\t\t\tthis.dialog.show();\n\t\t},\n\t\tinitDialog()\n\t\t{\n\t\t\tconst preselectedItems = [];\n\t\t\tfor (const dashboard: Dashboard of this.dashboards)\n\t\t\t{\n\t\t\t\tpreselectedItems.push(['biconnector-superset-dashboard', dashboard.id]);\n\t\t\t}\n\t\t\tthis.dialog = new Dialog({\n\t\t\t\tid: 'group-dashboard-selector',\n\t\t\t\ttargetNode: this.$refs.addDashboardButton,\n\t\t\t\twidth: 400,\n\t\t\t\theight: 300,\n\t\t\t\tdropdownMode: true,\n\t\t\t\tenableSearch: true,\n\t\t\t\tpreload: true,\n\t\t\t\tpreselectedItems,\n\t\t\t\tentities: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'biconnector-superset-dashboard',\n\t\t\t\t\t\tdynamicLoad: true,\n\t\t\t\t\t\tdynamicSearch: true,\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tloadProxyData: false,\n\t\t\t\t\t\t\tcheckAccessRights: this.$store.getters.isSaveEnabled,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onSelect': (event: BaseEvent) => {\n\t\t\t\t\t\tconst item: Item = event.data.item;\n\t\t\t\t\t\tconst dashboard: Dashboard = {\n\t\t\t\t\t\t\tid: item.getId(),\n\t\t\t\t\t\t\tname: item.getTitle(),\n\t\t\t\t\t\t\ttype: item.getCustomData().get('type') ?? DashboardType.system,\n\t\t\t\t\t\t\tscopes: item.getCustomData().get('scopes') ?? [],\n\t\t\t\t\t\t};\n\t\t\t\t\t\tthis.$store.commit('addDashboard', dashboard);\n\t\t\t\t\t\tthis.$emit('onDashboardsChange');\n\t\t\t\t\t},\n\t\t\t\t\t'Item:onDeselect': (event: BaseEvent) => {\n\t\t\t\t\t\tconst item = event.data.item;\n\t\t\t\t\t\tthis.$store.commit('removeDashboard', item.getId());\n\t\t\t\t\t\tthis.$emit('onDashboardsChange');\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t},\n\temits: [\n\t\t'onDashboardsChange',\n\t],\n\twatch: {\n\t\tdashboards(newValue, oldValue)\n\t\t{\n\t\t\tconst dialog: Dialog = this.dialog;\n\t\t\tfor (const oldItem of oldValue)\n\t\t\t{\n\t\t\t\tif (!newValue.includes(oldItem))\n\t\t\t\t{\n\t\t\t\t\tdialog.getItem(['biconnector-superset-dashboard', oldItem.id])?.deselect();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"ui-btn ui-btn-primary ui-btn-sm ui-btn-round ui-btn-icon-add ui-btn-no-caps group-add-dashboards-button\"\n\t\t\t@click=\"onAddDashboardClick\"\n\t\t\tref=\"addDashboardButton\"\n\t\t>\n\t\t\t{{ $Bitrix.Loc.getMessage('BI_GROUP_ADD_DASHBOARD') }}\n\t\t</div>\n\t`,\n};\n","import type { BitrixVueComponentProps } from 'ui.vue3';\nimport { Popup as MainPopup, PopupManager, type PopupOptions } from 'main.popup';\nimport { BIcon, Set } from 'ui.icon-set.api.vue';\n\nexport const DeletionWarningPopup: BitrixVueComponentProps = {\n\temits: ['confirm', 'close'],\n\tprops: {},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tpopupInstance: null,\n\t\t\tpopupId: 'biconnector-dashboard-deletion',\n\t\t\tdontShow: false,\n\t\t};\n\t},\n\tcomputed: {\n\t\tpopupOptions(): PopupOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tid: this.popupId,\n\t\t\t\tcontent: this.$refs.content,\n\t\t\t\twidth: 400,\n\t\t\t\tpadding: 18,\n\t\t\t\tautoHide: true,\n\t\t\t\toverlay: true,\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose: this.closePopup,\n\t\t\t\t\tonPopupDestroy: this.closePopup,\n\t\t\t\t},\n\t\t\t\tfixed: true,\n\t\t\t};\n\t\t},\n\t\tset(): Set\n\t\t{\n\t\t\treturn Set;\n\t\t},\n\t},\n\tmethods: {\n\t\tclosePopup(): void\n\t\t{\n\t\t\tPopupManager.getPopupById(this.popupId)?.destroy();\n\t\t\tthis.popupInstance = null;\n\t\t\tthis.$emit('close');\n\t\t},\n\t\tonConfirm(): void\n\t\t{\n\t\t\tthis.$emit('confirm', { dontShow: this.dontShow });\n\t\t\tthis.closePopup();\n\t\t},\n\t\tgetPopupText(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('BI_GROUP_SAVE_WARN_TEXT')\n\t\t\t\t.replace('[link]', '<a class=\"ui-link ui-link-primary ui-link-dashed group-warn-popup-box-link\" onclick=\"top.BX.Helper.show(`redirect=detail&code=25556500`)\">')\n\t\t\t\t.replace('[/link]', '</a>')\n\t\t\t;\n\t\t},\n\t},\n\tmounted(): void\n\t{\n\t\tif (!this.popupInstance)\n\t\t{\n\t\t\tthis.popupInstance = new MainPopup(this.popupOptions);\n\t\t}\n\n\t\tthis.popupInstance.show();\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tthis.closePopup();\n\t},\n\tcomponents: {\n\t\tBIcon,\n\t},\n\ttemplate: `\n\t\t<div ref=\"content\" class=\"group-warn-popup\">\n\t\t\t<div class=\"group-warn-popup-title-block\">\n\t\t\t\t<div class=\"group-warn-popup-title\">{{ $Bitrix.Loc.getMessage('BI_GROUP_SAVE_WARN_TITLE') }}</div>\n\t\t\t\t<BIcon\n\t\t\t\t\t:name=\"set.CROSS_30\"\n\t\t\t\t\t:size=\"18\"\n\t\t\t\t\tcolor=\"#BDC1C6\"\n\t\t\t\t\t:class=\"'group-warn-popup-close'\"\n\t\t\t\t\t@click=\"closePopup\"\n\t\t\t\t></BIcon>\n\t\t\t</div>\n\t\t\t<div class=\"group-warn-popup-box\" v-html=\"getPopupText()\"></div>\n\t\t\t<label class=\"group-warn-popup-checkbox\">\n\t\t\t\t<input type=\"checkbox\" v-model=\"dontShow\"/>\n\t\t\t\t<span class=\"group-warn-popup-checkbox-text\">{{ $Bitrix.Loc.getMessage('BI_GROUP_SAVE_WARN_DONT_SHOW') }}</span>\n\t\t\t</label>\n\t\t\t<div class=\"group-warn-popup-separator\"></div>\n\t\t\t<div class=\"group-warn-popup-buttons\">\n\t\t\t\t<div class=\"ui-btn ui-btn-sm ui-btn-primary\" @click=\"onConfirm\">{{ $Bitrix.Loc.getMessage('BI_GROUP_SAVE_WARN_YES') }}</div>\n\t\t\t\t<div class=\"ui-btn ui-btn-sm ui-btn-light-border\" @click=\"closePopup\">{{ $Bitrix.Loc.getMessage('BI_GROUP_SAVE_WARN_NO') }}</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Dom, UI } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport { Dialog, Item } from 'ui.entity-selector';\nimport type { BitrixVueComponentProps } from 'ui.vue3';\nimport { BIcon, Set } from 'ui.icon-set.api.vue';\nimport { hint } from 'ui.vue3.directives.hint';\nimport type { Scope } from '../type';\n\nexport const GroupScopeSelector: BitrixVueComponentProps = {\n\tprops: {\n\t\tcanEdit: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdirectives: {\n\t\thint,\n\t},\n\tdata(): Object {\n\t\treturn {\n\t\t\tscopeNameLengthLimit: 30,\n\t\t};\n\t},\n\tcomputed: {\n\t\tscopes(): Scope[]\n\t\t{\n\t\t\treturn this.$store.getters.groupScopes;\n\t\t},\n\t\tmoreScopesText(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('BI_GROUP_SCOPES_MORE').replace('#NUMBER#', this.scopes.length - 1);\n\t\t},\n\t\tshowMoreScopes(): boolean\n\t\t{\n\t\t\treturn this.scopes.length > 1;\n\t\t},\n\t\thintOptions(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\thtml: this.$Bitrix.Loc.getMessage('BI_GROUP_SCOPE_HINT')\n\t\t\t\t\t.replace('[link]', '<a class=\"scope-hint-link\" onclick=\"top.BX.Helper.show(`redirect=detail&code=25556500`)\">')\n\t\t\t\t\t.replace('[/link]', '</a>'),\n\t\t\t\tinteractivity: true,\n\t\t\t\tpopupOptions: {\n\t\t\t\t\tbindOptions: {\n\t\t\t\t\t\tposition: 'bottom',\n\t\t\t\t\t},\n\t\t\t\t\tautoHide: false,\n\t\t\t\t\twidth: 244,\n\t\t\t\t\toffsetTop: -4,\n\t\t\t\t\tangle: {\n\t\t\t\t\t\tposition: 'top',\n\t\t\t\t\t\toffset: 34,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\tsystemScopeHintOptions(): ?Object\n\t\t{\n\t\t\tif (this.canEdit)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\ttext: this.$Bitrix.Loc.getMessage('BI_GROUP_SYSTEM_SCOPES_HINT'),\n\t\t\t\tpopupOptions: {\n\t\t\t\t\tbindOptions: {\n\t\t\t\t\t\tposition: 'bottom',\n\t\t\t\t\t},\n\t\t\t\t\twidth: 244,\n\t\t\t\t\toffsetLeft: -140,\n\t\t\t\t\tangle: {\n\t\t\t\t\t\tposition: 'top',\n\t\t\t\t\t\toffset: 180,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\tset(): Set\n\t\t{\n\t\t\treturn Set;\n\t\t},\n\t},\n\tmethods: {\n\t\topenScopeSelector(): void\n\t\t{\n\t\t\tif (!this.canEdit)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.dialog)\n\t\t\t{\n\t\t\t\tthis.initDialog();\n\t\t\t}\n\t\t\tthis.dialog.show();\n\t\t},\n\t\tinitDialog(): void\n\t\t{\n\t\t\tconst preselectedItems = [];\n\t\t\tfor (const scope: Scope of this.scopes)\n\t\t\t{\n\t\t\t\tpreselectedItems.push(['biconnector-superset-scope', scope.code]);\n\t\t\t}\n\t\t\tthis.dialog = new Dialog({\n\t\t\t\tid: 'group-scope-selector',\n\t\t\t\ttargetNode: this.$refs.groupScopes,\n\t\t\t\twidth: 350,\n\t\t\t\theight: 300,\n\t\t\t\tdropdownMode: true,\n\t\t\t\tcompactView: true,\n\t\t\t\tshowAvatars: false,\n\t\t\t\tenableSearch: true,\n\t\t\t\tpreload: true,\n\t\t\t\tpreselectedItems,\n\t\t\t\tentities: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'biconnector-superset-scope',\n\t\t\t\t\t\tdynamicLoad: true,\n\t\t\t\t\t\tdynamicSearch: true,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onSelect': this.onGroupScopeAdd,\n\t\t\t\t\t'Item:onDeselect': this.onGroupScopeRemove,\n\t\t\t\t},\n\t\t\t});\n\t\t\tthis.dialog.getPopup().setOffset({ offsetLeft: -320 });\n\t\t\tthis.dialog.adjustPosition();\n\t\t\tDom.addClass(this.dialog.getContainer(), 'biconnector-scope-selector');\n\t\t},\n\t\tonGroupScopeAdd(event: BaseEvent): void\n\t\t{\n\t\t\tconst item: Item = event.getData().item;\n\t\t\tconst scope: Scope = { code: item.getId(), name: item.getTitle() };\n\t\t\tthis.$emit('onGroupScopeAdd', scope);\n\t\t},\n\t\tonGroupScopeRemove(event: BaseEvent): void\n\t\t{\n\t\t\tconst item: Item = event.getData().item;\n\t\t\tconst scope: Scope = { code: item.getId(), name: item.getTitle() };\n\t\t\tthis.$emit('onGroupScopeRemove', scope);\n\t\t},\n\t\tshowMoreScopesHint(): void\n\t\t{\n\t\t\tconst hintNode = this.$refs.moreScopesHint;\n\t\t\tthis.hintManager.show(hintNode, this.scopes.slice(1).map((scope: Scope) => scope.name).join(', '), false);\n\t\t},\n\t\thideMoreScopesHint(): void\n\t\t{\n\t\t\tthis.hintManager.hide();\n\t\t},\n\t\tformatScopeName(scopeName: string): string\n\t\t{\n\t\t\tif (scopeName.length < this.scopeNameLengthLimit)\n\t\t\t{\n\t\t\t\treturn scopeName;\n\t\t\t}\n\n\t\t\treturn `${scopeName.slice(0, this.scopeNameLengthLimit)}...`;\n\t\t},\n\t},\n\tmounted()\n\t{\n\t\tthis.hintManager = UI.Hint.createInstance({\n\t\t\tid: 'group-scope-hint',\n\t\t\tpopupParameters: {\n\t\t\t\tbindOptions: {\n\t\t\t\t\tposition: 'bottom',\n\t\t\t\t},\n\t\t\t\twidth: 190,\n\t\t\t\toffsetLeft: -80,\n\t\t\t\tangle: {\n\t\t\t\t\tposition: 'top',\n\t\t\t\t\toffset: 130,\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t},\n\temits: [\n\t\t'onGroupScopeAdd',\n\t\t'onGroupScopeRemove',\n\t],\n\tcomponents: {\n\t\tBIcon,\n\t},\n\ttemplate: `\n\t\t<span class=\"scopes-title\">\n\t\t\t{{$Bitrix.Loc.getMessage('BI_GROUP_SCOPES')}}\n\t\t</span>\n\t\t<span\n\t\t\tv-if=\"scopes.length > 0\"\n\t\t\t@click=\"openScopeSelector\"\n\t\t\tclass=\"scope-list scope-list-group\"\n\t\t\t:class=\"{'scope-list-system': !canEdit}\"\n\t\t\tv-hint=\"systemScopeHintOptions\"\n\t\t\t:title=\"scopes[0].name.length > scopeNameLengthLimit ? scopes[0].name : null\"\n\t\t>\n\t\t\t{{formatScopeName(scopes[0].name)}}\n\t\t</span>\n\t\t<span\n\t\t\tv-else\n\t\t\tclass=\"scope-list scope-list-group\"\n\t\t\t:class=\"{'scope-list-system': !canEdit}\"\n\t\t\t@click=\"openScopeSelector\"\n\t\t>\n\t\t\t{{$Bitrix.Loc.getMessage('BI_GROUP_SCOPES_EMPTY')}}\n\t\t</span>\n\t\t<span\n\t\t\tv-if=\"showMoreScopes\"\n\t\t\t@click=\"openScopeSelector\"\n\t\t\tclass=\"scope-list scope-list-more\"\n\t\t\tref=\"moreScopesHint\"\n\t\t\t@mouseenter=\"showMoreScopesHint\"\n\t\t\t@mouseleave=\"hideMoreScopesHint\"\n\t\t>\n\t\t\t{{moreScopesText}}\n\t\t</span>\n\t\t<div class=\"group-scope-list-hint\" ref=\"groupScopes\" v-hint=\"hintOptions\">\n\t\t\t<BIcon\n\t\t\t\t:name=\"set.HELP\"\n\t\t\t\t:size=\"20\"\n\t\t\t\tcolor=\"#D5D7DB\"\n\t\t\t></BIcon>\n\t\t</div>\n\t`,\n};\n","import type { BitrixVueComponentProps } from 'ui.vue3';\nimport { BIcon, Set } from 'ui.icon-set.api.vue';\nimport { hint } from 'ui.vue3.directives.hint';\n\nexport const TitleEditor: BitrixVueComponentProps = {\n\tprops: {\n\t\tcanEdit: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\teditMode: false,\n\t\t};\n\t},\n\tdirectives: {\n\t\thint,\n\t},\n\tcomputed: {\n\t\tgroupName: {\n\t\t\tget(): string\n\t\t\t{\n\t\t\t\treturn this.$store.getters.groupName;\n\t\t\t},\n\t\t\tset(value): void\n\t\t\t{\n\t\t\t\tthis.$store.commit('setGroupName', value);\n\t\t\t},\n\t\t},\n\t\tset(): Set\n\t\t{\n\t\t\treturn Set;\n\t\t},\n\t\tnameHintOptions(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\ttext: this.$Bitrix.Loc.getMessage('BI_GROUP_SYSTEM_NAME_HINT'),\n\t\t\t\tpopupOptions: {\n\t\t\t\t\tbindOptions: {\n\t\t\t\t\t\tposition: 'bottom',\n\t\t\t\t\t},\n\t\t\t\t\twidth: 220,\n\t\t\t\t\toffsetLeft: 40,\n\t\t\t\t\tangle: {\n\t\t\t\t\t\tposition: 'top',\n\t\t\t\t\t\toffset: 0,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t},\n\tmethods: {\n\t\tsetEditMode()\n\t\t{\n\t\t\tthis.editMode = true;\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.$refs.nameInput.focus();\n\t\t\t});\n\t\t},\n\t\tsetViewMode()\n\t\t{\n\t\t\tthis.editMode = false;\n\t\t\tif (!this.groupName)\n\t\t\t{\n\t\t\t\tthis.$store.commit('setGroupName', this.$Bitrix.Loc.getMessage('BI_GROUP_NAME_NEW'));\n\t\t\t}\n\t\t\tthis.$emit('onNameUpdate');\n\t\t},\n\t},\n\temits: [\n\t\t'onNameUpdate',\n\t],\n\tcomponents: {\n\t\tBIcon,\n\t},\n\ttemplate: `\n\t\t<div class=\"group-header-title\" :style=\"{ width: editMode ? '80%' : 'auto' }\">\n\t\t\t<template v-if=\"canEdit\">\n\t\t\t\t<input v-if=\"editMode\" class=\"group-name-input\" @blur=\"setViewMode\" v-model=\"groupName\" ref=\"nameInput\">\n\t\t\t\t<template v-else>\n\t\t\t\t\t<div class=\"group-name\">{{groupName}}</div>\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\t:name=\"set.PENCIL_40\"\n\t\t\t\t\t\t:size=\"20\"\n\t\t\t\t\t\tcolor=\"#BDC1C6\"\n\t\t\t\t\t\t:class=\"'group-name-edit-icon'\"\n\t\t\t\t\t\t@click=\"setEditMode\"\n\t\t\t\t\t></BIcon>\n\t\t\t\t</template>\n\t\t\t</template>\n\t\t\t<template v-else>\n\t\t\t\t<div class=\"group-name\" v-hint=\"nameHintOptions\">{{groupName}}</div>\n\t\t\t</template>\n\t\t</div>\n\t`,\n};\n","import { ajax as Ajax, Runtime } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Popup, PopupManager } from 'main.popup';\nimport { BIcon, Set } from 'ui.icon-set.api.vue';\nimport type { BitrixVueComponentProps } from 'ui.vue3';\nimport { DashboardItem } from './components/dashboard-item';\nimport { DashboardSelector } from './components/dashboard-selector';\nimport { DeletionWarningPopup } from './components/deletion-warning-popup';\nimport { GroupScopeSelector } from './components/group-scope-selector';\nimport { TitleEditor } from './components/title-editor';\nimport type { Dashboard } from './type';\n\nexport const App: BitrixVueComponentProps = {\n\tmounted(): void\n\t{},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tdeletionWarning: {\n\t\t\t\tpopupShown: false,\n\t\t\t\tdashboardId: null,\n\t\t\t},\n\t\t};\n\t},\n\tcomputed: {\n\t\tisNoDashboards(): boolean\n\t\t{\n\t\t\treturn this.$store.state.group.dashboardIds.length === 0;\n\t\t},\n\t\tdashboards(): Dashboard[]\n\t\t{\n\t\t\treturn this.$store.getters.groupDashboardsData;\n\t\t},\n\t\tisSystemGroup(): boolean\n\t\t{\n\t\t\treturn this.$store.getters.isSystemGroup;\n\t\t},\n\t\tisSaveEnabled(): boolean\n\t\t{\n\t\t\treturn this.$store.getters.isSaveEnabled;\n\t\t},\n\t\tisLoading(): boolean\n\t\t{\n\t\t\treturn this.$store.getters.isLoading;\n\t\t},\n\t\tisDashboardListScrollable(): boolean\n\t\t{\n\t\t\tif (this.isSaveEnabled)\n\t\t\t{\n\t\t\t\treturn this.dashboards.length > 6;\n\t\t\t}\n\n\t\t\treturn this.dashboards.length > 7;\n\t\t},\n\t\tset(): Set\n\t\t{\n\t\t\treturn Set;\n\t\t},\n\t},\n\tmethods: {\n\t\tupdateRight(): void\n\t\t{\n\t\t\tEventEmitter.emit('BIConnector.GroupPopup:onGroupUpdated', {\n\t\t\t\tgroup: Runtime.clone(this.$store.getters.groupData),\n\t\t\t\tdashboards: Runtime.clone(this.$store.getters.dashboards),\n\t\t\t});\n\t\t},\n\t\tonGroupScopeAdd(event): void\n\t\t{\n\t\t\tthis.$store.commit('addGroupScope', event);\n\t\t\tthis.updateRight();\n\t\t\tfor (const dashboardItem of this.$refs.dashboardItem ?? [])\n\t\t\t{\n\t\t\t\tdashboardItem.onGroupScopeChanged();\n\t\t\t}\n\t\t},\n\t\tonGroupScopeRemove(event): void\n\t\t{\n\t\t\tthis.$store.commit('removeGroupScope', event);\n\t\t\tthis.updateRight();\n\t\t\tfor (const dashboardItem of this.$refs.dashboardItem ?? [])\n\t\t\t{\n\t\t\t\tdashboardItem.onGroupScopeChanged();\n\t\t\t}\n\t\t},\n\t\tonDashboardRemove(event): void\n\t\t{\n\t\t\tif (\n\t\t\t\tthis.isSaveEnabled\n\t\t\t\t&& this.$store.getters.isNeedShowDeletionWarningPopup\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.deletionWarning.dashboardId = event.dashboardId;\n\t\t\t\tthis.deletionWarning.popupShown = true;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.$store.commit('removeDashboard', event.dashboardId);\n\t\t\t\tthis.updateRight();\n\t\t\t}\n\t\t},\n\t\tconfirmDashboardDeletion(event): void\n\t\t{\n\t\t\tthis.$store.commit('removeDashboard', this.deletionWarning.dashboardId);\n\t\t\tif (event.dontShow)\n\t\t\t{\n\t\t\t\tBX.userOptions.save('biconnector', 'deleteDashboardFromGroupPopup', 'needShow', false);\n\t\t\t\tthis.$store.commit('setShowDeletionWarningPopup', false);\n\t\t\t}\n\t\t\tthis.deletionWarning.dashboardId = null;\n\t\t\tthis.deletionWarning.popupShown = false;\n\t\t\tthis.updateRight();\n\t\t},\n\t\tcancelDashboardDeletion(): void\n\t\t{\n\t\t\tthis.deletionWarning.dashboardId = null;\n\t\t\tthis.deletionWarning.popupShown = false;\n\t\t},\n\t\tsaveGroup(): void\n\t\t{\n\t\t\tthis.$store.commit('setIsLoading', true);\n\t\t\tAjax.runAction('biconnector.group.save', {\n\t\t\t\tdata: {\n\t\t\t\t\tgroup: this.$store.getters.groupData,\n\t\t\t\t\tdashboards: [...this.$store.getters.dashboards.values()],\n\t\t\t\t},\n\t\t\t})\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.$store.commit('setIsLoading', false);\n\t\t\t\t\tthis.closePopup();\n\t\t\t\t\tEventEmitter.emit('BIConnector.GroupPopup:onGroupSaved', {\n\t\t\t\t\t\tgroup: Runtime.clone(this.$store.getters.groupData),\n\t\t\t\t\t\tdashboards: Runtime.clone(this.$store.getters.dashboards),\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch((response) => {\n\t\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: response.errors[0]?.message,\n\t\t\t\t\t});\n\t\t\t\t\tthis.$store.commit('setIsLoading', false);\n\t\t\t\t})\n\t\t\t;\n\t\t},\n\t\tclosePopup(): void\n\t\t{\n\t\t\tconst popup: Popup = PopupManager.getPopupById('biconnector-dashboard-group');\n\t\t\tpopup.close();\n\t\t},\n\t},\n\tcomponents: {\n\t\tBIcon,\n\t\tDashboardItem,\n\t\tDashboardSelector,\n\t\tGroupScopeSelector,\n\t\tTitleEditor,\n\t\tDeletionWarningPopup,\n\t},\n\ttemplate: `\n\t\t<div class=\"group-header\">\n\t\t\t<TitleEditor @on-name-update=\"updateRight\" :can-edit=\"!isSystemGroup\"/>\n\t\t\t<div class=\"group-header-controls\">\n\t\t\t\t<BIcon\n\t\t\t\t\t:name=\"set.CROSS_25\"\n\t\t\t\t\t:size=\"25\"\n\t\t\t\t\tcolor=\"#BDC1C6\"\n\t\t\t\t\t:class=\"'group-close'\"\n\t\t\t\t\t@click=\"closePopup\"\n\t\t\t\t></BIcon>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"group-button-panel\">\n\t\t\t<div class=\"group-button-wrapper\">\n\t\t\t\t<DashboardSelector :dashboards=\"dashboards\" @on-dashboards-change=\"updateRight\"/>\n\t\t\t</div>\n\t\t\t<div class=\"group-scope-selector\">\n\t\t\t\t<GroupScopeSelector @on-group-scope-add=\"onGroupScopeAdd\" @on-group-scope-remove=\"onGroupScopeRemove\" :can-edit=\"!isSystemGroup\"/>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"group-dashboard-empty\" v-if=\"isNoDashboards\">\n\t\t\t<img class=\"group-dashboard-empty-image\" src=\"/bitrix/images/biconnector/dashboard-groups/empty-state.svg\" alt=\"No dashboards\">\n\t\t\t<div class=\"group-dashboard-empty-title\">{{ $Bitrix.Loc.getMessage('BI_GROUP_EMPTY_TITLE') }}</div>\n\t\t\t<div class=\"group-dashboard-empty-subtitle\">{{ $Bitrix.Loc.getMessage('BI_GROUP_EMPTY_SUBTITLE') }}</div>\n\t\t</div>\n\t\t<div class=\"group-dashboard-list\" :class=\"{'group-dashboard-list-scroll': isDashboardListScrollable}\" v-else>\n\t\t\t<DashboardItem \n\t\t\t\tv-for=\"dashboard of dashboards\" \n\t\t\t\tref=\"dashboardItem\" \n\t\t\t\t:dashboard=\"dashboard\" \n\t\t\t\t@on-dashboard-change=\"updateRight\"\n\t\t\t\t@on-dashboard-remove=\"onDashboardRemove\"\n\t\t\t/>\n\t\t</div>\n\t\t<div class=\"group-footer\" v-if=\"isSaveEnabled\">\n\t\t\t<div\n\t\t\t\t:class=\"['ui-btn ui-btn-primary ui-btn-md ui-btn-round ui-btn-no-caps group-footer-button', {'ui-btn-disabled ui-btn-clock': isLoading}]\" \n\t\t\t\t@click=\"saveGroup\"\n\t\t\t>\n\t\t\t\t{{ $Bitrix.Loc.getMessage('BI_GROUP_SAVE') }}\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tclass=\"ui-btn ui-btn-light-border ui-btn-md ui-btn-round ui-btn-no-caps group-footer-button\"\n\t\t\t\t@click=\"closePopup\"\n\t\t\t>\n\t\t\t\t{{ $Bitrix.Loc.getMessage('BI_GROUP_SAVE_CANCEL') }}\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"group-loader\" v-if=\"isLoading\"></div>\n\t\t<DeletionWarningPopup \n\t\t\tv-if=\"deletionWarning.popupShown\" \n\t\t\t@confirm=\"confirmDashboardDeletion\" \n\t\t\t@close=\"cancelDashboardDeletion\"\n\t\t/>\n\t`,\n};\n","import { Popup } from 'main.popup';\nimport { Loc } from 'main.core';\nimport { BitrixVue } from 'ui.vue3';\nimport { Store } from './store';\nimport { App } from './app';\nimport { type Group, GroupAppParams, GroupAppState, GroupType } from './type';\n\nexport class DashboardGroup\n{\n\tstatic open(appParams: GroupAppParams = {})\n\t{\n\t\tconst app = this.getApp(appParams);\n\n\t\tconst popup = new Popup({\n\t\t\tid: 'biconnector-dashboard-group',\n\t\t\twidth: 800,\n\t\t\theight: 560,\n\t\t\toverlay: true,\n\t\t\tcloseIcon: false,\n\t\t\tautoHide: true,\n\t\t\tpadding: 0,\n\t\t\tcacheable: false,\n\t\t\tcontent: '<div id=\"app\"></div>',\n\t\t\tevents: {\n\t\t\t\tonPopupClose: () => {\n\t\t\t\t\tapp.unmount();\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t\tpopup.show();\n\t\tapp.mount('#app');\n\t}\n\n\tstatic getApp(appParams: GroupAppParams = {})\n\t{\n\t\tlet group: Group = appParams.groups.find((item: Group) => item.id === appParams.groupId);\n\t\tif (!group)\n\t\t{\n\t\t\tgroup = {\n\t\t\t\tid: 'new_G0',\n\t\t\t\tname: Loc.getMessage('BI_GROUP_NAME_NEW'),\n\t\t\t\ttype: GroupType.custom,\n\t\t\t\tscopes: [],\n\t\t\t\tdashboardIds: [],\n\t\t\t};\n\t\t}\n\t\tconst state: GroupAppState = {\n\t\t\tgroup,\n\t\t\totherGroups: appParams.groups.filter((item: Group) => item.id !== appParams.groupId),\n\t\t\tdashboards: appParams.dashboards,\n\t\t\tsaveEnabled: appParams.saveEnabled,\n\t\t\tisLoading: false,\n\t\t\tisNeedShowDeletionWarningPopup: appParams.isNeedShowDeletionWarningPopup,\n\t\t};\n\n\t\tconst app = BitrixVue.createApp({\n\t\t\tname: 'GroupPopupApp',\n\t\t\tdata()\n\t\t\t{\n\t\t\t\treturn {};\n\t\t\t},\n\t\t\tcomponents: {\n\t\t\t\tApp,\n\t\t\t},\n\t\t\tcomputed: {\n\t\t\t\tcomponentName()\n\t\t\t\t{\n\t\t\t\t\treturn App;\n\t\t\t\t},\n\t\t\t},\n\t\t\t// language=Vue\n\t\t\ttemplate: `\n\t\t\t\t<App/>\n\t\t\t`,\n\t\t});\n\n\t\tconst store = Store.buildStore(state);\n\t\tapp.use(store);\n\n\t\treturn app;\n\t}\n}\n"],"names":["GroupType","system","custom","DashboardType","Store","babelHelpers","key","value","defaultValues","createStore","state","mutations","setIsLoading","isLoading","setGroupName","groupName","group","name","addDashboard","dashboard","dashboardIds","unshift","id","groupScopes","scopes","dashboards","get","_step","dashboardScopeCodes","Set","map","dashScope","code","groupScope","has","push","_iterator","set","removeDashboard","dashboardId","filter","_step2","_step3","dashboardIsInOtherGroupWithScope","otherGroups","otherGroup","includes","some","item","_iterator3","_loop","_iterator2","setDashboardScopes","data","addGroupScope","scope","_step4","newScopeCode","_iterator4","removeGroupScope","existingScope","_step5","deletedScopeCode","_step6","_iterator6","_iterator5","setShowDeletionWarningPopup","isShow","isNeedShowDeletionWarningPopup","getters","groupDashboardsData","_step7","result","_iterator7","isSystemGroup","type","groupData","isSaveEnabled","saveEnabled","isGroupScope","scopeCode","_step8","_iterator8","DashboardScopeSelector","props","Object","required","scopeNameLengthLimit","beforeUnmount","this","dialog","destroy","computed","visibleScopes","slice","moreScopesText","$Bitrix","Loc","getMessage","replace","length","showMoreScopes","_this","$store","emits","methods","formatScopeName","scopeName","openSelector","initDialog","show","preselectedItems","undeselectedItems","Dialog","targetNode","$refs","dashboardScopes","width","height","dropdownMode","compactView","showAvatars","enableSearch","preload","entities","dynamicLoad","dynamicSearch","events","Item:onSelect","handleScopeAdd","Item:onDeselect","handleScopeRemove","getPopup","setOffset","offsetLeft","adjustPosition","Dom","addClass","getContainer","event","addedItem","getData","getId","getTitle","commit","$emit","removedItem","showMoreScopesHint","hintNode","moreScopesHint","hintManager","join","hideMoreScopesHint","hide","onGroupScopeChanged","_this$dialog","mounted","UI","Hint","createInstance","Date","now","popupParameters","bindOptions","position","angle","offset","template","DashboardItem","iconPath","onRemoveClick","emitDashboardChange","scopeSelector","components","BIcon","DashboardSelector","Array","onAddDashboardClick","addDashboardButton","options","loadProxyData","checkAccessRights","getCustomData","watch","newValue","oldValue","oldItem","getItem","_dialog$getItem","deselect","DeletionWarningPopup","popupInstance","popupId","dontShow","popupOptions","content","padding","autoHide","overlay","onPopupClose","closePopup","onPopupDestroy","fixed","PopupManager","getPopupById","_PopupManager$getPopu","onConfirm","getPopupText","MainPopup","GroupScopeSelector","canEdit","Boolean","directives","hint","hintOptions","html","interactivity","offsetTop","systemScopeHintOptions","text","openScopeSelector","onGroupScopeAdd","onGroupScopeRemove","TitleEditor","editMode","nameHintOptions","setEditMode","$nextTick","nameInput","focus","setViewMode","App","deletionWarning","popupShown","isNoDashboards","isDashboardListScrollable","updateRight","EventEmitter","emit","Runtime","clone","dashboardItem","onDashboardRemove","confirmDashboardDeletion","BX","userOptions","save","cancelDashboardDeletion","saveGroup","Ajax","runAction","values","then","response","Notification","Center","notify","errors","_response$errors$","message","close","DashboardGroup","appParams","app","getApp","popup","Popup","closeIcon","cacheable","unmount","mount","groups","find","groupId","BitrixVue","createApp","componentName","store","buildStore","use"],"mappings":"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"}