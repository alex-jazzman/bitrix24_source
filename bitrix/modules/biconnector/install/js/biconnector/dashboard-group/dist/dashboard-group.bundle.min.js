this.BX=this.BX||{},function(t,e,o,n,s,i,r,a,c){"use strict";var d={system:"SYSTEM",custom:"CUSTOM"},p="SYSTEM",u="MARKET";function l(t,e){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function(t,e){if(!t)return;if("string"==typeof t)return h(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return h(t,e)}(t))||e&&t&&"number"==typeof t.length){o&&(t=o);var n=0,s=function(){};return{s:s,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,r=!0,a=!1;return{s:function(){o=o.call(t)},n:function(){var t=o.next();return r=t.done,t},e:function(t){a=!0,i=t},f:function(){try{r||null==o.return||o.return()}finally{if(a)throw i}}}}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=new Array(e);o<e;o++)n[o]=t[o];return n}var f=function(){function t(){babelHelpers.classCallCheck(this,t)}return babelHelpers.createClass(t,null,[{key:"buildStore",value:function(e){return t.initialGroup=s.Runtime.clone(e.group),o.createStore({state:function(){return e},mutations:{setIsLoading:function(t,e){t.isLoading=e},setGroupName:function(t,e){t.group.name=e},addDashboard:function(t,e){t.group.dashboardIds.unshift(e.id);var o=t.group.scopes;t.dashboards.get(e.id)&&(e.scopes=t.dashboards.get(e.id).scopes);var n,s=new Set(e.scopes.map((function(t){return t.code}))),i=l(o);try{for(i.s();!(n=i.n()).done;){var r=n.value;s.has(r.code)||e.scopes.push(r)}}catch(t){i.e(t)}finally{i.f()}t.dashboards.set(e.id,e)},removeDashboard:function(t,e){var o=t.dashboards.get(e);if(o){t.group.dashboardIds=t.group.dashboardIds.filter((function(t){return t!==e}));var n,s=l(t.group.scopes);try{var i=function(){var s,i=n.value,r=!1,a=l(t.otherGroups);try{for(a.s();!(s=a.n()).done;){var c=s.value;c.dashboardIds.includes(e)&&c.scopes.some((function(t){return t.code===i.code}))&&(r=!0)}}catch(t){a.e(t)}finally{a.f()}!r&&o.scopes.some((function(t){return t.code===i.code}))&&(o.scopes=o.scopes.filter((function(t){return t.code!==i.code})),t.dashboards.set(e,o))};for(s.s();!(n=s.n()).done;)i()}catch(t){s.e(t)}finally{s.f()}}},setDashboardScopes:function(t,e){var o=e.dashboardId,n=e.scopes;t.dashboards.get(o).scopes=n},addGroupScope:function(t,e){t.group.scopes.push(e);var o,n=e.code,s=l(t.group.dashboardIds);try{for(s.s();!(o=s.n()).done;){var i=o.value,r=t.dashboards.get(i);r.scopes.some((function(t){return t.code===n}))||(r.scopes.push(e),t.dashboards.set(i,r))}}catch(t){s.e(t)}finally{s.f()}},removeGroupScope:function(t,e){t.group.scopes=t.group.scopes.filter((function(t){return t.code!==e.code}));var o,n=e.code,s=l(t.group.dashboardIds);try{for(s.s();!(o=s.n()).done;){var i,r=o.value,a=!1,c=l(t.otherGroups);try{for(c.s();!(i=c.n()).done;){var d=i.value;d.dashboardIds.includes(r)&&d.scopes.some((function(t){return t.code===n}))&&(a=!0)}}catch(t){c.e(t)}finally{c.f()}if(!a){var p=t.dashboards.get(r);p.scopes.some((function(t){return t.code===n}))&&(p.scopes=p.scopes.filter((function(t){return t.code!==n})),t.dashboards.set(r,p))}}}catch(t){s.e(t)}finally{s.f()}},setShowDeletionWarningPopup:function(t,e){t.isNeedShowDeletionWarningPopup=e}},getters:{groupName:function(t){return t.group.name},groupScopes:function(t){return t.group.scopes},dashboards:function(t){return t.dashboards},groupDashboardsData:function(t){var e,o=[],n=l(t.group.dashboardIds);try{for(n.s();!(e=n.n()).done;){var s=e.value;o.push(t.dashboards.get(s))}}catch(t){n.e(t)}finally{n.f()}return o},isSystemGroup:function(t){return t.group.type===d.system},groupData:function(t){return{id:t.group.id,name:t.group.name,type:t.group.type,scopes:t.group.scopes,dashboardIds:t.group.dashboardIds}},isSaveEnabled:function(t){return t.saveEnabled},isLoading:function(t){return t.isLoading},isGroupScope:function(t){return function(e,o){if(t.group.scopes.some((function(t){return t.code===o})))return!0;var n,s=l(t.otherGroups);try{for(s.s();!(n=s.n()).done;){var i=n.value;if(i.dashboardIds.includes(e)&&i.scopes.some((function(t){return t.code===o})))return!0}}catch(t){s.e(t)}finally{s.f()}return!1}},isNeedShowDeletionWarningPopup:function(t){return t.isNeedShowDeletionWarningPopup},isTitleEdited:function(e){return e.group.name!==t.initialGroup.name},isDashboardListEdited:function(e){return!t.areSetsEqual(new Set(t.initialGroup.dashboardIds),new Set(e.group.dashboardIds))},isScopeListEdited:function(e){return!t.areSetsEqual(new Set(t.initialGroup.scopes.map((function(t){return t.code}))),new Set(e.group.scopes.map((function(t){return t.code}))))}}})}},{key:"areSetsEqual",value:function(t,e){if(t.size!==e.size)return!1;var o,n=l(t);try{for(n.s();!(o=n.n()).done;){var s=o.value;if(!e.has(s))return!1}}catch(t){n.e(t)}finally{n.f()}return!0}}]),t}();function g(t,e){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function(t,e){if(!t)return;if("string"==typeof t)return m(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return m(t,e)}(t))||e&&t&&"number"==typeof t.length){o&&(t=o);var n=0,s=function(){};return{s:s,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,r=!0,a=!1;return{s:function(){o=o.call(t)},n:function(){var t=o.next();return r=t.done,t},e:function(t){a=!0,i=t},f:function(){try{r||null==o.return||o.return()}finally{if(a)throw i}}}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=new Array(e);o<e;o++)n[o]=t[o];return n}var b={props:{dashboard:{type:Object,required:!0}},data:function(){return{scopeNameLengthLimit:30,initialScopedIds:[]}},beforeUnmount:function(){this.dialog&&this.dialog.destroy(),this.dialog=null;var t=this.$el.querySelector(".scope-hint");t&&s.Event.unbindAll(t)},computed:{visibleScopes:function(){return this.scopes.slice(0,3)},scopes:function(){return babelHelpers.toConsumableArray(this.dashboard.scopes)},isGroupScope:function(){var t=this;return function(e){return t.$store.getters.isGroupScope(t.dashboard.id,e)}},scopeText:function(){var t,e=[],o=g(this.visibleScopes.entries());try{for(o.s();!(t=o.n()).done;){var n=babelHelpers.slicedToArray(t.value,2),i=n[0],r=n[1],a=this.formatScopeName(r.name),c=i<this.visibleScopes.length-1?", ":"",d='\n\t\t\t\t\t<span \n\t\t\t\t\t\tclass="scope-name"\n\t\t\t\t\t\ttitle="'.concat(r.name.length>this.scopeNameLengthLimit?s.Text.encode(r.name):"",'"\n\t\t\t\t\t>\n\t\t\t\t\t\t').concat(s.Text.encode(a+c),"\n\t\t\t\t\t</span>\n\t\t\t\t");e.push(d)}}catch(t){o.e(t)}finally{o.f()}return this.scopes.length<=3?e.join(""):this.$Bitrix.Loc.getMessage("BI_GROUP_SCOPES_DASHBOARD").replace("#FIRST_SCOPES#",e.join("")).replace("[hint]",'<span class="scope-list scope-list-more scope-hint">').replace("[/hint]","</span>").replace("#NUMBER#",this.dashboard.scopes.length-3)}},emits:["onScopeChange"],methods:{formatScopeName:function(t){return t.length<this.scopeNameLengthLimit?t:"".concat(t.slice(0,this.scopeNameLengthLimit),"...")},openSelector:function(){this.dialog||this.initDialog(),this.initialScopedIds=this.dashboard.scopes.map((function(t){return t.code})),this.dialog.show()},initDialog:function(){var t,e=[],o=[],n=g(this.dashboard.scopes);try{for(n.s();!(t=n.n()).done;){var i=t.value;e.push(["biconnector-superset-scope",i.code]),this.isGroupScope(i.code)&&o.push(["biconnector-superset-scope",i.code])}}catch(t){n.e(t)}finally{n.f()}this.dialog=new r.Dialog({id:"dashboard-scope-selector",targetNode:this.$refs.dashboardScopes,width:350,height:300,dropdownMode:!0,compactView:!0,showAvatars:!1,enableSearch:!0,preload:!0,preselectedItems:e,undeselectedItems:o,entities:[{id:"biconnector-superset-scope",dynamicLoad:!0,dynamicSearch:!0}],events:{"Item:onSelect":this.handleScopeAdd,"Item:onDeselect":this.handleScopeRemove,onHide:this.handleDialogHide}}),this.dialog.getPopup().setOffset({offsetLeft:-320}),this.dialog.adjustPosition(),s.Dom.addClass(this.dialog.getContainer(),"biconnector-scope-selector")},handleScopeAdd:function(t){var e=t.getData().item,o=this.scopes;o.push({code:e.getId(),name:e.getTitle()}),this.$store.commit("setDashboardScopes",{dashboardId:this.dashboard.id,scopes:o}),this.$emit("onScopeChange")},handleScopeRemove:function(t){var e=t.getData().item,o=this.scopes.filter((function(t){return t.code!==e.id}));this.$store.commit("setDashboardScopes",{dashboardId:this.dashboard.id,scopes:o}),this.$emit("onScopeChange")},handleDialogHide:function(t){var e=!f.areSetsEqual(new Set(this.initialScopedIds),new Set(this.dashboard.scopes.map((function(t){return t.code}))));i.EventEmitter.emit("BIConnector.GroupPopup.DashboardScopeSelector:onDialogHide",{isScopeListEdited:e})},showMoreScopesHint:function(){var t=this.$el.querySelector(".scope-hint");this.hintManager.show(t,this.scopes.slice(3).map((function(t){return t.name})).join(", "),!1)},hideMoreScopesHint:function(){this.hintManager.hide(),this.hintManager.popup=null},onGroupScopeChanged:function(){var t;null===(t=this.dialog)||void 0===t||t.destroy(),this.dialog=null},attachHintHandlers:function(){var t=this.$el.querySelector(".scope-hint");t&&(s.Event.unbindAll(t),s.Event.bind(t,"mouseenter",this.showMoreScopesHint),s.Event.bind(t,"mouseleave",this.hideMoreScopesHint))}},mounted:function(){this.hintManager=s.UI.Hint.createInstance({id:"dashboard-scope-hint-".concat(Date.now()),popupParameters:{bindOptions:{position:"bottom"},width:190,offsetLeft:-80,angle:{position:"top",offset:130},cacheable:!1}}),this.attachHintHandlers()},updated:function(){this.attachHintHandlers()},template:'\n\t\t<div class="group-dashboard-scopes-container">\n\t\t\t<span class="scope-list scope-list-dashboard" @click="openSelector">\n\t\t\t\t<span\n\t\t\t\t\tv-if="scopes.length > 0"\n\t\t\t\t\tv-html="scopeText"\n\t\t\t\t></span>\n\t\t\t\t<span v-else class="scope-list-empty">\n\t\t\t\t\t{{$Bitrix.Loc.getMessage(\'BI_GROUP_DASHBOARD_SCOPES_EMPTY\')}}\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t\t<span ref="dashboardScopes"></span>\n\t\t</div>\n\t'},v={props:{dashboard:{type:Object,required:!0}},computed:{iconPath:function(){return this.dashboard.type===p?"/bitrix/images/biconnector/superset-dashboard-selector/icon-type-system.png":this.dashboard.type===u?"/bitrix/images/biconnector/superset-dashboard-selector/icon-type-market.png":"/bitrix/images/biconnector/superset-dashboard-selector/icon-type-custom.png"},set:function(){return a.Set}},methods:{onRemoveClick:function(){i.EventEmitter.emit("BIConnector.GroupPopup.DashboardList:onDashboardRemove",{isDashboardListEdited:!0}),this.$emit("onDashboardRemove",{dashboardId:this.dashboard.id}),this.emitDashboardChange()},emitDashboardChange:function(){this.$emit("onDashboardChange")},onGroupScopeChanged:function(){this.$refs.scopeSelector.onGroupScopeChanged()}},emits:["onDashboardChange","onDashboardRemove"],components:{BIcon:a.BIcon,DashboardScopeSelector:b},template:'\n\t\t<div class="group-dashboard">\n\t\t\t<img class="group-dashboard-icon" :src="iconPath" width="32" height="32" alt="Dashboard icon">\n\t\t\t<div class="group-dashboard-name" :title="dashboard.name">{{dashboard.name}}</div>\n\t\t\t<DashboardScopeSelector :dashboard="dashboard" ref="scopeSelector" @on-scope-change="emitDashboardChange"/>\n\t\t\t<BIcon\n\t\t\t\t:name="set.CROSS_20"\n\t\t\t\t:size="20"\n\t\t\t\tcolor="#BDC1C6"\n\t\t\t\t:class="\'group-dashboard-remove-icon\'"\n\t\t\t\t@click="onRemoveClick"\n\t\t\t></BIcon>\n\t\t</div>\n\t'};function S(t,e){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function(t,e){if(!t)return;if("string"==typeof t)return y(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return y(t,e)}(t))||e&&t&&"number"==typeof t.length){o&&(t=o);var n=0,s=function(){};return{s:s,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,r=!0,a=!1;return{s:function(){o=o.call(t)},n:function(){var t=o.next();return r=t.done,t},e:function(t){a=!0,i=t},f:function(){try{r||null==o.return||o.return()}finally{if(a)throw i}}}}function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=new Array(e);o<e;o++)n[o]=t[o];return n}var I={props:{dashboards:{type:Array,required:!0}},data:function(){return{initialDashboardIds:[]}},mounted:function(){this.initDialog()},methods:{onAddDashboardClick:function(){this.initialDashboardIds=this.dashboards.map((function(t){return t.id})),this.dialog.show()},initDialog:function(){var t,e=this,o=[],n=S(this.dashboards);try{for(n.s();!(t=n.n()).done;){var s=t.value;o.push(["biconnector-superset-dashboard",s.id])}}catch(t){n.e(t)}finally{n.f()}this.dialog=new r.Dialog({id:"group-dashboard-selector",targetNode:this.$refs.addDashboardButton,width:400,height:300,dropdownMode:!0,enableSearch:!0,preload:!0,preselectedItems:o,entities:[{id:"biconnector-superset-dashboard",dynamicLoad:!0,dynamicSearch:!0,options:{loadProxyData:!1,checkAccessRights:this.$store.getters.isSaveEnabled}}],events:{"Item:onSelect":function(t){var o,n,s=t.data.item,i={id:s.getId(),name:s.getTitle(),type:null!==(o=s.getCustomData().get("type"))&&void 0!==o?o:p,scopes:null!==(n=s.getCustomData().get("scopes"))&&void 0!==n?n:[]};e.$store.commit("addDashboard",i),e.$emit("onDashboardsChange")},"Item:onDeselect":function(t){var o=t.data.item;e.$store.commit("removeDashboard",o.getId()),e.$emit("onDashboardsChange")},onHide:function(t){var o=!f.areSetsEqual(new Set(e.initialDashboardIds),new Set(e.dashboards.map((function(t){return t.id}))));i.EventEmitter.emit("BIConnector.GroupPopup.DashboardSelector:onDialogHide",{isDashboardListEdited:o})}}})}},emits:["onDashboardsChange"],watch:{dashboards:function(t,e){var o,n=this.dialog,s=S(e);try{for(s.s();!(o=s.n()).done;){var i,r=o.value;if(!t.includes(r))null===(i=n.getItem(["biconnector-superset-dashboard",r.id]))||void 0===i||i.deselect()}}catch(t){s.e(t)}finally{s.f()}}},template:'\n\t\t<div class="ui-btn ui-btn-primary ui-btn-sm ui-btn-round ui-btn-icon-add ui-btn-no-caps group-add-dashboards-button"\n\t\t\t@click="onAddDashboardClick"\n\t\t\tref="addDashboardButton"\n\t\t>\n\t\t\t{{ $Bitrix.Loc.getMessage(\'BI_GROUP_ADD_DASHBOARD\') }}\n\t\t</div>\n\t'},D={emits:["confirm","close"],props:{},data:function(){return{popupInstance:null,popupId:"biconnector-dashboard-deletion",dontShow:!1}},computed:{popupOptions:function(){return{id:this.popupId,content:this.$refs.content,width:400,padding:18,autoHide:!0,overlay:!0,events:{onPopupClose:this.closePopup,onPopupDestroy:this.closePopup},fixed:!0}},set:function(){return a.Set}},methods:{closePopup:function(){var t;null===(t=n.PopupManager.getPopupById(this.popupId))||void 0===t||t.destroy(),this.popupInstance=null,this.$emit("close")},onConfirm:function(){this.$emit("confirm",{dontShow:this.dontShow}),this.closePopup()},getPopupText:function(){return this.$Bitrix.Loc.getMessage("BI_GROUP_SAVE_WARN_TEXT").replace("[link]",'<a class="ui-link ui-link-primary ui-link-dashed group-warn-popup-box-link" onclick="top.BX.Helper.show(`redirect=detail&code=25556500`)">').replace("[/link]","</a>")}},mounted:function(){this.popupInstance||(this.popupInstance=new n.Popup(this.popupOptions)),this.popupInstance.show()},beforeUnmount:function(){this.closePopup()},components:{BIcon:a.BIcon},template:'\n\t\t<div ref="content" class="group-warn-popup">\n\t\t\t<div class="group-warn-popup-title-block">\n\t\t\t\t<div class="group-warn-popup-title">{{ $Bitrix.Loc.getMessage(\'BI_GROUP_SAVE_WARN_TITLE\') }}</div>\n\t\t\t\t<BIcon\n\t\t\t\t\t:name="set.CROSS_30"\n\t\t\t\t\t:size="18"\n\t\t\t\t\tcolor="#BDC1C6"\n\t\t\t\t\t:class="\'group-warn-popup-close\'"\n\t\t\t\t\t@click="closePopup"\n\t\t\t\t></BIcon>\n\t\t\t</div>\n\t\t\t<div class="group-warn-popup-box" v-html="getPopupText()"></div>\n\t\t\t<label class="group-warn-popup-checkbox">\n\t\t\t\t<input type="checkbox" v-model="dontShow"/>\n\t\t\t\t<span class="group-warn-popup-checkbox-text">{{ $Bitrix.Loc.getMessage(\'BI_GROUP_SAVE_WARN_DONT_SHOW\') }}</span>\n\t\t\t</label>\n\t\t\t<div class="group-warn-popup-separator"></div>\n\t\t\t<div class="group-warn-popup-buttons">\n\t\t\t\t<div class="ui-btn ui-btn-sm ui-btn-primary" @click="onConfirm">{{ $Bitrix.Loc.getMessage(\'BI_GROUP_SAVE_WARN_YES\') }}</div>\n\t\t\t\t<div class="ui-btn ui-btn-sm ui-btn-light-border" @click="closePopup">{{ $Bitrix.Loc.getMessage(\'BI_GROUP_SAVE_WARN_NO\') }}</div>\n\t\t\t</div>\n\t\t</div>\n\t'};function E(t,e){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function(t,e){if(!t)return;if("string"==typeof t)return w(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return w(t,e)}(t))||e&&t&&"number"==typeof t.length){o&&(t=o);var n=0,s=function(){};return{s:s,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,r=!0,a=!1;return{s:function(){o=o.call(t)},n:function(){var t=o.next();return r=t.done,t},e:function(t){a=!0,i=t},f:function(){try{r||null==o.return||o.return()}finally{if(a)throw i}}}}function w(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=new Array(e);o<e;o++)n[o]=t[o];return n}var B={props:{canEdit:{type:Boolean,required:!0}},directives:{hint:c.hint},data:function(){return{scopeNameLengthLimit:30,initialScopedIds:[]}},computed:{scopes:function(){return this.$store.getters.groupScopes},hintOptions:function(){return{html:this.$Bitrix.Loc.getMessage("BI_GROUP_SCOPE_HINT").replace("[link]",'<a class="scope-hint-link" onclick="top.BX.Helper.show(`redirect=detail&code=25556500`)">').replace("[/link]","</a>"),interactivity:!0,popupOptions:{bindOptions:{position:"bottom"},autoHide:!1,width:244,offsetTop:-4,angle:{position:"top",offset:34}}}},scopeText:function(){var t='\n\t\t\t\t<span\n\t\t\t\t\tclass="scope-name '.concat(this.canEdit?"":"scope-list-system",'"\n\t\t\t\t\ttitle="').concat(this.scopes[0].name.length>this.scopeNameLengthLimit?s.Text.encode(this.scopes[0].name):"",'"\n\t\t\t\t>\n\t\t\t\t\t').concat(s.Text.encode(this.formatScopeName(this.scopes[0].name)),"\n\t\t\t\t</span>\n\t\t\t");return this.scopes.length<=1?this.$Bitrix.Loc.getMessage("BI_GROUP_SCOPES_GROUP").replace("[title]",'<span class="group-scope-title">').replace("[/title]","</span>").replace("#SCOPE#",t):this.$Bitrix.Loc.getMessage("BI_GROUP_SCOPES_GROUP_MANY").replace("[title]",'<span class="group-scope-title">').replace("[/title]","</span>").replace("#FIRST_SCOPES#",t).replace("[hint]",'<span class="scope-list scope-list-more group-scope-hint">').replace("[/hint]","</span>").replace("#NUMBER#",this.scopes.length-1)},emptyScopesText:function(){return this.$Bitrix.Loc.getMessage("BI_GROUP_SCOPES_GROUP_EMPTY").replace("[title]",'<span class="group-scope-title">').replace("[/title]","</span>")},set:function(){return a.Set}},methods:{openScopeSelector:function(){this.canEdit&&(this.dialog||this.initDialog(),this.initialScopedIds=this.scopes.map((function(t){return t.code})),this.dialog.show())},initDialog:function(){var t,e=[],o=E(this.scopes);try{for(o.s();!(t=o.n()).done;){var n=t.value;e.push(["biconnector-superset-scope",n.code])}}catch(t){o.e(t)}finally{o.f()}this.dialog=new r.Dialog({id:"group-scope-selector",targetNode:this.$refs.groupScopes,width:350,height:300,dropdownMode:!0,compactView:!0,showAvatars:!1,enableSearch:!0,preload:!0,preselectedItems:e,entities:[{id:"biconnector-superset-scope",dynamicLoad:!0,dynamicSearch:!0}],events:{"Item:onSelect":this.onGroupScopeAdd,"Item:onDeselect":this.onGroupScopeRemove,onHide:this.onDialogHide}}),this.dialog.getPopup().setOffset({offsetLeft:-320}),this.dialog.adjustPosition(),s.Dom.addClass(this.dialog.getContainer(),"biconnector-scope-selector")},onGroupScopeAdd:function(t){var e=t.getData().item,o={code:e.getId(),name:e.getTitle()};this.$emit("onGroupScopeAdd",o)},onGroupScopeRemove:function(t){var e=t.getData().item,o={code:e.getId(),name:e.getTitle()};this.$emit("onGroupScopeRemove",o)},onDialogHide:function(t){var e=!f.areSetsEqual(new Set(this.initialScopedIds),new Set(this.scopes.map((function(t){return t.code}))));i.EventEmitter.emit("BIConnector.GroupPopup.ScopeSelector:onDialogHide",{isScopeListEdited:e})},showMoreScopesHint:function(){var t=this.$el.querySelector(".group-scope-hint");this.hintManager.show(t,this.scopes.slice(1).map((function(t){return t.name})).join(", "),!1)},hideMoreScopesHint:function(){this.hintManager.hide(),this.hintManager.popup=null},showSystemScopesHint:function(){var t=this.$el.querySelector(".scope-list-system");this.systemScopeHintManager.show(t,this.$Bitrix.Loc.getMessage("BI_GROUP_SYSTEM_SCOPES_HINT"),!1)},hideSystemScopesHint:function(){this.systemScopeHintManager.hide(),this.systemScopeHintManager.popup=null},formatScopeName:function(t){return t.length<this.scopeNameLengthLimit?t:"".concat(t.slice(0,this.scopeNameLengthLimit),"...")},attachHintHandlers:function(){var t=this.$el.querySelector(".group-scope-hint");if(t&&(s.Event.unbindAll(t),s.Event.bind(t,"mouseenter",this.showMoreScopesHint),s.Event.bind(t,"mouseleave",this.hideMoreScopesHint)),!this.canEdit){var e=this.$el.querySelector(".scope-list-system");e&&(s.Event.unbindAll(e),s.Event.bind(e,"mouseenter",this.showSystemScopesHint),s.Event.bind(e,"mouseleave",this.hideSystemScopesHint))}}},mounted:function(){this.hintManager=s.UI.Hint.createInstance({id:"group-scope-hint",popupParameters:{bindOptions:{position:"bottom"},width:190,offsetLeft:-80,angle:{position:"top",offset:130},cacheable:!1}}),this.systemScopeHintManager=s.UI.Hint.createInstance({id:"system-scope-hint",popupParameters:{bindOptions:{position:"bottom"},width:244,offsetLeft:-140,angle:{position:"top",offset:180},cacheable:!1}}),this.attachHintHandlers()},updated:function(){this.attachHintHandlers()},beforeUnmount:function(){this.dialog&&this.dialog.destroy(),this.dialog=null;var t=this.$el.querySelector(".group-scope-hint");t&&s.Event.unbindAll(t);var e=this.$el.querySelector(".scope-list-system");e&&s.Event.unbindAll(e)},emits:["onGroupScopeAdd","onGroupScopeRemove"],components:{BIcon:a.BIcon},template:'\n\t\t<div class="group-scope-selector">\n\t\t\t<span\n\t\t\t\tv-if="scopes.length > 0"\n\t\t\t\t@click="openScopeSelector"\n\t\t\t\tclass="scope-list scope-list-group"\n\t\t\t\tv-html="scopeText"\n\t\t\t></span>\n\t\t\t<span\n\t\t\t\tv-else\n\t\t\t\t@click="openScopeSelector"\n\t\t\t\tclass="scope-list scope-list-group"\n\t\t\t\tv-html="emptyScopesText"\n\t\t\t></span>\n\t\t\t<div class="group-scope-list-hint" ref="groupScopes" v-hint="hintOptions">\n\t\t\t\t<BIcon\n\t\t\t\t\t:name="set.HELP"\n\t\t\t\t\t:size="20"\n\t\t\t\t\tcolor="#D5D7DB"\n\t\t\t\t></BIcon>\n\t\t\t</div>\n\t\t</div>\n\t'},P={props:{canEdit:{type:Boolean,required:!0}},data:function(){return{editMode:!1}},directives:{hint:c.hint},computed:{groupName:{get:function(){return this.$store.getters.groupName},set:function(t){this.$store.commit("setGroupName",t)}},set:function(){return a.Set},nameHintOptions:function(){return{text:this.$Bitrix.Loc.getMessage("BI_GROUP_SYSTEM_NAME_HINT"),popupOptions:{bindOptions:{position:"bottom"},width:220,offsetLeft:40,angle:{position:"top",offset:0}}}}},methods:{setEditMode:function(){var t=this;this.editMode=!0,this.$nextTick((function(){t.$refs.nameInput.focus()}))},setViewMode:function(){this.editMode=!1,this.groupName||this.$store.commit("setGroupName",this.$Bitrix.Loc.getMessage("BI_GROUP_NAME_NEW")),this.$emit("onNameUpdate")}},emits:["onNameUpdate"],components:{BIcon:a.BIcon},template:'\n\t\t<div class="group-header-title" :style="{ width: editMode ? \'80%\' : \'auto\' }">\n\t\t\t<template v-if="canEdit">\n\t\t\t\t<input v-if="editMode" class="group-name-input" @blur="setViewMode" v-model="groupName" ref="nameInput">\n\t\t\t\t<template v-else>\n\t\t\t\t\t<div class="group-name">{{groupName}}</div>\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\t:name="set.PENCIL_40"\n\t\t\t\t\t\t:size="20"\n\t\t\t\t\t\tcolor="#BDC1C6"\n\t\t\t\t\t\t:class="\'group-name-edit-icon\'"\n\t\t\t\t\t\t@click="setEditMode"\n\t\t\t\t\t></BIcon>\n\t\t\t\t</template>\n\t\t\t</template>\n\t\t\t<template v-else>\n\t\t\t\t<div class="group-name" v-hint="nameHintOptions">{{groupName}}</div>\n\t\t\t</template>\n\t\t</div>\n\t'};function $(t,e){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function(t,e){if(!t)return;if("string"==typeof t)return C(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return C(t,e)}(t))||e&&t&&"number"==typeof t.length){o&&(t=o);var n=0,s=function(){};return{s:s,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,r=!0,a=!1;return{s:function(){o=o.call(t)},n:function(){var t=o.next();return r=t.done,t},e:function(t){a=!0,i=t},f:function(){try{r||null==o.return||o.return()}finally{if(a)throw i}}}}function C(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=new Array(e);o<e;o++)n[o]=t[o];return n}var G={mounted:function(){i.EventEmitter.subscribe("BIConnector.Internal.GroupPopup:onPopupClose",this.onGroupPopupClose)},beforeUnmount:function(){i.EventEmitter.unsubscribe("BIConnector.Internal.GroupPopup:onPopupClose",this.onGroupPopupClose)},data:function(){return{deletionWarning:{popupShown:!1,dashboardId:null}}},computed:{isNoDashboards:function(){return 0===this.$store.state.group.dashboardIds.length},dashboards:function(){return this.$store.getters.groupDashboardsData},isSystemGroup:function(){return this.$store.getters.isSystemGroup},isSaveEnabled:function(){return this.$store.getters.isSaveEnabled},isLoading:function(){return this.$store.getters.isLoading},isDashboardListScrollable:function(){return this.isSaveEnabled?this.dashboards.length>6:this.dashboards.length>7},set:function(){return a.Set}},methods:{updateRight:function(){i.EventEmitter.emit("BIConnector.GroupPopup:onGroupUpdated",{group:s.Runtime.clone(this.$store.getters.groupData),dashboards:s.Runtime.clone(this.$store.getters.dashboards)})},onGroupScopeAdd:function(t){var e;this.$store.commit("addGroupScope",t),this.updateRight();var o,n=$(null!==(e=this.$refs.dashboardItem)&&void 0!==e?e:[]);try{for(n.s();!(o=n.n()).done;){o.value.onGroupScopeChanged()}}catch(t){n.e(t)}finally{n.f()}},onGroupScopeRemove:function(t){var e;this.$store.commit("removeGroupScope",t),this.updateRight();var o,n=$(null!==(e=this.$refs.dashboardItem)&&void 0!==e?e:[]);try{for(n.s();!(o=n.n()).done;){o.value.onGroupScopeChanged()}}catch(t){n.e(t)}finally{n.f()}},onDashboardRemove:function(t){this.isSaveEnabled&&this.$store.getters.isNeedShowDeletionWarningPopup?(this.deletionWarning.dashboardId=t.dashboardId,this.deletionWarning.popupShown=!0):(this.$store.commit("removeDashboard",t.dashboardId),this.updateRight())},confirmDashboardDeletion:function(t){this.$store.commit("removeDashboard",this.deletionWarning.dashboardId),t.dontShow&&(BX.userOptions.save("biconnector","deleteDashboardFromGroupPopup","needShow",!1),this.$store.commit("setShowDeletionWarningPopup",!1)),this.deletionWarning.dashboardId=null,this.deletionWarning.popupShown=!1,this.updateRight()},cancelDashboardDeletion:function(){this.deletionWarning.dashboardId=null,this.deletionWarning.popupShown=!1},saveGroup:function(){var t=this;this.$store.commit("setIsLoading",!0),s.ajax.runAction("biconnector.group.save",{data:{group:this.$store.getters.groupData,dashboards:babelHelpers.toConsumableArray(this.$store.getters.dashboards.values())}}).then((function(){t.$store.commit("setIsLoading",!1),t.closePopup(),i.EventEmitter.emit("BIConnector.GroupPopup:onGroupSaved",{group:s.Runtime.clone(t.$store.getters.groupData),dashboards:s.Runtime.clone(t.$store.getters.dashboards),isTitleEdited:t.$store.getters.isTitleEdited,isDashboardListEdited:t.$store.getters.isDashboardListEdited,isScopeListEdited:t.$store.getters.isScopeListEdited})})).catch((function(e){var o;BX.UI.Notification.Center.notify({content:null===(o=e.errors[0])||void 0===o?void 0:o.message}),t.$store.commit("setIsLoading",!1)}))},closePopup:function(){n.PopupManager.getPopupById("biconnector-dashboard-group").close()},onGroupPopupClose:function(){i.EventEmitter.emit("BIConnector.GroupPopup:onPopupClose",{group:this.$store.getters.groupData,isTitleEdited:this.$store.getters.isTitleEdited,isDashboardListEdited:this.$store.getters.isDashboardListEdited,isScopeListEdited:this.$store.getters.isScopeListEdited})}},components:{BIcon:a.BIcon,DashboardItem:v,DashboardSelector:I,GroupScopeSelector:B,TitleEditor:P,DeletionWarningPopup:D},template:'\n\t\t<div class="group-header">\n\t\t\t<TitleEditor @on-name-update="updateRight" :can-edit="!isSystemGroup"/>\n\t\t\t<div class="group-header-controls">\n\t\t\t\t<BIcon\n\t\t\t\t\t:name="set.CROSS_25"\n\t\t\t\t\t:size="25"\n\t\t\t\t\tcolor="#BDC1C6"\n\t\t\t\t\t:class="\'group-close\'"\n\t\t\t\t\t@click="closePopup"\n\t\t\t\t></BIcon>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="group-button-panel">\n\t\t\t<div class="group-button-wrapper">\n\t\t\t\t<DashboardSelector :dashboards="dashboards" @on-dashboards-change="updateRight"/>\n\t\t\t</div>\n\t\t\t<GroupScopeSelector @on-group-scope-add="onGroupScopeAdd" @on-group-scope-remove="onGroupScopeRemove" :can-edit="!isSystemGroup"/>\n\t\t</div>\n\t\t<div class="group-dashboard-empty" v-if="isNoDashboards">\n\t\t\t<img class="group-dashboard-empty-image" src="/bitrix/images/biconnector/dashboard-groups/empty-state.svg" alt="No dashboards">\n\t\t\t<div class="group-dashboard-empty-title">{{ $Bitrix.Loc.getMessage(\'BI_GROUP_EMPTY_TITLE\') }}</div>\n\t\t\t<div class="group-dashboard-empty-subtitle">{{ $Bitrix.Loc.getMessage(\'BI_GROUP_EMPTY_SUBTITLE\') }}</div>\n\t\t</div>\n\t\t<div class="group-dashboard-list" :class="{\'group-dashboard-list-scroll\': isDashboardListScrollable}" v-else>\n\t\t\t<DashboardItem\n\t\t\t\tv-for="dashboard of dashboards"\n\t\t\t\t:key="dashboard.id"\n\t\t\t\tref="dashboardItem"\n\t\t\t\t:dashboard="dashboard"\n\t\t\t\t@on-dashboard-change="updateRight"\n\t\t\t\t@on-dashboard-remove="onDashboardRemove"\n\t\t\t/>\n\t\t</div>\n\t\t<div class="group-footer" v-if="isSaveEnabled">\n\t\t\t<div\n\t\t\t\t:class="[\'ui-btn ui-btn-primary ui-btn-md ui-btn-round ui-btn-no-caps group-footer-button\', {\'ui-btn-disabled ui-btn-clock\': isLoading}]" \n\t\t\t\t@click="saveGroup"\n\t\t\t>\n\t\t\t\t{{ $Bitrix.Loc.getMessage(\'BI_GROUP_SAVE\') }}\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tclass="ui-btn ui-btn-light-border ui-btn-md ui-btn-round ui-btn-no-caps group-footer-button"\n\t\t\t\t@click="closePopup"\n\t\t\t>\n\t\t\t\t{{ $Bitrix.Loc.getMessage(\'BI_GROUP_SAVE_CANCEL\') }}\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="group-loader" v-if="isLoading"></div>\n\t\t<DeletionWarningPopup \n\t\t\tv-if="deletionWarning.popupShown" \n\t\t\t@confirm="confirmDashboardDeletion" \n\t\t\t@close="cancelDashboardDeletion"\n\t\t/>\n\t'},A=function(){function t(){babelHelpers.classCallCheck(this,t)}return babelHelpers.createClass(t,null,[{key:"open",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.getApp(t),o=new n.Popup({id:"biconnector-dashboard-group",width:800,height:560,overlay:!0,closeIcon:!1,autoHide:!0,padding:0,cacheable:!1,content:'<div id="app"></div>',events:{onPopupClose:function(){i.EventEmitter.emit("BIConnector.Internal.GroupPopup:onPopupClose"),e.unmount()}}});o.show(),e.mount("#app")}},{key:"getApp",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=t.groups.find((function(e){return e.id===t.groupId}));o||(o={id:"new_G0",name:s.Loc.getMessage("BI_GROUP_NAME_NEW"),type:d.custom,scopes:[],dashboardIds:[]});var n={group:o,otherGroups:t.groups.filter((function(e){return e.id!==t.groupId})),dashboards:t.dashboards,saveEnabled:t.saveEnabled,isLoading:!1,isNeedShowDeletionWarningPopup:t.isNeedShowDeletionWarningPopup},i=e.BitrixVue.createApp({name:"GroupPopupApp",data:function(){return{}},components:{App:G},computed:{componentName:function(){return G}},template:"\n\t\t\t\t<App/>\n\t\t\t"}),r=f.buildStore(n);return i.use(r),i}}]),t}();t.DashboardGroup=A,t.GroupType=d}(this.BX.BIConnector=this.BX.BIConnector||{},BX.Vue3,BX.Vue3.Vuex,BX.Main,BX,BX.Event,BX.UI.EntitySelector,BX.UI.IconSet,BX.Vue3.Directives);
//# sourceMappingURL=dashboard-group.bundle.map.js