this.BX=this.BX||{},function(t,e,o,n,s,r,i,a,c,d,u){"use strict";var p={system:"SYSTEM",custom:"CUSTOM"},l="SYSTEM",h="MARKET";function f(t,e){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function(t,e){if(!t)return;if("string"==typeof t)return g(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return g(t,e)}(t))||e&&t&&"number"==typeof t.length){o&&(t=o);var n=0,s=function(){};return{s:s,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i=!0,a=!1;return{s:function(){o=o.call(t)},n:function(){var t=o.next();return i=t.done,t},e:function(t){a=!0,r=t},f:function(){try{i||null==o.return||o.return()}finally{if(a)throw r}}}}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=new Array(e);o<e;o++)n[o]=t[o];return n}var m=function(){function t(){babelHelpers.classCallCheck(this,t)}return babelHelpers.createClass(t,null,[{key:"buildStore",value:function(e){return t.initialGroup=i.Runtime.clone(e.group),o.createStore({state:function(){return e},mutations:{setIsLoading:function(t,e){t.isLoading=e},setGroupName:function(t,e){t.group.name=e},addDashboard:function(t,e){t.group.dashboardIds.unshift(e.id);var o=t.group.scopes;t.dashboards.get(e.id)&&(e.scopes=t.dashboards.get(e.id).scopes);var n,s=new Set(e.scopes.map((function(t){return t.code}))),r=f(o);try{for(r.s();!(n=r.n()).done;){var i=n.value;s.has(i.code)||e.scopes.push(i)}}catch(t){r.e(t)}finally{r.f()}t.dashboards.set(e.id,e)},removeDashboard:function(t,e){var o=t.dashboards.get(e);if(o){t.group.dashboardIds=t.group.dashboardIds.filter((function(t){return t!==e}));var n,s=f(t.group.scopes);try{var r=function(){var s,r=n.value,i=!1,a=f(t.otherGroups);try{for(a.s();!(s=a.n()).done;){var c=s.value;c.dashboardIds.includes(e)&&c.scopes.some((function(t){return t.code===r.code}))&&(i=!0)}}catch(t){a.e(t)}finally{a.f()}!i&&o.scopes.some((function(t){return t.code===r.code}))&&(o.scopes=o.scopes.filter((function(t){return t.code!==r.code})),t.dashboards.set(e,o))};for(s.s();!(n=s.n()).done;)r()}catch(t){s.e(t)}finally{s.f()}}},setDashboardScopes:function(t,e){var o=e.dashboardId,n=e.scopes;t.dashboards.get(o).scopes=n},addGroupScope:function(t,e){t.group.scopes.push(e);var o,n=e.code,s=f(t.group.dashboardIds);try{for(s.s();!(o=s.n()).done;){var r=o.value,i=t.dashboards.get(r);i.scopes.some((function(t){return t.code===n}))||(i.scopes.push(e),t.dashboards.set(r,i))}}catch(t){s.e(t)}finally{s.f()}},removeGroupScope:function(t,e){t.group.scopes=t.group.scopes.filter((function(t){return t.code!==e.code}));var o,n=e.code,s=f(t.group.dashboardIds);try{for(s.s();!(o=s.n()).done;){var r,i=o.value,a=!1,c=f(t.otherGroups);try{for(c.s();!(r=c.n()).done;){var d=r.value;d.dashboardIds.includes(i)&&d.scopes.some((function(t){return t.code===n}))&&(a=!0)}}catch(t){c.e(t)}finally{c.f()}if(!a){var u=t.dashboards.get(i);u.scopes.some((function(t){return t.code===n}))&&(u.scopes=u.scopes.filter((function(t){return t.code!==n})),t.dashboards.set(i,u))}}}catch(t){s.e(t)}finally{s.f()}}},getters:{user:function(t){return t.user},groupName:function(t){return t.group.name},groupScopes:function(t){return t.group.scopes},dashboards:function(t){return t.dashboards},otherGroups:function(t){return t.otherGroups},groupDashboardsData:function(t){var e,o=[],n=f(t.group.dashboardIds);try{for(n.s();!(e=n.n()).done;){var s=e.value;o.push(t.dashboards.get(s))}}catch(t){n.e(t)}finally{n.f()}return o},isSystemGroup:function(t){return t.group.type===p.system},groupData:function(t){return{id:t.group.id,name:t.group.name,type:t.group.type,scopes:t.group.scopes,dashboardIds:t.group.dashboardIds}},isSaveEnabled:function(t){return t.saveEnabled},isLoading:function(t){return t.isLoading},isGroupScope:function(t){return function(e,o){if(t.group.scopes.some((function(t){return t.code===o})))return!0;var n,s=f(t.otherGroups);try{for(s.s();!(n=s.n()).done;){var r=n.value;if(r.dashboardIds.includes(e)&&r.scopes.some((function(t){return t.code===o})))return!0}}catch(t){s.e(t)}finally{s.f()}return!1}},accessibleDashboardIdsSet:function(t){return new Set(t.otherGroups.filter((function(e){return t.user.accessibleGroupIds.includes(e.id)})).flatMap((function(t){return t.dashboardIds})))},shouldShowDeleteWarning:function(t,e){return function(o){var n=t.user;if(n.isAdmin||n.hasAccessToPermission)return!1;var s=t.dashboards.get(o);return!!s&&(s.createdById!==n.id&&s.ownerId!==n.id&&!e.accessibleDashboardIdsSet.has(o))}},isTitleEdited:function(e){return e.group.name!==t.initialGroup.name},isDashboardListEdited:function(e){return!t.areSetsEqual(new Set(t.initialGroup.dashboardIds),new Set(e.group.dashboardIds))},isScopeListEdited:function(e){return!t.areSetsEqual(new Set(t.initialGroup.scopes.map((function(t){return t.code}))),new Set(e.group.scopes.map((function(t){return t.code}))))}}})}},{key:"areSetsEqual",value:function(t,e){if(t.size!==e.size)return!1;var o,n=f(t);try{for(n.s();!(o=n.n()).done;){var s=o.value;if(!e.has(s))return!1}}catch(t){n.e(t)}finally{n.f()}return!0}}]),t}();function b(t,e){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function(t,e){if(!t)return;if("string"==typeof t)return v(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return v(t,e)}(t))||e&&t&&"number"==typeof t.length){o&&(t=o);var n=0,s=function(){};return{s:s,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i=!0,a=!1;return{s:function(){o=o.call(t)},n:function(){var t=o.next();return i=t.done,t},e:function(t){a=!0,r=t},f:function(){try{i||null==o.return||o.return()}finally{if(a)throw r}}}}function v(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=new Array(e);o<e;o++)n[o]=t[o];return n}var S={props:{dashboard:{type:Object,required:!0}},data:function(){return{scopeNameLengthLimit:30,initialScopedIds:[]}},beforeUnmount:function(){this.dialog&&this.dialog.destroy(),this.dialog=null;var t=this.$el.querySelector(".scope-hint");t&&i.Event.unbindAll(t)},computed:{visibleScopes:function(){return this.scopes.slice(0,3)},scopes:function(){return babelHelpers.toConsumableArray(this.dashboard.scopes)},isGroupScope:function(){var t=this;return function(e){return t.$store.getters.isGroupScope(t.dashboard.id,e)}},scopeText:function(){var t,e=[],o=b(this.visibleScopes.entries());try{for(o.s();!(t=o.n()).done;){var n=babelHelpers.slicedToArray(t.value,2),s=n[0],r=n[1],a=this.formatScopeName(r.name),c=s<this.visibleScopes.length-1?", ":"",d='\n\t\t\t\t\t<span \n\t\t\t\t\t\tclass="scope-name"\n\t\t\t\t\t\ttitle="'.concat(r.name.length>this.scopeNameLengthLimit?i.Text.encode(r.name):"",'"\n\t\t\t\t\t>\n\t\t\t\t\t\t').concat(i.Text.encode(a+c),"\n\t\t\t\t\t</span>\n\t\t\t\t");e.push(d)}}catch(t){o.e(t)}finally{o.f()}return this.scopes.length<=3?e.join(""):this.$Bitrix.Loc.getMessage("BI_GROUP_SCOPES_DASHBOARD").replace("#FIRST_SCOPES#",e.join("")).replace("[hint]",'<span class="scope-list scope-list-more scope-hint">').replace("[/hint]","</span>").replace("#NUMBER#",this.dashboard.scopes.length-3)}},emits:["onScopeChange"],methods:{formatScopeName:function(t){return t.length<this.scopeNameLengthLimit?t:"".concat(t.slice(0,this.scopeNameLengthLimit),"...")},openSelector:function(){this.dialog||this.initDialog(),this.initialScopedIds=this.dashboard.scopes.map((function(t){return t.code})),this.dialog.show()},initDialog:function(){var t,e=[],o=[],n=b(this.dashboard.scopes);try{for(n.s();!(t=n.n()).done;){var s=t.value;e.push(["biconnector-superset-scope",s.code]),this.isGroupScope(s.code)&&o.push(["biconnector-superset-scope",s.code])}}catch(t){n.e(t)}finally{n.f()}this.dialog=new c.Dialog({id:"dashboard-scope-selector",targetNode:this.$refs.dashboardScopes,width:350,height:300,dropdownMode:!0,compactView:!0,showAvatars:!1,enableSearch:!0,preload:!0,preselectedItems:e,undeselectedItems:o,entities:[{id:"biconnector-superset-scope",dynamicLoad:!0,dynamicSearch:!0}],events:{"Item:onSelect":this.handleScopeAdd,"Item:onDeselect":this.handleScopeRemove,onHide:this.handleDialogHide}}),this.dialog.getPopup().setOffset({offsetLeft:-320}),this.dialog.adjustPosition(),i.Dom.addClass(this.dialog.getContainer(),"biconnector-scope-selector")},handleScopeAdd:function(t){var e=t.getData().item,o=this.scopes;o.push({code:e.getId(),name:e.getTitle()}),this.$store.commit("setDashboardScopes",{dashboardId:this.dashboard.id,scopes:o}),this.$emit("onScopeChange")},handleScopeRemove:function(t){var e=t.getData().item,o=this.scopes.filter((function(t){return t.code!==e.id}));this.$store.commit("setDashboardScopes",{dashboardId:this.dashboard.id,scopes:o}),this.$emit("onScopeChange")},handleDialogHide:function(t){var e=!m.areSetsEqual(new Set(this.initialScopedIds),new Set(this.dashboard.scopes.map((function(t){return t.code}))));a.EventEmitter.emit("BIConnector.GroupPopup.DashboardScopeSelector:onDialogHide",{isScopeListEdited:e})},showMoreScopesHint:function(){var t=this.$el.querySelector(".scope-hint");this.hintManager.show(t,this.scopes.slice(3).map((function(t){return t.name})).join(", "),!1)},hideMoreScopesHint:function(){this.hintManager.hide(),this.hintManager.popup=null},onGroupScopeChanged:function(){var t;null===(t=this.dialog)||void 0===t||t.destroy(),this.dialog=null},attachHintHandlers:function(){var t=this.$el.querySelector(".scope-hint");t&&(i.Event.unbindAll(t),i.Event.bind(t,"mouseenter",this.showMoreScopesHint),i.Event.bind(t,"mouseleave",this.hideMoreScopesHint))}},mounted:function(){this.hintManager=i.UI.Hint.createInstance({id:"dashboard-scope-hint-".concat(Date.now()),popupParameters:{bindOptions:{position:"bottom"},width:190,offsetLeft:-80,angle:{position:"top",offset:130},cacheable:!1}}),this.attachHintHandlers()},updated:function(){this.attachHintHandlers()},template:'\n\t\t<div class="group-dashboard-scopes-container">\n\t\t\t<span class="scope-list scope-list-dashboard" @click="openSelector">\n\t\t\t\t<span\n\t\t\t\t\tv-if="scopes.length > 0"\n\t\t\t\t\tv-html="scopeText"\n\t\t\t\t></span>\n\t\t\t\t<span v-else class="scope-list-empty">\n\t\t\t\t\t{{$Bitrix.Loc.getMessage(\'BI_GROUP_DASHBOARD_SCOPES_EMPTY\')}}\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t\t<span ref="dashboardScopes"></span>\n\t\t</div>\n\t'},y={props:{dashboard:{type:Object,required:!0}},computed:{iconPath:function(){return this.dashboard.type===l?"/bitrix/images/biconnector/superset-dashboard-selector/icon-type-system.png":this.dashboard.type===h?"/bitrix/images/biconnector/superset-dashboard-selector/icon-type-market.png":"/bitrix/images/biconnector/superset-dashboard-selector/icon-type-custom.png"},set:function(){return d.Set}},methods:{onRemoveClick:function(){a.EventEmitter.emit("BIConnector.GroupPopup.DashboardList:onDashboardRemove",{isDashboardListEdited:!0}),this.$emit("onDashboardRemove",{dashboardId:this.dashboard.id}),this.emitDashboardChange()},emitDashboardChange:function(){this.$emit("onDashboardChange")},onGroupScopeChanged:function(){this.$refs.scopeSelector.onGroupScopeChanged()}},emits:["onDashboardChange","onDashboardRemove"],components:{BIcon:d.BIcon,DashboardScopeSelector:S},template:'\n\t\t<div class="group-dashboard">\n\t\t\t<img class="group-dashboard-icon" :src="iconPath" width="32" height="32" alt="Dashboard icon">\n\t\t\t<div class="group-dashboard-name" :title="dashboard.name">{{dashboard.name}}</div>\n\t\t\t<DashboardScopeSelector :dashboard="dashboard" ref="scopeSelector" @on-scope-change="emitDashboardChange"/>\n\t\t\t<BIcon\n\t\t\t\t:name="set.CROSS_20"\n\t\t\t\t:size="20"\n\t\t\t\tcolor="#BDC1C6"\n\t\t\t\t:class="\'group-dashboard-remove-icon\'"\n\t\t\t\t@click="onRemoveClick"\n\t\t\t></BIcon>\n\t\t</div>\n\t'};function I(t,e){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function(t,e){if(!t)return;if("string"==typeof t)return D(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return D(t,e)}(t))||e&&t&&"number"==typeof t.length){o&&(t=o);var n=0,s=function(){};return{s:s,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i=!0,a=!1;return{s:function(){o=o.call(t)},n:function(){var t=o.next();return i=t.done,t},e:function(t){a=!0,r=t},f:function(){try{i||null==o.return||o.return()}finally{if(a)throw r}}}}function D(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=new Array(e);o<e;o++)n[o]=t[o];return n}var E={props:{dashboards:{type:Array,required:!0}},data:function(){return{initialDashboardIds:[],bypassDeselectHandler:!1}},mounted:function(){this.initDialog()},methods:{onAddDashboardClick:function(){this.initialDashboardIds=this.dashboards.map((function(t){return t.id})),this.dialog.show()},initDialog:function(){var t,e=this,o=[],n=I(this.dashboards);try{for(n.s();!(t=n.n()).done;){var s=t.value;o.push(["biconnector-superset-dashboard",s.id])}}catch(t){n.e(t)}finally{n.f()}this.dialog=new c.Dialog({id:"group-dashboard-selector",targetNode:this.$refs.addDashboardButton,width:400,height:300,dropdownMode:!0,enableSearch:!0,preload:!0,preselectedItems:o,entities:[{id:"biconnector-superset-dashboard",dynamicLoad:!0,dynamicSearch:!0,options:{loadProxyData:!1,checkAccessRights:this.$store.getters.isSaveEnabled}}],tagSelectorOptions:{events:{onBeforeTagRemove:function(t){if(!e.bypassDeselectHandler){var o=t.data.tag.getId();e.$store.getters.isSaveEnabled&&e.$store.getters.shouldShowDeleteWarning(o)&&(t.preventDefault(),e.dialog.setAutoHide(!1),e.$emit("onBeforeRemoveConfirmation",{dashboardId:o}))}}}},events:{"Item:onSelect":function(t){var o,n,s=t.data.item,r={id:s.getId(),name:s.getTitle(),type:null!==(o=s.getCustomData().get("type"))&&void 0!==o?o:l,createdById:s.getCustomData().get("createdById"),ownerId:s.getCustomData().get("ownerId"),scopes:null!==(n=s.getCustomData().get("scopes"))&&void 0!==n?n:[]};e.$store.commit("addDashboard",r),e.$emit("onDashboardsChange")},"Item:onBeforeDeselect":function(t){if(!e.bypassDeselectHandler){var o=t.data.item.getId();e.$store.getters.isSaveEnabled&&e.$store.getters.shouldShowDeleteWarning(o)&&(t.preventDefault(),e.dialog.setAutoHide(!1),e.$emit("onBeforeRemoveConfirmation",{dashboardId:o}))}},"Item:onDeselect":function(t){var o=t.data.item;e.$store.commit("removeDashboard",o.getId()),e.$emit("onDashboardsChange")},onHide:function(t){var o=!m.areSetsEqual(new Set(e.initialDashboardIds),new Set(e.dashboards.map((function(t){return t.id}))));a.EventEmitter.emit("BIConnector.GroupPopup.DashboardSelector:onDialogHide",{isDashboardListEdited:o})}}})},deselect:function(t){var e;this.bypassDeselectHandler=!0,null===(e=this.dialog.getItem({entityId:"biconnector-superset-dashboard",id:t}))||void 0===e||e.deselect()},resetDialog:function(){this.dialog.setAutoHide(!0),this.bypassDeselectHandler=!1}},emits:["onBeforeRemoveConfirmation","onDashboardsChange"],watch:{dashboards:function(t,e){var o,n=this.dialog,s=I(e);try{for(s.s();!(o=s.n()).done;){var r,i=o.value;if(!t.includes(i))null===(r=n.getItem(["biconnector-superset-dashboard",i.id]))||void 0===r||r.deselect()}}catch(t){s.e(t)}finally{s.f()}}},template:'\n\t\t<div class="ui-btn ui-btn-primary ui-btn-sm ui-btn-round ui-btn-icon-add ui-btn-no-caps group-add-dashboards-button"\n\t\t\t@click="onAddDashboardClick"\n\t\t\tref="addDashboardButton"\n\t\t>\n\t\t\t{{ $Bitrix.Loc.getMessage(\'BI_GROUP_ADD_DASHBOARD\') }}\n\t\t</div>\n\t'},B={emits:["confirm","close"],props:{},setup:function(){return{ButtonSize:r.ButtonSize,AirButtonStyle:r.AirButtonStyle,Outline:s.Outline}},data:function(){return{popupInstance:null,popupId:"biconnector-dashboard-deletion",dontShow:!1}},computed:{popupOptions:function(){return{id:this.popupId,content:this.$refs.content,width:410,padding:12,borderRadius:"16px",autoHide:!0,overlay:!0,events:{onPopupClose:this.closePopup},fixed:!0}}},methods:{closePopup:function(){var t;this.popupInstance&&(null===(t=n.PopupManager.getPopupById(this.popupId))||void 0===t||t.destroy(),this.popupInstance=null,this.$emit("close"))},onConfirm:function(){this.$emit("confirm",{dontShow:this.dontShow}),this.closePopup()},getPopupText:function(){return this.$Bitrix.Loc.getMessage("BI_GROUP_SAVE_WARN_TEXT_MSGVER_1")}},mounted:function(){this.popupInstance||(this.popupInstance=new n.Popup(this.popupOptions)),this.popupInstance.show()},beforeUnmount:function(){this.closePopup()},components:{BIcon:d.BIcon,UiButton:r.Button},template:'\n\t\t<div ref="content" class="group-warn-popup">\n\t\t\t<div class="group-warn-popup-title-block">\n\t\t\t\t<div class="group-warn-popup-title">{{ $Bitrix.Loc.getMessage(\'BI_GROUP_SAVE_WARN_TITLE\') }}</div>\n\t\t\t\t<BIcon\n\t\t\t\t\t:name="Outline.CROSS_L"\n\t\t\t\t\t:size="24"\n\t\t\t\t\tcolor="#A7A7A7"\n\t\t\t\t\t:class="\'group-warn-popup-close\'"\n\t\t\t\t\t@click="closePopup"\n\t\t\t\t></BIcon>\n\t\t\t</div>\n\t\t\t<div class="group-warn-popup-box" v-html="getPopupText()"></div>\n\t\t\t<div class="group-warn-popup-buttons">\n\t\t\t\t<UiButton\n\t\t\t\t\t:text="$Bitrix.Loc.getMessage(\'BI_GROUP_SAVE_WARN_YES\')"\n\t\t\t\t\t:size="ButtonSize.MEDIUM"\n\t\t\t\t\t:style="AirButtonStyle.FILLED"\n\t\t\t\t\t@click="onConfirm"\n\t\t\t\t/>\n\t\t\t\t<UiButton\n\t\t\t\t\t:text="$Bitrix.Loc.getMessage(\'BI_GROUP_SAVE_WARN_NO\')"\n\t\t\t\t\t:size="ButtonSize.MEDIUM"\n\t\t\t\t\t:style="AirButtonStyle.PLAIN"\n\t\t\t\t\t@click="closePopup"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t'};function w(t,e){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function(t,e){if(!t)return;if("string"==typeof t)return A(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return A(t,e)}(t))||e&&t&&"number"==typeof t.length){o&&(t=o);var n=0,s=function(){};return{s:s,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i=!0,a=!1;return{s:function(){o=o.call(t)},n:function(){var t=o.next();return i=t.done,t},e:function(t){a=!0,r=t},f:function(){try{i||null==o.return||o.return()}finally{if(a)throw r}}}}function A(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=new Array(e);o<e;o++)n[o]=t[o];return n}var $={props:{canEdit:{type:Boolean,required:!0}},directives:{hint:u.hint},data:function(){return{scopeNameLengthLimit:30,initialScopedIds:[]}},computed:{scopes:function(){return this.$store.getters.groupScopes},hintOptions:function(){return{html:this.$Bitrix.Loc.getMessage("BI_GROUP_SCOPE_HINT").replace("[link]",'<a class="scope-hint-link" onclick="top.BX.Helper.show(`redirect=detail&code=25556500`)">').replace("[/link]","</a>"),interactivity:!0,popupOptions:{bindOptions:{position:"bottom"},autoHide:!1,width:244,offsetTop:-4,angle:{position:"top",offset:34}}}},scopeText:function(){var t='\n\t\t\t\t<span\n\t\t\t\t\tclass="scope-name '.concat(this.canEdit?"":"scope-list-system",'"\n\t\t\t\t\ttitle="').concat(this.scopes[0].name.length>this.scopeNameLengthLimit?i.Text.encode(this.scopes[0].name):"",'"\n\t\t\t\t>\n\t\t\t\t\t').concat(i.Text.encode(this.formatScopeName(this.scopes[0].name)),"\n\t\t\t\t</span>\n\t\t\t");return this.scopes.length<=1?this.$Bitrix.Loc.getMessage("BI_GROUP_SCOPES_GROUP").replace("[title]",'<span class="group-scope-title">').replace("[/title]","</span>").replace("#SCOPE#",t):this.$Bitrix.Loc.getMessage("BI_GROUP_SCOPES_GROUP_MANY").replace("[title]",'<span class="group-scope-title">').replace("[/title]","</span>").replace("#FIRST_SCOPES#",t).replace("[hint]",'<span class="scope-list scope-list-more group-scope-hint">').replace("[/hint]","</span>").replace("#NUMBER#",this.scopes.length-1)},emptyScopesText:function(){return this.$Bitrix.Loc.getMessage("BI_GROUP_SCOPES_GROUP_EMPTY").replace("[title]",'<span class="group-scope-title">').replace("[/title]","</span>")},set:function(){return d.Set}},methods:{openScopeSelector:function(){this.canEdit&&(this.dialog||this.initDialog(),this.initialScopedIds=this.scopes.map((function(t){return t.code})),this.dialog.show())},initDialog:function(){var t,e=[],o=w(this.scopes);try{for(o.s();!(t=o.n()).done;){var n=t.value;e.push(["biconnector-superset-scope",n.code])}}catch(t){o.e(t)}finally{o.f()}this.dialog=new c.Dialog({id:"group-scope-selector",targetNode:this.$refs.groupScopes,width:350,height:300,dropdownMode:!0,compactView:!0,showAvatars:!1,enableSearch:!0,preload:!0,preselectedItems:e,entities:[{id:"biconnector-superset-scope",dynamicLoad:!0,dynamicSearch:!0}],events:{"Item:onSelect":this.onGroupScopeAdd,"Item:onDeselect":this.onGroupScopeRemove,onHide:this.onDialogHide}}),this.dialog.getPopup().setOffset({offsetLeft:-320}),this.dialog.adjustPosition(),i.Dom.addClass(this.dialog.getContainer(),"biconnector-scope-selector")},onGroupScopeAdd:function(t){var e=t.getData().item,o={code:e.getId(),name:e.getTitle()};this.$emit("onGroupScopeAdd",o)},onGroupScopeRemove:function(t){var e=t.getData().item,o={code:e.getId(),name:e.getTitle()};this.$emit("onGroupScopeRemove",o)},onDialogHide:function(t){var e=!m.areSetsEqual(new Set(this.initialScopedIds),new Set(this.scopes.map((function(t){return t.code}))));a.EventEmitter.emit("BIConnector.GroupPopup.ScopeSelector:onDialogHide",{isScopeListEdited:e})},showMoreScopesHint:function(){var t=this.$el.querySelector(".group-scope-hint");this.hintManager.show(t,this.scopes.slice(1).map((function(t){return t.name})).join(", "),!1)},hideMoreScopesHint:function(){this.hintManager.hide(),this.hintManager.popup=null},showSystemScopesHint:function(){var t=this.$el.querySelector(".scope-list-system");this.systemScopeHintManager.show(t,this.$Bitrix.Loc.getMessage("BI_GROUP_SYSTEM_SCOPES_HINT"),!1)},hideSystemScopesHint:function(){this.systemScopeHintManager.hide(),this.systemScopeHintManager.popup=null},formatScopeName:function(t){return t.length<this.scopeNameLengthLimit?t:"".concat(t.slice(0,this.scopeNameLengthLimit),"...")},attachHintHandlers:function(){var t=this.$el.querySelector(".group-scope-hint");if(t&&(i.Event.unbindAll(t),i.Event.bind(t,"mouseenter",this.showMoreScopesHint),i.Event.bind(t,"mouseleave",this.hideMoreScopesHint)),!this.canEdit){var e=this.$el.querySelector(".scope-list-system");e&&(i.Event.unbindAll(e),i.Event.bind(e,"mouseenter",this.showSystemScopesHint),i.Event.bind(e,"mouseleave",this.hideSystemScopesHint))}}},mounted:function(){this.hintManager=i.UI.Hint.createInstance({id:"group-scope-hint",popupParameters:{bindOptions:{position:"bottom"},width:190,offsetLeft:-80,angle:{position:"top",offset:130},cacheable:!1}}),this.systemScopeHintManager=i.UI.Hint.createInstance({id:"system-scope-hint",popupParameters:{bindOptions:{position:"bottom"},width:244,offsetLeft:-140,angle:{position:"top",offset:180},cacheable:!1}}),this.attachHintHandlers()},updated:function(){this.attachHintHandlers()},beforeUnmount:function(){this.dialog&&this.dialog.destroy(),this.dialog=null;var t=this.$el.querySelector(".group-scope-hint");t&&i.Event.unbindAll(t);var e=this.$el.querySelector(".scope-list-system");e&&i.Event.unbindAll(e)},emits:["onGroupScopeAdd","onGroupScopeRemove"],components:{BIcon:d.BIcon},template:'\n\t\t<div class="group-scope-selector">\n\t\t\t<span\n\t\t\t\tv-if="scopes.length > 0"\n\t\t\t\t@click="openScopeSelector"\n\t\t\t\tclass="scope-list scope-list-group"\n\t\t\t\tv-html="scopeText"\n\t\t\t></span>\n\t\t\t<span\n\t\t\t\tv-else\n\t\t\t\t@click="openScopeSelector"\n\t\t\t\tclass="scope-list scope-list-group"\n\t\t\t\tv-html="emptyScopesText"\n\t\t\t></span>\n\t\t\t<div class="group-scope-list-hint" ref="groupScopes" v-hint="hintOptions">\n\t\t\t\t<BIcon\n\t\t\t\t\t:name="set.HELP"\n\t\t\t\t\t:size="20"\n\t\t\t\t\tcolor="#D5D7DB"\n\t\t\t\t></BIcon>\n\t\t\t</div>\n\t\t</div>\n\t'},C={props:{canEdit:{type:Boolean,required:!0}},data:function(){return{editMode:!1}},directives:{hint:u.hint},computed:{groupName:{get:function(){return this.$store.getters.groupName},set:function(t){this.$store.commit("setGroupName",t)}},set:function(){return d.Set},nameHintOptions:function(){return{text:this.$Bitrix.Loc.getMessage("BI_GROUP_SYSTEM_NAME_HINT"),popupOptions:{bindOptions:{position:"bottom"},width:220,offsetLeft:40,angle:{position:"top",offset:0}}}}},methods:{setEditMode:function(){var t=this;this.editMode=!0,this.$nextTick((function(){t.$refs.nameInput.focus()}))},setViewMode:function(){this.editMode=!1,this.groupName||this.$store.commit("setGroupName",this.$Bitrix.Loc.getMessage("BI_GROUP_NAME_NEW")),this.$emit("onNameUpdate")}},emits:["onNameUpdate"],components:{BIcon:d.BIcon},template:'\n\t\t<div class="group-header-title" :style="{ width: editMode ? \'80%\' : \'auto\' }">\n\t\t\t<template v-if="canEdit">\n\t\t\t\t<input v-if="editMode" class="group-name-input" @blur="setViewMode" v-model="groupName" ref="nameInput">\n\t\t\t\t<template v-else>\n\t\t\t\t\t<div class="group-name">{{groupName}}</div>\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\t:name="set.PENCIL_40"\n\t\t\t\t\t\t:size="20"\n\t\t\t\t\t\tcolor="#BDC1C6"\n\t\t\t\t\t\t:class="\'group-name-edit-icon\'"\n\t\t\t\t\t\t@click="setEditMode"\n\t\t\t\t\t></BIcon>\n\t\t\t\t</template>\n\t\t\t</template>\n\t\t\t<template v-else>\n\t\t\t\t<div class="group-name" v-hint="nameHintOptions">{{groupName}}</div>\n\t\t\t</template>\n\t\t</div>\n\t'};function G(t,e){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function(t,e){if(!t)return;if("string"==typeof t)return P(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return P(t,e)}(t))||e&&t&&"number"==typeof t.length){o&&(t=o);var n=0,s=function(){};return{s:s,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i=!0,a=!1;return{s:function(){o=o.call(t)},n:function(){var t=o.next();return i=t.done,t},e:function(t){a=!0,r=t},f:function(){try{i||null==o.return||o.return()}finally{if(a)throw r}}}}function P(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=new Array(e);o<e;o++)n[o]=t[o];return n}var L={mounted:function(){a.EventEmitter.subscribe("BIConnector.Internal.GroupPopup:onPopupClose",this.onGroupPopupClose)},beforeUnmount:function(){a.EventEmitter.unsubscribe("BIConnector.Internal.GroupPopup:onPopupClose",this.onGroupPopupClose)},data:function(){return{deletionWarning:{popupShown:!1,dashboardId:null}}},computed:{isNoDashboards:function(){return 0===this.$store.state.group.dashboardIds.length},dashboards:function(){return this.$store.getters.groupDashboardsData},isSystemGroup:function(){return this.$store.getters.isSystemGroup},isSaveEnabled:function(){return this.$store.getters.isSaveEnabled},isLoading:function(){return this.$store.getters.isLoading},isDashboardListScrollable:function(){return this.isSaveEnabled?this.dashboards.length>6:this.dashboards.length>7},set:function(){return d.Set}},methods:{handleDeletionConfirmationRequest:function(t){this.deletionWarning.dashboardId=t.dashboardId,this.deletionWarning.popupShown=!0},updateRight:function(){a.EventEmitter.emit("BIConnector.GroupPopup:onGroupUpdated",{group:i.Runtime.clone(this.$store.getters.groupData),dashboards:i.Runtime.clone(this.$store.getters.dashboards)})},onGroupScopeAdd:function(t){var e;this.$store.commit("addGroupScope",t),this.updateRight();var o,n=G(null!==(e=this.$refs.dashboardItem)&&void 0!==e?e:[]);try{for(n.s();!(o=n.n()).done;){o.value.onGroupScopeChanged()}}catch(t){n.e(t)}finally{n.f()}},onGroupScopeRemove:function(t){var e;this.$store.commit("removeGroupScope",t),this.updateRight();var o,n=G(null!==(e=this.$refs.dashboardItem)&&void 0!==e?e:[]);try{for(n.s();!(o=n.n()).done;){o.value.onGroupScopeChanged()}}catch(t){n.e(t)}finally{n.f()}},onDashboardRemove:function(t){var e=t.dashboardId;this.isSaveEnabled&&this.$store.getters.shouldShowDeleteWarning(e)?(this.deletionWarning.dashboardId=e,this.deletionWarning.popupShown=!0):(this.$store.commit("removeDashboard",e),this.updateRight())},confirmDashboardDeletion:function(){this.$store.commit("removeDashboard",this.deletionWarning.dashboardId),this.$refs.dashboardSelector.deselect(this.deletionWarning.dashboardId),this.deletionWarning.dashboardId=null,this.deletionWarning.popupShown=!1,this.updateRight()},cancelDashboardDeletion:function(){this.$refs.dashboardSelector.resetDialog(),this.deletionWarning.dashboardId=null,this.deletionWarning.popupShown=!1},saveGroup:function(){var t=this;this.$store.commit("setIsLoading",!0),i.ajax.runAction("biconnector.group.save",{data:{group:this.$store.getters.groupData,dashboards:babelHelpers.toConsumableArray(this.$store.getters.dashboards.values())}}).then((function(){t.$store.commit("setIsLoading",!1),t.closePopup(),a.EventEmitter.emit("BIConnector.GroupPopup:onGroupSaved",{group:i.Runtime.clone(t.$store.getters.groupData),dashboards:i.Runtime.clone(t.$store.getters.dashboards),isTitleEdited:t.$store.getters.isTitleEdited,isDashboardListEdited:t.$store.getters.isDashboardListEdited,isScopeListEdited:t.$store.getters.isScopeListEdited})})).catch((function(e){var o;BX.UI.Notification.Center.notify({content:null===(o=e.errors[0])||void 0===o?void 0:o.message}),t.$store.commit("setIsLoading",!1)}))},closePopup:function(){n.PopupManager.getPopupById("biconnector-dashboard-group").close()},onGroupPopupClose:function(){a.EventEmitter.emit("BIConnector.GroupPopup:onPopupClose",{group:this.$store.getters.groupData,isTitleEdited:this.$store.getters.isTitleEdited,isDashboardListEdited:this.$store.getters.isDashboardListEdited,isScopeListEdited:this.$store.getters.isScopeListEdited})}},components:{BIcon:d.BIcon,DashboardItem:y,DashboardSelector:E,GroupScopeSelector:$,TitleEditor:C,DeletionWarningPopup:B},template:'\n\t\t<div class="group-header">\n\t\t\t<TitleEditor @on-name-update="updateRight" :can-edit="!isSystemGroup"/>\n\t\t\t<div class="group-header-controls">\n\t\t\t\t<BIcon\n\t\t\t\t\t:name="set.CROSS_25"\n\t\t\t\t\t:size="25"\n\t\t\t\t\tcolor="#BDC1C6"\n\t\t\t\t\t:class="\'group-close\'"\n\t\t\t\t\t@click="closePopup"\n\t\t\t\t></BIcon>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="group-button-panel">\n\t\t\t<div class="group-button-wrapper">\n\t\t\t\t<DashboardSelector\n\t\t\t\t\t:dashboards="dashboards"\n\t\t\t\t\t@on-dashboards-change="updateRight"\n\t\t\t\t\t@on-before-remove-confirmation="handleDeletionConfirmationRequest"\n\t\t\t\t\tref="dashboardSelector"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<GroupScopeSelector @on-group-scope-add="onGroupScopeAdd" @on-group-scope-remove="onGroupScopeRemove" :can-edit="!isSystemGroup"/>\n\t\t</div>\n\t\t<div class="group-dashboard-empty" v-if="isNoDashboards">\n\t\t\t<img class="group-dashboard-empty-image" src="/bitrix/images/biconnector/dashboard-groups/empty-state.svg" alt="No dashboards">\n\t\t\t<div class="group-dashboard-empty-title">{{ $Bitrix.Loc.getMessage(\'BI_GROUP_EMPTY_TITLE\') }}</div>\n\t\t\t<div class="group-dashboard-empty-subtitle">{{ $Bitrix.Loc.getMessage(\'BI_GROUP_EMPTY_SUBTITLE\') }}</div>\n\t\t</div>\n\t\t<div class="group-dashboard-list" :class="{\'group-dashboard-list-scroll\': isDashboardListScrollable}" v-else>\n\t\t\t<DashboardItem\n\t\t\t\tv-for="dashboard of dashboards"\n\t\t\t\t:key="dashboard.id"\n\t\t\t\tref="dashboardItem"\n\t\t\t\t:dashboard="dashboard"\n\t\t\t\t@on-dashboard-change="updateRight"\n\t\t\t\t@on-dashboard-remove="onDashboardRemove"\n\t\t\t/>\n\t\t</div>\n\t\t<div class="group-footer" v-if="isSaveEnabled">\n\t\t\t<div\n\t\t\t\t:class="[\'ui-btn ui-btn-primary ui-btn-md ui-btn-round ui-btn-no-caps group-footer-button\', {\'ui-btn-disabled ui-btn-clock\': isLoading}]" \n\t\t\t\t@click="saveGroup"\n\t\t\t>\n\t\t\t\t{{ $Bitrix.Loc.getMessage(\'BI_GROUP_SAVE\') }}\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tclass="ui-btn ui-btn-light-border ui-btn-md ui-btn-round ui-btn-no-caps group-footer-button"\n\t\t\t\t@click="closePopup"\n\t\t\t>\n\t\t\t\t{{ $Bitrix.Loc.getMessage(\'BI_GROUP_SAVE_CANCEL_MSGVER_1\') }}\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="group-loader" v-if="isLoading"></div>\n\t\t<DeletionWarningPopup \n\t\t\tv-if="deletionWarning.popupShown" \n\t\t\t@confirm="confirmDashboardDeletion" \n\t\t\t@close="cancelDashboardDeletion"\n\t\t/>\n\t'},M=function(){function t(){babelHelpers.classCallCheck(this,t)}return babelHelpers.createClass(t,null,[{key:"open",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.getApp(t),o=new n.Popup({id:"biconnector-dashboard-group",width:800,height:560,overlay:!0,closeIcon:!1,autoHide:!0,padding:0,cacheable:!1,content:'<div id="app"></div>',events:{onPopupClose:function(){a.EventEmitter.emit("BIConnector.Internal.GroupPopup:onPopupClose"),e.unmount()}}});o.show(),e.mount("#app")}},{key:"getApp",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=t.groups.find((function(e){return e.id===t.groupId}));o||(o={id:"new_G0",name:i.Loc.getMessage("BI_GROUP_NAME_NEW"),type:p.custom,scopes:[],dashboardIds:[]});var n={group:o,otherGroups:t.groups.filter((function(e){return e.id!==t.groupId})),dashboards:t.dashboards,saveEnabled:t.saveEnabled,isLoading:!1,user:t.user},s=e.BitrixVue.createApp({name:"GroupPopupApp",data:function(){return{}},components:{App:L},computed:{componentName:function(){return L}},template:"\n\t\t\t\t<App/>\n\t\t\t"}),r=m.buildStore(n);return s.use(r),s}}]),t}();t.DashboardGroup=M,t.GroupType=p}(this.BX.BIConnector=this.BX.BIConnector||{},BX.Vue3,BX.Vue3.Vuex,BX.Main,BX.UI.IconSet,BX.Vue3.Components,BX,BX.Event,BX.UI.EntitySelector,BX.UI.IconSet,BX.Vue3.Directives);
//# sourceMappingURL=dashboard-group.bundle.map.js