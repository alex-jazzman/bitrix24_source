{"version":3,"file":"script.js","sources":["src/chat-selector.js","src/detail-instance.js","src/skeleton.js","src/detail.js"],"sourcesContent":["import { ajax as Ajax, Loc, Tag, Type } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport { ApacheSupersetAnalytics } from 'biconnector.apache-superset-analytics';\nimport { Dialog, Item } from 'ui.entity-selector';\n\ntype Props = {\n\ttargetNode: HTMLElement,\n\tonSend: Function,\n\tfileExtension: 'jpeg' | 'pdf',\n\tdashboardName: string,\n\tdashboardId: number,\n\tdashboardType: string,\n\tappId: number,\n};\n\nexport class ChatSelector\n{\n\t#props: Props;\n\t#dialog: Dialog;\n\t#sendInProgress: boolean = false;\n\n\tconstructor(props: Props)\n\t{\n\t\tthis.#props = props;\n\t\tthis.#initDialog();\n\t}\n\n\tshow(): void\n\t{\n\t\tthis.#dialog.show();\n\t}\n\n\t#initDialog()\n\t{\n\t\tthis.#dialog = new Dialog({\n\t\t\tid: 'biconnector-chat-selector',\n\t\t\tmultiple: true,\n\t\t\ttargetNode: this.#props.targetNode,\n\t\t\toffsetTop: 14,\n\t\t\tcontext: 'biconnector-chat-selector',\n\t\t\tpopupOptions: {\n\t\t\t\tclassName: 'biconnector-chat-selector',\n\t\t\t},\n\t\t\tentities: this.#getSelectorEntities(),\n\t\t\theader: this.#getHeader(),\n\t\t\tfooter: this.#getFooter(),\n\t\t\tfooterOptions: {\n\t\t\t\tcontainerClass: 'ui-selector-footer-default biconnector-send-to-chat-footer-wrapper',\n\t\t\t},\n\t\t\tenableSearch: true,\n\t\t\tdropdownMode: true,\n\t\t\tshowAvatars: true,\n\t\t\tcompactView: true,\n\t\t\tdynamicLoad: true,\n\t\t\tevents: {\n\t\t\t\t'Item:onBeforeSelect': (event: BaseEvent) => {\n\t\t\t\t\tconst dialog: Dialog = event.getTarget();\n\t\t\t\t\tdialog.deselectAll();\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\t#handleOnFooterLinkClick()\n\t{\n\t\tconst item = this.#dialog.selectedItems.values()?.next()?.value;\n\t\tif (!(item instanceof Item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!Type.isFunction(this.#props.onSend))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#sendInProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#dialog.showLoader();\n\t\tconst notificationStack = new BX.UI.Notification.Stack({\n\t\t\tid: 'send-dashboard',\n\t\t\toffsetX: 20,\n\t\t\toffsetY: 80,\n\t\t});\n\n\t\tthis.#sendInProgress = true;\n\t\tthis.#props.onSend()\n\t\t\t.then((response) => {\n\t\t\t\treturn Ajax.runComponentAction('bitrix:biconnector.apachesuperset.dashboard.detail', 'sendDashboardToChat', {\n\t\t\t\t\tmode: 'ajax',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tdialogId: item.id,\n\t\t\t\t\t\tcontent: response,\n\t\t\t\t\t\tdashboardName: this.#props.dashboardName,\n\t\t\t\t\t\tfileExtension: this.#props.fileExtension,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t})\n\t\t\t.then(() => {\n\t\t\t\tthis.#dialog.hideLoader();\n\t\t\t\tthis.#dialog.hide();\n\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\tcontent: Loc.getMessage('SUPERSET_DASHBOARD_DETAIL_SHARE_SUCCESS'),\n\t\t\t\t\tstack: notificationStack,\n\t\t\t\t\tautoHideDelay: 3000,\n\t\t\t\t});\n\t\t\t\tApacheSupersetAnalytics.sendAnalytics('share', 'dashboard_share', {\n\t\t\t\t\tstatus: 'success',\n\t\t\t\t\ttype: this.#props.dashboardType,\n\t\t\t\t\tp1: ApacheSupersetAnalytics.buildAppIdForAnalyticRequest(this.#props.appId),\n\t\t\t\t\tp2: this.#props.dashboardId,\n\t\t\t\t\tp3: `ext_${this.#props.fileExtension}`,\n\t\t\t\t});\n\t\t\t\tthis.#sendInProgress = false;\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.#dialog.hideLoader();\n\t\t\t\tconsole.error(response);\n\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\tcontent: response.errors[0].message,\n\t\t\t\t\tstack: notificationStack,\n\t\t\t\t});\n\t\t\t\tApacheSupersetAnalytics.sendAnalytics('share', 'dashboard_share', {\n\t\t\t\t\tstatus: 'error',\n\t\t\t\t\ttype: this.#props.dashboardType,\n\t\t\t\t\tp1: ApacheSupersetAnalytics.buildAppIdForAnalyticRequest(this.#props.appId),\n\t\t\t\t\tp2: this.#props.dashboardId,\n\t\t\t\t\tp3: `ext_${this.#props.fileExtension}`,\n\t\t\t\t});\n\t\t\t\tthis.#sendInProgress = false;\n\t\t\t})\n\t\t;\n\t}\n\n\t#getHeader(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<span class=\"biconnector-send-to-chat-header\">\n\t\t\t\t${Loc.getMessage('SUPERSET_DASHBOARD_DETAIL_SHARE_RECEIVER')}\n\t\t\t</span>\n\t\t`;\n\t}\n\n\t#getFooter(): HTMLElement[]\n\t{\n\t\treturn [\n\t\t\tTag.render`\n\t\t\t\t<div class=\"biconnector-send-to-chat-footer\" onclick=\"${this.#handleOnFooterLinkClick.bind(this)}}\">\n\t\t\t\t\t<span class=\"ui-icon-set --send\" style=\"--ui-icon-set__icon-size: 32px; --ui-icon-set__icon-color: #2FC6F6; margin-right: 10px;\">\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class=\"biconnector-send-to-chat-footer-text\">\n\t\t\t\t\t\t${Loc.getMessage('SUPERSET_DASHBOARD_DETAIL_SHARE_SEND')}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t`,\n\t\t];\n\t}\n\n\t#getSelectorEntities(): Array\n\t{\n\t\treturn [\n\t\t\t{\n\t\t\t\tid: 'im-chat',\n\t\t\t\toptions: {\n\t\t\t\t\tsearchableChatTypes: ['C', 'L', 'O'],\n\t\t\t\t\tfillDialog: false,\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'user',\n\t\t\t\toptions: {\n\t\t\t\t\tfillDialog: false,\n\t\t\t\t},\n\t\t\t\tfilters: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'im.userDataFilter',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'im-recent',\n\t\t\t\toptions: {\n\t\t\t\t\tlimit: 100,\n\t\t\t\t},\n\t\t\t},\n\t\t];\n\t}\n}\n","import { Dom, Event, Loc, Text, Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport type { MenuItemOptions } from 'main.popup';\nimport { Menu, MenuItem } from 'main.popup';\nimport { Loader } from 'main.loader';\nimport { DateTimeFormat } from 'main.date';\nimport type { DetailConfig } from './type/detail-config';\nimport type { DashboardEmbeddedParameters } from './type/dashboard-embedded-parameters';\nimport { DashboardManager } from 'biconnector.apache-superset-dashboard-manager';\nimport { ApacheSupersetEmbeddedLoader } from 'biconnector.apache-superset-embedded-loader';\nimport { ApacheSupersetAnalytics } from 'biconnector.apache-superset-analytics';\nimport { ApacheSupersetFeedbackForm } from 'biconnector.apache-superset-feedback-form';\nimport { ChatSelector } from './chat-selector';\nimport 'sidepanel';\n\nexport class DetailInstance\n{\n\t#dashboardManager: DashboardManager;\n\t#dashboardNode: HTMLElement;\n\t#frameNode: HTMLElement;\n\t#editBtn: HTMLElement;\n\n\t#embeddedParams: DashboardEmbeddedParameters;\n\t#embeddedLoader: ApacheSupersetEmbeddedLoader;\n\t#embeddedDebugMode: boolean;\n\t#canExport: boolean;\n\t#canEdit: boolean;\n\n\t#moreMenu: Menu;\n\n\tconstructor(config: DetailConfig)\n\t{\n\t\tthis.#dashboardNode = document.getElementById(config.appNodeId);\n\t\tif (!Type.isDomNode(this.#dashboardNode))\n\t\t{\n\t\t\tconst errorMsg = `Cannot init superset dashboard. Node with ID ${config.appNodeId} does not exists`;\n\t\t\tthrow new Error(errorMsg);\n\t\t}\n\t\tthis.#dashboardManager = new DashboardManager();\n\t\tthis.#canExport = config.canExport === 'Y';\n\t\tthis.#canEdit = config.canEdit === 'Y';\n\t\tthis.#embeddedParams = config.dashboardEmbeddedParams;\n\t\tthis.#embeddedDebugMode = config.embeddedDebugMode;\n\n\t\tthis.#frameNode = this.#dashboardNode.querySelector('.dashboard-iframe');\n\t\tthis.#subscribeEvents();\n\t\tthis.#initHeaderButtons();\n\n\t\tif (!BX.BIConnector.LimitLockPopup)\n\t\t{\n\t\t\tthis.#initFrame(this.#embeddedParams);\n\t\t}\n\n\t\tApacheSupersetAnalytics.sendAnalytics('view', 'report_view', {\n\t\t\tc_element: config.analyticSource,\n\t\t\tstatus: 'success',\n\t\t\ttype: this.#embeddedParams.type.toLowerCase(),\n\t\t\tp1: ApacheSupersetAnalytics.buildAppIdForAnalyticRequest(this.#embeddedParams.appId),\n\t\t\tp2: this.#embeddedParams.id,\n\t\t\t...(config.analyticScope && { p3: ApacheSupersetAnalytics.buildScopeForAnalyticRequest(config.analyticScope) }),\n\t\t\tp4: this.#embeddedParams.isUseExternalDatasets ?? false,\n\t\t});\n\t}\n\n\t#subscribeEvents()\n\t{\n\t\tEventEmitter.subscribe('BiConnector:DashboardSelector.onSelect', (event) => {\n\t\t\tDom.clean(this.#frameNode);\n\t\t\tBX.BIConnector.ApacheSuperset.Dashboard.Detail.createSkeleton({\n\t\t\t\tcontainer: this.#frameNode,\n\t\t\t\tstatus: DashboardManager.DASHBOARD_STATUS_LOAD,\n\t\t\t});\n\t\t});\n\n\t\tEventEmitter.subscribe('BiConnector:DashboardSelector.onSelectDataLoaded', (event) => {\n\t\t\tDom.clean(this.#frameNode);\n\t\t\tthis.#embeddedParams = event.data.credentials;\n\t\t\tthis.#canEdit = this.#embeddedParams.canEdit;\n\t\t\tthis.#canExport = this.#embeddedParams.canExport;\n\n\t\t\tlet historyUrl = this.#embeddedParams.embeddedUrl;\n\t\t\tthis.#initFrame(this.#embeddedParams);\n\n\t\t\tApacheSupersetAnalytics.sendAnalytics('view', 'report_view', {\n\t\t\t\tc_element: 'selector',\n\t\t\t\tstatus: 'success',\n\t\t\t\ttype: this.#embeddedParams.type.toLowerCase(),\n\t\t\t\tp1: ApacheSupersetAnalytics.buildAppIdForAnalyticRequest(this.#embeddedParams.appId),\n\t\t\t\tp2: this.#embeddedParams.id,\n\t\t\t\tp4: this.#embeddedParams.isUseExternalDatasets ?? false,\n\t\t\t});\n\n\t\t\ttop.window.history.pushState(null, '', historyUrl);\n\t\t\tthis.#initHeaderButtons();\n\t\t});\n\n\t\tEventEmitter.subscribe('BiConnector:LimitPopup.Warning.onClose', (event) => {\n\t\t\tthis.#initFrame(this.#embeddedParams);\n\t\t\tthis.#initHeaderButtons();\n\t\t});\n\n\t\tEventEmitter.subscribe('BX.BIConnector.Settings:onAfterSave', () => {\n\t\t\tthis.#reloadGridAfterSliderClose();\n\t\t});\n\t}\n\n\t#initFrame(embeddedParams: DashboardEmbeddedParameters)\n\t{\n\t\tconst dashboardParams = {\n\t\t\tid: embeddedParams.uuid, // given by the Superset embedding UI\n\t\t\tsupersetDomain: embeddedParams.supersetDomain,\n\t\t\tmountPoint: this.#frameNode, // any html element that can contain an iframe\n\t\t\tfetchGuestToken: embeddedParams.guestToken,\n\t\t\tdebug: this.#embeddedDebugMode,\n\t\t\tdashboardUiConfig: { // dashboard UI config: hideTitle, hideTab, ...etc.\n\t\t\t\thideTitle: true,\n\t\t\t\thideTab: true,\n\t\t\t\thideChartControls: true,\n\t\t\t\tfilters: {\n\t\t\t\t\texpanded: true,\n\t\t\t\t\tvisible: true,\n\t\t\t\t\tnativeFilters: embeddedParams.nativeFilters,\n\t\t\t\t},\n\t\t\t\turlParams: embeddedParams.urlParams ?? {},\n\t\t\t},\n\t\t};\n\n\t\tthis.#embeddedLoader = new ApacheSupersetEmbeddedLoader(dashboardParams);\n\t\tthis.#embeddedLoader.embedDashboard();\n\t}\n\n\t#initHeaderButtons()\n\t{\n\t\tthis.#initMoreMenu();\n\t\tthis.#initDownloadButton();\n\t\tthis.#initShareButton();\n\n\t\tthis.#editBtn = this.#dashboardNode.querySelector('.dashboard-header-buttons-edit');\n\t\tEvent.unbindAll(this.#editBtn);\n\n\t\tif (this.#canEdit)\n\t\t{\n\t\t\tthis.#enableEditButton();\n\t\t\tEvent.bind(this.#editBtn, 'click', this.#onEditButtonClick.bind(this));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#disableEditButton();\n\t\t\tEvent.unbindAll(this.#editBtn);\n\t\t}\n\n\t\tif (BX.BIConnector.LimitLockPopup)\n\t\t{\n\t\t\tthis.#disableEditButton();\n\t\t\tEvent.unbindAll(this.#editBtn);\n\t\t}\n\t}\n\n\t#onEditButtonClick()\n\t{\n\t\tthis.#muteEditButton();\n\n\t\tconst dashboardInfo = {\n\t\t\tid: this.#embeddedParams.id,\n\t\t\teditLink: this.#embeddedParams.editUrl,\n\t\t\ttype: this.#embeddedParams.type,\n\t\t};\n\n\t\tthis.#dashboardManager.processEditDashboard(\n\t\t\tdashboardInfo,\n\t\t\t() => {\n\t\t\t\tthis.#unmuteEditButton();\n\t\t\t},\n\t\t\t(popupType) => {\n\t\t\t\tApacheSupersetAnalytics.sendAnalytics('edit', 'report_edit', {\n\t\t\t\t\tc_sub_section: popupType,\n\t\t\t\t\tc_element: 'detail_button',\n\t\t\t\t\ttype: this.#embeddedParams.type.toLowerCase(),\n\t\t\t\t\tp1: ApacheSupersetAnalytics.buildAppIdForAnalyticRequest(this.#embeddedParams.appId),\n\t\t\t\t\tp2: this.#embeddedParams.id,\n\t\t\t\t\tstatus: 'success',\n\t\t\t\t});\n\t\t\t},\n\t\t\t(popupType) => {\n\t\t\t\tApacheSupersetAnalytics.sendAnalytics('edit', 'report_edit', {\n\t\t\t\t\tc_sub_section: popupType,\n\t\t\t\t\tc_element: 'detail_button',\n\t\t\t\t\ttype: this.#embeddedParams.type.toLowerCase(),\n\t\t\t\t\tp1: ApacheSupersetAnalytics.buildAppIdForAnalyticRequest(this.#embeddedParams.appId),\n\t\t\t\t\tp2: this.#embeddedParams.id,\n\t\t\t\t\tstatus: 'error',\n\t\t\t\t});\n\t\t\t},\n\t\t);\n\n\t\tthis.#reloadGridAfterSliderClose();\n\t}\n\n\t#reloadGridAfterSliderClose()\n\t{\n\t\tconst slider = BX.SidePanel.Instance.getSliderByWindow(window);\n\t\tif (slider)\n\t\t{\n\t\t\tEventEmitter.subscribeOnce(slider, 'SidePanel.Slider:onClose', () => {\n\t\t\t\tif (!top.BX.Main || !top.BX.Main.gridManager)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\ttop.BX.Main.gridManager.data.forEach((grid) => {\n\t\t\t\t\tif (grid.instance.getId() === 'biconnector_superset_dashboard_grid')\n\t\t\t\t\t{\n\t\t\t\t\t\tgrid.instance.reload();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\t#muteEditButton()\n\t{\n\t\tthis.#disableEditButton();\n\t\tDom.addClass(this.#editBtn, 'ui-btn-wait');\n\t}\n\n\t#unmuteEditButton()\n\t{\n\t\tthis.#enableEditButton();\n\t\tDom.removeClass(this.#editBtn, 'ui-btn-wait');\n\t}\n\n\t#disableEditButton()\n\t{\n\t\tthis.#editBtn.setAttribute('disabled', 'true');\n\t}\n\n\t#enableEditButton()\n\t{\n\t\tthis.#editBtn.removeAttribute('disabled');\n\t}\n\n\t// eslint-disable-next-line max-lines-per-function\n\t#initDownloadButton(): void\n\t{\n\t\tconst downloadButton = this.#dashboardNode.querySelector('.dashboard-header-buttons-download');\n\t\tEvent.unbindAll(downloadButton);\n\t\tconst downloadMenu = new Menu({\n\t\t\tcloseByEsc: false,\n\t\t\tcloseIcon: false,\n\t\t\tcacheable: true,\n\t\t\tangle: {\n\t\t\t\tposition: 'top',\n\t\t\t},\n\t\t\toffsetLeft: (parseInt(getComputedStyle(downloadButton).marginLeft, 10) + downloadButton.offsetWidth) / 2,\n\t\t\tbindElement: downloadButton,\n\t\t\tautoHide: true,\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\tid: 'download-screenshot',\n\t\t\t\t\ttext: Loc.getMessage('SUPERSET_DASHBOARD_DETAIL_DOWNLOAD_IMAGE'),\n\t\t\t\t\ttitle: Loc.getMessage('SUPERSET_DASHBOARD_DETAIL_DOWNLOAD_IMAGE'),\n\t\t\t\t\tonclick: (event, menuItem) => {\n\t\t\t\t\t\tmenuItem.disable();\n\t\t\t\t\t\tconst loader = new Loader({\n\t\t\t\t\t\t\ttarget: menuItem.layout.item,\n\t\t\t\t\t\t\tsize: 30,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tloader.show();\n\t\t\t\t\t\tthis.#embeddedLoader.getScreenshot()\n\t\t\t\t\t\t\t.then((imageData: string) => {\n\t\t\t\t\t\t\t\tconst dashboardTitle = Text.decode(this.#embeddedParams.title);\n\t\t\t\t\t\t\t\tconst datetime = DateTimeFormat.format('Y-m-d H-i-s');\n\t\t\t\t\t\t\t\tthis.#downloadFile(\n\t\t\t\t\t\t\t\t\timageData.replace('data:image/jpeg;base64,', ''),\n\t\t\t\t\t\t\t\t\t`${dashboardTitle} ${datetime}.jpeg`,\n\t\t\t\t\t\t\t\t\t'image/jpeg',\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tmenuItem.enable();\n\t\t\t\t\t\t\t\tloader.hide();\n\t\t\t\t\t\t\t\tApacheSupersetAnalytics.sendAnalytics('download', 'dashboard_download', {\n\t\t\t\t\t\t\t\t\tstatus: 'success',\n\t\t\t\t\t\t\t\t\ttype: this.#embeddedParams.type.toLowerCase(),\n\t\t\t\t\t\t\t\t\tp1: ApacheSupersetAnalytics.buildAppIdForAnalyticRequest(this.#embeddedParams.appId),\n\t\t\t\t\t\t\t\t\tp2: this.#embeddedParams.id,\n\t\t\t\t\t\t\t\t\tp3: 'ext_jpeg',\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch(() => {\n\t\t\t\t\t\t\t\tmenuItem.enable();\n\t\t\t\t\t\t\t\tloader.hide();\n\t\t\t\t\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\t\t\t\t\tcontent: Loc.getMessage('SUPERSET_DASHBOARD_DETAIL_DOWNLOAD_ERROR'),\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tApacheSupersetAnalytics.sendAnalytics('download', 'dashboard_download', {\n\t\t\t\t\t\t\t\t\tstatus: 'error',\n\t\t\t\t\t\t\t\t\ttype: this.#embeddedParams.type.toLowerCase(),\n\t\t\t\t\t\t\t\t\tp1: ApacheSupersetAnalytics.buildAppIdForAnalyticRequest(this.#embeddedParams.appId),\n\t\t\t\t\t\t\t\t\tp2: this.#embeddedParams.id,\n\t\t\t\t\t\t\t\t\tp3: 'ext_jpeg',\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'download-pdf',\n\t\t\t\t\ttext: Loc.getMessage('SUPERSET_DASHBOARD_DETAIL_DOWNLOAD_PDF'),\n\t\t\t\t\ttitle: Loc.getMessage('SUPERSET_DASHBOARD_DETAIL_DOWNLOAD_PDF'),\n\t\t\t\t\tonclick: (event, menuItem) => {\n\t\t\t\t\t\tmenuItem.disable();\n\t\t\t\t\t\tconst loader = new Loader({\n\t\t\t\t\t\t\ttarget: menuItem.layout.item,\n\t\t\t\t\t\t\tsize: 30,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tloader.show();\n\t\t\t\t\t\tthis.#embeddedLoader.getPdf()\n\t\t\t\t\t\t\t.then((imageData: string) => {\n\t\t\t\t\t\t\t\tconst dashboardTitle = Text.decode(this.#embeddedParams.title);\n\t\t\t\t\t\t\t\tconst datetime = DateTimeFormat.format('Y-m-d H-i-s');\n\t\t\t\t\t\t\t\tthis.#downloadFile(\n\t\t\t\t\t\t\t\t\timageData,\n\t\t\t\t\t\t\t\t\t`${dashboardTitle} ${datetime}.pdf`,\n\t\t\t\t\t\t\t\t\t'application/pdf',\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tmenuItem.enable();\n\t\t\t\t\t\t\t\tloader.hide();\n\t\t\t\t\t\t\t\tApacheSupersetAnalytics.sendAnalytics('download', 'dashboard_download', {\n\t\t\t\t\t\t\t\t\tstatus: 'success',\n\t\t\t\t\t\t\t\t\ttype: this.#embeddedParams.type.toLowerCase(),\n\t\t\t\t\t\t\t\t\tp1: ApacheSupersetAnalytics.buildAppIdForAnalyticRequest(this.#embeddedParams.appId),\n\t\t\t\t\t\t\t\t\tp2: this.#embeddedParams.id,\n\t\t\t\t\t\t\t\t\tp3: 'ext_pdf',\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch(() => {\n\t\t\t\t\t\t\t\tmenuItem.enable();\n\t\t\t\t\t\t\t\tloader.hide();\n\t\t\t\t\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\t\t\t\t\tcontent: Loc.getMessage('SUPERSET_DASHBOARD_DETAIL_DOWNLOAD_ERROR'),\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tApacheSupersetAnalytics.sendAnalytics('download', 'dashboard_download', {\n\t\t\t\t\t\t\t\t\tstatus: 'error',\n\t\t\t\t\t\t\t\t\ttype: this.#embeddedParams.type.toLowerCase(),\n\t\t\t\t\t\t\t\t\tp1: ApacheSupersetAnalytics.buildAppIdForAnalyticRequest(this.#embeddedParams.appId),\n\t\t\t\t\t\t\t\t\tp2: this.#embeddedParams.id,\n\t\t\t\t\t\t\t\t\tp3: 'ext_pdf',\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tonAfterShow: () => {\n\t\t\t\t\tDom.style(downloadMenu.popupWindow.angle.element, 'left', '17px');\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tEvent.bind(downloadButton, 'click', () => {\n\t\t\tdownloadMenu.show();\n\t\t\tApacheSupersetAnalytics.sendAnalytics('download', 'click_download', {\n\t\t\t\ttype: this.#embeddedParams.type.toLowerCase(),\n\t\t\t});\n\t\t});\n\t}\n\n\t#initShareButton()\n\t{\n\t\tconst shareButton = this.#dashboardNode.querySelector('.dashboard-header-buttons-share');\n\t\tEvent.unbindAll(shareButton);\n\t\tconst downloadMenu = new Menu({\n\t\t\tcloseByEsc: false,\n\t\t\tcloseIcon: false,\n\t\t\tcacheable: true,\n\t\t\tangle: {\n\t\t\t\tposition: 'top',\n\t\t\t},\n\t\t\toffsetLeft: (parseInt(getComputedStyle(shareButton).marginLeft, 10) + shareButton.offsetWidth) / 2,\n\t\t\tbindElement: shareButton,\n\t\t\tautoHide: true,\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\tid: 'share-screenshot',\n\t\t\t\t\ttext: Loc.getMessage('SUPERSET_DASHBOARD_DETAIL_DOWNLOAD_IMAGE'),\n\t\t\t\t\ttitle: Loc.getMessage('SUPERSET_DASHBOARD_DETAIL_DOWNLOAD_IMAGE'),\n\t\t\t\t\tonclick: (event, menuItem: MenuItem) => {\n\t\t\t\t\t\tmenuItem.menuWindow.close();\n\t\t\t\t\t\tconst moreButton = this.#dashboardNode.querySelector('.dashboard-header-buttons-more');\n\t\t\t\t\t\tconst selector: ChatSelector = new ChatSelector({\n\t\t\t\t\t\t\ttargetNode: moreButton,\n\t\t\t\t\t\t\tdashboardName: Text.decode(this.#embeddedParams.title),\n\t\t\t\t\t\t\tfileExtension: 'jpeg',\n\t\t\t\t\t\t\tonSend: () => this.#embeddedLoader.getScreenshot(),\n\t\t\t\t\t\t\tdashboardId: this.#embeddedParams.id,\n\t\t\t\t\t\t\tdashboardType: this.#embeddedParams.type.toLowerCase(),\n\t\t\t\t\t\t\tappId: this.#embeddedParams.appId,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tselector.show();\n\t\t\t\t\t\tApacheSupersetAnalytics.sendAnalytics('share', 'open_selector', {\n\t\t\t\t\t\t\tp3: 'ext_jpeg',\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'share-pdf',\n\t\t\t\t\ttext: Loc.getMessage('SUPERSET_DASHBOARD_DETAIL_DOWNLOAD_PDF'),\n\t\t\t\t\ttitle: Loc.getMessage('SUPERSET_DASHBOARD_DETAIL_DOWNLOAD_PDF'),\n\t\t\t\t\tonclick: (event, menuItem: MenuItem) => {\n\t\t\t\t\t\tmenuItem.menuWindow.close();\n\t\t\t\t\t\tconst moreButton = this.#dashboardNode.querySelector('.dashboard-header-buttons-more');\n\t\t\t\t\t\tconst selector: ChatSelector = new ChatSelector({\n\t\t\t\t\t\t\ttargetNode: moreButton,\n\t\t\t\t\t\t\tdashboardName: Text.decode(this.#embeddedParams.title),\n\t\t\t\t\t\t\tfileExtension: 'pdf',\n\t\t\t\t\t\t\tonSend: () => this.#embeddedLoader.getPdf(),\n\t\t\t\t\t\t\tdashboardId: this.#embeddedParams.id,\n\t\t\t\t\t\t\tdashboardType: this.#embeddedParams.type.toLowerCase(),\n\t\t\t\t\t\t\tappId: this.#embeddedParams.appId,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tselector.show();\n\t\t\t\t\t\tApacheSupersetAnalytics.sendAnalytics('share', 'open_selector', {\n\t\t\t\t\t\t\tp3: 'ext_pdf',\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tonAfterShow: () => {\n\t\t\t\t\tDom.style(downloadMenu.popupWindow.angle.element, 'left', '17px');\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tEvent.bind(shareButton, 'click', () => {\n\t\t\tdownloadMenu.show();\n\t\t\tApacheSupersetAnalytics.sendAnalytics('share', 'click_share', {\n\t\t\t\ttype: this.#embeddedParams.type.toLowerCase(),\n\t\t\t});\n\t\t});\n\t}\n\n\t#initMoreMenu()\n\t{\n\t\tconst moreButton = this.#dashboardNode.querySelector('.dashboard-header-buttons-more');\n\t\tif (this.#moreMenu)\n\t\t{\n\t\t\tEvent.unbindAll(moreButton);\n\t\t}\n\n\t\tthis.#moreMenu = new Menu({\n\t\t\tcloseByEsc: false,\n\t\t\tcloseIcon: false,\n\t\t\tcacheable: true,\n\t\t\tangle: {\n\t\t\t\tposition: 'top',\n\t\t\t\toffset: 43,\n\t\t\t},\n\t\t\titems: this.#getMoreMenuItems(),\n\t\t\ttoFrontOnShow: true,\n\t\t\tautoHide: true,\n\t\t\tbindElement: moreButton,\n\t\t\tclassName: 'more-popup',\n\t\t\tevents: {\n\t\t\t\tonBeforeClose: () => {\n\t\t\t\t\tthis.#moreMenu.getMenuItems().forEach((menuItem) => {\n\t\t\t\t\t\tmenuItem.closeSubMenu();\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tonAfterShow: () => {\n\t\t\t\t\tconst popupContainer = this.#getMoreMenu().getPopupWindow().getPopupContainer();\n\t\t\t\t\tconst overHeight = popupContainer.getBoundingClientRect().top + popupContainer.offsetHeight;\n\n\t\t\t\t\tif (overHeight > window.innerHeight)\n\t\t\t\t\t{\n\t\t\t\t\t\twindow.scrollTo({\n\t\t\t\t\t\t\ttop: window.scrollY + (-window.innerHeight + overHeight),\n\t\t\t\t\t\t\tbehavior: 'smooth',\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tEvent.bind(moreButton, 'click', () => this.#moreMenu.show());\n\t}\n\n\t// eslint-disable-next-line max-lines-per-function\n\t#getMoreMenuItems(): MenuItemOptions[]\n\t{\n\t\tconst result = [\n\t\t\t{\n\t\t\t\tid: 'order_dashboard',\n\t\t\t\ttext: Loc.getMessage('SUPERSET_DASHBOARD_DETAIL_MORE_MENU_ORDER_DASHBOARD'),\n\t\t\t\ttitle: Loc.getMessage('SUPERSET_DASHBOARD_DETAIL_MORE_MENU_ORDER_DASHBOARD'),\n\t\t\t\tonclick: () => {\n\t\t\t\t\tApacheSupersetFeedbackForm.requestIntegrationFormOpen();\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'feedback',\n\t\t\t\ttext: Loc.getMessage('SUPERSET_DASHBOARD_DETAIL_MORE_MENU_FEEDBACK'),\n\t\t\t\ttitle: Loc.getMessage('SUPERSET_DASHBOARD_DETAIL_MORE_MENU_FEEDBACK'),\n\t\t\t\tonclick: () => {\n\t\t\t\t\tApacheSupersetFeedbackForm.feedbackFormOpen();\n\t\t\t\t},\n\t\t\t},\n\t\t];\n\n\t\tif (this.#canExport)\n\t\t{\n\t\t\tresult.push({\n\t\t\t\tid: 'export',\n\t\t\t\ttext: Loc.getMessage('SUPERSET_DASHBOARD_DETAIL_MORE_MENU_EXPORT'),\n\t\t\t\ttitle: Loc.getMessage('SUPERSET_DASHBOARD_DETAIL_MORE_MENU_EXPORT'),\n\t\t\t\tonclick: () => {\n\t\t\t\t\tthis.#moreMenu.getMenuItem('export').disable();\n\t\t\t\t\tthis.#dashboardManager.exportDashboard(this.#embeddedParams.id, 'detail_button')\n\t\t\t\t\t\t.finally(() => {\n\t\t\t\t\t\t\tthis.#moreMenu.getMenuItem('export').enable();\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch(() => {})\n\t\t\t\t\t;\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t#downloadFile(base64Data: string, fileName: string, fileType: string): void\n\t{\n\t\tconst byteCharacters = atob(base64Data);\n\t\tconst byteNumbers = Array.from({ length: byteCharacters.length });\n\t\tfor (let i = 0; i < byteCharacters.length; i++)\n\t\t{\n\t\t\tbyteNumbers[i] = byteCharacters.codePointAt(i);\n\t\t}\n\n\t\tconst byteArray = new Uint8Array(byteNumbers);\n\t\tconst blob = new Blob([byteArray], { type: fileType });\n\t\tconst link = document.createElement('a');\n\t\tlink.href = window.URL.createObjectURL(blob);\n\t\tlink.download = fileName;\n\t\tDom.append(link, document.body);\n\t\tlink.click();\n\t\tDom.remove(link);\n\t}\n\n\t#getMoreMenu(): Menu\n\t{\n\t\treturn this.#moreMenu;\n\t}\n}\n","import { Dom, Tag, Type, Loc } from 'main.core';\nimport { Lottie } from 'ui.lottie';\nimport SkeletonAnimation from './skeleton/biconnector-dashboard-skeleton.json';\nimport DashboardLoadingAnimation from './skeleton/biconnector-dashboard-loading.json';\nimport DotsAnimation from './skeleton/biconnector-dots-animation.json';\nimport type { SkeletonConfig } from './type/skeleton-config';\nimport { DashboardManager } from 'biconnector.apache-superset-dashboard-manager';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\n\nexport class Skeleton\n{\n\t#dashboardManager: DashboardManager;\n\t#periodicReload: boolean;\n\t#reloadInterval: number;\n\n\tconstructor(options: SkeletonConfig)\n\t{\n\t\tthis.container = options.container ?? null;\n\t\tthis.dashboardId = options.dashboardId;\n\t\tthis.status = options.status;\n\t\tthis.dashboardType = options.dashboardType;\n\t\tthis.supersetStatus = options.supersetStatus;\n\t\tthis.isFirstStartup = options.isFirstStartup;\n\t\tthis.#dashboardManager = new DashboardManager();\n\t\tthis.#periodicReload = options.periodicReload ?? false;\n\t\tthis.#reloadInterval = null;\n\n\t\tthis.subscribeOnEvents();\n\n\t\tif (Type.isDomNode(this.container))\n\t\t{\n\t\t\tDom.append(this.#initAnimationContainer(), this.container);\n\t\t\tthis.#changeContent(this.#getContent(this.status));\n\t\t}\n\n\t\tif (this.supersetStatus === 'READY' && this.status === 'N')\n\t\t{\n\t\t\tDashboardManager.installDashboard(this.dashboardId)\n\t\t\t\t.then(() => {})\n\t\t\t\t.catch(() => {\n\t\t\t\t\tthis.#changeContent(this.#getFailedContent());\n\t\t\t\t\tthis.#clearReloadInterval();\n\t\t\t\t});\n\t\t}\n\n\t\tif (this.#periodicReload)\n\t\t{\n\t\t\tthis.#reloadInterval = setInterval(() => {\n\t\t\t\twindow.location.reload();\n\t\t\t}, 10000);\n\t\t}\n\t}\n\n\tsubscribeOnEvents(): void\n\t{\n\t\t// eslint-disable-next-line no-unused-expressions\n\t\tBX.PULL && BX.PULL.extendWatch('superset_dashboard', true);\n\t\tEventEmitter.subscribe('onPullEvent-biconnector', (event: BaseEvent) => {\n\t\t\tconst [eventName, eventData] = event.data;\n\t\t\tif (eventName === 'onSupersetStatusUpdated')\n\t\t\t{\n\t\t\t\tconst status = eventData?.status;\n\t\t\t\tif (!status)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tswitch (status)\n\t\t\t\t{\n\t\t\t\t\tcase 'READY':\n\t\t\t\t\t\tthis.#clearReloadInterval();\n\t\t\t\t\t\tDashboardManager.installDashboard(this.dashboardId);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'LOAD':\n\t\t\t\t\t\tthis.#changeContent(this.#getLoadingContent());\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'ERROR':\n\t\t\t\t\t\tthis.#clearReloadInterval();\n\t\t\t\t\t\tthis.#changeContent(this.#getUnavailableSupersetHint());\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'LIMIT_EXCEEDED':\n\t\t\t\t\t\tthis.#changeContent(this.#getLimitExceededHint());\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tEventEmitter.subscribe('BIConnector.Superset.DashboardManager:onDashboardBatchStatusUpdate', (event) => {\n\t\t\tconst data = event.getData();\n\t\t\tif (!data.dashboardList)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst dashboardList = data.dashboardList;\n\n\t\t\tif (BX.SidePanel?.Instance)\n\t\t\t{\n\t\t\t\tBX.SidePanel.Instance.postMessage(window, 'BIConnector.Superset.DashboardDetail:onDashboardBatchStatusUpdate', { dashboardList });\n\t\t\t}\n\n\t\t\tfor (const dashboard of dashboardList)\n\t\t\t{\n\t\t\t\tif (Number(dashboard.id) === this.dashboardId)\n\t\t\t\t{\n\t\t\t\t\tthis.#onDashboardStatusUpdated(dashboard.status);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t#onDashboardStatusUpdated(status: string): void\n\t{\n\t\tswitch (status)\n\t\t{\n\t\t\tcase DashboardManager.DASHBOARD_STATUS_DRAFT:\n\t\t\tcase DashboardManager.DASHBOARD_STATUS_READY: {\n\t\t\t\twindow.location.reload();\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase DashboardManager.DASHBOARD_STATUS_LOAD: {\n\t\t\t\tthis.#changeContent(this.#getLoadingContent());\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase DashboardManager.DASHBOARD_STATUS_FAILED: {\n\t\t\t\tthis.#clearReloadInterval();\n\t\t\t\tthis.#changeContent(this.#getFailedContent());\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t#clearReloadInterval(): void\n\t{\n\t\tif (this.#reloadInterval)\n\t\t{\n\t\t\tclearInterval(this.#reloadInterval);\n\t\t\tthis.#reloadInterval = null;\n\t\t}\n\t}\n\n\t#initAnimationContainer(): HTMLElement\n\t{\n\t\tconst animationBox = Tag.render`\n\t\t\t<div class=\"biconnector-dashboard__animation_box\"></div>\n\t\t`;\n\n\t\tconst animation = Lottie.loadAnimation({\n\t\t\tcontainer: animationBox,\n\t\t\trenderer: 'svg',\n\t\t\tloop: true,\n\t\t\tautoplay: false,\n\t\t\tanimationData: SkeletonAnimation,\n\t\t});\n\n\t\tanimation.play();\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"biconnector-dashboard__animation\">\n\t\t\t\t<div class=\"biconnector-dashboard__hint_container\"></div>\n\t\t\t\t${animationBox}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#changeContent(innerContent: HTMLElement): void\n\t{\n\t\tif (!this.container)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst hint = this.container.querySelector('.biconnector-dashboard__hint_container');\n\t\tDom.clean(hint);\n\t\tDom.append(innerContent, hint);\n\t}\n\n\t#getContent(): HTMLElement\n\t{\n\t\tif (this.supersetStatus === 'LIMIT_EXCEEDED')\n\t\t{\n\t\t\treturn this.#getLimitExceededHint();\n\t\t}\n\n\t\tif (this.supersetStatus === 'ERROR')\n\t\t{\n\t\t\treturn this.#getUnavailableSupersetHint();\n\t\t}\n\n\t\tif (\n\t\t\tthis.status === DashboardManager.DASHBOARD_STATUS_LOAD\n\t\t\t|| this.status === DashboardManager.DASHBOARD_STATUS_NOT_INSTALLED\n\t\t)\n\t\t{\n\t\t\treturn this.#getLoadingContent();\n\t\t}\n\n\t\tif (this.status === DashboardManager.DASHBOARD_STATUS_FAILED)\n\t\t{\n\t\t\treturn this.#getFailedContent();\n\t\t}\n\n\t\treturn '';\n\t}\n\n\t#getLoadingContent(): HTMLElement\n\t{\n\t\tconst loadingAnimationContainer = Tag.render`\n\t\t\t<div class=\"biconnector-dashboard__loading-animation\"></div>\n\t\t`;\n\n\t\tLottie.loadAnimation({\n\t\t\tcontainer: loadingAnimationContainer,\n\t\t\trenderer: 'svg',\n\t\t\tloop: false,\n\t\t\tautoplay: true,\n\t\t\tanimationData: DashboardLoadingAnimation,\n\t\t});\n\n\t\tlet descriptionBlock = '';\n\t\tif (this.isFirstStartup)\n\t\t{\n\t\t\tconst description: string = this.dashboardType === 'CUSTOM'\n\t\t\t\t? Loc.getMessage('SUPERSET_DASHBOARD_DETAIL_HINT_DESC_CREATING')\n\t\t\t\t: Loc.getMessage('SUPERSET_DASHBOARD_DETAIL_HINT_DESC_MSGVER_2')\n\t\t\t;\n\n\t\t\tdescriptionBlock = Tag.render`\n\t\t\t\t<div class=\"biconnector-dashboard__hint_desc\">\n\t\t\t\t\t${description.replaceAll('[br]', '<br>')}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\tconst title: string = this.dashboardType === 'CUSTOM'\n\t\t\t? Loc.getMessage('SUPERSET_DASHBOARD_DETAIL_HINT_TITLE_CREATING')\n\t\t\t: Loc.getMessage('SUPERSET_DASHBOARD_DETAIL_HINT_TITLE_MSGVER_2')\n\t\t;\n\n\t\tconst container = Tag.render`\n\t\t\t<div class=\"biconnector-dashboard__hint biconnector-dashboard__hint__loading\">\n\t\t\t\t${loadingAnimationContainer}\n\t\t\t\t<div class=\"biconnector-dashboard__hint_title\">\n\t\t\t\t\t${title.replace('[dots]', '<span class=\"biconnector-dashboard__dots-animation\"></span>')}\n\t\t\t\t</div>\n\t\t\t\t${descriptionBlock}\n\t\t\t</div>\n\t\t`;\n\n\t\tconst dotsContainer = container.querySelector('.biconnector-dashboard__dots-animation');\n\t\tLottie.loadAnimation({\n\t\t\tcontainer: dotsContainer,\n\t\t\trenderer: 'svg',\n\t\t\tloop: true,\n\t\t\tautoplay: true,\n\t\t\tanimationData: DotsAnimation,\n\t\t});\n\n\t\treturn container;\n\t}\n\n\t#getFailedContent(): HTMLElement\n\t{\n\t\tconst reloadBtn = Tag.render`\n\t\t\t<button class=\"ui-btn ui-btn-sm biconnector-dashboard__error_btn ui-btn-primary\">\n\t\t\t\t${Loc.getMessage('SUPERSET_DASHBOARD_DETAIL_ERROR_RELOAD_BTN')}\n\t\t\t</button>\n\t\t`;\n\n\t\treloadBtn.onclick = () => {\n\t\t\tDom.addClass(reloadBtn, 'ui-btn-wait');\n\t\t\treloadBtn.setAttribute('disabled', 'true');\n\t\t\tthis.#dashboardManager.restartDashboardImport(this.dashboardId).then(\n\t\t\t\t(response) => {\n\t\t\t\t\tconst dashboardIds = response?.data?.restartedDashboardIds;\n\t\t\t\t\tif (!dashboardIds)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (const restartedDashboardId of dashboardIds)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (Number(restartedDashboardId) === this.dashboardId)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.#changeContent(this.#getLoadingContent());\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t);\n\t\t};\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"biconnector-dashboard__hint biconnector-dashboard__hint__error\">\n\t\t\t\t<div class=\"biconnector-dashboard__error__logo-wrapper\">\n\t\t\t\t\t${this.#getErrorLogo()}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"biconnector-dashboard__hint_desc biconnector-dashboard__error_desc\">\n\t\t\t\t\t${Loc.getMessage('SUPERSET_DASHBOARD_DETAIL_ERROR_DESC')}\n\t\t\t\t</div>\n\t\t\t\t${reloadBtn}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getUnavailableSupersetHint(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"biconnector-dashboard__hint biconnector-dashboard__hint__unavailable\">\n\t\t\t\t<div class=\"biconnector-dashboard__error__logo-wrapper\">\n\t\t\t\t\t${this.#getErrorLogo()}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"biconnector-dashboard__hint_title\">\n\t\t\t\t\t${Loc.getMessage('SUPERSET_DASHBOARD_DETAIL_HINT_TITLE_UNAVAILABLE')}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"biconnector-dashboard__hint_desc\">\n\t\t\t\t\t${Loc.getMessage('SUPERSET_DASHBOARD_DETAIL_HINT_DESC_UNAVAILABLE')}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getErrorLogo(): HTMLElement {\n\t\treturn Tag.render`\n\t\t\t<div class=\"biconnector-dashboard__error__logo\"></div>\n\t\t`;\n\t}\n\n\t#getLimitExceededHint(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"biconnector-dashboard__hint biconnector-dashboard__limit__exceeded__warning\">\n\t\t\t\t<div class=\"biconnector-dashboard__error__logo-wrapper\">\n\t\t\t\t\t${this.#getWarningLogo()}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"biconnector-dashboard__hint_title\">\n\t\t\t\t\t${Loc.getMessage('SUPERSET_DASHBOARD_DETAIL_HINT_TITLE_LIMIT_EXCEEDED')}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"biconnector-dashboard__hint_desc biconnector-dashboard__limit__exceeded__warning_desc\">\n\t\t\t\t\t${Loc.getMessage('SUPERSET_DASHBOARD_DETAIL_HINT_DESC_LIMIT_EXCEEDED_MSGVER_1').replaceAll('[br]', '<br>')}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getWarningLogo(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"biconnector-dashboard__limit__exceeded__warning__logo\"></div>\n\t\t`;\n\t}\n}\n","import { DetailInstance } from './detail-instance';\nimport type { DetailConfig } from './type/detail-config';\nimport type { SkeletonConfig } from './type/skeleton-config';\nimport { Skeleton } from './skeleton';\n\nexport class Detail\n{\n\tstatic create(config: DetailConfig): DetailInstance\n\t{\n\t\tnew DetailInstance(config);\n\t}\n\n\tstatic createSkeleton(config: SkeletonConfig): Skeleton\n\t{\n\t\tnew Skeleton(config);\n\t}\n}\n"],"names":["ChatSelector","props","show","Dialog","id","multiple","targetNode","offsetTop","context","popupOptions","className","entities","header","footer","footerOptions","containerClass","enableSearch","dropdownMode","showAvatars","compactView","dynamicLoad","events","event","dialog","getTarget","deselectAll","item","selectedItems","values","next","value","Item","Type","isFunction","onSend","showLoader","notificationStack","BX","UI","Notification","Stack","offsetX","offsetY","then","response","Ajax","runComponentAction","mode","data","dialogId","content","dashboardName","fileExtension","hideLoader","hide","Center","notify","Loc","getMessage","stack","autoHideDelay","ApacheSupersetAnalytics","sendAnalytics","status","type","dashboardType","p1","buildAppIdForAnalyticRequest","appId","p2","dashboardId","p3","console","error","errors","message","Tag","render","bind","options","searchableChatTypes","fillDialog","filters","limit","DetailInstance","config","_classPrivateMethodInitSpec","_classPrivateFieldInitSpec","document","getElementById","appNodeId","isDomNode","errorMsg","Error","DashboardManager","canExport","canEdit","dashboardEmbeddedParams","embeddedDebugMode","querySelector","_classPrivateMethodGet","BIConnector","LimitLockPopup","c_element","analyticSource","toLowerCase","analyticScope","buildScopeForAnalyticRequest","p4","isUseExternalDatasets","EventEmitter","subscribe","Dom","clean","ApacheSuperset","Dashboard","Detail","createSkeleton","container","DASHBOARD_STATUS_LOAD","credentials","historyUrl","embeddedUrl","top","window","history","pushState","embeddedParams","dashboardParams","uuid","supersetDomain","mountPoint","fetchGuestToken","guestToken","debug","dashboardUiConfig","hideTitle","hideTab","hideChartControls","expanded","visible","nativeFilters","urlParams","ApacheSupersetEmbeddedLoader","embedDashboard","Event","unbindAll","dashboardInfo","editLink","editUrl","processEditDashboard","popupType","c_sub_section","slider","SidePanel","Instance","getSliderByWindow","subscribeOnce","Main","gridManager","forEach","grid","instance","getId","reload","addClass","removeClass","setAttribute","removeAttribute","downloadButton","downloadMenu","Menu","closeByEsc","closeIcon","cacheable","angle","position","offsetLeft","parseInt","getComputedStyle","marginLeft","offsetWidth","bindElement","autoHide","items","text","title","onclick","menuItem","disable","loader","Loader","target","layout","size","getScreenshot","imageData","dashboardTitle","Text","decode","datetime","DateTimeFormat","format","replace","enable","getPdf","onAfterShow","style","popupWindow","element","shareButton","menuWindow","close","moreButton","selector","offset","toFrontOnShow","onBeforeClose","getMenuItems","closeSubMenu","popupContainer","getPopupWindow","getPopupContainer","overHeight","getBoundingClientRect","offsetHeight","innerHeight","scrollTo","scrollY","behavior","result","ApacheSupersetFeedbackForm","requestIntegrationFormOpen","feedbackFormOpen","push","getMenuItem","exportDashboard","base64Data","fileName","fileType","byteCharacters","atob","byteNumbers","Array","from","length","i","codePointAt","byteArray","Uint8Array","blob","Blob","link","createElement","href","URL","createObjectURL","download","append","body","click","remove","Skeleton","supersetStatus","isFirstStartup","periodicReload","subscribeOnEvents","installDashboard","setInterval","location","PULL","extendWatch","eventName","eventData","getData","dashboardList","postMessage","dashboard","Number","DASHBOARD_STATUS_DRAFT","DASHBOARD_STATUS_READY","DASHBOARD_STATUS_FAILED","clearInterval","animationBox","animation","Lottie","loadAnimation","renderer","loop","autoplay","animationData","SkeletonAnimation","play","innerContent","hint","DASHBOARD_STATUS_NOT_INSTALLED","loadingAnimationContainer","DashboardLoadingAnimation","descriptionBlock","description","replaceAll","dotsContainer","DotsAnimation","reloadBtn","restartDashboardImport","dashboardIds","restartedDashboardIds","restartedDashboardId"],"mappings":"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;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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"}