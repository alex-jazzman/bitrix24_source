(function(e,t,n,r,i,a){"use strict";var o,l;function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){babelHelpers.defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e,t){E(e,t);t.add(e)}function d(e,t,n){E(e,t);t.set(e,n)}function E(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function f(e,t,n){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return n}var v=new WeakMap;var h=new WeakMap;var g=new WeakMap;var p=new WeakMap;var I=new WeakSet;var S=new WeakSet;var b=new WeakSet;var T=new WeakSet;var _=new WeakSet;var C=new WeakSet;var O=new WeakSet;var B=new WeakSet;var w=function(){function e(r){var i,a;babelHelpers.classCallCheck(this,e);u(this,B);u(this,O);u(this,C);u(this,_);u(this,T);u(this,b);u(this,S);u(this,I);d(this,v,{writable:true,value:void 0});d(this,h,{writable:true,value:void 0});d(this,g,{writable:true,value:void 0});d(this,p,{writable:true,value:"/bi/dataset/"});babelHelpers.classPrivateFieldSet(this,v,(i=BX.Main.gridManager.getById(r.gridId))===null||i===void 0?void 0:i.instance);babelHelpers.classPrivateFieldSet(this,h,BX.Main.filterManager.getById(r.gridId));babelHelpers.classPrivateFieldSet(this,g,(a=r.sourceTitleList)!==null&&a!==void 0?a:{});f(this,S,A).call(this);f(this,I,P).call(this);t.EditableColumnManager.init(r.gridId,[{name:"DESCRIPTION",saveEndpoint:"biconnector.externalsource.source.updateComment",onValueCheck:function e(){return true},onSave:function e(){BX.UI.Notification.Center.notify({content:n.Text.encode(n.Loc.getMessage("BICONNECTOR_SUPERSET_EXTERNAL_SOURCE_GRID_COMMENT_UPDATED"))})}}])}babelHelpers.createClass(e,[{key:"getGrid",value:function e(){return babelHelpers.classPrivateFieldGet(this,v)}},{key:"getFilter",value:function e(){return babelHelpers.classPrivateFieldGet(this,h)}},{key:"handleCreatedByClick",value:function e(t){this.handleDatasetFilterChange(s({fieldId:"CREATED_BY_ID"},t))}},{key:"handleDatasetFilterChange",value:function e(t){var n,r;var i=this.getFilter().getFilterFieldsValues();var a=(n=i[t.fieldId])!==null&&n!==void 0?n:[];var o=(r=i["".concat(t.fieldId,"_label")])!==null&&r!==void 0?r:[];if(t.IS_FILTERED){a=a.filter((function(e){return parseInt(e,10)!==t.ID}));o=o.filter((function(e){return e!==t.TITLE}))}else if(!a.includes(t.ID)){a.push(t.ID);o.push(t.TITLE)}var l=this.getFilter().getApi();var c={};c[t.fieldId]=a;c["".concat(t.fieldId,"_label")]=o;l.extendFilter(c);l.apply()}},{key:"openSourceDetail",value:function e(t,r){var i="";var a=0;if(r==="BI"){i=new n.Uri("/bitrix/components/bitrix/biconnector.externalconnection/slider.php?sourceId=".concat(t));a=564}else if(r==="CRM"){i=new n.Uri("/crm/tracking/source/edit/".concat(t,"/"));a=900}else{return}BX.SidePanel.Instance.open(i.toString(),{width:a,allowChangeHistory:false,cacheable:false,events:{onClose:BX.BIConnector.TrackingAnalyticsHandler.handleSliderClose}})}},{key:"openCreateSourceSlider",value:function e(){var t=new n.Uri("/bitrix/components/bitrix/biconnector.apachesuperset.source.connect.list/slider.php");BX.SidePanel.Instance.open(t.toString(),{width:900,allowChangeHistory:false,cacheable:false})}},{key:"changeActivitySource",value:function e(t,r){var i=this;n.ajax.runAction("biconnector.externalsource.source.changeActivity",{data:{id:t,moduleId:r}}).then((function(){i.getGrid().reload()}))["catch"]((function(e){if(e.errors){f(i,B,k).call(i,e.errors)}}))}},{key:"deleteSource",value:function e(t,r){var i=this;n.ajax.runAction("biconnector.externalsource.source.validateBeforeDelete",{data:{id:t,moduleId:r}}).then((function(){f(i,b,D).call(i,t,r)}))["catch"]((function(e){if(e.errors){if(e.errors.some((function(e){var t=e.code;return t===409}))){f(i,_,R).call(i,t).show()}else{f(i,B,k).call(i,e.errors)}}}))}}]);return e}();function P(){var e=this;a.EventEmitter.subscribe("Grid::updated",(function(){f(e,S,A).call(e)}));a.EventEmitter.subscribe("SidePanel.Slider:onMessage",(function(t){var n=t.getData(),r=babelHelpers.slicedToArray(n,1),i=r[0];var a=i.getEventId();if(a==="BIConnector:ExternalConnectionGrid:reload"||a==="BIConnector:ExternalConnection:onConnectionSave"){babelHelpers.classPrivateFieldGet(e,v).reload()}}))}function A(){var e=BX.UI.Hint.createInstance({popupParameters:{autoHide:true}});e.init(babelHelpers.classPrivateFieldGet(this,v).getContainer())}function D(e,t){var a=this;var o=new i.Dialog({content:f(this,T,y).call(this),centerButtons:[new r.Button({color:r.AirButtonStyle.FILLED,useAirDesign:true,text:n.Loc.getMessage("BICONNECTOR_SUPERSET_EXTERNAL_SOURCE_GRID_DELETE_POPUP_CAPTION_YES"),onclick:function r(i){i.setWaiting();n.ajax.runAction("biconnector.externalsource.source.delete",{data:{id:e,moduleId:t}}).then((function(){a.getGrid().reload();o.hide()}))["catch"]((function(e){o.hide();if(e.errors){f(a,B,k).call(a,e.errors)}}))}}),new r.Button({text:n.Loc.getMessage("BICONNECTOR_SUPERSET_EXTERNAL_SOURCE_GRID_DELETE_POPUP_CAPTION_NO"),size:r.ButtonSize.LARGE,style:r.AirButtonStyle.PLAIN,useAirDesign:true,onclick:function e(){return o.hide()}})],hasOverlay:true});o.show()}function y(){return n.Tag.render(o||(o=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="biconnector-delete-source-popup-content">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),n.Loc.getMessage("BICONNECTOR_SUPERSET_EXTERNAL_SOURCE_GRID_DELETE_POPUP_TITLE"))}function R(e){var t=this;var a=new i.Dialog({title:n.Loc.getMessage("BICONNECTOR_SUPERSET_EXTERNAL_SOURCE_WITH_DATASET_DELETE_DIALOG_TITLE"),content:f(this,C,L).call(this),centerButtons:[new r.Button({text:n.Loc.getMessage("BICONNECTOR_SUPERSET_EXTERNAL_SOURCE_WITH_DATASET_DELETE_DIALOG_OK_CAPTION"),size:r.ButtonSize.LARGE,style:r.AirButtonStyle.FILLED,useAirDesign:true,onclick:function n(){a.hide();f(t,O,N).call(t,e)}}),new r.Button({text:n.Loc.getMessage("BICONNECTOR_SUPERSET_EXTERNAL_SOURCE_WITH_DATASET_DELETE_DIALOG_CANCEL_CAPTION"),size:r.ButtonSize.LARGE,style:r.AirButtonStyle.PLAIN,useAirDesign:true,onclick:function e(){return a.hide()}})],hasOverlay:true,width:446});return a}function L(){return n.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="biconnector-delete-source-with-dataset-dialog-content">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),n.Loc.getMessage("BICONNECTOR_SUPERSET_EXTERNAL_SOURCE_WITH_DATASET_DELETE_DIALOG_DESCRIPTION"))}function N(e){var t=this;BX.SidePanel.Instance.open(babelHelpers.classPrivateFieldGet(this,p),{allowChangeHistory:false,cacheable:false,events:{onOpenComplete:function n(r){var i=r.getSlider?r.getSlider():BX.SidePanel.Instance.getTopSlider();if(!i){return}var a=i.getWindow();var o=function n(){if(a&&a.BX&&a.BX.Main&&a.BX.Main.filterManager){var r=a.BX.Main.filterManager.getById("biconnector_superset_external_dataset_grid");if(r&&r instanceof a.BX.Main.Filter){var i=r.getApi();i.setFields({"SOURCE.ID":String(e),"SOURCE.ID_label":babelHelpers.classPrivateFieldGet(t,g)[e]});i.apply();return}}setTimeout(n,100)};o()}}})}function k(e){if(e[0]&&e[0].message){BX.UI.Notification.Center.notify({content:n.Text.encode(e[0].message)})}}n.Reflection.namespace("BX.BIConnector").ExternalSourceManager=w})(this.window=this.window||{},BX.BIConnector.Grid,BX,BX.UI,BX.UI.System,BX.Event);
//# sourceMappingURL=script.map.js