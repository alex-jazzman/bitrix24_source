{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { EditableColumnManager } from 'biconnector.grid.editable-columns';\nimport { Reflection, Uri, Text, Loc, ajax as Ajax, Tag } from 'main.core';\nimport { AirButtonStyle, Button, ButtonSize } from 'ui.buttons';\nimport { Dialog } from 'ui.system.dialog';\nimport { EventEmitter } from 'main.core.events';\nimport 'ui.alerts';\nimport 'ui.forms';\n\ntype Props = {\n\tgridId: ?string,\n\tsourceTitleList: Object,\n};\n\n/**\n * @namespace BX.BIConnector\n */\nclass ExternalSourceManager\n{\n\t#grid: BX.Main.grid;\n\t#filter: BX.Main.Filter;\n\t#sourceTitleList: Object;\n\n\t#datasetUrl: String = '/bi/dataset/';\n\n\tconstructor(props: Props)\n\t{\n\t\tthis.#grid = BX.Main.gridManager.getById(props.gridId)?.instance;\n\t\tthis.#filter = BX.Main.filterManager.getById(props.gridId);\n\t\tthis.#sourceTitleList = props.sourceTitleList ?? {};\n\t\tthis.#initHints();\n\t\tthis.#subscribeToEvents();\n\n\t\tEditableColumnManager.init(\n\t\t\tprops.gridId,\n\t\t\t[\n\t\t\t\t{\n\t\t\t\t\tname: 'DESCRIPTION',\n\t\t\t\t\tsaveEndpoint: 'biconnector.externalsource.source.updateComment',\n\t\t\t\t\tonValueCheck: () => true,\n\t\t\t\t\tonSave: () => {\n\t\t\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\t\t\tcontent: Text.encode(Loc.getMessage('BICONNECTOR_SUPERSET_EXTERNAL_SOURCE_GRID_COMMENT_UPDATED')),\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t);\n\t}\n\n\t#subscribeToEvents()\n\t{\n\t\tEventEmitter.subscribe('Grid::updated', () => {\n\t\t\tthis.#initHints();\n\t\t});\n\n\t\tEventEmitter.subscribe('SidePanel.Slider:onMessage', (event) => {\n\t\t\tconst [messageEvent] = event.getData();\n\t\t\tconst eventId = messageEvent.getEventId();\n\t\t\tif (\n\t\t\t\teventId === 'BIConnector:ExternalConnectionGrid:reload'\n\t\t\t\t|| eventId === 'BIConnector:ExternalConnection:onConnectionSave'\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.#grid.reload();\n\t\t\t}\n\t\t});\n\t}\n\n\t#initHints(): void\n\t{\n\t\tconst manager = BX.UI.Hint.createInstance({\n\t\t\tpopupParameters: {\n\t\t\t\tautoHide: true,\n\t\t\t},\n\t\t});\n\t\tmanager.init(this.#grid.getContainer());\n\t}\n\n\tgetGrid(): BX.Main.grid\n\t{\n\t\treturn this.#grid;\n\t}\n\n\tgetFilter(): BX.Main.Filter\n\t{\n\t\treturn this.#filter;\n\t}\n\n\thandleCreatedByClick(ownerData: Object)\n\t{\n\t\tthis.handleDatasetFilterChange({\n\t\t\tfieldId: 'CREATED_BY_ID',\n\t\t\t...ownerData,\n\t\t});\n\t}\n\n\thandleDatasetFilterChange(fieldData: Object)\n\t{\n\t\tconst filterFieldsValues = this.getFilter().getFilterFieldsValues();\n\t\tlet currentFilteredField = filterFieldsValues[fieldData.fieldId] ?? [];\n\t\tlet currentFilteredFieldLabel = filterFieldsValues[`${fieldData.fieldId}_label`] ?? [];\n\n\t\tif (fieldData.IS_FILTERED)\n\t\t{\n\t\t\tcurrentFilteredField = currentFilteredField.filter((value) => parseInt(value, 10) !== fieldData.ID);\n\t\t\tcurrentFilteredFieldLabel = currentFilteredFieldLabel.filter((value) => value !== fieldData.TITLE);\n\t\t}\n\t\telse if (!currentFilteredField.includes(fieldData.ID))\n\t\t{\n\t\t\tcurrentFilteredField.push(fieldData.ID);\n\t\t\tcurrentFilteredFieldLabel.push(fieldData.TITLE);\n\t\t}\n\n\t\tconst filterApi = this.getFilter().getApi();\n\t\tconst filterToExtend = {};\n\t\tfilterToExtend[fieldData.fieldId] = currentFilteredField;\n\t\tfilterToExtend[`${fieldData.fieldId}_label`] = currentFilteredFieldLabel;\n\n\t\tfilterApi.extendFilter(filterToExtend);\n\t\tfilterApi.apply();\n\t}\n\n\topenSourceDetail(id: number, moduleId: string): void\n\t{\n\t\tlet sliderLink = '';\n\t\tlet sliderWidth = 0;\n\n\t\tif (moduleId === 'BI')\n\t\t{\n\t\t\tsliderLink = new Uri(`/bitrix/components/bitrix/biconnector.externalconnection/slider.php?sourceId=${id}`);\n\t\t\tsliderWidth = 564;\n\t\t}\n\t\telse if (moduleId === 'CRM')\n\t\t{\n\t\t\tsliderLink = new Uri(`/crm/tracking/source/edit/${id}/`);\n\t\t\tsliderWidth = 900;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tBX.SidePanel.Instance.open(\n\t\t\tsliderLink.toString(),\n\t\t\t{\n\t\t\t\twidth: sliderWidth,\n\t\t\t\tallowChangeHistory: false,\n\t\t\t\tcacheable: false,\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: BX.BIConnector.TrackingAnalyticsHandler.handleSliderClose,\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\t}\n\n\topenCreateSourceSlider()\n\t{\n\t\tconst sliderLink = new Uri('/bitrix/components/bitrix/biconnector.apachesuperset.source.connect.list/slider.php');\n\n\t\tBX.SidePanel.Instance.open(\n\t\t\tsliderLink.toString(),\n\t\t\t{\n\t\t\t\twidth: 900,\n\t\t\t\tallowChangeHistory: false,\n\t\t\t\tcacheable: false,\n\t\t\t},\n\t\t);\n\t}\n\n\tchangeActivitySource(id: number, moduleId: string)\n\t{\n\t\tAjax.runAction('biconnector.externalsource.source.changeActivity', {\n\t\t\tdata: {\n\t\t\t\tid,\n\t\t\t\tmoduleId,\n\t\t\t},\n\t\t})\n\t\t\t.then(() => {\n\t\t\t\tthis.getGrid().reload();\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tif (response.errors)\n\t\t\t\t{\n\t\t\t\t\tthis.#notifyErrors(response.errors);\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\t}\n\n\tdeleteSource(id: number, moduleId: string)\n\t{\n\t\tAjax.runAction('biconnector.externalsource.source.validateBeforeDelete', {\n\t\t\tdata: {\n\t\t\t\tid,\n\t\t\t\tmoduleId,\n\t\t\t},\n\t\t})\n\t\t\t.then(() => {\n\t\t\t\tthis.#showDeleteSourcePopup(id, moduleId);\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tif (response.errors)\n\t\t\t\t{\n\t\t\t\t\tif (response.errors.some(({ code }) => code === 409))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#getDeleteSourceWithDatasetDialog(id).show();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#notifyErrors(response.errors);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\t}\n\n\t#showDeleteSourcePopup(id: number, moduleId: string)\n\t{\n\t\tconst messageBox = new Dialog({\n\t\t\tcontent: this.#getDeleteSourcePopupContent(),\n\t\t\tcenterButtons: [\n\t\t\t\tnew Button({\n\t\t\t\t\tcolor: AirButtonStyle.FILLED,\n\t\t\t\t\tuseAirDesign: true,\n\t\t\t\t\ttext: Loc.getMessage('BICONNECTOR_SUPERSET_EXTERNAL_SOURCE_GRID_DELETE_POPUP_CAPTION_YES'),\n\t\t\t\t\tonclick: (button) => {\n\t\t\t\t\t\tbutton.setWaiting();\n\t\t\t\t\t\tAjax.runAction('biconnector.externalsource.source.delete', {\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\t\tmoduleId,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\tthis.getGrid().reload();\n\t\t\t\t\t\t\t\tmessageBox.hide();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\t\t\tmessageBox.hide();\n\t\t\t\t\t\t\t\tif (response.errors)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.#notifyErrors(response.errors);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t;\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tnew Button({\n\t\t\t\t\ttext: Loc.getMessage('BICONNECTOR_SUPERSET_EXTERNAL_SOURCE_GRID_DELETE_POPUP_CAPTION_NO'),\n\t\t\t\t\tsize: ButtonSize.LARGE,\n\t\t\t\t\tstyle: AirButtonStyle.PLAIN,\n\t\t\t\t\tuseAirDesign: true,\n\t\t\t\t\tonclick: () => messageBox.hide(),\n\t\t\t\t}),\n\t\t\t],\n\t\t\thasOverlay: true,\n\t\t});\n\n\t\tmessageBox.show();\n\t}\n\n\t#getDeleteSourcePopupContent(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"biconnector-delete-source-popup-content\">\n\t\t\t\t${Loc.getMessage('BICONNECTOR_SUPERSET_EXTERNAL_SOURCE_GRID_DELETE_POPUP_TITLE')}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getDeleteSourceWithDatasetDialog(id: number): Dialog\n\t{\n\t\tconst deleteSourcePopupInstance = new Dialog({\n\t\t\ttitle: Loc.getMessage('BICONNECTOR_SUPERSET_EXTERNAL_SOURCE_WITH_DATASET_DELETE_DIALOG_TITLE'),\n\t\t\tcontent: this.#getDeleteSourceWithDatasetDialogContent(),\n\t\t\tcenterButtons: [\n\t\t\t\tnew Button({\n\t\t\t\t\ttext: Loc.getMessage('BICONNECTOR_SUPERSET_EXTERNAL_SOURCE_WITH_DATASET_DELETE_DIALOG_OK_CAPTION'),\n\t\t\t\t\tsize: ButtonSize.LARGE,\n\t\t\t\t\tstyle: AirButtonStyle.FILLED,\n\t\t\t\t\tuseAirDesign: true,\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tdeleteSourcePopupInstance.hide();\n\t\t\t\t\t\tthis.#openDatasetSlider(id);\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tnew Button({\n\t\t\t\t\ttext: Loc.getMessage('BICONNECTOR_SUPERSET_EXTERNAL_SOURCE_WITH_DATASET_DELETE_DIALOG_CANCEL_CAPTION'),\n\t\t\t\t\tsize: ButtonSize.LARGE,\n\t\t\t\t\tstyle: AirButtonStyle.PLAIN,\n\t\t\t\t\tuseAirDesign: true,\n\t\t\t\t\tonclick: () => deleteSourcePopupInstance.hide(),\n\t\t\t\t}),\n\t\t\t],\n\t\t\thasOverlay: true,\n\t\t\twidth: 446,\n\t\t});\n\n\t\treturn deleteSourcePopupInstance;\n\t}\n\n\t#getDeleteSourceWithDatasetDialogContent(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"biconnector-delete-source-with-dataset-dialog-content\">\n\t\t\t\t${Loc.getMessage('BICONNECTOR_SUPERSET_EXTERNAL_SOURCE_WITH_DATASET_DELETE_DIALOG_DESCRIPTION')}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#openDatasetSlider(id: number): void\n\t{\n\t\tBX.SidePanel.Instance.open(\n\t\t\tthis.#datasetUrl,\n\t\t\t{\n\t\t\t\tallowChangeHistory: false,\n\t\t\t\tcacheable: false,\n\t\t\t\tevents: {\n\t\t\t\t\tonOpenComplete: (event) => {\n\t\t\t\t\t\tconst slider = event.getSlider ? event.getSlider() : BX.SidePanel.Instance.getTopSlider();\n\n\t\t\t\t\t\tif (!slider)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst sliderWindow = slider.getWindow();\n\t\t\t\t\t\tconst tryApplyFilter = () => {\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\tsliderWindow\n\t\t\t\t\t\t\t\t&& sliderWindow.BX\n\t\t\t\t\t\t\t\t&& sliderWindow.BX.Main\n\t\t\t\t\t\t\t\t&& sliderWindow.BX.Main.filterManager\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconst filter = sliderWindow.BX.Main.filterManager.getById('biconnector_superset_external_dataset_grid');\n\t\t\t\t\t\t\t\tif (filter && (filter instanceof sliderWindow.BX.Main.Filter))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tconst filterApi = filter.getApi();\n\t\t\t\t\t\t\t\t\tfilterApi.setFields({\n\t\t\t\t\t\t\t\t\t\t'SOURCE.ID': String(id),\n\t\t\t\t\t\t\t\t\t\t'SOURCE.ID_label': this.#sourceTitleList[id],\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tfilterApi.apply();\n\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tsetTimeout(tryApplyFilter, 100);\n\t\t\t\t\t\t};\n\t\t\t\t\t\ttryApplyFilter();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\t}\n\n\t#notifyErrors(errors: Array): void\n\t{\n\t\tif (errors[0] && errors[0].message)\n\t\t{\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tcontent: Text.encode(errors[0].message),\n\t\t\t});\n\t\t}\n\t}\n}\n\nReflection.namespace('BX.BIConnector').ExternalSourceManager = ExternalSourceManager;\n"],"names":["ExternalSourceManager","props","BX","Main","gridManager","getById","gridId","instance","filterManager","sourceTitleList","EditableColumnManager","init","name","saveEndpoint","onValueCheck","onSave","UI","Notification","Center","notify","content","Text","encode","Loc","getMessage","ownerData","handleDatasetFilterChange","fieldId","fieldData","filterFieldsValues","getFilter","getFilterFieldsValues","currentFilteredField","currentFilteredFieldLabel","IS_FILTERED","filter","value","parseInt","ID","TITLE","includes","push","filterApi","getApi","filterToExtend","extendFilter","apply","id","moduleId","sliderLink","sliderWidth","Uri","SidePanel","Instance","open","toString","width","allowChangeHistory","cacheable","events","onClose","BIConnector","TrackingAnalyticsHandler","handleSliderClose","Ajax","runAction","data","then","getGrid","reload","response","errors","some","code","show","EventEmitter","subscribe","event","getData","messageEvent","eventId","getEventId","manager","Hint","createInstance","popupParameters","autoHide","getContainer","messageBox","Dialog","centerButtons","Button","color","AirButtonStyle","FILLED","useAirDesign","text","onclick","button","setWaiting","hide","size","ButtonSize","LARGE","style","PLAIN","hasOverlay","Tag","render","deleteSourcePopupInstance","title","onOpenComplete","slider","getSlider","getTopSlider","sliderWindow","getWindow","tryApplyFilter","Filter","setFields","String","setTimeout","message","Reflection","namespace"],"mappings":"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"}