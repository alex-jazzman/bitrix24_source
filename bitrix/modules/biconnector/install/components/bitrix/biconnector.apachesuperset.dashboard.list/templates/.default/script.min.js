(function(e,t,a,r,i,n,s,l,o,d,c,u,b,v,p,h){"use strict";var g,D,f,_,S,E,T,A;function I(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function y(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?I(Object(a),!0).forEach((function(t){babelHelpers.defineProperty(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):I(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function R(e,t){var a=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=O(e))||t&&e&&typeof e.length==="number"){if(a)e=a;var r=0;var i=function e(){};return{s:i,n:function t(){if(r>=e.length)return{done:true};return{done:false,value:e[r++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n=true,s=false,l;return{s:function t(){a=a.call(e)},n:function e(){var t=a.next();n=t.done;return t},e:function e(t){s=true;l=t},f:function e(){try{if(!n&&a["return"]!=null)a["return"]()}finally{if(s)throw l}}}}function O(e,t){if(!e)return;if(typeof e==="string")return P(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor)a=e.constructor.name;if(a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return P(e,t)}function P(e,t){if(t==null||t>e.length)t=e.length;for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function C(e,t){m(e,t);t.add(e)}function B(e,t,a){m(e,t);t.set(e,a)}function m(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function G(e,t,a){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return a}var H=new WeakMap;var F=new WeakMap;var L=new WeakMap;var M=new WeakMap;var w=new WeakMap;var U=new WeakMap;var N=new WeakSet;var k=new WeakSet;var X=new WeakSet;var x=new WeakSet;var q=new WeakSet;var W=new WeakSet;var j=new WeakSet;var z=new WeakSet;var Y=new WeakSet;var V=new WeakSet;var K=new WeakSet;var J=function(){function e(t){var a;babelHelpers.classCallCheck(this,e);C(this,K);C(this,V);C(this,Y);C(this,z);C(this,j);C(this,W);C(this,q);C(this,x);C(this,X);C(this,k);C(this,N);B(this,H,{writable:true,value:null});B(this,F,{writable:true,value:void 0});B(this,L,{writable:true,value:void 0});B(this,M,{writable:true,value:void 0});B(this,w,{writable:true,value:void 0});B(this,U,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,H,new i.DashboardManager);babelHelpers.classPrivateFieldSet(this,U,t);babelHelpers.classPrivateFieldSet(this,F,(a=BX.Main.gridManager.getById(t.gridId))===null||a===void 0?void 0:a.instance);babelHelpers.classPrivateFieldSet(this,L,BX.Main.filterManager.getById(t.gridId));G(this,N,Q).call(this);G(this,q,te).call(this);G(this,k,$).call(this)}babelHelpers.createClass(e,[{key:"onUpdatedDashboardBatchStatus",value:function e(t){var a=R(t),r;try{for(a.s();!(r=a.n()).done;){var i=r.value;this.updateDashboardStatus(i.id,i.status)}}catch(e){a.e(e)}finally{a.f()}}},{key:"getGrid",value:function e(){return babelHelpers.classPrivateFieldGet(this,F)}},{key:"getFilter",value:function e(){return babelHelpers.classPrivateFieldGet(this,L)}},{key:"showLoginPopup",value:function e(a){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"unknown";if(!t.Type.isNumber(a.dashboardId)||!["CUSTOM","MARKET","SYSTEM"].includes(a.type)||!t.Type.isStringFilled(a.editUrl)){console.error("SupersetDashboardGridManager: showLoginPopup called with invalid params",a);return}var i=this.getGrid();if(a.type==="CUSTOM"){i.tableFade()}babelHelpers.classPrivateFieldGet(this,H).processEditDashboard({id:a.dashboardId,type:a.type,editLink:a.editUrl},(function(){i.tableUnfade()}),(function(e){l.ApacheSupersetAnalytics.sendAnalytics("edit","report_edit",{c_sub_section:e,c_element:r,type:a.type.toLowerCase(),p1:l.ApacheSupersetAnalytics.buildAppIdForAnalyticRequest(a.appId),p2:a.dashboardId,status:"success"})}),(function(e){l.ApacheSupersetAnalytics.sendAnalytics("edit","report_edit",{c_sub_section:e,c_element:r,type:a.type.toLowerCase(),p1:l.ApacheSupersetAnalytics.buildAppIdForAnalyticRequest(a.appId),p2:a.dashboardId,status:"error"})}))}},{key:"showCreationMenu",value:function e(r){var i=this;var n=a.MenuManager.getMenuById("biconnector-creation-menu");if(n){n.close();return}var s=[];if(babelHelpers.classPrivateFieldGet(this,U).isAvailableDashboardCreation){s.push({text:t.Loc.getMessage("BICONNECTOR_APACHE_SUPERSET_DASHBOARD_LIST_MENU_ITEM_NEW_DASHBOARD"),onclick:function e(){i.openCreationSlider();l.close()}})}if(babelHelpers.classPrivateFieldGet(this,U).isAvailableGroupCreation){s.push({text:t.Loc.getMessage("BICONNECTOR_APACHE_SUPERSET_DASHBOARD_LIST_MENU_ITEM_NEW_GROUP"),onclick:function e(){i.showCreationGroupPopup();l.close()},disabled:G(this,W,ae).call(this)})}s.push({text:t.Loc.getMessage("BICONNECTOR_APACHE_SUPERSET_DASHBOARD_LIST_MENU_ITEM_CREATE_DASHBOARD"),onclick:function e(){c.ApacheSupersetMarketManager.openMarket(babelHelpers.classPrivateFieldGet(i,U).isMarketExists,babelHelpers.classPrivateFieldGet(i,U).marketUrl,"menu");l.close()}});var l=a.MenuManager.create({id:"biconnector-creation-menu",closeByEsc:false,closeIcon:false,cacheable:false,angle:true,offsetLeft:20,items:s,autoHide:true,bindElement:r.target});l.show()}},{key:"restartDashboardLoad",value:function e(a){var r=this;var n=babelHelpers.classPrivateFieldGet(this,F).getRows().getById(a);if(n){var s=n.node.querySelector("#restart-dashboard-load-btn");if(t.Type.isDomNode(s)){var l=s.getAttribute("disabled");if(l){return}s.setAttribute("disabled","true");t.Dom.addClass(s,"dashboard-status-label-error-btn__loading")}}babelHelpers.classPrivateFieldGet(this,H).restartDashboardImport(a).then((function(e){var t;var a=e===null||e===void 0?void 0:(t=e.data)===null||t===void 0?void 0:t.restartedDashboardIds;if(!a){return}var n=R(a),s;try{for(n.s();!(s=n.n()).done;){var l=s.value;r.updateDashboardStatus(l,i.DashboardManager.DASHBOARD_STATUS_LOAD)}}catch(e){n.e(e)}finally{n.f()}}))["catch"]()}},{key:"updateDashboardStatus",value:function e(a,r){var n=this;var s=babelHelpers.classPrivateFieldGet(this,F).getRows().getById(a);if(s){var l=s.node.querySelector(".dashboard-status-label-wrapper");var o=l.querySelector(".dashboard-status-label");var d=l.querySelector("#restart-dashboard-load-btn");var c="";var u="";switch(r){case i.DashboardManager.DASHBOARD_STATUS_READY:setTimeout((function(){return babelHelpers.classPrivateFieldGet(n,F).updateRow(a)}),500);return;case i.DashboardManager.DASHBOARD_STATUS_DRAFT:c="ui-label-default";u=t.Loc.getMessage("BICONNECTOR_SUPERSET_DASHBOARD_GRID_STATUS_DRAFT");break;case i.DashboardManager.DASHBOARD_STATUS_LOAD:c="ui-label-primary";u=t.Loc.getMessage("BICONNECTOR_SUPERSET_DASHBOARD_GRID_STATUS_LOAD");break;case i.DashboardManager.DASHBOARD_STATUS_FAILED:c="ui-label-danger";u=t.Loc.getMessage("BICONNECTOR_SUPERSET_DASHBOARD_GRID_STATUS_FAILED");break;case i.DashboardManager.DASHBOARD_STATUS_COMPUTED_NOT_LOAD:c="ui-label-danger";u=t.Loc.getMessage("BICONNECTOR_SUPERSET_DASHBOARD_GRID_STATUS_NOT_LOAD");break}if(babelHelpers.classPrivateFieldGet(this,U).supersetStatus==="LIMIT_EXCEEDED"){c="ui-label-danger";u=t.Loc.getMessage("BICONNECTOR_SUPERSET_DASHBOARD_GRID_STATUS_NOT_LOAD")}if(c===""){return}if(d){d.remove()}if(r===i.DashboardManager.DASHBOARD_STATUS_FAILED){var b=this.createReloadBtn(a);t.Dom.append(b,l)}var v=["ui-label-lightgreen","ui-label-default","ui-label-primary","ui-label-danger"];t.Dom.addClass(o,c);v.forEach((function(e){if(e!==c){t.Dom.removeClass(o,e)}}));o.querySelector("span").innerText=u}}},{key:"createReloadBtn",value:function e(a){return t.Tag.render(g||(g=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div id="restart-dashboard-load-btn" onclick="BX.BIConnector.SupersetDashboardGridManager.Instance.restartDashboardLoad(',')" class="dashboard-status-label-error-btn">\n\t\t\t\t<div class="ui-icon-set --refresh-5 dashboard-status-label-error-icon"></div>\n\t\t\t</div>\n\t\t'])),a)}},{key:"duplicateDashboard",value:function e(a){var r=this;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var n=this.getGrid();n.tableFade();return babelHelpers.classPrivateFieldGet(this,H).duplicateDashboard(a).then((function(e){var s=n.getRealtime();var o=e.data.dashboard;var d={id:o.id,columns:o.columns,actions:o.actions};var c=babelHelpers.classPrivateFieldGet(r,F).getRows().getRowsByGroupId("D").find((function(e){return!t.Dom.hasClass(e.node,"biconnector-dashboard-pinned")}));if(c){d.insertBefore=c===null||c===void 0?void 0:c.getId()}else{d.insertAfter=0}s.addRow(d);var u=babelHelpers.classPrivateFieldGet(r,F).getRows().getById(o.id).node;u.setAttribute("data-group-id","D");var b=n.getParam("EDITABLE_DATA");if(BX.type.isPlainObject(b)){b[o.id]={TITLE:o.title}}n.tableUnfade();var v=n.getCounterTotal().querySelector(".main-grid-panel-content-text");v.textContent++;G(r,k,$).call(r);BX.UI.Notification.Center.notify({content:t.Loc.getMessage("BICONNECTOR_SUPERSET_DASHBOARD_GRID_COPY_NOTIFICATION_ADDED")});if(i!==null){l.ApacheSupersetAnalytics.sendAnalytics("edit","report_copy",{type:i.type,p1:l.ApacheSupersetAnalytics.buildAppIdForAnalyticRequest(i.appId),p2:a,status:"success",c_element:i.from})}}))["catch"]((function(e){n.tableUnfade();if(e.errors){G(r,j,re).call(r,e.errors)}if(i!==null){l.ApacheSupersetAnalytics.sendAnalytics("edit","report_copy",{type:i.type,p1:l.ApacheSupersetAnalytics.buildAppIdForAnalyticRequest(i.appId),p2:a,status:"error",c_element:i.from})}}))}},{key:"exportDashboard",value:function e(t){var a=this.getGrid();a.tableFade();return babelHelpers.classPrivateFieldGet(this,H).exportDashboard(t,"grid_menu")}},{key:"publish",value:function e(a){var r=this;babelHelpers.classPrivateFieldGet(this,H).toggleDraft(a,true).then((function(){r.updateDashboardStatus(a,i.DashboardManager.DASHBOARD_STATUS_READY);babelHelpers.classPrivateFieldGet(r,F).updateRow(a)}))["catch"]((function(){BX.UI.Notification.Center.notify({content:t.Loc.getMessage("BICONNECTOR_SUPERSET_DASHBOARD_GRID_PUBLISH_NOTIFICATION_ERROR")})}))}},{key:"setDraft",value:function e(a){var r=this;babelHelpers.classPrivateFieldGet(this,H).toggleDraft(a,false).then((function(){r.updateDashboardStatus(a,i.DashboardManager.DASHBOARD_STATUS_DRAFT);babelHelpers.classPrivateFieldGet(r,F).updateRow(a,null,null,(function(e){G(r,x,ee).call(r,babelHelpers.classPrivateFieldGet(r,F).getRows().getById(a).node)}))}))["catch"]((function(){BX.UI.Notification.Center.notify({content:t.Loc.getMessage("BICONNECTOR_SUPERSET_DASHBOARD_GRID_SET_DRAFT_NOTIFICATION_ERROR")})}))}},{key:"deleteDashboard",value:function e(a,r){var i=this;var n=r?t.Loc.getMessage("BICONNECTOR_SUPERSET_DASHBOARD_GRID_DELETE_POPUP_MESSAGE_CUSTOM"):t.Loc.getMessage("BICONNECTOR_SUPERSET_DASHBOARD_GRID_DELETE_POPUP_MESSAGE_MARKET");var s=new h.Dialog({title:t.Loc.getMessage("BICONNECTOR_SUPERSET_DASHBOARD_GRID_DELETE_POPUP_TITLE_MSGVER_1"),subtitle:n,width:400,hasCloseButton:true,closeByEsc:true,disableScrolling:true,centerButtons:[new b.Button({text:t.Loc.getMessage("BICONNECTOR_SUPERSET_DASHBOARD_GRID_DELETE_POPUP_CAPTION_YES"),useAirDesign:true,size:b.ButtonSize.LARGE,style:b.AirButtonStyle.FILLED_ALERT,onclick:function e(t){t.setWaiting();babelHelpers.classPrivateFieldGet(i,H).deleteDashboard(a).then((function(){i.getGrid().reload();s.hide()}))["catch"]((function(e){s.hide();if(e.errors){G(i,j,re).call(i,e.errors)}}))}}),new b.CancelButton({text:t.Loc.getMessage("BICONNECTOR_SUPERSET_DASHBOARD_GRID_DELETE_POPUP_CAPTION_NO"),size:b.ButtonSize.LARGE,useAirDesign:true,style:b.AirButtonStyle.PLAIN,onclick:function e(t){return s.hide()}})]});s.show()}},{key:"deleteGroup",value:function e(a){var r=this;var i=new h.Dialog({title:t.Loc.getMessage("BICONNECTOR_SUPERSET_DASHBOARD_GRID_DELETE_GROUP_POPUP_TITLE_MSGVER_1"),subtitle:t.Loc.getMessage("BICONNECTOR_SUPERSET_DASHBOARD_GRID_DELETE_GROUP_POPUP_DESC"),hasCloseButton:true,closeByEsc:true,disableScrolling:true,centerButtons:[new b.Button({text:t.Loc.getMessage("BICONNECTOR_SUPERSET_DASHBOARD_GRID_DELETE_GROUP_POPUP_CAPTION_YES"),useAirDesign:true,size:b.ButtonSize.LARGE,style:b.AirButtonStyle.FILLED_ALERT,onclick:function e(t){l.PermissionsAnalytics.sendGroupDeleteAnalytics(l.PermissionsAnalyticsSource.grid);t.setWaiting();babelHelpers.classPrivateFieldGet(r,H).deleteGroup(a).then((function(){r.getGrid().reload();i.hide()}))["catch"]((function(e){i.hide();if(e.errors){G(r,j,re).call(r,e.errors)}}))}}),new b.CancelButton({text:t.Loc.getMessage("BICONNECTOR_SUPERSET_DASHBOARD_GRID_DELETE_GROUP_POPUP_CAPTION_NO"),size:b.ButtonSize.LARGE,useAirDesign:true,style:b.AirButtonStyle.PLAIN,onclick:function e(t){return i.hide()}})]});i.show()}},{key:"openCreationSlider",value:function e(){var t;var a=this.getFilter().getFilterFieldsValues();var r=(t=a["GROUPS.ID"])!==null&&t!==void 0?t:[];babelHelpers.classPrivateFieldGet(this,H).openCreationSlider(r)}},{key:"showCreationGroupPopup",value:function e(){if(G(this,W,ae).call(this)){return}babelHelpers.classPrivateFieldGet(this,H).showCreationGroupPopup();l.PermissionsAnalytics.sendClickGroupActionAnalytics(l.PermissionsAnalyticsSource.grid,true)}},{key:"showGroupSettingsPopup",value:function e(t){var a=this;l.PermissionsAnalytics.sendClickGroupActionAnalytics(l.PermissionsAnalyticsSource.grid,false);babelHelpers.classPrivateFieldGet(this,F).tableFade();babelHelpers.classPrivateFieldGet(this,H).showGroupSettingsPopup(t).then((function(){babelHelpers.classPrivateFieldGet(a,F).tableUnfade()}))["catch"]((function(){babelHelpers.classPrivateFieldGet(a,F).tableUnfade()}))}},{key:"renameDashboard",value:function e(a){var r,i=this,n;var s=this.getGrid();var l=s.getRows().getById(a);if(!l){return}var o=l.getNode();t.Dom.removeClass(o,"dashboard-title-edited");var d=(r=l.getCellById("TITLE"))===null||r===void 0?void 0:r.querySelector(".dashboard-title-wrapper");if(!d){return}var c=G(this,z,ie).call(this,a,l.getEditData().TITLE,(function(){i.cancelRenameDashboard(a)}),(function(e){var r=G(i,Y,ne).call(i,a).querySelector("a").innerText;G(i,Y,ne).call(i,a).querySelector("a").innerText=e;var n=l.getEditData();n.TITLE=e;var d=s.getParam("EDITABLE_DATA");if(BX.type.isPlainObject(d)){d[l.getId()]=n}t.Dom.addClass(o,"dashboard-title-edited");var c=t.Loc.getMessage("BICONNECTOR_SUPERSET_DASHBOARD_GRID_CHANGE_TITLE_SUCCESS",{"#NEW_TITLE#":t.Text.encode(e)});BX.UI.Notification.Center.notify({content:c});i.cancelRenameDashboard(a);G(i,V,se).call(i,a);babelHelpers.classPrivateFieldGet(i,H).renameDashboard(a,e)["catch"]((function(e){if(e.errors){G(i,j,re).call(i,e.errors)}G(i,Y,ne).call(i,a).querySelector("a").innerText=r;n.TITLE=r}))}));var u=d.querySelector(".dashboard-title-preview");if(u){t.Dom.style(u,"display","none")}t.Dom.append(c,d);var b=(n=l.getCellById("EDIT_URL"))===null||n===void 0?void 0:n.querySelector("a");var v=function e(){t.Event.unbind(l.getActionsButton(),"click",e);if(b){t.Event.unbind(b,"click",e)}i.cancelRenameDashboard(a)};t.Event.bind(l.getActionsButton(),"click",v);if(b){t.Event.bind(b,"click",v)}}},{key:"cancelRenameDashboard",value:function e(a){var r,i;var n=this.getGrid().getRows().getById(a);if(!n){return}var s=(r=n.getCellById("TITLE"))===null||r===void 0?void 0:r.querySelector(".dashboard-title-edit");var l=(i=n.getCellById("TITLE"))===null||i===void 0?void 0:i.querySelector(".dashboard-title-preview");if(s){t.Dom.remove(s)}if(l){t.Dom.style(l,"display","flex")}}},{key:"handleGroupTitleClick",value:function e(t){this.handleFilterChange(y({fieldId:"GROUPS.ID"},t))}},{key:"handleTagClick",value:function e(t){var a=JSON.parse(t);this.handleFilterChange(y({fieldId:"TAGS.ID"},a))}},{key:"handleTagAddClick",value:function e(a,r,i){var n=this;var s=function e(){var t=babelHelpers.classPrivateFieldGet(n,M).getSelectedItems().map((function(e){return e.getId()}));babelHelpers.classPrivateFieldGet(n,H).setDashboardTags(a,t).then((function(){var e;n.getGrid().updateRow(a,null,null,(function(){var e;var t=(e=n.getGrid().getRows().getById(a))===null||e===void 0?void 0:e.getCellById("TAGS");if(t&&babelHelpers.classPrivateFieldGet(n,M)){babelHelpers.classPrivateFieldGet(n,M).setTargetNode(t)}}));var r=n.getFilter().getFilterFieldsValues();var i=(e=r["TAGS.ID"])!==null&&e!==void 0?e:[];if(i.length>0){var s=t.filter((function(e){return i.includes(String(e))}));if(s.length===0){babelHelpers.classPrivateFieldGet(n,M).destroy();babelHelpers.classPrivateFieldSet(n,M,null)}}}))["catch"]((function(e){if(e.errors){G(n,j,re).call(n,e.errors)}}))};var l="biconnector-superset-dashboard-tag";var d=[];JSON.parse(r).forEach((function(e){return d.push([l,e])}));babelHelpers.classPrivateFieldSet(this,M,new o.Dialog({id:"biconnector-superset-tag-widget",targetNode:i.getData().button,enableSearch:true,width:350,height:400,multiple:true,dropdownMode:true,compactView:true,context:l,clearUnavailableItems:true,entities:[{id:l,options:{dashboardId:a}}],preselectedItems:d,searchOptions:{allowCreateItem:false},footer:u.TagFooter,events:{onSearch:function e(a){var r=a.getData().query;var i=babelHelpers.classPrivateFieldGet(n,M).getFooter();var s=babelHelpers.classPrivateFieldGet(n,M).getFooterContainer();if(t.Type.isStringFilled(r.trim())&&i.canCreateTag()){t.Dom.show(s.querySelector("#tags-widget-custom-footer-add-new"));t.Dom.show(s.querySelector("#tags-widget-custom-footer-conjunction"));return}t.Dom.hide(s.querySelector("#tags-widget-custom-footer-add-new"));t.Dom.hide(s.querySelector("#tags-widget-custom-footer-conjunction"))},"Search:onItemCreateAsync":function e(a){return new Promise((function(e,r){var i=a.getData(),s=i.searchQuery;var o=s.getQuery();babelHelpers.classPrivateFieldGet(n,H).addTag(o).then((function(t){var a=t.data;var r=babelHelpers.classPrivateFieldGet(n,M).addItem({id:a.ID,entityId:l,title:o,tabs:"all"});if(r){r.select()}e()}))["catch"]((function(e){var a=e.errors;a.forEach((function(e){var a=t.Tag.render(D||(D=babelHelpers.taggedTemplateLiteral(["\n\t\t\t\t\t\t\t\t\t\t<div class=\"dashboard-tag-already-exists-alert\">\n\t\t\t\t\t\t\t\t\t\t\t<div class='ui-alert ui-alert-xs ui-alert-danger'> \n\t\t\t\t\t\t\t\t\t\t\t\t<span class='ui-alert-message'>\n\t\t\t\t\t\t\t\t\t\t\t\t\t","\n\t\t\t\t\t\t\t\t\t\t\t\t</span> \n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t"])),e.message);t.Dom.prepend(a,babelHelpers.classPrivateFieldGet(n,M).getFooterContainer());setTimeout((function(){t.Dom.remove(a)}),3e3);r()}))}))}))},"Item:onSelect":t.Runtime.debounce(s,100,this),"Item:onDeselect":t.Runtime.debounce(s,100,this)}}));babelHelpers.classPrivateFieldGet(this,M).show()}},{key:"handleOwnerClick",value:function e(t){this.handleFilterChange(y({fieldId:"OWNER_ID"},t))}},{key:"handleCreatedByClick",value:function e(t){this.handleFilterChange(y({fieldId:"CREATED_BY_ID"},t))}},{key:"handleFilterChange",value:function e(t){var a,r;var i=this.getFilter().getFilterFieldsValues();var n=(a=i[t.fieldId])!==null&&a!==void 0?a:[];var s=(r=i["".concat(t.fieldId,"_label")])!==null&&r!==void 0?r:[];if(t.IS_FILTERED){n=n.filter((function(e){return parseInt(e,10)!==t.ID}));s=s.filter((function(e){return e!==t.TITLE}))}else if(!n.includes(t.ID)){n.push(t.ID.toString());s.push(t.TITLE)}var l=this.getFilter().getApi();var o={};o[t.fieldId]=n;o["".concat(t.fieldId,"_label")]=s;l.extendFilter(o);l.apply()}},{key:"addToTopMenu",value:function e(a,r){var i=this;BX.UI.Notification.Center.notify({content:t.Loc.getMessage("BICONNECTOR_SUPERSET_DASHBOARD_GRID_ADD_TO_TOP_MENU_SUCCESS")});G(this,K,le).call(this,a,true,r);return babelHelpers.classPrivateFieldGet(this,H).addToTopMenu(a).then((function(e){}))["catch"]((function(e){babelHelpers.classPrivateFieldGet(i,F).updateRow(a);BX.UI.Notification.Center.notify({content:t.Loc.getMessage("BICONNECTOR_SUPERSET_DASHBOARD_GRID_ADD_TO_TOP_MENU_ERROR")})}))}},{key:"deleteFromTopMenu",value:function e(a,r){var i=this;BX.UI.Notification.Center.notify({content:t.Loc.getMessage("BICONNECTOR_SUPERSET_DASHBOARD_GRID_DELETE_FROM_TOP_MENU_SUCCESS")});G(this,K,le).call(this,a,false,r);return babelHelpers.classPrivateFieldGet(this,H).deleteFromTopMenu(a).then((function(e){}))["catch"]((function(e){babelHelpers.classPrivateFieldGet(i,F).updateRow(a);BX.UI.Notification.Center.notify({content:t.Loc.getMessage("BICONNECTOR_SUPERSET_DASHBOARD_GRID_DELETE_FROM_TOP_MENU_ERROR")})}))}},{key:"pin",value:function e(t){var a=this;return babelHelpers.classPrivateFieldGet(this,H).pin(t).then((function(){babelHelpers.classPrivateFieldGet(a,F).reload()}))["catch"]((function(){}))}},{key:"unpin",value:function e(t){var a=this;return babelHelpers.classPrivateFieldGet(this,H).unpin(t).then((function(){babelHelpers.classPrivateFieldGet(a,F).reload()}))["catch"]((function(){}))}}]);return e}();function Q(){var e=this;n.EventEmitter.subscribe("SidePanel.Slider:onMessage",(function(a){var r=a.getCompatData(),i=babelHelpers.slicedToArray(r,1),n=i[0];if(n.getEventId()==="BIConnector.Superset.DashboardDetail:onDashboardBatchStatusUpdate"){var s=n.getData();if(s.dashboardList){e.onUpdatedDashboardBatchStatus(s.dashboardList)}}else if(n.getEventId()==="BIConnector.Superset.DashboardTagGrid:onTagChange"||n.getEventId()==="BIConnector.Superset.DashboardTagGrid:onTagDelete"){var l,o;if(babelHelpers.classPrivateFieldGet(e,M)){babelHelpers.classPrivateFieldGet(e,M).destroy();babelHelpers.classPrivateFieldSet(e,M,null)}var d=e.getFilter().getFilterFieldsValues();if(t.Type.isUndefined(d["TAGS.ID"])||d["TAGS.ID"].length===0){e.getGrid().reload();return}var c=n.getData(),u=c.tagId,b=c.title;var v=(l=d["TAGS.ID"])!==null&&l!==void 0?l:[];var p=(o=d["TAGS.ID_label"])!==null&&o!==void 0?o:[];var h=v.findIndex((function(e){return t.Text.toInteger(e)===t.Text.toInteger(u)}));if(n.getEventId()==="BIConnector.Superset.DashboardTagGrid:onTagDelete"){v.splice(h,1);p.splice(h,1)}else{p[h]=b}var g=e.getFilter().getApi();g.extendFilter({"TAGS.ID":v,"TAGS.ID_label":p});g.apply()}}));n.EventEmitter.subscribe("BIConnector.Superset.DashboardManager:onDashboardBatchStatusUpdate",(function(t){var a=t.getData();if(!a.dashboardList){return}var r=a.dashboardList;e.onUpdatedDashboardBatchStatus(r)}));BX.PULL&&BX.PULL.extendWatch("superset_dashboard",true);n.EventEmitter.subscribe("onPullEvent-biconnector",(function(t){var a=babelHelpers.slicedToArray(t.data,2),r=a[0],i=a[1];if(r==="onSupersetStatusUpdated"){var n=i===null||i===void 0?void 0:i.status;if(n){G(e,X,Z).call(e,n)}}}));n.EventEmitter.subscribe("BX.Rest.Configuration.Install:onFinish",(function(){babelHelpers.classPrivateFieldGet(e,F).reload()}));n.EventEmitter.subscribe("Grid::updated",(function(){G(e,k,$).call(e);G(e,q,te).call(e)}));n.EventEmitter.subscribe("BIConnector.ExportMaster:onDashboardDataLoaded",(function(){babelHelpers.classPrivateFieldGet(e,F).tableUnfade()}));n.EventEmitter.subscribe("BIConnector.DashboardManager:onEmbeddedDataLoaded",(function(){babelHelpers.classPrivateFieldGet(e,F).reload()}));n.EventEmitter.subscribe("BX.BIConnector.Settings:onAfterSave",(function(){babelHelpers.classPrivateFieldGet(e,F).reload()}));n.EventEmitter.subscribe("BIConnector.CreateForm:onDashboardCreated",(function(){babelHelpers.classPrivateFieldGet(e,F).reload()}));n.EventEmitter.subscribe("BIConnector.AccessRights:onRightsSaved",(function(){babelHelpers.classPrivateFieldGet(e,F).reload()}));n.EventEmitter.subscribe("BIConnector.GroupPopup:onGroupSaved",(function(a){var r;var i=a.getData();var n=i===null||i===void 0?void 0:(r=i.group)===null||r===void 0?void 0:r.id;var s=i===null||i===void 0?void 0:i.isTitleEdited;var o=i===null||i===void 0?void 0:i.isDashboardListEdited;var d=i===null||i===void 0?void 0:i.isScopeListEdited;if(n&&(s||o||d)){l.PermissionsAnalytics.sendGroupActionAnalytics(l.PermissionsAnalyticsSource.grid,t.Type.isString(n)?n.startsWith("new_"):false,o,d)}babelHelpers.classPrivateFieldGet(e,F).reload()}));n.EventEmitter.subscribe("BIConnector.GroupPopup.DashboardScopeSelector:onDialogHide",(function(e){var t;if(!((t=e.getData())!==null&&t!==void 0&&t.isScopeListEdited)){return}l.PermissionsAnalytics.sendGroupDashboardScopeEditAnalytics(l.PermissionsAnalyticsSource.grid)}));n.EventEmitter.subscribe("BIConnector.GroupPopup.ScopeSelector:onDialogHide",(function(e){var t;if(!((t=e.getData())!==null&&t!==void 0&&t.isScopeListEdited)){return}l.PermissionsAnalytics.sendGroupScopeEditAnalytics(l.PermissionsAnalyticsSource.grid)}));n.EventEmitter.subscribe("BIConnector.GroupPopup.DashboardSelector:onDialogHide",(function(e){var t;if(!((t=e.getData())!==null&&t!==void 0&&t.isDashboardListEdited)){return}l.PermissionsAnalytics.sendGroupDashboardEditAnalytics(l.PermissionsAnalyticsSource.grid)}));n.EventEmitter.subscribe("BIConnector.GroupPopup.DashboardList:onDashboardRemove",(function(){l.PermissionsAnalytics.sendGroupDashboardEditAnalytics(l.PermissionsAnalyticsSource.grid)}))}function $(){var e=BX.UI.Hint.createInstance({popupParameters:{autoHide:true}});e.init(babelHelpers.classPrivateFieldGet(this,F).getContainer())}function Z(e){if(e==="READY"){this.getGrid().reload()}if(e!=="LOAD"&&e!=="ERROR"&&e!=="LIMIT_EXCEEDED"){return}var t={LOAD:i.DashboardManager.DASHBOARD_STATUS_LOAD,ERROR:i.DashboardManager.DASHBOARD_STATUS_COMPUTED_NOT_LOAD,LIMIT_EXCEEDED:i.DashboardManager.DASHBOARD_STATUS_COMPUTED_NOT_LOAD};var a=this.getGrid();var r=a.getRows().getBodyChild();var n=R(r),s;try{for(n.s();!(s=n.n()).done;){var l=s.value;var o=l.getId();var d=t[e];if(d){this.updateDashboardStatus(o,d)}}}catch(e){n.e(e)}finally{n.f()}}function ee(e){if(!babelHelpers.classPrivateFieldGet(this,U).isNeedShowDraftGuide){return}var a=e.querySelector(".dashboard-status-label.ui-label-default");var r=a?a.closest(".main-grid-cell"):null;var i=new d.Guide({steps:[{target:r!==null&&r!==void 0?r:e,title:t.Loc.getMessage("BICONNECTOR_SUPERSET_DASHBOARD_GRID_DRAFT_GUIDE_TITLE"),text:t.Loc.getMessage("BICONNECTOR_SUPERSET_DASHBOARD_GRID_DRAFT_GUIDE_TEXT"),events:{onClose:function e(){BX.userOptions.save("biconnector","draft_guide","is_over",true)}},rounded:false,position:"bottom",areaPadding:0}],onEvents:true});i.start();babelHelpers.classPrivateFieldGet(this,U).isNeedShowDraftGuide=false}function te(){babelHelpers.classPrivateFieldSet(this,w,0);var e=babelHelpers.classPrivateFieldGet(this,F).getRows().getBodyChild();var a=R(e),r;try{for(a.s();!(r=a.n()).done;){var i=r.value;if(i.node.querySelector(".dashboard-unpin-icon")){t.Dom.addClass(i.node,"biconnector-dashboard-pinned");babelHelpers.classPrivateFieldSet(this,w,i.getId())}}}catch(e){a.e(e)}finally{a.f()}}function ae(){var e;var t=this.getFilter().getFilterFieldsValues();var a=(e=t["GROUPS.ID"])!==null&&e!==void 0?e:[];return a.length>0}function re(e){if(e[0]&&e[0].message){BX.UI.Notification.Center.notify({content:t.Text.encode(e[0].message)})}}function ie(e,a,r,i){var n=t.Tag.render(f||(f=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<input class="main-grid-editor main-grid-editor-text" type="text">\n\t\t'])));n.value=a;var s=function e(){var a=n.value;t.Dom.removeClass(n,"dashboard-title-input-danger");if(a.trim()===""){BX.UI.Notification.Center.notify({content:t.Loc.getMessage("BICONNECTOR_SUPERSET_DASHBOARD_GRID_CHANGE_TITLE_ERROR_EMPTY")});t.Dom.addClass(n,"dashboard-title-input-danger");return}t.Dom.style(d,"display","none");t.Dom.attr(n,"disabled",true);i(n.value)};t.Event.bind(n,"keydown",(function(e){if(e.keyCode===13){s();e.preventDefault()}else if(e.keyCode===27){r();e.preventDefault()}}));var l=t.Tag.render(_||(_=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<a>\n\t\t\t\t<i\n\t\t\t\t\tclass="ui-icon-set --check"\n\t\t\t\t\tstyle="--ui-icon-set__icon-size: 21px; --ui-icon-set__icon-color: var(--ui-color-palette-gray-40);"\n\t\t\t\t></i>\n\t\t\t</a>\n\t\t'])));var o=t.Tag.render(S||(S=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<a>\n\t\t\t\t<i\n\t\t\t\t\tclass="ui-icon-set --cross-60"\n\t\t\t\t\tstyle="--ui-icon-set__icon-size: 21px; --ui-icon-set__icon-color: var(--ui-color-palette-gray-40);"\n\t\t\t\t></i>\n\t\t\t</a>\n\t\t'])));var d=t.Tag.render(E||(E=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="dashboard-title-wrapper__buttons">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t</div>\n\t\t"])),l,o);t.Event.bind(o,"click",(function(){r()}));t.Event.bind(l,"click",s);return t.Tag.render(T||(T=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="dashboard-title-wrapper__item dashboard-title-edit">\n\t\t\t\t','\n\t\t\t\t<div class="dashboard-title-wrapper__buttons-wrapper">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),n,d)}function ne(e){var t;var a=this.getGrid();var r=a.getRows().getById(e);if(!r){return null}var i=(t=r.getCellById("TITLE"))===null||t===void 0?void 0:t.querySelector(".dashboard-title-wrapper");if(!i){return null}var n=i.querySelector(".dashboard-title-preview");if(n){return n}return null}function se(e){var a;var i=(a=babelHelpers.classPrivateFieldGet(this,F).getRows().getById(e))===null||a===void 0?void 0:a.getCellById("DATE_MODIFY");if(!i){return}var n=i.querySelector(".main-grid-cell-content span");var s=r.DateTimeFormat.format(r.DateTimeFormat.getFormat("FORMAT_DATETIME"),Math.floor(Date.now()/1e3));var l=t.Loc.getMessage("BICONNECTOR_SUPERSET_DASHBOARD_GRID_DATE_MODIFY_NOW");var o=t.Tag.render(A||(A=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span data-hint="','" data-hint-no-icon data-hint-interactivity>',"</span>\n\t\t"])),s,l);t.Dom.replace(n,o);G(this,k,$).call(this)}function le(e,a){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"/";var i=babelHelpers.classPrivateFieldGet(this,F).getRows().getById(e);var n=i===null||i===void 0?void 0:i.getActions();var s=R(n.entries()),l;try{for(s.s();!(l=s.n()).done;){var o=babelHelpers.slicedToArray(l.value,2),d=o[0],c=o[1];if(a&&c.ACTION_ID==="addToTopMenu"){n[d].ACTION_ID="deleteFromTopMenu";n[d].onclick="BX.BIConnector.SupersetDashboardGridManager.Instance.deleteFromTopMenu(".concat(e,")");n[d].text=t.Loc.getMessage("BICONNECTOR_SUPERSET_DASHBOARD_GRID_ACTION_ITEM_DELETE_FROM_TOP_MENU")}else if(!a&&c.ACTION_ID==="deleteFromTopMenu"){n[d].ACTION_ID="addToTopMenu";n[d].onclick="BX.BIConnector.SupersetDashboardGridManager.Instance.addToTopMenu(".concat(e,", `").concat(r,"`)");n[d].text=t.Loc.getMessage("BICONNECTOR_SUPERSET_DASHBOARD_GRID_ACTION_ITEM_ADD_TO_TOP_MENU")}}}catch(e){s.e(e)}finally{s.f()}i.setActions(n);var u=i===null||i===void 0?void 0:i.getCellById("TITLE");var b="";if(u){var v=u.querySelector(".dashboard-title-wrapper__item");b=v.querySelector("a").innerText}var p=BX.Main.interfaceButtonsManager.getById("biconnector_superset_menu");if(a&&b){p.addMenuItem({ID:"biconnector_superset_menu_dashboard_".concat(e),TEXT:b,ON_CLICK:"window.open(`".concat(r,"`, '_blank');"),id:"biconnector_superset_menu_dashboard_".concat(e),text:b,onClick:"window.open(`".concat(r,"`, '_blank');")});var h=p.getItemById("biconnector_superset_menu_dashboard_".concat(e));var g=p.getVisibleItems();t.Dom.insertBefore(h,g[0])}else{var D=p.getItemById("biconnector_superset_menu_dashboard_".concat(e));p.deleteMenuItem(D)}}t.Reflection.namespace("BX.BIConnector").SupersetDashboardGridManager=J})(this.window=this.window||{},BX,BX.Main,BX.Main,BX.BIConnector,BX.Event,BX.UI.Dialogs,BX.BIConnector,BX.UI.EntitySelector,BX.UI.Tour,BX.BIConnector,BX.BIConnector.EntitySelector,BX.UI,BX.UI,BX,BX.UI.System);
//# sourceMappingURL=script.map.js