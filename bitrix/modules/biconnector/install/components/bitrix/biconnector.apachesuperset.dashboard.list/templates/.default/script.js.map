{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { Loc, Type, Tag, Reflection, Dom, Text, Event, Runtime } from 'main.core';\nimport { Menu, MenuManager } from 'main.popup';\nimport { DateTimeFormat } from 'main.date';\nimport { DashboardManager } from 'biconnector.apache-superset-dashboard-manager';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { MessageBox } from 'ui.dialogs.messagebox';\nimport { ApacheSupersetAnalytics, PermissionsAnalytics, PermissionsAnalyticsSource } from 'biconnector.apache-superset-analytics';\nimport type { DashboardAnalyticInfo } from 'biconnector.apache-superset-analytics';\nimport { Dialog } from 'ui.entity-selector';\nimport { Guide } from 'ui.tour';\nimport { ApacheSupersetMarketManager } from 'biconnector.apache-superset-market-manager';\nimport { TagFooter } from 'biconnector.entity-selector';\nimport { AirButtonStyle, Button, ButtonColor, CancelButton, ButtonSize } from 'ui.buttons';\nimport 'ui.alerts';\nimport 'ui.forms';\nimport { Dialog as SystemDialog } from 'ui.system.dialog';\n\ntype Props = {\n\tgridId: ?string,\n\tisNeedShowDraftGuide: boolean,\n\tisAvailableDashboardCreation: boolean,\n\tisAvailableGroupCreation: boolean,\n\tisMarketExists: boolean,\n\tmarketUrl: string,\n\tsupersetStatus: string,\n};\n\ntype LoginPopupParams = {\n\tdashboardId: number,\n\ttype: string,\n\teditUrl: string,\n\tappId: string,\n};\n\n/**\n * @namespace BX.BIConnector\n */\nclass SupersetDashboardGridManager\n{\n\t#dashboardManager: DashboardManager = null;\n\t#grid: BX.Main.grid;\n\t#filter: BX.Main.Filter;\n\t#tagSelectorDialog: ?Dialog;\n\t#lastPinnedRowId: ?number;\n\t#properties: Props;\n\tconstructor(props: Props)\n\t{\n\t\tthis.#dashboardManager = new DashboardManager();\n\t\tthis.#properties = props;\n\n\t\tthis.#grid = BX.Main.gridManager.getById(props.gridId)?.instance;\n\t\tthis.#filter = BX.Main.filterManager.getById(props.gridId);\n\t\tthis.#subscribeToEvents();\n\n\t\tthis.#colorPinnedRows();\n\t\tthis.#initHints();\n\t}\n\n\t#subscribeToEvents()\n\t{\n\t\tEventEmitter.subscribe('SidePanel.Slider:onMessage', (event) => {\n\t\t\tconst [sliderEvent] = event.getCompatData();\n\n\t\t\tif (sliderEvent.getEventId() === 'BIConnector.Superset.DashboardDetail:onDashboardBatchStatusUpdate')\n\t\t\t{\n\t\t\t\tconst eventArgs = sliderEvent.getData();\n\t\t\t\tif (eventArgs.dashboardList)\n\t\t\t\t{\n\t\t\t\t\tthis.onUpdatedDashboardBatchStatus(eventArgs.dashboardList);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (\n\t\t\t\tsliderEvent.getEventId() === 'BIConnector.Superset.DashboardTagGrid:onTagChange'\n\t\t\t\t|| sliderEvent.getEventId() === 'BIConnector.Superset.DashboardTagGrid:onTagDelete'\n\t\t\t)\n\t\t\t{\n\t\t\t\tif (this.#tagSelectorDialog)\n\t\t\t\t{\n\t\t\t\t\tthis.#tagSelectorDialog.destroy();\n\t\t\t\t\tthis.#tagSelectorDialog = null;\n\t\t\t\t}\n\n\t\t\t\tconst filterTagValues = this.getFilter().getFilterFieldsValues();\n\t\t\t\tif (Type.isUndefined(filterTagValues['TAGS.ID']) || filterTagValues['TAGS.ID'].length === 0)\n\t\t\t\t{\n\t\t\t\t\tthis.getGrid().reload();\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst { tagId, title } = sliderEvent.getData();\n\t\t\t\tconst currentFilteredTags = filterTagValues['TAGS.ID'] ?? [];\n\t\t\t\tconst currentFilteredTagLabels = filterTagValues['TAGS.ID_label'] ?? [];\n\n\t\t\t\tconst index = currentFilteredTags.findIndex((id) => Text.toInteger(id) === Text.toInteger(tagId));\n\t\t\t\tif (sliderEvent.getEventId() === 'BIConnector.Superset.DashboardTagGrid:onTagDelete')\n\t\t\t\t{\n\t\t\t\t\tcurrentFilteredTags.splice(index, 1);\n\t\t\t\t\tcurrentFilteredTagLabels.splice(index, 1);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tcurrentFilteredTagLabels[index] = title;\n\t\t\t\t}\n\n\t\t\t\tconst filterApi = this.getFilter().getApi();\n\t\t\t\tfilterApi.extendFilter({\n\t\t\t\t\t'TAGS.ID': currentFilteredTags,\n\t\t\t\t\t'TAGS.ID_label': currentFilteredTagLabels,\n\t\t\t\t});\n\n\t\t\t\tfilterApi.apply();\n\t\t\t}\n\t\t});\n\n\t\tEventEmitter.subscribe('BIConnector.Superset.DashboardManager:onDashboardBatchStatusUpdate', (event) => {\n\t\t\tconst data = event.getData();\n\t\t\tif (!data.dashboardList)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst dashboardList = data.dashboardList;\n\t\t\tthis.onUpdatedDashboardBatchStatus(dashboardList);\n\t\t});\n\n\t\tBX.PULL && BX.PULL.extendWatch('superset_dashboard', true);\n\t\tEventEmitter.subscribe('onPullEvent-biconnector', (event: BaseEvent) => {\n\t\t\tconst [eventName, eventData] = event.data;\n\t\t\tif (eventName === 'onSupersetStatusUpdated')\n\t\t\t{\n\t\t\t\tconst status = eventData?.status;\n\t\t\t\tif (status)\n\t\t\t\t{\n\t\t\t\t\tthis.#onSupersetStatusChange(status);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tEventEmitter.subscribe('BX.Rest.Configuration.Install:onFinish', () => {\n\t\t\tthis.#grid.reload();\n\t\t});\n\n\t\tEventEmitter.subscribe('Grid::updated', () => {\n\t\t\tthis.#initHints();\n\t\t\tthis.#colorPinnedRows();\n\t\t});\n\n\t\tEventEmitter.subscribe('BIConnector.ExportMaster:onDashboardDataLoaded', () => {\n\t\t\tthis.#grid.tableUnfade();\n\t\t});\n\n\t\tEventEmitter.subscribe('BIConnector.DashboardManager:onEmbeddedDataLoaded', () => {\n\t\t\tthis.#grid.reload();\n\t\t});\n\n\t\tEventEmitter.subscribe('BX.BIConnector.Settings:onAfterSave', () => {\n\t\t\tthis.#grid.reload();\n\t\t});\n\n\t\tEventEmitter.subscribe('BIConnector.CreateForm:onDashboardCreated', () => {\n\t\t\tthis.#grid.reload();\n\t\t});\n\n\t\tEventEmitter.subscribe('BIConnector.AccessRights:onRightsSaved', () => {\n\t\t\tthis.#grid.reload();\n\t\t});\n\n\t\tEventEmitter.subscribe('BIConnector.GroupPopup:onGroupSaved', (event: BaseEvent) => {\n\t\t\tconst eventData = event.getData();\n\t\t\tconst groupId = eventData?.group?.id;\n\t\t\tconst isTitleEdited = eventData?.isTitleEdited;\n\t\t\tconst isDashboardListEdited = eventData?.isDashboardListEdited;\n\t\t\tconst isScopeListEdited = eventData?.isScopeListEdited;\n\n\t\t\tif (groupId && (isTitleEdited || isDashboardListEdited || isScopeListEdited))\n\t\t\t{\n\t\t\t\tPermissionsAnalytics.sendGroupActionAnalytics(\n\t\t\t\t\tPermissionsAnalyticsSource.grid,\n\t\t\t\t\tType.isString(groupId) ? groupId.startsWith('new_') : false,\n\t\t\t\t\tisDashboardListEdited,\n\t\t\t\t\tisScopeListEdited,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tthis.#grid.reload();\n\t\t});\n\n\t\tEventEmitter.subscribe(\n\t\t\t'BIConnector.GroupPopup.DashboardScopeSelector:onDialogHide',\n\t\t\t(event: BaseEvent) => {\n\t\t\t\tif (!event.getData()?.isScopeListEdited)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tPermissionsAnalytics.sendGroupDashboardScopeEditAnalytics(\n\t\t\t\t\tPermissionsAnalyticsSource.grid,\n\t\t\t\t);\n\t\t\t},\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\t'BIConnector.GroupPopup.ScopeSelector:onDialogHide',\n\t\t\t(event: BaseEvent) => {\n\t\t\t\tif (!event.getData()?.isScopeListEdited)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tPermissionsAnalytics.sendGroupScopeEditAnalytics(\n\t\t\t\t\tPermissionsAnalyticsSource.grid,\n\t\t\t\t);\n\t\t\t},\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\t'BIConnector.GroupPopup.DashboardSelector:onDialogHide',\n\t\t\t(event: BaseEvent) => {\n\t\t\t\tif (!event.getData()?.isDashboardListEdited)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tPermissionsAnalytics.sendGroupDashboardEditAnalytics(\n\t\t\t\t\tPermissionsAnalyticsSource.grid,\n\t\t\t\t);\n\t\t\t},\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\t'BIConnector.GroupPopup.DashboardList:onDashboardRemove',\n\t\t\t() => {\n\t\t\t\tPermissionsAnalytics.sendGroupDashboardEditAnalytics(\n\t\t\t\t\tPermissionsAnalyticsSource.grid,\n\t\t\t\t);\n\t\t\t},\n\t\t);\n\t}\n\n\t#initHints(): void\n\t{\n\t\tconst manager = BX.UI.Hint.createInstance({\n\t\t\tpopupParameters: {\n\t\t\t\tautoHide: true,\n\t\t\t},\n\t\t});\n\t\tmanager.init(this.#grid.getContainer());\n\t}\n\n\t#onSupersetStatusChange(status: string): void\n\t{\n\t\tif (status === 'READY')\n\t\t{\n\t\t\tthis.getGrid().reload();\n\t\t}\n\n\t\tif (\n\t\t\tstatus !== 'LOAD'\n\t\t\t&& status !== 'ERROR'\n\t\t\t&& status !== 'LIMIT_EXCEEDED'\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst statusMap = {\n\t\t\tLOAD: DashboardManager.DASHBOARD_STATUS_LOAD,\n\t\t\tERROR: DashboardManager.DASHBOARD_STATUS_COMPUTED_NOT_LOAD,\n\t\t\tLIMIT_EXCEEDED: DashboardManager.DASHBOARD_STATUS_COMPUTED_NOT_LOAD,\n\t\t};\n\n\t\tconst grid = this.getGrid();\n\t\tconst rows = grid.getRows().getBodyChild();\n\t\tfor (const row: BX.Grid.Row of rows)\n\t\t{\n\t\t\tconst dashboardId = row.getId();\n\t\t\tconst dashboardStatus = statusMap[status];\n\t\t\tif (dashboardStatus)\n\t\t\t{\n\t\t\t\tthis.updateDashboardStatus(dashboardId, dashboardStatus);\n\t\t\t}\n\t\t}\n\t}\n\n\t#showDraftGuide(node: HTMLElement): void\n\t{\n\t\tif (!this.#properties.isNeedShowDraftGuide)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst labelNode = node.querySelector('.dashboard-status-label.ui-label-default');\n\t\tconst cellNode = labelNode ? labelNode.closest('.main-grid-cell') : null;\n\t\tconst guide = new Guide({\n\t\t\tsteps: [\n\t\t\t\t{\n\t\t\t\t\ttarget: cellNode ?? node,\n\t\t\t\t\ttitle: Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_DRAFT_GUIDE_TITLE'),\n\t\t\t\t\ttext: Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_DRAFT_GUIDE_TEXT'),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonClose: () => {\n\t\t\t\t\t\t\tBX.userOptions.save('biconnector', 'draft_guide', 'is_over', true);\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\trounded: false,\n\t\t\t\t\tposition: 'bottom',\n\t\t\t\t\tareaPadding: 0,\n\t\t\t\t},\n\t\t\t],\n\t\t\tonEvents: true,\n\t\t});\n\n\t\tguide.start();\n\t\tthis.#properties.isNeedShowDraftGuide = false;\n\t}\n\n\t#colorPinnedRows(): void\n\t{\n\t\tthis.#lastPinnedRowId = 0;\n\t\tconst rows = this.#grid.getRows().getBodyChild();\n\t\tfor (const row: BX.Grid.Row of rows)\n\t\t{\n\t\t\tif (row.node.querySelector('.dashboard-unpin-icon'))\n\t\t\t{\n\t\t\t\tDom.addClass(row.node, 'biconnector-dashboard-pinned');\n\t\t\t\tthis.#lastPinnedRowId = row.getId();\n\t\t\t}\n\t\t}\n\t}\n\n\tonUpdatedDashboardBatchStatus(dashboardList: Array)\n\t{\n\t\tfor (const dashboard of dashboardList)\n\t\t{\n\t\t\tthis.updateDashboardStatus(dashboard.id, dashboard.status);\n\t\t}\n\t}\n\n\tgetGrid(): BX.Main.grid\n\t{\n\t\treturn this.#grid;\n\t}\n\n\tgetFilter(): BX.Main.Filter\n\t{\n\t\treturn this.#filter;\n\t}\n\n\t/**\n\t * @param params LoginPopupParams\n\t * @param openedFrom\n\t */\n\tshowLoginPopup(params: LoginPopupParams, openedFrom: string = 'unknown')\n\t{\n\t\tif (\n\t\t\t!Type.isNumber(params.dashboardId)\n\t\t\t|| !['CUSTOM', 'MARKET', 'SYSTEM'].includes(params.type)\n\t\t\t|| !Type.isStringFilled(params.editUrl)\n\t\t)\n\t\t{\n\t\t\t// noinspection JSIgnoredPromiseFromCall\n\t\t\tconsole.error('SupersetDashboardGridManager: showLoginPopup called with invalid params', params);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst grid = this.getGrid();\n\t\tif (params.type === 'CUSTOM')\n\t\t{\n\t\t\tgrid.tableFade();\n\t\t}\n\n\t\tthis.#dashboardManager.processEditDashboard(\n\t\t\t{\n\t\t\t\tid: params.dashboardId,\n\t\t\t\ttype: params.type,\n\t\t\t\teditLink: params.editUrl,\n\t\t\t},\n\t\t\t() => {\n\t\t\t\tgrid.tableUnfade();\n\t\t\t},\n\t\t\t(popupType) => {\n\t\t\t\tApacheSupersetAnalytics.sendAnalytics('edit', 'report_edit', {\n\t\t\t\t\tc_sub_section: popupType,\n\t\t\t\t\tc_element: openedFrom,\n\t\t\t\t\ttype: params.type.toLowerCase(),\n\t\t\t\t\tp1: ApacheSupersetAnalytics.buildAppIdForAnalyticRequest(params.appId),\n\t\t\t\t\tp2: params.dashboardId,\n\t\t\t\t\tstatus: 'success',\n\t\t\t\t});\n\t\t\t},\n\t\t\t(popupType) => {\n\t\t\t\tApacheSupersetAnalytics.sendAnalytics('edit', 'report_edit', {\n\t\t\t\t\tc_sub_section: popupType,\n\t\t\t\t\tc_element: openedFrom,\n\t\t\t\t\ttype: params.type.toLowerCase(),\n\t\t\t\t\tp1: ApacheSupersetAnalytics.buildAppIdForAnalyticRequest(params.appId),\n\t\t\t\t\tp2: params.dashboardId,\n\t\t\t\t\tstatus: 'error',\n\t\t\t\t});\n\t\t\t},\n\t\t);\n\t}\n\n\t#isActiveGroupIdFilter(): boolean\n\t{\n\t\tconst filterFieldsValues = this.getFilter().getFilterFieldsValues();\n\t\tconst selectedGroups: string[] = filterFieldsValues['GROUPS.ID'] ?? [];\n\n\t\treturn selectedGroups.length > 0;\n\t}\n\n\t/**\n\t * @param event PointerEvent\n\t */\n\tshowCreationMenu(event: PointerEvent): void\n\t{\n\t\tconst openedMenu: ?Menu = MenuManager.getMenuById('biconnector-creation-menu');\n\t\tif (openedMenu)\n\t\t{\n\t\t\topenedMenu.close();\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst items = [];\n\n\t\tif (this.#properties.isAvailableDashboardCreation)\n\t\t{\n\t\t\titems.push(\n\t\t\t\t{\n\t\t\t\t\ttext: Loc.getMessage('BICONNECTOR_APACHE_SUPERSET_DASHBOARD_LIST_MENU_ITEM_NEW_DASHBOARD'),\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tthis.openCreationSlider();\n\t\t\t\t\t\tcreationMenu.close();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\n\t\tif (this.#properties.isAvailableGroupCreation)\n\t\t{\n\t\t\titems.push(\n\t\t\t\t{\n\t\t\t\t\ttext: Loc.getMessage('BICONNECTOR_APACHE_SUPERSET_DASHBOARD_LIST_MENU_ITEM_NEW_GROUP'),\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tthis.showCreationGroupPopup();\n\t\t\t\t\t\tcreationMenu.close();\n\t\t\t\t\t},\n\t\t\t\t\tdisabled: this.#isActiveGroupIdFilter(),\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\n\t\titems.push(\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('BICONNECTOR_APACHE_SUPERSET_DASHBOARD_LIST_MENU_ITEM_CREATE_DASHBOARD'),\n\t\t\t\tonclick: () => {\n\t\t\t\t\tApacheSupersetMarketManager.openMarket(this.#properties.isMarketExists, this.#properties.marketUrl, 'menu');\n\t\t\t\t\tcreationMenu.close();\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\n\t\tconst creationMenu = MenuManager.create({\n\t\t\tid: 'biconnector-creation-menu',\n\t\t\tcloseByEsc: false,\n\t\t\tcloseIcon: false,\n\t\t\tcacheable: false,\n\t\t\tangle: true,\n\t\t\toffsetLeft: 20,\n\t\t\titems,\n\t\t\tautoHide: true,\n\t\t\tbindElement: event.target,\n\t\t});\n\n\t\tcreationMenu.show();\n\t}\n\n\trestartDashboardLoad(dashboardId: number): void\n\t{\n\t\tconst row = this.#grid.getRows().getById(dashboardId);\n\t\tif (row)\n\t\t{\n\t\t\tconst btn = row.node.querySelector('#restart-dashboard-load-btn');\n\t\t\tif (Type.isDomNode(btn))\n\t\t\t{\n\t\t\t\tconst isDisabled = btn.getAttribute('disabled');\n\t\t\t\tif (isDisabled)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tbtn.setAttribute('disabled', 'true');\n\t\t\t\tDom.addClass(btn, 'dashboard-status-label-error-btn__loading');\n\t\t\t}\n\t\t}\n\n\t\tthis.#dashboardManager\n\t\t\t.restartDashboardImport(dashboardId)\n\t\t\t.then(\n\t\t\t\t(response) => {\n\t\t\t\t\tconst dashboardIds = response?.data?.restartedDashboardIds;\n\t\t\t\t\tif (!dashboardIds)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (const restartedDashboardId of dashboardIds)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.updateDashboardStatus(restartedDashboardId, DashboardManager.DASHBOARD_STATUS_LOAD);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t)\n\t\t\t.catch()\n\t\t;\n\t}\n\n\tupdateDashboardStatus(dashboardId: number, status: string): void\n\t{\n\t\tconst row = this.#grid.getRows().getById(dashboardId);\n\t\tif (row)\n\t\t{\n\t\t\tconst labelWrapper = row.node.querySelector('.dashboard-status-label-wrapper');\n\t\t\tconst label = labelWrapper.querySelector('.dashboard-status-label');\n\t\t\tconst reloadBtn = labelWrapper.querySelector('#restart-dashboard-load-btn');\n\n\t\t\tlet labelClass = '';\n\t\t\tlet labelTitle = '';\n\n\t\t\tswitch (status)\n\t\t\t{\n\t\t\t\tcase DashboardManager.DASHBOARD_STATUS_READY:\n\t\t\t\t\tsetTimeout(() => this.#grid.updateRow(dashboardId), 500);\n\n\t\t\t\t\treturn;\n\t\t\t\tcase DashboardManager.DASHBOARD_STATUS_DRAFT:\n\t\t\t\t\tlabelClass = 'ui-label-default';\n\t\t\t\t\tlabelTitle = Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_STATUS_DRAFT');\n\t\t\t\t\tbreak;\n\t\t\t\tcase DashboardManager.DASHBOARD_STATUS_LOAD:\n\t\t\t\t\tlabelClass = 'ui-label-primary';\n\t\t\t\t\tlabelTitle = Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_STATUS_LOAD');\n\t\t\t\t\tbreak;\n\t\t\t\tcase DashboardManager.DASHBOARD_STATUS_FAILED:\n\t\t\t\t\tlabelClass = 'ui-label-danger';\n\t\t\t\t\tlabelTitle = Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_STATUS_FAILED');\n\t\t\t\t\tbreak;\n\t\t\t\tcase DashboardManager.DASHBOARD_STATUS_COMPUTED_NOT_LOAD:\n\t\t\t\t\tlabelClass = 'ui-label-danger';\n\t\t\t\t\tlabelTitle = Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_STATUS_NOT_LOAD');\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (this.#properties.supersetStatus === 'LIMIT_EXCEEDED')\n\t\t\t{\n\t\t\t\tlabelClass = 'ui-label-danger';\n\t\t\t\tlabelTitle = Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_STATUS_NOT_LOAD');\n\t\t\t}\n\n\t\t\tif (labelClass === '')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (reloadBtn)\n\t\t\t{\n\t\t\t\treloadBtn.remove();\n\t\t\t}\n\n\t\t\tif (status === DashboardManager.DASHBOARD_STATUS_FAILED)\n\t\t\t{\n\t\t\t\tconst createdReloadBtn = this.createReloadBtn(dashboardId);\n\t\t\t\tDom.append(createdReloadBtn, labelWrapper);\n\t\t\t}\n\n\t\t\tconst labelStatuses = [\n\t\t\t\t'ui-label-lightgreen',\n\t\t\t\t'ui-label-default',\n\t\t\t\t'ui-label-primary',\n\t\t\t\t'ui-label-danger',\n\t\t\t];\n\t\t\tDom.addClass(label, labelClass);\n\t\t\tlabelStatuses.forEach((uiStatus: string) => {\n\t\t\t\tif (uiStatus !== labelClass)\n\t\t\t\t{\n\t\t\t\t\tDom.removeClass(label, uiStatus);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tlabel.querySelector('span').innerText = labelTitle;\n\t\t}\n\t}\n\n\tcreateReloadBtn(dashboardId: number): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div id=\"restart-dashboard-load-btn\" onclick=\"BX.BIConnector.SupersetDashboardGridManager.Instance.restartDashboardLoad(${dashboardId})\" class=\"dashboard-status-label-error-btn\">\n\t\t\t\t<div class=\"ui-icon-set --refresh-5 dashboard-status-label-error-icon\"></div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tduplicateDashboard(dashboardId: number, analyticInfo: DashboardAnalyticInfo = null): void\n\t{\n\t\tconst grid = this.getGrid();\n\t\tgrid.tableFade();\n\n\t\treturn this.#dashboardManager.duplicateDashboard(dashboardId)\n\t\t\t.then((response) => {\n\t\t\t\tconst gridRealtime: BX.Grid.Realtime = grid.getRealtime();\n\t\t\t\tconst newDashboard = response.data.dashboard;\n\n\t\t\t\tconst newRow = {\n\t\t\t\t\tid: newDashboard.id,\n\t\t\t\t\tcolumns: newDashboard.columns,\n\t\t\t\t\tactions: newDashboard.actions,\n\t\t\t\t};\n\n\t\t\t\tconst firstDashboardRow = this.#grid\n\t\t\t\t\t.getRows()\n\t\t\t\t\t.getRowsByGroupId('D')\n\t\t\t\t\t.find((row) => !Dom.hasClass(row.node, 'biconnector-dashboard-pinned'))\n\t\t\t\t;\n\t\t\t\tif (firstDashboardRow)\n\t\t\t\t{\n\t\t\t\t\tnewRow.insertBefore = firstDashboardRow?.getId();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tnewRow.insertAfter = 0;\n\t\t\t\t}\n\n\t\t\t\tgridRealtime.addRow(newRow);\n\t\t\t\tconst newRowNode = this.#grid.getRows().getById(newDashboard.id).node;\n\t\t\t\tnewRowNode.setAttribute('data-group-id', 'D');\n\n\t\t\t\tconst editableData = grid.getParam('EDITABLE_DATA');\n\t\t\t\tif (BX.type.isPlainObject(editableData))\n\t\t\t\t{\n\t\t\t\t\teditableData[newDashboard.id] = { TITLE: newDashboard.title };\n\t\t\t\t}\n\n\t\t\t\tgrid.tableUnfade();\n\t\t\t\tconst counterTotalTextContainer = grid.getCounterTotal().querySelector('.main-grid-panel-content-text');\n\t\t\t\tcounterTotalTextContainer.textContent++;\n\n\t\t\t\tthis.#initHints();\n\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\tcontent: Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_COPY_NOTIFICATION_ADDED'),\n\t\t\t\t});\n\n\t\t\t\tif (analyticInfo !== null)\n\t\t\t\t{\n\t\t\t\t\tApacheSupersetAnalytics.sendAnalytics('edit', 'report_copy', {\n\t\t\t\t\t\ttype: analyticInfo.type,\n\t\t\t\t\t\tp1: ApacheSupersetAnalytics.buildAppIdForAnalyticRequest(analyticInfo.appId),\n\t\t\t\t\t\tp2: dashboardId,\n\t\t\t\t\t\tstatus: 'success',\n\t\t\t\t\t\tc_element: analyticInfo.from,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tgrid.tableUnfade();\n\t\t\t\tif (response.errors)\n\t\t\t\t{\n\t\t\t\t\tthis.#notifyErrors(response.errors);\n\t\t\t\t}\n\n\t\t\t\tif (analyticInfo !== null)\n\t\t\t\t{\n\t\t\t\t\tApacheSupersetAnalytics.sendAnalytics('edit', 'report_copy', {\n\t\t\t\t\t\ttype: analyticInfo.type,\n\t\t\t\t\t\tp1: ApacheSupersetAnalytics.buildAppIdForAnalyticRequest(analyticInfo.appId),\n\t\t\t\t\t\tp2: dashboardId,\n\t\t\t\t\t\tstatus: 'error',\n\t\t\t\t\t\tc_element: analyticInfo.from,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\t#notifyErrors(errors: Array): void\n\t{\n\t\tif (errors[0] && errors[0].message)\n\t\t{\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tcontent: Text.encode(errors[0].message),\n\t\t\t});\n\t\t}\n\t}\n\n\texportDashboard(dashboardId: number): void\n\t{\n\t\tconst grid = this.getGrid();\n\t\tgrid.tableFade();\n\n\t\treturn this.#dashboardManager.exportDashboard(dashboardId, 'grid_menu');\n\t}\n\n\tpublish(dashboardId: number): void\n\t{\n\t\tthis.#dashboardManager.toggleDraft(dashboardId, true)\n\t\t\t.then(() => {\n\t\t\t\tthis.updateDashboardStatus(dashboardId, DashboardManager.DASHBOARD_STATUS_READY);\n\t\t\t\tthis.#grid.updateRow(dashboardId);\n\t\t\t})\n\t\t\t.catch(() => {\n\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\tcontent: Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_PUBLISH_NOTIFICATION_ERROR'),\n\t\t\t\t});\n\t\t\t})\n\t\t;\n\t}\n\n\tsetDraft(dashboardId: number): void\n\t{\n\t\tthis.#dashboardManager.toggleDraft(dashboardId, false)\n\t\t\t.then(() => {\n\t\t\t\tthis.updateDashboardStatus(dashboardId, DashboardManager.DASHBOARD_STATUS_DRAFT);\n\t\t\t\tthis.#grid.updateRow(dashboardId, null, null, (result) => {\n\t\t\t\t\tthis.#showDraftGuide(this.#grid.getRows().getById(dashboardId).node);\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch(() => {\n\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\tcontent: Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_SET_DRAFT_NOTIFICATION_ERROR'),\n\t\t\t\t});\n\t\t\t})\n\t\t;\n\t}\n\n\tdeleteDashboard(dashboardId: number, isCustom: boolean): void\n\t{\n\t\tconst message = isCustom\n\t\t\t? Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_DELETE_POPUP_MESSAGE_CUSTOM')\n\t\t\t: Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_DELETE_POPUP_MESSAGE_MARKET')\n\t\t;\n\n\t\tconst deletePopup = new SystemDialog({\n\t\t\ttitle: Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_DELETE_POPUP_TITLE_MSGVER_1'),\n\t\t\tsubtitle: message,\n\t\t\twidth: 400,\n\t\t\thasCloseButton: true,\n\t\t\tcloseByEsc: true,\n\t\t\tdisableScrolling: true,\n\t\t\tcenterButtons: [\n\t\t\t\tnew Button({\n\t\t\t\t\ttext: Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_DELETE_POPUP_CAPTION_YES'),\n\t\t\t\t\tuseAirDesign: true,\n\t\t\t\t\tsize: ButtonSize.LARGE,\n\t\t\t\t\tstyle: AirButtonStyle.FILLED_ALERT,\n\t\t\t\t\tonclick: (button) => {\n\t\t\t\t\t\tbutton.setWaiting();\n\t\t\t\t\t\tthis.#dashboardManager.deleteDashboard(dashboardId)\n\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\tthis.getGrid().reload();\n\t\t\t\t\t\t\t\tdeletePopup.hide();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\t\t\tdeletePopup.hide();\n\t\t\t\t\t\t\t\tif (response.errors)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.#notifyErrors(response.errors);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tnew CancelButton({\n\t\t\t\t\ttext: Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_DELETE_POPUP_CAPTION_NO'),\n\t\t\t\t\tsize: ButtonSize.LARGE,\n\t\t\t\t\tuseAirDesign: true,\n\t\t\t\t\tstyle: AirButtonStyle.PLAIN,\n\t\t\t\t\tonclick: (button) => deletePopup.hide(),\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\n\t\tdeletePopup.show();\n\t}\n\n\tdeleteGroup(groupId: number): void\n\t{\n\t\tconst deletePopup = new SystemDialog({\n\t\t\ttitle: Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_DELETE_GROUP_POPUP_TITLE_MSGVER_1'),\n\t\t\tsubtitle: Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_DELETE_GROUP_POPUP_DESC'),\n\t\t\thasCloseButton: true,\n\t\t\tcloseByEsc: true,\n\t\t\tdisableScrolling: true,\n\t\t\tcenterButtons: [\n\t\t\t\tnew Button({\n\t\t\t\t\ttext: Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_DELETE_GROUP_POPUP_CAPTION_YES'),\n\t\t\t\t\tuseAirDesign: true,\n\t\t\t\t\tsize: ButtonSize.LARGE,\n\t\t\t\t\tstyle: AirButtonStyle.FILLED_ALERT,\n\t\t\t\t\tonclick: (button) => {\n\t\t\t\t\t\tPermissionsAnalytics.sendGroupDeleteAnalytics(PermissionsAnalyticsSource.grid);\n\t\t\t\t\t\tbutton.setWaiting();\n\t\t\t\t\t\tthis.#dashboardManager.deleteGroup(groupId)\n\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\tthis.getGrid().reload();\n\t\t\t\t\t\t\t\tdeletePopup.hide();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\t\t\tdeletePopup.hide();\n\t\t\t\t\t\t\t\tif (response.errors)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.#notifyErrors(response.errors);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tnew CancelButton({\n\t\t\t\t\ttext: Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_DELETE_GROUP_POPUP_CAPTION_NO'),\n\t\t\t\t\tsize: ButtonSize.LARGE,\n\t\t\t\t\tuseAirDesign: true,\n\t\t\t\t\tstyle: AirButtonStyle.PLAIN,\n\t\t\t\t\tonclick: (button) => deletePopup.hide(),\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\n\t\tdeletePopup.show();\n\t}\n\n\topenCreationSlider(): void\n\t{\n\t\tconst filterFieldsValues = this.getFilter().getFilterFieldsValues();\n\t\tconst selectedGroups: string[] = filterFieldsValues['GROUPS.ID'] ?? [];\n\n\t\tthis.#dashboardManager.openCreationSlider(selectedGroups);\n\t}\n\n\tshowCreationGroupPopup(): void\n\t{\n\t\tif (this.#isActiveGroupIdFilter())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#dashboardManager.showCreationGroupPopup();\n\n\t\tPermissionsAnalytics.sendClickGroupActionAnalytics(\n\t\t\tPermissionsAnalyticsSource.grid,\n\t\t\ttrue,\n\t\t);\n\t}\n\n\t#buildDashboardTitleEditor(\n\t\tid: number,\n\t\ttitle: string,\n\t\tonCancel: () => void,\n\t\tonSave: (innerTitle: string) => void,\n\t): HTMLElement\n\t{\n\t\tconst input = Tag.render`\n\t\t\t<input class=\"main-grid-editor main-grid-editor-text\" type=\"text\">\n\t\t`;\n\t\tinput.value = title;\n\n\t\tconst saveInputValue = () => {\n\t\t\tconst value = input.value;\n\t\t\tDom.removeClass(input, 'dashboard-title-input-danger');\n\t\t\tif (value.trim() === '')\n\t\t\t{\n\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\tcontent: Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_CHANGE_TITLE_ERROR_EMPTY'),\n\t\t\t\t});\n\n\t\t\t\tDom.addClass(input, 'dashboard-title-input-danger');\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tDom.style(buttons, 'display', 'none');\n\t\t\tDom.attr(input, 'disabled', true);\n\t\t\tonSave(input.value);\n\t\t};\n\n\t\tEvent.bind(input, 'keydown', (event) => {\n\t\t\tif (event.keyCode === 13)\n\t\t\t{\n\t\t\t\tsaveInputValue();\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t\telse if (event.keyCode === 27)\n\t\t\t{\n\t\t\t\tonCancel();\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t});\n\n\t\tconst applyButton = Tag.render`\n\t\t\t<a>\n\t\t\t\t<i\n\t\t\t\t\tclass=\"ui-icon-set --check\"\n\t\t\t\t\tstyle=\"--ui-icon-set__icon-size: 21px; --ui-icon-set__icon-color: var(--ui-color-palette-gray-40);\"\n\t\t\t\t></i>\n\t\t\t</a>\n\t\t`;\n\n\t\tconst cancelButton = Tag.render`\n\t\t\t<a>\n\t\t\t\t<i\n\t\t\t\t\tclass=\"ui-icon-set --cross-60\"\n\t\t\t\t\tstyle=\"--ui-icon-set__icon-size: 21px; --ui-icon-set__icon-color: var(--ui-color-palette-gray-40);\"\n\t\t\t\t></i>\n\t\t\t</a>\n\t\t`;\n\n\t\tconst buttons = Tag.render`\n\t\t\t<div class=\"dashboard-title-wrapper__buttons\">\n\t\t\t\t${applyButton}\n\t\t\t\t${cancelButton}\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(cancelButton, 'click', () => {\n\t\t\tonCancel();\n\t\t});\n\n\t\tEvent.bind(applyButton, 'click', saveInputValue);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"dashboard-title-wrapper__item dashboard-title-edit\">\n\t\t\t\t${input}\n\t\t\t\t<div class=\"dashboard-title-wrapper__buttons-wrapper\">\n\t\t\t\t\t${buttons}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getTitlePreview(dashboardId: number): ?HTMLElement\n\t{\n\t\tconst grid = this.getGrid();\n\t\tconst row = grid.getRows().getById(dashboardId);\n\t\tif (!row)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst wrapper = row.getCellById('TITLE')?.querySelector('.dashboard-title-wrapper');\n\t\tif (!wrapper)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst previewSection = wrapper.querySelector('.dashboard-title-preview');\n\t\tif (previewSection)\n\t\t{\n\t\t\treturn previewSection;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tshowGroupSettingsPopup(groupId: number): void\n\t{\n\t\tPermissionsAnalytics.sendClickGroupActionAnalytics(\n\t\t\tPermissionsAnalyticsSource.grid,\n\t\t\tfalse,\n\t\t);\n\n\t\tthis.#grid.tableFade();\n\t\tthis.#dashboardManager.showGroupSettingsPopup(groupId)\n\t\t\t.then(() => {\n\t\t\t\tthis.#grid.tableUnfade();\n\t\t\t})\n\t\t\t.catch(() => {\n\t\t\t\tthis.#grid.tableUnfade();\n\t\t\t})\n\t\t;\n\t}\n\n\trenameDashboard(dashboardId: number): void\n\t{\n\t\tconst grid = this.getGrid();\n\t\tconst row = grid.getRows().getById(dashboardId);\n\t\tif (!row)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst rowNode = row.getNode();\n\t\tDom.removeClass(rowNode, 'dashboard-title-edited');\n\n\t\tconst wrapper = row.getCellById('TITLE')?.querySelector('.dashboard-title-wrapper');\n\t\tif (!wrapper)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst editor = this.#buildDashboardTitleEditor(\n\t\t\tdashboardId,\n\t\t\trow.getEditData().TITLE,\n\t\t\t() => {\n\t\t\t\tthis.cancelRenameDashboard(dashboardId);\n\t\t\t},\n\t\t\t(innerTitle) => {\n\t\t\t\tconst oldTitle = this.#getTitlePreview(dashboardId).querySelector('a').innerText;\n\t\t\t\tthis.#getTitlePreview(dashboardId).querySelector('a').innerText = innerTitle;\n\n\t\t\t\tconst rowEditData = row.getEditData();\n\t\t\t\trowEditData.TITLE = innerTitle;\n\t\t\t\tconst editableData = grid.getParam('EDITABLE_DATA');\n\t\t\t\tif (BX.type.isPlainObject(editableData))\n\t\t\t\t{\n\t\t\t\t\teditableData[row.getId()] = rowEditData;\n\t\t\t\t}\n\n\t\t\t\tDom.addClass(rowNode, 'dashboard-title-edited');\n\t\t\t\tconst msg = Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_CHANGE_TITLE_SUCCESS', {\n\t\t\t\t\t'#NEW_TITLE#': Text.encode(innerTitle),\n\t\t\t\t});\n\n\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\tcontent: msg,\n\t\t\t\t});\n\n\t\t\t\tthis.cancelRenameDashboard(dashboardId);\n\t\t\t\tthis.#setDateModifyNow(dashboardId);\n\n\t\t\t\tthis.#dashboardManager.renameDashboard(dashboardId, innerTitle)\n\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\tif (response.errors)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.#notifyErrors(response.errors);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.#getTitlePreview(dashboardId).querySelector('a').innerText = oldTitle;\n\t\t\t\t\t\trowEditData.TITLE = oldTitle;\n\t\t\t\t\t});\n\t\t\t},\n\t\t);\n\n\t\tconst preview = wrapper.querySelector('.dashboard-title-preview');\n\t\tif (preview)\n\t\t{\n\t\t\tDom.style(preview, 'display', 'none');\n\t\t}\n\t\tDom.append(editor, wrapper);\n\n\t\tconst editBtn = row.getCellById('EDIT_URL')?.querySelector('a');\n\n\t\tconst actionsClickHandler = () => {\n\t\t\tEvent.unbind(row.getActionsButton(), 'click', actionsClickHandler);\n\t\t\tif (editBtn)\n\t\t\t{\n\t\t\t\tEvent.unbind(editBtn, 'click', actionsClickHandler);\n\t\t\t}\n\t\t\tthis.cancelRenameDashboard(dashboardId);\n\t\t};\n\t\tEvent.bind(row.getActionsButton(), 'click', actionsClickHandler);\n\t\tif (editBtn)\n\t\t{\n\t\t\tEvent.bind(editBtn, 'click', actionsClickHandler);\n\t\t}\n\t}\n\n\tcancelRenameDashboard(dashboardId): void\n\t{\n\t\tconst row = this.getGrid().getRows().getById(dashboardId);\n\t\tif (!row)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst editSection = row.getCellById('TITLE')?.querySelector('.dashboard-title-edit');\n\t\tconst previewSection = row.getCellById('TITLE')?.querySelector('.dashboard-title-preview');\n\n\t\tif (editSection)\n\t\t{\n\t\t\tDom.remove(editSection);\n\t\t}\n\n\t\tif (previewSection)\n\t\t{\n\t\t\tDom.style(previewSection, 'display', 'flex');\n\t\t}\n\t}\n\n\t#setDateModifyNow(dashboardId: number)\n\t{\n\t\tconst dateModifyCell = this.#grid.getRows().getById(dashboardId)?.getCellById('DATE_MODIFY');\n\t\tif (!dateModifyCell)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst cellContent = dateModifyCell.querySelector('.main-grid-cell-content span');\n\n\t\tconst date = DateTimeFormat.format(\n\t\t\tDateTimeFormat.getFormat('FORMAT_DATETIME'),\n\t\t\tMath.floor(Date.now() / 1000),\n\t\t);\n\t\tconst readableDate = Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_DATE_MODIFY_NOW');\n\t\tconst newCellContent = Tag.render`\n\t\t\t<span data-hint=\"${date}\" data-hint-no-icon data-hint-interactivity>${readableDate}</span>\n\t\t`;\n\n\t\tDom.replace(cellContent, newCellContent);\n\t\tthis.#initHints();\n\t}\n\n\thandleGroupTitleClick(groupJson: Object): void\n\t{\n\t\tthis.handleFilterChange({\n\t\t\tfieldId: 'GROUPS.ID',\n\t\t\t...groupJson,\n\t\t});\n\t}\n\n\thandleTagClick(tagJson: string): void\n\t{\n\t\tconst tag = JSON.parse(tagJson);\n\t\tthis.handleFilterChange({\n\t\t\tfieldId: 'TAGS.ID',\n\t\t\t...tag,\n\t\t});\n\t}\n\n\thandleTagAddClick(dashboardId: number, preselectedIds: [], event: BaseEvent): void\n\t{\n\t\tconst onTagsChange = () => {\n\t\t\tconst tags = this.#tagSelectorDialog.getSelectedItems().map((item) => item.getId());\n\t\t\tthis.#dashboardManager\n\t\t\t\t.setDashboardTags(dashboardId, tags)\n\t\t\t\t.then(\n\t\t\t\t\t() => {\n\t\t\t\t\t\tthis.getGrid().updateRow(dashboardId, null, null, () => {\n\t\t\t\t\t\t\tconst anchor = this.getGrid()\n\t\t\t\t\t\t\t\t.getRows()\n\t\t\t\t\t\t\t\t.getById(dashboardId)\n\t\t\t\t\t\t\t\t?.getCellById('TAGS')\n\t\t\t\t\t\t\t;\n\n\t\t\t\t\t\t\tif (anchor && this.#tagSelectorDialog)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.#tagSelectorDialog.setTargetNode(anchor);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tconst filterTagValues = this.getFilter().getFilterFieldsValues();\n\t\t\t\t\t\tconst currentFilteredTags = filterTagValues['TAGS.ID'] ?? [];\n\t\t\t\t\t\tif (currentFilteredTags.length > 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst filtered = tags.filter((tagId) => currentFilteredTags.includes(String(tagId)));\n\t\t\t\t\t\t\tif (filtered.length === 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.#tagSelectorDialog.destroy();\n\n\t\t\t\t\t\t\t\tthis.#tagSelectorDialog = null;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t)\n\t\t\t\t.catch((response) => {\n\t\t\t\t\tif (response.errors)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#notifyErrors(response.errors);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t;\n\t\t};\n\t\tconst entityId = 'biconnector-superset-dashboard-tag';\n\n\t\tconst preselectedItems = [];\n\t\tJSON.parse(preselectedIds).forEach((id) => preselectedItems.push([entityId, id]));\n\t\tthis.#tagSelectorDialog = new Dialog({\n\t\t\tid: 'biconnector-superset-tag-widget',\n\t\t\ttargetNode: event.getData().button,\n\t\t\tenableSearch: true,\n\t\t\twidth: 350,\n\t\t\theight: 400,\n\t\t\tmultiple: true,\n\t\t\tdropdownMode: true,\n\t\t\tcompactView: true,\n\t\t\tcontext: entityId,\n\t\t\tclearUnavailableItems: true,\n\t\t\tentities: [\n\t\t\t\t{\n\t\t\t\t\tid: entityId,\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tdashboardId,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t\tpreselectedItems,\n\t\t\tsearchOptions: {\n\t\t\t\tallowCreateItem: false,\n\t\t\t},\n\t\t\tfooter: TagFooter,\n\t\t\tevents: {\n\t\t\t\tonSearch: (event: BaseEvent) => {\n\t\t\t\t\tconst query = event.getData().query;\n\n\t\t\t\t\tconst footer: TagFooter = this.#tagSelectorDialog.getFooter();\n\t\t\t\t\tconst footerWrapper = this.#tagSelectorDialog.getFooterContainer();\n\t\t\t\t\tif (Type.isStringFilled(query.trim()) && footer.canCreateTag())\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.show(footerWrapper.querySelector('#tags-widget-custom-footer-add-new'));\n\t\t\t\t\t\tDom.show(footerWrapper.querySelector('#tags-widget-custom-footer-conjunction'));\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tDom.hide(footerWrapper.querySelector('#tags-widget-custom-footer-add-new'));\n\t\t\t\t\tDom.hide(footerWrapper.querySelector('#tags-widget-custom-footer-conjunction'));\n\t\t\t\t},\n\t\t\t\t'Search:onItemCreateAsync': (searchEvent: BaseEvent) => {\n\t\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\t\tconst { searchQuery } = searchEvent.getData();\n\t\t\t\t\t\tconst name = searchQuery.getQuery();\n\n\t\t\t\t\t\tthis.#dashboardManager.addTag(name)\n\t\t\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\t\t\tconst newTag = result.data;\n\t\t\t\t\t\t\t\tconst item = this.#tagSelectorDialog.addItem({\n\t\t\t\t\t\t\t\t\tid: newTag.ID,\n\t\t\t\t\t\t\t\t\tentityId,\n\t\t\t\t\t\t\t\t\ttitle: name,\n\t\t\t\t\t\t\t\t\ttabs: 'all',\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tif (item)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\titem.select();\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch((result) => {\n\t\t\t\t\t\t\t\tconst errors = result.errors;\n\t\t\t\t\t\t\t\terrors.forEach((error) => {\n\t\t\t\t\t\t\t\t\tconst alert = Tag.render`\n\t\t\t\t\t\t\t\t\t\t<div class=\"dashboard-tag-already-exists-alert\">\n\t\t\t\t\t\t\t\t\t\t\t<div class='ui-alert ui-alert-xs ui-alert-danger'> \n\t\t\t\t\t\t\t\t\t\t\t\t<span class='ui-alert-message'>\n\t\t\t\t\t\t\t\t\t\t\t\t\t${error.message}\n\t\t\t\t\t\t\t\t\t\t\t\t</span> \n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t`;\n\n\t\t\t\t\t\t\t\t\tDom.prepend(alert, this.#tagSelectorDialog.getFooterContainer());\n\t\t\t\t\t\t\t\t\tsetTimeout(\n\t\t\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\t\t\tDom.remove(alert);\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t3000,\n\t\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\t\treject();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t;\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t'Item:onSelect': Runtime.debounce(onTagsChange, 100, this),\n\t\t\t\t'Item:onDeselect': Runtime.debounce(onTagsChange, 100, this),\n\t\t\t},\n\t\t});\n\n\t\tthis.#tagSelectorDialog.show();\n\t}\n\n\thandleOwnerClick(ownerData: Object)\n\t{\n\t\tthis.handleFilterChange({\n\t\t\tfieldId: 'OWNER_ID',\n\t\t\t...ownerData,\n\t\t});\n\t}\n\n\thandleCreatedByClick(ownerData: Object)\n\t{\n\t\tthis.handleFilterChange({\n\t\t\tfieldId: 'CREATED_BY_ID',\n\t\t\t...ownerData,\n\t\t});\n\t}\n\n\thandleFilterChange(fieldData: Object)\n\t{\n\t\tconst filterFieldsValues = this.getFilter().getFilterFieldsValues();\n\t\tlet currentFilteredField = filterFieldsValues[fieldData.fieldId] ?? [];\n\t\tlet currentFilteredFieldLabel = filterFieldsValues[`${fieldData.fieldId}_label`] ?? [];\n\n\t\tif (fieldData.IS_FILTERED)\n\t\t{\n\t\t\tcurrentFilteredField = currentFilteredField.filter((value) => parseInt(value, 10) !== fieldData.ID);\n\t\t\tcurrentFilteredFieldLabel = currentFilteredFieldLabel.filter((value) => value !== fieldData.TITLE);\n\t\t}\n\t\telse if (!currentFilteredField.includes(fieldData.ID))\n\t\t{\n\t\t\tcurrentFilteredField.push(fieldData.ID.toString());\n\t\t\tcurrentFilteredFieldLabel.push(fieldData.TITLE);\n\t\t}\n\n\t\tconst filterApi = this.getFilter().getApi();\n\t\tconst filterToExtend = {};\n\t\tfilterToExtend[fieldData.fieldId] = currentFilteredField;\n\t\tfilterToExtend[`${fieldData.fieldId}_label`] = currentFilteredFieldLabel;\n\n\t\tfilterApi.extendFilter(filterToExtend);\n\t\tfilterApi.apply();\n\t}\n\n\taddToTopMenu(dashboardId: number, url: string): Promise\n\t{\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_ADD_TO_TOP_MENU_SUCCESS'),\n\t\t});\n\t\tthis.#switchTopMenuAction(dashboardId, true, url);\n\n\t\treturn this.#dashboardManager.addToTopMenu(dashboardId)\n\t\t\t.then((response) => {})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.#grid.updateRow(dashboardId);\n\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\tcontent: Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_ADD_TO_TOP_MENU_ERROR'),\n\t\t\t\t});\n\t\t\t})\n\t\t;\n\t}\n\n\tdeleteFromTopMenu(dashboardId: number, url: string): Promise\n\t{\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_DELETE_FROM_TOP_MENU_SUCCESS'),\n\t\t});\n\t\tthis.#switchTopMenuAction(dashboardId, false, url);\n\n\t\treturn this.#dashboardManager.deleteFromTopMenu(dashboardId)\n\t\t\t.then((response) => {})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.#grid.updateRow(dashboardId);\n\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\tcontent: Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_DELETE_FROM_TOP_MENU_ERROR'),\n\t\t\t\t});\n\t\t\t})\n\t\t;\n\t}\n\n\t#switchTopMenuAction(dashboardId: number, isInTopMenu: boolean, url: string = '/')\n\t{\n\t\tconst row = this.#grid.getRows().getById(dashboardId);\n\t\tconst rowActions = row?.getActions();\n\t\tfor (const [index, action] of rowActions.entries())\n\t\t{\n\t\t\tif (isInTopMenu && action.ACTION_ID === 'addToTopMenu')\n\t\t\t{\n\t\t\t\trowActions[index].ACTION_ID = 'deleteFromTopMenu';\n\t\t\t\trowActions[index].onclick = `BX.BIConnector.SupersetDashboardGridManager.Instance.deleteFromTopMenu(${dashboardId})`;\n\t\t\t\trowActions[index].text = Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_ACTION_ITEM_DELETE_FROM_TOP_MENU');\n\t\t\t}\n\t\t\telse if (!isInTopMenu && action.ACTION_ID === 'deleteFromTopMenu')\n\t\t\t{\n\t\t\t\trowActions[index].ACTION_ID = 'addToTopMenu';\n\t\t\t\trowActions[index].onclick = `BX.BIConnector.SupersetDashboardGridManager.Instance.addToTopMenu(${dashboardId}, \\`${url}\\`)`;\n\t\t\t\trowActions[index].text = Loc.getMessage('BICONNECTOR_SUPERSET_DASHBOARD_GRID_ACTION_ITEM_ADD_TO_TOP_MENU');\n\t\t\t}\n\t\t}\n\t\trow.setActions(rowActions);\n\n\t\tconst titleCell = row?.getCellById('TITLE');\n\t\tlet dashboardTitle = '';\n\t\tif (titleCell)\n\t\t{\n\t\t\tconst titleWrapper = titleCell.querySelector('.dashboard-title-wrapper__item');\n\t\t\tdashboardTitle = titleWrapper.querySelector('a').innerText;\n\t\t}\n\n\t\tconst menu: BX.Main.interfaceButtons = BX.Main.interfaceButtonsManager.getById('biconnector_superset_menu');\n\t\tif (isInTopMenu && dashboardTitle)\n\t\t{\n\t\t\tmenu.addMenuItem({\n\t\t\t\tID: `biconnector_superset_menu_dashboard_${dashboardId}`,\n\t\t\t\tTEXT: dashboardTitle,\n\t\t\t\tON_CLICK: `window.open(\\`${url}\\`, '_blank');`,\n\n\t\t\t\t// TODO: Temporary workaround for compatibility with main 25.300.0, remove after that version is released\n\t\t\t\tid: `biconnector_superset_menu_dashboard_${dashboardId}`,\n\t\t\t\ttext: dashboardTitle,\n\t\t\t\tonClick: `window.open(\\`${url}\\`, '_blank');`,\n\t\t\t});\n\t\t\tconst menuItem = menu.getItemById(`biconnector_superset_menu_dashboard_${dashboardId}`);\n\t\t\tconst firstMenuItem = menu.getVisibleItems();\n\t\t\tDom.insertBefore(menuItem, firstMenuItem[0]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst menuItem = menu.getItemById(`biconnector_superset_menu_dashboard_${dashboardId}`);\n\t\t\tmenu.deleteMenuItem(menuItem);\n\t\t}\n\t}\n\n\tpin(dashboardId: number): void\n\t{\n\t\treturn this.#dashboardManager.pin(dashboardId)\n\t\t\t.then(() => {\n\t\t\t\tthis.#grid.reload();\n\t\t\t})\n\t\t\t.catch(() => {})\n\t\t;\n\t}\n\n\tunpin(dashboardId: number): void\n\t{\n\t\treturn this.#dashboardManager.unpin(dashboardId)\n\t\t\t.then(() => {\n\t\t\t\tthis.#grid.reload();\n\t\t\t})\n\t\t\t.catch(() => {})\n\t\t;\n\t}\n}\n\nReflection.namespace('BX.BIConnector').SupersetDashboardGridManager = SupersetDashboardGridManager;\n"],"names":["SupersetDashboardGridManager","props","DashboardManager","BX","Main","gridManager","getById","gridId","instance","filterManager","dashboardList","dashboard","updateDashboardStatus","id","status","params","openedFrom","Type","isNumber","dashboardId","includes","type","isStringFilled","editUrl","console","error","grid","getGrid","tableFade","processEditDashboard","editLink","tableUnfade","popupType","ApacheSupersetAnalytics","sendAnalytics","c_sub_section","c_element","toLowerCase","p1","buildAppIdForAnalyticRequest","appId","p2","event","openedMenu","MenuManager","getMenuById","close","items","isAvailableDashboardCreation","push","text","Loc","getMessage","onclick","openCreationSlider","creationMenu","isAvailableGroupCreation","showCreationGroupPopup","disabled","ApacheSupersetMarketManager","openMarket","isMarketExists","marketUrl","create","closeByEsc","closeIcon","cacheable","angle","offsetLeft","autoHide","bindElement","target","show","row","getRows","btn","node","querySelector","isDomNode","isDisabled","getAttribute","setAttribute","Dom","addClass","restartDashboardImport","then","response","dashboardIds","data","restartedDashboardIds","restartedDashboardId","DASHBOARD_STATUS_LOAD","labelWrapper","label","reloadBtn","labelClass","labelTitle","DASHBOARD_STATUS_READY","setTimeout","updateRow","DASHBOARD_STATUS_DRAFT","DASHBOARD_STATUS_FAILED","DASHBOARD_STATUS_COMPUTED_NOT_LOAD","supersetStatus","remove","createdReloadBtn","createReloadBtn","append","labelStatuses","forEach","uiStatus","removeClass","innerText","Tag","render","analyticInfo","duplicateDashboard","gridRealtime","getRealtime","newDashboard","newRow","columns","actions","firstDashboardRow","getRowsByGroupId","find","hasClass","insertBefore","getId","insertAfter","addRow","newRowNode","editableData","getParam","isPlainObject","TITLE","title","counterTotalTextContainer","getCounterTotal","textContent","UI","Notification","Center","notify","content","from","errors","exportDashboard","toggleDraft","result","isCustom","message","deletePopup","SystemDialog","subtitle","width","hasCloseButton","disableScrolling","centerButtons","Button","useAirDesign","size","ButtonSize","LARGE","style","AirButtonStyle","FILLED_ALERT","button","setWaiting","deleteDashboard","reload","hide","CancelButton","PLAIN","groupId","PermissionsAnalytics","sendGroupDeleteAnalytics","PermissionsAnalyticsSource","deleteGroup","filterFieldsValues","getFilter","getFilterFieldsValues","selectedGroups","sendClickGroupActionAnalytics","showGroupSettingsPopup","rowNode","getNode","wrapper","getCellById","editor","getEditData","cancelRenameDashboard","innerTitle","oldTitle","rowEditData","msg","Text","encode","renameDashboard","preview","editBtn","actionsClickHandler","Event","unbind","getActionsButton","bind","editSection","previewSection","groupJson","handleFilterChange","fieldId","tagJson","tag","JSON","parse","preselectedIds","onTagsChange","tags","getSelectedItems","map","item","setDashboardTags","anchor","setTargetNode","filterTagValues","currentFilteredTags","length","filtered","filter","tagId","String","destroy","entityId","preselectedItems","Dialog","targetNode","getData","enableSearch","height","multiple","dropdownMode","compactView","context","clearUnavailableItems","entities","options","searchOptions","allowCreateItem","footer","TagFooter","events","onSearch","query","getFooter","footerWrapper","getFooterContainer","trim","canCreateTag","searchEvent","Promise","resolve","reject","searchQuery","name","getQuery","addTag","newTag","addItem","ID","tabs","select","alert","prepend","Runtime","debounce","ownerData","fieldData","currentFilteredField","currentFilteredFieldLabel","IS_FILTERED","value","parseInt","toString","filterApi","getApi","filterToExtend","extendFilter","apply","url","addToTopMenu","deleteFromTopMenu","pin","unpin","EventEmitter","subscribe","getCompatData","sliderEvent","getEventId","eventArgs","onUpdatedDashboardBatchStatus","isUndefined","currentFilteredTagLabels","index","findIndex","toInteger","splice","PULL","extendWatch","eventName","eventData","group","isTitleEdited","isDashboardListEdited","isScopeListEdited","sendGroupActionAnalytics","isString","startsWith","sendGroupDashboardScopeEditAnalytics","sendGroupScopeEditAnalytics","sendGroupDashboardEditAnalytics","manager","Hint","createInstance","popupParameters","init","getContainer","statusMap","LOAD","ERROR","LIMIT_EXCEEDED","rows","getBodyChild","dashboardStatus","isNeedShowDraftGuide","labelNode","cellNode","closest","guide","Guide","steps","onClose","userOptions","save","rounded","position","areaPadding","onEvents","start","onCancel","onSave","input","saveInputValue","buttons","attr","keyCode","preventDefault","applyButton","cancelButton","dateModifyCell","cellContent","date","DateTimeFormat","format","getFormat","Math","floor","Date","now","readableDate","newCellContent","replace","isInTopMenu","rowActions","getActions","entries","action","ACTION_ID","setActions","titleCell","dashboardTitle","titleWrapper","menu","interfaceButtonsManager","addMenuItem","TEXT","ON_CLICK","onClick","menuItem","getItemById","firstMenuItem","getVisibleItems","deleteMenuItem","Reflection","namespace"],"mappings":"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"}