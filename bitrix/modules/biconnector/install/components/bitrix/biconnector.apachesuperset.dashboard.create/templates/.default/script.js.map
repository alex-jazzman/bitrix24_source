{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { ajax as Ajax, Dom, Loc, Reflection, Tag } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { DashboardParametersSelector } from 'biconnector.dashboard-parameters-selector';\nimport { ApacheSupersetAnalytics } from 'biconnector.apache-superset-analytics';\nimport { Button, ButtonManager } from 'ui.buttons';\n\ntype Props = {\n\tnodeId: string,\n\tcomponentName: string,\n\tsignedParameters: string,\n\tdefaultValues: Object,\n\tscopeParamsMap: Object,\n\tgroupIds: number[],\n\tcanManageGroups: boolean,\n};\n\n/**\n * @namespace BX.BIConnector\n */\nclass SupersetDashboardCreateManager\n{\n\t#props: Props;\n\t#node: HTMLElement;\n\t#paramsSelector: ?DashboardParametersSelector;\n\t#saveButton: Button;\n\n\tconstructor(props: Props)\n\t{\n\t\tthis.#props = props;\n\t\tthis.#node = document.querySelector(`#${this.#props.nodeId}`);\n\t\tthis.#render();\n\t\tthis.#saveButton = ButtonManager.createFromNode(document.querySelector('#dashboard-button-save'));\n\t\tif (this.#props.canManageGroups)\n\t\t{\n\t\t\tthis.#saveButton.setDisabled(true);\n\t\t}\n\t\tEventEmitter.subscribe('BIConnector.DashboardParamsSelector:initCompleted', this.#onParamSelectorInit.bind(this));\n\t}\n\n\t#render(): void\n\t{\n\t\tDom.append(this.#getTopBlock(), this.#node);\n\t\tDom.append(this.#getMainContent(), this.#node);\n\n\t\tif (this.#props.canManageGroups)\n\t\t{\n\t\t\tthis.#paramsSelector = new DashboardParametersSelector({\n\t\t\t\tgroups: new Set(),\n\t\t\t\tscopes: new Set(),\n\t\t\t\tparams: new Set(),\n\t\t\t\tscopeParamsMap: this.#props.scopeParamsMap,\n\t\t\t});\n\t\t\tDom.append(this.#paramsSelector.getLayout(), this.#node);\n\t\t}\n\t}\n\n\t#getMainContent(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div>\n\t\t\t\t<div class=\"dashboard-params-title-container\">\n\t\t\t\t\t<div class=\"dashboard-params-title\">\n\t\t\t\t\t\t${Loc.getMessage('DASHBOARD_CREATE_NAME')}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100 dashboard-title-wrapper\">\n\t\t\t\t\t<input type=\"text\" class=\"ui-ctl-element\" id=\"dashboard-title-field\" value=\"${this.#props.defaultValues.title}\">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getTopBlock(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"dashboard-create-top-block\">\n\t\t\t\t<div class=\"dashboard-create-top-block-image\"></div>\n\t\t\t\t<div class=\"dashboard-create-top-block-text\">\n\t\t\t\t\t${Loc.getMessage('DASHBOARD_CREATE_TOP_BLOCK')}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#onParamSelectorInit(): void\n\t{\n\t\tthis.#paramsSelector.selectGroups(this.#props.groupIds);\n\t\tthis.#saveButton.setDisabled(false);\n\t}\n\n\t// noinspection JSUnusedGlobalSymbols\n\tonClickSave(): void\n\t{\n\t\tconst titleField = document.querySelector('#dashboard-title-field');\n\t\tconst saveData = {\n\t\t\ttitle: titleField.value,\n\t\t};\n\n\t\tif (this.#props.canManageGroups)\n\t\t{\n\t\t\tconst selectorData = this.#paramsSelector.getValues();\n\t\t\tsaveData.groups = [...selectorData.groups];\n\t\t\tsaveData.scopes = [...selectorData.scopes];\n\t\t\tsaveData.params = [...selectorData.params];\n\t\t}\n\n\t\tthis.#saveButton.setWaiting(true);\n\n\t\tAjax.runComponentAction(\n\t\t\tthis.#props.componentName,\n\t\t\t'save',\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tsignedParameters: this.#props.signedParameters,\n\t\t\t\tdata: {\n\t\t\t\t\tdata: saveData,\n\t\t\t\t},\n\t\t\t},\n\t\t)\n\t\t\t.then((response) => {\n\t\t\t\tApacheSupersetAnalytics.sendAnalytics('new', 'report_new', {\n\t\t\t\t\ttype: 'custom',\n\t\t\t\t\tc_element: 'new_button',\n\t\t\t\t});\n\t\t\t\twindow.open(response.data.dashboard.detailUrl, '_blank')?.focus();\n\t\t\t\tparent.BX.Event.EventEmitter.emit('BIConnector.CreateForm:onDashboardCreated', {\n\t\t\t\t\tdashboard: response.data.dashboard,\n\t\t\t\t});\n\t\t\t\tBX.SidePanel.Instance.getTopSlider().close();\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\tcontent: response.errors[0].message,\n\t\t\t\t});\n\t\t\t\tthis.#saveButton.setWaiting(false);\n\t\t\t});\n\t}\n}\n\nReflection.namespace('BX.BIConnector').SupersetDashboardCreateManager = SupersetDashboardCreateManager;\n"],"names":["SupersetDashboardCreateManager","props","document","querySelector","nodeId","ButtonManager","createFromNode","canManageGroups","setDisabled","EventEmitter","subscribe","bind","titleField","saveData","title","value","selectorData","getValues","groups","scopes","params","setWaiting","Ajax","runComponentAction","componentName","mode","signedParameters","data","then","response","ApacheSupersetAnalytics","sendAnalytics","type","c_element","window","open","dashboard","detailUrl","focus","parent","BX","Event","emit","SidePanel","Instance","getTopSlider","close","UI","Notification","Center","notify","content","errors","message","Dom","append","DashboardParametersSelector","Set","scopeParamsMap","getLayout","Tag","render","Loc","getMessage","defaultValues","selectGroups","groupIds","Reflection","namespace"],"mappings":"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"}