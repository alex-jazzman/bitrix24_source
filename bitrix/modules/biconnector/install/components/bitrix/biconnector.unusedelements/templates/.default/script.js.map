{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { ajax as Ajax, Loc, Reflection, Text } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { MessageBox } from 'ui.dialogs.messagebox';\n\ntype ElementToDelete = {\n\telementId: number,\n\telementType: 'chart' | 'dataset',\n};\n\ntype GridRowEditableData = {\n\tTITLE: string,\n\tEXTERNAL_ID: number,\n\tTYPE: string,\n}\n\n/**\n * @namespace BX.BIConnector\n */\nclass UnusedElementsGridManager\n{\n\t#grid: BX.Main.grid;\n\n\tconstructor(props)\n\t{\n\t\tthis.#grid = BX.Main.gridManager.getById(props.gridId)?.instance;\n\t\tthis.#initHints();\n\t\tthis.#subscribeToEvents();\n\t}\n\n\t#initHints(): void\n\t{\n\t\tconst manager = BX.UI.Hint.createInstance({\n\t\t\tpopupParameters: {\n\t\t\t\tautoHide: true,\n\t\t\t},\n\t\t});\n\t\tmanager.init(this.#grid.getContainer());\n\t}\n\n\t#subscribeToEvents(): void\n\t{\n\t\tEventEmitter.subscribe('Grid::updated', () => {\n\t\t\tthis.#initHints();\n\t\t});\n\t}\n\n\tdeleteElement(elements: ElementToDelete[])\n\t{\n\t\tlet popupTitle = Loc.getMessage('BI_UNUSED_ELEMENTS_POPUP_DELETE_TITLE_SINGLE');\n\t\tlet popupText = Loc.getMessage('BI_UNUSED_ELEMENTS_POPUP_DELETE_TEXT_SINGLE');\n\t\tif (elements.length > 1)\n\t\t{\n\t\t\tpopupTitle = Loc.getMessage('BI_UNUSED_ELEMENTS_POPUP_DELETE_TITLE');\n\t\t\tpopupText = Loc.getMessage('BI_UNUSED_ELEMENTS_POPUP_DELETE_TEXT');\n\t\t}\n\t\tconst messageBox = new MessageBox({\n\t\t\ttitle: popupTitle,\n\t\t\tmessage: popupText,\n\t\t\tmaxWidth: 300,\n\t\t\tminWidth: 300,\n\t\t\tbuttons: [\n\t\t\t\tnew BX.UI.Button({\n\t\t\t\t\tcolor: BX.UI.Button.Color.DANGER,\n\t\t\t\t\ttext: Loc.getMessage('BI_UNUSED_ELEMENTS_POPUP_DELETE_BUTTON_YES'),\n\t\t\t\t\tonclick: (button) => {\n\t\t\t\t\t\tbutton.setWaiting();\n\t\t\t\t\t\tAjax.runComponentAction('bitrix:biconnector.unusedelements', 'delete', {\n\t\t\t\t\t\t\tmode: 'class',\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\telements,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\tthis.#grid.reload();\n\t\t\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t\t\t\tif (response.errors)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.#notifyErrors(response.errors);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tnew BX.UI.CancelButton({\n\t\t\t\t\ttext: Loc.getMessage('BI_UNUSED_ELEMENTS_POPUP_DELETE_BUTTON_NO'),\n\t\t\t\t\tonclick: () => messageBox.close(),\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\n\t\tmessageBox.show();\n\t}\n\n\t// noinspection JSUnusedGlobalSymbols\n\topenElement(openUrl: string)\n\t{\n\t\tthis.#grid.tableFade();\n\t\tAjax.runComponentAction('bitrix:biconnector.unusedelements', 'getOpenUrl', {\n\t\t\tmode: 'class',\n\t\t\tdata: {\n\t\t\t\topenUrl,\n\t\t\t},\n\t\t})\n\t\t\t.then((response) => {\n\t\t\t\tconst link = response.data;\n\t\t\t\tif (link)\n\t\t\t\t{\n\t\t\t\t\twindow.open(link, '_blank').focus();\n\t\t\t\t}\n\t\t\t\tthis.#grid.tableUnfade();\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tif (response.errors)\n\t\t\t\t{\n\t\t\t\t\tthis.#notifyErrors(response.errors);\n\t\t\t\t}\n\t\t\t\tthis.#grid.tableUnfade();\n\t\t\t});\n\t}\n\n\t// noinspection JSUnusedGlobalSymbols\n\tdeleteSelectedElements()\n\t{\n\t\tconst selectedElements = this.#grid.getRows().getSelected();\n\t\tconst elementsToDelete: ElementToDelete[] = [];\n\n\t\tfor (const row: BX.Grid.Row of selectedElements)\n\t\t{\n\t\t\tconst rowData: GridRowEditableData = row.getEditData();\n\t\t\telementsToDelete.push({\n\t\t\t\telementId: rowData.EXTERNAL_ID,\n\t\t\t\telementType: rowData.TYPE,\n\t\t\t});\n\t\t}\n\t\tthis.deleteElement(elementsToDelete);\n\t}\n\n\t#notifyErrors(errors: Array): void\n\t{\n\t\tif (errors[0] && errors[0].message)\n\t\t{\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tcontent: Text.encode(errors[0].message),\n\t\t\t});\n\t\t}\n\t}\n}\n\nReflection.namespace('BX.BIConnector').UnusedElementsGridManager = UnusedElementsGridManager;\n"],"names":["UnusedElementsGridManager","props","BX","Main","gridManager","getById","gridId","instance","elements","popupTitle","Loc","getMessage","popupText","length","messageBox","MessageBox","title","message","maxWidth","minWidth","buttons","UI","Button","color","Color","DANGER","text","onclick","button","setWaiting","Ajax","runComponentAction","mode","data","then","reload","close","response","errors","CancelButton","show","openUrl","tableFade","link","window","open","focus","tableUnfade","selectedElements","getRows","getSelected","elementsToDelete","row","rowData","getEditData","push","elementId","EXTERNAL_ID","elementType","TYPE","deleteElement","manager","Hint","createInstance","popupParameters","autoHide","init","getContainer","EventEmitter","subscribe","Notification","Center","notify","content","Text","encode","Reflection","namespace"],"mappings":"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"}