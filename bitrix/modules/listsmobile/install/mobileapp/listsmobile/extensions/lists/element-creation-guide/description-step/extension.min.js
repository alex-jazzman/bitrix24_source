jn.define("lists/element-creation-guide/description-step",((e,t,i)=>{const s=e("apptheme");const{Loc:r}=e("loc");const{WizardStep:n}=e("layout/ui/wizard/step");const{EventEmitter:o}=e("event-emitter");const{NotifyManager:a}=e("notify-manager");const{Random:d}=e("utils/random");const{DescriptionStepComponent:h}=e("lists/element-creation-guide/description-step/component");const{ProgressBarNumber:l}=e("lists/wizard/progress-bar-number");class c extends n{constructor(e){super(e);this.uid=e.uid||d.getString();this.customEventEmitter=o.createWithUid(this.uid);this.iBlockId=this.props.iBlockId||null;this.name=this.props.name||null;this.formattedTime=this.props.formattedTime||null;this.prevIBlockId=null;this.prevDescription=null;this.description=null;this.hasFieldsToRender=true;this.isConstantsTuned=false;this.sign="";this.startTime=null;this.subscribeOnEvents()}subscribeOnEvents(){this.customEventEmitter.on("DescriptionStepComponent:onAfterLoadDescription",(({description:e,hasFieldsToRender:t,sign:i,isConstantsTuned:s,hasErrors:r})=>{this.description=e;this.startTime=this.getCurrentTime();if(this.prevDescription===null){this.prevDescription=this.description}this.hasFieldsToRender=t;this.isConstantsTuned=s;this.sign=i;this.customEventEmitter.emit("DescriptionStep:onAfterLoadDescription",[this.startTime]);this.stepAvailabilityChangeCallback(!r);if(r){this.description=null;this.prevDescription=null;this.hasFieldsToRender=true;this.isConstantsTuned=true;this.sign=null}}))}get isLoaded(){return this.description!==null}get isPreviousSelectedIBlockId(){return this.iBlockId===this.prevIBlockId}getCurrentTime(){return Math.round(Date.now()/1e3)}onEnterStep(){super.onEnterStep();if(this.isPreviousSelectedIBlockId){this.description=this.prevDescription;this.stepAvailabilityChangeCallback(true)}if(!this.isLoaded){this.hasFieldsToRender=true;this.isConstantsTuned=false;this.sign="";this.stepAvailabilityChangeCallback(false)}}onMoveToBackStep(e){this.prevIBlockId=this.iBlockId;this.prevDescription=this.description;this.description=null}async onMoveToNextStep(e){const t={finish:false,next:false};const i={finish:false,next:true};const s={finish:true,next:false};if(!this.isConstantsTuned){a.showError(r.getMessage("LISTSMOBILE_EXT_ELEMENT_CREATION_GUIDE_DESCRIPTION_STEP_CONSTANTS_NOT_CONFIGURED"));return Promise.resolve(t)}if(this.hasFieldsToRender){return Promise.resolve(i)}await a.showLoadingIndicator();return new Promise((e=>{BX.ajax.runAction("listsmobile.ElementCreationGuide.createElement",{data:{sign:this.sign,fields:{IBLOCK_ID:this.iBlockId},timeToStart:this.getCurrentTime()-this.startTime}}).then((()=>{a.hideLoadingIndicator(true);e(s)})).catch((i=>{console.error(i.errors);a.hideLoadingIndicator(false);if(Array.isArray(i.errors)){a.showErrors(i.errors)}e(t)}))}))}updateProps(e){if(this.isLoaded){this.onMoveToBackStep()}this.iBlockId=e.iBlockId===undefined?this.iBlockId:e.iBlockId;this.name=e.name===undefined?this.name:e.name;this.formattedTime=e.formattedTime===undefined?this.formattedTime:e.formattedTime}renderNumberBlock(){return new l({isCompleted:this.isLoaded,number:this.props.stepNumber})}getProgressBarSettings(){return{...super.getProgressBarSettings(),isEnabled:true,title:{text:r.getMessage("LISTSMOBILE_EXT_ELEMENT_CREATION_GUIDE_DESCRIPTION_STEP_TITLE")},number:this.props.stepNumber,count:this.hasFieldsToRender?this.props.totalSteps:this.props.totalSteps-1,previousLineColor:this.isLoaded?s.colors.accentMainSuccess:s.colors.base6,currentLineColor:this.isLoaded?s.colors.accentExtraAqua:s.colors.base6,nextLineColor:s.colors.base6}}getTitle(){return this.props.title||""}getNextStepButtonText(){if(this.isLoaded&&!this.hasFieldsToRender){return r.getMessage("LISTSMOBILE_EXT_ELEMENT_CREATION_GUIDE_DESCRIPTION_STEP_NEXT_STEP_IS_FINAL_TITLE")}return r.getMessage("LISTSMOBILE_EXT_ELEMENT_CREATION_GUIDE_DESCRIPTION_STEP_NEXT_STEP_TITLE")}isNextStepEnabled(){return this.isLoaded}isPrevStepEnabled(){return this.isLoaded}createLayout(e){return new h({layout:this.props.layout,uid:this.uid,iBlockId:this.iBlockId,name:this.name,formattedTime:this.formattedTime,description:this.isPreviousSelectedIBlockId?this.prevDescription:this.description})}}i.exports={DescriptionStep:c}}));
//# sourceMappingURL=extension.map.js