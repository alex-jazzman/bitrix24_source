jn.define("lists/element-creation-guide/detail-step",((t,e,i)=>{const{Loc:s}=t("loc");const{WizardStep:n}=t("layout/ui/wizard/step");const{EventEmitter:o}=t("event-emitter");const{FocusManager:r}=t("layout/ui/fields/focus-manager");const{NotifyManager:a}=t("notify-manager");const{AnalyticsEvent:l}=t("analytics");const{Type:d}=t("type");const{Random:h}=t("utils/random");const{ProgressBarNumber:c}=t("lists/wizard/progress-bar-number");const{DetailStepComponent:u}=t("lists/element-creation-guide/detail-step/component");class p extends n{constructor(t){super(t);this.uid=t.uid||h.getString();this.customEventEmitter=o.createWithUid(this.uid);this.elementId=t.elementId;this.iBlockId=t.iBlockId;this.prevElementId=null;this.prevIBlockId=null;this.editorConfig=null;this.sign=null;this.prevEditorConfig=null;this.component=null;this.componentRefCallback=t=>{this.component=t};this.subscribeOnEvents()}get isLoaded(){return this.editorConfig!==null}getCurrentTime(){return Math.round(Date.now()/1e3)}subscribeOnEvents(){this.customEventEmitter.on("DetailStepComponent:OnAfterLoad",((t,e)=>{this.editorConfig=e;this.sign=t;if(this.prevEditorConfig===null){this.prevEditorConfig=this.editorConfig}this.stepAvailabilityChangeCallback(true)})).on("DetailStepComponent:onFieldChangeState",(()=>{this.customEventEmitter.emit("DetailStep:onFieldChangeState")}))}get isPreviousSelectedDetailContent(){return this.prevIBlockId===this.iBlockId&&this.prevElementId===this.elementId}onEnterStep(){super.onEnterStep();if(this.isPreviousSelectedDetailContent){this.editorConfig=this.prevEditorConfig;this.stepAvailabilityChangeCallback(true)}if(!this.isLoaded){this.sign=null;this.stepAvailabilityChangeCallback(false)}}async onMoveToBackStep(t){await a.showLoadingIndicator();return new Promise((t=>{this.prevElementId=this.elementId;this.prevIBlockId=this.iBlockId;this.prevEditorConfig=this.editorConfig;this.editorConfig=null;this.component.getData().then((t=>{this.prevEditorConfig.ENTITY_DATA=Object.assign(this.prevEditorConfig.ENTITY_DATA,t)})).catch((t=>{console.error(t)})).finally((()=>{a.hideLoadingIndicator(true);t()}))}))}updateProps(t){if(this.isLoaded){this.prevElementId=this.elementId;this.prevIBlockId=this.iBlockId;this.prevEditorConfig=this.editorConfig;this.editorConfig=null}this.elementId=t.elementId===undefined?this.elementId:t.elementId;this.iBlockId=t.iBlockId===undefined?this.iBlockId:t.iBlockId;this.startTime=t.startTime===undefined?this.startTime:t.startTime}renderNumberBlock(){return new c({isCompleted:false,number:this.props.stepNumber})}getProgressBarSettings(){return{...super.getProgressBarSettings(),isEnabled:true,title:{text:s.getMessage("LISTSMOBILE_EXT_ELEMENT_CREATION_GUIDE_DETAIL_STEP_TITLE")},number:this.props.stepNumber,count:this.props.totalSteps}}getTitle(){return this.props.title||""}getNextStepButtonText(){return s.getMessage("LISTSMOBILE_EXT_ELEMENT_CREATION_GUIDE_DETAIL_STEP_NEXT_STEP_TITLE")}isNextStepEnabled(){return this.isLoaded}isPrevStepEnabled(){return this.isLoaded}async onMoveToNextStep(t){await a.showLoadingIndicator();return new Promise((t=>{const e=(t,e=[])=>{let i=t?"success":"error";if(!d.isArrayFilled(e)){i+=e[0]?.code?`_${e[0]?.code}`:""}new l({tool:"automation",category:"bizproc_operations",event:"process_run",type:"run",c_section:this.analyticsSection,status:i}).send()};const i=i=>{console.error(i);e(false,i);a.hideLoadingIndicator(false);if(Array.isArray(i)){a.showErrors(i)}t({finish:false,next:false})};const s=()=>{a.hideLoadingIndicator(true);e(true);t({finish:true,next:true})};r.blurFocusedFieldIfHas().then((()=>this.component.validate())).then((()=>this.component.getData())).then((t=>this.startCreateProcess(t))).then((()=>s())).catch((t=>i(t)))}))}startCreateProcess(t){t.IBLOCK_ID=this.iBlockId;return new Promise(((e,i)=>{BX.ajax.runAction("listsmobile.ElementCreationGuide.createElement",{data:{sign:this.sign,fields:t,timeToStart:this.startTime===undefined?null:this.getCurrentTime()-this.startTime}}).then((()=>e())).catch((t=>i(t.errors)))}))}createLayout(t){return new u({layout:this.props.layout,uid:this.uid,iBlockId:this.iBlockId,elementId:this.elementId,editorConfig:this.isPreviousSelectedDetailContent?this.prevEditorConfig:this.editorConfig,ref:this.componentRefCallback})}}i.exports={DetailStep:p}}));
//# sourceMappingURL=extension.map.js