jn.define("lists/element-creation-guide/catalog-step/component",((t,e,s)=>{const{PureComponent:i}=t("layout/pure-component");const{CatalogStepView:o}=t("lists/element-creation-guide/catalog-step/view");const{EventEmitter:n}=t("event-emitter");const{Duration:r}=t("utils/date/duration");const{Random:a}=t("utils/random");const{NotifyManager:m}=t("notify-manager");const{StorageCache:c}=t("storage-cache");class d extends i{constructor(t){super(t);this.state={items:null,cachedItems:null};this.isLoading=false;this.uid=t.uid||a.getString();this.customEventEmitter=n.createWithUid(this.uid);this.selectedItem=this.props.selectedItem||null;this.cache=new c("lists.element-create-guide.catalog-step",`catalog-${env.userId}`);this.loadFromCache();this.subscribeOnEvents()}subscribeOnEvents(){this.customEventEmitter.on("CatalogStepView:OnSelectItem",(t=>{this.selectedItem=t;this.customEventEmitter.emit("CatalogStepComponent:OnSelectItem",[t])}))}loadFromCache(){const t=this.cache.get();if(this.state.items!==null||Object.keys(t).length===0){return}this.state.cachedItems=Object.values(t)}get isLoaded(){return this.state.items!==null}loadItems(){if(this.isLoaded||this.isLoading){return}this.isLoading=true;let t=[];BX.ajax.runAction("listsmobile.ElementCreationGuide.loadCatalogStep",{}).then((e=>{t=e.data.items||[]})).catch((t=>{console.error(t.errors);if(Array.isArray(t.errors)){m.showErrors(t.errors)}})).finally((()=>{this.isLoading=false;const e=t.map((t=>{const e=this.getFormattedTime(t);return{...t,formattedTime:e}}));this.cache.set(e);this.setState({items:e,cachedItems:e})}))}getFormattedTime(t){if(t.time===null||t.time===undefined||t.time===""){return null}const e=r.createFromSeconds(t.time);const s={s:e.getUnitPropertyModByFormat("s"),i:e.getUnitPropertyModByFormat("i"),H:e.getUnitPropertyModByFormat("H"),d:e.getUnitPropertyModByFormat("d"),m:e.getUnitPropertyModByFormat("m"),Y:e.getUnitPropertyModByFormat("Y")};const i=this.roundTime(s);if(i.Y!==0){return new r(i.Y*r.getLengthFormat().YEAR).format("Y")}if(i.m!==0){return new r(i.m*r.getLengthFormat().MONTH).format("m")}if(i.d!==0){return new r(i.d*r.getLengthFormat().DAY).format("d")}if(i.H!==0){return new r(i.H*r.getLengthFormat().HOUR).format("H")}if(i.i!==0){return new r(i.i*r.getLengthFormat().MINUTE).format("i")}return e.format("s")}roundTime(t){const e=t.s;const s=t.i!==0&&e>=30?t.i+1:t.i;const i=t.H!==0&&s>=30?t.H+1:t.H;const o=t.d!==0&&i>=12?t.d+1:t.d;const n=t.m!==0&&o>=15?t.m+1:t.m;const r=t.Y!==0&&n>=6?t.Y+1:t.Y;return{s:e,i:s,H:i,d:o,m:n,Y:r}}render(){this.loadItems();return new o({uid:this.uid,items:this.isLoaded?this.state.items:this.state.cachedItems,isLoaded:this.isLoaded||this.state.cachedItems!==null,selectedItem:this.selectedItem,layout:this.props.layout})}}s.exports={CatalogStepComponent:d}}));
//# sourceMappingURL=component.map.js