jn.define("bizproc/task/details/buttons",((t,e,s)=>{const o=t("apptheme");const{Alert:i}=t("alert");const{EventEmitter:n}=t("event-emitter");const{Loc:r}=t("loc");const{NotifyManager:a}=t("notify-manager");const{showToast:l,Position:h}=t("toast");const{Random:u}=t("utils/random");const{PureComponent:c}=t("layout/pure-component");const{TaskErrorCode:d,TaskUserStatus:p}=t("bizproc/task/task-constants");const{TaskButtons:T,DelegateButton:g}=t("bizproc/task/buttons");const{AppRatingClient:k}=t("bizproc/app-rating-client");class m extends c{constructor(t){super(t);this.uid=t.uid||u.getString();this.customEventEmitter=n.createWithUid(this.uid)}get layout(){return this.props.layout}get task(){return this.props.task}get isMyTask(){return this.props.isMyTask}get canShowTaskButtons(){return this.isMyTask&&!this.props.isTaskCompleted&&this.task.buttons&&this.task.buttons.length>0}get canShowDelegateButton(){return!this.props.isTaskCompleted&&this.props.canDelegate}get canShowTimelineButton(){return this.isMyTask}render(){const t=this.canShowTaskButtons||!this.isMyTask&&this.canShowDelegateButton;const e=this.canShowTimelineButton||this.isMyTask&&this.canShowDelegateButton;return ScrollView({style:{height:64},horizontal:true},View({style:{paddingTop:16,paddingBottom:12,flexDirection:"row",alignContent:"center",alignItems:"center",paddingHorizontal:11},testId:"MBP_TASK_DETAILS_HORIZONTAL_BUTTONS"},this.canShowTaskButtons&&this.renderTaskButtons(),!this.isMyTask&&this.canShowDelegateButton&&this.renderDelegateButton(),t&&e&&this.renderSeparator(),this.canShowTimelineButton&&this.renderTimelineButton(),this.isMyTask&&this.canShowDelegateButton&&this.renderDelegateButton()))}renderTaskButtons(){return View({style:{maxWidth:device.screen.width*.69}},new T({uid:this.uid,testId:"TASK_DETAILS_BUTTONS",task:this.task,onBeforeAction:this.onBeforeTaskButtonAction.bind(this),onComplete:this.onTaskCompleted.bind(this),onFail:this.onTaskCompleteFailed.bind(this)}))}async onBeforeTaskButtonAction(t,e,s){await a.showLoadingIndicator();if(!this.props.detailsRef){return Promise.resolve(null)}let o=false;const i=await this.props.detailsRef.getFieldValues(e).catch((()=>{o=true}));if(!o){if(this.layout&&this.props.isNeedFastClose){this.layout.close((()=>{BX.postComponentEvent("AppRatingManager.onBizProcTaskCompleted",[s?.taskRequest])}))}return Promise.resolve(i)}a.hideLoadingIndicator(false);return Promise.reject()}onTaskCompleted(t,e){a.hideLoadingIndicatorWithoutFallback();this.customEventEmitter.emit("TaskDetails:OnTaskCompleted",[{response:t,request:e,task:this.task}]);setTimeout((()=>{if(this.layout){this.layout.close((()=>{if(e?.taskRequest?.INLINE_USER_STATUS===p.YES||e?.taskRequest?.INLINE_USER_STATUS===p.OK){k.increaseBusinessProcessExecutedCounter();k.tryOpenAppRatingAfterBusinessProcessExecuted()}}))}}),280)}onTaskCompleteFailed(t){a.hideLoadingIndicator(false);this.customEventEmitter.emit("TaskDetails:OnTaskCompleteFailed",[{errors:t,task:this.task}])}renderDelegateButton(){return new g({onClick:this.props.onDelegateButtonClick,style:{flexGrow:null}})}renderSeparator(){return View({style:{marginLeft:12,width:1,height:19,backgroundColor:o.colors.base6}})}renderTimelineButton(){return View({style:{paddingLeft:12,height:64,flexDirection:"row",alignItems:"center"}},View({style:{justifyContent:"center",height:36,borderRadius:8,borderWidth:1,borderColor:o.colors.base5,padding:8,paddingHorizontal:10,marginRight:12,maxWidth:157},onClick:this.props.onTimelineButtonClick},Text({style:{fontWeight:"500",fontSize:14,color:o.colors.base2},text:r.getMessage("BPMOBILE_TASK_DETAILS_TIMELINE_MSGVER_1")})),this.renderTimelineCounter())}renderTimelineCounter(){let t=this.props.allTaskCount;if(!this.props.isTaskCompleted){t-=1}if(t<=0){return null}return Text({style:{position:"absolute",top:10,left:7,width:18,height:18,borderRadius:9,backgroundColor:o.colors.accentMainAlert,textAlign:"center",color:o.colors.baseWhiteFixed,fontSize:12,fontWeight:"500"},text:String(t)})}}s.exports={TaskDetailsButtons:m}}));
//# sourceMappingURL=buttons.map.js