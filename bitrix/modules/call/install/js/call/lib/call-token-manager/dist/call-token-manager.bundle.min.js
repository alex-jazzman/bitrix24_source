this.BX=this.BX||{};this.BX.Call=this.BX.Call||{};(function(e,s){"use strict";const{callInstalled:l}=s.Extension.getSettings("call.core");var a=babelHelpers.classPrivateFieldLooseKey("tokenList");var t=babelHelpers.classPrivateFieldLooseKey("pendingTokenList");var i=babelHelpers.classPrivateFieldLooseKey("queryParams");var r=babelHelpers.classPrivateFieldLooseKey("userToken");var o=babelHelpers.classPrivateFieldLooseKey("loadToken");class b{constructor(){Object.defineProperty(this,o,{value:c});Object.defineProperty(this,a,{writable:true,value:void 0});Object.defineProperty(this,t,{writable:true,value:void 0});Object.defineProperty(this,i,{writable:true,value:void 0});Object.defineProperty(this,r,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,a)[a]={};babelHelpers.classPrivateFieldLooseBase(this,t)[t]={};babelHelpers.classPrivateFieldLooseBase(this,i)[i]={};if(l){babelHelpers.classPrivateFieldLooseBase(this,r)[r]=s.Loc.getMessage("user_jwt")}}setQueryParams(e){if(!s.Type.isPlainObject(e)){return}babelHelpers.classPrivateFieldLooseBase(this,i)[i]=e}getTokenCached(e){return babelHelpers.classPrivateFieldLooseBase(this,a)[a][e]}async getToken(e){const s=babelHelpers.classPrivateFieldLooseBase(this,a)[a][e];const l=babelHelpers.classPrivateFieldLooseBase(this,t)[t][e];if(s){return s}if(l){return l}babelHelpers.classPrivateFieldLooseBase(this,t)[t][e]=new Promise((s=>{babelHelpers.classPrivateFieldLooseBase(this,o)[o](e).then((()=>{delete babelHelpers.classPrivateFieldLooseBase(this,t)[t][e];s(babelHelpers.classPrivateFieldLooseBase(this,a)[a][e])}))}));return babelHelpers.classPrivateFieldLooseBase(this,t)[t][e]}setToken(e,s){babelHelpers.classPrivateFieldLooseBase(this,a)[a][e]=s}async getUserToken(e){const s=babelHelpers.classPrivateFieldLooseBase(this,t)[t][e];if(babelHelpers.classPrivateFieldLooseBase(this,r)[r]){return babelHelpers.classPrivateFieldLooseBase(this,r)[r]}if(s){return s}babelHelpers.classPrivateFieldLooseBase(this,t)[t][e]=new Promise((s=>{babelHelpers.classPrivateFieldLooseBase(this,o)[o](e).then((()=>{delete babelHelpers.classPrivateFieldLooseBase(this,t)[t][e];s(babelHelpers.classPrivateFieldLooseBase(this,r)[r])}))}));return babelHelpers.classPrivateFieldLooseBase(this,t)[t][e]}setUserToken(e){babelHelpers.classPrivateFieldLooseBase(this,r)[r]=e}clearTokenList(){babelHelpers.classPrivateFieldLooseBase(this,a)[a]={};babelHelpers.classPrivateFieldLooseBase(this,t)[t]={};babelHelpers.classPrivateFieldLooseBase(this,r)[r]=null}}async function c(e){try{var s,l;const a={chatId:e,...babelHelpers.classPrivateFieldLooseBase(this,i)[i]};const t=await BX.rest.callMethod("call.Call.getCallToken",a);const r=(s=t.data())==null?void 0:s.callToken;const o=(l=t.data())==null?void 0:l.userToken;if(r){this.setToken(e,r)}if(o){this.setUserToken(o)}}catch(e){console.error("Error during call token retrieving",e)}}const n=new b;e.CallTokenManager=n})(this.BX.Call.Lib=this.BX.Call.Lib||{},BX);
//# sourceMappingURL=call-token-manager.bundle.map.js