{"version":3,"file":"call.bundle.js","sources":["../src/hacks.js","../src/dialogs/background_dialog.js","../../lib/hardware/src/hardware.js","../src/call_hardware.js","../src/call_api.js","../src/engine/logger.js","../src/engine/abstract_call.js","../src/view/tools.js","../src/view/user-registry.js","../src/view/svg.js","../src/view/buttons.js","../src/view/mobile.js","../src/view/call-user.js","../src/view/floor-request.js","../src/view/notifications.js","../src/view/device-selector.js","../src/view/copilot-notify.js","../src/call_ai.js","../src/view/media-renderer.js","../src/engine/unsupported_features_in_browsers.js","../src/view/pictureInPictureWindow.js","../src/view/user-selector.js","../src/view/aha-moment-notify.js","../src/view/view.js","../src/engine/simple_vad.js","../src/engine/server_plain_call.js","../src/engine/bitrix_call.js","../src/engine/stub.js","../src/call_multi_channel.js","../src/engine/engine.js","../src/engine/plain_call.js","../src/engine/bitrix_call_legacy.js","../src/engine/engine_legacy.js","../src/util.js","../src/dialogs/incoming_notification.js","../src/dialogs/conference_notification.js","../src/floating_screenshare.js","../src/call_hint_popup.js","../src/dialogs/promo_popup.js","../src/sidebar.js","../src/view/record-with-copilot-popup.js","../src/web_screenshare_popup.js","../src/engine/voximplant_call.js","../src/video_strategy.js","../src/view/copilot-popup.js","../src/view/participants-permission-popup.js","../src/controller.js","../src/index.js"],"sourcesContent":["// screensharing workaround\nexport function applyHacks() {\n\tif (window[\"BXDesktopSystem\"])\n\t{\n\t\tnavigator['getDisplayMedia'] = function ()\n\t\t{\n\t\t\tvar mediaParams = {\n\t\t\t\taudio: false,\n\t\t\t\tvideo: {\n\t\t\t\t\tmandatory: {\n\t\t\t\t\t\tchromeMediaSource: 'desktop',\n\t\t\t\t\t\tmaxWidth: screen.width > 1920 ? screen.width : 1920,\n\t\t\t\t\t\tmaxHeight: screen.height > 1080 ? screen.height : 1080,\n\t\t\t\t\t},\n\t\t\t\t\toptional: [{googTemporalLayeredScreencast: true}],\n\t\t\t\t},\n\t\t\t};\n\t\t\treturn navigator.mediaDevices.getUserMedia(mediaParams);\n\t\t};\n\t}\n}\n","import { Type } from 'main.core';\nimport { Utils as MessengerUtils } from 'im.lib.utils';\nimport { DesktopApi } from 'im.v2.lib.desktop-api';\n\nexport class BackgroundDialog\n{\n\tstatic isAvailable()\n\t{\n\t\treturn MessengerUtils.platform.getDesktopVersion() >= 52;\n\t}\n\n\tstatic isMaskAvailable()\n\t{\n\t\treturn MessengerUtils.platform.isDesktopFeatureEnabled('mask');\n\t}\n\n\tstatic open(options)\n\t{\n\t\toptions = Type.isPlainObject(options) ? options : {};\n\t\tconst tab = Type.isStringFilled(options.tab) ? options.tab : 'background'; // mask, background\n\n\t\tif (!this.isAvailable())\n\t\t{\n\t\t\tif (window.BX.Helper)\n\t\t\t{\n\t\t\t\twindow.BX.Helper.show(\"redirect=detail&code=12398124\");\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\tconst html =\n\t\t\t`<div id=\"bx-desktop-loader\" class=\"bx-desktop-loader-wrap\">\n\t\t\t\t<div class=\"bx-desktop-loader\">\n\t\t\t\t\t<svg class=\"bx-desktop-loader-circular\" viewBox=\"25 25 50 50\">\n\t\t\t\t\t\t<circle class=\"bx-desktop-loader-path\" cx=\"50\" cy=\"50\" r=\"20\" fill=\"none\" stroke-miterlimit=\"10\"/>\n\t\t\t\t\t</svg>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div id=\"placeholder\"></div>`\n\t\t;\n\n\t\tconst js = `BX.Runtime.loadExtension(\"im.v2.component.call-background\").then(function(exports) {\n\t\t\t\tBX.Vue3.BitrixVue.createApp({\n\t\t\t\t\tcomponents: {CallBackground: exports.CallBackground},\n\t\t\t\t\ttemplate: '<CallBackground tab=\"${tab}\"/>',\n\t\t\t\t}).mount(\"#placeholder\");\n\t\t\t});`;\n\n\t\tDesktopApi.createWindow(\"callBackground\", (controller) =>\n\t\t{\n\t\t\tconst title = this.isMaskAvailable() ? BX.message('BXD_CALL_BG_MASK_TITLE') : BX.message('BXD_CALL_BG_TITLE');\n\t\t\tcontroller.SetProperty(\"title\", title);\n\t\t\tcontroller.SetProperty(\"clientSize\", {Width: 943, Height: 670});\n\t\t\tcontroller.SetProperty(\"minClientSize\", {Width: 943, Height: 670});\n\t\t\tcontroller.SetProperty(\"backgroundColor\", \"#2B3038\");\n\t\t\tcontroller.ExecuteCommand(\"center\");\n\t\t\tcontroller.ExecuteCommand(\"html.load\", DesktopApi.prepareHtml(html, js));\n\t\t});\n\n\t\treturn true;\n\t}\n}\n","import { EventEmitter } from 'main.core.events';\nimport { DesktopApi } from 'im.v2.lib.desktop-api';\n\nconst lsKey = {\n\tdefaultMicrophone: 'bx-im-settings-default-microphone',\n\tdefaultCamera: 'bx-im-settings-default-camera',\n\tdefaultSpeaker: 'bx-im-settings-default-speaker',\n};\n\nconst Events = {\n\tinitialized: 'initialized',\n\tdeviceChanged: 'deviceChange',\n};\n\nexport class HardwareManager extends EventEmitter\n{\n\tEvents = Events\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\t\n\t\tthis.setEventNamespace('BX.Call.HardwareManager');\n\n\t\tthis.initialized = false;\n\t\tthis._currentDeviceList = [];\n\t\tthis.updating = false;\n\t}\n\n\tinit()\n\t{\n\t\tif (this.initialized)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tif (this.initPromise)\n\t\t{\n\t\t\treturn this.initPromise;\n\t\t}\n\t\t\n\t\tthis._checkPermissions();\n\n\t\tthis.initPromise = new Promise((resolve, reject) =>\n\t\t{\n\t\t\tthis.enumerateDevices()\n\t\t\t\t.then((deviceList) =>\n\t\t\t\t{\n\t\t\t\t\tthis._currentDeviceList = this.filterDeviceList(deviceList);\n\n\t\t\t\t\tnavigator.mediaDevices.addEventListener('devicechange', BX.debounce(this.onNavigatorDeviceChanged.bind(this), 500));\n\t\t\t\t\tthis.initialized = true;\n\t\t\t\t\tthis.initPromise = null;\n\t\t\t\t\tthis.emit(Events.initialized, {});\n\t\t\t\t\tresolve();\n\t\t\t\t})\n\t\t\t\t.catch((e) =>\n\t\t\t\t{\n\t\t\t\t\tthis.initPromise = null;\n\t\t\t\t\treject(e)\n\t\t\t\t});\n\t\t})\n\n\t\treturn this.initPromise;\n\t}\n\t\n\tasync _checkPermissions()\n\t{\n\t\tconst cameraPermission = await navigator.permissions.query({ name: 'camera' });\n\t\tconst microphonePermission = await navigator.permissions.query({ name: 'microphone' });\n\n\t\tcameraPermission.onchange = (status) => {\n\t\t\tthis.getCurrentDeviceList();\n\t\t};\n\n\t\tmicrophonePermission.onchange = (status) => {\n\t\t\tthis.getCurrentDeviceList();\n\t\t};\n\t}\n\t\n\tasync getUserMedia(constraints)\n\t{\t\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tif (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia)\n\t\t\t{\n\t\t\t\tconst error = new Error(\"NO_WEBRTC\");\n\t\t\t\terror.code = \"NO_WEBRTC\";\n\t\t\t\tthrow error;\n\t\t\t}\n\n\t\t\tnavigator.mediaDevices.getUserMedia(constraints)\n\t\t\t.then(stream => {\n\t\t\t\tresolve(stream);\n\t\t\t})\n\t\t\t.catch(err => {\n\t\t\t\treject(err);\n\t\t\t});\n\t\t});\n\t}\n\n\tasync enumerateDevices() {\n\t\tif (!navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices)\n\t\t{\n\t\t\tconst error = new Error(\"NO_WEBRTC\");\n\t\t\terror.code = \"NO_WEBRTC\";\n\t\t\tthrow error;\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tconst devices = await navigator.mediaDevices.enumerateDevices();\n\t\t\treturn devices;\n\t\t} catch (e) {\n\t\t\tthrow e;\n\t\t}\n\t}\n\n\tget cameraList()\n\t{\n\t\treturn this._getDeviceMap('videoinput');\n\t}\n\n\tget microphoneList()\n\t{\n\t\treturn this._getDeviceMap('audioinput');\n\t}\n\n\tget audioOutputList()\n\t{\n\t\treturn this._getDeviceMap('audiooutput');\n\t}\n\n\tget defaultMicrophone()\n\t{\n\t\tlet microphoneId = localStorage ? localStorage.getItem(lsKey.defaultMicrophone) : '';\n\n\t\tif (\n\t\t\t(!microphoneId || !this.microphoneList[microphoneId])\n\t\t\t&& Object.keys(this.microphoneList).length\n\t\t)\n\t\t{\n\t\t\t// previous solution with ternary operator\n\t\t\t// has been replaced with two separate conditions\n\t\t\t// because some systems / browsers don't create a duplicate for the default audio device\n\t\t\tif (Object.keys(this.microphoneList).includes('default'))\n\t\t\t{\n\t\t\t\tmicrophoneId = this.getDefaultDeviceIdByGroupId(this.getDeviceGroupIdByDeviceId('default', 'audioinput'), 'audioinput');\n\t\t\t}\n\n\t\t\tif (!microphoneId)\n\t\t\t{\n\t\t\t\tmicrophoneId = Object.keys(this.microphoneList)[0];\n\t\t\t}\n\n\t\t\treturn  microphoneId;\n\t\t}\n\t\treturn this.microphoneList[microphoneId] ? microphoneId : '';\n\t}\n\n\tset defaultMicrophone(microphoneId)\n\t{\n\t\tif (localStorage)\n\t\t{\n\t\t\tlocalStorage.setItem(lsKey.defaultMicrophone, microphoneId)\n\t\t}\n\t}\n\n\tget defaultCamera()\n\t{\n\t\tconst cameraId = localStorage ? localStorage.getItem(lsKey.defaultCamera) : '';\n\n\t\tif (\n\t\t\t(!cameraId || !this.cameraList[cameraId])\n\t\t\t&& Object.keys(this.cameraList).length\n\t\t)\n\t\t{\n\t\t\treturn Object.keys(this.cameraList)[0];\n\t\t}\n\n\t\treturn this.cameraList[cameraId] ? cameraId : '';\n\t}\n\n\tset defaultCamera(cameraId)\n\t{\n\t\tif (localStorage)\n\t\t{\n\t\t\tlocalStorage.setItem(lsKey.defaultCamera, cameraId)\n\t\t}\n\t}\n\n\tget defaultSpeaker()\n\t{\n\t\tlet speakerId = localStorage ? localStorage.getItem(lsKey.defaultSpeaker) : '';\n\n\t\tif (\n\t\t\t(!speakerId || this.audioOutputList[speakerId])\n\t\t\t&& Object.keys(this.audioOutputList).length\n\t\t)\n\t\t{\n\t\t\tspeakerId = Object.keys(this.audioOutputList).includes('default')\n\t\t\t\t? this.getDefaultDeviceIdByGroupId(this.getDeviceGroupIdByDeviceId('default', 'audiooutput'), 'audiooutput')\n\t\t\t\t: Object.keys(this.audioOutputList)[0]\n\t\t\t;\n\n\t\t\treturn  speakerId;\n\t\t}\n\t\treturn this.audioOutputList[speakerId] ? speakerId : '';\n\t}\n\n\tset defaultSpeaker(speakerId: string)\n\t{\n\t\tif (localStorage)\n\t\t{\n\t\t\tlocalStorage.setItem(lsKey.defaultSpeaker, speakerId)\n\t\t}\n\t}\n\n\thasCamera()\n\t{\n\t\tif (!this.initialized)\n\t\t{\n\t\t\tthrow new Error('HardwareManager is not initialized yet');\n\t\t}\n\n\t\treturn Object.keys(this.cameraList).length > 0;\n\t}\n\n\thasMicrophone()\n\t{\n\t\tif (!this.initialized)\n\t\t{\n\t\t\tthrow new Error('HardwareManager is not initialized yet');\n\t\t}\n\n\t\treturn Object.keys(this.microphoneList).length > 0;\n\t}\n\n\tgetMicrophoneList()\n\t{\n\t\tif (!this.initialized)\n\t\t{\n\t\t\tthrow new Error('HardwareManager is not initialized yet');\n\t\t}\n\n\t\treturn Object.values(this._currentDeviceList).filter(deviceInfo => (\n\t\t\tdeviceInfo.kind === 'audioinput' && deviceInfo.deviceId !== 'default'\n\t\t));\n\t}\n\n\tgetCameraList()\n\t{\n\t\tif (!this.initialized)\n\t\t{\n\t\t\tthrow new Error('HardwareManager is not initialized yet');\n\t\t}\n\n\t\treturn Object.values(this._currentDeviceList).filter(deviceInfo => deviceInfo.kind == 'videoinput')\n\t}\n\n\tgetSpeakerList()\n\t{\n\t\tif (!this.initialized)\n\t\t{\n\t\t\tthrow new Error('HardwareManager is not initialized yet');\n\t\t}\n\n\t\treturn Object.values(this._currentDeviceList).filter(deviceInfo => (\n\t\t\tdeviceInfo.kind === 'audiooutput' && deviceInfo.deviceId !== 'default'\n\t\t));\n\t}\n\n\tcanSelectSpeaker()\n\t{\n\t\treturn 'setSinkId' in HTMLMediaElement.prototype;\n\t}\n\n\tupdateDeviceList(e)\n\t{\n\t\tif (this.updating)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.updating = true;\n\t\tlet removedDevices = this._currentDeviceList;\n\t\tlet addedDevices = [];\n\n\t\tconst shouldSkipDeviceChangedEvent = this._currentDeviceList.every(deviceInfo => deviceInfo.deviceId == '' && deviceInfo.label == '');\n\n\t\tthis.enumerateDevices().then(devices =>\n\t\t{\n\t\t\tdevices = this.filterDeviceList(devices);\n\t\t\tdevices.forEach(deviceInfo =>\n\t\t\t{\n\t\t\t\tconst index = removedDevices.findIndex(dev => (\n\t\t\t\t\tdev.kind === deviceInfo.kind\n\t\t\t\t\t&& dev.deviceId === deviceInfo.deviceId\n\t\t\t\t\t&& dev.groupId === deviceInfo.groupId\n\t\t\t\t))\n\t\t\t\tif (index != -1)\n\t\t\t\t{\n\t\t\t\t\t// device found in previous version\n\t\t\t\t\tremovedDevices.splice(index, 1);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\taddedDevices.push(deviceInfo);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis._currentDeviceList = devices;\n\n\t\t\tif (!shouldSkipDeviceChangedEvent)\n\t\t\t{\n\t\t\t\tthis.emit(Events.deviceChanged, {\n\t\t\t\t\tadded: addedDevices,\n\t\t\t\t\tremoved: removedDevices\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.updating = false;\n\t\t})\n\t}\n\n\tfilterDeviceList(browserDeviceList)\n\t{\n\t\treturn browserDeviceList.filter(device =>\n\t\t{\n\t\t\tswitch (device.kind)\n\t\t\t{\n\t\t\t\tcase 'audioinput':\n\t\t\t\t\treturn device.deviceId !== 'communications' && !this.isDeviceInBlackList(device);\n\t\t\t\tcase 'audiooutput':\n\t\t\t\t\treturn device.deviceId !== 'communications' && !this.isDeviceInBlackList(device);\n\t\t\t\tdefault:\n\t\t\t\t\treturn true;\n\t\t\t}\n\t\t})\n\t}\n\n\tisDeviceInBlackList(device)\n\t{\n\t\tconst deviceBlackList = [\n\t\t\t'(virtual)',\n\t\t\t'zoomaudiodevice',\n\t\t\t'microsoft teams audio',\n\t\t\t'bitrixaudio',\n\t\t];\n\t\tlet result = false;\n\n\t\tdeviceBlackList.forEach(item => {\n\t\t\tif (device.label.toLowerCase().includes(item))\n\t\t\t{\n\t\t\t\tresult = true;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t}\n\n\tonNavigatorDeviceChanged(e)\n\t{\n\t\tif (!this.initialized)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.updateDeviceList();\n\t}\n\n\t_getDeviceMap(deviceKind)\n\t{\n\t\tlet result = {};\n\t\tif (!this.initialized)\n\t\t{\n\t\t\tthrow new Error('HardwareManager is not initialized yet');\n\t\t}\n\t\tfor (let i = 0; i < this._currentDeviceList.length; i++)\n\t\t{\n\t\t\tif (this._currentDeviceList[i].kind == deviceKind)\n\t\t\t{\n\t\t\t\tresult[this._currentDeviceList[i].deviceId] = this._currentDeviceList[i].label;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetDefaultDeviceIdByGroupId(groupId, deviceKind)\n\t{\n\t\tlet deviceId;\n\n\t\tthis._currentDeviceList.forEach(device => {\n\t\t\tif (\n\t\t\t\tdevice.groupId === groupId\n\t\t\t\t&& device.deviceId !== 'default'\n\t\t\t\t&& device.kind === deviceKind\n\t\t\t)\n\t\t\t{\n\t\t\t\tdeviceId = device.deviceId;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\n\t\treturn deviceId;\n\t}\n\n\tgetDeviceGroupIdByDeviceId(deviceId, deviceKind)\n\t{\n\t\tlet groupId;\n\n\t\tthis._currentDeviceList.forEach(device => {\n\t\t\tif (device.deviceId === deviceId && device.kind === deviceKind)\n\t\t\t{\n\t\t\t\tgroupId = device.groupId;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\n\t\treturn groupId;\n\t}\n\n\tremoveDevicesByDefaultGroup(devices)\n\t{\n\t\tlet resultDeviceList = devices;\n\n\t\tdevices.forEach(device => {\n\t\t\tif (device.deviceId === 'default')\n\t\t\t{\n\t\t\t\tresultDeviceList = resultDeviceList.filter(item => (\n\t\t\t\t\titem.kind !== device.kind\n\t\t\t\t\t|| item.groupId !== device.groupId\n\t\t\t\t));\n\t\t\t}\n\t\t});\n\n\t\treturn resultDeviceList;\n\t}\n\n\tgetCurrentDeviceList()\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.enumerateDevices().then(deviceList => {\n\t\t\t\tthis._currentDeviceList = this.filterDeviceList(deviceList);\n\t\t\t\tresolve(this._currentDeviceList, deviceList);\n\t\t\t})\n\t\t});\n\t}\n\n\tgetRemovedUsedDevices(devices, currentDevices)\n\t{\n\t\treturn devices.filter(device =>\n\t\t{\n\t\t\tswitch (device.kind)\n\t\t\t{\n\t\t\t\tcase 'audioinput':\n\t\t\t\t\treturn device.deviceId === currentDevices.microphoneId;\n\t\t\t\tcase 'audiooutput':\n\t\t\t\t\treturn device.deviceId === currentDevices.speakerId;\n\t\t\t\tcase 'videoinput':\n\t\t\t\t\treturn device.deviceId === currentDevices.cameraId;\n\t\t\t\tdefault:\n\t\t\t\t\treturn false;\n\t\t\t}\n\t\t})\n\t}\n}","import { HardwareManager } from '../../lib/hardware/src/hardware.js'\n\nconst lsKey = {\n\tenableMicAutoParameters: 'bx-im-settings-enable-mic-auto-parameters',\n\tpreferHd: 'bx-im-settings-camera-prefer-hd',\n\tenableMirroring: 'bx-im-settings-camera-enable-mirroring',\n};\n\nconst CallEvents = {\n\tonChangeMirroringVideo: 'onChangeMirroringVideo',\n\tonChangeMicrophoneMuted: 'onChangeMicrophoneMuted',\n\tonChangeCameraOn: 'onChangeCameraOn',\n};\n\nclass CallHardwareManager extends HardwareManager\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis._isCameraOn = false;\n\t\tthis._isMicrophoneMuted = false;\n\t\tthis.Events = Object.assign(this.Events, CallEvents);\n\t}\n\n\tget enableMicAutoParameters(): boolean\n\t{\n\t\treturn localStorage ? (localStorage.getItem(lsKey.enableMicAutoParameters) !== 'N') : true;\n\t}\n\n\tset enableMicAutoParameters(enableMicAutoParameters: boolean)\n\t{\n\t\tif (localStorage)\n\t\t{\n\t\t\tlocalStorage.setItem(lsKey.enableMicAutoParameters, enableMicAutoParameters ? 'Y' : 'N')\n\t\t}\n\t}\n\n\tget preferHdQuality(): boolean\n\t{\n\t\treturn localStorage ? (localStorage.getItem(lsKey.preferHd) !== 'N') : true;\n\t}\n\n\tset preferHdQuality(preferHdQuality: boolean)\n\t{\n\t\tif (localStorage)\n\t\t{\n\t\t\tlocalStorage.setItem(lsKey.preferHd, preferHdQuality ? 'Y' : 'N')\n\t\t}\n\t}\n\n\tget enableMirroring(): boolean\n\t{\n\t\treturn localStorage ? (localStorage.getItem(lsKey.enableMirroring) !== 'N') : true;\n\t}\n\n\tset enableMirroring(enableMirroring: boolean)\n\t{\n\t\tif (this.enableMirroring !== enableMirroring)\n\t\t{\n\t\t\tthis.emit(this.Events.onChangeMirroringVideo, {enableMirroring: enableMirroring});\n\n\t\t\tif (DesktopApi.isDesktop())\n\t\t\t{\n\t\t\t\tDesktopApi.emit(this.Events.onChangeMirroringVideo, [enableMirroring]);\n\t\t\t}\n\t\t\tif (localStorage)\n\t\t\t{\n\t\t\t\tlocalStorage.setItem(lsKey.enableMirroring, enableMirroring ? 'Y' : 'N');\n\t\t\t}\n\t\t}\n\t}\n\n\tget isCameraOn()\n\t{\n\t\treturn this._isCameraOn;\n\t}\n\n\tset isCameraOn(isCameraOn)\n\t{\n\t\tif (this._isCameraOn !== isCameraOn)\n\t\t{\n\t\t\tthis._isCameraOn = isCameraOn;\n\t\t\tthis.emit(this.Events.onChangeCameraOn, {isCameraOn: this._isCameraOn});\n\t\t}\n\t}\n\t\n\t/* \n\t\n\tthe setter 'isCameraOn' is duplicated by that function  \n\tto emit additional params in 'onChangeCameraOn' event\n\t\n\tfor task-565624 off all participants mic/cam/screenshare\n\t\n\t*/\n\t\n\tsetIsCameraOn(options) \n\t{\n\t\tif (this._isCameraOn !== options.isCameraOn)\n\t\t{\n\t\t\tthis._isCameraOn = options.isCameraOn;\n\t\t\tthis.emit(this.Events.onChangeCameraOn, options);\n\t\t}\n\t}\n\n\tget isMicrophoneMuted()\n\t{\n\t\treturn this._isMicrophoneMuted;\n\t}\n\n\tset isMicrophoneMuted(isMicrophoneMuted)\n\t{\n\t\tif (this._isMicrophoneMuted !== isMicrophoneMuted)\n\t\t{\n\t\t\tthis._isMicrophoneMuted = isMicrophoneMuted;\n\t\t\tthis.emit(this.Events.onChangeMicrophoneMuted, {isMicrophoneMuted: this._isMicrophoneMuted});\n\t\t}\n\t}\n\t\n\t/* \n\t\n\tthe setter 'isMicrophoneMuted' is duplicated by that function  \n\tto emit additional params in 'onChangeMicrophoneMuted' event\n\t\n\tfor task-565624 off all participants mic/cam/screenshare\n\t\n\t*/\n\t\n\tsetIsMicrophoneMuted(options) \n\t{\n\t\tif (this._isMicrophoneMuted !== options.isMicrophoneMuted)\n\t\t{\n\t\t\tthis._isMicrophoneMuted = options.isMicrophoneMuted;\n\t\t\tthis.emit(this.Events.onChangeMicrophoneMuted, options);\n\t\t}\n\t}\n}\n\nexport const Hardware = new CallHardwareManager();\n","import Util from './util';\nimport {Event} from 'main.core';\nimport {Hardware} from './call_hardware';\n\nexport const ClientPlatform = 'web';\n\nexport const ClientVersion = '1.0.0';\n\nexport const MediaStreamsKinds = {\n\tCamera: 1,\n\tMicrophone: 2,\n\tScreen: 3,\n\tScreenAudio: 4,\n}\n\nclass Track {\n\tid = null;\n\tsource = '';\n\ttrack = {};\n\n\tconstructor(id, track) {\n\t\tthis.id = id;\n\t\tthis.source = track.source;\n\t\tthis.track = track\n\t}\n}\n\nclass Message {\n\ttext\n\tfrom\n\ttimestamp\n\n\tconstructor(message) {\n\t\tthis.text = message.message\n\t\tthis.from = message.senderSid\n\t\tthis.timestamp = Math.floor(Date.now() / 1000)\n\t}\n}\n\nconst STREAM_QUALITY = {\n\tHIGH: 2,\n\tMEDIUM: 1,\n\tLOW: 0,\n}\n\nexport const CALL_STATE = {\n\tCONNECTED: 'Connected',\n\tPROGRESSING: 'Progressing',\n\tTERMINATED: 'Terminated',\n}\n\nconst VIDEO_QUEUE = {\n\tINITIAL: '',\n\tENABLE: 'enable',\n\tDISABLE: 'disable',\n};\n\nconst LOG_LEVEL = {\n\tINFO: 'INFO',\n\tWARNING: 'WARNING',\n\tERROR: 'ERROR',\n};\n\nconst MONITORING_EVENTS_NAME_LIST = {\n\tTRACK_SUBSCRIPTION_FAILED: 3,\n\tTRACK_SUBSCRIPTION_DELAY: 4,\n\tHIGH_PACKET_LOSS_SEND: 7,\n\tHIGH_PACKET_LOSS_RECEIVE: 8,\n\tCPU_ISSUES: 9,\n\tNETWORK_ISSUES: 10,\n\tPEER_CONNECTION_REFUSED: 11,\n\tPEER_CONNECTION_ISSUES: 12,\n\tUSER_CAMERA_DISABLED: 14,\n\tUSER_RECONNECTED: 15,\n\tLOCAL_VIDEO_STREAM_RECEIVING_FAILED: 18,\n\tLOCAL_MICROPHONE_STREAM_RECEIVING_FAILED: 19,\n\tLOCAL_SCREEN_STREAM_RECEIVING_FAILED: 20,\n\tLOCAL_VIDEO_STREAM_PUBLICATION_FAILED: 21,\n\tLOCAL_MICROPHONE_STREAM_PUBLICATION_FAILED: 22,\n\tLOCAL_SCREEN_STREAM_PUBLICATION_FAILED: 23,\n};\n\nconst MONITORING_METRICS_NAME_LIST = {\n\tCOUNT_TRACKS: 'COUNT_TRACKS',\n\tPACKET_LOST_RECEIVE: 'PACKET_LOST_RECEIVE',\n\tBITRATE_IN: 'BITRATE_IN',\n\tBITRATE_OUT: 'BITRATE_OUT',\n\tCONN_SCORE_CURRENT: 'CONN_SCORE_CURRENT',\n\tFRAMES_LOSS: 'FRAMES_LOSS',\n\tFREEZE_COUNT: 'FREEZE_COUNT',\n\tTOTAL_FREEZE_DURATION: 'TOTAL_FREEZE_DURATION',\n\tJITTER: 'JITTER',\n\tFRAMES_DECODED: 'FRAMES_DECODED',\n\tFRAMES_DROPPED: 'FRAMES_DROPPED',\n\tFRAMES_RECEIVED: 'FRAMES_RECEIVED',\n\tPACKET_LOST_SEND: 'PACKET_LOST_SEND'\n};\n\nconst MONITORING_EVENTS_LIST = {\n\tmetrics: {},\n\tstartTimestamp: 0,\n\tevents: []\n};\n\nexport const RecorderStatus = {\n\tUNAVAILABLE: 0, // recording not available at the moment\n\tNONE: 1, // recording not started but available\n\tENABLED: 2, // recording started and not paused\n\tDISABLED: 3, // recording stopped and can not be resumed\n\tPAUSED: 4, // recording started and paused\n\tDESTROYED: 5, // recording will be aborted and no results will be provided\n};\n\nconst ReconnectionReason = {\n\tNetworkError: 'NetworkError',\n\tPingPongMissed: 'PingPongMissed',\n\tPeerConnectionFailed: 'PeerConnectionFailed',\n\tWsTransportClosed: 'WsTransportClosed',\n\tLeaveCommand: 'LeaveCommand',\n\tJoinResponseError: 'JoinResponseError',\n};\n\nexport const JoinRequestFailedCodes = {\n\tCanNotCreateRoom: 1,\n\tInputError: 2,\n\tAccessDenied: 3,\n\tRoomNotFound: 5,\n\tMalfunctioningSignaling: 7,\n\tJsonParsingError: 'JsonParsingError',\n\tUnexpectedResponse: 'UnexpectedResponse',\n\tUnknownError: 'UnknownError',\n};\n\nexport class JoinResponseError extends Error\n{\n\tconstructor(message, code) {\n\t\tlet errorCode = null;\n\t\tlet name = null;\n\t\tconst fondedCodePair = Object\n\t\t\t.entries(JoinRequestFailedCodes)\n\t\t\t.find(([_, failedCode]) => failedCode === code);\n\t\tif (fondedCodePair)\n\t\t{\n\t\t\t[name, errorCode] = fondedCodePair;\n\t\t}\n\n\t\tif (!name)\n\t\t{\n\t\t\tname = 'UnknownError';\n\t\t}\n\n\t\tsuper(message);\n\t\tthis.name = name;\n\t\tthis.code = errorCode ?? code;\n\t}\n}\n\nexport class Call {\n\tsender = null;\n\trecipient = null;\n\t#privateProperties = {\n\t\tcodec: 'vp8',\n\t\tcanReconnect: true,\n\t\tlogs: {},\n\t\tisloggingEnable: true,\n\t\tloggerCallback: null,\n\t\tabortController: new AbortController(),\n\t\tisWaitAnswer: false,\n\t\treportsForIncomingTracks: {},\n\t\treportsForOutgoingTracks: {},\n\t\tprevParticipantsWithLargeDataLoss: new Set(),\n\t\ttracksDataFromSocket: {},\n\t\trealTracksIds: {}, // todo: check why track ids are different in a stream and in the track itself\n\t\tmediaServerUrl: null,\n\t\troomData: null,\n\t\troomId: null,\n\t\tisLegacy: false,\n\t\ttoken: null,\n\t\tendpoint: null,\n\t\tjwt: null,\n\t\toptions: null,\n\t\ticeServers: null,\n\t\tsocketConnect: null,\n\t\tpeerConnectionFailed: false,\n\t\tpendingOffer: null,\n\t\tpendingCandidates: {\n\t\t\trecipient: [],\n\t\t\tsender: [],\n\t\t},\n\t\tpendingPublications: {},\n\t\tpendingSubscriptions: {},\n\t\tpublicationTimeout: 10000,\n\t\tsubscriptionTimeout: 1500,\n\t\tsubscriptionTries: 5,\n\t\tcameraStream: null,\n\t\tmicrophoneStream: null,\n\t\tscreenStream: null,\n\t\tmediaMutedBySystem: false,\n\t\tneedToEnableAudioAfterSystemMuted: false,\n\t\tneedToDisableAudioAfterPublish: false,\n\t\tlocalTracks: {},\n\t\tlocalConnectionQuality: 0,\n\t\tminimalConnectionQuality: 2,\n\t\trtt: 0,\n\t\tpingIntervalDuration: 0,\n\t\tpingTimeoutDuration: 0,\n\t\tontrackData: {},\n\t\tremoteTracks: {},\n\t\tremoteParticipants: {},\n\t\tmainStream: {},\n\t\tpingPongTimeout: null,\n\t\tpingPongInterval: null,\n\t\tuserId: '',\n\t\tlocalParticipantSid: '',\n\t\tdefaultVideoResolution: {\n\t\t\twidth: 1280,\n\t\t\theight: 720\n\t\t},\n\t\tdefaultSimulcastBitrate: {\n\t\t\tq: 120000,\n\t\t\th: 300000,\n\t\t\tf: 1000000\n\t\t},\n\t\tdefaultRemoteStreamsQuality: STREAM_QUALITY.MEDIUM,\n\t\taudioBitrate: 70000,\n\t\tvideoBitrate: 1500000,\n\t\tscreenBitrate: 1500000,\n\t\tvideoSimulcast: true,\n\t\tscreenSimulcast: false,\n\t\tevents: new Map(),\n\t\toffersStack: 0,\n\t\taudioDeviceId: '',\n\t\tswitchActiveAudioDeviceInProgress: null,\n\t\tswitchActiveAudioDevicePending: null,\n\t\tvideoDeviceId: '',\n\t\tswitchActiveVideoDeviceInProgress: null,\n\t\tswitchActiveVideoDevicePending: null,\n\t\tisReconnecting: false,\n\t\treconnectionAttempt: 0,\n\t\treconnectionTimeout: null,\n\t\tlastReconnectionReason: null,\n\t\tfastReconnectionDelay: 1000,\n\t\treconnectionDelay: 5000,\n\t\tcallStatsInterval: null,\n\t\tcallState: '',\n\t\twasConnected: false,\n\t\tpacketLostThreshold: 7,\n\t\tstatsTimeout: 3000,\n\t\tvideoQueue: VIDEO_QUEUE.INITIAL,\n\t\tvideoStreamSetupErrorList: {},\n\t}\n\n\tconstructor() {\n\t\tthis.sendLeaveBound = this.#sendLeave.bind(this);\n\t\tthis.beforeDisconnectBound = this.#beforeDisconnect.bind(this);\n\n\t\tthis.monitoringEvents = [];\n\t\tthis.monitoringDelayTime = 60000;\n\t\tthis.monitoringIntervalTime = 10000;\n\t\tthis.countMetricsInMetricsInterval = this.monitoringDelayTime / this.#privateProperties.statsTimeout;\n\t\tthis.monitoringInterval = null;\n\t\tthis.currentMonitoringEventsObject = null;\n\t\tthis.startTimestampGrabMetrics = null;\n\n\t\tthis.currentMonitoringErrorsObject = {};\n\n\t\tthis.prevInboundRtpStatsSum = {\n\t\t\tfreezeCount: 0,\n\t\t\ttotalFreezesDuration: 0,\n\t\t\tjitter: 0,\n\t\t\tframesDecoded: 0,\n\t\t\tframesDropped: 0,\n\t\t\tframesReceived: 0,\n\t\t};\n\n\t\tEvent.EventEmitter.subscribe('BX.Call.Logger:sendLog', (event) => {\n\t\t\tthis.setLog(event.data);\n\t\t});\n\n\t\tthis.initConnectionEvent();\n\t}\n\n\tget remoteParticipantsCount()\n\t{\n\t\treturn Object.keys(this.#privateProperties.remoteParticipants).length;\n\t}\n\n\tget isMediaMutedBySystem()\n\t{\n\t\treturn this.#privateProperties.mediaMutedBySystem;\n\t}\n\n\tonChangeConnection(connection)\n\t{\n\t\tconst rtt = connection.rtt;\n\n\t\tif (!rtt && !this.#privateProperties.isReconnecting)\n\t\t{\n\t\t\tthis.#beforeDisconnect();\n\t\t\tthis.#reconnect({\n\t\t\t\treconnectionReason: 'ON_CHANGE_CONNECTION',\n\t\t\t\treconnectionReasonInfo: `RTT: ${rtt}`,\n\t\t\t});\n\t\t}\n\t}\n\n\tinitConnectionEvent()\n\t{\n\t\tconst connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;\n\n\t\tif (!connection)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconnection.addEventListener('change', () =>\n\t\t{\n\t\t\tthis.onChangeConnection(connection);\n\t\t});\n\t}\n\n\tcheckQosFeatureAndExecutionCallback(callback)\n\t{\n\t\treturn;\n\n\t\tif (typeof callback === 'function' && Util.isNewQOSEnabled())\n\t\t{\n\t\t\tcallback();\n\t\t}\n\t}\n\n\tclearMonitoringEvents()\n\t{\n\t\tthis.monitoringEvents = [];\n\t}\n\n\tcalcBitrateSumFromArray({ bitrateArray })\n\t{\n\t\tif (bitrateArray && Array.isArray(bitrateArray))\n\t\t{\n\t\t\treturn bitrateArray.reduce((acc, currentValue) => acc + currentValue.bitrate || 0, 0);\n\t\t}\n\n\t\treturn 0;\n\t}\n\n\taddValidatedMonitoringMetricWithLogging({ additionalData, metricValue, metricKey })\n\t{\n\t\tconst { video, audio } = this.currentMonitoringEventsObject.metrics[MONITORING_METRICS_NAME_LIST.COUNT_TRACKS];\n\n\t\tlet currentValue = metricValue;\n\t\tconst isValidMetricValue = typeof currentValue === 'number' && currentValue > 0 && !Number.isNaN(currentValue);\n\n\t\tif (!isValidMetricValue && !this.currentMonitoringErrorsObject[metricKey])\n\t\t{\n\t\t\tthis.currentMonitoringErrorsObject[metricKey] = [];\n\t\t}\n\n\t\tif (!isValidMetricValue)\n\t\t{\n\t\t\tcurrentValue = 0;\n\n\t\t\tthis.currentMonitoringErrorsObject[metricKey].push({\n\t\t\t\tmetricValue,\n\t\t\t\tcountVideoTracks: video,\n\t\t\t\tcountAudioTracks: audio,\n\t\t\t\ttimestamp: Date.now(),\n\t\t\t\tadditionalData: additionalData || 'none',\n\t\t\t});\n\t\t}\n\n\t\tthis.currentMonitoringEventsObject.metrics[metricKey].push(currentValue);\n\t}\n\n\taddMonitoringEvents({ name, value = undefined, withCounter = false })\n\t{\n\t\tconst currentEventIndex = this.currentMonitoringEventsObject.events.findIndex(evt => evt.name === name);\n\t\tconst lastTimestamp = Date.now();\n\n\t\tif (withCounter && currentEventIndex !== -1)\n\t\t{\n\t\t\tthis.currentMonitoringEventsObject.events[currentEventIndex].lastTimestamp = lastTimestamp;\n\t\t\tthis.currentMonitoringEventsObject.events[currentEventIndex].value += 1;\n\t\t\treturn;\n\t\t}\n\n\t\tif (withCounter && currentEventIndex === -1)\n\t\t{\n\t\t\tthis.currentMonitoringEventsObject.events.push({name, value: 1, lastTimestamp})\n\t\t\treturn;\n\t\t}\n\n\t\tthis.currentMonitoringEventsObject.events.push({name, value, lastTimestamp});\n\t}\n\n\tsetClearValuesForCurrentMonitoringEventsObject()\n\t{\n\t\tthis.currentMonitoringEventsObject = {\n\t\t\tmetrics: this.fillDefaultValueMonitoringMetrics(),\n\t\t\tstartTimestamp: Date.now(),\n\t\t\tevents: []\n\t\t};\n\t}\n\n\tgetCountRemoteTracks()\n\t{\n\t\tlet countVideoTracks = 0;\n\t\tlet countAudioTracks = 0;\n\n\t\tObject.values(this.#privateProperties.remoteParticipants).forEach(participant =>\n\t\t{\n\t\t\tif (participant.getTrack(MediaStreamsKinds.Camera) && !participant.isMutedVideo && !participant.isLocalVideoMute)\n\t\t\t{\n\t\t\t\tcountVideoTracks += 1;\n\t\t\t}\n\n\t\t\tif (participant.getTrack(MediaStreamsKinds.Microphone) && !participant.isMutedAudio)\n\t\t\t{\n\t\t\t\tcountAudioTracks += 1;\n\t\t\t}\n\n\t\t\tif (participant.getTrack(MediaStreamsKinds.Screen))\n\t\t\t{\n\t\t\t\tcountVideoTracks += 1;\n\t\t\t}\n\n\t\t\tif (participant.getTrack(MediaStreamsKinds.ScreenAudio))\n\t\t\t{\n\t\t\t\tcountAudioTracks += 1;\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\tcountVideoTracks,\n\t\t\tcountAudioTracks,\n\t\t}\n\t}\n\n\tgetDefaultValueMonitoringMetric(key)\n\t{\n\t\tswitch (key)\n\t\t{\n\t\t\tcase 'COUNT_TRACKS':\n\t\t\t\treturn {\n\t\t\t\t\tvideo: 0,\n\t\t\t\t\taudio: 0,\n\t\t\t\t};\n\t\t\tdefault:\n\t\t\t\treturn [];\n\t\t}\n\t}\n\n\tfillDefaultValueMonitoringMetrics()\n\t{\n\t\treturn Object.entries(MONITORING_METRICS_NAME_LIST).reduce((acc, [key, value]) => {\n\t\t\tacc[value] = this.getDefaultValueMonitoringMetric(key);\n\t\t\treturn acc;\n\t\t}, {});\n\t}\n\n\tstartAggregateMonitoringEvents()\n\t{\n\t\tthis.startTimestampGrabMetrics = Date.now();\n\n\t\tthis.setClearValuesForCurrentMonitoringEventsObject();\n\n\t\tthis.monitoringInterval = setInterval(() => {\n\t\t\tconst { countVideoTracks, countAudioTracks } = this.getCountRemoteTracks();\n\n\t\t\tthis.currentMonitoringEventsObject.metrics[MONITORING_METRICS_NAME_LIST.COUNT_TRACKS] = {\n\t\t\t\tvideo: countVideoTracks,\n\t\t\t\taudio: countAudioTracks,\n\t\t\t};\n\t\t}, this.monitoringIntervalTime);\n\n\t\tthis.monitoringTimeout = setTimeout(() => {\n\t\t\tclearTimeout(this.monitoringTimeout);\n\t\t\tthis.monitoringTimeout = null;\n\n\t\t\tif (this.#privateProperties.isReconnecting)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.sendMonitoringEvents();\n\t\t}, this.monitoringDelayTime);\n\n\t}\n\n\tsendLogMonitoringErrors()\n\t{\n\t\tconst isErrorsListNotEmpty = !!Object.keys(this.currentMonitoringErrorsObject);\n\n\t\tif (isErrorsListNotEmpty)\n\t\t{\n\t\t\tObject.entries(this.currentMonitoringErrorsObject).forEach(([key, value]) =>\n\t\t\t{\n\t\t\t\tthis.setLog(`Monitoring errors for key - ${key}.\\n${JSON.stringify(value)}`, LOG_LEVEL.ERROR)\n\t\t\t});\n\t\t}\n\n\t\tthis.currentMonitoringErrorsObject = {};\n\t}\n\n\tsendMonitoringEvents(withRestart = true)\n\t{\n\t\tconst eventsToSend = [];\n\t\tconst eventsToLog = [];\n\n\t\tthis.currentMonitoringEventsObject.events.forEach(evt =>\n\t\t{\n\t\t\tlet eventName = '';\n\t\t\tconst eventList = Object.entries(MONITORING_EVENTS_NAME_LIST);\n\t\t\tfor (let i = 0; i < eventList.length; i++)\n\t\t\t{\n\t\t\t\tif (eventList[i][1] === evt.name)\n\t\t\t\t{\n\t\t\t\t\teventName = eventList[i][0];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst eventData = {\n\t\t\t\tmediaServerId: 0, // TODO: should be replaced with real value for large rooms; 0 - only for small rooms\n\t\t\t\tmessage: '',\n\t\t\t\tvalue: JSON.stringify(evt.value),\n\t\t\t\teventTime: Math.round(evt.lastTimestamp / 1000)\n\t\t\t};\n\n\t\t\teventsToSend.push({\n\t\t\t\teventTypeId: evt.name,\n\t\t\t\t...eventData,\n\t\t\t});\n\n\t\t\teventsToLog.push({\n\t\t\t\teventTypeId: eventName,\n\t\t\t\t...eventData,\n\t\t\t});\n\t\t});\n\n\t\tconst objForSend = {\n\t\t\taudioSubscribed: this.currentMonitoringEventsObject.metrics[MONITORING_METRICS_NAME_LIST.COUNT_TRACKS].audio,\n\t\t\tvideoSubscribed: this.currentMonitoringEventsObject.metrics[MONITORING_METRICS_NAME_LIST.COUNT_TRACKS].video,\n\t\t\tpacketLoss: this.currentMonitoringEventsObject.metrics[MONITORING_METRICS_NAME_LIST.PACKET_LOST_RECEIVE],\n\t\t\tbitrateIn: this.currentMonitoringEventsObject.metrics[MONITORING_METRICS_NAME_LIST.BITRATE_IN],\n\t\t\tbitrateOut: this.currentMonitoringEventsObject.metrics[MONITORING_METRICS_NAME_LIST.BITRATE_OUT],\n\t\t\tconnScore:  this.currentMonitoringEventsObject.metrics[MONITORING_METRICS_NAME_LIST.CONN_SCORE_CURRENT],\n\t\t\tframesLoss: this.currentMonitoringEventsObject.metrics[MONITORING_METRICS_NAME_LIST.FRAMES_LOSS],\n\t\t\tfreezeCount: this.currentMonitoringEventsObject.metrics[MONITORING_METRICS_NAME_LIST.FREEZE_COUNT],\n\t\t\ttotalFreezesDuration: this.currentMonitoringEventsObject.metrics[MONITORING_METRICS_NAME_LIST.TOTAL_FREEZE_DURATION],\n\t\t\tjitter: this.currentMonitoringEventsObject.metrics[MONITORING_METRICS_NAME_LIST.JITTER],\n\t\t\tevents: eventsToSend,\n\t\t};\n\n\t\tobjForSend.events = eventsToSend;\n\n\t\tthis.#sendSignal({ sendQoS: objForSend });\n\n\t\tthis.sendLogMonitoringErrors();\n\n\t\tclearInterval(this.monitoringInterval);\n\t\tthis.monitoringInterval = null;\n\t\tclearTimeout(this.monitoringTimeout);\n\t\tthis.monitoringTimeout = null;\n\n\t\tif (withRestart)\n\t\t{\n\t\t\tthis.startAggregateMonitoringEvents();\n\t\t}\n\t}\n\n\tonPublishFailed(kind)\n\t{\n\t\tthis.triggerEvents('PublishFailed', [kind]);\n\t\tlet eventName;\n\t\tif (kind === MediaStreamsKinds.Camera)\n\t\t{\n\t\t\teventName = MONITORING_EVENTS_NAME_LIST.LOCAL_VIDEO_STREAM_PUBLICATION_FAILED;\n\t\t}\n\t\telse if (kind === MediaStreamsKinds.Microphone)\n\t\t{\n\t\t\teventName = MONITORING_EVENTS_NAME_LIST.LOCAL_MICROPHONE_STREAM_PUBLICATION_FAILED;\n\t\t}\n\t\telse if (kind === MediaStreamsKinds.Screen)\n\t\t{\n\t\t\teventName = MONITORING_EVENTS_NAME_LIST.LOCAL_SCREEN_STREAM_PUBLICATION_FAILED;\n\t\t}\n\n\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t{\n\t\t\tthis.addMonitoringEvents({\n\t\t\t\tname: eventName,\n\t\t\t\twithCounter: true,\n\t\t\t});\n\t\t});\n\t}\n\n\tasync connect(options) {\n\t\tthis.setLog(`Connecting to the call (desktop: ${Util.isDesktop()})`, LOG_LEVEL.INFO);\n\t\tthis.#privateProperties.callState = CALL_STATE.PROGRESSING\n\n\t\tfor (let key in options) {\n\t\t\tthis.#privateProperties[`${key}`] = options[key]\n\t\t}\n\n\t\tif (this.#privateProperties.isLegacy)\n\t\t{\n\t\t\tif (!this.#privateProperties.endpoint)\n\t\t\t{\n\t\t\t\tthis.setLog(`Missing required param 'endpoint' from backend, disconnecting`, LOG_LEVEL.ERROR);\n\t\t\t\tthis.triggerEvents('Failed', [{name: 'AUTHORIZE_ERROR', message: `Missing required param 'endpoint'`}]);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!this.#privateProperties.jwt)\n\t\t\t{\n\t\t\t\tthis.setLog(`Missing required param 'jwt' from backend, disconnecting`, LOG_LEVEL.ERROR);\n\t\t\t\tthis.triggerEvents('Failed', [{name: 'AUTHORIZE_ERROR', message: `Missing required param 'jwt'`}]);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#privateProperties.endpoint = this.#privateProperties.endpoint.replace(/\\/+$/, '');\n\t\t}\n\n\t\tconst canConnect = this.#privateProperties.mediaServerUrl && this.#privateProperties.roomData;\n\n\t\tif (!canConnect)\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst mediaServerInfo = await this.getMediaServerInfo();\n\n\t\t\t\tthis.#privateProperties.mediaServerUrl = mediaServerInfo.mediaServerUrl;\n\t\t\t\tthis.#privateProperties.roomData = mediaServerInfo.roomData;\n\t\t\t}\n\t\t\tcatch (error)\n\t\t\t{\n\t\t\t\tif (error.name !== 'AbortError' && !this.#privateProperties.abortController.signal.aborted)\n\t\t\t\t{\n\t\t\t\t\t// don't write error.name and error.message to analytics now,\n\t\t\t\t\t// because we don't watch failed reconnecting requests now\n\n\t\t\t\t\tthis.#reconnect({\n\t\t\t\t\t\treconnectionReason: 'GET_MEDIASERVER_INFO',\n\t\t\t\t\t\treconnectionReasonInfo: error?.name || '',\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse if (this.#privateProperties.abortController.signal.aborted)\n\t\t\t\t{\n\t\t\t\t\tthis.triggerEvents('Failed', [error]);\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (this.#privateProperties.abortController.signal.aborted)\n\t\t{\n\t\t\tthis.#beforeDisconnect();\n\t\t\treturn;\n\t\t}\n\t\tthis.#privateProperties.abortController.signal.addEventListener('abort', this.beforeDisconnectBound);\n\n\t\tthis.#privateProperties.socketConnect = new WebSocket(\n\t\t\t`${this.#privateProperties.mediaServerUrl}?auto_subscribe=1&sdk=js&version=1.6.7&protocol=8`\n\t\t\t+`&roomData=${this.#privateProperties.roomData}`\n\t\t\t+`&clientVersion=${ClientVersion}`\n\t\t\t+`&clientPlatform=${ClientPlatform}`);\n\n\t\tthis.#privateProperties.socketConnect.onmessage = (e) => this.socketOnMessageHandler(e);\n\t\tthis.#privateProperties.socketConnect.onopen = () => this.socketOnOpenHandler();\n\t\tthis.#privateProperties.socketConnect.onerror = () => this.socketOnErrorHandler();\n\t\tthis.#privateProperties.socketConnect.onclose = (e) => this.socketOnCloseHandler(e);\n\t};\n\n\t#reconnect(data) {\n\t\tthis.#privateProperties.isReconnecting = true;\n\t\tthis.#privateProperties.videoQueue = VIDEO_QUEUE.INITIAL;\n\n\t\tconst reconnect = () =>\n\t\t{\n\t\t\tconst reconnectionDelay = this.#privateProperties.lastReconnectionReason !== ReconnectionReason.JoinResponseError\n\t\t\t\t? this.#privateProperties.fastReconnectionDelay\n\t\t\t\t: this.#privateProperties.reconnectionDelay;\n\t\t\tthis.setLog(`Reconnecting attempt: ${++this.#privateProperties.reconnectionAttempt}`, LOG_LEVEL.WARNING);\n\t\t\tthis.#privateProperties.reconnectionTimeout = setTimeout(this.connect.bind(this), reconnectionDelay);\n\t\t};\n\n\t\treconnect();\n\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t{\n\t\t\tthis.addMonitoringEvents({\n\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.USER_RECONNECTED,\n\t\t\t\twithCounter: true,\n\t\t\t});\n\t\t});\n\n\t\tthis.triggerEvents('Reconnecting', [data]);\n\t};\n\n\t#beforeDisconnect()\n\t{\n\t\twindow.removeEventListener('unload', this.sendLeaveBound);\n\t\tthis.#clearPingInterval();\n\t\tthis.#clearPingTimeout();\n\t\tclearInterval(this.#privateProperties.callStatsInterval);\n\n\t\tthis.#privateProperties.mediaServerUrl = '';\n\t\tthis.#privateProperties.roomData = '';\n\t\tthis.#privateProperties.pendingOffer = null;\n\t\tthis.#privateProperties.pendingCandidates = { recipient: [], sender: [] };\n\n\t\tthis.#privateProperties.localTracks = {};\n\t\tthis.#privateProperties.isWaitAnswer = false;\n\n\t\tif (this.#privateProperties.socketConnect)\n\t\t{\n\t\t\tthis.#privateProperties.socketConnect.onmessage = null;\n\t\t\tthis.#privateProperties.socketConnect.onopen = null;\n\t\t\tthis.#privateProperties.socketConnect.onerror = null;\n\t\t\tthis.#privateProperties.socketConnect.onclose = null;\n\t\t\tthis.#privateProperties.socketConnect.close();\n\t\t\tthis.#privateProperties.socketConnect = null;\n\t\t}\n\t}\n\n\tgetMediaServerInfo()\n\t{\n\t\tlet request = null;\n\n\t\tif (this.#privateProperties.isLegacy)\n\t\t{\n\t\t\tlet url = `${this.#privateProperties.endpoint}/join`;\n\t\t\turl += `?token=${this.#privateProperties.jwt}`;\n\t\t\turl += `&clientVersion=${ClientVersion}`;\n\t\t\turl += `&clientPlatform=${ClientPlatform}`;\n\n\t\t\trequest = new Promise((resolve, reject) => {\n\t\t\t\tfetch(url, {\n\t\t\t\t\tmethod: 'GET',\n\t\t\t\t\tsignal: this.#privateProperties.abortController.signal,\n\t\t\t\t})\n\t\t\t\t\t.then((response) => {\n\t\t\t\t\t\treturn response.json();\n\t\t\t\t\t})\n\t\t\t\t\t.then((data) => {\n\t\t\t\t\t\tresolve(data);\n\t\t\t\t\t})\n\t\t\t\t\t.catch((error) => {\n\t\t\t\t\t\treject(error);\n\t\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\trequest = Util.getCallConnectionDataById(this.#privateProperties.roomId);\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst isErrorPreventingReconnection = (code) => {\n\t\t\t\tconst reconnectionStoppableCodeNames = new Set(['InputError', 'AccessDenied', 'RoomNotFound', 'MalfunctioningSignaling', 'CanNotCreateRoom']);\n\n\t\t\t\treturn Object.entries(JoinRequestFailedCodes)\n\t\t\t\t\t.some(([failedName, failedCode]) => reconnectionStoppableCodeNames.has(failedName) && failedCode === code);\n\t\t\t};\n\n\t\t\trequest\n\t\t\t\t.then((data) => {\n\t\t\t\t\tif (data.error)\n\t\t\t\t\t{\n\t\t\t\t\t\tthrow data.error;\n\t\t\t\t\t}\n\t\t\t\t\telse if (!data?.result?.mediaServerUrl || !data?.result?.roomData)\n\t\t\t\t\t{\n\t\t\t\t\t\tthrow {\n\t\t\t\t\t\t\tname: 'MEDIASERVER_MISSING_PARAMS',\n\t\t\t\t\t\t\tmessage: 'Incorrect signaling response',\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve({\n\t\t\t\t\t\tmediaServerUrl: data.result.mediaServerUrl,\n\t\t\t\t\t\troomData: data.result.roomData,\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tif (\n\t\t\t\t\t\t(error.code && isErrorPreventingReconnection(error.code))\n\t\t\t\t\t\t|| error.name === 'AbortError'\n\t\t\t\t\t\t|| error.name === 'SyntaxError'\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#privateProperties.abortController.abort();\n\t\t\t\t\t\t/*\n\t\t\t\t\t\tlet errorCode = 'UNKNOWN_ERROR';\n\t\t\t\t\t\tif (Type.isObject(error) && error instanceof JoinResponseError)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\terrorCode = error.name;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (Type.isObject(error) && error.code)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\terrorCode = error.code === 'access_denied' 'ACCESS_DENIED' : error.code;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.triggerEvents('ReconnectingFailed', [null, {\n\t\t\t\t\t\t\tcode: errorCode,\n\t\t\t\t\t\t\tmessage: error?.message,\n\t\t\t\t\t\t}]);\n\t\t\t\t\t\t*/\n\n\t\t\t\t\t\treject({\n\t\t\t\t\t\t\tname: 'MEDIASERVER_UNEXPECTED_ANSWER',\n\t\t\t\t\t\t\tmessage: error?.message,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#privateProperties.lastReconnectionReason = error.code\n\t\t\t\t\t\t\t? ReconnectionReason.JoinResponseError\n\t\t\t\t\t\t\t: ReconnectionReason.NetworkError;\n\n\t\t\t\t\t\t// don't write error.name and error.message to analytics now,\n\t\t\t\t\t\t// because we don't watch failed reconnecting requests now\n\n\t\t\t\t\t\treject({\n\t\t\t\t\t\t\tname: 'MEDIASERVER_ERROR',\n\t\t\t\t\t\t\tmessage: `Reason: ${error?.message}`,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t});\n\t}\n\n\tasync sendOffer() {\n\t\tif (this.#privateProperties.offersStack > 0 && !this.#privateProperties.isWaitAnswer) {\n\t\t\tthis.setLog('Start sending an offer', LOG_LEVEL.INFO);\n\t\t\tthis.#privateProperties.isWaitAnswer = true;\n\t\t\tthis.#privateProperties.offersStack--;\n\n\t\t\ttry {\n\t\t\t\tlet offer = await this.sender.createOffer();\n\t\t\t\tif (Util.useTcpSdp())\n\t\t\t\t{\n\t\t\t\t\toffer = {\n\t\t\t\t\t\ttype: offer.type,\n\t\t\t\t\t\tsdp: this.#removeUdpFromSdp(offer.sdp),\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tawait this.sender.setLocalDescription(offer);\n\t\t\t\tthis.#sendSignal({ offer });\n\t\t\t\tthis.setLog('Sending an offer succeeded', LOG_LEVEL.INFO);\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tthis.setLog(`Sending an offer failed: ${e}`, LOG_LEVEL.ERROR);\n\t\t\t\tthis.#beforeDisconnect();\n\t\t\t\tthis.#reconnect({\n\t\t\t\t\treconnectionReason: 'SENDING_OFFER',\n\t\t\t\t\treconnectionReasonInfo: `Sending an offer failed: ${e}`,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tasync startStream() {\n\t\tconst videoTrack = await this.getLocalVideo();\n\t\tif (videoTrack) {\n\t\t\tawait this.publishTrack(MediaStreamsKinds.Camera, videoTrack);\n\t\t} else {\n\t\t\tthis.#releaseStream(MediaStreamsKinds.Camera);\n\t\t\tthis.onPublishFailed(MediaStreamsKinds.Camera);\n\t\t}\n\n\t\tconst audioTrack = await this.getLocalAudio();\n\t\tif (audioTrack) {\n\t\t\tawait this.publishTrack(MediaStreamsKinds.Microphone, audioTrack);\n\t\t} else {\n\t\t\tthis.#releaseStream(MediaStreamsKinds.Microphone);\n\t\t\tthis.onPublishFailed(MediaStreamsKinds.Microphone);\n\t\t}\n\t}\n\n\tasync socketOnMessageHandler(event) {\n\t\tif (typeof event.data !== 'string') return;\n\n\t\tlet data\n\n\t\ttry\n\t\t{\n\t\t\tdata = JSON.parse(event.data);\n\t\t}\n\t\tcatch (err)\n\t\t{\n\t\t\tthis.setLog(`Could not parse a socket message: ${event.data}`, LOG_LEVEL.WARNING);\n\t\t\treturn;\n\t\t}\n\n\t\tif (data?.answer){\n\t\t\tawait this.#answerHandler(data);\n\t\t}\n\t\telse if (data?.offer)\n\t\t{\n\t\t\tawait this.#offerHandler(data);\n\t\t}\n\t\telse if (data?.joinResponse) {\n\t\t\tif (data.joinResponse.role)\n\t\t\t{\n\t\t\t\tUtil.setCurrentUserRole(data.joinResponse.role);\n\t\t\t}\n\n\t\t\tthis.#privateProperties.abortController.signal.removeEventListener('abort', this.beforeDisconnectBound);\n\n\t\t\tthis.#privateProperties.iceServers = data.joinResponse.iceServers;\n\t\t\tthis.#privateProperties.localParticipantSid = data.joinResponse.localParticipant.sid;\n\t\t\tthis.#createPeerConnection();\n\n\t\t\tconst connectedEvent = this.#privateProperties.isReconnecting && this.wasConnected\n\t\t\t\t? 'Reconnected'\n\t\t\t\t: 'Connected';\n\n\t\t\tthis.#privateProperties.callState = CALL_STATE.CONNECTED;\n\t\t\tthis.wasConnected = true;\n\t\t\tthis.setLog(`${connectedEvent} to the call ${this.#privateProperties.roomId} on the mediaserver after ${this.#privateProperties.reconnectionAttempt} attempts`, LOG_LEVEL.INFO);\n\t\t\tthis.#privateProperties.isReconnecting = false;\n\t\t\tthis.#privateProperties.reconnectionAttempt = 0;\n\n\t\t\tif(data.joinResponse.permissions && connectedEvent === 'Connected')\n\t\t\t{\n\t\t\t\tthis.#setUserPermissions(data.joinResponse.permissions);\n\t\t\t}\n\n\t\t\tif(data.joinResponse.roomState && connectedEvent === 'Connected')\n\t\t\t{\n\t\t\t\tUtil.setRoomPermissions(data.joinResponse.roomState);\n\t\t\t\tUtil.setUserPermissionsByRoomPermissions(data.joinResponse.roomState);\n\n\t\t\t}\n\n\t\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t\t{\n\t\t\t\tif (connectedEvent === 'Reconnected' && this.monitoringEvents.length)\n\t\t\t\t{\n\t\t\t\t\tthis.sendMonitoringEvents();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst participantsToDelete = {...this.#privateProperties.remoteParticipants};\n\t\t\tObject.values(data.joinResponse.otherParticipants).forEach( p => {\n\t\t\t\tif (participantsToDelete[p.userId])\n\t\t\t\t{\n\t\t\t\t\tdelete participantsToDelete[p.userId];\n\t\t\t\t}\n\t\t\t\tthis.setLog(`Adding an early connected participant with id ${p.userId} (sid: ${p.sid})`, LOG_LEVEL.INFO);\n\t\t\t\tthis.#setRemoteParticipant(p);\n\t\t\t});\n\n\t\t\tif (connectedEvent === 'Reconnected')\n\t\t\t{\n\t\t\t\tfor (let userId in participantsToDelete)\n\t\t\t\t{\n\t\t\t\t\tconst participant = this.#privateProperties.remoteParticipants[userId];\n\t\t\t\t\tthis.setLog(`Deleting a missing participant with id ${participant.userId} (sid: ${participant.sid})`, LOG_LEVEL.INFO);\n\t\t\t\t\tthis.triggerEvents('ParticipantLeaved', [participant]);\n\t\t\t\t\tdelete this.#privateProperties.remoteTracks[userId];\n\t\t\t\t\tdelete this.#privateProperties.remoteParticipants[userId];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ('recorderStatus' in data.joinResponse)\n\t\t\t{\n\t\t\t\tconst recorderStatus = { code: data.joinResponse.recorderStatus };\n\t\t\t\tif (data.joinResponse.recorderRespStatus)\n\t\t\t\t{\n\t\t\t\t\trecorderStatus.errMsg = data.joinResponse.recorderRespStatus;\n\t\t\t\t}\n\n\t\t\t\tthis.triggerEvents('RecorderStatusChanged', [recorderStatus]);\n\t\t\t}\n\n\t\t\tthis.#privateProperties.pingIntervalDuration = data.joinResponse.pingInterval * 1000\n\t\t\tthis.#privateProperties.pingTimeoutDuration = this.#privateProperties.pingIntervalDuration * 2\n\n\t\t\tthis.#startPingInterval();\n\n\t\t\tthis.triggerEvents(connectedEvent);\n\t\t} else if (data?.participantJoined) {\n\t\t\tthis.setLog(`Adding a new participant with id ${data.participantJoined.participant.userId} (sid: ${data.participantJoined.participant.sid})`, LOG_LEVEL.INFO);\n\t\t\tthis.#setRemoteParticipant(data.participantJoined.participant);\n\t\t} else if (data?.participantLeft) {\n\t\t\tconst participantId = data.participantLeft.userId;\n\t\t\tconst participant = this.#privateProperties.remoteParticipants[participantId];\n\t\t\tconst pendingSubscriptions = this.#privateProperties.pendingSubscriptions[participantId];\n\n\t\t\tif (pendingSubscriptions)\n\t\t\t{\n\t\t\t\tfor (let trackId in pendingSubscriptions)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(pendingSubscriptions[trackId].timeout);\n\t\t\t\t\tthis.setLog(`A participant with id ${participantId} (sid: ${data.participantLeft.sid}) left during subscription attempt, cancel it`, LOG_LEVEL.WARNING);\n\t\t\t\t}\n\n\t\t\t\tdelete this.#privateProperties.pendingSubscriptions[participantId];\n\t\t\t}\n\n\t\t\tif (participant)\n\t\t\t{\n\t\t\t\tthis.setLog(`Deleting a participant with id ${participant.userId} (sid: ${participant.sid})`, LOG_LEVEL.INFO);\n\t\t\t\tthis.triggerEvents('ParticipantLeaved', [participant]);\n\t\t\t\tdelete this.#privateProperties.remoteTracks[participantId];\n\t\t\t\tdelete this.#privateProperties.remoteParticipants[participantId];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.setLog(`Got participantLeft signal for a non-existent participant with id ${participantId} (sid: ${data.participantLeft.sid})`, LOG_LEVEL.WARNING);\n\t\t\t}\n\t\t} else if (data?.trackCreated) {\n\t\t\tconst participantId = data.trackCreated.userId;\n\t\t\tconst cid = data.trackCreated.cid;\n\t\t\tconst track = data.trackCreated.track;\n\t\t\tconst trackId = track.sid;\n\t\t\ttrack.userId = participantId\n\t\t\tif (participantId == this.#privateProperties.userId) {\n\t\t\t\tconst timeout = this.#privateProperties.pendingPublications[cid];\n\t\t\t\tif (timeout)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.#privateProperties.pendingPublications[cid]);\n\t\t\t\t\tdelete this.#privateProperties.pendingPublications[cid];\n\n\t\t\t\t\tthis.setLog(`Publishing a local track with kind ${track.source} (sid: ${trackId}) succeeded`, LOG_LEVEL.INFO);\n\t\t\t\t\tthis.#privateProperties.localTracks[track.source] = track\n\t\t\t\t\tthis.triggerEvents('PublishSucceed', [track.source]);\n\t\t\t\t\tif (track.source === MediaStreamsKinds.Microphone && this.#privateProperties.needToDisableAudioAfterPublish)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#privateProperties.needToDisableAudioAfterPublish = false;\n\t\t\t\t\t\tthis.disableAudio();\n\t\t\t\t\t}\n\t\t\t\t\telse if (track.source === MediaStreamsKinds.Camera && this.#privateProperties.videoQueue)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#processVideoQueue();\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.setLog(`Got trackCreated signal for a non-existent local track with kind ${track.source} (sid: ${trackId})`, LOG_LEVEL.WARNING);\n\t\t\t} else {\n\t\t\t\tthis.#privateProperties.tracksDataFromSocket[trackId] = track;\n\t\t\t\tconst participant = this.#privateProperties.remoteParticipants[participantId];\n\t\t\t\tif (participant)\n\t\t\t\t{\n\t\t\t\t\tthis.setLog(`Got a track info with kind ${track.source} (sid: ${data.trackCreated.track.sid}) for a participant with id ${participantId} (sid: ${participant.sid}), waiting for it`, LOG_LEVEL.INFO);\n\t\t\t\t\tswitch (track.source)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase MediaStreamsKinds.Camera:\n\t\t\t\t\t\t\tparticipant.videoEnabled = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase MediaStreamsKinds.Microphone:\n\t\t\t\t\t\t\tparticipant.audioEnabled = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase MediaStreamsKinds.Screen:\n\t\t\t\t\t\t\tparticipant.screenSharingEnabled = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst ontrackData = this.#privateProperties.ontrackData[trackId];\n\t\t\t\t\tdelete this.#privateProperties.ontrackData[trackId];\n\n\t\t\t\t\tif (ontrackData)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#createRemoteTrack(trackId, ontrackData);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#addPendingSubscription(participant, track);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.setLog(`Got a track info with kind ${track.source} (sid: ${data.trackCreated.track.sid}) for a non-existent participant with id ${participantId}`, LOG_LEVEL.WARNING);\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (data?.trackDeleted) {\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst participantId = data.trackDeleted.publisher;\n\t\t\t\tconst trackId = data.trackDeleted.shortId;\n\t\t\t\tconst pendingSubscription = this.#privateProperties.pendingSubscriptions[participantId]?.[trackId];\n\n\t\t\t\tif (pendingSubscription)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(pendingSubscription.timeout);\n\t\t\t\t\tdelete this.#privateProperties.pendingSubscriptions[participantId][trackId];\n\t\t\t\t\tthis.setLog(`Track with id ${trackId} was deleted during subscription attempt, cancel it`, LOG_LEVEL.WARNING);\n\t\t\t\t}\n\n\t\t\t\tif (participantId == this.#privateProperties.userId) return;\n\t\t\t\tthis.setLog(`Start deleting a track with id ${trackId} from a participant with id ${participantId} `, LOG_LEVEL.INFO);\n\t\t\t\tconst participant = this.#privateProperties.remoteParticipants[participantId];\n\t\t\t\tif (!participant)\n\t\t\t\t{\n\t\t\t\t\tthis.setLog(`Deleting a track with id ${trackId} failed: can't find a participant with id ${participantId}`, LOG_LEVEL.WARNING);\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tconst track = Object.values(participant.tracks)?.find(track => track?.id === trackId);\n\t\t\t\tdelete this.#privateProperties.tracksDataFromSocket[trackId];\n\n\t\t\t\tif (track)\n\t\t\t\t{\n\t\t\t\t\tif (track.source === MediaStreamsKinds.Microphone)\n\t\t\t\t\t{\n\t\t\t\t\t\tparticipant.audioEnabled = false;\n\t\t\t\t\t}\n\t\t\t\t\telse if (track.source === MediaStreamsKinds.Camera)\n\t\t\t\t\t{\n\t\t\t\t\t\tparticipant.videoEnabled = false;\n\t\t\t\t\t}\n\t\t\t\t\telse if (track.source === MediaStreamsKinds.Screen)\n\t\t\t\t\t{\n\t\t\t\t\t\tparticipant.screenSharingEnabled = false;\n\t\t\t\t\t}\n\t\t\t\t\tparticipant.removeTrack(track.source);\n\t\t\t\t\tthis.setLog(`Deleting a track with id ${trackId} from a participant with id ${participantId} (sid: ${participant.sid}) succeeded`, LOG_LEVEL.INFO);\n\t\t\t\t\tthis.triggerEvents('RemoteMediaRemoved', [participant, track]);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.setLog(`Deleting a track with id ${trackId} from a participant with id ${participantId} (sid: ${participant.sid}) failed: can't find a track`, LOG_LEVEL.WARNING);\n\t\t\t\t}\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tthis.setLog(`Deleting a track with id ${trackId} from a participant with id ${participantId} failed: ${e}`, LOG_LEVEL.ERROR);\n\t\t\t}\n\t\t} else if (data?.trackMuted) {\n\t\t\tthis.#trackMutedHandler(data.trackMuted);\n\t\t}\n\t\telse if (data.recorderStatus)\n\t\t{\n\t\t\tthis.triggerEvents('RecorderStatusChanged', [data.recorderStatus]);\n\t\t}\n\t\telse if (data?.trickle) {\n\t\t\tthis.#addIceCandidate(data.trickle);\n\t\t} else if (data?.newMessage) {\n\t\t\tconst message = new Message(data.newMessage)\n\t\t\tthis.triggerEvents('MessageReceived', [message]);\n\t\t} else if (data['1to1Info']) {\n\t\t\tconst message = new Message(data['1to1Info'])\n\t\t\tthis.triggerEvents('MessageReceived', [message]);\n\t\t} else if (data?.handRaised) {\n\t\t\tconst participant = this.#privateProperties.remoteParticipants[data.handRaised.participantId];\n\t\t\tif (participant)\n\t\t\t{\n\t\t\t\tparticipant.isHandRaised = data.handRaised.isHandRaised;\n\t\t\t\tthis.triggerEvents('HandRaised', [participant]);\n\t\t\t}\n\t\t} else if (data?.speakersChanged) {\n\t\t\tthis.#speakerChangedHandler(data)\n\t\t} else if (data?.connectionQuality) {\n\t\t\tif (!data.connectionQuality.updates)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst participants = {};\n\t\t\tconst participantsToUpdate = { ...this.#privateProperties.remoteParticipants };\n\n\t\t\tdata.connectionQuality.updates.forEach(participant => {\n\t\t\t\tObject.values(participantsToUpdate).forEach(remoteParticipant => {\n\n\t\t\t\t\tconst hasGoodQuality = participant.score > this.#privateProperties.minimalConnectionQuality;\n\t\t\t\t\tif (\n\t\t\t\t\t\tparticipant.participantSid === remoteParticipant.sid\n\t\t\t\t\t\t&& (\n\t\t\t\t\t\t\t!remoteParticipant.isMutedVideo\n\t\t\t\t\t\t\t|| !remoteParticipant.connectionQuality\n\t\t\t\t\t\t)\n\t\t\t\t\t\t&& !remoteParticipant.screenSharingEnabled\n\t\t\t\t\t) {\n\t\t\t\t\t\tparticipants[remoteParticipant.userId] = participant.score;\n\t\t\t\t\t\t// commented out for now, since a lot of log generated by this\n\t\t\t\t\t\t//this.setLog(`Quality of connection with a participant with id ${remoteParticipant.userId} (sid: ${remoteParticipant.sid}) changed to ${participant.score}`, hasGoodQuality ? LOG_LEVEL.INFO : LOG_LEVEL.WARNING);\n\t\t\t\t\t\tthis.#privateProperties.remoteParticipants[remoteParticipant.userId].connectionQuality = participant.score;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst isLocalVideoMuted = this.#privateProperties.localTracks[MediaStreamsKinds.Camera]\n\t\t\t\t\t\t&& this.#privateProperties.localTracks[MediaStreamsKinds.Camera].muted;\n\n\t\t\t\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t\t\t\t{\n\t\t\t\t\t\tif (participant.participantSid === this.#privateProperties.localParticipantSid)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.addValidatedMonitoringMetricWithLogging({\n\t\t\t\t\t\t\t\tmetricKey: MONITORING_METRICS_NAME_LIST.CONN_SCORE_CURRENT,\n\t\t\t\t\t\t\t\tmetricValue: participant.score,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tparticipant.participantSid === this.#privateProperties.localParticipantSid\n\t\t\t\t\t\t&& (\n\t\t\t\t\t\t\t!isLocalVideoMuted\n\t\t\t\t\t\t\t|| !this.#privateProperties.localConnectionQuality\n\t\t\t\t\t\t)\n\t\t\t\t\t\t&& !this.#privateProperties.localTracks[MediaStreamsKinds.Screen]\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tparticipants[this.#privateProperties.userId] = participant.score;\n\t\t\t\t\t\tthis.#privateProperties.localConnectionQuality =  participant.score;\n\t\t\t\t\t\t// commented out for now, since a lot of log generated by this\n\t\t\t\t\t\t//this.setLog(`Quality of connection with a mediaserver changed to ${participant.score}`, hasGoodQuality ? LOG_LEVEL.INFO : LOG_LEVEL.WARNING);\n\t\t\t\t\t\t// this.#toggleRemoteParticipantVideo(Object.keys(participantsToUpdate), hasGoodQuality);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\tthis.triggerEvents('ConnectionQualityChanged', [participants]);\n\t\t} else if (data.pongResp) {\n\t\t\tthis.#privateProperties.rtt = Date.now() - data.pongResp.lastPingTimestamp\n\t\t\tthis.#resetPingTimeout()\n\t\t} else if (data.leave) {\n\t\t\tthis.setLog(`Got leave signal with ${data.leave.reason} reason`, LOG_LEVEL.WARNING);\n\t\t\tthis.#beforeDisconnect();\n\n\t\t\tconst reasonsToReconnect = ['CHANGING_MEDIA_SERVER', 'FULL_RECONNECT_NEEDED', 'STATE_MISMATCH'];\n\n\t\t\tif (\n\t\t\t\t(data.leave.canReconnect || reasonsToReconnect.includes(data.leave.reason)) &&\n\t\t\t\tdata.leave.reason !== \"SIGNALING_DUPLICATE_PARTICIPANT\")\n\t\t\t{\n\t\t\t\tthis.#privateProperties.lastReconnectionReason = ReconnectionReason.LeaveCommand;\n\t\t\t\tthis.#reconnect({\n\t\t\t\t\treconnectionReason: 'GOT_LEAVE_SIGNAL',\n\t\t\t\t\treconnectionReasonInfo: `Leave reason ${data.leave.reason}`,\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#privateProperties.canReconnect = false;\n\t\t\t\tthis.triggerEvents('Failed', [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: data.leave.reason,\n\t\t\t\t\t\tleaveInformation: {code: data.leave.code, reason: data.leave.reason}\n\t\t\t\t\t}]);\n\t\t\t}\n\t\t}\n\t\telse if (data?.onErrorResponse)\n\t\t{\n\t\t\tthis.setLog(`Got signaling error: ${data.onErrorResponse.message}`, LOG_LEVEL.ERROR);\n\t\t}\n\t\telse if (data?.onActionSent)\n\t\t{\n\t\t\tif (data?.onActionSent.changeSettings)\n\t\t\t{\n\t\t\t\tthis.#settingsChangedHandler(data.onActionSent.changeSettings);\n\t\t\t}\n\t\t\telse if (data?.onActionSent.givePermissions)\n\t\t\t{\n\t\t\t\tthis.#userPermissionsChanged(data.onActionSent.givePermissions);\n\t\t\t}\n\t\t\telse if (data?.onActionSent.participantMuted)\n\t\t\t{\n\t\t\t\tthis.#participantMutedHandler(data.onActionSent.participantMuted);\n\t\t\t}\n\t\t\telse if (data?.onActionSent.allParticipantsMuted)\n\t\t\t{\n\t\t\t\tthis.#allParticipantsMutedHandler(data.onActionSent.allParticipantsMuted);\n\t\t\t}\n\t\t\telse if (data?.onActionSent.updateRole)\n\t\t\t{\n\t\t\t\tthis.#updateRoleHandler(data.onActionSent.updateRole);\n\t\t\t}\n\t\t}\n\t};\n\n\tsocketOnOpenHandler() {\n\t\twindow.addEventListener('unload', this.sendLeaveBound);\n\t};\n\n\tsocketOnCloseHandler(e) {\n\t\tthis.#beforeDisconnect();\n\n\t\tif (e?.code && e?.code !== 1005)\n\t\t{\n\t\t\tthis.setLog(`Socket closed with a code ${e.code}, reconnecting`, LOG_LEVEL.ERROR);\n\t\t\tthis.#privateProperties.lastReconnectionReason = ReconnectionReason.WsTransportClosed;\n\t\t\tthis.#reconnect({\n\t\t\t\treconnectionReason: 'WS_CONNECTION_CLOSED',\n\t\t\t\treconnectionReasonInfo: `Socket closed with a code ${e.code}`,\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.setLog(`Socket closed with a code ${e.code}`, LOG_LEVEL.ERROR);\n\t\t}\n\t};\n\tsocketOnErrorHandler() {\n\t\tthis.setLog(`Got a socket error`, LOG_LEVEL.ERROR);\n\t};\n\tasync onIceCandidate(target, event) {\n\t\tif (!event.candidate) return;\n\n\t\tif (Util.useTcpSdp() && event.candidate.protocol !== 'tcp')\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst trickle = {\n\t\t\tcandidateInit: JSON.stringify({\n\t\t\t\tcandidate: event.candidate.candidate,\n\t\t\t\tsdpMid: event.candidate?.sdpMid,\n\t\t\t\tsdpMLineIndex: event.candidate?.sdpMLineIndex,\n\t\t\t\tusernameFragment: event.candidate?.usernameFragment\n\t\t\t})\n\t\t};\n\n\t\tif (target) {\n\t\t\ttrickle.target = target;\n\t\t}\n\n\t\tthis.#sendSignal({ trickle });\n\t};\n\tonConnectionStateChange(subscriber) {\n\t\tconst state = subscriber\n\t\t\t? this.recipient.connectionState\n\t\t\t: this.sender.connectionState\n\n\t\tif (state === 'failed' && !this.#privateProperties.isReconnecting)\n\t\t{\n\t\t\tthis.setLog(`State of ${subscriber ? 'recipient' : 'sender'} peer connection changed to ${state}, reconnecting`, LOG_LEVEL.WARNING);\n\t\t\tif (this.#privateProperties.peerConnectionFailed)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#privateProperties.peerConnectionFailed = true;\n\t\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t\t{\n\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.PEER_CONNECTION_REFUSED,\n\t\t\t\t\twithCounter: true,\n\t\t\t\t});\n\t\t\t});\n\t\t\tthis.#beforeDisconnect();\n\t\t\tif (this.#privateProperties.canReconnect)\n\t\t\t{\n\t\t\t\tthis.#privateProperties.lastReconnectionReason = ReconnectionReason.PeerConnectionFailed;\n\t\t\t\tthis.#reconnect({\n\t\t\t\t\treconnectionReason: 'ON_CONNECTION_STATE_CHANGED',\n\t\t\t\t\treconnectionReasonInfo: `State of ${subscriber ? 'recipient' : 'sender'} peer connection changed to ${state}`,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse if (state === 'failed' || state === 'disconnected')\n\t\t{\n\t\t\tconst logMessage = `State of ${subscriber ? 'recipient' : 'sender'} PEER CONNECTION changed to ${state}`;\n\t\t\tthis.setLog(logMessage, LOG_LEVEL.WARNING);\n\t\t}\n\t}\n\n\tonIceConnectionStateChange(subscriber)\n\t{\n\t\tconst state = subscriber\n\t\t\t? this.recipient.iceConnectionState\n\t\t\t: this.sender.iceConnectionState;\n\n\t\tif (state === 'failed' || state === 'disconnected')\n\t\t{\n\t\t\tconst logMessage = `State of ${subscriber ? 'recipient' : 'sender'} ICE connection changed to ${state}`;\n\t\t\tthis.setLog(logMessage, LOG_LEVEL.WARNING);\n\t\t}\n\t}\n\n\t#resetPingTimeout() {\n\t\tthis.#clearPingTimeout()\n\t\tif (!this.#privateProperties.pingTimeoutDuration) {\n\t\t\treturn;\n\t\t}\n\t\tthis.#privateProperties.pingTimeout = setTimeout(() => {\n\t\t\tthis.setLog('Ping signal was not received, reconnecting', LOG_LEVEL.WARNING);\n\t\t\tthis.#beforeDisconnect();\n\t\t\tthis.#privateProperties.lastReconnectionReason = ReconnectionReason.PingPongMissed;\n\t\t\tthis.#reconnect({\n\t\t\t\treconnectionReason: 'PING_SIGNAL_NOT_RECEIVED',\n\t\t\t\treconnectionReasonInfo: ``,\n\t\t\t});\n\t\t}, this.#privateProperties.pingTimeoutDuration);\n\t}\n\n\n\t#clearPingTimeout() {\n\t\tif (this.#privateProperties.pingTimeout) {\n\t\t\tclearTimeout(this.#privateProperties.pingTimeout);\n\t\t}\n\t}\n\n\t#startPingInterval() {\n\t\tthis.#clearPingInterval()\n\t\tthis.#resetPingTimeout()\n\t\tif (!this.#privateProperties.pingIntervalDuration) {\n\t\t\treturn;\n\t\t}\n\t\tthis.#privateProperties.pingPongInterval = setInterval(() => {\n\t\t\tthis.#sendPing();\n\t\t}, this.#privateProperties.pingIntervalDuration);\n\t}\n\n\t#clearPingInterval() {\n\t\tthis.#clearPingTimeout();\n\t\tif (this.#privateProperties.pingPongInterval) {\n\t\t\tclearInterval(this.#privateProperties.pingPongInterval);\n\t\t}\n\t}\n\n\t#sendPing() {\n\t\tthis.#sendSignal({\n\t\t\tpingReq: {\n\t\t\t\ttimestamp: Date.now(),\n\t\t\t\trtt: this.#privateProperties.rtt\n\t\t\t}\n\t\t});\n\t}\n\n\ton(eventType, handler) {\n\t\tthis.#privateProperties.events.set(eventType, handler)\n\t\treturn this\n\t}\n\toff(eventType) {\n\t\tif (this.#privateProperties.events.has(eventType)) {\n\t\t\treturn this.#privateProperties.events.delete(eventType)\n\t\t}\n\t\treturn this\n\t}\n\n\ttriggerEvents(eventType, args) {\n\t\tif (this.#privateProperties.events.has(eventType)) {\n\t\t\tconst event = this.#privateProperties.events.get(eventType)\n\t\t\tif (args) {\n\t\t\t\tevent(...args)\n\t\t\t} else {\n\t\t\t\tevent()\n\t\t\t}\n\t\t}\n\t}\n\n\tisRecordable() {\n\t\tconsole.log('isRecordable')\n\t}\n\n\tsetBitrate(bitrate, MediaStreamKind) {\n\t\tthis.setLog('Start setting bitrate', LOG_LEVEL.INFO);\n\t\tlet track;\n\t\tlet isSimulcast;\n\t\tswitch (MediaStreamKind) {\n\t\t\tcase MediaStreamsKinds.Camera:\n\t\t\t\ttrack = this.#privateProperties.cameraStream.getVideoTracks[0];\n\t\t\t\tisSimulcast = this.#privateProperties.videoSimulcast;\n\t\t\t\tbreak;\n\t\t\tcase MediaStreamsKinds.Microphone:\n\t\t\t\ttrack = this.#privateProperties.microphoneStream.getAudioTracks[0];\n\t\t\t\tbreak;\n\t\t\tcase MediaStreamsKinds.Screen:\n\t\t\t\ttrack = this.#privateProperties.screenStream.getVideoTracks[0];\n\t\t\t\tbreak;\n\t\t}\n\t\tconst senders = this.sender.getSenders()\n\n\t\tsenders.forEach( (sender) => {\n\t\t\tconst params = sender.getParameters();\n\t\t\tif(!params || !params.encodings || params.encodings.length === 0)\n\t\t\t{\n\t\t\t\tthis.setLog('Setting bitrate failed: has no encodings in the sender parameters', LOG_LEVEL.WARNING);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tparams.encodings.forEach(encoding => {\n\t\t\t\t\tif (isSimulcast) {\n\t\t\t\t\t\tencoding.maxBitrate = bitrate < this.#privateProperties.defaultSimulcastBitrate[encoding.rid] ? bitrate : this.#privateProperties.defaultSimulcastBitrate[encoding.rid]\n\t\t\t\t\t} else {\n\t\t\t\t\t\tencoding.maxBitrate = bitrate\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\tsender.setParameters(params);\n\t\t\t\tthis.setLog('Setting bitrate succeeded', LOG_LEVEL.INFO);\n\t\t\t}\n\t\t});\n\t}\n\n\t#addPendingPublication(trackId, source)\n\t{\n\t\tthis.#privateProperties.pendingPublications[trackId] = setTimeout(() =>\n\t\t{\n\t\t\tdelete this.#privateProperties.pendingPublications[trackId];\n\t\t\tthis.onPublishFailed(source);\n\t\t}, this.#privateProperties.publicationTimeout);\n\t}\n\n\t#addPendingSubscription(participant, track, tries)\n\t{\n\t\tclearTimeout(this.#privateProperties.pendingSubscriptions[participant.userId]?.[track.sid]?.timeout);\n\t\tif (!this.#privateProperties.pendingSubscriptions[participant.userId])\n\t\t{\n\t\t\tthis.#privateProperties.pendingSubscriptions[participant.userId] = {};\n\t\t}\n\n\t\tif (tries === undefined)\n\t\t{\n\t\t\ttries = this.#privateProperties.subscriptionTries;\n\t\t}\n\n\t\tconst timeout = setTimeout(() => {\n\t\t\tthis.setLog(`Track ${track.sid} with kind ${track.source} for a participant with id ${participant.userId} (sid: ${participant.sid}) was not received, trying to subscribe to it`, LOG_LEVEL.WARNING);\n\t\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t\t{\n\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.TRACK_SUBSCRIPTION_DELAY,\n\t\t\t\t\twithCounter: true,\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tif (tries)\n\t\t\t{\n\t\t\t\tthis.#addPendingSubscription(participant, track, tries - 1)\n\t\t\t\tthis.#changeSubscriptionToTrack(track.sid, participant.sid, true);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.setLog(`Subscription to track ${track.sid} with kind ${track.source} for a participant with id ${participant.userId} (sid: ${participant.sid}) failed`, LOG_LEVEL.ERROR);\n\t\t\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t\t\t{\n\t\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.TRACK_SUBSCRIPTION_FAILED,\n\t\t\t\t\t\twithCounter: true\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tthis.triggerEvents('TrackSubscriptionFailed', [{participant: participant, track: track}]);\n\t\t\t}\n\t\t}, this.#privateProperties.subscriptionTimeout);\n\n\t\tthis.#privateProperties.pendingSubscriptions[participant.userId][track.sid] = {\n\t\t\ttimeout,\n\t\t\ttries,\n\t\t};\n\t}\n\n\tsetCodec(transceiver)\n\t{\n\t\tif (!('getCapabilities' in RTCRtpReceiver)) {\n\t\t\treturn;\n\t\t}\n\t\tconst cap = RTCRtpReceiver.getCapabilities('video');\n\t\tif (!cap) return;\n\t\tconst matched = [];\n\t\tconst partialMatched = [];\n\t\tconst unmatched = [];\n\t\tcap.codecs.forEach((c) => {\n\t\t\tconst codec = c.mimeType.toLowerCase();\n\t\t\tif (codec === 'audio/opus') {\n\t\t\t\tmatched.push(c);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst matchesVideoCodec = codec === `video/${this.#privateProperties.codec}`;\n\t\t\tif (!matchesVideoCodec) {\n\t\t\t\tunmatched.push(c);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// for h264 codecs that have sdpFmtpLine available, use only if the\n\t\t\t// profile-level-id is 42e01f for cross-browser compatibility\n\t\t\tif (this.#privateProperties.codec === 'h264') {\n\t\t\t\tif (c.sdpFmtpLine && c.sdpFmtpLine.includes('profile-level-id=42e01f')) {\n\t\t\t\t\tmatched.push(c);\n\t\t\t\t} else {\n\t\t\t\t\tpartialMatched.push(c);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tmatched.push(c);\n\t\t});\n\n\t\tif ('setCodecPreferences' in transceiver) {\n\t\t\t// console.log('setCodecPreferences', this.#privateProperties.codec, matched, partialMatched, unmatched);\n\t\t\ttransceiver.setCodecPreferences(matched.concat(partialMatched, unmatched));\n\t\t}\n\t}\n\n\tasync publishTrack(MediaStreamKind, MediaStreamTrack, StreamQualityOptions = {}) {\n\t\tif (!this.sender)\n\t\t{\n\t\t\tthis.setLog(`Publishing a track before a peer connection was created, ignoring`, LOG_LEVEL.WARNING);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setLog(`Start publishing a track with kind ${MediaStreamKind}`, LOG_LEVEL.INFO);\n\n\t\ttry {\n\t\t\tfor (let keys in StreamQualityOptions ) {\n\t\t\t\tthis.#privateProperties[`${keys}`] = StreamQualityOptions[keys]\n\t\t\t}\n\n\t\t\tconst source = MediaStreamKind;\n\t\t\tMediaStreamTrack.source = source;\n\t\t\tif (source === MediaStreamsKinds.Camera) {\n\t\t\t\tif( this.#privateProperties.videoSimulcast) {\n\t\t\t\t\tconst width = MediaStreamTrack.getSettings().width;\n\t\t\t\t\tconst height = MediaStreamTrack.getSettings().height;\n\n\t\t\t\t\tconst sender = this.#getSender(MediaStreamsKinds.Camera);\n\t\t\t\t\tif (sender)\n\t\t\t\t\t{\n\t\t\t\t\t\tawait sender.replaceTrack(MediaStreamTrack);\n\t\t\t\t\t\tthis.#updateVideoEncodings(sender, MediaStreamTrack);\n\t\t\t\t\t\tthis.setLog(`Publishing a track with kind ${MediaStreamKind} via replace track succeeded`, LOG_LEVEL.INFO);\n\t\t\t\t\t\tthis.triggerEvents('PublishSucceed', [MediaStreamsKinds.Camera]);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tconst encodings = this.#getEncodingsFromVideoWidth(width);\n\n\t\t\t\t\t\tthis.setLog('Add sender transceiver - direction: sendonly', LOG_LEVEL.INFO);\n\t\t\t\t\t\tconst transceiver = this.sender.addTransceiver(MediaStreamTrack, {\n\t\t\t\t\t\t\tdirection: 'sendonly',\n\t\t\t\t\t\t\tstreams: [this.#privateProperties.cameraStream],\n\t\t\t\t\t\t\tsendEncodings: MediaStreamTrack.sendEncodings || encodings,\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.setCodec(transceiver)\n\n\t\t\t\t\t\tthis.#addPendingPublication(MediaStreamTrack.id, source);\n\n\t\t\t\t\t\tthis.#sendSignal({\n\t\t\t\t\t\t\t\"addTrack\":  {\n\t\t\t\t\t\t\t\t\"cid\":  MediaStreamTrack.id,\n\t\t\t\t\t\t\t\t\"type\":  \"VIDEO\",\n\t\t\t\t\t\t\t\t\"width\":  width,\n\t\t\t\t\t\t\t\t\"height\":  height,\n\t\t\t\t\t\t\t\t\"source\":  source,\n\t\t\t\t\t\t\t\t\"layers\":  this.#getLayersFromEncodings(width, height, encodings),\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconst sender = this.#getSender(MediaStreamsKinds.Camera);\n\t\t\t\t\tif (sender)\n\t\t\t\t\t{\n\t\t\t\t\t\tawait sender.replaceTrack(MediaStreamTrack);\n\t\t\t\t\t\tthis.setLog(`Publishing a track with kind ${MediaStreamKind} via replace track succeeded`, LOG_LEVEL.INFO);\n\t\t\t\t\t\tthis.triggerEvents('PublishSucceed', [MediaStreamsKinds.Camera]);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setLog('Add sender transceiver - direction: sendonly', LOG_LEVEL.INFO);\n\t\t\t\t\t\tthis.sender.addTransceiver(MediaStreamTrack, {\n\t\t\t\t\t\t\tdirection: 'sendonly'\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.setBitrate(this.#privateProperties.videoBitrate, MediaStreamsKinds.Camera)\n\n\t\t\t\t\t\tconst width = MediaStreamTrack.getSettings().width\n\t\t\t\t\t\tconst height = MediaStreamTrack.getSettings().height\n\n\t\t\t\t\t\tthis.#addPendingPublication(MediaStreamTrack.id, source);\n\n\t\t\t\t\t\tthis.#sendSignal({\n\t\t\t\t\t\t\t\"addTrack\":  {\n\t\t\t\t\t\t\t\t\"cid\":  MediaStreamTrack.id,\n\t\t\t\t\t\t\t\t\"type\":  \"VIDEO\",\n\t\t\t\t\t\t\t\t\"width\":  width,\n\t\t\t\t\t\t\t\t\"height\":  height,\n\t\t\t\t\t\t\t\t\"source\":  source,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (source === MediaStreamsKinds.Microphone) {\n\t\t\t\tconst sender = this.#getSender(MediaStreamsKinds.Microphone);\n\t\t\t\tif (sender)\n\t\t\t\t{\n\t\t\t\t\tawait sender.replaceTrack(MediaStreamTrack);\n\t\t\t\t\tthis.setLog(`Publishing a track with kind ${MediaStreamKind} via replace track succeeded`, LOG_LEVEL.INFO);\n\t\t\t\t\tthis.triggerEvents('PublishSucceed', [MediaStreamsKinds.Microphone]);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.sender.addTransceiver(MediaStreamTrack, {\n\t\t\t\t\t\tdirection: 'sendonly'\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.#addPendingPublication(MediaStreamTrack.id, source);\n\n\t\t\t\t\tthis.#sendSignal({\n\t\t\t\t\t\t\"addTrack\":  {\n\t\t\t\t\t\t\t\"cid\" : MediaStreamTrack.id,\n\t\t\t\t\t\t\t\"source\":  source\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else if (source === MediaStreamsKinds.Screen) {\n\t\t\t\tthis.sender.addTransceiver(MediaStreamTrack, {\n\t\t\t\t\tdirection: 'sendonly'\n\t\t\t\t});\n\t\t\t\tconst width = MediaStreamTrack.getSettings().width\n\t\t\t\tconst height = MediaStreamTrack.getSettings().height\n\n\t\t\t\tthis.#addPendingPublication(MediaStreamTrack.id, source);\n\n\t\t\t\tthis.#sendSignal({\n\t\t\t\t\t\"addTrack\":  {\n\t\t\t\t\t\t\"cid\":  MediaStreamTrack.id,\n\t\t\t\t\t\t\"type\":  \"VIDEO\",\n\t\t\t\t\t\t\"width\":  width,\n\t\t\t\t\t\t\"height\":  height,\n\t\t\t\t\t\t\"source\":  source,\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else if (source === MediaStreamsKinds.ScreenAudio) {\n\t\t\t\tthis.sender.addTransceiver(MediaStreamTrack, {\n\t\t\t\t\tdirection: 'sendonly'\n\t\t\t\t});\n\t\t\t\tthis.sender.addTransceiver(MediaStreamTrack, {\n\t\t\t\t\tdirection: 'sendonly'\n\t\t\t\t});\n\n\t\t\t\tthis.#addPendingPublication(MediaStreamTrack.id, source);\n\n\t\t\t\tthis.#sendSignal({\n\t\t\t\t\t\"addTrack\":  {\n\t\t\t\t\t\t\"cid\" : MediaStreamTrack.id,\n\t\t\t\t\t\t\"source\":  source\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.#privateProperties.offersStack++;\n\t\t\tawait this.sendOffer();\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tif (MediaStreamKind === MediaStreamsKinds.Microphone)\n\t\t\t{\n\t\t\t\tthis.#privateProperties.needToDisableAudioAfterPublish = false;\n\t\t\t}\n\t\t\tthis.setLog(`Publishing a track with kind ${MediaStreamKind} failed: ${e}`, LOG_LEVEL.ERROR);\n\t\t\tthis.#releaseStream(MediaStreamKind);\n\t\t\tthis.onPublishFailed(MediaStreamKind);\n\t\t}\n\t}\n\n\t#getMaxEncodingsByVideoWidth(width)\n\t{\n\t\t// https://source.chromium.org/chromium/chromium/src/+/main:third_party/webrtc/video/config/simulcast.cc;l=76;\n\t\tif (width >= 960)\n\t\t{\n\t\t\treturn 3;\n\t\t}\n\t\telse if (width >= 480)\n\t\t{\n\t\t\treturn 2;\n\t\t}\n\t\treturn 1;\n\t}\n\n\t#getEncodingsFromVideoWidth(width)\n\t{\n\t\tconst maxEncodings = this.#getMaxEncodingsByVideoWidth(width);\n\t\tconst rids = ['q', 'h', 'f'];\n\t\tconst encodings = [];\n\n\t\tfor (let i = 0; i < 3; i++)\n\t\t{\n\t\t\tconst rid = rids[i];\n\t\t\tencodings.push({\n\t\t\t\trid,\n\t\t\t\tactive: i < maxEncodings,\n\t\t\t\tmaxBitrate: this.#privateProperties.defaultSimulcastBitrate[rid],\n\t\t\t\tscaleResolutionDownBy: 2 ** Math.max(0, (maxEncodings - 1 - i))\n\t\t\t});\n\t\t}\n\n\t\treturn encodings;\n\t};\n\n\t#getLayersFromEncodings(width, height, encodings)\n\t{\n\t\treturn encodings.map((encoding, index) =>\n\t\t{\n\t\t\treturn {\n\t\t\t\tquality: index,\n\t\t\t\twidth: width / encoding.scaleResolutionDownBy,\n\t\t\t\theight: height / encoding.scaleResolutionDownBy,\n\t\t\t\tbitrate: this.#privateProperties.defaultSimulcastBitrate[encoding.rid],\n\t\t\t}\n\t\t});\n\t}\n\n\t#updateVideoEncodings(sender, track)\n\t{\n\t\tconst params = sender.getParameters();\n\t\tconst width = track.getSettings().width;\n\t\tconst encodings = this.#getEncodingsFromVideoWidth(width);\n\n\t\tif (params && params.encodings && params.encodings.length)\n\t\t{\n\t\t\tparams.encodings.forEach((encoding) =>\n\t\t\t{\n\t\t\t\tconst encodingByRid = encodings.find(el => el.rid === encoding.rid);\n\t\t\t\tif (encodingByRid)\n\t\t\t\t{\n\t\t\t\t\tencoding.active = encodingByRid.active;\n\t\t\t\t\tencoding.maxBitrate = encodingByRid.maxBitrate;\n\t\t\t\t\tencoding.scaleResolutionDownBy = encodingByRid.scaleResolutionDownBy;\n\t\t\t\t}\n\t\t\t});\n\t\t\tsender.setParameters(params);\n\t\t}\n\t}\n\n\tasync changeStreamQuality(StreamQualityOptions) {\n\t\tfor (let key in StreamQualityOptions) {\n\t\t\tif (this.#privateProperties[`${key}`] !== StreamQualityOptions[key]) {\n\t\t\t\tthis.#privateProperties[`${key}`] = StreamQualityOptions[key]\n\n\t\t\t\tif (key === 'videoSimulcast' || (key === 'screenSimulcast' && this.#privateProperties.screenStream)) {\n\t\t\t\t\tconst kind = key === 'videoSimulcast'\n\t\t\t\t\t\t? MediaStreamsKinds.Camera\n\t\t\t\t\t\t: MediaStreamsKinds.Screen\n\n\t\t\t\t\tif (this.#getSender(kind)) {\n\t\t\t\t\t\tawait this.republishTrack(kind)\n\t\t\t\t\t}\n\t\t\t\t} else if ( ['videoBitrate', 'audioBitrate', 'screenBitrate'].includes(key)) {\n\t\t\t\t\tconst kind = key === 'videoBitrate'\n\t\t\t\t\t\t? MediaStreamsKinds.Camera\n\t\t\t\t\t\t: key === 'screenBitrate'\n\t\t\t\t\t\t\t? MediaStreamsKinds.Screen\n\t\t\t\t\t\t\t: MediaStreamsKinds.Microphone\n\n\t\t\t\t\tawait this.setBitrate(StreamQualityOptions[key], kind)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tasync republishTrack(MediaStreamKind) {\n\t\tthis.setLog(`Start republishing a track with kind ${MediaStreamKind}`, LOG_LEVEL.INFO);\n\t\tawait this.unpublishTrack(MediaStreamKind);\n\t\tconst track = await this.getTrack(MediaStreamKind);\n\t\tif (track) {\n\t\t\tawait this.publishTrack(MediaStreamKind, track);\n\t\t} else {\n\t\t\tthis.setLog(`Republishing a track with kind ${MediaStreamKind} failed: ${error}`, LOG_LEVEL.ERROR);\n\t\t\tthis.#releaseStream(MediaStreamKind);\n\t\t\tthis.triggerEvents('PublishFailed', [MediaStreamKind])\n\t\t}\n\t}\n\n\tasync unpublishTrack(MediaStreamKind) {\n\t\tthis.setLog(`Start unpublishing a track with kind ${MediaStreamKind}`, LOG_LEVEL.INFO);\n\t\tconst sender = this.#getSender(MediaStreamKind);\n\n\t\tif (sender) {\n\t\t\tthis.sender.removeTrack(sender);\n\t\t\tthis.#privateProperties.offersStack++;\n\t\t\tawait this.sendOffer();\n\t\t\tthis.setLog(`Unpublishing a track with kind ${MediaStreamKind} succeeded`, LOG_LEVEL.INFO);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.setLog(`Unpublishing a track with kind ${MediaStreamKind} failed: has no sender for a track`, LOG_LEVEL.ERROR);\n\t\t}\n\t}\n\n\ttoggleRemoteParticipantVideo(participantIds, showVideo, isPaginateToggle = false) {\n\t\tthis.#toggleRemoteParticipantVideo(participantIds, showVideo, isPaginateToggle);\n\t}\n\n\t#changeSubscriptionToTrack(trackId, participantId, subscribe)\n\t{\n\t\tthis.#sendSignal({\n\t\t\tsubscription: {\n\t\t\t\ttrackSids: [trackId],\n\t\t\t\tsubscribe,\n\t\t\t\tparticipantTracks: [\n\t\t\t\t\t{\n\t\t\t\t\t\tparticipantSid: participantId,\n\t\t\t\t\t\ttrackSids: [trackId],\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t}\n\t\t});\n\t}\n\n\t#pauseRemoteTrack(userId, trackId, trackSource, pause)\n\t{\n\t\tconst participant = this.#privateProperties.remoteParticipants[userId];\n\t\tif (!participant)\n\t\t{\n\t\t\tthis.setLog(`Trying to pause a track with kind ${trackSource} (sid: ${trackId}) for a non-existent participant with id ${userId}`, LOG_LEVEL.WARNING);\n\t\t\treturn;\n\t\t}\n\n\t\tparticipant.videoPaused = pause;\n\t\tthis.#sendSignal({\n\t\t\ttrackSetting: {\n\t\t\t\ttrackSids: [trackId],\n\t\t\t\tdisabled: pause,\n\t\t\t\tquality: this.#calculateVideoQualityForUser(userId, trackSource),\n\t\t\t}\n\t\t});\n\t}\n\n\t#calculateVideoQualityForUser(userId, source)\n\t{\n\t\tconst participant = this.#privateProperties.remoteParticipants[userId];\n\t\tconst exactUser = this.#privateProperties.mainStream.userId == userId;\n\t\tconst exactTrack = this.#privateProperties.mainStream.kind === source;\n\n\t\tlet quality = STREAM_QUALITY.LOW;\n\t\tif (exactUser && (exactTrack || !participant.screenSharingEnabled))\n\t\t{\n\t\t\tquality = STREAM_QUALITY.HIGH;\n\t\t}\n\t\telse if (!this.#privateProperties.mainStream.userId)\n\t\t{\n\t\t\tquality = this.#privateProperties.defaultRemoteStreamsQuality;\n\t\t}\n\n\t\treturn quality;\n\t}\n\n\t#changeRoomStreamsQuality(userId, kind) {\n\t\tthis.setLog(`Start changing a streams quality`, LOG_LEVEL.INFO);\n\t\tObject.values(this.getParticipants()).forEach(p =>\n\t\t{\n\t\t\tlet quality = this.#privateProperties.defaultRemoteStreamsQuality;\n\t\t\tif (userId)\n\t\t\t{\n\t\t\t\tconst exactUser = userId == p.userId;\n\t\t\t\tquality = exactUser && kind === MediaStreamsKinds.Camera ? STREAM_QUALITY.HIGH : STREAM_QUALITY.MEDIUM;\n\n\t\t\t\tif (exactUser)\n\t\t\t\t{\n\t\t\t\t\tthis.#privateProperties.mainStream = { userId, kind };\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#privateProperties.mainStream = {};\n\t\t\t}\n\n\t\t\tp.setStreamQuality(quality);\n\t\t\tthis.setLog(`Quality of video for a participant with id ${p.userId} (sid: ${p.sid}) was changed to ${quality}`, LOG_LEVEL.INFO);\n\t\t})\n\t}\n\n\t#toggleRemoteParticipantVideo(participantIds, showVideo, isPaginateToggle = false)\n\t{\n\t\tparticipantIds.forEach(participantId => {\n\t\t\tconst remoteParticipant = this.#privateProperties.remoteParticipants[participantId];\n\t\t\tif (remoteParticipant && remoteParticipant.tracks[MediaStreamsKinds.Camera] && remoteParticipant.isLocalVideoMute === showVideo)\n\t\t\t{\n\t\t\t\tremoteParticipant.isLocalVideoMute = !showVideo;\n\n\t\t\t\tif (remoteParticipant.isMutedVideo)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.#pauseRemoteTrack(\n\t\t\t\t\tremoteParticipant.userId,\n\t\t\t\t\tremoteParticipant.tracks[MediaStreamsKinds.Camera].id,\n\t\t\t\t\tremoteParticipant.tracks[MediaStreamsKinds.Camera].source,\n\t\t\t\t\tremoteParticipant.isLocalVideoMute\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\n\t\tif (!isPaginateToggle)\n\t\t{\n\t\t\tthis.triggerEvents('ToggleRemoteParticipantVideo', [showVideo]);\n\t\t}\n\t}\n\n\thangup(closeRoom = false) {\n\t\tif (this.#privateProperties.callState === CALL_STATE.TERMINATED)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#privateProperties.abortController.abort();\n\n\t\tthis.#privateProperties.callState = CALL_STATE.TERMINATED;\n\n\t\tthis.setLog(`Disconnecting from the call`, LOG_LEVEL.INFO);\n\t\tif (closeRoom)\n\t\t{\n\t\t\tthis.#sendSignal({\n\t\t\t\tcloseRoom: {\n\t\t\t\t\ttimestamp: Math.floor(Date.now() / 1000)\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#sendLeave();\n\t\t}\n\t\tthis.#beforeDisconnect();\n\t\tthis.#destroyPeerConnection();\n\n\t\tclearTimeout(this.#privateProperties.reconnectionTimeout);\n\n\t\tfor (let trackId in this.#privateProperties.pendingPublications)\n\t\t{\n\t\t\tclearTimeout(this.#privateProperties.pendingPublications[trackId]);\n\t\t}\n\t\tthis.#privateProperties.pendingPublications = {};\n\n\t\tfor (let userId in this.#privateProperties.pendingSubscriptions)\n\t\t{\n\t\t\tfor (let trackId in this.#privateProperties.pendingSubscriptions[userId])\n\t\t\t{\n\t\t\t\tclearTimeout(this.#privateProperties.pendingSubscriptions[userId][trackId].timeout);\n\t\t\t}\n\t\t}\n\t\tthis.#privateProperties.pendingSubscriptions = {};\n\n\t\tthis.#privateProperties.options = null;\n\t\tthis.#privateProperties.iceServers = null;\n\t\tthis.#privateProperties.lastReconnectionReason = null;\n\n\t\tthis.#releaseStream(MediaStreamsKinds.Camera);\n\t\tthis.#releaseStream(MediaStreamsKinds.Microphone);\n\t\tthis.#releaseStream(MediaStreamsKinds.Screen);\n\n\t\tthis.#privateProperties.rtt = 0;\n\t\tthis.#privateProperties.remoteTracks = {};\n\t\tthis.#privateProperties.isReconnecting = false;\n\t\tthis.#privateProperties.reconnectionAttempt = 0;\n\t\tthis.#privateProperties.mainStream = {};\n\n\t\tthis.triggerEvents('Disconnected');\n\t}\n\n\tisConnected() {\n\t\treturn this.#privateProperties.callState === CALL_STATE.CONNECTED\n\t}\n\n\tsetVideoStreamSetupErrorList(userId, kind)\n\t{\n\t\tconst errorInVideoStreamSetupErrorList = this.#privateProperties.videoStreamSetupErrorList[userId];\n\t\tconst kindInListKinds = !!errorInVideoStreamSetupErrorList && errorInVideoStreamSetupErrorList.includes(kind);\n\t\tconst kindsArray = errorInVideoStreamSetupErrorList || [];\n\n\t\tif (!kindInListKinds)\n\t\t{\n\t\t\tthis.#privateProperties.videoStreamSetupErrorList[userId] = [kind, ...kindsArray];\n\t\t}\n\t}\n\n\tsetMainStream(userId, kind)\n\t{\n\t\t// userId always exists, check in bitrix_call\n\t\tif (!this.#privateProperties.remoteParticipants[userId])\n\t\t{\n\t\t\tthis.setVideoStreamSetupErrorList(userId, kind);\n\t\t\tthis.setLog(`Setting main stream error (No remoteParticipant with ID - ${userId} in list)`, LOG_LEVEL.ERROR);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setLog(`Setting main stream for a participant width id ${userId} (sid: ${this.#privateProperties.remoteParticipants[userId].sid})`, LOG_LEVEL.INFO);\n\t\tthis.#changeRoomStreamsQuality(userId, kind);\n\t}\n\n\tresetMainStream() {\n\t\tthis.setLog(`Resetting main stream`, LOG_LEVEL.INFO);\n\t\tthis.#changeRoomStreamsQuality()\n\t}\n\n\tremoveTrack(mediaStreamKind) {\n\t\tconst trackSid = this.#privateProperties.localTracks[mediaStreamKind]?.sid\n\t\tif (trackSid)\n\t\t{\n\t\t\tthis.setLog(`Sending removeTrack signal for a track with kind ${mediaStreamKind} (sid: ${trackSid})`, LOG_LEVEL.INFO);\n\t\t\tdelete this.#privateProperties.localTracks[mediaStreamKind];\n\t\t\tthis.#sendSignal({\n\t\t\t\tremoveTrack: {\n\t\t\t\t\tsid: trackSid\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.setLog(`Sending removeTrack signal for a non-existent track with kind ${mediaStreamKind}`, LOG_LEVEL.WARNING);\n\t\t}\n\t}\n\n\tpauseTrack(mediaStreamKind, keepTrack) {\n\t\tconst trackSid = this.#privateProperties.localTracks[mediaStreamKind]?.sid;\n\t\tif (trackSid)\n\t\t{\n\t\t\tthis.setLog(`Sending pause signal (keep: ${keepTrack}) for a track with kind ${mediaStreamKind} (sid: ${trackSid})`, LOG_LEVEL.INFO);\n\t\t\tif (!keepTrack)\n\t\t\t{\n\t\t\t\tdelete this.#privateProperties.localTracks[mediaStreamKind];\n\t\t\t}\n\t\t\tthis.#sendSignal({\n\t\t\t\tmute: {\n\t\t\t\t\tsid: trackSid,\n\t\t\t\t\tmuted: true\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.setLog(`Sending pause signal for a non-existent track with kind ${mediaStreamKind}`, LOG_LEVEL.WARNING);\n\t\t}\n\t}\n\n\tunpauseTrack(mediaStreamKind) {\n\t\tconst trackSid = this.#privateProperties.localTracks[mediaStreamKind]?.sid;\n\t\tif (trackSid)\n\t\t{\n\t\t\tthis.setLog(`Sending unpause signal for a track with kind ${mediaStreamKind} (sid: ${trackSid})`, LOG_LEVEL.INFO);\n\t\t\tthis.#sendSignal({\n\t\t\t\tmute: {\n\t\t\t\t\tsid: trackSid,\n\t\t\t\t\tmuted: false\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.setLog(`Sending unpause signal for a non-existent track with kind ${mediaStreamKind}`, LOG_LEVEL.WARNING);\n\t\t}\n\t}\n\n\tdisableAudio(bySystem = false) {\n\t\tif (this.#privateProperties.mediaMutedBySystem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setLog('Start disabling audio', LOG_LEVEL.INFO);\n\t\tconst track = this.#privateProperties.microphoneStream?.getAudioTracks()[0];\n\t\tif (track)\n\t\t{\n\t\t\tthis.#privateProperties.needToEnableAudioAfterSystemMuted = bySystem ? track.enabled : false;\n\t\t\ttrack.enabled = false;\n\t\t\tthis.pauseTrack(MediaStreamsKinds.Microphone, true);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.setLog('Disabling audio failed: has no track', LOG_LEVEL.ERROR);\n\t\t}\n\t}\n\n\tasync enableAudio(disabled = false)\n\t{\n\t\tif (!Util.havePermissionToBroadcast('mic'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.setLog('Start enabling audio', LOG_LEVEL.INFO);\n\t\tthis.#privateProperties.needToEnableAudioAfterSystemMuted = false;\n\t\tif (this.#privateProperties.switchActiveAudioDeviceInProgress)\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tawait this.#privateProperties.switchActiveAudioDeviceInProgress;\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tthis.onPublishFailed(MediaStreamsKinds.Microphone);\n\t\t\t}\n\t\t}\n\t\tlet track = this.#privateProperties.microphoneStream?.getAudioTracks()[0];\n\t\tconst canUseUnpauseSignal = track && this.#privateProperties.localTracks[MediaStreamsKinds.Microphone];\n\t\tconst needToGetNewTrack = track?.readyState !== 'live';\n\n\t\tif (needToGetNewTrack)\n\t\t{\n\t\t\ttrack = await this.getLocalAudio();\n\t\t}\n\n\t\tif (!track)\n\t\t{\n\n\t\t\tthis.setLog('Enabling audio failed: has no track', LOG_LEVEL.ERROR);\n\t\t\tthis.#releaseStream(MediaStreamsKinds.Microphone);\n\t\t\tthis.triggerEvents('PublishFailed', [MediaStreamsKinds.Microphone]);\n\t\t}\n\n\t\tif (canUseUnpauseSignal)\n\t\t{\n\t\t\tthis.setLog('Enabling audio via unpause signal', LOG_LEVEL.INFO);\n\t\t\ttrack.enabled = true;\n\t\t\tawait this.publishTrack(MediaStreamsKinds.Microphone, track);\n\t\t\tthis.unpauseTrack(MediaStreamsKinds.Microphone);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.setLog('Enabling audio via publish', LOG_LEVEL.INFO);\n\t\t\ttrack.enabled = !disabled;\n\t\t\tif (disabled)\n\t\t\t{\n\t\t\t\tthis.#privateProperties.needToDisableAudioAfterPublish = true;\n\t\t\t}\n\t\t\tawait this.publishTrack(MediaStreamsKinds.Microphone, track);\n\t\t}\n\t}\n\n\tasync disableVideo(options)\n\t{\n\t\tconst bySystem = options?.bySystem || false;\n\t\tconst calledFrom = options?.calledFrom || '';\n\t\tconst hasQueue = this.#privateProperties.videoQueue !== VIDEO_QUEUE.INITIAL;\n\n\t\tthis.setLog(`Start disabling video - calledFrom: ${calledFrom}, isReconnecting: ${this.#privateProperties.isReconnecting}, bySystem: ${bySystem}, mediaMutedBySystem: ${this.#privateProperties.mediaMutedBySystem}, hasQueue: ${hasQueue}, videoQueue: ${this.#privateProperties.videoQueue} `, LOG_LEVEL.INFO);\n\t\t//console.warn(`Start disabling video - isReconnecting: ${this.#privateProperties.isReconnecting}, bySystem: ${bySystem}, mediaMutedBySystem: ${this.#privateProperties.mediaMutedBySystem}, calledFrom: ${calledFrom}, hasQueue: ${hasQueue}, videoQueue: ${this.#privateProperties.videoQueue} `);\n\t\tif (this.#privateProperties.isReconnecting)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#privateProperties.videoQueue = VIDEO_QUEUE.DISABLE;\n\n\t\tif (hasQueue)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst track = this.#privateProperties.cameraStream?.getVideoTracks()[0];\n\t\tif (track && this.#privateProperties.localTracks[MediaStreamsKinds.Camera])\n\t\t{\n\t\t\tif (this.#privateProperties.mediaMutedBySystem)\n\t\t\t{\n\t\t\t\tthis.#privateProperties.videoQueue = VIDEO_QUEUE.INITIAL;\n\t\t\t\tthis.#privateProperties.mediaMutedBySystem = false;\n\n\t\t\t\tthis.setLog(`Video disabling stops track - bySystem: ${bySystem}, mediaMutedBySystem: ${this.#privateProperties.mediaMutedBySystem}`, LOG_LEVEL.INFO);\n\t\t\t\ttrack.stop();\n\t\t\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t\t\t{\n\t\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.USER_CAMERA_DISABLED,\n\t\t\t\t\t\twithCounter: true\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tthis.triggerEvents('MediaMutedBySystem', [false]);\n\t\t\t\tthis.triggerEvents('PublishEnded', [MediaStreamsKinds.Camera]);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#privateProperties.localTracks[MediaStreamsKinds.Camera].muted = true;\n\n\t\t\tthis.setLog(`Video disabling pauses track - bySystem: ${bySystem}, mediaMutedBySystem: ${this.#privateProperties.mediaMutedBySystem}`, LOG_LEVEL.INFO);\n\t\t\tthis.pauseTrack(MediaStreamsKinds.Camera, true);\n\t\t\tif (!bySystem)\n\t\t\t{\n\t\t\t\tthis.#privateProperties.videoQueue = VIDEO_QUEUE.INITIAL;\n\n\t\t\t\tthis.setLog(`Video disabling stops track - bySystem: ${bySystem}, mediaMutedBySystem: ${this.#privateProperties.mediaMutedBySystem}`, LOG_LEVEL.INFO);\n\t\t\t\ttrack.stop();\n\t\t\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t\t\t{\n\t\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.USER_CAMERA_DISABLED,\n\t\t\t\t\t\twithCounter: true\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tthis.triggerEvents('PublishEnded', [MediaStreamsKinds.Camera]);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.setLog('Disabling video failed: has no track', LOG_LEVEL.ERROR);\n\t\t\tthis.#privateProperties.videoQueue = VIDEO_QUEUE.INITIAL;\n\t\t}\n\t}\n\n\tasync enableVideo(options) /* {calledFrom: 'processVideoQueue', skipUnpause: true} */\n\t{\n\t\tconst skipUnpause = options?.skipUnpause || false;\n\t\tconst calledFrom = options?.calledFrom || '';\n\t\tconst hasQueue = this.#privateProperties.videoQueue !== VIDEO_QUEUE.INITIAL;\n\n\t\tthis.setLog(`Start enabling video - calledFrom: ${calledFrom}, isReconnecting: ${this.#privateProperties.isReconnecting}, skipUnpause: ${skipUnpause}, mediaMutedBySystem: ${this.#privateProperties.mediaMutedBySystem}, hasQueue: ${hasQueue}, videoQueue: ${this.#privateProperties.videoQueue} `, LOG_LEVEL.INFO);\n\t\t//console.warn(`Start enabling video - calledFrom: ${calledFrom}, isReconnecting: ${this.#privateProperties.isReconnecting}, skipUnpause: ${skipUnpause}, mediaMutedBySystem: ${this.#privateProperties.mediaMutedBySystem}, hasQueue: ${hasQueue}, videoQueue: ${this.#privateProperties.videoQueue} `, LOG_LEVEL.INFO);\n\n\t\tif (this.#privateProperties.isReconnecting)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!Util.havePermissionToBroadcast('cam'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#privateProperties.videoQueue = VIDEO_QUEUE.ENABLE;\n\t\tif (hasQueue)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.#privateProperties.switchActiveVideoDeviceInProgress)\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tawait this.#privateProperties.switchActiveVideoDeviceInProgress;\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tthis.onPublishFailed(MediaStreamsKinds.Camera);\n\t\t\t}\n\t\t}\n\n\t\tlet hasTrack = !!this.#privateProperties.cameraStream?.getVideoTracks()[0];\n\t\tlet track = await this.getLocalVideo();\n\n\t\tif (track && hasTrack && this.#privateProperties.localTracks[MediaStreamsKinds.Camera])\n\t\t{\n\n\t\t\tif (this.#privateProperties.mediaMutedBySystem)\n\t\t\t{\n\t\t\t\tthis.#privateProperties.mediaMutedBySystem = false;\n\t\t\t\tthis.triggerEvents('MediaMutedBySystem', [false]);\n\t\t\t}\n\t\t\tif (skipUnpause)\n\t\t\t{\n\t\t\t\tthis.setLog('Re-enabling video after automatic camera change', LOG_LEVEL.INFO);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.setLog('Enabling video via unpause signal', LOG_LEVEL.INFO);\n\t\t\t}\n\t\t\tthis.#privateProperties.localTracks[MediaStreamsKinds.Camera].muted = false;\n\t\t\tawait this.publishTrack(MediaStreamsKinds.Camera, track);\n\t\t\tif (skipUnpause)\n\t\t\t{\n\t\t\t\tthis.#privateProperties.videoQueue = VIDEO_QUEUE.INITIAL;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.unpauseTrack(MediaStreamsKinds.Camera);\n\t\t\t}\n\t\t}\n\t\telse if (track)\n\t\t{\n\t\t\tthis.setLog('Enabling video via publish', LOG_LEVEL.INFO);\n\t\t\tawait this.publishTrack(MediaStreamsKinds.Camera, track);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.setLog('Enabling video failed: has no track', LOG_LEVEL.ERROR);\n\t\t\tthis.#privateProperties.videoQueue = VIDEO_QUEUE.INITIAL;\n\t\t\tthis.#releaseStream(MediaStreamsKinds.Camera);\n\t\t\tthis.triggerEvents('PublishFailed', [MediaStreamsKinds.Camera]);\n\t\t}\n\t}\n\n\t#processVideoQueue()\n\t{\n\t\tconst videoQueue = this.#privateProperties.videoQueue;\n\t\tthis.#privateProperties.videoQueue = VIDEO_QUEUE.INITIAL;\n\t\tif (videoQueue === VIDEO_QUEUE.ENABLE && this.#privateProperties.cameraStream?.getVideoTracks()[0].readyState !== 'live')\n\t\t{\n\t\t\tthis.enableVideo({calledFrom: 'processVideoQueue'});\n\t\t}\n\t\telse if (videoQueue === VIDEO_QUEUE.DISABLE && this.#privateProperties.cameraStream?.getVideoTracks()[0].readyState === 'live' && !this.#privateProperties.mediaMutedBySystem)\n\t\t{\n\t\t\tthis.disableVideo({calledFrom: 'processVideoQueue'});\n\t\t}\n\t}\n\n\tasync startScreenShare() {\n\t\tif (!Util.havePermissionToBroadcast('screenshare'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setLog('Start enabling screen sharing', LOG_LEVEL.INFO);\n\t\tconst tracks = await this.getLocalScreen()\n\t\tconst videoTrack = tracks?.video;\n\t\tconst audioTrack = tracks?.audio;\n\n\t\tif (!videoTrack)\n\t\t{\n\t\t\tthis.setLog('Enabling screen sharing failed: has no track', LOG_LEVEL.ERROR);\n\t\t\tthis.#releaseStream(MediaStreamsKinds.Screen);\n\t\t\tthis.onPublishFailed(MediaStreamsKinds.Screen);\n\t\t\tthis.onPublishFailed(MediaStreamsKinds.ScreenAudio);\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.publishTrack(MediaStreamsKinds.Screen, videoTrack);\n\n\t\tif (audioTrack)\n\t\t{\n\t\t\tawait this.publishTrack(MediaStreamsKinds.ScreenAudio, audioTrack);\n\t\t}\n\t}\n\n\tasync stopScreenShare() {\n\t\tthis.setLog('Start disabling screen sharing', LOG_LEVEL.INFO);\n\t\tthis.#releaseStream(MediaStreamsKinds.Screen);\n\t\tthis.removeTrack(MediaStreamsKinds.Screen);\n\t\tthis.removeTrack(MediaStreamsKinds.ScreenAudio);\n\t\tawait this.unpublishTrack(MediaStreamsKinds.Screen);\n\t\tawait this.unpublishTrack(MediaStreamsKinds.ScreenAudio);\n\t}\n\n\tsendMessage(message) {\n\t\tthis.#sendSignal({ sendMessage: { message } });\n\t}\n\n\tsend1to1Info(message) {\n\t\tthis.#sendSignal({ send1to1Info: { message } });\n\t}\n\n\traiseHand(raised) {\n\t\tthis.#sendSignal({ raiseHand: { raised } });\n\t}\n\n\tchangeSettings(options)\n\t{\n\t\tif (!Util.isUserControlFeatureEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet settingsObj = {};\n\n\t\tswitch (options.typeOfSetting){\n\t\t\tcase 'mic':\n\t\t\t\tsettingsObj =  { 'audioMutedEvent': { 'muted': !options.settingEnabled } };\n\t\t\t\tbreak;\n\t\t\tcase 'cam':\n\t\t\t\tthis.setLog(`Settings changes send videoMutedEvent (act: 'change_settings') - muted: ${!options.settingEnabled}`, LOG_LEVEL.INFO);\n\t\t\t\tsettingsObj =  { 'videoMutedEvent': { 'muted': !options.settingEnabled } };\n\t\t\t\tbreak;\n\t\t\tcase 'screenshare':\n\t\t\t\tsettingsObj =  { 'screenShareMutedEvent': { 'muted': !options.settingEnabled } };\n\t\t\t\tbreak;\n\t\t}\n\n\t\tthis.#sendSignal( { sendAction: {\n\t\t\tact: 'change_settings',\n\t\t\tchangeSettingsPayload: settingsObj\n\t\t}});\n\t}\n\n\tturnOffAllParticipansStream(options)\n\t{\n\t\tif (!Util.isUserControlFeatureEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif(options?.data)\n\t\t{\n\t\t\tif(options.data?.typeOfStream)\n\t\t\t{\n\t\t\t\tswitch (options.data.typeOfStream)\n\t\t\t\t{\n\t\t\t\t\tcase 'mic':\n\t\t\t\t\t\tthis.#sendSignal(\n\t\t\t\t\t\t{\tsendAction:\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tact: 'mute_others',\n\t\t\t\t\t\t\t\tmuteAllParticipantPayload:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\taudioMutedEvent:\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t'muted': true\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\n\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'cam':\n\t\t\t\t\t\tthis.setLog('turnOffAllParticipansStream send videoMutedEvent (act: \\'mute_others\\') - muted: true', LOG_LEVEL.INFO);\n\t\t\t\t\t\tthis.#sendSignal(\n\t\t\t\t\t\t{\tsendAction:\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tact: 'mute_others',\n\t\t\t\t\t\t\t\tmuteAllParticipantPayload:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tvideoMutedEvent:\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t'muted': true\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\n\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'screenshare':\n\t\t\t\t\t\tthis.#sendSignal(\n\t\t\t\t\t\t{\tsendAction:\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tact: 'mute_others',\n\t\t\t\t\t\t\t\tmuteAllParticipantPayload:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tscreenShareMutedEvent:\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t'muted': true\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tturnOffParticipantStream(options)\n\t{\n\t\tif (!Util.isUserControlFeatureEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif(!options.typeOfStream)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tswitch (options.typeOfStream)\n\t\t{\n\t\t\tcase 'mic':\n\t\t\t\tthis.#sendSignal({\n\t\t\t\t\tsendAction:\n\t\t\t\t\t{\n\t\t\t\t\t\tact: 'mute_others',\n\t\t\t\t\t\tmuteParticipantPayload:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'participantID': (options.userId + ''), // must be a String type\n\t\t\t\t\t\t\t'audioMutedEvent': { 'muted': true }\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\t\t\tcase 'cam':\n\t\t\t\tthis.setLog(`turnOffParticipantStream send videoMutedEvent (act: 'mute_others') - muted: true, participantID: ${options.userId}`, LOG_LEVEL.INFO);\n\t\t\t\tthis.#sendSignal({\n\t\t\t\t\tsendAction:\n\t\t\t\t\t{\n\t\t\t\t\t\tact: 'mute_others',\n\t\t\t\t\t\tmuteParticipantPayload:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'participantID': (options.userId + ''), // must be a String type\n\t\t\t\t\t\t\t'videoMutedEvent': { 'muted': true }\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\t\t\tcase 'screenshare':\n\t\t\t\tthis.#sendSignal({\n\t\t\t\t\tsendAction:\n\t\t\t\t\t{\n\t\t\t\t\t\tact: 'mute_others',\n\t\t\t\t\t\tmuteParticipantPayload:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'participantID': (options.userId + ''), // must be a String type\n\t\t\t\t\t\t\t'screenShareMutedEvent': { 'muted': true }\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tallowSpeakPermission(options)\n\t{\n\t\tif (Util.canControlGiveSpeakPermission())\n\t\t{\n\t\t\tthis.#sendSignal( { sendAction: {\n\t\t\t\t'act': 'give_permissions',\n\t\t\t\t'givePermissionsPayload':\n\t\t\t\t{\n\t\t\t\t\t'forUserId': (options.userId + ''),\n\t\t\t\t\t'allow': options.allow,\n\t\t\t\t},\n\t\t\t}});\n\t\t}\n\t}\n\n\tasync getLocalVideo() {\n\t\tconst readyState = this.#privateProperties.cameraStream?.getVideoTracks()[0].readyState;\n\t\tconst readyStateInfo = readyState ? ` - readyState: ${readyState}` : '';\n\t\tthis.setLog(`Local video getting${readyStateInfo}`, LOG_LEVEL.INFO);\n\t\tif (readyState !== 'live')\n\t\t{\n\t\t\tawait this.getTrack(MediaStreamsKinds.Camera);\n\t\t}\n\n\t\treturn this.#privateProperties.cameraStream?.getVideoTracks()[0];\n\t}\n\tasync getLocalAudio() {\n\t\tif (!this.#privateProperties.microphoneStream)\n\t\t{\n\t\t\tawait this.getTrack(MediaStreamsKinds.Microphone);\n\t\t}\n\n\t\treturn this.#privateProperties.microphoneStream?.getAudioTracks()[0];\n\t}\n\tasync getLocalScreen() {\n\t\tif (!this.#privateProperties.screenStream)\n\t\t{\n\t\t\tawait this.getTrack(MediaStreamsKinds.Screen);\n\t\t}\n\n\t\treturn {\n\t\t\tvideo: this.#privateProperties.screenStream?.getVideoTracks()[0],\n\t\t\taudio: this.#privateProperties.screenStream?.getAudioTracks()[0]\n\t\t};\n\t}\n\n\tasync #getUserMedia(options, fallbackMode = false) {\n\t\tthis.triggerEvents('GetUserMediaStarted', [options]);\n\n\t\tthis.setLog(`Start getting user media with options: ${JSON.stringify(options)}`, LOG_LEVEL.INFO);\n\t\tconst constraints = {\n\t\t\taudio: false,\n\t\t\tvideo: false,\n\t\t}\n\n\t\tlet stream = null\n\n\t\ttry {\n\t\t\tif (options.video) {\n\t\t\t\tconstraints.video = {};\n\n\t\t\t\tif (!fallbackMode)\n\t\t\t\t{\n\t\t\t\t\tconstraints.video.width = { ideal: this.#privateProperties.defaultVideoResolution.width };\n\t\t\t\t\tconstraints.video.height = { ideal: this.#privateProperties.defaultVideoResolution.height };\n\t\t\t\t}\n\n\t\t\t\tif (this.#privateProperties.videoDeviceId) {\n\t\t\t\t\tconstraints.video.deviceId = {exact: this.#privateProperties.videoDeviceId}\n\t\t\t\t}\n\t\t\t} else if (options.audio) {\n\t\t\t\tif (this.#privateProperties.audioDeviceId) {\n\t\t\t\t\tconstraints.audio = {\n\t\t\t\t\t\tdeviceId: {exact: this.#privateProperties.audioDeviceId}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconstraints.audio = true\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tstream = await Hardware.getUserMedia(constraints);\n\n\t\t\tif (options.video && stream.getVideoTracks()[0])\n\t\t\t{\n\t\t\t\tthis.triggerEvents('GetUserMediaSuccess', [{video: true}]);\n\t\t\t}\n\n\t\t\tif (options.audio && stream.getAudioTracks()[0])\n\t\t\t{\n\t\t\t\tthis.triggerEvents('GetUserMediaSuccess', [{audio: true}]);\n\t\t\t}\n\n\t\t\tif (options.video)\n\t\t\t{\n\t\t\t\tthis.#addTrackMuteHandlers(stream.getVideoTracks()[0]);\n\t\t\t}\n\t\t\tconst trackMuteHandlersAreAddedInfo = options.video ? ' - trackMuteHandlersAreAdded: true' : '';\n\t\t\tthis.setLog(`Getting user media with constraints: ${JSON.stringify(constraints)} succeeded${trackMuteHandlersAreAddedInfo}`, LOG_LEVEL.INFO);\n\t\t} catch (e) {\n\t\t\tif (options.video)\n\t\t\t{\n\t\t\t\tthis.setLog(`Getting user media with constraints: ${JSON.stringify(constraints)} failed (fallbackMode: ${fallbackMode}): ${e}`, LOG_LEVEL.ERROR);\n\n\t\t\t\tif (!fallbackMode)\n\t\t\t\t{\n\t\t\t\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.LOCAL_VIDEO_STREAM_RECEIVING_FAILED,\n\t\t\t\t\t\t\twithCounter: true,\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\tstream = await this.#getUserMedia(options, true);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (options.audio)\n\t\t\t{\n\t\t\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t\t\t{\n\t\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.LOCAL_MICROPHONE_STREAM_RECEIVING_FAILED,\n\t\t\t\t\t\twithCounter: true,\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.setLog(`Getting user media with constraints: ${JSON.stringify(constraints)} failed: ${e}`, LOG_LEVEL.ERROR);\n\t\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t\t{\n\t\t\t\tthis.addMonitoringEvents({ name: MONITORING_EVENTS_NAME_LIST.GET_LOCAL_TRACK_ERROR,\n\t\t\t\t\tvalue: {\n\t\t\t\t\t\ttype: 'main'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t} finally {\n\t\t\tthis.triggerEvents('GetUserMediaEnded');\n\t\t\treturn stream\n\t\t}\n\t}\n\n\tasync #getDisplayMedia() {\n\t\tthis.setLog('Start getting display media', LOG_LEVEL.INFO);\n\t\tlet stream = null;\n\n\t\ttry {\n\t\t\tif (window[\"BXDesktopSystem\"] && window[\"BXDesktopSystem\"].GetProperty('versionParts')[3] < 78) {\n\t\t\t\tstream = await Hardware.getUserMedia({\n\t\t\t\t\tvideo: {\n\t\t\t\t\t\tmandatory: {\n\t\t\t\t\t\t\tchromeMediaSource: 'screen',\n\t\t\t\t\t\t\tmaxWidth: 1920,\n\t\t\t\t\t\t\tmaxHeight: 1080,\n\t\t\t\t\t\t\tmaxFrameRate: 5\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tstream = await navigator.mediaDevices.getDisplayMedia({\n\t\t\t\t\tvideo: {\n\t\t\t\t\t\tcursor: 'always',\n\t\t\t\t\t\twidth: {\n\t\t\t\t\t\t\tideal: 1920\n\t\t\t\t\t\t},\n\t\t\t\t\t\theight: {\n\t\t\t\t\t\t\tideal: 1080\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tsystemAudio: 'include',\n\t\t\t\t\taudio: true,\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.setLog('Getting display media succeeded', LOG_LEVEL.INFO);\n\t\t} catch (e) {\n\t\t\tthis.setLog(`Getting display media failed: ${e}`, LOG_LEVEL.ERROR);\n\t\t\tthis.checkQosFeatureAndExecutionCallback(() => {\n\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.LOCAL_SCREEN_STREAM_RECEIVING_FAILED,\n\t\t\t\t\twithCounter: true,\n\t\t\t\t});\n\t\t\t});\n\t\t} finally {\n\t\t\treturn stream;\n\t\t}\n\t}\n\n\tasync getTrack(MediaStreamKind) {\n\t\tif (MediaStreamKind === MediaStreamsKinds.Camera)\n\t\t{\n\t\t\tconst readyState = this.#privateProperties.cameraStream?.getVideoTracks()[0]?.readyState;\n\t\t\tconst readyStateInfo = readyState ? ` - readyState: ${readyState}` : '';\n\t\t\tthis.setLog(`Video rack getting${readyStateInfo}`, LOG_LEVEL.INFO);\n\t\t}\n\n\t\tif (MediaStreamKind === MediaStreamsKinds.Camera && this.#privateProperties.cameraStream?.getVideoTracks()[0]?.readyState !== 'live')\n\t\t{\n\t\t\tthis.#privateProperties.cameraStream = await this.#getUserMedia({video: true});\n\t\t}\n\t\telse if (MediaStreamKind === MediaStreamsKinds.Microphone && !this.#privateProperties.microphoneStream)\n\t\t{\n\t\t\tthis.#privateProperties.microphoneStream = await this.#getUserMedia({audio: true});\n\t\t}\n\t\telse if (MediaStreamKind === MediaStreamsKinds.Screen && !this.#privateProperties.screenStream)\n\t\t{\n\t\t\tthis.#privateProperties.screenStream = await this.#getDisplayMedia();\n\t\t}\n\n\t\tif (this.#privateProperties.abortController.signal.aborted)\n\t\t{\n\t\t\tthis.#releaseStream(MediaStreamKind);\n\t\t\treturn;\n\t\t}\n\n\t\tlet track;\n\n\t\tif (MediaStreamKind === MediaStreamsKinds.Screen)\n\t\t{\n\t\t\ttrack = this.#privateProperties.screenStream?.getVideoTracks()[0];\n\t\t\tif (track && track.readyState !== 'live')\n\t\t\t{\n\t\t\t\tthis.#privateProperties.screenStream = null;\n\t\t\t\ttrack = this.getLocalScreen();\n\t\t\t}\n\t\t}\n\t\telse if (MediaStreamKind === MediaStreamsKinds.Camera)\n\t\t{\n\t\t\ttrack = this.#privateProperties.cameraStream?.getVideoTracks()[0];\n\t\t\tconst readyState = track.readyState;\n\t\t\tconst readyStateInfo = readyState ? ` - readyState: ${readyState}` : '';\n\t\t\tthis.setLog(`New video track getting${readyStateInfo}`, LOG_LEVEL.INFO);\n\t\t\tif (track && track.readyState !== 'live')\n\t\t\t{\n\t\t\t\tthis.#privateProperties.cameraStream = null;\n\t\t\t\ttrack = this.getLocalVideo();\n\t\t\t}\n\t\t}\n\t\telse if (MediaStreamKind === MediaStreamsKinds.Microphone)\n\t\t{\n\t\t\ttrack = this.#privateProperties.microphoneStream?.getAudioTracks()[0];\n\t\t\tif (track && track.readyState !== 'live')\n\t\t\t{\n\t\t\t\tthis.#privateProperties.microphoneStream = null;\n\t\t\t\ttrack = this.getLocalAudio();\n\t\t\t}\n\t\t}\n\n\t\tif (track && !track.onended)\n\t\t{\n\t\t\tconst interrupted = MediaStreamKind === MediaStreamsKinds.Microphone\n\t\t\t\t|| MediaStreamKind === MediaStreamsKinds.Camera;\n\n\t\t\ttrack.onended = () => {\n\t\t\t\tif (this.#privateProperties.localTracks[MediaStreamKind])\n\t\t\t\t{\n\t\t\t\t\tthis.#privateProperties.localTracks[MediaStreamKind].muted = true;\n\t\t\t\t\tif (MediaStreamKind === MediaStreamsKinds.Camera)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setLog('Video track is ended - muted: true', LOG_LEVEL.INFO);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.triggerEvents('PublishEnded', [MediaStreamKind, interrupted]);\n\t\t\t};\n\t\t}\n\n\t\treturn track;\n\t}\n\n\tasync switchActiveAudioDevice(deviceId, force) {\n\t\tif (this.#privateProperties.switchActiveAudioDeviceInProgress && !force)\n\t\t{\n\t\t\tthis.setLog(`Got another request to switch an audio device to ${deviceId}, saving it`, LOG_LEVEL.INFO);\n\t\t\tthis.#privateProperties.switchActiveAudioDevicePending = deviceId;\n\t\t\treturn;\n\t\t}\n\n\t\tlet error = null;\n\t\tlet fulfilled = false;\n\t\tthis.setLog(`Start switching an audio device to ${deviceId}`, LOG_LEVEL.INFO);\n\n\t\tconst promise = new Promise(async (resolve, reject) => {\n\t\t\tthis.#privateProperties.audioDeviceId = deviceId;\n\t\t\tconst prevStream = this.#privateProperties.microphoneStream;\n\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst sender = this.#getSender(MediaStreamsKinds.Microphone);\n\n\t\t\t\tif (!sender)\n\t\t\t\t{\n\t\t\t\t\tthis.setLog('Switching an audio device skipped - no sender', LOG_LEVEL.WARNING);\n\t\t\t\t\terror = 'No sender for audio';\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst prevTrack = this.#privateProperties.microphoneStream?.getAudioTracks()[0];\n\t\t\t\tthis.#privateProperties.microphoneStream = null;\n\t\t\t\tlet prevTrackEnabledState = true;\n\t\t\t\tlet prevTrackId = '';\n\t\t\t\tif (prevTrack)\n\t\t\t\t{\n\t\t\t\t\tprevTrackEnabledState = prevTrack.enabled;\n\t\t\t\t\tprevTrackId = prevTrack.id;\n\t\t\t\t\tprevTrack.stop();\n\t\t\t\t}\n\t\t\t\tconst audioTrack = await this.getLocalAudio();\n\t\t\t\taudioTrack.source = MediaStreamsKinds.Microphone;\n\t\t\t\taudioTrack.enabled = prevTrackEnabledState;\n\t\t\t\tif ((this.isAudioPublished() || sender.track.id !== audioTrack.id || audioTrack.id !== prevTrackId))\n\t\t\t\t{\n\t\t\t\t\tthis.setLog('Have sender for audio, start replacing track', LOG_LEVEL.INFO);\n\t\t\t\t\tawait sender.replaceTrack(audioTrack);\n\t\t\t\t}\n\t\t\t\tthis.setLog('Switching an audio device succeeded', LOG_LEVEL.INFO);\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\terror = e;\n\t\t\t\tthis.setLog(`Switching an audio device failed: ${e}`, LOG_LEVEL.ERROR);\n\t\t\t\tif (!this.#privateProperties.microphoneStream)\n\t\t\t\t{\n\t\t\t\t\tthis.#privateProperties.microphoneStream = prevStream;\n\t\t\t\t}\n\t\t\t}\n\t\t\tfinally\n\t\t\t{\n\t\t\t\tif (this.#privateProperties.switchActiveAudioDevicePending)\n\t\t\t\t{\n\t\t\t\t\tconst deviceId = this.#privateProperties.switchActiveAudioDevicePending;\n\t\t\t\t\tthis.#privateProperties.switchActiveAudioDevicePending = null;\n\t\t\t\t\tresolve(this.switchActiveAudioDevice(deviceId , true));\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tfulfilled = true;\n\t\t\t\t\tthis.#privateProperties.switchActiveAudioDeviceInProgress = null;\n\t\t\t\t\treturn error ? reject(error) : resolve();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (!force && !fulfilled)\n\t\t{\n\t\t\tthis.#privateProperties.switchActiveAudioDeviceInProgress = promise;\n\t\t}\n\n\t\treturn promise;\n\t}\n\n\tasync switchActiveVideoDevice(deviceId, force) {\n\t\tif (this.#privateProperties.switchActiveVideoDeviceInProgress && !force)\n\t\t{\n\t\t\tthis.setLog(`Got another request to switch a video device to ${deviceId}, saving it`, LOG_LEVEL.INFO);\n\t\t\tthis.#privateProperties.switchActiveVideoDevicePending = deviceId;\n\t\t\treturn;\n\t\t}\n\n\t\tlet error = null;\n\t\tlet fulfilled = false;\n\t\tthis.setLog(`Start switching a video device to ${deviceId}`, LOG_LEVEL.INFO);\n\n\t\tconst promise = new Promise(async (resolve, reject) => {\n\t\t\tthis.#privateProperties.videoDeviceId = deviceId;\n\t\t\tconst prevStream = this.#privateProperties.cameraStream;\n\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst sender = this.#getSender(MediaStreamsKinds.Camera);\n\n\t\t\t\tif (!sender)\n\t\t\t\t{\n\t\t\t\t\tthis.setLog('Switching a video device skipped - no sender', LOG_LEVEL.WARNING);\n\t\t\t\t\terror = 'No sender for video';\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.isVideoPublished())\n\t\t\t\t{\n\t\t\t\t\tthis.setLog('Have sender for video, start replacing track', LOG_LEVEL.INFO);\n\t\t\t\t\tthis.#privateProperties.cameraStream?.getVideoTracks()[0].stop();\n\t\t\t\t\tthis.#privateProperties.cameraStream = null;\n\n\t\t\t\t\tconst videoTrack = await this.getLocalVideo();\n\t\t\t\t\tvideoTrack.source = MediaStreamsKinds.Camera;\n\t\t\t\t\tawait sender.replaceTrack(videoTrack);\n\t\t\t\t\tthis.#updateVideoEncodings(sender, videoTrack);\n\t\t\t\t}\n\t\t\t\tthis.setLog('Switching a video device succeeded', LOG_LEVEL.INFO);\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\terror = e;\n\t\t\t\tthis.setLog(`Switching a video device failed: ${e}`, LOG_LEVEL.ERROR);\n\t\t\t\tif (!this.#privateProperties.cameraStream)\n\t\t\t\t{\n\t\t\t\t\tthis.#privateProperties.cameraStream = prevStream;\n\t\t\t\t}\n\t\t\t}\n\t\t\tfinally\n\t\t\t{\n\t\t\t\tif (this.#privateProperties.switchActiveVideoDevicePending)\n\t\t\t\t{\n\t\t\t\t\tconst deviceId = this.#privateProperties.switchActiveVideoDevicePending;\n\t\t\t\t\tthis.#privateProperties.switchActiveVideoDevicePending = null;\n\t\t\t\t\tresolve(this.switchActiveVideoDevice(deviceId , true));\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tfulfilled = true;\n\t\t\t\t\tthis.#privateProperties.switchActiveVideoDeviceInProgress = null;\n\t\t\t\t\treturn error ? reject(error) : resolve();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (!force && !fulfilled)\n\t\t{\n\t\t\tthis.#privateProperties.switchActiveVideoDeviceInProgress = promise;\n\t\t}\n\n\t\treturn promise;\n\t}\n\n\tisAudioPublished()\n\t{\n\t\treturn this.#privateProperties.localTracks[MediaStreamsKinds.Microphone] && this.#privateProperties.localTracks[MediaStreamsKinds.Microphone]?.muted !== true;\n\t}\n\n\tisVideoPublished()\n\t{\n\t\treturn this.#privateProperties.localTracks[MediaStreamsKinds.Camera] && this.#privateProperties.localTracks[MediaStreamsKinds.Camera]?.muted !== true ;\n\t}\n\n\t#addTrackMuteHandlers(track)\n\t{\n\t\ttrack.onmute = (event) =>\n\t\t{\n\t\t\tthis.setLog('Video track event \"mute\" was triggered', LOG_LEVEL.INFO);\n\t\t\tthis.#privateProperties.mediaMutedBySystem = false;\n\t\t\tthis.disableVideo({calledFrom: 'track.onmute', bySystem: true});\n\t\t\tthis.disableAudio(true);\n\t\t\tthis.#privateProperties.mediaMutedBySystem = true;\n\t\t\tthis.triggerEvents('MediaMutedBySystem', [true]);\n\t\t};\n\n\t\ttrack.onunmute = (event) =>\n\t\t{\n\t\t\tthis.setLog('Video track event \"unmute\" was triggered', LOG_LEVEL.INFO);\n\t\t\tif (this.#privateProperties.mediaMutedBySystem)\n\t\t\t{\n\t\t\t\tthis.#privateProperties.mediaMutedBySystem = false;\n\t\t\t\tthis.triggerEvents('MediaMutedBySystem', [false]);\n\t\t\t}\n\t\t\tthis.enableVideo({calledFrom: 'track.onunmute'});\n\t\t\tif (this.#privateProperties.needToEnableAudioAfterSystemMuted)\n\t\t\t{\n\t\t\t\tthis.enableAudio();\n\t\t\t}\n\t\t};\n\t}\n\n\tgetParticipants() {\n\t\treturn this.#privateProperties.remoteParticipants\n\t}\n\n\tgetState() {\n\t\treturn this.#privateProperties.callState\n\t}\n\n\tsetRecorderState(status)\n\t{\n\t\tif (!Object.values(RecorderStatus).includes(status))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst signal = {\n\t\t\trecorderControl: {\n\t\t\t\tstatus: status,\n\t\t\t}\n\t\t};\n\n\t\treturn this.isConnected() ? this.#sendSignal(signal) : false;\n\t}\n\n\tsetLog(log, level) {\n\t\tlevel = LOG_LEVEL[level] || LOG_LEVEL.INFO;\n\n\t\tif (this.#privateProperties.isloggingEnable)\n\t\t{\n\t\t\tconst desktopVersion = window['BXDesktopSystem']?.ApiVersion?.();\n\t\t\tconst version = ClientVersion + (desktopVersion ? ` (desktopApi: ${desktopVersion})` : '');\n\t\t\tconst data = {\n\t\t\t\ttimestamp: Math.floor(Date.now() / 1000),\n\t\t\t\ttimestampMS: Date.now(),\n\t\t\t\tevent: log,\n\t\t\t\tclient: ClientPlatform,\n\t\t\t\tappVersion: version,\n\t\t\t};\n\t\t\tconst logLength = Object.values(this.#privateProperties.logs).length;\n\t\t\tthis.#privateProperties.logs[logLength] = {\n\t\t\t\tlevel,\n\t\t\t\tdata,\n\t\t\t};\n\t\t\tlet lastSentLog = 0;\n\n\t\t\tfor (let index in this.#privateProperties.logs)\n\t\t\t{\n\t\t\t\tif (!this.#sendLog(this.#privateProperties.logs[index].data, this.#privateProperties.logs[index].level))\n\t\t\t\t{\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tlastSentLog = index;\n\t\t\t}\n\n\t\t\tif (lastSentLog)\n\t\t\t{\n\t\t\t\tthis.#privateProperties.logs = Object.values(this.#privateProperties.logs).slice(lastSentLog + 1);\n\t\t\t}\n\n\t\t\tif (this.#privateProperties.loggerCallback) {\n\t\t\t\tthis.#privateProperties.loggerCallback();\n\t\t\t}\n\t\t}\n\t}\n\n\t#sendLog(log, level) {\n\t\tif (!Util.isKibanaLogsEnabled())\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tconst signal = {\n\t\t\tsendLog: {\n\t\t\t\tuserName: `${this.#privateProperties.userId}`,\n\t\t\t\tdata: JSON.stringify(log),\n\t\t\t\tmsgLevel: level,\n\t\t\t}\n\t\t};\n\n\t\treturn this.isConnected() ? this.#sendSignal(signal) : false;\n\t}\n\n\tsetLoggerCallback(callback) {\n\t\tthis.#privateProperties.loggerCallback = callback;\n\t}\n\n\tenableSilentLogging(enable) {\n\t\tthis.#privateProperties.isloggingEnable = enable;\n\t}\n\n\t#removeUdpFromSdp(sdp)\n\t{\n\t\tconst updatedSdp = [];\n\t\tsdp.split(/(\\r\\n|\\r|\\n)/).filter(RegExp.prototype.test.bind(/^([a-z])=(.*)/)).forEach((el) =>\n\t\t{\n\t\t\tif (!el.startsWith('a=candidate') || el.includes('tcp'))\n\t\t\t{\n\t\t\t\tupdatedSdp.push(el);\n\t\t\t}\n\t\t});\n\n\t\tsdp = updatedSdp.join('\\r\\n') + '\\r\\n';\n\n\t\treturn sdp;\n\t}\n\n\tasync #answerHandler(data) {\n\t\tthis.setLog('Start handling a remote answer', LOG_LEVEL.INFO);\n\t\tlet hasError = false;\n\t\ttry\n\t\t{\n\t\t\tif (Util.useTcpSdp())\n\t\t\t{\n\t\t\t\tdata.answer.sdp = this.#removeUdpFromSdp(data.answer.sdp);\n\t\t\t}\n\t\t\tawait this.sender.setRemoteDescription(data.answer);\n\t\t\tthis.#privateProperties.pendingCandidates.sender.forEach((candidate) =>\n\t\t\t{\n\t\t\t\tthis.sender.addIceCandidate(candidate);\n\t\t\t\tthis.setLog('Added a deferred ICE candidate', LOG_LEVEL.INFO);\n\t\t\t});\n\t\t\tthis.#privateProperties.pendingCandidates.sender = [];\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tthis.setLog(`Handling a remote answer failed: ${e}`, LOG_LEVEL.ERROR);\n\t\t\thasError = true;\n\t\t\tthis.#beforeDisconnect();\n\t\t\tthis.#reconnect({\n\t\t\t\treconnectionReason: 'HANDLING_ANSWER',\n\t\t\t\treconnectionReasonInfo: `Handling a remote answer failed: ${e}`,\n\t\t\t});\n\t\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t\t{\n\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.PEER_CONNECTION_ISSUES,\n\t\t\t\t\tvalue: 1,\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\tfinally\n\t\t{\n\t\t\tif (!hasError)\n\t\t\t{\n\t\t\t\tthis.setLog('Handling a remote answer succeeded', LOG_LEVEL.INFO);\n\t\t\t\tthis.#privateProperties.isWaitAnswer = false;\n\t\t\t\tawait this.sendOffer();\n\t\t\t}\n\t\t}\n\t}\n\n\tasync #offerHandler(data)\n\t{\n\t\tthis.setLog('Handling a remote offer', LOG_LEVEL.INFO);\n\n\t\tif (!this.recipient)\n\t\t{\n\t\t\tthis.setLog('Handling a remote offer deferred');\n\t\t\tthis.#privateProperties.pendingOffer = data;\n\n\t\t\treturn;\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tif (Util.useTcpSdp())\n\t\t\t{\n\t\t\t\tdata.offer.sdp = this.#removeUdpFromSdp(data.offer.sdp);\n\t\t\t}\n\t\t\tawait this.recipient.setRemoteDescription(data.offer);\n\t\t\tthis.#privateProperties.pendingCandidates.recipient.forEach((candidate) => {\n\t\t\t\tthis.recipient.addIceCandidate(candidate);\n\t\t\t\tthis.setLog('Added a deferred ICE candidate', LOG_LEVEL.INFO);\n\t\t\t});\n\t\t\tthis.#privateProperties.pendingCandidates.recipient = [];\n\t\t\tlet answer = await this.recipient.createAnswer();\n\t\t\tif (Util.useTcpSdp())\n\t\t\t{\n\t\t\t\tanswer = {\n\t\t\t\t\ttype: answer.type,\n\t\t\t\t\tsdp: this.#removeUdpFromSdp(answer.sdp),\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tawait this.recipient.setLocalDescription(answer);\n\t\t\tthis.#sendSignal({ answer });\n\t\t\tthis.setLog('Handling a remote offer succeeded', LOG_LEVEL.INFO);\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tthis.setLog(`Handling a remote offer failed: ${e}`, LOG_LEVEL.ERROR);\n\t\t\tthis.#beforeDisconnect();\n\n\t\t\tthis.#reconnect({\n\t\t\t\treconnectionReason: 'HANDLING_OFFER',\n\t\t\t\treconnectionReasonInfo: `Handling a remote offer failed: ${e}`,\n\t\t\t});\n\n\t\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t\t{\n\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.PEER_CONNECTION_ISSUES,\n\t\t\t\t\tvalue: 2,\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\t#addIceCandidate(trickle)\n\t{\n\t\tthis.setLog('Start adding an ICE candidate', LOG_LEVEL.INFO);\n\t\ttry\n\t\t{\n\t\t\tconst candidate = JSON.parse(trickle.candidateInit);\n\n\t\t\tif (Util.useTcpSdp() && !candidate.candidate.includes('tcp'))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (trickle.target)\n\t\t\t{\n\t\t\t\tif (this.recipient?.remoteDescription)\n\t\t\t\t{\n\t\t\t\t\tthis.recipient.addIceCandidate(candidate);\n\t\t\t\t\tthis.setLog('Adding an ICE candidate succeeded', LOG_LEVEL.INFO);\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.#privateProperties.pendingCandidates.recipient.push(candidate);\n\t\t\t\tthis.setLog('Adding an ICE candidate deferred: has no remote description', LOG_LEVEL.INFO);\n\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (this.sender?.remoteDescription)\n\t\t\t\t{\n\t\t\t\t\tthis.sender.addIceCandidate(candidate);\n\t\t\t\t\tthis.setLog('Adding an ICE candidate succeeded', LOG_LEVEL.INFO);\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.#privateProperties.pendingCandidates.sender.push(candidate);\n\t\t\t\tthis.setLog('Adding an ICE candidate deferred: has no remote description', LOG_LEVEL.INFO);\n\t\t\t}\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tthis.setLog(`Adding an ICE candidate failed: ${e}`, LOG_LEVEL.ERROR);\n\t\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t\t{\n\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.PEER_CONNECTION_ISSUES,\n\t\t\t\t\tvalue: 3,\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\t#setUserPermissions(_permissionsJSON)\n\t{\n\t\ttry\n\t\t{\n\t\t\tlet permissions = JSON.parse(_permissionsJSON);\n\n\t\t\tUtil.setUserPermissions(permissions);\n\t\t}\n\t\tcatch (err)\n\t\t{\n\t\t\tthis.setLog(`Could not parse a permissions JSON: ${_permissionsJSON}  ${err.message}`, LOG_LEVEL.WARNING);\n\t\t}\n\t}\n\n\t#setRemoteParticipant(participant) {\n\t\tconst userId = participant.userId\n\t\tconst participantEvent = this.#privateProperties.remoteParticipants[userId]\n\t\t\t? 'ParticipantStateUpdated'\n\t\t\t: 'ParticipantJoined'\n\t\tconst remoteParticipant = new Participant(participant, this.#privateProperties.socketConnect)\n\t\tthis.#privateProperties.remoteParticipants[userId] = remoteParticipant;\n\n\t\tthis.triggerEvents(participantEvent, [remoteParticipant]);\n\t\tif (participant.participantTracks)\n\t\t{\n\t\t\tObject.values(participant.participantTracks).forEach( track => {\n\t\t\t\ttrack.userId = userId\n\t\t\t\tthis.#privateProperties.tracksDataFromSocket[track.sid] = track\n\t\t\t\tif (track.muted && track.source === MediaStreamsKinds.Microphone)\n\t\t\t\t{\n\t\t\t\t\tremoteParticipant.isMutedAudio = true;\n\t\t\t\t}\n\t\t\t\tif (track.muted && track.source === MediaStreamsKinds.Camera)\n\t\t\t\t{\n\t\t\t\t\tremoteParticipant.isMutedVideo = true;\n\t\t\t\t}\n\t\t\t\tswitch (track.source)\n\t\t\t\t{\n\t\t\t\t\tcase MediaStreamsKinds.Camera:\n\t\t\t\t\t\tremoteParticipant.videoEnabled = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase MediaStreamsKinds.Microphone:\n\t\t\t\t\t\tremoteParticipant.audioEnabled = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase MediaStreamsKinds.Screen:\n\t\t\t\t\t\tremoteParticipant.screenSharingEnabled = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tthis.setLog(`A participant with id ${userId} (sid: ${participant.sid}) has a track info with kind ${track.source} (sid: ${track.sid}, waiting for it`, LOG_LEVEL.INFO);\n\n\t\t\t\tconst ontrackData = this.#privateProperties.ontrackData[track.sid];\n\t\t\t\tdelete this.#privateProperties.ontrackData[track.sid];\n\n\t\t\t\tif (ontrackData)\n\t\t\t\t{\n\t\t\t\t\tthis.#createRemoteTrack(track.sid, ontrackData);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.#addPendingSubscription(participant, track);\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\n\t\tif (this.#privateProperties.videoStreamSetupErrorList[userId]) {\n\t\t\tconst kindArray = [...this.#privateProperties.videoStreamSetupErrorList[userId]];\n\t\t\tdelete this.#privateProperties.videoStreamSetupErrorList[userId];\n\n\t\t\tkindArray.forEach((kind) =>\n\t\t\t{\n\t\t\t\tthis.setMainStream(userId, kind);\n\t\t\t});\n\t\t}\n\t};\n\n\t#createRemoteTrack(trackId, ontrackData)\n\t{\n\t\tconst trackData = this.#privateProperties.tracksDataFromSocket[trackId];\n\t\tconst userId = trackData.userId;\n\t\tconst participant = this.#privateProperties.remoteParticipants[userId];\n\t\tconst track = ontrackData.track;\n\t\tconst trackMuted = !!trackData.muted;\n\n\t\tthis.#privateProperties.realTracksIds[track.id] = trackId;\n\t\ttrack.source = trackData.source;\n\t\ttrack.layers = trackData.layers || null;\n\n\t\tif (!this.#privateProperties.remoteTracks?.[userId])\n\t\t{\n\t\t\tthis.#privateProperties.remoteTracks[userId] = {}\n\t\t}\n\t\tconst remoteTrack = new Track(trackId, track);\n\t\tthis.#privateProperties.remoteTracks[userId][trackId] = remoteTrack;\n\n\t\tif (remoteTrack.source === MediaStreamsKinds.Camera)\n\t\t{\n\t\t\tparticipant.isMutedVideo = trackMuted;\n\t\t}\n\t\telse if (remoteTrack.source === MediaStreamsKinds.Microphone)\n\t\t{\n\t\t\tparticipant.isMutedAudio = trackMuted;\n\t\t\tif (trackMuted)\n\t\t\t{\n\t\t\t\tthis.setLog(`Trigger mute signal (${trackMuted}) for received audio from a participant with id ${participant.userId} (sid: ${participant.sid})`, LOG_LEVEL.INFO);\n\t\t\t\tthis.triggerEvents('RemoteMediaMuted', [participant, remoteTrack]);\n\t\t\t}\n\t\t}\n\n\t\tif (this.#privateProperties.pendingSubscriptions[userId]?.[trackId]?.timeout)\n\t\t{\n\t\t\tclearTimeout(this.#privateProperties.pendingSubscriptions[userId][trackId].timeout);\n\t\t\tdelete this.#privateProperties.pendingSubscriptions[userId][trackId];\n\t\t}\n\n\t\tthis.setLog(`Got an expected track with kind ${remoteTrack.source} (sid: ${trackId}) for a participant with id ${participant.userId} (sid: ${participant.sid})`, LOG_LEVEL.INFO);\n\t\tparticipant.addTrack(remoteTrack.source, remoteTrack);\n\t\tif (remoteTrack.source !== MediaStreamsKinds.Camera || !participant.isMutedVideo)\n\t\t{\n\t\t\tthis.triggerEvents('RemoteMediaAdded', [participant, remoteTrack]);\n\t\t}\n\n\t\tif (remoteTrack.source === MediaStreamsKinds.Camera)\n\t\t{\n\t\t\tconst quality = this.#calculateVideoQualityForUser(userId, remoteTrack.source);\n\t\t\tthis.setLog(`Quality of video for a participant with id ${participant.userId} (sid: ${participant.sid}) was changed to ${quality} after receiving`, LOG_LEVEL.INFO);\n\t\t\tparticipant.setStreamQuality(quality);\n\t\t}\n\n\t\tif (track.kind === 'video')\n\t\t{\n\t\t\tconst streamRemovingId = Util.getUuidv4();\n\t\t\tparticipant.streamRemovingId = streamRemovingId;\n\t\t\tontrackData.streams[0].onremovetrack = () =>\n\t\t\t{\n\t\t\t\t// we need to check if a participant is still exists\n\t\t\t\t// otherwise tracks were deleted when participant left room\n\t\t\t\tconst participant = this.#privateProperties.remoteParticipants[userId];\n\t\t\t\tif (participant?.streamRemovingId === streamRemovingId)\n\t\t\t\t{\n\t\t\t\t\tthis.setLog(`Track with kind ${track.source} (sid: ${track.id}) for a participant with id ${userId} (sid: ${participant.sid || 'unknown'}) was removed from peer connection`, LOG_LEVEL.WARNING);\n\t\t\t\t\tthis.triggerEvents('RemoteMediaRemoved', [participant, remoteTrack]);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.setLog(`Track with kind ${track.source} (sid: ${track.id}) was removed from a disconnected participant with id ${userId} (sid: unknown) before it was removed from peer connection`, LOG_LEVEL.WARNING);\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n\n\t#speakerChangedHandler(data) {\n\t\tdata.speakersChanged.speakers.forEach((speaker) => {\n\t\t\tconst participant = Object.values(this.#privateProperties.remoteParticipants).find(p => p.sid === speaker.sid)\n\t\t\tif (participant && participant?.userId != this.#privateProperties.userId) {\n\t\t\t\tparticipant.isSpeaking = speaker?.active || false\n\t\t\t\tif (speaker?.active) {\n\t\t\t\t\tthis.triggerEvents('VoiceStarted', [participant]);\n\t\t\t\t} else {\n\t\t\t\t\tthis.triggerEvents('VoiceEnded', [participant]);\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\n\t#trackMutedHandler(data) {\n\t\tconst participant = this.#privateProperties.remoteParticipants[data.track.publisher];\n\t\tconst trackId = data.track.shortId;\n\t\tthis.setLog(`Got socket message \"trackMuted\" - trackId: ${trackId}, muted: ${data?.muted}`, LOG_LEVEL.INFO);\n\n\t\tif (data.track.publisher == this.#privateProperties.userId)\n\t\t{\n\t\t\tconst track = Object.values(this.#privateProperties.localTracks)?.find(track => track?.sid === trackId);\n\t\t\tif (track)\n\t\t\t{\n\t\t\t\tif (track.source === MediaStreamsKinds.Camera)\n\t\t\t\t{\n\t\t\t\t\tthis.setLog(`Got mute self video signal (${data.muted}) - trackId: ${trackId}`, LOG_LEVEL.INFO);\n\n\t\t\t\t\tif (!data.muted && track.muted && !this.#privateProperties.mediaMutedBySystem)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.triggerEvents('PublishSucceed', [track.source]);\n\t\t\t\t\t}\n\t\t\t\t\telse if (!this.#privateProperties.mediaMutedBySystem)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.triggerEvents('PublishPaused', [track.source]);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.#privateProperties.videoQueue)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#processVideoQueue();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if(track.source === MediaStreamsKinds.Microphone)\n\t\t\t\t{\n\t\t\t\t\tthis.triggerEvents('PublishPaused', [track.source, data.muted]);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.setLog(`Mute self signal (${data.muted}) getting failed - trackId: ${trackId}`, LOG_LEVEL.INFO);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!participant) {\n\t\t\tif (data.track.publisher != this.#privateProperties.userId)\n\t\t\t{\n\t\t\t\tthis.setLog(`Got mute signal (${data.muted}) for a non-existent participant with id ${data.track.publisher}`, LOG_LEVEL.WARNING);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tconst track = Object.values(participant.tracks)?.find(track => track?.id === trackId);\n\t\tconst awaitedTrack = this.#privateProperties.tracksDataFromSocket[trackId];\n\t\tif (awaitedTrack && !track)\n\t\t{\n\t\t\tthis.#privateProperties.tracksDataFromSocket[trackId].muted = data.muted;\n\t\t\tthis.setLog(`Got mute signal (${data.muted}) for a non-received track with id ${trackId}`, LOG_LEVEL.WARNING);\n\t\t\treturn;\n\t\t}\n\t\telse if (!track)\n\t\t{\n\t\t\tthis.setLog(`Got mute signal (${data.muted}) for a non-existent track with id ${trackId}`, LOG_LEVEL.WARNING);\n\t\t\treturn;\n\t\t}\n\n\t\tif (track.source === MediaStreamsKinds.Microphone)\n\t\t{\n\t\t\tthis.#microphoneMuteUnmuteHandler({track: track, isMuted: data.muted, participant: participant});\n\t\t\tthis.setLog(`Got mute signal (${data.muted}) for audio from a participant with id ${participant.userId} (sid: ${participant.sid})`, LOG_LEVEL.INFO);\n\t\t}\n\t\telse if (track.source === MediaStreamsKinds.Camera)\n\t\t{\n\t\t\tthis.#cameraMuteUnmuteHandler({track: track, isMuted: data.muted, participant: participant});\n\t\t\tthis.setLog(`Got mute signal (${data.muted}) for video from a participant with id ${participant.userId} (sid: ${participant.sid})`, LOG_LEVEL.INFO);\n\n\t\t}\n\t}\n\n\t#microphoneMuteUnmuteHandler(options) {\n\t\toptions.participant.isMutedAudio = options.isMuted;\n\n\t\tconst eventName = options.isMuted\n\t\t\t? 'RemoteMediaMuted'\n\t\t\t: 'RemoteMediaUnmuted';\n\n\t\tthis.triggerEvents(eventName, [options.participant, options.track]);\n\t}\n\n\t#cameraMuteUnmuteHandler(options) {\n\t\tthis.setLog(`Camera muting was changed (${options?.isMuted}) - trackSid: ${options?.track?.sid}, participantUserId: ${options?.participant?.userId}, trackSource: ${options?.track?.source}`, LOG_LEVEL.INFO);\n\n\t\toptions.participant.isMutedVideo = options.isMuted;\n\n\t\tconst eventName = options.isMuted\n\t\t\t? 'RemoteMediaRemoved'\n\t\t\t: 'RemoteMediaAdded';\n\n\t\tif (this.#privateProperties.tracksDataFromSocket[options.track.sid])\n\t\t{\n\t\t\tthis.#privateProperties.tracksDataFromSocket[options.track.sid].muted = options.isMuted;\n\t\t}\n\n\t\tthis.triggerEvents(eventName, [options.participant, options.track]);\n\t}\n\n\t#participantMutedHandler(data)\n\t{\n\t\tif (!Util.isUserControlFeatureEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (data.toUserId === data.fromUserId) // we not accept mute participant by himself by this method\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (data.toUserId != this.#privateProperties.userId)\n\t\t{\n\t\t\tconst participant = this.#privateProperties.remoteParticipants[data.toUserId];\n\n\t\t\tif (!participant)\n\t\t\t{\n\t\t\t\tthis.setLog(`Got a onParticipantMuted event for non-existent user (toUserId: ${data.toUserId})`, LOG_LEVEL.WARNING);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (data?.track.muted) // tbh always should be in \"true\"..\n\t\t\t{\n\t\t\t\tif (data.track.type === 0 && participant.audioEnabled)\n\t\t\t\t{ // audio\n\t\t\t\t\tparticipant.audioEnabled = false;\n\n\t\t\t\t\tconst track = Object.values(participant.tracks)?.find(track => track?.source === MediaStreamsKinds.Microphone);\n\n\t\t\t\t\tthis.#microphoneMuteUnmuteHandler({track: track, isMuted: true, participant: participant});\n\t\t\t\t}\n\t\t\t\telse if (data.track.type === 1 && participant.videoEnabled)\n\t\t\t\t{ // video\n\t\t\t\t\tthis.setLog(`Mute participant video - from: ${data?.fromUserId}, to: ${data?.toUserId}`, LOG_LEVEL.INFO);\n\t\t\t\t\tparticipant.videoEnabled = false;\n\t\t\t\t\tconst track = Object.values(participant.tracks)?.find(track => track?.source === MediaStreamsKinds.Camera);\n\n\t\t\t\t\tthis.#cameraMuteUnmuteHandler({track: track, isMuted: true, participant: participant});\n\t\t\t\t}\n\t\t\t\telse if (data.track.type === 1 && !participant.videoEnabled)\n\t\t\t\t{\n\t\t\t\t\tthis.setLog(`Cancel participant video muting - from: ${data?.fromUserId}, to: ${data?.toUserId}`, LOG_LEVEL.INFO);\n\t\t\t\t}\n\t\t\t\telse if (data.track.type === 2 && participant.screenSharingEnabled)\n\t\t\t\t{ // screenshare\n\t\t\t\t\tparticipant.screenSharingEnabled = false;\n\n\t\t\t\t\tconst track = Object.values(participant.tracks)?.find(track => track?.source === MediaStreamsKinds.Screen);\n\t\t\t\t\tconst screenAudioTrack = participant.getTrack(MediaStreamsKinds.ScreenAudio);\n\n\t\t\t\t\tthis.#cameraMuteUnmuteHandler({track: track, isMuted: true, participant: participant});\n\n\t\t\t\t\tif (screenAudioTrack)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#microphoneMuteUnmuteHandler({track: screenAudioTrack, isMuted: true, participant: participant});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.triggerEvents('ParticipantMuted', [data]);\n\t}\n\n\t#allParticipantsMutedHandler(data)\n\t{\n\t\tif (!Util.isUserControlFeatureEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (data.fromUserId == this.#privateProperties.userId)\n\t\t{\n\t\t\tif (!data.reason || (data.reason && data.reason != 'settings'))\n\t\t\t{\n\t\t\t\tthis.triggerEvents('YouMuteAllParticipants', [data]);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (data?.track.type === 0)\n\t\t\t{\n\t\t\t\tthis.triggerEvents('AllParticipantsAudioMuted', [data]);\n\t\t\t}\n\t\t\telse if (data.track.type === 1)\n\t\t\t{\n\t\t\t\tthis.setLog(`Try to mute all participant videos - from: ${data?.fromUserId}`, LOG_LEVEL.INFO);\n\t\t\t\tthis.triggerEvents('AllParticipantsVideoMuted', [data]);\n\t\t\t}\n\t\t\telse if (data.track.type === 2)\n\t\t\t{\n\t\t\t\tthis.triggerEvents('AllParticipantsScreenshareMuted', [data]);\n\t\t\t}\n\t\t}\n\n\t\tif (data?.track.muted) // tbh always should be in \"true\"..\n\t\t{\n\t\t\tfor (let i in this.#privateProperties.remoteParticipants)\n\t\t\t{\n\t\t\t\tif (this.#privateProperties.remoteParticipants.hasOwnProperty(i))\n\t\t\t\t{\n\t\t\t\t\tlet  participant = this.#privateProperties.remoteParticipants[i];\n\n\t\t\t\t\tif (participant.userId != data.fromUserId && Util.isRegularUser(Util.getUserRoleByUserId(participant.userId)))\n\t\t\t\t\t{\n\t\t\t\t\t\tif (data.track.type === 0 && participant.audioEnabled)\n\t\t\t\t\t\t{ // audio\n\t\t\t\t\t\t\tparticipant.audioEnabled = false;\n\n\t\t\t\t\t\t\tconst track = participant.getTrack(MediaStreamsKinds.Microphone);\n\n\t\t\t\t\t\t\tthis.#microphoneMuteUnmuteHandler({track: track, isMuted: true, participant: participant});\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if(data.track.type === 1 && participant.videoEnabled)\n\t\t\t\t\t\t{ // video\n\t\t\t\t\t\t\tparticipant.videoEnabled = false;\n\n\t\t\t\t\t\t\tthis.setLog(`Mute participant video - from: ${data?.fromUserId}, to: ${participant?.userId}`, LOG_LEVEL.INFO);\n\n\t\t\t\t\t\t\tconst track = participant.getTrack(MediaStreamsKinds.Camera);\n\n\t\t\t\t\t\t\tthis.#cameraMuteUnmuteHandler({track: track, isMuted: true, participant: participant});\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (data.track.type === 1 && !participant.videoEnabled)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.setLog(`Cancel participant video muting - from: ${data?.fromUserId}, to: ${participant?.userId}`, LOG_LEVEL.INFO);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if(data.track.type === 2)\n\t\t\t\t\t\t{ // screenshare\n\t\t\t\t\t\t\tparticipant.screenSharingEnabled = false;\n\n\t\t\t\t\t\t\tconst track = participant.getTrack(MediaStreamsKinds.Screen);\n\t\t\t\t\t\t\tconst screenAudioTrack = participant.getTrack(MediaStreamsKinds.ScreenAudio);\n\n\t\t\t\t\t\t\tthis.#cameraMuteUnmuteHandler({track: track, isMuted: true, participant: participant});\n\t\t\t\t\t\t\tif (screenAudioTrack)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.#microphoneMuteUnmuteHandler({track: screenAudioTrack, isMuted: true, participant: participant});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t#updateRoleHandler(data)\n\t{\n\t\tif (!Util.isUserControlFeatureEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (data.toUserId == this.#privateProperties.userId)\n\t\t{\n\t\t\tUtil.setCurrentUserRole(data.role);\n\t\t\tthis.#setUserPermissions(data.permissions);\n\t\t}\n\n\t\tthis.triggerEvents('UserRoleChanged', [data]);\n\t}\n\n\t#userPermissionsChanged(data)\n\t{\n\t\tif (!Util.isUserControlFeatureEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (data.allow === true && Util.isRegularUser(Util.getCurrentUserRole()))\n\t\t{\n\t\t\tlet permissions = Util.getUserPermissions();\n\n\t\t\tpermissions.audio = data.allow;\n\t\t\tpermissions.video = data.allow;\n\t\t\tpermissions.screen_share = data.allow;\n\n\t\t\tUtil.setUserPermissions(permissions);\n\t\t}\n\n\t\tthis.triggerEvents('UserPermissionsChanged', [data]);\n\t}\n\n\t#settingsChangedHandler(data)\n\t{\n\t\tif (!Util.isUserControlFeatureEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tdata.calledFrom = 'settingsChanged';\n\n\t\tlet newRoomSettings = Util.getRoomPermissions();\n\t\tlet options = {reason: 'settings', eft: data.eft, fromUserId: data.fromUserId, track: {type: 0}};\n\n\t\tswitch (data.act)\n\t\t{\n\t\t\tcase 'audio':\n\t\t\t\toptions.track.type = 0;\n\t\t\t\tnewRoomSettings.AudioEnabled = data.roomState.AudioEnabled;\n\t\t\t\tbreak\n\t\t\tcase 'video':\n\t\t\t\toptions.track.type = 1;\n\t\t\t\tnewRoomSettings.VideoEnabled = data.roomState.VideoEnabled;\n\t\t\t\tbreak\n\t\t\tcase 'screen_share':\n\t\t\t\toptions.track.type = 2;\n\t\t\t\tnewRoomSettings.ScreenShareEnabled = data.roomState.ScreenShareEnabled;\n\t\t\t\tbreak\n\t\t}\n\n\t\tUtil.setRoomPermissions(newRoomSettings);\n\t\tUtil.updateUserPermissionByNewRoomPermission(data.act, !data.eft);\n\n\t\tif (data.eft === true)\n\t\t{\n\t\t\tthis.#allParticipantsMutedHandler(options);\n\t\t}\n\n\t\tthis.triggerEvents('RoomSettingsChanged', [data]);\n\t}\n\n\t#createPeerConnection() {\n\t\tthis.#destroyPeerConnection()\n\n\t\tconst config = {};\n\t\tif (this.#privateProperties.iceServers)\n\t\t{\n\t\t\tconfig.iceServers = this.#privateProperties.iceServers;\n\t\t}\n\n\t\tthis.sender = new RTCPeerConnection(config);\n\t\tthis.sender.addEventListener('icecandidate', e => this.onIceCandidate(null, e));\n\t\tthis.sender.addEventListener('connectionstatechange', e => this.onConnectionStateChange());\n\t\tthis.sender.addEventListener('iceconnectionstatechange', e => this.onIceConnectionStateChange());\n\n\t\tthis.recipient = new RTCPeerConnection(config);\n\t\tthis.recipient.ontrack = (event) => {\n\t\t\tconst ids = event.streams[0].id.split('|');\n\t\t\tconst trackId = ids[1];\n\t\t\tconst userId = this.#privateProperties.tracksDataFromSocket[trackId]?.userId;\n\n\t\t\tif (this.#privateProperties.remoteParticipants[userId] && this.#privateProperties.tracksDataFromSocket[trackId])\n\t\t\t{\n\t\t\t\tthis.#createRemoteTrack(trackId, event);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.setLog(`Got a track with kind ${event.track.kind} (sid: ${trackId}) without a participant, saving it`, LOG_LEVEL.WARNING);\n\t\t\t\tthis.#privateProperties.ontrackData[trackId] = event;\n\t\t\t}\n\t\t};\n\t\tthis.recipient.addEventListener('icecandidate', e => this.onIceCandidate('SUBSCRIBER', e));\n\t\tthis.recipient.addEventListener('connectionstatechange', e => this.onConnectionStateChange(true));\n\t\tthis.recipient.addEventListener('iceconnectionstatechange', e => this.onIceConnectionStateChange(true));\n\n\t\tif (this.#privateProperties.pendingOffer)\n\t\t{\n\t\t\tthis.#offerHandler(this.#privateProperties.pendingOffer);\n\t\t\tthis.#privateProperties.pendingOffer = null;\n\t\t}\n\n\t\tconst getStatsHandle = async () => {\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst statsAll = {};\n\t\t\t\tlet packetLostEventAdded = false;\n\t\t\t\tawait this.sender.getStats(null).then((stats) =>\n\t\t\t\t{\n\t\t\t\t\tlet statsOutput = [];\n\t\t\t\t\tconst codecs = {};\n\t\t\t\t\tconst reportsWithoutCodecs = {};\n\t\t\t\t\tconst remoteReports = {};\n\t\t\t\t\tconst reportsWithoutRemoteInfo = {};\n\t\t\t\t\tlet isQualityLimitationSent = false;\n\t\t\t\t\tlet totalBitrateOut = [];\n\n\t\t\t\t\tstats.forEach((report) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tstatsOutput.push(report);\n\n\t\t\t\t\t\tif (report.type === 'codec')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tUtil.processReportsWithoutCodecs(report, codecs, reportsWithoutCodecs);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (report.type === 'remote-inbound-rtp')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst reportId = report.localId;\n\t\t\t\t\t\t\tif (reportsWithoutRemoteInfo[reportId])\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconst packetsLostData = Util.calcLocalPacketsLost(reportsWithoutRemoteInfo[reportId], this.#privateProperties.reportsForOutgoingTracks[reportId], report);\n\t\t\t\t\t\t\t\tconst { currentPercentPacketLost } = packetsLostData;\n\n\t\t\t\t\t\t\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.addValidatedMonitoringMetricWithLogging({\n\t\t\t\t\t\t\t\t\t\tadditionalData: {\n\t\t\t\t\t\t\t\t\t\t\tcurrentReportPacketsSent: reportsWithoutRemoteInfo[reportId]?.packetsSent,\n\t\t\t\t\t\t\t\t\t\t\tprevReportPacketsSent: this.#privateProperties.reportsForOutgoingTracks[reportId]?.packetsSent,\n\t\t\t\t\t\t\t\t\t\t\tprevReportPacketsLost: this.#privateProperties.reportsForOutgoingTracks[reportId]?.packetsLost,\n\t\t\t\t\t\t\t\t\t\t\tremoteReportPacketsLost: report?.packetsLost,\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tmetricKey: MONITORING_METRICS_NAME_LIST.PACKET_LOST_SEND,\n\t\t\t\t\t\t\t\t\t\tmetricValue: currentPercentPacketLost,\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tif (!packetLostEventAdded && currentPercentPacketLost > this.#privateProperties.packetLostThreshold)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tpacketLostEventAdded = true;\n\t\t\t\t\t\t\t\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\t\t\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.HIGH_PACKET_LOSS_SEND,\n\t\t\t\t\t\t\t\t\t\t\twithCounter: true\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treportsWithoutRemoteInfo[reportId].packetsLostData = packetsLostData;\n\t\t\t\t\t\t\t\treportsWithoutRemoteInfo[reportId].packetsLost = packetsLostData.totalPacketsLost;\n\t\t\t\t\t\t\t\treportsWithoutRemoteInfo[reportId].packetsLostExtended = Util.formatPacketsLostData(packetsLostData);\n\t\t\t\t\t\t\t\tthis.#privateProperties.reportsForOutgoingTracks[reportId] = reportsWithoutRemoteInfo[reportId];\n\t\t\t\t\t\t\t\tdelete reportsWithoutRemoteInfo[reportId];\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tremoteReports[report.localId] = report;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (report.type === 'outbound-rtp')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treport.bitrate = Util.calcBitrate(report, this.#privateProperties.reportsForOutgoingTracks[report.id], true);\n\t\t\t\t\t\t\treport.userId = this.#privateProperties.userId;\n\n\t\t\t\t\t\t\tif (report.kind === 'audio')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treport.source = MediaStreamsKinds.Microphone;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if (report.kind === 'video' )\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treport.source = report.contentType === 'screenshare'\n\t\t\t\t\t\t\t\t\t? MediaStreamsKinds.Screen\n\t\t\t\t\t\t\t\t\t: MediaStreamsKinds.Camera;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\ttotalBitrateOut.push({\n\t\t\t\t\t\t\t\tbitrate: report.bitrate,\n\t\t\t\t\t\t\t\tkind: report.kind,\n\t\t\t\t\t\t\t\tcontentType: report.contentType,\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tif (report.qualityLimitationReason && report.qualityLimitationReason !== 'none' && !isQualityLimitationSent)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tif (report.qualityLimitationReason === 'cpu') {\n\t\t\t\t\t\t\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\t\t\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.CPU_ISSUES,\n\t\t\t\t\t\t\t\t\t\t\twithCounter: true\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif (report.qualityLimitationReason === 'bandwidth') {\n\t\t\t\t\t\t\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\t\t\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.NETWORK_ISSUES,\n\t\t\t\t\t\t\t\t\t\t\twithCounter: true\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tisQualityLimitationSent = true;\n\t\t\t\t\t\t\t\tthis.setLog(`Local user have problems with sending video: ${report.qualityLimitationReason} (${Object.entries(report.qualityLimitationDurations).reduce(\n\t\t\t\t\t\t\t\t\t(accumulator, value, index) => accumulator + `${index ? ', ' : ''}` + `${value[0]}: ${value[1]}`,\n\t\t\t\t\t\t\t\t\t'',\n\t\t\t\t\t\t\t\t)})`, LOG_LEVEL.WARNING);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (!Util.setCodecToReport(report, codecs, reportsWithoutCodecs))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tUtil.saveReportWithoutCodecs(report, reportsWithoutCodecs);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (Util.setLocalPacketsLostOrSaveReport(report, remoteReports, reportsWithoutRemoteInfo))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.#privateProperties.reportsForOutgoingTracks[report.id] = report;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t\t\t\t{\n\t\t\t\t\t\tconst bitrateSumOut = this.calcBitrateSumFromArray({ bitrateArray: totalBitrateOut});\n\t\t\t\t\t\tconst formattedBitrateOut = Number.parseFloat((bitrateSumOut / 1000000).toFixed(2));\n\n\t\t\t\t\t\tif (this.currentMonitoringEventsObject.metrics[MONITORING_METRICS_NAME_LIST.BITRATE_OUT].length < this.countMetricsInMetricsInterval)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.addValidatedMonitoringMetricWithLogging({\n\t\t\t\t\t\t\t\tadditionalData: {\n\t\t\t\t\t\t\t\t\tbitrateList: totalBitrateOut,\n\t\t\t\t\t\t\t\t\tbitrateSumOut,\n\t\t\t\t\t\t\t\t\tformattedBitrateOut,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tmetricKey: MONITORING_METRICS_NAME_LIST.BITRATE_OUT,\n\t\t\t\t\t\t\t\tmetricValue: formattedBitrateOut,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tstatsAll.sender = statsOutput;\n\t\t\t\t});\n\n\n\n\t\t\t\tawait this.recipient.getStats(null).then((stats) =>\n\t\t\t\t{\n\t\t\t\t\tlet statsOutput = [];\n\t\t\t\t\tconst participantsWithLargeDataLoss = new Map();\n\t\t\t\t\tconst codecs = {};\n\t\t\t\t\tconst reportsWithoutCodecs = {};\n\t\t\t\t\tlet totalBitrateIn = [];\n\t\t\t\t\tlet currentPacketLostReceiveCount = 0;\n\n\t\t\t\t\tconst inboundRtpStatsArray = {\n\t\t\t\t\t\tfreezeCount: [],\n\t\t\t\t\t\ttotalFreezesDuration: [],\n\t\t\t\t\t\tjitter: [],\n\t\t\t\t\t\tframesDecoded: [],\n\t\t\t\t\t\tframesDropped: [],\n\t\t\t\t\t\tframesReceived: [],\n\t\t\t\t\t\tframesLoss: [],\n\t\t\t\t\t};\n\n\t\t\t\t\tstats.forEach((report) =>\n\t\t\t\t\t{\n\n\t\t\t\t\t\tif (report.type === 'inbound-rtp' && report.kind === 'video')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst { freezeCount, totalFreezesDuration, jitter, framesDecoded, framesDropped, framesReceived } = report;\n\n\t\t\t\t\t\t\tinboundRtpStatsArray.jitter.push(jitter);\n\t\t\t\t\t\t\tinboundRtpStatsArray.totalFreezesDuration.push(totalFreezesDuration);\n\t\t\t\t\t\t\tinboundRtpStatsArray.freezeCount.push(freezeCount);\n\t\t\t\t\t\t\tinboundRtpStatsArray.framesDecoded.push(framesDecoded);\n\t\t\t\t\t\t\tinboundRtpStatsArray.framesDropped.push(framesDropped);\n\t\t\t\t\t\t\tinboundRtpStatsArray.framesReceived.push(framesReceived);\n\t\t\t\t\t\t\tinboundRtpStatsArray.framesLoss.push((framesDropped / framesReceived) * 100);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tstatsOutput.push(report);\n\n\t\t\t\t\t\tconst needCheckPacketLosts = (report?.trackIdentifier\n\t\t\t\t\t\t\t&& report.hasOwnProperty('packetsLost')\n\t\t\t\t\t\t\t&& report.hasOwnProperty('packetsReceived'));\n\n\t\t\t\t\t\tif (needCheckPacketLosts)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst packetsLostData = Util.calcRemotePacketsLost(report, this.#privateProperties.reportsForIncomingTracks[report.trackIdentifier]);\n\n\t\t\t\t\t\t\treport.packetsLostExtended = Util.formatPacketsLostData(packetsLostData);\n\n\n\t\t\t\t\t\t\tthis.#privateProperties.reportsForIncomingTracks[report.trackIdentifier] = report;\n\n\t\t\t\t\t\t\tconst realTrackId = this.#privateProperties.realTracksIds[report.trackIdentifier];\n\t\t\t\t\t\t\tconst track = this.#privateProperties.tracksDataFromSocket[realTrackId];\n\t\t\t\t\t\t\tif (track)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconst prevReport = track.report || {};\n\t\t\t\t\t\t\t\ttrack.report = report;\n\n\t\t\t\t\t\t\t\treport.bitrate = Util.calcBitrate(report, prevReport);\n\t\t\t\t\t\t\t\treport.userId = track.userId;\n\t\t\t\t\t\t\t\treport.source = track.source;\n\n\t\t\t\t\t\t\t\tconst { currentPercentPacketLost } = packetsLostData;\n\n\t\t\t\t\t\t\t\tif (track.source === MediaStreamsKinds.Camera)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tcurrentPacketLostReceiveCount = currentPercentPacketLost;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\ttotalBitrateIn.push({\n\t\t\t\t\t\t\t\t\tbitrate: report.bitrate,\n\t\t\t\t\t\t\t\t\tkind: report.kind,\n\t\t\t\t\t\t\t\t\tcontentType: report.contentType,\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tif (!Util.setCodecToReport(report, codecs, reportsWithoutCodecs))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tUtil.saveReportWithoutCodecs(report, reportsWithoutCodecs);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treport.inRemoteTracks = (!!(this.#privateProperties.remoteTracks[track.userId] && this.#privateProperties.remoteTracks[track.userId][realTrackId]) ? 'Y' : 'N');\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (packetsLostData.currentPercentPacketLost > this.#privateProperties.packetLostThreshold)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconst participant = Object.values(this.#privateProperties.remoteParticipants)\n\t\t\t\t\t\t\t\t\t.find(p => p?.tracks?.[MediaStreamsKinds.Camera]?.track?.id === report.trackIdentifier);\n\t\t\t\t\t\t\t\tif (participant && participant.userId != this.#privateProperties.userId)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tparticipantsWithLargeDataLoss.set(participant.userId, `userId: ${ participant.userId} (${packetsLostData.currentPercentPacketLost}%)`);\n\t\t\t\t\t\t\t\t\tthis.#privateProperties.prevParticipantsWithLargeDataLoss.delete(participant.userId);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (report.type === 'codec')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tUtil.processReportsWithoutCodecs(report, codecs, reportsWithoutCodecs);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t\t\t\t{\n\t\t\t\t\t\tconst { countVideoTracks, countAudioTracks } = this.getCountRemoteTracks();\n\n\t\t\t\t\t\tconst round = (number, decimal) => Math.round(number * Math.pow(10, decimal)) / Math.pow(10, decimal);\n\n\t\t\t\t\t\tconst addValueInboundRTCStatsToMetrics = ({ key, metricsKey, isSum, decimal = 0, interval }) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (this.currentMonitoringEventsObject.metrics[MONITORING_METRICS_NAME_LIST[metricsKey]].length >= this.countMetricsInMetricsInterval)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst inboundRtpStatsArraySumByKey = inboundRtpStatsArray[key].reduce((acc, number) => acc + number, 0) / (interval ? (this.#privateProperties.statsTimeout / 1000) : 1);\n\t\t\t\t\t\t\tconst prevInboundRtpStatsArraySumByKey = this.prevInboundRtpStatsSum[key];\n\t\t\t\t\t\t\tconst diffInboundRtpStatsArraySumByKey = prevInboundRtpStatsArraySumByKey && !!isSum ? inboundRtpStatsArraySumByKey - prevInboundRtpStatsArraySumByKey : inboundRtpStatsArraySumByKey;\n\t\t\t\t\t\t\tconst metricValue = !!countVideoTracks ? diffInboundRtpStatsArraySumByKey / countVideoTracks : 0;\n\n\t\t\t\t\t\t\tthis.addValidatedMonitoringMetricWithLogging({\n\t\t\t\t\t\t\t\tadditionalData: {\n\t\t\t\t\t\t\t\t\tinboundRtpStatsArrayByKey: inboundRtpStatsArray[key],\n\t\t\t\t\t\t\t\t\tinboundRtpStatsArraySumByKey,\n\t\t\t\t\t\t\t\t\tprevInboundRtpStatsArraySumByKey: prevInboundRtpStatsArraySumByKey,\n\t\t\t\t\t\t\t\t\tdiffInboundRtpStatsArraySumByKey,\n\t\t\t\t\t\t\t\t\tmetricValue,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tmetricKey: metricsKey,\n\t\t\t\t\t\t\t\tmetricValue: round(metricValue, decimal),\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tthis.prevInboundRtpStatsSum[key] = inboundRtpStatsArraySumByKey;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\taddValueInboundRTCStatsToMetrics({ key: 'jitter', metricsKey: MONITORING_METRICS_NAME_LIST.JITTER, isSum: false, decimal: 3 });\n\t\t\t\t\t\taddValueInboundRTCStatsToMetrics({ key: 'freezeCount', metricsKey: MONITORING_METRICS_NAME_LIST.FREEZE_COUNT, isSum: true, interval: true });\n\t\t\t\t\t\taddValueInboundRTCStatsToMetrics({ key: 'totalFreezesDuration', metricsKey: MONITORING_METRICS_NAME_LIST.TOTAL_FREEZE_DURATION, isSum: true, decimal: 3, interval: true });\n\t\t\t\t\t\taddValueInboundRTCStatsToMetrics({ key:'framesDecoded', metricsKey:MONITORING_METRICS_NAME_LIST.FRAMES_DECODED, isSum:true, interval: true });\n\t\t\t\t\t\taddValueInboundRTCStatsToMetrics({ key:'framesReceived', metricsKey:MONITORING_METRICS_NAME_LIST.FRAMES_RECEIVED, isSum:true, interval: true });\n\t\t\t\t\t\taddValueInboundRTCStatsToMetrics({ key:'framesDropped', metricsKey: MONITORING_METRICS_NAME_LIST.FRAMES_DROPPED, isSum: true, interval: true });\n\t\t\t\t\t\t// addValueInboundRTCStatsToMetrics({ key: 'framesLoss', metricsKey: 'FRAMES_LOSS', isSum: true });\n\n\t\t\t\t\t\tif (this.currentMonitoringEventsObject.metrics[MONITORING_METRICS_NAME_LIST.FRAMES_LOSS].length < this.countMetricsInMetricsInterval)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst currentFramesReceivedArray = this.currentMonitoringEventsObject.metrics[MONITORING_METRICS_NAME_LIST.FRAMES_RECEIVED];\n\t\t\t\t\t\t\tconst currentFramesDroppedArray = this.currentMonitoringEventsObject.metrics[MONITORING_METRICS_NAME_LIST.FRAMES_DROPPED];\n\t\t\t\t\t\t\tconst currentFramesReceived = currentFramesReceivedArray.slice(-1)[0];\n\t\t\t\t\t\t\tconst currentFramesDropped = currentFramesDroppedArray.slice(-1)[0];\n\t\t\t\t\t\t\tconst currentFramesLoss = !!currentFramesReceived ? currentFramesDropped / currentFramesReceived : 0;\n\n\t\t\t\t\t\t\tthis.addValidatedMonitoringMetricWithLogging({\n\t\t\t\t\t\t\t\tadditionalData: {\n\t\t\t\t\t\t\t\t\tcurrentFramesReceivedArray,\n\t\t\t\t\t\t\t\t\tcurrentFramesDroppedArray,\n\t\t\t\t\t\t\t\t\tcurrentFramesReceived,\n\t\t\t\t\t\t\t\t\tcurrentFramesDropped,\n\t\t\t\t\t\t\t\t\tcurrentFramesLoss,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tmetricKey: MONITORING_METRICS_NAME_LIST.FRAMES_LOSS,\n\t\t\t\t\t\t\t\tmetricValue: currentFramesLoss > 0 ? round(currentFramesLoss * 100, 0)  : 0,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst bitrateSumIn = this.calcBitrateSumFromArray({ bitrateArray: totalBitrateIn });\n\t\t\t\t\t\tconst formattedBitrateIn = Number.parseFloat((bitrateSumIn / 1000000).toFixed(2));\n\n\t\t\t\t\t\tif (this.currentMonitoringEventsObject.metrics[MONITORING_METRICS_NAME_LIST.BITRATE_IN].length < this.countMetricsInMetricsInterval)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.addValidatedMonitoringMetricWithLogging({\n\t\t\t\t\t\t\t\tadditionalData: {\n\t\t\t\t\t\t\t\t\tbitrateList: totalBitrateIn,\n\t\t\t\t\t\t\t\t\tbitrateSumIn,\n\t\t\t\t\t\t\t\t\tformattedBitrateIn,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tmetricKey: MONITORING_METRICS_NAME_LIST.BITRATE_IN,\n\t\t\t\t\t\t\t\tmetricValue: formattedBitrateIn,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.currentMonitoringEventsObject.metrics[MONITORING_METRICS_NAME_LIST.PACKET_LOST_RECEIVE].length < this.countMetricsInMetricsInterval)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.addValidatedMonitoringMetricWithLogging({\n\t\t\t\t\t\t\t\tmetricKey: MONITORING_METRICS_NAME_LIST.PACKET_LOST_RECEIVE,\n\t\t\t\t\t\t\t\tmetricValue: currentPacketLostReceiveCount,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (currentPacketLostReceiveCount > this.#privateProperties.packetLostThreshold)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.addMonitoringEvents({name: MONITORING_EVENTS_NAME_LIST.HIGH_PACKET_LOSS_RECEIVE, withCounter: true} )\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tstatsAll.recipient = statsOutput;\n\t\t\t\t\tif (participantsWithLargeDataLoss.size || this.#privateProperties.prevParticipantsWithLargeDataLoss.size)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (participantsWithLargeDataLoss.size)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.setLog(`Have high packetsLost on users: ${[...participantsWithLargeDataLoss.values()]}`, LOG_LEVEL.WARNING);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.triggerEvents('UpdatePacketLoss', [[...participantsWithLargeDataLoss.keys()]] );\n\t\t\t\t\t}\n\t\t\t\t\tthis.#privateProperties.prevParticipantsWithLargeDataLoss = participantsWithLargeDataLoss;\n\t\t\t\t});\n\n\t\t\t\tthis.triggerEvents('CallStatsReceived', [statsAll]);\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\t// if we're here it's almost okay\n\t\t\t\t// we tried to get stats during reconnection\n\t\t\t}\n\t\t}\n\n\n\t\tgetStatsHandle().finally(() => {\n\t\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t\t{\n\t\t\t\tthis.startAggregateMonitoringEvents();\n\t\t\t});\n\t\t\tthis.#privateProperties.callStatsInterval = setInterval( async () => {\n\t\t\t\tawait getStatsHandle()\n\t\t\t}, this.#privateProperties.statsTimeout);\n\t\t});\n\t}\n\n\t#destroyPeerConnection() {\n\t\tif (this.sender) {\n\t\t\tthis.sender.close()\n\t\t\tthis.sender = null\n\t\t}\n\n\t\tif (this.recipient) {\n\t\t\tthis.recipient.close()\n\t\t\tthis.recipient = null\n\t\t}\n\n\t\tthis.#privateProperties.peerConnectionFailed = false;\n\t}\n\n\t#releaseStream(kind) {\n\t\tlet streamType\n\n\t\tswitch (kind) {\n\t\t\tcase MediaStreamsKinds.Camera:\n\t\t\t\tstreamType = 'cameraStream'\n\t\t\t\tbreak\n\t\t\tcase MediaStreamsKinds.Microphone:\n\t\t\t\tstreamType = 'microphoneStream'\n\t\t\t\tbreak\n\t\t\tcase MediaStreamsKinds.Screen:\n\t\t\t\tstreamType = 'screenStream'\n\t\t\t\tbreak\n\t\t}\n\n\t\tif (streamType) {\n\t\t\tthis.#privateProperties[streamType]?.getTracks?.()?.forEach( track => {\n\t\t\t\ttrack.onended = null\n\t\t\t\ttrack.stop()\n\t\t\t})\n\t\t\tthis.#privateProperties[streamType] = null\n\t\t}\n\t}\n\n\t#getSender(kind) {\n\t\tconst senders = this.sender?.getSenders?.();\n\t\tlet sender = null;\n\n\t\tif (senders?.length > 0) {\n\t\t\tfor (const s of senders) {\n\t\t\t\tif (s.track?.source === kind) {\n\t\t\t\t\tsender = s\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn sender;\n\t}\n\n\t#sendSignal(signal) {\n\t\tif (this.#privateProperties.socketConnect?.readyState === 1)\n\t\t{\n\t\t\tthis.#privateProperties.socketConnect.send(JSON.stringify(signal));\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t#sendLeave() {\n\t\tif (this.#privateProperties.socketConnect?.readyState === 1) {\n\t\t\tthis.#sendSignal({\n\t\t\t\tleave:  {\n\t\t\t\t\treason: 'CLIENT_INITIATED'\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.checkQosFeatureAndExecutionCallback(() =>\n\t\t\t{\n\t\t\t\tthis.sendMonitoringEvents(false);\n\t\t\t});\n\t\t}\n\t}\n}\n\nclass Participant {\n\t#socketConnect;\n\n\tname = '';\n\timage = '';\n\tuserId = '';\n\tvideoEnabled = false;\n\taudioEnabled = false;\n\tscreenSharingEnabled = false;\n\tisSpeaking = false;\n\ttracks = {};\n\tsid = '';\n\tisMutedVideo = false;\n\tisMutedAudio = false;\n\tisHandRaised = false;\n\tvideoPaused = false;\n\tisLocalVideoMute = false;\n\tstreamRemovingId = '';\n\tcameraStreamQuality: STREAM_QUALITY.MEDIUM;\n\n\tconstructor(participant, socket) {\n\t\tthis.name = participant?.name || '';\n\t\tthis.image = participant?.image || '';\n\t\tthis.userId = participant?.userId || '';\n\t\tthis.sid = participant?.sid || '';\n\t\tthis.videoEnabled = participant?.videoEnabled || false;\n\t\tthis.audioEnabled = participant?.audioEnabled || false;\n\t\tthis.screenSharingEnabled = participant?.screenSharingEnabled || false;\n\t\tthis.isSpeaking = participant?.isSpeaking || false;\n\t\tthis.isHandRaised = participant?.isHandRaised || false;\n\t\tthis.#socketConnect = socket;\n\t}\n\n\tsubscribeTrack(MediaStreamKind) {};\n\n\tunsubscribeTrack(MediaStreamKind) {};\n\n\tattachTrack(MediaStreamKind) {};\n\n\tdetachTrack(MediaStreamKind) {};\n\n\tdisableAudio() {\n\t\tthis.tracks[MediaStreamsKinds.Microphone].track.enabled = false;\n\t\tthis.isMutedAudio = true;\n\t};\n\n\tenableAudio() {\n\t\tthis.tracks[MediaStreamsKinds.Microphone].track.enabled = true;\n\t\tthis.isMutedAudio = false;\n\t};\n\n\tdisableVideo() {\n\t\tthis.tracks[MediaStreamsKinds.Camera].track.enabled = false;\n\t\tthis.isMutedVideo = true;\n\t};\n\n\tenableVideo() {\n\t\tthis.tracks[MediaStreamsKinds.Camera].track.enabled = true;\n\t\tthis.isMutedVideo = false;\n\t};\n\n\taddTrack(MediaStreamKind, Track) {\n\t\tthis.tracks[MediaStreamKind] = Track;\n\t};\n\n\tremoveTrack(MediaStreamKind, Track) {\n\t\tdelete this.tracks[MediaStreamKind];\n\t};\n\n\tgetTrack(MediaStreamKind) {\n\t\treturn this.tracks?.[MediaStreamKind]\n\t}\n\n\tsetStreamQuality(quality) {\n\t\tif (this.cameraStreamQuality === quality || this.videoPaused)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.tracks?.[MediaStreamsKinds.Camera]) {\n\t\t\tthis.cameraStreamQuality = quality;\n\t\t\tconst trackId = this.tracks[MediaStreamsKinds.Camera].id;\n\t\t\tthis.tracks[MediaStreamsKinds.Camera].track.currentVideoQuality =  quality;\n\t\t\tconst signal = {\n\t\t\t\ttrackSetting: {\n\t\t\t\t\ttrackSids: [trackId],\n\t\t\t\t\tquality: quality,\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis.#socketConnect.send(JSON.stringify(signal));\n\t\t}\n\t}\n}","export class Logger\n{\n\tconstructor(serviceUrl, token)\n\t{\n\t\tthis.serviceUrl = serviceUrl;\n\t\tthis.token = token;\n\n\t\tthis.socket = null;\n\t\tthis.attempt = 0;\n\t\tthis.reconnectTimeout = null;\n\t\tthis.unsentMessages = [];\n\n\t\tthis.onSocketOpenHandler = this.onSocketOpen.bind(this);\n\t\tthis.onSocketCloseHandler = this.onSocketClose.bind(this);\n\t\tthis.onSocketErrorHandler = this.onSocketError.bind(this);\n\n\t\tthis.connect();\n\t}\n\n\tget isConnected()\n\t{\n\t\treturn this.socket && this.socket.readyState === 1;\n\t}\n\n\tlog(message)\n\t{\n\t\tif ((typeof message) != 'string')\n\t\t{\n\t\t\tconsole.error(\"Message should be string\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isConnected)\n\t\t{\n\t\t\tthis.socket.send(JSON.stringify({\n\t\t\t\taction: 'log',\n\t\t\t\tmessage: message\n\t\t\t}));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.unsentMessages.push(message);\n\t\t}\n\t}\n\n\tsendStat(statRecord)\n\t{\n\t\tif ((typeof statRecord) == 'object')\n\t\t{\n\t\t\tstatRecord = JSON.stringify(statRecord)\n\t\t}\n\n\t\tif (this.isConnected)\n\t\t{\n\t\t\tthis.socket.send(JSON.stringify({\n\t\t\t\taction: 'stat',\n\t\t\t\tmessage: statRecord\n\t\t\t}));\n\t\t}\n\t}\n\n\tconnect()\n\t{\n\t\tif (this.socket)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!this.serviceUrl)\n\t\t{\n\t\t\tconsole.error('Logging service url is empty');\n\t\t\treturn;\n\t\t}\n\t\tif (!this.serviceUrl.startsWith('ws://') && !this.serviceUrl.startsWith('wss://'))\n\t\t{\n\t\t\tconsole.error('Logging service url should start with ws:// or wss://');\n\t\t\treturn;\n\t\t}\n\t\tif (!this.token)\n\t\t{\n\t\t\tconsole.error('Logging token is empty');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.attempt++;\n\t\tthis.socket = new WebSocket(this.serviceUrl + '?token=' + this.token);\n\n\t\tthis.bindSocketEvents();\n\t}\n\n\tscheduleReconnect()\n\t{\n\t\tclearTimeout(this.reconnectTimeout);\n\n\t\tif (this.attempt > 3)\n\t\t{\n\t\t\tconsole.error(\"Could not connect to the logging service, giving up\");\n\t\t\treturn;\n\t\t}\n\n\t\tthis.reconnectTimeout = setTimeout(this.connect.bind(this), this.getConnectionDelay(this.attempt) * 1000);\n\t}\n\n\tgetConnectionDelay(attempt)\n\t{\n\t\tswitch (attempt)\n\t\t{\n\t\t\tcase 0:\n\t\t\tcase 1:\n\t\t\t\treturn 15;\n\t\t\tcase 2:\n\t\t\t\treturn 30;\n\t\t\tdefault:\n\t\t\t\treturn 60;\n\t\t}\n\t}\n\n\tdisconnect()\n\t{\n\t\tclearTimeout(this.reconnectTimeout);\n\t\tif (this.socket)\n\t\t{\n\t\t\tthis.removeSocketEvents();\n\t\t\tthis.socket.close(1000);\n\t\t\tthis.socket = null;\n\t\t}\n\t}\n\n\tbindSocketEvents()\n\t{\n\t\tthis.socket.addEventListener('open', this.onSocketOpenHandler);\n\t\tthis.socket.addEventListener('close', this.onSocketCloseHandler);\n\t\tthis.socket.addEventListener('error', this.onSocketErrorHandler);\n\t}\n\n\tremoveSocketEvents()\n\t{\n\t\tthis.socket.removeEventListener('open', this.onSocketOpenHandler);\n\t\tthis.socket.removeEventListener('close', this.onSocketCloseHandler);\n\t\tthis.socket.removeEventListener('error', this.onSocketErrorHandler);\n\t}\n\n\tonSocketOpen()\n\t{\n\t\tthis.attempt = 0;\n\t\tfor (let i = 0; i < this.unsentMessages.length; i++)\n\t\t{\n\t\t\tthis.socket.send(JSON.stringify({\n\t\t\t\taction: 'log',\n\t\t\t\tmessage: this.unsentMessages[i]\n\t\t\t}));\n\t\t}\n\t\tthis.unsentMessages = [];\n\t}\n\n\tonSocketClose()\n\t{\n\t\tthis.socket = null;\n\t\tthis.scheduleReconnect();\n\t}\n\n\tonSocketError()\n\t{\n\t\tthis.socket = null;\n\t\tthis.scheduleReconnect();\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.disconnect();\n\t\tthis.unsentMessages = null;\n\t}\n}","import {Type} from 'main.core'\nimport {DesktopApi} from 'im.v2.lib.desktop-api';\nimport {Logger} from './logger'\nimport {CallType, CallEvent, CallState, CallEngine, Provider} from './engine'\nimport {Hardware} from '../call_hardware';\nimport Util from '../util'\n\n/**\n * Abstract call class\n * Public methods:\n * - inviteUsers\n * - cancel\n * - answer\n * - decline\n * - hangup\n *\n * Events:\n * - onJoin\n * - onLeave\n * - onUserStateChanged\n * - onStreamReceived\n * - onStreamRemoved\n * - onCallFailure\n * - onDestroy\n */\nexport class AbstractCall\n{\n\tlogger: ?Logger\n\tlocalStreams: {[key: string]: ?MediaStream}\n\n\tconstructor(params)\n\t{\n\t\tthis.id = params.id;\n\t\tthis.uuid = params.uuid;\n\t\tthis.instanceId = params.instanceId;\n\t\tthis.parentId = params.parentId || null;\n\t\tthis.parentUuid = params.parentUuid || null;\n\t\tthis.direction = params.direction;\n\t\tthis.scheme = params.scheme;\n\t\tthis.type = BX.prop.getInteger(params, \"type\", CallType.Instant); // @see {BX.Call.Type}\n\t\tthis.state = BX.prop.getString(params, \"state\", CallState.Idle);\n\n\t\tthis.ready = false;\n\t\tthis.userId = CallEngine.getCurrentUserId();\n\t\tthis.userData = Type.isPlainObject(params.userData) ? params.userData : {};\n\n\t\tthis.initiatorId = params.initiatorId || '';\n\t\tthis.users = Type.isArray(params.users) ? params.users.filter(userId => userId != this.userId) : [];\n\n\t\tthis.associatedEntity = Type.isPlainObject(params.associatedEntity) ? params.associatedEntity : {};\n\t\tthis.startDate = new Date(BX.prop.getString(params, \"startDate\", \"\"));\n\n\t\t// media constraints\n\t\tthis.videoEnabled = Hardware.isCameraOn;\n\t\tthis.videoHd = params.videoHd === true;\n\t\tthis.cameraId = params.cameraId || '';\n\t\tthis.microphoneId = params.microphoneId || '';\n\n\t\tthis.muted = Hardware.isMicrophoneMuted;\n\n\t\tthis.wasConnected = false;\n\n\t\tthis.logToken = params.logToken || '';\n\t\tif (CallEngine.getLogService() && this.logToken)\n\t\t{\n\t\t\tthis.logger = new Logger(CallEngine.getLogService(), this.logToken);\n\t\t}\n\n\t\tthis.localStreams = {\n\t\t\tmain: null,\n\t\t\tscreen: null\n\t\t};\n\n\t\tthis.eventListeners = {};\n\n\t\tif (Type.isPlainObject(params.events))\n\t\t{\n\t\t\tthis.initEventListeners(params.events);\n\t\t}\n\n\t\tthis.connectionData = params.connectionData || {};\n\n\t\tthis._microphoneLevel = 0;\n\t};\n\n\tget provider()\n\t{\n\t\tthrow new Error(\"must be overwritten\")\n\t}\n\n\tget microphoneLevel()\n\t{\n\t\treturn this._microphoneLevel\n\t}\n\n\tset microphoneLevel(level)\n\t{\n\t\tif (level != this._microphoneLevel)\n\t\t{\n\t\t\tthis._microphoneLevel = level;\n\t\t\tthis.runCallback(CallEvent.onMicrophoneLevel, {\n\t\t\t\tlevel: level\n\t\t\t});\n\t\t}\n\t}\n\n\taddDialogInfo(dialogInfo)\n\t{\n\t\tthis.associatedEntity = Type.isPlainObject(dialogInfo) ? dialogInfo : {};\n\t}\n\n\tinitEventListeners(eventListeners)\n\t{\n\t\tfor (var eventName in eventListeners)\n\t\t{\n\t\t\tthis.addEventListener(eventName, eventListeners[eventName]);\n\t\t}\n\t};\n\n\taddEventListener(eventName, listener)\n\t{\n\t\tif (!Type.isArray(this.eventListeners[eventName]))\n\t\t{\n\t\t\tthis.eventListeners[eventName] = [];\n\t\t}\n\n\t\tif (Type.isArray(this.eventListeners[eventName]) && this.eventListeners[eventName].includes(listener))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (Type.isFunction(listener))\n\t\t{\n\t\t\tthis.eventListeners[eventName].push(listener);\n\t\t}\n\t};\n\n\tremoveEventListener(eventName, listener)\n\t{\n\t\tif (Type.isArray(this.eventListeners[eventName]) && this.eventListeners[eventName].indexOf(listener) >= 0)\n\t\t{\n\t\t\tvar listenerIndex = this.eventListeners[eventName].indexOf(listener);\n\t\t\tif (listenerIndex >= 0)\n\t\t\t{\n\t\t\t\tthis.eventListeners[eventName].splice(listenerIndex, 1);\n\t\t\t}\n\t\t}\n\t};\n\n\trunCallback(eventName, eventFields)\n\t{\n\t\t//console.log(eventName, eventFields);\n\t\tif (Type.isArray(this.eventListeners[eventName]) && this.eventListeners[eventName].length > 0)\n\t\t{\n\t\t\tif (eventName === null || typeof (eventFields) !== \"object\")\n\t\t\t{\n\t\t\t\teventFields = {};\n\t\t\t}\n\t\t\teventFields.call = this;\n\t\t\tfor (let i = 0; i < this.eventListeners[eventName].length; i++)\n\t\t\t{\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tthis.eventListeners[eventName][i].call(this, eventFields);\n\t\t\t\t} catch (err)\n\t\t\t\t{\n\t\t\t\t\tconsole.error(eventName + \" callback error: \", err);\n\t\t\t\t\tthis.log(eventName + \" callback error: \", err);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tgetLocalStream(tag)\n\t{\n\t\treturn this.localStreams[tag];\n\t};\n\n\tsetLocalStream(mediaStream, tag)\n\t{\n\t\ttag = tag || \"main\";\n\n\t\tthis.localStreams[tag] = mediaStream;\n\t};\n\n\tisAnyoneParticipating()\n\t{\n\t\tthrow new Error(\"isAnyoneParticipating should be implemented\");\n\t};\n\n\t__onPullEvent(command, params)\n\t{\n\t\tthrow new Error(\"__onPullEvent should be implemented\");\n\t};\n\n\tinviteUsers()\n\t{\n\t\tthrow new Error(\"inviteUsers is not implemented\");\n\t};\n\n\tcancel()\n\t{\n\t\tthrow new Error(\"cancel is not implemented\");\n\t};\n\n\tanswer()\n\t{\n\t\tthrow new Error(\"answer is not implemented\");\n\t};\n\n\tdecline(code, reason)\n\t{\n\t\tthrow new Error(\"decline is not implemented\");\n\t};\n\n\thangup()\n\t{\n\t\tthrow new Error(\"hangup is not implemented\");\n\t};\n\n\tlog()\n\t{\n\t\tlet text = Util.getLogMessage.apply(null, arguments);\n\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.writeToLogFile(BX.message('USER_ID') + '.video.log', text.substr(3));\n\t\t}\n\t\tif (CallEngine.debugFlag && console)\n\t\t{\n\t\t\tlet a = ['Call log [' + Util.getTimeForLog() + ']: '];\n\t\t\tconsole.log.apply(this, a.concat(Array.prototype.slice.call(arguments)));\n\t\t}\n\t\tif (this.logger)\n\t\t{\n\t\t\tthis.logger.log(text);\n\t\t}\n\n\t\tif (BX.MessengerDebug)\n\t\t{\n\t\t\tBX.MessengerDebug.addLog(this.id, text);\n\t\t}\n\t};\n\n\tdestroy()\n\t{\n\t\tif (this.logger)\n\t\t{\n\t\t\tthis.logger.destroy();\n\t\t\tthis.logger = null;\n\t\t}\n\n\t\tthis.state = CallState.Finished;\n\t\tthis.runCallback(CallEvent.onDestroy);\n\t}\n}","import Util from '../util';\n\nexport function logPlaybackError(error)\n{\n\tconsole.error(\"Playback start error: \", error);\n\t\n\tUtil.sendLog({\n\t\tdescription: 'Playback start error',\n\t\terror: error,\n\t});\n}\n\nexport function checkAndEncodeURI(uri)\n{\n\treturn decodeURI(uri) === uri ? encodeURI(uri) : uri;\n}","import {Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {EndpointDirection, UserState} from '../engine/engine';\nimport { checkAndEncodeURI } from './tools';\n\ntype UserModelMap = Record<string, UserModel>;\n\nexport class UserModel\n{\n\tid: number\n\tname: string\n\tavatar: string\n\tgender: string\n\tstate: string\n\ttalking: boolean\n\tcameraState: boolean\n\tprevCameraState: boolean\n\tmicrophoneState: boolean\n\tscreenState: boolean\n\tvideoPaused: boolean\n\tfloorRequestState: boolean\n\tpermissionToSpeak: boolean\n\tlocalUser: boolean\n\tcentralUser: boolean\n\tpinned: boolean\n\tpresenter: boolean\n\torder: number\n\tprevOrder: number\n\tallowRename: boolean\n\twasRenamed: boolean\n\trenameRequested: boolean\n\tdirection: string\n\n\tconstructor(config)\n\t{\n\t\tthis.data = {\n\t\t\tid: BX.prop.getInteger(config, \"id\", 0),\n\t\t\tname: BX.prop.getString(config, \"name\", \"\"),\n\t\t\tavatar: checkAndEncodeURI(BX.prop.getString(config, \"avatar\", \"\")),\n\t\t\tgender: BX.prop.getString(config, \"gender\", \"\"),\n\t\t\tstate: BX.prop.getString(config, \"state\", UserState.Idle),\n\t\t\ttalking: BX.prop.getBoolean(config, \"talking\", false),\n\t\t\tcameraState: BX.prop.getBoolean(config, \"cameraState\", true),\n\t\t\tprevCameraState: BX.prop.getBoolean(config, \"cameraState\", true),\n\t\t\tmicrophoneState: BX.prop.getBoolean(config, \"microphoneState\", true),\n\t\t\tscreenState: BX.prop.getBoolean(config, \"screenState\", false),\n\t\t\tvideoPaused: BX.prop.getBoolean(config, \"videoPaused\", false),\n\t\t\tfloorRequestState: BX.prop.getBoolean(config, \"floorRequestState\", false),\n\t\t\tpermissionToSpeak: BX.prop.getBoolean(config, \"permissionToSpeak\", false),\n\t\t\tlocalUser: BX.prop.getBoolean(config, \"localUser\", false),\n\t\t\tcentralUser: BX.prop.getBoolean(config, \"centralUser\", false),\n\t\t\tpinned: BX.prop.getBoolean(config, \"pinned\", false),\n\t\t\tpresenter: BX.prop.getBoolean(config, \"presenter\", false),\n\t\t\torder: BX.prop.getInteger(config, \"order\", false),\n\t\t\tprevOrder: BX.prop.getInteger(config, \"prevOrder\", false),\n\t\t\tallowRename: BX.prop.getBoolean(config, \"allowRename\", false),\n\t\t\twasRenamed: BX.prop.getBoolean(config, \"wasRenamed\", false),\n\t\t\trenameRequested: BX.prop.getBoolean(config, \"renameRequested\", false),\n\t\t\tdirection: BX.prop.getString(config, \"direction\", EndpointDirection.SendRecv),\n\t\t};\n\n\t\tfor (let fieldName in this.data)\n\t\t{\n\t\t\tif (this.data.hasOwnProperty(fieldName))\n\t\t\t{\n\t\t\t\tObject.defineProperty(this, fieldName, {\n\t\t\t\t\tget: this._getField(fieldName).bind(this),\n\t\t\t\t\tset: this._setField(fieldName).bind(this),\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tthis.onUpdate = {\n\t\t\ttalking: this._onUpdateTalking.bind(this),\n\t\t\tstate: this._onUpdateState.bind(this),\n\t\t};\n\n\t\tthis.talkingStop = null;\n\n\t\tthis.eventEmitter = new EventEmitter(this, 'UserModel');\n\t};\n\n\t_getField(fieldName)\n\t{\n\t\treturn function ()\n\t\t{\n\t\t\treturn this.data[fieldName];\n\t\t}\n\t};\n\n\t_setField(fieldName)\n\t{\n\t\treturn function (newValue)\n\t\t{\n\t\t\tvar oldValue = this.data[fieldName];\n\t\t\tif (oldValue == newValue)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.data[fieldName] = newValue;\n\n\t\t\tif (this.onUpdate.hasOwnProperty(fieldName))\n\t\t\t{\n\t\t\t\tthis.onUpdate[fieldName](newValue, oldValue);\n\t\t\t}\n\n\t\t\tthis.eventEmitter.emit(\"changed\", {\n\t\t\t\tuser: this,\n\t\t\t\tfieldName: fieldName,\n\t\t\t\toldValue: oldValue,\n\t\t\t\tnewValue: newValue,\n\t\t\t});\n\t\t}\n\t};\n\n\t_onUpdateTalking(talking)\n\t{\n\t\tif (!talking)\n\t\t{\n\t\t\tthis.talkingStop = (new Date()).getTime();\n\t\t}\n\t};\n\n\t_onUpdateState(newValue)\n\t{\n\t\tif (newValue != UserState.Connected)\n\t\t{\n\t\t\tthis.talking = false;\n\t\t\tthis.screenState = false;\n\t\t}\n\t};\n\n\twasTalkingAgo()\n\t{\n\t\tif (this.state != UserState.Connected)\n\t\t{\n\t\t\treturn +Infinity;\n\t\t}\n\t\tif (this.talking)\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\t\tif (!this.talkingStop)\n\t\t{\n\t\t\treturn +Infinity;\n\t\t}\n\n\t\treturn ((new Date()).getTime() - this.talkingStop);\n\t};\n\n\tsubscribe(event, handler)\n\t{\n\t\tthis.eventEmitter.subscribe(event, handler);\n\t};\n\n\tunsubscribe(event, handler)\n\t{\n\t\tthis.eventEmitter.unsubscribe(event, handler);\n\t};\n}\n\nexport class UserRegistry extends EventEmitter\n{\n\tusers: UserModelMap;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Call.UserRegistry');\n\t\tthis.users = new Map();\n\t};\n\n\t/**\n\t *\n\t * @param {int} userId\n\t * @returns {UserModel|null}\n\t */\n\tget(userId): ?UserModel\n\t{\n\t\treturn this.users.get(Number(userId)) || null;\n\t};\n\n\tpush(user: UserModel)\n\t{\n\t\tif (!(user instanceof UserModel))\n\t\t{\n\t\t\tthrow Error(\"user should be instance of UserModel\")\n\t\t}\n\n\t\tthis.users.set(Number(user.id), user);\n\n\t\tuser.subscribe(\"changed\", this._onUserChanged.bind(this));\n\t\tthis.emit(\"userAdded\", {\n\t\t\tuser: user\n\t\t});\n\t};\n\n\t_onUserChanged(event)\n\t{\n\t\tif (event.data.fieldName === 'order')\n\t\t{\n\t\t\tthis._sort();\n\t\t}\n\t\tthis.emit(\"userChanged\", event.data)\n\t};\n\n\t_sort()\n\t{\n\t\tthis.users = new Map([...this.users].sort((a, b) => a[1].order - b[1].order));\n\t}\n}","import {Dom, Type} from 'main.core'\n\nexport function createSVG(elementName, config)\n{\n\tlet element = document.createElementNS('http://www.w3.org/2000/svg', elementName);\n\n\tif (\"attrNS\" in config && Type.isObject(config.attrNS))\n\t{\n\t\tfor (let key in config.attrNS)\n\t\t{\n\t\t\tif (config.attrNS.hasOwnProperty(key))\n\t\t\t{\n\t\t\t\telement.setAttributeNS(null, key, config.attrNS[key]);\n\t\t\t}\n\t\t}\n\t}\n\n\tDom.adjust(element, config);\n\treturn element;\n}","import { Dom, Text, Type } from 'main.core';\n\nimport Util from '../util';\nimport { createSVG } from './svg';\nimport { View } from './view';\n\n\n\nconst createCssTooltip = (options = {}) => {\n\tconst {\n\t\twidth: tooltipWidth = 'max-content',\n\t\tposition: tooltipPosition = 'top',\n\t\tgetText: getTooltipText = () => ''\n\t} = options;\n\n\tconst hasTooltip = Boolean(Object.keys(options).length);\n\tconst tooltipText = getTooltipText();\n\tconst tooltipPositionClass = tooltipPosition === 'bottom' ? '-bottom' : '-top';\n\tconst tooltipClass = `bx-videocall-tooltip ${tooltipPositionClass}`;\n\tconst tooltipTextVarName = '--data-tooltip-text';\n\n\treturn {\n\t\thasTooltip,\n\t\ttooltipClass: hasTooltip ? tooltipClass : '',\n\t\ttooltipText,\n\t\ttooltipStyle: `--data-tooltip-width:${tooltipWidth}; ${tooltipTextVarName}:'${tooltipText}'`,\n\t\tgetTooltipText,\n\t\ttooltipTextVarName,\n\t}\n}\nexport class TitleButton\n{\n\tconstructor(config)\n\t{\n\t\tthis.elements = {\n\t\t\troot: null\n\t\t};\n\n\t\tthis.text = Type.isStringFilled(config.text) ? config.text : '';\n\t\tthis.isGroupCall = config.isGroupCall;\n\t};\n\n\trender()\n\t{\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-panel-title\"},\n\t\t\thtml: this.getTitle()\n\t\t});\n\n\t\treturn this.elements.root;\n\t};\n\n\tgetTitle()\n\t{\n\t\tconst prettyName = '<span class=\"bx-messenger-videocall-panel-title-name\">' + Text.encode(this.text) + '</span>';\n\n\t\tif (this.isGroupCall)\n\t\t{\n\t\t\treturn BX.message(\"IM_M_GROUP_CALL_WITH\").replace(\"#CHAT_NAME#\", prettyName);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn BX.message(\"IM_M_CALL_WITH\").replace(\"#USER_NAME#\", prettyName);\n\t\t}\n\t};\n\n\tupdate(config)\n\t{\n\t\tthis.text = Type.isStringFilled(config.text) ? config.text : '';\n\t\tthis.isGroupCall = config.isGroupCall;\n\t\tthis.elements.root.innerHTML = this.getTitle();\n\t}\n}\n\nexport class SimpleButton\n{\n\tconstructor(config)\n\t{\n\t\tthis.class = config.class;\n\t\tthis.backgroundClass = BX.prop.getString(config, \"backgroundClass\", \"\");\n\t\tthis.backgroundClass = \"bx-messenger-videocall-panel-icon-background\" + (this.backgroundClass ? \" \" : \"\") + this.backgroundClass;\n\t\tthis.blocked = config.blocked === true;\n\n\t\tthis.tooltip = createCssTooltip(BX.prop.getObject(config, 'tooltip', {}));\n\n\t\tthis.text = BX.prop.getString(config, \"text\", \"\");\n\t\tthis.isActive = false;\n\t\tthis.counter = BX.prop.getInteger(config, \"counter\", 0);\n\t\tthis.isComingSoon = config.isComingSoon || false;\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\tcounter: null,\n\t\t\tcomingSoon: null,\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tonClick: BX.prop.getFunction(config, \"onClick\", BX.DoNothing),\n\t\t}\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tlet textNode;\n\t\tif (this.text !== '')\n\t\t{\n\t\t\ttextNode = Dom.create(\"div\", {props: {className: \"bx-messenger-videocall-panel-text\"}, text: this.text});\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttextNode = null;\n\t\t}\n\n\t\tconst {\n\t\t\ttooltipClass, tooltipStyle,\n\t\t} = this.tooltip;\n\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: { className: `bx-messenger-videocall-panel-item ${tooltipClass}` + (this.blocked ? ' blocked' : '') },\n\t\t\tattrs: {\n\t\t\t\tstyle: tooltipStyle,\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: this.backgroundClass},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-panel-icon bx-messenger-videocall-panel-icon-\" + this.class},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tthis.elements.counter = Dom.create(\"span\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-panel-item-counter\"},\n\t\t\t\t\t\t\t\t\ttext: 0,\n\t\t\t\t\t\t\t\t\tdataset: {\n\t\t\t\t\t\t\t\t\t\tcounter: 0,\n\t\t\t\t\t\t\t\t\t\tcounterType: 'digits',\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.comingSoon = Dom.create(\"span\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-panel-item-coming-soon\"},\n\t\t\t\t\t\t\t\t\ttext: BX.message('CALL_FEATURES_COMING_SOON'),\n\t\t\t\t\t\t\t\t\tdataset: {\n\t\t\t\t\t\t\t\t\t\tvisible: this.isComingSoon ? 'Y' : 'N',\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\ttextNode,\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-panel-item-bottom-spacer\"}\n\t\t\t\t})\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: this.callbacks.onClick,\n\t\t\t}\n\t\t});\n\n\t\tif (this.isActive)\n\t\t{\n\t\t\tthis.elements.root.classList.add(\"active\");\n\t\t}\n\n\t\treturn this.elements.root;\n\t};\n\n\tsetActive(isActive)\n\t{\n\t\tif (this.isActive == isActive)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.isActive = isActive;\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.isActive)\n\t\t{\n\t\t\tthis.elements.root.classList.add(\"active\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root.classList.remove(\"active\");\n\t\t}\n\n\t\tconst {\n\t\t\thasTooltip, getTooltipText, tooltipTextVarName,\n\t\t} = this.tooltip;\n\n\t\thasTooltip && this.elements.root.style.setProperty(tooltipTextVarName, `'${getTooltipText()}'`);\n\n\t};\n\n\tsetBlocked(isBlocked)\n\t{\n\t\tif (this.blocked == isBlocked)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.blocked = isBlocked;\n\t\tif (this.blocked)\n\t\t{\n\t\t\tthis.elements.root.classList.add(\"blocked\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root.classList.remove(\"blocked\");\n\t\t}\n\t};\n\n\tsetCounter(counter)\n\t{\n\t\tthis.counter = parseInt(counter, 10);\n\n\t\tlet counterLabel = this.counter;\n\t\tif (counterLabel > 999)\n\t\t{\n\t\t\tcounterLabel = 999;\n\t\t}\n\n\t\tlet counterType = 'digits';\n\t\tif (counterLabel.toString().length === 2)\n\t\t{\n\t\t\tcounterType = 'dozens';\n\t\t}\n\t\telse if (counterLabel.toString().length > 2)\n\t\t{\n\t\t\tcounterType = 'hundreds';\n\t\t}\n\n\t\tthis.elements.counter.dataset.counter = counterLabel;\n\t\tthis.elements.counter.dataset.counterType = counterType;\n\t\tthis.elements.counter.innerText = counterLabel;\n\t};\n\n\tsetIsComingSoon(isActive)\n\t{\n\t\tthis.isComingSoon = isActive;\n\n\t\tthis.isComingSoon\n\t\t\t? this.elements.comingSoon.dataset.visible = 'Y'\n\t\t\t: this.elements.comingSoon.dataset.visible = 'N';\n\t}\n}\n\nexport class DeviceButton\n{\n\tconstructor(config)\n\t{\n\t\tthis.class = config.class;\n\t\tthis.text = config.text;\n\n\t\tthis.enabled = (config.enabled === true);\n\t\tthis.arrowEnabled = (config.arrowEnabled === true);\n\t\tthis.arrowHidden = (config.arrowHidden === true);\n\t\tthis.blocked = (config.blocked === true);\n\n\t\tthis.tooltip = createCssTooltip(BX.prop.getObject(config, 'tooltip', {}));\n\n\t\tthis.backgroundClass = BX.prop.getString(config, \"backgroundClass\", \"\");\n\n\t\tthis.showLevel = (config.showLevel === true);\n\t\tthis.level = config.level || 0;\n\n\t\tthis.sideIcon = BX.prop.getString(config, \"sideIcon\", \"\");\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\ticonContainer: null,\n\t\t\ticon: null,\n\t\t\tarrow: null,\n\t\t\tlevelMeter: null,\n\t\t\tpointer: null,\n\t\t\tellipsis: null,\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tonClick: BX.prop.getFunction(config, \"onClick\", BX.DoNothing),\n\t\t\tonArrowClick: BX.prop.getFunction(config, \"onArrowClick\", BX.DoNothing),\n\t\t\tonSideIconClick: BX.prop.getFunction(config, \"onSideIconClick\", BX.DoNothing),\n\t\t}\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tconst {\n\t\t\ttooltipClass, tooltipStyle,\n\t\t} = this.tooltip;\n\n\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tid: \"bx-messenger-videocall-panel-item-with-arrow-\" + this.class,\n\t\t\t\tclassName: `bx-messenger-videocall-panel-item-with-arrow ${tooltipClass}` + (this.blocked ? \" blocked\" : \"\")\n\t\t\t},\n\t\t\tattrs: {\n\t\t\t\tstyle: tooltipStyle,\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-panel-item-with-arrow-left\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.elements.iconContainer = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: this.getIconContainerClass()},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tthis.elements.icon = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: this.getIconClass()},\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-panel-text\"},\n\t\t\t\t\ttext: this.text\n\t\t\t\t}),\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: this.callbacks.onClick,\n\t\t\t}\n\t\t});\n\n\t\tthis.elements.arrow = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-panel-item-with-arrow-right\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-panel-item-with-arrow-right-icon\"},\n\t\t\t\t})\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: function (e)\n\t\t\t\t{\n\t\t\t\t\tthis.callbacks.onArrowClick.apply(this, arguments);\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t}.bind(this)\n\t\t\t}\n\t\t});\n\n\t\tif (!this.arrowHidden)\n\t\t{\n\t\t\tthis.elements.root.appendChild(this.elements.arrow);\n\t\t}\n\n\t\tif (this.showLevel)\n\t\t{\n\t\t\tthis.elements.icon.appendChild(createSVG(\"svg\", {\n\t\t\t\tattrNS: {\n\t\t\t\t\tclass: \"bx-messenger-videocall-panel-item-level-meter-container\",\n\t\t\t\t\twidth: \"28\",\n\t\t\t\t\theight: \"28\",\n\t\t\t\t\tviewBox: \"0 0 28 28\",\n\t\t\t\t\tfill: \"none\",\n\t\t\t\t},\n\t\t\t\tchildren: [\n\t\t\t\t\tcreateSVG(\"defs\", {\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\tcreateSVG(\"linearGradient\", {\n\t\t\t\t\t\t\t\tattrNS: {\n\t\t\t\t\t\t\t\t\tid: \"volumeGradient\",\n\t\t\t\t\t\t\t\t\tx1: \"0%\",\n\t\t\t\t\t\t\t\t\ty1: \"100%\",\n\t\t\t\t\t\t\t\t\tx2: \"0%\",\n\t\t\t\t\t\t\t\t\ty2: \"0%\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\tthis.elements.gradientStop1 = createSVG(\"stop\", {\n\t\t\t\t\t\t\t\t\t\tattrNS: {\n\t\t\t\t\t\t\t\t\t\t\toffset: \"0\",\n\t\t\t\t\t\t\t\t\t\t\t\"stop-color\": \"#2FC6F6\",\n\t\t\t\t\t\t\t\t\t\t\tid: \"gradientStop1\"\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\tthis.elements.gradientStop2 = createSVG(\"stop\", {\n\t\t\t\t\t\t\t\t\t\tattrNS: {\n\t\t\t\t\t\t\t\t\t\t\toffset: \"0\",\n\t\t\t\t\t\t\t\t\t\t\t\"stop-color\": \"transparent\",\n\t\t\t\t\t\t\t\t\t\t\tid: \"gradientStop2\"\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t]\n\t\t\t\t\t}),\n\t\t\t\t\tcreateSVG(\"path\", {\n\t\t\t\t\t\tattrNS: {\n\t\t\t\t\t\t\t\"fill-rule\": \"evenodd\",\n\t\t\t\t\t\t\t\"clip-rule\": \"evenodd\",\n\t\t\t\t\t\t\td: \"M20.4012 13.5741C20.9948 13.5614 21.4862 14.0351 21.4988 14.6321C21.5567 17.3753 19.5475 20.5964 15.6554 21.1285L15.6546 22.5504L16.1204 22.5507C16.6554 22.5507 17.0891 22.9869 17.0891 23.525C17.0891 24.0631 16.6554 24.4993 16.1204 24.4993H12.879C12.344 24.4993 11.9103 24.0631 11.9103 23.525C11.9103 22.9869 12.344 22.5507 12.879 22.5507L13.3433 22.5504L13.3432 21.1275C9.45683 20.5997 7.47015 17.4555 7.50034 14.6434C7.50675 14.0463 7.99323 13.5674 8.58692 13.5738C9.14103 13.5799 9.59269 14.0065 9.64523 14.5489L9.65028 14.6667C9.64425 15.2277 9.95576 16.3048 10.5307 17.1425C11.3561 18.3452 12.625 19.0421 14.5111 19.0421C16.3868 19.0421 17.6512 18.3317 18.4781 17.1059C19.0061 16.3232 19.3137 15.3287 19.3465 14.7932L19.3492 14.678C19.3366 14.081 19.8076 13.5867 20.4012 13.5741ZM14.4996 4.66602C16.2557 4.66602 17.6793 6.0193 17.6793 7.68867V14.0608C17.6793 15.7301 16.2557 17.0834 14.4996 17.0834C12.7435 17.0834 11.32 15.7301 11.32 14.0608L11.32 7.68867C11.32 6.0193 12.7435 4.66602 14.4996 4.66602Z\",\n\t\t\t\t\t\t\tfill: \"url(#volumeGradient)\"\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t]\n\t\t\t}));\n\t\t}\n\t\telse if (this.showLevel)\n\t\t{\n\t\t\tthis.elements.icon.appendChild(createSVG(\"svg\", {\n\t\t\t\tattrNS: {\n\t\t\t\t\tclass: \"bx-messenger-videocall-panel-item-level-meter-container\",\n\t\t\t\t\twidth: 3, height: 20\n\t\t\t\t},\n\t\t\t\tchildren: [\n\t\t\t\t\tcreateSVG(\"g\", {\n\t\t\t\t\t\tattrNS: {\n\t\t\t\t\t\t\tfill: \"#30B1DC\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\tcreateSVG(\"rect\", {\n\t\t\t\t\t\t\t\tattrNS: {\n\t\t\t\t\t\t\t\t\tx: 0, y: 0, width: 3, height: 20, rx: 1.5, opacity: .1,\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\tthis.elements.levelMeter = createSVG(\"rect\", {\n\t\t\t\t\t\t\t\tattrNS: {\n\t\t\t\t\t\t\t\t\tx: 0, y: 20, width: 3, height: 20, rx: 1.5,\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t]\n\t\t\t\t\t})\n\t\t\t\t]\n\t\t\t}));\n\t\t}\n\n\t\tthis.elements.ellipsis = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-panel-icon-ellipsis\"},\n\t\t\tevents: {\n\t\t\t\tclick: this.callbacks.onSideIconClick\n\t\t\t}\n\t\t})\n\n\t\tthis.elements.pointer = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-panel-icon-pointer\"},\n\t\t\tevents: {\n\t\t\t\tclick: this.callbacks.onSideIconClick\n\t\t\t}\n\t\t})\n\n\t\tif (this.sideIcon == \"pointer\")\n\t\t{\n\t\t\tBX.Dom.insertAfter(this.elements.pointer, this.elements.icon);\n\t\t}\n\t\telse if (this.sideIcon == \"ellipsis\")\n\t\t{\n\t\t\tBX.Dom.insertAfter(this.elements.ellipsis, this.elements.icon);\n\t\t}\n\n\t\treturn this.elements.root;\n\t};\n\n\tgetIconClass()\n\t{\n\t\treturn \"bx-messenger-videocall-panel-item-with-arrow-icon bx-messenger-videocall-panel-item-with-arrow-icon-\" + this.class + (this.enabled ? \"\" : \"-off\");\n\t};\n\n\tgetIconContainerClass()\n\t{\n\t\treturn \"bx-messenger-videocall-panel-item-with-arrow-icon-container\" + \" bx-messenger-videocall-panel-item-with-arrow-icon-container-\" + this.class + (this.enabled ? \"\" : \"-off\") + (this.arrowHidden ? \" bx-messenger-videocall-panel-item-with-arrow-icon-container-arrow-hidden\" : \"\") + (this.backgroundClass ? ` ${this.backgroundClass}` : \"\");\n\t};\n\n\tenable()\n\t{\n\t\tif (this.enabled)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.enabled = true;\n\t\tthis.elements.iconContainer.className = this.getIconContainerClass();\n\t\tthis.elements.icon.className = this.getIconClass();\n\n\t\tif (this.elements.gradientStop1 && this.elements.gradientStop2)\n\t\t{\n\t\t\tthis.elements.gradientStop1.setAttribute('offset', '0%');\n\t\t\tthis.elements.gradientStop2.setAttribute('offset', '0%');\n\t\t}\n\t\telse if (this.elements.levelMeter)\n\t\t{\n\t\t\tthis.elements.levelMeter.setAttribute('y', Math.round((1 - this.level) * 20));\n\t\t}\n\n\t\tconst {\n\t\t\thasTooltip, getTooltipText, tooltipTextVarName,\n\t\t} = this.tooltip;\n\n\t\thasTooltip && this.elements.root.style.setProperty(tooltipTextVarName, `'${getTooltipText()}'`);\n\t};\n\n\tdisable()\n\t{\n\t\tif (!this.enabled)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.enabled = false;\n\t\tthis.elements.iconContainer.className = this.getIconContainerClass();\n\t\tthis.elements.icon.className = this.getIconClass();\n\n\t\tif (this.elements.gradientStop1 && this.elements.gradientStop2)\n\t\t{\n\t\t\tthis.elements.gradientStop1.setAttribute('offset', '0%');\n\t\t\tthis.elements.gradientStop2.setAttribute('offset', '0%');\n\t\t}\n\t\telse if (this.elements.levelMeter)\n\t\t{\n\t\t\tthis.elements.levelMeter.setAttribute('y', Math.round((1 - this.level) * 20));\n\t\t}\n\n\t\tconst {\n\t\t\thasTooltip, getTooltipText, tooltipTextVarName,\n\t\t} = this.tooltip;\n\n\t\thasTooltip && this.elements.root.style.setProperty(tooltipTextVarName, `'${getTooltipText()}'`);\n\t};\n\n\tsetBlocked(blocked)\n\t{\n\t\tif (this.blocked == blocked)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.blocked = blocked;\n\t\tthis.elements.iconContainer.className = this.getIconContainerClass();\n\t\tthis.elements.icon.className = this.getIconClass();\n\t\tif (this.blocked)\n\t\t{\n\t\t\tthis.elements.root.classList.add(\"blocked\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root.classList.remove(\"blocked\");\n\t\t}\n\t};\n\n\tsetSideIcon(sideIcon)\n\t{\n\t\tif (this.sideIcon == sideIcon)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.sideIcon = sideIcon;\n\n\t\tBX.Dom.remove(this.elements.pointer);\n\t\tBX.Dom.remove(this.elements.ellipsis);\n\n\t\tif (this.sideIcon == \"pointer\")\n\t\t{\n\t\t\tBX.Dom.insertAfter(this.elements.pointer, this.elements.icon);\n\t\t}\n\t\telse if (this.sideIcon == \"ellipsis\")\n\t\t{\n\t\t\tBX.Dom.insertAfter(this.elements.ellipsis, this.elements.icon);\n\t\t}\n\t}\n\n\tshowArrow()\n\t{\n\t\tif (!this.arrowHidden)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.arrowHidden = false;\n\t\tthis.elements.root.appendChild(this.elements.arrow);\n\t};\n\n\thideArrow()\n\t{\n\t\tif (this.arrowHidden)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.arrowHidden = false;\n\t\tthis.elements.root.removeChild(this.elements.arrow);\n\t};\n\n\tsetLevel(level)\n\t{\n\t\tthis.level = Math.log(level * 100) / 4.6;\n\t\tif (this.showLevel && this.enabled)\n\t\t{\n\t\t\tconst offset = `${100 - Math.round((1 - this.level) * 100)}%`;\n\t\t\tthis.elements.gradientStop1.setAttribute('offset', offset);\n\t\t\tthis.elements.gradientStop2.setAttribute('offset', offset);\n\t\t}\n\t}\n}\n\nexport class WaterMarkButton\n{\n\tconstructor(config)\n\t{\n\t\tthis.language = config.language;\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t};\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tthis.elements.root = Dom.create('div', {\n\t\t\tprops: { className: 'bx-messenger-videocall-watermark' },\n\t\t\tchildren: [\n\t\t\t\tDom.create('img', {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'bx-messenger-videocall-watermark-img',\n\t\t\t\t\t\tsrc: this.getWatermarkUrl(this.language),\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\n\t\treturn this.elements.root;\n\t}\n\n\tgetWatermarkUrl(language)\n\t{\n\t\tswitch (language)\n\t\t{\n\t\t\tcase 'ru':\n\t\t\tcase 'kz':\n\t\t\tcase 'by':\n\t\t\t\treturn '/bitrix/js/call/images/new-logo-white-ru.svg';\n\t\t\tdefault:\n\t\t\t\treturn '/bitrix/js/call/images/new-logo-white-en.svg';\n\t\t}\n\t};\n}\n\nexport class TopButton\n{\n\tconstructor(config)\n\t{\n\t\tthis.iconClass = BX.prop.getString(config, 'iconClass', '');\n\t\tthis.text = BX.prop.getString(config, 'text', '');\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\ticon: null,\n\t\t\ttext: null,\n\t\t};\n\t\tthis.tooltip = createCssTooltip(BX.prop.getObject(config, 'tooltip', {}));\n\n\t\tthis.callbacks = {\n\t\t\tonClick: BX.prop.getFunction(config, 'onClick', BX.DoNothing),\n\t\t};\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tconst {\n\t\t\ttooltipClass, tooltipStyle,\n\t\t} = this.tooltip;\n\n\t\tthis.elements.root = Dom.create('div', {\n\t\t\tprops: { className: `bx-messenger-videocall-top-button ${tooltipClass}` },\n\t\t\tattrs: {\n\t\t\t\tstyle: tooltipStyle,\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tthis.elements.icon = Dom.create('div', {\n\t\t\t\t\tprops: { className: `bx-messenger-videocall-top-button-icon ${this.iconClass}` },\n\t\t\t\t}),\n\t\t\t\tthis.elements.text = Dom.create('div', {\n\t\t\t\t\tprops: { className: `bx-messenger-videocall-top-button-text ${this.iconClass}` },\n\t\t\t\t\ttext: this.text,\n\t\t\t\t}),\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: this.callbacks.onClick,\n\t\t\t},\n\t\t});\n\n\t\treturn this.elements.root;\n\t}\n\n\tupdate(config)\n\t{\n\t\tconst iconClass = BX.prop.getString(config, 'iconClass', this.iconClass);\n\t\tconst text = BX.prop.getString(config, 'text', this.text);\n\n\t\tif (this.iconClass !== iconClass)\n\t\t{\n\t\t\tthis.iconClass = iconClass;\n\t\t\tthis.elements.icon.className = `bx-messenger-videocall-top-button-icon ${this.iconClass}`;\n\t\t}\n\n\t\tif (this.text !== text)\n\t\t{\n\t\t\tthis.text = text;\n\t\t\tthis.elements.text.innerText = this.text;\n\t\t\tthis.elements.text.className = `bx-messenger-videocall-top-button-text ${this.iconClass}`;\n\t\t}\n\t}\n}\n\nexport class TopFramelessButton\n{\n\tconstructor(config)\n\t{\n\t\tthis.iconClass = BX.prop.getString(config, 'iconClass', '');\n\t\tthis.textClass = BX.prop.getString(config, 'textClass', '');\n\t\tthis.text = BX.prop.getString(config, 'text', '');\n\t\tthis.tooltip = createCssTooltip(BX.prop.getObject(config, 'tooltip', {}));\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tonClick: BX.prop.getFunction(config, 'onClick', BX.DoNothing),\n\t\t};\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tconst {\n\t\t\ttooltipClass, tooltipStyle,\n\t\t} = this.tooltip;\n\n\t\tthis.elements.root = Dom.create('div', {\n\t\t\tprops: { className: `bx-messenger-videocall-top-button-frameless ${tooltipClass}` },\n\t\t\tattrs: {\n\t\t\t\tstyle: tooltipStyle,\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: { className: `bx-messenger-videocall-top-button-icon ${this.iconClass}` },\n\t\t\t\t}),\n\t\t\t\t(this.text === ''\n\t\t\t\t\t\t? null\n\t\t\t\t\t\t: Dom.create('div', {\n\t\t\t\t\t\t\tprops: { className: `bx-messenger-videocall-top-button-text ${this.textClass}` },\n\t\t\t\t\t\t\ttext: this.text,\n\t\t\t\t\t\t})\n\t\t\t\t),\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: this.callbacks.onClick,\n\t\t\t},\n\t\t});\n\n\t\treturn this.elements.root;\n\t}\n}\n\nexport class ParticipantsButton\n{\n\tconstructor(config)\n\t{\n\t\tthis.count = BX.prop.getInteger(config, \"count\", 0);\n\t\tthis.foldButtonState = BX.prop.getString(config, \"foldButtonState\", ParticipantsButton.FoldButtonState.Hidden);\n\t\tthis.allowAdding = BX.prop.getBoolean(config, \"allowAdding\", false);\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\tleftContainer: null,\n\t\t\trightContainer: null,\n\t\t\tfoldIcon: null,\n\t\t\tcount: null,\n\t\t\tseparator: null\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tonListClick: BX.prop.getFunction(config, \"onListClick\", BX.DoNothing),\n\t\t\tonAddClick: BX.prop.getFunction(config, \"onAddClick\", BX.DoNothing)\n\t\t}\n\t};\n\n\tstatic FoldButtonState = {\n\t\tActive: \"active\",\n\t\tFold: \"fold\",\n\t\tUnfold: \"unfold\",\n\t\tHidden: \"hidden\"\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-top-participants\"},\n\t\t\tchildren: [\n\t\t\t\tthis.elements.leftContainer = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-participants-inner left\" + (this.foldButtonState != ParticipantsButton.FoldButtonState.Hidden ? \" active\" : \"\")},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-button-icon participants\"}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.count = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-participants-text-count\"},\n\t\t\t\t\t\t\ttext: this.count\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.foldIcon = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-participants-fold-icon \" + this.foldButtonState},\n\t\t\t\t\t\t})\n\t\t\t\t\t],\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: this.callbacks.onListClick\n\t\t\t\t\t}\n\t\t\t\t}),\n\n\t\t\t]\n\t\t});\n\n\t\tthis.elements.separator = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-top-participants-separator\"}\n\t\t});\n\t\tthis.elements.rightContainer = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-top-participants-inner active\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-participants-text\"},\n\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_ADD\")\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-button-icon add\"}\n\t\t\t\t}),\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: this.callbacks.onAddClick\n\t\t\t}\n\t\t});\n\n\t\tif (this.allowAdding)\n\t\t{\n\t\t\tthis.elements.root.appendChild(this.elements.separator);\n\t\t\tthis.elements.root.appendChild(this.elements.rightContainer);\n\t\t}\n\t\treturn this.elements.root;\n\t};\n\n\tupdate(config)\n\t{\n\t\tthis.count = BX.prop.getInteger(config, \"count\", this.count);\n\t\tthis.foldButtonState = BX.prop.getString(config, \"foldButtonState\", this.foldButtonState);\n\t\tthis.allowAdding = BX.prop.getBoolean(config, \"allowAdding\", this.allowAdding);\n\n\t\tthis.elements.count.innerText = this.count;\n\n\t\tthis.elements.foldIcon.className = \"bx-messenger-videocall-top-participants-fold-icon \" + this.foldButtonState;\n\t\tif (this.foldButtonState == ParticipantsButton.FoldButtonState.Hidden)\n\t\t{\n\t\t\tthis.elements.leftContainer.classList.remove(\"active\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.leftContainer.classList.add(\"active\");\n\t\t}\n\n\t\tif (this.allowAdding && !this.elements.separator.parentElement)\n\t\t{\n\t\t\tthis.elements.root.appendChild(this.elements.separator);\n\t\t\tthis.elements.root.appendChild(this.elements.rightContainer);\n\t\t}\n\t\tif (!this.allowAdding && this.elements.separator.parentElement)\n\t\t{\n\t\t\tBX.remove(this.elements.separator);\n\t\t\tBX.remove(this.elements.rightContainer);\n\t\t}\n\t};\n}\n\nexport class ParticipantsButtonMobile\n{\n\tconstructor(config)\n\t{\n\t\tthis.count = BX.prop.getInteger(config, \"count\", 0);\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\ticon: null,\n\t\t\ttext: null,\n\t\t\tarrow: null\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tonClick: BX.prop.getFunction(config, \"onClick\", BX.DoNothing),\n\t\t}\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-messenger-videocall-top-participants-mobile\"\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tthis.elements.icon = Dom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-top-participants-mobile-icon\"\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tthis.elements.text = Dom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-top-participants-mobile-text\"\n\t\t\t\t\t},\n\t\t\t\t\ttext: BX.message(\"IM_M_CALL_PARTICIPANTS\").replace(\"#COUNT#\", this.count)\n\t\t\t\t}),\n\t\t\t\tthis.elements.arrow = Dom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-top-participants-mobile-arrow\"\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: this.callbacks.onClick\n\t\t\t}\n\t\t});\n\n\t\treturn this.elements.root;\n\t};\n\n\tsetCount(count)\n\t{\n\t\tif (this.count == count)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.count = count;\n\t\tthis.elements.text.innerText = BX.message(\"IM_M_CALL_PARTICIPANTS\").replace(\"#COUNT#\", this.count);\n\t};\n}\n\nexport class RecordStatusButton\n{\n\tconstructor(config)\n\t{\n\t\tthis.userId = config.userId;\n\t\tthis.recordState = config.recordState;\n\n\t\tthis.updateViewInterval = null;\n\n\t\tthis.tooltip = createCssTooltip(BX.prop.getObject(config, 'tooltip', {}));\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\ttimeText: null,\n\t\t\tstateText: null,\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tonPauseClick: BX.prop.getFunction(config, \"onPauseClick\", BX.DoNothing),\n\t\t\tonStopClick: BX.prop.getFunction(config, \"onStopClick\", BX.DoNothing),\n\t\t}\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tconst {\n\t\t\ttooltipStyle,\n\t\t} = this.tooltip;\n\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: { className: `bx-messenger-videocall-top-recordstatus record-status-` + this.recordState.state + ' ' + (this.recordState.userId == this.userId ? '' : 'record-user-viewer') },\n\t\t\tattrs: {\n\t\t\t\tstyle: tooltipStyle,\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-recordstatus-status\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-button-icon record-status\"}\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-recordstatus-time\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.elements.timeText = Dom.create(\"span\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-recordstatus-time-text\"},\n\t\t\t\t\t\t\ttext: Util.getRecordTimeText(this.recordState)\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-recordstatus-separator\"}\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-recordstatus-buttons\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-recordstatus-button\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-button-icon record-pause\"},\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: this.callbacks.onPauseClick\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\n\t\treturn this.elements.root;\n\t};\n\n\tupdate(recordState)\n\t{\n\t\tif (this.recordState.state !== recordState.state)\n\t\t{\n\t\t\tclearInterval(this.updateViewInterval);\n\t\t\tif (recordState.state === View.RecordState.Started)\n\t\t\t{\n\t\t\t\tthis.updateViewInterval = setInterval(this.updateView.bind(this), 1000);\n\t\t\t}\n\t\t}\n\n\t\tthis.recordState = recordState;\n\t\tthis.updateView();\n\t}\n\n\tupdateView()\n\t{\n\t\tvar timeText = Util.getRecordTimeText(this.recordState);\n\t\tif (this.elements.timeText.innerText !== timeText)\n\t\t{\n\t\t\tthis.elements.timeText.innerText = Util.getRecordTimeText(this.recordState);\n\t\t}\n\n\t\tif (!this.elements.root.classList.contains(\"record-status-\" + this.recordState.state))\n\t\t{\n\t\t\tconst {\n\t\t\t\ttooltipClass,\n\t\t\t\thasTooltip, tooltipTextVarName, getTooltipText,\n\t\t\t} = this.tooltip;\n\n\t\t\tconst tooltipText = getTooltipText();\n\t\t\thasTooltip && tooltipText && this.elements.root.style.setProperty(tooltipTextVarName, `'${tooltipText}'`);\n\t\t\tthis.elements.root.className = `${tooltipText && tooltipClass} bx-messenger-videocall-top-recordstatus record-status-` + this.recordState.state + ' ' + (this.recordState.userId == this.userId ? '' : 'record-user-viewer');\n\t\t}\n\t};\n\n\tstopViewUpdate()\n\t{\n\t\tif (this.updateViewInterval)\n\t\t{\n\t\t\tclearInterval(this.updateViewInterval);\n\t\t\tthis.updateViewInterval = null;\n\t\t}\n\t};\n}","import {Dom} from 'main.core';\nimport {createSVG} from './svg'\nimport {UserState} from '../engine/engine';\nimport Util from '../util'\nimport { Utils } from 'im.v2.lib.utils';\n\nexport class CallUserMobile\n{\n\tconstructor(config)\n\t{\n\t\tthis.userModel = config.userModel;\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\tavatar: null,\n\t\t\tavatarOutline: null,\n\t\t\tuserName: null,\n\t\t\tuserStatus: null,\n\t\t\tmenuArrow: null,\n\t\t\tfloorRequest: null,\n\t\t\tmic: null,\n\t\t\tcam: null,\n\t\t};\n\n\t\tthis._onUserFieldChangeHandler = this._onUserFieldChange.bind(this);\n\t\tthis.userModel.subscribe(\"changed\", this._onUserFieldChangeHandler);\n\n\t\tthis.callbacks = {\n\t\t\tonClick: BX.prop.getFunction(config, \"onClick\", BX.DoNothing)\n\t\t}\n\n\t\tthis.avatarBackground = Util.getAvatarBackground();\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-messenger-videocall-user-mobile\"\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tthis.elements.avatar = Dom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-mobile-avatar\" + (this.userModel.talking ? \" talking\" : \"\")\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.elements.floorRequest = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-mobile-floor-request bx-messenger-videocall-floor-request-icon\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-mobile-body\"\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-mobile-text\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tthis.elements.mic = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-mobile-icon\" + (this.userModel.microphoneState ? \"\" : \" bx-call-view-icon-red-microphone-off\")\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.cam = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-mobile-icon\" + (this.userModel.cameraState ? \"\" : \" bx-call-view-icon-red-camera-off\")\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.userName = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-mobile-username\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\ttext: this.userModel.name\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-mobile-menu-arrow\"\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.userStatus = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-mobile-user-status\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttext: this.userModel.pinned ? BX.message(\"IM_M_CALL_PINNED_USER\") : BX.message(\"IM_M_CALL_CURRENT_PRESENTER\")\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t}),\n\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: this.callbacks.onClick\n\t\t\t}\n\t\t});\n\n\t\treturn this.elements.root;\n\t};\n\n\tupdate()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.elements.userName.innerText = this.userModel.name;\n\n\t\tif (this.userModel.avatar !== '')\n\t\t{\n\t\t\tthis.elements.root.style.setProperty(\"--avatar\", \"url('\" + this.userModel.avatar + \"')\");\n\t\t\tthis.elements.avatar.innerText = '';\n\t\t\tthis.elements.root.style.removeProperty(\"--avatar-background\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root.style.removeProperty(\"--avatar\");\n\t\t\tthis.elements.root.style.setProperty(\"--avatar-background\", this.avatarBackground);\n\t\t\tthis.elements.avatar.innerText = Utils.text.getFirstLetters(this.userModel.name).toUpperCase();\n\t\t}\n\t\tthis.elements.avatar.classList.toggle(\"talking\", this.userModel.talking);\n\t\tthis.elements.floorRequest.classList.toggle(\"active\", this.userModel.floorRequestState);\n\t\tthis.elements.mic.classList.toggle(\"bx-call-view-icon-red-microphone-off\", !this.userModel.microphoneState);\n\t\tthis.elements.cam.classList.toggle(\"bx-call-view-icon-red-camera-off\", !this.userModel.cameraState);\n\n\t\tthis.elements.userStatus.innerText = this.userModel.pinned ? BX.message(\"IM_M_CALL_PINNED_USER\") : BX.message(\"IM_M_CALL_CURRENT_PRESENTER\");\n\t};\n\n\tmount(parentElement)\n\t{\n\t\tparentElement.appendChild(this.render());\n\t};\n\n\tdismount()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tDom.remove(this.elements.root);\n\t};\n\n\tsetUserModel(userModel: UserModel)\n\t{\n\t\tthis.userModel.unsubscribe(\"changed\", this._onUserFieldChangeHandler);\n\t\tthis.userModel = userModel;\n\t\tthis.userModel.subscribe(\"changed\", this._onUserFieldChangeHandler);\n\t\tthis.update();\n\t};\n\n\t_onUserFieldChange(event)\n\t{\n\t\tthis.update();\n\t};\n}\n\nexport class UserSelectorMobile\n{\n\tconstructor(config)\n\t{\n\t\tthis.userRegistry = config.userRegistry;\n\t\tthis.userRegistry.subscribe(\"userAdded\", this._onUserAdded.bind(this));\n\t\tthis.userRegistry.subscribe(\"userChanged\", this._onUserChanged.bind(this));\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\tusers: {}\n\t\t}\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-messenger-videocall-user-selector-mobile\",\n\t\t\t},\n\t\t});\n\n\t\tthis.updateUsers();\n\n\t\treturn this.elements.root;\n\t};\n\n\trenderUser(userFields)\n\t{\n\t\treturn createSVG(\"svg\", {\n\t\t\tattrNS: {\n\t\t\t\twidth: 14.5, height: 11.6\n\t\t\t},\n\t\t\tstyle: {\n\t\t\t\torder: userFields.order\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tcreateSVG(\"circle\", {\n\t\t\t\t\tattrNS: {\n\t\t\t\t\t\tclass: \"bx-messenger-videocall-user-selector-mobile-border\" + (userFields.talking ? \" talking\" : \"\"),\n\t\t\t\t\t\tcx: 7.25, cy: 5.8, r: 4.6,\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tcreateSVG(\"circle\", {\n\t\t\t\t\tattrNS: {\n\t\t\t\t\t\tclass: \"bx-messenger-videocall-user-selector-mobile-dot\" + (userFields.centralUser ? \" pinned\" : \"\"),\n\t\t\t\t\t\tcx: 7.25, cy: 5.8, r: 3.3\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t};\n\n\tupdateUsers()\n\t{\n\t\tthis.userRegistry.users.forEach(function (userFields)\n\t\t{\n\t\t\tif (userFields.localUser || userFields.state != UserState.Connected)\n\t\t\t{\n\t\t\t\tif (this.elements.users[userFields.id])\n\t\t\t\t{\n\t\t\t\t\tBX.remove(this.elements.users[userFields.id]);\n\t\t\t\t\tthis.elements.users[userFields.id] = null;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tvar newNode = this.renderUser(userFields);\n\t\t\t\tif (this.elements.users[userFields.id])\n\t\t\t\t{\n\t\t\t\t\tBX.replace(this.elements.users[userFields.id], newNode)\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.elements.root.appendChild(newNode)\n\t\t\t\t}\n\t\t\t\tthis.elements.users[userFields.id] = newNode;\n\t\t\t}\n\t\t}, this)\n\t};\n\n\t_onUserAdded(event)\n\t{\n\t\tthis.updateUsers();\n\t};\n\n\t_onUserChanged(event)\n\t{\n\t\tthis.updateUsers();\n\t};\n\n\tmount(parentElement)\n\t{\n\t\tparentElement.appendChild(this.render());\n\t};\n\n\tdismount()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tBX.remove(this.elements.root);\n\t};\n}\n\nexport class MobileSlider\n{\n\tconstructor(config)\n\t{\n\t\tthis.parent = config.parent || null;\n\t\tthis.content = config.content || null;\n\n\t\tthis.elements = {\n\t\t\tbackground: null,\n\t\t\troot: null,\n\t\t\thandle: null,\n\t\t\tbody: null,\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tonClose: BX.prop.getFunction(config, \"onClose\", BX.DoNothing),\n\t\t\tonDestroy: BX.prop.getFunction(config, \"onDestroy\", BX.DoNothing),\n\t\t};\n\n\t\tthis.touchStartY = 0;\n\t\tthis.processedTouchId = 0;\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tthis.elements.background = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-videocall-mobile-menu-background\"\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tclick: this._onBackgroundClick.bind(this)\n\t\t\t}\n\t\t});\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-videocall-mobile-menu-container\"\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tthis.elements.handle = Dom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-videocall-mobile-menu-handle\"\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tthis.elements.body = Dom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-videocall-mobile-menu\"\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.content\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\ttouchstart: this._onTouchStart.bind(this),\n\t\t\t\ttouchmove: this._onTouchMove.bind(this),\n\t\t\t\ttouchend: this._onTouchEnd.bind(this),\n\t\t\t}\n\t\t});\n\n\t\treturn this.elements.root;\n\t};\n\n\tshow()\n\t{\n\t\tif (this.parent)\n\t\t{\n\t\t\tthis.render();\n\t\t\tthis.parent.appendChild(this.elements.root);\n\t\t\tthis.parent.appendChild(this.elements.background);\n\t\t}\n\t};\n\n\tclose()\n\t{\n\t\tBX.remove(this.elements.root);\n\t\tBX.remove(this.elements.background);\n\t\tthis.callbacks.onClose();\n\t};\n\n\tcloseWithAnimation()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.elements.root.classList.add(\"closing\");\n\t\tthis.elements.background.classList.add(\"closing\");\n\t\tthis.elements.root.addEventListener(\"animationend\", function ()\n\t\t{\n\t\t\tthis.close();\n\t\t}.bind(this));\n\t};\n\n\t_onTouchStart(e)\n\t{\n\t\tthis.touchStartY = e.pageY;\n\t\tif (this.processedTouchId || e.touches.length > 1)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (e.target == this.elements.header || e.target == this.elements.root || this.elements.body.scrollTop === 0)\n\t\t{\n\t\t\tthis.processedTouchId = e.touches[0].identifier;\n\t\t}\n\t};\n\n\t_onTouchMove(e)\n\t{\n\t\tif (e.touches.length > 1)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (e.touches[0].identifier != this.processedTouchId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tvar delta = this.touchStartY - e.pageY;\n\t\tif (delta > 0)\n\t\t{\n\t\t\tdelta = 0;\n\t\t}\n\t\tthis.elements.root.style.bottom = delta + \"px\";\n\t\tif (delta)\n\t\t{\n\t\t\te.preventDefault();\n\t\t}\n\t};\n\n\t_onTouchEnd(e)\n\t{\n\t\tvar allowProcessing = false;\n\t\tfor (var i = 0; i < e.changedTouches.length; i++)\n\t\t{\n\t\t\tif (e.changedTouches[i].identifier == this.processedTouchId)\n\t\t\t{\n\t\t\t\tallowProcessing = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (!allowProcessing)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvar delta = e.pageY - this.touchStartY;\n\t\tif (delta > 100)\n\t\t{\n\t\t\tthis.closeWithAnimation();\n\t\t\te.preventDefault();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root.style.removeProperty(\"bottom\");\n\t\t}\n\n\t\tthis.processedTouchId = 0;\n\t\tthis.touchStartY = 0;\n\t};\n\n\tdestroy()\n\t{\n\t\tthis.callbacks.onDestroy();\n\t\tthis.elements = {};\n\t\tthis.callbacks = {};\n\t\tthis.parent = null;\n\t};\n\n\t_onBackgroundClick()\n\t{\n\t\tthis.closeWithAnimation();\n\t};\n}\n\nexport class MobileMenu\n{\n\tconstructor(config)\n\t{\n\t\tthis.parent = config.parent || null;\n\t\tthis.header = BX.prop.getString(config, \"header\", \"\");\n\t\tthis.largeIcons = BX.prop.getBoolean(config, \"largeIcons\", false);\n\n\t\tthis.slider = null;\n\n\t\tvar items = BX.prop.getArray(config, \"items\", []);\n\t\tif (items.length === 0)\n\t\t{\n\t\t\tthrow Error(\"Items array should not be empty\");\n\t\t}\n\n\t\tthis.items = items\n\t\t\t.filter(item => typeof (item) === \"object\" && !!item)\n\t\t\t.map(item => new MobileMenuItem(item))\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\theader: null,\n\t\t\tbody: null\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tonClose: BX.prop.getFunction(config, \"onClose\", BX.DoNothing),\n\t\t\tonDestroy: BX.prop.getFunction(config, \"onDestroy\", BX.DoNothing),\n\t\t};\n\t};\n\n\trender()\n\t{\n\t\tthis.elements.header = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-videocall-mobile-menu-header\"\n\t\t\t},\n\t\t\ttext: this.header\n\t\t});\n\t\tthis.elements.body = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-videocall-mobile-menu-body\" + (this.largeIcons ? \" bx-videocall-mobile-menu-large\" : \"\")\n\t\t\t}\n\t\t});\n\n\t\tthis.items.forEach(item =>\n\t\t{\n\t\t\tif (item)\n\t\t\t{\n\t\t\t\tthis.elements.body.appendChild(item.render());\n\t\t\t}\n\t\t});\n\n\t\treturn BX.createFragment([\n\t\t\tthis.elements.header,\n\t\t\tthis.elements.body\n\t\t]);\n\t};\n\n\tsetHeader(header)\n\t{\n\t\tthis.header = header;\n\t\tif (this.elements.header)\n\t\t{\n\t\t\tthis.elements.header.innerText = header;\n\t\t}\n\t};\n\n\tshow()\n\t{\n\t\tif (!this.slider)\n\t\t{\n\t\t\tthis.slider = new MobileSlider({\n\t\t\t\tparent: this.parent,\n\t\t\t\tcontent: this.render(),\n\t\t\t\tonClose: this.onSliderClose.bind(this),\n\t\t\t\tonDestroy: this.onSliderDestroy.bind(this),\n\t\t\t});\n\t\t}\n\n\t\tthis.slider.show()\n\t};\n\n\tclose()\n\t{\n\t\tif (this.slider)\n\t\t{\n\t\t\tthis.slider.close()\n\t\t}\n\t};\n\n\tonSliderClose()\n\t{\n\t\tthis.slider.destroy();\n\t};\n\n\tonSliderDestroy()\n\t{\n\t\tthis.slider = null;\n\t\tthis.destroy();\n\t};\n\n\tdestroy()\n\t{\n\t\tif (this.slider)\n\t\t{\n\t\t\tthis.slider.destroy();\n\t\t}\n\t\tthis.slider = null;\n\t\tthis.items.forEach(function (item)\n\t\t{\n\t\t\titem.destroy();\n\t\t});\n\t\tthis.items = [];\n\n\t\tthis.callbacks.onDestroy();\n\t\tthis.elements = {};\n\t\tthis.callbacks = {};\n\t\tthis.parent = null;\n\t};\n}\n\nclass MobileMenuItem\n{\n\tconstructor(config)\n\t{\n\t\tthis.id = BX.prop.getString(config, \"id\", Util.getUuidv4());\n\t\tthis.icon = BX.prop.getString(config, \"icon\", \"\");\n\t\tthis.iconClass = BX.prop.getString(config, \"iconClass\", \"\");\n\t\tthis.text = BX.prop.getString(config, \"text\", \"\");\n\t\tthis.showSubMenu = BX.prop.getBoolean(config, \"showSubMenu\", false);\n\t\tthis.separator = BX.prop.getBoolean(config, \"separator\", false);\n\t\tthis.enabled = BX.prop.getBoolean(config, \"enabled\", true);\n\t\tthis.userModel = BX.prop.get(config, \"userModel\", null);\n\t\tthis.avatarBackground = Util.getAvatarBackground();\n\n\t\tif (this.userModel)\n\t\t{\n\t\t\tthis._userChangeHandler = this._onUserChange.bind(this);\n\t\t\tthis.subscribeUserEvents();\n\t\t\tthis.text = this.userModel.name;\n\t\t\tthis.icon = this.userModel.avatar;\n\t\t\tthis.iconClass = \"user-avatar\";\n\t\t\tthis.iconText = Utils.text.getFirstLetters(this.userModel.name);\n\t\t\tthis.iconBackground = Util.getAvatarBackground();\n\t\t}\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\ticon: null,\n\t\t\tcontent: null,\n\t\t\tsubmenu: null,\n\t\t\tseparator: null,\n\t\t\tmic: null,\n\t\t\tcam: null,\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tclick: BX.prop.getFunction(config, \"onClick\", BX.DoNothing),\n\t\t\tclickSubMenu: BX.prop.getFunction(config, \"onClickSubMenu\", BX.DoNothing),\n\t\t};\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tif (this.separator)\n\t\t{\n\t\t\tthis.elements.root = Dom.create(\"hr\", {\n\t\t\t\tprops: {\n\t\t\t\t\tclassName: \"bx-videocall-mobile-menu-item-separator\",\n\t\t\t\t},\n\t\t\t})\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\t\tprops: {\n\t\t\t\t\tclassName: \"bx-videocall-mobile-menu-item\" + (this.enabled ? \"\" : \" disabled\"),\n\t\t\t\t},\n\t\t\t\tchildren: [\n\t\t\t\t\tthis.elements.icon = Dom.create(\"div\", {\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tclassName: \"bx-videocall-mobile-menu-item-icon \" + this.iconClass\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t\tthis.elements.content = Dom.create(\"div\", {\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tclassName: \"bx-videocall-mobile-menu-item-content\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\t\t\ttext: this.text\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t]\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\tclick: this.callbacks.click\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (this.icon != \"\")\n\t\t\t{\n\t\t\t\tthis.elements.icon.style.backgroundImage = \"url(\\\"\" + this.icon + \"\\\")\";\n\t\t\t\tthis.elements.icon.innerText = '';\n\t\t\t}\n\t\t\telse if (this.iconText)\n\t\t\t{\n\t\t\t\tthis.elements.icon.innerText = this.iconText;\n\t\t\t\tthis.elements.root.style.setProperty(\"--avatar-background\", this.avatarBackground);\n\t\t\t}\n\n\t\t\tif (this.showSubMenu)\n\t\t\t{\n\t\t\t\tthis.elements.submenu = Dom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-videocall-mobile-menu-item-submenu-icon\"\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis.elements.root.appendChild(this.elements.submenu);\n\t\t\t}\n\n\t\t\tif (this.userModel)\n\t\t\t{\n\t\t\t\tthis.elements.mic = Dom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-videocall-mobile-menu-icon-user bx-call-view-icon-red-microphone-off\"\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis.elements.cam = Dom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-videocall-mobile-menu-icon-user bx-call-view-icon-red-camera-off\"\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (!this.userModel.cameraState)\n\t\t\t\t{\n\t\t\t\t\tthis.elements.content.prepend(this.elements.cam);\n\t\t\t\t}\n\t\t\t\tif (!this.userModel.microphoneState)\n\t\t\t\t{\n\t\t\t\t\tthis.elements.content.prepend(this.elements.mic);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn this.elements.root;\n\t};\n\n\tupdateUserIcons()\n\t{\n\t\tif (!this.userModel)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.userModel.microphoneState)\n\t\t{\n\t\t\tBX.remove(this.elements.mic);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.content.prepend(this.elements.mic);\n\t\t}\n\t\tif (this.userModel.cameraState)\n\t\t{\n\t\t\tBX.remove(this.elements.cam);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.content.prepend(this.elements.cam);\n\t\t}\n\t};\n\n\tsubscribeUserEvents()\n\t{\n\t\tthis.userModel.subscribe(\"changed\", this._userChangeHandler);\n\t};\n\n\t_onUserChange(event)\n\t{\n\t\tthis.updateUserIcons();\n\t};\n\n\tdestroy()\n\t{\n\t\tif (this.userModel)\n\t\t{\n\t\t\tthis.userModel.unsubscribe(\"changed\", this._userChangeHandler);\n\t\t\tthis.userModel = null;\n\t\t}\n\t\tthis.callbacks = null;\n\t\tthis.elements = null;\n\t};\n}\n","import {Dom, Type} from 'main.core';\nimport {Menu} from 'main.popup';\nimport {UserState, Provider} from '../engine/engine';\nimport {BackgroundDialog} from '../dialogs/background_dialog';\nimport {logPlaybackError} from './tools';\nimport type {UserModel} from './user-registry'\nimport {MediaStreamsKinds} from '../call_api';\nimport Util from '../util';\nimport { Utils } from 'im.v2.lib.utils';\n\ntype CallUserElements = {\n\troot?: HTMLElement,\n\tcontainer?: HTMLElement,\n\tvideoContainer?: HTMLElement,\n\tvideo?: HTMLVideoElement,\n\taudio?: HTMLAudioElement,\n\tscreenAudio?: HTMLAudioElement,\n\tpreview?: HTMLVideoElement,\n\tvideoBorder?: HTMLElement,\n\tavatarContainer?: HTMLElement,\n\tavatar?: HTMLElement,\n\tnameContainer?: HTMLElement,\n\tname?: HTMLElement,\n\tchangeNameIcon?: HTMLElement,\n\tchangeNameContainer?: HTMLElement,\n\tchangeNameCancel?: HTMLElement,\n\tchangeNameInput?: HTMLInputElement,\n\tchangeNameConfirm?: HTMLElement,\n\tchangeNameLoader?: HTMLElement,\n\tintroduceYourselfContainer?: HTMLElement,\n\tfloorRequest?: HTMLElement,\n\tbadNetworkIndicator?: HTMLElement,\n\tstate?: HTMLElement,\n\tremoveButton?: HTMLElement,\n\tmicState?: HTMLElement,\n\tcameraState?: HTMLElement,\n\tpanel?: HTMLElement,\n\tbuttonMenu?: HTMLElement,\n\tremoteParticipantButtonMenu?: HTMLElement,\n\tbuttonBackground?: HTMLElement,\n\tbuttonPin?: HTMLElement,\n\tbuttonUnPin?: HTMLElement,\n\tconnectionProblem?: HTMLElement,\n\tstatsOverlay?: HTMLElement,\n\tconnectionQualityIcon?: HTMLElement,\n}\n\ntype CallUserParams = {\n\tparentContainer: HTMLElement,\n\tuserModel: UserModel,\n\tscreenAudioElement: ?HTMLAudioElement,\n\taudioElement: ?HTMLAudioElement,\n\tallowBackgroundItem: ?boolean,\n\tallowMaskItem: ?boolean,\n\tallowPinButton: ?boolean,\n\tscreenSharingUser: ?boolean,\n\taudioTrack: ?MediaStreamTrack,\n\tscreenAudioTrack: ?MediaStreamTrack,\n\tvideoTrack: ?MediaStreamTrack,\n\n\tonClick: () => void,\n\tonPin: () => void,\n\tonTurnOffParticipantMic: () => void,\n\tonTurnOffParticipantCam: () => void,\n\tonTurnOffParticipantScreenshare: () => void,\n\tonUnPin: () => void,\n\tonUserRename: () => void,\n\tonUserRenameInputFocus: () => void,\n\tonUserRenameInputBlur: () => void,\n\n\tavatarBackground: ?string,\n\talwaysShowName?: boolean;\n\tflipVideo: ?boolean;\n\thiddenFloorRequest: ?boolean;\n\thiddenRemoteParticipantButtonMenu: ?boolean;\n}\n\nexport class CallUser\n{\n\tuserModel: UserModel\n\telements: CallUserElements = {}\n\tmenu: ?Menu\n\tremoteParticipantMenu: ?Menu\n\n\tconstructor(config: CallUserParams = {})\n\t{\n\t\tthis._onUserFieldChangedHandler = this._onUserFieldChanged.bind(this);\n\t\tthis.userModel = config.userModel;\n\t\tthis.userModel.subscribe('changed', this._onUserFieldChangedHandler);\n\t\tthis.parentContainer = config.parentContainer;\n\t\tthis.screenSharingUser = Type.isBoolean(config.screenSharingUser) ? config.screenSharingUser : false;\n\t\tthis.allowBackgroundItem = Type.isBoolean(config.allowBackgroundItem) ? config.allowBackgroundItem : true;\n\t\tthis.allowMaskItem = Type.isBoolean(config.allowMaskItem) ? config.allowMaskItem : true;\n\t\tthis._allowPinButton = Type.isBoolean(config.allowPinButton) ? config.allowPinButton : true;\n\t\tthis._visible = true;\n\t\tthis._audioTrack = config.audioTrack;\n\t\tthis._screenAudioTrack = config.screenAudioTrack;\n\t\tthis._audioStream = this._audioTrack ? new MediaStream([this._audioTrack]) : null;\n\t\tthis._screenAudioStream = this._screenAudioTrack ? new MediaStream([this._screenAudioTrack]) : null;\n\t\tthis._videoTrack = config.videoTrack;\n\t\tthis._stream = this._videoTrack ? new MediaStream([this._videoTrack]) : null;\n\t\tthis._videoRenderer = null;\n\t\tthis._previewRenderer = null;\n\t\tthis._flipVideo = config.flipVideo || false;\n\t\tthis._tracksSubscriptionFailed = {};\n\t\tthis._alwaysShowName = config.alwaysShowName;\n\t\tthis._hiddenFloorRequest = config.hiddenFloorRequest;\n\t\tthis._hiddenRemoteParticipantButtonMenu = config.hiddenRemoteParticipantButtonMenu\n\t\tthis.hidden = false;\n\t\tthis.videoBlurState = false;\n\t\tthis.isChangingName = false;\n\n\t\tthis._badNetworkIndicator = false;\n\n\t\tthis.incomingVideoConstraints = {\n\t\t\twidth: 0, height: 0\n\t\t}\n\t\tif (config.audioElement)\n\t\t{\n\t\t\tthis.elements.audio = config.audioElement;\n\t\t}\n\n\t\tif (config.screenAudioElement)\n\t\t{\n\t\t\tthis.elements.screenAudio = config.screenAudioElement;\n\t\t}\n\n\t\tthis.callBacks = {\n\t\t\tonClick: Type.isFunction(config.onClick) ? config.onClick : BX.DoNothing,\n\t\t\tonUserRename: Type.isFunction(config.onUserRename) ? config.onUserRename : BX.DoNothing,\n\t\t\tonUserRenameInputFocus: Type.isFunction(config.onUserRenameInputFocus) ? config.onUserRenameInputFocus : BX.DoNothing,\n\t\t\tonUserRenameInputBlur: Type.isFunction(config.onUserRenameInputBlur) ? config.onUserRenameInputBlur : BX.DoNothing,\n\t\t\tonPin: Type.isFunction(config.onPin) ? config.onPin : BX.DoNothing,\n\t\t\tonUnPin: Type.isFunction(config.onUnPin) ? config.onUnPin : BX.DoNothing,\n\t\t\tonTurnOffParticipantMic: Type.isFunction(config.onTurnOffParticipantMic) ? config.onTurnOffParticipantMic : BX.DoNothing,\n\t\t\tonTurnOffParticipantCam: Type.isFunction(config.onTurnOffParticipantCam) ? config.onTurnOffParticipantCam : BX.DoNothing,\n\t\t\tonTurnOffParticipantScreenshare: Type.isFunction(config.onTurnOffParticipantScreenshare) ? config.onTurnOffParticipantScreenshare : BX.DoNothing,\n\t\t};\n\t\tthis.checkAspectInterval = setInterval(this.checkVideoAspect.bind(this), 500);\n\n\t\tthis.hintManager = BX.UI.Hint.createInstance({\n\t\t\tpopupParameters: {\n\t\t\t\ttargetContainer: document.body,\n\t\t\t\tclassName: `bx-messenger-videocall-panel-item-hotkey-hint ${this.userModel.id}`,\n\t\t\t\tbindOptions: {forceBindPosition: true}\n\t\t\t}\n\t\t});\n\n\t\tthis.connectionStats = {};\n\t\tthis.connectionStatsVisible = false;\n\n\t\tthis.avatarBackground = config.avatarBackground || Util.getAvatarBackground();\n\n\t\tthis.removeAvatarPulseTimer = null;\n\t\tthis.hideUserNameTimer = null;\n\t};\n\n\tinitUserNameState()\n\t{\n\t\tif (this._alwaysShowName)\n\t\t{\n\t\t\tthis.toggleStateUserName(true);\n\t\t}\n\t}\n\n\tget id()\n\t{\n\t\treturn this.userModel.id\n\t}\n\n\tget allowPinButton()\n\t{\n\t\treturn this._allowPinButton;\n\t}\n\n\tset allowPinButton(allowPinButton)\n\t{\n\t\tif (this._allowPinButton == allowPinButton)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._allowPinButton = allowPinButton;\n\t\tthis.update()\n\t}\n\n\tget audioTrack()\n\t{\n\t\treturn this._audioTrack;\n\t}\n\n\tset audioTrack(audioTrack: ?MediaStreamTrack)\n\t{\n\t\tif (this._audioTrack === audioTrack)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._audioTrack = audioTrack;\n\t\t\n\t\tif (!this._audioTrack)\n\t\t{\n\t\t\tUtil.sendLog({\n\t\t\t\tdescription: 'trying to set not defined audioTrack!',\n\t\t\t\tuserModelId: this.userModel?.id,\n\t\t\t});\n\t\t}\n\t\t\n\t\tthis._audioStream = this._audioTrack ? new MediaStream([this._audioTrack]) : null;\n\t\tthis.playAudio()\n\t}\n\n\tget audioStream()\n\t{\n\t\treturn this._audioStream;\n\t}\n\n\tget screenAudioTrack()\n\t{\n\t\treturn this._screenAudioTrack;\n\t}\n\n\tset screenAudioTrack(screenAudioTrack: ?MediaStreamTrack)\n\t{\n\t\tif (this._screenAudioTrack === screenAudioTrack)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._screenAudioTrack = screenAudioTrack;\n\t\tthis._screenAudioStream = this._screenAudioTrack ? new MediaStream([this._screenAudioTrack]) : null;\n\t\tthis.playScreenAudio()\n\t}\n\n\tget screenAudioStream()\n\t{\n\t\treturn this._screenAudioStream;\n\t}\n\n\tget flipVideo()\n\t{\n\t\treturn this._flipVideo;\n\t}\n\n\tset flipVideo(flipVideo)\n\t{\n\t\tthis._flipVideo = flipVideo;\n\t\tthis.update()\n\t}\n\n\tget stream(): ?MediaStream\n\t{\n\t\treturn this._stream;\n\t}\n\n\tget visible()\n\t{\n\t\treturn this._visible;\n\t}\n\n\tset visible(visible)\n\t{\n\t\tif (this._visible !== visible)\n\t\t{\n\t\t\tthis._visible = visible;\n\t\t\tthis.update();\n\t\t\tthis.updateRendererState();\n\t\t}\n\t}\n\n\tget videoRenderer()\n\t{\n\t\treturn this._videoRenderer;\n\t}\n\n\tset videoRenderer(videoRenderer)\n\t{\n\t\t// we should to reset old video track after switching from a plain call\n\t\t// in order to properly check the camera video in hasCameraVideo\n\t\tif (this._videoTrack)\n\t\t{\n\t\t\tthis._videoTrack = null;\n\t\t}\n\n\t\tif (this._badNetworkIndicator)\n\t\t{\n\t\t\t// Voximplant calls logic with support of streams disabling\n\t\t\tif (videoRenderer.stream)\n\t\t\t{\n\t\t\t\tthis._tempVideoRenderer = videoRenderer;\n\t\t\t\tthis._videoRenderer = null;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis._tempVideoRenderer = this._videoRenderer = null;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// Bitrix calls logic with support of preview\n\t\t\tthis._tempVideoRenderer = null;\n\t\t\tconst currentVideoRendererKind = this._videoRenderer?.kind;\n\t\t\tconst newVideoRendererKind = videoRenderer?.kind;\n\n\t\t\tif (videoRenderer?.stream)\n\t\t\t{\n\t\t\t\tif (newVideoRendererKind === 'sharing' && currentVideoRendererKind === 'video')\n\t\t\t\t{\n\t\t\t\t\tthis._previewRenderer = this._videoRenderer;\n\t\t\t\t\tthis._videoRenderer = videoRenderer;\n\t\t\t\t}\n\t\t\t\telse if (newVideoRendererKind === 'video' && currentVideoRendererKind === 'sharing')\n\t\t\t\t{\n\t\t\t\t\tthis._previewRenderer = videoRenderer;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis._videoRenderer = videoRenderer;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (newVideoRendererKind === 'sharing')\n\t\t\t\t{\n\t\t\t\t\tif (currentVideoRendererKind === 'sharing')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._videoRenderer = this._previewRenderer;\n\t\t\t\t\t}\n\t\t\t\t\tthis._previewRenderer = null;\n\t\t\t\t\tdelete this.connectionStats[MediaStreamsKinds.Screen];\n\t\t\t\t}\n\t\t\t\telse if (newVideoRendererKind === 'video')\n\t\t\t\t{\n\t\t\t\t\tif (currentVideoRendererKind === 'sharing')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._previewRenderer = null;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._videoRenderer = null;\n\t\t\t\t\t}\n\t\t\t\t\tdelete this.connectionStats[MediaStreamsKinds.Camera];\n\t\t\t\t}\n\t\t\t\tthis.showConnectionStats();\n\t\t\t}\n\t\t}\n\n\t\tthis.update();\n\t\tthis.updateRendererState();\n\t}\n\n\tget previewRenderer()\n\t{\n\t\treturn this._previewRenderer;\n\t}\n\n\tget videoTrack()\n\t{\n\t\treturn this._videoTrack;\n\t}\n\n\tset videoTrack(videoTrack: MediaStreamTrack)\n\t{\n\t\tif (this._videoTrack === videoTrack)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._videoTrack = videoTrack;\n\t\tif (this._videoTrack && this._stream)\n\t\t{\n\t\t\tthis._stream.removeTrack(this._stream.getVideoTracks()[0]);\n\t\t\tthis._stream.addTrack(this._videoTrack);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._stream = this._videoTrack ? new MediaStream([this._videoTrack]) : null;\n\t\t}\n\n\t\tthis.update();\n\t}\n\n\tset badNetworkIndicator(badNetworkIndicator)\n\t{\n\t\tif (this._badNetworkIndicator === badNetworkIndicator)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis._badNetworkIndicator = badNetworkIndicator;\n\t\tif (this._badNetworkIndicator)\n\t\t{\n\t\t\tif (this._videoRenderer)\n\t\t\t{\n\t\t\t\tthis._tempVideoRenderer = this._videoRenderer;\n\t\t\t\tthis._videoRenderer = null;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this._tempVideoRenderer)\n\t\t\t{\n\t\t\t\tthis._videoRenderer = this._tempVideoRenderer;\n\t\t\t\tthis._tempVideoRenderer = null;\n\t\t\t}\n\t\t}\n\n\t\tthis.update();\n\t}\n\n\tset hasConnectionProblem(hasConnectionProblem)\n\t{\n\t\tthis._hasConnectionProblem = hasConnectionProblem;\n\t\tif (this._hasConnectionProblem)\n\t\t{\n\t\t\tthis.elements.connectionProblem.classList.add('connection-problem-visible');\n\t\t}\n\t\telse {\n\t\t\tthis.elements.connectionProblem.classList.remove('connection-problem-visible');\n\t\t}\n\t}\n\n\tset connectionQuality(connectionQuality)\n\t{\n\t\tthis._connectionQuality = connectionQuality;\n\n\t\tconst connectionQualityIcons = {\n\t\t\texcellent: '--excellent-quality-icon',\n\t\t\tgood: '--good-quality-icon',\n\t\t\tpoor: '--poor-quality-icon',\n\t\t\tbad: '--bad-quality-icon',\n\t\t}\n\n\t\tif (this._connectionQuality !== undefined && this.elements.connectionQualityIcon)\n\t\t{\n\t\t\tlet resultIcon = connectionQualityIcons.bad;\n\n\t\t\tif (this._connectionQuality >= 4)\n\t\t\t{\n\t\t\t\tresultIcon = connectionQualityIcons.excellent;\n\t\t\t}\n\n\t\t\tif (this._connectionQuality >= 3 && this._connectionQuality < 4)\n\t\t\t{\n\t\t\t\tresultIcon = connectionQualityIcons.good;\n\t\t\t}\n\n\t\t\tif (this._connectionQuality >= 2 && this._connectionQuality < 3)\n\t\t\t{\n\t\t\t\tresultIcon = connectionQualityIcons.poor;\n\t\t\t}\n\n\t\t\tif (this._connectionQuality < 2)\n\t\t\t{\n\t\t\t\tresultIcon = connectionQualityIcons.bad;\n\t\t\t}\n\n\t\t\tthis.elements.connectionQualityIcon.style.setProperty('--connection-quality-icon', `var(${resultIcon})`);\n\t\t}\n\t}\n\n\tisVisibleMediaStateIcon(isActive)\n\t{\n\t\treturn !isActive && this.userModel.state === UserState.Connected;\n\t};\n\n\tisVisibleCameraStateIcon()\n\t{\n\t\treturn this.isVisibleMediaStateIcon(this.userModel.cameraState);\n\t};\n\n\tisVisibleMicStateIcon()\n\t{\n\t\treturn this.isVisibleMediaStateIcon(this.userModel.microphoneState);\n\t};\n\n\tshowStats(stats)\n\t{\n\t\tthis.connectionStats = stats;\n\t\tif (this.elements.statsOverlay && this.connectionStatsVisible)\n\t\t{\n\t\t\tthis.showConnectionStats();\n\t\t}\n\t}\n\n\tshowTrackSubscriptionFailed(track)\n\t{\n\t\tthis._tracksSubscriptionFailed[track.sid] = track;\n\t}\n\n\t_formatFailedSubscribtionTracks()\n\t{\n\t\tlet result = '';\n\n\t\tfor (let track in this._tracksSubscriptionFailed)\n\t\t{\n\t\t\tresult += (this._tracksSubscriptionFailed[track].source + ` ` + track + `\\n`);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\t\tthis.elements.root = Dom.create('div', {\n\t\t\tprops: {className: 'bx-messenger-videocall-user'},\n\t\t\tdataset: {userId: this.userModel.id, order: this.userModel.order},\n\t\t\tchildren: [\n\t\t\t\tthis.elements.videoBorder = Dom.create('div', {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'bx-messenger-videocall-user-border',\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tthis.elements.container = Dom.create('div', {\n\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-inner'},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.elements.avatarContainer = Dom.create('div', {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-avatar-border'},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tthis.elements.avatar = Dom.create('div', {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-avatar'},\n\t\t\t\t\t\t\t\t\ttext: ''\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-avatar-overlay-border'}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-avatar-pulse-element', style: 'animation-delay: -2s;'}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-avatar-pulse-element', style: 'animation-delay: -1.5s;'}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-avatar-pulse-element', style: 'animation-delay: -1s;'}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-avatar-pulse-element', style: 'animation-delay: -0.5s;'}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.panel = Dom.create('div', {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-panel'}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.state = Dom.create('div', {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-status-text'},\n\t\t\t\t\t\t\ttext: this.getStateMessage(this.userModel.state)\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.userBottomContainer = Dom.create('div', {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-bottom'},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tthis.elements.nameContainer = Dom.create('div', {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-name-container' + ((this.userModel.allowRename && !this.userModel.wasRenamed) ? ' hidden' : '')},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tthis.elements.name = Dom.create('span', {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-name', title: (this.screenSharingUser ? BX.message('IM_CALL_USERS_SCREEN').replace('#NAME#', this.userModel.name) : this.userModel.name)},\n\t\t\t\t\t\t\t\t\t\t\ttext: (this.screenSharingUser ? BX.message('IM_CALL_USERS_SCREEN').replace('#NAME#', this.userModel.name) : this.userModel.name),\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tthis.elements.changeNameIcon = Dom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-name-icon bx-messenger-videocall-user-change-name-icon hidden'},\n\t\t\t\t\t\t\t\t\t\t})],\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tclick: this.toggleNameInput.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.changeNameContainer = Dom.create('div', {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-change-name-container hidden'},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tthis.elements.changeNameCancel = Dom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-change-name-cancel'},\n\t\t\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\t\t\tclick: this.toggleNameInput.bind(this)\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tthis.elements.changeNameInput = Dom.create('input', {\n\t\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\t\tclassName: 'bx-messenger-videocall-user-change-name-input'\n\t\t\t\t\t\t\t\t\t\t\t}, attrs: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: 'text', value: this.userModel.name\n\t\t\t\t\t\t\t\t\t\t\t}, events: {\n\t\t\t\t\t\t\t\t\t\t\t\tkeydown: this.onNameInputKeyDown.bind(this),\n\t\t\t\t\t\t\t\t\t\t\t\tfocus: this.callBacks.onUserRenameInputFocus,\n\t\t\t\t\t\t\t\t\t\t\t\tblur: this.callBacks.onUserRenameInputBlur,\n\t\t\t\t\t\t\t\t\t\t\t\tclick: function(event) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tthis.elements.changeNameConfirm = Dom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-change-name-confirm'},\n\t\t\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\t\t\tclick: this.changeName.bind(this)\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tthis.elements.changeNameLoader = Dom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-change-name-loader hidden'},\n\t\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-change-name-loader-icon'}\n\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.introduceYourselfContainer = Dom.create('div', {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-introduce-yourself-container' + (!this.userModel.allowRename || this.userModel.wasRenamed ? ' hidden' : '')},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-introduce-yourself-text'},\n\t\t\t\t\t\t\t\t\t\t\ttext: BX.message('IM_CALL_GUEST_INTRODUCE_YOURSELF'),\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tclick: this.toggleNameInput.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.floorRequest = Dom.create('div', {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-floor-request bx-messenger-videocall-floor-request-icon'}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.statsOverlay = Dom.create('div', {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-stats-overlay'},\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t],\n\t\t\tstyle: {\n\t\t\t\torder: this.userModel.order\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tclick: function (e)\n\t\t\t\t{\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tthis.callBacks.onClick({\n\t\t\t\t\t\tuserId: this.id\n\t\t\t\t\t});\n\t\t\t\t}.bind(this)\n\t\t\t}\n\t\t});\n\n\t\tif (this.userModel.talking)\n\t\t{\n\t\t\tthis.updateAvatarPulseState()\n\t\t}\n\n\t\tthis.elements.debugPanel = Dom.create('div', {\n\t\t\tprops: {className: 'bx-messenger-videocall-user-debug-panel'},\n\t\t\tchildren: [\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'bx-messenger-videocall-user-debug-panel-button connection-stats'\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.elements.connectionQualityIcon = Dom.create('div', {\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tclassName: 'bx-messenger-videocall-user-debug-panel-button-icon connection-quality-icon',\n\t\t\t\t\t\t\t\ttitle: BX.message('IM_M_CALL_CONNECTION_QUALITY_HINT'),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t],\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: e => {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\tthis.connectionStatsVisible = !this.connectionStatsVisible;\n\t\t\t\t\t\t\tif (this.connectionStatsVisible)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.showConnectionStats();\n\t\t\t\t\t\t\t\tthis.elements.statsOverlay.classList.add('stats-overlay-visble');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.elements.statsOverlay.classList.remove('stats-overlay-visble');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tthis.elements.connectionProblem = Dom.create('div', {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'bx-messenger-videocall-user-debug-panel-button connection-problem'\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tclassName: 'bx-messenger-videocall-user-debug-panel-button-icon connection-problem-icon'\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tmouseover: (e) =>\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.hintManager.show(e.currentTarget, BX.message('IM_M_CALL_POOR_CONNECTION_WITH_USER'));\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tmouseout: (e) =>\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.hintManager.hide();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\n\t\tif (this.userModel.localUser)\n\t\t{\n\t\t\tthis.elements.root.classList.add('bx-messenger-videocall-user-self');\n\t\t}\n\n\t\tif (this.userModel.avatar !== '')\n\t\t{\n\t\t\tthis.elements.root.style.setProperty('--avatar', `url('${this.userModel.avatar}')`);\n\t\t\tthis.elements.avatar.innerText = '';\n\t\t\tthis.elements.root.style.removeProperty('--avatar-background');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root.style.removeProperty('--avatar');\n\t\t\tthis.elements.root.style.setProperty('--avatar-background', this.avatarBackground);\n\t\t\tthis.elements.avatar.innerText = this.getAvatarInnerText();\n\t\t}\n\n\t\tthis.elements.videoContainer = Dom.create('div', {\n\t\t\tprops: {\n\t\t\t\tclassName: 'bx-messenger-videocall-video-container',\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tthis.elements.video = Dom.create('video', {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'bx-messenger-videocall-video', volume: 0, autoplay: true\n\t\t\t\t\t},\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tplaysinline: true, muted: true\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'bx-messenger-videocall-preview',\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tclassName: 'bx-messenger-videocall-preview-container',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tthis.elements.preview = Dom.create('video', {\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\tclassName: 'bx-messenger-videocall-preview-video', volume: 0, autoplay: true,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\t\t\t\tplaysinline: true, muted: true\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t]\n\t\t});\n\t\tthis.elements.container.appendChild(this.elements.videoContainer);\n\n\t\tif (this.stream && this.stream.active)\n\t\t{\n\t\t\tthis.elements.video.srcObject = this.stream;\n\t\t}\n\n\t\tif (this.flipVideo)\n\t\t{\n\t\t\tthis.elements.video.classList.add('bx-messenger-videocall-video-flipped');\n\t\t}\n\t\tif (this.userModel.screenState)\n\t\t{\n\t\t\tthis.elements.video.classList.add('bx-messenger-videocall-video-contain');\n\t\t}\n\n\t\tif (this.isVisibleCameraStateIcon() && this.isVisibleMicStateIcon())\n\t\t{\n\t\t\tthis.elements.nameContainer.classList.add('extra-padding');\n\t\t}\n\n\t\t//this.elements.nameContainer.appendChild(this.elements.micState);\n\n\t\t// todo: show button only if user have the permission to remove user\n\t\t/*this.elements.removeButton = Dom.create('div', {\n\t\t\tprops: {className: 'bx-messenger-videocall-user-close'}\n\t\t});\n\n\t\tthis.elements.container.appendChild(this.elements.removeButton);*/\n\n\t\tthis.elements.buttonBackground = Dom.create('div', {\n\t\t\tprops: {\n\t\t\t\tclassName: 'bx-messenger-videocall-user-panel-button'\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'bx-messenger-videocall-user-panel-button-icon background'\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'bx-messenger-videocall-user-panel-button-text'\n\t\t\t\t\t},\n\t\t\t\t\ttext: BX.message('IM_CALL_CHANGE_BACKGROUND')\n\t\t\t\t})\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: e => {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tBackgroundDialog.open();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.elements.buttonMenu = Dom.create('div', {\n\t\t\tprops: {\n\t\t\t\tclassName: 'bx-messenger-videocall-user-panel-button'\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'bx-messenger-videocall-user-panel-button-icon menu'\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: e => {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tthis.showMenu();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (!this._hiddenRemoteParticipantButtonMenu)\n\t\t{\n\t\t\tthis.elements.remoteParticipantButtonMenu = Dom.create('div', {\n\t\t\t\tprops: {\n\t\t\t\t\tclassName: 'bx-messenger-videocall-user-panel-button'\n\t\t\t\t},\n\t\t\t\tchildren: [\n\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tclassName: 'bx-messenger-videocall-user-panel-button-icon menu'\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\tclick: e => {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\tthis.showRemoteParticipantMenu();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tthis.elements.buttonPin = Dom.create('div', {\n\t\t\tprops: {\n\t\t\t\tclassName: 'bx-messenger-videocall-user-panel-button'\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'bx-messenger-videocall-user-panel-button-icon pin'\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'bx-messenger-videocall-user-panel-button-text'\n\t\t\t\t\t}, text: BX.message('IM_CALL_PIN')\n\t\t\t\t})\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: (e) =>\n\t\t\t\t{\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tthis.callBacks.onPin({userId: this.userModel.id});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.elements.buttonUnPin = Dom.create('div', {\n\t\t\tprops: {\n\t\t\t\tclassName: 'bx-messenger-videocall-user-panel-button'\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'bx-messenger-videocall-user-panel-button-icon unpin'\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'bx-messenger-videocall-user-panel-button-text'\n\t\t\t\t\t},\n\t\t\t\t\ttext: BX.message('IM_CALL_UNPIN')\n\t\t\t\t})\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick:  (e) =>\n\t\t\t\t{\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tthis.callBacks.onUnPin();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.elements.userBottomContainer.appendChild(\n\t\t\tDom.create('div', {\n\t\t\t\tprops: {className: 'bx-messenger-videocall-user-device-state-container'},\n\t\t\t\tchildren: [\n\t\t\t\t\tthis.elements.cameraState = Dom.create('div', {\n\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-name-icon bx-messenger-videocall-user-device-state camera' + (!this.isVisibleCameraStateIcon() ? ' hidden' : '')},\n\t\t\t\t\t}),\n\t\t\t\t\tthis.elements.micState = Dom.create('div', {\n\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-name-icon bx-messenger-videocall-user-device-state mic' + (!this.isVisibleMicStateIcon() ? ' hidden' : '')},\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t}),\n\t\t);\n\n\t\tthis.updatePanelDeferred();\n\t\treturn this.elements.root;\n\t};\n\n\tshowConnectionStats()\n\t{\n\t\tif (!this.elements.statsOverlay)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet statsString = '';\n\n\t\tconst cameraStats = this.connectionStats?.[MediaStreamsKinds.Camera];\n\t\tconst screenStats = this.connectionStats?.[MediaStreamsKinds.Screen];\n\t\tconst audioStats = this.connectionStats?.[MediaStreamsKinds.Microphone];\n\n\t\tconst failedTracksResult = this._formatFailedSubscribtionTracks();\n\n\t\tif (failedTracksResult)\n\t\t{\n\t\t\tstatsString += `Failed subscribe to:\\n`;\n\t\t\tstatsString += failedTracksResult;\n\t\t}\n\n\n\t\tif (cameraStats || !screenStats)\n\t\t{\n\t\t\tstatsString += `Video stats:\\n`;\n\t\t\tstatsString += this._formatVideoStats(cameraStats);\n\t\t}\n\n\t\tif (screenStats)\n\t\t{\n\t\t\tif (screenStats)\n\t\t\t{\n\t\t\t\tstatsString += `\\n\\n`;\n\t\t\t}\n\n\t\t\tstatsString += `Screen share stats:\\n`;\n\t\t\tstatsString += this._formatVideoStats(screenStats);\n\t\t}\n\n\t\tif (audioStats)\n\t\t{\n\t\t\tif (cameraStats || screenStats)\n\t\t\t{\n\t\t\t\tstatsString += `\\n\\n`;\n\t\t\t}\n\n\t\t\tstatsString += `Audio stats:\\n`;\n\t\t\tstatsString += `Bitrate: ${audioStats?.bitrate || 0}\\n`;\n\t\t\tstatsString += `PacketsLost: ${audioStats?.packetsLostExtended || 0}\\n`;\n\t\t\tstatsString += `Codec: ${audioStats?.codecName || '-'}`;\n\t\t}\n\n\t\tthis.elements.statsOverlay.innerText = statsString;\n\t}\n\n\tsetIncomingVideoConstraints(width, height)\n\t{\n\t\tthis.incomingVideoConstraints.width = typeof (width) === 'undefined' ? this.incomingVideoConstraints.width : width;\n\t\tthis.incomingVideoConstraints.height = typeof (height) === 'undefined' ? this.incomingVideoConstraints.height : height;\n\n\t\tif (!this.videoRenderer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// vox low quality temporary workaround\n\t\t// (disabled to test quality)\n\t\t// if (this.incomingVideoConstraints.width >= 320 && this.incomingVideoConstraints.width <= 640)\n\t\t// {\n\t\t// \tthis.incomingVideoConstraints.width = 640;\n\t\t// }\n\t\t// if (this.incomingVideoConstraints.height >= 180 && this.incomingVideoConstraints.height <= 360)\n\t\t// {\n\t\t// \tthis.incomingVideoConstraints.height = 360;\n\t\t// }\n\n\t\tthis.videoRenderer.requestVideoSize(this.incomingVideoConstraints.width, this.incomingVideoConstraints.height);\n\t};\n\n\tupdateRendererState()\n\t{\n\t\t/*if (this.videoRenderer)\n\t\t{\n\t\t\tif (this.visible)\n\t\t\t{\n\t\t\t\tthis.videoRenderer.enable();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.videoRenderer.disable();\n\t\t\t}\n\t\t}*/\n\n\t\t/*if (this.elements.video && this.elements.video.srcObject)\n\t\t{\n\t\t\tif (this.visible)\n\t\t\t{\n\t\t\t\tthis.elements.video.play();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.elements.video.pause();\n\t\t\t}\n\t\t}*/\n\t};\n\n\t_onUserFieldChanged(event)\n\t{\n\t\tconst eventData = event.data;\n\n\t\tswitch (eventData.fieldName)\n\t\t{\n\t\t\tcase 'id':\n\t\t\t\treturn this.updateId();\n\t\t\tcase 'name':\n\t\t\t\treturn this.updateName();\n\t\t\tcase 'avatar':\n\t\t\t\treturn this.updateAvatar();\n\t\t\tcase 'state':\n\t\t\t\treturn this.updateState();\n\t\t\tcase 'talking':\n\t\t\t\treturn this.updateTalking();\n\t\t\tcase 'microphoneState':\n\t\t\t\treturn this.updateMicrophoneState();\n\t\t\tcase 'cameraState':\n\t\t\t\treturn this.updateCameraState();\n\t\t\tcase 'videoPaused':\n\t\t\t\treturn this.updateVideoPaused();\n\t\t\tcase 'floorRequestState':\n\t\t\t\treturn this.updateFloorRequestState();\n\t\t\tcase 'screenState':\n\t\t\t\treturn this.updateScreenState();\n\t\t\tcase 'pinned':\n\t\t\t\treturn this.updatePanel();\n\t\t\tcase 'allowRename':\n\t\t\t\treturn this.updateRenameAllowed();\n\t\t\tcase 'wasRenamed':\n\t\t\t\treturn this.updateWasRenamed();\n\t\t\tcase 'renameRequested':\n\t\t\t\treturn this.updateRenameRequested();\n\t\t\tcase 'order':\n\t\t\t\treturn this.updateOrder();\n\n\t\t}\n\t};\n\n\ttoggleRenameIcon()\n\t{\n\t\tif (!this.userModel.allowRename)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.elements.changeNameIcon.classList.toggle('hidden');\n\t};\n\n\ttoggleNameInput(event)\n\t{\n\t\tif (!this.userModel.allowRename || !this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tevent.stopPropagation();\n\n\t\tif (this.isChangingName)\n\t\t{\n\t\t\tthis.isChangingName = false;\n\t\t\tif (!this.userModel.wasRenamed)\n\t\t\t{\n\t\t\t\tthis.elements.introduceYourselfContainer.classList.remove('hidden');\n\t\t\t\tthis.elements.changeNameContainer.classList.add('hidden');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.elements.changeNameContainer.classList.add('hidden');\n\t\t\t\tthis.elements.nameContainer.classList.remove('hidden');\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (!this.userModel.wasRenamed)\n\t\t\t{\n\t\t\t\tthis.elements.introduceYourselfContainer.classList.add('hidden');\n\t\t\t}\n\t\t\tthis.isChangingName = true;\n\t\t\tthis.elements.nameContainer.classList.add('hidden');\n\t\t\tthis.elements.changeNameContainer.classList.remove('hidden');\n\t\t\tthis.elements.changeNameInput.value = this.userModel.name;\n\t\t\tthis.elements.changeNameInput.focus();\n\t\t\tthis.elements.changeNameInput.select();\n\t\t}\n\t};\n\n\tonNameInputKeyDown(event)\n\t{\n\t\tif (!this.userModel.allowRename)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t//enter\n\t\tif (event.keyCode === 13)\n\t\t{\n\t\t\tthis.changeName(event);\n\t\t}\n\t\t//escape\n\t\telse if (event.keyCode === 27)\n\t\t{\n\t\t\tthis.toggleNameInput(event);\n\t\t}\n\t};\n\n\tonNameInputFocus(event)\n\t{\n\n\t};\n\n\tonNameInputBlur(event)\n\t{\n\n\t};\n\n\tchangeName(event)\n\t{\n\t\tevent.stopPropagation();\n\n\t\tconst inputValue = this.elements.changeNameInput.value;\n\t\tconst newName = inputValue.trim();\n\t\tlet needToUpdate = true;\n\t\tif (newName === this.userModel.name || newName === '')\n\t\t{\n\t\t\tneedToUpdate = false;\n\t\t}\n\n\t\tif (needToUpdate)\n\t\t{\n\t\t\tthis.elements.changeNameConfirm.classList.toggle('hidden');\n\t\t\tthis.elements.changeNameLoader.classList.toggle('hidden');\n\t\t\tthis.callBacks.onUserRename(newName);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.toggleNameInput(event);\n\t\t}\n\t};\n\n\tshowMenu()\n\t{\n\t\tconst menuItems = [];\n\n\t\tif (this.userModel.localUser && this.allowBackgroundItem)\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\ttext: (this.allowMaskItem ? BX.message('IM_CALL_CHANGE_BG_MASK') : BX.message('IM_CALL_CHANGE_BACKGROUND')),\n\t\t\t\tonclick: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.menu.close();\n\t\t\t\t\tBackgroundDialog.open();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tif (menuItems.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet rect = Dom.getRelativePosition(this.elements.buttonMenu, this.parentContainer)\n\t\tthis.menu = new Menu({\n\t\t\tid: 'call-view-user-menu-' + this.userModel.id,\n\t\t\tbindElement: {\n\t\t\t\tleft: rect.left,\n\t\t\t\ttop: rect.top,\n\t\t\t\tbottom: rect.bottom\n\t\t\t},\n\t\t\titems: menuItems,\n\t\t\ttargetContainer: this.parentContainer,\n\t\t\tautoHide: true,\n\t\t\tcloseByEsc: true,\n\t\t\toffsetTop: 0,\n\t\t\toffsetLeft: 0,\n\t\t\tbindOptions: {\n\t\t\t\tposition: 'bottom'\n\t\t\t},\n\t\t\tangle: true,\n\t\t\toverlay: {\n\t\t\t\tbackgroundColor: 'white', opacity: 0\n\t\t\t},\n\t\t\tcacheable: false,\n\t\t\tevents: {\n\t\t\t\tonPopupDestroy: () => this.menu = null\n\t\t\t}\n\t\t});\n\t\tthis.menu.show();\n\t};\n\n\tshowRemoteParticipantMenu()\n\t{\n\t\tif\t(this.remoteParticipantMenu)\n\t\t{\n\t\t\tthis.remoteParticipantMenu.destroy();\n\t\t\tthis.remoteParticipantMenu = null;\n\t\t}\n\n\t\tconst menuItems = [];\n\n\t\tif (!this.userModel.localUser)\n\t\t{\n\t\t\tif (this.userModel.microphoneState)\n\t\t\t{\n\t\t\t\tmenuItems.push({\n\t\t\t\t\ttext: BX.message('CALL_REMOTE_USER_DROPDOWN_MENU_TURN_OFF_MIC'),\n\t\t\t\t\tclassName: 'bx-call-remote-user-turn-off-mic',\n\t\t\t\t\tdisabled: !this.userModel.microphoneState,\n\t\t\t\t\tonclick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.remoteParticipantMenu.destroy();\n\t\t\t\t\t\tthis.callBacks.onTurnOffParticipantMic({userId: this.userModel.id});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (this.userModel.cameraState)\n\t\t\t{\n\t\t\t\tmenuItems.push({\n\t\t\t\t\ttext: BX.message('CALL_REMOTE_USER_DROPDOWN_MENU_TURN_OFF_CAM'),\n\t\t\t\t\tclassName: 'bx-call-remote-user-turn-off-cam',\n\t\t\t\t\tdisabled: !this.userModel.cameraState,\n\t\t\t\t\tonclick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.remoteParticipantMenu.destroy();\n\t\t\t\t\t\tthis.callBacks.onTurnOffParticipantCam({userId: this.userModel.id});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (this.userModel.screenState)\n\t\t\t{\n\t\t\t\tmenuItems.push({\n\t\t\t\t\ttext: BX.message('CALL_REMOTE_USER_DROPDOWN_MENU_TURN_OFF_SCREENSHARE'),\n\t\t\t\t\tclassName: 'bx-call-remote-user-turn-off-screenshare',\n\t\t\t\t\tdisabled: !this.userModel.screenState,\n\t\t\t\t\tonclick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.remoteParticipantMenu.destroy();\n\t\t\t\t\t\tthis.callBacks.onTurnOffParticipantScreenshare({userId: this.userModel.id});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tif (menuItems.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet rect = Dom.getRelativePosition(this.elements.remoteParticipantButtonMenu, this.parentContainer);\n\n\t\tthis.remoteParticipantMenu = new Menu({\n\t\t\tid: 'call-view-user-menu-' + this.userModel.id,\n\t\t\tclassName: 'bx-call-remote-user-menu-container',\n\t\t\tbindElement: {\n\t\t\t\tleft: rect.left,\n\t\t\t\ttop: rect.top,\n\t\t\t\tbottom: rect.bottom\n\t\t\t},\n\t\t\titems: menuItems,\n\t\t\ttargetContainer: this.parentContainer,\n\t\t\tdarkMode: true,\n\t\t\tautoHide: true,\n\t\t\tcloseByEsc: true,\n\t\t\tangle: true,\n\t\t\toffsetTop: 0,\n\t\t\tbindOptions: {\n\t\t\t\tposition: 'bottom'\n\t\t\t},\n\t\t\toverlay: {\n\t\t\t\tbackgroundColor: 'white', opacity: 0\n\t\t\t},\n\t\t\tcacheable: false,\n\t\t\tevents: {\n\t\t\t\tonShow: (event) =>\n\t\t\t\t{\n\t\t\t\t\tconst popup = event.getTarget();\n\t\t\t\t\tpopup.adjustPosition();\n\n\t\t\t\t\tthis.elements.root.classList.add('bx-messenger-videocall-user-dropdown-menu-opened');\n\t\t\t\t},\n\t\t\t\tonPopupDestroy: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.elements.root.classList.remove('bx-messenger-videocall-user-dropdown-menu-opened');\n\t\t\t\t\tthis.remoteParticipantMenu = null;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.remoteParticipantMenu.show();\n\t};\n\n\tupdateAvatar()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\tif (this.userModel.avatar !== '')\n\t\t\t{\n\t\t\t\tthis.elements.root.style.setProperty('--avatar', `url('${this.userModel.avatar}')`);\n\t\t\t\tthis.elements.avatar.innerText = '';\n\t\t\t\tthis.elements.root.style.removeProperty('--avatar-background');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.elements.root.style.removeProperty('--avatar');\n\t\t\t\tthis.elements.root.style.setProperty('--avatar-background', this.avatarBackground);\n\t\t\t\tthis.elements.avatar.innerText = this.getAvatarInnerText();\n\t\t\t}\n\t\t}\n\t};\n\n\tupdateId()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\tthis.elements.root.dataset.userId = this.userModel.id;\n\t\t}\n\t};\n\n\tupdateName()\n\t{\n\t\tif (this.isChangingName)\n\t\t{\n\t\t\tthis.isChangingName = false;\n\t\t\tthis.elements.changeNameConfirm.classList.toggle('hidden');\n\t\t\tthis.elements.changeNameLoader.classList.toggle('hidden');\n\t\t\tthis.elements.changeNameContainer.classList.add('hidden');\n\t\t\tthis.elements.nameContainer.classList.remove('hidden');\n\t\t}\n\n\t\tif (this.elements.name)\n\t\t{\n\t\t\tthis.elements.name.innerText = this.screenSharingUser ? BX.message('IM_CALL_USERS_SCREEN').replace('#NAME#', this.userModel.name) : this.userModel.name;\n\t\t}\n\t\tif (this.userModel.avatar === '' && this.elements.avatar)\n\t\t{\n\t\t\tthis.elements.avatar.innerText = this.getAvatarInnerText();\n\t\t}\n\n\t};\n\n\tgetAvatarInnerText()\n\t{\n\t\treturn Utils.text.getFirstLetters(this.userModel.name).toUpperCase();\n\t}\n\n\tupdateRenameAllowed()\n\t{\n\t\tif (this.userModel.allowRename && this.elements.nameContainer && this.elements.introduceYourselfContainer)\n\t\t{\n\t\t\tthis.elements.nameContainer.classList.add('hidden');\n\t\t\tthis.elements.introduceYourselfContainer.classList.remove('hidden');\n\t\t}\n\t};\n\n\tupdateWasRenamed()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.userModel.allowRename)\n\t\t{\n\t\t\tthis.elements.introduceYourselfContainer.classList.add('hidden');\n\t\t\tthis.elements.changeNameIcon.classList.remove('hidden');\n\t\t\tif (this.elements.changeNameContainer.classList.contains('hidden'))\n\t\t\t{\n\t\t\t\tthis.elements.nameContainer.classList.remove('hidden');\n\t\t\t}\n\t\t}\n\t};\n\n\tupdateRenameRequested()\n\t{\n\t\tif (this.userModel.allowRename)\n\t\t{\n\t\t\tthis.elements.introduceYourselfContainer.classList.add('hidden');\n\t\t}\n\t};\n\n\tupdateOrder()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\tthis.elements.root.dataset.order = this.userModel.order;\n\t\t\tthis.elements.root.style.order = this.userModel.order;\n\t\t}\n\t};\n\n\tupdatePanelDeferred()\n\t{\n\t\tsetTimeout(this.updatePanel.bind(this), 0);\n\t};\n\n\tupdatePanel()\n\t{\n\t\tif (!this.isMounted())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst width = this.elements.root.offsetWidth;\n\t\tconst initialUpdate = !this.elements.panel.hasChildNodes();\n\n\t\tif (this.lastWIdth && this.lastWIdth === width && !initialUpdate)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst canChangeBackground = this.userModel.localUser && this.allowBackgroundItem;\n\t\tconst needChangeBackgroundButton = this.lastWIdth\n\t\t\t|| (this.lastWIdth <= 300 && width > 300)\n\t\t\t|| (this.lastWIdth > 300 && width <= 300);\n\t\tconst needChangePinButton = this.userModel.pinned && Boolean(this.elements.buttonPin.parentElement);\n\t\tconst needChangeUnPinButton = !this.userModel.pinned && Boolean(this.elements.buttonUnPin.parentElement);\n\t\tconst needToUpdate = initialUpdate\n\t\t\t|| (canChangeBackground && needChangeBackgroundButton)\n\t\t\t|| needChangePinButton\n\t\t\t|| needChangeUnPinButton;\n\n\t\tthis.lastWIdth = width;\n\n\t\tif (needToUpdate)\n\t\t{\n\t\t\tDom.clean(this.elements.panel);\n\t\t}\n\n\t\tif (canChangeBackground && (needChangeBackgroundButton || initialUpdate))\n\t\t{\n\t\t\tif (width > 300)\n\t\t\t{\n\t\t\t\tDom.append(this.elements.buttonBackground, this.elements.panel);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.append(this.elements.buttonMenu, this.elements.panel);\n\t\t\t}\n\t\t}\n\n\t\tif (this.allowPinButton)\n\t\t{\n\t\t\tif (initialUpdate || needChangePinButton || needChangeUnPinButton)\n\t\t\t{\n\t\t\t\tif (this.userModel.pinned)\n\t\t\t\t{\n\t\t\t\t\tDom.append(this.elements.buttonUnPin, this.elements.panel);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tDom.append(this.elements.buttonPin, this.elements.panel);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (width > 250)\n\t\t\t{\n\t\t\t\tthis.elements.buttonPin.classList.remove('no-text');\n\t\t\t\tthis.elements.buttonUnPin.classList.remove('no-text');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.elements.buttonPin.classList.add('no-text');\n\t\t\t\tthis.elements.buttonUnPin.classList.add('no-text');\n\t\t\t}\n\t\t}\n\n\t\tif (!this.userModel.localUser)\n\t\t{\n\t\t\tthis.currentBitrixCall = Util.getCurrentBitrixCall();\n\n\t\t\tthis.isShowRemoteParticipantButtonMenu =\n\t\t\t\tUtil.isUserControlFeatureEnabled()\n\t\t\t\t&& Util.canControlChangeSettings()\n\t\t\t\t&& (this.userModel.microphoneState || this.userModel.cameraState || this.userModel.screenState)\n\t\t\t\t&& this.currentBitrixCall\n\t\t\t\t&& this.currentBitrixCall.provider !== Provider.Plain;\n\t\t\t//&& !(this.currentBitrixCall.associatedEntity.type === 'chat' && this.currentBitrixCall.associatedEntity.advanced['chatType'] === 'videoconf');\n\n\t\t\tif (this.isShowRemoteParticipantButtonMenu && this.elements.remoteParticipantButtonMenu)\n\t\t\t{\n\t\t\t\tthis.elements.panel.appendChild(this.elements.remoteParticipantButtonMenu);\n\t\t\t}\n\t\t}\n\t};\n\n\tplayVideoElements(videoElement)\n\t{\n\t\tconst hasVideoEl = Boolean(videoElement);\n\t\tconst isCanPlaying = hasVideoEl && Boolean(videoElement.srcObject);\n\t\tconst isReadyPlaying = hasVideoEl && videoElement.readyState >= videoElement.HAVE_CURRENT_DATA;\n\t\tconst isEnded = hasVideoEl && videoElement.ended;\n\n\t\tif (isCanPlaying && isReadyPlaying && !isEnded)\n\t\t{\n\t\t\tvideoElement.play().catch(logPlaybackError);\n\t\t}\n\n\t\tif (isCanPlaying && isEnded)\n\t\t{\n\t\t\tvideoElement.load();\n\t\t}\n\n\t\tif (isCanPlaying && !isReadyPlaying && !isEnded && !videoElement.onloadeddata)\n\t\t{\n\t\t\tvideoElement.onloadeddata = () => {\n\t\t\t\tthis.playVideoElements(videoElement);\n\t\t\t};\n\t\t}\n\t}\n\n\tupdate()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.hasVideo()/* && this.visible*/)\n\t\t{\n\t\t\tif (this.visible)\n\t\t\t{\n\t\t\t\tif (this.videoRenderer)\n\t\t\t\t{\n\t\t\t\t\tthis.videoRenderer.render(this.elements.video);\n\t\t\t\t\tthis.playVideoElements(this.elements.video);\n\t\t\t\t\tif (this._previewRenderer)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._previewRenderer.render(this.elements.preview);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.elements.preview.srcObject = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (this.stream && this.elements.video.srcObject?.id !== this.stream?.id)\n\t\t\t\t{\n\t\t\t\t\tthis.elements.video.srcObject = this.stream;\n\t\t\t\t\tthis.playVideoElements(this.elements.video);\n\t\t\t\t}\n\n\t\t\t\tif (this.elements.avatarContainer)\n\t\t\t\t{\n\t\t\t\t\tthis.elements.avatarContainer.classList.add('bx-messenger-videocall-hidden-avatar');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.videoRenderer?.kind === 'video' && this.flipVideo)\n\t\t\t{\n\t\t\t\tthis.elements.video.classList.toggle('bx-messenger-videocall-video-flipped', this.flipVideo);\n\t\t\t\tthis.elements.preview.classList.toggle('bx-messenger-videocall-video-flipped', !this.flipVideo);\n\t\t\t}\n\t\t\telse if (this.videoRenderer?.kind === 'sharing' && this.flipVideo)\n\t\t\t{\n\t\t\t\tthis.elements.video.classList.toggle('bx-messenger-videocall-video-flipped', !this.flipVideo);\n\t\t\t\tthis.elements.preview.classList.toggle('bx-messenger-videocall-video-flipped', this.flipVideo);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.elements.video.classList.toggle('bx-messenger-videocall-video-flipped', this.flipVideo);\n\t\t\t}\n\t\t\tthis.elements.video.classList.toggle('bx-messenger-videocall-video-contain', this.userModel.screenState);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.video.srcObject = null;\n\t\t\tthis.elements.preview.srcObject = null;\n\t\t\tif (this.elements.avatarContainer)\n\t\t\t{\n\t\t\t\tthis.elements.avatarContainer.classList.remove('bx-messenger-videocall-hidden-avatar');\n\t\t\t}\n\t\t}\n\t\tif (\n\t\t\tUtil.isCallServerAllowed()\n\t\t\t&& this.userModel.state === UserState.Connected\n\t\t\t&& !this.elements.debugPanel.parentElement\n\t\t\t&& !this.screenSharingUser\n\t\t)\n\t\t{\n\t\t\tthis.elements.container.appendChild(this.elements.debugPanel);\n\t\t}\n\t\tthis.updatePanelDeferred();\n\t};\n\n\tplayAudio()\n\t{\n\t\tif (!this.audioStream)\n\t\t{\t\t\t\n\t\t\tthis.elements.audio.srcObject = null;\n\t\t\t\n\t\t\tUtil.sendLog({\n\t\t\t\tdescription: 'no audioStream to play',\n\t\t\t\tuserModelId: this.userModel?.id,\n\t\t\t});\n\t\t\t\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.speakerId && Type.isFunction(this.elements.audio.setSinkId))\n\t\t{\n\t\t\tthis.elements.audio.setSinkId(this.speakerId).then(function ()\n\t\t\t{\n\t\t\t\tthis.elements.audio.srcObject = this.audioStream;\n\t\t\t\tthis.elements.audio.play().catch(logPlaybackError);\n\t\t\t}.bind(this)).catch(console.error);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.audio.srcObject = this.audioStream;\n\t\t\tthis.elements.audio.play().catch(logPlaybackError);\n\t\t}\n\t};\n\n\tplayScreenAudio()\n\t{\n\t\tif (!this.screenAudioStream)\n\t\t{\n\t\t\tthis.elements.screenAudio.srcObject = null;\n\t\t\treturn;\n\t\t}\n\n\t\tthis.elements.screenAudio.srcObject = this.screenAudioStream;\n\t\tthis.elements.screenAudio.play().catch(logPlaybackError);\n\t}\n\n\tplayVideo()\n\t{\n\t\tthis.playVideoElements(this.elements.video);\n\t\tthis.playVideoElements(this.elements.preview);\n\t};\n\n\tblurVideo(blurState)\n\t{\n\t\tblurState = !!blurState;\n\n\t\tif (this.videoBlurState == blurState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.videoBlurState = blurState;\n\t\tif (this.elements.video)\n\t\t{\n\t\t\tthis.elements.video.classList.toggle('bx-messenger-videocall-video-blurred');\n\t\t}\n\t};\n\n\tgetStateMessage(userState, videoPaused)\n\t{\n\t\tswitch (userState)\n\t\t{\n\t\t\tcase UserState.Idle:\n\t\t\t\treturn '';\n\t\t\tcase UserState.Calling:\n\t\t\t\treturn BX.message('IM_M_CALL_STATUS_WAIT_ANSWER');\n\t\t\tcase UserState.Declined:\n\t\t\t\treturn BX.message('IM_M_CALL_STATUS_DECLINED');\n\t\t\tcase UserState.Ready:\n\t\t\tcase UserState.Connecting:\n\t\t\t\treturn BX.message('IM_M_CALL_STATUS_WAIT_CONNECT');\n\t\t\tcase UserState.Connected:\n\t\t\t\treturn videoPaused ? BX.message('IM_M_CALL_STATUS_VIDEO_PAUSED') : '';\n\t\t\tcase UserState.Failed:\n\t\t\t\treturn BX.message('IM_M_CALL_STATUS_CONNECTION_ERROR');\n\t\t\tcase UserState.Unavailable:\n\t\t\t\treturn BX.message('IM_M_CALL_STATUS_UNAVAILABLE');\n\t\t\tdefault:\n\t\t\t\treturn '';\n\t\t}\n\t};\n\n\n\tmount(parent, force)\n\t{\n\t\tforce = force === true;\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\tthis.render();\n\t\t\tthis.initUserNameState();\n\t\t}\n\n\t\tif (this.isMounted() && this.elements.root.parentElement == parent && !force)\n\t\t{\n\t\t\tthis.updatePanelDeferred();\n\t\t\treturn false;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.checkAspectInterval = setInterval(this.checkVideoAspect.bind(this), 500);\n\t\t}\n\n\t\tparent.appendChild(this.elements.root);\n\t\tthis.update();\n\t};\n\n\tdismount()\n\t{\n\t\t// this.visible = false;\n\t\tif (!this.isMounted())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tclearInterval(this.checkAspectInterval);\n\t\tthis.elements.video.srcObject = null;\n\t\tthis.elements.preview.srcObject = null;\n\t\tDom.remove(this.elements.root);\n\t};\n\n\tisMounted()\n\t{\n\t\treturn !!(this.elements.root && this.elements.root.parentElement);\n\t};\n\n\tupdateState()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.userModel.state == UserState.Calling || this.userModel.state == UserState.Connecting)\n\t\t{\n\t\t\tthis.updateAvatarPulseState();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.addAvatarPulseTimer();\n\t\t}\n\n\t\tif (this.userModel.state == UserState.Idle)\n\t\t{\n\t\t\tthis._videoRenderer = null;\n\t\t\tthis._previewRenderer = null;\n\t\t\tthis._audioTrack = null;\n\t\t\tthis._audioStream = null;\n\t\t}\n\n\t\tthis.elements.state.innerText = this.getStateMessage(this.userModel.state, this.userModel.videoPaused);\n\n\t\tthis.updateMicrophoneState()\n\t\tthis.updateCameraState()\n\n\t\tthis.update();\n\t};\n\n\tupdateTalking()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.userModel.talking)\n\t\t{\n\t\t\tthis.updateAvatarPulseState();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.addAvatarPulseTimer();\n\t\t}\n\t};\n\n\tupdateMicrophoneState()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!this.isVisibleMicStateIcon())\n\t\t{\n\t\t\tthis.elements.micState.classList.add('hidden');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.micState.classList.remove('hidden');\n\t\t\tthis.clearAvatarPulseTimer();\n\t\t}\n\n\t\tif (this.isVisibleCameraStateIcon() && this.isVisibleMicStateIcon())\n\t\t{\n\t\t\tthis.elements.nameContainer.classList.add('extra-padding');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.nameContainer.classList.remove('extra-padding');\n\t\t}\n\n\t\tthis.updateRemoteParticipantMenuState();\n\t};\n\n\tupdateCameraState()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!this.isVisibleCameraStateIcon())\n\t\t{\n\t\t\tthis.elements.cameraState.classList.add('hidden');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.cameraState.classList.remove('hidden');\n\t\t}\n\n\t\tif (this.isVisibleCameraStateIcon() && this.isVisibleMicStateIcon())\n\t\t{\n\t\t\tthis.elements.nameContainer.classList.add('extra-padding');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.nameContainer.classList.remove('extra-padding');\n\t\t}\n\n\t\tthis.updateRemoteParticipantMenuState();\n\t};\n\n\tupdateRemoteParticipantMenuState()\n\t{\n\t\tif (this.remoteParticipantMenu)\n\t\t{\n\t\t\tthis.showRemoteParticipantMenu();\n\t\t}\n\n\t\tthis.updatePanelDeferred();\n\t}\n\n\tupdateVideoPaused()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\n\t\t}\n\t\tif (this.stream && this.hasVideo())\n\t\t{\n\t\t\tthis.blurVideo(this.userModel.videoPaused);\n\t\t}\n\t\tthis.updateState();\n\t};\n\n\tupdateFloorRequestState()\n\t{\n\t\tif (!this.elements.floorRequest || this._hiddenFloorRequest)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.userModel.floorRequestState)\n\t\t{\n\t\t\tthis.elements.floorRequest.classList.add('active');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.floorRequest.classList.remove('active');\n\t\t}\n\t};\n\n\tupdateScreenState()\n\t{\n\t\tif (!this.elements.video)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.userModel.screenState)\n\t\t{\n\t\t\tthis.elements.video.classList.add('bx-messenger-videocall-video-contain');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.video.classList.remove('bx-messenger-videocall-video-contain');\n\t\t}\n\t};\n\n\thide()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.elements.root.dataset.hidden = 1;\n\t};\n\n\tshow()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tdelete this.elements.root.dataset.hidden;\n\t};\n\n\thasVideo()\n\t{\n\t\treturn this.userModel.state == UserState.Connected && (!!this._videoTrack || !!this._videoRenderer);\n\t};\n\n\thasCameraVideo()\n\t{\n\t\treturn this.userModel.state == UserState.Connected && (!!this._videoTrack || this._videoRenderer?.kind === 'video' || this._previewRenderer?.kind === 'video');\n\t}\n\n\tcheckVideoAspect()\n\t{\n\t\tif (!this.elements.video)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.elements.video.videoHeight > this.elements.video.videoWidth)\n\t\t{\n\t\t\tthis.elements.video.classList.add('bx-messenger-videocall-video-vertical');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.video.classList.remove('bx-messenger-videocall-video-vertical');\n\t\t}\n\t};\n\n\treleaseStream()\n\t{\n\t\tif (this._videoRenderer && !this._previewRenderer)\n\t\t{\n\t\t\tif (this.elements.video)\n\t\t\t{\n\t\t\t\tthis.elements.video.srcObject = null;\n\t\t\t}\n\t\t\tthis._videoRenderer = null;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.elements.video)\n\t\t\t{\n\t\t\t\tthis.elements.video.srcObject = null;\n\t\t\t}\n\t\t\tthis.videoTrack = null;\n\t\t}\n\t};\n\n\t_getVideoStats(videoStats) {\n\t\tlet resultString = '';\n\t\tlet limitationsString = '';\n\n\t\tresultString += `Bitrate: ${videoStats?.bitrate || 0}\\n`;\n\t\tresultString += `Track ID: ${videoStats?.trackIdentifier || 'no track id!'}\\n`;\n\t\tresultString += `PacketsLost: ${videoStats?.packetsLostExtended || 0}\\n`;\n\t\tresultString += `Codec: ${videoStats?.codecName || '-'}\\n`;\n\t\tresultString += `Resolution: ${videoStats?.frameWidth || 0}x${videoStats?.frameHeight || 0} \\n`;\n\t\tresultString += `In Remote Tracks: ${videoStats?.inRemoteTracks || 'U'} \\n`;\n\n\t\tif (videoStats?.qualityLimitationReason)\n\t\t{\n\t\t\tresultString += `(changes:${videoStats.qualityLimitationResolutionChanges}, FPS: ${videoStats?.framesPerSecond || 0})`;\n\t\t\tlimitationsString = `Limitation: ${videoStats.qualityLimitationReason}`;\n\t\t\tlimitationsString += ` (duration: ${Object.entries(videoStats.qualityLimitationDurations || {}).reduce(\n\t\t\t\t(accumulator, value, index) => accumulator + `${index ? ', ' : ''}` + `${value[0]}: ${value[1]}`,\n\t\t\t\t'',\n\t\t\t)})`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresultString += `(${videoStats?.framesPerSecond || 0} FPS)`;\n\t\t}\n\n\t\treturn ({\n\t\t\tresultString,\n\t\t\tlimitationsString,\n\t\t})\n\t}\n\n\t_formatVideoStats(videoStats)\n\t{\n\t\tlet result = '';\n\t\tlet limitations = '';\n\t\tif (Type.isArray(videoStats))\n\t\t{\n\t\t\tvideoStats.forEach((stats, trackIndex) =>\n\t\t\t{\n\t\t\t\tif (trackIndex)\n\t\t\t\t{\n\t\t\t\t\tresult += `\\n\\n`;\n\t\t\t\t}\n\n\t\t\t\tif (videoStats.length > 1)\n\t\t\t\t{\n\t\t\t\t\tresult += `Track ${trackIndex+1}\\n`;\n\t\t\t\t}\n\n\t\t\t\tconst {resultString, limitationsString} = this._getVideoStats(stats);\n\n\t\t\t\tif (resultString)\n\t\t\t\t{\n\t\t\t\t\tresult += resultString;\n\t\t\t\t}\n\n\t\t\t\tif (limitationsString)\n\t\t\t\t{\n\t\t\t\t\tlimitations = limitationsString;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst {resultString, limitationsString} = this._getVideoStats(videoStats);\n\n\t\t\tif (resultString)\n\t\t\t{\n\t\t\t\tresult += resultString;\n\t\t\t}\n\n\t\t\tif (limitationsString)\n\t\t\t{\n\t\t\t\tlimitations = limitationsString;\n\t\t\t}\n\t\t}\n\n\t\treturn limitations ? `${limitations}\\n\\n${result}` : result;\n\t};\n\n\ttoggleStateUserName(isActive)\n\t{\n\t\tif (!this.elements.nameContainer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst activeClassName = 'active';\n\t\tconst hasActiveClass = this.elements.nameContainer.classList.contains(activeClassName);\n\n\t\tif (hasActiveClass !== isActive)\n\t\t{\n\t\t\tthis.elements.nameContainer.classList.toggle(activeClassName);\n\t\t}\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.hintManager)\n\t\t{\n\t\t\tthis.hintManager.hide();\n\t\t\tthis.hintManager = null;\n\t\t}\n\t\tthis.userModel.unsubscribe('changed', this._onUserFieldChangedHandler);\n\t\tthis.releaseStream();\n\t\tclearInterval(this.checkAspectInterval);\n\t};\n\n\taddAvatarPulseTimer()\n\t{\n\t\tif (this.removeAvatarPulseTimer)\n\t\t{\n\t\t\tclearTimeout(this.removeAvatarPulseTimer);\n\t\t\tthis.removeAvatarPulseTimer = null;\n\t\t}\n\n\t\tthis.removeAvatarPulseTimer = setTimeout(() => {\n\t\t\tthis.elements.avatarContainer.classList.remove('bx-messenger-videocall-user-avatar-pulse');\n\t\t\tthis.elements.root.classList.remove('bx-messenger-videocall-user-talking');\n\t\t}, 1000);\n\t}\n\n\tclearAvatarPulseTimer()\n\t{\n\t\tif (this.removeAvatarPulseTimer)\n\t\t{\n\t\t\tclearTimeout(this.removeAvatarPulseTimer);\n\t\t\tthis.removeAvatarPulseTimer = null;\n\t\t}\n\n\t\tthis.elements.avatarContainer.classList.remove('bx-messenger-videocall-user-avatar-pulse');\n\t\tthis.elements.root.classList.remove('bx-messenger-videocall-user-talking');\n\t}\n\n\tupdateAvatarPulseState()\n\t{\n\t\tif (this.removeAvatarPulseTimer)\n\t\t{\n\t\t\tclearTimeout(this.removeAvatarPulseTimer);\n\t\t\tthis.removeAvatarPulseTimer = null;\n\t\t}\n\n\t\tthis.elements.avatarContainer.classList.add('bx-messenger-videocall-user-avatar-pulse');\n\n\t\tif (this.userModel.talking)\n\t\t{\n\t\t\tthis.elements.root.classList.add('bx-messenger-videocall-user-talking');\n\t\t}\n\t}\n}","import {Dom} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport { Utils } from 'im.v2.lib.utils';\nimport { Util } from 'call.core';\n\nexport class FloorRequest extends EventEmitter\n{\n\tconstructor(config)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace(\"BX.Call.FloorRequest\");\n\n\t\tthis.hideTime = BX.prop.getInteger(config, \"hideTime\", 10);\n\t\t//this.isShowAllowPermissionButton = BX.prop.getBoolean(config, 'isShowAllowPermissionButton', false);\n\t\tthis.userModel = config.userModel;\n\t\t\n\t\tthis.isShowAllowPermissionButton = this._canChangeSpeakPermission();\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\tavatar: null,\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tonAllowSpeakPermissionClicked:\n\t\t\t\tBX.type.isFunction(config.onAllowSpeakPermissionClicked)\n\t\t\t\t\t? config.onAllowSpeakPermissionClicked\n\t\t\t\t\t: BX.DoNothing,\n\t\t\tonDisallowSpeakPermissionClicked:\n\t\t\t\tBX.type.isFunction(config.onDisallowSpeakPermissionClicked)\n\t\t\t\t\t? config.onDisallowSpeakPermissionClicked\n\t\t\t\t\t: BX.DoNothing,\n\t\t\tonDestroy:\n\t\t\t\tBX.type.isFunction(config.onDestroy)\n\t\t\t\t\t? config.onDestroy\n\t\t\t\t\t: BX.DoNothing,\n\t\t};\n\n\t\tthis._hideTimeout = null;\n\t\tthis.container = null;\n\t\tthis._onUserModelChangedHandler = this._onUserModelChanged.bind(this);\n\t\tthis.userModel.subscribe(\"changed\", this._onUserModelChangedHandler);\n\t};\n\n\tstatic create(config)\n\t{\n\t\treturn new FloorRequest(config);\n\t};\n\t\n\t_canChangeSpeakPermission()\n\t{\n\t\treturn (\n\t\t\tUtil.isUserControlFeatureEnabled()\n\t\t\t&& !this.userModel.permissionToSpeak\n\t\t\t&& !Util.getRoomPermissions().AudioEnabled\n\t\t\t&& Util.canControlGiveSpeakPermission()\n\t\t);\n\t}\n\n\tmount(container)\n\t{\n\t\tthis.container = container;\n\t\tthis.container.appendChild(this.render());\n\t\tthis.scheduleDismount();\n\t};\n\t\n\tupdatePermissionButtonState()\n\t{\n\t\tthis.isShowAllowPermissionButton = this._canChangeSpeakPermission();\n\t\t\n\t\tif (this.elements)\n\t\t{\n\t\t\tBX.remove(this.elements.root);\n\t\t\tthis.elements.root = null;\n\t\t}\n\t\t\n\t\tthis.container.appendChild(this.render());\n\t}\n\n\tdismount()\n\t{\n\t\tif (this.elements)\n\t\t{\n\t\t\tBX.remove(this.elements.root);\t\t\t\n\t\t}\n\n\t\tthis.destroy();\n\t};\n\n\tonCloseClicked(event)\n\t{\n\t\tevent.stopPropagation();\n\n\t\tif(this.isShowAllowPermissionButton)\n\t\t{\n\t\t\tthis.callbacks.onDisallowSpeakPermissionClicked(this.userModel);\n\t\t}\n\t\tthis.dismount();\n\t}\n\n\tdismountWithAnimation()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.elements.root.classList.add(\"closing\");\n\n\t\tthis.elements.root.addEventListener(\"animationend\", () => this.dismount());\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\t\t\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-call-view-floor-request-notification\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-floor-request-notification-icon-container\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.elements.avatar = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-floor-request-notification-avatar\"},\n\t\t\t\t\t\t\ttext: '',\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-floor-request-notification-icon bx-messenger-videocall-floor-request-icon\"}\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\n\t\t\t\tthis.elements.name = Dom.create(\"span\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-floor-request-notification-text-container\"},\n\t\t\t\t\thtml: BX.message(\"IM_CALL_WANTS_TO_SAY_\" + (this.userModel.gender == \"F\" ? \"F\" : \"M\")).replace(\"#NAME#\", '<span class =\"bx-call-view-floor-request-notification-text-name\">' + BX.util.htmlspecialchars(this.userModel.name) + '</span>')\n\t\t\t\t}),\n\n\t\t\t\t(this.isShowAllowPermissionButton ? this.createAllowPermissionButton() : null),\n\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-floor-request-notification-close\"},\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: this.onCloseClicked.bind(this)\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\n\t\tif (this.userModel.avatar)\n\t\t{\n\t\t\tthis.elements.avatar.style.setProperty(\"--avatar\", \"url('\" + this.userModel.avatar + \"')\");\n\t\t\tthis.elements.avatar.innerText = '';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.avatar.innerText = Utils.text.getFirstLetters(this.userModel.name).toUpperCase();\n\t\t}\n\n\t\treturn this.elements.root\n\t};\n\n\tscheduleDismount()\n\t{\n\t\treturn;\n\t\tthis._hideTimeout = setTimeout(this.dismountWithAnimation.bind(this), this.hideTime * 1000);\n\t};\n\n\tcreateAllowPermissionButton()\n\t{\n\t\treturn new BX.UI.Button({\n\t\t\tbaseClass: \"ui-btn ui-btn-icon-mic\",\n\t\t\ttext: BX.message(\"CALL_RAISE_HAND_NOTIFY_ALLOW\"),\n\t\t\tsize: BX.UI.Button.Size.EXTRA_SMALL,\n\t\t\tcolor: BX.UI.Button.Color.LIGHT_BORDER,\n\t\t\tnoCaps: true,\n\t\t\tround: true,\n\t\t\tevents: {\n\t\t\t\tclick: () =>\n\t\t\t\t{\n\t\t\t\t\tthis._allowPermissionHandler();\n\t\t\t\t}\n\t\t\t}\n\t\t}).render();\n\t}\n\n\t_allowPermissionHandler()\n\t{\n\t\tthis.callbacks.onAllowSpeakPermissionClicked(this.userModel);\n\t\tthis.dismount();\n\t};\n\n\t_onUserModelChanged(event)\n\t{\n\t\tvar eventData = event.data;\n\n\t\tif (eventData.fieldName == \"floorRequestState\" && !this.userModel.floorRequestState)\n\t\t{\n\t\t\tthis.dismountWithAnimation();\n\t\t}\n\n\t\tif (this.userModel.avatar === '' && this.elements.avatar)\n\t\t{\n\t\t\tthis.elements.avatar.innerText = Utils.text.getFirstLetters(this.userModel.name).toUpperCase();\n\t\t}\n\n\t\tif (this.elements.name)\n\t\t{\n\t\t\tthis.elements.name.innerHtml = BX.message(\"IM_CALL_WANTS_TO_SAY_\" + (this.userModel.gender == \"F\" ? \"F\" : \"M\")).replace(\"#NAME#\", '<span class =\"bx-call-view-floor-request-notification-text-name\">' + BX.util.htmlspecialchars(this.userModel.name) + '</span>');\n\t\t}\n\t};\n\n\tdestroy()\n\t{\n\t\tthis.callbacks.onDestroy();\n\n\t\tclearTimeout(this._hideTimeout);\n\t\tthis._hideTimeout = null;\n\t\tthis.elements = null;\n\t\tif (this.userModel)\n\t\t{\n\t\t\tthis.userModel.unsubscribe(\"changed\", this._onUserModelChangedHandler);\n\t\t\tthis.userModel = null;\n\t\t}\n\t\tthis.emit(\"onDestroy\", {});\n\t}\n}\n","const maximumNotifications = 5;\n\nlet instance;\n\nexport class NotificationManager\n{\n\tconstructor()\n\t{\n\t\tthis.maxNotification = maximumNotifications;\n\t\tthis.notifications = [];\n\t};\n\n\tstatic get Instance()\n\t{\n\t\tif (!instance)\n\t\t{\n\t\t\tinstance = new NotificationManager()\n\t\t}\n\n\t\treturn instance;\n\t}\n\n\taddNotification(notification)\n\t{\n\t\tnotification.subscribe(\"onDestroy\", () => this.onNotificationDestroy(notification));\n\t\tthis.notifications.push(notification);\n\n\t\tif (this.notifications.length > this.maxNotification)\n\t\t{\n\t\t\tconst firstNotification = this.notifications.shift();\n\t\t\tfirstNotification.dismount();\n\t\t}\n\t};\n\n\tonNotificationDestroy(notification)\n\t{\n\t\tconst index = this.notifications.indexOf(notification);\n\n\t\tif (index != -1)\n\t\t{\n\t\t\tthis.notifications.splice(index, 1);\n\t\t}\n\t};\n}","import {Dom} from 'main.core'\nimport {EventEmitter} from 'main.core.events'\nimport {Popup} from 'main.popup'\nimport {Hardware} from '../call_hardware';\nimport {BackgroundDialog} from '../dialogs/background_dialog';\nimport 'ui.switcher';\nimport Util from '../util';\n\nconst DeviceSelectorEvents = {\n\tonMicrophoneSelect: \"onMicrophoneSelect\",\n\tonMicrophoneSwitch: \"onMicrophoneSwitch\",\n\tonCameraSelect: \"onCameraSelect\",\n\tonCameraSwitch: \"onCameraSwitch\",\n\tonSpeakerSelect: \"onSpeakerSelect\",\n\tonSpeakerSwitch: \"onSpeakerSwitch\",\n\tonChangeHdVideo: \"onChangeHdVideo\",\n\tonChangeMicAutoParams: \"onChangeMicAutoParams\",\n\tonChangeFaceImprove: \"onChangeFaceImprove\",\n\tonAdvancedSettingsClick: \"onOpenAdvancedSettingsClick\",\n\tonShow: \"onShow\",\n\tonDestroy: \"onDestroy\",\n};\n\n/**\n * @param config\n * @param {Node} config.parentElement\n * @param {boolean} config.cameraEnabled\n * @param {boolean} config.microphoneEnabled\n * @param {boolean} config.speakerEnabled\n * @param {boolean} config.allowHdVideo\n * @param {boolean} config.faceImproveEnabled\n * @param {object} config.events\n\n * @returns {DeviceSelector}\n */\n\n/**\n * @param config\n * @param {Node} config.parentElement\n * @param {number} config.zIndex\n * @param {boolean} config.cameraEnabled\n * @param {boolean} config.microphoneEnabled\n * @param {boolean} config.speakerEnabled\n * @param {boolean} config.allowHdVideo\n * @param {boolean} config.faceImproveEnabled\n * @constructor\n */\nexport class DeviceSelector\n{\n\tstatic Events = DeviceSelectorEvents;\n\n\tconstructor(config)\n\t{\n\t\tthis.viewElement = config.viewElement || null;\n\t\tthis.parentElement = config.parentElement;\n\t\tthis.zIndex = config.zIndex;\n\n\t\tthis.cameraEnabled = BX.prop.getBoolean(config, \"cameraEnabled\", false);\n\t\tthis.cameraId = BX.prop.getString(config, \"cameraId\", false);\n\t\tthis.microphoneEnabled = BX.prop.getBoolean(config, \"microphoneEnabled\", false);\n\t\tthis.microphoneId = BX.prop.getString(config, \"microphoneId\", false);\n\t\tthis.speakerEnabled = BX.prop.getBoolean(config, \"speakerEnabled\", false);\n\t\tthis.speakerId = BX.prop.getString(config, \"speakerId\", false);\n\t\tthis.allowHdVideo = BX.prop.getBoolean(config, \"allowHdVideo\", false);\n\t\tthis.faceImproveEnabled = BX.prop.getBoolean(config, \"faceImproveEnabled\", false);\n\t\tthis.allowFaceImprove = BX.prop.getBoolean(config, \"allowFaceImprove\", false);\n\t\tthis.allowBackground = BX.prop.getBoolean(config, \"allowBackground\", true);\n\t\tthis.allowMask = BX.prop.getBoolean(config, \"allowMask\", true);\n\t\tthis.allowAdvancedSettings = BX.prop.getBoolean(config, \"allowAdvancedSettings\", false);\n\t\tthis.switchCameraBlocked = config.switchCameraBlocked || false;\n\t\tthis.switchMicrophoneBlocked = config.switchMicrophoneBlocked || false;\n\t\tthis.isDestroying = false;\n\n\t\tthis.popup = null;\n\t\tthis.eventEmitter = new BX.Event.EventEmitter(this, \"DeviceSelector\");\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\tmicContainer: null,\n\t\t\tcameraContainer: null,\n\t\t\tspeakerContainer: null,\n\t\t};\n\n\t\tconst eventListeners = BX.prop.getObject(config, \"events\", {});\n\t\tObject.values(DeviceSelectorEvents).forEach((eventName) =>\n\t\t{\n\t\t\tif (eventListeners[eventName])\n\t\t\t{\n\t\t\t\tthis.eventEmitter.subscribe(eventName, eventListeners[eventName]);\n\t\t\t}\n\t\t})\n\t};\n\n\t// static create(config)\n\t// {\n\t// \treturn new DeviceSelector(config);\n\t// };\n\n\tshow()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.show();\n\t\t\treturn;\n\t\t}\n\t\tthis.popup = new Popup({\n\t\t\tid: 'call-view-device-selector',\n\t\t\tbindElement: this.parentElement,\n\t\t\ttargetContainer: this.viewElement,\n\t\t\tautoHide: true,\n\t\t\tzIndex: this.zIndex,\n\t\t\tcloseByEsc: true,\n\t\t\toffsetTop: 20,\n\t\t\toffsetLeft: -20,\n\t\t\tbindOptions: {\n\t\t\t\tposition: 'top'\n\t\t\t},\n\t\t\tangle: false,\n\t\t\tbackground: '#22272B',\n\t\t\toverlay: {\n\t\t\t\tbackgroundColor: '#22272B',\n\t\t\t\topacity: 0\n\t\t\t},\n\t\t\tcontent: this.render(),\n\t\t\tevents: {\n\t\t\t\tonPopupClose: () => this.popup.destroy(),\n\t\t\t\tonPopupDestroy: () => this.destroy(),\n\t\t\t}\n\t\t});\n\t\tthis.popup.show();\n\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onShow, {});\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-call-view-device-selector\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-top\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\t(this.microphoneContainer = DeviceMenu.create({\n\t\t\t\t\t\t\tblocked: this.switchMicrophoneBlocked,\n\t\t\t\t\t\t\tdeviceLabel: BX.message(\"IM_M_CALL_BTN_MIC\"),\n\t\t\t\t\t\t\tdeviceList: Hardware.getMicrophoneList(),\n\t\t\t\t\t\t\tselectedDevice: this.microphoneId,\n\t\t\t\t\t\t\tdeviceEnabled: this.microphoneEnabled,\n\t\t\t\t\t\t\ticons: [\"microphone\", \"microphone-off\"],\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tonSwitch: this.onMicrophoneSwitch.bind(this),\n\t\t\t\t\t\t\t\tonSelect: this.onMicrophoneSelect.bind(this)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})).render(),\n\t\t\t\t\t\t(this.cameraContainer = DeviceMenu.create({\n\t\t\t\t\t\t\tblocked: this.switchCameraBlocked,\n\t\t\t\t\t\t\tdeviceLabel: BX.message(\"IM_M_CALL_BTN_CAMERA\"),\n\t\t\t\t\t\t\tdeviceList: Hardware.getCameraList(),\n\t\t\t\t\t\t\tselectedDevice: this.cameraId,\n\t\t\t\t\t\t\tdeviceEnabled: this.cameraEnabled,\n\t\t\t\t\t\t\ticons: [\"camera\", \"camera-off\"],\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tonSwitch: this.onCameraSwitch.bind(this),\n\t\t\t\t\t\t\t\tonSelect: this.onCameraSelect.bind(this)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})).render(),\n\t\t\t\t\t\tHardware.canSelectSpeaker() ?\n\t\t\t\t\t\t\tDeviceMenu.create({\n\t\t\t\t\t\t\t\tdeviceLabel: BX.message(\"IM_M_CALL_BTN_SPEAKER\"),\n\t\t\t\t\t\t\t\tdeviceList: Hardware.getSpeakerList(),\n\t\t\t\t\t\t\t\tselectedDevice: this.speakerId,\n\t\t\t\t\t\t\t\tdeviceEnabled: this.speakerEnabled,\n\t\t\t\t\t\t\t\ticons: [\"speaker\", \"speaker-off\"],\n\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\tonSwitch: this.onSpeakerSwitch.bind(this),\n\t\t\t\t\t\t\t\t\tonSelect: this.onSpeakerSelect.bind(this)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}).render()\n\t\t\t\t\t\t\t: null,\n\t\t\t\t\t]\n\t\t\t\t}),\n\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom-item\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"input\", {\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\tid: \"device-selector-hd-video\",\n\t\t\t\t\t\t\t\t\t\tclassName: \"bx-call-view-device-selector-bottom-item-checkbox\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\t\t\t\ttype: \"checkbox\",\n\t\t\t\t\t\t\t\t\t\tchecked: this.allowHdVideo\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tchange: this.onAllowHdVideoChange.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"label\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom-item-label\"},\n\t\t\t\t\t\t\t\t\tattrs: {for: \"device-selector-hd-video\"},\n\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_HD_VIDEO\")\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.allowFaceImprove ?\n\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom-item\"},\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\tDom.create(\"input\", {\n\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\tid: \"device-selector-mic-auto-params\",\n\t\t\t\t\t\t\t\t\t\t\tclassName: \"bx-call-view-device-selector-bottom-item-checkbox\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"checkbox\",\n\t\t\t\t\t\t\t\t\t\t\tchecked: this.faceImproveEnabled\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\t\tchange: this.onFaceImproveChange.bind(this)\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\tDom.create(\"label\", {\n\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom-item-label\"},\n\t\t\t\t\t\t\t\t\t\tattrs: {for: \"device-selector-mic-auto-params\"},\n\t\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_SETTINGS_HARDWARE_CAMERA_FACE_IMPROVE\")\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t: null,\n\t\t\t\t\t\tthis.allowBackground ?\n\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom-item\"},\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom-item-action\"},\n\t\t\t\t\t\t\t\t\t\ttext: this.allowMask ? BX.message(\"IM_M_CALL_BG_MASK_CHANGE\") : BX.message(\"IM_M_CALL_BACKGROUND_CHANGE\"),\n\t\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\t\tclick: () =>\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tBackgroundDialog.open();\n\t\t\t\t\t\t\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t: null,\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom-item\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom-item-action\"},\n\t\t\t\t\t\t\t\t\ttext: BX.message(\"CALL_RUN_SELF_TEST\"),\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tclick: () =>\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tUtil.startSelfTest();\n\t\t\t\t\t\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\t(this.allowAdvancedSettings && !!BX.MessengerCommon) ?\n\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom-item\"},\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom-item-action\"},\n\t\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_ADVANCED_SETTINGS\"),\n\t\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\t\tclick: (e) =>\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t// to prevent BX.IM.autoHide\n\t\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onAdvancedSettingsClick);\n\t\t\t\t\t\t\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t: null,\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t]\n\t\t})\n\t};\n\n\ttoggleCameraAvailability(available)\n\t{\n\t\tif (available)\n\t\t{\n\t\t\tthis.cameraContainer.unblock();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.cameraContainer.block();\n\t};\n\n\ttoggleMicrophoneAvailability(available)\n\t{\n\t\tif (available)\n\t\t{\n\t\t\tthis.microphoneContainer.unblock();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.microphoneContainer.block();\n\t};\n\n\tonMicrophoneSwitch()\n\t{\n\t\tthis.microphoneEnabled = !this.microphoneEnabled;\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onMicrophoneSwitch, {\n\t\t\tmicrophoneEnabled: this.microphoneEnabled\n\t\t})\n\t};\n\n\tonMicrophoneSelect(e)\n\t{\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onMicrophoneSelect, {\n\t\t\tdeviceId: e.data.deviceId\n\t\t})\n\t};\n\n\tonCameraSwitch()\n\t{\n\t\tthis.cameraEnabled = !this.cameraEnabled;\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onCameraSwitch, {\n\t\t\tcameraEnabled: this.cameraEnabled\n\t\t})\n\t};\n\n\tonCameraSelect(e)\n\t{\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onCameraSelect, {\n\t\t\tdeviceId: e.data.deviceId\n\t\t});\n\t};\n\n\tonSpeakerSwitch()\n\t{\n\t\tthis.speakerEnabled = !this.speakerEnabled;\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onSpeakerSwitch, {\n\t\t\tspeakerEnabled: this.speakerEnabled\n\t\t})\n\t};\n\n\tonSpeakerSelect(e)\n\t{\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onSpeakerSelect, {\n\t\t\tdeviceId: e.data.deviceId\n\t\t});\n\t};\n\n\tonAllowHdVideoChange(e)\n\t{\n\t\tthis.allowHdVideo = e.currentTarget.checked;\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onChangeHdVideo, {\n\t\t\tallowHdVideo: this.allowHdVideo\n\t\t})\n\t};\n\n\tonAllowMirroringVideoChange(e)\n\t{\n\t\tHardware.enableMirroring = e.target.checked;\n\t};\n\n\tonFaceImproveChange(e)\n\t{\n\t\tthis.faceImproveEnabled = e.currentTarget.checked;\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onChangeFaceImprove, {\n\t\t\tfaceImproveEnabled: this.faceImproveEnabled\n\t\t})\n\t};\n\n\tdestroy()\n\t{\n\t\tif (this.isDestroying)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isDestroying = true;\n\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.destroy();\n\t\t\tthis.popup = null;\n\t\t}\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onDestroy, {});\n\t};\n}\n\nconst DeviceMenuEvents = {\n\tonSelect: \"onSelect\",\n\tonSwitch: \"onSwitch\"\n};\n\nclass DeviceMenu\n{\n\tconstructor(config)\n\t{\n\t\tconfig = BX.type.isObject(config) ? config : {};\n\n\t\tthis.menuBlocked = config.blocked || false;\n\t\tthis.deviceList = BX.prop.getArray(config, \"deviceList\", []);\n\t\tthis.selectedDevice = BX.prop.getString(config, \"selectedDevice\", \"\");\n\t\tthis.deviceEnabled = BX.prop.getBoolean(config, \"deviceEnabled\", false);\n\t\tthis.deviceLabel = BX.prop.getString(config, \"deviceLabel\", \"\");\n\t\tthis.icons = BX.prop.getArray(config, \"icons\", []);\n\t\tthis.eventEmitter = new EventEmitter(this, 'DeviceMenu');\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\tswitchIcon: null,\n\t\t\tmenuInner: null,\n\t\t\tmenuItems: {}  // deviceId => {root: element, icon: element}\n\t\t};\n\n\t\tvar events = BX.prop.getObject(config, \"events\", {});\n\t\tfor (var eventName in events)\n\t\t{\n\t\t\tif (!events.hasOwnProperty(eventName))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tthis.eventEmitter.subscribe(eventName, events[eventName]);\n\t\t}\n\t};\n\n\tstatic create(config)\n\t{\n\t\treturn new DeviceMenu(config);\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-call-view-device-selector-menu-container\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-switch-wrapper\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.elements.switchIcon = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-device-icon \" + this.getDeviceIconClass()}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-device-text\"},\n\t\t\t\t\t\t\ttext: this.deviceLabel\n\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-device-switch\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t(new BX.UI.Switcher({\n\t\t\t\t\t\t\t\t\tsize: 'small',\n\t\t\t\t\t\t\t\t\tchecked: this.deviceEnabled,\n\t\t\t\t\t\t\t\t\thandlers: {\n\t\t\t\t\t\t\t\t\t\ttoggled: this.onSwitchToggled.bind(this)\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tdisabled: this.menuBlocked,\n\t\t\t\t\t\t\t\t})).getNode()\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tthis.elements.menuInner = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-menu-inner\" + (this.menuBlocked ? ' inactive' : '')},\n\t\t\t\t\tchildren: this.deviceList.map(this.renderDevice.bind(this))\n\t\t\t\t}),\n\t\t\t]\n\t\t});\n\t\treturn this.elements.root;\n\t};\n\n\trenderDevice(deviceInfo)\n\t{\n\t\tvar iconClass = this.selectedDevice === deviceInfo.deviceId ? \"selected\" : \"\";\n\t\tvar deviceElements = {};\n\t\tdeviceElements.root = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-call-view-device-selector-menu-item\"},\n\t\t\tdataset: {\n\t\t\t\tdeviceId: deviceInfo.deviceId\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tdeviceElements.icon = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-menu-item-icon \" + iconClass},\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-menu-item-text\"},\n\t\t\t\t\ttext: deviceInfo.label || \"(\" + BX.message(\"IM_M_CALL_DEVICE_NO_NAME\") + \")\",\n\t\t\t\t}),\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: this.onMenuItemClick.bind(this)\n\t\t\t}\n\t\t});\n\t\tthis.elements.menuItems[deviceInfo.deviceId] = deviceElements;\n\t\treturn deviceElements.root;\n\t};\n\n\tblock()\n\t{\n\t\tthis.menuBlocked = true;\n\t\tthis.elements.root.classList.add(\"bx-call-view-device-selector-menu-container-blocked\");\n\t};\n\n\tunblock()\n\t{\n\t\tthis.menuBlocked = false;\n\t\tthis.elements.root.classList.remove(\"bx-call-view-device-selector-menu-container-blocked\");\n\t};\n\n\tgetDeviceIconClass()\n\t{\n\t\tvar result = \"\";\n\t\tif (this.deviceEnabled && this.icons.length > 0)\n\t\t{\n\t\t\tresult = this.icons[0];\n\t\t}\n\t\telse if (!this.deviceEnabled && this.icons.length > 1)\n\t\t{\n\t\t\tresult = this.icons[1];\n\t\t}\n\t\treturn result;\n\t};\n\n\tonSwitchToggled()\n\t{\n\t\tif (this.menuBlocked)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.deviceEnabled = !this.deviceEnabled;\n\t\tthis.elements.switchIcon.className = \"bx-call-view-device-selector-device-icon \" + this.getDeviceIconClass();\n\n\t\tthis.eventEmitter.emit(DeviceMenuEvents.onSwitch, {\n\t\t\tdeviceEnabled: this.deviceEnabled\n\t\t})\n\t};\n\n\tonMenuItemClick(e)\n\t{\n\t\tvar currentDevice = this.selectedDevice;\n\t\tvar selectedDevice = e.currentTarget.dataset.deviceId;\n\n\t\tthis.selectedDevice = selectedDevice;\n\t\tif (this.elements.menuItems[currentDevice])\n\t\t{\n\t\t\tthis.elements.menuItems[currentDevice]['icon'].classList.remove('selected');\n\t\t}\n\t\tif (this.elements.menuItems[this.selectedDevice])\n\t\t{\n\t\t\tthis.elements.menuItems[this.selectedDevice]['icon'].classList.add('selected');\n\t\t}\n\n\t\tthis.eventEmitter.emit(DeviceMenuEvents.onSelect, {\n\t\t\tdeviceId: this.selectedDevice\n\t\t})\n\t};\n};","import { Dom, Loc } from 'main.core';\nimport { Popup } from 'main.popup';\nimport { PromoManager } from 'im.v2.lib.promo';\n\nimport { Analytics } from 'call.lib.analytics';\n\nimport '../css/copilot-notify.css'\n\nexport const CopilotNotifyType = {\n\tCOPILOT_ENABLED: 'COPILOT_ENABLED',\n\tCOPILOT_DISABLED: 'COPILOT_DISABLED',\n\tCOPILOT_RESULT: 'COPILOT_RESULT',\n\tAI_UNAVAILABLE_ERROR: 'AI_UNAVAILABLE_ERROR',\n\tAI_SETTINGS_ERROR: 'AI_SETTINGS_ERROR',\n\tAI_AGREEMENT_ERROR: 'AI_AGREEMENT_ERROR',\n\tAI_NOT_ENOUGH_BAAS_ERROR: 'AI_NOT_ENOUGH_BAAS_ERROR',\n\tAI_MODULE_ERROR: 'AI_MODULE_ERROR',\n\tENABLE_AI_INTERNAL_ERROR: 'ENABLE_AI_INTERNAL_ERROR',\n\tDISABLE_AI_INTERNAL_ERROR: 'DISABLE_AI_INTERNAL_ERROR',\n};\n\nexport class CopilotNotify {\n\tconstructor(config)\n\t{\n\t\tthis.callId = config.callId || 0;\n\t\tthis.type = config.type || '';\n\t\tthis.code = config.code || '';\n\t\tthis.popup = null;\n\t\tthis.notifyText = '';\n\t\tthis.promoId = '';\n\t\tthis.popupTemplate = null;\n\t\tthis.bindElement = config.bindElement;\n\t\tthis.notifyColor = '';\n\n\t\tthis.callbacks = {\n\t\t\tonClose: BX.type.isFunction(config.onClose) ? config.onClose : BX.DoNothing,\n\t\t}\n\t}\n\n\tgetPopupTemplate()\n\t{\n\t\tthis.setAdditionalInformation();\n\n\t\tif (!this.notifyText)\n\t\t{\n\t\t\tthis.popupTemplate = null;\n\t\t}\n\n\t\tthis.popupTemplate = Dom.create(\"div\", {\n\t\t\tprops: {className: 'bx-call-copilot-notify__content'},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'bx-call-copilot-notify__icon'},\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'bx-call-copilot-notify__message'},\n\t\t\t\t\ttext: this.notifyText,\n\t\t\t\t}),\n\t\t\t\tDom.create(\"button\", {\n\t\t\t\t\tprops: {className: 'bx-call-copilot-notify__close-btn'},\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\tthis.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t}\n\n\tsetAdditionalInformation()\n\t{\n\t\tswitch (this.type)\n\t\t{\n\t\t\tcase CopilotNotifyType.COPILOT_ENABLED:\n\t\t\t\tthis.notifyText = BX.message('CALL_POPUP_WARNING_ENABLED');\n\t\t\t\tthis.promoId = 'call:copilot-notify-warning:21112024:all';\n\t\t\t\tthis.notifyColor = '#8E52EC';\n\t\t\t\tbreak;\n\t\t\tcase CopilotNotifyType.COPILOT_DISABLED:\n\t\t\t\tthis.notifyText = BX.message('CALL_POPUP_PROMO_ENABLED');\n\t\t\t\tthis.promoId = 'call:copilot-notify-promo:21112024:all';\n\t\t\t\tthis.notifyColor = '#8E52EC';\n\t\t\t\tbreak;\n\t\t\tcase CopilotNotifyType.COPILOT_RESULT:\n\t\t\t\tthis.notifyText = BX.message('CALL_POPUP_RESULT_WARNING');\n\t\t\t\tthis.promoId = 'call:copilot-notify-result:24112024:all';\n\t\t\t\tthis.notifyColor = '#8E52EC';\n\t\t\t\tbreak;\n\t\t\tcase CopilotNotifyType.AI_UNAVAILABLE_ERROR:\n\t\t\t\tthis.notifyText = BX.message('CALL_POPUP_AI_UNAVAILABLE_ERROR');\n\t\t\t\tthis.notifyColor = '#FF5752';\n\t\t\t\tbreak;\n\t\t\tcase CopilotNotifyType.AI_MODULE_ERROR:\n\t\t\t\tthis.notifyText = BX.message('CALL_POPUP_AI_MODULE_ERROR').replace('#ERROR_CODE#', this.code);\n\t\t\t\tthis.notifyColor = '#FF5752';\n\t\t\t\tbreak;\n\t\t\tcase CopilotNotifyType.AI_SETTINGS_ERROR:\n\t\t\t\tthis.notifyText = BX.message('CALL_POPUP_AI_SETTINGS_ERROR');\n\t\t\t\tthis.notifyColor = '#FF5752';\n\t\t\t\tbreak;\n\t\t\tcase CopilotNotifyType.AI_AGREEMENT_ERROR:\n\t\t\t\tthis.notifyText = BX.message('CALL_POPUP_AI_AGREEMENT_ERROR');\n\t\t\t\tthis.notifyColor = '#FF5752';\n\t\t\t\tbreak;\n\t\t\tcase CopilotNotifyType.AI_NOT_ENOUGH_BAAS_ERROR:\n\t\t\t\tthis.notifyText = BX.message('CALL_POPUP_AI_NOT_ENOUGH_BAAS_ERROR');\n\t\t\t\tthis.notifyColor = '#FF5752';\n\t\t\t\tbreak;\n\t\t\tcase CopilotNotifyType.ENABLE_AI_INTERNAL_ERROR:\n\t\t\t\tthis.notifyText = BX.message('CALL_POPUP_ENABLE_AI_INTERNAL_ERROR').replace('#ERROR_CODE#', this.code);\n\t\t\t\tthis.notifyColor = '#FF5752';\n\t\t\t\tbreak;\n\t\t\tcase CopilotNotifyType.DISABLE_AI_INTERNAL_ERROR:\n\t\t\t\tthis.notifyText = BX.message('CALL_POPUP_DISABLE_AI_INTERNAL_ERROR').replace('#ERROR_CODE#', this.code);\n\t\t\t\tthis.notifyColor = '#FF5752';\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthis.notifyText = Loc.getMessage('CALL_POPUP_AI_DEFAULT_TEXT');\n\t\t\t\tthis.notifyColor = '#FF5752';\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tcreate()\n\t{\n\t\tconst self = this;\n\n\t\tthis.getPopupTemplate();\n\n\t\tif (!this.bindElement || !this.popupTemplate)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.popup = new Popup({\n\t\t\tclassName : \"bx-call-copilot-notify\",\n\t\t\tbindElement: this.bindElement,\n\t\t\ttargetContainer: document.body,\n\t\t\tcontent: this.popupTemplate,\n\t\t\tbindOptions: {\n\t\t\t\tposition: \"top\"\n\t\t\t},\n\t\t\tpadding: 0,\n\t\t\tcontentBorderRadius: '1024px',\n\t\t\tbackground: this.notifyColor,\n\t\t\tcontentBackground: this.notifyColor,\n\t\t\tdarkMode: true,\n\t\t\tcontentNoPaddings: true,\n\t\t\tanimation: \"fading\",\n\t\t\tautoHide: true,\n\t\t\tevents: {\n\t\t\t\tonPopupClose: function ()\n\t\t\t\t{\n\t\t\t\t\tself.callbacks.onClose();\n\t\t\t\t\tthis.destroy();\n\t\t\t\t},\n\t\t\t\tonPopupDestroy: function ()\n\t\t\t\t{\n\t\t\t\t\tself.popup = null;\n\t\t\t\t},\n\t\t\t\tonShow: () => {\n\t\t\t\t\tconst popupWidth = this.popup.getPopupContainer().offsetWidth;\n\t\t\t\t\tconst elementWidth = this.popup.bindElement.offsetWidth;\n\t\t\t\t\tconst offsetFix = 7;\n\n\t\t\t\t\tthis.popup.setOffset({\n\t\t\t\t\t\toffsetLeft: elementWidth - offsetFix - popupWidth / 2\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.popup.setAngle({\n\t\t\t\t\t\toffset: popupWidth / 2,\n\t\t\t\t\t\tposition: 'bottom',\n\t\t\t\t\t});\n\t\t\t\t\tthis.popup.adjustPosition();\n\t\t\t\t},\n\t\t\t\tonClose: () => {\n\t\t\t\t\tif (!this.promoId)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tPromoManager.getInstance().markAsWatched(this.promoId);\n\t\t\t\t},\n\t\t\t}\n\t\t});\n\t}\n\n\tshow()\n\t{\n\t\tthis.close();\n\t\tthis.create();\n\n\t\tif (!this.canShowCopilotNotify())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.type === CopilotNotifyType.COPILOT_ENABLED || this.type === CopilotNotifyType.COPILOT_DISABLED)\n\t\t{\n\t\t\tAnalytics.getInstance().copilot.onCopilotNotifyShow({\n\t\t\t\tisCopilotActive: this.type === CopilotNotifyType.COPILOT_ENABLED,\n\t\t\t\tcallId: this.callId,\n\t\t\t});\n\t\t}\n\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.show();\n\t\t}\n\t}\n\n\tclose()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t}\n\t}\n\n\tcanShowCopilotNotify()\n\t{\n\t\tif (!this.promoId)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\treturn PromoManager.getInstance().needToShow(this.promoId);\n\t}\n}\n","import { Extension } from 'main.core';\nimport { CopilotNotifyType } from './view/copilot-notify';\n\n\nexport type CallAiOptions = {\n\tserviceEnabled?: boolean;\n\tsettingsEnabled?: boolean;\n\trecordingMinUsers?: number;\n\tagreementAccepted?: boolean;\n\ttariffAvailable?: boolean;\n\tbaasAvailable?: boolean;\n\tfeedBackLink?: string;\n\tbaasPromoSlider?: string;\n\thelpSlider?: string;\n\tdisclaimerArticleCode?: string;\n};\n\nexport const CallAiError = {\n\tAI_MODULE_ERROR: 'AI_MODULE_ERROR',\n\tAI_UNAVAILABLE_ERROR: 'AI_UNAVAILABLE_ERROR',\n\tAI_SETTINGS_ERROR: 'AI_SETTINGS_ERROR',\n\tAI_AGREEMENT_ERROR: 'AI_AGREEMENT_ERROR',\n\tAI_NOT_ENOUGH_BAAS_ERROR: 'AI_NOT_ENOUGH_BAAS_ERROR',\n};\n\nclass CallAi\n{\n\tconstructor()\n\t{\n\t\tthis.serviceEnabled = false;\n\t\tthis.settingsEnabled = false;\n\t\tthis.recordingMinUsers = 1000;\n\t\tthis.agreementAccepted = false;\n\t\tthis.tariffAvailable = false;\n\t\tthis.baasAvailable = false;\n\t\tthis.feedBackLink = '';\n\t\tthis.baasPromoSlider = '';\n\t\tthis.helpSlider = '';\n\t\tthis.disclaimerArticleCode = '';\n\n\t\tif (Extension.getSettings('call.core').ai)\n\t\t{\n\t\t\tthis.setup(Extension.getSettings('call.core').ai);\n\t\t}\n\t}\n\n\tsetup(options: CallAiOptions)\n\t{\n\t\tif (options.serviceEnabled !== undefined)\n\t\t{\n\t\t\tthis.serviceEnabled = options.serviceEnabled;\n\t\t}\n\t\tif (options.settingsEnabled !== undefined)\n\t\t{\n\t\t\tthis.settingsEnabled = options.settingsEnabled;\n\t\t}\n\t\tif (options.recordingMinUsers)\n\t\t{\n\t\t\tthis.recordingMinUsers = options.recordingMinUsers;\n\t\t}\n\t\tif (options.agreementAccepted !== undefined)\n\t\t{\n\t\t\tthis.agreementAccepted = options.agreementAccepted;\n\t\t}\n\t\tif (options.tariffAvailable !== undefined)\n\t\t{\n\t\t\tthis.tariffAvailable = options.tariffAvailable;\n\t\t}\n\t\tif (options.baasAvailable !== undefined)\n\t\t{\n\t\t\tthis.baasAvailable = options.baasAvailable;\n\t\t}\n\t\tif (options.feedBackLink)\n\t\t{\n\t\t\tthis.feedBackLink = options.feedBackLink;\n\t\t}\n\t\tif (options.baasPromoSlider)\n\t\t{\n\t\t\tthis.baasPromoSlider = options.baasPromoSlider;\n\t\t}\n\t\tif (options.helpSlider)\n\t\t{\n\t\t\tthis.helpSlider = options.helpSlider;\n\t\t}\n\t\tif (options.disclaimerArticleCode)\n\t\t{\n\t\t\tthis.disclaimerArticleCode = options.disclaimerArticleCode;\n\t\t}\n\t}\n\n\tget serviceEnabled(): boolean\n\t{\n\t\treturn this._serviceEnabled;\n\t}\n\tset serviceEnabled(flag: boolean)\n\t{\n\t\tthis._serviceEnabled = flag;\n\t}\n\n\tget settingsEnabled(): boolean\n\t{\n\t\treturn this._settingsEnabled;\n\t}\n\tset settingsEnabled(flag: boolean)\n\t{\n\t\tthis._settingsEnabled = flag;\n\t}\n\n\tget recordingMinUsers(): number\n\t{\n\t\treturn this._recordingMinUsers;\n\t}\n\tset recordingMinUsers(value: number)\n\t{\n\t\tthis._recordingMinUsers = value;\n\t}\n\n\tget agreementAccepted(): boolean\n\t{\n\t\treturn this._agreementAccepted;\n\t}\n\tset agreementAccepted(flag: boolean)\n\t{\n\t\tthis._agreementAccepted = flag;\n\t}\n\n\tget tariffAvailable(): boolean\n\t{\n\t\treturn this._tariffAvailable;\n\t}\n\tset tariffAvailable(flag: boolean)\n\t{\n\t\tthis._tariffAvailable = flag;\n\t}\n\n\tget baasAvailable(): boolean\n\t{\n\t\treturn this._baasAvailable;\n\t}\n\tset baasAvailable(flag: boolean)\n\t{\n\t\tthis._baasAvailable = flag;\n\t}\n\n\tget feedBackLink(): string\n\t{\n\t\treturn this._feedBackLink;\n\t}\n\tset feedBackLink(value: string)\n\t{\n\t\tthis._feedBackLink = value;\n\t}\n\n\tget baasPromoSlider(): string\n\t{\n\t\treturn this._baasPromoSlider;\n\t}\n\tset baasPromoSlider(value: string)\n\t{\n\t\tthis._baasPromoSlider = value;\n\t}\n\n\tget helpSlider(): string\n\t{\n\t\treturn this._helpSlider;\n\t}\n\tset helpSlider(value: string)\n\t{\n\t\tthis._helpSlider = value;\n\t}\n\n\tget disclaimerArticleCode(): string\n\t{\n\t\treturn this._disclaimerArticleCode;\n\t}\n\tset disclaimerArticleCode(value: string)\n\t{\n\t\tthis._disclaimerArticleCode = value;\n\t}\n\n\thandleCopilotError(errorType: string)\n\t{\n\t\tswitch (errorType)\n\t\t{\n\t\t\tcase CallAiError.AI_UNAVAILABLE_ERROR:\n\t\t\t\tthis.tariffAvailable = false;\n\t\t\t\tbreak;\n\t\t\tcase CallAiError.AI_MODULE_ERROR:\n\t\t\tcase CallAiError.AI_SETTINGS_ERROR:\n\t\t\t\tthis.settingsEnabled = false;\n\t\t\t\tbreak;\n\t\t\tcase CallAiError.AI_AGREEMENT_ERROR:\n\t\t\t\tthis.agreementAccepted = false;\n\t\t\t\tbreak;\n\t\t\tcase CallAiError.AI_NOT_ENOUGH_BAAS_ERROR:\n\t\t\t\tthis.baasAvailable = false;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tconsole.error('there are no such errorTypes');\n\t\t\t\tbreak;\n\t\t}\n\t}\n}\n\nexport const CallAI = new CallAi();","export class MediaRenderer\n{\n\telement = null;\n\n\tconstructor(params)\n\t{\n\t\tparams = params || {};\n\t\tthis.kind = params.kind || 'video';\n\t\tif (params.track)\n\t\t{\n\t\t\tthis.stream = new MediaStream([params.track]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.stream = null;\n\t\t}\n\t}\n\n\trender(el)\n\t{\n\t\tif (!el.srcObject || !el.srcObject.active || el.srcObject.id !== this.stream.id)\n\t\t{\n\t\t\tel.srcObject = this.stream;\n\t\t}\n\t}\n\n\trequestVideoSize()\n\t{\n\t}\n}\n","import { DesktopApi } from 'im.v2.lib.desktop-api';\n\nexport class UnsupportedBrowserFeatures\n{\n\tstatic listOfDevicesBeforeStream: boolean[] = [BX.browser.IsFirefox()];\n\tstatic listOfPiPAvailable: boolean[] = [BX.browser.IsChrome(), DesktopApi.isDesktop()];\n\n\tstatic get isNotSupportDevicesListBeforeStream(): boolean\n\t{\n\t\treturn this.listOfDevicesBeforeStream.some((browser) => browser);\n\t}\n\n\tstatic get isPiPAvailable(): boolean\n\t{\n\t\treturn this.listOfPiPAvailable.some(device => device);\n\t}\n}","import { Dom } from 'main.core';\nimport { Hardware } from '../call_hardware';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Popup } from 'main.popup';\nimport { Utils } from 'im.v2.lib.utils';\n\nimport * as Buttons from './buttons';\nimport { CallUser } from './call-user';\nimport { FloorRequest } from './floor-request';\n\nimport '../css/picture-in-picture-window.css'\nimport { UnsupportedBrowserFeatures } from '../engine/unsupported_features_in_browsers';\n\nexport class PictureInPictureWindow {\n\tconstructor(config)\n\t{\n\t\tthis.pictureWindow = null;\n\t\tthis.template = null;\n\t\tthis.userPanel = null;\n\t\tthis.actionsPanel = null;\n\t\tthis.notificationPanel = null;\n\n\t\tthis.buttons = {\n\t\t\tmicrophone: null,\n\t\t\tcamera: null,\n\t\t\treturnToCall: null,\n\t\t\tstopScreen: null,\n\t\t\tcopilot: null,\n\t\t};\n\n\t\tthis.preferInitialWindowPlacement = config.preferInitialWindowPlacement;\n\n\t\tthis.user = null;\n\t\tthis.userData = config.currentUser;\n\n\t\tthis.buttons = config.buttons || [];\n\t\tthis.blockedButtons = config.blockedButtons || [];\n\n\t\tthis.previousFloorRequestNotifications = config.floorRequestNotifications || [];\n\n\t\tthis.callbacks = {\n\t\t\tonButtonClick: BX.type.isFunction(config.onButtonClick) ? config.onButtonClick : BX.DoNothing,\n\t\t\tonClose: BX.type.isFunction(config.onClose) ? config.onClose : BX.DoNothing,\n\t\t}\n\n\t\tthis.eventEmitter = new EventEmitter(this, 'BX.Call.View');\n\n\t\tthis.isMinSize = false;\n\n\t\tthis.floorRequestElements = {\n\t\t\tcounter: null,\n\t\t\tmainNotification: null,\n\t\t\tpopup: null,\n\t\t\tpopupTemplate: null,\n\t\t};\n\n\t\tthis.floorRequestsList = [];\n\t\tthis.floorRequestTimeForHidden = 5000;\n\t\tthis.floorRequestTimeout = null;\n\t\tthis.baseWidthPopup = 244;\n\t}\n\n\t_onButtonClick({ buttonName, event })\n\t{\n\t\tthis.callbacks.onButtonClick({\n\t\t\tbuttonName,\n\t\t\tevent,\n\t\t})\n\t}\n\n\tsetUserMedia(userId, track)\n\t{\n\t\tif (!this.user || +userId !== this.user.userModel.id)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.user.videoTrack = track;\n\t};\n\n\tsetStats(userId, stats)\n\t{\n\t\tif (!this.user || +userId !== this.user.userModel.id)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.user.showStats(stats);\n\t}\n\n\tshowFloorRequestNotification(userModel)\n\t{\n\t\tlet notification = FloorRequest.create({\n\t\t\tuserModel: userModel\n\t\t});\n\n\t\tnotification.mount(this.notificationPanel);\n\t}\n\n\tsetVideoRenderer(userId, mediaRenderer)\n\t{\n\t\tif (!this.user || +userId !== this.user.userModel.id)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.user.videoRenderer = mediaRenderer;\n\t}\n\n\treleaseLocalStream(userId)\n\t{\n\t\tif (!this.user || +userId !== this.user.userModel.id)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.user.releaseStream();\n\t}\n\n\tsetCurrentUser(user)\n\t{\n\n\t\tif (!user)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.userData = user;\n\t\tconst hasUser = !!this.user;\n\t\tconst isCurrentUser = this.userData.userModel.id === this.user.userModel.id;\n\n\t\tif (hasUser && !isCurrentUser)\n\t\t{\n\t\t\tthis.destroyCurrentUser();\n\t\t}\n\n\t\tif (!hasUser || !isCurrentUser)\n\t\t{\n\t\t\tthis.renderUserPanel();\n\t\t}\n\t}\n\n\tdestroyCurrentUser()\n\t{\n\t\tif (!this.user)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.user.dismount();\n\t\tthis.user.destroy();\n\t\tthis.user = null;\n\t}\n\n\tgetCurrentUserId()\n\t{\n\t\treturn this.user?.userModel.id || null;\n\t}\n\n\tisButtonBlocked(buttonName)\n\t{\n\t\treturn this.blockedButtons.includes(buttonName);\n\t}\n\n\tupdateBlockButtons(buttonsList)\n\t{\n\t\tthis.blockedButtons = buttonsList;\n\t\treturn this;\n\t}\n\n\tsetButtons(buttonsList)\n\t{\n\t\tthis.buttons = buttonsList;\n\t\treturn this;\n\t}\n\n\tupdateButtons()\n\t{\n\t\tDom.clean(this.actionsPanel);\n\t\tthis.renderButtons();\n\t}\n\n\tgetButtonTextBySizePictureWindow(text)\n\t{\n\t\treturn this.isMinSize ? \"\" : text;\n\t}\n\n\trenderButtons()\n\t{\n\t\tif (!this.actionsPanel && this.buttons.length)\n\t\t{\n\t\t\tthis.actionsPanel = Dom.create('div', {\n\t\t\t\tprops: {\n\t\t\t\t\tclassName: 'bx-call-picture-in-picture-window__actions',\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tfor (let i = 0; i < this.buttons.length; i++)\n\t\t{\n\t\t\tswitch (this.buttons[i]) {\n\t\t\t\tcase 'microphone':\n\t\t\t\t\tthis.buttons.microphone = new Buttons.DeviceButton({\n\t\t\t\t\t\tclass: 'microphone',\n\t\t\t\t\t\tbackgroundClass: 'bx-call-picture-in-picture-window__button-background',\n\t\t\t\t\t\ttext: this.getButtonTextBySizePictureWindow(BX.message('IM_M_CALL_BTN_MIC')),\n\t\t\t\t\t\tenabled: !Hardware.isMicrophoneMuted,\n\t\t\t\t\t\tarrowHidden: true,\n\t\t\t\t\t\tarrowEnabled: false,\n\t\t\t\t\t\tshowPointer: true, //todo\n\t\t\t\t\t\tblocked: this.isButtonBlocked('microphone'),\n\t\t\t\t\t\tshowLevel: true,\n\t\t\t\t\t\tsideIcon: null,\n\t\t\t\t\t\tonClick: (event) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\t\tthis._onButtonClick({ buttonName: 'microphone', event });\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.actionsPanel.appendChild(this.buttons.microphone.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'camera':\n\t\t\t\t\tthis.buttons.camera = new Buttons.DeviceButton({\n\t\t\t\t\t\tclass: 'camera',\n\t\t\t\t\t\tbackgroundClass: 'bx-call-picture-in-picture-window__button-background',\n\t\t\t\t\t\ttext: this.getButtonTextBySizePictureWindow(BX.message('IM_M_CALL_BTN_CAMERA')),\n\t\t\t\t\t\tenabled: Hardware.isCameraOn,\n\t\t\t\t\t\tarrowHidden: true,\n\t\t\t\t\t\tblocked: this.isButtonBlocked('camera'),\n\t\t\t\t\t\tonClick: (event) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\t\tthis._onButtonClick({ buttonName: 'camera', event });\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.actionsPanel.appendChild(this.buttons.camera.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'returnToCall':\n\t\t\t\t\tthis.buttons.returnToCall = new Buttons.SimpleButton({\n\t\t\t\t\t\tclass: 'go-to-call',\n\t\t\t\t\t\tbackgroundClass: 'bx-call-picture-in-picture-window__button-background bx-messenger-videocall-panel-icon-background-go-to-call',\n\t\t\t\t\t\ttext: this.getButtonTextBySizePictureWindow(BX.message('CALL_BUTTON_GO_TO_CALL')),\n\t\t\t\t\t\tonClick: (event) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\t\tthis._onButtonClick({ buttonName: 'returnToCall', event });\n\t\t\t\t\t\t\twindow.focus();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tthis.actionsPanel.appendChild(this.buttons.returnToCall.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'stop-screen':\n\t\t\t\t\tthis.buttons.stopScreen = new Buttons.SimpleButton({\n\t\t\t\t\t\tclass: 'stop-screen',\n\t\t\t\t\t\tbackgroundClass: 'bx-call-picture-in-picture-window__button-background',\n\t\t\t\t\t\ttext: this.getButtonTextBySizePictureWindow(BX.message('CALL_BUTTON_STOP_SCREEN')),\n\t\t\t\t\t\tblocked: this.isButtonBlocked('screen'),\n\t\t\t\t\t\tonClick: (event) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\t\tthis._onButtonClick({ buttonName: 'stop-screen', event });\n\t\t\t\t\t\t\twindow.focus();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.actionsPanel.appendChild(this.buttons.stopScreen.render());\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\trenderUserPanel()\n\t{\n\t\tif (!this.userPanel)\n\t\t{\n\t\t\tthis.userPanel = Dom.create('div', {\n\t\t\t\tprops: {\n\t\t\t\t\tclassName: 'bx-call-picture-in-picture-window__user',\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tif (!this.user)\n\t\t{\n\t\t\tthis.user = new CallUser({\n\t\t\t\tparentContainer: this.userPanel,\n\t\t\t\tuserModel: this.userData.userModel,\n\t\t\t\tavatarBackground: this.userData.avatarBackground,\n\t\t\t\tallowPinButton: false,\n\t\t\t\tallowBackgroundItem: false,\n\t\t\t\tallowMaskItem: false,\n\t\t\t\talwaysShowName: true,\n\t\t\t\tflipVideo: this.userData.userModel.localUser,\n\t\t\t\thiddenFloorRequest: true,\n\t\t\t\thiddenRemoteParticipantButtonMenu: true,\n\t\t\t\tonClick: (event) =>\n\t\t\t\t{\n\t\t\t\t\tthis._onButtonClick({ buttonName: 'returnToCall', event });\n\t\t\t\t\twindow.focus();\n\t\t\t\t},\n\t\t\t});\n\t\t\tthis.user.mount(this.userPanel);\n\t\t}\n\n\t\tif (this.userData.previewRenderer)\n\t\t{\n\t\t\tthis.user.videoRenderer = this.userData.previewRenderer;\n\t\t}\n\n\t\tif (this.userData.videoRenderer)\n\t\t{\n\t\t\tthis.user.videoRenderer = this.userData.videoRenderer\n\t\t}\n\t}\n\n\trenderNotificationPanel()\n\t{\n\t\tif (!this.notificationPanel)\n\t\t{\n\t\t\tthis.notificationPanel = Dom.create('div', {\n\t\t\t\tprops: { className: 'bx-call-picture-in-picture-window__notifications bx-messenger-videocall-notification-panel' },\n\t\t\t});\n\t\t}\n\t}\n\n\tupdateFloorRequestsList({ floorRequestsList, user })\n\t{\n\t\tif (floorRequestsList)\n\t\t{\n\t\t\tthis.floorRequestsList = [...floorRequestsList.map(floorRequestsListItem =>\n\t\t\t{\n\t\t\t\treturn {\n\t\t\t\t\tuserModel: floorRequestsListItem.userModel,\n\t\t\t\t\tavatarBackgroundColor: floorRequestsListItem.avatarBackgroundColor,\n\t\t\t\t\tinitials: Utils.text.getFirstLetters(floorRequestsListItem.userModel.name).toUpperCase(),\n\t\t\t\t}\n\t\t\t})];\n\t\t\tthis.updateFloorRequestCounter();\n\t\t\treturn;\n\t\t}\n\n\t\tif (!user)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst userInFloorRequestsListIndex = this.floorRequestsList.findIndex(el => el.userModel.id === user.userModel.id);\n\t\tconst hasUserInFloorRequestsList = userInFloorRequestsListIndex !== -1;\n\t\tconst isActiveFloorRequestState = user.userModel.floorRequestState;\n\n\t\tif (hasUserInFloorRequestsList === isActiveFloorRequestState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (isActiveFloorRequestState)\n\t\t{\n\t\t\tthis.floorRequestsList.push({\n\t\t\t\tuserModel: user.userModel,\n\t\t\t\tavatarBackgroundColor: user.avatarBackgroundColor,\n\t\t\t\tinitials: Utils.text.getFirstLetters(user.userModel.name).toUpperCase(),\n\t\t\t});\n\t\t}\n\n\t\tif (!isActiveFloorRequestState)\n\t\t{\n\t\t\tthis.floorRequestsList.splice(userInFloorRequestsListIndex, 1);\n\t\t}\n\n\t\tthis.updateFloorRequestCounter();\n\t}\n\n\tupdateFloorRequestCounter(withoutRenderTemplate = false)\n\t{\n\t\tif (this.floorRequestElements.counter)\n\t\t{\n\t\t\tthis.floorRequestElements.counter.innerText = this.floorRequestsList.length;\n\t\t\tthis.updateVisibilityFloorRequestCounter();\n\t\t}\n\n\t\tif (!withoutRenderTemplate)\n\t\t{\n\t\t\tthis.updateTemplateForFloorRequestsPopup();\n\t\t}\n\t}\n\n\tgetTemplateForFloorRequestsPopup()\n\t{\n\t\tconst self = this;\n\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: { className: 'bx-call-picture-in-picture-window__popup-template' },\n\t\t\tchildren: (\n\t\t\t\tfunction()\n\t\t\t\t{\n\t\t\t\t\tconst items = [];\n\n\t\t\t\t\tself.floorRequestsList.forEach((floorRequestsListItem, floorRequestsListItemIndex) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tlet avatarElement;\n\n\t\t\t\t\t\titems.push(\n\t\t\t\t\t\t\tDom.create(\"li\", {\n\t\t\t\t\t\t\t\tprops: { className: 'bx-call-picture-in-picture-window__floor-request-item' },\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\tavatarElement = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\tclassName: 'bx-call-picture-in-picture-window__floor-request-avatar',\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-picture-in-picture-window__floor-request-name' },\n\t\t\t\t\t\t\t\t\t\ttext: floorRequestsListItem.userModel.name,\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-picture-in-picture-window__floor-request-index' },\n\t\t\t\t\t\t\t\t\t\ttext: floorRequestsListItemIndex + 1,\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tif (floorRequestsListItem.userModel.avatar)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tavatarElement.style.setProperty('--avatar', `url('${floorRequestsListItem.userModel.avatar}')`);\n\t\t\t\t\t\t\tavatarElement.innerText = '';\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tavatarElement.style.setProperty(\"--avatar-color\", floorRequestsListItem.avatarBackgroundColor);\n\t\t\t\t\t\t\tavatarElement.innerText = floorRequestsListItem.initials;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\treturn items;\n\t\t\t\t}\n\t\t\t)(),\n\t\t});\n\t}\n\n\tupdateTemplateForFloorRequestsPopup()\n\t{\n\t\tconst tmpTemplate = this.getTemplateForFloorRequestsPopup();\n\n\t\tif (this.floorRequestElements.template)\n\t\t{\n\t\t\tDom.remove(this.floorRequestElements.template)\n\t\t}\n\n\t\tthis.floorRequestElements.popupTemplate = tmpTemplate;\n\n\t\tif (!this.floorRequestElements.popup)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.floorRequestsList.length)\n\t\t{\n\t\t\tthis.floorRequestElements.popup.close();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.floorRequestElements.popup.setContent(this.floorRequestElements.popupTemplate);\n\t}\n\n\tcloseFloorRequestMainNotification({ withoutAdditionInList, user, withoutDismount })\n\t{\n\t\tif (this.floorRequestTimeout)\n\t\t{\n\t\t\tclearTimeout(this.floorRequestTimeout);\n\t\t\tthis.floorRequestTimeout = null;\n\t\t}\n\n\t\tif (this.floorRequestElements.mainNotification && !withoutDismount)\n\t\t{\n\t\t\tthis.floorRequestElements.mainNotification.dismount();\n\t\t}\n\n\t\tif (!withoutAdditionInList && user)\n\t\t{\n\t\t\tthis.updateFloorRequestsList({ user });\n\t\t}\n\t}\n\n\tupdateFloorRequestState({ userModel, avatarBackgroundColor })\n\t{\n\t\tif (\n\t\t\tthis.floorRequestElements.mainNotification\n\t\t\t&& this.floorRequestElements.mainNotification.userModel\n\t\t\t&& this.floorRequestElements.mainNotification.userModel.id === userModel.id\n\t\t\t&& !userModel.floorRequestState)\n\t\t{\n\t\t\tthis.floorRequestElements.mainNotification = null;\n\t\t}\n\n\t\tif (userModel.floorRequestState)\n\t\t{\n\t\t\tthis.updateFloorRequestMainNotification({\n\t\t\t\tuserModel,\n\t\t\t\tavatarBackgroundColor\n\t\t\t});\n\t\t}\n\n\t\tif (!userModel.floorRequestState)\n\t\t{\n\t\t\tthis.updateFloorRequestsList({\n\t\t\t\tuser: {\n\t\t\t\t\tuserModel,\n\t\t\t\t\tavatarBackgroundColor,\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tupdateFloorRequestMainNotification({ userModel, avatarBackgroundColor })\n\t{\n\t\tif (!this.notificationPanel)\n\t\t{\n\t\t\tthis.renderNotificationPanel();\n\t\t}\n\n\t\tif (this.floorRequestElements.mainNotification)\n\t\t{\n\t\t\tthis.closeFloorRequestMainNotification({\n\t\t\t\twithoutAdditionInList: false,\n\t\t\t\tuser: {\n\t\t\t\t\tuserModel: this.floorRequestElements.mainNotification.userModel,\n\t\t\t\t\tavatarBackgroundColor: this.floorRequestElements.mainNotification.avatarBackgroundColor,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tthis.floorRequestElements.mainNotification = FloorRequest.create({\n\t\t\tuserModel: userModel,\n\t\t\tonDestroy: () =>\n\t\t\t{\n\t\t\t\tthis.closeFloorRequestMainNotification({\n\t\t\t\t\twithoutAdditionInList: !userModel.floorRequestState,\n\t\t\t\t\tuser: {\n\t\t\t\t\t\tuserModel,\n\t\t\t\t\t\tavatarBackgroundColor\n\t\t\t\t\t},\n\t\t\t\t\twithoutDismount: true\n\t\t\t\t});\n\t\t\t\tthis.floorRequestElements.mainNotification = null;\n\t\t\t},\n\t\t});\n\n\t\tthis.floorRequestElements.mainNotification.mount(this.notificationPanel);\n\n\t\tthis.floorRequestTimeout = setTimeout(() => {\n\t\t\tthis.closeFloorRequestMainNotification({\n\t\t\t\twithoutAdditionInList: false,\n\t\t\t\tuser: {\n\t\t\t\t\tuserModel,\n\t\t\t\t\tavatarBackgroundColor,\n\t\t\t\t},\n\t\t\t})\n\t\t}, this.floorRequestTimeForHidden);\n\t}\n\n\tupdateVisibilityFloorRequestCounter()\n\t{\n\t\tconst isHidden = !this.floorRequestsList.length;\n\n\t\tif (!this.floorRequestElements.counter)\n\t\t{\n\t\t\tthis.renderFloorRequestCounter();\n\t\t}\n\n\t\tconst hiddenClass = 'bx-call-picture-in-picture-window__floor-requests_hidden';\n\t\tconst hasHiddenClass = this.floorRequestElements.counter.classList.contains(hiddenClass);\n\n\t\tif (hasHiddenClass === isHidden)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.floorRequestElements.counter.classList.toggle(hiddenClass);\n\t}\n\n\tonMouseOutCallbackForPopup(event)\n\t{\n\t\tif (!this.floorRequestElements.popup)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst composedPath = event.composedPath();\n\t\tif (composedPath.some(element => element.classList && (element.classList.contains('bx-call-picture-in-picture-window__floor-requests') || element.classList.contains('bx-call-picture-in-picture-window__popup'))))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.floorRequestElements.popup.close();\n\t}\n\n\tsetNewSettingForPopup()\n\t{\n\t\tif (!this.pictureWindow.document.body || !this.floorRequestElements.popup || !this.floorRequestElements.counter)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst { clientHeight, clientWidth } = this.pictureWindow.document.body;\n\t\tconst bindElement = this.floorRequestElements.counter;\n\t\tconst bindElementPos = bindElement.getBoundingClientRect();\n\t\tconst { bottom } = bindElementPos;\n\t\tconst baseOffsetHorizontalPopup = 16;\n\t\tconst baseOffsetVerticalPopup = baseOffsetHorizontalPopup / 2;\n\t\tconst maxWidthPopup = clientWidth - baseOffsetHorizontalPopup * 2;\n\t\tconst widthPopup = this.baseWidthPopup <= maxWidthPopup ? this.baseWidthPopup : maxWidthPopup;\n\t\tconst heightWidth = clientHeight - bottom - (baseOffsetVerticalPopup * 2);\n\n\t\tthis.floorRequestElements.popup.setOffset({\n\t\t\toffsetLeft: clientWidth - baseOffsetHorizontalPopup - widthPopup,\n\t\t\toffsetTop: baseOffsetVerticalPopup,\n\t\t});\n\n\t\tthis.floorRequestElements.popup.setWidth(widthPopup);\n\t\tthis.floorRequestElements.popup.setMaxHeight(heightWidth);\n\t}\n\n\trenderFloorRequestCounter()\n\t{\n\t\tif (!!this.floorRequestElements.counter)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.floorRequestElements.counter = Dom.create('div', {\n\t\t\tprops: {\n\t\t\t\tclassName: 'bx-call-picture-in-picture-window__floor-requests',\n\t\t\t},\n\t\t\ttext: this.floorRequestsList.length,\n\t\t\tevents: {\n\t\t\t\tmouseover: (event) => {\n\t\t\t\t\tevent.stopPropagation();\n\n\t\t\t\t\tconst self = this;\n\n\t\t\t\t\tif (!this.floorRequestElements.popup && !this.isMinSize)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.updateTemplateForFloorRequestsPopup();\n\t\t\t\t\t\tthis.floorRequestElements.popup = new Popup({\n\t\t\t\t\t\t\tclassName : \"bx-call-picture-in-picture-window__popup\",\n\t\t\t\t\t\t\tbindElement: this.floorRequestElements.counter,\n\t\t\t\t\t\t\ttargetContainer: this.pictureWindow.document.body,\n\t\t\t\t\t\t\tcontent: this.floorRequestElements.popupTemplate,\n\t\t\t\t\t\t\tbindOptions: {\n\t\t\t\t\t\t\t\tposition: \"top\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tautoHide: true,\n\t\t\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\t\t\tbackground: '#ffffff',\n\t\t\t\t\t\t\tcontentBackground: '#ffffff',\n\t\t\t\t\t\t\tdarkMode: false,\n\t\t\t\t\t\t\tcontentNoPaddings: true,\n\t\t\t\t\t\t\tanimation: \"fading\",\n\t\t\t\t\t\t\tpadding: 0,\n\t\t\t\t\t\t\tcontentBorderRadius: '18px',\n\t\t\t\t\t\t\tzIndex: 11,\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tonPopupClose: function ()\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.destroy();\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tonPopupDestroy: function ()\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tself.floorRequestElements.popup = null;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.setNewSettingForPopup();\n\t\t\t\t\tthis.floorRequestElements.popup.show();\n\t\t\t\t},\n\t\t\t}\n\t\t});\n\n\t\tthis.updateFloorRequestCounter(true);\n\t}\n\n\trender()\n\t{\n\t\tthis.renderButtons();\n\t\tthis.renderUserPanel();\n\t\tthis.renderNotificationPanel();\n\t\tthis.renderFloorRequestCounter();\n\t\tthis.updateFloorRequestsList({\n\t\t\tfloorRequestsList: this.previousFloorRequestNotifications,\n\t\t})\n\n\t\tthis.template = Dom.create('div', {\n\t\t\tprops: {\n\t\t\t\tclassName: 'bx-call-picture-in-picture-window',\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tclick: (event) =>\n\t\t\t\t{\n\t\t\t\t\tthis._onButtonClick({ buttonName: 'returnToCall', event });\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tif (!!this.userPanel)\n\t\t{\n\t\t\tthis.template.appendChild(this.userPanel);\n\t\t}\n\n\t\tif (!!this.actionsPanel)\n\t\t{\n\t\t\tthis.template.appendChild(this.actionsPanel);\n\t\t}\n\n\t\tif (!!this.notificationPanel)\n\t\t{\n\t\t\tthis.template.appendChild(this.notificationPanel);\n\t\t}\n\n\t\tif (!!this.floorRequestElements.counter)\n\t\t{\n\t\t\tthis.template.appendChild(this.floorRequestElements.counter);\n\t\t}\n\t}\n\n\tsetSizePictureWindow()\n\t{\n\t\t// TODO: debounce/throttle\n\t\tif (!this.template)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst pictureWindowHeight = this.template.clientHeight;\n\t\tconst isMinSize = pictureWindowHeight <= 80;\n\n\t\tif (this.isMinSize === isMinSize)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (isMinSize && !!this.floorRequestElements.popup)\n\t\t{\n\t\t\tthis.floorRequestElements.popup.close();\n\t\t}\n\n\t\tthis.isMinSize = isMinSize;\n\n\t\tthis.updateButtons();\n\t\tthis.template.classList[this.isMinSize ? 'add' : 'remove']('bx-call-picture-in-picture-window_min');\n\t}\n\n\tsetAvatarSettings()\n\t{\n\t\tif (!this.userPanel)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst avatarSize = this.userPanel.clientHeight * 0.45;\n\t\tconst avatarTextSize = avatarSize * 0.45;\n\n\t\tthis.userPanel.style.setProperty('--avatar-size', avatarSize + 'px');\n\t\tthis.userPanel.style.setProperty('--avatar-text-size', avatarTextSize + 'px');\n\t}\n\n\tonMouseMove(event)\n\t{\n\t\tthis.onMouseOutCallbackForPopup(event);\n\t}\n\n\tonResize()\n\t{\n\t\tthis.setAvatarSettings();\n\t\tthis.setSizePictureWindow();\n\n\t\tif (this.floorRequestElements.popup)\n\t\t{\n\t\t\tthis.floorRequestElements.popup.close();\n\t\t}\n\t}\n\n\ttoggleEvents(isActive)\n\t{\n\t\tconst eventName = isActive ? 'addEventListener' : 'removeEventListener';\n\n\t\tif (this.pictureWindow)\n\t\t{\n\t\t\tthis.pictureWindow[eventName]('pagehide', (event) => {\n\t\t\t\tthis.onClose();\n\t\t\t});\n\n\t\t\tthis.pictureWindow[eventName]('resize', (event) => {\n\t\t\t\tthis.onResize();\n\t\t\t});\n\n\t\t\tthis.pictureWindow[eventName]('mousemove', (event) => {\n\t\t\t\tthis.onMouseMove(event);\n\t\t\t});\n\t\t}\n\t}\n\n\tasync checkAvailableAndCreate()\n\t{\n\t\tif (this.pictureWindow)\n\t\t{\n\t\t\treturn this.pictureWindow;\n\t\t}\n\n\t\tif (window.documentPictureInPicture?.requestWindow)\n\t\t{\n\t\t\tthis.render();\n\n\t\t\ttry\n\t\t\t{\n\t\t\t\tthis.pictureWindow = await window.documentPictureInPicture.requestWindow({\n\t\t\t\t\tdisallowReturnToOpener: true,\n\t\t\t\t\twidth: 370,\n\t\t\t\t\theight: 215,\n\t\t\t\t\tpreferInitialWindowPlacement: false,\n\t\t\t\t});\n\n\t\t\t\tthis.toggleEvents(true);\n\n\t\t\t\t[...document.styleSheets].forEach((styleSheet) => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst cssRules = [...styleSheet.cssRules].map((rule) => rule.cssText).join('');\n\t\t\t\t\t\tconst style = document.createElement('style');\n\n\t\t\t\t\t\tstyle.textContent = cssRules;\n\t\t\t\t\t\tthis.pictureWindow.document.head.appendChild(style);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconst link = document.createElement('link');\n\n\t\t\t\t\t\tlink.rel = 'stylesheet';\n\t\t\t\t\t\tlink.type = styleSheet.type;\n\t\t\t\t\t\tlink.media = styleSheet.media;\n\t\t\t\t\t\tlink.href = styleSheet.href;\n\t\t\t\t\t\tthis.pictureWindow.document.head.appendChild(link);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tthis.pictureWindow.document.body.append(this.template);\n\t\t\t}\n\t\t\tcatch (error)\n\t\t\t{\n\t\t\t\tif (error.name === \"NotAllowedError\")\n\t\t\t\t{\n\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t'It seems you closed the Picture-in-Picture window while selecting a screen to share. ' +\n\t\t\t\t\t\t'We cannot reopen it without your permission. ' +\n\t\t\t\t\t\t'If you need PiP again, please reopen it manually.'\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tthis.onClose();\n\t\t\t}\n\n\t\t} else {\n\t\t\tthis.onClose();\n\t\t}\n\t}\n\n\tonClose()\n\t{\n\t\tif (typeof this.callbacks?.onClose === 'function')\n\t\t{\n\t\t\tthis.callbacks.onClose();\n\t\t}\n\n\t\tif (this.template)\n\t\t{\n\t\t\tBX.remove(this.template);\n\t\t}\n\n\t\tthis.destroyCurrentUser();\n\n\t\tthis.close();\n\t\tthis.pictureWindow = null;\n\n\t\tthis.template = null;\n\t\tthis.toggleEvents(false);\n\t}\n\n\tclose()\n\t{\n\t\tif (this.pictureWindow)\n\t\t{\n\t\t\tthis.pictureWindow.close();\n\t\t}\n\t}\n\n\tstatic get isAvailable(): boolean\n\t{\n\t\treturn UnsupportedBrowserFeatures.isPiPAvailable\n\t}\n}","import {Type} from 'main.core';\nimport {Menu, MenuManager} from 'main.popup';\n\nexport class UserSelector\n{\n\tconstructor(config)\n\t{\n\t\tthis.userList = config.userList;\n\t\tthis.current = config.current;\n\t\tthis.parentElement = config.parentElement;\n\t\tthis.zIndex = config.zIndex;\n\n\t\tthis.menu = null;\n\n\t\tthis.callbacks = {\n\t\t\tonSelect: Type.isFunction(config.onSelect) ? config.onSelect : BX.DoNothing\n\t\t}\n\t};\n\n\tstatic create(config)\n\t{\n\t\treturn new UserSelector(config);\n\t}\n\n\tshow()\n\t{\n\t\tlet menuItems = [];\n\n\t\tthis.userList.forEach((user) =>\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\tid: user.id,\n\t\t\t\ttext: user.name || \"unknown (\" + user.id + \")\",\n\t\t\t\tclassName: (this.current == user.id ? \"menu-popup-item-accept\" : \"device-selector-empty\"),\n\t\t\t\tonclick: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.menu.close();\n\t\t\t\t\tthis.callbacks.onSelect(user.id);\n\t\t\t\t}\n\t\t\t})\n\t\t});\n\n\t\tthis.menu = new Menu({\n\t\t\tid: 'call-view-select-user',\n\t\t\tbindElement: this.parentElement,\n\t\t\titems: menuItems,\n\t\t\tautoHide: true,\n\t\t\tzIndex: this.zIndex,\n\t\t\tcloseByEsc: true,\n\t\t\toffsetTop: 0,\n\t\t\toffsetLeft: 0,\n\t\t\tbindOptions: {\n\t\t\t\tposition: 'bottom'\n\t\t\t},\n\t\t\tangle: false,\n\t\t\toverlay: {\n\t\t\t\tbackgroundColor: 'white',\n\t\t\t\topacity: 0\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tonPopupClose: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.menu.popupWindow.destroy();\n\t\t\t\t\tMenuManager.destroy('call-view-select-device');\n\t\t\t\t},\n\t\t\t\tonPopupDestroy: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.menu = null;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.menu.popupWindow.show();\n\t}\n}","import { Dom, Loc } from 'main.core';\nimport { Popup } from 'main.popup';\nimport { PromoManager } from 'im.v2.lib.promo';\n\nimport '../css/aha-moment-notify.css';\n\nconst SPOTLIGHT_ID_PREFIX = 'bx-call-aha-moment-notify_spotlight';\n\nexport class AhaMomentNotify {\n\tconstructor(config)\n\t{\n\t\tthis.popup = null;\n\t\tthis.id = config.id || Math.random().toString(16).slice(2);\n\t\tthis.notifyText = config.notifyText || '';\n\t\tthis.notifyTitle = config.notifyTitle || '';\n\t\tthis.promoId = config.promoId || '';\n\t\tthis.popupTemplate = null;\n\t\tthis.bindElement = config.bindElement;\n\t\tthis.notifyColor = '#22272B';\n\t\tthis.spotlight = null;\n\n\t\tthis.callbacks = {\n\t\t\tonClose: BX.type.isFunction(config.onClose) ? config.onClose : BX.DoNothing,\n\t\t}\n\t}\n\n\tgetPopupTemplate()\n\t{\n\t\tif (this.popupTemplate)\n\t\t{\n\t\t\treturn;\n\t\t}\t\t\t\n\t\t\n\t\tthis.popupTemplate = Dom.create('div', {\n\t\t\tprops: {className: 'bx-call-aha-moment-notify__content'},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'bx-call-aha-moment-line-top'},\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'bx-call-aha-moment-notify__title'},\n\t\t\t\t\ttext: this.notifyTitle,\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'bx-call-aha-moment-notify__message'},\n\t\t\t\t\ttext: this.notifyText,\n\t\t\t\t}),\n\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\tprops: {className: 'popup-window-close-icon'},\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\tif (this.promoId)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tPromoManager.getInstance().markAsWatched(this.promoId);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t]\n\t\t});\n\t}\n\t\n\tgetSpotlight()\n\t{\n\t\tif (!this.bindElement)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tif (this.spotlight)\n\t\t{\n\t\t\tthis.spotlight.close();\n\t\t\tthis.spotlight = null;\n\t\t}\t\t\n\t\t\n\t\tconst id = `${SPOTLIGHT_ID_PREFIX}_${this.id}`;\n\n\t\tthis.spotlight = new BX.SpotLight({\n\t\t\tid,\n\t\t\ttargetElement: this.bindElement,\n\t\t\ttargetVertex: 'middle-center',\n\t\t\tlightMode: true,\n\t\t\tzIndex: 1500,\n\t\t});\t\t\n\n\t\treturn this.spotlight;\n\t}\n\n\tcreate()\n\t{\n\t\tconst self = this;\n\n\t\tthis.getPopupTemplate();\n\n\t\tif (!this.bindElement || !this.popupTemplate || this.popup)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.popup = new Popup({\n\t\t\tclassName : 'bx-call-aha-moment-notify',\n\t\t\tbindElement: this.bindElement,\n\t\t\ttargetContainer: document.body,\n\t\t\tcontent: this.popupTemplate,\n\t\t\tbindOptions: {\n\t\t\t\tposition: 'bottom',\n\t\t\t\tforceBindPosition: true,\n\t\t\t},\n\t\t\toffsetTop: 23,\n\t\t\tbackground: this.notifyColor,\n\t\t\tcontentBackground: this.notifyColor,\n\t\t\tdarkMode: true,\n\t\t\tanimation: 'fading',\n\t\t\tautoHide: false,\n\t\t\tevents: {\n\t\t\t\tonPopupClose: function ()\n\t\t\t\t{\n\t\t\t\t\tself.callbacks.onClose();\n\t\t\t\t\tif (self.spotlight)\n\t\t\t\t\t{\n\t\t\t\t\t\tself.spotlight.close();\n\t\t\t\t\t}\n\t\t\t\t\tthis.destroy();\n\t\t\t\t},\n\t\t\t\tonPopupDestroy: function ()\n\t\t\t\t{\n\t\t\t\t\tself.popup = null;\n\t\t\t\t},\n\t\t\t\tonShow: () => {\n\t\t\t\t\tconst popupWidth = this.popup.getPopupContainer().offsetWidth;\n\t\t\t\t\tconst elementWidth = this.popup.bindElement.offsetWidth;\n\t\t\t\t\tconst offsetFix = 0;\n\n\t\t\t\t\tthis.popup.setOffset({\n\t\t\t\t\t\toffsetLeft: elementWidth - offsetFix - popupWidth / 2\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.popup.setAngle({\n\t\t\t\t\t\toffset: (popupWidth / 2) - 33,\n\t\t\t\t\t\tposition: 'top',\n\t\t\t\t\t});\n\t\t\t\t\tthis.popup.adjustPosition();\n\t\t\t\t},\n\t\t\t\tonClose: () => {\n\t\t\t\t\tif (self.spotlight)\n\t\t\t\t\t{\n\t\t\t\t\t\tself.spotlight.close();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t}\n\t\t});\n\t}\n\n\tshow()\n\t{\n\t\tthis.create();\n\n\t\tif (!this.bindElement || !this.popupTemplate)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tif(!this.spotlight)\n\t\t{\n\t\t\tthis.getSpotlight();\n\t\t}\n\t\t\n\t\tthis.spotlight.show();\n\t\tthis.spotlight.getTargetContainer().hidden = false;\n\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.show();\n\t\t}\n\t}\n\n\tclose()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t}\n\t\t\n\t\tif (this.spotlight)\n\t\t{\n\t\t\tthis.spotlight.close();\n\t\t}\n\t}\n}\n","import { Browser, Dom, Runtime, Text, Type, Loc } from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\nimport {Popup} from 'main.popup';\nimport {DesktopApi} from 'im.v2.lib.desktop-api';\n\nimport {UserModel, UserRegistry} from './user-registry'\nimport * as Buttons from './buttons';\nimport {BackgroundDialog} from '../dialogs/background_dialog';\nimport {CallUserMobile, MobileMenu, MobileSlider, UserSelectorMobile} from './mobile';\nimport {CallUser} from './call-user';\nimport {Hardware} from '../call_hardware';\nimport {FloorRequest} from './floor-request';\nimport {NotificationManager} from './notifications';\nimport {DeviceSelector} from './device-selector';\nimport {EndpointDirection, UserState} from '../engine/engine';\nimport Util from '../util';\nimport { CallAI } from '../call_ai';\nimport { CopilotNotify, CopilotNotifyType } from './copilot-notify';\nimport { MediaRenderer } from './media-renderer';\nimport { PictureInPictureWindow } from './pictureInPictureWindow';\nimport { Utils } from 'im.v2.lib.utils';\nimport {UserSelector} from './user-selector';\nimport { checkAndEncodeURI } from './tools';\n\nimport { PromoManager } from 'im.v2.lib.promo';\nimport { AhaMomentNotify } from './aha-moment-notify';\n\nimport '../css/view.css';\n\nconst Layouts = {\n\tGrid: 1,\n\tCentered: 2,\n\tMobile: 3\n};\n\nconst RerenderReason = {\n\tVideoEnabled: 'videoEnabled',\n\tVideoDisabled: 'videoDisabled',\n\tUserDisconnected: 'userDisconnected',\n};\n\nconst SwapType = {\n\tDirect: 'direct',\n\tReplace: 'replace',\n};\n\nconst UiState = {\n\tPreparing: 1,\n\tInitializing: 2,\n\tCalling: 3,\n\tConnected: 4,\n\tError: 5\n};\n\nconst Size = {\n\tFolded: 'folded',\n\tFull: 'full'\n};\n\nconst RecordState = {\n\tStarted: 'started',\n\tResumed: 'resumed',\n\tPaused: 'paused',\n\tStopped: 'stopped'\n};\n\nconst RecordType = {\n\tNone: 'none',\n\tVideo: 'video',\n\tAudio: 'audio',\n};\n\nconst RoomState = {\n\tNone: 1,\n\tSpeaker: 2,\n\tNonSpeaker: 3,\n}\n\nconst EventName = {\n\tonShow: 'onShow',\n\tonClose: 'onClose',\n\tonDestroy: 'onDestroy',\n\tonButtonClick: 'onButtonClick',\n\tonBodyClick: 'onBodyClick',\n\tonReplaceCamera: 'onReplaceCamera',\n\tonReplaceMicrophone: 'onReplaceMicrophone',\n\tonReplaceSpeaker: 'onReplaceSpeaker',\n\tonSetCentralUser: 'onSetCentralUser',\n\tonLayoutChange: 'onLayoutChange',\n\tonChangeHdVideo: 'onChangeHdVideo',\n\tonChangeMicAutoParams: 'onChangeMicAutoParams',\n\tonChangeFaceImprove: 'onChangeFaceImprove',\n\tonUserClick: 'onUserClick',\n\tonUserRename: 'onUserRename',\n\tonUserPinned: 'onUserPinned',\n\tonDeviceSelectorShow: 'onDeviceSelectorShow',\n\tonOpenAdvancedSettings: 'onOpenAdvancedSettings',\n\tonHasMainStream: 'onHasMainStream',\n\tonTurnOffParticipantMic: 'onTurnOffParticipantMic',\n\tonTurnOffParticipantCam: 'onTurnOffParticipantCam',\n\tonTurnOffParticipantScreenshare: 'onTurnOffParticipantScreenshare',\n\tonAllowSpeakPermission: 'onAllowSpeakPermission',\n\tonDisallowSpeakPermission: 'onDisallowSpeakPermission',\n\tonToggleSubscribe: 'onToggleSubscribe',\n\tonUnfold: 'onUnfold',\n\tonPiPClose: 'onPiPClose',\n};\n\nconst beginingPosition = -1;\nconst newUserPosition = 999;\nconst addButtonPosition = 1001;\n\nconst MIN_WIDTH = 250;\n\nconst SIDE_USER_WIDTH = 160; // keep in sync with .bx-messenger-videocall-user-block .bx-messenger-videocall-user width\nconst SIDE_USER_HEIGHT = 90; // keep in sync with .bx-messenger-videocall-user height\n\nconst MAX_USERS_PER_PAGE = 19;\nconst MIN_GRID_USER_WIDTH = 180;\nconst MIN_GRID_USER_HEIGHT = 100;\n\nconst CHANGE_VIDEO_RERENDER_DELAY = 3000;\nconst WAITING_VIDEO_DELAY = 3000;\n\nconst CALLCONTROL_PROMO_ID = 'call:callcontrol-notify-promo:07052025:all';\n\ntype ViewOptions = {\n\ttitle: ?string,\n\tcontainer: HTMLElement,\n\tbaseZIndex: number,\n\tcameraId: string,\n\tmicrophoneId: string,\n\tshowChatButtons: boolean,\n\tshowUsersButton: boolean,\n\tshowShareButton: boolean,\n\tshowRecordButton: boolean,\n\tshowDocumentButton: boolean,\n\tshowButtonPanel: boolean,\n\tbroadcastingMode: boolean,\n\tbroadcastingPresenters: number[],\n\tlanguage: string,\n\tuserData: {},\n\tuserLimit: number,\n\tisIntranetOrExtranet: boolean,\n\tmediaSelectionBlocked: boolean,\n\tblockedButtons: string[],\n\thiddenButtons: string[],\n\thiddenTopButtons: string[],\n\tuiState: string,\n\tlayout: string,\n\tuserStates: {},\n\tshowAddUserButtonInList?: boolean,\n\tisCopilotFeaturesEnabled: boolean,\n\tisCopilotActive: boolean,\n\tisWindowFocus?: boolean,\n\tisVideoconf: boolean,\n}\n\nconst DocumentVisibilityState = {\n\thidden: 'hidden',\n\tvisible: 'visible',\n};\n\nexport class View\n{\n\tcentralUser: CallUser\n\tcallMenu: ?MobileMenu\n\tparticipantsMenu: ?MobileMenu\n\tpinnedUser: ?CallUser\n\tuserMenu: ?MobileMenu\n\tuserRegistry: UserRegistry\n\tusers: { [key: number]: CallUser; }\n\tscreenUsers: { [key: number]: CallUser; }\n\n\tconstructor(config: ViewOptions)\n\t{\n\t\tthis.title = config.title;\n\t\tthis.container = config.container;\n\t\tthis.baseZIndex = config.baseZIndex;\n\t\tthis.cameraId = config.cameraId;\n\t\tthis.microphoneId = config.microphoneId;\n\n\t\tthis.speakerId = '';\n\t\tthis.speakerMuted = false;\n\t\tthis.showChatButtons = (config.showChatButtons === true);\n\t\tthis.showUsersButton = (config.showUsersButton === true);\n\t\tthis.showShareButton = (config.showShareButton !== false);\n\t\tthis.showRecordButton = (config.showRecordButton !== false);\n\t\tthis.showDocumentButton = (config.showDocumentButton !== false);\n\t\tthis.showCopilotButton = (config.showCopilotButton !== false);\n\t\tthis.showButtonPanel = (config.showButtonPanel !== false);\n\t\tthis.showAddUserButtonInList = config.showAddUserButtonInList || false;\n\t\tthis.preferInitialWindowPlacementPictureInPicture = true;\n\n\t\tthis.limitation = null;\n\t\tthis.inactiveUsers = [];\n\t\tthis.activeUsers = [];\n\t\tthis.rerenderTimeout = null;\n\t\tthis.waitingForUserMediaTimeouts = new Map();\n\t\tthis.rerenderQueue = new Map();\n\t\tthis.shelvedRerenderQueue = new Map();\n\n\t\tthis.broadcastingMode = BX.prop.getBoolean(config, \"broadcastingMode\", false);\n\t\tthis.broadcastingPresenters = BX.prop.getArray(config, \"broadcastingPresenters\", []);\n\n\t\tthis.currentPage = 1;\n\t\tthis.pagesCount = 1;\n\n\t\tthis.usersPerPage = 0; // initializes after rendering and on resize\n\n\t\tthis.language = config.language || '';\n\n\t\tthis.lastPosition = 1;\n\n\t\tthis.userData = {};\n\t\tif (config.userData)\n\t\t{\n\t\t\tthis.updateUserData(config.userData);\n\t\t}\n\t\tthis.userLimit = config.userLimit || 1;\n\t\tthis.userId = BX.message('USER_ID');\n\t\tthis.isIntranetOrExtranet = BX.prop.getBoolean(config, \"isIntranetOrExtranet\", true);\n\t\tthis.users = {}; // Call participants. The key is the user id.\n\t\tthis.screenUsers = {}; // Screen sharing participants. The key is the user id.\n\t\tthis.userRegistry = new UserRegistry();\n\n\t\tlet localUserModel = new UserModel({\n\t\t\tid: this.userId,\n\t\t\tstate: BX.prop.getString(config, \"localUserState\", UserState.Connected),\n\t\t\tlocalUser: true,\n\t\t\torder: beginingPosition,\n\t\t\tname: this.userData[this.userId] ? this.userData[this.userId].name : '',\n\t\t\tavatar: this.userData[this.userId] ? this.userData[this.userId].avatar_hr : '',\n\t\t});\n\n\t\tif (this.userId)\n\t\t{\n\t\t\tthis.userRegistry.push(localUserModel);\n\t\t}\n\n\t\tthis.cache = new Map();\n\n\t\tthis.localUser = new CallUser({\n\t\t\tparentContainer: this.container,\n\t\t\tuserModel: localUserModel,\n\t\t\tallowBackgroundItem: BackgroundDialog.isAvailable() && this.isIntranetOrExtranet,\n\t\t\tallowMaskItem: BackgroundDialog.isMaskAvailable() && this.isIntranetOrExtranet,\n\t\t\tonUserRename: this._onUserRename.bind(this),\n\t\t\tonUserRenameInputFocus: this._onUserRenameInputFocus.bind(this),\n\t\t\tonUserRenameInputBlur: this._onUserRenameInputBlur.bind(this),\n\t\t\tonClick: this._onUserClick.bind(this),\n\t\t\tonTurnOffParticipantMic: this._onTurnOffParticipantMic.bind(this),\n\t\t\tonTurnOffParticipantCam: this._onTurnOffParticipantCam.bind(this),\n\t\t\tonTurnOffParticipantScreenshare: this._onTurnOffParticipantScreenshare.bind(this),\n\t\t\tonPin: this._onUserPin.bind(this),\n\t\t\tonUnPin: this._onUserUnPin.bind(this),\n\t\t});\n\n\t\tthis.centralUser = this.localUser; //show local user until someone is connected\n\t\tthis.centralUserMobile = null;\n\t\tthis.pinnedUser = null;\n\t\tthis.presenterId = null;\n\n\t\tthis.localUserRecivedStats = false;\n\n\t\tthis.returnToGridAfterScreenStopped = false;\n\n\t\tthis.mediaSelectionBlocked = (config.mediaSelectionBlocked === true);\n\n\t\tthis.visible = false;\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\twrap: null,\n\t\t\twatermark: null,\n\t\t\tcontainer: null,\n\t\t\toverlay: null,\n\t\t\ttopPanel: null,\n\t\t\tbottom: null,\n\t\t\tnotificationPanel: null,\n\t\t\tpanel: null,\n\t\t\taudioContainer: null,\n\t\t\tscreenAudioContainer: null,\n\t\t\taudio: {\n\t\t\t\t// userId: <audio> for this user's stream\n\t\t\t},\n\t\t\tscreenAudio: {\n\t\t\t\t// userId: <audio> for this user's stream\n\t\t\t},\n\t\t\tcenter: null,\n\t\t\tlocalUserMobile: null,\n\t\t\tuserBlock: null,\n\t\t\tear: {\n\t\t\t\tleft: null,\n\t\t\t\tright: null\n\t\t\t},\n\t\t\tuserList: {\n\t\t\t\tcontainer: null,\n\t\t\t\taddButton: null\n\t\t\t},\n\t\t\tuserSelectorContainer: null,\n\t\t\tpinnedUserContainer: null,\n\t\t\trenameSlider: {\n\t\t\t\tinput: null,\n\t\t\t\tbutton: null\n\t\t\t},\n\t\t\tpageNavigatorLeft: null,\n\t\t\tpageNavigatorLeftCounter: null,\n\t\t\tpageNavigatorRight: null,\n\t\t\tpageNavigatorRightCounter: null,\n\t\t};\n\n\t\tthis.buttons = {\n\t\t\ttitle: null,\n\t\t\tgrid: null,\n\t\t\tadd: null,\n\t\t\tshare: null,\n\t\t\trecord: null,\n\t\t\tdocument: null,\n\t\t\tcopilot: null,\n\t\t\tmicrophone: null,\n\t\t\tcamera: null,\n\t\t\tspeaker: null,\n\t\t\tscreen: null,\n\t\t\tmobileMenu: null,\n\t\t\tchat: null,\n\t\t\tusers: null,\n\t\t\thistory: null,\n\t\t\thangup: null,\n\t\t\tfullscreen: null,\n\t\t\toverlay: null,\n\t\t\tstatus: null,\n\t\t\treturnToCall: null,\n\t\t\trecordStatus: null,\n\t\t\tparticipants: null,\n\t\t\tparticipantsMobile: null,\n\t\t\twatermark: null,\n\t\t\thd: null,\n\t\t\tprotected: null,\n\t\t\tmore: null,\n\t\t\thangupOptions: null,\n\t\t};\n\n\t\tthis.previousTopButtonList = [];\n\t\tthis.needToRerenderTopButtonList = false;\n\t\tthis.previousButtonList = [];\n\t\tthis.needToRerenderButtonList = false;\n\n\t\tthis.size = Size.Full;\n\t\tthis.maxWidth = null;\n\t\tthis.isMuted = Hardware.isMicrophoneMuted;\n\t\tthis.isCameraOn = Hardware.isCameraOn;\n\t\tthis.isFullScreen = false;\n\t\tthis.isUserBlockFolded = false;\n\n\t\tthis.recordState = this.getDefaultRecordState();\n\n\t\tthis.blockedButtons = {};\n\t\tlet configBlockedButtons = BX.prop.getArray(config, \"blockedButtons\", []);\n\t\tconfigBlockedButtons.forEach(buttonCode => this.blockedButtons[buttonCode] = true);\n\n\t\tthis.hiddenButtons = {};\n\t\tthis.overflownButtons = {};\n\t\tif (!this.showUsersButton)\n\t\t{\n\t\t\tthis.hiddenButtons['users'] = true;\n\t\t}\n\t\tlet configHiddenButtons = BX.prop.getArray(config, \"hiddenButtons\", []);\n\t\tconfigHiddenButtons.forEach(buttonCode => this.hiddenButtons[buttonCode] = true);\n\n\t\tthis.hiddenTopButtons = {};\n\t\tlet configHiddenTopButtons = BX.prop.getArray(config, \"hiddenTopButtons\", []);\n\t\tconfigHiddenTopButtons.forEach(buttonCode => this.hiddenTopButtons[buttonCode] = true);\n\n\t\tthis.uiState = config.uiState || UiState.Calling;\n\t\tthis.layout = config.layout || Layouts.Centered;\n\t\tthis.whiteSpaceInUserGrid = 0;\n\t\tthis.roomState = RoomState.None;\n\n\t\tthis.eventEmitter = new EventEmitter(this, 'BX.Call.View');\n\n\t\tthis.scrollInterval = 0;\n\n\t\t// Event handlers\n\t\tthis._onFullScreenChangeHandler = this._onFullScreenChange.bind(this);\n\t\t//this._onResizeHandler = BX.throttle(this._onResize.bind(this), 500);\n\t\tthis._onResizeHandler = this._onResize.bind(this);\n\t\tthis._onOrientationChangeHandler = BX.debounce(this._onOrientationChange.bind(this), 500);\n\t\tthis._onKeyDownHandler = this._onKeyDown.bind(this);\n\t\tthis._onKeyUpHandler = this._onKeyUp.bind(this);\n\n\t\tthis.resizeObserver = new BX.ResizeObserver(this._onResizeHandler);\n\t\tthis.intersectionObserver = null;\n\n\t\t// timers\n\t\tthis.switchPresenterTimeout = 0;\n\n\t\tthis.deviceSelector = null;\n\t\tthis.userSelector = null;\n\t\tthis.pinnedUserContainer = null;\n\n\t\tthis.renameSlider = null;\n\n\t\tthis.userSize = {width: 0, height: 0};\n\n\t\tthis.hintManager = BX.UI.Hint.createInstance({\n\t\t\tpopupParameters: {\n\t\t\t\ttargetContainer: document.body,\n\t\t\t\tclassName: 'bx-messenger-videocall-panel-item-hotkey-hint',\n\t\t\t\tbindOptions: {forceBindPosition: true},\n\t\t\t\tangle: false\n\t\t\t}\n\t\t});\n\n\t\tthis.hotKey = {\n\t\t\tall: Util.isDesktop(),\n\t\t\tmicrophone: true,\n\t\t\tmicrophoneSpace: true,\n\t\t\tcamera: true,\n\t\t\tscreen: true,\n\t\t\trecord: true,\n\t\t\tspeaker: true,\n\t\t\tchat: true,\n\t\t\tusers: true,\n\t\t\tfloorRequest: true,\n\t\t\tmuteSpeaker: true,\n\t\t\tgrid: true,\n\t\t};\n\t\tthis.hotKeyTemporaryBlock = 0;\n\n\t\tthis._isPreparing = false;\n\t\tthis._videoRerenderDelay = 0;\n\n\t\tthis.isWindowFocus = config.isWindowFocus || false;\n\t\tthis.isDocumentHidden = false;\n\t\tthis._isActivePiPFromController = false;\n\n\t\tconst pictureInPictureUpdateButtonHandler = () => {\n\t\t\tthis.pictureInPictureCallWindow && this.pictureInPictureCallWindow.setButtons(this.getPictureInPictureCallWindowGetButtonsList()).updateButtons();\n\t\t};\n\n\t\tthis.viewVisibility = this.#getViewVisibilityChange([pictureInPictureUpdateButtonHandler]);\n\n\t\tthis.init();\n\t\tthis.subscribeEvents(config);\n\t\tif (Type.isPlainObject(config.userStates))\n\t\t{\n\t\t\tthis.appendUsers(config.userStates);\n\t\t}\n\n\t\t/*this.resizeCalled = 0;\n\t\tthis.reportResizeCalled = BX.debounce(function()\n\t\t{\n\t\t\tconsole.log('resizeCalled ' + this.resizeCalled + ' times');\n\t\t\tthis.resizeCalled = 0;\n\t\t}.bind(this), 100)*/\n\n\t\tthis.hideEarTimer = null;\n\n\t\tthis.isCopilotFeaturesEnabled = config.isCopilotFeaturesEnabled || false;\n\t\tthis.isCopilotActive = config.isCopilotActive || false;\n\t\tthis.copilotNotify = null;\n\n\t\tthis.ahaMomentNotify = null;\n\n\t\tthis.pictureInPictureCallWindow = null;\n\n\t\tthis.floorRequestNotifications = [];\n\t\tthis.currentPiPUserId = null;\n\n\t\tthis.isVideoconf = config.isVideoconf || false;\n\n\t\tthis.needToShowCallcontrolPromo = this.isVideoconf ? false : PromoManager.getInstance().needToShow(CALLCONTROL_PROMO_ID);\n\t};\n\n\topenArticle(articleCode)\n\t{\n\t\tconst infoHelper = BX.UI.InfoHelper;\n\n\t\tif (infoHelper.isOpen())\n\t\t{\n\t\t\tinfoHelper.close()\n\t\t}\n\n\t\tinfoHelper.show(articleCode);\n\t}\n\n\tonClickButtonWithLimit(limitObj, handle)\n\t{\n\t\tconst {enabled, articleCode} = limitObj;\n\n\t\tif (enabled && typeof handle === \"function\") {\n\t\t\thandle()\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!enabled && articleCode) {\n\t\t\tif (this.size === View.Size.Folded)\n\t\t\t{\n\t\t\t\tthis._onBodyClick();\n\t\t\t}\n\n\t\t\tthis.openArticle(articleCode)\n\t\t}\n\t}\n\n\tgetLimitation()\n\t{\n\t\tthis.limitation = Util.getCallFeatures();\n\t}\n\n\tgetLimitationByType(type)\n\t{\n\t\tconst defaultLimitation = {enable: true};\n\n\t\tconst currentLimitation = this.limitation?.[`call_${type}`];\n\n\t\tif (!currentLimitation) {\n\t\t\treturn defaultLimitation;\n\t\t}\n\n\t\treturn {\n\t\t\tenabled: currentLimitation.enable,\n\t\t\tarticleCode: currentLimitation.articleCode\n\t\t}\n\t}\n\n\tgetBackgroundLimitation()\n\t{\n\t\treturn this.getLimitationByType('background')\n\t}\n\n\tgetBackgroundBlurLimitation()\n\t{\n\t\treturn this.getLimitationByType('background_blur')\n\t}\n\n\tgetRecordLimitation()\n\t{\n\t\treturn this.getLimitationByType('record')\n\t}\n\n\tgetScreenSharingLimitation()\n\t{\n\t\treturn this.getLimitationByType('screen_sharing')\n\t}\n\n\tisDesktopCall()\n\t{\n\t\treturn DesktopApi.isDesktop();\n\t}\n\tcheckAvailableBackgroundImage()\n\t{\n\t\tif (!this.isDesktopCall())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst {id: backgroundId} = DesktopApi.getBackgroundImage();\n\n\t\tif (!backgroundId || backgroundId === 'none') {\n\t\t\tDesktopApi.setCallBackground('none', 'none')\n\t\t}\n\t}\n\n\ttoggleVisibilityEar()\n\t{\n\t\tif (this.hideEarTimer)\n\t\t{\n\t\t\tclearTimeout(this.hideEarTimer);\n\t\t\tthis.hideEarTimer = null;\n\t\t}\n\n\t\tDom.addClass(this.elements.root, 'on-mouse-move');\n\t\tthis.elements.ear.top?.classList.add(\"force-visible\");\n\t\tthis.elements.ear.bottom?.classList.add(\"force-visible\");\n\t\tthis.elements.pageNavigatorLeft?.classList.add(\"force-visible\");\n\t\tthis.elements.pageNavigatorRight?.classList.add(\"force-visible\");\n\n\t\tthis.hideEarTimer = setTimeout(() =>\n\t\t{\n\t\t\tDom.removeClass(this.elements.root, 'on-mouse-move');\n\t\t\tthis.elements.ear.top?.classList.remove(\"force-visible\");\n\t\t\tthis.elements.ear.bottom?.classList.remove(\"force-visible\");\n\t\t\tthis.elements.pageNavigatorLeft?.classList.remove(\"force-visible\");\n\t\t\tthis.elements.pageNavigatorRight?.classList.remove(\"force-visible\");\n\t\t}, 5000);\n\t}\n\n\tinit()\n\t{\n\t\tthis.getLimitation();\n\t\tthis.checkAvailableBackgroundImage();\n\n\t\tif (this.isFullScreenSupported())\n\t\t{\n\t\t\tif (Browser.isChrome() || Browser.isSafari())\n\t\t\t{\n\t\t\t\twindow.addEventListener(\"fullscreenchange\", this._onFullScreenChangeHandler);\n\t\t\t\twindow.addEventListener(\"webkitfullscreenchange\", this._onFullScreenChangeHandler);\n\t\t\t}\n\t\t\telse if (Browser.isFirefox())\n\t\t\t{\n\t\t\t\twindow.addEventListener(\"mozfullscreenchange\", this._onFullScreenChangeHandler);\n\t\t\t}\n\t\t}\n\t\tif (Browser.isMobile())\n\t\t{\n\t\t\tdocument.documentElement.style.setProperty('--view-height', window.innerHeight + 'px');\n\t\t\twindow.addEventListener(\"orientationchange\", this._onOrientationChangeHandler);\n\t\t}\n\n\t\tthis.elements.audioContainer = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-audio-container\"}\n\t\t});\n\n\t\tthis.elements.screenAudioContainer = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-audio-container\"}\n\t\t});\n\n\t\tif (Hardware.initialized)\n\t\t{\n\t\t\tthis.setSpeakerId(Hardware.defaultSpeaker);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tHardware.subscribe(Hardware.Events.initialized, function ()\n\t\t\t{\n\t\t\t\tthis.setSpeakerId(Hardware.defaultSpeaker);\n\t\t\t}.bind(this))\n\t\t}\n\n\t\tHardware.subscribe(Hardware.Events.onChangeMicrophoneMuted, this.setMuted);\n\t\tHardware.subscribe(Hardware.Events.onChangeCameraOn, this.setCameraState);\n\n\t\twindow.addEventListener(\"keydown\", this._onKeyDownHandler);\n\t\twindow.addEventListener(\"keyup\", this._onKeyUpHandler);\n\n\t\tthis.onMouseMoveHandler = this.toggleVisibilityEar.bind(this);\n\t\tdocument.addEventListener('mousemove', this.onMouseMoveHandler);\n\n\t\tthis.keyModifierForCss = Browser.isMac() ? '\\\\2318 + Shift' : 'Ctrl + Shift';\n\n\t\tthis.container.appendChild(this.elements.audioContainer);\n\t\tthis.container.appendChild(this.elements.screenAudioContainer);\n\n\t\tthis.viewVisibility.startViewVisibilityChange()\n\t};\n\n\tget isActivePiPFromController()\n\t{\n\t\treturn this._isActivePiPFromController;\n\t}\n\n\tset isActivePiPFromController(isActive)\n\t{\n\t\tthis._isActivePiPFromController = isActive;\n\t}\n\n\tget isPreparing()\n\t{\n\t\treturn this._isPreparing;\n\t};\n\n\tset isPreparing(isPreparing)\n\t{\n\t\tthis._isPreparing = !!isPreparing;\n\t};\n\n\t// for testing different delay values\n\tget videoRerenderDelay()\n\t{\n\t\treturn this._videoRerenderDelay > 0 ? this._videoRerenderDelay : CHANGE_VIDEO_RERENDER_DELAY;\n\t};\n\n\tset videoRerenderDelay(videoRerenderDelay)\n\t{\n\t\tthis._videoRerenderDelay = videoRerenderDelay;\n\t};\n\n\tsubscribeEvents(config)\n\t{\n\t\tfor (let event in EventName)\n\t\t{\n\t\t\tif (EventName.hasOwnProperty(event) && Type.isFunction(config[event]))\n\t\t\t{\n\t\t\t\tthis.setCallback(event, config[event]);\n\t\t\t}\n\t\t}\n\t};\n\n\tsetCallback(name, cb)\n\t{\n\t\tif (Type.isFunction(cb) && EventName.hasOwnProperty(name))\n\t\t{\n\t\t\tthis.eventEmitter.subscribe(name, function (event)\n\t\t\t{\n\t\t\t\tcb(event.data);\n\t\t\t});\n\t\t}\n\t};\n\n\tsubscribe(eventName, listener)\n\t{\n\t\treturn this.eventEmitter.subscribe(eventName, listener);\n\t};\n\n\tunsubscribe(eventName, listener)\n\t{\n\t\treturn this.eventEmitter.unsubscribe(eventName, listener);\n\t};\n\n\tgetNextPosition()\n\t{\n\t\treturn this.lastPosition++;\n\t};\n\n\t/**\n\t * @param {object} userStates {userId -> state}\n\t */\n\tappendUsers(userStates)\n\t{\n\t\tif (!Type.isPlainObject(userStates))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet userIds = Object.keys(userStates);\n\t\tfor (let i = 0; i < userIds.length; i++)\n\t\t{\n\t\t\tlet userId = userIds[i];\n\t\t\tthis.addUser(userId, userStates[userId] ? userStates[userId] : UserState.Idle);\n\t\t}\n\t};\n\n\tsetCentralUser(userId)\n\t{\n\t\tif (this.centralUser.id == userId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.users[userId] && userId != this.userId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst previousCentralUser = this.centralUser;\n\t\tthis.centralUser = (userId == this.userId ? this.localUser : this.users[userId]);\n\t\tif (this.layout == Layouts.Centered || this.layout == Layouts.Mobile)\n\t\t{\n\t\t\tif (this.layout == Layouts.Mobile)\n\t\t\t{\n\t\t\t\tpreviousCentralUser.dismount();\n\t\t\t}\n\t\t\tthis.updateUserList();\n\t\t}\n\t\tif (this.layout == Layouts.Mobile)\n\t\t{\n\t\t\tif (this.centralUserMobile)\n\t\t\t{\n\t\t\t\tthis.centralUserMobile.setUserModel(this.userRegistry.get(userId));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.centralUserMobile = new CallUserMobile({\n\t\t\t\t\tuserModel: this.userRegistry.get(userId),\n\t\t\t\t\tonClick: () => this.showUserMenu(this.centralUser.id)\n\t\t\t\t})\n\t\t\t\tthis.centralUserMobile.mount(this.elements.pinnedUserContainer);\n\t\t\t}\n\t\t}\n\n\t\tthis.userRegistry.get(previousCentralUser.id).centralUser = false;\n\t\tthis.userRegistry.get(this.centralUser.id).centralUser = true;\n\n\t\tthis.eventEmitter.emit(EventName.onSetCentralUser, {\n\t\t\tuserId: userId,\n\t\t\tstream: userId == this.userId ? this.localUser.stream : this.users[userId].stream\n\t\t})\n\t};\n\n\tgetLeftUser(userId): ?number\n\t{\n\t\tlet candidateUserId = null;\n\t\tconst keys = [...this.userRegistry.users.keys()];\n\t\tconst index = keys.indexOf(userId);\n\n\t\tif (index === -1)\n\t\t{\n\t\t\treturn candidateUserId;\n\t\t}\n\n\t\tconst userModels = [...this.userRegistry.users.values()].slice(0, index);\n\t\tconst totalUserModels = userModels.length;\n\n\t\tfor (let i = totalUserModels - 1; i >= 0; i--)\n\t\t{\n\t\t\tconst userModel = userModels[i];\n\t\t\tif (!userModel.localUser && userModel.state === UserState.Connected)\n\t\t\t{\n\t\t\t\tcandidateUserId = userModel.id;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn candidateUserId;\n\t}\n\n\tgetRightUser(userId): ?number\n\t{\n\t\tlet candidateUserId = null;\n\t\tconst keys = [...this.userRegistry.users.keys()];\n\t\tconst index = keys.indexOf(userId);\n\n\t\tif (index === -1)\n\t\t{\n\t\t\treturn candidateUserId;\n\t\t}\n\n\t\tconst userModels = [...this.userRegistry.users.values()].slice(index + 1);\n\t\tconst totalUserModels = userModels.length;\n\n\t\tfor (let i = 0; i < totalUserModels; i++)\n\t\t{\n\t\t\tconst userModel = userModels[i];\n\n\t\t\tif (!userModel.localUser && userModel.state === UserState.Connected)\n\t\t\t{\n\t\t\t\tcandidateUserId = userModel.id;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn candidateUserId;\n\t}\n\n\tgetUserCount()\n\t{\n\t\treturn Object.keys(this.users).length;\n\t};\n\n\tgetConnectedUserCount(withYou)\n\t{\n\t\tlet count = this.getConnectedUsers().length;\n\n\t\tif (withYou)\n\t\t{\n\t\t\tconst userId = parseInt(this.userId);\n\t\t\tif (!this.broadcastingMode || this.broadcastingPresenters.includes(userId))\n\t\t\t{\n\t\t\t\tcount += 1;\n\t\t\t}\n\t\t}\n\n\t\treturn count;\n\t};\n\n\tgetUsersWithVideo(): Array\n\t{\n\t\tif (this.cache.has('usersWithVideo'))\n\t\t{\n\t\t\treturn this.cache.get('usersWithVideo');\n\t\t}\n\n\t\tconst users = Object.keys(this.users);\n\t\tconst result = [];\n\n\t\tusers.forEach((userId) => {\n\t\t\tif (this.users[userId].hasVideo())\n\t\t\t{\n\t\t\t\tresult.push(userId);\n\t\t\t}\n\t\t});\n\n\t\tthis.cache.set('usersWithVideo', result);\n\n\t\treturn result;\n\t}\n\n\tgetConnectedUsers(): Array\n\t{\n\t\tif (this.cache.has('currentConnectedUser'))\n\t\t{\n\t\t\treturn this.cache.get('currentConnectedUser');\n\t\t}\n\n\t\tconst result = [];\n\t\tconst userModels = [...this.userRegistry.users.values()];\n\t\tuserModels.forEach((userModel) => {\n\t\t\tif (userModel.id != this.userId && userModel.state === UserState.Connected)\n\t\t\t{\n\t\t\t\tresult.push(userModel.id);\n\t\t\t}\n\t\t});\n\n\t\tthis.cache.set('previousConnectedUserCount', 0);\n\t\tthis.cache.set('currentConnectedUser', result);\n\n\t\treturn result;\n\t}\n\n\tgetDisplayedUsers(): Array\n\t{\n\t\tconst result = [];\n\t\tconst userModels = [...this.userRegistry.users.values()];\n\t\tuserModels.forEach((userModel) => {\n\t\t\tif (\n\t\t\t\tuserModel.id != this.userId\n\t\t\t\t&& ((userModel.id != this.centralUser.id && this.layout === Layouts.Centered) || this.layout !== Layouts.Centered)\n\t\t\t\t&& ([UserState.Connected, UserState.Connecting, UserState.Calling].includes(userModel.state))\n\t\t\t)\n\t\t\t{\n\t\t\t\tresult.push(userModel.id);\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t}\n\n\tgetActiveUsers(): Array\n\t{\n\t\tif (this.cache.has('activeUsers'))\n\t\t{\n\t\t\treturn this.cache.get('activeUsers');\n\t\t}\n\n\t\tconst result = [];\n\t\tconst userModels = [...this.userRegistry.users.values()];\n\t\tuserModels.forEach((userModel) => {\n\t\t\tif (this.isUserHasActiveState(userModel) && Object.hasOwn(this.users, userModel.id))\n\t\t\t{\n\t\t\t\tresult.push(userModel.id);\n\t\t\t}\n\t\t});\n\n\t\tthis.cache.set('activeUsers', result);\n\n\t\treturn result;\n\t}\n\n\tgetUsersWithCamera(): Array\n\t{\n\t\t// since we don't receive streams from inactive pages\n\t\t// we can't use this.getUsersWithVideo() to get number of users with video\n\t\treturn [...this.userRegistry.users.values()].filter((userModel) => {\n\t\t\treturn userModel.id != this.userId\n\t\t\t\t&& userModel.cameraState\n\t\t\t\t&& this.isUserHasActiveState(userModel)\n\t\t\t\t&& userModel.state !== UserState.Calling;\n\t\t});\n\t}\n\n\thasUserWithScreenSharing(): Boolean\n\t{\n\t\treturn [...this.userRegistry.users.values()].some((userModel) => userModel.screenState);\n\t}\n\n\thasCurrentUserScreenSharing(): Boolean\n\t{\n\t\tconst currentUser = this.userRegistry.get(this.userId);\n\n\t\tif (currentUser)\n\t\t{\n\t\t\treturn currentUser.screenState;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tgetPresenterUserId(): ?number\n\t{\n\t\tlet currentPresenterId = this.presenterId || 0;\n\t\tif (!this.getConnectedUserCount())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tif (currentPresenterId == this.localUser.id)\n\t\t{\n\t\t\tcurrentPresenterId = 0;\n\t\t}\n\n\t\tconst currentPresenterModel = this.userRegistry.get(currentPresenterId);\n\n\t\t// 1. Current user, who is sharing screen has top priority\n\t\tif (currentPresenterModel?.screenState === true)\n\t\t{\n\t\t\treturn currentPresenterId;\n\t\t}\n\n\t\t// 2. If current user is not sharing screen, but someone is sharing - he should become presenter\n\t\tconst users = Object.keys(this.users);\n\t\tfor (const userId of users)\n\t\t{\n\t\t\tif (Object.hasOwn(this.users, userId) && this.userRegistry.get(userId).screenState === true)\n\t\t\t{\n\t\t\t\treturn parseInt(userId, 10);\n\t\t\t}\n\t\t}\n\n\t\t// 3. If current user is talking, or stopped talking less then one second ago - he should stay presenter\n\t\tif (currentPresenterModel && currentPresenterModel.wasTalkingAgo() < 1000)\n\t\t{\n\t\t\treturn currentPresenterId;\n\t\t}\n\n\t\t// 4. Return currently talking user\n\t\tconst minTalkingAgo = 0;\n\t\tlet minTalkingAgoUserId = 0;\n\t\tfor (const userId of users)\n\t\t{\n\t\t\tif (!Object.hasOwn(this.users, userId))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst userWasTalkingAgo = this.userRegistry.get(userId).wasTalkingAgo();\n\t\t\tif (userWasTalkingAgo < 1000)\n\t\t\t{\n\t\t\t\treturn parseInt(userId, 10);\n\t\t\t}\n\n\t\t\tif (userWasTalkingAgo < minTalkingAgo)\n\t\t\t{\n\t\t\t\tminTalkingAgoUserId = parseInt(userId, 10);\n\t\t\t}\n\t\t}\n\n\t\t// Return last talking user or current user in center\n\t\treturn minTalkingAgoUserId || this.centralUser.id;\n\t}\n\n\tswitchPresenter()\n\t{\n\t\tconst currentPresenterId = this.presenterId || 0;\n\t\tconst newPresenterId = this.getPresenterUserId();\n\n\t\tif (!newPresenterId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.presenterId = newPresenterId;\n\n\t\tif (currentPresenterId)\n\t\t{\n\t\t\tthis.userRegistry.get(currentPresenterId).presenter = false;\n\t\t}\n\t\tthis.userRegistry.get(newPresenterId).presenter = true;\n\n\t\tif (this.pictureInPictureCallWindow)\n\t\t{\n\t\t\tthis.pictureInPictureCallWindow.setCurrentUser(this.getPictureInPictureCallWindowUser());\n\t\t}\n\n\t\tif (this.pinnedUser === null)\n\t\t{\n\t\t\tthis.setCentralUser(newPresenterId);\n\n\t\t\tif (this.layout === Layouts.Centered && currentPresenterId !== newPresenterId)\n\t\t\t{\n\t\t\t\tthis.eventEmitter.emit(EventName.onHasMainStream, {\n\t\t\t\t\tuserId: this.centralUser.id,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse if (currentPresenterId !== newPresenterId)\n\t\t{\n\t\t\tthis.eventEmitter.emit(EventName.onHasMainStream, {\n\t\t\t\tuserId: this.centralUser.id,\n\t\t\t});\n\t\t}\n\t}\n\n\tswitchPresenterDeferred()\n\t{\n\t\tclearTimeout(this.switchPresenterTimeout);\n\t\tthis.switchPresenterTimeout = setTimeout(this.switchPresenter.bind(this), 1000);\n\t};\n\n\tcancelSwitchPresenter()\n\t{\n\t\tclearTimeout(this.switchPresenterTimeout);\n\t};\n\n\tsetUiState(uiState)\n\t{\n\t\tif (this.uiState == uiState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.uiState = uiState;\n\t\tif (this.uiState == UiState.Error && this.elements.container)\n\t\t{\n\t\t\tDom.clean(this.elements.container);\n\t\t\tthis.elements.container.appendChild(this.elements.overlay);\n\t\t}\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.updateButtons();\n\t};\n\n\tsetLayout(newLayout)\n\t{\n\t\tif (newLayout == this.layout)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet useShelvedRerenderQueue = this.layout === Layouts.Centered && newLayout === Layouts.Grid;\n\n\t\tthis.layout = newLayout;\n\n\t\tif (this.layout == Layouts.Centered || this.layout == Layouts.Mobile)\n\t\t{\n\t\t\tthis.elements.root.classList.remove(\"bx-messenger-videocall-grid\");\n\t\t\tthis.elements.root.classList.add(\"bx-messenger-videocall-centered\");\n\t\t\tthis.centralUser.mount(this.elements.center);\n\t\t\tthis.elements.container.appendChild(this.elements.userBlock);\n\n\t\t\tif (this.layout != Layouts.Mobile)\n\t\t\t{\n\t\t\t\tthis.elements.userBlock.appendChild(this.elements.userList.container);\n\t\t\t}\n\n\t\t\tthis.centralUser.playVideo();\n\t\t\t//this.centralUser.updateAvatarWidth();\n\t\t}\n\n\t\tif (this.layout === Layouts.Grid)\n\t\t{\n\t\t\tthis.elements.root.classList.remove('bx-messenger-videocall-centered');\n\t\t\tthis.elements.root.classList.add('bx-messenger-videocall-grid');\n\n\t\t\tthis.elements.container.appendChild(this.elements.userList.container);\n\t\t\tthis.elements.container.removeChild(this.elements.userBlock);\n\n\t\t\tthis.centralUser.dismount();\n\n\t\t\tif (this.isFullScreen && this.buttons.participants)\n\t\t\t{\n\t\t\t\tthis.buttons.participants.update({\n\t\t\t\t\tfoldButtonState: Buttons.ParticipantsButton.FoldButtonState.Hidden,\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.unpinUser();\n\t\t}\n\n\t\tif (this.layout === Layouts.Centered && this.isFullScreen)\n\t\t{\n\t\t\tthis.setUserBlockFolded(true);\n\t\t}\n\n\t\tthis.elements.root.classList.toggle(\"bx-messenger-videocall-fullscreen-mobile\", (this.layout == Layouts.Mobile));\n\n\t\tthis.updateUserList(useShelvedRerenderQueue);\n\t\tthis.toggleEars();\n\t\tthis.updateButtons();\n\t\tthis.eventEmitter.emit(EventName.onLayoutChange, {\n\t\t\tlayout: this.layout\n\t\t});\n\t};\n\n\tsetRoomState(roomState)\n\t{\n\t\tif (this.roomState === roomState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.roomState = roomState;\n\t\tif (this.buttons.microphone)\n\t\t{\n\t\t\tthis.buttons.microphone.setSideIcon(this.getMicrophoneSideIcon(this.roomState));\n\t\t}\n\t}\n\n\tgetMicrophoneSideIcon(roomState)\n\t{\n\t\tswitch (roomState)\n\t\t{\n\t\t\tcase RoomState.Speaker:\n\t\t\t\treturn 'ellipsis';\n\t\t\tcase RoomState.NonSpeaker:\n\t\t\t\treturn 'pointer';\n\t\t\tcase RoomState.None:\n\t\t\tdefault:\n\t\t\t\treturn null;\n\t\t}\n\t}\n\n\tsetCurrentPage(pageNumber)\n\t{\n\t\tif (pageNumber < 1 || pageNumber > this.pagesCount || pageNumber == this.currentPage)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.currentPage = pageNumber;\n\n\t\tthis.recalculateUsersPerPage()\n\t\tif (this.elements.root)\n\t\t{\n\t\t\tthis.elements.pageNavigatorLeftCounter.innerHTML = (this.currentPage - 1) + '&nbsp;/&nbsp;' + this.pagesCount;\n\t\t\tthis.elements.pageNavigatorRightCounter.innerHTML = (this.currentPage + 1) + '&nbsp;/&nbsp;' + this.pagesCount;\n\t\t}\n\t\tif (!(this.layout === Layouts.Grid || this.layout === Layouts.Centered))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.renderUserList(true);\n\t\tthis.toggleEars();\n\t};\n\n\tcalculateUsersPerPage()\n\t{\n\t\tif (!this.elements.userList)\n\t\t{\n\t\t\treturn 1000;\n\t\t}\n\n\t\tconst containerSize = this.elements.userList.container.getBoundingClientRect();\n\t\tlet columns = Math.floor(containerSize.width / MIN_GRID_USER_WIDTH) || 1;\n\t\tlet rows = Math.floor(containerSize.height / MIN_GRID_USER_HEIGHT) || 1;\n\n\t\tif (this.layout === Layouts.Centered)\n\t\t{\n\t\t\tconst rowsWithoutGap = Math.floor(containerSize.height / SIDE_USER_HEIGHT) || 1;\n\t\t\tconst rowGap = 6;\n\n\t\t\tthis.whiteSpaceInUserGrid = containerSize.height - rowsWithoutGap * SIDE_USER_HEIGHT + (rowsWithoutGap - 1) * rowGap;\n\n\t\t\tcolumns = 1;\n\t\t\trows = this.whiteSpaceInUserGrid < 0 ? rowsWithoutGap - 1 : rowsWithoutGap;\n\t\t}\n\n\t\tlet usersPerPage = columns * rows - 1;\n\n\t\tif (this.userId == this.centralUser.id && this.layout === Layouts.Centered)\n\t\t{\n\t\t\tusersPerPage += 1;\n\t\t}\n\n\t\tif (!usersPerPage)\n\t\t{\n\t\t\treturn 1000;\n\t\t}\n\n\t\tif (usersPerPage >= MAX_USERS_PER_PAGE)\n\t\t{\n\t\t\t// check if the last row should be filled up\n\t\t\tconst elementSize = Util.findBestElementSize(\n\t\t\t\tcontainerSize.width,\n\t\t\t\tcontainerSize.height,\n\t\t\t\tMAX_USERS_PER_PAGE + 1,\n\t\t\t\tMIN_GRID_USER_WIDTH,\n\t\t\t\tMIN_GRID_USER_HEIGHT,\n\t\t\t);\n\t\t\t// console.log('Optimal element size: width '+elementSize.width+' height '+elementSize.height);\n\t\t\tcolumns = Math.floor(containerSize.width / elementSize.width);\n\t\t\trows = Math.floor(containerSize.height / elementSize.height);\n\t\t\tusersPerPage = columns * rows - 1;\n\t\t}\n\n\t\treturn usersPerPage;\n\t}\n\n\tcalculatePagesCount(usersPerPage)\n\t{\n\t\tconst pages = Math.ceil((this.getDisplayedUsers().length) / usersPerPage);\n\t\treturn pages > 0 ? pages : 1;\n\t};\n\n\trecalculateUsersPerPage()\n\t{\n\t\tthis.usersPerPage = this.calculateUsersPerPage();\n\n\t\tif (this.currentPage < this.pagesCount && this.layout === Layouts.Centered && this.whiteSpaceInUserGrid > 0)\n\t\t{\n\t\t\tthis.usersPerPage = this.usersPerPage + 1;\n\t\t}\n\t}\n\n\trecalculatePages()\n\t{\n\t\tthis.usersPerPage = this.calculateUsersPerPage();\n\t\tthis.pagesCount = this.calculatePagesCount(this.usersPerPage);\n\n\t\tif (this.currentPage > this.pagesCount)\n\t\t{\n\t\t\tthis.currentPage = this.pagesCount;\n\t\t}\n\n\t\tthis.recalculateUsersPerPage();\n\n\t\tif (this.elements.root)\n\t\t{\n\t\t\tthis.elements.pageNavigatorLeftCounter.innerHTML = (this.currentPage - 1) + '&nbsp;/&nbsp;' + this.pagesCount;\n\t\t\tthis.elements.pageNavigatorRightCounter.innerHTML = (this.currentPage + 1) + '&nbsp;/&nbsp;' + this.pagesCount;\n\t\t}\n\t};\n\n\t/**\n\t * Returns page number, where the user is displayed, or 0 if user is not found\n\t * @param {int} userId Id of the user\n\t * @return {int}\n\t */\n\tfindUsersPage(userId)\n\t{\n\t\tif (userId == this.userId || this.usersPerPage === 0)\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\t\tconst displayedUsers = this.getDisplayedUsers();\n\t\tlet userPosition = 0;\n\n\t\tfor (let i = 0; i < displayedUsers.length; i++)\n\t\t{\n\t\t\tif (displayedUsers[i] == userId)\n\t\t\t{\n\t\t\t\tuserPosition = i + 1;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn (userPosition ? Math.ceil(userPosition / this.usersPerPage) : 0);\n\t};\n\n\tsetCameraId(cameraId)\n\t{\n\t\tif (this.cameraId == cameraId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.localUser.stream && this.localUser.stream.getVideoTracks().length > 0)\n\t\t{\n\t\t\tthrow new Error(\"Can not set camera id while having active stream\")\n\t\t}\n\t\tthis.cameraId = cameraId;\n\t};\n\n\tsetMicrophoneId(microphoneId)\n\t{\n\t\tif (this.microphoneId == microphoneId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.localUser.stream && this.localUser.stream.getAudioTracks().length > 0)\n\t\t{\n\t\t\tthrow new Error(\"Can not set microphone id while having active stream\")\n\t\t}\n\t\tthis.microphoneId = microphoneId;\n\t};\n\n\tsetMicrophoneLevel(level)\n\t{\n\t\tthis.microphoneLevel = level;\n\t\tthis.buttons.microphone?.setLevel(level);\n\t};\n\n\tsetCameraState = (event) =>\n\t{\n\t\tif (this.isCameraOn == event.data.isCameraOn)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isCameraOn = event.data.isCameraOn;\n\n\t\tif (this.buttons.camera)\n\t\t{\n\t\t\tif (this.isCameraOn)\n\t\t\t{\n\t\t\t\tthis.buttons.camera.enable();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.buttons.camera.disable();\n\t\t\t}\n\t\t}\n\n\t\tif (this.pictureInPictureCallWindow)\n\t\t{\n\t\t\tthis.pictureInPictureCallWindow.setButtons(this.getPictureInPictureCallWindowGetButtonsList()).updateButtons();\n\t\t}\n\t};\n\n\tsetMuted = (event) =>\n\t{\n\t\tif (this.isMuted == event.data.isMicrophoneMuted)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isMuted = event.data.isMicrophoneMuted\n\n\t\tif (this.buttons.microphone)\n\t\t{\n\t\t\tif (this.isMuted)\n\t\t\t{\n\t\t\t\tthis.buttons.microphone.disable();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.buttons.microphone.enable();\n\t\t\t}\n\t\t}\n\t\tthis.userRegistry.get(this.userId).microphoneState = !this.isMuted;\n\n\t\tif (this.pictureInPictureCallWindow)\n\t\t{\n\t\t\tthis.pictureInPictureCallWindow.setButtons(this.getPictureInPictureCallWindowGetButtonsList()).updateButtons();\n\t\t}\n\t};\n\n\tsetLocalUserId(userId)\n\t{\n\t\tif (userId == this.userId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.userId = parseInt(userId);\n\t\tthis.localUser.userModel.id = this.userId;\n\t\tthis.localUser.userModel.name = this.userData[this.userId] ? this.userData[this.userId].name : '';\n\t\tthis.localUser.userModel.avatar = this.userData[this.userId] ? checkAndEncodeURI(this.userData[this.userId].avatar_hr) : '';\n\n\t\tthis.userRegistry.push(this.localUser.userModel);\n\t};\n\n\tsetUserBlockFolded(isUserBlockFolded)\n\t{\n\t\tthis.isUserBlockFolded = isUserBlockFolded;\n\n\t\tthis.elements.userBlock?.classList.toggle(\"folded\", this.isUserBlockFolded);\n\t\tthis.elements.root?.classList.toggle(\"bx-messenger-videocall-userblock-folded\", this.isUserBlockFolded);\n\t\tif (this.isUserBlockFolded)\n\t\t{\n\t\t\tif (this.buttons.participants && this.layout == Layouts.Centered)\n\t\t\t{\n\t\t\t\tthis.buttons.participants.update({\n\t\t\t\t\tfoldButtonState: Buttons.ParticipantsButton.FoldButtonState.Unfold\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.buttons.participants)\n\t\t\t{\n\t\t\t\tthis.buttons.participants.update({\n\t\t\t\t\tfoldButtonState: (this.isFullScreen && this.layout == Layouts.Centered) ? Buttons.ParticipantsButton.FoldButtonState.Fold : Buttons.ParticipantsButton.FoldButtonState.Hidden\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t};\n\n\taddUser(userId, state, direction)\n\t{\n\t\tuserId = Number(userId);\n\t\tif (this.users[userId])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tstate = state || UserState.Idle;\n\t\tif (!direction)\n\t\t{\n\t\t\tif (this.broadcastingPresenters.length > 0 && !this.broadcastingPresenters.includes(userId))\n\t\t\t{\n\t\t\t\tdirection = EndpointDirection.RecvOnly;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tdirection = EndpointDirection.SendRecv\n\t\t\t}\n\t\t}\n\n\t\tlet userModel = new UserModel({\n\t\t\tid: userId,\n\t\t\tname: this.userData[userId] ? this.userData[userId].name : '',\n\t\t\tavatar: this.userData[userId] ? this.userData[userId].avatar_hr : '',\n\t\t\tstate: state,\n\t\t\torder: state == UserState.Connected ? this.getNextPosition() : newUserPosition,\n\t\t\tdirection: direction,\n\t\t});\n\n\t\tthis.userRegistry.push(userModel);\n\n\t\tif (!this.elements.audio[userId])\n\t\t{\n\t\t\tthis.elements.audio[userId] = Dom.create('audio');\n\t\t\tDom.append(this.elements.audio[userId], this.elements.audioContainer);\n\t\t}\n\n\t\tif (!this.elements.screenAudio[userId])\n\t\t{\n\t\t\tthis.elements.screenAudio[userId] = Dom.create('audio');\n\t\t\tDom.append(this.elements.screenAudio[userId], this.elements.screenAudioContainer);\n\t\t}\n\n\t\tthis.users[userId] = new CallUser({\n\t\t\tparentContainer: this.container,\n\t\t\tuserModel: userModel,\n\t\t\taudioElement: this.elements.audio[userId],\n\t\t\tscreenAudioElement: this.elements.screenAudio[userId],\n\t\t\tallowPinButton: this.getConnectedUserCount() > 1,\n\t\t\tonClick: this._onUserClick.bind(this),\n\t\t\tonPin: this._onUserPin.bind(this),\n\t\t\tonUnPin: this._onUserUnPin.bind(this),\n\t\t\tonTurnOffParticipantMic: this._onTurnOffParticipantMic.bind(this),\n\t\t\tonTurnOffParticipantCam: this._onTurnOffParticipantCam.bind(this),\n\t\t\tonTurnOffParticipantScreenshare: this._onTurnOffParticipantScreenshare.bind(this),\n\t\t});\n\n\t\tthis.screenUsers[userId] = new CallUser({\n\t\t\tparentContainer: this.container,\n\t\t\tuserModel: userModel,\n\t\t\tallowPinButton: false,\n\t\t\tscreenSharingUser: true,\n\t\t});\n\n\t\tif (this.elements.root && state !== UserState.Idle)\n\t\t{\n\t\t\tif (state === UserState.Connected)\n\t\t\t{\n\t\t\t\tthis.cache.set('previousConnectedUserCount', this.cache.get('currentConnectedUser')?.length || 0);\n\t\t\t\tthis.cache.delete('currentConnectedUser');\n\t\t\t\tthis.cache.delete('activeUsers');\n\t\t\t}\n\n\t\t\tthis.updateUserList();\n\t\t\tthis.updateButtons();\n\t\t\tthis.updateUserButtons();\n\t\t\tthis.muteSpeaker(this.speakerMuted);\n\t\t}\n\t};\n\n\tsetUserDirection(userId, direction)\n\t{\n\t\tconst user = this.userRegistry.get(userId);\n\t\tif (!user || user.direction == direction)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tuser.direction = direction;\n\t\tthis.updateUserList();\n\t};\n\n\tsetLocalUserDirection(direction)\n\t{\n\t\tif (this.localUser.userModel.direction != direction)\n\t\t{\n\t\t\tthis.localUser.userModel.direction = direction;\n\t\t\tthis.updateUserList();\n\t\t}\n\t};\n\n\tsetUserState(userId, newState)\n\t{\n\t\tconst user = this.userRegistry.get(userId);\n\t\tif (!user || user.state === newState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif ((user.state === UserState.Connected || newState === UserState.Connected))\n\t\t{\n\t\t\tthis.cache.set('previousConnectedUserCount', this.cache.get('currentConnectedUser')?.length || 0);\n\t\t\tthis.cache.delete('currentConnectedUser');\n\t\t\tthis.cache.delete('activeUsers');\n\t\t}\n\n\t\tif (newState === UserState.Connected && this.uiState === UiState.Calling)\n\t\t{\n\t\t\tthis.setUiState(UiState.Connected);\n\t\t}\n\n\t\tuser.state = newState;\n\n\t\t// maybe switch central user\n\t\tif (this.centralUser.id == this.userId && newState == UserState.Connected)\n\t\t{\n\t\t\tthis.setCentralUser(userId);\n\t\t}\n\t\telse if (userId == this.centralUser.id)\n\t\t{\n\t\t\tif (newState == UserState.Connecting || newState == UserState.Failed)\n\t\t\t{\n\t\t\t\tthis.centralUser.blurVideo();\n\t\t\t}\n\t\t\telse if (newState == UserState.Connected)\n\t\t\t{\n\t\t\t\tthis.centralUser.blurVideo(false);\n\t\t\t}\n\t\t\telse if (newState == UserState.Idle)\n\t\t\t{\n\t\t\t\tconst usersWithVideo = this.getUsersWithVideo();\n\t\t\t\tconst connectedUsers = this.getConnectedUsers();\n\n\t\t\t\tif (connectedUsers.length === 0)\n\t\t\t\t{\n\t\t\t\t\tthis.setCentralUser(this.userId);\n\t\t\t\t}\n\t\t\t\telse if (usersWithVideo.length > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.setCentralUser(usersWithVideo[0]);\n\t\t\t\t}\n\t\t\t\telse //if (connectedUsers.length > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.setCentralUser(connectedUsers[0]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\n\t\tif (newState === UserState.Connected)\n\t\t{\n\t\t\tconst timer = setTimeout(() => {\n\t\t\t\tthis.waitingForUserMediaTimeouts.delete(userId);\n\t\t\t}, WAITING_VIDEO_DELAY);\n\t\t\tthis.waitingForUserMediaTimeouts.set(userId, timer);\n\t\t}\n\t\telse if (newState === UserState.Idle)\n\t\t{\n\t\t\tthis.setUserFloorRequestState(userId, false);\n\t\t\tthis.setUserPermissionToSpeakState(userId, false);\n\t\t\tclearTimeout(this.waitingForUserMediaTimeouts.get(userId));\n\t\t\tthis.waitingForUserMediaTimeouts.delete(userId);\n\t\t\tthis.rerenderQueue.set(userId, {\n\t\t\t\tuserId,\n\t\t\t\treason: RerenderReason.UserDisconnected,\n\t\t\t});\n\t\t}\n\n\t\tif (newState == UserState.Connected && user.order == newUserPosition)\n\t\t{\n\t\t\tuser.order = this.getNextPosition();\n\t\t}\n\t\telse if (newState == UserState.Idle)\n\t\t{\n\t\t\t// reset user position to add them in the end after they reconnect\n\t\t\tuser.prevOrder = user.order;\n\t\t\tuser.order = newUserPosition;\n\t\t\tuser.prevCameraState = user.cameraState;\n\t\t\tuser.cameraState = false;\n\t\t}\n\n\t\tif (userId == this.localUser.id)\n\t\t{\n\t\t\tthis.localUser.userModel.cameraState = this.localUser.hasCameraVideo();\n\t\t}\n\n\t\tconst skippedElementsList = userId === this.localUser.id ? [] : ['panel'];\n\n\t\tif (userId == this.presenterId && newState !== UserState.Connected)\n\t\t{\n\t\t\tthis.switchPresenter();\n\t\t}\n\n\t\tthis.updateUserList();\n\t\tthis.updateButtons(skippedElementsList);\n\t\tthis.updateUserButtons();\n\t};\n\n\tsetTitle(title)\n\t{\n\t\tthis.title = title;\n\t};\n\n\tgetUserTalking(userId)\n\t{\n\t\tconst user = this.userRegistry.get(userId);\n\t\tif (!user)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn !!user.talking;\n\t}\n\n\tsetUserTalking(userId, talking): void\n\t{\n\t\tconst user = this.userRegistry.get(userId);\n\t\tif (!user)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tuser.talking = talking;\n\n\t\tif (userId == this.userId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (userId == this.presenterId && !talking)\n\t\t{\n\t\t\tthis.switchPresenterDeferred();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.switchPresenter();\n\t\t}\n\t}\n\n\tsetUserStats(userId, stats)\n\t{\n\t\tif (this.users[userId])\n\t\t{\n\t\t\tthis.users[userId].showStats(stats);\n\t\t}\n\t\tif (this.screenUsers[userId])\n\t\t{\n\t\t\tthis.screenUsers[userId].showStats(stats);\n\t\t}\n\t\tif (userId == this.localUser.id)\n\t\t{\n\t\t\tthis.localUser.showStats(stats);\n\t\t\tthis.localUserRecivedStats = true;\n\t\t}\n\n\t\tthis.pictureInPictureCallWindow?.setStats(userId, stats);\n\n\t\tthis.updateButtons()\n\t}\n\n\tsetTrackSubscriptionFailed(data)\n\t{\n\t\tif (this.users[data.participant.userId])\n\t\t{\n\t\t\tif(data.participant.userId && data.track){\n\t\t\t\tthis.users[data.participant.userId].showTrackSubscriptionFailed(data.track);\n\t\t\t}\n\t\t}\n\t}\n\n\tsetUserMicrophoneState(userId, isMicrophoneOn)\n\t{\n\t\tconst user = this.userRegistry.get(userId);\n\t\tif (user)\n\t\t{\n\t\t\tuser.microphoneState = isMicrophoneOn;\n\t\t}\n\t};\n\n\tsetUserCameraState(userId, cameraState)\n\t{\n\t\tconst user = this.userRegistry.get(userId);\n\t\tif (user)\n\t\t{\n\t\t\tuser.cameraState = cameraState;\n\t\t}\n\t};\n\n\tsetUserVideoPaused(userId, videoPaused)\n\t{\n\t\tconst user = this.userRegistry.get(userId);\n\t\tif (user)\n\t\t{\n\t\t\tuser.videoPaused = videoPaused;\n\t\t\tuser.cameraState = !videoPaused;\n\n\t\t\tif (!user.videoPaused !== videoPaused)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvideoPaused\n\t\t\t\t? this.updateRerenderQueue(userId, RerenderReason.VideoDisabled)\n\t\t\t\t: this.updateRerenderQueue(userId, RerenderReason.VideoEnabled);\n\t\t}\n\t};\n\n\tgetUserFloorRequestState(userId)\n\t{\n\t\tconst user = this.userRegistry.get(userId);\n\n\t\treturn user && user.floorRequestState;\n\t};\n\n\tsetUserFloorRequestState(userId, userFloorRequestState)\n\t{\n\t\tconst user: UserModel = this.userRegistry.get(userId);\n\t\tif (!user)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (user.floorRequestState != userFloorRequestState)\n\t\t{\n\t\t\tconst userState = user?.state;\n\t\t\tconst userActive = (userState !== UserState.Idle\n\t\t\t\t&& userState !== UserState.Declined\n\t\t\t\t&& userState !== UserState.Unavailable\n\t\t\t\t&& userState !== UserState.Busy\n\t\t\t);\n\t\t\tif (userFloorRequestState && !userActive)\n\t\t\t{\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tuser.floorRequestState = userFloorRequestState;\n\n\t\t\tif (userId != this.localUser.id)\n\t\t\t{\n\t\t\t\tthis.updateFloorRequestNotifications(user, userFloorRequestState);\n\t\t\t}\n\n\t\t\tif (userId != this.localUser.id && userFloorRequestState)\n\t\t\t{\n\t\t\t\tthis.showFloorRequestNotification(userId);\n\t\t\t}\n\t\t}\n\n\t\tif (userId == this.userId)\n\t\t{\n\t\t\tthis.setButtonActive('floorRequest', userFloorRequestState);\n\t\t}\n\t};\n\n\tsetUserPermissionToSpeakState(userId, permissionToSpeakState)\n\t{\n\t\tconst user: UserModel = this.userRegistry.get(userId);\n\t\tif (!user)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (user.permissionToSpeak !== permissionToSpeakState)\n\t\t{\n\t\t\tuser.permissionToSpeak = permissionToSpeakState;\n\t\t}\n\t};\n\n\tsetAllUserPermissionToSpeakState(permissionToSpeakState)\n\t{\n\t\tthis.userRegistry.users.forEach((userModel) => {userModel.permissionToSpeak = permissionToSpeakState});\n\t};\n\n\tpinUser(userId): void\n\t{\n\t\tif (!(userId in this.users) && userId !== Number(this.userId))\n\t\t{\n\t\t\tconsole.error(`User ${userId} is not known`);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.pinnedUser && this.userRegistry.users.has(this.pinnedUser.userModel.id))\n\t\t{\n\t\t\tthis.userRegistry.get(this.pinnedUser.userModel.id).pinned = false;\n\t\t}\n\t\tthis.pinnedUser = this.users[userId] || this.localUser;\n\t\tthis.userRegistry.get(this.pinnedUser.userModel.id).pinned = true;\n\t\tthis.setCentralUser(userId);\n\t\tthis.eventEmitter.emit(EventName.onUserPinned, { userId });\n\n\t\tthis.eventEmitter.emit(EventName.onHasMainStream, {\n\t\t\tuserId: this.centralUser.id,\n\t\t});\n\t}\n\n\tunpinUser(): void\n\t{\n\t\tif (this.pinnedUser && this.userRegistry.users.has(this.pinnedUser.userModel.id))\n\t\t{\n\t\t\tthis.userRegistry.get(this.pinnedUser.userModel.id).pinned = false;\n\t\t}\n\t\tthis.pinnedUser = null;\n\n\t\tthis.eventEmitter.emit(EventName.onUserPinned, {\n\t\t\tuserId: null,\n\t\t});\n\n\t\tthis.eventEmitter.emit(EventName.onHasMainStream, {\n\t\t\tuserId: null,\n\t\t});\n\t\tthis.switchPresenterDeferred();\n\t}\n\n\tupdateFloorRequestNotifications(userModel, floorRequestState)\n\t{\n\t\tconst indexFloorRequestInList = this.floorRequestNotifications.findIndex(req => req.userModel.id === userModel.id);\n\t\tconst hasFloorRequestInList = indexFloorRequestInList !== -1;\n\t\tconst currentUser = this.users[userModel.id];\n\t\tconst currentUserData = {\n\t\t\tuserModel,\n\t\t\tavatarBackgroundColor: currentUser?.avatarBackground || Util.getAvatarBackground(),\n\t\t}\n\n\t\tif (floorRequestState && !hasFloorRequestInList)\n\t\t{\n\t\t\tthis.floorRequestNotifications.push(currentUserData);\n\t\t}\n\n\t\tif (!floorRequestState && hasFloorRequestInList)\n\t\t{\n\t\t\tthis.floorRequestNotifications.splice(indexFloorRequestInList, 1);\n\t\t}\n\n\t\tthis.pictureInPictureCallWindow?.updateFloorRequestState(currentUserData);\n\t}\n\n\tshowFloorRequestNotification(userId)\n\t{\n\t\tconst userModel: ?UserModel = this.userRegistry.get(userId);\n\t\tif (!userModel)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet notification = FloorRequest.create({\n\t\t\tuserModel,\n\t\t\tonAllowSpeakPermissionClicked: (_userModel) => {\n\t\t\t\tthis._onAllowSpeakPermissionClickedHandler(_userModel);\n\t\t\t},\n\t\t\tonDisallowSpeakPermissionClicked: (_userModel) => {\n\t\t\t\tthis._onDisallowSpeakPermissionClickedHandler(_userModel);\n\t\t\t},\n\t\t});\n\n\t\tnotification.mount(this.elements.notificationPanel);\n\t\tNotificationManager.Instance.addNotification(notification);\n\t};\n\n\tupdateFloorRequestNotification()\n\t{\n\t\tif (!NotificationManager?.Instance.notifications.length)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tNotificationManager.Instance.notifications.forEach(notification =>\n\t\t{\n\t\t\tnotification.updatePermissionButtonState();\n\t\t});\n\t}\n\n\t_onAllowSpeakPermissionClickedHandler(_userModel)\n\t{\n\t\tthis.setUserPermissionToSpeakState(_userModel.id, true);\n\t\tthis.eventEmitter.emit(EventName.onAllowSpeakPermission, {\n\t\t\tuserId: _userModel.id\n\t\t});\n\t}\n\n\t_onDisallowSpeakPermissionClickedHandler(_userModel)\n\t{\n\t\tthis.eventEmitter.emit(EventName.onDisallowSpeakPermission, {\n\t\t\tuserId: _userModel.id\n\t\t});\n\t}\n\n\tsetUserScreenState(userId, screenState)\n\t{\n\t\tconst user: ?UserModel = this.userRegistry.get(userId);\n\t\tif (!user)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tuser.screenState = screenState;\n\t\tif (userId != this.userId)\n\t\t{\n\t\t\tif (screenState === true && this.layout === View.Layout.Grid)\n\t\t\t{\n\t\t\t\tthis.setLayout(Layouts.Centered);\n\t\t\t\tthis.returnToGridAfterScreenStopped = true;\n\t\t\t}\n\t\t\tif (screenState === false\n\t\t\t\t&& this.layout === Layouts.Centered\n\t\t\t\t&& !this.hasUserWithScreenSharing()\n\t\t\t\t&& !this.pinnedUser\n\t\t\t\t&& this.returnToGridAfterScreenStopped)\n\t\t\t{\n\t\t\t\tthis.returnToGridAfterScreenStopped = false;\n\t\t\t\tthis.setLayout(Layouts.Grid);\n\t\t\t}\n\t\t\tthis.switchPresenter();\n\t\t}\n\t};\n\n\tflipLocalVideo(flipVideo)\n\t{\n\t\tthis.localUser.flipVideo = !!flipVideo;\n\t}\n\n\tsetLocalStream(streamData)\n\t{\n\t\tconst mediaRenderer = streamData.mediaRenderer;\n\t\tconst mediaStream = streamData.stream;\n\t\tconst removed = streamData.removed;\n\t\tconst flipVideo = streamData.flipVideo;\n\n\t\tif (removed)\n\t\t{\n\t\t\tmediaRenderer.stream = null;\n\t\t}\n\n\t\tif (mediaRenderer) // for Bitrix calls\n\t\t{\n\t\t\tthis.localUser.videoRenderer = mediaRenderer;\n\t\t\tthis.pictureInPictureCallWindow?.setVideoRenderer(this.userId, mediaRenderer);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst videoTrack = mediaStream.getVideoTracks().length > 0 ? mediaStream.getVideoTracks()[0] : null;\n\t\t\tthis.localUser.videoTrack = videoTrack;\n\t\t\tthis.pictureInPictureCallWindow?.setVideoRenderer(this.userId, new MediaRenderer({\n\t\t\t\tkind: 'video',\n\t\t\t\ttrack: videoTrack,\n\t\t\t}));\n\t\t}\n\n\t\tif (!Type.isUndefined(flipVideo))\n\t\t{\n\t\t\tthis.flipLocalVideo(flipVideo);\n\t\t}\n\t\tthis.localUser.userModel.cameraState = this.localUser.hasCameraVideo();\n\n\t\tconst videoTracks = mediaStream.getVideoTracks();\n\t\tif (videoTracks.length > 0)\n\t\t{\n\t\t\tconst videoTrackSettings = videoTracks[0].getSettings();\n\t\t\tthis.cameraId = videoTrackSettings.deviceId || '';\n\t\t}\n\t\telse if (!mediaRenderer)\n\t\t{\n\t\t\tthis.cameraId = '';\n\t\t}\n\n\t\tconst audioTracks = mediaStream.getAudioTracks();\n\t\tif (audioTracks.length > 0)\n\t\t{\n\t\t\tconst audioTrackSettings = audioTracks[0].getSettings();\n\t\t\tthis.microphoneId = audioTrackSettings.deviceId || '';\n\t\t}\n\n\t\t/*if(!this.localUser.hasVideo())\n\t\t{\n\t\t\treturn false;\n\t\t}*/\n\n\t\tif (this.layout !== Layouts.Grid && this.centralUser.id == this.userId)\n\t\t{\n\t\t\tif (mediaRenderer) // for Bitrix ca;ls\n\t\t\t{\n\t\t\t\tthis.centralUser.videoRenderer = mediaRenderer;\n\t\t\t}\n\t\t\telse if (videoTracks.length > 0 || Object.keys(this.users).length === 0)\n\t\t\t{\n\t\t\t\tthis.centralUser.videoTrack = videoTracks[0];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.setCentralUser(Object.keys(this.users)[0]);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.updateUserList();\n\t\t}\n\n\t\tthis.updateButtons()\n\t};\n\n\tsetLocalStreamVideoTrack(videoTrack)\n\t{\n\t\tthis.localStreamVideoTrack = videoTrack;\n\n\t\tthis.pictureInPictureCallWindow?.setVideoRenderer(this.userId, new MediaRenderer({\n\t\t\tkind: 'sharing',\n\t\t\ttrack: videoTrack,\n\t\t}));\n\t}\n\n\tsetSpeakerId(speakerId)\n\t{\n\t\tif (this.speakerId == speakerId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!('setSinkId' in HTMLMediaElement.prototype))\n\t\t{\n\t\t\tconsole.error(\"Speaker selection is not supported\");\n\t\t}\n\n\t\tthis.speakerId = speakerId;\n\t\tfor (let userId in this.elements.audio)\n\t\t{\n\t\t\tthis.elements.audio[userId].setSinkId(this.speakerId);\n\t\t}\n\t};\n\n\tmuteSpeaker(mute)\n\t{\n\t\tthis.speakerMuted = !!mute;\n\n\t\tfor (let userId in this.elements.audio)\n\t\t{\n\t\t\tthis.elements.audio[userId].volume = this.speakerMuted ? 0 : 1;\n\t\t}\n\n\t\tif (!this.buttons.speaker)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.speakerMuted)\n\t\t{\n\t\t\tthis.buttons.speaker.disable();\n\t\t\tthis.buttons.speaker.hideArrow()\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.buttons.speaker.enable();\n\t\t\tif (Hardware.canSelectSpeaker())\n\t\t\t{\n\t\t\t\tthis.buttons.speaker.showArrow()\n\t\t\t}\n\t\t}\n\t};\n\n\tupdateRerenderQueue(userId, reason)\n\t{\n\t\tif (!this.users[userId])\n\t\t{\n\t\t\tthrow Error(\"User \" + userId + \" is not a part of this call\");\n\t\t}\n\n\t\tif (reason === RerenderReason.VideoEnabled)\n\t\t{\n\t\t\tif (this.rerenderQueue.get(userId)?.reason === RerenderReason.VideoDisabled)\n\t\t\t{\n\t\t\t\tthis.rerenderQueue.delete(userId);\n\t\t\t\tif (!this.rerenderQueue.size)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.rerenderTimeout);\n\t\t\t\t\tthis.rerenderTimeout = null;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (this.waitingForUserMediaTimeouts.has(userId))\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.waitingForUserMediaTimeouts.get(userId));\n\t\t\t\t\tthis.waitingForUserMediaTimeouts.delete(userId);\n\t\t\t\t\tthis.rerenderQueue.set(userId, {\n\t\t\t\t\t\tuserId,\n\t\t\t\t\t\treason: RerenderReason.VideoEnabled,\n\t\t\t\t\t});\n\t\t\t\t\tthis.renderUserList();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tif (!this.rerenderTimeout)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.rerenderTimeout = setTimeout(() => {\n\t\t\t\t\t\t\tthis.renderUserList();\n\t\t\t\t\t\t}, this.videoRerenderDelay);\n\t\t\t\t\t}\n\t\t\t\t\tthis.rerenderQueue.set(userId, {\n\t\t\t\t\t\tuserId,\n\t\t\t\t\t\treason: RerenderReason.VideoEnabled,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if (reason === RerenderReason.VideoDisabled)\n\t\t{\n\t\t\tif (this.rerenderQueue.get(userId)?.reason === RerenderReason.VideoEnabled)\n\t\t\t{\n\t\t\t\tthis.rerenderQueue.delete(userId);\n\t\t\t\tif (!this.rerenderQueue.size)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.rerenderTimeout);\n\t\t\t\t\tthis.rerenderTimeout = null;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (!this.rerenderTimeout)\n\t\t\t\t{\n\t\t\t\t\tthis.rerenderTimeout = setTimeout(() =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.renderUserList();\n\t\t\t\t\t}, this.videoRerenderDelay);\n\t\t\t\t}\n\n\t\t\t\tthis.rerenderQueue.set(userId, {\n\t\t\t\t\tuserId,\n\t\t\t\t\treason: RerenderReason.VideoDisabled,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tsetVideoRenderer(userId, mediaRenderer)\n\t{\n\t\tconst user = this.users[userId];\n\t\tif (!user)\n\t\t{\n\t\t\tthrow Error(\"User \" + userId + \" is not a part of this call\");\n\t\t}\n\n\t\tthis.cache.delete('usersWithVideo');\n\n\t\tif (mediaRenderer === null)\n\t\t{\n\t\t\tif (user.hasCameraVideo())\n\t\t\t{\n\t\t\t\tthis.updateRerenderQueue(userId, RerenderReason.VideoDisabled);\n\t\t\t}\n\t\t\tuser.videoRenderer = null;\n\t\t\tthis.pictureInPictureCallWindow?.setVideoRenderer(userId, null);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!(\"render\" in mediaRenderer) || !Type.isFunction(mediaRenderer.render))\n\t\t{\n\t\t\tthrow Error(\"mediaRenderer should have method render\");\n\t\t}\n\t\tif (!(\"kind\" in mediaRenderer) || (mediaRenderer.kind !== \"video\" && mediaRenderer.kind !== \"sharing\"))\n\t\t{\n\t\t\tthrow Error(\"mediaRenderer should be of video kind\");\n\t\t}\n\n\t\tconst userHasCameraVideo = user.hasCameraVideo();\n\t\tuser.videoRenderer = mediaRenderer;\n\t\tthis.pictureInPictureCallWindow?.setVideoRenderer(userId, mediaRenderer);\n\n\t\tif (mediaRenderer.stream && mediaRenderer.kind === 'video')\n\t\t{\n\t\t\tthis.updateRerenderQueue(userId, RerenderReason.VideoEnabled);\n\t\t}\n\t\telse if (mediaRenderer.kind === 'video')\n\t\t{\n\t\t\tif (!userHasCameraVideo)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.updateRerenderQueue(userId, RerenderReason.VideoDisabled);\n\t\t}\n\t};\n\n\tsetUserMedia(userId, kind, track)\n\t{\n\t\tif (kind === 'audio')\n\t\t{\n\t\t\tthis.users[userId].audioTrack = track;\n\t\t}\n\n\t\tswitch (kind)\n\t\t{\n\t\t\tcase 'sharingAudio':\n\t\t\t\tthis.users[userId].screenAudioTrack = track;\n\t\t\t\tbreak;\n\n\t\t\tcase 'video':\n\t\t\t\tthis.users[userId].videoTrack = track;\n\t\t\t\tthis.pictureInPictureCallWindow?.setVideoRenderer(userId, new MediaRenderer({\n\t\t\t\t\tkind: 'video',\n\t\t\t\t\ttrack: track,\n\t\t\t\t}));\n\t\t\t\tbreak;\n\n\t\t\tcase 'screen':\n\t\t\t\tthis.screenUsers[userId].videoTrack = track;\n\t\t\t\tthis.pictureInPictureCallWindow?.setVideoRenderer(userId, new MediaRenderer({\n\t\t\t\t\tkind: 'sharing',\n\t\t\t\t\ttrack: track,\n\t\t\t\t}));\n\t\t\t\tthis.updateUserList();\n\t\t\t\tthis.setUserScreenState(userId, track !== null);\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t}\n\t}\n\n\tremoveScreenUsers()\n\t{\n\t\tfor (let userId in this.screenUsers)\n\t\t{\n\t\t\tthis.screenUsers[userId].videoTrack = null;\n\t\t}\n\t\tthis.updateUserList();\n\t};\n\n\tsetBadNetworkIndicator(userId, badNetworkIndicator)\n\t{\n\t\tif (this.users[userId])\n\t\t{\n\t\t\tthis.users[userId].badNetworkIndicator = badNetworkIndicator;\n\t\t}\n\t}\n\n\tsetUserHasConnectionProblem(userId, hasConnectionProblem)\n\t{\n\t\tif (this.users[userId])\n\t\t{\n\t\t\tthis.users[userId].hasConnectionProblem = hasConnectionProblem;\n\t\t}\n\t};\n\n\tsetUserConnectionQuality(userId, connectionQuality)\n\t{\n\t\tif (this.users[userId])\n\t\t{\n\t\t\tthis.users[userId].connectionQuality = connectionQuality;\n\t\t}\n\n\t\tif (this.localUser.id === userId)\n\t\t{\n\t\t\tthis.localUser.connectionQuality = connectionQuality;\n\t\t}\n\t};\n\n\tapplyIncomingVideoConstraints()\n\t{\n\t\tlet userId;\n\t\tlet user: CallUser;\n\t\tif (this.layout === Layouts.Grid)\n\t\t{\n\t\t\tfor (userId in this.users)\n\t\t\t{\n\t\t\t\tuser = this.users[userId];\n\t\t\t\tuser.setIncomingVideoConstraints(this.userSize.width, this.userSize.height);\n\t\t\t}\n\t\t}\n\t\telse if (this.layout === Layouts.Centered)\n\t\t{\n\t\t\tfor (userId in this.users)\n\t\t\t{\n\t\t\t\tuser = this.users[userId];\n\t\t\t\tif (userId == this.centralUser.id)\n\t\t\t\t{\n\t\t\t\t\tconst containerSize = this.elements.center.getBoundingClientRect();\n\t\t\t\t\tuser.setIncomingVideoConstraints(Math.floor(containerSize.width), Math.floor(containerSize.height));\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tuser.setIncomingVideoConstraints(SIDE_USER_WIDTH, SIDE_USER_HEIGHT);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tgetDefaultRecordState()\n\t{\n\t\treturn {\n\t\t\tstate: RecordState.Stopped,\n\t\t\tuserId: 0,\n\t\t\tdate: {\n\t\t\t\tstart: null,\n\t\t\t\tpause: []\n\t\t\t},\n\t\t};\n\t};\n\n\tsetRecordState(recordState)\n\t{\n\t\tthis.recordState = recordState;\n\t\tif (this.buttons.recordStatus)\n\t\t{\n\t\t\tthis.buttons.recordStatus.update(this.recordState);\n\t\t}\n\n\t\tif (this.recordState.userId != this.userId)\n\t\t{\n\t\t\tif (this.recordState.state === RecordState.Stopped)\n\t\t\t{\n\t\t\t\tthis.unblockButtons(['record']);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.blockButtons(['record']);\n\t\t\t}\n\t\t}\n\n\t\tif (this.elements.topPanel)\n\t\t{\n\t\t\tif (this.recordState.state === RecordState.Stopped)\n\t\t\t{\n\t\t\t\tdelete (this.elements.topPanel.dataset.recordState);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.elements.topPanel.dataset.recordState = recordState.state;\n\t\t\t}\n\t\t}\n\t};\n\n\tshow()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\tthis.render();\n\t\t}\n\t\tthis.container.appendChild(this.elements.root);\n\n\t\tif (this.layout !== Layouts.Mobile)\n\t\t{\n\t\t\tthis.startIntersectionObserver();\n\t\t}\n\t\tthis.updateButtons();\n\t\tthis.updateUserList();\n\n\t\tthis.resumeVideo();\n\t\tthis.toggleEars();\n\t\tthis.visible = true;\n\n\t\tthis.eventEmitter.emit(EventName.onShow);\n\n\t\t// We specifically disable the face improve feature to improve call quality.\n\t\tthis.disableFaceImprove();\n\t\tthis.checkPanelOverflow();\n\t};\n\n\thide()\n\t{\n\t\tthis.closeCopilotNotify();\n\t\tthis.clearCallcontrolPromo();\n\t\tif (this.overflownButtonsPopup)\n\t\t{\n\t\t\tthis.overflownButtonsPopup.close();\n\t\t}\n\t\tDom.remove(this.elements.root);\n\t\tthis.visible = false;\n\t};\n\n\tstartIntersectionObserver()\n\t{\n\t\tif (!('IntersectionObserver' in window))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.intersectionObserver = new IntersectionObserver(\n\t\t\tthis._onIntersectionChange.bind(this),\n\t\t\t{\n\t\t\t\troot: this.elements.userList.container,\n\t\t\t\tthreshold: 0.5\n\t\t\t}\n\t\t);\n\t};\n\n\t/**\n\t * @param {CallUser} callUser\n\t */\n\tobserveIntersections(callUser)\n\t{\n\t\tif (this.intersectionObserver && callUser.elements.root)\n\t\t{\n\t\t\tthis.intersectionObserver.observe(callUser.elements.root);\n\t\t}\n\t};\n\n\t/**\n\t * @param {CallUser} callUser\n\t */\n\tunobserveIntersections(callUser)\n\t{\n\t\tif (this.intersectionObserver && callUser.elements.root)\n\t\t{\n\t\t\tthis.intersectionObserver.unobserve(callUser.elements.root);\n\t\t}\n\t};\n\n\tshowDeviceSelector(bindElement)\n\t{\n\t\tif (this.deviceSelector)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.deviceSelector = new DeviceSelector({\n\t\t\tviewElement: this.container,\n\t\t\tparentElement: bindElement,\n\t\t\tzIndex: this.baseZIndex + 500,\n\t\t\tmicrophoneEnabled: !Hardware.isMicrophoneMuted,\n\t\t\tmicrophoneId: this.microphoneId || Hardware.defaultMicrophone,\n\t\t\tcameraEnabled: Hardware.isCameraOn,\n\t\t\tcameraId: this.cameraId,\n\t\t\tspeakerEnabled: !this.speakerMuted,\n\t\t\tspeakerId: this.speakerId,\n\t\t\tallowHdVideo: Hardware.preferHdQuality,\n\t\t\tfaceImproveEnabled: Util.isDesktop() && DesktopApi.isDesktop() && DesktopApi.getCameraSmoothingStatus(),\n\t\t\tallowFaceImprove: false,\n\t\t\tallowBackground: BackgroundDialog.isAvailable() && this.isIntranetOrExtranet,\n\t\t\tallowMask: BackgroundDialog.isMaskAvailable() && this.isIntranetOrExtranet,\n\t\t\tallowAdvancedSettings: typeof (BXIM) !== 'undefined' && this.isIntranetOrExtranet,\n\t\t\tswitchCameraBlocked: this.blockedButtons['camera'],\n\t\t\tswitchMicrophoneBlocked: this.blockedButtons['microphone'],\n\t\t\tevents: {\n\t\t\t\t[DeviceSelector.Events.onMicrophoneSelect]: this._onMicrophoneSelected.bind(this),\n\t\t\t\t[DeviceSelector.Events.onMicrophoneSwitch]: this._onMicrophoneButtonClick.bind(this),\n\t\t\t\t[DeviceSelector.Events.onCameraSelect]: this._onCameraSelected.bind(this),\n\t\t\t\t[DeviceSelector.Events.onCameraSwitch]: this._onCameraButtonClick.bind(this),\n\t\t\t\t[DeviceSelector.Events.onSpeakerSelect]: this._onSpeakerSelected.bind(this),\n\t\t\t\t[DeviceSelector.Events.onSpeakerSwitch]: this._onSpeakerButtonClick.bind(this),\n\t\t\t\t[DeviceSelector.Events.onChangeHdVideo]: this._onChangeHdVideo.bind(this),\n\t\t\t\t[DeviceSelector.Events.onChangeMicAutoParams]: this._onChangeMicAutoParams.bind(this),\n\t\t\t\t[DeviceSelector.Events.onChangeFaceImprove]: this._onChangeFaceImprove.bind(this),\n\t\t\t\t[DeviceSelector.Events.onAdvancedSettingsClick]: () => this.eventEmitter.emit(EventName.onOpenAdvancedSettings),\n\t\t\t\t[DeviceSelector.Events.onDestroy]: () => this.deviceSelector = null,\n\t\t\t\t[DeviceSelector.Events.onShow]: () => this.eventEmitter.emit(EventName.onDeviceSelectorShow, {}),\n\t\t\t}\n\t\t});\n\t\tthis.deviceSelector.show();\n\t};\n\n\tshowCallMenu()\n\t{\n\t\tlet menuItems = [\n\t\t\t{\n\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_WANT_TO_SAY\"),\n\t\t\t\ticonClass: \"hand\",\n\t\t\t\tonClick: this._onMobileCallMenuFloorRequestClick.bind(this)\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_MENU_PARTICIPANTS_LIST\"),\n\t\t\t\ticonClass: \"participants\",\n\t\t\t\tonClick: this._onMobileCallMenShowParticipantsClick.bind(this)\n\t\t\t},\n\t\t\t// TODO:\n\t\t\t/*{\n\t\t\t\ttext: \"Add participant\",\n\t\t\t\ticonClass: \"add-participant\",\n\t\t\t\tonClick: function() {}\n\t\t\t},*/\n\n\t\t\t/*{ //DEBUG: mobile audio\n\t\t\t\ttext: \"Enable audio\",\n\t\t\t\ticonClass: \"\",\n\t\t\t\tonClick: function() {\n\t\t\t\t\tfor (var userId in this.elements.audio)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.users[userId].stream)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconsole.log('user ' + userId + ' stream found, trying to play');\n\t\t\t\t\t\t\tthis.elements.audio[userId].srcObject = this.users[userId].stream;\n\t\t\t\t\t\t\tthis.elements.audio[userId].play();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.callMenu.close();\n\t\t\t\t}.bind(this)\n\t\t\t},*/\n\t\t\t{\n\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_MENU_COPY_INVITE\"),\n\t\t\t\ticonClass: \"add-participant\",\n\t\t\t\tonClick: this._onMobileCallMenuCopyInviteClick.bind(this)\n\n\t\t\t},\n\t\t\t!this.isIntranetOrExtranet\n\t\t\t\t?\n\t\t\t\t{\n\t\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_MENU_CHANGE_MY_NAME\"),\n\t\t\t\t\ticonClass: \"change-name\",\n\t\t\t\t\tonClick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.callMenu.close();\n\t\t\t\t\t\tsetTimeout(this.showRenameSlider.bind(this), 100);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t:\n\t\t\t\tnull,\n\t\t\t{\n\t\t\t\tseparator: true,\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_MENU_CANCEL\"),\n\t\t\t\tenabled: false,\n\t\t\t\tonClick: this._onMobileCallMenuCancelClick.bind(this)\n\t\t\t}\n\t\t];\n\n\t\tthis.callMenu = new MobileMenu({\n\t\t\tparent: this.elements.root,\n\t\t\titems: menuItems,\n\t\t\tonClose: () => this.callMenu.destroy(),\n\t\t\tonDestroy: () => this.callMenu = null,\n\t\t});\n\n\t\tthis.callMenu.show();\n\t};\n\n\tshowUserMenu(userId)\n\t{\n\t\tconst userModel: ?UserModel = this.userRegistry.get(userId);\n\t\tif (!userModel)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet pinItem = null;\n\t\tif (this.pinnedUser && this.pinnedUser.id == userId)\n\t\t{\n\t\t\tpinItem = {\n\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_MENU_UNPIN\"),\n\t\t\t\ticonClass: \"unpin\",\n\t\t\t\tonClick: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.userMenu.close();\n\t\t\t\t\tthis.unpinUser();\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t\telse if (this.userId != userId)\n\t\t{\n\t\t\tpinItem = {\n\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_MENU_PIN\"),\n\t\t\t\ticonClass: \"pin\",\n\t\t\t\tonClick: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.userMenu.close();\n\t\t\t\t\tthis.pinUser(userId);\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tlet menuItems = [\n\t\t\t{\n\t\t\t\tuserModel: userModel,\n\t\t\t\tenabled: false\n\t\t\t},\n\t\t\t{\n\t\t\t\tseparator: true,\n\t\t\t},\n\t\t\tpinItem,\n\t\t\tthis.userId == userId && !this.isIntranetOrExtranet\n\t\t\t\t?\n\t\t\t\t{\n\t\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_MENU_CHANGE_MY_NAME\"),\n\t\t\t\t\ticonClass: \"change-name\",\n\t\t\t\t\tonClick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.userMenu.close();\n\t\t\t\t\t\tsetTimeout(this.showRenameSlider.bind(this), 100)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t:\n\t\t\t\tnull,\n\t\t\t/*{\n\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_MENU_WRITE_TO_PRIVATE_CHAT\"),\n\t\t\t\ticonClass: \"private-chat\",\n\t\t\t\tonClick: function()\n\t\t\t\t{\n\t\t\t\t\tthis.userMenu.close();\n\t\t\t\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\n\t\t\t\t\t})\n\t\t\t\t}.bind(this)\n\t\t\t},*/\n\t\t\t/*{\n\t\t\t\t// TODO:\n\t\t\t\ttext: \"Remove user\",\n\t\t\t\ticonClass: \"remove-user\"\n\t\t\t},*/\n\t\t\t{\n\t\t\t\tseparator: true\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_MENU_CANCEL\"),\n\t\t\t\tenabled: false,\n\t\t\t\tonClick: () => this.userMenu.close(),\n\t\t\t}\n\t\t];\n\n\t\tthis.userMenu = new MobileMenu({\n\t\t\tparent: this.elements.root,\n\t\t\titems: menuItems,\n\t\t\tonClose: () => this.userMenu.destroy(),\n\t\t\tonDestroy: () => this.userMenu = null,\n\t\t});\n\t\tthis.userMenu.show();\n\t};\n\n\tshowParticipantsMenu()\n\t{\n\t\tif (this.participantsMenu)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst menuItems = [{\n\t\t\tuserModel: this.localUser.userModel,\n\t\t\tshowSubMenu: true,\n\t\t\tonClick: () => {\n\t\t\t\tthis.participantsMenu.close();\n\t\t\t\tthis.showUserMenu(this.localUser.userModel.id);\n\t\t\t},\n\t\t}];\n\n\t\t[...this.userRegistry.users.values()].forEach((userModel: UserModel) => {\n\t\t\tif (userModel.localUser || userModel.state !== UserState.Connected)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (menuItems.length > 0)\n\t\t\t{\n\t\t\t\tmenuItems.push({\n\t\t\t\t\tseparator: true,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tmenuItems.push({\n\t\t\t\tuserModel,\n\t\t\t\tshowSubMenu: true,\n\t\t\t\tonClick: () => {\n\t\t\t\t\tthis.participantsMenu.close();\n\t\t\t\t\tthis.showUserMenu(userModel.id);\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\n\t\tif (menuItems.length === 0)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.participantsMenu = new MobileMenu({\n\t\t\tparent: this.elements.root,\n\t\t\titems: menuItems,\n\t\t\theader: BX.message('IM_M_CALL_PARTICIPANTS').replace('#COUNT#', this.getConnectedUserCount(true)),\n\t\t\tlargeIcons: true,\n\n\t\t\tonClose: () => {\n\t\t\t\tthis.participantsMenu.destroy();\n\t\t\t},\n\t\t\tonDestroy: () => {\n\t\t\t\tthis.participantsMenu = null;\n\t\t\t},\n\t\t});\n\n\t\tthis.participantsMenu.show();\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * @param {Object} params\n\t * @param {string} params.text\n\t * @param {string} [params.subText]\n\t */\n\tshowMessage(params)\n\t{\n\t\tconst statusNode = Dom.create('div', {\n\t\t\tprops: { className: 'bx-messenger-videocall-user-status bx-messenger-videocall-user-status-wide' },\n\t\t});\n\n\t\tif (Type.isStringFilled(params.text))\n\t\t{\n\t\t\tconst textNode = Dom.create('div', {\n\t\t\t\tprops: { className: 'bx-messenger-videocall-status-text' },\n\t\t\t\ttext: params.text,\n\t\t\t});\n\t\t\tDom.append(textNode, statusNode);\n\t\t}\n\n\t\tthis.#showErrorLayout(statusNode);\n\t}\n\n\thideMessage()\n\t{\n\t\tthis.elements.overlay.textContent = '';\n\t}\n\n\trenderSelfTestCallLayout()\n\t{\n\t\tconst errorContainer = Dom.create('div', {\n\t\t\tprops: { className: 'bx-messenger-videocall-error-container' },\n\t\t\tchildren: [\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: { className: 'bx-messenger-videocall-error-container-icon-alert' },\n\t\t\t\t}),\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: { className: 'bx-messenger-videocall-error-message' },\n\t\t\t\t\ttext: Loc.getMessage('CALL_CONNECTED_ERROR'),\n\t\t\t\t}),\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: { className: 'bx-messenger-videocall-error-button-self-test' },\n\t\t\t\t\ttext: Loc.getMessage('CALL_RUN_SELF_TEST'),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\tUtil.startSelfTest();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\n\t\tthis.#showErrorLayout(errorContainer);\n\t}\n\n\trenderReloadPageLayout()\n\t{\n\t\tconst errorContainer = Dom.create('div', {\n\t\t\tprops: { className: 'bx-messenger-videocall-error-container' },\n\t\t\tchildren: [\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: { className: 'bx-messenger-videocall-error-container-icon-alert' },\n\t\t\t\t}),\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: { className: 'bx-messenger-videocall-error-message' },\n\t\t\t\t\thtml: Loc.getMessage('CALL_SECURITY_KEY_CHANGED', { '[break]': '<br/>' }),\n\t\t\t\t}),\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: { className: 'bx-messenger-videocall-error-button-self-test' },\n\t\t\t\t\ttext: Loc.getMessage('CALL_RELOAD_PAGE'),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\tthis.destroy();\n\t\t\t\t\t\t\tlocation.reload();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\n\t\tthis.#showErrorLayout(errorContainer);\n\t}\n\n\t#showErrorLayout(content)\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\tthis.render();\n\t\t\tDom.append(this.elements.root, this.container);\n\t\t}\n\n\t\tif (this.elements.overlay.childElementCount)\n\t\t{\n\t\t\tDom.clean(this.elements.overlay);\n\t\t}\n\n\t\tDom.append(content, this.elements.overlay);\n\t}\n\n\t/**\n\t * @param {Object} params\n\t * @param {string} params.text\n\t * @param {string} [params.subText]\n\t */\n\tshowFatalError(params)\n\t{\n\t\tthis.showMessage(params);\n\t\tthis.#prepareErrorState();\n\t}\n\n\tshowSecurityKeyError()\n\t{\n\t\tthis.renderReloadPageLayout();\n\t\tthis.#prepareErrorState();\n\t}\n\n\tshowSelfTest()\n\t{\n\t\tthis.renderSelfTestCallLayout();\n\t\tthis.#prepareErrorState();\n\t}\n\n\t#prepareErrorState()\n\t{\n\t\tthis.setUiState(UiState.Error);\n\t\t// in some cases video elements may still be shown on the error screen, let's hide them\n\t\tDom.style(this.elements.userList.container, 'display', 'none');\n\t}\n\n\tclose()\n\t{\n\t\tif (this.buttons.recordStatus)\n\t\t{\n\t\t\tthis.buttons.recordStatus.stopViewUpdate();\n\t\t}\n\t\tthis.recordState = this.getDefaultRecordState();\n\n\t\tif (this.elements.root)\n\t\t{\n\t\t\tBX.remove(this.elements.root);\n\t\t}\n\n\t\tif (this.pictureInPictureCallWindow)\n\t\t{\n\t\t\tthis.toggleStatePictureInPictureCallWindow(false)\n\t\t}\n\n\t\tthis.visible = false;\n\t\tthis.eventEmitter.emit(EventName.onClose);\n\n\t\tthis.clearCallcontrolPromo();\n\t};\n\n\tsetSize(size)\n\t{\n\t\tif (this.size == size)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.size = size;\n\n\t\tif (this.size == Size.Folded)\n\t\t{\n\t\t\tthis.clearCallcontrolPromo();\n\n\t\t\tif (this.overflownButtonsPopup)\n\t\t\t{\n\t\t\t\tthis.overflownButtonsPopup.close();\n\t\t\t}\n\t\t\tif (this.elements.panel)\n\t\t\t{\n\t\t\t\tthis.elements.panel.classList.add('bx-messenger-videocall-panel-folded');\n\t\t\t}\n\t\t\tDom.remove(this.elements.container);\n\t\t\tDom.remove(this.elements.topPanel);\n\t\t\tthis.elements.root.style.removeProperty('max-width');\n\t\t\tthis.updateButtons();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.elements.panel)\n\t\t\t{\n\t\t\t\tthis.elements.panel.classList.remove('bx-messenger-videocall-panel-folded');\n\t\t\t}\n\t\t\tthis.elements.wrap.appendChild(this.elements.topPanel);\n\t\t\tthis.elements.wrap.appendChild(this.elements.container);\n\t\t\tif (this.maxWidth > 0)\n\t\t\t{\n\t\t\t\tthis.elements.root.style.maxWidth = Math.max(this.maxWidth, MIN_WIDTH) + 'px';\n\t\t\t}\n\t\t\tthis.updateButtons();\n\t\t\tthis.updateUserList();\n\t\t\tthis.resumeVideo();\n\t\t}\n\n\t\tif (this.pictureInPictureCallWindow)\n\t\t{\n\t\t\tthis.pictureInPictureCallWindow.setButtons(this.getPictureInPictureCallWindowGetButtonsList()).updateButtons();\n\t\t}\n\t};\n\n\tisButtonBlocked(buttonName)\n\t{\n\t\tswitch (buttonName)\n\t\t{\n\t\t\tcase 'camera':\n\t\t\t\tconst isUiBlocked = this.uiState !== UiState.Preparing && this.uiState !== UiState.Connected;\n\t\t\t\tconst isForceBlock = this.blockedButtons[buttonName] === true;\n\t\t\t\tconst noCamPermission = !Util.havePermissionToBroadcast('cam');\n\t\t\t\tconst isUserConnecting = this.localUser.userModel.state === UserState.Connecting;\n\t\t\t\tconst localUserRecivedStats =  this.isVideoconf ? true : this.localUserRecivedStats;\n\t\t\t\tconst isButtonBlocked = isUiBlocked || isForceBlock || noCamPermission || isUserConnecting || !localUserRecivedStats;\n\t\t\t\treturn isButtonBlocked;\n\t\t\tcase 'chat':\n\t\t\t\treturn !this.showChatButtons || this.blockedButtons[buttonName] === true;\n\t\t\tcase 'microphone':\n\t\t\t\treturn !Util.havePermissionToBroadcast('mic');\n\t\t\tcase 'floorRequest':\n\t\t\t\treturn (this.uiState !== UiState.Connected) || this.blockedButtons[buttonName] === true;\n\t\t\tcase 'screen':\n\t\t\t\treturn !this.showShareButton || (!this.isScreenSharingSupported() || this.isFullScreen) || this.blockedButtons[buttonName] === true || !Util.havePermissionToBroadcast('screenshare');\n\t\t\tcase 'users':\n\t\t\t\treturn !this.showUsersButton || this.blockedButtons[buttonName] === true;\n\t\t\tcase 'record':\n\t\t\t\treturn !this.showRecordButton || this.blockedButtons[buttonName] === true;\n\t\t\tcase 'document':\n\t\t\t\treturn !this.showDocumentButton || this.blockedButtons[buttonName] === true;\n\t\t\tcase 'copilot':\n\t\t\t\treturn !this.showCopilotButton || this.blockedButtons[buttonName] === true;\n\t\t\tdefault:\n\t\t\t\treturn this.blockedButtons[buttonName] === true;\n\t\t}\n\t};\n\n\tisButtonHidden(buttonName)\n\t{\n\t\treturn this.hiddenButtons[buttonName] === true;\n\t};\n\n\tshowButton(buttonCode)\n\t{\n\t\tthis.showButtons([buttonCode]);\n\t};\n\n\thideButton(buttonCode)\n\t{\n\t\tthis.hideButtons([buttonCode]);\n\t};\n\n\t/**\n\t * @return {bool} Returns true if buttons update is required\n\t */\n\tcheckPanelOverflow()\n\t{\n\t\tconst delta = this.elements.panel.scrollWidth - this.elements.panel.offsetWidth\n\t\tconst mediumButtonMinWidth = 60; // todo: move to constants maybe? or maybe even calculate dynamically somehow?\n\t\tif (delta > 0)\n\t\t{\n\t\t\tlet countOfButtonsToHide = Math.ceil(delta / mediumButtonMinWidth);\n\t\t\tif (Object.keys(this.overflownButtons).length === 0)\n\t\t\t{\n\t\t\t\tcountOfButtonsToHide += 1;\n\t\t\t}\n\n\t\t\tconst buttons = this.getButtonList();\n\n\t\t\tfor (let i = buttons.length - 1; i > 0; i--)\n\t\t\t{\n\t\t\t\tif (buttons[i] === 'hangupOptions' || buttons[i] === 'hangup' || buttons[i] === 'close' || buttons[i] === 'more')\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tthis.overflownButtons[buttons[i]] = true;\n\t\t\t\tcountOfButtonsToHide -= 1;\n\t\t\t\tif (!countOfButtonsToHide)\n\t\t\t\t{\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst hiddenButtonsCount = Object.keys(this.overflownButtons).length;\n\t\t\tif (hiddenButtonsCount > 0)\n\t\t\t{\n\t\t\t\tconst unusedPanelSpace = this.calculateUnusedPanelSpace();\n\t\t\t\tif (unusedPanelSpace > 320)\n\t\t\t\t{\n\t\t\t\t\tlet countOfButtonsToShow = Math.min(Math.floor(unusedPanelSpace / mediumButtonMinWidth), hiddenButtonsCount);\n\t\t\t\t\tlet buttonsLeftHidden = hiddenButtonsCount - countOfButtonsToShow;\n\t\t\t\t\tif (buttonsLeftHidden === 1)\n\t\t\t\t\t{\n\t\t\t\t\t\tcountOfButtonsToShow += 1;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (countOfButtonsToShow == hiddenButtonsCount)\n\t\t\t\t\t{\n\t\t\t\t\t\t// show all buttons;\n\t\t\t\t\t\tthis.overflownButtons = {};\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tfor (let i = 0; i < countOfButtonsToShow; i++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdelete this.overflownButtons[Object.keys(this.overflownButtons)[0]]\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t};\n\n\t/**\n\t * @param {string[]} buttons Array of buttons names to show\n\t */\n\tshowButtons(buttons)\n\t{\n\t\tif (!Type.isArray(buttons))\n\t\t{\n\t\t\tconsole.error(\"buttons should be array\")\n\t\t}\n\n\t\tbuttons.forEach((buttonName) =>\n\t\t{\n\t\t\tif (this.hiddenButtons.hasOwnProperty(buttonName))\n\t\t\t{\n\t\t\t\tdelete this.hiddenButtons[buttonName];\n\t\t\t}\n\t\t})\n\n\t\tthis.updateButtons();\n\t};\n\n\t/**\n\t * @param {string[]} buttons Array of buttons names to hide\n\t */\n\thideButtons(buttons)\n\t{\n\t\tif (!Type.isArray(buttons))\n\t\t{\n\t\t\tconsole.error(\"buttons should be array\")\n\t\t}\n\n\t\tbuttons.forEach((buttonName) => this.hiddenButtons[buttonName] = true);\n\t\tthis.updateButtons();\n\t};\n\n\tblockAddUser()\n\t{\n\t\tthis.blockButtons(['add']);\n\t\tif (this.elements.userList.addButton)\n\t\t{\n\t\t\tDom.remove(this.elements.userList.addButton);\n\t\t}\n\t};\n\n\tunblockAddUser()\n\t{\n\t\tthis.unblockButtons(['add']);\n\n\t\tthis.updateButtons();\n\t};\n\n\tblockUsersButton()\n\t{\n\t\tthis.blockButtons(['users']);\n\n\t\tthis.updateButtons();\n\t};\n\n\tunblockUsersButton()\n\t{\n\t\tthis.unblockButtons(['users']);\n\n\t\tthis.updateButtons();\n\t};\n\n\tblockSwitchCamera()\n\t{\n\t\tthis.blockButtons(['camera']);\n\t\tif (this.deviceSelector)\n\t\t{\n\t\t\tthis.deviceSelector.toggleCameraAvailability(false);\n\t\t}\n\t};\n\n\tunblockSwitchCamera()\n\t{\n\t\tthis.unblockButtons(['camera']);\n\t\tif (this.deviceSelector)\n\t\t{\n\t\t\tthis.deviceSelector.toggleCameraAvailability(true);\n\t\t}\n\t};\n\n\tblockSwitchMicrophone()\n\t{\n\t\tthis.blockButtons(['microphone']);\n\t\tif (this.deviceSelector)\n\t\t{\n\t\t\tthis.deviceSelector.toggleMicrophoneAvailability(false);\n\t\t}\n\t};\n\n\tunblockSwitchMicrophone()\n\t{\n\t\tthis.unblockButtons(['microphone']);\n\t\tif (this.deviceSelector)\n\t\t{\n\t\t\tthis.deviceSelector.toggleMicrophoneAvailability(true);\n\t\t}\n\t};\n\n\tblockScreenSharing()\n\t{\n\t\tthis.blockButtons(['screen']);\n\t};\n\n\tblockHistoryButton()\n\t{\n\t\tthis.blockButtons(['history']);\n\t};\n\n\t/**\n\t * @param {string[]} buttons Array of buttons names to block\n\t */\n\n\tblockButtons(buttons)\n\t{\n\t\tif (!Type.isArray(buttons))\n\t\t{\n\t\t\tconsole.error(\"buttons should be array \")\n\t\t}\n\n\t\tbuttons.forEach((buttonName) =>\n\t\t{\n\t\t\tthis.blockedButtons[buttonName] = true;\n\t\t\tif (this.buttons[buttonName])\n\t\t\t{\n\t\t\t\tthis.buttons[buttonName].setBlocked(true);\n\t\t\t}\n\t\t})\n\n\t\tif (this.pictureInPictureCallWindow)\n\t\t{\n\t\t\tthis.pictureInPictureCallWindow.updateBlockButtons(this.getBlockedButtonsListPictureInPictureCallWindow()).updateButtons();\n\t\t}\n\t};\n\n\t/**\n\t * @param {string[]} buttons Array of buttons names to unblock\n\t */\n\tunblockButtons(buttons)\n\t{\n\t\tif (!Type.isArray(buttons))\n\t\t{\n\t\t\tconsole.error(\"buttons should be array\")\n\t\t}\n\n\t\tbuttons.forEach((buttonName) =>\n\t\t{\n\t\t\tdelete this.blockedButtons[buttonName];\n\t\t\tif (this.buttons[buttonName])\n\t\t\t{\n\t\t\t\tthis.buttons[buttonName].setBlocked(this.isButtonBlocked(buttonName));\n\t\t\t}\n\t\t});\n\n\t\tif (this.pictureInPictureCallWindow)\n\t\t{\n\t\t\tthis.pictureInPictureCallWindow.updateBlockButtons(this.getBlockedButtonsListPictureInPictureCallWindow()).updateButtons();\n\t\t}\n\t};\n\n\tdisableMediaSelection()\n\t{\n\t\tthis.mediaSelectionBlocked = true;\n\t};\n\n\tenableMediaSelection()\n\t{\n\t\tthis.mediaSelectionBlocked = false;\n\t\tif (this.buttons.microphone && this.isMediaSelectionAllowed())\n\t\t{\n\t\t\tthis.buttons.microphone.showArrow();\n\t\t}\n\t\tif (this.buttons.camera && this.isMediaSelectionAllowed())\n\t\t{\n\t\t\tthis.buttons.camera.showArrow();\n\t\t}\n\t};\n\n\tisMediaSelectionAllowed()\n\t{\n\t\treturn this.layout != Layouts.Mobile && (this.uiState == UiState.Preparing || this.uiState == UiState.Connected) && !this.mediaSelectionBlocked && !this.isFullScreen;\n\t};\n\n\tgetButtonList(): Array\n\t{\n\t\tlet result = [];\n\n\t\tif (this.uiState === UiState.Error)\n\t\t{\n\t\t\tresult.push('close');\n\t\t}\n\n\t\tif (this.uiState === UiState.Initializing)\n\t\t{\n\t\t\tresult.push('hangup');\n\t\t}\n\n\t\tif (this.size === Size.Folded)\n\t\t{\n\t\t\tresult.push('title', 'spacer', 'returnToCall', 'hangup');\n\t\t}\n\n\t\tif (result.length > 0)\n\t\t{\n\t\t\tthis.needToRerenderButtonList = this.previousButtonList.toString() !== result.toString();\n\t\t\tthis.previousButtonList = result;\n\n\t\t\treturn result;\n\t\t}\n\n\t\tresult.push('microphone', 'camera');\n\n\t\tif (this.layout != Layouts.Mobile)\n\t\t{\n\t\t\tresult.push('speaker');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult.push('mobileMenu');\n\t\t}\n\n\t\tresult.push('chat', 'users');\n\n\t\tif (this.layout != Layouts.Mobile)\n\t\t{\n\t\t\tresult.push('floorRequest', 'screen', 'record', 'document');\n\t\t}\n\n\t\tif (this.layout !== Layouts.Mobile && CallAI.serviceEnabled)\n\t\t{\n\t\t\tresult.push('copilot');\n\t\t}\n\n\t\tresult = result.filter((buttonCode) => {\n\t\t\treturn !Object.prototype.hasOwnProperty.call(this.hiddenButtons, buttonCode)\n\t\t\t\t&& !Object.prototype.hasOwnProperty.call(this.overflownButtons, buttonCode);\n\t\t});\n\n\t\tif (Object.keys(this.overflownButtons).length > 0)\n\t\t{\n\t\t\tresult.push('more');\n\t\t}\n\n\t\tif (this.uiState == UiState.Preparing)\n\t\t{\n\t\t\tresult.push('close');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult.push('hangup');\n\t\t}\n\n\t\tif (\n\t\t\t!Object.prototype.hasOwnProperty.call(this.hiddenButtons, 'hangupOptions')\n\t\t\t&& this.isIntranetOrExtranet\n\t\t)\n\t\t{\n\t\t\tresult.push('hangupOptions');\n\t\t}\n\n\t\tthis.needToRerenderButtonList = this.previousButtonList.toString() !== result.toString();\n\t\tthis.previousButtonList = result;\n\n\t\treturn result;\n\t}\n\n\tgetTopButtonList()\n\t{\n\t\tlet result = [];\n\n\t\tif (this.layout == Layouts.Mobile)\n\t\t{\n\t\t\treturn ['participantsMobile'];\n\t\t}\n\t\tresult.push('watermark');\n\t\tresult.push('protected');\n\t\tresult.push('recordStatus');\n\t\tresult.push('spacer');\n\n\t\tlet separatorNeeded = false;\n\t\tif (this.uiState === UiState.Connected && this.layout != Layouts.Mobile)\n\t\t{\n\t\t\tresult.push('grid');\n\t\t}\n\n\t\tif (this.uiState != UiState.Preparing && this.isFullScreenSupported() && this.layout != Layouts.Mobile)\n\t\t{\n\t\t\tresult.push('fullscreen');\n\t\t}\n\n\t\tif (this.uiState === UiState.Connected && this.layout != Layouts.Mobile)\n\t\t{\n\t\t\tresult.push('feedback');\n\t\t}\n\n\t\tif (\n\t\t\tthis.uiState === UiState.Connected\n\t\t\t&& this.layout != Layouts.Mobile\n\t\t\t&& Util.canControlChangeSettings()\n\t\t\t&& Util.isUserControlFeatureEnabled()\n\t\t)\n\t\t{\n\t\t\tresult.push('callcontrol');\n\t\t}\n\n\t\tif (this.uiState != UiState.Preparing)\n\t\t{\n\t\t\tif (separatorNeeded)\n\t\t\t{\n\t\t\t\tresult.push('separator');\n\t\t\t}\n\t\t\tresult.push('participants');\n\t\t}\n\n\t\tlet previousButtonCode = '';\n\t\tresult = result.filter((buttonCode) =>\n\t\t{\n\t\t\tif (previousButtonCode === 'spacer' && buttonCode === 'separator')\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tpreviousButtonCode = buttonCode;\n\n\t\t\treturn !this.hiddenTopButtons.hasOwnProperty(buttonCode);\n\t\t});\n\n\t\tthis.needToRerenderTopButtonList = this.previousTopButtonList.toString() !== result.toString();\n\t\tthis.previousTopButtonList = result;\n\n\t\treturn result;\n\t};\n\n\trender()\n\t{\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall bx-messenger-videocall-scope\"},\n\t\t\tchildren: [\n\t\t\t\tthis.elements.wrap = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: `bx-messenger-videocall-wrap ${this.isCopilotActive ? 'bx-messenger-videocall-wrap-with-copilot' : ''}`},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.elements.container = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-inner\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tthis.elements.center = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-central-user\"},\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\ttouchstart: this._onCenterTouchStart.bind(this),\n\t\t\t\t\t\t\t\t\t\ttouchend: this._onCenterTouchEnd.bind(this),\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.pageNavigatorLeft = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-page-navigator left\"},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tthis.elements.pageNavigatorLeftCounter = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-page-navigator-counter left\"},\n\t\t\t\t\t\t\t\t\t\t\thtml: (this.currentPage - 1) + '&nbsp;/&nbsp;' + this.pagesCount\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-page-navigator-icon left\"}\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tclick: this._onLeftPageNavigatorClick.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.pageNavigatorRight = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-page-navigator right\"},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tthis.elements.pageNavigatorRightCounter = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-page-navigator-counter right\"},\n\t\t\t\t\t\t\t\t\t\t\thtml: (this.currentPage + 1) + '&nbsp;/&nbsp;' + this.pagesCount\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-page-navigator-icon right\"}\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tclick: this._onRightPageNavigatorClick.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.topPanel = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-panel\"},\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.notificationPanel = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-notification-panel\"},\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.bottom = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-bottom\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tthis.elements.userSelectorContainer = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-bottom-user-selector-container\"}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.pinnedUserContainer = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-bottom-pinned-user-container\"}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: this._onBodyClick.bind(this)\n\t\t\t}\n\t\t});\n\n\t\tif (this.showButtonPanel)\n\t\t{\n\t\t\tthis.elements.panel = Dom.create(\"div\", {\n\t\t\t\tprops: {className: \"bx-messenger-videocall-panel\"},\n\t\t\t});\n\t\t\tthis.elements.bottom.appendChild(this.elements.panel);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root.classList.add(\"bx-messenger-videocall-no-button-panel\");\n\t\t}\n\n\t\tif (this.layout == Layouts.Mobile)\n\t\t{\n\t\t\tthis.userSelector = new UserSelectorMobile({\n\t\t\t\tuserRegistry: this.userRegistry\n\t\t\t});\n\t\t\tthis.userSelector.mount(this.elements.userSelectorContainer);\n\n\t\t\tthis.elements.ear.left = Dom.create(\"div\", {\n\t\t\t\tprops: {\n\t\t\t\t\tclassName: \"bx-messenger-videocall-mobile-ear left\"\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tclick: this._onLeftEarClick.bind(this)\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.elements.ear.right = Dom.create(\"div\", {\n\t\t\t\tprops: {\n\t\t\t\t\tclassName: \"bx-messenger-videocall-mobile-ear right\"\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tclick: this._onRightEarClick.bind(this)\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.elements.localUserMobile = Dom.create(\"div\", {\n\t\t\t\tprops: {className: \"bx-messenger-videocall-local-user-mobile\"}\n\t\t\t});\n\n\t\t\tif (window.innerHeight < window.innerWidth)\n\t\t\t{\n\t\t\t\tthis.elements.root.classList.add(\"orientation-landscape\");\n\t\t\t}\n\n\t\t\tthis.elements.wrap.appendChild(this.elements.ear.left);\n\t\t\tthis.elements.wrap.appendChild(this.elements.ear.right);\n\t\t\tthis.elements.wrap.appendChild(this.elements.localUserMobile);\n\t\t}\n\n\t\tthis.centralUser.mount(this.elements.center);\n\n\t\tthis.elements.overlay = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-overlay\"}\n\t\t});\n\n\t\tthis.elements.userBlock = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-user-block\"},\n\t\t\tchildren: [\n\t\t\t\tthis.elements.ear.top = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-ear bx-messenger-videocall-ear-top\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-ear-icon\"}\n\t\t\t\t\t\t})\n\t\t\t\t\t],\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: this._onTopPageNavigatorClick.bind(this)\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tthis.elements.ear.bottom = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-ear bx-messenger-videocall-ear-bottom\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-ear-icon\"}\n\t\t\t\t\t\t})\n\t\t\t\t\t],\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: this._onBottomPageNavigatorClick.bind(this)\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\n\t\tthis.elements.userList.container = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-messenger-videocall-user-list\"\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tscroll: Runtime.debounce(this.toggleEars.bind(this), 300),\n\t\t\t\twheel: (e) => this.elements.userList.container.scrollTop += e.deltaY\n\t\t\t}\n\t\t});\n\n\t\tthis.elements.userList.addButton = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-user-add\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-add-inner\"}\n\t\t\t\t})\n\t\t\t],\n\t\t\tstyle: {\n\t\t\t\torder: addButtonPosition\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tclick: this._onAddButtonClick.bind(this)\n\t\t\t}\n\t\t});\n\n\t\tif (this.layout == Layouts.Centered || this.layout == Layouts.Mobile)\n\t\t{\n\t\t\tthis.centralUser.mount(this.elements.center);\n\t\t\tthis.eventEmitter.emit(EventName.onHasMainStream, {\n\t\t\t\tuserId: this.centralUser.id,\n\t\t\t});\n\t\t\tthis.elements.root.classList.add('bx-messenger-videocall-centered');\n\t\t\tif (this.layout !== Layouts.Mobile)\n\t\t\t{\n\t\t\t\tthis.elements.container.appendChild(this.elements.userBlock);\n\t\t\t}\n\t\t}\n\t\tif (this.layout == Layouts.Grid)\n\t\t{\n\t\t\tthis.elements.root.classList.add(\"bx-messenger-videocall-grid\");\n\t\t}\n\t\tif (this.layout == Layouts.Mobile)\n\t\t{\n\t\t\tthis.elements.root.classList.add(\"bx-messenger-videocall-fullscreen-mobile\");\n\t\t}\n\n\t\tthis.resizeObserver.observe(this.elements.root);\n\t\tthis.resizeObserver.observe(this.container);\n\t\treturn this.elements.root;\n\t};\n\n\ttoggleSubscribingVideoInRenderUserList(participantIds, showVideo)\n\t{\n\t\tif (!!participantIds.length)\n\t\t{\n\t\t\tthis.eventEmitter.emit(EventName.onToggleSubscribe, {\n\t\t\t\tparticipantIds: participantIds,\n\t\t\t\tshowVideo: showVideo\n\t\t\t});\n\t\t}\n\t}\n\n\tgetOrderingRules(): Object\n\t{\n\t\tconst rules = {\n\t\t\t[RerenderReason.VideoEnabled]: [],\n\t\t\t[RerenderReason.VideoDisabled]: [],\n\t\t\t[RerenderReason.UserDisconnected]: null,\n\t\t};\n\n\t\tthis.rerenderQueue.forEach((el) => {\n\t\t\tswitch (el.reason)\n\t\t\t{\n\t\t\t\tcase RerenderReason.UserDisconnected:\n\t\t\t\t\trules[el.reason] = {\n\t\t\t\t\t\tid: el.userId,\n\t\t\t\t\t\torder: this.userRegistry.get(el.userId).prevOrder,\n\t\t\t\t\t};\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase RerenderReason.VideoEnabled:\n\t\t\t\tcase RerenderReason.VideoDisabled:\n\t\t\t\t\trules[el.reason].push({\n\t\t\t\t\t\tid: el.userId,\n\t\t\t\t\t\torder: this.userRegistry.get(el.userId).order,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t}\n\t\t});\n\n\t\tthis.rerenderQueue.clear();\n\t\trules[RerenderReason.VideoEnabled].sort((a, b) => a.order - b.order);\n\t\trules[RerenderReason.VideoDisabled].sort((a, b) => a.order - b.order);\n\n\t\treturn rules;\n\t}\n\n\tapplyOrderChanges(changes): void\n\t{\n\t\tif (!Type.isArray(changes))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tchanges.forEach((change) => {\n\t\t\tif (change.type === SwapType.Direct)\n\t\t\t{\n\t\t\t\tchange.to.userModel.order = change.to.order;\n\t\t\t\tthis.cache.delete('activeUsers');\n\t\t\t}\n\t\t\telse if (change.type === SwapType.Replace && change.to && change.from)\n\t\t\t{\n\t\t\t\tchange.to.userModel.order = change.from.order;\n\t\t\t\tchange.to.userModel.prevOrder = 0;\n\t\t\t\tchange.from.userModel.order = change.to.order;\n\t\t\t\tthis.cache.delete('activeUsers');\n\t\t\t}\n\t\t});\n\t}\n\n\tisUserHasActiveState(userModel)\n\t{\n\t\treturn (userModel.state !== UserState.Idle\n\t\t\t&& userModel.state !== UserState.Declined\n\t\t\t&& userModel.state !== UserState.Unavailable\n\t\t\t&& userModel.state !== UserState.Busy\n\t\t\t&& userModel.direction !== EndpointDirection.RecvOnly\n\t\t);\n\t};\n\n\tprocessVideoRules(rules, params): void\n\t{\n\t\tconst diffBetweenChanges = rules[RerenderReason.VideoEnabled].length - rules[RerenderReason.VideoDisabled].length;\n\t\tconst lessChangesField = diffBetweenChanges > 0\n\t\t\t? RerenderReason.VideoDisabled\n\t\t\t: RerenderReason.VideoEnabled;\n\t\tconst moreChangesField = diffBetweenChanges > 0\n\t\t\t? RerenderReason.VideoEnabled\n\t\t\t: RerenderReason.VideoDisabled;\n\n\t\tif (rules[RerenderReason.VideoEnabled].length > 0 && rules[RerenderReason.VideoDisabled].length > 0)\n\t\t{\n\t\t\trules[lessChangesField].forEach((el, index) => {\n\t\t\t\tconst toUser = this.userRegistry.get(el.id);\n\t\t\t\tconst fromUser = this.userRegistry.get(rules[moreChangesField][index].id);\n\n\t\t\t\tparams.orderChanges.push({\n\t\t\t\t\ttype: SwapType.Replace,\n\t\t\t\t\tto: {\n\t\t\t\t\t\tuserModel: fromUser,\n\t\t\t\t\t\torder: fromUser.order,\n\t\t\t\t\t},\n\t\t\t\t\tfrom: {\n\t\t\t\t\t\tuserModel: toUser,\n\t\t\t\t\t\torder: toUser.order,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tthis.applyOrderChanges(params.orderChanges);\n\t\tparams.orderChanges.length = 0;\n\n\t\tif (diffBetweenChanges === 0)\n\t\t{\n\t\t\trules[RerenderReason.VideoEnabled].length = 0;\n\t\t\trules[RerenderReason.VideoDisabled].length = 0;\n\t\t}\n\t\telse\n\t\t{\n\t\t\trules[moreChangesField].splice(0, rules[moreChangesField].length - Math.abs(diffBetweenChanges));\n\t\t\trules[lessChangesField].length = 0;\n\n\t\t\tif (moreChangesField === RerenderReason.VideoEnabled)\n\t\t\t{\n\t\t\t\trules[moreChangesField].forEach((el) => {\n\t\t\t\t\tparams.orderChanges.push({\n\t\t\t\t\t\ttype: SwapType.Replace,\n\t\t\t\t\t\tfrom: {\n\t\t\t\t\t\t\tuserModel: this.userRegistry.get(el.id),\n\t\t\t\t\t\t\torder: this.userRegistry.get(el.id).order,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t\tparams.incompleteSwaps.push(params.orderChanges.length);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tprocessDisconnectRules(rules, params): void\n\t{\n\t\tif (!rules[RerenderReason.UserDisconnected])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst userModel = this.userRegistry.get(rules[RerenderReason.UserDisconnected].id);\n\n\t\tif (userModel.prevCameraState)\n\t\t{\n\t\t\tparams.disconnectedUserHadVideo = true;\n\t\t}\n\t}\n\n\tcompleteVideoEnableSwap(userModel, rules, params): void\n\t{\n\t\tconst swapRemains = params.incompleteSwaps.length;\n\n\t\tif (userModel.state === UserState.Calling)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (params.usersWithEnabledVideo.includes(userModel.id))\n\t\t{\n\t\t\tparams.incompleteSwaps.pop();\n\t\t\tparams.usersWithEnabledVideo.splice(params.usersWithEnabledVideo.indexOf(userModel.id), 1);\n\t\t\tparams.usersToKeepActive.push(userModel.id);\n\t\t}\n\t\telse if (!userModel.cameraState)\n\t\t{\n\t\t\tconst index = params.incompleteSwaps[swapRemains - 1] - 1;\n\t\t\tconst userEnabledVideo = params.orderChanges[index].from;\n\t\t\tconst currenUserFromCurrentPage = params.possibleActiveUsers?.includes(userModel.id);\n\t\t\tconst changedUserFromCurrentPage = params.possibleActiveUsers?.includes(userEnabledVideo.userModel.id);\n\t\t\tconst skipDeactivation = changedUserFromCurrentPage || (currenUserFromCurrentPage && changedUserFromCurrentPage);\n\n\t\t\tparams.orderChanges[index].to = {\n\t\t\t\tuserModel,\n\t\t\t\torder: userModel.order,\n\t\t\t};\n\n\t\t\tif (!skipDeactivation)\n\t\t\t{\n\t\t\t\tparams.currentPageUsers.pop();\n\t\t\t\tparams.usersToDeactivate++;\n\t\t\t}\n\t\t\telse if (changedUserFromCurrentPage && !currenUserFromCurrentPage)\n\t\t\t{\n\t\t\t\tparams.usersToForceDeactivation.push(userEnabledVideo.userModel.id);\n\t\t\t}\n\t\t\telse if (currenUserFromCurrentPage && changedUserFromCurrentPage)\n\t\t\t{\n\t\t\t\tparams.usersToKeepActive.push(userModel.id);\n\t\t\t}\n\n\t\t\tparams.incompleteSwaps.pop();\n\t\t}\n\t}\n\n\tcompleteVideoDisabledSwap(rules, params): void\n\t{\n\t\tlet usersProcessed = 0;\n\n\t\trules[RerenderReason.VideoDisabled].forEach((el) => {\n\t\t\tconst userWithoutVideo = this.userRegistry.get(el.id);\n\t\t\tconst userWithoutVideoIndex = params.activeUsers.indexOf(el.id);\n\t\t\tconst userWithoutVideoPage = Math.ceil((userWithoutVideoIndex + 1) / this.usersPerPage);\n\t\t\tconst skipUsers = (userWithoutVideoPage - 1) * this.usersPerPage;\n\t\t\tconst numberOfUsersWithVideoForSwap = params.usersWithVideo.length - skipUsers;\n\t\t\tconst userToSwap = params.usersWithVideo[params.usersWithVideo.length - 1 - usersProcessed];\n\t\t\tconst canCompleteVideoSwap = userToSwap && userToSwap.order > el.order;\n\n\t\t\tif (canCompleteVideoSwap && (numberOfUsersWithVideoForSwap - usersProcessed >= 0))\n\t\t\t{\n\t\t\t\tusersProcessed++;\n\t\t\t\tparams.orderChanges.push({\n\t\t\t\t\ttype: SwapType.Replace,\n\t\t\t\t\tto: {\n\t\t\t\t\t\tuserModel: userWithoutVideo,\n\t\t\t\t\t\torder: userWithoutVideo.order,\n\t\t\t\t\t},\n\t\t\t\t\tfrom: {\n\t\t\t\t\t\tuserModel: userToSwap,\n\t\t\t\t\t\torder: userToSwap.order,\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tconst userToSwapIndex = params.activeUsers.indexOf(userToSwap.id);\n\t\t\t\tconst userToSwapPage = Math.ceil((userToSwapIndex + 1) / this.usersPerPage);\n\n\t\t\t\tif (userWithoutVideoPage === this.currentPage && userToSwapPage > this.currentPage)\n\t\t\t\t{\n\t\t\t\t\tparams.usersToKeepActive.push(userToSwap.id);\n\t\t\t\t\tparams.usersToForceDeactivation.push(el.id);\n\t\t\t\t\tparams.usersToDeactivate++;\n\t\t\t\t}\n\t\t\t\telse if (userToSwapPage === this.currentPage && userToSwapPage > userWithoutVideoPage)\n\t\t\t\t{\n\t\t\t\t\tparams.usersToKeepActive.push(el.id);\n\t\t\t\t\tparams.usersToForceDeactivation.push(userToSwap.id);\n\t\t\t\t\tparams.usersToDeactivate++;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.applyOrderChanges(params.orderChanges);\n\t}\n\n\tcalculateUserActive(userModel, status, userSkipped, params)\n\t{\n\t\tif (params.usersWithEnabledVideo.includes(userModel.id) && !userSkipped && !params.possibleActiveUsers.includes(userModel.id))\n\t\t{\n\t\t\tparams.currentPageUsers.push(userModel);\n\t\t\tparams.usersToDeactivate--;\n\t\t\tstatus = true;\n\t\t}\n\t\telse if (params.currentPageUsers.length + params.usersToDeactivate > this.usersPerPage)\n\t\t{\n\t\t\tparams.currentPageUsers.pop();\n\t\t\tstatus = false;\n\t\t}\n\n\t\treturn status;\n\t};\n\n\tcompleteDisconnectSwap(rules, params): void\n\t{\n\t\tconst disconnectedUser = rules[RerenderReason.UserDisconnected];\n\t\tif (!disconnectedUser)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst lowerOrderOnCurrentPage = this.userRegistry.get(params.possibleActiveUsers[0])?.order;\n\t\tconst higherOrderOnCurrentPage = this.userRegistry.get(params.possibleActiveUsers[params.possibleActiveUsers.length - 1])?.order;\n\t\tlet disconnectedUserFromCurrentPage = false;\n\n\t\tif (this.currentPage === 1)\n\t\t{\n\t\t\tdisconnectedUserFromCurrentPage = disconnectedUser.order < lowerOrderOnCurrentPage\n\t\t\t\t|| (disconnectedUser.order > lowerOrderOnCurrentPage && disconnectedUser.order < higherOrderOnCurrentPage);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst skipUsers = (this.currentPage - 2) * this.usersPerPage;\n\t\t\tconst activeUsersFromPreviousPage = params.activeUsers.slice(skipUsers, skipUsers + this.usersPerPage);\n\t\t\tconst lastActiveUserFromPreviousPage = this.userRegistry.get(activeUsersFromPreviousPage[activeUsersFromPreviousPage.length - 1]);\n\t\t\tdisconnectedUserFromCurrentPage = (disconnectedUser.order > lowerOrderOnCurrentPage && disconnectedUser.order < higherOrderOnCurrentPage)\n\t\t\t\t|| (disconnectedUser.order < lowerOrderOnCurrentPage && disconnectedUser.order > lastActiveUserFromPreviousPage?.order);\n\t\t}\n\n\t\tconst userToSwap = params.disconnectedUserHadVideo\n\t\t\t? params.usersWithVideo[params.usersWithVideo.length - 1]\n\t\t\t: this.userRegistry.get(params.activeUsers[params.activeUsers.length - 1]);\n\n\t\tif (!userToSwap || userToSwap.order <= disconnectedUser.order)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tparams.orderChanges.push({\n\t\t\ttype: SwapType.Direct,\n\t\t\tto: {\n\t\t\t\tuserModel: userToSwap,\n\t\t\t\torder: disconnectedUser.order,\n\t\t\t},\n\t\t});\n\n\t\tif (\n\t\t\tthis.currentPage !== this.pagesCount\n\t\t\t&& disconnectedUserFromCurrentPage\n\t\t\t&& !params.possibleActiveUsers.includes(userToSwap.id)\n\t\t)\n\t\t{\n\t\t\tparams.usersToKeepActive.push(userToSwap.id);\n\t\t\tparams.usersToDeactivate++;\n\t\t}\n\n\t\tthis.applyOrderChanges(params.orderChanges);\n\t}\n\n\trenderAddUserButtonInList()\n\t{\n\t\tconst showAdd = this.showAddUserButtonInList && this.layout == Layouts.Centered && this.uiState === UiState.Connected && !this.isButtonBlocked(\"add\") && this.getConnectedUserCount() < this.userLimit - 1 && !this.isFullScreen && this.elements.userList.addButton;\n\n\t\tif (showAdd)\n\t\t{\n\t\t\tthis.elements.userList.container.appendChild(this.elements.userList.addButton);\n\t\t\treturn;\n\t\t}\n\n\t\tDom.remove(this.elements.userList.addButton);\n\t};\n\n\trenderUserList(pageChange)\n\t{\n\t\tclearTimeout(this.rerenderTimeout);\n\t\tthis.rerenderTimeout = null;\n\t\tthis.activeUsers = [];\n\t\tthis.inactiveUsers = [];\n\n\t\tconst showLocalUser = this.shouldShowLocalUser();\n\t\tlet userCount = 0;\n\t\tlet skipUsers = 0;\n\t\tlet skippedUsers = 0;\n\t\tlet renderedUsers = 0;\n\n\t\tconst orderingRules = this.getOrderingRules();\n\t\tconst orderingParams = {\n\t\t\tusersWithVideo: [],\n\t\t\tusersWithEnabledVideo: [],\n\t\t\tusersWithDisabledVideo: [],\n\t\t\tpossibleActiveUsers: null,\n\t\t\tusersToKeepActive: [],\n\t\t\tusersToForceDeactivation: [],\n\t\t\tcurrentPageUsers: [],\n\t\t\torderChanges: [],\n\t\t\tincompleteSwaps: [],\n\t\t\tdisconnectedUserHadVideo: false,\n\t\t\tusersToDeactivate: 0,\n\t\t\tvideoDisabledProceed: false,\n\t\t};\n\n\t\tif ((this.layout === Layouts.Grid || this.layout === Layouts.Centered) && this.pagesCount > 1)\n\t\t{\n\t\t\tskipUsers = (this.currentPage - 1) * this.usersPerPage;\n\t\t}\n\n\t\tif (this.layout === Layouts.Grid)\n\t\t{\n\t\t\tthis.processVideoRules(orderingRules, orderingParams);\n\t\t\tthis.processDisconnectRules(orderingRules, orderingParams);\n\t\t\torderingParams.usersWithEnabledVideo = orderingRules[RerenderReason.VideoEnabled].map((el) => el.id);\n\t\t\torderingParams.usersWithDisabledVideo = orderingRules[RerenderReason.VideoDisabled].map((el) => el.id);\n\n\t\t\torderingParams.activeUsers = this.getActiveUsers();\n\t\t\torderingParams.possibleActiveUsers = orderingParams.activeUsers.slice(skipUsers, skipUsers + this.usersPerPage);\n\t\t\torderingParams.usersWithVideo = this.getUsersWithCamera();\n\n\t\t\tthis.completeVideoDisabledSwap(orderingRules, orderingParams);\n\t\t\tthis.completeDisconnectSwap(orderingRules, orderingParams);\n\n\t\t\torderingParams.activeUsers = this.getActiveUsers();\n\t\t\torderingParams.possibleActiveUsers = orderingParams.activeUsers.slice(skipUsers, skipUsers + this.usersPerPage);\n\t\t}\n\t\telse if (this.layout === Layouts.Centered)\n\t\t{\n\t\t\t// new grid logic is applied only in the Layouts.Grid layout\n\t\t\t// so we need to save some rules for later\n\t\t\torderingRules[RerenderReason.VideoEnabled].forEach((user) => this.shelvedRerenderQueue.set(user.id, {\n\t\t\t\tuserId: user.id,\n\t\t\t\treason: RerenderReason.VideoEnabled,\n\t\t\t}));\n\t\t\torderingRules[RerenderReason.VideoDisabled].forEach((user) => this.shelvedRerenderQueue.set(user.id, {\n\t\t\t\tuserId: user.id,\n\t\t\t\treason: RerenderReason.VideoDisabled,\n\t\t\t}));\n\t\t}\n\n\t\tconst userModels: UserModel[] = [...this.userRegistry.users.values()];\n\t\tfor (const userModel: UserModel of userModels)\n\t\t{\n\t\t\tconst userId = userModel.id;\n\t\t\tif (!this.users.hasOwnProperty(userId))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst user: CallUser = this.users[userId];\n\t\t\tconst screenUser: CallUser = this.screenUsers[userId];\n\t\t\tif (userId == this.centralUser.id && (this.layout == Layouts.Centered || this.layout == Layouts.Mobile))\n\t\t\t{\n\t\t\t\tif (this.layout == Layouts.Centered)\n\t\t\t\t{\n\t\t\t\t\tthis.activeUsers.push(userId);\n\t\t\t\t}\n\t\t\t\tthis.unobserveIntersections(user);\n\t\t\t\tif (screenUser.hasVideo())\n\t\t\t\t{\n\t\t\t\t\tscreenUser.mount(this.elements.center);\n\t\t\t\t\tscreenUser.visible = true;\n\t\t\t\t\tuser.mount(this.elements.userList.container);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tuser.visible = true;\n\t\t\t\t\tuser.mount(this.elements.center);\n\t\t\t\t\tscreenUser.dismount();\n\t\t\t\t}\n\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tlet userActive = this.isUserHasActiveState(userModel);\n\t\t\tlet userSkipped = false;\n\n\t\t\tif (userActive && skipUsers > 0 && skippedUsers < skipUsers)\n\t\t\t{\n\t\t\t\t// skip users on previous pages\n\t\t\t\tskippedUsers++;\n\t\t\t\tuserActive = false;\n\t\t\t\tuserSkipped = true;\n\t\t\t}\n\n\t\t\tif (userActive && this.layout === Layouts.Grid && this.usersPerPage > 0 && renderedUsers < this.usersPerPage)\n\t\t\t{\n\t\t\t\torderingParams.currentPageUsers.push(userModel);\n\t\t\t}\n\n\t\t\tif (this.layout === Layouts.Grid)\n\t\t\t{\n\t\t\t\tif (orderingRules[RerenderReason.VideoEnabled].length > 0)\n\t\t\t\t{\n\t\t\t\t\tif ((userActive || userSkipped) && orderingParams.incompleteSwaps.length > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst previousIncompleteSwaps = orderingParams.incompleteSwaps.length;\n\t\t\t\t\t\tconst index = orderingParams.incompleteSwaps[0] - 1;\n\t\t\t\t\t\tconst userEnabledVideo = orderingParams.orderChanges[index].from;\n\t\t\t\t\t\tconst currentUserFromCurrentPage = orderingParams.possibleActiveUsers?.includes(userModel.id);\n\t\t\t\t\t\tconst changedUserFromCurrentPage = orderingParams.possibleActiveUsers?.includes(userEnabledVideo.userModel.id);\n\n\t\t\t\t\t\tthis.completeVideoEnableSwap(userModel, orderingRules, orderingParams);\n\t\t\t\t\t\tconst swapCompleted = previousIncompleteSwaps !== orderingParams.incompleteSwaps.length;\n\n\t\t\t\t\t\tif (swapCompleted && userActive && !changedUserFromCurrentPage && !orderingParams.usersToKeepActive.includes(userModel.id))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tuserActive = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (swapCompleted && ((!userSkipped && !currentUserFromCurrentPage) || (userSkipped && changedUserFromCurrentPage)))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tuserActive = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (orderingParams.usersToDeactivate)\n\t\t\t\t\t{\n\t\t\t\t\t\tuserActive = this.calculateUserActive(userModel, userActive, userSkipped, orderingParams);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (orderingParams.usersToForceDeactivation.includes(userModel.id))\n\t\t\t\t\t{\n\t\t\t\t\t\tuserActive = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (orderingRules[RerenderReason.VideoDisabled].length > 0)\n\t\t\t\t{\n\t\t\t\t\tif (orderingParams.usersToKeepActive.includes(userModel.id))\n\t\t\t\t\t{\n\t\t\t\t\t\tuserActive = true;\n\t\t\t\t\t\torderingParams.usersToDeactivate--;\n\t\t\t\t\t}\n\t\t\t\t\telse if (orderingParams.usersToForceDeactivation.includes(userModel.id)\n\t\t\t\t\t\t|| (orderingParams.currentPageUsers.length + orderingParams.usersToDeactivate > this.usersPerPage)\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tuserActive = false;\n\t\t\t\t\t\torderingParams.currentPageUsers.pop();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (orderingRules[RerenderReason.UserDisconnected])\n\t\t\t\t{\n\t\t\t\t\tif (orderingParams.usersToKeepActive.includes(userModel.id))\n\t\t\t\t\t{\n\t\t\t\t\t\tuserActive = true;\n\t\t\t\t\t\torderingParams.usersToDeactivate--;\n\t\t\t\t\t}\n\t\t\t\t\telse if (orderingParams.currentPageUsers.length + orderingParams.usersToDeactivate > this.usersPerPage)\n\t\t\t\t\t{\n\t\t\t\t\t\tuserActive = false;\n\t\t\t\t\t\torderingParams.currentPageUsers.pop();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (userActive && (this.layout === Layouts.Grid || this.layout === Layouts.Centered) && this.usersPerPage > 0 && renderedUsers >= this.usersPerPage)\n\t\t\t{\n\t\t\t\t// skip users on following pages\n\t\t\t\tuserActive = false;\n\t\t\t}\n\n\t\t\tif (userActive)\n\t\t\t{\n\t\t\t\tthis.activeUsers.push(userId)\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.inactiveUsers.push(userId)\n\t\t\t}\n\n\t\t\tif (!userActive)\n\t\t\t{\n\t\t\t\tuser.dismount();\n\t\t\t\tthis.unobserveIntersections(user);\n\t\t\t\tscreenUser.dismount();\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (screenUser.hasVideo())\n\t\t\t{\n\t\t\t\tscreenUser.mount(this.elements.userList.container);\n\t\t\t\tuserCount++;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tscreenUser.dismount();\n\t\t\t}\n\t\t\tuser.mount(this.elements.userList.container);\n\t\t\tif (!this.isPreparing)\n\t\t\t{\n\t\t\t\tthis.observeIntersections(user);\n\t\t\t}\n\t\t\trenderedUsers++;\n\t\t\tuserCount++;\n\t\t}\n\n\t\tthis.applyOrderChanges(orderingParams.orderChanges);\n\n\t\tif (showLocalUser)\n\t\t{\n\t\t\tif (this.layout == Layouts.Centered && this.userId == this.centralUser.id || this.layout == Layouts.Mobile)\n\t\t\t{\n\t\t\t\t// this.unobserveIntersections(this.localUser);\n\t\t\t\tthis.localUser.mount(this.elements.center, true);\n\t\t\t\tthis.localUser.visible = true;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// using force true to always move self to the end of the list\n\t\t\t\tthis.localUser.mount(this.elements.userList.container);\n\t\t\t\tif (this.layout == Layouts.Centered && this.intersectionObserver)\n\t\t\t\t{\n\t\t\t\t\t// this.observeIntersections(this.localUser);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.localUser.visible = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tuserCount++;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.localUser.dismount();\n\t\t\t// this.unobserveIntersections(this.localUser);\n\t\t}\n\n\t\tif (this.layout == Layouts.Grid)\n\t\t{\n\t\t\tthis.updateGridUserSize(userCount);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.userList.container.classList.add(\"bx-messenger-videocall-user-list-small\");\n\t\t\tthis.elements.userList.container.style.removeProperty('--avatar-size');\n\t\t\tthis.elements.userList.container.style.removeProperty('--avatar-text-size');\n\t\t\tthis.updateCentralUserAvatarSize();\n\t\t}\n\t\tthis.applyIncomingVideoConstraints();\n\n\t\tthis.renderAddUserButtonInList();\n\n\t\tthis.elements.root.classList.toggle(\"bx-messenger-videocall-user-list-empty\", (this.elements.userList.container.childElementCount === 0));\n\t\tthis.localUser.updatePanelDeferred();\n\n\t\tconst currentActiveUsers = this.currentPiPUserId ? [...this.activeUsers, this.currentPiPUserId] : this.activeUsers;\n\t\tconst currentInactiveUsers = [...this.inactiveUsers];\n\t\tconst currentPiPUserIndexInInactiveUsers = this.currentPiPUserId ? currentInactiveUsers.indexOf(this.currentPiPUserId) : -1;\n\n\t\tif (currentPiPUserIndexInInactiveUsers !== -1)\n\t\t{\n\t\t\tcurrentInactiveUsers.splice(currentPiPUserIndexInInactiveUsers, 1);\n\t\t}\n\n\t\tthis.toggleSubscribingVideoInRenderUserList(currentActiveUsers, true)\n\t\tthis.toggleSubscribingVideoInRenderUserList(currentInactiveUsers, false)\n\t};\n\n\tshouldShowLocalUser()\n\t{\n\t\treturn (\n\t\t\tthis.localUser.userModel.state != UserState.Idle\n\t\t\t&& this.localUser.userModel.direction != EndpointDirection.RecvOnly\n\t\t);\n\t};\n\n\tupdateGridUserSize(userCount)\n\t{\n\t\tconst containerSize = this.elements.userList.container.getBoundingClientRect();\n\t\tthis.userSize = Util.findBestElementSize(\n\t\t\tcontainerSize.width,\n\t\t\tcontainerSize.height,\n\t\t\tuserCount,\n\t\t\tMIN_GRID_USER_WIDTH,\n\t\t\tMIN_GRID_USER_HEIGHT\n\t\t);\n\n\t\t//Change the size to make it possible to make indents between users\n\t\tlet rows = Math.floor(containerSize.height / MIN_GRID_USER_HEIGHT) || 1;\n\t\tthis.userSize.width -= 5 * rows;\n\t\tthis.userSize.height -= 2.75 * rows;\n\t\tconst avatarSize = Math.round(this.userSize.height * 0.45);\n\t\tconst avatarTextSize = Math.round(avatarSize * 0.45);\n\t\tthis.elements.userList.container.style.setProperty('--grid-user-width', this.userSize.width + 'px');\n\t\tthis.elements.userList.container.style.setProperty('--grid-user-height', this.userSize.height + 'px');\n\t\tthis.elements.userList.container.style.setProperty('--avatar-size', avatarSize + 'px');\n\t\tthis.elements.userList.container.style.setProperty('--avatar-text-size', avatarTextSize + 'px');\n\t\tif (this.userSize.width < 220)\n\t\t{\n\t\t\tthis.elements.userList.container.classList.add(\"bx-messenger-videocall-user-list-small\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.userList.container.classList.remove(\"bx-messenger-videocall-user-list-small\");\n\t\t}\n\t};\n\n\tupdateCentralUserAvatarSize()\n\t{\n\t\tlet containerSize;\n\t\tlet avatarSize;\n\t\tif (this.layout == Layouts.Mobile)\n\t\t{\n\t\t\tcontainerSize = this.elements.root.getBoundingClientRect();\n\t\t\tavatarSize = Math.round(containerSize.width * 0.55);\n\t\t}\n\t\telse if (this.layout == Layouts.Centered)\n\t\t{\n\t\t\tcontainerSize = this.elements.center.getBoundingClientRect();\n\t\t\tavatarSize = Math.min(Math.round(containerSize.height * 0.45), Math.round(containerSize.width * 0.45));\n\t\t\tthis.centralUser.setIncomingVideoConstraints(Math.floor(containerSize.width), Math.floor(containerSize.height));\n\t\t}\n\t\tconst avatarTextSize = Math.round(avatarSize * 0.45);\n\t\tthis.elements.center.style.setProperty('--avatar-size', avatarSize + 'px');\n\t\tthis.elements.center.style.setProperty('--avatar-text-size', avatarTextSize + 'px');\n\t};\n\n\trenderButtons(buttons, rerender): HTMLElement\n\t{\n\t\tlet panelInner, left, center, right;\n\n\t\tif (rerender)\n\t\t{\n\t\t\tpanelInner = Dom.create('div', {\n\t\t\t\tprops: { className: 'bx-messenger-videocall-panel-inner' },\n\t\t\t});\n\t\t}\n\n\t\tif (this.layout === Layouts.Mobile || this.size === Size.Folded)\n\t\t{\n\t\t\tleft = panelInner;\n\t\t\tcenter = panelInner;\n\t\t\tright = panelInner;\n\t\t}\n\t\telse if (rerender)\n\t\t{\n\t\t\tleft = Dom.create('div', {\n\t\t\t\tprops: { className: 'bx-messenger-videocall-panel-inner-left' },\n\t\t\t});\n\t\t\tcenter = Dom.create('div', {\n\t\t\t\tprops: { className: 'bx-messenger-videocall-panel-inner-center' },\n\t\t\t});\n\t\t\tright = Dom.create('div', {\n\t\t\t\tprops: { className: 'bx-messenger-videocall-panel-inner-right' },\n\t\t\t});\n\t\t\tDom.append(left, panelInner);\n\t\t\tDom.append(center, panelInner);\n\t\t\tDom.append(right, panelInner);\n\t\t}\n\n\t\tfor (let i = 0; i < buttons.length; i++)\n\t\t{\n\t\t\tswitch (buttons[i])\n\t\t\t{\n\t\t\t\tcase 'title':\n\t\t\t\t\tif (this.buttons.title)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.title.update({\n\t\t\t\t\t\t\ttext: this.title,\n\t\t\t\t\t\t\tisGroupCall: Object.keys(this.users).length > 1,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.title = new Buttons.TitleButton({\n\t\t\t\t\t\t\ttext: this.title,\n\t\t\t\t\t\t\tisGroupCall: Object.keys(this.users).length > 1,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.append(this.buttons.title.render(), left);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t/*case \"grid\":\n\t\t\t\t\tthis.buttons.grid = new SimpleButton({\n\t\t\t\t\t\tclass: \"grid\",\n\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_GRID\"),\n\t\t\t\t\t\tonClick: this._onGridButtonClick.bind(this)\n\t\t\t\t\t});\n\t\t\t\t\tpanelInner.appendChild(this.buttons.grid.render());\n\t\t\t\t\tbreak;*/\n\t\t\t\t/*case \"add\":\n\t\t\t\t\tthis.buttons.add = new SimpleButton({\n\t\t\t\t\t\tclass: \"add\",\n\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_ADD\"),\n\t\t\t\t\t\tonClick: this._onAddButtonClick.bind(this)\n\t\t\t\t\t});\n\t\t\t\t\tleftSubPanel.appendChild(this.buttons.add.render());\n\t\t\t\t\tbreak;*/\n\t\t\t\tcase 'share':\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.share = new Buttons.SimpleButton({\n\t\t\t\t\t\t\tclass: 'share',\n\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_BTN_LINK'),\n\t\t\t\t\t\t\tonClick: this._onShareButtonClick.bind(this),\n\t\t\t\t\t\t});\n\t\t\t\t\t\tDom.append(this.buttons.share.render(), center);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'microphone':\n\t\t\t\t\tif (this.buttons.microphone)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.microphone.setBlocked(this.isButtonBlocked('microphone'));\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.microphone = new Buttons.DeviceButton({\n\t\t\t\t\t\t\tclass: 'microphone',\n\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_BTN_MIC'),\n\t\t\t\t\t\t\tenabled: !Hardware.isMicrophoneMuted,\n\t\t\t\t\t\t\tarrowHidden: this.layout === Layouts.Mobile,\n\t\t\t\t\t\t\tarrowEnabled: this.isMediaSelectionAllowed(),\n\t\t\t\t\t\t\tshowPointer: true, //todo\n\t\t\t\t\t\t\tblocked: this.isButtonBlocked('microphone'),\n\t\t\t\t\t\t\tshowLevel: true,\n\t\t\t\t\t\t\tsideIcon: this.getMicrophoneSideIcon(this.roomState),\n\t\t\t\t\t\t\tonClick: this._onMicrophoneButtonClick.bind(this),\n\t\t\t\t\t\t\tonArrowClick: this._onMicrophoneArrowClick.bind(this),\n\t\t\t\t\t\t\tonSideIconClick: this._onMicrophoneSideIconClick.bind(this),\n\t\t\t\t\t\t\t...(Util.isDesktop() ? {\n\t\t\t\t\t\t\t\ttooltip: {\n\t\t\t\t\t\t\t\t\tposition: 'top',\n\t\t\t\t\t\t\t\t\tgetText: () => Hardware.isMicrophoneMuted ? `${BX.message('IM_SPACE_HOTKEY')}\\\\A${' '}${this.keyModifierForCss} + A${' '}` : `${this.keyModifierForCss} + A`,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t} : {}),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.append(this.buttons.microphone.render(), left);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'camera':\n\t\t\t\t\tif (this.buttons.camera)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.camera.setBlocked(this.isButtonBlocked('camera'));\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.camera = new Buttons.DeviceButton({\n\t\t\t\t\t\t\tclass: 'camera',\n\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_BTN_CAMERA'),\n\t\t\t\t\t\t\tenabled: Hardware.isCameraOn,\n\t\t\t\t\t\t\tarrowHidden: this.layout === Layouts.Mobile,\n\t\t\t\t\t\t\tarrowEnabled: this.isMediaSelectionAllowed(),\n\t\t\t\t\t\t\tblocked: this.isButtonBlocked('camera'),\n\t\t\t\t\t\t\tonClick: this._onCameraButtonClick.bind(this),\n\t\t\t\t\t\t\tonArrowClick: this._onCameraArrowClick.bind(this),\n\t\t\t\t\t\t\t...(Util.isDesktop() ? {\n\t\t\t\t\t\t\t\ttooltip: {\n\t\t\t\t\t\t\t\t\tposition: 'top',\n\t\t\t\t\t\t\t\t\tgetText: () => `${this.keyModifierForCss} + V`,\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} : {}),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.append(this.buttons.camera.render(), left);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'screen':\n\t\t\t\t\tif (this.buttons.screen)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.screen.setBlocked(this.isButtonBlocked('screen'));\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.screen = new Buttons.SimpleButton({\n\t\t\t\t\t\t\tclass: 'screen',\n\t\t\t\t\t\t\tbackgroundClass: 'bx-messenger-videocall-panel-background-screen',\n\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_BTN_SCREEN'),\n\t\t\t\t\t\t\tblocked: this.isButtonBlocked('screen'),\n\t\t\t\t\t\t\tonClick: this._onScreenButtonClick.bind(this),\n\t\t\t\t\t\t\t...(Util.isDesktop() ? {\n\t\t\t\t\t\t\t\ttooltip: {\n\t\t\t\t\t\t\t\t\tposition: 'top',\n\t\t\t\t\t\t\t\t\tgetText: () => `${this.keyModifierForCss} + S`,\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} : {}),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.append(this.buttons.screen.render(), center);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'record':\n\t\t\t\t\tif (this.buttons.record)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.record.setBlocked(this.isButtonBlocked('record'));\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.record = new Buttons.SimpleButton({\n\t\t\t\t\t\t\tclass: 'record',\n\t\t\t\t\t\t\tbackgroundClass: 'bx-messenger-videocall-panel-background-record',\n\t\t\t\t\t\t\ttext: [\n\t\t\t\t\t\t\t\t'View.RecordState.Started',\n\t\t\t\t\t\t\t\t'View.RecordState.Resumed'\n\t\t\t\t\t\t\t].includes(this.recordState.state)\n\t\t\t\t\t\t\t\t? BX.message('CALL_M_BTN_TITLE_STOP_RECORD')\n\t\t\t\t\t\t\t\t: BX.message('IM_M_CALL_BTN_RECORD'),\n\t\t\t\t\t\t\tblocked: this.isButtonBlocked('record'),\n\t\t\t\t\t\t\tonClick: this._onRecordToggleClick.bind(this),\n\t\t\t\t\t\t\t...(Util.isDesktop() ? {\n\t\t\t\t\t\t\t\ttooltip: {\n\t\t\t\t\t\t\t\t\tposition: 'top',\n\t\t\t\t\t\t\t\t\tgetText: () => `${this.keyModifierForCss} + R`,\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} : {}),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.append(this.buttons.record.render(), center);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'document':\n\t\t\t\t\tif (this.buttons.document)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.document.setBlocked(this.isButtonBlocked('document'));\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.document = new Buttons.SimpleButton({\n\t\t\t\t\t\t\tclass: 'document',\n\t\t\t\t\t\t\tbackgroundClass: 'bx-messenger-videocall-panel-background-document',\n\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_BTN_DOCUMENT'),\n\t\t\t\t\t\t\tblocked: this.isButtonBlocked('document'),\n\t\t\t\t\t\t\tonClick: this._onDocumentButtonClick.bind(this),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.append(this.buttons.document.render(), center);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'copilot':\n\t\t\t\t\tif (this.buttons.copilot)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.copilot.setBlocked(this.isButtonBlocked('copilot'));\n\t\t\t\t\t\tthis.buttons.copilot.setActive(this.isCopilotActive);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.copilot = new Buttons.SimpleButton({\n\t\t\t\t\t\t\tclass: 'copilot',\n\t\t\t\t\t\t\tbackgroundClass: 'bx-messenger-videocall-panel-background-copilot',\n\t\t\t\t\t\t\ttext: BX.message('CALL_BUTTON_COPILOT_TITLE'),\n\t\t\t\t\t\t\tblocked: this.isButtonBlocked('copilot'),\n\t\t\t\t\t\t\tonClick: this._onCopilotButtonClick.bind(this),\n\t\t\t\t\t\t\tisComingSoon: !this.isCopilotFeaturesEnabled,\n\t\t\t\t\t\t\t...(Util.isDesktop() ? {\n\t\t\t\t\t\t\t\ttooltip: {\n\t\t\t\t\t\t\t\t\tposition: 'top',\n\t\t\t\t\t\t\t\t\tgetText: () => this.isCopilotActive\n\t\t\t\t\t\t\t\t\t\t? Loc.getMessage('CALL_COPILOT_BUTTON_ON_HINT_V2')\n\t\t\t\t\t\t\t\t\t\t: Loc.getMessage('CALL_COPILOT_BUTTON_OFF_HINT'),\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t} : {}),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.append(this.buttons.copilot.render(), center);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'returnToCall':\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.returnToCall = new Buttons.SimpleButton({\n\t\t\t\t\t\t\tclass: 'returnToCall',\n\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_BTN_RETURN_TO_CALL'),\n\t\t\t\t\t\t\tonClick: this._onBodyClick.bind(this),\n\t\t\t\t\t\t});\n\t\t\t\t\t\tDom.append(this.buttons.returnToCall.render(), right);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'hangup':\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.hangup = new Buttons.SimpleButton({\n\t\t\t\t\t\t\tclass: 'hangup',\n\t\t\t\t\t\t\tbackgroundClass: 'bx-messenger-videocall-panel-icon-background-hangup',\n\t\t\t\t\t\t\ttext: Object.keys(this.users).length > 1 ? BX.message('IM_M_CALL_BTN_DISCONNECT') : BX.message('IM_M_CALL_BTN_HANGUP'),\n\t\t\t\t\t\t\tonClick: this._onHangupButtonClick.bind(this),\n\t\t\t\t\t\t});\n\t\t\t\t\t\tDom.append(this.buttons.hangup.render(), right);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'hangupOptions':\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.hangupOptions = new Buttons.SimpleButton({\n\t\t\t\t\t\t\tclass: 'hangup-options',\n\t\t\t\t\t\t\tbackgroundClass: 'bx-messenger-videocall-panel-icon-background-hangup-options',\n\t\t\t\t\t\t\tonClick: this._onHangupOptionsButtonClick.bind(this),\n\t\t\t\t\t\t});\n\t\t\t\t\t\tDom.append(this.buttons.hangupOptions.render(), right);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'close':\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.close = new Buttons.SimpleButton({\n\t\t\t\t\t\t\tclass: 'close',\n\t\t\t\t\t\t\tbackgroundClass: 'bx-messenger-videocall-panel-icon-background-hangup',\n\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_BTN_CLOSE'),\n\t\t\t\t\t\t\tonClick: this._onCloseButtonClick.bind(this),\n\t\t\t\t\t\t});\n\t\t\t\t\t\tDom.append(this.buttons.close.render(), right);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'speaker':\n\t\t\t\t\t/*this.buttons.speaker = new Buttons.DeviceButton({\n\t\t\t\t\t\tclass: \"speaker\",\n\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_SPEAKER\"),\n\t\t\t\t\t\tenabled: !this.speakerMuted,\n\t\t\t\t\t\tarrowEnabled: Hardware.canSelectSpeaker() && this.isMediaSelectionAllowed(),\n\t\t\t\t\t\tonClick: this._onSpeakerButtonClick.bind(this),\n\t\t\t\t\t\tonArrowClick: this._onSpeakerArrowClick.bind(this)\n\t\t\t\t\t});\n\t\t\t\t\trightSubPanel.appendChild(this.buttons.speaker.render());*/\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'mobileMenu':\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!this.buttons.mobileMenu)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.buttons.mobileMenu = new Buttons.SimpleButton({\n\t\t\t\t\t\t\t\tclass: 'sandwich',\n\t\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_BTN_MENU'),\n\t\t\t\t\t\t\t\tonClick: this._onMobileMenuButtonClick.bind(this),\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tDom.append(this.buttons.mobileMenu.render(), center);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'chat':\n\t\t\t\t\tif (this.buttons.chat)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.chat.setBlocked(this.isButtonBlocked('chat'));\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.chat = new Buttons.SimpleButton({\n\t\t\t\t\t\t\tclass: 'chat',\n\t\t\t\t\t\t\tbackgroundClass: 'bx-messenger-videocall-panel-background-chat',\n\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_BTN_CHAT'),\n\t\t\t\t\t\t\tblocked: this.isButtonBlocked('chat'),\n\t\t\t\t\t\t\tonClick: this._onChatButtonClick.bind(this),\n\t\t\t\t\t\t\t...(Util.isDesktop() ? {\n\t\t\t\t\t\t\t\ttooltip: {\n\t\t\t\t\t\t\t\t\tposition: 'top',\n\t\t\t\t\t\t\t\t\tgetText: () => `${this.keyModifierForCss} + C`,\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} : {}),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.append(this.buttons.chat.render(), center);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'floorRequest':\n\t\t\t\t\tif (!this.buttons.floorRequest)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.floorRequest = new Buttons.SimpleButton({\n\t\t\t\t\t\t\tclass: 'floor-request',\n\t\t\t\t\t\t\tbackgroundClass: 'bx-messenger-videocall-panel-background-floor-request',\n\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_BTN_WANT_TO_SAY'),\n\t\t\t\t\t\t\tblocked: this.isButtonBlocked('floorRequest'),\n\t\t\t\t\t\t\tonClick: this._onFloorRequestButtonClick.bind(this),\n\t\t\t\t\t\t\t...(Util.isDesktop() ? {\n\t\t\t\t\t\t\t\ttooltip: {\n\t\t\t\t\t\t\t\t\tposition: 'top',\n\t\t\t\t\t\t\t\t\tgetText: () => `${this.keyModifierForCss} + H`,\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} : {}),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.floorRequest.setBlocked(this.isButtonBlocked('floorRequest'));\n\t\t\t\t\t}\n\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.append(this.buttons.floorRequest.render(), center);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'more':\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!this.buttons.more)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.buttons.more = new Buttons.SimpleButton({\n\t\t\t\t\t\t\t\tclass: 'more',\n\t\t\t\t\t\t\t\tonClick: this._onMoreButtonClick.bind(this),\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tDom.append(this.buttons.more.render(), center);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'spacer':\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tpanelInner.appendChild(Dom.create('div', {\n\t\t\t\t\t\t\tprops: { className: 'bx-messenger-videocall-panel-spacer' },\n\t\t\t\t\t\t}));\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t/*case \"history\":\n\t\t\t\t\tthis.buttons.history = new Buttons.SimpleButton({\n\t\t\t\t\t\tclass: \"history\",\n\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_HISTORY\"),\n\t\t\t\t\t\tonClick: this._onHistoryButtonClick.bind(this)\n\t\t\t\t\t});\n\t\t\t\t\trightSubPanel.appendChild(this.buttons.history.render());\n\t\t\t\t\tbreak;*/\n\t\t\t}\n\t\t}\n\n\t\treturn panelInner;\n\t}\n\n\trenderTopButtons(buttons, rerender): void\n\t{\n\t\tfor (let i = 0; i < buttons.length; i++)\n\t\t{\n\t\t\tswitch (buttons[i])\n\t\t\t{\n\t\t\t\tcase 'watermark':\n\t\t\t\t\tif (!this.buttons.waterMark)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.waterMark = new Buttons.WaterMarkButton({\n\t\t\t\t\t\t\tlanguage: this.language,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.append(this.buttons.waterMark.render(), this.elements.topPanel);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'protected':\n\t\t\t\t\tif (!this.buttons.protected)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.protected = new Buttons.TopFramelessButton({\n\t\t\t\t\t\t\ticonClass: 'protected',\n\t\t\t\t\t\t\ttextClass: 'protected',\n\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_PROTECTED').toLowerCase(),\n\t\t\t\t\t\t\ttooltip: {\n\t\t\t\t\t\t\t\twidth: '384px',\n\t\t\t\t\t\t\t\tposition: 'bottom',\n\t\t\t\t\t\t\t\tgetText: () => BX.message('IM_M_CALL_PROTECTED_HINT'),\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.append(this.buttons.protected.render(), this.elements.topPanel);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'recordStatus':\n\t\t\t\t\tif (this.buttons.recordStatus)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.recordStatus.updateView();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.recordStatus = new Buttons.RecordStatusButton({\n\t\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\t\trecordState: this.recordState,\n\t\t\t\t\t\t\tonPauseClick: this._onRecordPauseClick.bind(this),\n\t\t\t\t\t\t\tonStopClick: this._onRecordStopClick.bind(this),\n\t\t\t\t\t\t\ttooltip: {\n\t\t\t\t\t\t\t\tposition: 'bottom',\n\t\t\t\t\t\t\t\tgetText: () => {\n\t\t\t\t\t\t\t\t\tif (this.recordState.userId == this.userId || !this.userData[this.recordState.userId])\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\treturn '';\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tconst recordingUserName = Text.encode(this.userData[this.recordState.userId].name);\n\t\t\t\t\t\t\t\t\treturn BX.message('IM_M_CALL_RECORD_HINT').replace('#USER_NAME#', recordingUserName);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.append(this.buttons.recordStatus.render(), this.elements.topPanel);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'grid':\n\t\t\t\t\tif (this.buttons.grid)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.grid.update({\n\t\t\t\t\t\t\ticonClass: this.layout === Layouts.Grid ? 'speaker' : 'grid',\n\t\t\t\t\t\t\ttext: this.layout === Layouts.Grid ? BX.message('IM_M_CALL_SPEAKER_MODE') : BX.message('IM_M_CALL_GRID_MODE'),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.grid = new Buttons.TopButton({\n\t\t\t\t\t\t\ticonClass: this.layout === Layouts.Grid ? 'speaker' : 'grid',\n\t\t\t\t\t\t\ttext: this.layout === Layouts.Grid ? BX.message('IM_M_CALL_SPEAKER_MODE') : BX.message('IM_M_CALL_GRID_MODE'),\n\t\t\t\t\t\t\tonClick: this._onGridButtonClick.bind(this),\n\t\t\t\t\t\t\t...(Util.isDesktop() ? {\n\t\t\t\t\t\t\t\ttooltip: {\n\t\t\t\t\t\t\t\t\tposition: 'bottom',\n\t\t\t\t\t\t\t\t\tgetText: () => `${this.keyModifierForCss} + W`\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} : {}),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.append(this.buttons.grid.render(), this.elements.topPanel);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'fullscreen':\n\t\t\t\t\tif (this.buttons.fullscreen)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.fullscreen.update({\n\t\t\t\t\t\t\ticonClass: this.isFullScreen ? 'fullscreen-leave' : 'fullscreen-enter',\n\t\t\t\t\t\t\ttext: this.isFullScreen ? BX.message('IM_M_CALL_WINDOW_MODE') : BX.message('IM_M_CALL_FULLSCREEN_MODE'),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.fullscreen = new Buttons.TopButton({\n\t\t\t\t\t\t\ticonClass: this.isFullScreen ? 'fullscreen-leave' : 'fullscreen-enter',\n\t\t\t\t\t\t\ttext: this.isFullScreen ? BX.message('IM_M_CALL_WINDOW_MODE') : BX.message('IM_M_CALL_FULLSCREEN_MODE'),\n\t\t\t\t\t\t\tonClick: this._onFullScreenButtonClick.bind(this),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.append(this.buttons.fullscreen.render(), this.elements.topPanel);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'feedback':\n\t\t\t\t\tif (!this.buttons.feedback)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.feedback = new Buttons.TopButton({\n\t\t\t\t\t\t\ticonClass: 'feedback',\n\t\t\t\t\t\t\ttext: BX.message('IM_OL_COMMENT_HEAD_BUTTON_VOTE'),\n\t\t\t\t\t\t\tonClick: this._onFeedbackButtonClick.bind(this)\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.append(this.buttons.feedback.render(), this.elements.topPanel);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'callcontrol':\n\t\t\t\t\tif (!this.buttons.callcontrol)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.callcontrol = new Buttons.TopButton({\n\t\t\t\t\t\t\ticonClass: 'callcontrol',\n\t\t\t\t\t\t\ttext: BX.message('CALL_CALLCONTROL_BUTTON_LABEL'),\n\t\t\t\t\t\t\tonClick: this._onCallcontrolButtonClick.bind(this)\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.append(this.buttons.callcontrol.render(), this.elements.topPanel);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'participants':\n\t\t\t\t\tlet foldButtonState = Buttons.ParticipantsButton.FoldButtonState.Hidden;\n\n\t\t\t\t\tif (this.isFullScreen && this.layout === Layouts.Centered)\n\t\t\t\t\t{\n\t\t\t\t\t\tfoldButtonState = this.isUserBlockFolded\n\t\t\t\t\t\t\t? Buttons.ParticipantsButton.FoldButtonState.Unfold\n\t\t\t\t\t\t\t: Buttons.ParticipantsButton.FoldButtonState.Fold;\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.showUsersButton)\n\t\t\t\t\t{\n\t\t\t\t\t\tfoldButtonState = Buttons.ParticipantsButton.FoldButtonState.Active;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.buttons.participants)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.participants.update({\n\t\t\t\t\t\t\tfoldButtonState,\n\t\t\t\t\t\t\tallowAdding: !this.isButtonBlocked('add'),\n\t\t\t\t\t\t\tcount: this.getConnectedUserCount(true),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.participants = new Buttons.ParticipantsButton({\n\t\t\t\t\t\t\tfoldButtonState,\n\t\t\t\t\t\t\tallowAdding: !this.isButtonBlocked('add'),\n\t\t\t\t\t\t\tcount: this.getConnectedUserCount(true),\n\t\t\t\t\t\t\tonListClick: this._onParticipantsButtonListClick.bind(this),\n\t\t\t\t\t\t\tonAddClick: this._onAddButtonClick.bind(this),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.append(this.buttons.participants.render(), this.elements.topPanel);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'participantsMobile':\n\t\t\t\t\tif (!this.buttons.participantsMobile)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.participantsMobile = new Buttons.ParticipantsButtonMobile({\n\t\t\t\t\t\t\tcount: this.getConnectedUserCount(true),\n\t\t\t\t\t\t\tonClick: this._onParticipantsButtonMobileListClick.bind(this),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.append(this.buttons.participantsMobile.render(), this.elements.topPanel);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'separator':\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.elements.topPanel.appendChild(Dom.create('div', {\n\t\t\t\t\t\t\tprops: { className: 'bx-messenger-videocall-top-separator' },\n\t\t\t\t\t\t}));\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'spacer':\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.elements.topPanel.appendChild(Dom.create('div', {\n\t\t\t\t\t\t\tprops: { className: 'bx-messenger-videocall-top-panel-spacer' },\n\t\t\t\t\t\t}));\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tupdateCopilotState(isActive)\n\t{\n\t\tthis.isCopilotActive = isActive;\n\n\t\tthis.setButtonActive('copilot', this.isCopilotActive);\n\n\t\tif (this.elements.wrap)\n\t\t{\n\t\t\tthis.elements.wrap.classList[this.isCopilotActive ? 'add' : 'remove']('bx-messenger-videocall-wrap-with-copilot')\n\t\t}\n\t}\n\n\tupdateCopilotFeatureState(isEnabled)\n\t{\n\t\tthis.isCopilotFeaturesEnabled = isEnabled;\n\n\t\tif (!this.buttons.copilot)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.buttons.copilot.setIsComingSoon(!this.isCopilotFeaturesEnabled);\n\t}\n\n\tshowCopilotNotify(callId = 0, errorCode = '')\n\t{\n\t\tlet notifyType = '';\n\n\t\tif (!errorCode)\n\t\t{\n\t\t\tnotifyType = CopilotNotifyType[this.isCopilotActive ? 'COPILOT_ENABLED' : 'COPILOT_DISABLED'];\n\t\t}\n\n\t\tthis.copilotNotify = this.createCopilotNotify(notifyType, callId);\n\n\t\tif (this.copilotNotify)\n\t\t{\n\t\t\tthis.copilotNotify.show();\n\t\t}\n\t}\n\n\tcloseCopilotNotify()\n\t{\n\t\tif (this.copilotNotify)\n\t\t{\n\t\t\tthis.copilotNotify.close();\n\t\t}\n\t}\n\n\tshowCopilotResultNotify()\n\t{\n\t\tthis.copilotNotify = this.createCopilotNotify(CopilotNotifyType.COPILOT_RESULT);\n\n\t\tif (this.copilotNotify)\n\t\t{\n\t\t\tthis.copilotNotify.show();\n\t\t}\n\t}\n\n\tshowCopilotErrorNotify(errorType)\n\t{\n\t\tthis.copilotNotify = this.createCopilotNotify(CopilotNotifyType[errorType]);\n\n\t\tif (this.copilotNotify)\n\t\t{\n\t\t\tthis.copilotNotify.show();\n\t\t}\n\t}\n\n\tcreateCopilotNotify(notifyType, callId)\n\t{\n\t\tif (!this.buttons.copilot)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn new CopilotNotify({\n\t\t\ttype: notifyType,\n\t\t\tbindElement: this.buttons.copilot.elements.root,\n\t\t\tonClose: () => {\n\t\t\t\tthis.copilotNotify = null;\n\t\t\t},\n\t\t\tcallId,\n\t\t});\n\t}\n\n\tcreateAhaMomentNotifyCallcontrol()\n\t{\n\t\tif (!this.buttons.callcontrol)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.ahaMomentNotifyCallcontrol)\n\t\t{\n\t\t\tthis.ahaMomentNotifyCallcontrol.show();\n\t\t\treturn this.ahaMomentNotifyCallcontrol;\n\t\t}\n\n\t\tthis.ahaMomentNotifyCallcontrol = new AhaMomentNotify({\n\t\t\tnotifyTitle: BX.message(\"CALL_CALLCONTROL_AXA_MOMENT_TITLE\"),\n\t\t\tnotifyText: BX.message(\"CALL_CALLCONTROL_AXA_MOMENT_TEXT\"),\n\t\t\tbindElement: this.buttons.callcontrol.elements.root,\n\t\t\tpromoId: CALLCONTROL_PROMO_ID,\n\t\t\tonClose: () => {\n\t\t\t\tthis.needToShowCallcontrolPromo = false;\n\t\t\t\tthis.ahaMomentNotifyCallcontrol = null;\n\t\t\t}\n\t\t});\n\n\t\tthis.ahaMomentNotifyCallcontrol.show();\n\n\t\treturn this.ahaMomentNotifyCallcontrol;\n\t}\n\n\tcalculateUnusedPanelSpace(buttonList)\n\t{\n\t\tif (!buttonList)\n\t\t{\n\t\t\tbuttonList = this.getButtonList();\n\t\t}\n\n\t\tlet totalButtonWidth = 0;\n\t\tfor (let i = 0; i < buttonList.length; i++)\n\t\t{\n\t\t\tconst button = this.buttons[buttonList[i]];\n\t\t\tif (!button)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst buttonWidth = button.elements.root ? button.elements.root.getBoundingClientRect().width : 0;\n\t\t\ttotalButtonWidth += buttonWidth;\n\t\t}\n\n\t\treturn this.elements.panel.scrollWidth - totalButtonWidth - 32;\n\t};\n\n\n\tsetWindowFocusState(isActive)\n\t{\n\t\tif (isActive === this.isWindowFocus)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isWindowFocus = isActive;\n\n\t\tif (this.pictureInPictureCallWindow)\n\t\t{\n\t\t\tthis.pictureInPictureCallWindow.setButtons(this.getPictureInPictureCallWindowGetButtonsList()).updateButtons();\n\t\t}\n\t}\n\n\tgetPictureInPictureCallWindowGetButtonsList()\n\t{\n\t\tconst buttonsList = [\"microphone\", \"camera\"];\n\n\t\tif (this.getButtonActive('screen'))\n\t\t{\n\t\t\tbuttonsList.push(\"stop-screen\");\n\t\t}\n\n\t\tconst isViewHidden = this.viewVisibility.getCurrentVisibility() === DocumentVisibilityState.hidden;\n\n\t\tif (this.size === View.Size.Folded || this.isDocumentHidden || isViewHidden)\n\t\t{\n\t\t\tbuttonsList.push(\"returnToCall\");\n\t\t}\n\n\t\t// if (this.getButtonList().includes('copilot'))\n\t\t// {\n\t\t// \tbuttonsList.push(\"copilot\");\n\t\t// }\n\n\t\treturn buttonsList;\n\t}\n\n\tgetPictureInPictureCallWindowUser()\n\t{\n\t\tconst currentUserId = this.presenterId || this.centralUser?.userModel.id || this.userId;\n\t\tconst isLocalUser = +this.userId === +currentUserId;\n\t\tconst currentUser = isLocalUser ? this.localUser : this.users[currentUserId];\n\n\t\tconst isCurrentPiPUser = !!this.currentPiPUserId && currentUserId === this.currentPiPUserId;\n\n\t\tif (isCurrentPiPUser)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.activeUsers.includes(currentUserId) && !isLocalUser)\n\t\t{\n\t\t\tthis.toggleSubscribingVideoInRenderUserList([currentUserId], true);\n\t\t}\n\n\t\tif (this.currentPiPUserId && +this.userId !== +this.currentPiPUserId && !this.activeUsers.includes(this.currentPiPUserId))\n\t\t{\n\t\t\tthis.toggleSubscribingVideoInRenderUserList([this.currentPiPUserId], false);\n\t\t}\n\n\t\tthis.currentPiPUserId = currentUserId;\n\n\t\tconst modifiedCurrentUser =  {\n\t\t\tuserModel: this.userRegistry.get(currentUserId),\n\t\t\tavatarBackground: currentUser.avatarBackground,\n\t\t\tvideoRenderer: currentUser.videoRenderer,\n\t\t\tpreviewRenderer: currentUser.previewRenderer,\n\t\t};\n\n\t\tif (currentUser.videoTrack)\n\t\t{\n\t\t\tmodifiedCurrentUser.videoRenderer = new MediaRenderer({\n\t\t\t\tkind: 'video',\n\t\t\t\ttrack: currentUser.videoTrack,\n\t\t\t});\n\t\t}\n\n\t\tif (!isLocalUser && this.screenUsers[currentUserId]?.videoTrack)\n\t\t{\n\t\t\tmodifiedCurrentUser.previewRenderer = new MediaRenderer({\n\t\t\t\tkind: 'sharing',\n\t\t\t\ttrack: this.screenUsers[currentUserId].videoTrack,\n\t\t\t});\n\t\t}\n\n\t\tif (isLocalUser && this.localStreamVideoTrack)\n\t\t{\n\t\t\tmodifiedCurrentUser.previewRenderer = new MediaRenderer({\n\t\t\t\tkind: 'sharing',\n\t\t\t\ttrack: this.localStreamVideoTrack,\n\t\t\t});\n\t\t}\n\n\t\treturn modifiedCurrentUser;\n\t}\n\n\tgetBlockedButtonsListPictureInPictureCallWindow()\n\t{\n\t\tconst blockedButtons = [];\n\n\t\tif (this.isButtonBlocked('camera'))\n\t\t{\n\t\t\tblockedButtons.push('camera');\n\t\t}\n\n\t\tif (this.isButtonBlocked('microphone'))\n\t\t{\n\t\t\tblockedButtons.push('microphone');\n\t\t}\n\n\t\tif (this.isButtonBlocked('screen'))\n\t\t{\n\t\t\tblockedButtons.push('screen');\n\t\t}\n\n\t\treturn blockedButtons;\n\t}\n\n\n\t_onPiPClose() : void\n\t{\n\t\tthis.eventEmitter.emit(EventName.onPiPClose);\n\t}\n\n\ttoggleStatePictureInPictureCallWindow(isActive)\n\t{\n\t\tconst isPiPAvailable = PictureInPictureWindow.isAvailable;\n\t\tif (isActive && !this.pictureInPictureCallWindow && isPiPAvailable && Util.isPictureInPictureFeatureEnabled())\n\t\t{\n\t\t\tthis.pictureInPictureCallWindow = new PictureInPictureWindow({\n\t\t\t\tcurrentUser: this.getPictureInPictureCallWindowUser(),\n\t\t\t\tisCopilotFeaturesEnabled: this.isCopilotFeaturesEnabled,\n\t\t\t\tbuttons: this.getPictureInPictureCallWindowGetButtonsList(),\n\t\t\t\tblockedButtons: this.getBlockedButtonsListPictureInPictureCallWindow(),\n\t\t\t\tallowPinButton: false,\n\t\t\t\tallowBackgroundItem: BackgroundDialog.isAvailable() && this.isIntranetOrExtranet,\n\t\t\t\tallowMaskItem: BackgroundDialog.isMaskAvailable() && this.isIntranetOrExtranet,\n\t\t\t\tpreferInitialWindowPlacement: this.preferInitialWindowPlacementPictureInPicture,\n\t\t\t\tfloorRequestNotifications: this.floorRequestNotifications,\n\t\t\t\tonClose: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.pictureInPictureCallWindow = null;\n\t\t\t\t\tthis.currentPiPUserId = null;\n\t\t\t\t\tthis._onPiPClose();\n\t\t\t\t},\n\t\t\t\tonButtonClick: ({ buttonName, event }) =>\n\t\t\t\t{\n\t\t\t\t\tswitch (buttonName)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase \"microphone\":\n\t\t\t\t\t\t\tthis._onMicrophoneButtonClick(event);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase \"camera\":\n\t\t\t\t\t\t\tthis._onCameraButtonClick(event);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase \"returnToCall\":\n\t\t\t\t\t\t\tthis._onBodyClick(event);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase \"stop-screen\":\n\t\t\t\t\t\t\tthis._onScreenButtonClick(event);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.pictureInPictureCallWindow.checkAvailableAndCreate()\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.preferInitialWindowPlacementPictureInPicture = false;\n\t\t\t\t});\n\t\t}\n\n\t\tif (!isActive && this.pictureInPictureCallWindow)\n\t\t{\n\t\t\tthis.pictureInPictureCallWindow.close();\n\t\t}\n\t}\n\n\tsetButtonActive(buttonName, isActive)\n\t{\n\t\tif (!this.buttons[buttonName])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.buttons[buttonName].setActive(isActive);\n\n\t\tif (this.pictureInPictureCallWindow)\n\t\t{\n\t\t\tthis.pictureInPictureCallWindow.setButtons(this.getPictureInPictureCallWindowGetButtonsList()).updateButtons();\n\t\t}\n\n\t};\n\n\tgetButtonActive(buttonName)\n\t{\n\t\tif (!this.buttons || !this.buttons[buttonName])\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.buttons[buttonName].isActive;\n\t};\n\n\tsetButtonCounter(buttonName, counter)\n\t{\n\t\tif (!this.buttons[buttonName])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.buttons[buttonName].setCounter(counter);\n\t};\n\n\tupdateUserList(useShelvedRerenderQueue)\n\t{\n\t\tif (this.layout == Layouts.Mobile)\n\t\t{\n\t\t\tif (this.localUser != this.centralUser)\n\t\t\t{\n\t\t\t\tif (this.localUser.hasVideo())\n\t\t\t\t{\n\t\t\t\t\tthis.localUser.mount(this.elements.localUserMobile);\n\t\t\t\t\tthis.localUser.visible = true;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.localUser.dismount();\n\t\t\t\t}\n\n\t\t\t\tthis.centralUser.mount(this.elements.center);\n\t\t\t\tthis.eventEmitter.emit(EventName.onHasMainStream, {\n\t\t\t\t\tuserId: this.centralUser.id,\n\t\t\t\t});\n\t\t\t\tthis.centralUser.visible = true;\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\t/* if (this.layout == Layouts.Grid && this.size == Size.Full)\n\t\t{\n\t\t\tthis.recalculatePages();\n\t\t} */\n\n\t\tif ((this.layout == Layouts.Grid || this.layout == Layouts.Centered) && this.size == Size.Full)\n\t\t{\n\t\t\tthis.recalculatePages();\n\t\t}\n\n\t\tif (useShelvedRerenderQueue)\n\t\t{\n\t\t\tthis.shelvedRerenderQueue.forEach((el) =>\n\t\t\t{\n\t\t\t\tif (el.reason === RerenderReason.VideoEnabled)\n\t\t\t\t{\n\t\t\t\t\tthis.updateRerenderQueue(el.userId, el.reason);\n\t\t\t\t}\n\t\t\t\telse if (el.reason === RerenderReason.VideoDisabled)\n\t\t\t\t{\n\t\t\t\t\tthis.updateRerenderQueue(el.userId, el.reason);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.shelvedRerenderQueue.clear();\n\t\t}\n\n\t\tthis.renderUserList();\n\n\t\tif (this.layout == Layouts.Centered)\n\t\t{\n\t\t\tif (!this.elements.userList.container.parentElement)\n\t\t\t{\n\t\t\t\tthis.elements.userBlock.appendChild(this.elements.userList.container);\n\t\t\t}\n\t\t\t//this.centralUser.setFullSize(this.elements.userList.container.childElementCount === 0);\n\n\t\t}\n\t\telse if (this.layout == Layouts.Grid)\n\t\t{\n\t\t\tif (!this.elements.userList.container.parentElement)\n\t\t\t{\n\t\t\t\tthis.elements.container.appendChild(this.elements.userList.container);\n\t\t\t}\n\t\t}\n\t\tthis.toggleEars();\n\t};\n\n\tshowOverflownButtonsPopup()\n\t{\n\t\tif (this.overflownButtonsPopup)\n\t\t{\n\t\t\tthis.overflownButtonsPopup.show();\n\t\t\treturn;\n\t\t}\n\n\t\tconst bindElement = this.buttons.more && this.buttons.more.elements.root ? this.buttons.more.elements.root : this.elements.panel;\n\n\t\tthis.overflownButtonsPopup = new Popup({\n\t\t\tid: 'bx-call-buttons-popup',\n\t\t\tbindElement: bindElement,\n\t\t\ttargetContainer: this.container,\n\t\t\tcontent: this.renderButtons(Object.keys(this.overflownButtons), true),\n\t\t\tcacheable: false,\n\t\t\tcloseIcon: false,\n\t\t\tautoHide: true,\n\t\t\toverlay: {backgroundColor: 'white', opacity: 0},\n\t\t\tbindOptions: {\n\t\t\t\tposition: 'top'\n\t\t\t},\n\t\t\tangle: {position: 'bottom', offset: 49},\n\t\t\tclassName: 'bx-call-buttons-popup',\n\t\t\tcontentBackground: 'unset',\n\t\t\tevents: {\n\t\t\t\tonPopupDestroy: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.overflownButtonsPopup = null;\n\t\t\t\t\tthis.buttons.more.setActive(false);\n\t\t\t\t},\n\t\t\t}\n\t\t});\n\t\tthis.overflownButtonsPopup.show();\n\t}\n\n\tresumeVideo()\n\t{\n\t\tfor (let userId in this.users)\n\t\t{\n\t\t\tconst user = this.users[userId];\n\t\t\tuser.playVideo()\n\t\t\tconst screenUser = this.screenUsers[userId];\n\t\t\tscreenUser.playVideo();\n\t\t}\n\t\tthis.localUser.playVideo();\n\t};\n\n\tupdateUserButtons()\n\t{\n\t\tconst currentConnectedUserCount = this.getConnectedUserCount();\n\t\tconst previousConnectedUserCount = this.cache.get('previousConnectedUserCount');\n\n\t\tif (currentConnectedUserCount > 1 && previousConnectedUserCount > 1)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let userId in this.users)\n\t\t{\n\t\t\tif (this.users.hasOwnProperty(userId))\n\t\t\t{\n\t\t\t\tthis.users[userId].allowPinButton = currentConnectedUserCount > 1;\n\t\t\t}\n\t\t}\n\t};\n\n\tupdateButtons(skippedElementsList = [])\n\t{\n\t\tif (!this.elements.panel)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!skippedElementsList.includes('panel'))\n\t\t{\n\t\t\tconst buttonList = this.getButtonList();\n\t\t\tif (this.needToRerenderButtonList)\n\t\t\t{\n\t\t\t\tDom.clean(this.elements.panel);\n\t\t\t\tDom.append(this.renderButtons(buttonList, this.needToRerenderButtonList), this.elements.panel);\n\t\t\t\tthis.needToRerenderButtonList = false;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.renderButtons(buttonList);\n\t\t\t}\n\t\t}\n\n\t\tif (this.elements.topPanel)\n\t\t{\n\t\t\tconst topButtonList = this.getTopButtonList();\n\t\t\tif (this.needToRerenderTopButtonList)\n\t\t\t{\n\t\t\t\tDom.clean(this.elements.topPanel);\n\t\t\t}\n\t\t\tthis.renderTopButtons(topButtonList, this.needToRerenderTopButtonList);\n\t\t\tthis.needToRerenderTopButtonList = false;\n\t\t}\n\n\t\tif (this.buttons.participantsMobile)\n\t\t{\n\t\t\tthis.buttons.participantsMobile.setCount(this.getConnectedUserCount(true));\n\t\t}\n\n\t\tif (this.showCallcontrolPromoPopupTimeout)\n\t\t{\n\t\t\tclearTimeout(this.showCallcontrolPromoPopupTimeout);\n\t\t}\n\n\t\tif (this.needToShowCallcontrolPromo)\n\t\t{\n\t\t\tthis.showCallcontrolPromoPopupTimeout = setTimeout(() =>\n\t\t\t{\n\t\t\t\tif (this.size !== View.Size.Folded)\n\t\t\t\t{\n\t\t\t\t\tthis.createAhaMomentNotifyCallcontrol();\n\t\t\t\t}\n\t\t\t}, 1500);\n\t\t}\n\n\t\tthis.renderAddUserButtonInList();\n\t};\n\n\tupdateUserData(userData)\n\t{\n\t\tfor (let userId in userData)\n\t\t{\n\t\t\tif (!this.userData[userId])\n\t\t\t{\n\t\t\t\tthis.userData[userId] = {\n\t\t\t\t\tname: '',\n\t\t\t\t\tavatar_hr: '',\n\t\t\t\t\tgender: 'M',\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (userData[userId].name)\n\t\t\t{\n\t\t\t\tthis.userData[userId].name = userData[userId].name;\n\t\t\t}\n\n\t\t\tif (userData[userId].avatar_hr)\n\t\t\t{\n\t\t\t\tthis.userData[userId].avatar_hr = Util.isAvatarBlank(userData[userId].avatar_hr) ? '' : userData[userId].avatar_hr;\n\t\t\t}\n\t\t\telse if (userData[userId].avatar)\n\t\t\t{\n\t\t\t\tthis.userData[userId].avatar_hr = Util.isAvatarBlank(userData[userId].avatar) ? '' : userData[userId].avatar;\n\t\t\t}\n\n\t\t\tif (userData[userId].gender)\n\t\t\t{\n\t\t\t\tthis.userData[userId].gender = userData[userId].gender === 'F' ? 'F' : 'M';\n\t\t\t}\n\n\t\t\tconst userModel = this.userRegistry.get(userId);\n\t\t\tif (userModel)\n\t\t\t{\n\t\t\t\tuserModel.name = this.userData[userId].name;\n\t\t\t\tuserModel.avatar = checkAndEncodeURI(this.userData[userId].avatar_hr);\n\t\t\t}\n\t\t}\n\t};\n\n\tisScreenSharingSupported()\n\t{\n\t\treturn navigator.mediaDevices && typeof (navigator.mediaDevices.getDisplayMedia) === \"function\" || typeof (BXDesktopSystem) !== \"undefined\";\n\t};\n\n\tisRecordingHotKeySupported()\n\t{\n\t\treturn typeof (BXDesktopSystem) !== \"undefined\" && BXDesktopSystem.ApiVersion() >= 60;\n\t};\n\n\tisFullScreenSupported()\n\t{\n\t\tif (BX.browser.IsChrome() || BX.browser.IsSafari())\n\t\t{\n\t\t\treturn document.webkitFullscreenEnabled === true;\n\t\t}\n\t\telse if (BX.browser.IsFirefox())\n\t\t{\n\t\t\treturn document.fullscreenEnabled === true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t};\n\n\ttoggleEars()\n\t{\n\t\tthis.toggleTopEar();\n\t\tthis.toggleBottomEar();\n\n\t\tif (this.layout == Layouts.Grid && this.pagesCount > 1 && this.currentPage > 1)\n\t\t{\n\t\t\tthis.elements.pageNavigatorLeft.classList.add(\"active\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.pageNavigatorLeft.classList.remove(\"active\");\n\t\t}\n\n\t\tif (this.layout == Layouts.Grid && this.pagesCount > 1 && this.currentPage < this.pagesCount)\n\t\t{\n\t\t\tthis.elements.pageNavigatorRight.classList.add(\"active\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.pageNavigatorRight.classList.remove(\"active\");\n\t\t}\n\t};\n\n\ttoggleTopEar()\n\t{\n\t\tif (\n\t\t\tthis.layout !== Layouts.Grid &&\n\t\t\tthis.pagesCount > 1\n\t\t)\n\t\t{\n\t\t\tthis.elements.ear.top.classList.add(\"active\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.ear.top.classList.remove(\"active\");\n\t\t}\n\t};\n\n\ttoggleBottomEar()\n\t{\n\t\tif (\n\t\t\tthis.layout !== Layouts.Grid &&\n\t\t\tthis.pagesCount > 1\n\t\t)\n\t\t{\n\t\t\tthis.elements.ear.bottom.classList.add(\"active\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.ear.bottom.classList.remove(\"active\");\n\t\t}\n\t};\n\n\tscrollUserListUp()\n\t{\n\t\tthis.stopScroll();\n\t\tthis.scrollInterval = setInterval(\n\t\t\t() => this.elements.userList.container.scrollTop -= 10,\n\t\t\t20\n\t\t);\n\t};\n\n\tscrollUserListDown()\n\t{\n\t\tthis.stopScroll();\n\t\tthis.scrollInterval = setInterval(\n\t\t\t() => this.elements.userList.container.scrollTop += 10,\n\t\t\t20\n\t\t);\n\t};\n\n\tstopScroll()\n\t{\n\t\tif (this.scrollInterval)\n\t\t{\n\t\t\tclearInterval(this.scrollInterval);\n\t\t\tthis.scrollInterval = 0;\n\t\t}\n\t};\n\n\ttoggleRenameSliderInputLoader()\n\t{\n\t\tthis.elements.renameSlider.button.classList.add('ui-btn-wait');\n\t};\n\n\tsetHotKeyTemporaryBlock(isActive, force)\n\t{\n\t\tif (!!isActive)\n\t\t{\n\t\t\tthis.hotKeyTemporaryBlock++;\n\t\t}\n\t\telse\n\t\t{\n\n\t\t\tthis.hotKeyTemporaryBlock--;\n\t\t\tif (this.hotKeyTemporaryBlock < 0 || force)\n\t\t\t{\n\t\t\t\tthis.hotKeyTemporaryBlock = 0;\n\t\t\t}\n\t\t}\n\t}\n\n\tsetHotKeyActive(name, isActive)\n\t{\n\t\tif (typeof this.hotKey[name] === 'undefined')\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.hotKey[name] = !!isActive;\n\t};\n\n\tisHotKeyActive(name)\n\t{\n\t\tif (!this.hotKey['all'])\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.hotKeyTemporaryBlock > 0)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.isButtonHidden(name))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.isButtonBlocked(name))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn !!this.hotKey[name];\n\t}\n\n\t// event handlers\n\n\t_onBodyClick()\n\t{\n\t\tthis.eventEmitter.emit(EventName.onBodyClick);\n\t};\n\n\t_onCenterTouchStart(e)\n\t{\n\t\tthis.centerTouchX = e.pageX;\n\t};\n\n\t_onCenterTouchEnd(e)\n\t{\n\t\tconst delta = e.pageX - this.centerTouchX;\n\n\t\tif (delta > 100)\n\t\t{\n\t\t\tthis.pinUser(this.getRightUser(this.centralUser.id));\n\t\t\te.preventDefault();\n\t\t}\n\t\tif (delta < -100)\n\t\t{\n\t\t\tthis.pinUser(this.getLeftUser(this.centralUser.id));\n\t\t\te.preventDefault();\n\t\t}\n\t};\n\n\t_onFullScreenChange()\n\t{\n\t\tif (\"webkitFullscreenElement\" in document)\n\t\t{\n\t\t\tthis.isFullScreen = (!!document.webkitFullscreenElement);\n\t\t}\n\t\telse if (\"fullscreenElement\" in document)\n\t\t{\n\t\t\tthis.isFullScreen = (!!document.fullscreenElement);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// safari workaround\n\t\tsetTimeout(function ()\n\t\t{\n\t\t\tif (!this.elements.root)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (this.isFullScreen)\n\t\t\t{\n\t\t\t\tthis.elements.root.classList.add(\"bx-messenger-videocall-fullscreen\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.elements.root.classList.remove(\"bx-messenger-videocall-fullscreen\");\n\t\t\t}\n\t\t\tthis.updateUserList();\n\t\t\tthis.updateButtons();\n\t\t\tthis.setUserBlockFolded(this.isFullScreen);\n\n\t\t}.bind(this), 0);\n\t};\n\n\t_onIntersectionChange(entries)\n\t{\n\t\tlet t = {};\n\t\tentries.forEach(function (intersectionEntry)\n\t\t{\n\t\t\tt[intersectionEntry.target.dataset.userId] = intersectionEntry.isIntersecting;\n\t\t});\n\t\tfor (let userId in t)\n\t\t{\n\t\t\tif (this.users[userId])\n\t\t\t{\n\t\t\t\tthis.users[userId].visible = t[userId];\n\t\t\t}\n\t\t\tif (userId == this.localUser.id)\n\t\t\t{\n\t\t\t\tthis.localUser.visible = t[userId];\n\t\t\t}\n\t\t}\n\t};\n\n\t_onResize()\n\t{\n\t\t// this.resizeCalled++;\n\t\t// this.reportResizeCalled();\n\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.centralUser)\n\t\t{\n\t\t\t//this.centralUser.updateAvatarWidth();\n\t\t}\n\t\tif (BX.browser.IsMobile())\n\t\t{\n\t\t\tdocument.documentElement.style.setProperty('--view-height', window.innerHeight + 'px');\n\t\t}\n\t\tif (this.layout == Layouts.Grid || this.layout == Layouts.Centered)\n\t\t{\n\t\t\tthis.updateUserList();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.updateCentralUserAvatarSize();\n\t\t\tthis.toggleEars();\n\t\t}\n\n\t\tconst rootDimensions = this.elements.root.getBoundingClientRect()\n\t\tthis.elements.root.classList.toggle(\"bx-messenger-videocall-width-lt-450\", rootDimensions.width < 450);\n\t\tthis.elements.root.classList.toggle(\"bx-messenger-videocall-width-lt-550\", rootDimensions.width < 550);\n\t\tthis.elements.root.classList.toggle(\"bx-messenger-videocall-width-lt-650\", rootDimensions.width < 650);\n\t\tthis.elements.root.classList.toggle(\"bx-messenger-videocall-width-lt-700\", rootDimensions.width < 700);\n\t\tthis.elements.root.classList.toggle(\"bx-messenger-videocall-width-lt-850\", rootDimensions.width < 850);\n\t\tthis.elements.root.classList.toggle(\"bx-messenger-videocall-width-lt-900\", rootDimensions.width < 900);\n\n\t\t/*if (this.maxWidth === 0)\n\t\t{\n\t\t\tthis.elements.root.style.maxWidth = this.container.clientWidth + 'px';\n\t\t}*/\n\n\t\tif (this.checkPanelOverflow())\n\t\t{\n\t\t\tthis.updateButtons();\n\t\t\tif (this.overflownButtonsPopup && !Object.keys(this.overflownButtons).length)\n\t\t\t{\n\t\t\t\tthis.overflownButtonsPopup.close();\n\t\t\t}\n\t\t}\n\t};\n\n\t_onOrientationChange()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (window.innerHeight > window.innerWidth)\n\t\t{\n\t\t\tthis.elements.root.classList.remove(\"orientation-landscape\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root.classList.add(\"orientation-landscape\");\n\t\t}\n\t};\n\n\n\n\t_destroyHotKeyHint()\n\t{\n\t\tif (!Util.isDesktop())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.hintManager.popup)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// we need to destroy, not .hide for onShow event handler (see method _showHotKeyHint).\n\t\tthis.hintManager.hide();\n\t\tthis.hintManager.popup.destroy();\n\t\tthis.hintManager.popup = null;\n\t}\n\n\t_onKeyDown(e)\n\t{\n\t\tif (!Util.isDesktop())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!(e.shiftKey && (e.ctrlKey || e.metaKey)) && !(e.code === 'Space'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (event.repeat)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst callMinimized = this.size === View.Size.Folded;\n\n\t\tif (\n\t\t\te.code === 'KeyA'\n\t\t\t&& this.isHotKeyActive('microphone')\n\t\t)\n\t\t{\n\t\t\te.preventDefault();\n\t\t\tif (this.deviceSelector)\n\t\t\t{\n\t\t\t\tthis.deviceSelector.destroy();\n\t\t\t}\n\t\t\tthis._onMicrophoneButtonClick(e);\n\t\t}\n\t\telse if (\n\t\t\te.code === 'Space' && Hardware.isMicrophoneMuted\n\t\t\t&& this.isHotKeyActive('microphoneSpace')\n\t\t)\n\t\t{\n\t\t\tif (!callMinimized)\n\t\t\t{\n\t\t\t\te.preventDefault();\n\t\t\t\tthis.pushToTalk = true;\n\t\t\t\tthis.microphoneHotkeyTimerId = setTimeout(function ()\n\t\t\t\t{\n\t\t\t\t\tif (this.deviceSelector)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.deviceSelector.destroy();\n\t\t\t\t\t}\n\t\t\t\t\tthis._onMicrophoneButtonClick(e);\n\t\t\t\t}.bind(this), 100);\n\t\t\t}\n\t\t}\n\t\telse if (\n\t\t\te.code === 'KeyS'\n\t\t\t&& this.isHotKeyActive('screen')\n\t\t)\n\t\t{\n\t\t\te.preventDefault();\n\t\t\tthis._onScreenButtonClick(e);\n\t\t}\n\t\telse if (\n\t\t\te.code === 'KeyV'\n\t\t\t&& this.isHotKeyActive('camera')\n\t\t)\n\t\t{\n\t\t\te.preventDefault();\n\t\t\tif (this.deviceSelector)\n\t\t\t{\n\t\t\t\tthis.deviceSelector.destroy();\n\t\t\t}\n\t\t\tthis._onCameraButtonClick(e);\n\t\t}\n\t\telse if (\n\t\t\te.code === 'KeyU'\n\t\t\t&& this.isHotKeyActive('users')\n\t\t)\n\t\t{\n\t\t\te.preventDefault();\n\t\t\tthis._onUsersButtonClick(e);\n\t\t}\n\t\telse if (\n\t\t\te.code === 'KeyR'\n\t\t\t&& this.isRecordingHotKeySupported()\n\t\t\t&& this.isHotKeyActive('record')\n\t\t)\n\t\t{\n\t\t\te.preventDefault();\n\t\t\tthis._onForceRecordToggleClick(e);\n\t\t}\n\t\telse if (\n\t\t\te.code === 'KeyH'\n\t\t\t&& this.isHotKeyActive('floorRequest')\n\t\t)\n\t\t{\n\t\t\te.preventDefault();\n\t\t\tthis._onFloorRequestButtonClick(e);\n\t\t}\n\t\telse if (\n\t\t\te.code === 'KeyC'\n\t\t\t&& this.isHotKeyActive('chat')\n\t\t)\n\t\t{\n\t\t\te.preventDefault();\n\t\t\tif (callMinimized)\n\t\t\t{\n\t\t\t\tthis._onBodyClick(e);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis._onChatButtonClick(e);\n\t\t\t\tthis._destroyHotKeyHint();\n\t\t\t}\n\t\t}\n\t\telse if (\n\t\t\te.code === 'KeyM'\n\t\t\t&& this.isHotKeyActive('muteSpeaker')\n\t\t)\n\t\t{\n\t\t\te.preventDefault();\n\t\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\t\tbuttonName: \"toggleSpeaker\",\n\t\t\t\tspeakerMuted: this.speakerMuted,\n\t\t\t\tfromHotKey: true,\n\t\t\t});\n\t\t}\n\t\telse if (\n\t\t\te.code === 'KeyW'\n\t\t\t&& this.isHotKeyActive('grid')\n\t\t)\n\t\t{\n\t\t\te.preventDefault();\n\t\t\tthis.setLayout(this.layout == Layouts.Centered ? Layouts.Grid : Layouts.Centered);\n\t\t}\n\t};\n\n\t_onKeyUp(e)\n\t{\n\t\tif (!Util.isDesktop())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tclearTimeout(this.microphoneHotkeyTimerId);\n\t\tif (this.pushToTalk && !Hardware.isMicrophoneMuted && e.code === 'Space')\n\t\t{\n\t\t\te.preventDefault();\n\t\t\tthis.pushToTalk = false;\n\t\t\tif (this.deviceSelector)\n\t\t\t{\n\t\t\t\tthis.deviceSelector.destroy();\n\t\t\t}\n\t\t\tthis._onMicrophoneButtonClick(e);\n\t\t}\n\t};\n\n\t_onUserClick(e)\n\t{\n\t\tconst userId = e.userId;\n\n\t\tif (userId == this.centralUser.id && this.layout != Layouts.Grid)\n\t\t{\n\t\t\tthis.elements.root.classList.toggle(\"bx-messenger-videocall-hidden-panels\");\n\t\t}\n\n\t\tif (this.layout == Layouts.Centered && userId != this.centralUser.id)\n\t\t{\n\t\t\tthis.pinUser(userId);\n\t\t}\n\t\telse\n\t\t{\n\t\t\t(this.pinnedUser && this.pinnedUser.id === userId) ? this._onUserUnPin() : this._onUserPin({userId});\n\t\t}\n\n\t\tthis.eventEmitter.emit(EventName.onUserClick, {\n\t\t\tuserId: userId,\n\t\t\tstream: userId == this.userId ? this.localUser.stream : this.users[userId].stream,\n\t\t\tlayout: this.layout,\n\t\t});\n\t};\n\n\t_onUserRename(newName)\n\t{\n\t\tthis.eventEmitter.emit(EventName.onUserRename, {newName: newName});\n\t};\n\n\t_onUserRenameInputFocus()\n\t{\n\t\tthis.setHotKeyTemporaryBlock(true);\n\t};\n\n\t_onUserRenameInputBlur()\n\t{\n\t\tthis.setHotKeyTemporaryBlock(false);\n\t};\n\n\t_onUserPin(e)\n\t{\n\t\tif (this.layout == Layouts.Grid)\n\t\t{\n\t\t\tthis.setLayout(Layouts.Centered)\n\t\t}\n\t\tthis.pinUser(e.userId);\n\t};\n\n\t_onUserUnPin()\n\t{\n\t\tif (this.layout == Layouts.Centered)\n\t\t{\n\t\t\tthis.setLayout(Layouts.Grid);\n\t\t}\n\t\tthis.unpinUser();\n\t};\n\n\t_onTurnOffParticipantMic(e)\n\t{\n\t\tthis.eventEmitter.emit(EventName.onTurnOffParticipantMic, {\n\t\t\tuserId: e.userId\n\t\t});\n\t};\n\n\t_onTurnOffParticipantCam(e)\n\t{\n\t\tthis.eventEmitter.emit(EventName.onTurnOffParticipantCam, {\n\t\t\tuserId: e.userId\n\t\t});\n\t};\n\n\t_onTurnOffParticipantScreenshare(e)\n\t{\n\t\tthis.eventEmitter.emit(EventName.onTurnOffParticipantScreenshare, {\n\t\t\tuserId: e.userId\n\t\t});\n\t};\n\n\t_onRecordToggleClick(e)\n\t{\n\t\tconst limitObj = this.getRecordLimitation();\n\n\t\tthis.onClickButtonWithLimit(limitObj, () => {\n\t\t\tif (this.recordState.state === View.RecordState.Stopped)\n\t\t\t{\n\t\t\t\tthis._onRecordStartClick(e);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis._onRecordStopClick(e);\n\t\t\t}\n\t\t})\n\t}\n\n\t_onForceRecordToggleClick(e)\n\t{\n\t\tconst limitObj = this.getRecordLimitation();\n\n\t\tthis.onClickButtonWithLimit(limitObj, () => {\n\t\t\tif (this.recordState.state === View.RecordState.Stopped)\n\t\t\t{\n\t\t\t\tthis._onForceRecordStartClick(View.RecordType.Video);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis._onRecordStopClick(e);\n\t\t\t}\n\t\t})\n\t}\n\n\t_onForceRecordStartClick(recordType)\n\t{\n\t\tif (typeof recordType === 'undefined')\n\t\t{\n\t\t\trecordType = View.RecordType.None;\n\t\t}\n\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: \"record\",\n\t\t\trecordState: View.RecordState.Started,\n\t\t\tforceRecord: recordType, // none, video, audio\n\t\t\tnode: null\n\t\t});\n\t}\n\n\t_onRecordStartClick(e)\n\t{\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: \"record\",\n\t\t\trecordState: View.RecordState.Started,\n\t\t\tnode: e.currentTarget\n\t\t});\n\t}\n\n\t_onRecordPauseClick(e)\n\t{\n\t\tlet recordState;\n\t\tif (this.recordState.state === View.RecordState.Paused)\n\t\t{\n\t\t\tthis.recordState.state = View.RecordState.Started;\n\t\t\trecordState = View.RecordState.Resumed;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.recordState.state = View.RecordState.Paused;\n\t\t\trecordState = this.recordState.state;\n\t\t}\n\n\t\tthis.buttons.recordStatus.update(this.recordState);\n\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: \"record\",\n\t\t\trecordState: recordState,\n\t\t\tnode: e.currentTarget\n\t\t});\n\t};\n\n\t_onRecordStopClick(e)\n\t{\n\t\tthis.recordState.state = View.RecordState.Stopped;\n\t\tthis.buttons.recordStatus.update(this.recordState);\n\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: \"record\",\n\t\t\trecordState: this.recordState.state,\n\t\t\tnode: e.currentTarget\n\t\t});\n\t};\n\n\t_onDocumentButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'document',\n\t\t\tnode: e.target\n\t\t});\n\t};\n\n\t_onCopilotButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'copilot',\n\t\t\tnode: e.target\n\t\t});\n\t};\n\n\t_onGridButtonClick()\n\t{\n\t\tthis.setLayout(this.layout == Layouts.Centered ? Layouts.Grid : Layouts.Centered);\n\t\tif (this.layout == Layouts.Centered && this.localUser.id !== this.centralUser.id)\n\t\t{\n\t\t\tthis.eventEmitter.emit(EventName.onHasMainStream, {\n\t\t\t\tuserId: this.centralUser.id,\n\t\t\t});\n\t\t}\n\t};\n\n\t_onAddButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: \"inviteUser\",\n\t\t\tnode: e.currentTarget\n\t\t});\n\t};\n\n\t_onShareButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: \"share\",\n\t\t\tnode: e.currentTarget\n\t\t});\n\t};\n\n\t_onMicrophoneButtonClick(e)\n\t{\n\t\tif (this.isButtonBlocked('microphone'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (\"stopPropagation\" in e)\n\t\t{\n\t\t\te.stopPropagation();\n\t\t}\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: \"toggleMute\",\n\t\t\tmuted: !Hardware.isMicrophoneMuted\n\t\t});\n\t};\n\n\t_onMicrophoneArrowClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.showDeviceSelector(e.currentTarget);\n\t};\n\n\t_onMicrophoneSideIconClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: \"microphoneSideIcon\",\n\t\t});\n\t};\n\n\t_onMicrophoneSelected(e)\n\t{\n\t\tthis.eventEmitter.emit(EventName.onReplaceMicrophone, {\n\t\t\tdeviceId: e.data.deviceId\n\t\t});\n\t};\n\n\t_onCameraButtonClick(e)\n\t{\n\t\tif (this.isButtonBlocked('camera'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (\"stopPropagation\" in e)\n\t\t{\n\t\t\te.stopPropagation();\n\t\t}\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: \"toggleVideo\",\n\t\t\tvideo: !Hardware.isCameraOn\n\t\t});\n\t};\n\n\t_onCameraArrowClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.showDeviceSelector(e.currentTarget);\n\t};\n\n\t_onCameraSelected(e)\n\t{\n\t\tthis.eventEmitter.emit(EventName.onReplaceCamera, {\n\t\t\tdeviceId: e.data.deviceId\n\t\t});\n\t};\n\n\t_onSpeakerButtonClick()\n\t{\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: \"toggleSpeaker\",\n\t\t\tspeakerMuted: this.speakerMuted\n\t\t});\n\t};\n\n\t_onChangeHdVideo(e)\n\t{\n\t\tthis.eventEmitter.emit(EventName.onChangeHdVideo, e.data);\n\t};\n\n\t_onChangeMicAutoParams(e)\n\t{\n\t\tthis.eventEmitter.emit(EventName.onChangeMicAutoParams, e.data);\n\t};\n\n\t_onChangeFaceImprove(e)\n\t{\n\t\tthis.eventEmitter.emit(EventName.onChangeFaceImprove, e.data);\n\t};\n\n\tdisableFaceImprove()\n\t{\n\t\tif (\n\t\t\tUtil.isDesktop()\n\t\t\t&& DesktopApi.isDesktop()\n\t\t\t&& DesktopApi.getCameraSmoothingStatus()\n\t\t)\n\t\t{\n\t\t\tthis.eventEmitter.emit(EventName.onChangeFaceImprove, {\n\t\t\t\tfaceImproveEnabled: false\n\t\t\t});\n\t\t}\n\t}\n\n\t_onSpeakerSelected(e)\n\t{\n\t\tthis.setSpeakerId(e.data.deviceId);\n\n\t\tthis.eventEmitter.emit(EventName.onReplaceSpeaker, {\n\t\t\tdeviceId: e.data.deviceId\n\t\t});\n\t};\n\n\t_onScreenButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\n\t\tconst limitObj = this.getScreenSharingLimitation();\n\n\t\tthis.onClickButtonWithLimit(limitObj, () => {\n\t\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\t\tbuttonName: 'toggleScreenSharing',\n\t\t\t\tnode: e.target\n\t\t\t});\n\t\t})\n\t};\n\n\t_onChatButtonClick(e)\n\t{\n\t\tthis.hintManager.hide();\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'showChat',\n\t\t\tnode: e.target\n\t\t});\n\t};\n\n\t_onUsersButtonClick(e)\n\t{\n\t\tthis.hintManager.hide();\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'toggleUsers',\n\t\t\tnode: e.target\n\t\t});\n\t};\n\n\t_onMobileMenuButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.showCallMenu();\n\t};\n\n\t_onFloorRequestButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'floorRequest',\n\t\t\tnode: e.target\n\t\t});\n\t};\n\n\t_onMoreButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tif (this.overflownButtonsPopup)\n\t\t{\n\t\t\tthis.overflownButtonsPopup.close();\n\t\t\tthis.buttons.more.setActive(false);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.showOverflownButtonsPopup();\n\t\t\tthis.buttons.more.setActive(true);\n\t\t}\n\t};\n\n\t_onHistoryButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'showHistory',\n\t\t\tnode: e.target\n\t\t});\n\t};\n\n\t_onHangupButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.clearNewLogicRules();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'hangup',\n\t\t\tnode: e.target\n\t\t});\n\t};\n\n\t_onHangupOptionsButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'hangupOptions',\n\t\t\tnode: e.target\n\t\t});\n\t};\n\n\t_onCloseButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'close',\n\t\t\tnode: e.target\n\t\t});\n\t};\n\n\t_onFullScreenButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'fullscreen',\n\t\t\tnode: e.target\n\t\t});\n\t};\n\n\t_onFeedbackButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'feedback',\n\t\t\tnode: e.target\n\t\t});\n\t}\n\n\t_onCallcontrolButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'callcontrol',\n\t\t\tnode: e.target\n\t\t});\n\n\t\tif (this.ahaMomentNotifyCallcontrol)\n\t\t{\n\t\t\tPromoManager.getInstance().markAsWatched(CALLCONTROL_PROMO_ID);\n\t\t}\n\n\t\tthis.clearCallcontrolPromo();\n\t}\n\n\t_onParticipantsButtonListClick(event)\n\t{\n\t\tif (!this.isButtonBlocked('users'))\n\t\t{\n\t\t\tthis._onUsersButtonClick(event);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.isFullScreen)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setUserBlockFolded(!this.isUserBlockFolded);\n\t};\n\n\t_onParticipantsListButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\n\t\tconst viewEvent = new BaseEvent({\n\t\t\tdata: {\n\t\t\t\tbuttonName: 'participantsList',\n\t\t\t\tnode: e.target\n\t\t\t},\n\t\t\tcompatData: ['participantsList', e.target],\n\t\t});\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, viewEvent);\n\n\t\tif (viewEvent.isDefaultPrevented())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tUserSelector.create({\n\t\t\tparentElement: e.currentTarget,\n\t\t\tzIndex: this.baseZIndex + 500,\n\t\t\tuserList: Object.values(this.users),\n\t\t\tcurrent: this.centralUser.id,\n\t\t\tonSelect: (userId) => this.setCentralUser(userId)\n\t\t}).show();\n\t};\n\n\t_onParticipantsButtonMobileListClick()\n\t{\n\t\tthis.showParticipantsMenu();\n\t};\n\n\t_onMobileCallMenuFloorRequestClick()\n\t{\n\t\tthis.callMenu.close();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'floorRequest',\n\t\t});\n\t};\n\n\t_onMobileCallMenShowParticipantsClick()\n\t{\n\t\tthis.callMenu.close();\n\t\tthis.showParticipantsMenu();\n\t};\n\n\t_onMobileCallMenuCopyInviteClick()\n\t{\n\t\tthis.callMenu.close();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: \"share\",\n\t\t\tnode: null\n\t\t})\n\t};\n\n\tshowRenameSlider()\n\t{\n\t\tif (!this.renameSlider)\n\t\t{\n\t\t\tthis.renameSlider = new MobileSlider({\n\t\t\t\tparent: this.elements.root,\n\t\t\t\tcontent: this.renderRenameSlider(),\n\t\t\t\tonClose: () => this.renameSlider.destroy(),\n\t\t\t\tonDestroy: () => this.renameSlider = null,\n\t\t\t});\n\t\t}\n\n\t\tthis.renameSlider.show();\n\t\tsetTimeout(\n\t\t\t() =>\n\t\t\t{\n\t\t\t\tthis.elements.renameSlider.input.focus();\n\t\t\t\tthis.elements.renameSlider.input.select();\n\t\t\t},\n\t\t\t400\n\t\t);\n\t};\n\n\trenderRenameSlider()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-videocall-mobile-rename-slider-wrap\"\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-videocall-mobile-rename-slider-title\"\n\t\t\t\t\t},\n\t\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_MENU_CHANGE_MY_NAME\")\n\t\t\t\t}),\n\t\t\t\tthis.elements.renameSlider.input = Dom.create(\"input\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-videocall-mobile-rename-slider-input\"\n\t\t\t\t\t},\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\ttype: \"text\",\n\t\t\t\t\t\tvalue: this.localUser.userModel.name\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tthis.elements.renameSlider.button = Dom.create(\"button\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-videocall-mobile-rename-slider-button ui-btn ui-btn-md ui-btn-primary\"\n\t\t\t\t\t},\n\t\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_RENAME_CONFIRM\"),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: this._onMobileUserRename.bind(this)\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t};\n\n\t_onMobileUserRename(event)\n\t{\n\t\tevent.stopPropagation();\n\n\t\tconst inputValue = this.elements.renameSlider.input.value;\n\t\tconst newName = inputValue.trim();\n\t\tlet needToUpdate = true;\n\t\tif (newName === this.localUser.userModel.name || newName === '')\n\t\t{\n\t\t\tneedToUpdate = false;\n\t\t}\n\n\t\tif (needToUpdate)\n\t\t{\n\t\t\tthis.toggleRenameSliderInputLoader();\n\t\t\tthis._onUserRename(newName)\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.renameSlider.close();\n\t\t}\n\t};\n\n\t_onMobileCallMenuCancelClick()\n\t{\n\t\tthis.callMenu.close();\n\t};\n\n\t_onLeftEarClick()\n\t{\n\t\tthis.pinUser(this.getLeftUser(this.centralUser.id));\n\t};\n\n\t_onRightEarClick()\n\t{\n\t\tthis.pinUser(this.getRightUser(this.centralUser.id));\n\t};\n\n\t_onLeftPageNavigatorClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.setCurrentPage(this.currentPage - 1)\n\t};\n\n\t_onRightPageNavigatorClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.setCurrentPage(this.currentPage + 1)\n\t};\n\n\t_onTopPageNavigatorClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.setCurrentPage(this.currentPage !== 1 ? this.currentPage - 1 : this.pagesCount);\n\t};\n\n\t_onBottomPageNavigatorClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.setCurrentPage(this.currentPage !== this.pagesCount ? this.currentPage + 1 : 1);\n\t};\n\n\tsetMaxWidth(maxWidth)\n\t{\n\t\tif (this.maxWidth !== maxWidth)\n\t\t{\n\t\t\tconst MAX_WIDTH_SPEAKER_MODE = 650;\n\t\t\tif (maxWidth < MAX_WIDTH_SPEAKER_MODE\n\t\t\t\t&& (!this.maxWidth || this.maxWidth > MAX_WIDTH_SPEAKER_MODE)\n\t\t\t\t&& this.layout === Layouts.Centered\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.setLayout(Layouts.Grid)\n\t\t\t}\n\n\t\t\tconst animateUnsetProperty = this.maxWidth === null;\n\t\t\tthis.maxWidth = maxWidth;\n\t\t\tif (this.size !== View.Size.Folded)\n\t\t\t{\n\t\t\t\tthis._applyMaxWidth(animateUnsetProperty);\n\t\t\t}\n\t\t}\n\t};\n\n\tremoveMaxWidth()\n\t{\n\t\tthis.setMaxWidth(null);\n\t}\n\n\t_applyMaxWidth(animateUnsetProperty)\n\t{\n\t\tconst containerDimensions = this.container.getBoundingClientRect();\n\t\tif (this.maxWidth !== null)\n\t\t{\n\t\t\tif (!this.elements.root.style.maxWidth && animateUnsetProperty)\n\t\t\t{\n\t\t\t\tthis.elements.root.style.maxWidth = containerDimensions.width + 'px';\n\t\t\t}\n\t\t\tsetTimeout(\n\t\t\t\t() => this.elements.root.style.maxWidth = Math.max(this.maxWidth, MIN_WIDTH) + 'px',\n\t\t\t\t0,\n\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root.style.maxWidth = containerDimensions.width + 'px';\n\t\t\tthis.elements.root.addEventListener('transitionend',\n\t\t\t\t() => this.elements.root.style.removeProperty('max-width'),\n\t\t\t\t{once: true},\n\t\t\t)\n\t\t}\n\t};\n\n\treleaseLocalMedia()\n\t{\n\t\tthis.localUser.releaseStream();\n\n\t\tif (this.centralUser.id == this.userId)\n\t\t{\n\t\t\tthis.centralUser.releaseStream();\n\t\t}\n\t};\n\n\tclearNewLogicRules()\n\t{\n\t\tclearTimeout(this.rerenderTimeout);\n\t\tthis.rerenderTimeout = null;\n\t\tthis.waitingForUserMediaTimeouts.forEach(timeout => clearTimeout(timeout));\n\t\tthis.waitingForUserMediaTimeouts.clear();\n\t\tthis.rerenderQueue.clear();\n\t}\n\n\tclearCallcontrolPromo()\n\t{\n\t\tif (this.showCallcontrolPromoPopupTimeout)\n\t\t{\n\t\t\tclearTimeout(this.showCallcontrolPromoPopupTimeout);\n\t\t}\n\n\t\tif (this.ahaMomentNotifyCallcontrol)\n\t\t{\n\t\t\tthis.needToShowCallcontrolPromo = false;\n\t\t\tthis.ahaMomentNotifyCallcontrol.close();\n\t\t\tthis.ahaMomentNotifyCallcontrol = null;\n\t\t}\n\n\t}\n\t// 594840\n\t#getViewVisibilityChange(listners = []) {\n\t\tconst handler = (event) => {\n\t\t\tfor (const listner of listners)\n\t\t\t{\n\t\t\t\tlistner(event, document.visibilityState)\n\t\t\t}\n\t\t};\n\n\t\tconst startViewVisibilityChange = () => {\n\t\t\tdocument.addEventListener('visibilitychange', handler, { capture: true });\n\t\t};\n\n\t\tconst stopViewVisibilityChange = () => {\n\t\t\tdocument.removeEventListener('visibilitychange', handler, { capture: true });\n\t\t};\n\n\t\treturn {\n\t\t\tstartViewVisibilityChange,\n\t\t\tstopViewVisibilityChange,\n\t\t\tgetCurrentVisibility: () => document.visibilityState,\n\t\t};\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.destroyed = true;\n\n\t\tthis.closeCopilotNotify();\n\t\tif (this.overflownButtonsPopup)\n\t\t{\n\t\t\tthis.overflownButtonsPopup.close();\n\t\t}\n\n\t\tthis.preferInitialWindowPlacementPictureInPicture = true;\n\n\t\tif (this.elements.root)\n\t\t{\n\t\t\tDom.remove(this.elements.root);\n\t\t\tthis.elements.root = null;\n\t\t}\n\t\tthis.visible = false;\n\n\t\tthis.clearNewLogicRules();\n\n\t\twindow.removeEventListener(\"webkitfullscreenchange\", this._onFullScreenChangeHandler);\n\t\twindow.removeEventListener(\"mozfullscreenchange\", this._onFullScreenChangeHandler);\n\t\twindow.removeEventListener(\"orientationchange\", this._onOrientationChangeHandler);\n\t\twindow.removeEventListener(\"keydown\", this._onKeyDownHandler);\n\t\twindow.removeEventListener(\"keyup\", this._onKeyUpHandler);\n\n\t\tdocument.removeEventListener('mousemove', this.onMouseMoveHandler);\n\n\t\tthis.resizeObserver.disconnect();\n\t\tthis.resizeObserver = null;\n\t\tif (this.intersectionObserver)\n\t\t{\n\t\t\tthis.intersectionObserver.disconnect();\n\t\t\tthis.intersectionObserver = null;\n\t\t}\n\t\tfor (let userId in this.users)\n\t\t{\n\t\t\tif (this.users.hasOwnProperty(userId))\n\t\t\t{\n\t\t\t\tthis.users[userId].destroy();\n\t\t\t}\n\t\t}\n\t\tthis.userData = null;\n\t\tthis.centralUser.destroy();\n\t\tthis.hintManager.hide();\n\t\tthis.hintManager = null;\n\n\t\tclearTimeout(this.switchPresenterTimeout);\n\n\t\tif (this.buttons.recordStatus)\n\t\t{\n\t\t\tthis.buttons.recordStatus.stopViewUpdate();\n\t\t}\n\t\tthis.recordState = this.getDefaultRecordState();\n\t\tthis.buttons = null;\n\n\t\tthis.eventEmitter.emit(EventName.onDestroy);\n\t\tthis.eventEmitter.unsubscribeAll();\n\n\t\tHardware.unsubscribe(Hardware.Events.onChangeMicrophoneMuted, this.setMuted);\n\t\tHardware.unsubscribe(Hardware.Events.onChangeCameraOn, this.setCameraState);\n\n\t\tthis.clearCallcontrolPromo();\n\n\t\tthis.viewVisibility.stopViewVisibilityChange();\n\t};\n\n\tstatic Layout = Layouts;\n\tstatic Size = Size;\n\tstatic RecordState = RecordState;\n\tstatic RecordType = RecordType;\n\n\tstatic RecordSource = {\n\t\tChat: 'BXCLIENT_CHAT'\n\t};\n\n\tstatic UiState = UiState;\n\tstatic Event = EventName;\n\tstatic RoomState = RoomState;\n\tstatic DeviceSelector = DeviceSelector;\n\tstatic NotificationManager = NotificationManager;\n\tstatic MIN_WIDTH = MIN_WIDTH;\n\n\tstatic DocumentVisibilityState: DocumentVisibilityState = DocumentVisibilityState;\n}","import {Type} from 'main.core'\n\nconst VOLUME_THRESHOLD = 0.02;\nconst INACTIVITY_TIME = 2000;\nconst AVERAGING_COEFFICIENT = 0.6; // from 0 to 1;\n\n/**\n * Naive voice activity detection\n * @param {object} config\n * @param {MediaStream} config.mediaStream\n * @param {function} config.onVoiceStarted\n * @param {function} config.onVoiceStopped\n * @constructor\n */\nexport class SimpleVAD\n{\n\tconstructor(config)\n\t{\n\t\tif (!(config.mediaStream instanceof MediaStream))\n\t\t{\n\t\t\tthrow new Error(\"config.mediaStream should be instance of MediaStream\");\n\t\t}\n\n\t\tif (config.mediaStream.getAudioTracks().length === 0)\n\t\t{\n\t\t\tthrow new Error(\"config.mediaStream should contain audio track\");\n\t\t}\n\n\t\tthis.mediaStream = new MediaStream();\n\t\tthis.mediaStream.addTrack(config.mediaStream.getAudioTracks()[0].clone());\n\t\tthis.audioContext = null;\n\t\tthis.mediaStreamNode = null;\n\t\tthis.analyserNode = null;\n\n\t\tthis.audioTimeDomainData = null;\n\t\tthis.voiceState = false;\n\n\t\tthis.measureInterval = 0;\n\t\tthis.inactivityTimeout = 0;\n\n\t\tthis.currentVolume = 0;\n\n\t\tthis.callbacks = {\n\t\t\tvoiceStarted: Type.isFunction(config.onVoiceStarted) ? config.onVoiceStarted : BX.DoNothing,\n\t\t\tvoiceStopped: Type.isFunction(config.onVoiceStopped) ? config.onVoiceStopped : BX.DoNothing\n\t\t};\n\n\t\tif (SimpleVAD.isSupported())\n\t\t{\n\t\t\tthis.init();\n\t\t}\n\t};\n\n\tstatic isSupported()\n\t{\n\t\treturn (\n\t\t\t(window.AudioContext || window.webkitAudioContext)\n\t\t\t&& window.AnalyserNode\n\t\t\t&& typeof (window.AnalyserNode.prototype['getFloatTimeDomainData']) === \"function\"\n\t\t);\n\t};\n\n\tinit()\n\t{\n\t\tthis.audioContext = new (window.AudioContext || window.webkitAudioContext)();\n\t\tthis.analyserNode = this.audioContext.createAnalyser();\n\t\tthis.analyserNode.fftSize = 128;\n\t\tthis.mediaStreamNode = this.audioContext.createMediaStreamSource(this.mediaStream);\n\t\tthis.mediaStreamNode.connect(this.analyserNode);\n\n\t\tthis.audioTimeDomainData = new Float32Array(this.analyserNode.fftSize);\n\t\tthis.measureInterval = setInterval(this.analyzeAudioStream.bind(this), 100);\n\t};\n\n\tanalyzeAudioStream()\n\t{\n\t\tthis.analyserNode.getFloatTimeDomainData(this.audioTimeDomainData);\n\t\tthis.updateCurrentVolume(this.audioTimeDomainData);\n\n\t\tthis.setVoiceState(this.currentVolume >= VOLUME_THRESHOLD);\n\t};\n\n\tsetVoiceState(voiceState)\n\t{\n\t\tif (this.voiceState == voiceState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (voiceState)\n\t\t{\n\t\t\tthis.callbacks.voiceStarted();\n\t\t\tclearTimeout(this.inactivityTimeout);\n\t\t\tthis.inactivityTimeout = 0;\n\t\t\tthis.voiceState = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (!this.inactivityTimeout)\n\t\t\t{\n\t\t\t\tthis.inactivityTimeout = setTimeout(this.onInactivityTimeout.bind(this), INACTIVITY_TIME);\n\t\t\t}\n\t\t}\n\t};\n\n\tonInactivityTimeout()\n\t{\n\t\tthis.inactivityTimeout = 0;\n\t\tthis.voiceState = false;\n\t\tthis.callbacks.voiceStopped();\n\t};\n\n\tupdateCurrentVolume(audioTimeDomainData)\n\t{\n\t\tlet sum = 0;\n\n\t\tfor (let i = 0; i < audioTimeDomainData.length; i++)\n\t\t{\n\t\t\tsum += audioTimeDomainData[i] * audioTimeDomainData[i];\n\t\t}\n\n\t\tconst rms = Math.sqrt(sum / audioTimeDomainData.length);\n\t\tthis.currentVolume = Math.max(rms, this.currentVolume * AVERAGING_COEFFICIENT);\n\t};\n\n\tdestroy()\n\t{\n\t\tif (this.analyserNode)\n\t\t{\n\t\t\tthis.analyserNode.disconnect();\n\t\t}\n\n\t\tif (this.mediaStreamNode)\n\t\t{\n\t\t\tthis.mediaStreamNode.disconnect();\n\t\t}\n\n\t\tif (this.audioContext)\n\t\t{\n\t\t\tthis.audioContext.close();\n\t\t}\n\n\t\tif (this.mediaStream)\n\t\t{\n\t\t\tthis.mediaStream.getTracks().forEach(track => track.stop());\n\t\t\tthis.mediaStream = null;\n\t\t}\n\n\t\tclearInterval(this.measureInterval);\n\n\t\tthis.analyserNode = null;\n\t\tthis.mediaStreamNode = null;\n\t\tthis.audioContext = null;\n\n\t\tthis.callbacks = {\n\t\t\tvoiceStarted: BX.DoNothing,\n\t\t\tvoiceStopped: BX.DoNothing\n\t\t}\n\t}\n}\n\n","import {Browser, Type, Runtime} from 'main.core';\n\nimport {AbstractCall} from './abstract_call';\nimport { CallEngine, CallState, CallEvent, UserState, Provider, DisconnectReason } from './engine';\nimport {View} from '../view/view';\nimport {SimpleVAD} from './simple_vad';\nimport {Hardware} from '../call_hardware';\nimport Util from '../util';\nimport {Call, CALL_STATE, MediaStreamsKinds} from '../call_api.js';\n\nconst ajaxActions = {\n\tdecline: 'call.Call.decline',\n};\n\nconst clientEvents = {\n\tnegotiationNeeded: 'Call::negotiationNeeded',\n\tconnectionOffer: 'Call::connectionOffer',\n\tconnectionAnswer: 'Call::connectionAnswer',\n\ticeCandidate: 'Call::iceCandidate',\n\tvoiceStarted: 'Call::voiceStarted',\n\tvoiceStopped: 'Call::voiceStopped',\n\trecordState: 'Call::recordState',\n\tmicrophoneState: 'Call::microphoneState',\n\tcameraState: 'Call::cameraState',\n\tvideoPaused: 'Call::videoPaused',\n\tcustomMessage: 'Call::customMessage',\n\tusersInvited: 'Call::usersInvited',\n\tuserInviteTimeout: 'Call::userInviteTimeout',\n};\n\nconst defaultConnectionOptions = {\n\tofferToReceiveVideo: true,\n\tofferToReceiveAudio: true\n};\n\nconst signalingConnectionRefreshPeriod = 30000;\nconst signalingWaitReplyPeriod = 10000;\n//var signalingWaitReplyPeriod = 5000;\nconst invitePeriod = 30000;\nconst reinvitePeriod = 5500;\n\n/**\n * Implements Call interface\n * Public methods:\n * - inviteUsers\n * - cancel\n * - answer\n * - decline\n * - hangup\n * - setMuted\n * - setVideoEnabled\n * - setCameraId\n * - setMicrophoneId\n *\n * Events:\n * - onCallStateChanged //not sure about this.\n * - onUserStateChanged\n * - onUserVoiceStarted\n * - onUserVoiceStopped\n * - onLocalMediaReceived\n * - onLocalMediaStopped\n * - onLocalMediaError\n * - onDeviceListUpdated\n * - onDestroy\n */\n\nexport class ServerPlainCall extends AbstractCall\n{\n\tpeers: {[key: number]: Peer}\n\n\tconstructor(params)\n\t{\n\t\tsuper(params)\n\n\t\tthis.callFromMobile = params.callFromMobile;\n\t\tthis.state = params.state || '';\n\n\t\tthis.peers = this.initPeers(this.users);\n\n\t\tthis.signaling = new Signaling({\n\t\t\tcall: this\n\t\t});\n\n\t\tthis.recordState = {\n\t\t\tstate: 'stopped',\n\t\t\tuserId: 0,\n\t\t\tdate: {\n\t\t\t\tstart: null,\n\t\t\t\tpause: []\n\t\t\t},\n\t\t}\n\n\t\tthis.deviceList = [];\n\n\t\tthis.turnServer = BX.message('turn_server');\n\t\tthis.turnServerLogin = BX.message('turn_server_login') || 'bitrix';\n\t\tthis.turnServerPassword = BX.message('turn_server_password') || 'bitrix';\n\n\t\tthis.userData = params.userData;\n\n\t\tthis._onUnloadHandler = this.#onUnload.bind(this);\n\n\t\tthis.enableMicAutoParameters = params.enableMicAutoParameters !== false;\n\t\tthis.microphoneLevelInterval = null;\n\t\tthis.mediaMutedBySystem = false;\n\n\t\tthis._reconnectionEventCount = 0;\n\t\tthis.waitForAnswerTimeout = null;\n\n\t\twindow.addEventListener(\"unload\", this._onUnloadHandler);\n\t};\n\n\tget provider()\n\t{\n\t\treturn Provider.Plain;\n\t}\n\n\tget hasConnectionData()\n\t{\n\t\treturn Boolean(this.connectionData.mediaServerUrl && this.connectionData.roomData);\n\t}\n\n\tinitPeers(userIds)\n\t{\n\t\tlet peers = {};\n\t\tfor (let i = 0; i < userIds.length; i++)\n\t\t{\n\t\t\tconst userId = Number(userIds[i]);\n\t\t\tif (userId == this.userId)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tpeers[userId] = this.createPeer(userId);\n\t\t}\n\t\treturn peers;\n\t};\n\n\tcreatePeer(userId)\n\t{\n\t\treturn new Peer({\n\t\t\tcall: this,\n\t\t\tuserId: userId,\n\t\t\tready: userId == this.initiatorId,\n\t\t\tsignalingConnected: userId == this.initiatorId,\n\t\t\tisLegacyMobile: userId == this.initiatorId && this.callFromMobile,\n\n\t\t\tonMediaReceived: (e) =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onRemoteMediaReceived, e);\n\t\t\t},\n\t\t\tonMediaStopped: (e) =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onRemoteMediaStopped, e);\n\t\t\t},\n\t\t\tonStateChanged: this.#onPeerStateChanged.bind(this),\n\t\t\tonInviteTimeout: this.#onPeerInviteTimeout.bind(this),\n\t\t\tonRTCStatsReceived: this.#onPeerRTCStatsReceived.bind(this),\n\t\t\tonRTCQualityChanged: this.#onPeerRTCQualityChanged.bind(this),\n\t\t\tonNetworkProblem: (e) =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onNetworkProblem, e)\n\t\t\t},\n\t\t\tonReconnecting: () =>\n\t\t\t{\n\t\t\t\tthis.#onCallReconnecting();\n\t\t\t},\n\t\t\tonReconnected: () =>\n\t\t\t{\n\t\t\t\tthis.#onCallReconnected();\n\t\t\t},\n\t\t\tonUpdateLastUsedCameraId: () =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onUpdateLastUsedCameraId);\n\t\t\t}\n\t\t});\n\t};\n\n\t/**\n\t * Returns call participants and their states\n\t * @return {object} userId => user state\n\t */\n\tgetUsers()\n\t{\n\t\tlet result = {};\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tresult[userId] = this.peers[userId].calculatedState;\n\t\t}\n\t\treturn result;\n\t};\n\n\tisReady()\n\t{\n\t\treturn this.ready;\n\t};\n\n\tsetVideoEnabled = (event) =>\n\t{\n\t\tif (this.videoEnabled == event.data.isCameraOn)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.videoEnabled = event.data.isCameraOn;\n\t\tconst hasVideoTracks = this.localStreams['main'] && this.localStreams['main'].getVideoTracks().length > 0;\n\n\t\tif (this.ready && hasVideoTracks !== this.videoEnabled)\n\t\t{\n\t\t\tthis.replaceLocalMediaStream().then(() =>\n\t\t\t{\n\t\t\t\tthis.signaling.sendCameraState(this.users, this.videoEnabled);\n\t\t\t}).catch(() =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\t\ttag: 'main',\n\t\t\t\t\tstream: this.localStreams['main'] || new MediaStream(),\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t};\n\n\tcanChangeMediaDevices()\n\t{\n\t\treturn !this.mediaMutedBySystem;\n\t};\n\n\tsetMuted = (event) =>\n\t{\n\t\tif (this.muted == event.data.isMicrophoneMuted)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.muted = event.data.isMicrophoneMuted;\n\t\tif (this.localStreams[\"main\"])\n\t\t{\n\t\t\tconst audioTracks = this.localStreams[\"main\"].getAudioTracks();\n\t\t\tif (audioTracks[0])\n\t\t\t{\n\t\t\t\taudioTracks[0].enabled = !this.muted;\n\t\t\t}\n\t\t}\n\n\t\tthis.signaling.sendMicrophoneState(this.users, !this.muted);\n\t\tthis.sendTalkingState();\n\t};\n\n\tsetCameraId(cameraId)\n\t{\n\t\tif (this.cameraId == cameraId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.cameraId = cameraId;\n\n\t\tif (this.ready && this.mediaMutedBySystem)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onNeedResetMediaDevicesState);\n\t\t\tthis.changedMediaMutedBySystem(false);\n\t\t}\n\t\telse if (this.ready && Hardware.isCameraOn)\n\t\t{\n\t\t\tthis.runCallback('onUpdateLastUsedCameraId');\n\t\t\tRuntime.debounce(this.replaceLocalMediaStream, 100, this)();\n\t\t}\n\t};\n\n\tsetMicrophoneId(microphoneId)\n\t{\n\t\tif (this.microphoneId == microphoneId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.microphoneId = microphoneId;\n\t\tif (this.ready)\n\t\t{\n\t\t\tif (this.mediaMutedBySystem)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tRuntime.debounce(this.replaceLocalAudioStream, 100, this)();\n\t\t}\n\t};\n\n\tgetCurrentMicrophoneId()\n\t{\n\t\tif (!this.localStreams['main'])\n\t\t{\n\t\t\treturn this.microphoneId;\n\t\t}\n\n\t\tconst audioTracks = this.localStreams['main'].getAudioTracks();\n\t\tif (audioTracks.length > 0)\n\t\t{\n\t\t\tconst audioTrackSettings = audioTracks[0].getSettings();\n\t\t\treturn audioTrackSettings.deviceId;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.microphoneId;\n\t\t}\n\t};\n\n\tuseHdVideo(flag)\n\t{\n\t\tthis.videoHd = (flag === true);\n\t};\n\n\tsendRecordState(recordState)\n\t{\n\t\trecordState.senderId = this.userId;\n\n\t\tif (!this.#changeRecordState(recordState))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst users = [this.userId].concat(this.users);\n\t\tthis.signaling.sendRecordState(users, this.recordState);\n\t};\n\n\tstopSendingStream(tag)\n\t{\n\t\t//todo: implement\n\t};\n\n\tallowVideoFrom(userList)\n\t{\n\t\t//todo: implement\n\t};\n\n\t/**\n\t * Invites users to participate in the call.\n\t **/\n\tinviteUsers(config: {users: number[], localStream: MediaStream, show?: boolean} = {})\n\t{\n\t\tconst users = Type.isArray(config.users) ? config.users : Object.keys(this.peers);\n\t\tthis.ready = true;\n\n\t\tif (config.localStream instanceof MediaStream && !this.localStreams[\"main\"])\n\t\t{\n\t\t\tthis.localStreams[\"main\"] = config.localStream;\n\t\t}\n\n\t\tthis.getLocalMediaStream(\"main\", true)\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\treturn this.attachToConference();\n\t\t\t})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tif (!this.ready)\n\t\t\t\t{\n\t\t\t\t\tthis.#beforeLeaveCall();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tclearTimeout(this.waitForAnswerTimeout);\n\t\t\t\tthis.waitForAnswerTimeout = setTimeout(() =>\n\t\t\t\t{\n\t\t\t\t\tthis.#onNoAnswer();\n\t\t\t\t}, invitePeriod);\n\n\t\t\t\tfor (let i = 0; i < users.length; i++)\n\t\t\t\t{\n\t\t\t\t\tconst userId = Number(users[i]);\n\t\t\t\t\tif (!this.peers[userId])\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t\t\t\t}\n\t\t\t\t\tthis.peers[userId].onInvited();\n\t\t\t\t}\n\n\t\t\t\tif (config.userData && config.show)\n\t\t\t\t{\n\t\t\t\t\tthis.signaling.sendUsersInvited({\n\t\t\t\t\t\tusers: config.userData,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((e) =>\n\t\t\t{\n\t\t\t\tconsole.error(e);\n\t\t\t\tthis.#beforeLeaveCall();\n\t\t\t\tthis.runCallback(CallEvent.onCallFailure, e);\n\t\t\t});\n\t};\n\n\tattachToConference()\n\t{\n\t\tif (this.CallApi && this.CallApi.getState() === CALL_STATE.CONNECTED)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tthis.CallApi = new Call(this.userId);\n\n\t\t\t\tif (!this.CallApi)\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"Error: could not create Plain call\");\n\t\t\t\t\treturn reject({code: \"PLAIN_NO_CALL\"});\n\t\t\t\t}\n\n\t\t\t\tthis.bindCallEvents();\n\n\t\t\t\tthis.CallApi.on('Connected', () =>\n\t\t\t\t{\n\t\t\t\t\tthis.CallApi.on('Failed', this.#onCallDisconnected);\n\n\t\t\t\t\tthis.subscribeHardwareChanges();\n\n\t\t\t\t\tthis.state = CallState.Connected;\n\t\t\t\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\t\t\t\tlocal: true\n\t\t\t\t\t});\n\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\n\t\t\t\tthis.CallApi.on('Failed', (e) =>\n\t\t\t\t{\n\t\t\t\t\treject(e);\n\t\t\t\t});\n\n\t\t\t\tif (!this.ready)\n\t\t\t\t{\n\t\t\t\t\treturn reject({code: \"PLAIN_NO_CALL\"});\n\t\t\t\t}\n\n\t\t\t\tthis.CallApi.connect({\n\t\t\t\t\troomId: this.uuid,\n\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\tmediaServerUrl: this.connectionData.mediaServerUrl,\n\t\t\t\t\troomData: this.connectionData.roomData,\n\t\t\t\t\tvideoBitrate: 1000000,\n\t\t\t\t\tvideoSimulcast: true,\n\t\t\t\t\taudioDeviceId: this.microphoneId,\n\t\t\t\t\tvideoDeviceId: this.cameraId,\n\t\t\t\t});\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\treject(e);\n\t\t\t}\n\t\t});\n\t};\n\n\tbindCallEvents()\n\t{\n\t\tthis.CallApi.on('ParticipantJoined', this.#onParticipantJoined);\n\t\tthis.CallApi.on('ParticipantLeaved', this.#onParticipantLeaved);\n\t\tthis.CallApi.on('MessageReceived', this.#onCallMessageReceived.bind(this));\n\t\tthis.CallApi.on('Reconnecting', this.#onCallReconnecting);\n\t\tthis.CallApi.on('Reconnected', this.#onCallReconnected);\n\t\tthis.CallApi.on('Disconnected', this.#onCallDisconnected);\n\t\tthis.CallApi.on('ReconnectingFailed', this.#onCallReconnectingFailed);\n\t};\n\n\tremoveCallEvents()\n\t{\n\t\tif (this.CallApi)\n\t\t{\n\t\t\tthis.CallApi.on('Failed', BX.DoNothing);\n\t\t\tthis.CallApi.on('ParticipantJoined', BX.DoNothing);\n\t\t\tthis.CallApi.on('ParticipantLeaved', BX.DoNothing);\n\t\t\tthis.CallApi.on('MessageReceived', BX.DoNothing);\n\t\t\tthis.CallApi.on('Reconnecting', BX.DoNothing);\n\t\t\tthis.CallApi.on('Reconnected', BX.DoNothing);\n\t\t\tthis.CallApi.on('Disconnected', BX.DoNothing);\n\t\t\tthis.CallApi.on('ReconnectingFailed', BX.DoNothing);\n\t\t}\n\t};\n\n\tsubscribeHardwareChanges()\n\t{\n\t\tHardware.subscribe(Hardware.Events.onChangeMicrophoneMuted, this.setMuted);\n\t\tHardware.subscribe(Hardware.Events.onChangeCameraOn, this.setVideoEnabled);\n\t};\n\n\tunsubscribeHardwareChanges()\n\t{\n\t\tHardware.unsubscribe(Hardware.Events.onChangeMicrophoneMuted, this.setMuted);\n\t\tHardware.unsubscribe(Hardware.Events.onChangeCameraOn, this.setVideoEnabled);\n\t};\n\n\tgetMediaConstraints(options = {})\n\t{\n\t\tconst audio = {};\n\t\tconst video = options.videoEnabled ? {} : false;\n\t\tconst hdVideo = !!options.hdVideo;\n\t\tconst supportedConstraints = navigator.mediaDevices.getSupportedConstraints ? navigator.mediaDevices.getSupportedConstraints() : {};\n\n\t\tif (this.microphoneId)\n\t\t{\n\t\t\taudio.deviceId = {ideal: this.microphoneId};\n\t\t}\n\n\t\tif (!this.enableMicAutoParameters)\n\t\t{\n\t\t\tif (supportedConstraints.echoCancellation)\n\t\t\t{\n\t\t\t\taudio.echoCancellation = false;\n\t\t\t}\n\t\t\tif (supportedConstraints.noiseSuppression)\n\t\t\t{\n\t\t\t\taudio.noiseSuppression = false;\n\t\t\t}\n\t\t\tif (supportedConstraints.autoGainControl)\n\t\t\t{\n\t\t\t\taudio.autoGainControl = false;\n\t\t\t}\n\t\t}\n\n\t\tif (video)\n\t\t{\n\t\t\t//video.aspectRatio = 1.7777777778;\n\t\t\tif (this.cameraId)\n\t\t\t{\n\t\t\t\tvideo.deviceId = {exact: this.cameraId};\n\t\t\t}\n\n\t\t\tif (hdVideo)\n\t\t\t{\n\t\t\t\tvideo.width = {ideal: 1280};\n\t\t\t\tvideo.height = {ideal: 720};\n\t\t\t}\n\t\t}\n\n\t\treturn {audio: audio, video: video};\n\t};\n\n\t/**\n\t * Recursively tries to get user media stream with array of constraints\n\t *\n\t * @param constraintsArray array of constraints objects\n\t * @returns {Promise}\n\t */\n\tgetUserMedia(constraintsArray)\n\t{\n\t\treturn new Promise(function (resolve, reject)\n\t\t{\n\t\t\tconst currentConstraints = constraintsArray[0];\n\t\t\tnavigator.mediaDevices.getUserMedia(currentConstraints).then(\n\t\t\t\tfunction (stream)\n\t\t\t\t{\n\t\t\t\t\tresolve(stream);\n\t\t\t\t},\n\t\t\t\tfunction (error)\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"getUserMedia error: \", error);\n\t\t\t\t\tthis.log(\"Current constraints\", currentConstraints);\n\t\t\t\t\tif (constraintsArray.length > 1)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.getUserMedia(constraintsArray.slice(1)).then(\n\t\t\t\t\t\t\tfunction (stream)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tresolve(stream);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfunction (error)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treject(error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.log(\"Last fallback constraints used, failing\");\n\t\t\t\t\t\treject(error);\n\t\t\t\t\t}\n\t\t\t\t}.bind(this)\n\t\t\t)\n\t\t}.bind(this))\n\t};\n\n\tgetLocalMediaStream(tag, fallbackToAudio)\n\t{\n\t\tif (!Type.isStringFilled(tag))\n\t\t{\n\t\t\ttag = 'main';\n\t\t}\n\t\tif (this.localStreams[tag])\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\ttag: tag,\n\t\t\t\tstream: this.localStreams[tag]\n\t\t\t});\n\t\t\treturn Promise.resolve(this.localStreams[tag]);\n\t\t}\n\n\t\tthis.log(\"Requesting access to media devices\");\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tlet constraintsArray = [];\n\t\t\tif (Hardware.isCameraOn)\n\t\t\t{\n\t\t\t\tconstraintsArray.push(this.getMediaConstraints({videoEnabled: true, hdVideo: true}));\n\t\t\t\tconstraintsArray.push(this.getMediaConstraints({videoEnabled: true, hdVideo: false}));\n\t\t\t\tif (fallbackToAudio)\n\t\t\t\t{\n\t\t\t\t\tconstraintsArray.push(this.getMediaConstraints({videoEnabled: false}));\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconstraintsArray.push(this.getMediaConstraints({videoEnabled: false}));\n\t\t\t}\n\n\t\t\tthis.getUserMedia(constraintsArray).then((stream) =>\n\t\t\t{\n\t\t\t\tthis.log(\"Local media stream received\");\n\t\t\t\tthis.localStreams[tag] = stream;\n\t\t\t\tstream.getVideoTracks().forEach((track) =>\n\t\t\t\t{\n\t\t\t\t\ttrack.addEventListener(\"ended\", () => this.onLocalVideoTrackEnded());\n\t\t\t\t\ttrack.addEventListener(\"mute\", () => this.onLocalVideoTrackMute());\n\t\t\t\t\ttrack.addEventListener(\"unmute\", () => this.onLocalVideoTrackUnmute());\n\t\t\t\t});\n\n\t\t\t\tstream.getAudioTracks().forEach((track) =>\n\t\t\t\t{\n\t\t\t\t\ttrack.addEventListener(\"ended\", () => this.onLocalAudioTrackEnded())\n\t\t\t\t});\n\n\t\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\t\ttag: tag,\n\t\t\t\t\tstream: stream\n\t\t\t\t});\n\t\t\t\tthis.setPublishingState(MediaStreamsKinds.Camera, true);\n\t\t\t\tif (tag === 'main')\n\t\t\t\t{\n\t\t\t\t\tthis.attachVoiceDetection();\n\t\t\t\t\tif (Hardware.isMicrophoneMuted)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst audioTracks = stream.getAudioTracks();\n\t\t\t\t\t\tif (audioTracks[0])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\taudioTracks[0].enabled = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (this.deviceList.length === 0)\n\t\t\t\t{\n\t\t\t\t\tHardware.getCurrentDeviceList().then((deviceList) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.deviceList = deviceList;\n\t\t\t\t\t\tthis.runCallback(CallEvent.onDeviceListUpdated, {\n\t\t\t\t\t\t\tdeviceList: this.deviceList\n\t\t\t\t\t\t})\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tresolve(this.localStreams[tag]);\n\t\t\t}).catch((e) =>\n\t\t\t{\n\t\t\t\tthis.log(\"Could not get local media stream.\", e);\n\t\t\t\tthis.log(\"Request constraints: .\", constraintsArray);\n\t\t\t\tthis.runCallback(\"onLocalMediaError\", {\n\t\t\t\t\ttag: tag,\n\t\t\t\t\terror: e\n\t\t\t\t});\n\t\t\t\treject(e);\n\t\t\t});\n\t\t})\n\t};\n\n\tgetLocalAudioStream(tag, fallbackToAudio)\n\t{\n\t\tif (!Type.isStringFilled(tag))\n\t\t{\n\t\t\ttag = 'main';\n\t\t}\n\t\tif (this.localStreams[tag] && this.localStreams[tag].getAudioTracks().length)\n\t\t{\n\t\t\treturn Promise.resolve(this.localStreams[tag]);\n\t\t}\n\n\t\tthis.log(\"Requesting access to audio devices\");\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tlet constraintsArray = [this.getMediaConstraints({videoEnabled: false})];\n\n\t\t\tthis.getUserMedia(constraintsArray).then((stream) =>\n\t\t\t{\n\t\t\t\tthis.log(\"Local audio stream received\");\n\n\t\t\t\tif (!this.localStreams[tag]) {\n\t\t\t\t\tthis.localStreams[tag] = new MediaStream();\n\t\t\t\t}\n\n\t\t\t\tthis.localStreams[tag].addTrack(stream.getAudioTracks()[0]);\n\t\t\t\tstream.getAudioTracks().forEach((track) =>\n\t\t\t\t{\n\t\t\t\t\ttrack.addEventListener(\"ended\", () => this.onLocalAudioTrackEnded())\n\t\t\t\t});\n\n\t\t\t\tif (tag === 'main')\n\t\t\t\t{\n\t\t\t\t\tthis.attachVoiceDetection();\n\t\t\t\t\tif (this.muted)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst audioTracks = stream.getAudioTracks();\n\t\t\t\t\t\tif (audioTracks[0])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\taudioTracks[0].enabled = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (this.deviceList.length === 0)\n\t\t\t\t{\n\t\t\t\t\tHardware.getCurrentDeviceList().then((deviceList) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.deviceList = deviceList;\n\t\t\t\t\t\tthis.runCallback(CallEvent.onDeviceListUpdated, {\n\t\t\t\t\t\t\tdeviceList: this.deviceList\n\t\t\t\t\t\t})\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tresolve(this.localStreams[tag]);\n\t\t\t}).catch((e) =>\n\t\t\t{\n\t\t\t\tthis.log(\"Could not get local audio stream.\", e);\n\t\t\t\tthis.log(\"Request constraints: .\", constraintsArray);\n\t\t\t\tthis.runCallback(\"onLocalMediaError\", {\n\t\t\t\t\ttag: tag,\n\t\t\t\t\terror: e\n\t\t\t\t});\n\t\t\t\treject(e);\n\t\t\t});\n\t\t})\n\t};\n\n\tsetPublishingState(deviceType, publishing)\n\t{\n\t\tif (deviceType === MediaStreamsKinds.Camera)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onCameraPublishing, {\n\t\t\t\tpublishing\n\t\t\t});\n\t\t}\n\t\telse if (deviceType === MediaStreamsKinds.Microphone)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onMicrophonePublishing, {\n\t\t\t\tpublishing\n\t\t\t});\n\t\t}\n\t}\n\n\tstartMediaCapture()\n\t{\n\t\treturn this.getLocalMediaStream();\n\t};\n\n\tattachVoiceDetection()\n\t{\n\t\tif (this.voiceDetection)\n\t\t{\n\t\t\tthis.voiceDetection.destroy();\n\t\t}\n\t\tif (this.microphoneLevelInterval)\n\t\t{\n\t\t\tclearInterval(this.microphoneLevelInterval);\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tthis.voiceDetection = new SimpleVAD({\n\t\t\t\tmediaStream: this.localStreams['main'],\n\t\t\t\tonVoiceStarted: this.onLocalVoiceStarted.bind(this),\n\t\t\t\tonVoiceStopped: this.onLocalVoiceStopped.bind(this)\n\t\t\t})\n\n\t\t\tthis.microphoneLevelInterval = setInterval(function ()\n\t\t\t{\n\t\t\t\tthis.microphoneLevel = this.voiceDetection.currentVolume;\n\t\t\t}.bind(this), 200)\n\t\t} catch (e)\n\t\t{\n\t\t\tthis.log('Could not attach voice detection to media stream');\n\t\t}\n\t};\n\n\tgetDisplayMedia()\n\t{\n\t\treturn new Promise(function (resolve, reject)\n\t\t{\n\t\t\tif (window[\"BXDesktopSystem\"] && window[\"BXDesktopSystem\"].GetProperty('versionParts')[3] < 78) {\n\t\t\t\tnavigator.mediaDevices.getUserMedia({\n\t\t\t\t\tvideo: {\n\t\t\t\t\t\tmandatory: {\n\t\t\t\t\t\t\tchromeMediaSource: 'screen',\n\t\t\t\t\t\t\tmaxWidth: 1920,\n\t\t\t\t\t\t\tmaxHeight: 1080,\n\t\t\t\t\t\t\tmaxFrameRate: 5\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}).then(\n\t\t\t\t\tfunction (stream)\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve(stream)\n\t\t\t\t\t},\n\t\t\t\t\tfunction (error)\n\t\t\t\t\t{\n\t\t\t\t\t\treject(error)\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t\telse if (navigator.mediaDevices.getDisplayMedia)\n\t\t\t{\n\t\t\t\tnavigator.mediaDevices.getDisplayMedia({\n\t\t\t\t\tvideo: {\n\t\t\t\t\t\tcursor: 'always',\n\t\t\t\t\t\twidth: {\n\t\t\t\t\t\t\tideal: 1920\n\t\t\t\t\t\t},\n\t\t\t\t\t\theight: {\n\t\t\t\t\t\t\tideal: 1080\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tsystemAudio: \"include\",\n\t\t\t\t\taudio: true,\n\t\t\t\t}).then(\n\t\t\t\t\tfunction (stream)\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve(stream)\n\t\t\t\t\t},\n\t\t\t\t\tfunction (error)\n\t\t\t\t\t{\n\t\t\t\t\t\treject(error)\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconsole.error(\"Screen sharing is not supported\");\n\t\t\t\treject(\"Screen sharing is not supported\");\n\t\t\t}\n\t\t})\n\t};\n\n\tstartScreenSharing(changeSource)\n\t{\n\t\tchangeSource = !!changeSource;\n\t\tif (this.localStreams[\"screen\"] && !changeSource)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getDisplayMedia().then((stream) =>\n\t\t{\n\t\t\tthis.localStreams[\"screen\"] = stream;\n\n\t\t\tstream.getVideoTracks().forEach((track) =>\n\t\t\t{\n\t\t\t\ttrack.addEventListener(\"ended\", () => this.stopScreenSharing())\n\t\t\t});\n\n\t\t\tthis.runCallback(CallEvent.onUserScreenState, {\n\t\t\t\tuserId: this.userId,\n\t\t\t\tscreenState: true,\n\t\t\t});\n\n\t\t\tif (this.ready)\n\t\t\t{\n\t\t\t\tfor (let userId in this.peers)\n\t\t\t\t{\n\t\t\t\t\tif (this.peers[userId].calculatedState === UserState.Connected)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.peers[userId].sendMedia();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t}).catch((e) =>\n\t\t{\n\t\t\tthis.log(e);\n\t\t});\n\t};\n\n\tonLocalVideoTrackEnded()\n\t{\n\t\tif (!this.localStreams[\"main\"])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tUtil.stopMediaStreamVideoTracks(this.localStreams[\"main\"])\n\n\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\ttag: 'main',\n\t\t\tstream: this.localStreams[\"main\"]\n\t\t});\n\n\t\tif (!this.localStreams[\"main\"].getAudioTracks().length)\n\t\t{\n\t\t\tthis.localStreams[\"main\"] = null;\n\t\t}\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId].calculatedState === UserState.Connected)\n\t\t\t{\n\t\t\t\tthis.peers[userId].sendMedia();\n\t\t\t}\n\t\t}\n\t}\n\n\tonLocalAudioTrackEnded()\n\t{\n\t\tif (!this.localStreams[\"main\"])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tUtil.stopMediaStreamAudioTracks(this.localStreams[\"main\"])\n\n\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\ttag: 'main',\n\t\t\tstream: this.localStreams[\"main\"]\n\t\t});\n\n\t\tif (!this.localStreams[\"main\"].getVideoTracks().length)\n\t\t{\n\t\t\tthis.localStreams[\"main\"] = null;\n\t\t}\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId].calculatedState === UserState.Connected)\n\t\t\t{\n\t\t\t\tthis.peers[userId].sendMedia();\n\t\t\t}\n\t\t}\n\t}\n\n\tonLocalVideoTrackMute()\n\t{\n\t\tthis.changedMediaMutedBySystem(true);\n\t\tthis.prevMainStream = this.localStreams['main'];\n\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.localStreams['main'] = null;\n\t\t\tfor (let userId in this.peers)\n\t\t\t{\n\t\t\t\tif (this.peers[userId].isReady())\n\t\t\t\t{\n\t\t\t\t\tthis.peers[userId].replaceMediaStream('main');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tonLocalVideoTrackUnmute()\n\t{\n\t\tthis.changedMediaMutedBySystem(false);\n\n\t\tif (this.prevMainStream)\n\t\t{\n\t\t\tUtil.stopMediaStream(this.prevMainStream);\n\t\t\tthis.prevMainStream = null;\n\t\t}\n\n\t\tthis.replaceLocalMediaStream().catch(() =>\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\ttag: 'main',\n\t\t\t\tstream: this.localStreams['main'] || new MediaStream(),\n\t\t\t});\n\t\t});\n\t};\n\n\tchangedMediaMutedBySystem(muted)\n\t{\n\t\tthis.mediaMutedBySystem = muted;\n\t\tconst microphoneState = muted ? false : !Hardware.isMicrophoneMuted;\n\t\tconst cameraState = muted ? false : Hardware.isCameraOn;\n\t\tthis.signaling.sendMicrophoneState(this.users, microphoneState);\n\t\tthis.signaling.sendCameraState(this.users, cameraState);\n\t};\n\n\tstopScreenSharing()\n\t{\n\t\tif (!this.localStreams[\"screen\"])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tUtil.stopMediaStream(this.localStreams[\"screen\"])\n\t\tthis.localStreams[\"screen\"] = null;\n\t\tthis.runCallback(CallEvent.onUserScreenState, {\n\t\t\tuserId: this.userId,\n\t\t\tscreenState: false,\n\t\t});\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId].calculatedState === UserState.Connected)\n\t\t\t{\n\t\t\t\tthis.peers[userId].sendMedia();\n\t\t\t}\n\t\t}\n\t};\n\n\tisScreenSharingStarted()\n\t{\n\t\treturn this.localStreams[\"screen\"] instanceof MediaStream;\n\t};\n\n\tonLocalVoiceStarted()\n\t{\n\t\tthis.talking = true;\n\t\tthis.sendTalkingState();\n\t};\n\n\tonLocalVoiceStopped()\n\t{\n\t\tthis.talking = false;\n\t\tthis.sendTalkingState();\n\t};\n\n\tsendTalkingState()\n\t{\n\t\tif (this.talking && !Hardware.isMicrophoneMuted)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserVoiceStarted, {\n\t\t\t\tuserId: this.userId,\n\t\t\t\tlocal: true\n\t\t\t});\n\t\t\tthis.signaling.sendVoiceStarted({\n\t\t\t\tuserId: this.users\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserVoiceStopped, {\n\t\t\t\tuserId: this.userId,\n\t\t\t\tlocal: true\n\t\t\t});\n\t\t\tthis.signaling.sendVoiceStopped({\n\t\t\t\tuserId: this.users\n\t\t\t});\n\t\t}\n\t}\n\n\tsendCustomMessage(message)\n\t{\n\t\tthis.signaling.sendCustomMessage({\n\t\t\tuserId: this.users,\n\t\t\tmessage: message\n\t\t});\n\t}\n\n\t/**\n\t * @param {Object} config\n\t * @param {bool} [config.useVideo]\n\t * @param {bool} [config.enableMicAutoParameters]\n\t * @param {MediaStream} [config.localStream]\n\t */\n\tanswer(config)\n\t{\n\t\tif (!Type.isPlainObject(config))\n\t\t{\n\t\t\tconfig = {};\n\t\t}\n\t\t/*if(this.direction !== Direction.Incoming)\n\t\t{\n\t\t\tthrow new Error('Only incoming call could be answered');\n\t\t}*/\n\n\t\tthis.ready = true;\n\t\tthis.videoEnabled = Hardware.isCameraOn;\n\t\tthis.muted = Hardware.isMicrophoneMuted;\n\t\tthis.enableMicAutoParameters = (config.enableMicAutoParameters !== false);\n\n\t\tif (config.localStream instanceof MediaStream)\n\t\t{\n\t\t\tthis.localStreams[\"main\"] = config.localStream;\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tthis.getLocalMediaStream(\"main\", true)\n\t\t\t\t.then(() =>\n\t\t\t\t{\n\t\t\t\t\treturn this.attachToConference();\n\t\t\t\t})\n\t\t\t\t.then(() =>\n\t\t\t\t{\n\t\t\t\t\tif (!this.ready)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#beforeLeaveCall();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve();\n\t\t\t\t})\n\t\t\t\t.catch((e) =>\n\t\t\t\t{\n\t\t\t\t\tthis.#beforeLeaveCall();\n\t\t\t\t\tthis.runCallback(CallEvent.onCallFailure, e);\n\t\t\t\t\treject(e);\n\t\t\t\t});\n\t\t});\n\t};\n\n\tdecline(code, reason)\n\t{\n\t\tthis.ready = false;\n\n\t\tlet data = {\n\t\t\tcallUuid: this.uuid,\n\t\t\tcallInstanceId: this.instanceId,\n\t\t};\n\n\t\tif (typeof (code) != 'undefined')\n\t\t{\n\t\t\tdata.code = code;\n\t\t}\n\t\tif (typeof (reason) != 'undefined')\n\t\t{\n\t\t\tdata.reason = reason;\n\t\t}\n\n\t\tCallEngine.getRestClient().callMethod(ajaxActions.decline, data).then(() =>\n\t\t{\n\t\t\tthis.destroy();\n\t\t});\n\t};\n\n\thangup(force = false)\n\t{\n\t\tif (!this.ready && !force)\n\t\t{\n\t\t\tconst error = new Error(\"Hangup in wrong state\");\n\t\t\tthis.log(error);\n\t\t\treturn Promise.reject(error);\n\t\t}\n\n\t\tconst tempError = new Error();\n\t\ttempError.name = \"Call stack:\";\n\t\tthis.log(\"Hangup received \\n\" + tempError.stack);\n\n\t\tthis.ready = false;\n\t\tthis.state = CallState.Proceeding;\n\t\tthis.connectionData = {};\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tfor (let userId in this.peers)\n\t\t\t{\n\t\t\t\tthis.peers[userId].disconnect();\n\t\t\t}\n\n\t\t\tthis.#beforeLeaveCall();\n\n\t\t\tthis.runCallback(CallEvent.onLeave, {local: true});\n\t\t});\n\t};\n\n\tgetState()\n\t{\n\n\t};\n\n\treplaceLocalMediaStream(tag: string = \"main\")\n\t{\n\t\tthis.setPublishingState(MediaStreamsKinds.Camera, true);\n\t\tif (this.localStreams[tag])\n\t\t{\n\t\t\tUtil.stopMediaStream(this.localStreams[tag]);\n\t\t\tthis.localStreams[tag] = null;\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tthis.getLocalMediaStream(tag).then(() =>\n\t\t\t{\n\t\t\t\tif (this.ready)\n\t\t\t\t{\n\t\t\t\t\tfor (let userId in this.peers)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.peers[userId].isReady())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.peers[userId].replaceMediaStream(tag);\n\t\t\t\t\t\t\tif (this.mediaMutedBySystem)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.changedMediaMutedBySystem(false);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tresolve();\n\t\t\t}).catch((e) =>\n\t\t\t{\n\t\t\t\tconsole.error('Could not get access to hardware; don\\'t really know what to do. error:', e);\n\t\t\t\treject(e);\n\t\t\t});\n\t\t})\n\t};\n\n\treplaceLocalAudioStream(tag: string = \"main\")\n\t{\n\t\tif (this.localStreams[tag])\n\t\t{\n\t\t\tUtil.stopMediaStreamAudioTracks(this.localStreams[tag]);\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tthis.getLocalAudioStream(tag).then(() =>\n\t\t\t{\n\t\t\t\tif (this.ready)\n\t\t\t\t{\n\t\t\t\t\tfor (let userId in this.peers)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.peers[userId].isReady())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.peers[userId].replaceMediaStream(tag);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tresolve();\n\t\t\t}).catch((e) =>\n\t\t\t{\n\t\t\t\tconsole.error('Could not get access to hardware; don\\'t really know what to do. error:', e);\n\t\t\t\treject(e);\n\t\t\t});\n\t\t})\n\t};\n\n\tsendAllStreams(userId)\n\t{\n\t\tif (!this.peers[userId])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.peers[userId].isReady())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let tag in this.localStreams)\n\t\t{\n\t\t\tif (this.localStreams[tag])\n\t\t\t{\n\t\t\t\tthis.peers[userId].sendMedia();\n\t\t\t}\n\t\t}\n\t};\n\n\tisAnyoneParticipating()\n\t{\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId].isParticipating())\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t};\n\n\tgetParticipatingUsers()\n\t{\n\t\tlet result = [];\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId].isParticipating())\n\t\t\t{\n\t\t\t\tresult.push(userId);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t};\n\n\t/**\n\t * Adds users, invited by you or someone else\n\t * @param {Number[]} users\n\t */\n\taddJoinedUsers(users)\n\t{\n\t\tfor (let i = 0; i < users.length; i++)\n\t\t{\n\t\t\tconst userId = Number(users[i]);\n\t\t\tif (userId == this.userId || this.peers[userId])\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t\tif (!this.users.includes(userId))\n\t\t\t{\n\t\t\t\tthis.users.push(userId);\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * Adds users, invited by you or someone else\n\t * @param {Object} users\n\t */\n\taddInvitedUsers(users)\n\t{\n\t\tfor (let id in users)\n\t\t{\n\t\t\tconst userId = Number(id);\n\t\t\tif (userId == this.userId)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (!this.peers[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t\t\tthis.runCallback(CallEvent.onUserInvited, {\n\t\t\t\t\tuserId: userId,\n\t\t\t\t\tuserData: {[userId]: users[id]},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (this.peers[userId].calculatedState !== UserState.Calling)\n\t\t\t{\n\t\t\t\tthis.peers[userId].onInvited();\n\t\t\t}\n\n\t\t\tif (!this.users.includes(userId))\n\t\t\t{\n\t\t\t\tthis.users.push(userId);\n\t\t\t}\n\t\t}\n\t};\n\n\t#changeRecordState(params)\n\t{\n\t\tif (params.action !== View.RecordState.Started && this.recordState.userId != params.senderId)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (params.action === View.RecordState.Started)\n\t\t{\n\t\t\tif (this.recordState.state !== View.RecordState.Stopped)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.recordState.state = View.RecordState.Started;\n\t\t\tthis.recordState.userId = params.senderId;\n\t\t\tthis.recordState.date.start = params.date;\n\t\t\tthis.recordState.date.pause = [];\n\t\t}\n\t\telse if (params.action === View.RecordState.Paused)\n\t\t{\n\t\t\tif (this.recordState.state !== View.RecordState.Started)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.recordState.state = View.RecordState.Paused;\n\t\t\tthis.recordState.date.pause.push(\n\t\t\t\t{start: params.date, finish: null}\n\t\t\t);\n\t\t}\n\t\telse if (params.action === View.RecordState.Resumed)\n\t\t{\n\t\t\tif (this.recordState.state !== View.RecordState.Paused)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.recordState.state = View.RecordState.Started;\n\t\t\tconst pauseElement = this.recordState.date.pause.find(function (element)\n\t\t\t{\n\t\t\t\treturn element.finish === null;\n\t\t\t});\n\t\t\tif (pauseElement)\n\t\t\t{\n\t\t\t\tpauseElement.finish = params.date;\n\t\t\t}\n\t\t}\n\t\telse if (params.action === View.RecordState.Stopped)\n\t\t{\n\t\t\tthis.recordState.state = View.RecordState.Stopped;\n\t\t\tthis.recordState.userId = 0;\n\t\t\tthis.recordState.date.start = null;\n\t\t\tthis.recordState.date.pause = [];\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t#onNoAnswer()\n\t{\n\t\tif (this.ready && !this.isAnyoneParticipating())\n\t\t{\n\t\t\tthis.destroy(true);\n\t\t}\n\t}\n\n\t__onPullEvent(command, params, extra)\n\t{\n\t\tconst handlers = {\n\t\t\t'Call::answer': this.#onPullEventAnswer.bind(this),\n\t\t\t'Call::hangup': this.#onPullEventHangup.bind(this),\n\t\t\t'Call::usersJoined': this.#onPullEventUsersJoined.bind(this),\n\t\t\t'Call::associatedEntityReplaced': this.#onPullEventAssociatedEntityReplaced.bind(this),\n\t\t\t'Call::finish': this.#onPullEventFinish.bind(this),\n\t\t\t'Call::customMessage': this.#onPullEventCallCustomMessage.bind(this),\n\t\t};\n\n\t\tif (handlers[command])\n\t\t{\n\t\t\tif (command !== 'Call::ping')\n\t\t\t{\n\t\t\t\tthis.log(\"Signaling: \" + command + \"; Parameters: \" + JSON.stringify(params));\n\t\t\t}\n\t\t\thandlers[command].call(this, params);\n\t\t}\n\t};\n\n\t#onPullEventUsersJoined(params)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst users = params.users;\n\n\t\tthis.addJoinedUsers(users);\n\t};\n\n\t#onPullEventUsersInvited(params)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst users = params.users;\n\n\t\tthis.addInvitedUsers(users);\n\t};\n\n\t#onPullEventAnswer(params)\n\t{\n\t\tconst senderId = Number(params.senderId);\n\n\t\tif (senderId == this.userId)\n\t\t{\n\t\t\treturn this.#onPullEventAnswerSelf(params);\n\t\t}\n\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.peers[senderId])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.peers[senderId].isReady())\n\t\t{\n\t\t\tthis.log(\"Received answer for user \" + senderId + \" in ready state, ignoring\");\n\t\t\treturn;\n\t\t}\n\n\t\tthis.peers[senderId].setSignalingConnected(true);\n\t\tthis.peers[senderId].setReady(true);\n\t\tthis.peers[senderId].isLegacyMobile = params.isLegacyMobile === true;\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.sendAllStreams(senderId);\n\t\t}\n\t};\n\n\t#onPullEventAnswerSelf(params)\n\t{\n\t\tthis.runCallback('onGetUserMediaEnded', {});\n\t\tif (params.callInstanceId === this.instanceId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.log(\"Received remote self-answer in ready state, ignoring\");\n\t\t\treturn;\n\t\t}\n\n\t\t// call was answered elsewhere\n\t\tthis.log(\"Call was answered elsewhere\");\n\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\tlocal: false\n\t\t});\n\t};\n\n\t#onPullEventHangup(params)\n\t{\n\t\tconst senderId = params.senderId;\n\n\t\tif (this.userId == senderId)\n\t\t{\n\t\t\tif (this.instanceId != params.callInstanceId)\n\t\t\t{\n\t\t\t\t// self hangup elsewhere\n\t\t\t\tthis.runCallback(CallEvent.onLeave, {local: false});\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.peers[senderId] || this.peers[senderId].participant)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.peers[senderId].disconnect(params.code);\n\t\tthis.peers[senderId].setReady(false);\n\n\t\tif (params.code == 603)\n\t\t{\n\t\t\tthis.peers[senderId].setDeclined(true);\n\t\t}\n\n\t\tif (!this.isAnyoneParticipating() && this.ready)\n\t\t{\n\t\t\tthis.hangup();\n\t\t}\n\t};\n\n\t#onPullEventNegotiationNeeded(params)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet peer: Peer = this.peers[params.senderId];\n\t\tif (!peer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tpeer.setReady(true);\n\t\tif (params.restart)\n\t\t{\n\t\t\tpeer.reconnect()\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpeer.onNegotiationNeeded();\n\t\t}\n\t};\n\n\t#onPullEventConnectionOffer(params)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst peer = this.peers[params.senderId];\n\t\tif (!peer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tpeer.setReady(true);\n\t\tpeer.setUserAgent(params.userAgent);\n\t\tpeer.setConnectionOffer(params.connectionId, params.sdp, params.tracks);\n\t};\n\n\t#onPullEventConnectionAnswer(params)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst peer = this.peers[params.senderId];\n\t\tif (!peer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst connectionId = params.connectionId;\n\n\t\tpeer.setUserAgent(params.userAgent);\n\t\tpeer.setConnectionAnswer(connectionId, params.sdp, params.tracks);\n\t};\n\n\t#onPullEventIceCandidate(params)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst peer = this.peers[params.senderId];\n\t\tlet candidates;\n\t\tif (!peer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tcandidates = params.candidates;\n\t\t\tfor (let i = 0; i < candidates.length; i++)\n\t\t\t{\n\t\t\t\tpeer.addIceCandidate(params.connectionId, candidates[i]);\n\t\t\t}\n\t\t} catch (e)\n\t\t{\n\t\t\tthis.log('Error parsing serialized candidate: ', e);\n\t\t}\n\t};\n\n\t#onPullEventVoiceStarted(params)\n\t{\n\t\tthis.runCallback(CallEvent.onUserVoiceStarted, {\n\t\t\tuserId: params.senderId\n\t\t})\n\t};\n\n\t#onPullEventVoiceStopped(params)\n\t{\n\t\tthis.runCallback(CallEvent.onUserVoiceStopped, {\n\t\t\tuserId: params.senderId\n\t\t})\n\t};\n\n\t#onPullEventMicrophoneState(params)\n\t{\n\t\tthis.runCallback(CallEvent.onUserMicrophoneState, {\n\t\t\tuserId: params.senderId,\n\t\t\tmicrophoneState: params.microphoneState\n\t\t})\n\t};\n\n\t#onPullEventCameraState(params)\n\t{\n\t\tthis.runCallback(CallEvent.onUserCameraState, {\n\t\t\tuserId: params.senderId,\n\t\t\tcameraState: params.cameraState\n\t\t})\n\t};\n\n\t#onPullEventVideoPaused(params)\n\t{\n\t\tconst peer = this.peers[params.senderId];\n\t\tif (!peer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.runCallback(CallEvent.onUserVideoPaused, {\n\t\t\tuserId: params.senderId,\n\t\t\tvideoPaused: params.videoPaused\n\t\t});\n\n\t\tpeer.holdOutgoingVideo(!!params.videoPaused);\n\t};\n\n\t#onPullEventRecordState(params)\n\t{\n\t\tthis.runCallback(CallEvent.onUserRecordState, {\n\t\t\tuserId: params.senderId,\n\t\t\trecordState: params.recordState\n\t\t})\n\t};\n\n\t#onPullEventAssociatedEntityReplaced(params)\n\t{\n\t\tif (params.call && params.call.ASSOCIATED_ENTITY)\n\t\t{\n\t\t\tthis.associatedEntity = params.call.ASSOCIATED_ENTITY;\n\t\t}\n\t};\n\n\t#onPullEventFinish()\n\t{\n\t\tthis.destroy();\n\t};\n\n\t#onPullEventCallCustomMessage(params)\n\t{\n\t\tthis.runCallback(CallEvent.onCustomMessage, {message: params.message});\n\t}\n\n\t#onPeerStateChanged(e)\n\t{\n\t\tthis.runCallback(CallEvent.onUserStateChanged, e);\n\n\t\tif (e.state == UserState.Failed || e.state == UserState.Unavailable)\n\t\t{\n\t\t\tif (!this.isAnyoneParticipating())\n\t\t\t{\n\t\t\t\tthis.hangup().then(this.destroy.bind(this)).catch(() =>\n\t\t\t\t\t{\n\t\t\t\t\t\t//this.runCallback(Event.onCallFailure, e);\n\t\t\t\t\t\tthis.destroy();\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\telse if (e.state == UserState.Connected)\n\t\t{\n\t\t\tthis.signaling.sendMicrophoneState(e.userId, !Hardware.isMicrophoneMuted);\n\t\t\tthis.signaling.sendCameraState(e.userId, Hardware.isCameraOn);\n\t\t\tthis.wasConnected = true;\n\t\t}\n\t};\n\n\t#onPeerInviteTimeout(e)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t};\n\n\t#onPeerRTCStatsReceived(e)\n\t{\n\t\tconst remoteReportsToShow = {};\n\t\tconst localReportsToShow = {};\n\n\t\te.stats.forEach((report) =>\n\t\t{\n\t\t\tif (report.type === 'inbound-rtp' && (report.kind === 'video' || report.kind === 'audio') && report.source)\n\t\t\t{\n\t\t\t\tremoteReportsToShow[report.source] = report;\n\t\t\t}\n\t\t\tif (report.type === 'outbound-rtp' && (report.kind === 'video' || report.kind === 'audio') && report.source)\n\t\t\t{\n\t\t\t\tlocalReportsToShow[report.source] = report;\n\t\t\t}\n\t\t});\n\n\t\tthis.runCallback(CallEvent.onUserStatsReceived, {\n\t\t\tuserId: e.userId,\n\t\t\treport: remoteReportsToShow\n\t\t});\n\n\t\tthis.runCallback(CallEvent.onUserStatsReceived, {\n\t\t\tuserId: this.userId,\n\t\t\treport: localReportsToShow\n\t\t});\n\n\t\tthis.runCallback(CallEvent.onRTCStatsReceived, e);\n\t};\n\n\t#onPeerRTCQualityChanged(e)\n\t{\n\t\tthis.runCallback(CallEvent.onConnectionQualityChanged, {\n\t\t\tuserId: e.userId,\n\t\t\tscore: e.score,\n\t\t});\n\t}\n\n\t#onParticipantJoined = (p) =>\n\t{\n\t\tclearTimeout(this.waitForAnswerTimeout);\n\t\tlet peer = this.peers[p.userId];\n\n\t\tif (!peer)\n\t\t{\n\t\t\tconst userId = parseInt(p.userId);\n\t\t\tif (!this.users.includes(userId))\n\t\t\t{\n\t\t\t\tthis.users.push(userId);\n\t\t\t}\n\n\t\t\tpeer = this.createPeer(userId)\n\t\t\tthis.peers[userId] = peer;\n\t\t}\n\n\t\tthis.runCallback(CallEvent.onUserJoined, {\n\t\t\tuserId: p.userId,\n\t\t\tuserData: {\n\t\t\t\t[p.userId]: {\n\t\t\t\t\tname: p.name,\n\t\t\t\t\tavatar_hr: p.image,\n\t\t\t\t\tavatar: p.image,\n\t\t\t\t},\n\t\t\t}\n\t\t});\n\n\t\tthis.peers[p.userId].setSignalingConnected(true);\n\t\tthis.peers[p.userId].setReady(true);\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.sendAllStreams(p.userId);\n\t\t}\n\t};\n\n\t#onParticipantLeaved = (p) =>\n\t{\n\t\tconst peer = this.peers[p.userId];\n\t\tif (peer)\n\t\t{\n\t\t\tpeer.disconnect();\n\t\t\tpeer.setReady(false);\n\n\t\t\tif (!this.isAnyoneParticipating() && this.ready)\n\t\t\t{\n\t\t\t\tthis.hangup();\n\t\t\t}\n\t\t}\n\t}\n\n\t#onCallMessageReceived = (e) =>\n\t{\n\t\tlet message;\n\n\t\ttry\n\t\t{\n\t\t\tmessage = JSON.parse(e.text);\n\t\t}\n\t\tcatch (err)\n\t\t{\n\t\t\tthis.log(\"Could not parse scenario message.\", err);\n\t\t\treturn;\n\t\t}\n\n\t\tconst eventName = message.eventName;\n\n\t\tif (eventName === clientEvents.connectionOffer)\n\t\t{\n\t\t\tthis.#onPullEventConnectionOffer(message);\n\t\t}\n\t\telse if (eventName === clientEvents.connectionAnswer)\n\t\t{\n\t\t\tthis.#onPullEventConnectionAnswer(message);\n\t\t}\n\t\telse if (eventName === clientEvents.negotiationNeeded)\n\t\t{\n\t\t\tthis.#onPullEventNegotiationNeeded(message);\n\t\t}\n\t\telse if (eventName === clientEvents.iceCandidate)\n\t\t{\n\t\t\tthis.#onPullEventIceCandidate(message);\n\t\t}\n\t\telse if (eventName === clientEvents.microphoneState)\n\t\t{\n\t\t\tthis.#onPullEventMicrophoneState(message);\n\t\t}\n\t\telse if (eventName === clientEvents.cameraState)\n\t\t{\n\t\t\tthis.#onPullEventCameraState(message);\n\t\t}\n\t\telse if (eventName === clientEvents.voiceStarted)\n\t\t{\n\t\t\tthis.#onPullEventVoiceStarted(message);\n\t\t}\n\t\telse if (eventName === clientEvents.voiceStopped)\n\t\t{\n\t\t\tthis.#onPullEventVoiceStopped(message);\n\t\t}\n\t\telse if (eventName === clientEvents.videoPaused)\n\t\t{\n\t\t\tthis.#onPullEventVideoPaused(message);\n\t\t}\n\t\telse if (eventName === clientEvents.recordState)\n\t\t{\n\t\t\tthis.#onPullEventRecordState(message);\n\t\t}\n\t\telse if (eventName === clientEvents.customMessage)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onCustomMessage, {\n\t\t\t\tmessage: message.message\n\t\t\t})\n\t\t}\n\t\telse if (eventName === clientEvents.usersInvited)\n\t\t{\n\t\t\tthis.#onPullEventUsersInvited(message);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.log(\"Unknown scenario event \" + eventName);\n\t\t}\n\t};\n\n\t#onCallReconnecting = () =>\n\t{\n\t\tthis._reconnectionEventCount++;\n\t\tthis.runCallback(CallEvent.onReconnecting, {\n\t\t\treconnectionEventCount: this._reconnectionEventCount,\n\t\t});\n\t};\n\n\t#onCallReconnected = () =>\n\t{\n\t\tthis._reconnectionEventCount = 0;\n\t\tthis.runCallback(CallEvent.onReconnected);\n\t};\n\n\t#onCallDisconnected = (e) =>\n\t{\n\t\tif (e?.leaveInformation?.reason === DisconnectReason.SecurityKeyChanged)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onCallFailure, { name: e.leaveInformation.reason });\n\t\t\treturn;\n\t\t}\n\n\t\tthis.destroy();\n\t}\n\n\t#onCallReconnectingFailed = (e, error) => {\n\t\tthis.runCallback(CallEvent.onReconnectingFailed, { error });\n\t};\n\n\t#onUnload()\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tthis.peers[userId].disconnect();\n\t\t}\n\t};\n\n\t#beforeLeaveCall(finishCall = false)\n\t{\n\t\tthis.removeCallEvents();\n\t\tif (this.CallApi)\n\t\t{\n\t\t\tthis.CallApi.hangup(finishCall);\n\t\t\tthis.CallApi = null;\n\t\t}\n\n\t\t// stop media streams\n\t\tthis.unsubscribeHardwareChanges();\n\t\tfor (let tag in this.localStreams)\n\t\t{\n\t\t\tif (this.localStreams[tag])\n\t\t\t{\n\t\t\t\tUtil.stopMediaStream(this.localStreams[tag]);\n\t\t\t\tthis.localStreams[tag] = null;\n\t\t\t}\n\t\t}\n\t\tif (this.prevMainStream)\n\t\t{\n\t\t\tUtil.stopMediaStream(this.prevMainStream);\n\t\t\tthis.prevMainStream = null;\n\t\t}\n\n\t\tif (this.voiceDetection)\n\t\t{\n\t\t\tthis.voiceDetection.destroy();\n\t\t\tthis.voiceDetection = null;\n\t\t}\n\n\t\t// remove all event listeners\n\t\twindow.removeEventListener(\"unload\", this._onUnloadHandler);\n\n\t\tclearInterval(this.statsInterval);\n\t\tclearInterval(this.microphoneLevelInterval);\n\t};\n\n\tdestroy(finishCall)\n\t{\n\t\tthis.ready = false;\n\t\tconst tempError = new Error();\n\t\ttempError.name = \"Call stack:\";\n\t\tthis.log(\"Call destroy \\n\" + tempError.stack);\n\n\t\t// stop sending media streams\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId].destroy();\n\t\t\t}\n\t\t}\n\n\t\tthis.#beforeLeaveCall(finishCall);\n\t\tthis.runCallback(CallEvent.onLeave, { local: true });\n\n\t\treturn super.destroy();\n\t}\n}\n\nclass Signaling\n{\n\tconstructor(params)\n\t{\n\t\tthis.call = params.call;\n\t};\n\n\tisIceTricklingAllowed()\n\t{\n\t\treturn CallEngine.getPullClient().isPublishingSupported();\n\t};\n\n\tsendUsersInvited(data)\n\t{\n\t\tthis.#sendMessage(clientEvents.usersInvited, data);\n\t};\n\n\tsendConnectionOffer(data)\n\t{\n\t\treturn this.#sendMessage(clientEvents.connectionOffer, data);\n\t};\n\n\tsendConnectionAnswer(data)\n\t{\n\t\treturn this.#sendMessage(clientEvents.connectionAnswer, data);\n\t};\n\n\tsendIceCandidate(data)\n\t{\n\t\treturn this.#sendMessage(clientEvents.iceCandidate, data);\n\t};\n\n\tsendNegotiationNeeded(data)\n\t{\n\t\treturn this.#sendMessage(clientEvents.negotiationNeeded, data);\n\t};\n\n\tsendVoiceStarted(data)\n\t{\n\t\treturn this.#sendMessage(clientEvents.voiceStarted, data);\n\t};\n\n\tsendVoiceStopped(data)\n\t{\n\t\treturn this.#sendMessage(clientEvents.voiceStopped, data);\n\t};\n\n\tsendMicrophoneState(users, microphoneState)\n\t{\n\t\treturn this.#sendMessage(clientEvents.microphoneState, {\n\t\t\tuserId: users,\n\t\t\tmicrophoneState: microphoneState\n\t\t});\n\t};\n\n\tsendCameraState(users, cameraState)\n\t{\n\t\treturn this.#sendMessage(clientEvents.cameraState, {\n\t\t\tuserId: users,\n\t\t\tcameraState: cameraState\n\t\t});\n\t};\n\n\tsendVideoPaused(users, videoPaused)\n\t{\n\t\treturn this.#sendMessage(clientEvents.videoPaused, {\n\t\t\tuserId: users,\n\t\t\tvideoPaused: videoPaused\n\t\t});\n\t};\n\n\tsendRecordState(users, recordState)\n\t{\n\t\treturn this.#sendMessage(clientEvents.recordState, {\n\t\t\tuserId: users,\n\t\t\trecordState: recordState\n\t\t});\n\t};\n\n\tsendCustomMessage(data)\n\t{\n\t\treturn this.#sendMessage(clientEvents.customMessage, data);\n\t};\n\n\t#sendMessage(eventName, data)\n\t{\n\t\tif (!this.call.CallApi)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!Type.isPlainObject(data))\n\t\t{\n\t\t\tdata = {};\n\t\t}\n\n\t\tdata.eventName = eventName;\n\t\tdata.requestId = Util.getUuidv4();\n\t\tdata.senderId = this.call.userId;\n\n\t\tthis.call.CallApi.send1to1Info(JSON.stringify(data));\n\t};\n\n\t#runRestAction(signalName, data)\n\t{\n\t\tif (!Type.isPlainObject(data))\n\t\t{\n\t\t\tdata = {};\n\t\t}\n\n\t\tdata.callUuid = this.call.uuid;\n\t\tdata.callInstanceId = this.call.instanceId;\n\t\tdata.requestId = Util.getUuidv4();\n\n\t\tthis.call.log('Sending ajax-based signaling event ' + signalName + '; ' + JSON.stringify(data));\n\t\treturn CallEngine.getRestClient().callMethod(signalName, data).catch(function (e) {console.error(e)});\n\t};\n}\n\nclass Peer\n{\n\tcall: PlainCall\n\tpeerConnection: ?RTCPeerConnection\n\tpeerConnectionId: ?string\n\tvideoSender: ?RTCRtpSender\n\taudioSender: ?RTCRtpSender\n\tscreenSender: ?RTCRtpSender\n\tscreenAudioSender: ?RTCRtpSender\n\tcalculatedState: string\n\n\tconstructor(params)\n\t{\n\t\tthis.call = params.call;\n\t\tthis.userId = params.userId;\n\n\t\tthis.ready = params.ready === true;\n\t\tthis.calling = false;\n\t\tthis.inviteTimeout = false;\n\t\tthis.declined = false;\n\t\tthis.busy = false;\n\t\tthis.signalingConnected = params.signalingConnected === true;\n\t\tthis.failureReason = '';\n\n\t\tthis.userAgent = '';\n\t\tthis.isFirefox = false;\n\t\tthis.isChrome = false;\n\t\tthis.isLegacyMobile = params.isLegacyMobile === true;\n\n\t\t/*sums up from signaling, ready and connection states*/\n\t\tthis.calculatedState = this.calculateState();\n\n\t\tthis.localStreams = {\n\t\t\tmain: null,\n\t\t\tscreen: null\n\t\t};\n\n\t\tthis.pendingIceCandidates = {};\n\t\tthis.localIceCandidates = [];\n\n\t\tthis.trackList = {};\n\n\t\tthis.callbacks = {\n\t\t\tonStateChanged: Type.isFunction(params.onStateChanged) ? params.onStateChanged : BX.DoNothing,\n\t\t\tonInviteTimeout: Type.isFunction(params.onInviteTimeout) ? params.onInviteTimeout : BX.DoNothing,\n\t\t\tonMediaReceived: Type.isFunction(params.onMediaReceived) ? params.onMediaReceived : BX.DoNothing,\n\t\t\tonMediaStopped: Type.isFunction(params.onMediaStopped) ? params.onMediaStopped : BX.DoNothing,\n\t\t\tonRTCStatsReceived: Type.isFunction(params.onRTCStatsReceived) ? params.onRTCStatsReceived : BX.DoNothing,\n\t\t\tonRTCQualityChanged: Type.isFunction(params.onRTCQualityChanged) ? params.onRTCQualityChanged : BX.DoNothing,\n\t\t\tonNetworkProblem: Type.isFunction(params.onNetworkProblem) ? params.onNetworkProblem : BX.DoNothing,\n\t\t\tonReconnecting: Type.isFunction(params.onReconnecting) ? params.onReconnecting : BX.DoNothing,\n\t\t\tonReconnected: Type.isFunction(params.onReconnected) ? params.onReconnected : BX.DoNothing,\n\t\t\tonUpdateLastUsedCameraId: Type.isFunction(params.onUpdateLastUsedCameraId) ? params.onUpdateLastUsedCameraId : BX.DoNothing,\n\t\t};\n\n\t\t// intervals and timeouts\n\t\tthis.answerTimeout = null;\n\t\tthis.callingTimeout = null;\n\t\tthis.connectionTimeout = null;\n\t\tthis.signalingConnectionTimeout = null;\n\t\tthis.candidatesTimeout = null;\n\n\t\tthis.statsInterval = null;\n\n\t\tthis.connectionOfferReplyTimeout = null;\n\t\tthis.negotiationNeededReplyTimeout = null;\n\t\tthis.reconnectAfterDisconnectTimeout = null;\n\n\t\tthis.connectionAttempt = 0;\n\t\tthis.hasStun = false;\n\t\tthis.hasTurn = false;\n\n\t\tthis._outgoingVideoTrack = null;\n\t\tObject.defineProperty(this, 'outgoingVideoTrack', {\n\t\t\tget: function ()\n\t\t\t{\n\t\t\t\treturn this._outgoingVideoTrack;\n\t\t\t},\n\t\t\tset: function (track)\n\t\t\t{\n\t\t\t\tif (this._outgoingVideoTrack)\n\t\t\t\t{\n\t\t\t\t\tthis._outgoingVideoTrack.stop();\n\t\t\t\t}\n\t\t\t\tthis._outgoingVideoTrack = track;\n\t\t\t\tif (this._outgoingVideoTrack)\n\t\t\t\t{\n\t\t\t\t\tthis._outgoingVideoTrack.enabled = !this.outgoingVideoHoldState;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis._outgoingScreenTrack = null;\n\t\tObject.defineProperty(this, 'outgoingScreenTrack', {\n\t\t\tget: function ()\n\t\t\t{\n\t\t\t\treturn this._outgoingScreenTrack;\n\t\t\t},\n\t\t\tset: function (track)\n\t\t\t{\n\t\t\t\tif (this._outgoingScreenTrack)\n\t\t\t\t{\n\t\t\t\t\tthis._outgoingScreenTrack.stop();\n\t\t\t\t}\n\t\t\t\tthis._outgoingScreenTrack = track;\n\t\t\t\tif (this._outgoingScreenTrack)\n\t\t\t\t{\n\t\t\t\t\tthis._outgoingScreenTrack.enabled = !this.outgoingVideoHoldState;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis._incomingAudioTrack = null;\n\t\tthis._incomingScreenAudioTrack = null;\n\t\tthis._incomingVideoTrack = null;\n\t\tthis._incomingScreenTrack = null;\n\t\tObject.defineProperty(this, 'incomingAudioTrack', {\n\t\t\tget: this._mediaGetter('_incomingAudioTrack'),\n\t\t\tset: this._mediaSetter('_incomingAudioTrack', 'audio')\n\t\t});\n\t\tObject.defineProperty(this, 'incomingVideoTrack', {\n\t\t\tget: this._mediaGetter('_incomingVideoTrack'),\n\t\t\tset: this._mediaSetter('_incomingVideoTrack', 'video')\n\t\t});\n\t\tObject.defineProperty(this, 'incomingScreenTrack', {\n\t\t\tget: this._mediaGetter('_incomingScreenTrack'),\n\t\t\tset: this._mediaSetter('_incomingScreenTrack', 'screen')\n\t\t});\n\t\tObject.defineProperty(this, 'incomingScreenAudioTrack', {\n\t\t\tget: this._mediaGetter('_incomingScreenAudioTrack'),\n\t\t\tset: this._mediaSetter('_incomingScreenAudioTrack', 'sharingAudio')\n\t\t});\n\n\t\tthis.outgoingVideoHoldState = false;\n\n\t\t// event handlers\n\t\tthis._onPeerConnectionIceCandidateHandler = this._onPeerConnectionIceCandidate.bind(this);\n\t\tthis._onPeerConnectionConnectionStateChangeHandler = this.#onPeerConnectionConnectionStateChange.bind(this);\n\t\tthis._onPeerConnectionIceGatheringStateChangeHandler = this.#onPeerConnectionIceGatheringStateChange.bind(this);\n\t\tthis._onPeerConnectionSignalingStateChangeHandler = this.#onPeerConnectionSignalingStateChange.bind(this);\n\t\t//this._onPeerConnectionNegotiationNeededHandler = this._onPeerConnectionNegotiationNeeded.bind(this);\n\t\tthis._onPeerConnectionTrackHandler = this.#onPeerConnectionTrack.bind(this);\n\t\tthis._onPeerConnectionRemoveStreamHandler = this.#onPeerConnectionRemoveStream.bind(this);\n\n\t\tthis._updateTracksDebounced = Runtime.debounce(this.#updateTracks.bind(this), 50);\n\n\t\tthis._waitTurnCandidatesTimeout = null;\n\n\t\tthis.prevPercentPacketLostList = {\n\t\t\tincomingPacketLost: [],\n\t\t\toutgoingPacketLost: [],\n\t\t};\n\t\tthis.reportsForIncomingTracks = {};\n\t\tthis.reportsForOutgoingTracks = {};\n\t\tthis.packetLostThreshold = 7;\n\t\tthis.videoBitrate = 1000000;\n\t\tthis.screenShareBitrate = 1500000;\n\t\tthis.maxConnectionScore = 5;\n\t\tthis.incomingConnectionScore = 0;\n\t\tthis.outgoingConnectionScore = 0;\n\t};\n\n\t_mediaGetter(trackVariable)\n\t{\n\t\treturn function ()\n\t\t{\n\t\t\treturn this[trackVariable]\n\t\t}.bind(this)\n\t};\n\n\t_mediaSetter(trackVariable, kind)\n\t{\n\t\treturn function (track)\n\t\t{\n\t\t\tif (this[trackVariable] != track)\n\t\t\t{\n\t\t\t\tthis[trackVariable] = track;\n\t\t\t\tif (track)\n\t\t\t\t{\n\t\t\t\t\tthis.callbacks.onMediaReceived({\n\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\tkind: kind,\n\t\t\t\t\t\ttrack: track\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.callbacks.onMediaStopped({\n\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\tkind: kind\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t}.bind(this)\n\t};\n\n\tsendMedia(skipOffer)\n\t{\n\t\tif (!this.peerConnection)\n\t\t{\n\t\t\tif (!this.isInitiator())\n\t\t\t{\n\t\t\t\tthis.log('waiting for the other side to send connection offer');\n\t\t\t\tthis.sendNegotiationNeeded(false);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (!this.peerConnection)\n\t\t{\n\t\t\tconst connectionId = Util.getUuidv4();\n\t\t\tthis.#createPeerConnection(connectionId);\n\t\t}\n\t\tthis.updateOutgoingTracks();\n\n\t\tif (!skipOffer)\n\t\t{\n\t\t\tthis.applyResolutionScale();\n\t\t\tthis.createAndSendOffer();\n\t\t}\n\t};\n\n\tupdateOutgoingTracks()\n\t{\n\t\tif (!this.peerConnection)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet audioTrack;\n\t\tlet videoTrack;\n\t\tlet screenTrack;\n\t\tlet screenAudioTrack;\n\n\t\tif (this.call.localStreams[\"main\"] && this.call.localStreams[\"main\"].getAudioTracks().length > 0 && this.call.localStreams[\"main\"].getAudioTracks()[0]?.readyState === 'live')\n\t\t{\n\t\t\taudioTrack = this.call.localStreams[\"main\"].getAudioTracks()[0];\n\t\t}\n\t\tif (this.call.localStreams[\"screen\"] && this.call.localStreams[\"screen\"].getVideoTracks().length > 0)\n\t\t{\n\t\t\tscreenTrack = this.call.localStreams[\"screen\"].getVideoTracks()[0];\n\t\t}\n\t\tif (this.call.localStreams[\"screen\"] && this.call.localStreams[\"screen\"].getAudioTracks().length > 0)\n\t\t{\n\t\t\tscreenAudioTrack = this.call.localStreams[\"screen\"].getAudioTracks()[0];\n\t\t}\n\t\tif (this.call.localStreams[\"main\"] && this.call.localStreams[\"main\"].getVideoTracks().length > 0 && this.call.localStreams[\"main\"].getVideoTracks()[0]?.readyState === 'live')\n\t\t{\n\t\t\tvideoTrack = this.call.localStreams[\"main\"].getVideoTracks()[0];\n\t\t}\n\n\t\tthis.outgoingVideoTrack = videoTrack ? videoTrack.clone() : null;\n\t\tthis.outgoingScreenTrack = screenTrack ? screenTrack.clone() : null;\n\n\t\tlet tracksToSend = [];\n\t\tif (audioTrack)\n\t\t{\n\t\t\ttracksToSend.push(audioTrack.id + ' (audio)');\n\t\t}\n\t\tif (screenAudioTrack)\n\t\t{\n\t\t\ttracksToSend.push(screenAudioTrack.id + ' (sharingAudio)');\n\t\t}\n\t\tif (videoTrack)\n\t\t{\n\t\t\ttracksToSend.push(videoTrack.id + ' (' + videoTrack.kind + ')');\n\t\t}\n\t\tif (screenTrack)\n\t\t{\n\t\t\ttracksToSend.push(screenTrack.id + ' (' + screenTrack.kind + ')');\n\t\t}\n\n\t\tconsole.log(\"User: \" + this.userId + '; Sending media streams. Tracks: ' + tracksToSend.join('; '));\n\n\t\t// if video sender found - replace track\n\t\t// if not found - add track\n\t\tif (this.videoSender && this.outgoingVideoTrack)\n\t\t{\n\t\t\tthis.videoSender.replaceTrack(this.outgoingVideoTrack);\n\t\t}\n\t\tif (!this.videoSender && this.outgoingVideoTrack)\n\t\t{\n\t\t\tthis.videoSender = this.peerConnection.addTrack(this.outgoingVideoTrack);\n\t\t}\n\t\tif (this.videoSender && !this.outgoingVideoTrack)\n\t\t{\n\t\t\tthis.peerConnection.removeTrack(this.videoSender);\n\t\t\tthis.videoSender = null;\n\t\t}\n\n\t\t// if screen sender found - replace track\n\t\t// if not found - add track\n\t\tif (this.screenSender && this.outgoingScreenTrack)\n\t\t{\n\t\t\tthis.screenSender.replaceTrack(this.outgoingScreenTrack);\n\t\t}\n\t\tif (!this.screenSender && this.outgoingScreenTrack)\n\t\t{\n\t\t\tthis.screenSender = this.peerConnection.addTrack(this.outgoingScreenTrack);\n\t\t}\n\t\tif (this.screenSender && !this.outgoingScreenTrack)\n\t\t{\n\t\t\tthis.peerConnection.removeTrack(this.screenSender);\n\t\t\tthis.screenSender = null;\n\t\t}\n\n\t\t// if screen sender audio found - replace track\n\t\t// if not found - add track\n\t\tif (this.screenAudioSender && screenAudioTrack)\n\t\t{\n\t\t\tthis.screenAudioSender.replaceTrack(screenAudioTrack);\n\t\t}\n\t\tif (!this.screenAudioSender && screenAudioTrack)\n\t\t{\n\t\t\tthis.screenAudioSender = this.peerConnection.addTrack(screenAudioTrack);\n\t\t}\n\t\tif (this.screenAudioSender && !screenAudioTrack)\n\t\t{\n\t\t\tthis.peerConnection.removeTrack(this.screenAudioSender);\n\t\t\tthis.screenAudioSender = null;\n\t\t}\n\n\t\t// if audio sender found - replace track\n\t\t// if not found - add track\n\t\tif (this.audioSender && audioTrack)\n\t\t{\n\t\t\tthis.audioSender.replaceTrack(audioTrack);\n\t\t}\n\t\tif (!this.audioSender && audioTrack)\n\t\t{\n\t\t\tthis.audioSender = this.peerConnection.addTrack(audioTrack);\n\t\t}\n\t\tif (this.audioSender && !audioTrack)\n\t\t{\n\t\t\tthis.peerConnection.removeTrack(this.audioSender);\n\t\t\tthis.audioSender = null;\n\t\t}\n\t};\n\n\tgetSenderMid(rtpSender: RTCRtpSender): string\n\t{\n\t\tif (!rtpSender || !this.peerConnection)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\tconst transceiver = this.peerConnection.getTransceivers().find(transceiver => {\n\t\t\tif (transceiver.sender.track && rtpSender.track)\n\t\t\t{\n\t\t\t\treturn transceiver.sender.track.id === rtpSender.track.id\n\t\t\t}\n\t\t\treturn false\n\t\t});\n\n\t\treturn transceiver ? transceiver.mid : null;\n\t};\n\n\tapplyResolutionScale(factor)\n\t{\n\t\tif (this.videoSender)\n\t\t{\n\t\t\tconst scaleFactor = factor || (this.screenSender ? 2 : 1);\n\t\t\tconst rate = this.videoBitrate / scaleFactor;\n\t\t\tconst videoParams = this.videoSender.getParameters();\n\n\t\t\tif (videoParams.encodings && videoParams.encodings.length > 0)\n\t\t\t{\n\t\t\t\tvideoParams.encodings[0].scaleResolutionDownBy = scaleFactor;\n\t\t\t\tvideoParams.encodings[0].maxBitrate = rate;\n\t\t\t\tthis.videoSender.setParameters(videoParams);\n\t\t\t}\n\t\t}\n\n\t\tif (this.screenSender)\n\t\t{\n\t\t\tconst screenParams = this.screenSender.getParameters();\n\t\t\tif (screenParams.encodings && screenParams.encodings.length > 0)\n\t\t\t{\n\t\t\t\tscreenParams.encodings[0].maxBitrate = this.screenShareBitrate;\n\t\t\t\tthis.screenSender.setParameters(screenParams);\n\t\t\t}\n\t\t}\n\t};\n\n\treplaceMediaStream(tag: string)\n\t{\n\t\tif (this.isRenegotiationSupported())\n\t\t{\n\t\t\tthis.sendMedia();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.localStreams[tag] = this.call.getLocalStream(tag);\n\t\t\tthis.reconnect();\n\t\t}\n\t};\n\n\tholdOutgoingVideo(holdState)\n\t{\n\t\tif (this.outgoingVideoHoldState == holdState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.outgoingVideoHoldState = holdState;\n\t\tif (this._outgoingVideoTrack)\n\t\t{\n\t\t\tthis._outgoingVideoTrack.enabled = !this.outgoingVideoHoldState;\n\t\t}\n\t};\n\n\tisInitiator()\n\t{\n\t\treturn this.call.userId < this.userId;\n\t};\n\n\tisRenegotiationSupported()\n\t{\n\t\treturn true;\n\t\t// return (Browser.isChrome() && this.isChrome);\n\t};\n\n\tsetReady(ready)\n\t{\n\t\tthis.ready = ready;\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.declined = false;\n\t\t\tthis.busy = false;\n\t\t}\n\t\tif (this.calling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t}\n\t\tthis.updateCalculatedState();\n\t};\n\n\tisReady()\n\t{\n\t\treturn this.ready;\n\t};\n\n\tonInvited()\n\t{\n\t\tthis.ready = false;\n\t\tthis.inviteTimeout = false;\n\t\tthis.declined = false;\n\t\tthis.calling = true;\n\n\t\tif (this.callingTimeout)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t}\n\t\tthis.callingTimeout = setTimeout(function ()\n\t\t{\n\t\t\tthis.onInviteTimeout(true);\n\t\t}.bind(this), invitePeriod);\n\t\tthis.updateCalculatedState();\n\t};\n\n\tonInviteTimeout(internal)\n\t{\n\t\tclearTimeout(this.callingTimeout);\n\t\tthis.calling = false;\n\t\tthis.inviteTimeout = true;\n\t\tif (internal)\n\t\t{\n\t\t\tthis.callbacks.onInviteTimeout({\n\t\t\t\tuserId: this.userId\n\t\t\t});\n\t\t}\n\t\tthis.updateCalculatedState();\n\t};\n\n\tsetUserAgent(userAgent)\n\t{\n\t\tthis.userAgent = userAgent;\n\t\tthis.isFirefox = userAgent.toLowerCase().indexOf('firefox') != -1;\n\t\tthis.isChrome = userAgent.toLowerCase().indexOf('chrome') != -1;\n\t\tthis.isLegacyMobile = userAgent === 'Bitrix Legacy Mobile';\n\t};\n\n\tgetUserAgent()\n\t{\n\t\treturn this.userAgent;\n\t};\n\n\tisParticipating()\n\t{\n\t\tif (this.calling)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (this.declined || this.busy)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.peerConnection)\n\t\t{\n\t\t\t// todo: maybe we should check iceConnectionState as well.\n\t\t\tconst iceConnectionState = this.peerConnection.iceConnectionState;\n\t\t\tif (iceConnectionState == 'checking' || iceConnectionState == 'connected' || iceConnectionState == 'completed')\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t};\n\n\tsetSignalingConnected(signalingConnected)\n\t{\n\t\tthis.signalingConnected = signalingConnected;\n\t\tthis.updateCalculatedState();\n\n\t\tif (this.signalingConnected)\n\t\t{\n\t\t\tthis.refreshSignalingTimeout();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.stopSignalingTimeout();\n\t\t}\n\t};\n\n\tisSignalingConnected()\n\t{\n\t\treturn this.signalingConnected;\n\t};\n\n\tsetDeclined(declined)\n\t{\n\t\tthis.declined = declined;\n\t\tif (this.calling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t}\n\t\tthis.updateCalculatedState();\n\t};\n\n\tsetBusy(busy)\n\t{\n\t\tthis.busy = busy;\n\t\tif (this.calling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t}\n\t\tthis.updateCalculatedState();\n\t};\n\n\tisDeclined()\n\t{\n\t\treturn this.declined;\n\t};\n\n\tupdateCalculatedState()\n\t{\n\t\tconst calculatedState = this.calculateState();\n\n\t\tif (this.calculatedState != calculatedState)\n\t\t{\n\t\t\tthis.callbacks.onStateChanged({\n\t\t\t\tuserId: this.userId,\n\t\t\t\tstate: calculatedState,\n\t\t\t\tpreviousState: this.calculatedState,\n\t\t\t\tisLegacyMobile: this.isLegacyMobile,\n\t\t\t\tnetworkProblem: !this.hasStun || !this.hasTurn\n\t\t\t});\n\t\t\tthis.calculatedState = calculatedState;\n\t\t}\n\t};\n\n\tcalculateState()\n\t{\n\t\tif (this.peerConnection)\n\t\t{\n\t\t\tif (this.failureReason !== '')\n\t\t\t{\n\t\t\t\treturn UserState.Failed;\n\t\t\t}\n\n\t\t\tif (this.peerConnection.iceConnectionState === 'connected' || this.peerConnection.iceConnectionState === 'completed')\n\t\t\t{\n\t\t\t\treturn UserState.Connected;\n\t\t\t}\n\n\t\t\treturn UserState.Connecting;\n\t\t}\n\n\t\tif (this.calling)\n\t\t{\n\t\t\treturn UserState.Calling;\n\t\t}\n\n\t\tif (this.inviteTimeout)\n\t\t{\n\t\t\treturn UserState.Unavailable;\n\t\t}\n\n\t\tif (this.declined)\n\t\t{\n\t\t\treturn UserState.Declined;\n\t\t}\n\n\t\tif (this.busy)\n\t\t{\n\t\t\treturn UserState.Busy;\n\t\t}\n\n\t\tif (this.ready)\n\t\t{\n\t\t\treturn UserState.Ready;\n\t\t}\n\n\t\treturn UserState.Idle;\n\t};\n\n\tgetSignaling()\n\t{\n\t\treturn this.call.signaling;\n\t};\n\n\tstartStatisticsGathering()\n\t{\n\t\tclearInterval(this.statsInterval);\n\n\t\tthis.statsInterval = setInterval(function ()\n\t\t{\n\t\t\tif (!this.peerConnection)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.peerConnection.getStats().then(function (stats)\n\t\t\t{\n\t\t\t\t// stats gathering in new format like in the Bitrix24 calls\n\t\t\t\tconst statsOutput = [];\n\t\t\t\tconst codecs = {};\n\t\t\t\tconst reportsWithoutCodecs = {};\n\t\t\t\tconst remoteReports = {};\n\t\t\t\tconst reportsWithoutRemoteInfo = {};\n\t\t\t\tlet incomingDataLoss = 0;\n\t\t\t\tlet outgoingDataLoss = 0;\n\n\t\t\t\tstats.forEach((report) => {\n\t\t\t\t\tstatsOutput.push(report);\n\n\t\t\t\t\tconst needCheckInputPacketLost = (report?.trackIdentifier\n\t\t\t\t\t\t&& report?.type === 'inbound-rtp'\n\t\t\t\t\t\t&& report.hasOwnProperty('packetsLost')\n\t\t\t\t\t\t&& report.hasOwnProperty('packetsReceived'));\n\n\t\t\t\t\tif (needCheckInputPacketLost || report.type === 'outbound-rtp')\n\t\t\t\t\t{\n\t\t\t\t\t\tswitch (this.trackList[report.mid])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcase 'video':\n\t\t\t\t\t\t\t\treport.source = MediaStreamsKinds.Camera;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'screen':\n\t\t\t\t\t\t\t\treport.source = MediaStreamsKinds.Screen;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'audio':\n\t\t\t\t\t\t\t\treport.source = MediaStreamsKinds.Microphone;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (needCheckInputPacketLost)\n\t\t\t\t\t{\n\t\t\t\t\t\treport.bitrate = Util.calcBitrate(report, this.reportsForIncomingTracks[report.source]);\n\t\t\t\t\t\tconst packetsLostData = Util.calcRemotePacketsLost(report, this.reportsForIncomingTracks[report.source]);\n\t\t\t\t\t\treport.packetsLostExtended = Util.formatPacketsLostData(packetsLostData);\n\t\t\t\t\t\tif (!Util.setCodecToReport(report, codecs, reportsWithoutCodecs))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tUtil.saveReportWithoutCodecs(report, reportsWithoutCodecs);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.reportsForIncomingTracks[report.source] = report;\n\n\t\t\t\t\t\tif (report.source === MediaStreamsKinds.Camera)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tincomingDataLoss = packetsLostData.currentPercentPacketLost;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (report.type === 'codec')\n\t\t\t\t\t{\n\t\t\t\t\t\tUtil.processReportsWithoutCodecs(report, codecs, reportsWithoutCodecs);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (report.type === 'remote-inbound-rtp')\n\t\t\t\t\t{\n\t\t\t\t\t\tconst reportId = report.localId;\n\t\t\t\t\t\tif (reportsWithoutRemoteInfo[reportId])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst packetsLostData = Util.calcLocalPacketsLost(reportsWithoutRemoteInfo[reportId], this.reportsForOutgoingTracks[reportId], report);\n\t\t\t\t\t\t\treportsWithoutRemoteInfo[reportId].packetsLostData = packetsLostData;\n\t\t\t\t\t\t\treportsWithoutRemoteInfo[reportId].packetsLost = packetsLostData.totalPacketsLost;\n\t\t\t\t\t\t\treportsWithoutRemoteInfo[reportId].packetsLostExtended = Util.formatPacketsLostData(packetsLostData);\n\t\t\t\t\t\t\tthis.reportsForOutgoingTracks[reportId] = reportsWithoutRemoteInfo[reportId];\n\t\t\t\t\t\t\tdelete reportsWithoutRemoteInfo[reportId];\n\n\t\t\t\t\t\t\tif (this.reportsForOutgoingTracks[reportId].source === MediaStreamsKinds.Camera)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\toutgoingDataLoss = report.packetsLost;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tremoteReports[reportId] = report;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (report.type === 'outbound-rtp')\n\t\t\t\t\t{\n\t\t\t\t\t\treport.bitrate = Util.calcBitrate(report, this.reportsForOutgoingTracks[report.id], true);\n\t\t\t\t\t\treport.userId = this.call.userId;\n\n\t\t\t\t\t\tif (!Util.setCodecToReport(report, codecs, reportsWithoutCodecs))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tUtil.saveReportWithoutCodecs(report, reportsWithoutCodecs);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (Util.setLocalPacketsLostOrSaveReport(report, remoteReports, reportsWithoutRemoteInfo))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.reportsForOutgoingTracks[report.id] = report;\n\t\t\t\t\t\t\tif (report.source === MediaStreamsKinds.Camera)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\toutgoingDataLoss = report.packetsLostData.currentPercentPacketLost;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (this.prevPercentPacketLostList.incomingPacketLost.push(incomingDataLoss) > 10)\n\t\t\t\t{\n\t\t\t\t\tthis.prevPercentPacketLostList.incomingPacketLost.shift();\n\t\t\t\t}\n\n\t\t\t\tconst newIncomingConnectionDataLoss = this.prevPercentPacketLostList.incomingPacketLost.reduce(\n\t\t\t\t\t(acc, number) => acc + number, 0\n\t\t\t\t) / this.prevPercentPacketLostList.incomingPacketLost.length;\n\t\t\t\tconst newIncomingConnectionScore = this.calcNewConnectionScore(newIncomingConnectionDataLoss);\n\t\t\t\tif (!this.incomingConnectionScore || this.incomingConnectionScore !== newIncomingConnectionScore)\n\t\t\t\t{\n\t\t\t\t\tthis.incomingConnectionScore = newIncomingConnectionScore;\n\t\t\t\t\tthis.callbacks.onRTCQualityChanged({\n\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\tscore: this.incomingConnectionScore\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (this.prevPercentPacketLostList.outgoingPacketLost.push(outgoingDataLoss) > 10)\n\t\t\t\t{\n\t\t\t\t\tthis.prevPercentPacketLostList.outgoingPacketLost.shift();\n\t\t\t\t}\n\n\t\t\t\tconst newOutgoingConnectionDataLoss = this.prevPercentPacketLostList.outgoingPacketLost.reduce(\n\t\t\t\t\t(acc, number) => acc + number, 0\n\t\t\t\t) / this.prevPercentPacketLostList.outgoingPacketLost.length;\n\t\t\t\tconst newOutgoingConnectionScore = this.calcNewConnectionScore(newOutgoingConnectionDataLoss);\n\t\t\t\tif (!this.outgoingConnectionScore || this.outgoingConnectionScore !== newOutgoingConnectionScore)\n\t\t\t\t{\n\t\t\t\t\tthis.outgoingConnectionScore = newOutgoingConnectionScore;\n\t\t\t\t\tthis.callbacks.onRTCQualityChanged({\n\t\t\t\t\t\tuserId: this.call.userId,\n\t\t\t\t\t\tscore: this.outgoingConnectionScore\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tthis.callbacks.onRTCStatsReceived({\n\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\tstats: statsOutput\n\t\t\t\t});\n\t\t\t}.bind(this));\n\t\t}.bind(this), 1000);\n\t};\n\n\tcalcNewConnectionScore(dataLoss)\n\t{\n\t\tlet connectionQuality;\n\t\tif (dataLoss < 10)\n\t\t{\n\t\t\tconnectionQuality = 4;\n\t\t}\n\n\t\tif (dataLoss > 10 && dataLoss <= 20)\n\t\t{\n\t\t\tconnectionQuality = 3;\n\t\t}\n\n\t\tif (dataLoss > 20 && dataLoss <= 30)\n\t\t{\n\t\t\tconnectionQuality = 2;\n\t\t}\n\n\t\tif (dataLoss > 30)\n\t\t{\n\t\t\tconnectionQuality = 1;\n\t\t}\n\n\t\treturn connectionQuality;\n\t}\n\n\tstopStatisticsGathering()\n\t{\n\t\tclearInterval(this.statsInterval);\n\t\tthis.statsInterval = null;\n\t};\n\n\tupdateCandidatesTimeout()\n\t{\n\t\tif (this.candidatesTimeout)\n\t\t{\n\t\t\tclearTimeout(this.candidatesTimeout);\n\t\t}\n\n\t\tthis.candidatesTimeout = setTimeout(this.sendIceCandidates.bind(this), 500);\n\t};\n\n\tsendIceCandidates()\n\t{\n\t\tthis.log(\"User \" + this.userId + \": sending ICE candidates due to the timeout\");\n\n\t\tthis.candidatesTimeout = null;\n\t\tif (this.localIceCandidates.length > 0)\n\t\t{\n\t\t\tthis.getSignaling().sendIceCandidate({\n\t\t\t\tuserId: this.userId,\n\t\t\t\tconnectionId: this.peerConnectionId,\n\t\t\t\tcandidates: this.localIceCandidates\n\t\t\t});\n\t\t\tthis.localIceCandidates = [];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.log(\"User \" + this.userId + \": ICE candidates pool is empty\");\n\t\t}\n\t};\n\n\t#createPeerConnection(id)\n\t{\n\t\tthis.log(\"User \" + this.userId + \": Creating peer connection\");\n\t\tconst connectionConfig = {\n\t\t\t\"iceServers\": [\n\t\t\t\t{\n\t\t\t\t\turls: \"stun:\" + this.call.turnServer\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\turls: \"turn:\" + this.call.turnServer,\n\t\t\t\t\tusername: this.call.turnServerLogin,\n\t\t\t\t\tcredential: this.call.turnServerPassword\n\t\t\t\t}\n\t\t\t],\n\t\t\t// iceTransportPolicy: 'relay'\n\t\t};\n\n\t\tthis.localIceCandidates = [];\n\t\tthis.peerConnection = new RTCPeerConnection(connectionConfig);\n\t\tthis.peerConnectionId = id;\n\n\t\tthis.peerConnection.addEventListener(\"icecandidate\", this._onPeerConnectionIceCandidateHandler);\n\t\tthis.peerConnection.addEventListener(\"connectionstatechange\", this._onPeerConnectionConnectionStateChangeHandler);\n\t\tthis.peerConnection.addEventListener(\"icegatheringstatechange\", this._onPeerConnectionIceGatheringStateChangeHandler);\n\t\tthis.peerConnection.addEventListener(\"signalingstatechange\", this._onPeerConnectionSignalingStateChangeHandler);\n\t\t// this.peerConnection.addEventListener(\"negotiationneeded\", this._onPeerConnectionNegotiationNeededHandler);\n\t\tthis.peerConnection.addEventListener(\"track\", this._onPeerConnectionTrackHandler);\n\t\tthis.peerConnection.addEventListener(\"removestream\", this._onPeerConnectionRemoveStreamHandler);\n\n\t\tthis.failureReason = '';\n\t\tthis.hasStun = false;\n\t\tthis.hasTurn = false;\n\t\tthis.updateCalculatedState();\n\n\t\tthis.startStatisticsGathering();\n\t};\n\n\t_destroyPeerConnection()\n\t{\n\t\tif (!this.peerConnection)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tclearTimeout(this.reconnectAfterDisconnectTimeout);\n\n\t\tthis.log(\"User \" + this.userId + \": Destroying peer connection \" + this.peerConnectionId);\n\t\tthis.stopStatisticsGathering();\n\n\t\tthis.peerConnection.removeEventListener(\"icecandidate\", this._onPeerConnectionIceCandidateHandler);\n\t\tthis.peerConnection.removeEventListener(\"connectionstatechange\", this._onPeerConnectionConnectionStateChangeHandler);\n\t\tthis.peerConnection.removeEventListener(\"icegatheringstatechange\", this._onPeerConnectionIceGatheringStateChangeHandler);\n\t\tthis.peerConnection.removeEventListener(\"signalingstatechange\", this._onPeerConnectionSignalingStateChangeHandler);\n\t\t// this.peerConnection.removeEventListener(\"negotiationneeded\", this._onPeerConnectionNegotiationNeededHandler);\n\t\tthis.peerConnection.removeEventListener(\"track\", this._onPeerConnectionTrackHandler);\n\t\tthis.peerConnection.removeEventListener(\"removestream\", this._onPeerConnectionRemoveStreamHandler);\n\n\t\tthis.localIceCandidates = [];\n\t\tif (this.pendingIceCandidates[this.peerConnectionId])\n\t\t{\n\t\t\tdelete this.pendingIceCandidates[this.peerConnectionId];\n\t\t}\n\n\t\tthis.peerConnection.close();\n\t\tthis.peerConnection = null;\n\t\tthis.peerConnectionId = null;\n\t\tthis.videoSender = null;\n\t\tthis.screenSender = null;\n\t\tthis.audioSender = null;\n\t\tthis.incomingAudioTrack = null;\n\t\tthis.incomingScreenAudioTrack = null;\n\t\tthis.incomingVideoTrack = null;\n\t\tthis.incomingScreenTrack = null;\n\t};\n\n\t_onPeerConnectionIceCandidate(e)\n\t{\n\t\tconst candidate = e.candidate;\n\t\tthis.log(\"User \" + this.userId + \": ICE candidate discovered. Candidate: \" + (candidate ? candidate.candidate : candidate));\n\n\t\tif (candidate)\n\t\t{\n\t\t\tif (this.getSignaling().isIceTricklingAllowed())\n\t\t\t{\n\t\t\t\tthis.getSignaling().sendIceCandidate({\n\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\tconnectionId: this.peerConnectionId,\n\t\t\t\t\tcandidates: [candidate.toJSON()]\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.localIceCandidates.push(candidate.toJSON());\n\t\t\t\tthis.updateCandidatesTimeout();\n\t\t\t}\n\n\t\t\tconst match = candidate.candidate.match(/typ\\s(\\w+)?/);\n\t\t\tif (match)\n\t\t\t{\n\t\t\t\tconst type = match[1];\n\t\t\t\tif (type == \"srflx\")\n\t\t\t\t{\n\t\t\t\t\tthis.hasStun = true;\n\t\t\t\t}\n\t\t\t\telse if (type == \"relay\")\n\t\t\t\t{\n\t\t\t\t\tthis.hasTurn = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\t#onPeerConnectionConnectionStateChange()\n\t{\n\t\tthis.log(\"User \" + this.userId + \": peer connection state changed. New state: \" + this.peerConnection.connectionState);\n\n\t\tif (this.peerConnection.connectionState === \"connected\" || this.peerConnection.connectionState === \"completed\")\n\t\t{\n\t\t\tthis.connectionAttempt = 0;\n\t\t\tthis.callbacks.onReconnected();\n\t\t\tclearTimeout(this.reconnectAfterDisconnectTimeout);\n\t\t\tthis._updateTracksDebounced();\n\t\t}\n\t\telse if (this.peerConnection.connectionState === \"failed\")\n\t\t{\n\t\t\tthis.log(\"peer connection failed. Trying to restore connection immediately\");\n\t\t\tthis.reconnect();\n\t\t}\n\t\t// else if (this.peerConnection.connectionState === \"disconnected\")\n\t\t// {\n\t\t// \t// we can ignore a 'disconnected' state because it can provoke frequent reconnects,\n\t\t// \t// besides that, iceConnectionState can can be changed back to 'connected' state by itself\n\t\t// \tthis.log(\"peer connection lost. Waiting 5 seconds before trying to restore it\");\n\t\t// \tclearTimeout(this.reconnectAfterDisconnectTimeout);\n\t\t// \tthis.reconnectAfterDisconnectTimeout = setTimeout(() => this.reconnect(), 5000);\n\t\t// }\n\n\t\tthis.updateCalculatedState();\n\t};\n\n\t#onPeerConnectionIceGatheringStateChange(e)\n\t{\n\t\tconst connection = e.target;\n\t\tthis.log(\"User \" + this.userId + \": ICE gathering state changed to : \" + connection.iceGatheringState);\n\n\t\tif (connection.iceGatheringState === 'complete')\n\t\t{\n\t\t\tthis.log(\"User \" + this.userId + \": ICE gathering complete\");\n\t\t\tif (!this.hasStun || !this.hasTurn)\n\t\t\t{\n\t\t\t\tconst s = [];\n\t\t\t\tif (!this.hasTurn)\n\t\t\t\t{\n\t\t\t\t\ts.push(\"TURN\");\n\t\t\t\t}\n\t\t\t\tif (!this.hasStun)\n\t\t\t\t{\n\t\t\t\t\ts.push(\"STUN\");\n\t\t\t\t}\n\t\t\t\tthis.log(\"Connectivity problem detected: no ICE candidates from \" + s.join(\" and \") + \" servers\");\n\t\t\t\tconsole.error(\"Connectivity problem detected: no ICE candidates from \" + s.join(\" and \") + \" servers\");\n\t\t\t\tthis.callbacks.onNetworkProblem();\n\t\t\t}\n\n\t\t\tif (!this.hasTurn && !this.hasStun)\n\t\t\t{\n\n\t\t\t}\n\n\t\t\tif (!this.getSignaling().isIceTricklingAllowed())\n\t\t\t{\n\t\t\t\tif (this.localIceCandidates.length > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.getSignaling().sendIceCandidate({\n\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\tconnectionId: this.peerConnectionId,\n\t\t\t\t\t\tcandidates: this.localIceCandidates\n\t\t\t\t\t});\n\t\t\t\t\tthis.localIceCandidates = [];\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"User \" + this.userId + \": ICE candidates already sent\");\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\t#onPeerConnectionSignalingStateChange()\n\t{\n\t\tthis.log(\"User \" + this.userId + \" PC signalingState: \" + this.peerConnection.signalingState);\n\t\tif (this.peerConnection.signalingState === \"stable\")\n\t\t{\n\t\t\tthis._updateTracksDebounced();\n\t\t}\n\t};\n\n\t// this event is unusable in the current version of desktop (cef 64) and leads to signaling cycling\n\t// todo: reconsider using it after new version is released\n\t#onPeerConnectionNegotiationNeeded(e)\n\t{\n\t\tthis.log(\"User \" + this.userId + \": needed negotiation for peer connection\");\n\t\tthis.log(\"signaling state: \", e.target.signalingState);\n\t\tthis.log(\"ice connection state: \", e.target.iceConnectionState);\n\t\tthis.log(\"pendingRemoteDescription: \", e.target.pendingRemoteDescription);\n\n\t\tif (e.target.iceConnectionState !== \"new\" && e.target.iceConnectionState !== \"connected\" && e.target.iceConnectionState !== \"completed\")\n\t\t{\n\t\t\tthis.log(\"User \" + this.userId + \": wrong connection state\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isInitiator())\n\t\t{\n\t\t\tthis.createAndSendOffer();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.sendNegotiationNeeded(this.peerConnection._forceReconnect === true);\n\t\t}\n\t};\n\n\t#onPeerConnectionTrack(e)\n\t{\n\t\tthis.log(\"User \" + this.userId + \": media track received: \", e.track.id + \" (\" + e.track.kind + \")\");\n\n\t\tif (e.track.kind === \"video\")\n\t\t{\n\t\t\te.track.addEventListener(\"mute\", this.#onVideoTrackMuted.bind(this));\n\t\t\te.track.addEventListener(\"unmute\", this.#onVideoTrackUnMuted.bind(this));\n\t\t\te.track.addEventListener(\"ended\", this.#onVideoTrackEnded.bind(this));\n\t\t\tif (this.trackList[e.track.id] === 'screen')\n\t\t\t{\n\t\t\t\tthis.incomingScreenTrack = e.track;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.incomingVideoTrack = e.track\n\t\t\t}\n\t\t}\n\t\telse if (e.track.kind === 'audio')\n\t\t{\n\t\t\t// this.incomingAudioTrack = e.track;\n\t\t\tif (this.trackList[e.track.id] === 'screenAudio')\n\t\t\t{\n\t\t\t\tthis.incomingScreenAudioTrack = e.track;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.incomingAudioTrack = e.track;\n\t\t\t}\n\t\t}\n\t};\n\n\t#onPeerConnectionRemoveStream(e)\n\t{\n\t\tthis.log(\"User: \" + this.userId + \"_onPeerConnectionRemoveStream: \", e);\n\t};\n\n\t#onVideoTrackMuted()\n\t{\n\t\tconsole.log(\"Video track muted\");\n\t\t//this._updateTracksDebounced();\n\t};\n\n\t#onVideoTrackUnMuted()\n\t{\n\t\tconsole.log(\"Video track unmuted\");\n\t\t//this._updateTracksDebounced();\n\t};\n\n\t#onVideoTrackEnded()\n\t{\n\t\tconsole.log(\"Video track ended\");\n\t};\n\n\t#updateTracks()\n\t{\n\t\tif (!this.peerConnection)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\tlet audioTrack = null;\n\t\tlet videoTrack = null;\n\t\tlet screenTrack = null;\n\t\tlet screenAudioTrack = null;\n\t\tthis.peerConnection.getTransceivers().forEach((tr) =>\n\t\t{\n\t\t\tthis.call.log(\"[debug] tr direction: \" + tr.direction + \" currentDirection: \" + tr.currentDirection);\n\t\t\tif (tr.currentDirection === \"sendrecv\" || tr.currentDirection === \"recvonly\")\n\t\t\t{\n\t\t\t\tif (tr.receiver && tr.receiver.track)\n\t\t\t\t{\n\t\t\t\t\tconst track = tr.receiver.track;\n\t\t\t\t\tif (track.kind === 'audio')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.trackList[tr.mid] === 'sharingAudio')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tscreenAudioTrack = track;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\taudioTrack = track;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (track.kind === 'video')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.trackList[tr.mid] === 'screen')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tscreenTrack = track;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvideoTrack = track;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.incomingAudioTrack = audioTrack;\n\t\tthis.incomingVideoTrack = videoTrack;\n\t\tthis.incomingScreenTrack = screenTrack;\n\t\tthis.incomingScreenAudioTrack = screenAudioTrack;\n\t};\n\n\tstopSignalingTimeout()\n\t{\n\t\tclearTimeout(this.signalingConnectionTimeout);\n\t};\n\n\trefreshSignalingTimeout()\n\t{\n\t\tclearTimeout(this.signalingConnectionTimeout);\n\t\tthis.signalingConnectionTimeout = setTimeout(this.#onLostSignalingConnection.bind(this), signalingConnectionRefreshPeriod);\n\t};\n\n\t#onLostSignalingConnection()\n\t{\n\t\tthis.setSignalingConnected(false);\n\t};\n\n\t_onConnectionOfferReplyTimeout(connectionId)\n\t{\n\t\tthis.log(\"did not receive connection answer for connection \" + connectionId);\n\t\tthis.call.setPublishingState(MediaStreamsKinds.Camera, false);\n\n\t\tthis.reconnect();\n\t};\n\n\t_onNegotiationNeededReplyTimeout()\n\t{\n\t\tthis.log(\"did not receive connection offer in time\");\n\n\t\tthis.reconnect();\n\t};\n\n\tsetConnectionOffer(connectionId, sdp, trackList)\n\t{\n\t\tthis.log(\"User \" + this.userId + \": applying connection offer for connection \" + connectionId);\n\n\t\tclearTimeout(this.negotiationNeededReplyTimeout);\n\t\tthis.negotiationNeededReplyTimeout = null;\n\n\t\tif (!this.call.isReady())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.isReady())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (trackList)\n\t\t{\n\t\t\tthis.trackList = BX.util.array_flip(trackList);\n\t\t}\n\n\t\tif (this.peerConnection)\n\t\t{\n\t\t\tif (this.peerConnectionId !== connectionId)\n\t\t\t{\n\t\t\t\tthis._destroyPeerConnection();\n\t\t\t\tthis.#createPeerConnection(connectionId);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#createPeerConnection(connectionId);\n\t\t}\n\n\t\tthis.applyOfferAndSendAnswer(sdp);\n\t};\n\n\tcreateAndSendOffer(config)\n\t{\n\t\tlet connectionConfig = defaultConnectionOptions;\n\t\tfor (let key in config)\n\t\t{\n\t\t\tconnectionConfig[key] = config[key];\n\t\t}\n\n\t\tthis.peerConnection.createOffer(connectionConfig)\n\t\t\t.then((offer) =>\n\t\t\t{\n\t\t\t\tthis.log(\"User \" + this.userId + \": Created connection offer.\");\n\t\t\t\tthis.log(\"Applying local description\");\n\t\t\t\treturn this.peerConnection.setLocalDescription(offer);\n\t\t\t})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.sendOffer();\n\t\t\t})\n\t\t;\n\t};\n\n\tsendOffer()\n\t{\n\t\tclearTimeout(this.connectionOfferReplyTimeout);\n\t\tthis.connectionOfferReplyTimeout = setTimeout(\n\t\t\t() => this._onConnectionOfferReplyTimeout(this.peerConnectionId),\n\t\t\tsignalingWaitReplyPeriod\n\t\t);\n\n\t\tthis.getSignaling().sendConnectionOffer({\n\t\t\tuserId: this.userId,\n\t\t\tconnectionId: this.peerConnectionId,\n\t\t\tsdp: this.peerConnection.localDescription.sdp,\n\t\t\ttracks: {\n\t\t\t\taudio: this.getSenderMid(this.audioSender),\n\t\t\t\tvideo: this.getSenderMid(this.videoSender),\n\t\t\t\tscreen: this.getSenderMid(this.screenSender),\n\t\t\t\tsharingAudio: this.getSenderMid(this.screenAudioSender),\n\t\t\t},\n\t\t\tuserAgent: navigator.userAgent\n\t\t})\n\t};\n\n\tsendNegotiationNeeded(restart: boolean)\n\t{\n\t\trestart = restart === true;\n\t\tclearTimeout(this.negotiationNeededReplyTimeout);\n\t\tthis.negotiationNeededReplyTimeout = setTimeout(\n\t\t\t() => this._onNegotiationNeededReplyTimeout(),\n\t\t\tsignalingWaitReplyPeriod\n\t\t);\n\n\t\tconst params = {\n\t\t\tuserId: this.userId\n\t\t};\n\t\tif (restart)\n\t\t{\n\t\t\tparams.restart = true;\n\t\t}\n\n\t\tthis.getSignaling().sendNegotiationNeeded(params);\n\t};\n\n\tapplyOfferAndSendAnswer(sdp)\n\t{\n\t\tconst sessionDescription = new RTCSessionDescription({\n\t\t\ttype: \"offer\",\n\t\t\tsdp: sdp\n\t\t});\n\n\t\tif (this.pendingRemoteSdpDelay)\n\t\t{\n\t\t\tthis.pendingRemoteSdp = sdp;\n\t\t\treturn;\n\t\t}\n\n\t\tthis.log(\"User: \" + this.userId + \"; Applying remote offer\");\n\t\tthis.log(\"User: \" + this.userId + \"; Peer ice connection state \", this.peerConnection.iceConnectionState);\n\n\t\tthis.pendingRemoteSdpDelay = true;\n\n\t\tthis.peerConnection\n\t\t\t.setRemoteDescription(sessionDescription)\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tif (this.peerConnection.iceConnectionState === 'new')\n\t\t\t\t{\n\t\t\t\t\tthis.sendMedia(true);\n\t\t\t\t}\n\n\t\t\t\treturn this.peerConnection.createAnswer();\n\t\t\t})\n\t\t\t.then((answer) =>\n\t\t\t{\n\t\t\t\tthis.log(\"Created connection answer.\");\n\t\t\t\tthis.log(\"Applying local description.\");\n\n\t\t\t\treturn this.peerConnection.setLocalDescription(answer);\n\t\t\t})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.applyResolutionScale();\n\t\t\t\tthis.applyPendingIceCandidates();\n\t\t\t\tthis.getSignaling().sendConnectionAnswer({\n\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\tconnectionId: this.peerConnectionId,\n\t\t\t\t\tsdp: this.peerConnection.localDescription.sdp,\n\t\t\t\t\ttracks: {\n\t\t\t\t\t\taudio: this.getSenderMid(this.audioSender),\n\t\t\t\t\t\tvideo: this.getSenderMid(this.videoSender),\n\t\t\t\t\t\tscreen: this.getSenderMid(this.screenSender),\n\t\t\t\t\t\tsharingAudio: this.getSenderMid(this.screenAudioSender),\n\t\t\t\t\t},\n\t\t\t\t\tuserAgent: navigator.userAgent\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch((e) =>\n\t\t\t{\n\t\t\t\tthis.failureReason = e.toString();\n\t\t\t\tthis.updateCalculatedState();\n\t\t\t\tthis.log(\"Could not apply remote offer\", e);\n\t\t\t\tconsole.error(\"Could not apply remote offer\", e);\n\t\t\t})\n\t\t\t.finally(() => {\n\t\t\t\tthis.pendingRemoteSdpDelay = false;\n\t\t\t\tif (this.pendingRemoteSdp) {\n\t\t\t\t\tthis.applyOfferAndSendAnswer(this.pendingRemoteSdp);\n\t\t\t\t\tthis.pendingRemoteSdp = null;\n\t\t\t\t}\n\n\t\t\t})\n\t\t;\n\t};\n\n\tsetConnectionAnswer(connectionId, sdp, trackList)\n\t{\n\t\tif (!this.peerConnection || this.peerConnectionId != connectionId)\n\t\t{\n\t\t\tthis.log(\"Could not apply answer, for unknown connection \" + connectionId);\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.peerConnection.signalingState !== 'have-local-offer')\n\t\t{\n\t\t\tthis.log(\"Could not apply answer, wrong peer connection signaling state \" + this.peerConnection.signalingState);\n\t\t\treturn;\n\t\t}\n\n\t\tif (trackList)\n\t\t{\n\t\t\tthis.trackList = BX.util.array_flip(trackList);\n\t\t}\n\n\t\tconst sessionDescription = new RTCSessionDescription({\n\t\t\ttype: \"answer\",\n\t\t\tsdp: sdp\n\t\t});\n\n\t\tclearTimeout(this.connectionOfferReplyTimeout);\n\n\t\tthis.log(\"User: \" + this.userId + \"; Applying remote answer\");\n\t\tthis.peerConnection\n\t\t\t.setRemoteDescription(sessionDescription)\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.applyPendingIceCandidates();\n\t\t\t})\n\t\t\t.catch((e) =>\n\t\t\t{\n\t\t\t\tthis.failureReason = e.toString();\n\t\t\t\tthis.updateCalculatedState();\n\t\t\t\tthis.log(e);\n\t\t\t})\n\t\t\t.finally(() =>\n\t\t\t{\n\t\t\t\tthis.call.setPublishingState(MediaStreamsKinds.Camera, false);\n\t\t\t})\n\t\t;\n\t};\n\n\taddIceCandidate(connectionId, candidate)\n\t{\n\t\tif (!this.peerConnection)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.peerConnectionId != connectionId)\n\t\t{\n\t\t\tthis.log(\"Error: Candidate for unknown connection \" + connectionId);\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.peerConnection.remoteDescription && this.peerConnection.remoteDescription.type)\n\t\t{\n\t\t\tthis.peerConnection\n\t\t\t\t.addIceCandidate(candidate)\n\t\t\t\t.then(() =>\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"User: \" + this.userId + \"; Added remote ICE candidate: \" + (candidate ? candidate.candidate : candidate));\n\t\t\t\t})\n\t\t\t\t.catch((e) =>\n\t\t\t\t{\n\t\t\t\t\tthis.log(e);\n\t\t\t\t})\n\t\t\t;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (!this.pendingIceCandidates[connectionId])\n\t\t\t{\n\t\t\t\tthis.pendingIceCandidates[connectionId] = [];\n\t\t\t}\n\t\t\tthis.pendingIceCandidates[connectionId].push(candidate);\n\t\t}\n\t};\n\n\tapplyPendingIceCandidates()\n\t{\n\t\tif (!this.peerConnection || !this.peerConnection.remoteDescription.type)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (Type.isArray(this.pendingIceCandidates[this.peerConnectionId]))\n\t\t{\n\t\t\tthis.pendingIceCandidates[this.peerConnectionId].forEach((candidate) =>\n\t\t\t{\n\t\t\t\tthis.peerConnection.addIceCandidate(candidate).then(() =>\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"User: \" + this.userId + \"; Added remote ICE candidate: \" + (candidate ? candidate.candidate : candidate));\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tthis.pendingIceCandidates[this.peerConnectionId] = [];\n\t\t}\n\t};\n\n\tonNegotiationNeeded()\n\t{\n\t\tif (this.peerConnection)\n\t\t{\n\t\t\tif (this.peerConnection.signalingState == \"have-local-offer\")\n\t\t\t{\n\t\t\t\tthis.sendOffer();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.createAndSendOffer({iceRestart: true});\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.sendMedia();\n\t\t}\n\t};\n\n\treconnect()\n\t{\n\t\tclearTimeout(this.reconnectAfterDisconnectTimeout);\n\n\t\tthis.connectionAttempt++;\n\n\n\t\tif (this.connectionAttempt > 3)\n\t\t{\n\t\t\tthis.log(\"Error: Too many reconnection attempts, giving up\");\n\t\t\tthis.failureReason = \"Could not connect to user in time\";\n\t\t\tthis.updateCalculatedState();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callbacks.onReconnecting();\n\n\t\tthis.log(\"Trying to restore ICE connection. Attempt \" + this.connectionAttempt);\n\t\tif (this.isInitiator())\n\t\t{\n\t\t\tthis._destroyPeerConnection();\n\t\t\tthis.sendMedia();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.sendNegotiationNeeded(true);\n\t\t}\n\t};\n\n\tdisconnect()\n\t{\n\t\tthis._destroyPeerConnection();\n\n\t\tthis.outgoingVideoTrack = null;\n\t\tthis.outgoingScreenTrack = null;\n\t\tthis.outgoingVideoHoldState = false;\n\n\t\tthis.incomingAudioTrack = null;\n\t\tthis.incomingScreenAudioTrack = null;\n\t\tthis.incomingVideoTrack = null;\n\t\tthis.incomingScreenTrack = null;\n\t};\n\n\tlog()\n\t{\n\t\tthis.call.log.apply(this.call, arguments);\n\t};\n\n\tdestroy()\n\t{\n\t\tthis.disconnect();\n\n\t\tif (this.voiceDetection)\n\t\t{\n\t\t\tthis.voiceDetection.destroy();\n\t\t\tthis.voiceDetection = null;\n\t\t}\n\n\t\tfor (let tag in this.localStreams)\n\t\t{\n\t\t\tthis.localStreams[tag] = null;\n\t\t}\n\n\t\tclearTimeout(this.answerTimeout);\n\t\tthis.answerTimeout = null;\n\n\t\tclearTimeout(this.connectionTimeout);\n\t\tthis.connectionTimeout = null;\n\n\t\tclearTimeout(this.signalingConnectionTimeout);\n\t\tthis.signalingConnectionTimeout = null;\n\n\t\tthis.callbacks.onStateChanged = BX.DoNothing;\n\t\tthis.callbacks.onMediaReceived = BX.DoNothing;\n\t\tthis.callbacks.onMediaStopped = BX.DoNothing;\n\t};\n}","import {Type} from 'main.core';\n\nimport {AbstractCall} from './abstract_call';\nimport {\n\tCallEngine,\n\tEndpointDirection,\n\tUserState,\n\tQuality,\n\tUserMnemonic,\n\tCallEvent,\n\tCallState,\n\tCallType,\n\tProvider,\n\tDisconnectReason,\n} from './engine';\nimport {Call, CALL_STATE, MediaStreamsKinds, RecorderStatus} from '../call_api.js';\nimport {View} from '../view/view';\nimport { MediaRenderer } from '../view/media-renderer';\nimport {SimpleVAD} from './simple_vad'\nimport {Hardware} from '../call_hardware';\nimport Util from '../util'\n\nimport {Event} from 'main.core';\nimport { UnsupportedBrowserFeatures } from './unsupported_features_in_browsers';\n\n\n/**\n * Implements Call interface\n * Public methods:\n * - inviteUsers\n * - answer\n * - decline\n * - hangup\n *\n * Events:\n * - onCallStateChanged //not sure about this.\n * - onUserStateChanged\n * - onStreamReceived\n * - onStreamRemoved\n * - onDestroy\n */\n\nconst ajaxActions = {\n\tinvite: 'call.Call.invite',\n\tdecline: 'call.Call.decline',\n};\n\nconst clientEvents = {\n\tvoiceStarted: 'Call::voiceStarted',\n\tvoiceStopped: 'Call::voiceStopped',\n\tmicrophoneState: 'Call::microphoneState',\n\tcameraState: 'Call::cameraState',\n\tvideoPaused: 'Call::videoPaused',\n\tscreenState: 'Call::screenState',\n\trecordState: 'Call::recordState',\n\temotion: 'Call::emotion',\n\tcustomMessage: 'Call::customMessage',\n\tusersInvited: 'Call::usersInvited',\n\tuserInviteTimeout: 'Call::userInviteTimeout',\n\tshowUsers: 'Call::showUsers',\n\tshowAll: 'Call::showAll',\n\thideAll: 'Call::hideAll',\n};\n\nconst scenarioEvents = {\n\tviewerJoined: 'Call::viewerJoined',\n\tviewerLeft: 'Call::viewerLeft',\n};\n\nconst BitrixCallEvent = {\n\tonCallConference: 'BitrixCall::onCallConference'\n};\n\nconst MediaKinds = {\n\t[MediaStreamsKinds.Camera]: 'video',\n\t[MediaStreamsKinds.Microphone]: 'audio',\n\t[MediaStreamsKinds.Screen]: 'sharing',\n\t[MediaStreamsKinds.ScreenAudio]: 'sharingAudio',\n};\n\nconst invitePeriod = 30000;\nconst reinvitePeriod = 5500;\n\n// const MAX_USERS_WITHOUT_SIMULCAST = 6;\n\nexport class BitrixCall extends AbstractCall\n{\n\tstatic Event = BitrixCallEvent\n\tpeers: { [key: number]: Peer }\n\tlocalVAD: ?SimpleVAD\n\n\tconstructor(config)\n\t{\n\t\tsuper(config);\n\n\t\tthis.videoQuality = Quality.VeryHigh; // initial video quality. will drop on new peers connecting\n\n\t\tthis.BitrixCall = null;\n\n\t\tthis.signaling = new Signaling({\n\t\t\tcall: this\n\t\t});\n\n\t\tthis.peers = {};\n\t\tthis.peersWithBadConnection = new Set();\n\t\tthis.joinedAsViewer = false;\n\t\tthis.localVideoShown = false;\n\t\tthis._localUserState = UserState.Idle;\n\t\tthis.clientEventsBound = false;\n\t\tthis._screenShared = false;\n\t\tthis.videoAllowedFrom = UserMnemonic.all;\n\t\tthis.direction = EndpointDirection.SendRecv;\n\t\tthis.floorRequestActive = false;\n\n\t\tthis.recordState = {\n\t\t\tstate: View.RecordState.Stopped,\n\t\t\tuserId: 0,\n\t\t\tdate: {\n\t\t\t\tstart: null,\n\t\t\t\tpause: []\n\t\t\t},\n\t\t};\n\n\t\tthis.microphoneLevelInterval = null;\n\n\t\tthis.initPeers();\n\n\t\tthis.reinviteTimeout = null;\n\n\t\tthis._reconnectionEventCount = 0;\n\t\tthis.waitForAnswerTimeout = null;\n\n\t\tthis.pullEventHandlers = {\n\t\t\t'Call::answer': this.#onPullEventAnswer,\n\t\t\t'Call::hangup': this.#onPullEventHangup,\n\t\t\t'Call::finish': this.#onPullEventFinish,\n\t\t\t'Call::switchTrackRecordStatus': this.#onPullEventSwitchTrackRecordStatus,\n\t\t};\n\n\t\tthis._recorderState = RecorderStatus.UNAVAILABLE;\n\t\tthis._recorderStateHasChange = false;\n\t\tthis._isCopilotFeaturesEnabled = true;\n\t\tthis._isRecordWhenCopilotActivePopupAlreadyShow = false;\n\t\tthis._isBoostExpired = false;\n\t};\n\n\tget provider()\n\t{\n\t\treturn Provider.Bitrix;\n\t}\n\n\tget screenShared()\n\t{\n\t\treturn this._screenShared;\n\t}\n\n\tget isCopilotInitialized()\n\t{\n\t\treturn this._recorderState !== RecorderStatus.UNAVAILABLE || this._recorderStateHasChange;\n\t}\n\n\tget isCopilotActive()\n\t{\n\t\treturn this._recorderState === RecorderStatus.ENABLED;\n\t}\n\n\tget isCopilotDisabled()\n\t{\n\t\treturn this._recorderState === RecorderStatus.DESTROYED;\n\t}\n\n\tget isBoostExpired()\n\t{\n\t\treturn this._isBoostExpired;\n\t}\n\n\tset isBoostExpired(isBoostExpired)\n\t{\n\t\tif (isBoostExpired !== this._isBoostExpired)\n\t\t{\n\t\t\tthis._isBoostExpired = isBoostExpired;\n\t\t}\n\t}\n\n\tget isCopilotFeaturesEnabled()\n\t{\n\t\treturn this._isCopilotFeaturesEnabled;\n\t}\n\n\tset isCopilotFeaturesEnabled(isCopilotFeaturesEnabled)\n\t{\n\t\tif (isCopilotFeaturesEnabled !== this._isCopilotFeaturesEnabled)\n\t\t{\n\t\t\tthis._isCopilotFeaturesEnabled = isCopilotFeaturesEnabled;\n\t\t}\n\t}\n\n\tget isRecordWhenCopilotActivePopupAlreadyShow()\n\t{\n\t\treturn this._isRecordWhenCopilotActivePopupAlreadyShow;\n\t}\n\n\tset isRecordWhenCopilotActivePopupAlreadyShow(isRecordWhenCopilotActivePopupAlreadyShow)\n\t{\n\t\tif (isRecordWhenCopilotActivePopupAlreadyShow !== this._isRecordWhenCopilotActivePopupAlreadyShow)\n\t\t{\n\t\t\tthis._isRecordWhenCopilotActivePopupAlreadyShow = isRecordWhenCopilotActivePopupAlreadyShow;\n\t\t}\n\t}\n\n\tset screenShared(screenShared)\n\t{\n\t\tif (screenShared !== this._screenShared)\n\t\t{\n\t\t\tthis._screenShared = screenShared;\n\t\t\tthis.signaling.sendScreenState(this._screenShared);\n\t\t}\n\t}\n\n\tget localUserState()\n\t{\n\t\treturn this._localUserState\n\t}\n\n\tset localUserState(state)\n\t{\n\t\tif (state === this._localUserState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.runCallback(CallEvent.onUserStateChanged, {\n\t\t\tuserId: this.userId,\n\t\t\tstate: state,\n\t\t\tpreviousState: this._localUserState,\n\t\t\tdirection: this.direction,\n\t\t});\n\t\tthis._localUserState = state;\n\t}\n\n\tget reconnectionEventCount()\n\t{\n\t\treturn this._reconnectionEventCount;\n\t}\n\n\tset reconnectionEventCount(newValue)\n\t{\n\t\tif (newValue === 0)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onReconnected);\n\t\t}\n\t\tthis._reconnectionEventCount = newValue;\n\t}\n\n\tget hasConnectionData()\n\t{\n\t\treturn Boolean(this.connectionData.mediaServerUrl && this.connectionData.roomData);\n\t}\n\n\tinitPeers()\n\t{\n\t\tthis.users.forEach((userId) =>\n\t\t{\n\t\t\tuserId = Number(userId);\n\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t});\n\t};\n\n\treinitPeers()\n\t{\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers.hasOwnProperty(userId) && this.peers[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId].destroy();\n\t\t\t\tthis.peers[userId] = null;\n\t\t\t}\n\t\t}\n\n\t\tthis.initPeers();\n\t};\n\n\tcreatePeer(userId)\n\t{\n\t\tlet incomingVideoAllowed;\n\t\tif (this.videoAllowedFrom === UserMnemonic.all)\n\t\t{\n\t\t\tincomingVideoAllowed = true;\n\t\t}\n\t\telse if (this.videoAllowedFrom === UserMnemonic.none)\n\t\t{\n\t\t\tincomingVideoAllowed = false;\n\t\t}\n\t\telse if (Type.isArray(this.videoAllowedFrom))\n\t\t{\n\t\t\tincomingVideoAllowed = this.videoAllowedFrom.some(allowedUserId => allowedUserId == userId);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tincomingVideoAllowed = true;\n\t\t}\n\n\t\treturn new Peer({\n\t\t\tcall: this,\n\t\t\tuserId: userId,\n\t\t\tready: userId == this.initiatorId,\n\t\t\tisIncomingVideoAllowed: incomingVideoAllowed,\n\n\t\t\tonMediaReceived: (e) =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onRemoteMediaReceived, e);\n\t\t\t\tif (e.kind === 'video')\n\t\t\t\t{\n\t\t\t\t\tthis.runCallback(CallEvent.onUserVideoPaused, {\n\t\t\t\t\t\tuserId: userId,\n\t\t\t\t\t\tvideoPaused: false\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\tonMediaRemoved: (e) =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onRemoteMediaStopped, e);\n\t\t\t},\n\t\t\tonStateChanged: this.#onPeerStateChanged,\n\t\t\tonInviteTimeout: this.#onPeerInviteTimeout,\n\n\t\t})\n\t};\n\n\tgetUsers()\n\t{\n\t\tlet result = {};\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tresult[userId] = this.peers[userId].calculatedState;\n\t\t}\n\n\t\treturn result;\n\t};\n\n\tgetUserCount()\n\t{\n\t\treturn Object.keys(this.peers).length;\n\t};\n\n\tcanChangeMediaDevices()\n\t{\n\t\treturn !this.BitrixCall?.isMediaMutedBySystem;\n\t};\n\n\tsetMuted = (event) =>\n\t{\n\t\tif (this.muted === event.data.isMicrophoneMuted)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.muted = event.data.isMicrophoneMuted;\n\n\t\tif (this.BitrixCall)\n\t\t{\n\t\t\tif (!event.data.calledProgrammatically && this.muted)\n\t\t\t{\n\t\t\t\tthis.signaling.sendMicrophoneState(!this.muted);\n\t\t\t}\n\n\t\t\tif (this.muted)\n\t\t\t{\n\t\t\t\tthis.BitrixCall.disableAudio();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (!this.BitrixCall.isAudioPublished())\n\t\t\t\t{\n\t\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Microphone, true);\n\t\t\t\t}\n\t\t\t\tthis.BitrixCall.enableAudio();\n\t\t\t}\n\t\t}\n\t};\n\n\tsetVideoEnabled = (event) =>\n\t{\n\t\tif (this.videoEnabled === event.data.isCameraOn)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.videoEnabled = event.data.isCameraOn;\n\n\t\tif (this.BitrixCall)\n\t\t{\n\t\t\tif (!event.data.calledProgrammatically)\n\t\t\t{\n\t\t\t\tthis.signaling.sendCameraState(this.videoEnabled);\n\t\t\t}\n\n\t\t\tif (this.videoEnabled)\n\t\t\t{\n\t\t\t\tif (!this.BitrixCall.isVideoPublished())\n\t\t\t\t{\n\t\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Camera, true);\n\t\t\t\t}\n\t\t\t\tthis.localVideoShown = true;\n\t\t\t\tthis.BitrixCall.enableVideo({calledFrom: 'setVideoEnabled'});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (this.localVideoShown)\n\t\t\t\t{\n\t\t\t\t\tthis.localVideoShown = false;\n\t\t\t\t\tthis.BitrixCall.disableVideo({calledFrom: 'setVideoEnabled'});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tsetCameraId(cameraId)\n\t{\n\t\tif (this.cameraId === cameraId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.cameraId = cameraId;\n\n\t\tif (this.BitrixCall)\n\t\t{\n\t\t\tif (!cameraId)\n\t\t\t{\n\t\t\t\tthis.#onBeforeLocalMediaRendererRemoved(MediaStreamsKinds.Camera);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.BitrixCall.isVideoPublished())\n\t\t\t{\n\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Camera, true);\n\t\t\t}\n\n\t\t\tthis.BitrixCall.switchActiveVideoDevice(this.cameraId)\n\t\t\t\t.then(() =>\n\t\t\t\t{\n\t\t\t\t\tif (Hardware.isCameraOn)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.runCallback('onUpdateLastUsedCameraId');\n\n\t\t\t\t\t\tif (this.BitrixCall.isVideoPublished() && this.canChangeMediaDevices())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.BitrixCall.getLocalVideo()\n\t\t\t\t\t\t\t\t.then(track => {\n\t\t\t\t\t\t\t\t\tconst mediaRenderer = new MediaRenderer({\n\t\t\t\t\t\t\t\t\t\tkind: 'video',\n\t\t\t\t\t\t\t\t\t\ttrack,\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\t\t\t\t\t\t\tmediaRenderer,\n\t\t\t\t\t\t\t\t\t\ttag: 'main',\n\t\t\t\t\t\t\t\t\t\tstream: mediaRenderer.stream,\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.finally(() => {\n\t\t\t\t\t\t\t\t\tif (this.BitrixCall.isVideoPublished())\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Camera, false);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (!this.canChangeMediaDevices())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.runCallback(CallEvent.onNeedResetMediaDevicesState);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Camera, true);\n\t\t\t\t\t\t\tthis.localVideoShown = true;\n\t\t\t\t\t\t\tthis.BitrixCall.enableVideo({calledFrom: 'switchActiveVideoDevice', skipUnpause: true});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Camera, false);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch((e) =>\n\t\t\t\t{\n\t\t\t\t\tthis.log(e);\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t\tthis.#onBeforeLocalMediaRendererRemoved(MediaStreamsKinds.Camera);\n\t\t\t\t});\n\t\t}\n\t};\n\n\tsetMicrophoneId(microphoneId)\n\t{\n\t\tif (this.microphoneId === microphoneId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.microphoneId = microphoneId;\n\n\t\tif (this.BitrixCall)\n\t\t{\n\t\t\tif (!microphoneId)\n\t\t\t{\n\t\t\t\tthis.#onBeforeLocalMediaRendererRemoved(MediaStreamsKinds.Microphone);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#setPublishingState(MediaStreamsKinds.Microphone, true);\n\t\t\tthis.#onEndpointVoiceEnd({userId: this.userId});\n\n\t\t\tthis.BitrixCall.switchActiveAudioDevice(this.microphoneId)\n\t\t\t\t.then(() =>\n\t\t\t\t{\n\t\t\t\t\tthis.BitrixCall.getLocalAudio()\n\t\t\t\t\t\t.then(track => {\n\t\t\t\t\t\t\tthis.#onMicAccessResult({\n\t\t\t\t\t\t\t\tresult: true,\n\t\t\t\t\t\t\t\tstream: new MediaStream([track]),\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch((e) =>\n\t\t\t\t{\n\t\t\t\t\tthis.log(e);\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t\tthis.runCallback(CallEvent.onUserMicrophoneState, {\n\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\tmicrophoneState: false,\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t\t.finally(() => {\n\t\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Microphone, false);\n\n\t\t\t\t\tif (Hardware.isMicrophoneMuted && !this.canChangeMediaDevices())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.BitrixCall.disableAudio();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t}\n\t};\n\n\tsetRecorderState(state)\n\t{\n\t\tif (!this.BitrixCall || this._recorderState === state)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.BitrixCall.setRecorderState(state);\n\t};\n\n\t#setPublishingState(deviceType, publishing)\n\t{\n\t\tif (deviceType === MediaStreamsKinds.Camera)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onCameraPublishing, {\n\t\t\t\tpublishing\n\t\t\t});\n\t\t}\n\t\telse if (deviceType === MediaStreamsKinds.Microphone)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onMicrophonePublishing, {\n\t\t\t\tpublishing\n\t\t\t});\n\t\t}\n\t}\n\n\tuseHdVideo(flag)\n\t{\n\t\tthis.videoHd = (flag === true);\n\t};\n\n\tsetMainStream(userId)\n\t{\n\t\tif (!this.BitrixCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (userId && userId !== this.userId)\n\t\t{\n\t\t\tconst participant = this.peers[userId]?.participant;\n\t\t\tconst kind = participant?.screenSharingEnabled ? MediaStreamsKinds.Screen : MediaStreamsKinds.Camera;\n\t\t\tthis.BitrixCall.setMainStream(userId, kind);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.BitrixCall.resetMainStream();\n\t\t}\n\t}\n\n\trequestFloor(requestActive)\n\t{\n\t\tif (this.floorRequestActive === requestActive)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.floorRequestActive = requestActive;\n\t\tthis.BitrixCall.raiseHand(requestActive);\n\t};\n\n\tturnOffAllParticipansStream(options)\n\t{\n\t\tthis.BitrixCall.turnOffAllParticipansStream(options);\n\t};\n\n\tturnOffParticipantStream(options)\n\t{\n\t\tthis.BitrixCall.turnOffParticipantStream(options);\n\t};\n\n\tallowSpeakPermission(options)\n\t{\n\t\tthis.BitrixCall.allowSpeakPermission(options);\n\t};\n\n\tchangeSettings(options)\n\t{\n\t\tthis.BitrixCall.changeSettings(options);\n\t};\n\n\tsendRecordState(recordState)\n\t{\n\t\trecordState.senderId = this.userId;\n\n\t\tif (!this.#changeRecordState(recordState))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.runCallback(CallEvent.onUserRecordState, {\n\t\t\tuserId: this.userId,\n\t\t\trecordState: this.recordState\n\t\t})\n\t\tthis.signaling.sendRecordState(this.userId, this.recordState);\n\t};\n\n\tsendCustomMessage(message, repeatOnConnect)\n\t{\n\t\tthis.signaling.sendCustomMessage(message, repeatOnConnect);\n\t};\n\n\t/**\n\t * Updates list of users,\n\t */\n\tallowVideoFrom(userList: $Keys<typeof UserMnemonic> | number[])\n\t{\n\t\tif (this.videoAllowedFrom == userList)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.videoAllowedFrom = userList;\n\n\t\tif (userList === UserMnemonic.all)\n\t\t{\n\t\t\tthis.signaling.sendShowAll();\n\t\t\tuserList = Object.keys(this.peers);\n\t\t}\n\t\telse if (userList === UserMnemonic.none)\n\t\t{\n\t\t\tthis.signaling.sendHideAll();\n\t\t\tuserList = [];\n\t\t}\n\t\telse if (Type.isArray(userList))\n\t\t{\n\t\t\tthis.signaling.sendShowUsers(userList)\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthrow new Error(\"userList is in wrong format\");\n\t\t}\n\n\t\tlet users = {};\n\t\tuserList.forEach(userId => users[userId] = true);\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (!this.peers.hasOwnProperty(userId))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (users[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId].allowIncomingVideo(true);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.peers[userId].allowIncomingVideo(false);\n\t\t\t}\n\t\t}\n\t};\n\n\tstartScreenSharing()\n\t{\n\t\tif (!this.BitrixCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.waitingLocalScreenShare = true;\n\t\tthis.runCallback(CallEvent.onUserScreenState, {\n\t\t\tuserId: this.userId,\n\t\t\tscreenState: true,\n\t\t});\n\n\t\tthis.BitrixCall.startScreenShare();\n\t};\n\n\tstopScreenSharing()\n\t{\n\t\tthis.#onBeforeLocalMediaRendererRemoved(MediaStreamsKinds.Screen);\n\t};\n\n\tisScreenSharingStarted()\n\t{\n\t\treturn this.screenShared || this.waitingLocalScreenShare;\n\t};\n\n\tisGetUserMediaFulfilled()\n\t{\n\t\treturn this.getUserMediaFulfilled;\n\t};\n\n\t/**\n\t * Invites users to participate in the call.\n\t */\n\tinviteUsers(config: { users: ?number[], userData: ?Object, show: ?boolean } = {})\n\t{\n\t\tthis.ready = true;\n\t\tconst usersToInvite = Type.isArray(config.users) ? config.users : this.users;\n\n\t\tthis.attachToConference()\n\t\t\t.then(() => {\n\t\t\t\tif (this.type === CallType.Instant)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.waitForAnswerTimeout);\n\t\t\t\t\tthis.waitForAnswerTimeout = setTimeout(() => {\n\t\t\t\t\t\tthis.#onNoAnswer();\n\t\t\t\t\t}, invitePeriod);\n\t\t\t\t}\n\n\t\t\t\tthis.state = CallState.Connected;\n\t\t\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\t\t\tlocal: true,\n\t\t\t\t});\n\n\t\t\t\tusersToInvite.forEach((user) => {\n\t\t\t\t\tconst userId = parseInt(user, 10);\n\t\t\t\t\tif (!this.users.includes(userId))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.users.push(userId);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!this.peers[userId])\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.type === CallType.Instant)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.peers[userId].onInvited();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (config.userData && config.show)\n\t\t\t\t{\n\t\t\t\t\tconst inviteParams = {\n\t\t\t\t\t\tusers: config.userData,\n\t\t\t\t\t};\n\t\t\t\t\tthis.signaling.sendUsersInvited(inviteParams);\n\t\t\t\t}\n\n\t\t\t\tif (config.show && this.type === CallType.Instant && usersToInvite.length > 0)\n\t\t\t\t{\n\t\t\t\t\tconst inviteParams = {\n\t\t\t\t\t\tusers: usersToInvite,\n\t\t\t\t\t\tvideo: Hardware.isCameraOn ? 'Y' : 'N',\n\t\t\t\t\t\trepeated: 'Y',\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.signaling.inviteUsers(inviteParams).then(() => this.scheduleRepeatInvite());\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((e) => {\n\t\t\t\tthis.#onFatalError(e);\n\t\t\t})\n\t\t;\n\t}\n\n\tscheduleRepeatInvite()\n\t{\n\t\tclearTimeout(this.reinviteTimeout);\n\t\tthis.reinviteTimeout = setTimeout(() => this.repeatInviteUsers(), reinvitePeriod)\n\t};\n\n\trepeatInviteUsers()\n\t{\n\t\tclearTimeout(this.reinviteTimeout);\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet usersToRepeatInvite = [];\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers.hasOwnProperty(userId) && this.peers[userId].calculatedState === UserState.Calling)\n\t\t\t{\n\t\t\t\tusersToRepeatInvite.push(userId);\n\t\t\t}\n\t\t}\n\n\t\tif (usersToRepeatInvite.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst inviteParams = {\n\t\t\tusers: usersToRepeatInvite,\n\t\t\tvideo: Hardware.isCameraOn ? 'Y' : 'N',\n\t\t\trepeated: 'Y',\n\t\t}\n\t\tthis.signaling.inviteUsers(inviteParams).then(() => this.scheduleRepeatInvite());\n\t};\n\n\t/**\n\t * @param {Object} config\n\t * @param {bool?} [config.useVideo]\n\t * @param {bool?} [config.joinAsViewer]\n\t */\n\tanswer(config = {})\n\t{\n\t\tthis.ready = true;\n\t\tconst joinAsViewer = config.joinAsViewer === true;\n\t\tthis.videoEnabled = Hardware.isCameraOn;\n\t\tthis.muted = Hardware.isMicrophoneMuted;\n\n\t\tthis.attachToConference({joinAsViewer: joinAsViewer})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.log(\"Attached to conference\");\n\t\t\t\tthis.state = CallState.Connected;\n\t\t\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\t\t\tlocal: true\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch((err) =>\n\t\t\t{\n\t\t\t\tthis.#onFatalError(err);\n\t\t\t})\n\t\t;\n\t};\n\n\tdecline(code)\n\t{\n\t\tthis.ready = false;\n\t\tconst data = {\n\t\t\tcallUuid: this.uuid,\n\t\t\tcallInstanceId: this.instanceId,\n\t\t};\n\n\t\tif (code)\n\t\t{\n\t\t\tdata.code = code;\n\t\t}\n\n\t\tBX.ajax.runAction(ajaxActions.decline, { data });\n\t}\n\n\thangup(code, reason, finishCall = false)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\tconst error = new Error(\"Hangup in wrong state\");\n\t\t\tthis.log(error);\n\t\t\treturn;\n\t\t}\n\n\t\tconst tempError = new Error();\n\t\ttempError.name = \"Call stack:\";\n\t\tthis.log(\"Hangup received \\n\" + tempError.stack);\n\n\t\tif (this.localVAD)\n\t\t{\n\t\t\tthis.localVAD.destroy();\n\t\t\tthis.localVAD = null;\n\t\t}\n\t\tclearInterval(this.microphoneLevelInterval);\n\n\t\tlet data = {};\n\t\tthis.ready = false;\n\t\tif (typeof (code) != 'undefined')\n\t\t{\n\t\t\tdata.code = code;\n\t\t}\n\t\tif (typeof (reason) != 'undefined')\n\t\t{\n\t\t\tdata.reason = reason;\n\t\t}\n\t\tthis.state = CallState.Proceeding;\n\t\tthis.runCallback(CallEvent.onLeave, {local: true});\n\n\t\t//clone users and append current user id to send event to all participants of the call\n\t\tdata.userId = this.users.slice(0).concat(this.userId);\n\n\t\tif (reason !== 'SIGNALING_DUPLICATE_PARTICIPANT') {\n\t\t\t// for future reconnections\n\t\t\tthis.reinitPeers();\n\t\t}\n\n\t\tif (this.BitrixCall)\n\t\t{\n\t\t\tthis.BitrixCall._replaceVideoSharing = false;\n\t\t\tthis.BitrixCall.hangup(!!finishCall);\n\t\t\tthis.BitrixCall = null;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.log(\"Tried to hangup, but this.BitrixCall points nowhere\");\n\t\t\tconsole.error(\"Tried to hangup, but this.BitrixCall points nowhere\");\n\t\t}\n\n\t\tthis.connectionData = {};\n\n\t\tthis.screenShared = false;\n\t\tthis.localVideoShown = false;\n\t\tthis.floorRequestActive = false;\n\t};\n\n\tattachToConference(options: { joinAsViewer: ?boolean } = {})\n\t{\n\t\tconst joinAsViewer = options.joinAsViewer === true;\n\t\tif (this.BitrixCall && this.BitrixCall.getState() === CALL_STATE.CONNECTED)\n\t\t{\n\t\t\tif (this.joinedAsViewer === joinAsViewer)\n\t\t\t{\n\t\t\t\treturn Promise.resolve();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn Promise.reject(\"Already joined call in another mode\");\n\t\t\t}\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tthis.direction = joinAsViewer ? EndpointDirection.RecvOnly : EndpointDirection.SendRecv;\n\t\t\tthis.sendTelemetryEvent(\"call\");\n\n\t\t\ttry\n\t\t\t{\n\t\t\t\tthis.localUserState = UserState.Connecting;\n\t\t\t\tthis.BitrixCall = new Call(this.userId);\n\n\t\t\t\t/*if (Hardware.isCameraOn) // transfered to #onCallConnected\n\t\t\t\t{\n\t\t\t\t\tthis.localVideoShown = true;\n\t\t\t\t}*/\n\n\t\t\t\tthis.joinedAsViewer = joinAsViewer;\n\n\t\t\t\tif (!this.BitrixCall)\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"Error: could not create Bitrix call\");\n\t\t\t\t\treturn reject({code: \"BITRIX_NO_CALL\"});\n\t\t\t\t}\n\n\t\t\t\tthis.runCallback(BitrixCallEvent.onCallConference, {\n\t\t\t\t\tcall: this\n\t\t\t\t});\n\n\t\t\t\tthis.bindCallEvents();\n\t\t\t\tthis.subscribeHardwareChanges();\n\n\t\t\t\tthis.BitrixCall.on('Connected', () => {\n\t\t\t\t\tthis.#onCallConnected();\n\t\t\t\t\tresolve();\n\t\t\t\t})\n\t\t\t\tthis.BitrixCall.on('Failed', (e) =>\n\t\t\t\t{\n\t\t\t\t\tthis.#onCallFailed(e);\n\t\t\t\t\treject(e);\n\t\t\t\t});\n\n\t\t\t\tif (!this.ready)\n\t\t\t\t{\n\t\t\t\t\t// for rare cases with fast quit\n\t\t\t\t\treturn reject({code: \"BITRIX_NO_CALL\"});\n\t\t\t\t}\n\n\t\t\t\tthis.BitrixCall.connect({\n\t\t\t\t\troomId: this.uuid,\n\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\tuserRole: this.userRole,\n\t\t\t\t\tmediaServerUrl: this.connectionData.mediaServerUrl,\n\t\t\t\t\troomData: this.connectionData.roomData,\n\t\t\t\t\tvideoBitrate: 1000000,\n\t\t\t\t\tvideoSimulcast: true,\n\t\t\t\t\taudioDeviceId: this.microphoneId,\n\t\t\t\t\tvideoDeviceId: this.cameraId,\n\t\t\t\t});\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tthis.#onFatalError(e);\n\t\t\t}\n\t\t});\n\t};\n\n\t#onCallConnected()\n\t{\n\t\tthis.reconnectionEventCount = 0;\n\t\tthis.log(\"Call connected\");\n\t\tthis.sendTelemetryEvent(\"connect\");\n\t\tthis.localUserState = UserState.Connected;\n\n\t\tconst MAX_USERS_WITH_VIDEO = Util.countDisableCameraNewJoinedUsersFeature();\n\n\t\tif (Util.isDisableCameraNewJoinedUsersFeatureEnabled() && this.BitrixCall.remoteParticipantsCount >= MAX_USERS_WITH_VIDEO) // task-596223\n\t\t{\n\t\t\tHardware.isCameraOn = false;\n\t\t}\n\n\t\tif (!Util.havePermissionToBroadcast('cam'))\n\t\t{\n\t\t\tHardware.isCameraOn = false;\n\t\t}\n\n\t\tif (!Util.havePermissionToBroadcast('mic'))\n\t\t{\n\t\t\tHardware.isMicrophoneMuted = true;\n\t\t}\n\n\t\tthis.BitrixCall.on('Failed', this.#onCallDisconnected);\n\n\t\t//this.signaling.sendCameraState(Hardware.isCameraOn);\n\n\t\tif (!this.BitrixCall.isAudioPublished())\n\t\t{\n\t\t\tthis.#setPublishingState(MediaStreamsKinds.Microphone, true);\n\t\t}\n\t\tthis.BitrixCall.enableAudio(Hardware.isMicrophoneMuted);\n\n\t\tif (Hardware.isCameraOn)\n\t\t{\n\t\t\tthis.localVideoShown = true;\n\n\t\t\tif (!this.BitrixCall.isVideoPublished())\n\t\t\t{\n\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Camera, true);\n\t\t\t}\n\t\t\tthis.BitrixCall.enableVideo({calledFrom: 'onCallConnected'});\n\t\t}\n\n\t\tif (this.videoAllowedFrom == UserMnemonic.none)\n\t\t{\n\t\t\tthis.signaling.sendHideAll();\n\t\t}\n\t\telse if (Type.isArray(this.videoAllowedFrom))\n\t\t{\n\t\t\tthis.signaling.sendShowUsers(this.videoAllowedFrom);\n\t\t}\n\t};\n\n\t#onCallFailed(e)\n\t{\n\t\tthis.log(\"Could not attach to conference\", e);\n\t\tthis.sendTelemetryEvent(\"connect_failure\");\n\t\tthis.localUserState = UserState.Failed;\n\n\t\tthis.BitrixCall.enableSilentLogging(false);\n\t\tthis.BitrixCall.setLoggerCallback(null);\n\t};\n\n\tbindCallEvents()\n\t{\n\t\tthis.BitrixCall.on('PublishSucceed', this.#onLocalMediaRendererAdded);\n\t\tthis.BitrixCall.on('PublishPaused', this.#onLocalMediaRendererMuteToggled);\n\t\tthis.BitrixCall.on('MediaMutedBySystem', this.#onMediaMutedBySystem);\n\t\tthis.BitrixCall.on('PublishFailed', this.#onLocalMediaRendererEnded);\n\t\tthis.BitrixCall.on('PublishEnded', this.#onLocalMediaRendererEnded);\n\t\tthis.BitrixCall.on('GetUserMediaStarted', this.#onGetUserMediaStarted.bind(this));\n\t\tthis.BitrixCall.on('GetUserMediaEnded', this.#onGetUserMediaEnded);\n\t\tthis.BitrixCall.on('GetUserMediaSuccess', this.#onGetUserMediaSuccess.bind(this));\n\t\tthis.BitrixCall.on('RemoteMediaAdded', this.#onRemoteMediaAdded);\n\t\tthis.BitrixCall.on('RemoteMediaRemoved', this.#onRemoteMediaRemoved);\n\t\tthis.BitrixCall.on('RemoteMediaMuted', this.#onRemoteMediaMuteToggled);\n\t\tthis.BitrixCall.on('RemoteMediaUnmuted', this.#onRemoteMediaMuteToggled);\n\t\tthis.BitrixCall.on('ParticipantJoined', this.#onParticipantJoined);\n\t\tthis.BitrixCall.on('ParticipantStateUpdated', () => console.log('handleParticipantStateUpdated'));\n\t\tthis.BitrixCall.on('ParticipantLeaved', this.#onParticipantLeaved);\n\t\tthis.BitrixCall.on('MessageReceived', this.#onCallMessageReceived);\n\t\tthis.BitrixCall.on('HandRaised', this.#onCallHandRaised);\n\t\tthis.BitrixCall.on('VoiceStarted', this.#onEndpointVoiceStart);\n\t\tthis.BitrixCall.on('AllParticipantsAudioMuted', this.#onAllParticipantsAudioMuted);\n\t\tthis.BitrixCall.on('AllParticipantsVideoMuted', this.#onAllParticipantsVideoMuted);\n\t\tthis.BitrixCall.on('AllParticipantsScreenshareMuted', this.#onAllParticipantsScreenshareMuted);\n\t\tthis.BitrixCall.on('YouMuteAllParticipants', this.#onYouMuteAllParticipants);\n\t\tthis.BitrixCall.on('RoomSettingsChanged', this.#onRoomSettingsChanged);\n\t\tthis.BitrixCall.on('UserPermissionsChanged', this.#onUserPermissionsChanged);\n\t\tthis.BitrixCall.on('UserRoleChanged', this.#onUserRoleChanged);\n\t\tthis.BitrixCall.on('ParticipantMuted', this.#onParticipantMuted);\n\t\tthis.BitrixCall.on('VoiceEnded', this.#onEndpointVoiceEnd);\n\t\tthis.BitrixCall.on('RecorderStatusChanged', this.#onRecorderStatusChanged);\n\t\tthis.BitrixCall.on('Reconnecting', this.#onCallReconnecting);\n\t\tthis.BitrixCall.on('Reconnected', this.#onCallReconnected);\n\t\tthis.BitrixCall.on('ReconnectingFailed', this.#onCallReconnectingFailed);\n\t\tthis.BitrixCall.on('Disconnected', this.#onCallDisconnected);\n\t\t// if (Util.shouldCollectStats())\n\t\t// {\n\t\t\tthis.BitrixCall.on('CallStatsReceived', this.#onCallStatsReceived);\n\t\t// }\n\t\tthis.BitrixCall.on('UpdatePacketLoss', this.#onUpdatePacketLoss);\n\t\tthis.BitrixCall.on('ConnectionQualityChanged', this.#onConnectionQualityChanged);\n\t\tthis.BitrixCall.on('ToggleRemoteParticipantVideo', this.#onToggleRemoteParticipantVideo);\n\t\tthis.BitrixCall.on('TrackSubscriptionFailed', this.#onTrackSubscriptionFailed);\n\t};\n\n\tremoveCallEvents()\n\t{\n\t\tif (this.BitrixCall)\n\t\t{\n\t\t\tthis.BitrixCall.on('Failed', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('PublishSucceed', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('PublishFailed', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('PublishEnded', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('GetUserMediaEnded', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('RemoteMediaAdded', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('RemoteMediaRemoved', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('ParticipantJoined', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('ParticipantStateUpdated', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('ParticipantLeaved', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('MessageReceived', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('HandRaised', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('AllParticipantsAudioMuted', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('AllParticipantsVideoMuted', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('AllParticipantsScreenshareMuted', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('YouMuteAllParticipants', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('VoiceStarted', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('VoiceEnded', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('RecorderStatusChanged', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('Reconnecting', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('Reconnected', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('ReconnectingFailed', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('Disconnected', BX.DoNothing);\n\t\t\t// if (Util.shouldCollectStats())\n\t\t\t// {\n\t\t\t\tthis.BitrixCall.on('CallStatsReceived', BX.DoNothing);\n\t\t\t// }\n\t\t\tthis.BitrixCall.on('UpdatePacketLoss', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('ConnectionQualityChanged', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('ToggleRemoteParticipantVideo', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('TrackSubscriptionFailed', BX.DoNothing);\n\t\t}\n\t};\n\n\tsubscribeHardwareChanges()\n\t{\n\t\tHardware.subscribe(Hardware.Events.onChangeMicrophoneMuted, this.setMuted);\n\t\tHardware.subscribe(Hardware.Events.onChangeCameraOn, this.setVideoEnabled);\n\t};\n\n\tunsubscribeHardwareChanges()\n\t{\n\t\tHardware.unsubscribe(Hardware.Events.onChangeMicrophoneMuted, this.setMuted);\n\t\tHardware.unsubscribe(Hardware.Events.onChangeCameraOn, this.setVideoEnabled);\n\t};\n\n\t/**\n\t * Adds users, invited by you or someone else\n\t * @param {Object} users\n\t */\n\taddInvitedUsers(users)\n\t{\n\t\tfor (let id in users)\n\t\t{\n\t\t\tconst userId = Number(id);\n\t\t\tif (userId == this.userId)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (!this.peers[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t\t\tthis.runCallback(CallEvent.onUserInvited, {\n\t\t\t\t\tuserId: userId,\n\t\t\t\t\tuserData: {[userId]: users[id]},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (this.type === CallType.Instant && this.peers[userId].calculatedState !== UserState.Calling)\n\t\t\t{\n\t\t\t\tthis.peers[userId].onInvited();\n\t\t\t}\n\n\t\t\tif (!this.users.includes(userId))\n\t\t\t{\n\t\t\t\tthis.users.push(userId);\n\t\t\t}\n\t\t}\n\t};\n\n\ttoggleRemoteParticipantVideo(participantIds, showVideo, isPaginateToggle = false) {\n\t\tif (this.BitrixCall) {\n\t\t\tthis.BitrixCall.toggleRemoteParticipantVideo(participantIds, showVideo, isPaginateToggle)\n\t\t}\n\t}\n\n\tisAnyoneParticipating()\n\t{\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId].isParticipating())\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t};\n\n\tgetParticipatingUsers()\n\t{\n\t\tlet result = [];\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId].isParticipating())\n\t\t\t{\n\t\t\t\tresult.push(userId);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t};\n\n\t#onPeerStateChanged = (e) =>\n\t{\n\t\tthis.runCallback(CallEvent.onUserStateChanged, e);\n\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (e.state === UserState.Failed || e.state === UserState.Unavailable || e.state === UserState.Declined || e.state === UserState.Idle)\n\t\t{\n\t\t\tif (this.type == CallType.Instant && !this.isAnyoneParticipating())\n\t\t\t{\n\t\t\t\t// this.hangup();\n\t\t\t}\n\t\t}\n\t};\n\n\t#onPeerInviteTimeout = (e) =>\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.signaling.sendUserInviteTimeout({\n\t\t\tuserId: this.users,\n\t\t\tfailedUserId: e.userId\n\t\t})\n\t};\n\n\t#changeRecordState(params)\n\t{\n\t\tif (params.action !== View.RecordState.Started && this.recordState.userId != params.senderId)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (params.action === View.RecordState.Started)\n\t\t{\n\t\t\tif (this.recordState.state !== View.RecordState.Stopped)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.recordState.state = View.RecordState.Started;\n\t\t\tthis.recordState.userId = params.senderId;\n\t\t\tthis.recordState.date.start = params.date;\n\t\t\tthis.recordState.date.pause = [];\n\t\t}\n\t\telse if (params.action === View.RecordState.Paused)\n\t\t{\n\t\t\tif (this.recordState.state !== View.RecordState.Started)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.recordState.state = View.RecordState.Paused;\n\t\t\tthis.recordState.date.pause.push(\n\t\t\t\t{start: params.date, finish: null}\n\t\t\t);\n\t\t}\n\t\telse if (params.action === View.RecordState.Resumed)\n\t\t{\n\t\t\tif (this.recordState.state !== View.RecordState.Paused)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.recordState.state = View.RecordState.Started;\n\t\t\tconst pauseElement = this.recordState.date.pause.find(function (element)\n\t\t\t{\n\t\t\t\treturn element.finish === null;\n\t\t\t});\n\t\t\tif (pauseElement)\n\t\t\t{\n\t\t\t\tpauseElement.finish = params.date;\n\t\t\t}\n\t\t}\n\t\telse if (params.action === View.RecordState.Stopped)\n\t\t{\n\t\t\tthis.recordState.state = View.RecordState.Stopped;\n\t\t\tthis.recordState.userId = 0;\n\t\t\tthis.recordState.date.start = null;\n\t\t\tthis.recordState.date.pause = [];\n\t\t}\n\n\t\treturn true;\n\t};\n\n\t#onNoAnswer()\n\t{\n\t\tif (this.ready && !this.isAnyoneParticipating())\n\t\t{\n\t\t\tthis.destroy(true);\n\t\t}\n\t}\n\n\t__onPullEvent(command, params, extra)\n\t{\n\t\tif (this.pullEventHandlers[command])\n\t\t{\n\t\t\tif (command !== 'Call::ping')\n\t\t\t{\n\t\t\t\tthis.log(\"Signaling: \" + command + \"; Parameters: \" + JSON.stringify(params));\n\t\t\t}\n\t\t\tthis.pullEventHandlers[command].call(this, params);\n\t\t}\n\t};\n\n\t#onPullEventAnswer = (params) =>\n\t{\n\t\tconst senderId = Number(params.senderId);\n\n\t\tif (senderId == this.userId)\n\t\t{\n\t\t\treturn this.__onPullEventAnswerSelf(params);\n\t\t}\n\t};\n\n\t__onPullEventAnswerSelf(params)\n\t{\n\t\tif (params.callInstanceId === this.instanceId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// call was answered elsewhere\n\t\tthis.runCallback(CallEvent.onJoin, { local: false });\n\t}\n\n\t#onPullEventHangup = (params) => {\n\t\tconst senderId = params.senderId;\n\t\tconst callInstanceId = params.callInstanceId;\n\t\tconst peer = this.peers[senderId];\n\n\t\tif (params.code === 603)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserStateChanged, { userId: senderId, callId: params.callId, state: UserState.Declined });\n\t\t}\n\n\t\tif (this.userId === senderId && callInstanceId && this.instanceId !== callInstanceId)\n\t\t{\n\t\t\t// Call declined by the same user elsewhere\n\t\t\tthis.runCallback(CallEvent.onLeave, { local: false });\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!peer || (peer.participant && !callInstanceId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tUtil.sendLog({\n\t\t\tparams,\n\t\t\tdescription: 'GOT A #onPullEventHangup from user',\n\t\t\tpullEvent: '#onPullEventHangup',\n\t\t});\n\n\t\tif (!peer.participant)\n\t\t{\n\t\t\tif (params.code == 603)\n\t\t\t{\n\t\t\t\tpeer.setDeclined(true);\n\t\t\t}\n\t\t\telse if (params.code == 486)\n\t\t\t{\n\t\t\t\tpeer.setBusy(true);\n\t\t\t\tconsole.warn(`user ${senderId} is busy`);\n\t\t\t}\n\n\t\t\tif (this.ready && this.type === CallType.Instant && !this.isAnyoneParticipating())\n\t\t\t{\n\t\t\t\tthis.hangup();\n\t\t\t}\n\t\t}\n\t};\n\n\t#onPullEventFinish = () =>\n\t{\n\t\tthis.destroy();\n\t};\n\n\t#onPullEventSwitchTrackRecordStatus = (e) =>\n\t{\n\t\tthis.runCallback(CallEvent.onSwitchTrackRecordStatus, {\n\t\t\tisTrackRecordOn: e.isTrackRecordOn,\n\t\t\terrorCode: e.errorCode,\n\t\t});\n\t}\n\n\t#onLocalMediaRendererAdded = (e) =>\n\t{\n\t\tconst kind = MediaKinds[e];\n\t\tif (!kind)\n\t\t{\n\t\t\tthis.log(`Wrong kind for local mediaRenderer: ${e}`);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.log('__onLocalMediaRendererAdded', kind);\n\n\t\tconst isNotSupportDevicesListBeforeStream = UnsupportedBrowserFeatures.isNotSupportDevicesListBeforeStream;\n\n\t\tswitch (e) {\n\t\t\tcase MediaStreamsKinds.Camera:\n\t\t\t\tthis.BitrixCall.getLocalVideo()\n\t\t\t\t\t.then((track) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!this.videoEnabled)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst mediaRenderer = new MediaRenderer({\n\t\t\t\t\t\t\tkind,\n\t\t\t\t\t\t\ttrack,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\t\t\t\tmediaRenderer,\n\t\t\t\t\t\t\ttag: 'main',\n\t\t\t\t\t\t\tstream: mediaRenderer.stream,\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (isNotSupportDevicesListBeforeStream)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.runCallback(CallEvent.onGetUserMediaEnded, {});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase MediaStreamsKinds.Screen:\n\t\t\t\tthis.log(\"Screen shared\");\n\t\t\t\tthis.screenShared = true;\n\t\t\t\tthis.waitingLocalScreenShare = false;\n\n\t\t\t\tthis.BitrixCall.getLocalScreen()\n\t\t\t\t\t.then((tracks) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tconst mediaRenderer = new MediaRenderer({\n\t\t\t\t\t\t\tkind,\n\t\t\t\t\t\t\ttrack: tracks.video,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\t\t\t\tmediaRenderer,\n\t\t\t\t\t\t\ttag: 'screen',\n\t\t\t\t\t\t\tstream: new MediaStream(),\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase MediaStreamsKinds.Microphone:\n\t\t\t\tif (!this.BitrixCall)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.signaling.sendMicrophoneState(true);\n\t\t\t\tthis.BitrixCall.getLocalAudio()\n\t\t\t\t\t.then((track) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Microphone, false);\n\t\t\t\t\t\tthis.#onMicAccessResult({\n\t\t\t\t\t\t\tresult: true,\n\t\t\t\t\t\t\tstream: new MediaStream([track]),\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (isNotSupportDevicesListBeforeStream)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.runCallback(CallEvent.onGetUserMediaEnded, {});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\tif (Hardware.isMicrophoneMuted) // task-597518\n\t\t\t\t{\n\t\t\t\t\tthis.BitrixCall.disableAudio();\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\t#onLocalMediaRendererMuteToggled = (source, muted) => {\n\t\tif (source === MediaStreamsKinds.Microphone)\n\t\t{\n\t\t\tthis.#setPublishingState(MediaStreamsKinds.Microphone, false);\n\t\t\tthis.signaling.sendMicrophoneState(!muted);\n\t\t}\n\t\telse if (source === MediaStreamsKinds.Camera)\n\t\t{\n\t\t\tthis.#setPublishingState(MediaStreamsKinds.Camera, false);\n\t\t}\n\t};\n\n\t#onMediaMutedBySystem = (muted) =>\n\t{\n\t\tconst microphoneState = muted ? false : !Hardware.isMicrophoneMuted;\n\t\tconst cameraState = muted ? false : Hardware.isCameraOn;\n\t\tthis.signaling.sendMicrophoneState(microphoneState);\n\t\tthis.signaling.sendCameraState(cameraState);\n\t}\n\n\t#onLocalMediaRendererEnded = (e, interrupted) =>\n\t{\n\t\tconst kind = MediaKinds[e];\n\t\tif (!kind)\n\t\t{\n\t\t\tthis.log(`Wrong kind for mediaRenderer: ${e}`);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.BitrixCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tswitch (e)\n\t\t{\n\t\t\tcase MediaStreamsKinds.Camera:\n\t\t\tcase MediaStreamsKinds.Microphone:\n\t\t\t\tif (!interrupted)\n\t\t\t\t{\n\t\t\t\t\tthis.#onBeforeLocalMediaRendererRemoved(e);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase MediaStreamsKinds.Screen:\n\t\t\t\tthis.#onBeforeLocalMediaRendererRemoved(e);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t#onGetUserMediaStarted = (options) =>\n\t{\n\t\tthis.getUserMediaFulfilled = false;\n\t};\n\n\t#onGetUserMediaSuccess = (options) =>\n\t{\n\t\tif (options.video)\n\t\t{\n\t\t\tthis.signaling.sendCameraState(true);\n\t\t}\n\t}\n\n\t#onGetUserMediaEnded = () =>\n\t{\n\t\tthis.getUserMediaFulfilled = true;\n\t};\n\n\t#onBeforeLocalMediaRendererRemoved = (e) =>\n\t{\n\t\tconst kind = MediaKinds[e];\n\t\tif (!kind)\n\t\t{\n\t\t\tthis.log(`Wrong kind for mediaRenderer: ${e}`);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.BitrixCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.log(\"__onBeforeLocalMediaRendererRemoved\", kind);\n\n\t\tconst mediaRenderer = new MediaRenderer({\n\t\t\tkind,\n\t\t});\n\n\t\tswitch (e) {\n\t\t\tcase MediaStreamsKinds.Camera:\n\t\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\t\tmediaRenderer,\n\t\t\t\t\ttag: 'main',\n\t\t\t\t\tstream: new MediaStream(),\n\t\t\t\t\tremoved: true,\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase MediaStreamsKinds.Microphone:\n\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Microphone, false);\n\t\t\t\tthis.signaling.sendMicrophoneState(false);\n\t\t\t\tbreak;\n\t\t\tcase MediaStreamsKinds.Screen:\n\t\t\t\tthis.BitrixCall.stopScreenShare();\n\t\t\t\tthis.log(\"Screen is no longer shared\");\n\t\t\t\tthis.runCallback(CallEvent.onUserScreenState, {\n\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\tscreenState: false,\n\t\t\t\t});\n\t\t\t\tthis.screenShared = false;\n\t\t\t\tthis.waitingLocalScreenShare = false;\n\t\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\t\tmediaRenderer,\n\t\t\t\t\ttag: 'screen',\n\t\t\t\t\tstream: new MediaStream(),\n\t\t\t\t\tremoved: true,\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\t#onRemoteMediaAdded = (p, t) =>\n\t{\n\t\tif (p && t)\n\t\t{\n\t\t\tconst kind = MediaKinds[t.source];\n\t\t\tif (!kind)\n\t\t\t{\n\t\t\t\tthis.log(`Wrong kind for mediaRenderer: ${t.source}`);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst e = {\n\t\t\t\tmediaRenderer: new MediaRenderer({\n\t\t\t\t\tkind,\n\t\t\t\t\ttrack: t.track\n\t\t\t\t})\n\t\t\t};\n\n\t\t\tconst peer = this.peers[p.userId];\n\t\t\tif (peer)\n\t\t\t{\n\t\t\t\t// temporary solution to play new streams\n\t\t\t\t// todo: need to find what cause the problem itself\n\t\t\t\tif (!peer.participant)\n\t\t\t\t{\n\t\t\t\t\tpeer.participant = p;\n\t\t\t\t\tpeer.updateCalculatedState();\n\t\t\t\t}\n\t\t\t\tpeer.addMediaRenderer(e.mediaRenderer);\n\t\t\t}\n\n\t\t\tswitch (t.source)\n\t\t\t{\n\t\t\t\tcase MediaStreamsKinds.Camera:\n\t\t\t\t\tthis.runCallback(CallEvent.onUserCameraState, {\n\t\t\t\t\t\tuserId: p.userId,\n\t\t\t\t\t\tcameraState: !p.isMutedVideo\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase MediaStreamsKinds.Microphone:\n\t\t\t\t\tthis.runCallback(CallEvent.onUserMicrophoneState, {\n\t\t\t\t\t\tuserId: p.userId,\n\t\t\t\t\t\tmicrophoneState: !p.isMutedAudio\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tconsole.log(`[RemoteMediaAdded]: UserId: ${p.userId}, source: ${MediaKinds[t.source]}`);\n\t\t\tconst cameraStateInfo = t.source === MediaStreamsKinds.Camera ? `, cameraState: ${!p?.isMutedVideo}` : '';\n\t\t\tUtil.sendLog({ description: `[RemoteMediaAdded]: UserId: ${p.userId}, source: ${MediaKinds[t.source]}${cameraStateInfo}` });\n\t\t}\n\t};\n\n\t#onRemoteMediaRemoved = (p, t) =>\n\t{\n\t\tif (p && t) // sometimes track could be 'undefined'\n\t\t{\n\t\t\tconst kind = MediaKinds[t.source];\n\t\t\tif (!kind)\n\t\t\t{\n\t\t\t\tthis.log(`Wrong kind for mediaRenderer: ${t.source}`);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst e = {\n\t\t\t\tmediaRenderer: new MediaRenderer({\n\t\t\t\t\tkind,\n\t\t\t\t\ttrack: t.track\n\t\t\t\t})\n\t\t\t};\n\n\t\t\tconst peer = this.peers[p.userId];\n\t\t\tif (peer)\n\t\t\t{\n\t\t\t\tpeer.removeMediaRenderer(e.mediaRenderer);\n\t\t\t}\n\n\t\t\tif (t.source === MediaStreamsKinds.Camera)\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onUserCameraState, {\n\t\t\t\t\tuserId: p.userId,\n\t\t\t\t\tcameraState: false\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconsole.log(`[RemoteMediaRemoved]: UserId: ${p.userId}, source: ${MediaKinds[t.source]}`);\n\t\t\tconst cameraStateInfo = t.source === MediaStreamsKinds.Camera ? ', cameraState: false' : '';\n\t\t\tUtil.sendLog({ description: `[RemoteMediaRemoved]: UserId: ${p.userId}, source: ${MediaKinds[t.source]}${cameraStateInfo}` });\n\t\t}\n\t};\n\n\t#onRemoteMediaMuteToggled = (p, t) =>\n\t{\n\t\tif (t.source === MediaStreamsKinds.Microphone)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserMicrophoneState, {\n\t\t\t\tuserId: p.userId,\n\t\t\t\tmicrophoneState: !p.isMutedAudio\n\t\t\t});\n\t\t}\n\t}\n\n\t#onUsersInvited = (params) =>\n\t{\n\t\tthis.log('__onUsersInvited', params);\n\t\tconst users = params.users;\n\t\tconst show = params.show;\n\n\t\tif (this.type === CallType.Instant)\n\t\t{\n\t\t\tthis.addInvitedUsers(users, show);\n\t\t}\n\t};\n\n\t#onUserInviteTimeout = (params) =>\n\t{\n\t\tthis.log('__onUserInviteTimeout', params);\n\t\tconst failedUserId = params.failedUserId;\n\n\t\tif (this.peers[failedUserId])\n\t\t{\n\t\t\tthis.peers[failedUserId].onInviteTimeout(false);\n\t\t}\n\t};\n\n\t#onParticipantJoined = (p) => {\n\t\tclearTimeout(this.waitForAnswerTimeout);\n\t\tlet peer = this.peers[p.userId];\n\n\t\tif (!peer)\n\t\t{\n\t\t\tconst userId = parseInt(p.userId, 10);\n\t\t\tif (!this.users.includes(userId))\n\t\t\t{\n\t\t\t\tthis.users.push(userId);\n\t\t\t}\n\n\t\t\tpeer = this.createPeer(userId);\n\t\t\tthis.peers[userId] = peer;\n\t\t}\n\n\t\tthis.runCallback(CallEvent.onUserJoined, {\n\t\t\tuserId: p.userId,\n\t\t\tuserData: {\n\t\t\t\t[p.userId]: {\n\t\t\t\t\tname: p.name,\n\t\t\t\t\tavatar_hr: p.image,\n\t\t\t\t\tavatar: p.image,\n\t\t\t\t\tgender: p.gender,\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tif (!p.audioEnabled || p.isMutedAudio)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserMicrophoneState, {\n\t\t\t\tuserId: p.userId,\n\t\t\t\tmicrophoneState: false,\n\t\t\t});\n\t\t}\n\n\t\tif (!p.videoEnabled || p.isMutedVideo)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserCameraState, {\n\t\t\t\tuserId: p.userId,\n\t\t\t\tcameraState: false,\n\t\t\t});\n\t\t}\n\n\t\tif (p.isHandRaised)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserFloorRequest, {\n\t\t\t\tuserId: p.userId,\n\t\t\t\trequestActive: p.isHandRaised,\n\t\t\t});\n\t\t}\n\n\t\tpeer.participant = p;\n\t\tpeer.setReady(true);\n\n\t\tif (this.recordState.state !== View.RecordState.Stopped && this.recordState.userId === this.userId)\n\t\t{\n\t\t\tthis.signaling.sendRecordState(this.userId, this.recordState);\n\t\t}\n\t};\n\n\t#onParticipantLeaved = (p) => {\n\t\tconst peer = this.peers[p.userId];\n\n\t\tif (peer)\n\t\t{\n\t\t\tfor (const type in MediaStreamsKinds)\n\t\t\t{\n\t\t\t\tconst source = MediaStreamsKinds[type];\n\t\t\t\tconst kind = MediaKinds[source];\n\t\t\t\tconst e = {\n\t\t\t\t\tmediaRenderer: new MediaRenderer({\n\t\t\t\t\t\tkind,\n\t\t\t\t\t}),\n\t\t\t\t};\n\t\t\t\tpeer.removeMediaRenderer(e.mediaRenderer);\n\t\t\t}\n\t\t\tpeer.participant = null;\n\t\t\tpeer.setReady(false);\n\t\t}\n\t};\n\n\t#onMicAccessResult = (e) =>\n\t{\n\t\tif (e.result)\n\t\t{\n\t\t\tif (e.stream.getAudioTracks().length > 0)\n\t\t\t{\n\t\t\t\tif (this.localVAD)\n\t\t\t\t{\n\t\t\t\t\tthis.localVAD.destroy();\n\t\t\t\t}\n\t\t\t\tthis.localVAD = new SimpleVAD({\n\t\t\t\t\tmediaStream: e.stream,\n\t\t\t\t\tonVoiceStarted: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!Hardware.isMicrophoneMuted)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.requestFloor(false);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.#onEndpointVoiceStart({userId: this.userId});\n\t\t\t\t\t},\n\t\t\t\t\tonVoiceStopped: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#onEndpointVoiceEnd({userId: this.userId});\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tclearInterval(this.microphoneLevelInterval);\n\t\t\t\tthis.microphoneLevelInterval = setInterval(\n\t\t\t\t\t() =>this.microphoneLevel = this.localVAD.currentVolume,\n\t\t\t\t\t200\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t};\n\n\t#onCallReconnecting = (params) =>\n\t{\n\t\tif (this._reconnectionEventCount === 0)\n\t\t{\n\t\t\tparams.reconnectionEventCount = this.reconnectionEventCount + 1;\n\n\t\t\tthis.runCallback(CallEvent.onReconnecting, params);\n\t\t}\n\n\t\tif (this.reconnectionEventCount++)\n\t\t{\n\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (userId !== this.userId && this.peers.hasOwnProperty(userId) && this.peers[userId].calculatedState === UserState.Connected)\n\t\t\t{\n\t\t\t\tfor (let type in MediaStreamsKinds)\n\t\t\t\t{\n\t\t\t\t\tconst source = MediaStreamsKinds[type];\n\t\t\t\t\tconst kind = MediaKinds[source];\n\t\t\t\t\tconst e = {\n\t\t\t\t\t\tmediaRenderer: new MediaRenderer({\n\t\t\t\t\t\t\tkind,\n\t\t\t\t\t\t}),\n\t\t\t\t\t};\n\t\t\t\t\tthis.peers[userId].removeMediaRenderer(e.mediaRenderer);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t#onCallReconnected = () =>\n\t{\n\t\tthis.reconnectionEventCount = 0;\n\t\tthis.log(\"Call reconnected\");\n\t\tthis.sendTelemetryEvent(\"reconnect\");\n\t\tthis.localUserState = UserState.Connected;\n\n\t\tif (!this.BitrixCall.isAudioPublished())\n\t\t{\n\t\t\tthis.#setPublishingState(MediaStreamsKinds.Microphone, true);\n\t\t}\n\t\tthis.BitrixCall.enableAudio(Hardware.isMicrophoneMuted);\n\n\t\t//this.signaling.sendCameraState(Hardware.isCameraOn);\n\t\tif (Hardware.isCameraOn)\n\t\t{\n\t\t\tif (!this.BitrixCall.isVideoPublished())\n\t\t\t{\n\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Camera, true);\n\t\t\t}\n\t\t\tthis.BitrixCall.enableVideo({calledFrom: 'onCallReconnected'});\n\t\t}\n\n\t\tif (this.screenShared || this.waitingLocalScreenShare)\n\t\t{\n\t\t\tthis.BitrixCall.startScreenShare();\n\t\t}\n\n\t\tif (this.videoAllowedFrom == UserMnemonic.none)\n\t\t{\n\t\t\tthis.signaling.sendHideAll();\n\t\t}\n\t\telse if (Type.isArray(this.videoAllowedFrom))\n\t\t{\n\t\t\tthis.signaling.sendShowUsers(this.videoAllowedFrom);\n\t\t}\n\n\t\tthis.BitrixCall.raiseHand(this.floorRequestActive);\n\t};\n\n\t#onCallReconnectingFailed = (e, error) => {\n\t\tthis.runCallback(CallEvent.onReconnectingFailed, { error });\n\t};\n\n\t#onCallDisconnected = (e) =>\n\t{\n\t\tlet logData = {};\n\n\t\tconst evt = e && typeof e === 'object' ? e : {}\n\t\tconst {headers, leaveInformation} = evt;\n\n\t\tif (headers) {\n\t\t\tlogData = {\n\t\t\t\t...logData,\n\t\t\t\theaders,\n\t\t\t}\n\t\t}\n\n\t\tif (leaveInformation) {\n\t\t\tlogData = {\n\t\t\t\t...logData,\n\t\t\t\tleaveInformation,\n\t\t\t}\n\t\t}\n\n\t\tthis.log(\"__onCallDisconnected\", (Object.keys(logData).length ? logData : null));\n\n\t\tif (this.ready && leaveInformation?.reason !== DisconnectReason.SecurityKeyChanged)\n\t\t{\n\t\t\tthis.hangup(leaveInformation?.code, leaveInformation?.reason);\n\t\t}\n\n\t\tthis.sendTelemetryEvent(\"disconnect\");\n\n\t\tthis.localUserState = UserState.Idle;\n\n\t\tthis.ready = false;\n\t\tthis.joinedAsViewer = false;\n\t\tthis.reinitPeers();\n\n\t\tthis.localVideoShown = false;\n\t\tthis.removeCallEvents();\n\t\tthis.unsubscribeHardwareChanges();\n\n\t\tthis.state = CallState.Proceeding;\n\n\t\tif (leaveInformation?.reason === DisconnectReason.SecurityKeyChanged)\n\t\t{\n\t\t\tthis.#onFatalError(leaveInformation.reason);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (leaveInformation?.reason === DisconnectReason.RoomClosed)\n\t\t{\n\t\t\tthis.destroy();\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.runCallback(CallEvent.onLeave, {\n\t\t\tlocal: true\n\t\t});\n\t};\n\n\t#onFatalError = (error) =>\n\t{\n\t\tif (error && error.call)\n\t\t{\n\t\t\tdelete error.call;\n\t\t}\n\t\tthis.log(\"onFatalError\", error);\n\n\t\tthis.ready = false;\n\t\tthis.localUserState = UserState.Failed;\n\t\tthis.reinitPeers();\n\n\t\tthis.localVideoShown = false;\n\t\tif (this.BitrixCall)\n\t\t{\n\t\t\tthis.removeCallEvents();\n\t\t\tthis.unsubscribeHardwareChanges();\n\t\t\ttry\n\t\t\t{\n\t\t\t\tthis.BitrixCall.hangup({\n\t\t\t\t\t'X-Reason': 'Fatal error',\n\t\t\t\t\t'X-Error': typeof (error) === 'string' ? error : error.code || error.name\n\t\t\t\t})\n\t\t\t} catch (e)\n\t\t\t{\n\t\t\t\tthis.log(\"Bitrix hangup error: \", e);\n\t\t\t\tconsole.error(\"Bitrix hangup error: \", e);\n\t\t\t}\n\t\t\tthis.BitrixCall = null;\n\t\t}\n\n\t\tif (typeof (error) === \"string\")\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onCallFailure, {\n\t\t\t\tname: error\n\t\t\t});\n\t\t}\n\t\telse if (error.name)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onCallFailure, error);\n\t\t}\n\t};\n\n\t#onTrackSubscriptionFailed = (params) =>\n\t{\n\t\tthis.runCallback(CallEvent.onTrackSubscriptionFailed, params);\n\t}\n\n\t#onCallStatsReceived = (stats) =>\n\t{\n\t\tconst usersToSendReports = {};\n\t\t// to order local stats by track quality\n\t\tconst statsIndexByRid = { f: 2, h: 1, q: 0 };\n\n\t\tstats.sender.forEach((report) =>\n\t\t{\n\t\t\tif (report.userId && (report.kind === 'video' || report.kind === 'audio'))\n\t\t\t{\n\t\t\t\tif (!usersToSendReports[report.userId])\n\t\t\t\t{\n\t\t\t\t\tusersToSendReports[report.userId] = {};\n\t\t\t\t}\n\n\t\t\t\tif (report.kind === 'video')\n\t\t\t\t{\n\t\t\t\t\tif (!usersToSendReports[report.userId][report.source])\n\t\t\t\t\t{\n\t\t\t\t\t\tusersToSendReports[report.userId][report.source] = [];\n\t\t\t\t\t}\n\n\t\t\t\t\tconst index = statsIndexByRid[report.rid] || 0;\n\t\t\t\t\tusersToSendReports[report.userId][report.source][index] = report;\n\t\t\t\t}\n\t\t\t\telse if (report.kind === 'audio')\n\t\t\t\t{\n\t\t\t\t\tusersToSendReports[report.userId][report.source] = report;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tstats.recipient.forEach((report) =>\n\t\t{\n\t\t\tif (report.userId && (report.kind === 'video' || report.kind === 'audio'))\n\t\t\t{\n\t\t\t\tif (!usersToSendReports[report.userId])\n\t\t\t\t{\n\t\t\t\t\tusersToSendReports[report.userId] = {};\n\t\t\t\t}\n\t\t\t\tusersToSendReports[report.userId][report.source] = report;\n\t\t\t}\n\t\t});\n\n\t\tfor (let userId in usersToSendReports)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserStatsReceived, {\n\t\t\t\tuserId,\n\t\t\t\treport: usersToSendReports[userId]\n\t\t\t});\n\t\t}\n\n\t\t// todo: need to correct stats format\n\t\t// if (this.logger)\n\t\t// {\n\t\t// \tthis.logger.sendStat(transformVoxStats(e.stats, this.BitrixCall));\n\t\t// }\n\t}\n\n\t#onUpdatePacketLoss = (participants) =>\n\t{\n\t\tconst prevPeersWithBadConnection = new Set([...this.peersWithBadConnection.values()]);\n\t\tparticipants.forEach(userId =>\n\t\t{\n\t\t\tconst peer = this.peers[userId];\n\t\t\tif (peer)\n\t\t\t{\n\t\t\t\tif (!prevPeersWithBadConnection.has(userId))\n\t\t\t\t{\n\t\t\t\t\tthis.peersWithBadConnection.add(userId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tprevPeersWithBadConnection.delete(userId);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t#onConnectionQualityChanged = participants =>\n\t{\n\t\tObject.keys(participants).forEach(participantId => {\n\t\t\tthis.runCallback(\n\t\t\t\tCallEvent.onConnectionQualityChanged,\n\t\t\t\t{\n\t\t\t\t\tuserId: Number(participantId),\n\t\t\t\t\tscore: participants[participantId],\n\t\t\t\t}\n\t\t\t);\n\t\t})\n\t}\n\n\t#onToggleRemoteParticipantVideo = isVideoShown =>\n\t{\n\t\tthis.runCallback(\n\t\t\tCallEvent.onToggleRemoteParticipantVideo,\n\t\t\t{ isVideoShown }\n\t\t);\n\t}\n\n\t#onCallMessageReceived = (e) =>\n\t{\n\t\tlet message;\n\t\tlet peer;\n\n\t\ttry\n\t\t{\n\t\t\tmessage = JSON.parse(e.text);\n\t\t} catch (err)\n\t\t{\n\t\t\tthis.log(\"Could not parse scenario message.\", err);\n\t\t\treturn;\n\t\t}\n\n\t\tconst eventName = message.eventName;\n\t\tif (eventName === clientEvents.cameraState)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserCameraState, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\tcameraState: message.cameraState === \"Y\"\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.videoPaused)\n\t\t{\n\t\t\tif (message.senderId === this.userId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.runCallback(CallEvent.onUserVideoPaused, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\tvideoPaused: message.videoPaused === \"Y\"\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.screenState)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserScreenState, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\tscreenState: message.screenState === \"Y\"\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.recordState)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserRecordState, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\trecordState: message.recordState\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.emotion)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserEmotion, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\ttoUserId: message.toUserId,\n\t\t\t\temotion: message.emotion\n\t\t\t})\n\t\t}\n\t\telse if (eventName === clientEvents.usersInvited)\n\t\t{\n\t\t\tthis.#onUsersInvited(message);\n\t\t}\n\t\telse if (eventName === clientEvents.userInviteTimeout)\n\t\t{\n\t\t\tthis.#onUserInviteTimeout(message);\n\t\t}\n\t\telse if (eventName === clientEvents.customMessage)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onCustomMessage, {\n\t\t\t\tmessage: message.message\n\t\t\t})\n\t\t}\n\t\telse if (eventName === scenarioEvents.viewerJoined)\n\t\t{\n\t\t\tconsole.log(\"viewer \" + message.senderId + \" joined\");\n\t\t\tpeer = this.peers[message.senderId];\n\t\t\tif (peer)\n\t\t\t{\n\t\t\t\tpeer.setDirection(EndpointDirection.RecvOnly);\n\t\t\t\tpeer.setReady(true);\n\t\t\t}\n\t\t}\n\t\telse if (eventName === scenarioEvents.viewerLeft)\n\t\t{\n\t\t\tconsole.log(\"viewer \" + message.senderId + \" left\");\n\t\t\tpeer = this.peers[message.senderId];\n\t\t\tif (peer)\n\t\t\t{\n\t\t\t\tpeer.setReady(false);\n\t\t\t}\n\t\t}\n\t\telse if (eventName === clientEvents.microphoneState)\n\t\t{\n\t\t\t// do nothing\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.log(\"Unknown scenario event \" + eventName);\n\t\t}\n\t};\n\n\t#onCallHandRaised = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onUserFloorRequest, {\n\t\t\tuserId: p.userId,\n\t\t\trequestActive: p.isHandRaised\n\t\t})\n\t}\n\n\t#onAllParticipantsAudioMuted = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onAllParticipantsAudioMuted, {\n\t\t\tuserId: p.fromUserId,\n\t\t\treason: p.reason,\n\t\t})\n\t}\n\n\t#onAllParticipantsVideoMuted = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onAllParticipantsVideoMuted, {\n\t\t\tuserId: p.fromUserId,\n\t\t\treason: p.reason,\n\t\t})\n\t}\n\n\t#onAllParticipantsScreenshareMuted = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onAllParticipantsScreenshareMuted, {\n\t\t\tuserId: p.fromUserId,\n\t\t\treason: p.reason,\n\t\t})\n\t}\n\n\t#onYouMuteAllParticipants = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onYouMuteAllParticipants, {\n\t\t\tdata: p\n\t\t})\n\t}\n\n\t#onRoomSettingsChanged = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onRoomSettingsChanged, {\n\t\t\tdata: p\n\t\t})\n\t}\n\n\t#onUserPermissionsChanged = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onUserPermissionsChanged, {\n\t\t\tdata: p\n\t\t})\n\t}\n\n\t#onUserRoleChanged = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onUserRoleChanged, {\n\t\t\tdata: p\n\t\t})\n\t}\n\n\t#onParticipantMuted = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onParticipantMuted, {\n\t\t\tdata: p\n\t\t})\n\t}\n\n\t#onEndpointVoiceStart = (p) =>\n\t{\n\t\t// for local user we need to send extra signal to show unmute hint\n\t\tif (p.userId === this.userId)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserVoiceStarted, {\n\t\t\t\tuserId: p.userId,\n\t\t\t\tlocal: true,\n\t\t\t});\n\n\t\t\tif (Hardware.isMicrophoneMuted)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.runCallback(CallEvent.onUserVoiceStarted, {\n\t\t\tuserId: p.userId,\n\t\t});\n\t};\n\n\t#onEndpointVoiceEnd = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onUserVoiceStopped, {\n\t\t\tuserId: p.userId,\n\t\t});\n\t}\n\n\t#onRecorderStatusChanged = (status) => {\n\t\tconst ignoreError = status.code === RecorderStatus.DESTROYED || status.code === RecorderStatus.UNAVAILABLE;\n\t\tconst error = ignoreError ? '' : status.errMsg;\n\t\tthis._recorderState = error ? this._recorderState : status.code;\n\t\tconst isCopilotActive = this._recorderState === RecorderStatus.ENABLED;\n\t\tthis._recorderStateHasChange = true;\n\n\t\tthis.runCallback(CallEvent.onRecorderStatusChanged, {\n\t\t\terror,\n\t\t\tstatus: isCopilotActive,\n\t\t});\n\t};\n\n\tsendTelemetryEvent(eventName)\n\t{\n\t\tUtil.sendTelemetryEvent({\n\t\t\tcall_id: this.id,\n\t\t\tuser_id: this.userId,\n\t\t\tkind: \"Bitrix\",\n\t\t\tevent: eventName,\n\t\t})\n\t};\n\n\tdestroy(finishCall = false)\n\t{\n\t\tthis.ready = false;\n\t\tthis.joinedAsViewer = false;\n\t\tthis.localVideoShown = false;\n\t\tthis.floorRequestActive = false;\n\n\t\tif (this.localVAD)\n\t\t{\n\t\t\tthis.localVAD.destroy();\n\t\t\tthis.localVAD = null;\n\t\t}\n\t\tclearInterval(this.microphoneLevelInterval);\n\t\tif (this.BitrixCall)\n\t\t{\n\t\t\tthis.removeCallEvents();\n\t\t\tthis.unsubscribeHardwareChanges();\n\t\t\tthis.BitrixCall.hangup(finishCall);\n\t\t\tthis.BitrixCall = null;\n\t\t}\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers.hasOwnProperty(userId) && this.peers[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId].destroy();\n\t\t\t}\n\t\t}\n\n\t\tthis.runCallback(CallEvent.onLeave, { local: true });\n\n\t\treturn super.destroy();\n\t};\n}\n\nclass Signaling\n{\n\tconstructor(params)\n\t{\n\t\tthis.call = params.call;\n\t};\n\n\tinviteUsers(data)\n\t{\n\t\treturn this.#runRestAction(ajaxActions.invite, data);\n\t};\n\n\tsendUsersInvited(data)\n\t{\n\t\tthis.#sendMessage(clientEvents.usersInvited, {\n\t\t\tusers: data.userData,\n\t\t});\n\t}\n\n\tsendCameraState(cameraState)\n\t{\n\t\treturn this.#sendMessage(clientEvents.cameraState, {\n\t\t\tcameraState: cameraState ? \"Y\" : \"N\"\n\t\t});\n\t};\n\n\tsendVideoPaused(videoPaused)\n\t{\n\t\treturn this.#sendMessage(clientEvents.videoPaused, {\n\t\t\tvideoPaused: videoPaused ? \"Y\" : \"N\"\n\t\t});\n\t};\n\n\tsendMicrophoneState(microphoneState)\n\t{\n\t\treturn this.#sendMessage(clientEvents.microphoneState, {\n\t\t\tmicrophoneState: microphoneState ? \"Y\" : \"N\"\n\t\t});\n\t};\n\n\tsendScreenState(screenState)\n\t{\n\t\treturn this.#sendMessage(clientEvents.screenState, {\n\t\t\tscreenState: screenState ? \"Y\" : \"N\"\n\t\t});\n\t};\n\n\tsendRecordState(userId, recordState)\n\t{\n\t\tthis.#sendMessage(clientEvents.recordState, {\n\t\t\tsenderId: userId,\n\t\t\trecordState: recordState\n\t\t});\n\t};\n\n\tsendCustomMessage(message, repeatOnConnect)\n\t{\n\t\treturn this.#sendMessage(clientEvents.customMessage, {\n\t\t\tmessage: message,\n\t\t\trepeatOnConnect: !!repeatOnConnect\n\t\t});\n\t};\n\n\tsendShowUsers(users)\n\t{\n\t\treturn this.#sendMessage(clientEvents.showUsers, {\n\t\t\tusers: users\n\t\t});\n\t};\n\n\tsendShowAll()\n\t{\n\t\treturn this.#sendMessage(clientEvents.showAll, {});\n\t};\n\n\tsendHideAll()\n\t{\n\t\treturn this.#sendMessage(clientEvents.hideAll, {});\n\t};\n\n\tsendUserInviteTimeout(data)\n\t{\n\t\treturn this.#sendMessage(clientEvents.userInviteTimeout, {data});\n\t};\n\n\t#sendMessage(eventName, data)\n\t{\n\t\tif (!this.call.BitrixCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!Type.isPlainObject(data))\n\t\t{\n\t\t\tdata = {};\n\t\t}\n\t\tdata.eventName = eventName;\n\t\tdata.requestId = Util.getUuidv4();\n\t\tdata.senderId = this.call.userId;\n\n\t\tthis.call.BitrixCall.sendMessage(JSON.stringify(data));\n\t};\n\n\t#runRestAction(signalName, data)\n\t{\n\t\tif (!Type.isPlainObject(data))\n\t\t{\n\t\t\tdata = {};\n\t\t}\n\n\t\tdata.callUuid = this.call.uuid;\n\t\tdata.callInstanceId = this.call.instanceId;\n\t\tdata.requestId = Util.getUuidv4();\n\n\t\treturn BX.ajax.runAction(signalName, { data });\n\t}\n}\n\nclass Peer\n{\n\tcalculatedState: string\n\n\tconstructor(params)\n\t{\n\t\tthis.userId = params.userId;\n\t\tthis.call = params.call;\n\n\t\tthis.ready = !!params.ready;\n\t\tthis.calling = false;\n\t\tthis.declined = false;\n\t\tthis.busy = false;\n\t\tthis.inviteTimeout = false;\n\t\tthis.direction = params.direction || EndpointDirection.SendRecv;\n\n\t\tthis.stream = null;\n\t\tthis.mediaRenderers = [];\n\n\t\tthis.isIncomingVideoAllowed = params.isIncomingVideoAllowed !== false;\n\n\t\tthis.callingTimeout = 0;\n\n\t\tthis.callbacks = {\n\t\t\tonStateChanged: Type.isFunction(params.onStateChanged) ? params.onStateChanged : BX.DoNothing,\n\t\t\tonInviteTimeout: Type.isFunction(params.onInviteTimeout) ? params.onInviteTimeout : BX.DoNothing,\n\t\t\tonMediaReceived: Type.isFunction(params.onMediaReceived) ? params.onMediaReceived : BX.DoNothing,\n\t\t\tonMediaRemoved: Type.isFunction(params.onMediaRemoved) ? params.onMediaRemoved : BX.DoNothing,\n\t\t};\n\n\t\tthis.calculatedState = this.calculateState();\n\t};\n\n\tsetReady(ready)\n\t{\n\t\tready = !!ready;\n\t\tif (this.ready === ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.ready = ready;\n\t\tif (this.calling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t\tthis.inviteTimeout = false;\n\t\t}\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.declined = false;\n\t\t\tthis.busy = false;\n\t\t}\n\n\t\tthis.updateCalculatedState();\n\t}\n\n\tsetDirection(direction)\n\t{\n\t\tif (this.direction === direction)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.direction = direction;\n\t}\n\n\tsetDeclined(declined)\n\t{\n\t\tthis.declined = declined;\n\t\tif (this.calling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t}\n\t\tif (this.declined)\n\t\t{\n\t\t\tthis.ready = false;\n\t\t\tthis.busy = false;\n\t\t}\n\t\tthis.updateCalculatedState();\n\t}\n\n\tsetBusy(busy)\n\t{\n\t\tthis.busy = busy;\n\t\tif (this.calling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t}\n\t\tif (this.busy)\n\t\t{\n\t\t\tthis.ready = false;\n\t\t\tthis.declined = false;\n\t\t}\n\t\tthis.updateCalculatedState();\n\t}\n\n\tallowIncomingVideo(isIncomingVideoAllowed)\n\t{\n\t\tif (this.isIncomingVideoAllowed == isIncomingVideoAllowed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isIncomingVideoAllowed = !!isIncomingVideoAllowed;\n\t}\n\n\taddMediaRenderer(mediaRenderer)\n\t{\n\t\tthis.log('Adding media renderer for user' + this.userId, mediaRenderer);\n\n\t\tthis.mediaRenderers.push(mediaRenderer);\n\n\t\tthis.callbacks.onMediaReceived({\n\t\t\tuserId: this.userId,\n\t\t\tkind: mediaRenderer.kind,\n\t\t\tmediaRenderer: mediaRenderer\n\t\t});\n\t\tthis.updateCalculatedState();\n\t}\n\n\tremoveMediaRenderer(mediaRenderer)\n\t{\n\t\tthis.log('Removing media renderer for user' + this.userId, mediaRenderer);\n\n\t\tlet i\n\t\tthis.mediaRenderers.forEach((el, index) => {\n\t\t\tif (el.kind === mediaRenderer.kind) {\n\t\t\t\ti = index;\n\t\t\t}\n\t\t})\n\n\t\tif (i >= 0)\n\t\t{\n\t\t\tthis.mediaRenderers.splice(i, 1);\n\t\t}\n\t\tthis.callbacks.onMediaRemoved({\n\t\t\tuserId: this.userId,\n\t\t\tkind: mediaRenderer.kind,\n\t\t\tmediaRenderer: mediaRenderer\n\t\t});\n\t\tthis.updateCalculatedState();\n\t}\n\n\tcalculateState()\n\t{\n\t\tif (this.participant)\n\t\t{\n\t\t\treturn UserState.Connected;\n\t\t}\n\n\t\tif (this.calling)\n\t\t{\n\t\t\treturn UserState.Calling;\n\t\t}\n\n\t\tif (this.inviteTimeout)\n\t\t{\n\t\t\treturn UserState.Unavailable;\n\t\t}\n\n\t\tif (this.declined)\n\t\t{\n\t\t\treturn UserState.Declined;\n\t\t}\n\n\t\tif (this.busy)\n\t\t{\n\t\t\treturn UserState.Busy;\n\t\t}\n\n\t\tif (this.ready)\n\t\t{\n\t\t\treturn UserState.Ready;\n\t\t}\n\n\t\treturn UserState.Idle;\n\t}\n\n\tupdateCalculatedState()\n\t{\n\t\tconst calculatedState = this.calculateState();\n\n\t\tif (this.calculatedState !== calculatedState)\n\t\t{\n\t\t\tthis.callbacks.onStateChanged({\n\t\t\t\tuserId: this.userId,\n\t\t\t\tstate: calculatedState,\n\t\t\t\tpreviousState: this.calculatedState,\n\t\t\t\tdirection: this.direction,\n\t\t\t});\n\t\t\tthis.calculatedState = calculatedState;\n\t\t}\n\t}\n\n\tisParticipating()\n\t{\n\t\treturn ((this.calling || this.ready || this.participant) && !this.declined);\n\t}\n\n\tonInvited()\n\t{\n\t\tthis.ready = false;\n\t\tthis.inviteTimeout = false;\n\t\tthis.declined = false;\n\t\tthis.calling = true;\n\n\t\tif (this.callingTimeout)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t}\n\t\tthis.callingTimeout = setTimeout(() => this.onInviteTimeout(true), invitePeriod);\n\t\tthis.updateCalculatedState();\n\t}\n\n\tonInviteTimeout(internal)\n\t{\n\t\tclearTimeout(this.callingTimeout);\n\t\tif (!(this.calling))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.calling = false;\n\t\tthis.inviteTimeout = true;\n\t\tif (internal)\n\t\t{\n\t\t\tthis.callbacks.onInviteTimeout({\n\t\t\t\tuserId: this.userId\n\t\t\t});\n\t\t}\n\t\tthis.updateCalculatedState();\n\t}\n\n\tlog()\n\t{\n\t\tthis.call.log.apply(this.call, arguments);\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.stream)\n\t\t{\n\t\t\tUtil.sendLog({ description: 'Stop peer media stream' });\n\t\t\tUtil.stopMediaStream(this.stream);\n\t\t\tthis.stream = null;\n\t\t}\n\n\t\tthis.callbacks.onStateChanged = BX.DoNothing;\n\t\tthis.callbacks.onInviteTimeout = BX.DoNothing;\n\t\tthis.callbacks.onMediaReceived = BX.DoNothing;\n\t\tthis.callbacks.onMediaRemoved = BX.DoNothing;\n\n\t\tclearTimeout(this.callingTimeout);\n\t\tthis.callingTimeout = null;\n\t}\n}\n\nconst transformVoxStats = function (s, BitrixCall)\n{\n\tlet result = {\n\t\tconnection: s.connection,\n\t\toutboundAudio: [],\n\t\toutboundVideo: [],\n\t\tinboundAudio: [],\n\t\tinboundVideo: [],\n\t}\n\n\tlet endpoints = {};\n\tif (BitrixCall.getEndpoints)\n\t{\n\t\tBitrixCall.getEndpoints().forEach(endpoint => endpoints[endpoint.id] = endpoint)\n\t}\n\n\tif (!result.connection.timestamp)\n\t{\n\t\tresult.connection.timestamp = Date.now();\n\t}\n\tfor (let trackId in s.outbound)\n\t{\n\t\tif (!s.outbound.hasOwnProperty(trackId))\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\t\tconst statGroup = s.outbound[trackId];\n\t\tfor (let i = 0; i < statGroup.length; i++)\n\t\t{\n\t\t\tlet stat = statGroup[i];\n\t\t\tstat.trackId = trackId;\n\t\t\tif ('audioLevel' in stat)\n\t\t\t{\n\t\t\t\tresult.outboundAudio.push(stat)\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresult.outboundVideo.push(stat)\n\t\t\t}\n\t\t}\n\t}\n\tfor (let trackId in s.inbound)\n\t{\n\t\tif (!s.inbound.hasOwnProperty(trackId))\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\t\tlet stat = s.inbound[trackId];\n\t\tif (!('endpoint' in stat))\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\t\tstat.trackId = trackId;\n\t\tif ('audioLevel' in stat)\n\t\t{\n\t\t\tresult.inboundAudio.push(stat)\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (endpoints[stat.endpoint])\n\t\t\t{\n\t\t\t\tlet videoRenderer = endpoints[stat.endpoint].mediaRenderers.find(r => r.id == stat.trackId)\n\t\t\t\tif (videoRenderer && videoRenderer.element)\n\t\t\t\t{\n\t\t\t\t\tstat.actualHeight = videoRenderer.element.videoHeight;\n\t\t\t\t\tstat.actualWidth = videoRenderer.element.videoWidth;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tresult.inboundVideo.push(stat)\n\t\t}\n\t}\n\treturn result;\n\n}","import {Type} from 'main.core';\n\nexport class CallStub\n{\n\tconstructor(config)\n\t{\n\t\tthis.callId = config.callId;\n\t\tthis.lifetime = config.lifetime || 120;\n\t\tthis.callbacks = {\n\t\t\tonDelete: Type.isFunction(config.onDelete) ? config.onDelete : BX.DoNothing\n\t\t};\n\n\t\tthis.deleteTimeout = setTimeout( () =>\n\t\t{\n\t\t\tthis.callbacks.onDelete({\n\t\t\t\tcallId: this.callId\n\t\t\t})\n\t\t}, this.lifetime * 1000);\n\t};\n\n\t__onPullEvent(command, params, extra)\n\t{\n\t\t// do nothing\n\t};\n\n\tisAnyoneParticipating()\n\t{\n\t\treturn false;\n\t};\n\n\taddEventListener()\n\t{\n\t\treturn false;\n\t};\n\n\tremoveEventListener()\n\t{\n\t\treturn false;\n\t};\n\n\taddInvitedUsers()\n\t{\n\t\tconsole.error(\"unexpected call to CallStub.addInvitedUsers\");\n\t}\n\n\tdestroy()\n\t{\n\t\tclearTimeout(this.deleteTimeout);\n\t\tthis.callbacks.onDelete = BX.DoNothing;\n\t};\n}","export class CallMultiChannel\n{\n\tconstructor(name) {\n\t\tthis.channel = new BroadcastChannel(name);\n\t\tthis.senderId = Math.random().toString(36).slice(2);\n\t\tthis.requests = new Map();\n\n\t\tthis.channel.onmessage = (event) => {\n\t\t\tconst { type, requestId, senderId, payload } = event.data;\n\n\t\t\tif (type === 'response' && this.requests.has(requestId)) {\n\t\t\t\tconst req = this.requests.get(requestId);\n\n\t\t\t\tif (!req.responders.has(senderId)) {\n\t\t\t\t\treq.responders.add(senderId);\n\t\t\t\t\treq.responses.push(payload);\n\n\t\t\t\t\tif (Date.now() > req.deadline) {\n\t\t\t\t\t\treq.resolve(req.responses);\n\t\t\t\t\t\tthis.requests.delete(requestId);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (type === 'request' && senderId !== this.senderId) {\n\t\t\t\tconst result = this.handle ? this.handle(payload) : undefined;\n\n\t\t\t\tif (result !== undefined) {\n\t\t\t\t\tthis.channel.postMessage({\n\t\t\t\t\t\ttype: 'response',\n\t\t\t\t\t\trequestId,\n\t\t\t\t\t\tsenderId: this.senderId,\n\t\t\t\t\t\tpayload: result\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\texecuter(handler) {\n\t\tthis.handle = handler;\n\t}\n\n\tasync broadcastRequest(payload, { timeout = 100 } = {}) {\n\t\tconst requestId = Math.random().toString(36).slice(2);\n\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.requests.set(requestId, {\n\t\t\t\tresolve,\n\t\t\t\tresponses: [],\n\t\t\t\tresponders: new Set(),\n\t\t\t\tdeadline: Date.now() + timeout,\n\t\t\t});\n\n\t\t\tthis.channel.postMessage({\n\t\t\t\ttype: 'request',\n\t\t\t\trequestId,\n\t\t\t\tsenderId: this.senderId,\n\t\t\t\tpayload,\n\t\t\t});\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (this.requests.has(requestId)) {\n\t\t\t\t\tresolve(this.requests.get(requestId).responses);\n\t\t\t\t\tthis.requests.delete(requestId);\n\t\t\t\t}\n\t\t\t}, timeout);\n\t\t});\n\t}\n\n\tdestroy() {\n\t\tthis.channel.close();\n\t\tthis.requests.clear();\n\t}\n}","import {Type} from 'main.core'\nimport {DesktopApi} from 'im.v2.lib.desktop-api';\nimport { JoinResponseError } from '../call_api';\nimport {ServerPlainCall} from './server_plain_call'\nimport {BitrixCall} from './bitrix_call'\nimport {CallStub} from './stub'\nimport {Hardware} from '../call_hardware';\nimport Util from '../util'\nimport {AbstractCall} from './abstract_call';\nimport { CallTokenManager } from 'call.lib.call-token-manager';\nimport {CallAI} from '../call_ai';\nimport { CallMultiChannel } from '../call_multi_channel';\nimport { CallSettingsManager } from 'call.lib.settings-manager';\n\nexport const CallState = {\n\tIdle: 'Idle',\n\tProceeding: 'Proceeding',\n\tConnected: 'Connected',\n\tFinished: 'Finished'\n};\n\nexport const UserState = {\n\tIdle: 'Idle',\n\tBusy: 'Busy',\n\tCalling: 'Calling',\n\tUnavailable: 'Unavailable',\n\tDeclined: 'Declined',\n\tReady: 'Ready',\n\tConnecting: 'Connecting',\n\tConnected: 'Connected',\n\tFailed: 'Failed'\n};\n\nexport const EndpointDirection = {\n\tSendOnly: 'send',\n\tRecvOnly: 'recv',\n\tSendRecv: 'sendrecv',\n};\n\nexport const CallType = {\n\tInstant: 1,\n\tPermanent: 2\n};\n\nexport const RoomType = {\n\tSmall: 1,\n\tConference: 2,\n\tLarge: 3,\n\tPersonal: 4,\n};\n\nexport const Provider = {\n\tPlain: 'Plain',\n\tBitrix: 'Bitrix',\n};\n\nexport const StreamTag = {\n\tMain: 'main',\n\tScreen: 'screen'\n};\n\nexport const Direction = {\n\tIncoming: 'Incoming',\n\tOutgoing: 'Outgoing'\n};\n\nexport const Quality = {\n\tVeryHigh: \"very_high\",\n\tHigh: \"high\",\n\tMedium: \"medium\",\n\tLow: \"low\",\n\tVeryLow: \"very_low\"\n};\n\nexport const StartCallErrorCode = {\n\tAuthorizeError: 'AUTHORIZE_ERROR',\n\tBlankAnswer: 'BLANK_ANSWER',\n\tBlankAnswerWithErrorCode: 'BLANK_ANSWER_WITH_ERROR_CODE',\n\tErrorUnexpectedAnswer: 'ERROR_UNEXPECTED_ANSWER',\n\tAccessDenied: 'ACCESS_DENIED',\n\tNetworkError: 'NETWORK_ERROR',\n\tNoWebrtc: 'NO_WEBRTC',\n\tNotAllowedError: 'NotAllowedError',\n\tNotReadableError: 'NotReadableError',\n\tUnknownError: 'UNKNOWN_ERROR',\n};\n\nexport const DisconnectReason = {\n\tSecurityKeyChanged: 'SECURITY_KEY_CHANGED',\n\tRoomClosed: 'ROOM_CLOSED',\n};\n\nexport const UserMnemonic = {\n\tall: 'all',\n\tnone: 'none'\n};\n\ntype CreateCallOptions = {\n\ttype: number,\n\tprovider: string,\n\tentityType: string,\n\tentityId: string,\n\tjoinExisting: boolean,\n\tuserIds?: number[],\n\tvideoEnabled?: boolean,\n\tenableMicAutoParameters?: boolean,\n\tdebug?: boolean\n}\n\nexport const CallEvent = {\n\tonUserInvited: 'onUserInvited',\n\tonUserJoined: 'onUserJoined',\n\tonUserStateChanged: 'onUserStateChanged',\n\tonUserMicrophoneState: 'onUserMicrophoneState',\n\tonUserCameraState: 'onUserCameraState',\n\tonCameraPublishing: 'onCameraPublishing',\n\tonMicrophonePublishing: 'onMicrophonePublishing',\n\tonNeedResetMediaDevicesState: 'onNeedResetMediaDevicesState',\n\tonUserVideoPaused: 'onUserVideoPaused',\n\tonUserScreenState: 'onUserScreenState',\n\tonUserRecordState: 'onUserRecordState',\n\tonUserVoiceStarted: 'onUserVoiceStarted',\n\tonUserVoiceStopped: 'onUserVoiceStopped',\n\tonUserFloorRequest: 'onUserFloorRequest', // request for a permission to speak\n\tonAllParticipantsAudioMuted: 'onAllParticipantsAudioMuted',\n\tonAllParticipantsVideoMuted: 'onAllParticipantsVideoMuted',\n\tonAllParticipantsScreenshareMuted: 'onAllParticipantsScreenshareMuted',\n\tonYouMuteAllParticipants: 'onYouMuteAllParticipants',\n\tonRoomSettingsChanged: 'onRoomSettingsChanged',\n\tonUserPermissionsChanged: 'onUserPermissionsChanged',\n\tonUserRoleChanged: 'onUserRoleChanged',\n\tonParticipantMuted: 'onParticipantMuted',\n\tonUserEmotion: 'onUserEmotion',\n\tonTrackSubscriptionFailed: 'onTrackSubscriptionFailed',\n\tonUserStatsReceived: 'onUserStatsReceived',\n\tonCustomMessage: 'onCustomMessage',\n\tonLocalMediaReceived: 'onLocalMediaReceived',\n\tonLocalMediaStopped: 'onLocalMediaStopped',\n\tonLocalScreenUpdated: 'onLocalScreenUpdated',\n\tonMicrophoneLevel: 'onMicrophoneLevel',\n\tonDeviceListUpdated: 'onDeviceListUpdated',\n\tonRTCStatsReceived: 'onRTCStatsReceived',\n\tonCallFailure: 'onCallFailure',\n\tonRemoteMediaReceived: 'onRemoteMediaReceived',\n\tonRemoteMediaStopped: 'onRemoteMediaStopped',\n\tonBadNetworkIndicator: 'onBadNetworkIndicator',\n\tonConnectionQualityChanged: 'onConnectionQualityChanged',\n\tonNetworkProblem: 'onNetworkProblem',\n\tonReconnecting: 'onReconnecting',\n\tonReconnected: 'onReconnected',\n\tonReconnectingFailed: 'onReconnectingFailed',\n\tonJoin: 'onJoin',\n\tonLeave: 'onLeave',\n\tonJoinRoomOffer: 'onJoinRoomOffer',\n\tonJoinRoom: 'onJoinRoom',\n\tonLeaveRoom: 'onLeaveRoom',\n\tonListRooms: 'onListRooms',\n\tonUpdateRoom: 'onUpdateRoom',\n\tonTransferRoomSpeakerRequest: 'onTransferRoomSpeakerRequest',\n\tonTransferRoomSpeaker: 'onTransferRoomSpeaker',\n\tonDestroy: 'onDestroy',\n\tonGetUserMediaEnded: 'onGetUserMediaEnded',\n\tonUpdateLastUsedCameraId: 'onUpdateLastUsedCameraId',\n\tonToggleRemoteParticipantVideo: 'onToggleRemoteParticipantVideo',\n\tonSwitchTrackRecordStatus: 'onSwitchTrackRecordStatus',\n\tonRecorderStatusChanged: 'onRecorderStatusChanged',\n};\n\nconst ajaxActions = {\n\tcreateCall: 'im.call.create',\n\tcreateChatForChildCall: 'call.Call.createChatForChildCall',\n\tgetPublicChannels: 'pull.channel.public.list',\n\tgetCall: 'im.call.get'\n};\n\nexport const CallScheme = {\n\tclassic: 1,\n\tjwt: 2,\n};\n\nclass Engine\n{\n\thandlers = {\n\t\t'Call::incoming': this.#onPullIncomingCall.bind(this),\n\t};\n\n\tjwtPullHandlers = {\n\t\t'chatUserAdd': this.#onCallTokenUpdate.bind(this),\n\t\t'Call::callTokenUpdate': this.#onCallTokenUpdate.bind(this),\n\t\t'Call::clearCallTokens': this.#onCallTokenClear.bind(this),\n\t\t'Call::callV2AvailabilityChanged': this.#onCallV2AvailabilityChanged.bind(this),\n\t};\n\n\tconstructor()\n\t{\n\t\tthis.debugFlag = false;\n\t\tthis.calls = {};\n\t\tthis.userId = Number(BX.message('USER_ID'));\n\t\tthis.siteId = '';\n\n\t\tthis.unknownCalls = {};\n\n\t\tthis.restClient = null;\n\t\tthis.pullClient = null;\n\n\t\tthis.finishedCalls = new Set();\n\n\t\tthis.multiBroadcastClient = new CallMultiChannel('call_engine_channel');\n\n\t\tthis.init();\n\t};\n\n\tinit()\n\t{\n\t\tBX.addCustomEvent(\"onPullEvent-call\", this.#onPullEvent.bind(this));\n\t\tBX.addCustomEvent(\"onPullEvent-im\", this.#onPullEvent.bind(this));\n\t};\n\n\tgetSiteId()\n\t{\n\t\treturn this.siteId || BX.message('SITE_ID') || '';\n\t};\n\n\tsetSiteId(siteId)\n\t{\n\t\tthis.siteId = siteId;\n\t};\n\n\tgetCurrentUserId()\n\t{\n\t\treturn this.userId;\n\t};\n\n\tsetCurrentUserId(userId)\n\t{\n\t\tthis.userId = Number(userId);\n\t};\n\n\tsetRestClient(restClient)\n\t{\n\t\tthis.restClient = restClient;\n\t};\n\n\tsetPullClient(pullClient)\n\t{\n\t\tthis.pullClient = pullClient;\n\t};\n\n\tgetRestClient()\n\t{\n\t\treturn this.restClient || BX.rest;\n\t};\n\n\tgetPullClient()\n\t{\n\t\treturn this.pullClient || BX.PULL;\n\t};\n\n\tgetLogService()\n\t{\n\t\treturn BX.message(\"call_log_service\");\n\t};\n\n\tonCallCreated(call)\n\t{\n\t\tBX.onCustomEvent(window, \"CallEvents::callCreated\", [{\n\t\t\tcall: call\n\t\t}]);\n\t}\n\n\tcreateCall(config: CreateCallOptions): Promise<AbstractCall>\n\t{\n\t\treturn new Promise(async (resolve, reject) =>\n\t\t{\n\t\t\tconst callType = config.type || CallType.Instant;\n\t\t\tconst callProvider = config.provider || this.getDefaultProvider();\n\n\t\t\tif (config.joinExisting)\n\t\t\t{\n\t\t\t\tfor (let callId in this.calls)\n\t\t\t\t{\n\t\t\t\t\tif (this.calls.hasOwnProperty(callId))\n\t\t\t\t\t{\n\t\t\t\t\t\tconst call: AbstractCall = this.calls[callId];\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tcall.provider === config.provider\n\t\t\t\t\t\t\t&& call.associatedEntity.type === config.entityType\n\t\t\t\t\t\t\t&& call.associatedEntity.id === config.entityId\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.log(callId, \"Found existing call, attaching to it\");\n\t\t\t\t\t\t\tthis.onCallCreated(call);\n\n\t\t\t\t\t\t\tHardware.isCameraOn = config.videoEnabled === true;\n\n\t\t\t\t\t\t\treturn resolve({\n\t\t\t\t\t\t\t\tcall: call,\n\t\t\t\t\t\t\t\tisNew: false\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet data;\n\t\t\tconst instanceId = Util.getUuidv4();\n\t\t\ttry\n\t\t\t{\n\t\t\t\tdata = await Util.getCallConnectionData({\n\t\t\t\t\tcallToken: config.token,\n\t\t\t\t\tcallType: callType,\n\t\t\t\t\tprovider: callProvider,\n\t\t\t\t\tinstanceId: instanceId,\n\t\t\t\t\tisVideo: config.videoEnabled,\n\t\t\t\t}, config.chatInfo.chatId);\n\t\t\t}\n\t\t\tcatch(error)\n\t\t\t{\n\t\t\t\tif (Type.isObject(error) && (error instanceof JoinResponseError))\n\t\t\t\t{\n\t\t\t\t\treturn reject(error);\n\t\t\t\t}\n\n\t\t\t\treturn reject({name: 'MEDIA_SERVER_UNREACHABLE', message: `Reason: ${error?.reason} ${error?.data}`});\n\t\t\t}\n\n\t\t\tif (!data?.result?.mediaServerUrl || !data?.result?.roomData)\n\t\t\t{\n\t\t\t\treturn reject({name: 'MEDIA_SERVER_MISSING_PARAMS', message: `Incorrect signaling response`});\n\t\t\t}\n\n\t\t\tconst aiSettings = Util.getAiSettings();\n\t\t\tif (aiSettings.serviceEnabled)\n\t\t\t{\n\t\t\t\tCallAI.setup(aiSettings);\n\t\t\t}\n\n\t\t\tif (this.calls[data.result.roomId])\n\t\t\t{\n\t\t\t\tif (this.calls[data.result.roomId] instanceof CallStub)\n\t\t\t\t{\n\t\t\t\t\tthis.calls[data.result.roomId].destroy();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tconsole.warn(`Call ${data.result.roomId} already exists, returning it instead of creating a new one`);\n\n\t\t\t\t\treturn resolve({\n\t\t\t\t\t\tcall: this.calls[data.result.roomId],\n\t\t\t\t\t\tisNew: false,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tHardware.isCameraOn = config.videoEnabled === true;\n\t\t\tconst callFactory = this.#getCallFactory(callProvider);\n\t\t\tconst call = callFactory.createCall({\n\t\t\t\tuuid: data.result.roomId,\n\t\t\t\tinstanceId: instanceId,\n\t\t\t\tdirection: Direction.Outgoing,\n\t\t\t\tenableMicAutoParameters: (config.enableMicAutoParameters !== false),\n\t\t\t\tassociatedEntity: config.chatInfo,\n\t\t\t\ttype: callType,\n\t\t\t\tstartDate: new Date(data.result.startDate * 1000),\n\t\t\t\tevents: {\n\t\t\t\t\tonDestroy: this.#onCallDestroy.bind(this)\n\t\t\t\t},\n\t\t\t\tdebug: config.debug === true,\n\t\t\t\tconnectionData: {\n\t\t\t\t\tmediaServerUrl: data.result.mediaServerUrl,\n\t\t\t\t\troomData: data.result.roomData,\n\t\t\t\t},\n\t\t\t\tscheme: data.result.scheme,\n\t\t\t});\n\n\t\t\tthis.calls[call.uuid] = call;\n\n\t\t\tthis.onCallCreated(call);\n\n\t\t\tresolve({\n\t\t\t\tcall: call,\n\t\t\t\tisNew: data.result.isNew\n\t\t\t});\n\t\t});\n\t}\n\n\tcreateChildCall(parentCall, newProvider, newUsers, config)\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst callParameters = {\n\t\t\t\tnewProvider,\n\t\t\t\tcallUuid: parentCall.uuid,\n\t\t\t\tusers: newUsers,\n\t\t\t};\n\n\t\t\tBX.ajax.runAction(ajaxActions.createChatForChildCall, { data: callParameters })\n\t\t\t\t.then((response) => {\n\t\t\t\t\tconst createCallResponse = response.data;\n\t\t\t\t\tconst token = createCallResponse.token;\n\t\t\t\t\tconst chatId = createCallResponse.chatId;\n\t\t\t\t\tconst callType = CallType.Instant;\n\t\t\t\t\tconst callFactory = this.#getCallFactory(newProvider);\n\t\t\t\t\tconst instanceId = Util.getUuidv4();\n\n\t\t\t\t\tUtil.getCallConnectionData({\n\t\t\t\t\t\tinstanceId,\n\t\t\t\t\t\tcallType,\n\t\t\t\t\t\tcallToken: token,\n\t\t\t\t\t\tprovider: newProvider,\n\t\t\t\t\t\tisVideo: config.videoEnabled,\n\t\t\t\t\t\tparentUuid: parentCall.uuid,\n\t\t\t\t\t}, chatId)\n\t\t\t\t\t\t.then((data) => {\n\t\t\t\t\t\t\tif (!data?.result?.mediaServerUrl || !data?.result?.roomData)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn reject({name: 'MEDIA_SERVER_MISSING_PARAMS', message: `Incorrect signaling response`});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst call = callFactory.createCall({\n\t\t\t\t\t\t\t\tuuid: data.result.roomId,\n\t\t\t\t\t\t\t\tinstanceId: instanceId,\n\t\t\t\t\t\t\t\tinitiatorId: this.userId,\n\t\t\t\t\t\t\t\tparentUuid: parentCall.uuid,\n\t\t\t\t\t\t\t\tdirection: Direction.Outgoing,\n\t\t\t\t\t\t\t\tenableMicAutoParameters: parentCall.enableMicAutoParameters !== false,\n\t\t\t\t\t\t\t\ttype: callType,\n\t\t\t\t\t\t\t\tstartDate: data.result.startDate,\n\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\tonDestroy: this.#onCallDestroy.bind(this)\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tlogToken: createCallResponse.logToken,\n\t\t\t\t\t\t\t\tconnectionData: {\n\t\t\t\t\t\t\t\t\tmediaServerUrl: data.result.mediaServerUrl,\n\t\t\t\t\t\t\t\t\troomData: data.result.roomData,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tdebug: config.debug,\n\t\t\t\t\t\t\t\tscheme: data.result.scheme,\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tthis.calls[call.uuid] = call;\n\n\t\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\t\tcall,\n\t\t\t\t\t\t\t\tisNew: data.result.startDate,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((e) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn reject({name: 'MEDIA_SERVER_UNREACHABLE', message: `Reason: ${e.reason} ${e.data}`});\n\t\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch((e) =>\n\t\t\t\t{\n\t\t\t\t\treturn reject({name: 'MEDIA_SERVER_UNREACHABLE', message: `Reason: ${e.reason} ${e.data}`});\n\t\t\t\t});\n\t\t});\n\t};\n\n\tinstantiateCall(callFields, callToken, logToken, userData): AbstractCall\n\t{\n\t\tconst callUuid = callFields.UUID;\n\n\t\tif (this.calls[callUuid])\n\t\t{\n\t\t\tconsole.warn(`Call ${callUuid} already exists, returning it instead of creating a new one`);\n\n\t\t\treturn this.calls[callUuid];\n\t\t}\n\n\t\tconst associatedEntity = callFields['ASSOCIATED_ENTITY'];\n\t\tif (callToken)\n\t\t{\n\t\t\tCallTokenManager.setToken(associatedEntity.chatId, callToken);\n\t\t}\n\n\t\tconst callFactory = this.#getCallFactory(callFields['PROVIDER']);\n\t\tconst call = callFactory.createCall({\n\t\t\tuuid: callUuid,\n\t\t\tinstanceId: Util.getUuidv4(),\n\t\t\tinitiatorId: parseInt(callFields['INITIATOR_ID']),\n\t\t\tparentUuid: callFields['PARENT_UUID'],\n\t\t\tdirection: callFields['INITIATOR_ID'] == this.userId ? Direction.Outgoing : Direction.Incoming,\n\t\t\tassociatedEntity: {\n\t\t\t\tuserCounter: Object.keys(userData).length,\n\t\t\t\t...associatedEntity\n\t\t\t},\n\t\t\ttype: callFields['TYPE'],\n\t\t\tstartDate: callFields['START_DATE'],\n\t\t\tlogToken: logToken,\n\t\t\tscheme: callFields['SCHEME'],\n\n\t\t\tevents: {\n\t\t\t\tonDestroy: this.#onCallDestroy.bind(this)\n\t\t\t}\n\t\t});\n\n\t\tthis.calls[call.uuid] = call;\n\n\t\tthis.onCallCreated(call);\n\n\t\treturn call;\n\t};\n\n\tgetCallWithId(uuid, config): Promise<{ call: AbstractCall, isNew: boolean }>\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst call = this.calls[uuid];\n\n\t\t\tif (\n\t\t\t\t(call && call.hasConnectionData)\n\t\t\t\t|| (call && !config)\n\t\t\t)\n\t\t\t{\n\t\t\t\tresolve({ call, isNew: false });\n\t\t\t}\n\t\t\telse if (config)\n\t\t\t{\n\t\t\t\tthis.createCall(config)\n\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\tresolve(result);\n\t\t\t\t\t})\n\t\t\t\t\t.catch((error) => {\n\t\t\t\t\t\treject(error);\n\t\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst error = {\n\t\t\t\t\tname: 'CALL_NOT_FOUND',\n\t\t\t\t\tmessage: 'Call not found',\n\t\t\t\t};\n\n\t\t\t\treject(error);\n\t\t\t}\n\t\t});\n\t}\n\n\tgetCallWithDialogId(dialogId: string): ?Object\n\t{\n\t\treturn Object.values(this.calls).find((call) => call.associatedEntity?.id == dialogId);\n\t}\n\n\t#onPullEvent(command: string, params, extra)\n\t{\n\t\tif (this.jwtPullHandlers[command])\n\t\t{\n\t\t\tthis.jwtPullHandlers[command].call(this, params, extra);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst callScheme = params?.call?.SCHEME || params?.call?.scheme;\n\n\t\tif (callScheme !== CallScheme.jwt)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.handlers[command])\n\t\t{\n\t\t\tthis.handlers[command].call(this, params, extra);\n\t\t}\n\t\telse if (command.startsWith('Call::') && params.call)\n\t\t{\n\t\t\tconst callUuid = params.call?.UUID || params.call?.uuid;\n\t\t\tif (!callUuid)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet call = this.calls[callUuid];\n\n\t\t\tif (!call && command === 'Call::finish')\n\t\t\t{\n\t\t\t\tthis.log(callUuid, 'Got \"Call::finish\" before \"Call::incoming\"');\n\t\t\t\tthis.finishedCalls.add(callUuid);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.finishedCalls.has(callUuid) && command === 'Call::usersInvited')\n\t\t\t{\n\t\t\t\tcall.addDialogInfo({\n\t\t\t\t\tuserCounter: Object.keys(params.userData).length,\n\t\t\t\t\t...params.call.ASSOCIATED_ENTITY,\n\t\t\t\t});\n\t\t\t\tthis.onCallCreated(call);\n\t\t\t}\n\n\t\t\tif (call)\n\t\t\t{\n\t\t\t\tcall.__onPullEvent(command, params, extra);\n\t\t\t}\n\t\t}\n\t};\n\n\tasync #onPullIncomingCall(params, extra)\n\t{\n\t\tconsole.log('#onPullIncomingCall', location.href);\n\t\tif (extra.server_time_ago > 30)\n\t\t{\n\t\t\tconsole.error(\"Call was started too long time ago\");\n\t\t\treturn;\n\t\t}\n\n\t\tconst callFields = params.call;\n\t\tconst callUuid = callFields.uuid;\n\t\tlet call;\n\n\t\tCallAI.setup(params.aiSettings);\n\n\t\tif (this.finishedCalls.has(callUuid))\n\t\t{\n\t\t\tthis.log(callUuid, 'Got \"Call::incoming\" after \"Call::finish\"');\n\t\t\treturn;\n\t\t}\n\n\t\tCallTokenManager.setToken(callFields.associatedEntity.chatId, params.callToken);\n\n\t\tif (this.calls[callUuid] instanceof CallStub) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.calls[callUuid])\n\t\t{\n\t\t\tcall = this.calls[callUuid];\n\n\t\t\tif (!Object.keys(call.associatedEntity).length)\n\t\t\t{\n\t\t\t\tcall.addDialogInfo(callFields.associatedEntity);\n\n\t\t\t\tthis.onCallCreated(call);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst callFactory = this.#getCallFactory(callFields.provider);\n\t\t\tconst instanceId = Util.getUuidv4();\n\t\t\tcall = callFactory.createCall({\n\t\t\t\tuuid: callUuid,\n\t\t\t\tinstanceId: instanceId,\n\t\t\t\tparentId: callFields.parentId || null,\n\t\t\t\tparentUuid: callFields.parentUuid || null,\n\t\t\t\tcallFromMobile: params.isLegacyMobile === true,\n\t\t\t\tdirection: Direction.Incoming,\n\t\t\t\tinitiatorId: callFields.initiatorId,\n\t\t\t\tassociatedEntity: callFields.associatedEntity,\n\t\t\t\ttype: callFields.type,\n\t\t\t\tstartDate: callFields.startDate,\n\t\t\t\tlogToken: callFields.logToken,\n\t\t\t\tevents: {\n\t\t\t\t\tonDestroy: this.#onCallDestroy.bind(this)\n\t\t\t\t},\n\t\t\t\tscheme: callFields.scheme,\n\t\t\t});\n\n\t\t\tthis.calls[callUuid] = call;\n\n\t\t\tthis.onCallCreated(call);\n\t\t}\n\n\t\tconst broadcastResponse = await this.multiBroadcastClient.broadcastRequest(callUuid, { timeout: 100 });\n\t\tconst hasActiveCalls = broadcastResponse.some(res => res);\n\n\t\tif (call && !hasActiveCalls)\n\t\t{\n\t\t\tBX.onCustomEvent(window, \"CallEvents::incomingCall\", [{\n\t\t\t\tcall: call,\n\t\t\t\tvideo: params.video === true,\n\t\t\t\tisLegacyMobile: params.isLegacyMobile === true\n\t\t\t}]);\n\t\t}\n\t\tthis.log(call.uuid, \"Incoming call \" + call.uuid);\n\t};\n\n\t#onCallTokenUpdate(params, extra)\n\t{\n\t\tCallTokenManager.setToken(params.chatId, params.callToken);\n\t}\n\n\t#onCallTokenClear()\n\t{\n\t\tCallTokenManager.clearTokenList();\n\t}\n\n\t#onCallV2AvailabilityChanged(params, extra)\n\t{\n\t\tCallSettingsManager.jwtCallsEnabled = params.isJwtEnabled;\n\t\tCallSettingsManager.plainCallsUseJwt = params.isPlainUseJwt;\n\n\t\tif (params?.callBalancerUrl)\n\t\t{\n\t\t\tCallSettingsManager.callBalancerUrl = params.callBalancerUrl;\n\t\t}\n\t}\n\n\t#onCallDestroy(e)\n\t{\n\t\tconst callId = e.call.uuid;\n\t\tthis.calls[callId] = new CallStub({\n\t\t\tcallId: callId,\n\t\t\tonDelete: () =>\n\t\t\t{\n\t\t\t\tif (this.calls[callId])\n\t\t\t\t{\n\t\t\t\t\tdelete this.calls[callId];\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tBX.onCustomEvent(window, \"CallEvents::callDestroyed\", [{\n\t\t\tcallId: e.call.uuid\n\t\t}]);\n\t};\n\n\t#isCallAppInitialized()\n\t{\n\t\tif ('BXIM' in window && 'init' in window.BXIM)\n\t\t{\n\t\t\treturn BXIM.init;\n\t\t}\n\t\telse if (BX.Messenger && BX.Messenger.Application && BX.Messenger.Application.conference)\n\t\t{\n\t\t\treturn BX.Messenger.Application.conference.inited;\n\t\t}\n\n\t\t//TODO: support new chat\n\t\treturn true;\n\t};\n\n\tgetDefaultProvider()\n\t{\n\t\treturn Provider.Plain;\n\t};\n\n\tgetConferencePageTag(chatDialogId)\n\t{\n\t\treturn \"conference-open-\" + chatDialogId;\n\t};\n\n\t#getCallFactory(providerType: string)\n\t{\n\t\tif (providerType == Provider.Plain)\n\t\t{\n\t\t\treturn PlainCallFactory;\n\t\t}\n\t\telse if (providerType == Provider.Bitrix)\n\t\t{\n\t\t\treturn BitrixCallFactory;\n\t\t}\n\n\t\tthrow new Error(\"Unknown call provider type \" + providerType);\n\t};\n\n\tdebug(debugFlag: boolean = true): boolean\n\t{\n\t\tthis.debugFlag = !!debugFlag;\n\n\t\treturn this.debugFlag;\n\t};\n\n\tlog()\n\t{\n\t\tconst text = Util.getLogMessage.call(Util, arguments);\n\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.writeToLogFile(BX.message('USER_ID') + '.video.log', text);\n\t\t}\n\t\tif (this.debugFlag)\n\t\t{\n\t\t\tif (console)\n\t\t\t{\n\t\t\t\tconst a = ['Call log [' + Util.getTimeForLog() + ']: '];\n\t\t\t\tconsole.log.apply(this, a.concat(Array.prototype.slice.call(arguments)));\n\t\t\t}\n\t\t}\n\t};\n\n\tgetAllowedVideoQuality(participantsCount)\n\t{\n\t\tif (participantsCount < 5)\n\t\t{\n\t\t\treturn Quality.VeryHigh\n\t\t}\n\t\telse if (participantsCount < 10)\n\t\t{\n\t\t\treturn Quality.High\n\t\t}\n\t\telse if (participantsCount < 16)\n\t\t{\n\t\t\treturn Quality.Medium\n\t\t}\n\t\telse if (participantsCount < 32)\n\t\t{\n\t\t\treturn Quality.Low\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn Quality.VeryLow\n\t\t}\n\t};\n}\n\nclass PlainCallFactory\n{\n\tstatic createCall(config): ServerPlainCall\n\t{\n\t\treturn new ServerPlainCall(config);\n\t}\n}\n\nclass BitrixCallFactory\n{\n\tstatic createCall(config): BitrixCall\n\t{\n\t\treturn new BitrixCall(config);\n\t}\n}\n\nexport const CallEngine = new Engine();","import {Browser, Type, Runtime} from 'main.core';\n\nimport {AbstractCall} from './abstract_call';\nimport {CallEngine, CallState, CallEvent, UserState, Provider} from './engine';\nimport {View} from '../view/view';\nimport {SimpleVAD} from './simple_vad'\nimport {Hardware} from '../call_hardware';\nimport Util from '../util'\nimport {MediaStreamsKinds} from '../call_api';\n\nconst ajaxActions = {\n\tinvite: 'im.call.invite',\n\tcancel: 'im.call.cancel',\n\tanswer: 'im.call.answer',\n\tdecline: 'im.call.decline',\n\thangup: 'im.call.hangup',\n\tping: 'im.call.ping',\n\tnegotiationNeeded: 'im.call.negotiationNeeded',\n\tconnectionOffer: 'im.call.connectionOffer',\n\tconnectionAnswer: 'im.call.connectionAnswer',\n\ticeCandidate: 'im.call.iceCandidate'\n};\n\nconst pullEvents = {\n\tping: 'Call::ping',\n\tanswer: 'Call::answer',\n\tnegotiationNeeded: 'Call::negotiationNeeded',\n\tconnectionOffer: 'Call::connectionOffer',\n\tconnectionAnswer: 'Call::connectionAnswer',\n\ticeCandidate: 'Call::iceCandidate',\n\tvoiceStarted: 'Call::voiceStarted',\n\tvoiceStopped: 'Call::voiceStopped',\n\trecordState: 'Call::recordState',\n\tmicrophoneState: 'Call::microphoneState',\n\tcameraState: 'Call::cameraState',\n\tvideoPaused: 'Call::videoPaused',\n\tcustomMessage: 'Call::customMessage',\n\thangup: 'Call::hangup',\n\tuserInviteTimeout: 'Call::userInviteTimeout'\n};\n\nconst defaultConnectionOptions = {\n\tofferToReceiveVideo: true,\n\tofferToReceiveAudio: true\n};\n\nconst signalingConnectionRefreshPeriod = 30000;\nconst signalingWaitReplyPeriod = 10000;\n//var signalingWaitReplyPeriod = 5000;\nconst pingPeriod = 5000;\nconst backendPingPeriod = 25000;\nconst reinvitePeriod = 5500;\n\n/**\n * Implements Call interface\n * Public methods:\n * - inviteUsers\n * - cancel\n * - answer\n * - decline\n * - hangup\n * - setMuted\n * - setVideoEnabled\n * - setCameraId\n * - setMicrophoneId\n *\n * Events:\n * - onCallStateChanged //not sure about this.\n * - onUserStateChanged\n * - onUserVoiceStarted\n * - onUserVoiceStopped\n * - onLocalMediaReceived\n * - onLocalMediaStopped\n * - onLocalMediaError\n * - onDeviceListUpdated\n * - onDestroy\n */\n\nexport class PlainCall extends AbstractCall\n{\n\tpeers: {[key: number]: Peer}\n\n\tconstructor(params)\n\t{\n\t\tsuper(params)\n\n\t\tthis.callFromMobile = params.callFromMobile;\n\t\tthis.state = params.state || '';\n\n\t\tthis.peers = this.initPeers(this.users);\n\n\t\tthis.signaling = new Signaling({\n\t\t\tcall: this\n\t\t});\n\n\t\tthis.recordState = {\n\t\t\tstate: 'stopped',\n\t\t\tuserId: 0,\n\t\t\tdate: {\n\t\t\t\tstart: null,\n\t\t\t\tpause: []\n\t\t\t},\n\t\t}\n\n\t\tthis.deviceList = [];\n\n\t\tthis.turnServer = BX.message('turn_server');\n\t\tthis.turnServerLogin = BX.message('turn_server_login') || 'bitrix';\n\t\tthis.turnServerPassword = BX.message('turn_server_password') || 'bitrix';\n\n\t\tthis.pingUsersInterval = setInterval(this.pingUsers.bind(this), pingPeriod);\n\t\tthis.pingBackendInterval = setInterval(this.pingBackend.bind(this), backendPingPeriod);\n\n\t\tthis.reinviteTimeout = null;\n\t\tthis.userData = params.userData;\n\n\t\tthis._onUnloadHandler = this.#onUnload.bind(this);\n\t\tthis._onOnlineHandler = this.#onOnline.bind(this);\n\n\t\tthis.enableMicAutoParameters = params.enableMicAutoParameters !== false;\n\t\tthis.microphoneLevelInterval = null;\n\t\tthis.mediaMutedBySystem = false;\n\n\t\tthis._reconnectionEventCount = 0;\n\n\t\tthis._isCopilotActive = false;\n\t\tthis._isCopilotFeaturesEnabled = false;\n\t\tthis._isRecordWhenCopilotActivePopupAlreadyShow = null;\n\t\tthis._isBoostExpired = false;\n\n\t\twindow.addEventListener('unload', this._onUnloadHandler);\n\t\twindow.addEventListener('online', this._onOnlineHandler);\n\t}\n\n\tget provider()\n\t{\n\t\treturn Provider.Plain;\n\t}\n\n\tget isCopilotActive()\n\t{\n\t\treturn this._isCopilotActive;\n\t}\n\n\tset isCopilotActive(isCopilotActive)\n\t{\n\t\tif (isCopilotActive !== this._isCopilotActive)\n\t\t{\n\t\t\tthis._isCopilotActive = isCopilotActive;\n\t\t}\n\t}\n\n\tget isBoostExpired()\n\t{\n\t\treturn this._isBoostExpired;\n\t}\n\n\tset isBoostExpired(isBoostExpired)\n\t{\n\t\tif (isBoostExpired !== this._isBoostExpired)\n\t\t{\n\t\t\tthis._isBoostExpired = isBoostExpired;\n\t\t}\n\t}\n\n\tget isCopilotFeaturesEnabled()\n\t{\n\t\treturn this._isCopilotFeaturesEnabled;\n\t}\n\n\tset isCopilotFeaturesEnabled(isCopilotFeaturesEnabled)\n\t{\n\t\tif (isCopilotFeaturesEnabled !== this._isCopilotFeaturesEnabled)\n\t\t{\n\t\t\tthis._isCopilotFeaturesEnabled = isCopilotFeaturesEnabled;\n\t\t}\n\t}\n\n\tget isRecordWhenCopilotActivePopupAlreadyShow()\n\t{\n\t\treturn this._isRecordWhenCopilotActivePopupAlreadyShow;\n\t}\n\n\tset isRecordWhenCopilotActivePopupAlreadyShow(isRecordWhenCopilotActivePopupAlreadyShow)\n\t{\n\t\tif (isRecordWhenCopilotActivePopupAlreadyShow !== this._isRecordWhenCopilotActivePopupAlreadyShow)\n\t\t{\n\t\t\tthis._isRecordWhenCopilotActivePopupAlreadyShow = isRecordWhenCopilotActivePopupAlreadyShow;\n\t\t}\n\t}\n\n\tinitPeers(userIds)\n\t{\n\t\tlet peers = {};\n\t\tfor (let i = 0; i < userIds.length; i++)\n\t\t{\n\t\t\tconst userId = Number(userIds[i]);\n\t\t\tif (userId == this.userId)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tpeers[userId] = this.createPeer(userId);\n\t\t}\n\t\treturn peers;\n\t};\n\n\tcreatePeer(userId)\n\t{\n\t\treturn new Peer({\n\t\t\tcall: this,\n\t\t\tuserId: userId,\n\t\t\tready: userId == this.initiatorId,\n\t\t\tsignalingConnected: userId == this.initiatorId,\n\t\t\tisLegacyMobile: userId == this.initiatorId && this.callFromMobile,\n\n\t\t\tonMediaReceived: (e) =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onRemoteMediaReceived, e);\n\t\t\t},\n\t\t\tonMediaStopped: (e) =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onRemoteMediaStopped, e);\n\t\t\t},\n\t\t\tonStateChanged: this.#onPeerStateChanged.bind(this),\n\t\t\tonInviteTimeout: this.#onPeerInviteTimeout.bind(this),\n\t\t\tonRTCStatsReceived: this.#onPeerRTCStatsReceived.bind(this),\n\t\t\tonRTCQualityChanged: this.#onPeerRTCQualityChanged.bind(this),\n\t\t\tonNetworkProblem: (e) =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onNetworkProblem, e)\n\t\t\t},\n\t\t\tonReconnecting: (e) =>\n\t\t\t{\n\t\t\t\tthis._reconnectionEventCount++;\n\t\t\t\tthis.runCallback(CallEvent.onReconnecting, {\n\t\t\t\t\treconnectionEventCount: this._reconnectionEventCount,\n\t\t\t\t\treconnectionReason: e.reconnectionReason,\n\t\t\t\t\treconnectionReasonInfo: e.reconnectionReasonInfo,\n\t\t\t\t});\n\t\t\t},\n\t\t\tonReconnected: () =>\n\t\t\t{\n\t\t\t\tthis._reconnectionEventCount = 0;\n\t\t\t\tthis.runCallback(CallEvent.onReconnected);\n\t\t\t},\n\t\t\tonUpdateLastUsedCameraId: () =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onUpdateLastUsedCameraId);\n\t\t\t}\n\t\t});\n\t};\n\n\t/**\n\t * Returns call participants and their states\n\t * @return {object} userId => user state\n\t */\n\tgetUsers()\n\t{\n\t\tlet result = {};\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tresult[userId] = this.peers[userId].calculatedState;\n\t\t}\n\t\treturn result;\n\t};\n\n\tisReady()\n\t{\n\t\treturn this.ready;\n\t};\n\n\tsetVideoEnabled = (event) =>\n\t{\n\t\tif (this.videoEnabled == event.data.isCameraOn)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.videoEnabled = event.data.isCameraOn;\n\t\tconst hasVideoTracks = this.localStreams['main'] && this.localStreams['main'].getVideoTracks().length > 0;\n\n\t\tif (this.ready && hasVideoTracks !== this.videoEnabled)\n\t\t{\n\t\t\tthis.replaceLocalMediaStream().then(() =>\n\t\t\t{\n\t\t\t\tthis.signaling.sendCameraState(this.users, this.videoEnabled);\n\t\t\t}).catch(() =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\t\ttag: 'main',\n\t\t\t\t\tstream: this.localStreams['main'] || new MediaStream(),\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t};\n\n\tcanChangeMediaDevices()\n\t{\n\t\treturn !this.mediaMutedBySystem;\n\t};\n\n\tsetMuted = (event) =>\n\t{\n\t\tif (this.muted == event.data.isMicrophoneMuted)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.muted = event.data.isMicrophoneMuted;\n\t\tif (this.localStreams[\"main\"])\n\t\t{\n\t\t\tconst audioTracks = this.localStreams[\"main\"].getAudioTracks();\n\t\t\tif (audioTracks[0])\n\t\t\t{\n\t\t\t\taudioTracks[0].enabled = !this.muted;\n\t\t\t}\n\t\t}\n\n\t\tthis.signaling.sendMicrophoneState(this.users, !this.muted);\n\t\tthis.sendTalkingState();\n\t};\n\n\tsetCameraId(cameraId)\n\t{\n\t\tif (this.cameraId == cameraId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.cameraId = cameraId;\n\n\t\tif (this.ready && this.mediaMutedBySystem)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onNeedResetMediaDevicesState);\n\t\t\tthis.changedMediaMutedBySystem(false);\n\t\t}\n\t\telse if (this.ready && Hardware.isCameraOn)\n\t\t{\n\t\t\tthis.runCallback('onUpdateLastUsedCameraId');\n\t\t\tRuntime.debounce(this.replaceLocalMediaStream, 100, this)();\n\t\t}\n\t};\n\n\tsetMicrophoneId(microphoneId)\n\t{\n\t\tif (this.microphoneId == microphoneId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.microphoneId = microphoneId;\n\t\tif (this.ready)\n\t\t{\n\t\t\tif (this.mediaMutedBySystem)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tRuntime.debounce(this.replaceLocalAudioStream, 100, this)();\n\t\t}\n\t};\n\n\tgetCurrentMicrophoneId()\n\t{\n\t\tif (!this.localStreams['main'])\n\t\t{\n\t\t\treturn this.microphoneId;\n\t\t}\n\n\t\tconst audioTracks = this.localStreams['main'].getAudioTracks();\n\t\tif (audioTracks.length > 0)\n\t\t{\n\t\t\tconst audioTrackSettings = audioTracks[0].getSettings();\n\t\t\treturn audioTrackSettings.deviceId;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.microphoneId;\n\t\t}\n\t};\n\n\tuseHdVideo(flag)\n\t{\n\t\tthis.videoHd = (flag === true);\n\t};\n\n\tsendRecordState(recordState)\n\t{\n\t\trecordState.senderId = this.userId;\n\n\t\tif (!this.#changeRecordState(recordState))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst users = [this.userId].concat(this.users);\n\t\tthis.signaling.sendRecordState(users, this.recordState);\n\t};\n\n\tstopSendingStream(tag)\n\t{\n\t\t//todo: implement\n\t};\n\n\tallowVideoFrom(userList)\n\t{\n\t\t//todo: implement\n\t};\n\n\t/**\n\t * Invites users to participate in the call.\n\t **/\n\tinviteUsers(config: {users: number[], localStream: MediaStream} = {})\n\t{\n\t\tconst users = Type.isArray(config.users) ? config.users : Object.keys(this.peers);\n\t\tthis.ready = true;\n\n\t\tif (config.localStream instanceof MediaStream && !this.localStreams[\"main\"])\n\t\t{\n\t\t\tthis.localStreams[\"main\"] = config.localStream;\n\t\t}\n\n\t\tthis.getLocalMediaStream(\"main\", true).then(() =>\n\t\t{\n\t\t\tif (!this.ready)\n\t\t\t{\n\t\t\t\tthis.#beforeLeaveCall();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.subscribeHardwareChanges();\n\n\t\t\treturn this.signaling.inviteUsers({\n\t\t\t\tuserIds: users,\n\t\t\t\tvideo: Hardware.isCameraOn ? 'Y' : 'N'\n\t\t\t});\n\t\t}).then(() =>\n\t\t{\n\t\t\tthis.state = CallState.Connected;\n\t\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\t\tlocal: true\n\t\t\t});\n\n\t\t\tfor (let i = 0; i < users.length; i++)\n\t\t\t{\n\t\t\t\tconst userId = Number(users[i]);\n\t\t\t\tif (!this.peers[userId])\n\t\t\t\t{\n\t\t\t\t\tthis.peers[userId] = this.createPeer(userId);\n\n\t\t\t\t\tthis.runCallback(CallEvent.onUserInvited, {\n\t\t\t\t\t\tuserId: userId\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tthis.peers[userId].onInvited();\n\n\t\t\t\tthis.scheduleRepeatInvite();\n\t\t\t}\n\t\t}).catch((e) =>\n\t\t{\n\t\t\tconsole.error(e);\n\t\t\tthis.unsubscribeHardwareChanges();\n\t\t\tthis.runCallback(CallEvent.onCallFailure, e);\n\t\t});\n\t};\n\n\tscheduleRepeatInvite()\n\t{\n\t\tclearTimeout(this.reinviteTimeout);\n\t\tthis.reinviteTimeout = setTimeout(this.repeatInviteUsers.bind(this), reinvitePeriod)\n\t};\n\n\trepeatInviteUsers()\n\t{\n\t\tclearTimeout(this.reinviteTimeout);\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet usersToRepeatInvite = [];\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers.hasOwnProperty(userId) && this.peers[userId].calculatedState === UserState.Calling)\n\t\t\t{\n\t\t\t\tusersToRepeatInvite.push(userId);\n\t\t\t}\n\t\t}\n\t\tif (usersToRepeatInvite.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.signaling\n\t\t\t.inviteUsers({\n\t\t\t\tuserIds: usersToRepeatInvite,\n\t\t\t\tvideo: Hardware.isCameraOn ? 'Y' : 'N',\n\t\t\t\trepeated: 'Y',\n\t\t\t})\n\t\t\t.then(() => this.scheduleRepeatInvite());\n\t};\n\n\tsubscribeHardwareChanges()\n\t{\n\t\tHardware.subscribe(Hardware.Events.onChangeMicrophoneMuted, this.setMuted);\n\t\tHardware.subscribe(Hardware.Events.onChangeCameraOn, this.setVideoEnabled);\n\t};\n\n\tunsubscribeHardwareChanges()\n\t{\n\t\tHardware.unsubscribe(Hardware.Events.onChangeMicrophoneMuted, this.setMuted);\n\t\tHardware.unsubscribe(Hardware.Events.onChangeCameraOn, this.setVideoEnabled);\n\t};\n\n\tgetMediaConstraints(options = {})\n\t{\n\t\tconst audio = {};\n\t\tconst video = options.videoEnabled ? {} : false;\n\t\tconst hdVideo = !!options.hdVideo;\n\t\tconst supportedConstraints = navigator.mediaDevices.getSupportedConstraints ? navigator.mediaDevices.getSupportedConstraints() : {};\n\n\t\tif (this.microphoneId)\n\t\t{\n\t\t\taudio.deviceId = {ideal: this.microphoneId};\n\t\t}\n\n\t\tif (!this.enableMicAutoParameters)\n\t\t{\n\t\t\tif (supportedConstraints.echoCancellation)\n\t\t\t{\n\t\t\t\taudio.echoCancellation = false;\n\t\t\t}\n\t\t\tif (supportedConstraints.noiseSuppression)\n\t\t\t{\n\t\t\t\taudio.noiseSuppression = false;\n\t\t\t}\n\t\t\tif (supportedConstraints.autoGainControl)\n\t\t\t{\n\t\t\t\taudio.autoGainControl = false;\n\t\t\t}\n\t\t}\n\n\t\tif (video)\n\t\t{\n\t\t\t//video.aspectRatio = 1.7777777778;\n\t\t\tif (this.cameraId)\n\t\t\t{\n\t\t\t\tvideo.deviceId = {exact: this.cameraId};\n\t\t\t}\n\n\t\t\tif (hdVideo)\n\t\t\t{\n\t\t\t\tvideo.width = {ideal: 1280};\n\t\t\t\tvideo.height = {ideal: 720};\n\t\t\t}\n\t\t}\n\n\t\treturn {audio: audio, video: video};\n\t};\n\n\t/**\n\t * Recursively tries to get user media stream with array of constraints\n\t *\n\t * @param constraintsArray array of constraints objects\n\t * @returns {Promise}\n\t */\n\tgetUserMedia(constraintsArray)\n\t{\n\t\treturn new Promise(function (resolve, reject)\n\t\t{\n\t\t\tconst currentConstraints = constraintsArray[0];\n\t\t\tHardware.getUserMedia(currentConstraints).then(\n\t\t\t\tfunction (stream)\n\t\t\t\t{\n\t\t\t\t\tresolve(stream);\n\t\t\t\t},\n\t\t\t\tfunction (error)\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"getUserMedia error: \", error);\n\t\t\t\t\tthis.log(\"Current constraints\", currentConstraints);\n\t\t\t\t\tif (constraintsArray.length > 1)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.getUserMedia(constraintsArray.slice(1)).then(\n\t\t\t\t\t\t\tfunction (stream)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tresolve(stream);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfunction (error)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treject(error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.log(\"Last fallback constraints used, failing\");\n\t\t\t\t\t\treject(error);\n\t\t\t\t\t}\n\t\t\t\t}.bind(this)\n\t\t\t)\n\t\t}.bind(this))\n\t};\n\n\tgetLocalMediaStream(tag, fallbackToAudio)\n\t{\n\t\tif (!Type.isStringFilled(tag))\n\t\t{\n\t\t\ttag = 'main';\n\t\t}\n\t\tif (this.localStreams[tag])\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\ttag: tag,\n\t\t\t\tstream: this.localStreams[tag]\n\t\t\t});\n\t\t\treturn Promise.resolve(this.localStreams[tag]);\n\t\t}\n\n\t\tthis.log(\"Requesting access to media devices\");\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tlet constraintsArray = [];\n\t\t\tif (Hardware.isCameraOn)\n\t\t\t{\n\t\t\t\tconstraintsArray.push(this.getMediaConstraints({videoEnabled: true, hdVideo: true}));\n\t\t\t\tconstraintsArray.push(this.getMediaConstraints({videoEnabled: true, hdVideo: false}));\n\t\t\t\tif (fallbackToAudio)\n\t\t\t\t{\n\t\t\t\t\tconstraintsArray.push(this.getMediaConstraints({videoEnabled: false}));\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconstraintsArray.push(this.getMediaConstraints({videoEnabled: false}));\n\t\t\t}\n\n\t\t\tthis.getUserMedia(constraintsArray).then((stream) =>\n\t\t\t{\n\t\t\t\tthis.log(\"Local media stream received\");\n\t\t\t\tthis.localStreams[tag] = stream;\n\t\t\t\tstream.getVideoTracks().forEach((track) =>\n\t\t\t\t{\n\t\t\t\t\ttrack.addEventListener(\"ended\", () => this.onLocalVideoTrackEnded());\n\t\t\t\t\ttrack.addEventListener(\"mute\", () => this.onLocalVideoTrackMute());\n\t\t\t\t\ttrack.addEventListener(\"unmute\", () => this.onLocalVideoTrackUnmute());\n\t\t\t\t});\n\n                stream.getAudioTracks().forEach((track) =>\n                {\n                    track.addEventListener(\"ended\", () => this.onLocalAudioTrackEnded())\n                });\n\n\t\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\t\ttag: tag,\n\t\t\t\t\tstream: stream\n\t\t\t\t});\n\t\t\t\tthis.setPublishingState(MediaStreamsKinds.Camera, true);\n\t\t\t\tif (tag === 'main')\n\t\t\t\t{\n\t\t\t\t\tthis.attachVoiceDetection();\n\t\t\t\t\tif (Hardware.isMicrophoneMuted)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst audioTracks = stream.getAudioTracks();\n\t\t\t\t\t\tif (audioTracks[0])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\taudioTracks[0].enabled = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (this.deviceList.length === 0)\n\t\t\t\t{\n\t\t\t\t\tHardware.getCurrentDeviceList().then((deviceList) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.deviceList = deviceList;\n\t\t\t\t\t\tthis.runCallback(CallEvent.onDeviceListUpdated, {\n\t\t\t\t\t\t\tdeviceList: this.deviceList\n\t\t\t\t\t\t})\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tresolve(this.localStreams[tag]);\n\t\t\t}).catch((e) =>\n\t\t\t{\n\t\t\t\tthis.log(\"Could not get local media stream.\", e);\n\t\t\t\tthis.log(\"Request constraints: .\", constraintsArray);\n\t\t\t\tthis.runCallback(\"onLocalMediaError\", {\n\t\t\t\t\ttag: tag,\n\t\t\t\t\terror: e\n\t\t\t\t});\n\t\t\t\treject(e);\n\t\t\t});\n\t\t})\n\t};\n\n\tgetLocalAudioStream(tag, fallbackToAudio)\n\t{\n\t\tif (!Type.isStringFilled(tag))\n\t\t{\n\t\t\ttag = 'main';\n\t\t}\n\t\tif (this.localStreams[tag] && this.localStreams[tag].getAudioTracks().length)\n\t\t{\n\t\t\treturn Promise.resolve(this.localStreams[tag]);\n\t\t}\n\n\t\tthis.log(\"Requesting access to audio devices\");\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tlet constraintsArray = [this.getMediaConstraints({videoEnabled: false})];\n\n\t\t\tthis.getUserMedia(constraintsArray).then((stream) =>\n\t\t\t{\n\t\t\t\tthis.log(\"Local audio stream received\");\n\n\t\t\t\tif (!this.localStreams[tag]) {\n\t\t\t\t\tthis.localStreams[tag] = new MediaStream();\n\t\t\t\t}\n\n\t\t\t\tthis.localStreams[tag].addTrack(stream.getAudioTracks()[0]);\n\t\t\t\tstream.getAudioTracks().forEach((track) =>\n\t\t\t\t{\n\t\t\t\t\ttrack.addEventListener(\"ended\", () => this.onLocalAudioTrackEnded())\n\t\t\t\t});\n\n\t\t\t\tif (tag === 'main')\n\t\t\t\t{\n\t\t\t\t\tthis.attachVoiceDetection();\n\t\t\t\t\tif (this.muted)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst audioTracks = stream.getAudioTracks();\n\t\t\t\t\t\tif (audioTracks[0])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\taudioTracks[0].enabled = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (this.deviceList.length === 0)\n\t\t\t\t{\n\t\t\t\t\tHardware.getCurrentDeviceList().then((deviceList) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.deviceList = deviceList;\n\t\t\t\t\t\tthis.runCallback(CallEvent.onDeviceListUpdated, {\n\t\t\t\t\t\t\tdeviceList: this.deviceList\n\t\t\t\t\t\t})\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tresolve(this.localStreams[tag]);\n\t\t\t}).catch((e) =>\n\t\t\t{\n\t\t\t\tthis.log(\"Could not get local audio stream.\", e);\n\t\t\t\tthis.log(\"Request constraints: .\", constraintsArray);\n\t\t\t\tthis.runCallback(\"onLocalMediaError\", {\n\t\t\t\t\ttag: tag,\n\t\t\t\t\terror: e\n\t\t\t\t});\n\t\t\t\treject(e);\n\t\t\t});\n\t\t})\n\t};\n\n\tsetPublishingState(deviceType, publishing)\n\t{\n\t\tif (deviceType === MediaStreamsKinds.Camera)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onCameraPublishing, {\n\t\t\t\tpublishing\n\t\t\t});\n\t\t}\n\t\telse if (deviceType === MediaStreamsKinds.Microphone)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onMicrophonePublishing, {\n\t\t\t\tpublishing\n\t\t\t});\n\t\t}\n\t}\n\n\tstartMediaCapture()\n\t{\n\t\treturn this.getLocalMediaStream();\n\t};\n\n\tattachVoiceDetection()\n\t{\n\t\tif (this.voiceDetection)\n\t\t{\n\t\t\tthis.voiceDetection.destroy();\n\t\t}\n\t\tif (this.microphoneLevelInterval)\n\t\t{\n\t\t\tclearInterval(this.microphoneLevelInterval);\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tthis.voiceDetection = new SimpleVAD({\n\t\t\t\tmediaStream: this.localStreams['main'],\n\t\t\t\tonVoiceStarted: this.onLocalVoiceStarted.bind(this),\n\t\t\t\tonVoiceStopped: this.onLocalVoiceStopped.bind(this)\n\t\t\t})\n\n\t\t\tthis.microphoneLevelInterval = setInterval(function ()\n\t\t\t{\n\t\t\t\tthis.microphoneLevel = this.voiceDetection.currentVolume;\n\t\t\t}.bind(this), 200)\n\t\t} catch (e)\n\t\t{\n\t\t\tthis.log('Could not attach voice detection to media stream');\n\t\t}\n\t};\n\n\tgetDisplayMedia()\n\t{\n\t\treturn new Promise(function (resolve, reject)\n\t\t{\n\t\t\tif (window[\"BXDesktopSystem\"] && window[\"BXDesktopSystem\"].GetProperty('versionParts')[3] < 78) {\n\t\t\t\tHardware.getUserMedia({\n\t\t\t\t\tvideo: {\n\t\t\t\t\t\tmandatory: {\n\t\t\t\t\t\t\tchromeMediaSource: 'screen',\n\t\t\t\t\t\t\tmaxWidth: 1920,\n\t\t\t\t\t\t\tmaxHeight: 1080,\n\t\t\t\t\t\t\tmaxFrameRate: 5\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}).then(\n\t\t\t\t\tfunction (stream)\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve(stream)\n\t\t\t\t\t},\n\t\t\t\t\tfunction (error)\n\t\t\t\t\t{\n\t\t\t\t\t\treject(error)\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t\telse if (navigator.mediaDevices.getDisplayMedia)\n\t\t\t{\n\t\t\t\tnavigator.mediaDevices.getDisplayMedia({\n\t\t\t\t\tvideo: {\n\t\t\t\t\t\tcursor: 'always',\n\t\t\t\t\t\twidth: {\n\t\t\t\t\t\t\tideal: 1920\n\t\t\t\t\t\t},\n\t\t\t\t\t\theight: {\n\t\t\t\t\t\t\tideal: 1080\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tsystemAudio: \"include\",\n\t\t\t\t\taudio: true,\n\t\t\t\t}).then(\n\t\t\t\t\tfunction (stream)\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve(stream)\n\t\t\t\t\t},\n\t\t\t\t\tfunction (error)\n\t\t\t\t\t{\n\t\t\t\t\t\treject(error)\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconsole.error(\"Screen sharing is not supported\");\n\t\t\t\treject(\"Screen sharing is not supported\");\n\t\t\t}\n\t\t})\n\t};\n\n\tstartScreenSharing(changeSource)\n\t{\n\t\tchangeSource = !!changeSource;\n\t\tif (this.localStreams[\"screen\"] && !changeSource)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.waitingLocalScreenShare = true;\n\n\t\tthis.getDisplayMedia().then((stream) =>\n\t\t{\n\t\t\tthis.localStreams[\"screen\"] = stream;\n\n\t\t\tstream.getVideoTracks().forEach((track) =>\n\t\t\t{\n\t\t\t\ttrack.addEventListener(\"ended\", () => this.stopScreenSharing())\n\t\t\t});\n\n\t\t\tthis.runCallback(CallEvent.onUserScreenState, {\n\t\t\t\tuserId: this.userId,\n\t\t\t\tscreenState: true,\n\t\t\t});\n\n\t\t\tthis.runCallback(CallEvent.onLocalScreenUpdated, {\n\t\t\t\ttrack: stream.getVideoTracks()?.[0] || null,\n\t\t\t});\n\n\t\t\tif (this.ready)\n\t\t\t{\n\t\t\t\tfor (let userId in this.peers)\n\t\t\t\t{\n\t\t\t\t\tif (this.peers[userId].calculatedState === UserState.Connected)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.peers[userId].sendMedia();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t}).catch((e) =>\n\t\t{\n\t\t\tthis.log(e);\n\t\t}).finally(() =>\n\t\t{\n\t\t\tthis.waitingLocalScreenShare = false;\n\t\t})\n\t};\n\n    onLocalVideoTrackEnded()\n    {\n        if (!this.localStreams[\"main\"])\n        {\n            return;\n        }\n\n        Util.stopMediaStreamVideoTracks(this.localStreams[\"main\"])\n\n        this.runCallback(CallEvent.onLocalMediaReceived, {\n            tag: 'main',\n            stream: this.localStreams[\"main\"]\n        });\n\n        if (!this.localStreams[\"main\"].getAudioTracks().length)\n        {\n            this.localStreams[\"main\"] = null;\n        }\n\n        for (let userId in this.peers)\n        {\n            if (this.peers[userId].calculatedState === UserState.Connected)\n            {\n                this.peers[userId].sendMedia();\n            }\n        }\n    }\n\n    onLocalAudioTrackEnded()\n    {\n        if (!this.localStreams[\"main\"])\n        {\n            return;\n        }\n\n        Util.stopMediaStreamAudioTracks(this.localStreams[\"main\"])\n\n        this.runCallback(CallEvent.onLocalMediaReceived, {\n            tag: 'main',\n            stream: this.localStreams[\"main\"]\n        });\n\n\t\tif (!this.localStreams[\"main\"].getVideoTracks().length)\n\t\t{\n            this.localStreams[\"main\"] = null;\n        }\n\n        for (let userId in this.peers)\n        {\n            if (this.peers[userId].calculatedState === UserState.Connected)\n            {\n                this.peers[userId].sendMedia();\n            }\n        }\n    }\n\n\tonLocalVideoTrackMute()\n\t{\n\t\tthis.changedMediaMutedBySystem(true);\n\t\tthis.prevMainStream = this.localStreams['main'];\n\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.localStreams['main'] = null;\n\t\t\tfor (let userId in this.peers)\n\t\t\t{\n\t\t\t\tif (this.peers[userId].isReady())\n\t\t\t\t{\n\t\t\t\t\tthis.peers[userId].replaceMediaStream('main');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tonLocalVideoTrackUnmute()\n\t{\n\t\tthis.changedMediaMutedBySystem(false);\n\n\t\tif (this.prevMainStream)\n\t\t{\n\t\t\tUtil.stopMediaStream(this.prevMainStream);\n\t\t\tthis.prevMainStream = null;\n\t\t}\n\n\t\tthis.replaceLocalMediaStream().catch(() =>\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\ttag: 'main',\n\t\t\t\tstream: this.localStreams['main'] || new MediaStream(),\n\t\t\t});\n\t\t});\n\t};\n\n\tchangedMediaMutedBySystem(muted)\n\t{\n\t\tthis.mediaMutedBySystem = muted;\n\t\tconst microphoneState = muted ? false : !Hardware.isMicrophoneMuted;\n\t\tconst cameraState = muted ? false : Hardware.isCameraOn;\n\t\tthis.signaling.sendMicrophoneState(this.users, microphoneState);\n\t\tthis.signaling.sendCameraState(this.users, cameraState);\n\t};\n\n\tstopScreenSharing()\n\t{\n\t\tif (!this.localStreams[\"screen\"])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tUtil.stopMediaStream(this.localStreams[\"screen\"])\n\t\tthis.localStreams[\"screen\"] = null;\n\t\tthis.runCallback(CallEvent.onUserScreenState, {\n\t\t\tuserId: this.userId,\n\t\t\tscreenState: false,\n\t\t});\n\n\t\tthis.runCallback(CallEvent.onLocalScreenUpdated, {\n\t\t\ttrack: null,\n\t\t});\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId].calculatedState === UserState.Connected)\n\t\t\t{\n\t\t\t\tthis.peers[userId].sendMedia();\n\t\t\t}\n\t\t}\n\t};\n\n\tisScreenSharingStarted()\n\t{\n\t\treturn this.localStreams[\"screen\"] instanceof MediaStream || this.waitingLocalScreenShare;\n\t};\n\n\tonLocalVoiceStarted()\n\t{\n\t\tthis.talking = true;\n\t\tthis.sendTalkingState();\n\t};\n\n\tonLocalVoiceStopped()\n\t{\n\t\tthis.talking = false;\n\t\tthis.sendTalkingState();\n\t};\n\n\tsendTalkingState()\n\t{\n\t\tif (this.talking && !Hardware.isMicrophoneMuted)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserVoiceStarted, {\n\t\t\t\tuserId: this.userId,\n\t\t\t\tlocal: true\n\t\t\t});\n\t\t\tthis.signaling.sendVoiceStarted({\n\t\t\t\tuserId: this.users\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserVoiceStopped, {\n\t\t\t\tuserId: this.userId,\n\t\t\t\tlocal: true\n\t\t\t});\n\t\t\tthis.signaling.sendVoiceStopped({\n\t\t\t\tuserId: this.users\n\t\t\t});\n\t\t}\n\t}\n\n\tsendCustomMessage(message)\n\t{\n\t\tthis.signaling.sendCustomMessage({\n\t\t\tuserId: this.users,\n\t\t\tmessage: message\n\t\t});\n\t}\n\n\t/**\n\t * @param {Object} config\n\t * @param {bool} [config.useVideo]\n\t * @param {bool} [config.enableMicAutoParameters]\n\t * @param {MediaStream} [config.localStream]\n\t */\n\tanswer(config)\n\t{\n\t\tif (!Type.isPlainObject(config))\n\t\t{\n\t\t\tconfig = {};\n\t\t}\n\t\t/*if(this.direction !== Direction.Incoming)\n\t\t{\n\t\t\tthrow new Error('Only incoming call could be answered');\n\t\t}*/\n\n\t\tthis.ready = true;\n\t\tthis.videoEnabled = Hardware.isCameraOn;\n\t\tthis.muted = Hardware.isMicrophoneMuted;\n\t\tthis.enableMicAutoParameters = (config.enableMicAutoParameters !== false);\n\n\t\tif (config.localStream instanceof MediaStream)\n\t\t{\n\t\t\tthis.localStreams[\"main\"] = config.localStream;\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tthis.getLocalMediaStream(\"main\", true)\n\t\t\t\t.then(() =>\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!this.ready)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.#beforeLeaveCall();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.subscribeHardwareChanges();\n\n\t\t\t\t\t\tthis.state = CallState.Connected;\n\n\t\t\t\t\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\t\t\t\t\tlocal: true\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn this.sendAnswer();\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t\t.then(() => resolve())\n\t\t\t\t.catch((e) =>\n\t\t\t\t{\n\t\t\t\t\tthis.runCallback(CallEvent.onCallFailure, e);\n\t\t\t\t\treject(e)\n\t\t\t\t});\n\t\t});\n\t};\n\n\tsendAnswer()\n\t{\n\t\tthis.signaling.sendAnswer();\n\t};\n\n\tdecline(code, reason)\n\t{\n\t\tthis.ready = false;\n\n\t\tlet data = {\n\t\t\tcallId: this.id,\n\t\t\tcallInstanceId: this.instanceId,\n\t\t};\n\n\t\tif (typeof (code) != 'undefined')\n\t\t{\n\t\t\tdata.code = code;\n\t\t}\n\t\tif (typeof (reason) != 'undefined')\n\t\t{\n\t\t\tdata.reason = reason;\n\t\t}\n\n\t\tCallEngine.getRestClient().callMethod(ajaxActions.decline, data).then(() =>\n\t\t{\n\t\t\tthis.destroy();\n\t\t});\n\t};\n\n\thangup(force = false)\n\t{\n\t\tif (!this.ready && !force)\n\t\t{\n\t\t\tconst error = new Error(\"Hangup in wrong state\");\n\t\t\tthis.log(error);\n\t\t\treturn Promise.reject(error);\n\t\t}\n\n\t\tconst tempError = new Error();\n\t\ttempError.name = \"Call stack:\";\n\t\tthis.log(\"Hangup received \\n\" + tempError.stack);\n\n\t\tthis.ready = false;\n\t\tthis.state = CallState.Proceeding;\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tfor (let userId in this.peers)\n\t\t\t{\n\t\t\t\tthis.peers[userId].disconnect();\n\t\t\t}\n\n\t\t\tthis.#beforeLeaveCall();\n\n\t\t\tthis.runCallback(CallEvent.onLeave, {local: true});\n\n\t\t\tthis.signaling.sendHangup({userId: this.users})\n\t\t\t\t.then(() => resolve())\n\t\t\t\t.catch(e => reject(e))\n\t\t\t;\n\t\t});\n\t};\n\n\tpingUsers()\n\t{\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.signaling.sendPingToUsers({userId: this.users.concat(this.userId)});\n\t\t}\n\t};\n\n\tpingBackend()\n\t{\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.signaling.sendPingToBackend();\n\t\t}\n\t};\n\n\tgetState()\n\t{\n\n\t};\n\n\treplaceLocalMediaStream(tag: string = \"main\")\n\t{\n\t\tthis.setPublishingState(MediaStreamsKinds.Camera, true);\n\t\tif (this.localStreams[tag])\n\t\t{\n\t\t\tUtil.stopMediaStream(this.localStreams[tag]);\n\t\t\tthis.localStreams[tag] = null;\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tthis.getLocalMediaStream(tag).then(() =>\n\t\t\t{\n\t\t\t\tif (this.ready)\n\t\t\t\t{\n\t\t\t\t\tfor (let userId in this.peers)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.peers[userId].isReady())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.peers[userId].replaceMediaStream(tag);\n\t\t\t\t\t\t\tif (this.mediaMutedBySystem)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.changedMediaMutedBySystem(false);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tresolve();\n\t\t\t}).catch((e) =>\n\t\t\t{\n\t\t\t\tconsole.error('Could not get access to hardware; don\\'t really know what to do. error:', e);\n\t\t\t\treject(e);\n\t\t\t});\n\t\t})\n\t};\n\n\treplaceLocalAudioStream(tag: string = \"main\")\n\t{\n\t\tif (this.localStreams[tag])\n\t\t{\n\t\t\tUtil.stopMediaStreamAudioTracks(this.localStreams[tag]);\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tthis.getLocalAudioStream(tag).then(() =>\n\t\t\t{\n\t\t\t\tif (this.ready)\n\t\t\t\t{\n\t\t\t\t\tfor (let userId in this.peers)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.peers[userId].isReady())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.peers[userId].replaceMediaStream(tag);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tresolve();\n\t\t\t}).catch((e) =>\n\t\t\t{\n\t\t\t\tconsole.error('Could not get access to hardware; don\\'t really know what to do. error:', e);\n\t\t\t\treject(e);\n\t\t\t});\n\t\t})\n\t};\n\n\tsendAllStreams(userId)\n\t{\n\t\tif (!this.peers[userId])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.peers[userId].isReady())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let tag in this.localStreams)\n\t\t{\n\t\t\tif (this.localStreams[tag])\n\t\t\t{\n\t\t\t\tthis.peers[userId].sendMedia();\n\t\t\t}\n\t\t}\n\t};\n\n\tisAnyoneParticipating()\n\t{\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId].isParticipating())\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t};\n\n\tgetParticipatingUsers()\n\t{\n\t\tlet result = [];\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId].isParticipating())\n\t\t\t{\n\t\t\t\tresult.push(userId);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t};\n\n\t/**\n\t * Adds users, invited by you or someone else\n\t * @param {Number[]} users\n\t */\n\taddJoinedUsers(users)\n\t{\n\t\tfor (let i = 0; i < users.length; i++)\n\t\t{\n\t\t\tconst userId = Number(users[i]);\n\t\t\tif (userId == this.userId || this.peers[userId])\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t\tif (!this.users.includes(userId))\n\t\t\t{\n\t\t\t\tthis.users.push(userId);\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * Adds users, invited by you or someone else\n\t * @param {Number[]} users\n\t */\n\taddInvitedUsers(users)\n\t{\n\t\tfor (let i = 0; i < users.length; i++)\n\t\t{\n\t\t\tconst userId = Number(users[i]);\n\t\t\tif (userId == this.userId)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (!this.peers[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t\t\tthis.runCallback(CallEvent.onUserInvited, {\n\t\t\t\t\tuserId: userId\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (this.peers[userId].calculatedState !== UserState.Calling)\n\t\t\t{\n\t\t\t\tthis.peers[userId].onInvited();\n\t\t\t}\n\n\t\t\tif (!this.users.includes(userId))\n\t\t\t{\n\t\t\t\tthis.users.push(userId);\n\t\t\t}\n\t\t}\n\t};\n\n\t#changeRecordState(params)\n\t{\n\t\tif (params.action !== View.RecordState.Started && this.recordState.userId != params.senderId)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (params.action === View.RecordState.Started)\n\t\t{\n\t\t\tif (this.recordState.state !== View.RecordState.Stopped)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.recordState.state = View.RecordState.Started;\n\t\t\tthis.recordState.userId = params.senderId;\n\t\t\tthis.recordState.date.start = params.date;\n\t\t\tthis.recordState.date.pause = [];\n\t\t}\n\t\telse if (params.action === View.RecordState.Paused)\n\t\t{\n\t\t\tif (this.recordState.state !== View.RecordState.Started)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.recordState.state = View.RecordState.Paused;\n\t\t\tthis.recordState.date.pause.push(\n\t\t\t\t{start: params.date, finish: null}\n\t\t\t);\n\t\t}\n\t\telse if (params.action === View.RecordState.Resumed)\n\t\t{\n\t\t\tif (this.recordState.state !== View.RecordState.Paused)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.recordState.state = View.RecordState.Started;\n\t\t\tconst pauseElement = this.recordState.date.pause.find(function (element)\n\t\t\t{\n\t\t\t\treturn element.finish === null;\n\t\t\t});\n\t\t\tif (pauseElement)\n\t\t\t{\n\t\t\t\tpauseElement.finish = params.date;\n\t\t\t}\n\t\t}\n\t\telse if (params.action === View.RecordState.Stopped)\n\t\t{\n\t\t\tthis.recordState.state = View.RecordState.Stopped;\n\t\t\tthis.recordState.userId = 0;\n\t\t\tthis.recordState.date.start = null;\n\t\t\tthis.recordState.date.pause = [];\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t__onPullEvent(command, params, extra)\n\t{\n\t\tconst handlers = {\n\t\t\t'Call::answer': this.#onPullEventAnswer.bind(this),\n\t\t\t'Call::hangup': this.#onPullEventHangup.bind(this),\n\t\t\t'Call::ping': this.#onPullEventPing.bind(this),\n\t\t\t'Call::negotiationNeeded': this.#onPullEventNegotiationNeeded.bind(this),\n\t\t\t'Call::connectionOffer': this.#onPullEventConnectionOffer.bind(this),\n\t\t\t'Call::connectionAnswer': this.#onPullEventConnectionAnswer.bind(this),\n\t\t\t'Call::iceCandidate': this.#onPullEventIceCandidate.bind(this),\n\t\t\t'Call::voiceStarted': this.#onPullEventVoiceStarted.bind(this),\n\t\t\t'Call::voiceStopped': this.#onPullEventVoiceStopped.bind(this),\n\t\t\t'Call::microphoneState': this.#onPullEventMicrophoneState.bind(this),\n\t\t\t'Call::cameraState': this.#onPullEventCameraState.bind(this),\n\t\t\t'Call::videoPaused': this.#onPullEventVideoPaused.bind(this),\n\t\t\t'Call::recordState': this.#onPullEventRecordState.bind(this),\n\t\t\t'Call::usersJoined': this.#onPullEventUsersJoined.bind(this),\n\t\t\t'Call::usersInvited': this.#onPullEventUsersInvited.bind(this),\n\t\t\t'Call::userInviteTimeout': this.#onPullEventUserInviteTimeout.bind(this),\n\t\t\t'Call::associatedEntityReplaced': this.#onPullEventAssociatedEntityReplaced.bind(this),\n\t\t\t'Call::finish': this.#onPullEventFinish.bind(this),\n\t\t\t'Call::repeatAnswer': this.#onPullEventRepeatAnswer.bind(this),\n\t\t\t'Call::customMessage': this.#onPullEventCallCustomMessage.bind(this),\n\t\t};\n\n\t\tif (handlers[command])\n\t\t{\n\t\t\tif (command === 'Call::ping')\n\t\t\t{\n\t\t\t\tif (params.senderId != this.userId || params.instanceId != this.instanceId)\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"Signaling: ping from user \" + params.senderId);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.log(\"Signaling: \" + command + \"; Parameters: \" + JSON.stringify(params));\n\t\t\t}\n\t\t\thandlers[command].call(this, params);\n\t\t}\n\t};\n\n\t#onPullEventUsersJoined(params)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst users = params.users;\n\n\t\tthis.addJoinedUsers(users);\n\t};\n\n\t#onPullEventUsersInvited(params)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst users = params.users;\n\n\t\tthis.addInvitedUsers(users);\n\t};\n\n\t#onPullEventUserInviteTimeout(params)\n\t{\n\t\tthis.log('__onPullEventUserInviteTimeout', params);\n\t\tconst failedUserId = params.failedUserId;\n\n\t\tif (this.peers[failedUserId])\n\t\t{\n\t\t\tthis.peers[failedUserId].onInviteTimeout(false);\n\t\t}\n\t};\n\n\t#onPullEventAnswer(params)\n\t{\n\t\tconst senderId = Number(params.senderId);\n\n\t\tif (senderId == this.userId)\n\t\t{\n\t\t\treturn this.#onPullEventAnswerSelf(params);\n\t\t}\n\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.peers[senderId])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.peers[senderId].isReady())\n\t\t{\n\t\t\tthis.log(\"Received answer for user \" + senderId + \" in ready state, ignoring\");\n\t\t\treturn;\n\t\t}\n\n\t\tthis.peers[senderId].setSignalingConnected(true);\n\t\tthis.peers[senderId].setReady(true);\n\t\tthis.peers[senderId].isLegacyMobile = params.isLegacyMobile === true;\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.sendAllStreams(senderId);\n\t\t}\n\t};\n\n\t#onPullEventAnswerSelf(params)\n\t{\n\t\tthis.runCallback('onGetUserMediaEnded', {});\n\t\tif (params.callInstanceId === this.instanceId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.log(\"Received remote self-answer in ready state, ignoring\");\n\t\t\treturn;\n\t\t}\n\n\t\t// call was answered elsewhere\n\t\tthis.log(\"Call was answered elsewhere\");\n\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\tlocal: false\n\t\t});\n\t};\n\n\t#onPullEventHangup(params)\n\t{\n\t\tconst senderId = params.senderId;\n\n\t\tif (this.userId == senderId)\n\t\t{\n\t\t\tif (this.instanceId != params.callInstanceId)\n\t\t\t{\n\t\t\t\t// self hangup elsewhere\n\t\t\t\tthis.runCallback(CallEvent.onLeave, {local: false});\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.peers[senderId])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.peers[senderId].disconnect(params.code);\n\t\tthis.peers[senderId].setReady(false);\n\n\t\tif (params.code == 603)\n\t\t{\n\t\t\tthis.peers[senderId].setDeclined(true);\n\t\t}\n\n\t\tif (!this.isAnyoneParticipating() && this.ready)\n\t\t{\n\t\t\tthis.hangup();\n\t\t}\n\t};\n\n\t#onPullEventPing(params)\n\t{\n\t\tif (params.callInstanceId == this.instanceId)\n\t\t{\n\t\t\t// ignore self ping\n\t\t\treturn;\n\t\t}\n\n\t\tconst peer = this.peers[params.senderId];\n\t\tif (!peer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tpeer.setSignalingConnected(true);\n\t};\n\n\t#onPullEventNegotiationNeeded(params)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet peer: Peer = this.peers[params.senderId];\n\t\tif (!peer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tpeer.setReady(true);\n\t\tif (params.restart)\n\t\t{\n\t\t\tpeer.reconnect({reconnectionReason: 'GOT_PULL_EVENT_NEGOTIATION_NEEDED'});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpeer.onNegotiationNeeded();\n\t\t}\n\t};\n\n\t#onPullEventConnectionOffer(params)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst peer = this.peers[params.senderId];\n\t\tif (!peer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tpeer.setReady(true);\n\t\tpeer.setUserAgent(params.userAgent);\n\t\tpeer.setConnectionOffer(params.connectionId, params.sdp, params.tracks);\n\t};\n\n\t#onPullEventConnectionAnswer(params)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst peer = this.peers[params.senderId];\n\t\tif (!peer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst connectionId = params.connectionId;\n\n\t\tpeer.setUserAgent(params.userAgent);\n\t\tpeer.setConnectionAnswer(connectionId, params.sdp, params.tracks);\n\t};\n\n\t#onPullEventIceCandidate(params)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst peer = this.peers[params.senderId];\n\t\tlet candidates;\n\t\tif (!peer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tcandidates = params.candidates;\n\t\t\tfor (let i = 0; i < candidates.length; i++)\n\t\t\t{\n\t\t\t\tpeer.addIceCandidate(params.connectionId, candidates[i]);\n\t\t\t}\n\t\t} catch (e)\n\t\t{\n\t\t\tthis.log('Error parsing serialized candidate: ', e);\n\t\t}\n\t};\n\n\t#onPullEventVoiceStarted(params)\n\t{\n\t\tthis.runCallback(CallEvent.onUserVoiceStarted, {\n\t\t\tuserId: params.senderId\n\t\t})\n\t};\n\n\t#onPullEventVoiceStopped(params)\n\t{\n\t\tthis.runCallback(CallEvent.onUserVoiceStopped, {\n\t\t\tuserId: params.senderId\n\t\t})\n\t};\n\n\t#onPullEventMicrophoneState(params)\n\t{\n\t\tthis.runCallback(CallEvent.onUserMicrophoneState, {\n\t\t\tuserId: params.senderId,\n\t\t\tmicrophoneState: params.microphoneState\n\t\t})\n\t};\n\n\t#onPullEventCameraState(params)\n\t{\n\t\tthis.runCallback(CallEvent.onUserCameraState, {\n\t\t\tuserId: params.senderId,\n\t\t\tcameraState: params.cameraState\n\t\t})\n\t};\n\n\t#onPullEventVideoPaused(params)\n\t{\n\t\tconst peer = this.peers[params.senderId];\n\t\tif (!peer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.runCallback(CallEvent.onUserVideoPaused, {\n\t\t\tuserId: params.senderId,\n\t\t\tvideoPaused: params.videoPaused\n\t\t});\n\n\t\tpeer.holdOutgoingVideo(!!params.videoPaused);\n\t};\n\n\t#onPullEventRecordState(params)\n\t{\n\t\tthis.runCallback(CallEvent.onUserRecordState, {\n\t\t\tuserId: params.senderId,\n\t\t\trecordState: params.recordState\n\t\t})\n\t};\n\n\t#onPullEventAssociatedEntityReplaced(params)\n\t{\n\t\tif (params.call && params.call.ASSOCIATED_ENTITY)\n\t\t{\n\t\t\tthis.associatedEntity = params.call.ASSOCIATED_ENTITY;\n\t\t}\n\t};\n\n\t#onPullEventFinish()\n\t{\n\t\tthis.destroy();\n\t};\n\n\t#onPullEventRepeatAnswer()\n\t{\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.signaling.sendAnswer({userId: this.userId}, true);\n\t\t}\n\t};\n\n\t#onPullEventCallCustomMessage(params)\n\t{\n\t\tthis.runCallback(CallEvent.onCustomMessage, {message: params.message});\n\t}\n\n\t#onPeerStateChanged(e)\n\t{\n\t\tthis.runCallback(CallEvent.onUserStateChanged, e);\n\n\t\tif (e.state == UserState.Failed || e.state == UserState.Unavailable)\n\t\t{\n\t\t\tif (!this.isAnyoneParticipating())\n\t\t\t{\n\t\t\t\tthis.hangup().then(this.destroy.bind(this)).catch(() =>\n\t\t\t\t\t{\n\t\t\t\t\t\t//this.runCallback(Event.onCallFailure, e);\n\t\t\t\t\t\tthis.destroy();\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\telse if (e.state == UserState.Connected)\n\t\t{\n\t\t\tthis.signaling.sendMicrophoneState(e.userId, !Hardware.isMicrophoneMuted);\n\t\t\tthis.signaling.sendCameraState(e.userId, Hardware.isCameraOn);\n\t\t\tthis.wasConnected = true;\n\t\t}\n\t};\n\n\t#onPeerInviteTimeout(e)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.signaling.sendUserInviteTimeout({\n\t\t\tuserId: this.users,\n\t\t\tfailedUserId: e.userId\n\t\t})\n\t};\n\n\t#onPeerRTCStatsReceived(e)\n\t{\n\t\tconst remoteReportsToShow = {};\n\t\tconst localReportsToShow = {};\n\n\t\te.stats.forEach((report) =>\n\t\t{\n\t\t\tif (report.type === 'inbound-rtp' && (report.kind === 'video' || report.kind === 'audio') && report.source)\n\t\t\t{\n\t\t\t\tremoteReportsToShow[report.source] = report;\n\t\t\t}\n\t\t\tif (report.type === 'outbound-rtp' && (report.kind === 'video' || report.kind === 'audio') && report.source)\n\t\t\t{\n\t\t\t\tlocalReportsToShow[report.source] = report;\n\t\t\t}\n\t\t});\n\n\t\tthis.runCallback(CallEvent.onUserStatsReceived, {\n\t\t\tuserId: e.userId,\n\t\t\treport: remoteReportsToShow\n\t\t});\n\n\t\tthis.runCallback(CallEvent.onUserStatsReceived, {\n\t\t\tuserId: this.userId,\n\t\t\treport: localReportsToShow\n\t\t});\n\n\t\tthis.runCallback(CallEvent.onRTCStatsReceived, e);\n\t};\n\n\t#onPeerRTCQualityChanged(e)\n\t{\n\t\tthis.runCallback(CallEvent.onConnectionQualityChanged, {\n\t\t\tuserId: e.userId,\n\t\t\tscore: e.score,\n\t\t});\n\t}\n\n\t#onUnload()\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tCallEngine.getRestClient().callMethod(ajaxActions.hangup, {\n\t\t\tcallId: this.id,\n\t\t\tcallInstanceId: this.instanceId\n\t\t});\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tthis.peers[userId].disconnect();\n\t\t}\n\t};\n\n\t#onOnline()\n\t{\n\t\tconst peers = Object.values(this.peers);\n\t\tpeers.forEach((peer) => {\n\t\t\tpeer.reconnect({reconnectionReason: 'GOT_ONLINE_EVENT_FROM_BROWSER'});\n\t\t});\n\t}\n\n\t#beforeLeaveCall()\n\t{\n\t\t// stop media streams\n\t\tthis.unsubscribeHardwareChanges();\n\t\tfor (let tag in this.localStreams)\n\t\t{\n\t\t\tif (this.localStreams[tag])\n\t\t\t{\n\t\t\t\tUtil.stopMediaStream(this.localStreams[tag]);\n\t\t\t\tthis.localStreams[tag] = null;\n\t\t\t}\n\t\t}\n\t\tif (this.prevMainStream)\n\t\t{\n\t\t\tUtil.stopMediaStream(this.prevMainStream);\n\t\t\tthis.prevMainStream = null;\n\t\t}\n\n\t\tif (this.voiceDetection)\n\t\t{\n\t\t\tthis.voiceDetection.destroy();\n\t\t\tthis.voiceDetection = null;\n\t\t}\n\n\t\t// remove all event listeners\n\t\twindow.removeEventListener('unload', this._onUnloadHandler);\n\t\twindow.removeEventListener('online', this._onOnlineHandler);\n\n\t\tclearInterval(this.statsInterval);\n\t\tclearInterval(this.pingUsersInterval);\n\t\tclearInterval(this.pingBackendInterval);\n\t\tclearInterval(this.microphoneLevelInterval);\n\t\tclearTimeout(this.reinviteTimeout);\n\t};\n\n\tdestroy()\n\t{\n\t\tthis.ready = false;\n\t\tconst tempError = new Error();\n\t\ttempError.name = \"Call stack:\";\n\t\tthis.log(\"Call destroy \\n\" + tempError.stack);\n\n\t\t// stop sending media streams\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId].destroy();\n\t\t\t}\n\t\t}\n\n\t\tthis.#beforeLeaveCall();\n\t\tthis.runCallback(CallEvent.onLeave, { local: true });\n\n\t\treturn super.destroy();\n\t}\n}\n\nclass Signaling\n{\n\tconstructor(params)\n\t{\n\t\tthis.call = params.call;\n\t};\n\n\tisIceTricklingAllowed()\n\t{\n\t\treturn CallEngine.getPullClient().isPublishingSupported();\n\t};\n\n\tinviteUsers(data)\n\t{\n\t\treturn this.#runRestAction(ajaxActions.invite, data);\n\t};\n\n\tsendAnswer(data, repeated)\n\t{\n\t\tif (repeated && CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.answer, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.#runRestAction(ajaxActions.answer, data);\n\t\t}\n\t};\n\n\tsendConnectionOffer(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.connectionOffer, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.#runRestAction(ajaxActions.connectionOffer, data);\n\t\t}\n\t};\n\n\tsendConnectionAnswer(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.connectionAnswer, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.#runRestAction(ajaxActions.connectionAnswer, data);\n\t\t}\n\t};\n\n\tsendIceCandidate(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.iceCandidate, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.#runRestAction(ajaxActions.iceCandidate, data);\n\t\t}\n\t};\n\n\tsendNegotiationNeeded(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.negotiationNeeded, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.#runRestAction(ajaxActions.negotiationNeeded, data);\n\t\t}\n\t};\n\n\tsendVoiceStarted(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.voiceStarted, data);\n\t\t}\n\t};\n\n\tsendVoiceStopped(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.voiceStopped, data);\n\t\t}\n\t};\n\n\tsendMicrophoneState(users, microphoneState)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.microphoneState, {\n\t\t\t\tuserId: users,\n\t\t\t\tmicrophoneState: microphoneState\n\t\t\t}, 0);\n\t\t}\n\t};\n\n\tsendCameraState(users, cameraState)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.cameraState, {\n\t\t\t\tuserId: users,\n\t\t\t\tcameraState: cameraState\n\t\t\t}, 0);\n\t\t}\n\t};\n\n\tsendVideoPaused(users, videoPaused)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.videoPaused, {\n\t\t\t\tuserId: users,\n\t\t\t\tvideoPaused: videoPaused\n\t\t\t}, 0);\n\t\t}\n\t};\n\n\tsendRecordState(users, recordState)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.recordState, {\n\t\t\t\tuserId: users,\n\t\t\t\trecordState: recordState\n\t\t\t}, 0);\n\t\t}\n\t};\n\n\tsendPingToUsers(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.ping, data, 5);\n\t\t}\n\t};\n\n\tsendCustomMessage(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.customMessage, data, 5);\n\t\t}\n\t};\n\n\tsendPingToBackend()\n\t{\n\t\tconst retransmit = !CallEngine.getPullClient().isPublishingEnabled();\n\t\tthis.#runRestAction(ajaxActions.ping, {retransmit: retransmit});\n\t};\n\n\tsendUserInviteTimeout(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.userInviteTimeout, data, 0);\n\t\t}\n\t};\n\n\tsendHangup(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.hangup, data, 3600);\n\t\t\tdata.retransmit = false;\n\t\t\treturn this.#runRestAction(ajaxActions.hangup, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdata.retransmit = true;\n\t\t\treturn this.#runRestAction(ajaxActions.hangup, data);\n\t\t}\n\t};\n\n\t#sendPullEvent(eventName, data, expiry)\n\t{\n\t\texpiry = expiry || 5;\n\t\tif (!data.userId)\n\t\t{\n\t\t\tthrow new Error('userId is not found in data');\n\t\t}\n\n\t\tif (!Type.isArray(data.userId))\n\t\t{\n\t\t\tdata.userId = [data.userId];\n\t\t}\n\t\tdata.callInstanceId = this.call.instanceId;\n\t\tdata.senderId = this.call.userId;\n\t\tdata.callId = this.call.id;\n\t\tdata.requestId = Util.getUuidv4();\n\n\t\tif (eventName == 'Call::ping')\n\t\t{\n\t\t\tthis.call.log('Sending p2p signaling event ' + eventName);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.call.log('Sending p2p signaling event ' + eventName + '; ' + JSON.stringify(data));\n\t\t}\n\t\tCallEngine.getPullClient().sendMessage(data.userId, 'im', eventName, data, expiry);\n\t};\n\n\t#runRestAction(signalName, data)\n\t{\n\t\tif (!Type.isPlainObject(data))\n\t\t{\n\t\t\tdata = {};\n\t\t}\n\n\t\tdata.callId = this.call.id;\n\t\tdata.callInstanceId = this.call.instanceId;\n\t\tdata.requestId = Util.getUuidv4();\n\n\t\tif (signalName == 'Call::ping')\n\t\t{\n\t\t\tthis.call.log('Sending ajax-based signaling event ' + signalName);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.call.log('Sending ajax-based signaling event ' + signalName + '; ' + JSON.stringify(data));\n\t\t}\n\t\treturn CallEngine.getRestClient().callMethod(signalName, data).catch(function (e) {console.error(e)});\n\t};\n}\n\nclass Peer\n{\n\tcall: PlainCall\n\tpeerConnection: ?RTCPeerConnection\n\tpeerConnectionId: ?string\n\tvideoSender: ?RTCRtpSender\n\taudioSender: ?RTCRtpSender\n\tscreenSender: ?RTCRtpSender\n\tscreenAudioSender: ?RTCRtpSender\n\tcalculatedState: string\n\n\tconstructor(params)\n\t{\n\t\tthis.call = params.call;\n\t\tthis.userId = params.userId;\n\n\t\tthis.ready = params.ready === true;\n\t\tthis.calling = false;\n\t\tthis.inviteTimeout = false;\n\t\tthis.declined = false;\n\t\tthis.busy = false;\n\t\tthis.signalingConnected = params.signalingConnected === true;\n\t\tthis.failureReason = '';\n\n\t\tthis.userAgent = '';\n\t\tthis.isFirefox = false;\n\t\tthis.isChrome = false;\n\t\tthis.isLegacyMobile = params.isLegacyMobile === true;\n\n\t\tthis.lastSuccessedLocaleCandidate = '';\n\t\tthis.lastSuccessedRemoteCandidate = '';\n\n\t\t/*sums up from signaling, ready and connection states*/\n\t\tthis.calculatedState = this.calculateState();\n\n\t\tthis.localStreams = {\n\t\t\tmain: null,\n\t\t\tscreen: null\n\t\t};\n\n\t\tthis.pendingIceCandidates = {};\n\t\tthis.localIceCandidates = [];\n\n\t\tthis.trackList = {};\n\n\t\tthis.callbacks = {\n\t\t\tonStateChanged: Type.isFunction(params.onStateChanged) ? params.onStateChanged : BX.DoNothing,\n\t\t\tonInviteTimeout: Type.isFunction(params.onInviteTimeout) ? params.onInviteTimeout : BX.DoNothing,\n\t\t\tonMediaReceived: Type.isFunction(params.onMediaReceived) ? params.onMediaReceived : BX.DoNothing,\n\t\t\tonMediaStopped: Type.isFunction(params.onMediaStopped) ? params.onMediaStopped : BX.DoNothing,\n\t\t\tonRTCStatsReceived: Type.isFunction(params.onRTCStatsReceived) ? params.onRTCStatsReceived : BX.DoNothing,\n\t\t\tonRTCQualityChanged: Type.isFunction(params.onRTCQualityChanged) ? params.onRTCQualityChanged : BX.DoNothing,\n\t\t\tonNetworkProblem: Type.isFunction(params.onNetworkProblem) ? params.onNetworkProblem : BX.DoNothing,\n\t\t\tonReconnecting: Type.isFunction(params.onReconnecting) ? params.onReconnecting : BX.DoNothing,\n\t\t\tonReconnected: Type.isFunction(params.onReconnected) ? params.onReconnected : BX.DoNothing,\n\t\t\tonUpdateLastUsedCameraId: Type.isFunction(params.onUpdateLastUsedCameraId) ? params.onUpdateLastUsedCameraId : BX.DoNothing,\n\t\t};\n\n\t\t// intervals and timeouts\n\t\tthis.answerTimeout = null;\n\t\tthis.callingTimeout = null;\n\t\tthis.connectionTimeout = null;\n\t\tthis.signalingConnectionTimeout = null;\n\t\tthis.candidatesTimeout = null;\n\n\t\tthis.statsInterval = null;\n\n\t\tthis.connectionOfferReplyTimeout = null;\n\t\tthis.negotiationNeededReplyTimeout = null;\n\t\tthis.reconnectAfterDisconnectTimeout = null;\n\n\t\tthis.connectionAttempt = 0;\n\t\tthis.hasStun = false;\n\t\tthis.hasTurn = false;\n\n\t\tthis._outgoingVideoTrack = null;\n\t\tObject.defineProperty(this, 'outgoingVideoTrack', {\n\t\t\tget: function ()\n\t\t\t{\n\t\t\t\treturn this._outgoingVideoTrack;\n\t\t\t},\n\t\t\tset: function (track)\n\t\t\t{\n\t\t\t\tif (this._outgoingVideoTrack)\n\t\t\t\t{\n\t\t\t\t\tthis._outgoingVideoTrack.stop();\n\t\t\t\t}\n\t\t\t\tthis._outgoingVideoTrack = track;\n\t\t\t\tif (this._outgoingVideoTrack)\n\t\t\t\t{\n\t\t\t\t\tthis._outgoingVideoTrack.enabled = !this.outgoingVideoHoldState;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis._outgoingScreenTrack = null;\n\t\tObject.defineProperty(this, 'outgoingScreenTrack', {\n\t\t\tget: function ()\n\t\t\t{\n\t\t\t\treturn this._outgoingScreenTrack;\n\t\t\t},\n\t\t\tset: function (track)\n\t\t\t{\n\t\t\t\tif (this._outgoingScreenTrack)\n\t\t\t\t{\n\t\t\t\t\tthis._outgoingScreenTrack.stop();\n\t\t\t\t}\n\t\t\t\tthis._outgoingScreenTrack = track;\n\t\t\t\tif (this._outgoingScreenTrack)\n\t\t\t\t{\n\t\t\t\t\tthis._outgoingScreenTrack.enabled = !this.outgoingVideoHoldState;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis._incomingAudioTrack = null;\n\t\tthis._incomingScreenAudioTrack = null;\n\t\tthis._incomingVideoTrack = null;\n\t\tthis._incomingScreenTrack = null;\n\t\tObject.defineProperty(this, 'incomingAudioTrack', {\n\t\t\tget: this._mediaGetter('_incomingAudioTrack'),\n\t\t\tset: this._mediaSetter('_incomingAudioTrack', 'audio')\n\t\t});\n\t\tObject.defineProperty(this, 'incomingVideoTrack', {\n\t\t\tget: this._mediaGetter('_incomingVideoTrack'),\n\t\t\tset: this._mediaSetter('_incomingVideoTrack', 'video')\n\t\t});\n\t\tObject.defineProperty(this, 'incomingScreenTrack', {\n\t\t\tget: this._mediaGetter('_incomingScreenTrack'),\n\t\t\tset: this._mediaSetter('_incomingScreenTrack', 'screen')\n\t\t});\n\t\tObject.defineProperty(this, 'incomingScreenAudioTrack', {\n\t\t\tget: this._mediaGetter('_incomingScreenAudioTrack'),\n\t\t\tset: this._mediaSetter('_incomingScreenAudioTrack', 'sharingAudio')\n\t\t});\n\n\t\tthis.outgoingVideoHoldState = false;\n\n\t\t// event handlers\n\t\tthis._onPeerConnectionIceCandidateHandler = this._onPeerConnectionIceCandidate.bind(this);\n\t\tthis._onPeerConnectionConnectionStateChangeHandler = this.#onPeerConnectionConnectionStateChange.bind(this);\n\t\tthis._onPeerConnectionIceGatheringStateChangeHandler = this.#onPeerConnectionIceGatheringStateChange.bind(this);\n\t\tthis._onPeerConnectionSignalingStateChangeHandler = this.#onPeerConnectionSignalingStateChange.bind(this);\n\t\t//this._onPeerConnectionNegotiationNeededHandler = this._onPeerConnectionNegotiationNeeded.bind(this);\n\t\tthis._onPeerConnectionTrackHandler = this.#onPeerConnectionTrack.bind(this);\n\t\tthis._onPeerConnectionRemoveStreamHandler = this.#onPeerConnectionRemoveStream.bind(this);\n\n\t\tthis._updateTracksDebounced = Runtime.debounce(this.#updateTracks.bind(this), 50);\n\n\t\tthis._waitTurnCandidatesTimeout = null;\n\n\t\tthis.prevPercentPacketLostList = {\n\t\t\tincomingPacketLost: [],\n\t\t\toutgoingPacketLost: [],\n\t\t};\n\t\tthis.reportsForIncomingTracks = {};\n\t\tthis.reportsForOutgoingTracks = {};\n\t\tthis.packetLostThreshold = 7;\n\t\tthis.videoBitrate = 1000000;\n\t\tthis.screenShareBitrate = 1500000;\n\t\tthis.maxConnectionScore = 5;\n\t\tthis.incomingConnectionScore = 0;\n\t\tthis.outgoingConnectionScore = 0;\n\t};\n\n\t_mediaGetter(trackVariable)\n\t{\n\t\treturn function ()\n\t\t{\n\t\t\treturn this[trackVariable]\n\t\t}.bind(this)\n\t};\n\n\t_mediaSetter(trackVariable, kind)\n\t{\n\t\treturn function (track)\n\t\t{\n\t\t\tif (this[trackVariable] != track)\n\t\t\t{\n\t\t\t\tthis[trackVariable] = track;\n\t\t\t\tif (track)\n\t\t\t\t{\n\t\t\t\t\tthis.callbacks.onMediaReceived({\n\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\tkind: kind,\n\t\t\t\t\t\ttrack: track\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.callbacks.onMediaStopped({\n\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\tkind: kind\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t}.bind(this)\n\t};\n\n\tsendMedia(skipOffer)\n\t{\n\t\tif (!this.peerConnection)\n\t\t{\n\t\t\tif (!this.isInitiator())\n\t\t\t{\n\t\t\t\tthis.log('waiting for the other side to send connection offer');\n\t\t\t\tthis.sendNegotiationNeeded(false);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (!this.peerConnection)\n\t\t{\n\t\t\tconst connectionId = Util.getUuidv4();\n\t\t\tthis.#createPeerConnection(connectionId);\n\t\t}\n\t\tthis.updateOutgoingTracks();\n\n\t\tif (!skipOffer)\n\t\t{\n\t\t\tthis.applyResolutionScale();\n\t\t\tthis.createAndSendOffer();\n\t\t}\n\t};\n\n\tupdateOutgoingTracks()\n\t{\n\t\tif (!this.peerConnection)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet audioTrack;\n\t\tlet videoTrack;\n\t\tlet screenTrack;\n\t\tlet screenAudioTrack;\n\n\t\tif (this.call.localStreams[\"main\"] && this.call.localStreams[\"main\"].getAudioTracks().length > 0 && this.call.localStreams[\"main\"].getAudioTracks()[0]?.readyState === 'live')\n\t\t{\n\t\t\taudioTrack = this.call.localStreams[\"main\"].getAudioTracks()[0];\n\t\t}\n\t\tif (this.call.localStreams[\"screen\"] && this.call.localStreams[\"screen\"].getVideoTracks().length > 0)\n\t\t{\n\t\t\tscreenTrack = this.call.localStreams[\"screen\"].getVideoTracks()[0];\n\t\t}\n\t\tif (this.call.localStreams[\"screen\"] && this.call.localStreams[\"screen\"].getAudioTracks().length > 0)\n\t\t{\n\t\t\tscreenAudioTrack = this.call.localStreams[\"screen\"].getAudioTracks()[0];\n\t\t}\n\t\tif (this.call.localStreams[\"main\"] && this.call.localStreams[\"main\"].getVideoTracks().length > 0 && this.call.localStreams[\"main\"].getVideoTracks()[0]?.readyState === 'live')\n\t\t{\n\t\t\tvideoTrack = this.call.localStreams[\"main\"].getVideoTracks()[0];\n\t\t}\n\n\t\tthis.outgoingVideoTrack = videoTrack ? videoTrack.clone() : null;\n\t\tthis.outgoingScreenTrack = screenTrack ? screenTrack.clone() : null;\n\n\t\tlet tracksToSend = [];\n\t\tif (audioTrack)\n\t\t{\n\t\t\ttracksToSend.push(audioTrack.id + ' (audio)');\n\t\t}\n\t\tif (screenAudioTrack)\n\t\t{\n\t\t\ttracksToSend.push(screenAudioTrack.id + ' (sharingAudio)');\n\t\t}\n\t\tif (videoTrack)\n\t\t{\n\t\t\ttracksToSend.push(videoTrack.id + ' (' + videoTrack.kind + ')');\n\t\t}\n\t\tif (screenTrack)\n\t\t{\n\t\t\ttracksToSend.push(screenTrack.id + ' (' + screenTrack.kind + ')');\n\t\t}\n\n\t\tconsole.log(\"User: \" + this.userId + '; Sending media streams. Tracks: ' + tracksToSend.join('; '));\n\n\t\t// if video sender found - replace track\n\t\t// if not found - add track\n\t\tif (this.videoSender && this.outgoingVideoTrack)\n\t\t{\n\t\t\tthis.videoSender.replaceTrack(this.outgoingVideoTrack);\n\t\t}\n\t\tif (!this.videoSender && this.outgoingVideoTrack)\n\t\t{\n\t\t\tthis.videoSender = this.peerConnection.addTrack(this.outgoingVideoTrack);\n\t\t}\n\t\tif (this.videoSender && !this.outgoingVideoTrack)\n\t\t{\n\t\t\tthis.peerConnection.removeTrack(this.videoSender);\n\t\t\tthis.videoSender = null;\n\t\t}\n\n\t\t// if screen sender found - replace track\n\t\t// if not found - add track\n\t\tif (this.screenSender && this.outgoingScreenTrack)\n\t\t{\n\t\t\tthis.screenSender.replaceTrack(this.outgoingScreenTrack);\n\t\t}\n\t\tif (!this.screenSender && this.outgoingScreenTrack)\n\t\t{\n\t\t\tthis.screenSender = this.peerConnection.addTrack(this.outgoingScreenTrack);\n\t\t}\n\t\tif (this.screenSender && !this.outgoingScreenTrack)\n\t\t{\n\t\t\tthis.peerConnection.removeTrack(this.screenSender);\n\t\t\tthis.screenSender = null;\n\t\t}\n\n\t\t// if screen sender audio found - replace track\n\t\t// if not found - add track\n\t\tif (this.screenAudioSender && screenAudioTrack)\n\t\t{\n\t\t\tthis.screenAudioSender.replaceTrack(screenAudioTrack);\n\t\t}\n\t\tif (!this.screenAudioSender && screenAudioTrack)\n\t\t{\n\t\t\tthis.screenAudioSender = this.peerConnection.addTrack(screenAudioTrack);\n\t\t}\n\t\tif (this.screenAudioSender && !screenAudioTrack)\n\t\t{\n\t\t\tthis.peerConnection.removeTrack(this.screenAudioSender);\n\t\t\tthis.screenAudioSender = null;\n\t\t}\n\n\t\t// if audio sender found - replace track\n\t\t// if not found - add track\n\t\tif (this.audioSender && audioTrack)\n\t\t{\n\t\t\tthis.audioSender.replaceTrack(audioTrack);\n\t\t}\n\t\tif (!this.audioSender && audioTrack)\n\t\t{\n\t\t\tthis.audioSender = this.peerConnection.addTrack(audioTrack);\n\t\t}\n\t\tif (this.audioSender && !audioTrack)\n\t\t{\n\t\t\tthis.peerConnection.removeTrack(this.audioSender);\n\t\t\tthis.audioSender = null;\n\t\t}\n\t};\n\n\tgetSenderMid(rtpSender: RTCRtpSender): string\n\t{\n\t\tif (!rtpSender || !this.peerConnection)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\tconst transceiver = this.peerConnection.getTransceivers().find(transceiver => {\n\t\t\tif (transceiver.sender.track && rtpSender.track)\n\t\t\t{\n\t\t\t\treturn transceiver.sender.track.id === rtpSender.track.id\n\t\t\t}\n\t\t\treturn false\n\t\t});\n\n\t\treturn transceiver ? transceiver.mid : null;\n\t};\n\n\tapplyResolutionScale(factor)\n\t{\n\t\tif (this.videoSender)\n\t\t{\n\t\t\tconst scaleFactor = factor || (this.screenSender ? 2 : 1);\n\t\t\tconst rate = this.videoBitrate / scaleFactor;\n\t\t\tconst videoParams = this.videoSender.getParameters();\n\n\t\t\tif (videoParams.encodings && videoParams.encodings.length > 0)\n\t\t\t{\n\t\t\t\tvideoParams.encodings[0].scaleResolutionDownBy = scaleFactor;\n\t\t\t\tvideoParams.encodings[0].maxBitrate = rate;\n\t\t\t\tthis.videoSender.setParameters(videoParams);\n\t\t\t}\n\t\t}\n\n\t\tif (this.screenSender)\n\t\t{\n\t\t\tconst screenParams = this.screenSender.getParameters();\n\t\t\tif (screenParams.encodings && screenParams.encodings.length > 0)\n\t\t\t{\n\t\t\t\tscreenParams.encodings[0].maxBitrate = this.screenShareBitrate;\n\t\t\t\tthis.screenSender.setParameters(screenParams);\n\t\t\t}\n\t\t}\n\t};\n\n\treplaceMediaStream(tag: string)\n\t{\n\t\tif (this.isRenegotiationSupported())\n\t\t{\n\t\t\tthis.sendMedia();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.localStreams[tag] = this.call.getLocalStream(tag);\n\n\t\t\tconst logMessage = 'Reconnect by replaceMediaStream';\n\t\t\tthis.reconnect({ reconnectionReasonInfo: logMessage });\n\t\t}\n\t};\n\n\tholdOutgoingVideo(holdState)\n\t{\n\t\tif (this.outgoingVideoHoldState == holdState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.outgoingVideoHoldState = holdState;\n\t\tif (this._outgoingVideoTrack)\n\t\t{\n\t\t\tthis._outgoingVideoTrack.enabled = !this.outgoingVideoHoldState;\n\t\t}\n\t};\n\n\tisInitiator()\n\t{\n\t\treturn this.call.userId < this.userId;\n\t};\n\n\tisRenegotiationSupported()\n\t{\n\t\treturn true;\n\t\t// return (Browser.isChrome() && this.isChrome);\n\t};\n\n\tsetReady(ready)\n\t{\n\t\tthis.ready = ready;\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.declined = false;\n\t\t\tthis.busy = false;\n\t\t}\n\t\tif (this.calling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t}\n\t\tthis.updateCalculatedState();\n\t};\n\n\tisReady()\n\t{\n\t\treturn this.ready;\n\t};\n\n\tonInvited()\n\t{\n\t\tthis.ready = false;\n\t\tthis.inviteTimeout = false;\n\t\tthis.declined = false;\n\t\tthis.calling = true;\n\n\t\tif (this.callingTimeout)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t}\n\t\tthis.callingTimeout = setTimeout(function ()\n\t\t{\n\t\t\tthis.onInviteTimeout(true);\n\t\t}.bind(this), 30000);\n\t\tthis.updateCalculatedState();\n\t};\n\n\tonInviteTimeout(internal)\n\t{\n\t\tclearTimeout(this.callingTimeout);\n\t\tthis.calling = false;\n\t\tthis.inviteTimeout = true;\n\t\tif (internal)\n\t\t{\n\t\t\tthis.callbacks.onInviteTimeout({\n\t\t\t\tuserId: this.userId\n\t\t\t});\n\t\t}\n\t\tthis.updateCalculatedState();\n\t};\n\n\tsetUserAgent(userAgent)\n\t{\n\t\tthis.userAgent = userAgent;\n\t\tthis.isFirefox = userAgent.toLowerCase().indexOf('firefox') != -1;\n\t\tthis.isChrome = userAgent.toLowerCase().indexOf('chrome') != -1;\n\t\tthis.isLegacyMobile = userAgent === 'Bitrix Legacy Mobile';\n\t};\n\n\tgetUserAgent()\n\t{\n\t\treturn this.userAgent;\n\t};\n\n\tisParticipating()\n\t{\n\t\tif (this.calling)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (this.declined || this.busy)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.peerConnection)\n\t\t{\n\t\t\t// todo: maybe we should check iceConnectionState as well.\n\t\t\tconst iceConnectionState = this.peerConnection.iceConnectionState;\n\t\t\tif (iceConnectionState == 'checking' || iceConnectionState == 'connected' || iceConnectionState == 'completed')\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t};\n\n\tsetSignalingConnected(signalingConnected)\n\t{\n\t\tthis.signalingConnected = signalingConnected;\n\t\tthis.updateCalculatedState();\n\n\t\tif (this.signalingConnected)\n\t\t{\n\t\t\tthis.refreshSignalingTimeout();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.stopSignalingTimeout();\n\t\t}\n\t};\n\n\tisSignalingConnected()\n\t{\n\t\treturn this.signalingConnected;\n\t};\n\n\tsetDeclined(declined)\n\t{\n\t\tthis.declined = declined;\n\t\tif (this.calling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t}\n\t\tthis.updateCalculatedState();\n\t};\n\n\tsetBusy(busy)\n\t{\n\t\tthis.busy = busy;\n\t\tif (this.calling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t}\n\t\tthis.updateCalculatedState();\n\t};\n\n\tisDeclined()\n\t{\n\t\treturn this.declined;\n\t};\n\n\tupdateCalculatedState()\n\t{\n\t\tconst calculatedState = this.calculateState();\n\n\t\tif (this.calculatedState != calculatedState)\n\t\t{\n\t\t\tthis.callbacks.onStateChanged({\n\t\t\t\tuserId: this.userId,\n\t\t\t\tstate: calculatedState,\n\t\t\t\tpreviousState: this.calculatedState,\n\t\t\t\tisLegacyMobile: this.isLegacyMobile,\n\t\t\t\tnetworkProblem: !this.hasStun || !this.hasTurn\n\t\t\t});\n\t\t\tthis.calculatedState = calculatedState;\n\t\t}\n\t};\n\n\tcalculateState()\n\t{\n\t\tif (this.peerConnection)\n\t\t{\n\t\t\tif (this.failureReason !== '')\n\t\t\t{\n\t\t\t\treturn UserState.Failed;\n\t\t\t}\n\n\t\t\tif (this.peerConnection.iceConnectionState === 'connected' || this.peerConnection.iceConnectionState === 'completed')\n\t\t\t{\n\t\t\t\treturn UserState.Connected;\n\t\t\t}\n\n\t\t\treturn UserState.Connecting;\n\t\t}\n\n\t\tif (this.calling)\n\t\t{\n\t\t\treturn UserState.Calling;\n\t\t}\n\n\t\tif (this.inviteTimeout)\n\t\t{\n\t\t\treturn UserState.Unavailable;\n\t\t}\n\n\t\tif (this.declined)\n\t\t{\n\t\t\treturn UserState.Declined;\n\t\t}\n\n\t\tif (this.busy)\n\t\t{\n\t\t\treturn UserState.Busy;\n\t\t}\n\n\t\tif (this.ready)\n\t\t{\n\t\t\treturn UserState.Ready;\n\t\t}\n\n\t\treturn UserState.Idle;\n\t};\n\n\tgetSignaling()\n\t{\n\t\treturn this.call.signaling;\n\t};\n\n\tstartStatisticsGathering()\n\t{\n\t\tclearInterval(this.statsInterval);\n\n\t\tthis.statsInterval = setInterval(function ()\n\t\t{\n\t\t\tif (!this.peerConnection)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.peerConnection.getStats().then(function (stats)\n\t\t\t{\n\t\t\t\t// stats gathering in new format like in the Bitrix24 calls\n\t\t\t\tconst statsOutput = [];\n\t\t\t\tconst codecs = {};\n\t\t\t\tconst reportsWithoutCodecs = {};\n\t\t\t\tconst remoteReports = {};\n\t\t\t\tconst reportsWithoutRemoteInfo = {};\n\t\t\t\tlet incomingDataLoss = 0;\n\t\t\t\tlet outgoingDataLoss = 0;\n\n\t\t\t\tstats.forEach((report) => {\n\t\t\t\t\tstatsOutput.push(report);\n\n\t\t\t\t\tconst needCheckInputPacketLost = (report?.trackIdentifier\n\t\t\t\t\t\t&& report?.type === 'inbound-rtp'\n\t\t\t\t\t\t&& report.hasOwnProperty('packetsLost')\n\t\t\t\t\t\t&& report.hasOwnProperty('packetsReceived'));\n\n\t\t\t\t\tif (needCheckInputPacketLost || report.type === 'outbound-rtp')\n\t\t\t\t\t{\n\t\t\t\t\t\tswitch (this.trackList[report.mid])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcase 'video':\n\t\t\t\t\t\t\t\treport.source = MediaStreamsKinds.Camera;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'screen':\n\t\t\t\t\t\t\t\treport.source = MediaStreamsKinds.Screen;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'audio':\n\t\t\t\t\t\t\t\treport.source = MediaStreamsKinds.Microphone;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (\n\t\t\t\t\t\treport.type === 'candidate-pair'\n\t\t\t\t\t\t&& report.state === 'succeeded'\n\t\t\t\t\t\t&& report.bytesReceived > 0\n\t\t\t\t\t\t&& report.bytesSent > 0\n\t\t\t\t\t\t&& this.lastSuccessedLocaleCandidateId !== report.localCandidateId\n\t\t\t\t\t\t&& this.lastSuccessedRemoteCandidateId !== report.remoteCandidateId\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.lastSuccessedLocaleCandidateId = report.localCandidateId;\n\t\t\t\t\t\tthis.lastSuccessedRemoteCandidateId = report.remoteCandidateId;\n\n\t\t\t\t\t\tUtil.sendLog({\n\t\t\t\t\t\t\tdescription: `GOT a succeeded candidate-pair for user ${this.userId}`,\n\t\t\t\t\t\t\tlocalCandidateId: report.localCandidateId,\n\t\t\t\t\t\t\tremoteCandidateId: report.remoteCandidateId,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (needCheckInputPacketLost)\n\t\t\t\t\t{\n\t\t\t\t\t\treport.bitrate = Util.calcBitrate(report, this.reportsForIncomingTracks[report.source]);\n\t\t\t\t\t\tconst packetsLostData = Util.calcRemotePacketsLost(report, this.reportsForIncomingTracks[report.source]);\n\t\t\t\t\t\treport.packetsLostExtended = Util.formatPacketsLostData(packetsLostData);\n\t\t\t\t\t\tif (!Util.setCodecToReport(report, codecs, reportsWithoutCodecs))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tUtil.saveReportWithoutCodecs(report, reportsWithoutCodecs);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.reportsForIncomingTracks[report.source] = report;\n\n\t\t\t\t\t\tif (report.source === MediaStreamsKinds.Camera)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tincomingDataLoss = packetsLostData.currentPercentPacketLost;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (report.type === 'codec')\n\t\t\t\t\t{\n\t\t\t\t\t\tUtil.processReportsWithoutCodecs(report, codecs, reportsWithoutCodecs);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (report.type === 'remote-inbound-rtp')\n\t\t\t\t\t{\n\t\t\t\t\t\tconst reportId = report.localId;\n\t\t\t\t\t\tif (reportsWithoutRemoteInfo[reportId])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst packetsLostData = Util.calcLocalPacketsLost(reportsWithoutRemoteInfo[reportId], this.reportsForOutgoingTracks[reportId], report);\n\t\t\t\t\t\t\treportsWithoutRemoteInfo[reportId].packetsLostData = packetsLostData;\n\t\t\t\t\t\t\treportsWithoutRemoteInfo[reportId].packetsLost = packetsLostData.totalPacketsLost;\n\t\t\t\t\t\t\treportsWithoutRemoteInfo[reportId].packetsLostExtended = Util.formatPacketsLostData(packetsLostData);\n\t\t\t\t\t\t\tthis.reportsForOutgoingTracks[reportId] = reportsWithoutRemoteInfo[reportId];\n\t\t\t\t\t\t\tdelete reportsWithoutRemoteInfo[reportId];\n\n\t\t\t\t\t\t\tif (this.reportsForOutgoingTracks[reportId].source === MediaStreamsKinds.Camera)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\toutgoingDataLoss = report.packetsLost;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tremoteReports[reportId] = report;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (report.type === 'outbound-rtp')\n\t\t\t\t\t{\n\t\t\t\t\t\treport.bitrate = Util.calcBitrate(report, this.reportsForOutgoingTracks[report.id], true);\n\t\t\t\t\t\treport.userId = this.call.userId;\n\n\t\t\t\t\t\tif (!Util.setCodecToReport(report, codecs, reportsWithoutCodecs))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tUtil.saveReportWithoutCodecs(report, reportsWithoutCodecs);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (Util.setLocalPacketsLostOrSaveReport(report, remoteReports, reportsWithoutRemoteInfo))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.reportsForOutgoingTracks[report.id] = report;\n\t\t\t\t\t\t\tif (report.source === MediaStreamsKinds.Camera)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\toutgoingDataLoss = report.packetsLostData.currentPercentPacketLost;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (this.prevPercentPacketLostList.incomingPacketLost.push(incomingDataLoss) > 10)\n\t\t\t\t{\n\t\t\t\t\tthis.prevPercentPacketLostList.incomingPacketLost.shift();\n\t\t\t\t}\n\n\t\t\t\tconst newIncomingConnectionDataLoss = this.prevPercentPacketLostList.incomingPacketLost.reduce(\n\t\t\t\t\t(acc, number) => acc + number, 0\n\t\t\t\t) / this.prevPercentPacketLostList.incomingPacketLost.length;\n\t\t\t\tconst newIncomingConnectionScore = this.calcNewConnectionScore(newIncomingConnectionDataLoss);\n\t\t\t\tif (!this.incomingConnectionScore || this.incomingConnectionScore !== newIncomingConnectionScore)\n\t\t\t\t{\n\t\t\t\t\tthis.incomingConnectionScore = newIncomingConnectionScore;\n\t\t\t\t\tthis.callbacks.onRTCQualityChanged({\n\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\tscore: this.incomingConnectionScore\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (this.prevPercentPacketLostList.outgoingPacketLost.push(outgoingDataLoss) > 10)\n\t\t\t\t{\n\t\t\t\t\tthis.prevPercentPacketLostList.outgoingPacketLost.shift();\n\t\t\t\t}\n\n\t\t\t\tconst newOutgoingConnectionDataLoss = this.prevPercentPacketLostList.outgoingPacketLost.reduce(\n\t\t\t\t\t(acc, number) => acc + number, 0\n\t\t\t\t) / this.prevPercentPacketLostList.outgoingPacketLost.length;\n\t\t\t\tconst newOutgoingConnectionScore = this.calcNewConnectionScore(newOutgoingConnectionDataLoss);\n\t\t\t\tif (!this.outgoingConnectionScore || this.outgoingConnectionScore !== newOutgoingConnectionScore)\n\t\t\t\t{\n\t\t\t\t\tthis.outgoingConnectionScore = newOutgoingConnectionScore;\n\t\t\t\t\tthis.callbacks.onRTCQualityChanged({\n\t\t\t\t\t\tuserId: this.call.userId,\n\t\t\t\t\t\tscore: this.outgoingConnectionScore\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tthis.callbacks.onRTCStatsReceived({\n\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\tstats: statsOutput\n\t\t\t\t});\n\t\t\t}.bind(this));\n\t\t}.bind(this), 1000);\n\t};\n\n\tcalcNewConnectionScore(dataLoss)\n\t{\n\t\tlet connectionQuality;\n\t\tif (dataLoss < 10)\n\t\t{\n\t\t\tconnectionQuality = 4;\n\t\t}\n\n\t\tif (dataLoss > 10 && dataLoss <= 20)\n\t\t{\n\t\t\tconnectionQuality = 3;\n\t\t}\n\n\t\tif (dataLoss > 20 && dataLoss <= 30)\n\t\t{\n\t\t\tconnectionQuality = 2;\n\t\t}\n\n\t\tif (dataLoss > 30)\n\t\t{\n\t\t\tconnectionQuality = 1;\n\t\t}\n\n\t\treturn connectionQuality;\n\t}\n\n\tstopStatisticsGathering()\n\t{\n\t\tclearInterval(this.statsInterval);\n\t\tthis.statsInterval = null;\n\t};\n\n\tupdateCandidatesTimeout()\n\t{\n\t\tif (this.candidatesTimeout)\n\t\t{\n\t\t\tclearTimeout(this.candidatesTimeout);\n\t\t}\n\n\t\tthis.candidatesTimeout = setTimeout(this.sendIceCandidates.bind(this), 500);\n\t};\n\n\tsendIceCandidates()\n\t{\n\t\tthis.log(\"User \" + this.userId + \": sending ICE candidates due to the timeout\");\n\n\t\tthis.candidatesTimeout = null;\n\t\tif (this.localIceCandidates.length > 0)\n\t\t{\n\t\t\tthis.getSignaling().sendIceCandidate({\n\t\t\t\tuserId: this.userId,\n\t\t\t\tconnectionId: this.peerConnectionId,\n\t\t\t\tcandidates: this.localIceCandidates\n\t\t\t});\n\t\t\tthis.localIceCandidates = [];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.log(\"User \" + this.userId + \": ICE candidates pool is empty\");\n\t\t}\n\t};\n\n\t#createPeerConnection(id)\n\t{\n\t\tthis.log(\"User \" + this.userId + \": Creating peer connection\");\n\t\tconst connectionConfig = {\n\t\t\t\"iceServers\": [\n\t\t\t\t{\n\t\t\t\t\turls: \"stun:\" + this.call.turnServer\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\turls: \"turn:\" + this.call.turnServer,\n\t\t\t\t\tusername: this.call.turnServerLogin,\n\t\t\t\t\tcredential: this.call.turnServerPassword\n\t\t\t\t}\n\t\t\t],\n\t\t\t// iceTransportPolicy: 'relay'\n\t\t};\n\n\t\tthis.localIceCandidates = [];\n\t\tthis.peerConnection = new RTCPeerConnection(connectionConfig);\n\t\tthis.peerConnectionId = id;\n\n\t\tthis.peerConnection.addEventListener(\"icecandidate\", this._onPeerConnectionIceCandidateHandler);\n\t\tthis.peerConnection.addEventListener(\"connectionstatechange\", this._onPeerConnectionConnectionStateChangeHandler);\n\t\tthis.peerConnection.addEventListener(\"icegatheringstatechange\", this._onPeerConnectionIceGatheringStateChangeHandler);\n\t\tthis.peerConnection.addEventListener(\"signalingstatechange\", this._onPeerConnectionSignalingStateChangeHandler);\n\t\t// this.peerConnection.addEventListener(\"negotiationneeded\", this._onPeerConnectionNegotiationNeededHandler);\n\t\tthis.peerConnection.addEventListener(\"track\", this._onPeerConnectionTrackHandler);\n\t\tthis.peerConnection.addEventListener(\"removestream\", this._onPeerConnectionRemoveStreamHandler);\n\n\t\tthis.failureReason = '';\n\t\tthis.hasStun = false;\n\t\tthis.hasTurn = false;\n\t\tthis.updateCalculatedState();\n\n\t\tthis.startStatisticsGathering();\n\t};\n\n\t_destroyPeerConnection()\n\t{\n\t\tif (!this.peerConnection)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tclearTimeout(this.reconnectAfterDisconnectTimeout);\n\n\t\tthis.log(\"User \" + this.userId + \": Destroying peer connection \" + this.peerConnectionId);\n\t\tthis.stopStatisticsGathering();\n\n\t\tthis.peerConnection.removeEventListener(\"icecandidate\", this._onPeerConnectionIceCandidateHandler);\n\t\tthis.peerConnection.removeEventListener(\"connectionstatechange\", this._onPeerConnectionConnectionStateChangeHandler);\n\t\tthis.peerConnection.removeEventListener(\"icegatheringstatechange\", this._onPeerConnectionIceGatheringStateChangeHandler);\n\t\tthis.peerConnection.removeEventListener(\"signalingstatechange\", this._onPeerConnectionSignalingStateChangeHandler);\n\t\t// this.peerConnection.removeEventListener(\"negotiationneeded\", this._onPeerConnectionNegotiationNeededHandler);\n\t\tthis.peerConnection.removeEventListener(\"track\", this._onPeerConnectionTrackHandler);\n\t\tthis.peerConnection.removeEventListener(\"removestream\", this._onPeerConnectionRemoveStreamHandler);\n\n\t\tthis.localIceCandidates = [];\n\t\tif (this.pendingIceCandidates[this.peerConnectionId])\n\t\t{\n\t\t\tdelete this.pendingIceCandidates[this.peerConnectionId];\n\t\t}\n\n\t\tthis.peerConnection.close();\n\t\tthis.peerConnection = null;\n\t\tthis.peerConnectionId = null;\n\t\tthis.videoSender = null;\n\t\tthis.screenSender = null;\n\t\tthis.audioSender = null;\n\t\tthis.incomingAudioTrack = null;\n\t\tthis.incomingScreenAudioTrack = null;\n\t\tthis.incomingVideoTrack = null;\n\t\tthis.incomingScreenTrack = null;\n\t};\n\n\t_onPeerConnectionIceCandidate(e)\n\t{\n\t\tconst candidate = e.candidate;\n\t\tthis.log(\"User \" + this.userId + \": ICE candidate discovered. Candidate: \" + (candidate ? candidate.candidate : candidate));\n\n\t\tif (candidate)\n\t\t{\n\t\t\tif (this.getSignaling().isIceTricklingAllowed())\n\t\t\t{\n\t\t\t\tthis.getSignaling().sendIceCandidate({\n\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\tconnectionId: this.peerConnectionId,\n\t\t\t\t\tcandidates: [candidate.toJSON()]\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.localIceCandidates.push(candidate.toJSON());\n\t\t\t\tthis.updateCandidatesTimeout();\n\t\t\t}\n\n\t\t\tconst match = candidate.candidate.match(/typ\\s(\\w+)?/);\n\t\t\tif (match)\n\t\t\t{\n\t\t\t\tconst type = match[1];\n\t\t\t\tif (type == \"srflx\")\n\t\t\t\t{\n\t\t\t\t\tthis.hasStun = true;\n\t\t\t\t}\n\t\t\t\telse if (type == \"relay\")\n\t\t\t\t{\n\t\t\t\t\tthis.hasTurn = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\t#onPeerConnectionConnectionStateChange()\n\t{\n\t\tthis.log(\"User \" + this.userId + \": peer connection state changed. New state: \" + this.peerConnection.connectionState);\n\n\t\tif (this.peerConnection.connectionState === \"connected\" || this.peerConnection.connectionState === \"completed\")\n\t\t{\n\t\t\tthis.connectionAttempt = 0;\n\t\t\tthis.callbacks.onReconnected();\n\t\t\tclearTimeout(this.reconnectAfterDisconnectTimeout);\n\t\t\tthis._updateTracksDebounced();\n\t\t}\n\t\telse if (this.peerConnection.connectionState === \"failed\")\n\t\t{\n\t\t\tconst logMessage = 'Peer connection failed. Trying to restore connection immediately';\n\n\t\t\tthis.reconnect({\n\t\t\t\treconnectionReason: 'PEER_CONNECTION_FAILED',\n\t\t\t\treconnectionReasonInfo: logMessage,\n\t\t\t});\n\t\t}\n\t\t// else if (this.peerConnection.connectionState === \"disconnected\")\n\t\t// {\n\t\t// \t// we can ignore a 'disconnected' state because it can provoke frequent reconnects,\n\t\t// \t// besides that, iceConnectionState can can be changed back to 'connected' state by itself\n\t\t// \tthis.log(\"peer connection lost. Waiting 5 seconds before trying to restore it\");\n\t\t// \tclearTimeout(this.reconnectAfterDisconnectTimeout);\n\t\t// \tthis.reconnectAfterDisconnectTimeout = setTimeout(() => this.reconnect(), 5000);\n\t\t// }\n\n\t\tthis.updateCalculatedState();\n\t};\n\n\t#onPeerConnectionIceGatheringStateChange(e)\n\t{\n\t\tconst connection = e.target;\n\t\tthis.log(\"User \" + this.userId + \": ICE gathering state changed to : \" + connection.iceGatheringState);\n\n\t\tif (connection.iceGatheringState === 'complete')\n\t\t{\n\t\t\tthis.log(\"User \" + this.userId + \": ICE gathering complete\");\n\t\t\tif (!this.hasStun || !this.hasTurn)\n\t\t\t{\n\t\t\t\tconst s = [];\n\t\t\t\tif (!this.hasTurn)\n\t\t\t\t{\n\t\t\t\t\ts.push(\"TURN\");\n\t\t\t\t}\n\t\t\t\tif (!this.hasStun)\n\t\t\t\t{\n\t\t\t\t\ts.push(\"STUN\");\n\t\t\t\t}\n\t\t\t\tthis.log(\"Connectivity problem detected: no ICE candidates from \" + s.join(\" and \") + \" servers\");\n\t\t\t\tconsole.error(\"Connectivity problem detected: no ICE candidates from \" + s.join(\" and \") + \" servers\");\n\t\t\t\tthis.callbacks.onNetworkProblem();\n\t\t\t}\n\n\t\t\tif (!this.getSignaling().isIceTricklingAllowed())\n\t\t\t{\n\t\t\t\tif (this.localIceCandidates.length > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.getSignaling().sendIceCandidate({\n\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\tconnectionId: this.peerConnectionId,\n\t\t\t\t\t\tcandidates: this.localIceCandidates\n\t\t\t\t\t});\n\t\t\t\t\tthis.localIceCandidates = [];\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"User \" + this.userId + \": ICE candidates already sent\");\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\t#onPeerConnectionSignalingStateChange()\n\t{\n\t\tthis.log(\"User \" + this.userId + \" PC signalingState: \" + this.peerConnection.signalingState);\n\t\tif (this.peerConnection.signalingState === \"stable\")\n\t\t{\n\t\t\tthis._updateTracksDebounced();\n\t\t}\n\t};\n\n\t// this event is unusable in the current version of desktop (cef 64) and leads to signaling cycling\n\t// todo: reconsider using it after new version is released\n\t#onPeerConnectionNegotiationNeeded(e)\n\t{\n\t\tthis.log(\"User \" + this.userId + \": needed negotiation for peer connection\");\n\t\tthis.log(\"signaling state: \", e.target.signalingState);\n\t\tthis.log(\"ice connection state: \", e.target.iceConnectionState);\n\t\tthis.log(\"pendingRemoteDescription: \", e.target.pendingRemoteDescription);\n\n\t\tif (e.target.iceConnectionState !== \"new\" && e.target.iceConnectionState !== \"connected\" && e.target.iceConnectionState !== \"completed\")\n\t\t{\n\t\t\tthis.log(\"User \" + this.userId + \": wrong connection state\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isInitiator())\n\t\t{\n\t\t\tthis.createAndSendOffer();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.sendNegotiationNeeded(this.peerConnection._forceReconnect === true);\n\t\t}\n\t};\n\n\t#onPeerConnectionTrack(e)\n\t{\n\t\tthis.log(\"User \" + this.userId + \": media track received: \", e.track.id + \" (\" + e.track.kind + \")\");\n\n\t\tif (e.track.kind === \"video\")\n\t\t{\n\t\t\te.track.addEventListener(\"mute\", this.#onVideoTrackMuted.bind(this));\n\t\t\te.track.addEventListener(\"unmute\", this.#onVideoTrackUnMuted.bind(this));\n\t\t\te.track.addEventListener(\"ended\", this.#onVideoTrackEnded.bind(this));\n\t\t\tif (this.trackList[e.track.id] === 'screen')\n\t\t\t{\n\t\t\t\tthis.incomingScreenTrack = e.track;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.incomingVideoTrack = e.track\n\t\t\t}\n\t\t}\n\t\telse if (e.track.kind === 'audio')\n\t\t{\n\t\t\t// this.incomingAudioTrack = e.track;\n\t\t\tif (this.trackList[e.track.id] === 'screenAudio')\n\t\t\t{\n\t\t\t\tthis.incomingScreenAudioTrack = e.track;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.incomingAudioTrack = e.track;\n\t\t\t}\n\t\t}\n\t};\n\n\t#onPeerConnectionRemoveStream(e)\n\t{\n\t\tthis.log(\"User: \" + this.userId + \"_onPeerConnectionRemoveStream: \", e);\n\t};\n\n\t#onVideoTrackMuted()\n\t{\n\t\tconsole.log(\"Video track muted\");\n\t\t//this._updateTracksDebounced();\n\t};\n\n\t#onVideoTrackUnMuted()\n\t{\n\t\tconsole.log(\"Video track unmuted\");\n\t\t//this._updateTracksDebounced();\n\t};\n\n\t#onVideoTrackEnded()\n\t{\n\t\tconsole.log(\"Video track ended\");\n\t};\n\n\t#updateTracks()\n\t{\n\t\tif (!this.peerConnection)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\tlet audioTrack = null;\n\t\tlet videoTrack = null;\n\t\tlet screenTrack = null;\n\t\tlet screenAudioTrack = null;\n\t\tthis.peerConnection.getTransceivers().forEach((tr) =>\n\t\t{\n\t\t\tthis.call.log(\"[debug] tr direction: \" + tr.direction + \" currentDirection: \" + tr.currentDirection);\n\t\t\tif (tr.currentDirection === \"sendrecv\" || tr.currentDirection === \"recvonly\")\n\t\t\t{\n\t\t\t\tif (tr.receiver && tr.receiver.track)\n\t\t\t\t{\n\t\t\t\t\tconst track = tr.receiver.track;\n\t\t\t\t\tif (track.kind === 'audio')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.trackList[tr.mid] === 'sharingAudio')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tscreenAudioTrack = track;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\taudioTrack = track;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (track.kind === 'video')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.trackList[tr.mid] === 'screen')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tscreenTrack = track;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvideoTrack = track;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.incomingAudioTrack = audioTrack;\n\t\tthis.incomingVideoTrack = videoTrack;\n\t\tthis.incomingScreenTrack = screenTrack;\n\t\tthis.incomingScreenAudioTrack = screenAudioTrack;\n\t};\n\n\tstopSignalingTimeout()\n\t{\n\t\tclearTimeout(this.signalingConnectionTimeout);\n\t};\n\n\trefreshSignalingTimeout()\n\t{\n\t\tclearTimeout(this.signalingConnectionTimeout);\n\t\tthis.signalingConnectionTimeout = setTimeout(this.#onLostSignalingConnection.bind(this), signalingConnectionRefreshPeriod);\n\t};\n\n\t#onLostSignalingConnection()\n\t{\n\t\tthis.setSignalingConnected(false);\n\t};\n\n\t_onConnectionOfferReplyTimeout(connectionId)\n\t{\n\t\tconst logMessage = 'Did not receive connection answer for connection ' + connectionId;\n\n\t\tthis.call.setPublishingState(MediaStreamsKinds.Camera, false);\n\n\t\tthis.reconnect({ reconnectionReasonInfo: logMessage });\n\t};\n\n\t_onNegotiationNeededReplyTimeout()\n\t{\n\t\tconst logMessage = 'Did not receive connection offer in time';\n\n\t\tthis.reconnect({ reconnectionReasonInfo: logMessage });\n\t};\n\n\tsetConnectionOffer(connectionId, sdp, trackList)\n\t{\n\t\tthis.log(\"User \" + this.userId + \": applying connection offer for connection \" + connectionId);\n\n\t\tclearTimeout(this.negotiationNeededReplyTimeout);\n\t\tthis.negotiationNeededReplyTimeout = null;\n\n\t\tif (!this.call.isReady())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.isReady())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (trackList)\n\t\t{\n\t\t\tthis.trackList = BX.util.array_flip(trackList);\n\t\t}\n\n\t\tif (this.peerConnection)\n\t\t{\n\t\t\tif (this.peerConnectionId !== connectionId)\n\t\t\t{\n\t\t\t\tthis._destroyPeerConnection();\n\t\t\t\tthis.#createPeerConnection(connectionId);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#createPeerConnection(connectionId);\n\t\t}\n\n\t\tthis.applyOfferAndSendAnswer(sdp);\n\t};\n\n\tcreateAndSendOffer(config)\n\t{\n\t\tlet connectionConfig = defaultConnectionOptions;\n\t\tfor (let key in config)\n\t\t{\n\t\t\tconnectionConfig[key] = config[key];\n\t\t}\n\n\t\tthis.peerConnection.createOffer(connectionConfig)\n\t\t\t.then((offer) =>\n\t\t\t{\n\t\t\t\tthis.log(\"User \" + this.userId + \": Created connection offer.\");\n\t\t\t\tthis.log(\"Applying local description\");\n\t\t\t\treturn this.peerConnection.setLocalDescription(offer);\n\t\t\t})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.sendOffer();\n\t\t\t})\n\t\t;\n\t};\n\n\tsendOffer()\n\t{\n\t\tclearTimeout(this.connectionOfferReplyTimeout);\n\t\tthis.connectionOfferReplyTimeout = setTimeout(\n\t\t\t() => this._onConnectionOfferReplyTimeout(this.peerConnectionId),\n\t\t\tsignalingWaitReplyPeriod\n\t\t);\n\n\t\tthis.getSignaling().sendConnectionOffer({\n\t\t\tuserId: this.userId,\n\t\t\tconnectionId: this.peerConnectionId,\n\t\t\tsdp: this.peerConnection.localDescription.sdp,\n\t\t\ttracks: {\n\t\t\t\taudio: this.getSenderMid(this.audioSender),\n\t\t\t\tvideo: this.getSenderMid(this.videoSender),\n\t\t\t\tscreen: this.getSenderMid(this.screenSender),\n\t\t\t\tsharingAudio: this.getSenderMid(this.screenAudioSender),\n\t\t\t},\n\t\t\tuserAgent: navigator.userAgent\n\t\t})\n\t};\n\n\tsendNegotiationNeeded(restart: boolean)\n\t{\n\t\trestart = restart === true;\n\t\tclearTimeout(this.negotiationNeededReplyTimeout);\n\t\tthis.negotiationNeededReplyTimeout = setTimeout(\n\t\t\t() => this._onNegotiationNeededReplyTimeout(),\n\t\t\tsignalingWaitReplyPeriod\n\t\t);\n\n\t\tconst params = {\n\t\t\tuserId: this.userId\n\t\t};\n\t\tif (restart)\n\t\t{\n\t\t\tparams.restart = true;\n\t\t}\n\n\t\tthis.getSignaling().sendNegotiationNeeded(params);\n\t};\n\n\tapplyOfferAndSendAnswer(sdp)\n\t{\n\t\tconst sessionDescription = new RTCSessionDescription({\n\t\t\ttype: \"offer\",\n\t\t\tsdp: sdp\n\t\t});\n\n\t\tif (this.pendingRemoteSdpDelay)\n\t\t{\n\t\t\tthis.pendingRemoteSdp = sdp;\n\t\t\treturn;\n\t\t}\n\n\t\tthis.log(\"User: \" + this.userId + \"; Applying remote offer\");\n\t\tthis.log(\"User: \" + this.userId + \"; Peer ice connection state \", this.peerConnection.iceConnectionState);\n\n\t\tthis.pendingRemoteSdpDelay = true;\n\n\t\tthis.peerConnection\n\t\t\t.setRemoteDescription(sessionDescription)\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tif (this.peerConnection.iceConnectionState === 'new')\n\t\t\t\t{\n\t\t\t\t\tthis.sendMedia(true);\n\t\t\t\t}\n\n\t\t\t\treturn this.peerConnection.createAnswer();\n\t\t\t})\n\t\t\t.then((answer) =>\n\t\t\t{\n\t\t\t\tthis.log(\"Created connection answer.\");\n\t\t\t\tthis.log(\"Applying local description.\");\n\n\t\t\t\treturn this.peerConnection.setLocalDescription(answer);\n\t\t\t})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.applyResolutionScale();\n\t\t\t\tthis.applyPendingIceCandidates();\n\t\t\t\tthis.getSignaling().sendConnectionAnswer({\n\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\tconnectionId: this.peerConnectionId,\n\t\t\t\t\tsdp: this.peerConnection.localDescription.sdp,\n\t\t\t\t\ttracks: {\n\t\t\t\t\t\taudio: this.getSenderMid(this.audioSender),\n\t\t\t\t\t\tvideo: this.getSenderMid(this.videoSender),\n\t\t\t\t\t\tscreen: this.getSenderMid(this.screenSender),\n\t\t\t\t\t\tsharingAudio: this.getSenderMid(this.screenAudioSender),\n\t\t\t\t\t},\n\t\t\t\t\tuserAgent: navigator.userAgent\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch((e) =>\n\t\t\t{\n\t\t\t\tthis.failureReason = e.toString();\n\t\t\t\tthis.updateCalculatedState();\n\t\t\t\tthis.log(\"Could not apply remote offer\", e);\n\t\t\t\tconsole.error(\"Could not apply remote offer\", e);\n\t\t\t})\n\t\t\t.finally(() => {\n\t\t\t\tthis.pendingRemoteSdpDelay = false;\n\t\t\t\tif (this.pendingRemoteSdp) {\n\t\t\t\t\tthis.applyOfferAndSendAnswer(this.pendingRemoteSdp);\n\t\t\t\t\tthis.pendingRemoteSdp = null;\n\t\t\t\t}\n\n\t\t\t})\n\t\t;\n\t};\n\n\tsetConnectionAnswer(connectionId, sdp, trackList)\n\t{\n\t\tif (!this.peerConnection || this.peerConnectionId != connectionId)\n\t\t{\n\t\t\tthis.log(\"Could not apply answer, for unknown connection \" + connectionId);\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.peerConnection.signalingState !== 'have-local-offer')\n\t\t{\n\t\t\tthis.log(\"Could not apply answer, wrong peer connection signaling state \" + this.peerConnection.signalingState);\n\t\t\treturn;\n\t\t}\n\n\t\tif (trackList)\n\t\t{\n\t\t\tthis.trackList = BX.util.array_flip(trackList);\n\t\t}\n\n\t\tconst sessionDescription = new RTCSessionDescription({\n\t\t\ttype: \"answer\",\n\t\t\tsdp: sdp\n\t\t});\n\n\t\tclearTimeout(this.connectionOfferReplyTimeout);\n\n\t\tthis.log(\"User: \" + this.userId + \"; Applying remote answer\");\n\t\tthis.peerConnection\n\t\t\t.setRemoteDescription(sessionDescription)\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.applyPendingIceCandidates();\n\t\t\t})\n\t\t\t.catch((e) =>\n\t\t\t{\n\t\t\t\tthis.failureReason = e.toString();\n\t\t\t\tthis.updateCalculatedState();\n\t\t\t\tthis.log(e);\n\t\t\t})\n\t\t\t.finally(() =>\n\t\t\t{\n\t\t\t\tthis.call.setPublishingState(MediaStreamsKinds.Camera, false);\n\t\t\t})\n\t\t;\n\t};\n\n\taddIceCandidate(connectionId, candidate)\n\t{\n\t\tif (!this.peerConnection)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.peerConnectionId != connectionId)\n\t\t{\n\t\t\tthis.log(\"Error: Candidate for unknown connection \" + connectionId);\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.peerConnection.remoteDescription && this.peerConnection.remoteDescription.type)\n\t\t{\n\t\t\tthis.peerConnection\n\t\t\t\t.addIceCandidate(candidate)\n\t\t\t\t.then(() =>\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"User: \" + this.userId + \"; Added remote ICE candidate: \" + (candidate ? candidate.candidate : candidate));\n\t\t\t\t})\n\t\t\t\t.catch((e) =>\n\t\t\t\t{\n\t\t\t\t\tthis.log(e);\n\t\t\t\t})\n\t\t\t;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (!this.pendingIceCandidates[connectionId])\n\t\t\t{\n\t\t\t\tthis.pendingIceCandidates[connectionId] = [];\n\t\t\t}\n\t\t\tthis.pendingIceCandidates[connectionId].push(candidate);\n\t\t}\n\t};\n\n\tapplyPendingIceCandidates()\n\t{\n\t\tif (!this.peerConnection || !this.peerConnection.remoteDescription.type)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (Type.isArray(this.pendingIceCandidates[this.peerConnectionId]))\n\t\t{\n\t\t\tthis.pendingIceCandidates[this.peerConnectionId].forEach((candidate) =>\n\t\t\t{\n\t\t\t\tthis.peerConnection.addIceCandidate(candidate).then(() =>\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"User: \" + this.userId + \"; Added remote ICE candidate: \" + (candidate ? candidate.candidate : candidate));\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tthis.pendingIceCandidates[this.peerConnectionId] = [];\n\t\t}\n\t};\n\n\tonNegotiationNeeded()\n\t{\n\t\tif (this.peerConnection)\n\t\t{\n\t\t\tif (this.peerConnection.signalingState == \"have-local-offer\")\n\t\t\t{\n\t\t\t\tthis.sendOffer();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.createAndSendOffer({iceRestart: true});\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.sendMedia();\n\t\t}\n\t};\n\n\treconnect(reconnectInfoObject)\n\t{\n\t\tclearTimeout(this.reconnectAfterDisconnectTimeout);\n\n\t\tthis.connectionAttempt++;\n\n\n\t\tif (this.connectionAttempt > 3)\n\t\t{\n\t\t\tthis.log(\"Error: Too many reconnection attempts, giving up\");\n\t\t\tthis.failureReason = \"Could not connect to user in time\";\n\t\t\tthis.updateCalculatedState();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callbacks.onReconnecting({\n\t\t\treconnectionReason: reconnectInfoObject?.reconnectionReason || 'TRYING_RESTORE_ICE_CONNECTION',\n\t\t\treconnectionReasonInfo: reconnectInfoObject?.reconnectionReasonInfo || '',\n\t\t});\n\n\t\tif (reconnectInfoObject && reconnectInfoObject.reconnectionReasonInfo)\n\t\t{\n\t\t\tthis.log(reconnectInfoObject.reconnectionReasonInfo);\n\t\t}\n\n\t\tthis.log(\"Trying to restore ICE connection. Attempt \" + this.connectionAttempt);\n\n\t\tif (this.isInitiator())\n\t\t{\n\t\t\tthis._destroyPeerConnection();\n\t\t\tthis.sendMedia();\n\t\t}\n\t\telse\n\t\t{\n\t\t\t//this.sendNegotiationNeeded(true);\n\t\t}\n\t};\n\n\tdisconnect()\n\t{\n\t\tthis._destroyPeerConnection();\n\n\t\tthis.outgoingVideoTrack = null;\n\t\tthis.outgoingScreenTrack = null;\n\t\tthis.outgoingVideoHoldState = false;\n\n\t\tthis.incomingAudioTrack = null;\n\t\tthis.incomingScreenAudioTrack = null;\n\t\tthis.incomingVideoTrack = null;\n\t\tthis.incomingScreenTrack = null;\n\t};\n\n\tlog()\n\t{\n\t\tthis.call.log.apply(this.call, arguments);\n\t};\n\n\tdestroy()\n\t{\n\t\tthis.disconnect();\n\n\t\tif (this.voiceDetection)\n\t\t{\n\t\t\tthis.voiceDetection.destroy();\n\t\t\tthis.voiceDetection = null;\n\t\t}\n\n\t\tfor (let tag in this.localStreams)\n\t\t{\n\t\t\tthis.localStreams[tag] = null;\n\t\t}\n\n\t\tclearTimeout(this.answerTimeout);\n\t\tthis.answerTimeout = null;\n\n\t\tclearTimeout(this.connectionTimeout);\n\t\tthis.connectionTimeout = null;\n\n\t\tclearTimeout(this.signalingConnectionTimeout);\n\t\tthis.signalingConnectionTimeout = null;\n\n\t\tthis.callbacks.onStateChanged = BX.DoNothing;\n\t\tthis.callbacks.onMediaReceived = BX.DoNothing;\n\t\tthis.callbacks.onMediaStopped = BX.DoNothing;\n\t};\n}","import {Type} from 'main.core';\n\nimport {AbstractCall} from './abstract_call';\nimport {\n\tEndpointDirection,\n\tUserState,\n\tQuality,\n\tUserMnemonic,\n\tCallEvent,\n\tCallState,\n\tCallType,\n\tProvider\n} from './engine';\nimport { CallEngineLegacy } from './engine_legacy';\nimport {Call, CALL_STATE, MediaStreamsKinds} from '../call_api.js';\nimport {View} from '../view/view';\nimport {SimpleVAD} from './simple_vad'\nimport {Hardware} from '../call_hardware';\nimport Util from '../util'\n\nimport {Event} from 'main.core';\n\n/**\n * Implements Call interface\n * Public methods:\n * - inviteUsers\n * - answer\n * - decline\n * - hangup\n *\n * Events:\n * - onCallStateChanged //not sure about this.\n * - onUserStateChanged\n * - onStreamReceived\n * - onStreamRemoved\n * - onDestroy\n */\n\nconst ajaxActions = {\n\tinvite: 'im.call.invite',\n\tanswer: 'im.call.answer',\n\tdecline: 'im.call.decline',\n\thangup: 'im.call.hangup',\n\tping: 'im.call.ping',\n\tfinish: 'im.call.finish',\n};\n\nconst pullEvents = {\n\tping: 'Call::ping',\n\tanswer: 'Call::answer',\n\thangup: 'Call::hangup',\n\tuserInviteTimeout: 'Call::userInviteTimeout',\n\trepeatAnswer: 'Call::repeatAnswer',\n};\n\nconst clientEvents = {\n\tvoiceStarted: 'Call::voiceStarted',\n\tvoiceStopped: 'Call::voiceStopped',\n\tmicrophoneState: 'Call::microphoneState',\n\tcameraState: 'Call::cameraState',\n\tvideoPaused: 'Call::videoPaused',\n\tscreenState: 'Call::screenState',\n\trecordState: 'Call::recordState',\n\temotion: 'Call::emotion',\n\tcustomMessage: 'Call::customMessage',\n\tshowUsers: 'Call::showUsers',\n\tshowAll: 'Call::showAll',\n\thideAll: 'Call::hideAll',\n};\n\nconst scenarioEvents = {\n\tviewerJoined: 'Call::viewerJoined',\n\tviewerLeft: 'Call::viewerLeft',\n};\n\nconst BitrixCallEvent = {\n\tonCallConference: 'BitrixCall::onCallConference'\n};\n\nconst MediaKinds = {\n\t[MediaStreamsKinds.Camera]: 'video',\n\t[MediaStreamsKinds.Microphone]: 'audio',\n\t[MediaStreamsKinds.Screen]: 'sharing',\n\t[MediaStreamsKinds.ScreenAudio]: 'sharingAudio',\n};\n\nconst pingPeriod = 5000;\nconst backendPingPeriod = 25000;\nconst reinvitePeriod = 5500;\n\n// const MAX_USERS_WITHOUT_SIMULCAST = 6;\n\nexport class BitrixCallLegacy extends AbstractCall\n{\n\tstatic Event = BitrixCallEvent\n\tpeers: { [key: number]: Peer }\n\tlocalVAD: ?SimpleVAD\n\n\tconstructor(config)\n\t{\n\t\tsuper(config);\n\n\t\tthis.videoQuality = Quality.VeryHigh; // initial video quality. will drop on new peers connecting\n\n\t\tthis.BitrixCall = null;\n\n\t\tthis.signaling = new Signaling({\n\t\t\tcall: this\n\t\t});\n\n\t\tthis.peers = {};\n\t\tthis.peersWithBadConnection = new Set();\n\t\tthis.joinedElsewhere = false;\n\t\tthis.joinedAsViewer = false;\n\t\tthis.localVideoShown = false;\n\t\tthis._localUserState = UserState.Idle;\n\t\tthis.clientEventsBound = false;\n\t\tthis._screenShared = false;\n\t\tthis.videoAllowedFrom = UserMnemonic.all;\n\t\tthis.direction = EndpointDirection.SendRecv;\n\t\tthis.floorRequestActive = false;\n\n\t\tthis.recordState = {\n\t\t\tstate: View.RecordState.Stopped,\n\t\t\tuserId: 0,\n\t\t\tdate: {\n\t\t\t\tstart: null,\n\t\t\t\tpause: []\n\t\t\t},\n\t\t};\n\n\t\tthis.microphoneLevelInterval = null;\n\n\t\twindow.addEventListener(\"unload\", this.#onWindowUnload);\n\n\t\tthis.initPeers();\n\n\t\tthis.pingUsersInterval = setInterval(this.pingUsers.bind(this), pingPeriod);\n\t\tthis.pingBackendInterval = setInterval(this.pingBackend.bind(this), backendPingPeriod);\n\n\t\tthis.lastPingReceivedTimeout = null;\n\t\tthis.lastSelfPingReceivedTimeout = null;\n\n\t\tthis.reinviteTimeout = null;\n\n\t\tthis._reconnectionEventCount = 0;\n\n\t\tthis.pullEventHandlers = {\n\t\t\t'Call::answer': this.#onPullEventAnswer,\n\t\t\t'Call::hangup': this.#onPullEventHangup,\n\t\t\t'Call::usersJoined': this.#onPullEventUsersJoined,\n\t\t\t'Call::usersInvited': this.#onPullEventUsersInvited,\n\t\t\t'Call::userInviteTimeout': this.#onPullEventUserInviteTimeout,\n\t\t\t'Call::ping': this.#onPullEventPing,\n\t\t\t'Call::finish': this.#onPullEventFinish,\n\t\t\t'Call::repeatAnswer': this.#onPullEventRepeatAnswer,\n\t\t\t'Call::switchTrackRecordStatus': this.#onPullEventSwitchTrackRecordStatus,\n\t\t};\n\n\t\tthis._isCopilotActive = config.isCopilotActive;\n\t\tthis._isCopilotFeaturesEnabled = true;\n\t\tthis._isRecordWhenCopilotActivePopupAlreadyShow = false;\n\t\tthis._isBoostExpired = false;\n\t};\n\n\tget provider()\n\t{\n\t\treturn Provider.Bitrix;\n\t}\n\n\tget screenShared()\n\t{\n\t\treturn this._screenShared;\n\t}\n\n\tget isCopilotActive()\n\t{\n\t\treturn this._isCopilotActive;\n\t}\n\n\tset isCopilotActive(isCopilotActive)\n\t{\n\t\tif (isCopilotActive !== this._isCopilotActive)\n\t\t{\n\t\t\tthis._isCopilotActive = isCopilotActive;\n\t\t}\n\t}\n\n\tget isBoostExpired()\n\t{\n\t\treturn this._isBoostExpired;\n\t}\n\n\tset isBoostExpired(isBoostExpired)\n\t{\n\t\tif (isBoostExpired !== this._isBoostExpired)\n\t\t{\n\t\t\tthis._isBoostExpired = isBoostExpired;\n\t\t}\n\t}\n\n\tget isCopilotFeaturesEnabled()\n\t{\n\t\treturn this._isCopilotFeaturesEnabled;\n\t}\n\n\tset isCopilotFeaturesEnabled(isCopilotFeaturesEnabled)\n\t{\n\t\tif (isCopilotFeaturesEnabled !== this._isCopilotFeaturesEnabled)\n\t\t{\n\t\t\tthis._isCopilotFeaturesEnabled = isCopilotFeaturesEnabled;\n\t\t}\n\t}\n\n\tget isRecordWhenCopilotActivePopupAlreadyShow()\n\t{\n\t\treturn this._isRecordWhenCopilotActivePopupAlreadyShow;\n\t}\n\n\tset isRecordWhenCopilotActivePopupAlreadyShow(isRecordWhenCopilotActivePopupAlreadyShow)\n\t{\n\t\tif (isRecordWhenCopilotActivePopupAlreadyShow !== this._isRecordWhenCopilotActivePopupAlreadyShow)\n\t\t{\n\t\t\tthis._isRecordWhenCopilotActivePopupAlreadyShow = isRecordWhenCopilotActivePopupAlreadyShow;\n\t\t}\n\t}\n\n\tset screenShared(screenShared)\n\t{\n\t\tif (screenShared !== this._screenShared)\n\t\t{\n\t\t\tthis._screenShared = screenShared;\n\t\t\tthis.signaling.sendScreenState(this._screenShared);\n\t\t}\n\t}\n\n\tget localUserState()\n\t{\n\t\treturn this._localUserState\n\t}\n\n\tset localUserState(state)\n\t{\n\t\tif (state === this._localUserState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.runCallback(CallEvent.onUserStateChanged, {\n\t\t\tuserId: this.userId,\n\t\t\tstate: state,\n\t\t\tpreviousState: this._localUserState,\n\t\t\tdirection: this.direction,\n\t\t});\n\t\tthis._localUserState = state;\n\t}\n\n\tget reconnectionEventCount()\n\t{\n\t\treturn this._reconnectionEventCount;\n\t}\n\n\tset reconnectionEventCount(newValue)\n\t{\n\t\tif (this._reconnectionEventCount === 0 && newValue > 0)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onReconnecting, {\n\t\t\t\treconnectionEventCount: newValue,\n\t\t\t});\n\t\t}\n\t\tif (newValue === 0)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onReconnected);\n\t\t}\n\t\tthis._reconnectionEventCount = newValue;\n\t}\n\n\tinitPeers()\n\t{\n\t\tthis.users.forEach((userId) =>\n\t\t{\n\t\t\tuserId = Number(userId);\n\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t});\n\t};\n\n\treinitPeers()\n\t{\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers.hasOwnProperty(userId) && this.peers[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId].destroy();\n\t\t\t\tthis.peers[userId] = null;\n\t\t\t}\n\t\t}\n\n\t\tthis.initPeers();\n\t};\n\n\tpingUsers()\n\t{\n\t\tif (this.ready)\n\t\t{\n\t\t\tconst users = this.users.concat(this.userId);\n\t\t\tthis.signaling.sendPingToUsers({userId: users}, true);\n\t\t}\n\t};\n\n\tpingBackend()\n\t{\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.signaling.sendPingToBackend();\n\t\t}\n\t};\n\n\tcreatePeer(userId)\n\t{\n\t\tlet incomingVideoAllowed;\n\t\tif (this.videoAllowedFrom === UserMnemonic.all)\n\t\t{\n\t\t\tincomingVideoAllowed = true;\n\t\t}\n\t\telse if (this.videoAllowedFrom === UserMnemonic.none)\n\t\t{\n\t\t\tincomingVideoAllowed = false;\n\t\t}\n\t\telse if (Type.isArray(this.videoAllowedFrom))\n\t\t{\n\t\t\tincomingVideoAllowed = this.videoAllowedFrom.some(allowedUserId => allowedUserId == userId);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tincomingVideoAllowed = true;\n\t\t}\n\n\t\treturn new Peer({\n\t\t\tcall: this,\n\t\t\tuserId: userId,\n\t\t\tready: userId == this.initiatorId,\n\t\t\tisIncomingVideoAllowed: incomingVideoAllowed,\n\n\t\t\tonMediaReceived: (e) =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onRemoteMediaReceived, e);\n\t\t\t\tif (e.kind === 'video')\n\t\t\t\t{\n\t\t\t\t\tthis.runCallback(CallEvent.onUserVideoPaused, {\n\t\t\t\t\t\tuserId: userId,\n\t\t\t\t\t\tvideoPaused: false\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\tonMediaRemoved: (e) =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onRemoteMediaStopped, e);\n\t\t\t},\n\t\t\tonStateChanged: this.#onPeerStateChanged,\n\t\t\tonInviteTimeout: this.#onPeerInviteTimeout,\n\n\t\t})\n\t};\n\n\tgetUsers()\n\t{\n\t\tlet result = {};\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tresult[userId] = this.peers[userId].calculatedState;\n\t\t}\n\n\t\treturn result;\n\t};\n\n\tgetUserCount()\n\t{\n\t\treturn Object.keys(this.peers).length;\n\t};\n\n\tcanChangeMediaDevices()\n\t{\n\t\treturn !this.BitrixCall?.isMediaMutedBySystem;\n\t};\n\n\tsetMuted = (event) =>\n\t{\n\t\tif (this.muted === event.data.isMicrophoneMuted)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.muted = event.data.isMicrophoneMuted;\n\n\t\tif (this.BitrixCall)\n\t\t{\n\t\t\tif (!event.data.calledProgrammatically)\n\t\t\t{\n\t\t\t\tthis.signaling.sendMicrophoneState(!this.muted);\n\t\t\t}\n\n\t\t\tif (this.muted)\n\t\t\t{\n\t\t\t\tthis.BitrixCall.disableAudio();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (!this.BitrixCall.isAudioPublished())\n\t\t\t\t{\n\t\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Microphone, true);\n\t\t\t\t}\n\t\t\t\tthis.BitrixCall.enableAudio();\n\t\t\t}\n\t\t}\n\t};\n\n\tsetVideoEnabled = (event) =>\n\t{\n\t\tif (this.videoEnabled === event.data.isCameraOn)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.videoEnabled = event.data.isCameraOn;\n\n\t\tif (this.BitrixCall)\n\t\t{\n\t\t\tif (!event.data.calledProgrammatically)\n\t\t\t{\n\t\t\t\tthis.signaling.sendCameraState(this.videoEnabled);\n\t\t\t}\n\n\t\t\tif (this.videoEnabled)\n\t\t\t{\n\t\t\t\tif (!this.BitrixCall.isVideoPublished())\n\t\t\t\t{\n\t\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Camera, true);\n\t\t\t\t}\n\t\t\t\tthis.localVideoShown = true;\n\t\t\t\tthis.BitrixCall.enableVideo();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (this.localVideoShown)\n\t\t\t\t{\n\t\t\t\t\tthis.localVideoShown = false;\n\t\t\t\t\tthis.BitrixCall.disableVideo();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tsetCameraId(cameraId)\n\t{\n\t\tif (this.cameraId === cameraId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.cameraId = cameraId;\n\n\t\tif (this.BitrixCall)\n\t\t{\n\t\t\tif (!cameraId)\n\t\t\t{\n\t\t\t\tthis.#onBeforeLocalMediaRendererRemoved(MediaStreamsKinds.Camera);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.BitrixCall.isVideoPublished())\n\t\t\t{\n\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Camera, true);\n\t\t\t}\n\n\t\t\tthis.BitrixCall.switchActiveVideoDevice(this.cameraId)\n\t\t\t\t.then(() =>\n\t\t\t\t{\n\t\t\t\t\tif (Hardware.isCameraOn)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.runCallback('onUpdateLastUsedCameraId');\n\n\t\t\t\t\t\tif (this.BitrixCall.isVideoPublished() && this.canChangeMediaDevices())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.BitrixCall.getLocalVideo()\n\t\t\t\t\t\t\t\t.then(track => {\n\t\t\t\t\t\t\t\t\tconst mediaRenderer = new MediaRenderer({\n\t\t\t\t\t\t\t\t\t\tkind: 'video',\n\t\t\t\t\t\t\t\t\t\ttrack,\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\t\t\t\t\t\t\tmediaRenderer,\n\t\t\t\t\t\t\t\t\t\ttag: 'main',\n\t\t\t\t\t\t\t\t\t\tstream: mediaRenderer.stream,\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.finally(() => {\n\t\t\t\t\t\t\t\t\tif (this.BitrixCall.isVideoPublished())\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Camera, false);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (!this.canChangeMediaDevices())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.runCallback(CallEvent.onNeedResetMediaDevicesState);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Camera, true);\n\t\t\t\t\t\t\tthis.localVideoShown = true;\n\t\t\t\t\t\t\tthis.BitrixCall.enableVideo(true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Camera, false);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch((e) =>\n\t\t\t\t{\n\t\t\t\t\tthis.log(e);\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t\tthis.#onBeforeLocalMediaRendererRemoved(MediaStreamsKinds.Camera);\n\t\t\t\t});\n\t\t}\n\t};\n\n\tsetMicrophoneId(microphoneId)\n\t{\n\t\tif (this.microphoneId === microphoneId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.microphoneId = microphoneId;\n\n\t\tif (this.BitrixCall)\n\t\t{\n\t\t\tif (!microphoneId)\n\t\t\t{\n\t\t\t\tthis.#onBeforeLocalMediaRendererRemoved(MediaStreamsKinds.Microphone);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#setPublishingState(MediaStreamsKinds.Microphone, true);\n\t\t\tthis.#onEndpointVoiceEnd({userId: this.userId});\n\n\t\t\tthis.BitrixCall.switchActiveAudioDevice(this.microphoneId)\n\t\t\t\t.then(() =>\n\t\t\t\t{\n\t\t\t\t\tthis.BitrixCall.getLocalAudio()\n\t\t\t\t\t\t.then(track => {\n\t\t\t\t\t\t\tthis.#onMicAccessResult({\n\t\t\t\t\t\t\t\tresult: true,\n\t\t\t\t\t\t\t\tstream: new MediaStream([track]),\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch((e) =>\n\t\t\t\t{\n\t\t\t\t\tthis.log(e);\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t\tthis.runCallback(CallEvent.onUserMicrophoneState, {\n\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\tmicrophoneState: false,\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t\t.finally(() => {\n\t\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Microphone, false);\n\n\t\t\t\t\tif (Hardware.isMicrophoneMuted && !this.canChangeMediaDevices())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.BitrixCall.disableAudio();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t}\n\t};\n\n\t#setPublishingState(deviceType, publishing)\n\t{\n\t\tif (deviceType === MediaStreamsKinds.Camera)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onCameraPublishing, {\n\t\t\t\tpublishing\n\t\t\t});\n\t\t}\n\t\telse if (deviceType === MediaStreamsKinds.Microphone)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onMicrophonePublishing, {\n\t\t\t\tpublishing\n\t\t\t});\n\t\t}\n\t}\n\n\tuseHdVideo(flag)\n\t{\n\t\tthis.videoHd = (flag === true);\n\t};\n\n\tsetMainStream(userId)\n\t{\n\t\tif (userId && userId !== this.userId)\n\t\t{\n\t\t\tconst participant = this.peers[userId]?.participant;\n\t\t\tconst kind = participant?.screenSharingEnabled ? MediaStreamsKinds.Screen : MediaStreamsKinds.Camera;\n\t\t\tthis.BitrixCall.setMainStream(userId, kind);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.BitrixCall.resetMainStream();\n\t\t}\n\t}\n\n\trequestFloor(requestActive)\n\t{\n\t\tif (this.floorRequestActive === requestActive)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.floorRequestActive = requestActive;\n\t\tthis.BitrixCall.raiseHand(requestActive);\n\t};\n\n\tturnOffAllParticipansStream(options)\n\t{\n\t\tthis.BitrixCall.turnOffAllParticipansStream(options);\n\t};\n\n\tturnOffParticipantStream(options)\n\t{\n\t\tthis.BitrixCall.turnOffParticipantStream(options);\n\t};\n\t\n\tallowSpeakPermission(options)\n\t{\n\t\tthis.BitrixCall.allowSpeakPermission(options);\n\t};\n\n\tchangeSettings(options)\n\t{\n\t\tthis.BitrixCall.changeSettings(options);\n\t};\n\n\tsendRecordState(recordState)\n\t{\n\t\trecordState.senderId = this.userId;\n\n\t\tif (!this.#changeRecordState(recordState))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.runCallback(CallEvent.onUserRecordState, {\n\t\t\tuserId: this.userId,\n\t\t\trecordState: this.recordState\n\t\t})\n\t\tthis.signaling.sendRecordState(this.userId, this.recordState);\n\t};\n\n\tsendCustomMessage(message, repeatOnConnect)\n\t{\n\t\tthis.signaling.sendCustomMessage(message, repeatOnConnect);\n\t};\n\n\t/**\n\t * Updates list of users,\n\t */\n\tallowVideoFrom(userList: $Keys<typeof UserMnemonic> | number[])\n\t{\n\t\tif (this.videoAllowedFrom == userList)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.videoAllowedFrom = userList;\n\n\t\tif (userList === UserMnemonic.all)\n\t\t{\n\t\t\tthis.signaling.sendShowAll();\n\t\t\tuserList = Object.keys(this.peers);\n\t\t}\n\t\telse if (userList === UserMnemonic.none)\n\t\t{\n\t\t\tthis.signaling.sendHideAll();\n\t\t\tuserList = [];\n\t\t}\n\t\telse if (Type.isArray(userList))\n\t\t{\n\t\t\tthis.signaling.sendShowUsers(userList)\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthrow new Error(\"userList is in wrong format\");\n\t\t}\n\n\t\tlet users = {};\n\t\tuserList.forEach(userId => users[userId] = true);\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (!this.peers.hasOwnProperty(userId))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (users[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId].allowIncomingVideo(true);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.peers[userId].allowIncomingVideo(false);\n\t\t\t}\n\t\t}\n\t};\n\n\tstartScreenSharing()\n\t{\n\t\tif (!this.BitrixCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.waitingLocalScreenShare = true;\n\t\tthis.runCallback(CallEvent.onUserScreenState, {\n\t\t\tuserId: this.userId,\n\t\t\tscreenState: true,\n\t\t});\n\n\t\tthis.BitrixCall.startScreenShare();\n\t};\n\n\tstopScreenSharing()\n\t{\n\t\tthis.#onBeforeLocalMediaRendererRemoved(MediaStreamsKinds.Screen);\n\t};\n\n\tisScreenSharingStarted()\n\t{\n\t\treturn this.screenShared || this.waitingLocalScreenShare;\n\t};\n\n\tisGetUserMediaFulfilled()\n\t{\n\t\treturn this.getUserMediaFulfilled;\n\t};\n\n\t/**\n\t * Invites users to participate in the call.\n\t */\n\tinviteUsers(config: { users: number[], show?: boolean } = {})\n\t{\n\t\tthis.ready = true;\n\t\tlet users = Type.isArray(config.users) ? config.users : this.users;\n\n\t\tthis.attachToConference()\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.signaling.sendPingToUsers({userId: users});\n\n\t\t\t\tif (users.length > 0)\n\t\t\t\t{\n\t\t\t\t\treturn this.signaling.inviteUsers({\n\t\t\t\t\t\tuserIds: users,\n\t\t\t\t\t\tvideo: Hardware.isCameraOn ? 'Y' : 'N',\n\t\t\t\t\t\tshow: config.show === true ? 'Y' : 'N',\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.state = CallState.Connected;\n\t\t\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\t\t\tlocal: true\n\t\t\t\t});\n\t\t\t\tfor (let i = 0; i < users.length; i++)\n\t\t\t\t{\n\t\t\t\t\tconst userId = parseInt(users[i]);\n\t\t\t\t\tif (!this.users.includes(userId))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.users.push(userId);\n\t\t\t\t\t}\n\t\t\t\t\tif (!this.peers[userId])\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.peers[userId] = this.createPeer(userId);\n\n\t\t\t\t\t\tif (this.type === CallType.Instant)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.runCallback(CallEvent.onUserInvited, {\n\t\t\t\t\t\t\t\tuserId: userId\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (this.type === CallType.Instant)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.peers[userId].onInvited();\n\t\t\t\t\t\tthis.scheduleRepeatInvite();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((e) =>\n\t\t\t{\n\t\t\t\tthis.#onFatalError(e)\n\t\t\t})\n\t\t;\n\t};\n\n\tscheduleRepeatInvite()\n\t{\n\t\tclearTimeout(this.reinviteTimeout);\n\t\tthis.reinviteTimeout = setTimeout(() => this.repeatInviteUsers(), reinvitePeriod)\n\t};\n\n\trepeatInviteUsers()\n\t{\n\t\tclearTimeout(this.reinviteTimeout);\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet usersToRepeatInvite = [];\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers.hasOwnProperty(userId) && this.peers[userId].calculatedState === UserState.Calling)\n\t\t\t{\n\t\t\t\tusersToRepeatInvite.push(userId);\n\t\t\t}\n\t\t}\n\n\t\tif (usersToRepeatInvite.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst inviteParams = {\n\t\t\tuserIds: usersToRepeatInvite,\n\t\t\tvideo: Hardware.isCameraOn ? 'Y' : 'N',\n\t\t\trepeated: 'Y',\n\t\t}\n\t\tthis.signaling.inviteUsers(inviteParams).then(() => this.scheduleRepeatInvite());\n\t};\n\n\t/**\n\t * @param {Object} config\n\t * @param {bool?} [config.useVideo]\n\t * @param {bool?} [config.joinAsViewer]\n\t */\n\tanswer(config = {})\n\t{\n\t\tthis.ready = true;\n\t\tconst joinAsViewer = config.joinAsViewer === true;\n\t\tthis.videoEnabled = Hardware.isCameraOn;\n\t\tthis.muted = Hardware.isMicrophoneMuted;\n\n\t\tclearTimeout(this.lastSelfPingReceivedTimeout);\n\n\t\tif (!joinAsViewer)\n\t\t{\n\t\t\tthis._outgoingAnswer = this.signaling.sendAnswer();\n\t\t}\n\t\tthis.attachToConference({joinAsViewer: joinAsViewer})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.log(\"Attached to conference\");\n\t\t\t\tthis.state = CallState.Connected;\n\t\t\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\t\t\tlocal: true\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch((err) =>\n\t\t\t{\n\t\t\t\tthis.#onFatalError(err);\n\t\t\t})\n\t\t;\n\t};\n\n\tdecline(code)\n\t{\n\t\tthis.ready = false;\n\t\tconst data = {\n\t\t\tcallId: this.id,\n\t\t\tcallInstanceId: this.instanceId,\n\t\t};\n\t\tif (code)\n\t\t{\n\t\t\tdata.code = code\n\t\t}\n\n\t\tCallEngineLegacy.getRestClient().callMethod(ajaxActions.decline, data);\n\t};\n\n\thangup(code, reason, finishCall = false)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\tconst error = new Error(\"Hangup in wrong state\");\n\t\t\tthis.log(error);\n\t\t\treturn;\n\t\t}\n\n\t\tconst tempError = new Error();\n\t\ttempError.name = \"Call stack:\";\n\t\tthis.log(\"Hangup received \\n\" + tempError.stack);\n\n\t\tif (this.localVAD)\n\t\t{\n\t\t\tthis.localVAD.destroy();\n\t\t\tthis.localVAD = null;\n\t\t}\n\t\tclearInterval(this.microphoneLevelInterval);\n\n\t\tlet data = {};\n\t\tthis.ready = false;\n\t\tif (typeof (code) != 'undefined')\n\t\t{\n\t\t\tdata.code = code;\n\t\t}\n\t\tif (typeof (reason) != 'undefined')\n\t\t{\n\t\t\tdata.reason = reason;\n\t\t}\n\t\tthis.state = CallState.Proceeding;\n\t\tthis.runCallback(CallEvent.onLeave, {local: true});\n\n\t\t//clone users and append current user id to send event to all participants of the call\n\t\tdata.userId = this.users.slice(0).concat(this.userId);\n\t\tif (this._outgoingAnswer && !finishCall)\n\t\t{\n\t\t\tthis._outgoingAnswer.then(() => this.signaling.sendHangup(data));\n\t\t}\n\t\telse if (finishCall)\n\t\t{\n\t\t\tthis.signaling.sendFinish(data);\n\t\t}\n\t\telse if (reason !== 'SIGNALING_DUPLICATE_PARTICIPANT')\n\t\t{\n\t\t\tthis.signaling.sendHangup(data)\n\t\t}\n\n\t\tif (reason !== 'SIGNALING_DUPLICATE_PARTICIPANT') {\n\t\t\t// for future reconnections\n\t\t\tthis.reinitPeers();\n\t\t}\n\n\t\tif (this.BitrixCall)\n\t\t{\n\t\t\tthis.BitrixCall._replaceVideoSharing = false;\n\t\t\tthis.BitrixCall.hangup();\n\t\t\tthis.BitrixCall = null;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.log(\"Tried to hangup, but this.BitrixCall points nowhere\");\n\t\t\tconsole.error(\"Tried to hangup, but this.BitrixCall points nowhere\");\n\t\t}\n\n\t\tthis.screenShared = false;\n\t\tthis.localVideoShown = false;\n\t\tthis.floorRequestActive = false;\n\t};\n\n\tattachToConference(options: { joinAsViewer: ?boolean } = {})\n\t{\n\t\tconst joinAsViewer = options.joinAsViewer === true;\n\t\tif (this.BitrixCall && this.BitrixCall.getState() === CALL_STATE.CONNECTED)\n\t\t{\n\t\t\tif (this.joinedAsViewer === joinAsViewer)\n\t\t\t{\n\t\t\t\treturn Promise.resolve();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn Promise.reject(\"Already joined call in another mode\");\n\t\t\t}\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tthis.direction = joinAsViewer ? EndpointDirection.RecvOnly : EndpointDirection.SendRecv;\n\t\t\tthis.sendTelemetryEvent(\"call\");\n\n\t\t\ttry\n\t\t\t{\n\t\t\t\tthis.localUserState = UserState.Connecting;\n\t\t\t\tthis.BitrixCall = new Call(this.userId);\n\n\t\t\t\t/*if (Hardware.isCameraOn) // transfered to #onCallConnected\n\t\t\t\t{\n\t\t\t\t\tthis.localVideoShown = true;\n\t\t\t\t}*/\n\n\t\t\t\tthis.joinedAsViewer = joinAsViewer;\n\n\t\t\t\tif (!this.BitrixCall)\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"Error: could not create Bitrix call\");\n\t\t\t\t\treturn reject({code: \"BITRIX_NO_CALL\"});\n\t\t\t\t}\n\n\t\t\t\tthis.runCallback(BitrixCallEvent.onCallConference, {\n\t\t\t\t\tcall: this\n\t\t\t\t});\n\n\t\t\t\tthis.bindCallEvents();\n\t\t\t\tthis.subscribeHardwareChanges();\n\n\t\t\t\tthis.BitrixCall.on('Connected', () => {\n\t\t\t\t\tthis.#onCallConnected();\n\t\t\t\t\tresolve();\n\t\t\t\t})\n\t\t\t\tthis.BitrixCall.on('Failed', (e) =>\n\t\t\t\t{\n\t\t\t\t\tthis.#onCallFailed(e);\n\t\t\t\t\treject(e);\n\t\t\t\t});\n\n\t\t\t\tif (!this.ready)\n\t\t\t\t{\n\t\t\t\t\t// for rare cases with fast quit\n\t\t\t\t\treturn reject({code: \"BITRIX_NO_CALL\"});\n\t\t\t\t}\n\n\t\t\t\tthis.BitrixCall.connect({\n\t\t\t\t\troomId: this.id,\n\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\tisLegacy: true,\n\t\t\t\t\tendpoint: this.connectionData.endpoint,\n\t\t\t\t\tjwt: this.connectionData.jwt,\n\t\t\t\t\tvideoBitrate: 1000000,\n\t\t\t\t\tvideoSimulcast: true,\n\t\t\t\t\taudioDeviceId: this.microphoneId,\n\t\t\t\t\tvideoDeviceId: this.cameraId,\n\t\t\t\t});\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tthis.#onFatalError(e);\n\t\t\t}\n\t\t});\n\t};\n\n\t#onCallConnected()\n\t{\n\t\tthis.reconnectionEventCount = 0;\n\t\tthis.log(\"Call connected\");\n\t\tthis.sendTelemetryEvent(\"connect\");\n\t\tthis.localUserState = UserState.Connected;\n\t\t\n\t\tconst MAX_USERS_WITH_VIDEO = Util.countDisableCameraNewJoinedUsersFeature();\n\t\t\n\t\tif (Util.isDisableCameraNewJoinedUsersFeatureEnabled() && this.BitrixCall.remoteParticipantsCount >= MAX_USERS_WITH_VIDEO) // task-596223\n\t\t{\n\t\t\tHardware.isCameraOn = false;\n\t\t}\n\n\t\tthis.BitrixCall.on('Failed', this.#onCallDisconnected);\n\n\t\tthis.signaling.sendMicrophoneState(!Hardware.isMicrophoneMuted);\n\t\tthis.signaling.sendCameraState(Hardware.isCameraOn);\n\n\t\tif (!this.BitrixCall.isAudioPublished())\n\t\t{\n\t\t\tthis.#setPublishingState(MediaStreamsKinds.Microphone, true);\n\t\t}\n\t\tthis.BitrixCall.enableAudio(Hardware.isMicrophoneMuted);\n\n\t\tif (Hardware.isCameraOn)\n\t\t{\n\t\t\tthis.localVideoShown = true;\n\t\t\tif (!this.BitrixCall.isVideoPublished())\n\t\t\t{\n\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Camera, true);\n\t\t\t}\n\t\t\tthis.BitrixCall.enableVideo();\n\t\t}\n\n\t\tif (this.videoAllowedFrom == UserMnemonic.none)\n\t\t{\n\t\t\tthis.signaling.sendHideAll();\n\t\t}\n\t\telse if (Type.isArray(this.videoAllowedFrom))\n\t\t{\n\t\t\tthis.signaling.sendShowUsers(this.videoAllowedFrom);\n\t\t}\n\t};\n\n\t#onCallFailed(e)\n\t{\n\t\tthis.log(\"Could not attach to conference\", e);\n\t\tthis.sendTelemetryEvent(\"connect_failure\");\n\t\tthis.localUserState = UserState.Failed;\n\n\t\tthis.BitrixCall.enableSilentLogging(false);\n\t\tthis.BitrixCall.setLoggerCallback(null);\n\t};\n\n\tbindCallEvents()\n\t{\n\t\tthis.BitrixCall.on('PublishSucceed', this.#onLocalMediaRendererAdded);\n\t\tthis.BitrixCall.on('PublishPaused', this.#onLocalMediaRendererMuteToggled);\n\t\tthis.BitrixCall.on('MediaMutedBySystem', this.#onMediaMutedBySystem);\n\t\tthis.BitrixCall.on('PublishFailed', this.#onLocalMediaRendererEnded);\n\t\tthis.BitrixCall.on('PublishEnded', this.#onLocalMediaRendererEnded);\n\t\tthis.BitrixCall.on('GetUserMediaStarted', this.#onGetUserMediaStarted.bind(this));\n\t\tthis.BitrixCall.on('GetUserMediaEnded', this.#onGetUserMediaEnded);\n\t\tthis.BitrixCall.on('GetUserMediaSuccess', this.#onGetUserMediaSuccess.bind(this));\n\t\tthis.BitrixCall.on('RemoteMediaAdded', this.#onRemoteMediaAdded);\n\t\tthis.BitrixCall.on('RemoteMediaRemoved', this.#onRemoteMediaRemoved);\n\t\tthis.BitrixCall.on('RemoteMediaMuted', this.#onRemoteMediaMuteToggled);\n\t\tthis.BitrixCall.on('RemoteMediaUnmuted', this.#onRemoteMediaMuteToggled);\n\t\tthis.BitrixCall.on('ParticipantJoined', this.#onParticipantJoined);\n\t\tthis.BitrixCall.on('ParticipantStateUpdated', () => console.log('handleParticipantStateUpdated'));\n\t\tthis.BitrixCall.on('ParticipantLeaved', this.#onParticipantLeaved);\n\t\tthis.BitrixCall.on('MessageReceived', this.#onCallMessageReceived);\n\t\tthis.BitrixCall.on('HandRaised', this.#onCallHandRaised);\n\t\tthis.BitrixCall.on('VoiceStarted', this.#onEndpointVoiceStart);\n\t\tthis.BitrixCall.on('AllParticipantsAudioMuted', this.#onAllParticipantsAudioMuted);\n\t\tthis.BitrixCall.on('AllParticipantsVideoMuted', this.#onAllParticipantsVideoMuted);\n\t\tthis.BitrixCall.on('AllParticipantsScreenshareMuted', this.#onAllParticipantsScreenshareMuted);\n\t\tthis.BitrixCall.on('YouMuteAllParticipants', this.#onYouMuteAllParticipants);\n\t\tthis.BitrixCall.on('RoomSettingsChanged', this.#onRoomSettingsChanged);\n\t\tthis.BitrixCall.on('UserPermissionsChanged', this.#onUserPermissionsChanged);\n\t\tthis.BitrixCall.on('UserRoleChanged', this.#onUserRoleChanged);\n\t\tthis.BitrixCall.on('ParticipantMuted', this.#onParticipantMuted);\n\t\tthis.BitrixCall.on('VoiceEnded', this.#onEndpointVoiceEnd);\n\t\tthis.BitrixCall.on('Reconnecting', this.#onCallReconnecting);\n\t\tthis.BitrixCall.on('Reconnected', this.#onCallReconnected);\n\t\tthis.BitrixCall.on('Disconnected', this.#onCallDisconnected);\n\t\t// if (Util.shouldCollectStats())\n\t\t// {\n\t\tthis.BitrixCall.on('CallStatsReceived', this.#onCallStatsReceived);\n\t\t// }\n\t\tthis.BitrixCall.on('UpdatePacketLoss', this.#onUpdatePacketLoss);\n\t\tthis.BitrixCall.on('ConnectionQualityChanged', this.#onConnectionQualityChanged);\n\t\tthis.BitrixCall.on('ToggleRemoteParticipantVideo', this.#onToggleRemoteParticipantVideo);\n\t\tthis.BitrixCall.on('TrackSubscriptionFailed', this.#onTrackSubscriptionFailed);\n\t};\n\n\tremoveCallEvents()\n\t{\n\t\tif (this.BitrixCall)\n\t\t{\n\t\t\tthis.BitrixCall.on('Failed', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('PublishSucceed', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('PublishFailed', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('PublishEnded', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('GetUserMediaEnded', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('RemoteMediaAdded', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('RemoteMediaRemoved', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('ParticipantJoined', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('ParticipantStateUpdated', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('ParticipantLeaved', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('MessageReceived', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('HandRaised', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('AllParticipantsAudioMuted', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('AllParticipantsVideoMuted', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('AllParticipantsScreenshareMuted', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('YouMuteAllParticipants', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('RoomSettingsChanged', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('UserPermissionsChanged', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('ParticipantMuted', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('VoiceStarted', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('VoiceEnded', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('Reconnecting', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('Reconnected', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('Disconnected', BX.DoNothing);\n\t\t\t// if (Util.shouldCollectStats())\n\t\t\t// {\n\t\t\tthis.BitrixCall.on('CallStatsReceived', BX.DoNothing);\n\t\t\t// }\n\t\t\tthis.BitrixCall.on('UpdatePacketLoss', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('ConnectionQualityChanged', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('ToggleRemoteParticipantVideo', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('TrackSubscriptionFailed', BX.DoNothing);\n\t\t}\n\t};\n\n\tsubscribeHardwareChanges()\n\t{\n\t\tHardware.subscribe(Hardware.Events.onChangeMicrophoneMuted, this.setMuted);\n\t\tHardware.subscribe(Hardware.Events.onChangeCameraOn, this.setVideoEnabled);\n\t};\n\n\tunsubscribeHardwareChanges()\n\t{\n\t\tHardware.unsubscribe(Hardware.Events.onChangeMicrophoneMuted, this.setMuted);\n\t\tHardware.unsubscribe(Hardware.Events.onChangeCameraOn, this.setVideoEnabled);\n\t};\n\n\t/**\n\t * Adds new users to call\n\t * @param {Number[]} users\n\t */\n\taddJoinedUsers(users)\n\t{\n\t\tfor (let i = 0; i < users.length; i++)\n\t\t{\n\t\t\tconst userId = Number(users[i]);\n\t\t\tif (userId == this.userId || this.peers[userId])\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t\tif (!this.users.includes(userId))\n\t\t\t{\n\t\t\t\tthis.users.push(userId);\n\t\t\t}\n\t\t\tthis.runCallback(CallEvent.onUserInvited, {\n\t\t\t\tuserId: userId\n\t\t\t});\n\t\t}\n\t};\n\n\t/**\n\t * Adds users, invited by you or someone else\n\t * @param {Number[]} users\n\t */\n\taddInvitedUsers(users, show)\n\t{\n\t\tfor (let i = 0; i < users.length; i++)\n\t\t{\n\t\t\tconst userId = Number(users[i]);\n\t\t\tif (userId == this.userId)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (!this.peers[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t\t\tthis.runCallback(CallEvent.onUserInvited, {\n\t\t\t\t\tuserId: userId\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (this.type === CallType.Instant && this.peers[userId].calculatedState !== UserState.Calling)\n\t\t\t{\n\t\t\t\tthis.peers[userId].onInvited(show);\n\t\t\t}\n\n\t\t\tif (!this.users.includes(userId))\n\t\t\t{\n\t\t\t\tthis.users.push(userId);\n\t\t\t}\n\t\t}\n\t};\n\n\ttoggleRemoteParticipantVideo(participantIds, showVideo, isPaginateToggle = false) {\n\t\tif (this.BitrixCall) {\n\t\t\tthis.BitrixCall.toggleRemoteParticipantVideo(participantIds, showVideo, isPaginateToggle)\n\t\t}\n\t}\n\n\tisAnyoneParticipating()\n\t{\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId].isParticipating())\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t};\n\n\tgetParticipatingUsers()\n\t{\n\t\tlet result = [];\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId].isParticipating())\n\t\t\t{\n\t\t\t\tresult.push(userId);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t};\n\n\t#onPeerStateChanged = (e) =>\n\t{\n\t\tthis.runCallback(CallEvent.onUserStateChanged, e);\n\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (e.state === UserState.Failed || e.state === UserState.Unavailable || e.state === UserState.Declined || e.state === UserState.Idle)\n\t\t{\n\t\t\tif (this.type == CallType.Instant && !this.isAnyoneParticipating())\n\t\t\t{\n\t\t\t\tthis.hangup();\n\t\t\t}\n\t\t}\n\t};\n\n\t#onPeerInviteTimeout = (e) =>\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.signaling.sendUserInviteTimeout({\n\t\t\tuserId: this.users,\n\t\t\tfailedUserId: e.userId\n\t\t})\n\t};\n\n\t#changeRecordState(params)\n\t{\n\t\tif (params.action !== View.RecordState.Started && this.recordState.userId != params.senderId)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (params.action === View.RecordState.Started)\n\t\t{\n\t\t\tif (this.recordState.state !== View.RecordState.Stopped)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.recordState.state = View.RecordState.Started;\n\t\t\tthis.recordState.userId = params.senderId;\n\t\t\tthis.recordState.date.start = params.date;\n\t\t\tthis.recordState.date.pause = [];\n\t\t}\n\t\telse if (params.action === View.RecordState.Paused)\n\t\t{\n\t\t\tif (this.recordState.state !== View.RecordState.Started)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.recordState.state = View.RecordState.Paused;\n\t\t\tthis.recordState.date.pause.push(\n\t\t\t\t{start: params.date, finish: null}\n\t\t\t);\n\t\t}\n\t\telse if (params.action === View.RecordState.Resumed)\n\t\t{\n\t\t\tif (this.recordState.state !== View.RecordState.Paused)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.recordState.state = View.RecordState.Started;\n\t\t\tconst pauseElement = this.recordState.date.pause.find(function (element)\n\t\t\t{\n\t\t\t\treturn element.finish === null;\n\t\t\t});\n\t\t\tif (pauseElement)\n\t\t\t{\n\t\t\t\tpauseElement.finish = params.date;\n\t\t\t}\n\t\t}\n\t\telse if (params.action === View.RecordState.Stopped)\n\t\t{\n\t\t\tthis.recordState.state = View.RecordState.Stopped;\n\t\t\tthis.recordState.userId = 0;\n\t\t\tthis.recordState.date.start = null;\n\t\t\tthis.recordState.date.pause = [];\n\t\t}\n\n\t\treturn true;\n\t};\n\n\t__onPullEvent(command, params, extra)\n\t{\n\t\tif (this.pullEventHandlers[command])\n\t\t{\n\t\t\tif (command !== 'Call::ping')\n\t\t\t{\n\t\t\t\tthis.log(\"Signaling: \" + command + \"; Parameters: \" + JSON.stringify(params));\n\t\t\t}\n\t\t\tthis.pullEventHandlers[command].call(this, params);\n\t\t}\n\t};\n\n\t#onPullEventAnswer = (params) =>\n\t{\n\t\tconst senderId = Number(params.senderId);\n\n\t\tif (senderId == this.userId)\n\t\t{\n\t\t\treturn this.__onPullEventAnswerSelf(params);\n\t\t}\n\n\t\tif (!this.peers[senderId])\n\t\t{\n\t\t\tthis.peers[senderId] = this.createPeer(senderId);\n\t\t\tthis.runCallback(CallEvent.onUserInvited, {\n\t\t\t\tuserId: senderId\n\t\t\t});\n\t\t}\n\n\t\tif (!this.users.includes(senderId))\n\t\t{\n\t\t\tthis.users.push(senderId);\n\t\t}\n\n\t\tthis.peers[senderId].setReady(true);\n\t};\n\n\t__onPullEventAnswerSelf(params)\n\t{\n\t\tif (params.callInstanceId === this.instanceId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// call was answered elsewhere\n\t\tthis.joinedElsewhere = true;\n\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\tlocal: false\n\t\t});\n\t};\n\n\t#onPullEventHangup = (params) =>\n\t{\n\t\tconst senderId = params.senderId;\n\t\tif (this.userId === senderId && params.callInstanceId && this.instanceId !== params.callInstanceId)\n\t\t{\n\t\t\t// Call declined by the same user elsewhere\n\t\t\tthis.runCallback(CallEvent.onLeave, {local: false});\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.peers[senderId])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tUtil.sendLog({'description': 'GOT A #onPullEventHangup from user', 'pullEvent': '#onPullEventHangup', params: params});\n\n\t\tthis.peers[senderId].participant = null;\n\t\tthis.peers[senderId].setReady(false);\n\n\t\tif (params.code == 603)\n\t\t{\n\t\t\tthis.peers[senderId].setDeclined(true);\n\t\t}\n\t\telse if (params.code == 486)\n\t\t{\n\t\t\tthis.peers[senderId].setBusy(true);\n\t\t\tconsole.error(\"user \" + senderId + \" is busy\");\n\t\t}\n\n\t\tif (this.ready && this.type == CallType.Instant && !this.isAnyoneParticipating())\n\t\t{\n\t\t\tthis.hangup();\n\t\t}\n\t};\n\n\t#onPullEventUsersJoined = (params) =>\n\t{\n\t\tthis.log('__onPullEventUsersJoined', params);\n\t\tconst users = params.users;\n\n\t\tthis.addJoinedUsers(users);\n\t};\n\n\t#onPullEventUsersInvited = (params) =>\n\t{\n\t\tthis.log('__onPullEventUsersInvited', params);\n\t\tconst users = params.users;\n\t\tconst show = params.show;\n\n\t\tif (this.type === CallType.Instant)\n\t\t{\n\t\t\tthis.addInvitedUsers(users, show);\n\t\t}\n\t};\n\n\t#onPullEventUserInviteTimeout = (params) =>\n\t{\n\t\tthis.log('__onPullEventUserInviteTimeout', params);\n\t\tconst failedUserId = params.failedUserId;\n\n\t\tif (this.peers[failedUserId])\n\t\t{\n\t\t\tthis.peers[failedUserId].onInviteTimeout(false);\n\t\t}\n\t};\n\n\t#onPullEventPing = (params) =>\n\t{\n\t\tif (params.callInstanceId === this.instanceId)\n\t\t{\n\t\t\t// ignore self ping\n\t\t\treturn;\n\t\t}\n\n\t\tconst senderId = Number(params.senderId);\n\n\t\tif (senderId == this.userId)\n\t\t{\n\t\t\tif (!this.joinedElsewhere)\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\t\t\tlocal: false\n\t\t\t\t});\n\t\t\t\tthis.joinedElsewhere = true;\n\t\t\t}\n\t\t\tclearTimeout(this.lastSelfPingReceivedTimeout);\n\t\t\tthis.lastSelfPingReceivedTimeout = setTimeout(this.#onNoSelfPingsReceived, pingPeriod * 2.1);\n\t\t}\n\t\tclearTimeout(this.lastPingReceivedTimeout);\n\t\tthis.lastPingReceivedTimeout = setTimeout(this.#onNoPingsReceived, pingPeriod * 2.1);\n\t\tif (this.peers[senderId])\n\t\t{\n\t\t\tthis.peers[senderId].setReady(true);\n\t\t}\n\t};\n\n\t#onNoPingsReceived = () =>\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\tthis.destroy();\n\t\t}\n\t};\n\n\t#onNoSelfPingsReceived = () =>\n\t{\n\t\tthis.runCallback(CallEvent.onLeave, {\n\t\t\tlocal: false\n\t\t});\n\t\tthis.joinedElsewhere = false;\n\t};\n\n\t#onPullEventFinish = () =>\n\t{\n\t\tthis.destroy();\n\t};\n\n\t#onPullEventRepeatAnswer = () =>\n\t{\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.signaling.sendAnswer({userId: this.userId}, true);\n\t\t}\n\t}\n\n\t#onPullEventSwitchTrackRecordStatus = (e) =>\n\t{\n\t\tthis.runCallback(CallEvent.onSwitchTrackRecordStatus, {\n\t\t\tisTrackRecordOn: e.isTrackRecordOn,\n\t\t\terrorCode: e.errorCode,\n\t\t});\n\t}\n\n\t#onLocalMediaRendererAdded = (e) =>\n\t{\n\t\tconst kind = MediaKinds[e];\n\t\tif (!kind)\n\t\t{\n\t\t\tthis.log(`Wrong kind for local mediaRenderer: ${e}`);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.log('__onLocalMediaRendererAdded', kind);\n\n\t\tswitch (e) {\n\t\t\tcase MediaStreamsKinds.Camera:\n\t\t\t\tthis.BitrixCall.getLocalVideo()\n\t\t\t\t\t.then((track) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!this.videoEnabled)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst mediaRenderer = new MediaRenderer({\n\t\t\t\t\t\t\tkind,\n\t\t\t\t\t\t\ttrack,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\t\t\t\tmediaRenderer,\n\t\t\t\t\t\t\ttag: 'main',\n\t\t\t\t\t\t\tstream: mediaRenderer.stream,\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase MediaStreamsKinds.Screen:\n\t\t\t\tthis.log(\"Screen shared\");\n\t\t\t\tthis.screenShared = true;\n\t\t\t\tthis.waitingLocalScreenShare = false;\n\n\t\t\t\tthis.BitrixCall.getLocalScreen()\n\t\t\t\t\t.then((tracks) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tconst mediaRenderer = new MediaRenderer({\n\t\t\t\t\t\t\tkind,\n\t\t\t\t\t\t\ttrack: tracks.video,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\t\t\t\tmediaRenderer,\n\t\t\t\t\t\t\ttag: 'screen',\n\t\t\t\t\t\t\tstream: new MediaStream(),\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase MediaStreamsKinds.Microphone:\n\t\t\t\tthis.BitrixCall.getLocalAudio()\n\t\t\t\t\t.then((track) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Microphone, false);\n\t\t\t\t\t\tthis.#onMicAccessResult({\n\t\t\t\t\t\t\tresult: true,\n\t\t\t\t\t\t\tstream: new MediaStream([track]),\n\t\t\t\t\t\t})\n\t\t\t\t\t});\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\t#onLocalMediaRendererMuteToggled = (e) =>\n\t{\n\t\tif (e === MediaStreamsKinds.Microphone)\n\t\t{\n\t\t\tthis.#setPublishingState(MediaStreamsKinds.Microphone, false);\n\t\t}\n\t\telse if (e === MediaStreamsKinds.Camera)\n\t\t{\n\t\t\tthis.#setPublishingState(MediaStreamsKinds.Camera, false);\n\t\t}\n\t}\n\n\t#onMediaMutedBySystem = (muted) =>\n\t{\n\t\tconst microphoneState = muted ? false : !Hardware.isMicrophoneMuted;\n\t\tconst cameraState = muted ? false : Hardware.isCameraOn;\n\t\tthis.signaling.sendMicrophoneState(microphoneState);\n\t\tthis.signaling.sendCameraState(cameraState);\n\t}\n\n\t#onLocalMediaRendererEnded = (e, interrupted) =>\n\t{\n\t\tconst kind = MediaKinds[e];\n\t\tif (!kind)\n\t\t{\n\t\t\tthis.log(`Wrong kind for mediaRenderer: ${e}`);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.BitrixCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tswitch (e)\n\t\t{\n\t\t\tcase MediaStreamsKinds.Camera:\n\t\t\tcase MediaStreamsKinds.Microphone:\n\t\t\t\tif (!interrupted)\n\t\t\t\t{\n\t\t\t\t\tthis.#onBeforeLocalMediaRendererRemoved(e);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase MediaStreamsKinds.Screen:\n\t\t\t\tthis.#onBeforeLocalMediaRendererRemoved(e);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t#onGetUserMediaStarted = (options) =>\n\t{\n\t\tthis.getUserMediaFulfilled = false;\n\n\t\tif (options.video)\n\t\t{\n\t\t\tthis.signaling.sendCameraState(false);\n\t\t}\n\n\t\tif (options.audio)\n\t\t{\n\t\t\tthis.signaling.sendMicrophoneState(false);\n\t\t}\n\t};\n\n\t#onGetUserMediaSuccess = (options) =>\n\t{\n\t\tif (options.video)\n\t\t{\n\t\t\tthis.signaling.sendCameraState(true);\n\t\t}\n\n\t\tif (options.audio)\n\t\t{\n\t\t\tthis.signaling.sendMicrophoneState(true);\n\t\t}\n\t}\n\n\t#onGetUserMediaEnded = () =>\n\t{\n\t\tthis.getUserMediaFulfilled = true;\n\t};\n\n\t#onBeforeLocalMediaRendererRemoved = (e) =>\n\t{\n\t\tconst kind = MediaKinds[e];\n\t\tif (!kind)\n\t\t{\n\t\t\tthis.log(`Wrong kind for mediaRenderer: ${e}`);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.BitrixCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.log(\"__onBeforeLocalMediaRendererRemoved\", kind);\n\n\t\tconst mediaRenderer = new MediaRenderer({\n\t\t\tkind,\n\t\t});\n\n\t\tswitch (e) {\n\t\t\tcase MediaStreamsKinds.Camera:\n\t\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\t\tmediaRenderer,\n\t\t\t\t\ttag: 'main',\n\t\t\t\t\tstream: new MediaStream(),\n\t\t\t\t\tremoved: true,\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase MediaStreamsKinds.Microphone:\n\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Microphone, false);\n\t\t\t\tthis.signaling.sendMicrophoneState(false);\n\t\t\t\tbreak;\n\t\t\tcase MediaStreamsKinds.Screen:\n\t\t\t\tthis.BitrixCall.stopScreenShare();\n\t\t\t\tthis.log(\"Screen is no longer shared\");\n\t\t\t\tthis.runCallback(CallEvent.onUserScreenState, {\n\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\tscreenState: false,\n\t\t\t\t});\n\t\t\t\tthis.screenShared = false;\n\t\t\t\tthis.waitingLocalScreenShare = false;\n\t\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\t\tmediaRenderer,\n\t\t\t\t\ttag: 'screen',\n\t\t\t\t\tstream: new MediaStream(),\n\t\t\t\t\tremoved: true,\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\t#onRemoteMediaAdded = (p, t) =>\n\t{\n\t\tconst kind = MediaKinds[t.source];\n\t\tif (!kind)\n\t\t{\n\t\t\tthis.log(`Wrong kind for mediaRenderer: ${t.source}`);\n\t\t\treturn;\n\t\t}\n\n\t\tconst e = {\n\t\t\tmediaRenderer: new MediaRenderer({\n\t\t\t\tkind,\n\t\t\t\ttrack: t.track\n\t\t\t})\n\t\t};\n\n\t\tconst peer = this.peers[p.userId];\n\t\tif (peer)\n\t\t{\n\t\t\t// temporary solution to play new streams\n\t\t\t// todo: need to find what cause the problem itself\n\t\t\tif (!peer.participant)\n\t\t\t{\n\t\t\t\tpeer.participant = p;\n\t\t\t\tpeer.updateCalculatedState();\n\t\t\t}\n\t\t\tpeer.addMediaRenderer(e.mediaRenderer);\n\t\t}\n\n\t\tswitch (t.source)\n\t\t{\n\t\t\tcase MediaStreamsKinds.Camera:\n\t\t\t\tthis.runCallback(CallEvent.onUserCameraState, {\n\t\t\t\t\tuserId: p.userId,\n\t\t\t\t\tcameraState: !p.isMutedVideo\n\t\t\t\t});\n\t\t\t\tbreak;\n\n\t\t\tcase MediaStreamsKinds.Microphone:\n\t\t\t\tthis.runCallback(CallEvent.onUserMicrophoneState, {\n\t\t\t\t\tuserId: p.userId,\n\t\t\t\t\tmicrophoneState: !p.isMutedAudio\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t}\n\n\t\tconsole.log(`[RemoteMediaAdded]: UserId: ${p.userId}, source: ${MediaKinds[t.source]}`)\n\t};\n\n\t#onRemoteMediaRemoved = (p, t) =>\n\t{\n\t\tconst kind = MediaKinds[t.source];\n\t\tif (!kind)\n\t\t{\n\t\t\tthis.log(`Wrong kind for mediaRenderer: ${t.source}`);\n\t\t\treturn;\n\t\t}\n\n\t\tconst e = {\n\t\t\tmediaRenderer: new MediaRenderer({\n\t\t\t\tkind,\n\t\t\t\ttrack: t.track\n\t\t\t})\n\t\t};\n\n\t\tconst peer = this.peers[p.userId];\n\t\tif (peer)\n\t\t{\n\t\t\tpeer.removeMediaRenderer(e.mediaRenderer);\n\t\t}\n\n\t\tif (t.source === MediaStreamsKinds.Camera)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserCameraState, {\n\t\t\t\tuserId: p.userId,\n\t\t\t\tcameraState: false\n\t\t\t});\n\t\t}\n\n\t\tconsole.log(`[RemoteMediaRemoved]: UserId: ${p.userId}, source: ${MediaKinds[t.source]}`)\n\t};\n\n\t#onRemoteMediaMuteToggled = (p, t) =>\n\t{\n\t\tif (t.source === MediaStreamsKinds.Microphone)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserMicrophoneState, {\n\t\t\t\tuserId: p.userId,\n\t\t\t\tmicrophoneState: !p.isMutedAudio\n\t\t\t});\n\t\t}\n\t}\n\n\t#onParticipantJoined = (p) =>\n\t{\n\t\tconst peer = this.peers[p.userId];\n\t\tif (peer)\n\t\t{\n\t\t\tif (!p.audioEnabled || p.isMutedAudio)\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onUserMicrophoneState, {\n\t\t\t\t\tuserId: p.userId,\n\t\t\t\t\tmicrophoneState: false\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (!p.videoEnabled || p.isMutedVideo)\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onUserCameraState, {\n\t\t\t\t\tuserId: p.userId,\n\t\t\t\t\tcameraState: false\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (p.isHandRaised)\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onUserFloorRequest, {\n\t\t\t\t\tuserId: p.userId,\n\t\t\t\t\trequestActive: p.isHandRaised\n\t\t\t\t})\n\t\t\t}\n\n\t\t\tpeer.participant = p;\n\t\t\tpeer.updateCalculatedState();\n\n\t\t\tif (this.recordState.state !== View.RecordState.Stopped && this.recordState.userId === this.userId)\n\t\t\t{\n\t\t\t\tthis.signaling.sendRecordState(this.userId, this.recordState);\n\t\t\t}\n\t\t}\n\t};\n\n\t#onParticipantLeaved = (p) =>\n\t{\n\t\tconst peer = this.peers[p.userId];\n\t\tif (peer)\n\t\t{\n\t\t\tpeer.participant = null;\n\t\t\tfor (let type in MediaStreamsKinds)\n\t\t\t{\n\t\t\t\tconst source = MediaStreamsKinds[type];\n\t\t\t\tconst kind = MediaKinds[source];\n\t\t\t\tconst e = {\n\t\t\t\t\tmediaRenderer: new MediaRenderer({\n\t\t\t\t\t\tkind,\n\t\t\t\t\t}),\n\t\t\t\t};\n\t\t\t\tpeer.removeMediaRenderer(e.mediaRenderer);\n\t\t\t}\n\t\t\tpeer.updateCalculatedState();\n\t\t}\n\t};\n\n\t#onMicAccessResult = (e) =>\n\t{\n\t\tif (e.result)\n\t\t{\n\t\t\tif (e.stream.getAudioTracks().length > 0)\n\t\t\t{\n\t\t\t\tif (this.localVAD)\n\t\t\t\t{\n\t\t\t\t\tthis.localVAD.destroy();\n\t\t\t\t}\n\t\t\t\tthis.localVAD = new SimpleVAD({\n\t\t\t\t\tmediaStream: e.stream,\n\t\t\t\t\tonVoiceStarted: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!Hardware.isMicrophoneMuted)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.requestFloor(false);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.#onEndpointVoiceStart({userId: this.userId});\n\t\t\t\t\t},\n\t\t\t\t\tonVoiceStopped: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#onEndpointVoiceEnd({userId: this.userId});\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tclearInterval(this.microphoneLevelInterval);\n\t\t\t\tthis.microphoneLevelInterval = setInterval(\n\t\t\t\t\t() =>this.microphoneLevel = this.localVAD.currentVolume,\n\t\t\t\t\t200\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t};\n\n\t#onCallReconnecting = () =>\n\t{\n\t\tif (this.reconnectionEventCount++)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (userId !== this.userId && this.peers.hasOwnProperty(userId) && this.peers[userId].calculatedState === UserState.Connected)\n\t\t\t{\n\t\t\t\tfor (let type in MediaStreamsKinds)\n\t\t\t\t{\n\t\t\t\t\tconst source = MediaStreamsKinds[type];\n\t\t\t\t\tconst kind = MediaKinds[source];\n\t\t\t\t\tconst e = {\n\t\t\t\t\t\tmediaRenderer: new MediaRenderer({\n\t\t\t\t\t\t\tkind,\n\t\t\t\t\t\t}),\n\t\t\t\t\t};\n\t\t\t\t\tthis.peers[userId].removeMediaRenderer(e.mediaRenderer);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t#onCallReconnected = () =>\n\t{\n\t\tthis.reconnectionEventCount = 0;\n\t\tthis.log(\"Call reconnected\");\n\t\tthis.sendTelemetryEvent(\"reconnect\");\n\t\tthis.localUserState = UserState.Connected;\n\n\t\tthis.signaling.sendMicrophoneState(!Hardware.isMicrophoneMuted);\n\t\tif (!this.BitrixCall.isAudioPublished())\n\t\t{\n\t\t\tthis.#setPublishingState(MediaStreamsKinds.Microphone, true);\n\t\t}\n\t\tthis.BitrixCall.enableAudio(Hardware.isMicrophoneMuted);\n\n\t\tthis.signaling.sendCameraState(Hardware.isCameraOn);\n\t\tif (Hardware.isCameraOn)\n\t\t{\n\t\t\tif (!this.BitrixCall.isVideoPublished())\n\t\t\t{\n\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Camera, true);\n\t\t\t}\n\t\t\tthis.BitrixCall.enableVideo();\n\t\t}\n\n\t\tif (this.screenShared || this.waitingLocalScreenShare)\n\t\t{\n\t\t\tthis.BitrixCall.startScreenShare();\n\t\t}\n\n\t\tif (this.videoAllowedFrom == UserMnemonic.none)\n\t\t{\n\t\t\tthis.signaling.sendHideAll();\n\t\t}\n\t\telse if (Type.isArray(this.videoAllowedFrom))\n\t\t{\n\t\t\tthis.signaling.sendShowUsers(this.videoAllowedFrom);\n\t\t}\n\n\t\tthis.BitrixCall.raiseHand(this.floorRequestActive);\n\t};\n\n\t#onCallDisconnected = (e) =>\n\t{\n\t\tlet logData = {};\n\n\t\tconst evt = e && typeof e === 'object' ? e : {}\n\t\tconst {headers, leaveInformation} = evt;\n\n\t\tif (headers) {\n\t\t\tlogData = {\n\t\t\t\t...logData,\n\t\t\t\theaders,\n\t\t\t}\n\t\t}\n\n\t\tif (leaveInformation) {\n\t\t\tlogData = {\n\t\t\t\t...logData,\n\t\t\t\tleaveInformation,\n\t\t\t}\n\t\t}\n\n\t\tthis.log(\"__onCallDisconnected\", (Object.keys(logData).length ? logData : null));\n\n\t\tif (this.ready && leaveInformation) {\n\t\t\tthis.hangup(leaveInformation.code, leaveInformation.reason)\n\t\t}\n\n\t\tthis.sendTelemetryEvent(\"disconnect\");\n\n\t\tthis.localUserState = UserState.Idle;\n\n\t\tthis.ready = false;\n\t\tthis.joinedAsViewer = false;\n\t\tthis.reinitPeers();\n\n\t\tthis.localVideoShown = false;\n\t\tthis.removeCallEvents();\n\t\tthis.unsubscribeHardwareChanges();\n\n\t\tthis.state = CallState.Proceeding;\n\t\tthis.runCallback(CallEvent.onLeave, {\n\t\t\tlocal: true\n\t\t});\n\t};\n\n\t#onWindowUnload = () =>\n\t{\n\t\tif (this.ready && this.BitrixCall)\n\t\t{\n\t\t\tthis.signaling.sendHangup({\n\t\t\t\tuserId: this.users\n\t\t\t});\n\t\t}\n\t};\n\n\t#onFatalError = (error) =>\n\t{\n\t\tif (error && error.call)\n\t\t{\n\t\t\tdelete error.call;\n\t\t}\n\t\tthis.log(\"onFatalError\", error);\n\n\t\tthis.ready = false;\n\t\tthis.localUserState = UserState.Failed;\n\t\tthis.reinitPeers();\n\n\t\tthis.localVideoShown = false;\n\t\tif (this.BitrixCall)\n\t\t{\n\t\t\tthis.removeCallEvents();\n\t\t\tthis.unsubscribeHardwareChanges();\n\t\t\ttry\n\t\t\t{\n\t\t\t\tthis.BitrixCall.hangup({\n\t\t\t\t\t'X-Reason': 'Fatal error',\n\t\t\t\t\t'X-Error': typeof (error) === 'string' ? error : error.code || error.name\n\t\t\t\t})\n\t\t\t} catch (e)\n\t\t\t{\n\t\t\t\tthis.log(\"Bitrix hangup error: \", e);\n\t\t\t\tconsole.error(\"Bitrix hangup error: \", e);\n\t\t\t}\n\t\t\tthis.BitrixCall = null;\n\t\t}\n\n\t\tif (typeof (error) === \"string\")\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onCallFailure, {\n\t\t\t\tname: error\n\t\t\t});\n\t\t}\n\t\telse if (error.name)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onCallFailure, error);\n\t\t}\n\t};\n\n\t#onTrackSubscriptionFailed = (params) =>\n\t{\n\t\tthis.runCallback(CallEvent.onTrackSubscriptionFailed, params);\n\t}\n\n\t#onCallStatsReceived = (stats) =>\n\t{\n\t\tconst usersToSendReports = {};\n\t\t// to order local stats by track quality\n\t\tconst statsIndexByRid = { f: 2, h: 1, q: 0 };\n\n\t\tstats.sender.forEach((report) =>\n\t\t{\n\t\t\tif (report.userId && (report.kind === 'video' || report.kind === 'audio'))\n\t\t\t{\n\t\t\t\tif (!usersToSendReports[report.userId])\n\t\t\t\t{\n\t\t\t\t\tusersToSendReports[report.userId] = {};\n\t\t\t\t}\n\n\t\t\t\tif (report.kind === 'video')\n\t\t\t\t{\n\t\t\t\t\tif (!usersToSendReports[report.userId][report.source])\n\t\t\t\t\t{\n\t\t\t\t\t\tusersToSendReports[report.userId][report.source] = [];\n\t\t\t\t\t}\n\n\t\t\t\t\tconst index = statsIndexByRid[report.rid] || 0;\n\t\t\t\t\tusersToSendReports[report.userId][report.source][index] = report;\n\t\t\t\t}\n\t\t\t\telse if (report.kind === 'audio')\n\t\t\t\t{\n\t\t\t\t\tusersToSendReports[report.userId][report.source] = report;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tstats.recipient.forEach((report) =>\n\t\t{\n\t\t\tif (report.userId && (report.kind === 'video' || report.kind === 'audio'))\n\t\t\t{\n\t\t\t\tif (!usersToSendReports[report.userId])\n\t\t\t\t{\n\t\t\t\t\tusersToSendReports[report.userId] = {};\n\t\t\t\t}\n\t\t\t\tusersToSendReports[report.userId][report.source] = report;\n\t\t\t}\n\t\t});\n\n\t\tfor (let userId in usersToSendReports)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserStatsReceived, {\n\t\t\t\tuserId,\n\t\t\t\treport: usersToSendReports[userId]\n\t\t\t});\n\t\t}\n\n\t\t// todo: need to correct stats format\n\t\t// if (this.logger)\n\t\t// {\n\t\t// \tthis.logger.sendStat(transformVoxStats(e.stats, this.BitrixCall));\n\t\t// }\n\t}\n\n\t#onUpdatePacketLoss = (participants) =>\n\t{\n\t\tconst prevPeersWithBadConnection = new Set([...this.peersWithBadConnection.values()]);\n\t\tparticipants.forEach(userId =>\n\t\t{\n\t\t\tconst peer = this.peers[userId];\n\t\t\tif (peer)\n\t\t\t{\n\t\t\t\tif (!prevPeersWithBadConnection.has(userId))\n\t\t\t\t{\n\t\t\t\t\tthis.peersWithBadConnection.add(userId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tprevPeersWithBadConnection.delete(userId);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t#onConnectionQualityChanged = participants =>\n\t{\n\t\tObject.keys(participants).forEach(participantId => {\n\t\t\tthis.runCallback(\n\t\t\t\tCallEvent.onConnectionQualityChanged,\n\t\t\t\t{\n\t\t\t\t\tuserId: Number(participantId),\n\t\t\t\t\tscore: participants[participantId],\n\t\t\t\t}\n\t\t\t);\n\t\t})\n\t}\n\n\t#onToggleRemoteParticipantVideo = isVideoShown =>\n\t{\n\t\tthis.runCallback(\n\t\t\tCallEvent.onToggleRemoteParticipantVideo,\n\t\t\t{ isVideoShown }\n\t\t);\n\t}\n\n\t#onCallMessageReceived = (e) =>\n\t{\n\t\tlet message;\n\t\tlet peer;\n\n\t\ttry\n\t\t{\n\t\t\tmessage = JSON.parse(e.text);\n\t\t} catch (err)\n\t\t{\n\t\t\tthis.log(\"Could not parse scenario message.\", err);\n\t\t\treturn;\n\t\t}\n\n\t\tconst eventName = message.eventName;\n\t\tif (eventName === clientEvents.cameraState)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserCameraState, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\tcameraState: message.cameraState === \"Y\"\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.videoPaused)\n\t\t{\n\t\t\tif (message.senderId === this.userId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.runCallback(CallEvent.onUserVideoPaused, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\tvideoPaused: message.videoPaused === \"Y\"\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.screenState)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserScreenState, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\tscreenState: message.screenState === \"Y\"\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.recordState)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserRecordState, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\trecordState: message.recordState\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.emotion)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserEmotion, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\ttoUserId: message.toUserId,\n\t\t\t\temotion: message.emotion\n\t\t\t})\n\t\t}\n\t\telse if (eventName === clientEvents.customMessage)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onCustomMessage, {\n\t\t\t\tmessage: message.message\n\t\t\t})\n\t\t}\n\t\telse if (eventName === scenarioEvents.viewerJoined)\n\t\t{\n\t\t\tconsole.log(\"viewer \" + message.senderId + \" joined\");\n\t\t\tpeer = this.peers[message.senderId];\n\t\t\tif (peer)\n\t\t\t{\n\t\t\t\tpeer.setDirection(EndpointDirection.RecvOnly);\n\t\t\t\tpeer.setReady(true);\n\t\t\t}\n\t\t}\n\t\telse if (eventName === scenarioEvents.viewerLeft)\n\t\t{\n\t\t\tconsole.log(\"viewer \" + message.senderId + \" left\");\n\t\t\tpeer = this.peers[message.senderId];\n\t\t\tif (peer)\n\t\t\t{\n\t\t\t\tpeer.setReady(false);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.log(\"Unknown scenario event \" + eventName);\n\t\t}\n\t};\n\n\t#onCallHandRaised = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onUserFloorRequest, {\n\t\t\tuserId: p.userId,\n\t\t\trequestActive: p.isHandRaised\n\t\t})\n\t}\n\n\t#onAllParticipantsAudioMuted = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onAllParticipantsAudioMuted, {\n\t\t\tuserId: p.fromUserId,\n\t\t\treason: p.reason,\n\t\t})\n\t}\n\n\t#onAllParticipantsVideoMuted = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onAllParticipantsVideoMuted, {\n\t\t\tuserId: p.fromUserId,\n\t\t\treason: p.reason,\n\t\t})\n\t}\n\n\t#onAllParticipantsScreenshareMuted = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onAllParticipantsScreenshareMuted, {\n\t\t\tuserId: p.fromUserId,\n\t\t\treason: p.reason,\n\t\t})\n\t}\n\n\t#onYouMuteAllParticipants = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onYouMuteAllParticipants, {\n\t\t\tdata: p\n\t\t})\n\t}\n\n\t#onRoomSettingsChanged = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onRoomSettingsChanged, {\n\t\t\tdata: p\n\t\t})\n\t}\n\n\t#onUserPermissionsChanged = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onUserPermissionsChanged, {\n\t\t\tdata: p\n\t\t})\n\t}\n\t\n\t#onUserRoleChanged = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onUserRoleChanged, {\n\t\t\tdata: p\n\t\t})\n\t}\n\n\t#onParticipantMuted = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onParticipantMuted, {\n\t\t\tdata: p\n\t\t})\n\t}\n\n\t#onEndpointVoiceStart = (p) =>\n\t{\n\t\t// for local user we need to send extra signal to show unmute hint\n\t\tif (p.userId === this.userId)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserVoiceStarted, {\n\t\t\t\tuserId: p.userId,\n\t\t\t\tlocal: true,\n\t\t\t});\n\n\t\t\tif (Hardware.isMicrophoneMuted)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.runCallback(CallEvent.onUserVoiceStarted, {\n\t\t\tuserId: p.userId,\n\t\t});\n\t};\n\n\t#onEndpointVoiceEnd = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onUserVoiceStopped, {\n\t\t\tuserId: p.userId,\n\t\t});\n\t}\n\n\tsendTelemetryEvent(eventName)\n\t{\n\t\tUtil.sendTelemetryEvent({\n\t\t\tcall_id: this.id,\n\t\t\tuser_id: this.userId,\n\t\t\tkind: \"Bitrix\",\n\t\t\tevent: eventName,\n\t\t})\n\t};\n\n\tdestroy()\n\t{\n\t\tthis.ready = false;\n\t\tthis.joinedAsViewer = false;\n\t\tthis.localVideoShown = false;\n\t\tthis.floorRequestActive = false;\n\n\t\tif (this.localVAD)\n\t\t{\n\t\t\tthis.localVAD.destroy();\n\t\t\tthis.localVAD = null;\n\t\t}\n\t\tclearInterval(this.microphoneLevelInterval);\n\t\tif (this.BitrixCall)\n\t\t{\n\t\t\tthis.removeCallEvents();\n\t\t\tthis.unsubscribeHardwareChanges();\n\t\t\tthis.BitrixCall.hangup();\n\t\t\tthis.BitrixCall = null;\n\t\t}\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers.hasOwnProperty(userId) && this.peers[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId].destroy();\n\t\t\t}\n\t\t}\n\n\t\tclearTimeout(this.lastPingReceivedTimeout);\n\t\tclearTimeout(this.lastSelfPingReceivedTimeout);\n\t\tclearInterval(this.pingUsersInterval);\n\t\tclearInterval(this.pingBackendInterval);\n\n\t\twindow.removeEventListener(\"unload\", this.#onWindowUnload);\n\t\treturn super.destroy();\n\t};\n}\n\nclass Signaling\n{\n\tconstructor(params)\n\t{\n\t\tthis.call = params.call;\n\t};\n\n\tinviteUsers(data)\n\t{\n\t\treturn this.#runRestAction(ajaxActions.invite, data);\n\t};\n\n\tsendAnswer(data, repeated)\n\t{\n\t\tif (repeated && CallEngineLegacy.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.answer, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.#runRestAction(ajaxActions.answer, data);\n\t\t}\n\t};\n\n\tsendHangup(data)\n\t{\n\t\tif (CallEngineLegacy.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.hangup, data);\n\t\t\tdata.retransmit = false;\n\t\t\tthis.#runRestAction(ajaxActions.hangup, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdata.retransmit = true;\n\t\t\tthis.#runRestAction(ajaxActions.hangup, data);\n\t\t}\n\t};\n\n\tsendFinish(data)\n\t{\n\t\tif (CallEngineLegacy.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.hangup, data);\n\t\t\tdata.retransmit = false;\n\t\t\tthis.#runRestAction(ajaxActions.finish, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdata.retransmit = true;\n\t\t\tthis.#runRestAction(ajaxActions.finish, data);\n\t\t}\n\t};\n\n\tsendCameraState(cameraState)\n\t{\n\t\treturn this.#sendMessage(clientEvents.cameraState, {\n\t\t\tcameraState: cameraState ? \"Y\" : \"N\"\n\t\t});\n\t};\n\n\tsendVideoPaused(videoPaused)\n\t{\n\t\treturn this.#sendMessage(clientEvents.videoPaused, {\n\t\t\tvideoPaused: videoPaused ? \"Y\" : \"N\"\n\t\t});\n\t};\n\n\tsendMicrophoneState(microphoneState)\n\t{\n\t\treturn this.#sendMessage(clientEvents.microphoneState, {\n\t\t\tmicrophoneState: microphoneState ? \"Y\" : \"N\"\n\t\t});\n\t};\n\n\tsendScreenState(screenState)\n\t{\n\t\treturn this.#sendMessage(clientEvents.screenState, {\n\t\t\tscreenState: screenState ? \"Y\" : \"N\"\n\t\t});\n\t};\n\n\tsendRecordState(userId, recordState)\n\t{\n\t\tthis.#sendMessage(clientEvents.recordState, {\n\t\t\tsenderId: userId,\n\t\t\trecordState: recordState\n\t\t});\n\t};\n\n\tsendCustomMessage(message, repeatOnConnect)\n\t{\n\t\treturn this.#sendMessage(clientEvents.customMessage, {\n\t\t\tmessage: message,\n\t\t\trepeatOnConnect: !!repeatOnConnect\n\t\t});\n\t};\n\n\tsendShowUsers(users)\n\t{\n\t\treturn this.#sendMessage(clientEvents.showUsers, {\n\t\t\tusers: users\n\t\t});\n\t};\n\n\tsendShowAll()\n\t{\n\t\treturn this.#sendMessage(clientEvents.showAll, {});\n\t};\n\n\tsendHideAll()\n\t{\n\t\treturn this.#sendMessage(clientEvents.hideAll, {});\n\t};\n\n\tsendPingToUsers(data)\n\t{\n\t\tif (CallEngineLegacy.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.ping, data, 0);\n\t\t}\n\t};\n\n\tsendPingToBackend()\n\t{\n\t\tthis.#runRestAction(ajaxActions.ping, {retransmit: false});\n\t};\n\n\tsendUserInviteTimeout(data)\n\t{\n\t\tif (CallEngineLegacy.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.userInviteTimeout, data, 0);\n\t\t}\n\t};\n\n\t#sendPullEvent(eventName, data, expiry)\n\t{\n\t\texpiry = expiry || 5;\n\t\tif (!data.userId)\n\t\t{\n\t\t\tthrow new Error('userId is not found in data');\n\t\t}\n\n\t\tif (!Type.isArray(data.userId))\n\t\t{\n\t\t\tdata.userId = [data.userId];\n\t\t}\n\t\tif (data.userId.length === 0)\n\t\t{\n\t\t\t// nobody to send, exit\n\t\t\treturn;\n\t\t}\n\n\t\tdata.callInstanceId = this.call.instanceId;\n\t\tdata.senderId = this.call.userId;\n\t\tdata.callId = this.call.id;\n\t\tdata.requestId = Util.getUuidv4();\n\n\t\tthis.call.log('Sending p2p signaling event ' + eventName + '; ' + JSON.stringify(data));\n\t\tCallEngineLegacy.getPullClient().sendMessage(data.userId, 'im', eventName, data, expiry);\n\t};\n\n\t#sendMessage(eventName, data)\n\t{\n\t\tif (!this.call.BitrixCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!Type.isPlainObject(data))\n\t\t{\n\t\t\tdata = {};\n\t\t}\n\t\tdata.eventName = eventName;\n\t\tdata.requestId = Util.getUuidv4();\n\t\tdata.senderId = this.call.userId;\n\n\t\tthis.call.BitrixCall.sendMessage(JSON.stringify(data));\n\t};\n\n\t#runRestAction(signalName, data)\n\t{\n\t\tif (!Type.isPlainObject(data))\n\t\t{\n\t\t\tdata = {};\n\t\t}\n\n\t\tdata.callId = this.call.id;\n\t\tdata.callInstanceId = this.call.instanceId;\n\t\tdata.requestId = Util.getUuidv4();\n\t\treturn CallEngineLegacy.getRestClient().callMethod(signalName, data);\n\t};\n}\n\nclass Peer\n{\n\tcalculatedState: string\n\n\tconstructor(params)\n\t{\n\t\tthis.userId = params.userId;\n\t\tthis.call = params.call;\n\n\t\tthis.ready = !!params.ready;\n\t\tthis.calling = false;\n\t\tthis.backgroundCalling = false;\n\t\tthis.declined = false;\n\t\tthis.busy = false;\n\t\tthis.inviteTimeout = false;\n\t\tthis.direction = params.direction || EndpointDirection.SendRecv;\n\n\t\tthis.stream = null;\n\t\tthis.mediaRenderers = [];\n\n\t\tthis.isIncomingVideoAllowed = params.isIncomingVideoAllowed !== false;\n\n\t\tthis.callingTimeout = 0;\n\n\t\tthis.callbacks = {\n\t\t\tonStateChanged: Type.isFunction(params.onStateChanged) ? params.onStateChanged : BX.DoNothing,\n\t\t\tonInviteTimeout: Type.isFunction(params.onInviteTimeout) ? params.onInviteTimeout : BX.DoNothing,\n\t\t\tonMediaReceived: Type.isFunction(params.onMediaReceived) ? params.onMediaReceived : BX.DoNothing,\n\t\t\tonMediaRemoved: Type.isFunction(params.onMediaRemoved) ? params.onMediaRemoved : BX.DoNothing,\n\t\t};\n\n\t\tthis.calculatedState = this.calculateState();\n\t};\n\n\tsetReady(ready)\n\t{\n\t\tready = !!ready;\n\t\tif (this.ready === ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.ready = ready;\n\t\tif (this.calling || this.backgroundCalling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t\tthis.backgroundCalling = false;\n\t\t\tthis.inviteTimeout = false;\n\t\t}\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.declined = false;\n\t\t\tthis.busy = false;\n\t\t}\n\n\t\tthis.updateCalculatedState();\n\t}\n\n\tsetDirection(direction)\n\t{\n\t\tif (this.direction === direction)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.direction = direction;\n\t}\n\n\tsetDeclined(declined)\n\t{\n\t\tthis.declined = declined;\n\t\tif (this.calling || this.backgroundCalling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t\tthis.backgroundCalling = false;\n\t\t}\n\t\tif (this.declined)\n\t\t{\n\t\t\tthis.ready = false;\n\t\t\tthis.busy = false;\n\t\t}\n\t\tthis.updateCalculatedState();\n\t}\n\n\tsetBusy(busy)\n\t{\n\t\tthis.busy = busy;\n\t\tif (this.calling || this.backgroundCalling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t\tthis.backgroundCalling = false;\n\t\t}\n\t\tif (this.busy)\n\t\t{\n\t\t\tthis.ready = false;\n\t\t\tthis.declined = false;\n\t\t}\n\t\tthis.updateCalculatedState();\n\t}\n\n\tallowIncomingVideo(isIncomingVideoAllowed)\n\t{\n\t\tif (this.isIncomingVideoAllowed == isIncomingVideoAllowed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isIncomingVideoAllowed = !!isIncomingVideoAllowed;\n\t}\n\n\taddMediaRenderer(mediaRenderer)\n\t{\n\t\tthis.log('Adding media renderer for user' + this.userId, mediaRenderer);\n\n\t\tthis.mediaRenderers.push(mediaRenderer);\n\n\t\tthis.callbacks.onMediaReceived({\n\t\t\tuserId: this.userId,\n\t\t\tkind: mediaRenderer.kind,\n\t\t\tmediaRenderer: mediaRenderer\n\t\t});\n\t\tthis.updateCalculatedState();\n\t}\n\n\tremoveMediaRenderer(mediaRenderer)\n\t{\n\t\tthis.log('Removing media renderer for user' + this.userId, mediaRenderer);\n\n\t\tlet i\n\t\tthis.mediaRenderers.forEach((el, index) => {\n\t\t\tif (el.kind === mediaRenderer.kind) {\n\t\t\t\ti = index;\n\t\t\t}\n\t\t})\n\n\t\tif (i >= 0)\n\t\t{\n\t\t\tthis.mediaRenderers.splice(i, 1);\n\t\t}\n\t\tthis.callbacks.onMediaRemoved({\n\t\t\tuserId: this.userId,\n\t\t\tkind: mediaRenderer.kind,\n\t\t\tmediaRenderer: mediaRenderer\n\t\t});\n\t\tthis.updateCalculatedState();\n\t}\n\n\tcalculateState()\n\t{\n\t\tif (this.participant)\n\t\t{\n\t\t\treturn UserState.Connected;\n\t\t}\n\n\t\tif (this.calling)\n\t\t{\n\t\t\treturn UserState.Calling;\n\t\t}\n\n\t\tif (this.inviteTimeout)\n\t\t{\n\t\t\treturn UserState.Unavailable;\n\t\t}\n\n\t\tif (this.declined)\n\t\t{\n\t\t\treturn UserState.Declined;\n\t\t}\n\n\t\tif (this.busy)\n\t\t{\n\t\t\treturn UserState.Busy;\n\t\t}\n\n\t\tif (this.ready)\n\t\t{\n\t\t\treturn UserState.Ready;\n\t\t}\n\n\t\treturn UserState.Idle;\n\t}\n\n\tupdateCalculatedState()\n\t{\n\t\tconst calculatedState = this.calculateState();\n\n\t\tif (this.calculatedState !== calculatedState)\n\t\t{\n\t\t\tthis.callbacks.onStateChanged({\n\t\t\t\tuserId: this.userId,\n\t\t\t\tstate: calculatedState,\n\t\t\t\tpreviousState: this.calculatedState,\n\t\t\t\tdirection: this.direction,\n\t\t\t});\n\t\t\tthis.calculatedState = calculatedState;\n\t\t}\n\t}\n\n\tisParticipating()\n\t{\n\t\treturn ((this.calling || this.backgroundCalling || this.ready || this.participant) && !this.declined);\n\t}\n\n\tonInvited(showUser = false)\n\t{\n\t\tthis.ready = false;\n\t\tthis.inviteTimeout = false;\n\t\tthis.declined = false;\n\t\tif (showUser)\n\t\t{\n\t\t\tthis.calling = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.backgroundCalling = true;\n\t\t}\n\n\t\tif (this.callingTimeout)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t}\n\t\tthis.callingTimeout = setTimeout(() => this.onInviteTimeout(true), 30000);\n\t\tthis.updateCalculatedState();\n\t}\n\n\tonInviteTimeout(internal)\n\t{\n\t\tclearTimeout(this.callingTimeout);\n\t\tif (!(this.calling || this.backgroundCalling))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.calling = false;\n\t\tthis.backgroundCalling = false;\n\t\tthis.inviteTimeout = true;\n\t\tif (internal)\n\t\t{\n\t\t\tthis.callbacks.onInviteTimeout({\n\t\t\t\tuserId: this.userId\n\t\t\t});\n\t\t}\n\t\tthis.updateCalculatedState();\n\t}\n\n\tlog()\n\t{\n\t\tthis.call.log.apply(this.call, arguments);\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.stream)\n\t\t{\n\t\t\tUtil.stopMediaStream(this.stream);\n\t\t\tthis.stream = null;\n\t\t}\n\n\t\tthis.callbacks.onStateChanged = BX.DoNothing;\n\t\tthis.callbacks.onInviteTimeout = BX.DoNothing;\n\t\tthis.callbacks.onMediaReceived = BX.DoNothing;\n\t\tthis.callbacks.onMediaRemoved = BX.DoNothing;\n\n\t\tclearTimeout(this.callingTimeout);\n\t\tthis.callingTimeout = null;\n\t}\n}\n\nconst transformVoxStats = function (s, BitrixCall)\n{\n\tlet result = {\n\t\tconnection: s.connection,\n\t\toutboundAudio: [],\n\t\toutboundVideo: [],\n\t\tinboundAudio: [],\n\t\tinboundVideo: [],\n\t}\n\n\tlet endpoints = {};\n\tif (BitrixCall.getEndpoints)\n\t{\n\t\tBitrixCall.getEndpoints().forEach(endpoint => endpoints[endpoint.id] = endpoint)\n\t}\n\n\tif (!result.connection.timestamp)\n\t{\n\t\tresult.connection.timestamp = Date.now();\n\t}\n\tfor (let trackId in s.outbound)\n\t{\n\t\tif (!s.outbound.hasOwnProperty(trackId))\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\t\tconst statGroup = s.outbound[trackId];\n\t\tfor (let i = 0; i < statGroup.length; i++)\n\t\t{\n\t\t\tlet stat = statGroup[i];\n\t\t\tstat.trackId = trackId;\n\t\t\tif ('audioLevel' in stat)\n\t\t\t{\n\t\t\t\tresult.outboundAudio.push(stat)\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresult.outboundVideo.push(stat)\n\t\t\t}\n\t\t}\n\t}\n\tfor (let trackId in s.inbound)\n\t{\n\t\tif (!s.inbound.hasOwnProperty(trackId))\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\t\tlet stat = s.inbound[trackId];\n\t\tif (!('endpoint' in stat))\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\t\tstat.trackId = trackId;\n\t\tif ('audioLevel' in stat)\n\t\t{\n\t\t\tresult.inboundAudio.push(stat)\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (endpoints[stat.endpoint])\n\t\t\t{\n\t\t\t\tlet videoRenderer = endpoints[stat.endpoint].mediaRenderers.find(r => r.id == stat.trackId)\n\t\t\t\tif (videoRenderer && videoRenderer.element)\n\t\t\t\t{\n\t\t\t\t\tstat.actualHeight = videoRenderer.element.videoHeight;\n\t\t\t\t\tstat.actualWidth = videoRenderer.element.videoWidth;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tresult.inboundVideo.push(stat)\n\t\t}\n\t}\n\treturn result;\n\n}\n\nclass MediaRenderer\n{\n\telement = null;\n\n\tconstructor(params)\n\t{\n\t\tparams = params || {};\n\t\tthis.kind = params.kind || 'video';\n\t\tif (params.track)\n\t\t{\n\t\t\tthis.stream = new MediaStream([params.track]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.stream = new MediaStream();\n\t\t}\n\t}\n\n\trender(el)\n\t{\n\t\tif (!el.srcObject || !el.srcObject.active || el.srcObject.id !== this.stream.id)\n\t\t{\n\t\t\tel.srcObject = this.stream;\n\t\t}\n\t}\n\n\trequestVideoSize()\n\t{\n\t}\n}","import {Type} from 'main.core'\nimport {DesktopApi} from 'im.v2.lib.desktop-api';\nimport {PlainCall} from './plain_call'\nimport {BitrixCallLegacy} from './bitrix_call_legacy'\nimport {CallStub} from './stub'\nimport {Hardware} from '../call_hardware';\nimport Util from '../util'\nimport {AbstractCall} from './abstract_call';\nimport {CallAI} from '../call_ai';\nimport { CallSettingsManager } from 'call.lib.settings-manager';\n\nexport const CallState = {\n\tIdle: 'Idle',\n\tProceeding: 'Proceeding',\n\tConnected: 'Connected',\n\tFinished: 'Finished'\n};\n\nexport const UserState = {\n\tIdle: 'Idle',\n\tBusy: 'Busy',\n\tCalling: 'Calling',\n\tUnavailable: 'Unavailable',\n\tDeclined: 'Declined',\n\tReady: 'Ready',\n\tConnecting: 'Connecting',\n\tConnected: 'Connected',\n\tFailed: 'Failed'\n};\n\nexport const EndpointDirection = {\n\tSendOnly: 'send',\n\tRecvOnly: 'recv',\n\tSendRecv: 'sendrecv',\n};\n\nexport const CallType = {\n\tInstant: 1,\n\tPermanent: 2\n};\n\nexport const Provider = {\n\tPlain: 'Plain',\n\tBitrix: 'Bitrix',\n};\n\nexport const StreamTag = {\n\tMain: 'main',\n\tScreen: 'screen'\n};\n\nexport const Direction = {\n\tIncoming: 'Incoming',\n\tOutgoing: 'Outgoing'\n};\n\nexport const Quality = {\n\tVeryHigh: \"very_high\",\n\tHigh: \"high\",\n\tMedium: \"medium\",\n\tLow: \"low\",\n\tVeryLow: \"very_low\"\n};\n\nexport const UserMnemonic = {\n\tall: 'all',\n\tnone: 'none'\n};\n\ntype CreateCallOptions = {\n\ttype: number,\n\tprovider: string,\n\tentityType: string,\n\tentityId: string,\n\tjoinExisting: boolean,\n\tuserIds?: number[],\n\tvideoEnabled?: boolean,\n\tenableMicAutoParameters?: boolean,\n\tdebug?: boolean\n}\n\nexport const CallEvent = {\n\tonUserInvited: 'onUserInvited',\n\tonUserJoined: 'onUserJoined',\n\tonUserStateChanged: 'onUserStateChanged',\n\tonUserMicrophoneState: 'onUserMicrophoneState',\n\tonUserCameraState: 'onUserCameraState',\n\tonCameraPublishing: 'onCameraPublishing',\n\tonMicrophonePublishing: 'onMicrophonePublishing',\n\tonNeedResetMediaDevicesState: 'onNeedResetMediaDevicesState',\n\tonUserVideoPaused: 'onUserVideoPaused',\n\tonUserScreenState: 'onUserScreenState',\n\tonUserRecordState: 'onUserRecordState',\n\tonUserVoiceStarted: 'onUserVoiceStarted',\n\tonUserVoiceStopped: 'onUserVoiceStopped',\n\tonUserFloorRequest: 'onUserFloorRequest', // request for a permission to speak\n\tonAllParticipantsAudioMuted: 'onAllParticipantsAudioMuted',\n\tonAllParticipantsVideoMuted: 'onAllParticipantsVideoMuted',\n\tonAllParticipantsScreenshareMuted: 'onAllParticipantsScreenshareMuted',\n\tonYouMuteAllParticipants: 'onYouMuteAllParticipants',\n\tonRoomSettingsChanged: 'onRoomSettingsChanged',\n\tonUserPermissionsChanged: 'onUserPermissionsChanged',\n\tonUserRoleChanged: 'onUserRoleChanged',\n\tonParticipantMuted: 'onParticipantMuted',\n\tonUserEmotion: 'onUserEmotion',\n\tonUserStatsReceived: 'onUserStatsReceived',\n\tonCustomMessage: 'onCustomMessage',\n\tonLocalMediaReceived: 'onLocalMediaReceived',\n\tonLocalMediaStopped: 'onLocalMediaStopped',\n\tonMicrophoneLevel: 'onMicrophoneLevel',\n\tonDeviceListUpdated: 'onDeviceListUpdated',\n\tonRTCStatsReceived: 'onRTCStatsReceived',\n\tonCallFailure: 'onCallFailure',\n\tonRemoteMediaReceived: 'onRemoteMediaReceived',\n\tonRemoteMediaStopped: 'onRemoteMediaStopped',\n\tonBadNetworkIndicator: 'onBadNetworkIndicator',\n\tonConnectionQualityChanged: 'onConnectionQualityChanged',\n\tonNetworkProblem: 'onNetworkProblem',\n\tonReconnecting: 'onReconnecting',\n\tonReconnected: 'onReconnected',\n\tonJoin: 'onJoin',\n\tonLeave: 'onLeave',\n\tonJoinRoomOffer: 'onJoinRoomOffer',\n\tonJoinRoom: 'onJoinRoom',\n\tonLeaveRoom: 'onLeaveRoom',\n\tonListRooms: 'onListRooms',\n\tonUpdateRoom: 'onUpdateRoom',\n\tonTransferRoomSpeakerRequest: 'onTransferRoomSpeakerRequest',\n\tonTransferRoomSpeaker: 'onTransferRoomSpeaker',\n\tonDestroy: 'onDestroy',\n\tonGetUserMediaEnded: 'onGetUserMediaEnded',\n\tonSwitchTrackRecordStatus: 'onSwitchTrackRecordStatus',\n\tonUpdateLastUsedCameraId: 'onUpdateLastUsedCameraId',\n\tonToggleRemoteParticipantVideo: 'onToggleRemoteParticipantVideo',\n};\n\nconst ajaxActions = {\n\tcreateCall: 'im.call.create',\n\tcreateChildCall: 'im.call.createChildCall',\n\tgetPublicChannels: 'pull.channel.public.list',\n\tgetCall: 'im.call.get'\n};\n\nexport const CallScheme = {\n\tclassic: 1,\n\tjwt: 2,\n};\n\nclass EngineLegacy\n{\n\thandlers = {\n\t\t'Call::incoming': this.#onPullIncomingCall.bind(this),\n\t}\n\n\tconstructor()\n\t{\n\t\tthis.debugFlag = false;\n\t\tthis.calls = {};\n\t\tthis.userId = Number(BX.message('USER_ID'));\n\t\tthis.siteId = '';\n\n\t\tthis.unknownCalls = {};\n\n\t\tthis.restClient = null;\n\t\tthis.pullClient = null;\n\n\t\tthis.finishedCalls = new Set();\n\n\t\tthis.init();\n\t};\n\n\tinit()\n\t{\n\t\tBX.addCustomEvent(\"onPullEvent-call\", this.#onPullEvent.bind(this));\n\t\tBX.addCustomEvent(\"onPullEvent-im\", this.#onPullEvent.bind(this));\n\t\tBX.addCustomEvent(\"onPullClientEvent-im\", this.#onPullClientEvent.bind(this));\n\t};\n\n\tgetSiteId()\n\t{\n\t\treturn this.siteId || BX.message('SITE_ID') || '';\n\t};\n\n\tsetSiteId(siteId)\n\t{\n\t\tthis.siteId = siteId;\n\t};\n\n\tgetCurrentUserId()\n\t{\n\t\treturn this.userId;\n\t};\n\n\tsetCurrentUserId(userId)\n\t{\n\t\tthis.userId = Number(userId);\n\t};\n\n\tsetRestClient(restClient)\n\t{\n\t\tthis.restClient = restClient;\n\t};\n\n\tsetPullClient(pullClient)\n\t{\n\t\tthis.pullClient = pullClient;\n\t};\n\n\tgetRestClient()\n\t{\n\t\treturn this.restClient || BX.rest;\n\t};\n\n\tgetPullClient()\n\t{\n\t\treturn this.pullClient || BX.PULL;\n\t};\n\n\tgetLogService()\n\t{\n\t\treturn BX.message(\"call_log_service\");\n\t};\n\n\tcreateCall(config: CreateCallOptions): Promise<AbstractCall>\n\t{\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tconst callType = config.type || CallType.Instant;\n\t\t\tconst callProvider = config.provider || this.getDefaultProvider();\n\n\t\t\tif (config.joinExisting)\n\t\t\t{\n\t\t\t\tfor (let callId in this.calls)\n\t\t\t\t{\n\t\t\t\t\tif (this.calls.hasOwnProperty(callId))\n\t\t\t\t\t{\n\t\t\t\t\t\tconst call: AbstractCall = this.calls[callId];\n\t\t\t\t\t\tif (call.provider == config.provider && call.associatedEntity.type == config.entityType && call.associatedEntity.id == config.entityId)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.log(callId, \"Found existing call, attaching to it\");\n\n\t\t\t\t\t\t\tBX.onCustomEvent(window, \"CallEvents::callCreated\", [{\n\t\t\t\t\t\t\t\tcall: call\n\t\t\t\t\t\t\t}]);\n\n\t\t\t\t\t\t\tHardware.isCameraOn = config.videoEnabled === true;\n\n\t\t\t\t\t\t\treturn resolve({\n\t\t\t\t\t\t\t\tcall: call,\n\t\t\t\t\t\t\t\tisNew: false\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet callParameters = {\n\t\t\t\ttype: callType,\n\t\t\t\tprovider: callProvider,\n\t\t\t\tentityType: config.entityType,\n\t\t\t\tentityId: config.entityId,\n\t\t\t\tjoinExisting: !!config.joinExisting,\n\t\t\t\tuserIds: Type.isArray(config.userIds) ? config.userIds : []\n\t\t\t};\n\n\t\t\tthis.getRestClient().callMethod(ajaxActions.createCall, callParameters).then((response) =>\n\t\t\t{\n\t\t\t\tif (response.error())\n\t\t\t\t{\n\t\t\t\t\tconst error = response.error().getError();\n\t\t\t\t\treturn reject({\n\t\t\t\t\t\tcode: error.error,\n\t\t\t\t\t\tmessage: error.error_description\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tconst createCallResponse = response.data();\n\n\t\t\t\tif (createCallResponse.userData)\n\t\t\t\t{\n\t\t\t\t\tUtil.setUserData(createCallResponse.userData)\n\t\t\t\t}\n\t\t\t\tif (createCallResponse.publicChannels)\n\t\t\t\t{\n\t\t\t\t\tthis.getPullClient().setPublicIds(Object.values(createCallResponse.publicChannels))\n\t\t\t\t}\n\t\t\t\tif (createCallResponse.ai)\n\t\t\t\t{\n\t\t\t\t\tCallAI.setup(createCallResponse.ai);\n\t\t\t\t}\n\n\t\t\t\tconst callFields = createCallResponse.call;\n\t\t\t\tif (this.calls[callFields['ID']])\n\t\t\t\t{\n\t\t\t\t\tif (this.calls[callFields['ID']] instanceof CallStub)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.calls[callFields['ID']].destroy();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tconsole.error(\"Call \" + callFields['ID'] + \" already exists\");\n\t\t\t\t\t\treturn resolve({\n\t\t\t\t\t\t\tcall: this.calls[callFields['ID']],\n\t\t\t\t\t\t\tisNew: false\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst callFactory = this.#getCallFactory(callFields['PROVIDER']);\n\t\t\t\tHardware.isCameraOn = config.videoEnabled === true;\n\t\t\t\tconst call = callFactory.createCall({\n\t\t\t\t\tid: parseInt(callFields['ID']),\n\t\t\t\t\tuuid: callFields['UUID'],\n\t\t\t\t\tinstanceId: Util.getUuidv4(),\n\t\t\t\t\tdirection: Direction.Outgoing,\n\t\t\t\t\tusers: createCallResponse.users,\n\t\t\t\t\tuserData: createCallResponse.userData,\n\t\t\t\t\tenableMicAutoParameters: (config.enableMicAutoParameters !== false),\n\t\t\t\t\ttype: callFields.TYPE,\n\t\t\t\t\tstartDate: callFields.START_DATE,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonDestroy: this.#onCallDestroy.bind(this)\n\t\t\t\t\t},\n\t\t\t\t\tdebug: config.debug === true,\n\t\t\t\t\tlogToken: createCallResponse.logToken,\n\t\t\t\t\tconnectionData: createCallResponse.connectionData,\n\t\t\t\t\tisCopilotActive: callFields['RECORD_AUDIO'],\n\t\t\t\t\tscheme: callFields['SCHEME'],\n\t\t\t\t});\n\n\t\t\t\tcall.addDialogInfo(callFields.ASSOCIATED_ENTITY);\n\n\t\t\t\tthis.calls[callFields['ID']] = call;\n\n\t\t\t\tif (createCallResponse.isNew)\n\t\t\t\t{\n\t\t\t\t\tthis.log(call.id, \"Creating new call\");\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.log(call.id, \"Server returned existing call, attaching to it\");\n\t\t\t\t}\n\n\t\t\t\tBX.onCustomEvent(window, \"CallEvents::callCreated\", [{\n\t\t\t\t\tcall: call\n\t\t\t\t}]);\n\n\t\t\t\tresolve({\n\t\t\t\t\tcall: call,\n\t\t\t\t\tuserData: createCallResponse.userData,\n\t\t\t\t\tisNew: createCallResponse.isNew\n\t\t\t\t});\n\t\t\t}).catch(function (error)\n\t\t\t{\n\t\t\t\tif (Type.isFunction(error.error))\n\t\t\t\t{\n\t\t\t\t\terror = error.error().getError();\n\t\t\t\t}\n\t\t\t\treject({\n\t\t\t\t\tcode: error.error,\n\t\t\t\t\tmessage: error.error_description\n\t\t\t\t})\n\t\t\t})\n\t\t});\n\t};\n\n\tcreateChildCall(parentId, newProvider, newUsers, config)\n\t{\n\t\tif (!this.calls[parentId])\n\t\t{\n\t\t\treturn Promise.reject('Parent call is not found');\n\t\t}\n\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tconst parentCall = this.calls[parentId];\n\t\t\tconst callParameters = {\n\t\t\t\tparentId: parentId,\n\t\t\t\tnewProvider: newProvider,\n\t\t\t\tnewUsers: newUsers\n\t\t\t};\n\n\t\t\tthis.getRestClient().callMethod(ajaxActions.createChildCall, callParameters, (response) =>\n\t\t\t{\n\t\t\t\tconst createCallResponse = response.data();\n\t\t\t\tconst callFields = createCallResponse.call;\n\t\t\t\tconst callFactory = this.#getCallFactory(callFields['PROVIDER']);\n\n\t\t\t\tconst call = callFactory.createCall({\n\t\t\t\t\tid: parseInt(callFields['ID']),\n\t\t\t\t\tuuid: callFields['UUID'],\n\t\t\t\t\tinstanceId: Util.getUuidv4(),\n\t\t\t\t\tparentId: callFields['PARENT_ID'],\n\t\t\t\t\tdirection: Direction.Outgoing,\n\t\t\t\t\tusers: createCallResponse.users,\n\t\t\t\t\tuserData: createCallResponse.userData,\n\t\t\t\t\tenableMicAutoParameters: parentCall.enableMicAutoParameters !== false,\n\t\t\t\t\tassociatedEntity: callFields.ASSOCIATED_ENTITY,\n\t\t\t\t\ttype: callFields.TYPE,\n\t\t\t\t\tstartDate: callFields.START_DATE,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonDestroy: this.#onCallDestroy.bind(this)\n\t\t\t\t\t},\n\t\t\t\t\tlogToken: createCallResponse.logToken,\n\t\t\t\t\tconnectionData: createCallResponse.connectionData,\n\t\t\t\t\tdebug: config.debug,\n\t\t\t\t\tisCopilotActive: callFields['RECORD_AUDIO'],\n\t\t\t\t\tscheme: callFields['SCHEME'],\n\t\t\t\t\t// jwt: callFields['JWT'],\n\t\t\t\t\t// endpoint: callFields['ENDPOINT']\n\t\t\t\t});\n\n\t\t\t\tthis.calls[callFields['ID']] = call;\n\t\t\t\tBX.onCustomEvent(window, \"CallEvents::callCreated\", [{\n\t\t\t\t\tcall: call\n\t\t\t\t}]);\n\n\t\t\t\tresolve({\n\t\t\t\t\tcall: call,\n\t\t\t\t\tisNew: createCallResponse.isNew\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t};\n\n\tinstantiateCall(callFields, users, logToken, connectionData, userData): AbstractCall\n\t{\n\t\tif (this.calls[callFields['ID']])\n\t\t{\n\t\t\tconsole.error(\"Call \" + callFields['ID'] + \" already exists\");\n\t\t\treturn this.calls[callFields['ID']];\n\t\t}\n\n\t\tconst callFactory = this.#getCallFactory(callFields['PROVIDER']);\n\t\tconst call = callFactory.createCall({\n\t\t\tid: parseInt(callFields['ID']),\n\t\t\tuuid: callFields['UUID'],\n\t\t\tinstanceId: Util.getUuidv4(),\n\t\t\tinitiatorId: parseInt(callFields['INITIATOR_ID']),\n\t\t\tparentId: callFields['PARENT_ID'],\n\t\t\tdirection: callFields['INITIATOR_ID'] == this.userId ? Direction.Outgoing : Direction.Incoming,\n\t\t\tusers: users,\n\t\t\tuserData: userData,\n\t\t\tassociatedEntity: {\n\t\t\t\tuserCounter: Object.keys(userData).length,\n\t\t\t\t...callFields.ASSOCIATED_ENTITY\n\t\t\t},\n\t\t\ttype: callFields.TYPE,\n\t\t\tstartDate: callFields['START_DATE'],\n\t\t\tlogToken: logToken,\n\t\t\tconnectionData: connectionData,\n\t\t\tisCopilotActive: callFields['RECORD_AUDIO'],\n\t\t\tscheme: callFields['SCHEME'],\n\t\t\t// jwt: callFields['JWT'],\n\t\t\t// endpoint: callFields['ENDPOINT'],\n\n\t\t\tevents: {\n\t\t\t\tonDestroy: this.#onCallDestroy.bind(this)\n\t\t\t}\n\t\t});\n\n\t\tthis.calls[callFields['ID']] = call;\n\n\t\tBX.onCustomEvent(window, \"CallEvents::callCreated\", [{\n\t\t\tcall: call\n\t\t}]);\n\n\t\treturn call;\n\t};\n\n\tgetCallWithId(id): Promise<{ call: AbstractCall, isNew: boolean }>\n\t{\n\t\tif (this.calls[id])\n\t\t{\n\t\t\treturn Promise.resolve({\n\t\t\t\tcall: this.calls[id],\n\t\t\t\tisNew: false\n\t\t\t});\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tthis.getRestClient().callMethod(ajaxActions.getCall, {callId: id}).then((answer) =>\n\t\t\t{\n\t\t\t\tconst data = answer.data();\n\t\t\t\tresolve({\n\t\t\t\t\tcall: this.instantiateCall(data.call, data.users, data.logToken, data.connectionData, data.userData),\n\t\t\t\t\tisNew: false\n\t\t\t\t})\n\t\t\t}).catch((error) =>\n\t\t\t{\n\t\t\t\tconsole.error(error);\n\t\t\t\tif (Type.isFunction(error.error))\n\t\t\t\t{\n\t\t\t\t\terror = error.error().getError();\n\t\t\t\t}\n\t\t\t\treject({\n\t\t\t\t\tcode: error.error,\n\t\t\t\t\tmessage: error.error_description\n\t\t\t\t})\n\t\t\t})\n\t\t})\n\t};\n\n\tgetCallWithDialogId(dialogId: string): ?Object\n\t{\n\t\treturn Object.values(this.calls).find((call) => call.associatedEntity?.id == dialogId);\n\t}\n\n\t#onPullEvent(command: string, params, extra)\n\t{\n\t\tif (params?.call?.SCHEME !== CallScheme.classic)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (command.startsWith('Call::'))\n\t\t{\n\t\t\tif (params.publicIds)\n\t\t\t{\n\t\t\t\tthis.getPullClient().setPublicIds(Object.values(params.publicIds));\n\t\t\t}\n\t\t\tif (params.userData)\n\t\t\t{\n\t\t\t\tUtil.setUserData(params.userData);\n\t\t\t}\n\t\t}\n\n\t\tif (this.handlers[command])\n\t\t{\n\t\t\tthis.handlers[command].call(this, params, extra);\n\t\t}\n\t\telse if (command.startsWith('Call::') && (params['call'] || params['callId']))\n\t\t{\n\t\t\tconst callId = params['call'] ? params['call']['ID'] : params['callId'];\n\t\t\tif (this.calls[callId])\n\t\t\t{\n\t\t\t\tthis.calls[callId].__onPullEvent(command, params, extra);\n\t\t\t}\n\t\t\telse if (command === 'Call::finish')\n\t\t\t{\n\t\t\t\tthis.log(callId, 'Got \"Call::finish\" before \"Call::incoming\"');\n\t\t\t\tthis.finishedCalls.add(callId);\n\t\t\t}\n\t\t\telse if (command === 'Call::ping')\n\t\t\t{\n\t\t\t\tthis.#onUnknownCallPing(params, extra).then((result) =>\n\t\t\t\t{\n\t\t\t\t\tif (result && this.calls[callId])\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.calls[callId].__onPullEvent(command, params, extra);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t};\n\n\t#onPullClientEvent(command: string, params, extra)\n\t{\n\t\tif (command.startsWith('Call::') && params['callId'])\n\t\t{\n\t\t\tconst callId = params['callId'];\n\t\t\tif (this.calls[callId])\n\t\t\t{\n\t\t\t\tthis.calls[callId].__onPullEvent(command, params, extra);\n\t\t\t}\n\t\t\telse if (command === 'Call::ping')\n\t\t\t{\n\t\t\t\tthis.#onUnknownCallPing(params, extra).then((result) =>\n\t\t\t\t{\n\t\t\t\t\tif (result && this.calls[callId])\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.calls[callId].__onPullEvent(command, params, extra);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t};\n\n\t#onPullIncomingCall(params, extra)\n\t{\n\t\tconsole.log('#onPullIncomingCall', location.href);\n\t\tif (extra.server_time_ago > 30)\n\t\t{\n\t\t\tconsole.error(\"Call was started too long time ago\");\n\t\t\treturn;\n\t\t}\n\n\t\tconst callFields = params.call;\n\t\tconst callId = parseInt(callFields.ID);\n\t\tlet call;\n\n\t\tif (this.finishedCalls.has(callId))\n\t\t{\n\t\t\tthis.log(callId, 'Got \"Call::incoming\" after \"Call::finish\"');\n\t\t\treturn;\n\t\t}\n\n\t\tif (params.publicIds)\n\t\t{\n\t\t\tthis.getPullClient().setPublicIds(Object.values(params.publicIds));\n\t\t}\n\n\t\tif (params.userData)\n\t\t{\n\t\t\tUtil.setUserData(params.userData);\n\t\t}\n\n\t\tif (this.calls[callId])\n\t\t{\n\t\t\tcall = this.calls[callId];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst callFactory = this.#getCallFactory(callFields.PROVIDER);\n\t\t\tcall = callFactory.createCall({\n\t\t\t\tid: callId,\n\t\t\t\tuuid: callFields.UUID,\n\t\t\t\tinstanceId: Util.getUuidv4(),\n\t\t\t\tparentId: callFields.PARENT_ID || null,\n\t\t\t\tcallFromMobile: params.isLegacyMobile === true,\n\t\t\t\tdirection: Direction.Incoming,\n\t\t\t\tusers: params.users,\n\t\t\t\tuserData: params.userData,\n\t\t\t\tinitiatorId: params.senderId,\n\t\t\t\tassociatedEntity: callFields.ASSOCIATED_ENTITY,\n\t\t\t\ttype: callFields.TYPE,\n\t\t\t\tstartDate: callFields.START_DATE,\n\t\t\t\tlogToken: params.logToken,\n\t\t\t\tconnectionData: params.connectionData,\n\t\t\t\tevents: {\n\t\t\t\t\tonDestroy: this.#onCallDestroy.bind(this)\n\t\t\t\t},\n\t\t\t\tisCopilotActive: callFields['RECORD_AUDIO'],\n\t\t\t\tscheme: callFields['SCHEME'],\n\t\t\t\t// jwt: callFields['JWT'],\n\t\t\t\t// endpoint: callFields['ENDPOINT']\n\t\t\t});\n\n\t\t\tthis.calls[callId] = call;\n\n\t\t\tBX.onCustomEvent(window, \"CallEvents::callCreated\", [{\n\t\t\t\tcall: call\n\t\t\t}]);\n\t\t}\n\n\t\tif (call)\n\t\t{\n\t\t\tcall.addInvitedUsers(params.invitedUsers);\n\n\t\t\tBX.onCustomEvent(window, \"CallEvents::incomingCall\", [{\n\t\t\t\tcall: call,\n\t\t\t\tvideo: params.video === true,\n\t\t\t\tisLegacyMobile: params.isLegacyMobile === true\n\t\t\t}]);\n\t\t}\n\t\tthis.log(call.id, \"Incoming call \" + call.id);\n\t};\n\n\t#onUnknownCallPing(params, extra)\n\t{\n\t\tconst callId = Number(params.callId);\n\t\tif (extra.server_time_ago > 10)\n\t\t{\n\t\t\tthis.log(callId, \"Error: Ping was sent too long time ago\");\n\t\t\treturn Promise.resolve(false);\n\t\t}\n\t\tif (!this.#isCallAppInitialized())\n\t\t{\n\t\t\treturn Promise.resolve(false);\n\t\t}\n\n\t\tif (this.unknownCalls[callId])\n\t\t{\n\t\t\treturn Promise.resolve(false);\n\t\t}\n\n\t\tthis.unknownCalls[callId] = true;\n\n\t\tif (params.userData)\n\t\t{\n\t\t\tUtil.setUserData(params.userData);\n\t\t}\n\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tthis.getCallWithId(callId).then(() =>\n\t\t\t{\n\t\t\t\tthis.unknownCalls[callId] = false;\n\t\t\t\tresolve(true);\n\t\t\t}).catch((error) =>\n\t\t\t{\n\t\t\t\tthis.unknownCalls[callId] = false;\n\t\t\t\tthis.log(callId, \"Error: Could not instantiate call\", error);\n\t\t\t\tresolve(false);\n\t\t\t});\n\t\t});\n\t};\n\n\t#onCallDestroy(e)\n\t{\n\t\tconst callId = e.call.id;\n\t\tthis.calls[callId] = new CallStub({\n\t\t\tcallId: callId,\n\t\t\tonDelete: () =>\n\t\t\t{\n\t\t\t\tif (this.calls[callId])\n\t\t\t\t{\n\t\t\t\t\tdelete this.calls[callId];\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tBX.onCustomEvent(window, \"CallEvents::callDestroyed\", [{\n\t\t\tcallId: e.call.id\n\t\t}]);\n\t};\n\n\t#isCallAppInitialized()\n\t{\n\t\tif ('BXIM' in window && 'init' in window.BXIM)\n\t\t{\n\t\t\treturn BXIM.init;\n\t\t}\n\t\telse if (BX.Messenger && BX.Messenger.Application && BX.Messenger.Application.conference)\n\t\t{\n\t\t\treturn BX.Messenger.Application.conference.inited;\n\t\t}\n\n\t\t//TODO: support new chat\n\t\treturn true;\n\t};\n\n\tgetDefaultProvider()\n\t{\n\t\treturn Provider.Plain;\n\t};\n\n\tgetConferencePageTag(chatDialogId)\n\t{\n\t\treturn \"conference-open-\" + chatDialogId;\n\t};\n\n\t#getCallFactory(providerType: string)\n\t{\n\t\tif (providerType == Provider.Plain)\n\t\t{\n\t\t\treturn PlainCallFactory;\n\t\t}\n\t\telse if (providerType == Provider.Bitrix)\n\t\t{\n\t\t\treturn BitrixCallFactory;\n\t\t}\n\n\t\tthrow new Error(\"Unknown call provider type \" + providerType);\n\t};\n\n\tdebug(debugFlag: boolean = true): boolean\n\t{\n\t\tthis.debugFlag = !!debugFlag;\n\n\t\treturn this.debugFlag;\n\t};\n\n\tlog()\n\t{\n\t\tconst text = Util.getLogMessage.call(Util, arguments);\n\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.writeToLogFile(BX.message('USER_ID') + '.video.log', text);\n\t\t}\n\t\tif (this.debugFlag)\n\t\t{\n\t\t\tif (console)\n\t\t\t{\n\t\t\t\tconst a = ['Call log [' + Util.getTimeForLog() + ']: '];\n\t\t\t\tconsole.log.apply(this, a.concat(Array.prototype.slice.call(arguments)));\n\t\t\t}\n\t\t}\n\t};\n\n\tgetAllowedVideoQuality(participantsCount)\n\t{\n\t\tif (participantsCount < 5)\n\t\t{\n\t\t\treturn Quality.VeryHigh\n\t\t}\n\t\telse if (participantsCount < 10)\n\t\t{\n\t\t\treturn Quality.High\n\t\t}\n\t\telse if (participantsCount < 16)\n\t\t{\n\t\t\treturn Quality.Medium\n\t\t}\n\t\telse if (participantsCount < 32)\n\t\t{\n\t\t\treturn Quality.Low\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn Quality.VeryLow\n\t\t}\n\t};\n}\n\nclass PlainCallFactory\n{\n\tstatic createCall(config): PlainCall\n\t{\n\t\treturn new PlainCall(config);\n\t}\n}\n\nclass BitrixCallFactory\n{\n\tstatic createCall(config): BitrixCallLegacy\n\t{\n\t\treturn new BitrixCallLegacy(config);\n\t}\n}\n\n\nexport const CallEngineLegacy = new EngineLegacy();\n","import { Type, Extension } from 'main.core';\nimport { CallEngine, Provider, RoomType } from './engine/engine';\nimport { CallEngineLegacy } from './engine/engine_legacy';\nimport {\n\tClientPlatform,\n\tClientVersion,\n\tMediaStreamsKinds,\n\tJoinRequestFailedCodes,\n\tJoinResponseError,\n} from './call_api';\nimport { CallTokenManager } from 'call.lib.call-token-manager';\nimport { CallSettingsManager } from 'call.lib.settings-manager';\nimport { CallAI } from './call_ai';\n\nimport {EventEmitter} from 'main.core.events'\nimport {Event} from 'main.core';\n\nconst blankAvatar = '/bitrix/js/im/images/blank.gif';\n\nlet userData = {}\nlet usersInProcess = {}\n\nlet abortController = null;\n\n/* User role & room permission */\nlet roomPermissions =\n{\n\tAudioEnabled: false,\n\tVideoEnabled: false,\n\tScreenShareEnabled: false,\n};\n\nlet userPermissions =\n{\n\task: false,\n\taudio: true,\n\tcan_approve: false,\n\tchange_role: false,\n\tchange_settings: false,\n\tend_call: false,\n\tgive_permissions: false,\n\tinvite: false,\n\tjoin_call: false,\n\tkick_user: false,\n\tmute: false,\n\tmute_others: false,\n\trecord_call: false,\n\tscreen_share: true,\n\tupdate: false,\n\tvideo: true,\n\tview_users: false,\n};\n\nconst UsersRoles =\n{\n\tADMIN: 'ADMIN', // chat admin\n\tMANAGER: 'MANAGER', // aka moderator\n\tUSER: 'USER', // regular user\n}\n\nconst regularUserRoles = [UsersRoles.USER]; // TODO got this from signaling in future\n\nlet currentUserRole = UsersRoles.USER;\n\nfunction setCurrentUserRole(role)\n{\n\tif (role)\n\t{\n\t\tcurrentUserRole = role.toUpperCase();\n\t}\n}\n\nfunction setRoomPermissions(_roomPermissions)\n{\n\tif (!Type.isPlainObject(_roomPermissions))\n\t{\n\t\treturn;\n\t}\n\n\troomPermissions = _roomPermissions;\n}\n\nfunction setUserPermissionsByRoomPermissions(_roomPermissions)\n{\n\tif (this.isRegularUser(this.getCurrentUserRole()))\n\t{\n\t\tlet permissions = this.getUserPermissions();\n\n\t\tfor (let permission in _roomPermissions)\n\t\t{\n\t\t\tif (_roomPermissions.hasOwnProperty(permission))\n\t\t\t{\n\t\t\t\tswitch (permission)\n\t\t\t\t{\n\t\t\t\t\tcase 'AudioEnabled':\n\t\t\t\t\t\tpermissions.audio = _roomPermissions[permission];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'VideoEnabled':\n\t\t\t\t\t\tpermissions.video = _roomPermissions[permission];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'ScreenShareEnabled':\n\t\t\t\t\t\tpermissions.screen_share = _roomPermissions[permission];\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.setUserPermissions(permissions);\n\t}\n}\n\nfunction updateUserPermissionByNewRoomPermission(_roomPermission, value)\n{\n\tif (this.isRegularUser(this.getCurrentUserRole()))\n\t{\n\t\tlet permissions = this.getUserPermissions();\n\n\t\tswitch (_roomPermission)\n\t\t{\n\t\t\tcase 'audio':\n\t\t\t\tpermissions.audio = value;\n\t\t\t\tbreak;\n\t\t\tcase 'video':\n\t\t\t\tpermissions.video = value;\n\t\t\t\tbreak;\n\t\t\tcase 'screen_share':\n\t\t\t\tpermissions.screen_share = value;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tthis.setUserPermissions(permissions);\n\t}\n}\n\nfunction isRegularUser(_role)\n{\n\treturn regularUserRoles.includes(_role);\n}\n\nfunction getRoomPermissions()\n{\n\treturn roomPermissions;\n}\n\nfunction setUserPermissions(_userPermissions)\n{\n\tif (Type.isPlainObject(_userPermissions))\n\t{\n\t\tfor (let permission in _userPermissions)\n\t\t{\n\t\t\tif (userPermissions.hasOwnProperty(permission))\n\t\t\t{\n\t\t\t\tuserPermissions[permission] = _userPermissions[permission];\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction getUserPermissions()\n{\n\treturn userPermissions;\n}\n\nfunction getCurrentUserRole()\n{\n\treturn currentUserRole;\n}\n\nfunction havePermissionToBroadcast(type)\n{\n\tlet havePermission = false;\n\n\tswitch (type)\n\t{\n\t\tcase 'mic':\n\n\t\t\thavePermission = userPermissions.audio;\n\t\t\tbreak;\n\t\tcase 'cam':\n\n\t\t\thavePermission = userPermissions.video;\n\t\t\tbreak;\n\t\tcase 'screenshare':\n\n\t\t\thavePermission = userPermissions.screen_share;\n\t\t\tbreak;\n\t}\n\n\treturn havePermission;\n}\n\nfunction canControlChangeSettings()\n{\n\treturn !!(userPermissions.change_settings && getCurrentBitrixCall());\n}\n\nfunction canControlGiveSpeakPermission()\n{\n\treturn !!userPermissions.give_permissions;\n}\n\nfunction getUserRoleByUserId(userId)\n{\n\tif (userData.hasOwnProperty(userId))\n\t{\n\t\treturn userData[userId].role;\n\t}\n}\n\n/* ------ */\n\nfunction updateUserData(callId, users)\n{\n\tlet usersToUpdate = [];\n\tfor (let i = 0; i < users.length; i++)\n\t{\n\t\tif (userData.hasOwnProperty(users[i]))\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\n\t\tusersToUpdate.push(users[i]);\n\t}\n\n\tconst result = new Promise((resolve, reject) => {\n\t\tif (usersToUpdate.length === 0 || !callId)\n\t\t{\n\t\t\tresolve();\n\n\t\t\treturn;\n\t\t}\n\n\t\tBX.ajax.runAction('im.call.getUsers', {\n\t\t\tdata: {\n\t\t\t\tcallId,\n\t\t\t\tuserIds: usersToUpdate,\n\t\t\t},\n\t\t}).then((response) => {\n\t\t\tconst data = Type.isPlainObject(response.data) ? response.data : {};\n\n\t\t\tusers.forEach((userId) => {\n\t\t\t\tif (data[userId])\n\t\t\t\t{\n\t\t\t\t\tuserData[userId] = data[userId];\n\t\t\t\t}\n\t\t\t\tdelete usersInProcess[userId];\n\t\t\t});\n\n\t\t\tresolve();\n\t\t}).catch((error) => {\n\t\t\treject(error.answer);\n\t\t});\n\t});\n\n\tfor (const userId of usersToUpdate)\n\t{\n\t\tusersInProcess[userId] = result;\n\t}\n\n\treturn result;\n}\n\nfunction setUserData(users)\n{\n\tfor (let userId in users)\n\t{\n\t\tuserData[userId] = users[userId];\n\n\t}\n\n\t//setCurrentUserRole(userData[CallEngine.getCurrentUserId()].role);\n}\n\nconst getDateForLog = () =>\n{\n\tconst d = new Date();\n\n\treturn d.getFullYear() + \"-\" + lpad(d.getMonth() + 1, 2, '0') + \"-\" + lpad(d.getDate(), 2, '0') + \" \" + lpad(d.getHours(), 2, '0') + \":\" + lpad(d.getMinutes(), 2, '0') + \":\" + lpad(d.getSeconds(), 2, '0') + \".\" + d.getMilliseconds();\n}\n\nconst getTimeForLog = () =>\n{\n\tconst d = new Date();\n\n\treturn lpad(d.getHours(), 2, '0') + \":\" + lpad(d.getMinutes(), 2, '0') + \":\" + lpad(d.getSeconds(), 2, '0') + \".\" + d.getMilliseconds();\n}\n\nfunction lpad(str, length, chr)\n{\n\tstr = str.toString();\n\tchr = chr || ' ';\n\n\tif (str.length > length)\n\t{\n\t\treturn str;\n\t}\n\n\tlet result = '';\n\tfor (let i = 0; i < length - str.length; i++)\n\t{\n\t\tresult += chr;\n\t}\n\n\treturn result + str;\n}\n\nfunction getUser(callId, userId)\n{\n\treturn new Promise((resolve, reject) =>\n\t{\n\t\tif (userData.hasOwnProperty(userId))\n\t\t{\n\t\t\treturn resolve(userData[userId]);\n\t\t}\n\t\telse if (usersInProcess.hasOwnProperty(userId))\n\t\t{\n\t\t\tusersInProcess[userId].then(() =>\n\t\t\t{\n\t\t\t\treturn resolve(userData[userId]);\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tupdateUserData(callId, [userId]).then(() =>\n\t\t\t{\n\t\t\t\treturn resolve(userData[userId]);\n\t\t\t});\n\t\t}\n\t});\n}\n\nfunction getUserCached(userId)\n{\n\treturn userData.hasOwnProperty(userId) ? userData[userId] : null;\n}\n\nfunction getUsers(callId, users)\n{\n\n\treturn new Promise((resolve, reject) =>\n\t{\n\t\tupdateUserData(callId, users).then(() =>\n\t\t{\n\t\t\tlet result = {};\n\t\t\tusers.forEach(userId => result[userId] = userData[userId] || {});\n\t\t\treturn resolve(result);\n\t\t});\n\t});\n}\n\nfunction getUserName(callId, userId)\n{\n\treturn new Promise((resolve, reject) =>\n\t{\n\t\tif (userData.hasOwnProperty(userId))\n\t\t{\n\t\t\treturn resolve(userData[userId].name ? userData[userId].name : '');\n\t\t}\n\t\telse if (usersInProcess.hasOwnProperty(userId))\n\t\t{\n\t\t\tusersInProcess[userId].then(() =>\n\t\t\t{\n\t\t\t\treturn resolve(userData[userId].name ? userData[userId].name : '');\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tupdateUserData(callId, [userId]).then(() =>\n\t\t\t{\n\t\t\t\treturn resolve(userData[userId].name ? userData[userId].name : '');\n\t\t\t});\n\t\t}\n\t});\n}\n\nfunction getUserAvatar(callId, userId)\n{\n\treturn new Promise((resolve, reject) =>\n\t{\n\t\tif (userData.hasOwnProperty(userId))\n\t\t{\n\t\t\treturn resolve(userData[userId].avatar_hr && !isBlank(userData[userId].avatar_hr) ? userData[userId].avatar_hr : '');\n\t\t}\n\t\telse if (usersInProcess.hasOwnProperty(userId))\n\t\t{\n\t\t\tusersInProcess[userId].then(() =>\n\t\t\t{\n\t\t\t\treturn resolve(userData[userId].avatar_hr && !isBlank(userData[userId].avatar_hr) ? userData[userId].avatar_hr : '');\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tupdateUserData(callId, [userId]).then(() =>\n\t\t\t{\n\t\t\t\treturn resolve(userData[userId].avatar_hr && !isBlank(userData[userId].avatar_hr) ? userData[userId].avatar_hr : '');\n\t\t\t});\n\t\t}\n\t});\n}\n\nfunction getUserAvatars(callId, users)\n{\n\treturn new Promise((resolve, reject) =>\n\t{\n\t\tupdateUserData(callId, users).then(() =>\n\t\t{\n\t\t\tlet result = {};\n\t\t\tusers.forEach((userId) =>\n\t\t\t{\n\t\t\t\tresult[userId] = userData[userId].avatar_hr && !isBlank(userData[userId].avatar_hr) ? userData[userId].avatar_hr : ''\n\t\t\t});\n\t\t\treturn resolve(result);\n\t\t});\n\t});\n}\n\nfunction isAvatarBlank(url)\n{\n\treturn isBlank(url);\n}\n\nfunction getCustomMessage(message, userData)\n{\n\tlet messageText;\n\tif (!Type.isPlainObject(userData))\n\t{\n\t\tuserData = {};\n\t}\n\n\tif (userData.gender && BX.message.hasOwnProperty(message + '_' + userData.gender))\n\t{\n\t\tmessageText = BX.message(message + '_' + userData.gender);\n\t}\n\telse\n\t{\n\t\tmessageText = BX.message(message);\n\t}\n\n\tuserData = convertKeysToUpper(userData);\n\n\treturn messageText.replace(/#.+?#/gm, function (match)\n\t{\n\t\tconst placeHolder = match.substr(1, match.length - 2);\n\t\treturn userData.hasOwnProperty(placeHolder) ? userData[placeHolder] : match;\n\t});\n}\n\nfunction convertKeysToUpper(obj)\n{\n\tvar result = BX.util.objectClone(obj);\n\n\tfor (let k in result)\n\t{\n\t\tconst u = k.toUpperCase();\n\n\t\tif (u != k)\n\t\t{\n\t\t\tresult[u] = result[k];\n\t\t\tdelete result[k];\n\t\t}\n\t}\n\treturn result;\n}\n\nfunction appendChildren(parent, children)\n{\n\tchildren.forEach(child => parent.appendChild(child))\n}\n\nfunction containsVideoTrack(stream: MediaStream)\n{\n\tif (!(stream instanceof MediaStream))\n\t{\n\t\treturn false;\n\t}\n\n\treturn stream.getVideoTracks().length > 0;\n}\n\nfunction hasHdVideo(stream: MediaStream)\n{\n\tif (!(stream instanceof MediaStream) || stream.getVideoTracks().length === 0)\n\t{\n\t\treturn false;\n\t}\n\n\tvar videoTrack = stream.getVideoTracks()[0];\n\tvar trackSettings = videoTrack.getSettings();\n\n\treturn trackSettings.width >= 1280;\n}\n\nfunction findBestElementSize(width, height, userCount, minWidth, minHeight)\n{\n\tminWidth = minWidth || 0;\n\tminHeight = minHeight || 0;\n\tlet bestFilledArea = 0;\n\n\tfor (let i = 1; i <= userCount; i++)\n\t{\n\t\tconst area = getFilledArea(width, height, userCount, i);\n\t\tif (area.area > bestFilledArea && area.elementWidth > minWidth && area.elementHeight > minHeight)\n\t\t{\n\t\t\tbestFilledArea = area.area;\n\t\t\tvar bestWidth = area.elementWidth;\n\t\t\tvar bestHeight = area.elementHeight;\n\t\t}\n\t\tif (area.area < bestFilledArea)\n\t\t{\n\t\t\tbreak;\n\t\t}\n\t}\n\tif (bestFilledArea === 0)\n\t{\n\t\tbestWidth = minWidth;\n\t\tbestHeight = minHeight\n\t}\n\treturn {width: bestWidth, height: bestHeight};\n}\n\nfunction getFilledArea(width, height, userCount, rowCount)\n{\n\tconst columnCount = Math.ceil(userCount / rowCount);\n\tconst maxElementWidth = Math.floor(width / columnCount);\n\tconst maxElementHeight = Math.floor(height / rowCount);\n\n\tconst ratio = maxElementHeight / maxElementWidth;\n\tconst neededRatio = 9 / 16;\n\n\tlet expectedElementHeight;\n\tlet expectedElementWidth;\n\n\tif (ratio < neededRatio)\n\t{\n\t\texpectedElementHeight = maxElementHeight;\n\t\texpectedElementWidth = Math.floor(maxElementWidth * (ratio / neededRatio));\n\t}\n\telse\n\t{\n\t\texpectedElementWidth = maxElementWidth;\n\t\texpectedElementHeight = Math.floor(maxElementHeight * (neededRatio / ratio));\n\t}\n\n\t//console.log(expectedElementWidth + 'x' + expectedElementHeight)\n\tvar area = expectedElementWidth * expectedElementHeight * userCount;\n\n\treturn {area: area, elementWidth: expectedElementWidth, elementHeight: expectedElementHeight};\n}\n\nconst isWebRTCSupported = () =>\n{\n\treturn (typeof webkitRTCPeerConnection != 'undefined' || typeof mozRTCPeerConnection != 'undefined' || typeof RTCPeerConnection != 'undefined');\n}\n\nconst isCallServerAllowed = () =>\n{\n\treturn BX.message('call_server_enabled') === 'Y'\n}\n\nconst isFeedbackAllowed = () =>\n{\n\treturn BX.message('call_allow_feedback') === 'Y'\n}\n\nconst shouldCollectStats = () =>\n{\n\treturn BX.message('call_collect_stats') === 'Y'\n}\n\nconst shouldShowDocumentButton = () =>\n{\n\treturn BX.message('call_docs_status') !== 'N' || BX.message('call_resumes_status') !== 'N';\n}\n\nconst getDocumentsArticleCode = () =>\n{\n\tif (!BX.message('call_docs_status').startsWith('L'))\n\t{\n\t\treturn false;\n\t}\n\n\treturn BX.message('call_docs_status').substr(2);\n}\n\nconst getResumesArticleCode = () =>\n{\n\tif (!BX.message('call_resumes_status').startsWith('L'))\n\t{\n\t\treturn false;\n\t}\n\n\treturn BX.message('call_resumes_status').substr(2);\n}\n\nconst getUserLimit = () =>\n{\n\tif (isCallServerAllowed())\n\t{\n\t\treturn parseInt(BX.message('call_server_max_users'));\n\t}\n\n\treturn parseInt(BX.message('turn_server_max_users'));\n}\n\nconst getClientSelfTestUrl = () =>\n{\n\treturn BX.message('call_client_selftest_url') ?? '';\n}\n\nconst getCallFeatures = () => {\n\treturn BX.message('call_features')\n}\n\nfunction getLogMessage ()\n{\n\tlet text = getDateForLog();\n\n\tfor (let i = 0; i < arguments.length; i++)\n\t{\n\t\tif (arguments[i] instanceof Error)\n\t\t{\n\t\t\ttext = arguments[i].message + \"\\n\" + arguments[i].stack\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\ttext = text + ' | ' + (typeof (arguments[i]) == 'object' ? JSON.stringify(arguments[i]) : arguments[i]);\n\t\t\t} catch (e)\n\t\t\t{\n\t\t\t\ttext = text + ' | (circular structure)';\n\t\t\t}\n\t\t}\n\t}\n\n\treturn text;\n}\n\nconst getUuidv4 = () =>\n{\n\treturn 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) =>\n\t{\n\t\tconst r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n\t\treturn v.toString(16);\n\t});\n}\n\nfunction reportConnectionResult(callId, connectionResult)\n{\n\tBX.ajax.runAction(\"im.call.reportConnection\", {\n\t\tdata: {\n\t\t\tcallId: callId,\n\t\t\tconnectionResult: connectionResult\n\t\t}\n\t})\n}\n\nfunction sendTelemetryEvent(options)\n{\n\n}\n\nconst isDesktop = () =>\n{\n\treturn typeof (BXDesktopSystem) != \"undefined\" || typeof (BXDesktopWindow) != \"undefined\";\n}\n\nconst getBrowserForStatistics = () =>\n{\n\tif (BX.browser.IsOpera())\n\t{\n\t\treturn 'opera';\n\t}\n\tif (BX.browser.IsChrome())\n\t{\n\t\treturn 'chrome';\n\t}\n\tif (BX.browser.IsFirefox())\n\t{\n\t\treturn 'firefox';\n\t}\n\tif (BX.browser.IsSafari())\n\t{\n\t\treturn 'safari';\n\t}\n\treturn 'other';\n}\n\nfunction isBlank(url)\n{\n\treturn typeof (url) !== \"string\" || url == \"\" || url.endsWith(blankAvatar);\n}\n\nfunction stopMediaStreamAudioTracks(mediaStream)\n{\n\tif (!mediaStream instanceof MediaStream)\n\t{\n\t\treturn;\n\t}\n\n\tmediaStream.getAudioTracks().forEach(function (track)\n\t{\n\t\tif (track.kind === 'audio') {\n\t\t\ttrack.stop();\n\t\t\tmediaStream.removeTrack(track);\n\t\t}\n\t});\n}\n\nfunction stopMediaStreamVideoTracks(mediaStream)\n{\n\tif (!mediaStream instanceof MediaStream)\n\t{\n\t\treturn;\n\t}\n\n\tmediaStream.getTracks().forEach(function (track)\n\t{\n\t\tif (track.kind === 'video') {\n\t\t\ttrack.stop();\n\t\t\tmediaStream.removeTrack(track);\n\t\t}\n\t});\n}\n\nfunction stopMediaStream(mediaStream)\n{\n\tif (!mediaStream instanceof MediaStream)\n\t{\n\t\treturn;\n\t}\n\n\tmediaStream.getTracks().forEach(function (track)\n\t{\n\t\ttrack.stop()\n\t});\n}\n\nfunction getConferenceProvider(): string{\n\tif (isCallServerAllowed())\n\t{\n\t\treturn Provider.Bitrix;\n\t}\n\n\treturn Provider.Plain;\n}\n\nfunction getCurrentBitrixCall()\n{\n\tfor (let callId in CallEngine.calls)\n\t{\n\t\tif(CallEngine.calls[callId].BitrixCall)\n\t\t{\n\t\t\treturn CallEngine.calls[callId];\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tfor (let callId in CallEngineLegacy.calls)\n\t{\n\t\tif(CallEngineLegacy.calls[callId].BitrixCall)\n\t\t{\n\t\t\treturn CallEngineLegacy.calls[callId];\n\t\t\tbreak;\n\t\t}\n\t}\n\n\treturn false;\n}\n\nfunction setCodecToReport(report, codecs, reportsWithoutCodecs)\n{\n\tif (codecs[report.codecId])\n\t{\n\t\treport.codecName = codecs[report.codecId];\n\t\treturn true;\n\t}\n\treturn false;\n}\n\nfunction saveReportWithoutCodecs(report, reportsWithoutCodecs)\n{\n\tif (reportsWithoutCodecs[report.codecId])\n\t{\n\t\treportsWithoutCodecs[report.codecId].push(report);\n\t}\n\telse\n\t{\n\t\treportsWithoutCodecs[report.codecId] = [report];\n\t}\n}\n\nfunction processReportsWithoutCodecs(report, codecs, reportsWithoutCodecs)\n{\n\tcodecs[report.id] = report.mimeType;\n\tif (reportsWithoutCodecs[report.id])\n\t{\n\t\treportsWithoutCodecs[report.id].forEach(r =>\n\t\t{\n\t\t\tr.codecName = report.mimeType;\n\t\t});\n\t\tdelete reportsWithoutCodecs[report.id];\n\t}\n}\n\nfunction setLocalPacketsLostOrSaveReport(report, remoteReports, reportsWithoutRemoteInfo)\n{\n\tif (remoteReports[report.id])\n\t{\n\t\tconst packetsLostData = calcLocalPacketsLost(report, remoteReports[report.id]);\n\t\treport.packetsLostData = packetsLostData;\n\t\treport.packetsLost = packetsLostData.totalPacketsLost;\n\t\treport.packetsLostExtended = formatPacketsLostData(packetsLostData);\n\t\tdelete remoteReports[report.id];\n\t\treturn true;\n\t}\n\telse if (!report.packetsLostExtended)\n\t{\n\t\treportsWithoutRemoteInfo[report.id] = report;\n\t\treturn false;\n\t}\n}\n\nfunction calcBitrate(currentReport, prevReport, isLocal)\n{\n\tprevReport = prevReport || {};\n\tconst bytes = isLocal\n\t\t? currentReport.bytesSent - (prevReport.bytesSent || 0)\n\t\t: currentReport.bytesReceived - (prevReport.bytesReceived || 0);\n\tconst time = currentReport.timestamp - (prevReport.timestamp || 0);\n\tconst bitrate = 8 * bytes / (time / 1000);\n\treturn bitrate < 0 ? 0 : Math.trunc(bitrate);\n}\n\nfunction calcLocalPacketsLost(currentReport, prevReport, remoteReport)\n{\n\tprevReport = prevReport || {};\n\tconst packetsLost = Math.abs(remoteReport.packetsLost);\n\tconst deltaPacketsSent = currentReport.packetsSent - (prevReport.packetsSent || 0);\n\tconst deltaPacketsLost = packetsLost - (prevReport.packetsLost || 0);\n\tconst percentPacketLost = (deltaPacketsLost / deltaPacketsSent) * 100 || 0;\n\tconst percentPacketLostTotal = (packetsLost / currentReport.packetsSent) * 100 || 0;\n\treturn {\n\t\tcurrentPacketsLost: deltaPacketsLost,\n\t\tcurrentPercentPacketLost: percentPacketLost >= 0 ? Math.trunc(percentPacketLost) : 0,\n\t\ttotalPacketsLost: packetsLost,\n\t\ttotalPercentPacketLost: Math.trunc(percentPacketLostTotal),\n\t};\n}\n\nfunction calcRemotePacketsLost(currentReport, prevReport)\n{\n\tprevReport = prevReport || {};\n\tconst packetsLost = Math.abs(currentReport.packetsLost);\n\tconst deltaPacketsReceived = currentReport.packetsReceived - (prevReport.packetsReceived || 0);\n\tconst deltaPacketsLost = packetsLost - (prevReport.packetsLost || 0);\n\tconst percentPacketLost = (deltaPacketsLost / (deltaPacketsReceived + deltaPacketsLost)) * 100 || 0;\n\tconst percentPacketLostTotal = (packetsLost / (currentReport.packetsReceived + packetsLost)) * 100 || 0;\n\treturn {\n\t\tcurrentPacketsLost: deltaPacketsLost,\n\t\tcurrentPercentPacketLost:  percentPacketLost >= 0 ? Math.trunc(percentPacketLost) : 0,\n\t\ttotalPacketsLost: packetsLost,\n\t\ttotalPercentPacketLost:  Math.trunc(percentPacketLostTotal),\n\t};\n}\n\nfunction formatPacketsLostData(data)\n{\n\treturn `${data.currentPacketsLost} - ${data.currentPercentPacketLost}% (total: ${data.totalPacketsLost} - ${data.totalPercentPacketLost}%)`;\n}\n\nfunction getAvatarBackground()\n{\n\tconst colorList = ['#006484', '#00A2E8', '#559BE6', '#688800', '#7FA800', '#11A9D9', '#0B66C3', '#004F69', '#00789E', '#506900', '#828B95'];\n\n\treturn colorList[Math.floor(Math.random() * colorList.length)];\n}\n\nfunction getRecordTimeText(recordState, returnInSeconds = false)\n{\n\tif (!recordState)\n\t{\n\t\treturn '';\n\t}\n\n\tconst nowDate = new Date();\n\tlet startDate = new Date(recordState.date.start);\n\tif (startDate.getTime() < nowDate.getDate())\n\t{\n\t\tstartDate = nowDate;\n\t}\n\n\tconst pauseTime = recordState.date.pause\n\t\t.map((element) =>\n\t\t{\n\t\t\tconst finish = element.finish ? new Date(element.finish) : nowDate;\n\t\t\treturn finish - new Date(element.start);\n\t\t})\n\t\t.reduce((sum, element) => sum + element, 0);\n\n\tlet totalTime = nowDate - startDate - pauseTime;\n\tif (totalTime <= 0)\n\t{\n\t\ttotalTime = 0;\n\t}\n\n\tlet second = Math.floor(totalTime / 1000);\n\n\tif (returnInSeconds)\n\t{\n\t\treturn second;\n\t}\n\n\tlet hour = Math.floor(second / 60 / 60);\n\tif (hour > 0)\n\t{\n\t\tsecond -= hour * 60 * 60;\n\t}\n\n\tconst minute = Math.floor(second / 60);\n\tif (minute > 0)\n\t{\n\t\tsecond -= minute * 60;\n\t}\n\n\treturn (hour > 0 ? hour + ':' : '')\n\t\t+ (hour > 0 ? minute.toString().padStart(2, \"0\") + ':' : minute + ':')\n\t\t+ second.toString().padStart(2, \"0\")\n\t\t;\n}\n\nfunction getTimeText(startTime)\n{\n\tif (!startTime)\n\t{\n\t\treturn '';\n\t}\n\n\tconst nowDate = new Date();\n\tlet startDate = new Date(startTime);\n\tif (startDate.getTime() < nowDate.getDate())\n\t{\n\t\tstartDate = nowDate;\n\t}\n\n\tlet totalTime = nowDate - startDate;\n\tif (totalTime <= 0)\n\t{\n\t\ttotalTime = 0;\n\t}\n\n\tlet second = Math.floor(totalTime / 1000);\n\n\tlet hour = Math.floor(second / 60 / 60);\n\tif (hour > 0)\n\t{\n\t\tsecond -= hour * 60 * 60;\n\t}\n\n\tconst minute = Math.floor(second / 60);\n\tif (minute > 0)\n\t{\n\t\tsecond -= minute * 60;\n\t}\n\n\treturn (hour > 0 ? hour + ':' : '')\n\t\t+ (hour > 0 ? minute.toString().padStart(2, \"0\") + ':' : minute + ':')\n\t\t+ second.toString().padStart(2, \"0\")\n\t\t;\n}\n\nfunction getTimeInSeconds(startTime)\n{\n\tif (!startTime)\n\t{\n\t\treturn '';\n\t}\n\n\tconst nowDate = new Date();\n\tlet startDate = new Date(startTime);\n\tif (startDate.getTime() < nowDate.getDate())\n\t{\n\t\tstartDate = nowDate;\n\t}\n\n\tlet totalTime = nowDate - startDate;\n\tif (totalTime <= 0)\n\t{\n\t\ttotalTime = 0;\n\t}\n\n\treturn Math.floor(totalTime / 1000);\n}\n\nconst isConferenceChatEnabled = () =>\n{\n\treturn BX.message('conference_chat_enabled');\n}\n\nconst getCallConnectionData = async (callOptions, chatId, mustCreate = true) => {\n\tif (!Type.isPlainObject(callOptions))\n\t{\n\t\tcallOptions = {};\n\t}\n\n\treturn new Promise(async (resolve, reject) =>\n\t{\n\t\tabortController = new AbortController();\n\t\tconst callBalancerUrl = CallSettingsManager.callBalancerUrl;\n\n\t\tconst roomType = callOptions.provider === Provider.Plain && CallSettingsManager.isJwtInPlainCallsEnabled()\n\t\t\t? RoomType.Personal\n\t\t\t: RoomType.Small;\n\t\tconst url = `${callBalancerUrl}/v2/join?mustCreate=${Boolean(mustCreate)}`;\n\n\t\tconst userToken = await CallTokenManager.getUserToken(chatId);\n\n\t\tconst data = JSON.stringify({\n\t\t\tuserToken,\n\t\t\troomType,\n\t\t\tclientVersion: ClientVersion,\n\t\t\tclientPlatform: ClientPlatform,\n\t\t\t...callOptions,\n\t\t});\n\n\t\tlet responseInfo = null;\n\t\tfetch(url, {\n\t\t\tmethod: 'POST',\n\t\t\tbody: data,\n\t\t\tsignal: abortController.signal,\n\t\t})\n\t\t\t.then((response) => {\n\t\t\t\tresponseInfo = { status: response?.status, ok: response?.ok };\n\n\t\t\t\treturn response.json();\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\tif (error instanceof SyntaxError)\n\t\t\t\t{\n\t\t\t\t\tthrow new JoinResponseError(error.message, JoinRequestFailedCodes.JsonParsingError);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthrow error;\n\t\t\t\t}\n\t\t\t})\n\t\t\t.then((response) => {\n\t\t\t\tif (!responseInfo?.ok)\n\t\t\t\t{\n\t\t\t\t\tif (response?.error)\n\t\t\t\t\t{\n\t\t\t\t\t\tthrow new JoinResponseError(response?.error?.message, response?.error?.code);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthrow new JoinResponseError(`Response status: ${responseInfo.status}`, JoinRequestFailedCodes.UnexpectedResponse);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tresolve(response);\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tif (error?.xhr?.responseText)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst response = JSON.parse(error.xhr.responseText);\n\t\t\t\t\t\tif (response.error)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treject(response);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcatch (e)\n\t\t\t\t{\n\t\t\t\t\treject(e);\n\t\t\t\t}\n\n\t\t\t\treject(error);\n\t\t\t})\n\t\t\t.finally(() => {\n\t\t\t\tabortController = null;\n\t\t\t});\n\t});\n};\n\nconst getCallConnectionDataById = async (callUuid) => {\n\tconst call = await CallEngine.getCallWithId(callUuid);\n\n\treturn getCallConnectionData(\n\t\t{\n\t\t\tcallType: call.call.type,\n\t\t\tinstanceId: call.call.instanceId,\n\t\t\tprovider: call.call.provider,\n\t\t\tcallToken: CallTokenManager.getTokenCached(call.call.associatedEntity.chatId),\n\t\t},\n\t\tcall.call.associatedEntity.chatId,\n\t\tfalse,\n\t);\n};\n\nconst abortGetCallConnectionData = () => {\n\tabortController?.abort();\n};\n\nfunction startSelfTest()\n{\n\tconst link = BX.Call.Util.getClientSelfTestUrl();\n\n\tif (isDesktop()) {\n\t\twindow.open(link, '_blank', 'popup');\n\t\treturn;\n\t}\n\n\twindow.open(link, '_blank');\n}\n\nconst useTcpSdp = () =>\n{\n\treturn BX.message('call_use_tcp_sdp') === 'Y';\n}\n\nfunction openArticle(articleCode)\n{\n\tconst infoHelper = BX.UI.InfoHelper;\n\n\tif (infoHelper.isOpen())\n\t{\n\t\tinfoHelper.close()\n\t}\n\n\tinfoHelper.show(articleCode);\n}\n\nconst getAiSettings = () =>\n{\n\treturn Extension.getSettings('call.core')?.ai || {};\n}\n\nconst isUserControlFeatureEnabled = () =>\n{\n\treturn Extension.getSettings('call.core')?.isUserControlFeatureEnabled;\n}\n\nconst isDisableCameraNewJoinedUsersFeatureEnabled = () =>\n{\n\treturn Extension.getSettings('call.core')?.isDisableCameraNewJoinedUsersFeatureEnabled;\n}\n\nconst countDisableCameraNewJoinedUsersFeature = () =>\n{\n\treturn Extension.getSettings('call.core')?.countDisableCameraNewJoinedUsersFeature;\n}\n\nconst isPictureInPictureFeatureEnabled = () =>\n{\n\treturn Extension.getSettings('call.core')?.isPictureInPictureFeatureEnabled;\n}\n\nconst isNewQOSEnabled = () =>\n{\n\treturn Extension.getSettings('call.core')?.isNewQOSEnabled;\n}\n\nconst isKibanaLogsEnabled = () =>\n{\n\treturn Extension.getSettings('call.core')?.isKibanaLogsEnabled;\n}\n\nconst isChatMountInPage = () =>\n{\n\treturn Extension.getSettings('call.core')?.isAirDesignEnabled && Extension.getSettings('call.core')?.shouldHideQuickAccess;\n}\n\n/* ws logger */\n\nfunction sendLog(params)\n{\n\tconst evnt = new Event.BaseEvent({data: params});\n\tEvent.EventEmitter.emit('BX.Call.Logger:sendLog', evnt);\n}\n\n\nexport default {\n\tupdateUserData,\n\tsetUserData,\n\tgetDateForLog,\n\tgetTimeForLog,\n\tlpad,\n\tgetUser,\n\tgetUserCached,\n\tgetUsers,\n\tgetUserName,\n\tgetUserAvatar,\n\tgetUserAvatars,\n\tisAvatarBlank,\n\tgetCustomMessage,\n\tconvertKeysToUpper,\n\tappendChildren,\n\tcontainsVideoTrack,\n\thasHdVideo,\n\tfindBestElementSize,\n\tgetFilledArea,\n\tisWebRTCSupported,\n\tisCallServerAllowed,\n\tisFeedbackAllowed,\n\tshouldCollectStats,\n\tshouldShowDocumentButton,\n\tgetDocumentsArticleCode,\n\tgetResumesArticleCode,\n\tgetUserLimit,\n\tgetClientSelfTestUrl,\n\tgetLogMessage,\n\tgetUuidv4,\n\treportConnectionResult,\n\tsendTelemetryEvent,\n\tisDesktop,\n\tgetBrowserForStatistics,\n\tisBlank,\n\tstopMediaStream,\n    stopMediaStreamVideoTracks,\n    stopMediaStreamAudioTracks,\n\tgetConferenceProvider,\n\tgetCurrentBitrixCall,\n\tsetCodecToReport,\n\tsaveReportWithoutCodecs,\n\tprocessReportsWithoutCodecs,\n\tsetLocalPacketsLostOrSaveReport,\n\tcalcBitrate,\n\tcalcLocalPacketsLost,\n\tcalcRemotePacketsLost,\n\tformatPacketsLostData,\n\tgetCallFeatures,\n\tgetAvatarBackground,\n\tgetRecordTimeText,\n\tgetTimeText,\n\tgetTimeInSeconds,\n\tisConferenceChatEnabled,\n\tgetCallConnectionData,\n\tgetCallConnectionDataById,\n\tabortGetCallConnectionData,\n\tstartSelfTest,\n\tuseTcpSdp,\n\topenArticle,\n\tgetAiSettings,\n\tisUserControlFeatureEnabled,\n\tisPictureInPictureFeatureEnabled,\n\tisNewQOSEnabled,\n\tsendLog,\n\tisChatMountInPage,\n\troomPermissions,\n\tgetCurrentUserRole,\n\thavePermissionToBroadcast,\n\tsetRoomPermissions,\n\tgetRoomPermissions,\n\tsetUserPermissions,\n\tgetUserPermissions,\n\tupdateUserPermissionByNewRoomPermission,\n\tsetUserPermissionsByRoomPermissions,\n\tcanControlChangeSettings,\n\tcanControlGiveSpeakPermission,\n\tsetCurrentUserRole,\n\tUsersRoles,\n\tisRegularUser,\n\tgetUserRoleByUserId,\n\tisDisableCameraNewJoinedUsersFeatureEnabled,\n\tcountDisableCameraNewJoinedUsersFeature,\n\tisKibanaLogsEnabled,\n}","import {Dom, Text, Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {Popup} from 'main.popup';\n\nimport {DesktopApi} from 'im.v2.lib.desktop-api';\n\nimport Util from '../util';\nimport { Utils } from 'im.v2.lib.utils';\nimport { checkAndEncodeURI } from '../view/tools';\n\nconst Events = {\n\tonClose: 'onClose',\n\tonDestroy: 'onDestroy',\n\tonButtonClick: 'onButtonClick',\n};\n\nconst InternalEvents = {\n\tsetHasCamera: \"CallNotification::setHasCamera\",\n\tcontentReady: \"CallNotification::contentReady\",\n\tonButtonClick: \"CallNotification::onButtonClick\",\n};\n\nconst FirstDesktopVersionWithChrome = 76;\n\nexport type IncomingNotificationParams = {\n\tcallerName: string,\n\tcallerAvatar: string,\n\tcallerType: string,\n\tcallerColor: string,\n\tvideo: boolean,\n\thasCamera: boolean,\n\tmicrophoneState: boolean,\n\tcameraState: boolean,\n\tzIndex: number,\n\tonClose: () => void,\n\tonDestroy: () => void,\n\tonButtonClick: () => void,\n\tisMessengerOpen: boolean,\n}\n\nconst BroadcastChannelName = 'IncomingNotification';\n\nexport class IncomingNotification extends EventEmitter\n{\n\tstatic Events = Events;\n\n\tconstructor(config: IncomingNotificationParams)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Call.IncomingNotification')\n\n\t\tthis.popup = null;\n\t\tthis.window = null;\n\n\t\tthis.callerAvatar = Type.isStringFilled(config.callerAvatar) ? config.callerAvatar : \"\";\n\t\tif (Util.isAvatarBlank(this.callerAvatar))\n\t\t{\n\t\t\tthis.callerAvatar = \"\";\n\t\t}\n\n\t\tthis.callerName = config.callerName;\n\t\tthis.callerType = config.callerType;\n\t\tthis.callerColor = config.callerColor;\n\t\tthis.video = config.video;\n\t\tthis.hasCamera = config.hasCamera === true;\n\t\tthis.zIndex = config.zIndex;\n\t\tthis.isMessengerOpen = config.isMessengerOpen;\n\t\tthis.contentReady = false;\n\t\tthis.postponedEvents = [];\n\t\tthis.microphoneState = config.microphoneState;\n\t\tthis.cameraState = config.cameraState;\n\n\t\tthis.#subscribeEvents(config);\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tthis.onButtonClickHandler = this.#onButtonClick.bind(this);\n\t\t\tthis.onContentReadyHandler = this.#onContentReady.bind(this);\n\t\t\tDesktopApi.subscribe(InternalEvents.onButtonClick, this.onButtonClickHandler);\n\t\t\tDesktopApi.subscribe(InternalEvents.contentReady, this.onContentReadyHandler);\n\t\t}\n\n\t\tconst broadcastChannel = new BroadcastChannel(BroadcastChannelName);\n\t\tbroadcastChannel.onmessage = (event) => {\n\t\t\tif (event.data.desktopWindowIsReady)\n\t\t\t{\n\t\t\t\tthis.#showInDesktop();\n\t\t\t}\n\t\t};\n\t}\n\n\t#subscribeEvents(config)\n\t{\n\t\tconst eventKeys = Object.keys(Events);\n\t\tfor (let eventName of eventKeys)\n\t\t{\n\t\t\tif (Type.isFunction(config[eventName]))\n\t\t\t{\n\t\t\t\tthis.subscribe(Events[eventName], config[eventName])\n\t\t\t}\n\t\t}\n\t}\n\n\t#showInDesktop()\n\t{\n\t\tif (!this.window)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// Workaround to prevent incoming call window from hanging.\n\t\t// Without it, there is a possible scenario, when BXDesktopWindow.ExecuteCommand(\"close\") is executed too early\n\t\t// (if invite window is closed before appearing), which leads to hanging of the window\n\t\tif (this.window.opener.BXIM?.callController && !this.window.opener.BXIM.callController.callNotification)\n\t\t{\n\t\t\tconsole.log('Workaround to prevent incoming call window from hanging');\n\t\t\tthis.window.BXDesktopWindow.ExecuteCommand('close');\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst width = 460;\n\t\tconst height = 580;\n\n\t\tDom.append(this.content.render(), this.window.document.body);\n\t\tthis.window.BXDesktopWindow?.SetProperty('position', { X: 'STP_CENTER', Y: 'STP_VCENTER', Width: width, Height: height });\n\t}\n\n\tshow()\n\t{\n\t\tconsole.log('incoming notification : SHOW');\n\n\t\tconst params = {\n\t\t\tvideo: this.video,\n\t\t\thasCamera: this.hasCamera,\n\t\t\tcallerAvatar: this.callerAvatar,\n\t\t\tcallerName: this.callerName,\n\t\t\tcallerType: this.callerType,\n\t\t\tcallerColor: this.callerColor,\n\t\t\tmicrophoneState: this.microphoneState,\n\t\t\tcameraState: this.cameraState,\n\t\t\tisMessengerOpen: this.isMessengerOpen,\n\t\t};\n\n\t\tif (DesktopApi.isChatWindow())\n\t\t{\n\t\t\tconsole.log('incoming notification : ISDESKTOP');\n\t\t\tif (this.window)\n\t\t\t{\n\t\t\t\tthis.window.BXDesktopWindow.ExecuteCommand('show');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.content = new IncomingNotificationContent({\n\t\t\t\t\t...params,\n\t\t\t\t});\n\n\t\t\t\tconst js = `\n\t\t\t\t\tconst broadcastChannel = new BroadcastChannel('${BroadcastChannelName}');\n\t\t\t\t\tbroadcastChannel.postMessage({ desktopWindowIsReady: true });\n\t\t\t\t`;\n\t\t\t\tconst htmlContent = DesktopApi.prepareHtml('', js);\n\t\t\t\tthis.window = DesktopApi.createTopmostWindow(htmlContent);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconsole.log('incoming notification : ISNOTDESKTOP');\n\t\t\tthis.content = new IncomingNotificationContent({\n\t\t\t\t...params,\n\t\t\t\tonClose: () => this.emit(Events.onClose),\n\t\t\t\tonDestroy: () => this.emit(Events.onDestroy),\n\t\t\t\tonButtonClick: (e) => this.emit(Events.onButtonClick, Object.assign({}, e.data)),\n\t\t\t});\n\t\t\tthis.createPopup(this.content.render());\n\t\t\tthis.popup.show();\n\n\t\t\twindow.addEventListener('resize', () => {\n\t\t\t\tthis.onResize();\n\t\t\t});\n\t\t}\n\t};\n\n\tonResize()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.setMaxHeight(document.body.clientHeight);\n\t\t}\n\t}\n\n\tcreatePopup(content)\n\t{\n\t\tthis.popup = new Popup({\n\t\t\tid: \"bx-messenger-call-notify\",\n\t\t\tbindElement: null,\n\t\t\ttargetContainer: document.body,\n\t\t\tcontent: content,\n\t\t\tcloseIcon: false,\n\t\t\tnoAllPaddings: true,\n\t\t\tzIndex: this.zIndex,\n\t\t\tdisableScroll: true,\n\t\t\tmaxHeight: document.body.clientHeight,\n\t\t\toffsetLeft: 0,\n\t\t\toffsetTop: 0,\n\t\t\tcloseByEsc: false,\n\t\t\tdraggable: {restrict: false},\n\t\t\tborderRadius: '25px',\n\t\t\toverlay: {backgroundColor: 'black', opacity: 30},\n\t\t\tevents: {\n\t\t\t\tonPopupClose: () =>\n\t\t\t\t{\n\t\t\t\t\twindow.removeEventListener('resize', () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.onResize();\n\t\t\t\t\t});\n\t\t\t\t\tthis.emit(Events.onClose);\n\t\t\t\t},\n\t\t\t\tonPopupDestroy: () => this.popup = null,\n\t\t\t}\n\t\t});\n\t};\n\n\tsetHasCamera(hasCamera)\n\t{\n\t\tif (this.window)\n\t\t{\n\t\t\t// desktop; send event to the window\n\t\t\tif (this.contentReady)\n\t\t\t{\n\t\t\t\tDesktopApi.emit(InternalEvents.setHasCamera, [hasCamera]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.postponedEvents.push({\n\t\t\t\t\tname: InternalEvents.setHasCamera,\n\t\t\t\t\tparams: [hasCamera]\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t\telse if (this.content)\n\t\t{\n\t\t\tthis.content.setHasCamera(hasCamera)\n\t\t}\n\t};\n\n\tsendPostponedEvents()\n\t{\n\t\tthis.postponedEvents.forEach((event) =>\n\t\t{\n\t\t\tDesktopApi.emit(event.name, event.params);\n\t\t})\n\t\tthis.postponedEvents = [];\n\t}\n\n\tclose()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t}\n\n\t\tif (this.window)\n\t\t{\n\t\t\tconst desktopVersion = window.BXDesktopSystem?.ApiVersion?.();\n\t\t\tthis.window.BXDesktopWindow.ExecuteCommand('hide');\n\n\t\t\tif (desktopVersion >= FirstDesktopVersionWithChrome)\n\t\t\t{\n\t\t\t\tthis.window.BXDesktopWindow.ExecuteCommand('close');\n\t\t\t\tthis.window = null;\n\t\t\t}\n\t\t}\n\t\tthis.emit(Events.onClose);\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.destroy();\n\t\t\tthis.popup = null;\n\t\t}\n\t\tif (this.window)\n\t\t{\n\t\t\tthis.window.BXDesktopWindow.ExecuteCommand(\"close\");\n\t\t\tthis.window = null;\n\t\t}\n\t\tif (this.content)\n\t\t{\n\t\t\tthis.content.destroy();\n\t\t\tthis.content = null;\n\t\t}\n\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.unsubscribe(InternalEvents.onButtonClick, this.onButtonClickHandler);\n\t\t\tDesktopApi.unsubscribe(InternalEvents.contentReady, this.onContentReadyHandler);\n\t\t}\n\t\tthis.emit(Events.onDestroy);\n\n\t\tthis.unsubscribeAll(Events.onButtonClick);\n\t\tthis.unsubscribeAll(Events.onClick);\n\t\tthis.unsubscribeAll(Events.onDestroy);\n\t};\n\n\t#onButtonClick(event)\n\t{\n\t\tthis.emit(Events.onButtonClick, event);\n\t}\n\n\t#onContentReady()\n\t{\n\t\tthis.contentReady = true;\n\t\tthis.sendPostponedEvents();\n\t}\n}\n\nexport class IncomingNotificationContent extends EventEmitter\n{\n\tconstructor(config)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Call.IncomingNotificationContent');\n\n\t\tthis.video = !!config.video;\n\t\tthis.hasCamera = !!config.hasCamera;\n\t\tthis.callerAvatar = config.callerAvatar || '';\n\t\tthis.callerName = config.callerName || BX.message('IM_M_CALL_VIDEO_HD');\n\t\tthis.callerType = config.callerType || 'chat';\n\t\tthis.callerColor = config.callerColor || '';\n\t\tthis.microphoneState = config.microphoneState;\n\t\tthis.cameraState = config.cameraState;\n\t\tthis.isMessengerOpen = config.isMessengerOpen;\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\tavatar: null,\n\t\t\tbuttons: {\n\t\t\t\tanswerVideo: null\n\t\t\t}\n\t\t};\n\n\t\tthis.#subscribeEvents(config)\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tthis.onHasCameraHandler = this.#onHasCamera.bind(this);\n\t\t\tDesktopApi.subscribe(InternalEvents.setHasCamera, this.onHasCameraHandler);\n\t\t\tDesktopApi.emitToMainWindow(InternalEvents.contentReady, []);\n\t\t}\n\t};\n\n\t#subscribeEvents(config)\n\t{\n\t\tconst eventKeys = Object.keys(Events);\n\t\tfor (let eventName of eventKeys)\n\t\t{\n\t\t\tif (Type.isFunction(config[eventName]))\n\t\t\t{\n\t\t\t\tthis.subscribe(Events[eventName], config[eventName])\n\t\t\t}\n\t\t}\n\t}\n\n\trender()\n\t{\n\t\tlet callerPrefix;\n\n\t\tif (this.video)\n\t\t{\n\t\t\tif (this.callerType === 'private')\n\t\t\t{\n\t\t\t\tcallerPrefix = BX.message(\"IM_M_VIDEO_CALL_FROM\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcallerPrefix = BX.message(\"IM_M_VIDEO_CALL_FROM_CHAT\");\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.callerType === 'private')\n\t\t\t{\n\t\t\t\tcallerPrefix = BX.message(\"IM_M_CALL_FROM\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcallerPrefix = BX.message(\"IM_M_CALL_FROM_CHAT\");\n\t\t\t}\n\t\t}\n\n\t\tlet avatarClass = '';\n\t\tlet avatarImageStyles;\n\t\tlet avatarImageText = '';\n\n\t\tif (this.callerAvatar)\n\t\t{\n\t\t\tavatarImageStyles = {\n\t\t\t\tbackgroundImage: `url('${checkAndEncodeURI(this.callerAvatar)}')`,\n\t\t\t\tbackgroundColor: '#fff',\n\t\t\t\tbackgroundSize: 'cover',\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst callerType = this.callerType === 'private' ? 'user' : this.callerType;\n\n\t\t\tavatarClass = 'bx-messenger-panel-avatar-' + callerType;\n\t\t\tavatarImageStyles = {\n\t\t\t\tbackgroundColor: this.callerColor || '#525252',\n\t\t\t\tbackgroundSize: '40px',\n\t\t\t\tbackgroundPosition: 'center center',\n\t\t\t}\n\t\t\tavatarImageText = Utils.text.getFirstLetters(this.callerName).toUpperCase();\n\t\t}\n\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-call-window\" + (DesktopApi.isDesktop() ? ' desktop' : '')},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-call-window-body\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-top\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-photo bx-messenger-videocall-incoming-call-avatar-pulse\"},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\t\tclassName: \"bx-messenger-call-window-photo-left \" + avatarClass\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t\tthis.elements.avatar = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName: \"bx-messenger-call-window-photo-block\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: avatarImageStyles,\n\t\t\t\t\t\t\t\t\t\t\t\t\ttext: avatarImageText,\n\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-incoming-call-pulse-element\", style: \"animation-delay: -2s;\"}\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-incoming-call-pulse-element\", style: \"animation-delay: -1.5s;\"}\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-incoming-call-pulse-element\", style: \"animation-delay: -1s;\"}\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-incoming-call-pulse-element\", style: \"animation-delay: -0.5s;\"}\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-title\"},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-title-block\"},\n\t\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-overlay-title-caller-prefix\"},\n\t\t\t\t\t\t\t\t\t\t\t\t\ttext: callerPrefix\n\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-overlay-title-caller\"},\n\t\t\t\t\t\t\t\t\t\t\t\t\ttext: Text.decode(this.callerName)\n\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.windowBottom = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-bottom\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-buttons\"},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tthis.elements.buttonsBlock = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-buttons-block\"},\n\t\t\t\t\t\t\t\t\t\t\tchildren: []\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\n\t\tthis.elements.windowBottom.prepend(...[\n\t\t\tDom.create(\"div\", {\n\t\t\t\tprops: {className: \"bx-messenger-call-window-settings-block\"},\n\t\t\t\tchildren: [\n\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-settings-block-title\"},\n\t\t\t\t\t\ttext: BX.message(\"CALL_M_INCOMING_NOTIFICATION_SETTINGS_TITLE\")\n\t\t\t\t\t}),\n\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-settings-buttons-block\"},\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-settings-button\"},\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\tthis.elements.buttons.toggleMicrophoneIcon = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-settings-icon microphone-\" + (this.microphoneState ? \"on\" : \"off\")}\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-settings-text microphone\"},\n\t\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_MIC\")\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\tevents: {click: this.#onMicrophoneSettingClick.bind(this)},\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-settings-separator\"},\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-settings-button\"},\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\tthis.elements.buttons.toggleCameraIcon = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\tclassName: \"bx-messenger-call-window-settings-icon camera-\" + (this.cameraState && this.hasCamera ? \"on\" : \"off\") + (this.hasCamera ? \"\" : \" bx-messenger-call-window-button-disabled\")\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-settings-text camera\"},\n\t\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_CAMERA\"),\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\tevents: {click: this.#onCameraSettingClick.bind(this)}\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t],\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t}),\n\t\t]);\n\n\t\tthis.elements.buttonsBlock.append(...[\n\t\t\tDom.create(\"div\", {\n\t\t\t\tprops: {className: \"bx-messenger-call-window-button bx-messenger-call-window-button-danger\"},\n\t\t\t\tchildren: [\n\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tclassName: \"bx-messenger-call-window-button-icon bx-messenger-call-window-button-icon-phone-down\",\n\t\t\t\t\t\t\ttitle: BX.message(\"IM_M_CALL_BTN_DECLINE\"),\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tevents: {click: this.#onDeclineButtonClick.bind(this)}\n\t\t\t}),\n\t\t\tthis.elements.buttons.answer = Dom.create(\"div\", {\n\t\t\t\tprops: {\n\t\t\t\t\tclassName: \"bx-messenger-call-window-button\" + (this.withBlur ? ' with-blur' : ''),\n\t\t\t\t\ttitle: BX.message(\"IM_M_CALL_BTN_ANSWER\"),\n\t\t\t\t},\n\t\t\t\tchildren: [\n\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-button-icon bx-messenger-call-window-button-icon-phone-up\"}\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tevents: {click: this.#onAnswerButtonClick.bind(this)}\n\t\t\t}),\n\t\t]);\n\n\t\treturn this.elements.root;\n\t};\n\n\tsetHasCamera(hasCamera)\n\t{\n\t\tthis.hasCamera = !!hasCamera;\n\t};\n\n\t#onHasCamera()\n\t{\n\n\t}\n\n\t#onMicrophoneSettingClick()\n\t{\n\t\tthis.microphoneState = !this.microphoneState;\n\n\t\tif (this.microphoneState)\n\t\t{\n\t\t\tthis.elements.buttons.toggleMicrophoneIcon.classList.add('microphone-on');\n\t\t\tthis.elements.buttons.toggleMicrophoneIcon.classList.remove('microphone-off');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.buttons.toggleMicrophoneIcon.classList.add('microphone-off');\n\t\t\tthis.elements.buttons.toggleMicrophoneIcon.classList.remove('microphone-on');\n\t\t}\n\t};\n\n\t#onCameraSettingClick()\n\t{\n\t\tthis.cameraState = !this.cameraState;\n\n\t\tif (this.cameraState)\n\t\t{\n\t\t\tthis.elements.buttons.toggleCameraIcon.classList.add('camera-on');\n\t\t\tthis.elements.buttons.toggleCameraIcon.classList.remove('camera-off');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.buttons.toggleCameraIcon.classList.add('camera-off');\n\t\t\tthis.elements.buttons.toggleCameraIcon.classList.remove('camera-on');\n\t\t}\n\t};\n\n\t#onAnswerButtonClick()\n\t{\n\t\tif (!this.hasCamera)\n\t\t{\n\t\t\tthis.cameraState = false;\n\t\t\tthis.microphoneState = true;\n\t\t}\n\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.closeWindow();\n\t\t\tDesktopApi.emitToMainWindow(InternalEvents.onButtonClick, [{\n\t\t\t\tbutton: 'answer',\n\t\t\t\tmediaParams: {\n\t\t\t\t\taudio: this.microphoneState,\n\t\t\t\t\tvideo: this.cameraState,\n\t\t\t\t}\n\t\t\t}]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.emit(Events.onButtonClick, {\n\t\t\t\tbutton: 'answer',\n\t\t\t\tmediaParams: {\n\t\t\t\t\taudio: this.microphoneState,\n\t\t\t\t\tvideo: this.cameraState,\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t};\n\n\t#onAnswerWithVideoButtonClick()\n\t{\n\t\tif (!this.hasCamera)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.closeWindow();\n\t\t\tDesktopApi.emitToMainWindow(InternalEvents.onButtonClick, [{\n\t\t\t\tbutton: 'answer',\n\t\t\t\tmediaParams: {\n\t\t\t\t\taudio: true,\n\t\t\t\t\tvideo: true,\n\t\t\t\t}\n\t\t\t}]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.emit(Events.onButtonClick, {\n\t\t\t\tbutton: 'answer',\n\t\t\t\tmediaParams: {\n\t\t\t\t\taudio: true,\n\t\t\t\t\tvideo: true,\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t};\n\n\t#onDeclineButtonClick()\n\t{\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.closeWindow();\n\t\t\tDesktopApi.emitToMainWindow(InternalEvents.onButtonClick, [{\n\t\t\t\tbutton: 'decline'\n\t\t\t}]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.emit(Events.onButtonClick, {\n\t\t\t\tbutton: 'decline'\n\t\t\t});\n\t\t}\n\t};\n\n\tdestroy()\n\t{\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.unsubscribe(InternalEvents.setHasCamera, this.onHasCameraHandler);\n\t\t}\n\t\tthis.unsubscribeAll(Events.onButtonClick);\n\t\tthis.unsubscribeAll(Events.onClick);\n\t\tthis.unsubscribeAll(Events.onDestroy);\n\t}\n}","import {Dom, Text, Type} from 'main.core';\nimport {Popup} from 'main.popup';\nimport {DesktopApi} from 'im.v2.lib.desktop-api';\nimport Util from '../util';\nimport { Utils } from 'im.v2.lib.utils';\n\nconst Events = {\n\tonButtonClick: \"ConferenceNotification::onButtonClick\"\n};\n\n/**\n *\n * @param {Object} config\n * @param {string} config.callerName\n * @param {string} config.callerAvatar\n * @param {number} config.zIndex\n * @param {function} config.onClose\n * @param {function} config.onDestroy\n * @param {function} config.onButtonClick\n * @constructor\n */\nexport class ConferenceNotifications\n{\n\tconstructor(config)\n\t{\n\t\tthis.popup = null;\n\t\tthis.window = null;\n\n\t\tthis.callerAvatar = Type.isStringFilled(config.callerAvatar) ? config.callerAvatar : \"\";\n\t\tthis.zIndex = config.zIndex;\n\t\tif (Util.isAvatarBlank(this.callerAvatar))\n\t\t{\n\t\t\tthis.callerAvatar = \"\";\n\t\t}\n\n\t\tthis.callerName = config.callerName;\n\t\tthis.callerColor = config.callerColor;\n\n\t\tthis.callbacks = {\n\t\t\tonClose: Type.isFunction(config.onClose) ? config.onClose : BX.DoNothing,\n\t\t\tonDestroy: Type.isFunction(config.onDestroy) ? config.onDestroy : BX.DoNothing,\n\t\t\tonButtonClick: Type.isFunction(config.onButtonClick) ? config.onButtonClick : BX.DoNothing\n\t\t};\n\n\t\tthis._onContentButtonClickHandler = this._onContentButtonClick.bind(this);\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.subscribe(Events.onButtonClick, this._onContentButtonClickHandler);\n\t\t}\n\t};\n\n\tshow()\n\t{\n\t\tif (DesktopApi.isChatWindow())\n\t\t{\n\t\t\tvar params = {\n\t\t\t\tcallerAvatar: this.callerAvatar,\n\t\t\t\tcallerName: this.callerName,\n\t\t\t\tcallerColor: this.callerColor\n\t\t\t};\n\n\t\t\tif (this.window)\n\t\t\t{\n\t\t\t\tthis.window.BXDesktopWindow.ExecuteCommand(\"show\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst js = `\n\t\t\t\t\twindow.conferenceNotification = new BX.Call.NotificationConferenceContent(${JSON.stringify(params)});\n\t\t\t\t\twindow.conferenceNotification.showInDesktop();\n\t\t\t\t`;\n\t\t\t\tconst html = DesktopApi.prepareHtml('', js);\n\t\t\t\tthis.window = DesktopApi.createTopmostWindow(html);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.content = new NotificationConferenceContent({\n\t\t\t\tcallerAvatar: this.callerAvatar,\n\t\t\t\tcallerName: this.callerName,\n\t\t\t\tcallerColor: this.callerColor,\n\t\t\t\tonClose: this.callbacks.onClose,\n\t\t\t\tonDestroy: this.callbacks.onDestroy,\n\t\t\t\tonButtonClick: this.callbacks.onButtonClick\n\t\t\t});\n\t\t\tthis.createPopup(this.content.render());\n\t\t\tthis.popup.show();\n\t\t\twindow.addEventListener('resize', () =>\n\t\t\t{\n\t\t\t\tthis.onResize();\n\t\t\t});\n\t\t}\n\t};\n\n\tonResize()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.setMaxHeight(document.body.clientHeight);\n\t\t}\n\t}\n\n\tcreatePopup(content)\n\t{\n\t\tthis.popup = new Popup({\n\t\t\tid: \"bx-messenger-call-notify\",\n\t\t\ttargetContainer: document.body,\n\t\t\tcontent: content,\n\t\t\tcloseIcon: false,\n\t\t\tnoAllPaddings: true,\n\t\t\tzIndex: this.zIndex,\n\t\t\toffsetLeft: 0,\n\t\t\toffsetTop: 0,\n\t\t\tcloseByEsc: false,\n\t\t\tdraggable: {restrict: false},\n\t\t\tborderRadius: '25px',\n\t\t\tdisableScroll: true,\n\t\t\tmaxHeight: document.body.clientHeight,\n\t\t\toverlay: {backgroundColor: 'black', opacity: 30},\n\t\t\tevents: {\n\t\t\t\tonPopupClose: function ()\n\t\t\t\t{\n\t\t\t\t\twindow.removeEventListener('resize', () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.onResize();\n\t\t\t\t\t});\n\t\t\t\t\tthis.callbacks.onClose();\n\t\t\t\t}.bind(this),\n\t\t\t\tonPopupDestroy: function ()\n\t\t\t\t{\n\t\t\t\t\tthis.popup = null;\n\t\t\t\t}.bind(this)\n\t\t\t}\n\t\t});\n\t};\n\n\tclose()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t}\n\t\tif (this.window)\n\t\t{\n\t\t\tthis.window.BXDesktopWindow.ExecuteCommand(\"hide\");\n\t\t}\n\t\tthis.callbacks.onClose();\n\t};\n\n\tdestroy()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.destroy();\n\t\t\tthis.popup = null;\n\t\t}\n\t\tif (this.window)\n\t\t{\n\t\t\tthis.window.BXDesktopWindow.ExecuteCommand(\"close\");\n\t\t\tthis.window = null;\n\t\t}\n\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.unsubscribe(Events.onButtonClick, this._onContentButtonClickHandler);\n\t\t}\n\t\tthis.callbacks.onDestroy();\n\t}\n\n\t_onContentButtonClick(e)\n\t{\n\t\tthis.callbacks.onButtonClick(e);\n\t}\n}\n\nexport class NotificationConferenceContent\n{\n\tconstructor(config)\n\t{\n\t\tthis.callerAvatar = config.callerAvatar || '';\n\t\tthis.callerName = config.callerName || BX.message('IM_CL_USER');\n\t\tthis.callerColor = config.callerColor || '#525252';\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\tavatar: null\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tonClose: Type.isFunction(config.onClose) ? config.onClose : BX.DoNothing,\n\t\t\tonDestroy: Type.isFunction(config.onDestroy) ? config.onDestroy : BX.DoNothing,\n\t\t\tonButtonClick: Type.isFunction(config.onButtonClick) ? config.onButtonClick : BX.DoNothing\n\t\t};\n\t};\n\n\trender()\n\t{\n\t\tvar avatarImageStyles;\n\t\tlet avatarImageText = '';\n\t\tif (this.callerAvatar)\n\t\t{\n\t\t\tavatarImageStyles = {\n\t\t\t\tbackgroundImage: \"url('\" + this.callerAvatar + \"')\",\n\t\t\t\tbackgroundColor: '#fff',\n\t\t\t\tbackgroundSize: 'cover',\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tavatarImageStyles = {\n\t\t\t\tbackgroundImage: 'none',\n\t\t\t\tbackgroundColor: this.callerColor,\n\t\t\t\tbackgroundSize: '80px',\n\t\t\t\tbackgroundRepeat: 'no-repeat',\n\t\t\t\tbackgroundPosition: 'center center',\n\t\t\t}\n\t\t\tavatarImageText = Utils.text.getFirstLetters(this.callerName).toUpperCase();\n\t\t}\n\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-call-window\" + (DesktopApi.isDesktop() ? ' desktop' : '')},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-call-window-body\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-top\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-photo bx-messenger-videocall-incoming-call-avatar-pulse\"},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-photo-left\"},\n\t\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t\tthis.elements.avatar = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-photo-block\"},\n\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: avatarImageStyles,\n\t\t\t\t\t\t\t\t\t\t\t\t\ttext: avatarImageText,\n\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-incoming-call-pulse-element\", style: \"animation-delay: -2s;\"}\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-incoming-call-pulse-element\", style: \"animation-delay: -1.5s;\"}\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-incoming-call-pulse-element\", style: \"animation-delay: -1s;\"}\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-incoming-call-pulse-element\", style: \"animation-delay: -0.5s;\"}\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-title\"},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-title-block\"},\n\t\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-overlay-title-caller-prefix\"},\n\t\t\t\t\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_M_VIDEO_CALL_FROM\")\n\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\ttext: Text.encode(this.callerName),\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-overlay-title-caller\"}\n\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-bottom\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-buttons\"},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tthis.elements.buttonsBlock = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-window-buttons-block\"},\n\t\t\t\t\t\t\t\t\t\t\tchildren: []\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\n\t\tthis.elements.buttonsBlock.append(...[\n\t\t\tDom.create(\"div\", {\n\t\t\t\tprops: {className: \"bx-messenger-call-window-button bx-messenger-call-window-button-danger\"},\n\t\t\t\tchildren: [\n\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tclassName: \"bx-messenger-call-window-button-icon bx-messenger-call-window-button-icon-phone-down\",\n\t\t\t\t\t\t\ttitle: BX.message(\"IM_M_CALL_BTN_SKIP_CONFERENCE\"),\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tevents: {click: this._onSkipConferenceButtonClick.bind(this)}\n\t\t\t}),\n\t\t\tDom.create(\"div\", {\n\t\t\t\tprops: {className: \"bx-messenger-call-window-button\" + (this.withBlur ? ' with-blur' : '')},\n\t\t\t\tchildren: [\n\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tclassName: \"bx-messenger-call-window-button-icon bx-messenger-call-window-button-icon-phone-up\",\n\t\t\t\t\t\t\ttitle: BX.message(\"IM_M_CALL_BTN_ANSWER_CONFERENCE\"),\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tevents: {click: this._onAnswerConferenceButtonClick.bind(this)}\n\t\t\t}),\n\t\t]);\n\n\t\treturn this.elements.root;\n\t};\n\n\tshowInDesktop()\n\t{\n\t\tconst width = 460;\n\t\tconst height = 580;\n\t\tthis.render();\n\t\tdocument.body.appendChild(this.elements.root);\n\t\tDesktopApi.setWindowPosition({\n\t\t\tx: STP_CENTER,\n\t\t\ty: STP_VCENTER,\n\t\t\twidth,\n\t\t\theight\n\t\t});\n\t};\n\n\t_onAnswerConferenceButtonClick(e)\n\t{\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.closeWindow();\n\t\t\tDesktopApi.emitToMainWindow(Events.onButtonClick, [{\n\t\t\t\tbutton: 'answerConference',\n\t\t\t}]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callbacks.onButtonClick({\n\t\t\t\tbutton: 'answerConference',\n\t\t\t});\n\t\t}\n\t};\n\n\t_onSkipConferenceButtonClick(e)\n\t{\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.closeWindow();\n\t\t\tDesktopApi.emitToMainWindow(Events.onButtonClick, [{\n\t\t\t\tbutton: 'skipConference',\n\t\t\t}]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callbacks.onButtonClick({\n\t\t\t\tbutton: 'skipConference'\n\t\t\t});\n\t\t}\n\t};\n\n}\n","import {Dom, Type} from 'main.core';\nimport {DesktopApi} from 'im.v2.lib.desktop-api';\n\nimport './css/floating-screenshare.css';\n\nconst Events = {\n\tonBackToCallClick: \"FloatingScreenshare::onBackToCallClick\",\n\tonStopSharingClick: \"FloatingScreenshare::onStopSharingClick\",\n\tonChangeScreenClick: \"FloatingScreenshare::onChangeScreenClick\"\n};\n\nconst POPUP_WIDTH = 291;\nconst POPUP_HEIGHT = 81;\nconst POPUP_OFFSET_X = 80;\nconst POPUP_OFFSET_Y = 80;\n\n/**\n *\n * @param {object} config\n * @constructor\n */\nexport class FloatingScreenShare\n{\n\tconstructor(config)\n\t{\n\t\tif (typeof (config) !== \"object\")\n\t\t{\n\t\t\tconfig = {};\n\t\t}\n\t\tthis.darkMode = config.darkMode || false;\n\n\t\tthis.window = null;\n\t\tthis.sharedWindowX = null;\n\t\tthis.sharedWindowY = null;\n\t\tthis.sharedWindowHeight = null;\n\t\tthis.sharedWindowWidth = null;\n\t\tthis.title = '';\n\t\tthis.app = '';\n\n\t\tthis.screens = [];\n\t\tthis.screenToUse = null;\n\n\t\tthis.callbacks = {\n\t\t\tonBackToCallClick: Type.isFunction(config.onBackToCallClick) ? config.onBackToCallClick : BX.DoNothing,\n\t\t\tonStopSharingClick: Type.isFunction(config.onStopSharingClick) ? config.onStopSharingClick : BX.DoNothing,\n\t\t\tonChangeScreenClick: Type.isFunction(config.onChangeScreenClick) ? config.onChangeScreenClick : BX.DoNothing,\n\t\t};\n\n\t\tthis._onBackToCallClickHandler = this._onBackToCallClick.bind(this);\n\t\tthis._onStopSharingClickHandler = this._onStopSharingClick.bind(this);\n\t\tthis._onChangeScreenClickHandler = this._onChangeScreenClick.bind(this);\n\t\tthis.bindEventHandlers();\n\t};\n\n\tbindEventHandlers()\n\t{\n\t\tDesktopApi.subscribe(Events.onBackToCallClick, this._onBackToCallClickHandler);\n\t\tDesktopApi.subscribe(Events.onStopSharingClick, this._onStopSharingClickHandler);\n\t\tDesktopApi.subscribe(Events.onChangeScreenClick, this._onChangeScreenClickHandler);\n\t}\n\n\tsaveExistingScreens()\n\t{\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tif (this.screens.length > 0)\n\t\t\t{\n\t\t\t\treturn resolve();\n\t\t\t}\n\n\t\t\tBXDesktopSystem.ListScreenMedia((result) =>\n\t\t\t{\n\t\t\t\tresult.forEach((item) =>\n\t\t\t\t{\n\t\t\t\t\tif (item.id.slice(0, 6) === 'screen')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.screens.push({\n\t\t\t\t\t\t\tid: item.id,\n\t\t\t\t\t\t\tx: item.x,\n\t\t\t\t\t\t\ty: item.y,\n\t\t\t\t\t\t\twidth: item.width,\n\t\t\t\t\t\t\theight: item.height\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn resolve();\n\t\t\t});\n\t\t});\n\t}\n\n\t_onBackToCallClick()\n\t{\n\t\tthis.callbacks.onBackToCallClick();\n\t}\n\n\t_onStopSharingClick()\n\t{\n\t\tthis.close();\n\t\tthis.callbacks.onStopSharingClick();\n\t}\n\n\t_onChangeScreenClick()\n\t{\n\t\tthis.callbacks.onChangeScreenClick();\n\t}\n\n\tsetSharingData(data)\n\t{\n\t\treturn this.saveExistingScreens().then(() =>\n\t\t{\n\t\t\tthis.sharedWindowX = data.x + 10;\n\t\t\tthis.sharedWindowY = data.y + 10;\n\t\t\tthis.sharedWindowWidth = data.width;\n\t\t\tthis.sharedWindowHeight = data.height;\n\t\t\tthis.title = data.title;\n\t\t\tthis.app = data.app;\n\n\t\t\tfor (let i = 0; i < this.screens.length; i++)\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\tthis.sharedWindowX >= this.screens[i].x &&\n\t\t\t\t\tthis.sharedWindowX <= (this.screens[i].x + this.screens[i].width) &&\n\t\t\t\t\tthis.sharedWindowY >= this.screens[i].y &&\n\t\t\t\t\tthis.sharedWindowY <= (this.screens[i].y + this.screens[i].height)\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.screenToUse = this.screens[i];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!this.screenToUse && this.screens.length > 0)\n\t\t\t{\n\t\t\t\tthis.screenToUse = this.screens[0];\n\t\t\t}\n\t\t}).catch((error) =>\n\t\t{\n\t\t\tconsole.log('save existing screens error', error);\n\t\t});\n\t}\n\n\tshow()\n\t{\n\t\tif (!DesktopApi.isDesktop() || DesktopApi.getApiVersion() > 74)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.window)\n\t\t{\n\t\t\tthis.window.BXDesktopWindow.ExecuteCommand(\"show\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvar params = {\n\t\t\t\ttitle: this.title,\n\t\t\t\tapp: this.app,\n\t\t\t\tsharedWindowX: this.sharedWindowX,\n\t\t\t\tsharedWindowY: this.sharedWindowY,\n\t\t\t\tsharedWindowWidth: this.sharedWindowWidth,\n\t\t\t\tsharedWindowHeight: this.sharedWindowHeight,\n\t\t\t\tscreenToUse: this.screenToUse,\n\t\t\t\tdarkMode: this.darkMode\n\t\t\t};\n\n\t\t\tconst js = `window.FSSC = new BX.Call.FloatingScreenShareContent(${JSON.stringify(params)});`;\n\t\t\tconst htmlContent = DesktopApi.prepareHtml('', js);\n\t\t\tthis.window = DesktopApi.createTopmostWindow(htmlContent);\n\t\t}\n\t}\n\n\thide()\n\t{\n\t\tif (!this.window || !this.window.document)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.window.BXDesktopWindow.ExecuteCommand(\"hide\");\n\t}\n\n\tclose()\n\t{\n\t\tif (!this.window || !this.window.document)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.window.BXDesktopWindow.ExecuteCommand(\"close\");\n\t\tthis.window = null;\n\t\tthis.visible = false;\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.window)\n\t\t{\n\t\t\tDesktopApi.closeWindow();\n\t\t\tthis.window = null;\n\t\t}\n\n\t\tDesktopApi.unsubscribe(Events.onBackToCallClick, this._onBackToCallClickHandler);\n\t\tDesktopApi.unsubscribe(Events.onStopSharingClick, this._onStopSharingClickHandler);\n\t\tDesktopApi.unsubscribe(Events.onChangeScreenClick, this._onChangeScreenClickHandler);\n\t}\n}\n\nexport class FloatingScreenShareContent\n{\n\tconstructor(config)\n\t{\n\t\tthis.title = config.title || '';\n\t\tthis.app = config.app || '';\n\t\tthis.sharedWindowX = config.sharedWindowX || 0;\n\t\tthis.sharedWindowY = config.sharedWindowY || 0;\n\t\tthis.sharedWindowHeight = config.sharedWindowHeight || 0;\n\t\tthis.sharedWindowWidth = config.sharedWindowWidth || 0;\n\t\tthis.screenToUse = config.screenToUse || null;\n\t\tthis.darkMode = config.darkMode || false;\n\n\t\tthis.elements = {\n\t\t\tcontainer: null\n\t\t};\n\n\t\tthis.render();\n\t\tthis.adjustWindow(POPUP_WIDTH, POPUP_HEIGHT);\n\t};\n\n\trender()\n\t{\n\t\tconst title = this.app ? this.app + ' - ' + this.title : this.title;\n\n\t\tthis.elements.container = Dom.create(\"div\", {\n\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-wrap' + (this.darkMode ? ' dark-mode' : '')},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-top'},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-top-icon'}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-top-text', title: title},\n\t\t\t\t\t\t\ttext: title\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-bottom'},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-bottom-left'},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-back-icon'}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-back-text'},\n\t\t\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_SCREENSHARE_BACK_TO_CALL')\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: this.onBackToCallClick.bind(this)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-bottom-center'},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-change-screen-icon'}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-change-screen-text'},\n\t\t\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_SCREENSHARE_CHANGE_SCREEN')\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: this.onChangeScreenClick.bind(this)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-bottom-right'},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-stop-icon'}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-stop-text'},\n\t\t\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_SCREENSHARE_STOP')\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: this.onStopSharingClick.bind(this)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\n\t\tdocument.body.appendChild(this.elements.container);\n\t\tdocument.body.classList.add('bx-messenger-call-floating-screenshare');\n\t}\n\n\tonBackToCallClick()\n\t{\n\t\tthis.dispatchEvent(Events.onBackToCallClick, []);\n\t}\n\n\tonChangeScreenClick()\n\t{\n\t\tthis.dispatchEvent(Events.onChangeScreenClick, []);\n\t}\n\n\tonStopSharingClick()\n\t{\n\t\tthis.dispatchEvent(Events.onStopSharingClick, []);\n\t}\n\n\tadjustWindow(width, height)\n\t{\n\t\tif (!this.screenToUse)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst blockOffset = 22;\n\t\tconst popupPadding = 22;\n\t\tconst leftBlockWidth = document.querySelector('.bx-messenger-call-floating-screenshare-bottom-left').scrollWidth;\n\t\tconst centerBlockWidth = document.querySelector('.bx-messenger-call-floating-screenshare-bottom-center').scrollWidth;\n\t\tconst rightBlockWidth = document.querySelector('.bx-messenger-call-floating-screenshare-bottom-right').scrollWidth;\n\t\tconst fullWidth = leftBlockWidth + centerBlockWidth + rightBlockWidth + (2 * blockOffset) + (2 * popupPadding);\n\t\tif (fullWidth > POPUP_WIDTH)\n\t\t{\n\t\t\twidth = fullWidth;\n\t\t}\n\n\t\tthis.elements.container.style.width = width + \"px\";\n\t\tthis.elements.container.style.height = height + \"px\";\n\n\t\tBXDesktopWindow.SetProperty(\"minClientSize\", {Width: width, Height: height});\n\t\tBXDesktopWindow.SetProperty(\"resizable\", false);\n\t\tBXDesktopWindow.SetProperty(\"closable\", false);\n\t\tBXDesktopWindow.SetProperty(\"title\", BX.message('IM_M_CALL_SCREENSHARE_TITLE'));\n\n\t\tBXDesktopWindow.SetProperty(\"position\", {\n\t\t\tX: this.screenToUse.x + this.screenToUse.width - width - POPUP_OFFSET_X,\n\t\t\tY: this.screenToUse.y + POPUP_OFFSET_Y,\n\t\t\tWidth: width,\n\t\t\tHeight: height,\n\t\t\tMode: STP_FRONT\n\t\t});\n\t}\n\n\tdispatchEvent(name, params)\n\t{\n\t\tlet convertedParams = {};\n\t\tfor (let i = 0; i < params.length; i++)\n\t\t{\n\t\t\tconvertedParams[i] = params[i];\n\t\t}\n\n\t\tconst mainWindow = opener ? opener : top;\n\t\tmainWindow.BXWindows.forEach( (windowItem) =>\n\t\t{\n\t\t\tif (\n\t\t\t\twindowItem &&\n\t\t\t\twindowItem.name !== '' &&\n\t\t\t\twindowItem.BXDesktopWindow &&\n\t\t\t\twindowItem.BXDesktopWindow.DispatchCustomEvent\n\t\t\t)\n\t\t\t{\n\t\t\t\twindowItem.BXDesktopWindow.DispatchCustomEvent(name, convertedParams);\n\t\t\t}\n\t\t});\n\t\tmainWindow.BXDesktopWindow.DispatchCustomEvent(name, convertedParams);\n\t}\n}","import {Dom, Text} from 'main.core'\nimport {Popup} from 'main.popup'\nimport Util from './util'\n\nexport class CallHint\n{\n\tconstructor(options)\n\t{\n\t\tthis.popup = null;\n\n\t\tthis.title = BX.prop.getString(options, \"title\", Text.encode(BX.message(\"IM_CALL_MIC_MUTED_WHILE_TALKING\")));\n\t\tthis.icon = BX.prop.getString(options, \"icon\", \"mic\");\n\n\t\tthis.bindElement = BX.prop.getElementNode(options, \"bindElement\", null);\n\t\tthis.targetContainer = BX.prop.getElementNode(options, \"targetContainer\", null);\n\t\tthis.callFolded = BX.prop.getBoolean(options, \"callFolded\", false);\n\t\tthis.showAngle = BX.prop.getBoolean(options, \"showAngle\", false);\n\t\tthis.autoCloseDelay = BX.prop.getInteger(options, \"autoCloseDelay\", 5000);\n\t\tthis.maxWidth = BX.prop.getInteger(options, \"maxWidth\", 600);\n\t\tthis.customClassName = BX.prop.getString(options, \"customClassName\", \"\");\n\t\tthis.initiatorName = BX.prop.getString(options, \"initiatorName\", \"\");\n\t\tthis.customRender = BX.prop.getFunction(options, \"customRender\", false);\n\n\t\tthis.buttonsLayout = BX.prop.getString(options, \"buttonsLayout\", \"right\");\n\t\tthis.buttons = BX.prop.getArray(options, \"buttons\", []);\n\n\t\tthis.callbacks = {\n\t\t\tonClose: BX.prop.getFunction(options, \"onClose\", BX.DoNothing),\n\t\t\tonAskSpeakButtonClicked: BX.prop.getFunction(options, \"onAskSpeakButtonClicked\", BX.DoNothing),\n\t\t}\n\t\tthis.autoCloseTimeout = 0;\n\t};\n\n\tshow()\n\t{\n\t\tclearTimeout(this.autoCloseTimeout);\n\t\tif (this.autoCloseDelay > 0)\n\t\t{\n\t\t\tthis.autoCloseTimeout = setTimeout(() => this.onAutoClose(), this.autoCloseDelay);\n\t\t}\n\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.show();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.popup = new Popup({\n\t\t\tbindElement: this.bindElement,\n\t\t\ttargetContainer: this.targetContainer,\n\t\t\tcontent: this.render(),\n\t\t\tpadding: 0,\n\t\t\tcontentPadding: 14,\n\t\t\t// height: this.getPopupHeight(),\n\t\t\tclassName: ('bx-call-view-popup-call-hint ' + this.customClassName),\n\t\t\tcontentBackground: 'unset',\n\t\t\t//maxWidth: this.maxWidth,\n\t\t\tangle: (this.showAngle && this.bindElement),\n\t\t\tevents: {\n\t\t\t\tonClose: () => this.popup.destroy(),\n\t\t\t\tonDestroy: () => this.popup = null,\n\t\t\t}\n\t\t});\n\n\t\tthis.popup.show();\n\t}\n\n\trender()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-call-view-popup-call-hint-body layout-\" + this.buttonsLayout},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-popup-call-hint-icon \" + this.icon},\n\t\t\t\t}),\t\t\t\t\n\t\t\t\t(this.customRender ? this.customRender() : this.renderPopupMessage()),\n\t\t\t\t(this.buttonsLayout === 'right' ? this.renderButtons() : null),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-popup-call-hint-close\"},\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick:  () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.callbacks.onClose();\n\t\t\t\t\t\t\tif (this.popup)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t}\n\t\n\tcreateAskSpeakButton()\n\t{\n\t\treturn new BX.UI.Button({\n\t\t\tbaseClass: \"ui-btn\",\n\t\t\ttext: BX.message(\"CALL_RISE_YOU_HAND_IN_HINT\"),\n\t\t\tsize: BX.UI.Button.Size.EXTRA_SMALL,\n\t\t\tcolor: BX.UI.Button.Color.LIGHT_BORDER,\n\t\t\tnoCaps: true,\n\t\t\tround: true,\n\t\t\tevents: {\n\t\t\t\tclick: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.callbacks.onAskSpeakButtonClicked();\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\t\n\t/*renderHandRaiseIcon()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-call-view-popup-call-hint-hand-raise-icon\"},\n\t\t});\n\t}*/\n\n\trenderButtons()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-call-view-popup-call-hint-buttons-container\"},\n\t\t\tchildren: this.buttons.map(button => button.render()),\n\t\t})\n\t}\n\n\trenderPopupMessage()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-call-view-popup-call-hint-middle-block\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-popup-call-hint-text\"},\n\t\t\t\t\thtml: this.getPopupMessage()\n\t\t\t\t}),\n\t\t\t\t(this.buttonsLayout === 'bottom' ? this.renderButtons() : null),\n\t\t\t]\n\t\t});\n\t}\n\n\tgetPopupMessage()\n\t{\n\t\tif (!Util.isDesktop())\n\t\t{\n\t\t\treturn this.title;\n\t\t}\n\t\t\n\t\tlet hotKeyMessage = BX.message(\"IM_CALL_MIC_MUTED_WHILE_TALKING_HOTKEY\");\n\t\tif (this.callFolded)\n\t\t{\n\t\t\tconst hotkey = (BX.browser.IsMac() ? 'Shift + &#8984; + A' : 'Ctrl + Shift + A');\n\t\t\thotKeyMessage = BX.message(\"IM_CALL_MIC_MUTED_WHILE_TALKING_FOLDED_CALL_HOTKEY\").replace('#HOTKEY#', hotkey);\n\t\t}\n\t\thotKeyMessage = '<span class=\"bx-call-view-popup-call-hint-text-hotkey\">' + hotKeyMessage + '</span>';\n\n\t\treturn this.title + '<br>' + hotKeyMessage;\n\t}\n\n\t/**\n\t * Returns height in pixels for the popup.\n\t * The height depends on the hotkey hint (hint appears only in the desktop app).\n\t *\n\t * @returns {number}\n\t */\n\tgetPopupHeight()\n\t{\n\t\treturn Util.isDesktop() ? 60 : 54;\n\t}\n\n\tclose()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t\tthis.callbacks.onClose();\n\t\t}\n\t}\n\n\tonAutoClose()\n\t{\n\t\tthis.close();\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.destroy();\n\t\t}\n\n\t\tclearTimeout(this.autoCloseTimeout)\n\t}\n}","import {Dom, Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {Popup} from 'main.popup';\nimport {BackgroundDialog} from './background_dialog';\nimport {View} from '../view/view';\nimport '../css/promo-popup.css';\n\nconst Events = {\n\tonActionClick: 'onActionClick',\n\tonClose: 'onClose'\n};\n\nexport class PromoPopup\n{\n\tconstructor(options)\n\t{\n\t\toptions = Type.isPlainObject(options) ? options : {};\n\t\tthis.promoCode = Type.isStringFilled(options.promoCode) ? options.promoCode : '';\n\t\tthis.bindElement = options.bindElement;\n\n\t\tthis.elements = {\n\t\t\troot: null\n\t\t};\n\t\tthis.popup = null;\n\t\tthis.dontShowAgain = false;\n\t\tthis.eventEmitter = new EventEmitter(this, \"BX.Call.PromoPopup\");\n\n\t\tif (options.events)\n\t\t{\n\t\t\tthis.subscribeToEvents(options.events);\n\t\t}\n\t};\n\n\tsubscribeToEvents(events)\n\t{\n\t\tfor (let eventName in events)\n\t\t{\n\t\t\tif (events.hasOwnProperty(eventName))\n\t\t\t{\n\t\t\t\tthis.eventEmitter.subscribe(eventName, events[eventName]);\n\t\t\t}\n\t\t}\n\t};\n\n\trender()\n\t{\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-call-promo-container\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-promo-content\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-promo-icon-section\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-promo-icon\"}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-promo-text-section\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-promo-title\"},\n\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_CALL_DOCUMENT_PROMO_TITLE_MSGVER_2\")\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-promo-text\"},\n\t\t\t\t\t\t\t\t\thtml: BX.message(\"IM_CALL_DOCUMENT_PROMO_TEXT\")\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-promo-refuse\"},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"input\", {\n\t\t\t\t\t\t\t\t\t\t\tattrs: {type: \"checkbox\"},\n\t\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\t\tclassName: \"bx-call-promo-refuse-checkbox\",\n\t\t\t\t\t\t\t\t\t\t\t\tid: \"bx-call-promo-refuse-checkbox\"\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\t\t\tchange: this.onCheckboxChange.bind(this)\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"label\", {\n\t\t\t\t\t\t\t\t\t\t\tattrs: {for: \"bx-call-promo-refuse-checkbox\"},\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-promo-refuse-text\"},\n\t\t\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_CALL_DOCUMENT_PROMO_DONT_SHOW_AGAIN\")\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-promo-button-section\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"button\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-promo-button bx-call-promo-button-action ui-btn ui-btn-round\"},\n\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_CALL_DOCUMENT_PROMO_ACTION\"),\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tclick: this.onActionClick.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"button\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-promo-button bx-call-promo-button-action-close ui-btn ui-btn-round\"},\n\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_CALL_DOCUMENT_PROMO_ACTION_CLOSE\"),\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tclick: this.close.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t};\n\n\tshow()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\tthis.render();\n\t\t}\n\n\t\tthis.createPopup();\n\t\tthis.popup.show();\n\t};\n\n\tclose()\n\t{\n\t\tif (!this.popup)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.popup.close();\n\t};\n\n\tcreatePopup()\n\t{\n\t\tthis.popup = new Popup({\n\t\t\tid: 'bx-call-promo-popup',\n\t\t\tbindElement: this.bindElement,\n\t\t\ttargetContainer: document.body,\n\t\t\tcontent: this.elements.root,\n\t\t\tcacheable: false,\n\t\t\tcloseIcon: true,\n\t\t\tbindOptions: {\n\t\t\t\tposition: \"top\"\n\t\t\t},\n\t\t\tangle: {position: \"bottom\", offset: 49},\n\t\t\tclassName: 'bx-call-promo-popup',\n\t\t\tcontentBackground: 'unset',\n\t\t\tevents: {\n\t\t\t\tonPopupClose: this.onPopupClose.bind(this),\n\t\t\t}\n\t\t});\n\t};\n\n\tonPopupClose()\n\t{\n\t\tthis.popup.destroy();\n\t\tthis.destroy();\n\t};\n\n\tonCheckboxChange(event)\n\t{\n\t\tthis.dontShowAgain = event.currentTarget.checked;\n\t};\n\n\tonActionClick()\n\t{\n\t\tthis.eventEmitter.emit(Events.onActionClick);\n\t};\n\n\tdestroy()\n\t{\n\t\tthis.eventEmitter.emit(Events.onClose, {dontShowAgain: this.dontShowAgain});\n\n\t\tthis.eventEmitter.unsubscribeAll(Events.onClose);\n\t\tthis.eventEmitter = null;\n\t\tthis.elements = null;\n\t};\n}\n\nPromoPopup.Events = Events;\n\nexport class PromoPopup3D\n{\n\tcallView: View\n\n\tconstructor(options)\n\t{\n\t\toptions = Type.isPlainObject(options) ? options : {};\n\n\t\tthis.callView = options.callView;\n\t\tthis.bindElement = options.bindElement;\n\n\t\tthis.popup = null;\n\n\t\toptions.events = Type.isPlainObject(options.events) ? options.events : {};\n\t\tthis.events = {\n\t\t\tonActionClick: options.events.onActionClick ? options.events.onActionClick : () => {},\n\t\t\tonClose: options.events.onClose ? options.events.onClose : () => {},\n\t\t};\n\t};\n\n\tshow()\n\t{\n\t\tthis.createPopup();\n\t\tthis.popup.show();\n\n\t\tBX.bind(BX('promo-popup-3d-button'), \"click\", this.openWindow.bind(this));\n\t};\n\n\topenWindow()\n\t{\n\t\tBackgroundDialog.open({tab: 'mask'});\n\t\tsetTimeout(() => this.close(), 100);\n\t}\n\n\topenLearningPopup()\n\t{\n\t\tconst bindElement = BX('bx-messenger-videocall-panel-item-with-arrow-camera');\n\t\tif (!bindElement)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tconst title = BX.message('IM_PROMO_3DAVATAR_30112022_LEARNING_TITLE');\n\t\tconst description = BX.message('IM_PROMO_3DAVATAR_30112022_LEARNING_TEXT');\n\n\t\tconst content = `\n\t\t\t<div class=\"promo-popup-3d-learning-content\">\n\t\t\t\t<h4 class=\"ui-typography-heading-h4 promo-popup-3d-learning-content__title\">${title}</h4>\n\t\t\t\t<p class=\"promo-popup-3d-learning-content__description\">${description}</p>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.popup = new Popup({\n\t\t\tid: 'bx-call-promo-learning-popup',\n\t\t\tbindElement: bindElement,\n\t\t\ttargetContainer: document.body,\n\t\t\tcontent: content,\n\t\t\tcacheable: false,\n\t\t\tcloseIcon: true,\n\t\t\tautoHide: true,\n\t\t\tcloseByEsc: true,\n\t\t\tbindOptions: {\n\t\t\t\tposition: \"top\", forceTop: -100, forceLeft: 100, forceBindPosition: true\n\t\t\t},\n\t\t\tangle: {position: \"top\", offset: 49},\n\t\t\tclassName: 'bx-call-promo-popup-learn',\n\t\t\tcontentBackground: 'unset',\n\t\t\tevents: {\n\t\t\t\tonPopupClose: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.events.onClose();\n\t\t\t\t},\n\t\t\t}\n\t\t});\n\n\t\tthis.popup.show();\n\n\t\tthis.callView.subscribe(\n\t\t\tView.Event.onDeviceSelectorShow,\n\t\t\t() => this.popup ? this.popup.close() : ''\n\t\t);\n\t}\n\n\tclose()\n\t{\n\t\tif (!this.popup)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.popup.close();\n\t};\n\n\tcreatePopup()\n\t{\n\t\tconst title = BX.message('IM_PROMO_3DAVATAR_30112022_TITLE');\n\t\tconst description = BX.message('IM_PROMO_3DAVATAR_30112022_TEXT');\n\t\tconst btnText = BX.message('IM_PROMO_3DAVATAR_30112022_BUTTON');\n\n\t\tconst content = `\n\t\t\t<div class=\"promo-popup-3d-content\">\n\t\t\t\t<div class=\"promo-popup-3d-content__masks-container\">\n\t\t\t\t\t<div class=\"promo-popup-3d-content__mask --left-2 --bear\"></div>\n\t\t\t\t\t<div class=\"promo-popup-3d-content__mask --left-1 --pole-bear\"></div>\n\t\t\t\t\t<div class=\"promo-popup-3d-content__mask --center --fox\"></div>\n\t\t\t\t\t<div class=\"promo-popup-3d-content__mask --right-1 --santa\"></div>\n\t\t\t\t\t<div class=\"promo-popup-3d-content__mask --right-2 --owl\"></div>\n\t\t\t\t</div>\n\t\t\t\t<h3 class=\"ui-typography-heading-h2 promo-popup-3d-content__title\">${title}</h3>\n\t\t\t\t<p class=\"promo-popup-3d-content__description\">${description}</p>\n\t\t\t\t<div class=\"promo-popup-3d-content__actions-btn\">\n\t\t\t\t\t<span class=\"ui-btn btn-primary ui-btn-lg ui-btn-round ui-btn-primary\" id=\"promo-popup-3d-button\">${btnText}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.popup = new Popup({\n\t\t\tid: 'bx-call-promo-popup-3d',\n\t\t\tbindElement: this.bindElement,\n\t\t\ttargetContainer: document.body,\n\t\t\tcontent: content,\n\t\t\tcacheable: false,\n\t\t\tcloseIcon: true,\n\t\t\toverlay: {\n\t\t\t\tbackgroundColor: '#000',\n\t\t\t\topacity: 40,\n\t\t\t},\n\t\t\twidth: 531,\n\t\t\tminHeight: 481,\n\t\t\tbindOptions: {\n\t\t\t\tposition: \"top\"\n\t\t\t},\n\t\t\tclassName: 'bx-call-promo-popup-3d-masks',\n\t\t\tevents: {\n\t\t\t\tonPopupClose: this.onPopupClose.bind(this),\n\t\t\t}\n\t\t});\n\t};\n\n\tonPopupClose()\n\t{\n\t\tthis.popup.destroy();\n\t\tthis.openLearningPopup();\n\t};\n}\n\nPromoPopup3D.Events = Events;\n\n","import {Dom} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport './css/sidebar.css';\n\nconst Events = {\n\tonClose: 'onClose',\n\tonDestroy: 'onDestroy',\n\tonCloseClicked: 'onCloseClicked',\n}\n\nexport class Sidebar extends EventEmitter\n{\n\tconstructor(options)\n\t{\n\t\tsuper()\n\t\tthis.setEventNamespace(\"BX.Call.SideBar\");\n\t\tthis.container = options.container;\n\n\t\tthis.width = BX.prop.getInteger(options, 'width', 200);\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\tclose: null,\n\t\t\tcontentContainer: null,\n\t\t}\n\n\t\tif (options.events)\n\t\t{\n\t\t\tfor (let eventName in options.events)\n\t\t\t{\n\t\t\t\tif (options.events.hasOwnProperty(eventName))\n\t\t\t\t{\n\t\t\t\t\tthis.subscribe(eventName, options.events[eventName]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-messenger-call-sidebar-root\"\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-call-sidebar-labels\"},\n\t\t\t\t\tstyle: {top: '39px' /*'17px'*/},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-sidebar-label\"},\n\t\t\t\t\t\t\tstyle: {maxWidth: '40px'},\n\t\t\t\t\t\t\tchildren: [Dom.create(\"div\", {\n\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-sidebar-label-icon-box\"},\n\t\t\t\t\t\t\t\tattrs: {title: BX.message(\"IM_M_CALL_BTN_CLOSE\")},\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-sidebar-label-icon bx-messenger-call-sidebar-label-icon-close\"},\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t})],\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: () => this.emit(Events.onCloseClicked)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tthis.elements.contentContainer = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-call-sidebar-content-container\"}\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t\tthis.elements.root.style.setProperty('--sidebar-width', this.width + 'px');\n\n\t\treturn this.elements.root;\n\t}\n\n\tsetWidth(width)\n\t{\n\t\tif (this.width == width)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.width = width;\n\t\tthis.elements.root.style.setProperty('--sidebar-width', this.width + 'px');\n\t}\n\n\topen(animation)\n\t{\n\t\tanimation = animation !== false;\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tthis.container.appendChild(this.render());\n\t\t\tif (animation)\n\t\t\t{\n\t\t\t\tthis.elements.root.classList.add('opening');\n\t\t\t\tthis.elements.root.addEventListener(\n\t\t\t\t\t'animationend',\n\t\t\t\t\t() =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.elements.root.classList.remove('opening');\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tonce: true\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\t\t})\n\t}\n\n\tclose(animation)\n\t{\n\t\tanimation = animation !== false;\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tif (animation)\n\t\t\t{\n\t\t\t\tthis.elements.root.classList.add('closing');\n\t\t\t\tthis.elements.root.addEventListener(\n\t\t\t\t\t'animationend',\n\t\t\t\t\t() =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.container.removeChild(this.elements.root);\n\t\t\t\t\t\tthis.emit(Events.onClose);\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tonce: true\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.container.removeChild(this.elements.root);\n\t\t\t\tthis.emit(Events.onClose);\n\t\t\t\tresolve();\n\t\t\t}\n\t\t})\n\t}\n\n\ttoggleHidden(hidden)\n\t{\n\t\tthis.elements.root.classList.toggle('hidden', hidden);\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.emit(Events.onDestroy);\n\t\tthis.unsubscribeAll(Events.onClose);\n\t\tthis.unsubscribeAll(Events.onDestroy);\n\t\tthis.eventEmitter = null;\n\t\tthis.elements = null;\n\t\tthis.container = null;\n\t}\n}","import '../css/record-with-copilot-popup.css';\n\nimport { Dom } from 'main.core';\n\ntype RecordWithCopilotPopupOptions = {\n\tonClickYesButton?: 'function',\n\tonClickNoButton?: 'function',\n\tonClose?: 'function',\n\ttitle: string,\n\tmessage: string,\n\tyesButtonText: string,\n\tnoButtonText: string,\n};\n\nexport class RecordWithCopilotPopup {\n\tconstructor(config: RecordWithCopilotPopupOptions)\n\t{\n\t\tthis.popup = null;\n\n\t\tthis.callbacks = {\n\t\t\tonClickYesButton: BX.type.isFunction(config.onClickYesButton) ? config.onClickYesButton : BX.DoNothing,\n\t\t\tonClickNoButton: BX.type.isFunction(config.onClickNoButton) ? config.onClickNoButton : BX.DoNothing,\n\t\t\tonClose: BX.type.isFunction(config.onClose) ? config.onClose : BX.DoNothing,\n\t\t};\n\n\t\tthis.title = BX.type.isString(config.title) ? config.title : '';\n\t\tthis.message = BX.type.isString(config.message) ? config.message : '';\n\t\tthis.yesButtonText = BX.type.isString(config.yesButtonText) ? config.yesButtonText : '';\n\t\tthis.noButtonText = BX.type.isString(config.noButtonText) ? config.noButtonText : '';\n\t}\n\n\tcreate()\n\t{\n\t\tthis.popup = BX.UI.Dialogs.MessageBox.create({\n\t\t\tmodal: true,\n\t\t\tpopupOptions: {\n\t\t\t\tcontent: Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'bx-messenger-videocall-record-alert-popup-content'},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-record-alert-title'},\n\t\t\t\t\t\t\ttext: this.title,\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-record-alert-message'},\n\t\t\t\t\t\t\ttext: this.message,\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-record-alert-actions'},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"button\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-record-alert-button bx-messenger-videocall-record-alert-button-yes'},\n\t\t\t\t\t\t\t\t\ttext: this.yesButtonText,\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\t\t\t\t\tthis.callbacks.onClickYesButton();\n\t\t\t\t\t\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"button\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-record-alert-button bx-messenger-videocall-record-alert-button-no'},\n\t\t\t\t\t\t\t\t\ttext: this.noButtonText,\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\t\t\t\t\tthis.callbacks.onClickNoButton();\n\t\t\t\t\t\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tclassName : \"bx-messenger-videocall-record-alert-popup\",\n\t\t\t\tdarkMode: true,\n\t\t\t\tcontentBackground: '#22272B',\n\t\t\t\tcontentBorderRadius: '10px',\n\t\t\t\tautoHide: false,\n\t\t\t\tcloseByEsc: false,\n\t\t\t\tcloseIcon: true,\n\t\t\t\tcontentNoPaddings: true,\n\t\t\t\twidth: 420,\n\t\t\t\tmaxWidth: 420,\n\t\t\t\tanimation: \"fading\",\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose: ()=>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.callbacks.onClose();\n\t\t\t\t\t\tthis.popup = null;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\tshow()\n\t{\n\t\tthis.close();\n\t\tthis.create();\n\n\t\tthis.popup.show();\n\t}\n\n\tclose()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t}\n\t}\n}\n","import {Dom, Type} from 'main.core'\nimport {Popup} from 'main.popup'\n\nexport class WebScreenSharePopup\n{\n\tconstructor(options)\n\t{\n\t\tthis.popup = null;\n\t\tthis.options = options || {};\n\n\t\tthis.callbacks = {\n\t\t\tonClose: Type.isFunction(this.options.onClose) ? this.options.onClose : BX.DoNothing,\n\t\t\tonStopSharingClick: Type.isFunction(this.options.onStopSharingClick) ? this.options.onStopSharingClick : BX.DoNothing,\n\t\t}\n\t};\n\n\tshow()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.show();\n\t\t\treturn;\n\t\t}\n\n\t\tvar popupWidth = 400;\n\n\t\tthis.popup = new Popup({\n\t\t\tbindElement: this.options.bindElement,\n\t\t\ttargetContainer: this.options.targetContainer,\n\t\t\tcontent: this.render(),\n\t\t\tpadding: 0,\n\t\t\tcontentPadding: 0,\n\t\t\theight: 38,\n\t\t\twidth: popupWidth,\n\t\t\toffsetTop: -135,\n\t\t\toffsetLeft: (this.options.bindElement.offsetWidth / 2) - (popupWidth / 2) + (this.options.bindElement.offsetWidth / 2),\n\t\t\tclassName: 'bx-call-view-popup-web-screenshare',\n\t\t\tcontentBackground: 'unset',\n\t\t\tangle: false,\n\t\t\tcacheable: false,\n\t\t\tevents: {\n\t\t\t\tonDestroy: () => this.popup = null\n\t\t\t}\n\t\t});\n\n\t\tthis.popup.show();\n\t}\n\n\trender()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-call-view-popup-web-screenshare-body\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-popup-web-screenshare-left\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-popup-web-screenshare-icon-screen\"},\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-popup-web-screenshare-text\"},\n\t\t\t\t\t\t\ttext: BX.message(\"IM_CALL_WEB_SCREENSHARE_STATUS\")\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-popup-web-screenshare-right\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-popup-web-screenshare-stop ui-btn ui-btn-primary ui-btn-xs ui-btn-round ui-btn-no-caps ui-btn-icon-stop\"},\n\t\t\t\t\t\t\ttext: BX.message(\"IM_CALL_WEB_SCREENSHARE_STOP\"),\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: () => this.callbacks.onStopSharingClick()\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-popup-web-screenshare-close\"},\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: () =>\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t\t\t\t\tthis.callbacks.onClose();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t]\n\t\t})\n\t}\n\n\tclose()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t}\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.destroy();\n\t\t}\n\t}\n}","import {Type} from 'main.core';\n\nimport {AbstractCall} from './abstract_call';\nimport {\n\tCallEngine,\n\tEndpointDirection,\n\tUserState,\n\tQuality,\n\tUserMnemonic,\n\tCallEvent,\n\tCallState,\n\tCallType,\n\tProvider\n} from './engine';\nimport {SimpleVAD} from './simple_vad'\nimport {Hardware} from '../call_hardware';\nimport Util from '../util'\n\n/**\n * Implements Call interface\n * Public methods:\n * - inviteUsers\n * - cancel\n * - answer\n * - decline\n * - hangup\n *\n * Events:\n * - onCallStateChanged //not sure about this.\n * - onUserStateChanged\n * - onStreamReceived\n * - onStreamRemoved\n * - onDestroy\n */\n\nconst ajaxActions = {\n\tinvite: 'im.call.invite',\n\tcancel: 'im.call.cancel',\n\tanswer: 'im.call.answer',\n\tdecline: 'im.call.decline',\n\thangup: 'im.call.hangup',\n\tping: 'im.call.ping'\n};\n\nconst pullEvents = {\n\tping: 'Call::ping',\n\tanswer: 'Call::answer',\n\thangup: 'Call::hangup',\n\tuserInviteTimeout: 'Call::userInviteTimeout',\n\trepeatAnswer: 'Call::repeatAnswer',\n};\n\nconst clientEvents = {\n\tvoiceStarted: 'Call::voiceStarted',\n\tvoiceStopped: 'Call::voiceStopped',\n\tmicrophoneState: 'Call::microphoneState',\n\tcameraState: 'Call::cameraState',\n\tvideoPaused: 'Call::videoPaused',\n\tscreenState: 'Call::screenState',\n\trecordState: 'Call::recordState',\n\tfloorRequest: 'Call::floorRequest',\n\temotion: 'Call::emotion',\n\tcustomMessage: 'Call::customMessage',\n\tshowUsers: 'Call::showUsers',\n\tshowAll: 'Call::showAll',\n\thideAll: 'Call::hideAll',\n\n\tjoinRoom: 'Call::joinRoom',\n\tleaveRoom: 'Call::leaveRoom',\n\tlistRooms: 'Call::listRooms',\n\trequestRoomSpeaker: 'Call::requestRoomSpeaker',\n};\n\nconst scenarioEvents = {\n\tviewerJoined: 'Call::viewerJoined',\n\tviewerLeft: 'Call::viewerLeft',\n\n\tjoinRoomOffer: 'Call::joinRoomOffer',\n\ttransferRoomHost: 'Call::transferRoomHost',\n\tlistRoomsResponse: 'Call::listRoomsResponse',\n\troomUpdated: 'Call::roomUpdated',\n};\n\nconst VoximplantCallEvent = {\n\tonCallConference: 'VoximplantCall::onCallConference'\n};\n\nconst pingPeriod = 5000;\nconst backendPingPeriod = 25000;\nconst reinvitePeriod = 5500;\nconst connectionRestoreTime = 15000;\n\n// const MAX_USERS_WITHOUT_SIMULCAST = 6;\n\nexport class VoximplantCall extends AbstractCall\n{\n\tstatic Event = VoximplantCallEvent\n\tpeers: { [key: number]: Peer }\n\tlocalVAD: ?SimpleVAD\n\n\tconstructor(config)\n\t{\n\t\tsuper(config);\n\n\t\tthis.debug = config.debug;\n\n\t\tthis.videoQuality = Quality.VeryHigh; // initial video quality. will drop on new peers connecting\n\n\t\tthis.voximplantCall = null;\n\n\t\tthis.signaling = new Signaling({\n\t\t\tcall: this\n\t\t});\n\n\t\tthis.peers = {};\n\t\tthis.joinedElsewhere = false;\n\t\tthis.joinedAsViewer = false;\n\t\tthis.localVideoShown = false;\n\t\tthis._localUserState = UserState.Idle;\n\t\tthis.clientEventsBound = false;\n\t\tthis._screenShared = false;\n\t\tthis.videoAllowedFrom = UserMnemonic.all;\n\t\tthis.direction = EndpointDirection.SendRecv;\n\n\t\tthis.microphoneLevelInterval = null;\n\n\t\tthis.rooms = {};\n\n\t\twindow.addEventListener(\"unload\", this.#onWindowUnload);\n\n\t\tthis.initPeers();\n\n\t\tthis.pingUsersInterval = setInterval(this.pingUsers.bind(this), pingPeriod);\n\t\tthis.pingBackendInterval = setInterval(this.pingBackend.bind(this), backendPingPeriod);\n\n\t\tthis.lastPingReceivedTimeout = null;\n\t\tthis.lastSelfPingReceivedTimeout = null;\n\n\t\tthis.reinviteTimeout = null;\n\n\t\t// There are two kinds of reconnection events: from call (for media connection) and from client (for signaling).\n\t\t// So we have to use counter to convert these two events to one\n\t\tthis._reconnectionEventCount = 0;\n\n\t\tthis.pullEventHandlers = {\n\t\t\t'Call::answer': this.#onPullEventAnswer,\n\t\t\t'Call::hangup': this.#onPullEventHangup,\n\t\t\t'Call::usersJoined': this.#onPullEventUsersJoined,\n\t\t\t'Call::usersInvited': this.#onPullEventUsersInvited,\n\t\t\t'Call::userInviteTimeout': this.#onPullEventUserInviteTimeout,\n\t\t\t'Call::ping': this.#onPullEventPing,\n\t\t\t'Call::finish': this.#onPullEventFinish,\n\t\t\t'Call::repeatAnswer': this.#onPullEventRepeatAnswer,\n\t\t}\n\t};\n\n\tget provider()\n\t{\n\t\treturn Provider.Voximplant;\n\t}\n\n\tget screenShared()\n\t{\n\t\treturn this._screenShared;\n\t}\n\n\tset screenShared(screenShared)\n\t{\n\t\tif (screenShared != this._screenShared)\n\t\t{\n\t\t\tthis._screenShared = screenShared;\n\t\t\tthis.signaling.sendScreenState(this._screenShared);\n\t\t}\n\t}\n\n\tget localUserState()\n\t{\n\t\treturn this._localUserState\n\t}\n\n\tset localUserState(state)\n\t{\n\t\tif (state == this._localUserState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.runCallback(CallEvent.onUserStateChanged, {\n\t\t\tuserId: this.userId,\n\t\t\tstate: state,\n\t\t\tpreviousState: this._localUserState,\n\t\t\tdirection: this.direction,\n\t\t});\n\t\tthis._localUserState = state;\n\t}\n\n\tget reconnectionEventCount()\n\t{\n\t\treturn this._reconnectionEventCount;\n\t}\n\n\tset reconnectionEventCount(newValue)\n\t{\n\t\tif (this._reconnectionEventCount === 0 && newValue > 0)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onReconnecting);\n\t\t}\n\t\tif (newValue === 0)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onReconnected);\n\t\t}\n\t\tthis._reconnectionEventCount = newValue;\n\t}\n\n\tinitPeers()\n\t{\n\t\tthis.users.forEach((userId) =>\n\t\t{\n\t\t\tuserId = Number(userId);\n\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t});\n\t};\n\n\treinitPeers()\n\t{\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers.hasOwnProperty(userId) && this.peers[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId].destroy();\n\t\t\t\tthis.peers[userId] = null;\n\t\t\t}\n\t\t}\n\n\t\tthis.initPeers();\n\t};\n\n\tpingUsers()\n\t{\n\t\tif (this.ready)\n\t\t{\n\t\t\tconst users = this.users.concat(this.userId);\n\t\t\tthis.signaling.sendPingToUsers({userId: users}, true);\n\t\t}\n\t};\n\n\tpingBackend()\n\t{\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.signaling.sendPingToBackend();\n\t\t}\n\t};\n\n\tcreatePeer(userId)\n\t{\n\t\tlet incomingVideoAllowed;\n\t\tif (this.videoAllowedFrom === UserMnemonic.all)\n\t\t{\n\t\t\tincomingVideoAllowed = true;\n\t\t}\n\t\telse if (this.videoAllowedFrom === UserMnemonic.none)\n\t\t{\n\t\t\tincomingVideoAllowed = false;\n\t\t}\n\t\telse if (Type.isArray(this.videoAllowedFrom))\n\t\t{\n\t\t\tincomingVideoAllowed = this.videoAllowedFrom.some(allowedUserId => allowedUserId == userId);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tincomingVideoAllowed = true;\n\t\t}\n\n\t\treturn new Peer({\n\t\t\tcall: this,\n\t\t\tuserId: userId,\n\t\t\tready: userId == this.initiatorId,\n\t\t\tisIncomingVideoAllowed: incomingVideoAllowed,\n\n\t\t\tonMediaReceived: (e) =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onRemoteMediaReceived, e);\n\t\t\t\tif (e.kind === 'video')\n\t\t\t\t{\n\t\t\t\t\tthis.runCallback(CallEvent.onUserVideoPaused, {\n\t\t\t\t\t\tuserId: userId,\n\t\t\t\t\t\tvideoPaused: false\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\tonMediaRemoved: (e) =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onRemoteMediaStopped, e);\n\t\t\t},\n\t\t\tonMediaRenderEnabled: (e) =>\n\t\t\t{\n\t\t\t\tconst endpoint = e.endpoint;\n\t\t\t\tconst userName = endpoint.userName;\n\t\t\t\t// user connected to conference (userName is in format `user${id}`\n\t\t\t\tconst userId = parseInt(userName.substring(4));\n\t\t\t\tif (this.peers[userId])\n\t\t\t\t{\n\t\t\t\t\tthis.runCallback(CallEvent.onBadNetworkIndicator, {\n\t\t\t\t\t\tuserId: userId,\n\t\t\t\t\t\tbadNetworkIndicator: false\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\tonMediaRenderDisabled: (e) =>\n\t\t\t{\n\t\t\t\tconst endpoint = e.endpoint;\n\t\t\t\tconst userName = endpoint.userName;\n\t\t\t\tif (Type.isStringFilled(userName) && userName.startsWith('user'))\n\t\t\t\t{\n\t\t\t\t\tconst userId = parseInt(userName.substring(4));\n\t\t\t\t\tif (this.peers[userId] && e.reason === 'disabledByServer')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.runCallback(CallEvent.onBadNetworkIndicator, {\n\t\t\t\t\t\t\tuserId: userId,\n\t\t\t\t\t\t\tbadNetworkIndicator: true\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tonVoiceStarted: () =>\n\t\t\t{\n\t\t\t\t// todo: uncomment to switch to SDK VAD events\n\t\t\t\t/*this.runCallback(Event.onUserVoiceStarted, {\n\t\t\t\t\tuserId: userId\n\t\t\t\t});*/\n\t\t\t},\n\t\t\tonVoiceEnded: () =>\n\t\t\t{\n\t\t\t\t// todo: uncomment to switch to SDK VAD events\n\t\t\t\t/*this.runCallback(Event.onUserVoiceStopped, {\n\t\t\t\t\tuserId: userId\n\t\t\t\t});*/\n\t\t\t},\n\t\t\tonStateChanged: this.#onPeerStateChanged,\n\t\t\tonInviteTimeout: this.#onPeerInviteTimeout,\n\n\t\t})\n\t};\n\n\tgetUsers()\n\t{\n\t\tlet result = {};\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tresult[userId] = this.peers[userId].calculatedState;\n\t\t}\n\t\treturn result;\n\t};\n\n\tgetUserCount()\n\t{\n\t\treturn Object.keys(this.peers).length;\n\t};\n\n\tgetClient()\n\t{\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tBX.Voximplant.getClient({\n\t\t\t\tdebug: this.debug,\n\t\t\t\trestClient: CallEngine.getRestClient(),\n\t\t\t}).then((client) =>\n\t\t\t{\n\t\t\t\tclient.enableSilentLogging();\n\t\t\t\tclient.setLoggerCallback((e) => this.log(e.label + \": \" + e.message));\n\t\t\t\tthis.log(\"User agent: \" + navigator.userAgent);\n\t\t\t\tthis.log(\"Voximplant SDK version: \" + VoxImplant.version);\n\n\t\t\t\tthis.bindClientEvents();\n\n\t\t\t\tresolve(client);\n\t\t\t}).catch(reject);\n\t\t});\n\t};\n\n\tbindClientEvents()\n\t{\n\t\tconst streamManager = VoxImplant.Hardware.StreamManager.get();\n\n\t\tif (!this.clientEventsBound)\n\t\t{\n\t\t\tVoxImplant.getInstance().on(VoxImplant.Events.MicAccessResult, this.#onMicAccessResult);\n\t\t\tif (VoxImplant.Events.Reconnecting)\n\t\t\t{\n\t\t\t\tVoxImplant.getInstance().on(VoxImplant.Events.Reconnecting, this.#onClientReconnecting);\n\t\t\t\tVoxImplant.getInstance().on(VoxImplant.Events.Reconnected, this.#onClientReconnected);\n\t\t\t}\n\n\t\t\t// streamManager.on(VoxImplant.Hardware.HardwareEvents.DevicesUpdated, this.#onLocalDevicesUpdated);\n\t\t\tstreamManager.on(VoxImplant.Hardware.HardwareEvents.MediaRendererAdded, this.#onLocalMediaRendererAdded);\n\t\t\tstreamManager.on(VoxImplant.Hardware.HardwareEvents.MediaRendererUpdated, this.#onLocalMediaRendererAdded);\n\t\t\tstreamManager.on(VoxImplant.Hardware.HardwareEvents.BeforeMediaRendererRemoved, this.#onBeforeLocalMediaRendererRemoved);\n\t\t\tthis.clientEventsBound = true;\n\t\t}\n\t};\n\n\tremoveClientEvents()\n\t{\n\t\tif (!('VoxImplant' in window))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tVoxImplant.getInstance().off(VoxImplant.Events.MicAccessResult, this.#onMicAccessResult);\n\t\tif (VoxImplant.Events.Reconnecting)\n\t\t{\n\t\t\tVoxImplant.getInstance().off(VoxImplant.Events.Reconnecting, this.#onClientReconnecting);\n\t\t\tVoxImplant.getInstance().off(VoxImplant.Events.Reconnected, this.#onClientReconnected);\n\t\t}\n\n\t\tconst streamManager = VoxImplant.Hardware.StreamManager.get();\n\t\t// streamManager.off(VoxImplant.Hardware.HardwareEvents.DevicesUpdated, this.#onLocalDevicesUpdated);\n\t\tstreamManager.off(VoxImplant.Hardware.HardwareEvents.MediaRendererAdded, this.#onLocalMediaRendererAdded);\n\t\tstreamManager.off(VoxImplant.Hardware.HardwareEvents.BeforeMediaRendererRemoved, this.#onBeforeLocalMediaRendererRemoved);\n\t\tthis.clientEventsBound = false;\n\t};\n\n\tsetMuted = (event) =>\n\t{\n\t\tif (this.muted == event.data.isMicrophoneMuted)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.muted = event.data.isMicrophoneMuted;\n\n\t\tif (this.voximplantCall)\n\t\t{\n\t\t\tif (this.muted)\n\t\t\t{\n\t\t\t\tthis.voximplantCall.muteMicrophone();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.voximplantCall.unmuteMicrophone();\n\t\t\t}\n\t\t\tthis.signaling.sendMicrophoneState(!this.muted);\n\t\t}\n\t};\n\n\tsetVideoEnabled = (event) =>\n\t{\n\t\tif (this.videoEnabled == event.data.isCameraOn)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.videoEnabled = event.data.isCameraOn;\n\t\tif (this.voximplantCall)\n\t\t{\n\t\t\tif (this.videoEnabled)\n\t\t\t{\n\t\t\t\tthis.#showLocalVideo();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (this.localVideoShown)\n\t\t\t\t{\n\t\t\t\t\tVoxImplant.Hardware.StreamManager.get().hideLocalVideo().then(() =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.localVideoShown = false;\n\t\t\t\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\t\t\t\ttag: \"main\",\n\t\t\t\t\t\t\tstream: new MediaStream(),\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.voximplantCall.sendVideo(this.videoEnabled);\n\t\t\tthis.signaling.sendCameraState(this.videoEnabled);\n\t\t}\n\t};\n\n\tsetCameraId(cameraId)\n\t{\n\t\tif (this.cameraId == cameraId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.cameraId = cameraId;\n\n\t\tif (this.voximplantCall)\n\t\t{\n\t\t\tVoxImplant.Hardware.CameraManager.get().getInputDevices().then(() =>\n\t\t\t{\n\t\t\t\tVoxImplant.Hardware.CameraManager.get().setCallVideoSettings(this.voximplantCall, this.constructCameraParams());\n\t\t\t});\n\t\t}\n\t};\n\n\tsetMicrophoneId(microphoneId)\n\t{\n\t\tif (this.microphoneId == microphoneId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.microphoneId = microphoneId;\n\t\tif (this.voximplantCall)\n\t\t{\n\t\t\tVoxImplant.Hardware.AudioDeviceManager.get().getInputDevices().then(() =>\n\t\t\t{\n\t\t\t\tVoxImplant.Hardware.AudioDeviceManager.get().setCallAudioSettings(this.voximplantCall, {\n\t\t\t\t\tinputId: this.microphoneId\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t};\n\n\tgetCurrentMicrophoneId()\n\t{\n\t\tif (this.voximplantCall.peerConnection.impl.getTransceivers)\n\t\t{\n\t\t\tconst transceivers = this.voximplantCall.peerConnection.impl.getTransceivers();\n\t\t\tif (transceivers.length > 0)\n\t\t\t{\n\t\t\t\tconst audioTrack = transceivers[0].sender.track;\n\t\t\t\tconst audioTrackSettings = audioTrack.getSettings();\n\t\t\t\treturn audioTrackSettings.deviceId;\n\t\t\t}\n\t\t}\n\t\treturn this.microphoneId;\n\t};\n\n\tconstructCameraParams()\n\t{\n\t\tlet result = {};\n\n\t\tif (this.cameraId)\n\t\t{\n\t\t\tresult.cameraId = this.cameraId;\n\t\t}\n\n\t\tresult.videoQuality = this.videoHd ? VoxImplant.Hardware.VideoQuality.VIDEO_SIZE_HD : VoxImplant.Hardware.VideoQuality.VIDEO_SIZE_nHD;\n\t\tresult.facingMode = true;\n\t\treturn result;\n\t};\n\n\tuseHdVideo(flag)\n\t{\n\t\tthis.videoHd = (flag === true);\n\t};\n\n\trequestFloor(requestActive)\n\t{\n\t\tthis.signaling.sendFloorRequest(requestActive);\n\t};\n\n\tsendRecordState(recordState)\n\t{\n\t\tthis.signaling.sendRecordState(recordState);\n\t};\n\n\tsendEmotion(toUserId, emotion)\n\t{\n\t\tthis.signaling.sendEmotion(toUserId, emotion);\n\t};\n\n\tsendCustomMessage(message, repeatOnConnect)\n\t{\n\t\tthis.signaling.sendCustomMessage(message, repeatOnConnect);\n\t};\n\n\t/**\n\t * Updates list of users,\n\t */\n\tallowVideoFrom(userList: $Keys<typeof UserMnemonic> | number[])\n\t{\n\t\tif (this.videoAllowedFrom == userList)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.videoAllowedFrom = userList;\n\n\t\tif (userList === UserMnemonic.all)\n\t\t{\n\t\t\tthis.signaling.sendShowAll();\n\t\t\tuserList = Object.keys(this.peers);\n\t\t}\n\t\telse if (userList === UserMnemonic.none)\n\t\t{\n\t\t\tthis.signaling.sendHideAll();\n\t\t\tuserList = [];\n\t\t}\n\t\telse if (Type.isArray(userList))\n\t\t{\n\t\t\tthis.signaling.sendShowUsers(userList)\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthrow new Error(\"userList is in wrong format\");\n\t\t}\n\n\t\tlet users = {};\n\t\tuserList.forEach(userId => users[userId] = true);\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (!this.peers.hasOwnProperty(userId))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (users[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId].allowIncomingVideo(true);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.peers[userId].allowIncomingVideo(false);\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * Sets bitrate cap for outgoing video\n\t * @param bitrate\n\t * @deprecated\n\t */\n\n\t/*#setMaxBitrate(bitrate)\n\t{\n\t\tif (this.voximplantCall)\n\t\t{\n\t\t\tconst transceivers = this.voximplantCall.peerConnection.getTransceivers();\n\t\t\tif (!transceivers)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\ttransceivers.forEach((tr) =>\n\t\t\t{\n\t\t\t\tif (tr.sender && tr.sender.track && tr.sender.track.kind === 'video' && !tr.stoped && tr.currentDirection.indexOf('send') !== -1)\n\t\t\t\t{\n\t\t\t\t\tconst sender = tr.sender;\n\t\t\t\t\tconst parameters = sender.getParameters();\n\t\t\t\t\tif (!parameters.encodings)\n\t\t\t\t\t{\n\t\t\t\t\t\tparameters.encodings = [{}];\n\t\t\t\t\t}\n\t\t\t\t\tif (bitrate === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tdelete parameters.encodings[0].maxBitrate;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tparameters.encodings[0].maxBitrate = bitrate * 1000;\n\t\t\t\t\t}\n\t\t\t\t\tsender.setParameters(parameters);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t};*/\n\n\t#showLocalVideo()\n\t{\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tVoxImplant.Hardware.StreamManager.get().showLocalVideo(false).then(\n\t\t\t\t() =>\n\t\t\t\t{\n\t\t\t\t\tthis.localVideoShown = true;\n\t\t\t\t\tresolve();\n\t\t\t\t},\n\t\t\t\t() =>\n\t\t\t\t{\n\t\t\t\t\tthis.localVideoShown = true;\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t)\n\t\t})\n\t};\n\n\t#hideLocalVideo()\n\t{\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tif (!('VoxImplant' in window))\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tVoxImplant.Hardware.StreamManager.get().hideLocalVideo().then(\n\t\t\t\t() =>\n\t\t\t\t{\n\t\t\t\t\tthis.localVideoShown = false;\n\t\t\t\t\tresolve();\n\t\t\t\t},\n\t\t\t\t() =>\n\t\t\t\t{\n\t\t\t\t\tthis.localVideoShown = false;\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t);\n\t\t})\n\t};\n\n\tstartScreenSharing()\n\t{\n\t\tif (!this.voximplantCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst showLocalView = !Hardware.isCameraOn;\n\t\tconst replaceTrack = Hardware.isCameraOn || this.screenShared;\n\n\t\tthis.voximplantCall.shareScreen(showLocalView, replaceTrack)\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.log(\"Screen shared\");\n\t\t\t\tthis.screenShared = true;\n\t\t\t})\n\t\t\t.catch((error) =>\n\t\t\t{\n\t\t\t\tconsole.error(error);\n\t\t\t\tthis.log(\"Screen sharing error:\", error)\n\t\t\t})\n\t\t;\n\t};\n\n\tstopScreenSharing()\n\t{\n\t\tif (!this.voximplantCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.voximplantCall.stopSharingScreen()\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.log(\"Screen is no longer shared\");\n\t\t\t\tthis.screenShared = false;\n\t\t\t})\n\t\t;\n\t};\n\n\tisScreenSharingStarted()\n\t{\n\t\treturn this.screenShared;\n\t};\n\n\t/**\n\t * Invites users to participate in the call.\n\t */\n\tinviteUsers(config: { users: number[] } = {})\n\t{\n\t\tthis.ready = true;\n\t\tlet users = Type.isArray(config.users) ? config.users : this.users;\n\n\t\tthis.attachToConference()\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.signaling.sendPingToUsers({userId: users});\n\n\t\t\t\tif (users.length > 0)\n\t\t\t\t{\n\t\t\t\t\treturn this.signaling.inviteUsers({\n\t\t\t\t\t\tuserIds: users,\n\t\t\t\t\t\tvideo: Hardware.isCameraOn ? 'Y' : 'N'\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.state = CallState.Connected;\n\t\t\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\t\t\tlocal: true\n\t\t\t\t});\n\t\t\t\tfor (let i = 0; i < users.length; i++)\n\t\t\t\t{\n\t\t\t\t\tconst userId = parseInt(users[i]);\n\t\t\t\t\tif (!this.users.includes(userId))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.users.push(userId);\n\t\t\t\t\t}\n\t\t\t\t\tif (!this.peers[userId])\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.peers[userId] = this.createPeer(userId);\n\n\t\t\t\t\t\tif (this.type === CallType.Instant)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.runCallback(CallEvent.onUserInvited, {\n\t\t\t\t\t\t\t\tuserId: userId\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (this.type === CallType.Instant)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.peers[userId].onInvited();\n\t\t\t\t\t\tthis.scheduleRepeatInvite();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((e) =>\n\t\t\t{\n\t\t\t\tthis.#onFatalError(e)\n\t\t\t})\n\t\t;\n\t};\n\n\tscheduleRepeatInvite()\n\t{\n\t\tclearTimeout(this.reinviteTimeout);\n\t\tthis.reinviteTimeout = setTimeout(() => this.repeatInviteUsers(), reinvitePeriod)\n\t};\n\n\trepeatInviteUsers()\n\t{\n\t\tclearTimeout(this.reinviteTimeout);\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet usersToRepeatInvite = [];\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers.hasOwnProperty(userId) && this.peers[userId].calculatedState === UserState.Calling)\n\t\t\t{\n\t\t\t\tusersToRepeatInvite.push(userId);\n\t\t\t}\n\t\t}\n\n\t\tif (usersToRepeatInvite.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst inviteParams = {\n\t\t\tuserIds: usersToRepeatInvite,\n\t\t\tvideo: Hardware.isCameraOn ? 'Y' : 'N',\n\t\t\trepeated: 'Y',\n\t\t}\n\t\tthis.signaling.inviteUsers(inviteParams).then(() => this.scheduleRepeatInvite());\n\t};\n\n\t/**\n\t * @param {Object} config\n\t * @param {bool?} [config.useVideo]\n\t * @param {bool?} [config.joinAsViewer]\n\t */\n\tanswer(config = {})\n\t{\n\t\tthis.ready = true;\n\t\tconst joinAsViewer = config.joinAsViewer === true;\n\t\tthis.videoEnabled = Hardware.isCameraOn;\n\t\tthis.muted = Hardware.isMicrophoneMuted;\n\n\t\tif (!joinAsViewer)\n\t\t{\n\t\t\tthis.signaling.sendAnswer();\n\t\t}\n\t\tthis.attachToConference({joinAsViewer: joinAsViewer})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.log(\"Attached to conference\");\n\t\t\t\tthis.state = CallState.Connected;\n\t\t\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\t\t\tlocal: true\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch((err) =>\n\t\t\t{\n\t\t\t\tthis.#onFatalError(err);\n\t\t\t})\n\t\t;\n\t};\n\n\tdecline(code)\n\t{\n\t\tthis.ready = false;\n\t\tconst data = {\n\t\t\tcallId: this.id,\n\t\t\tcallInstanceId: this.instanceId,\n\t\t};\n\t\tif (code)\n\t\t{\n\t\t\tdata.code = code\n\t\t}\n\n\t\tCallEngine.getRestClient().callMethod(ajaxActions.decline, data);\n\t};\n\n\thangup(code, reason)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\tconst error = new Error(\"Hangup in wrong state\");\n\t\t\tthis.log(error);\n\t\t\treturn;\n\t\t}\n\n\t\tconst tempError = new Error();\n\t\ttempError.name = \"Call stack:\";\n\t\tthis.log(\"Hangup received \\n\" + tempError.stack);\n\n\t\tif (this.localVAD)\n\t\t{\n\t\t\tthis.localVAD.destroy();\n\t\t\tthis.localVAD = null;\n\t\t}\n\t\tclearInterval(this.microphoneLevelInterval);\n\n\t\tlet data = {};\n\t\tthis.ready = false;\n\t\tif (typeof (code) != 'undefined')\n\t\t{\n\t\t\tdata.code = code;\n\t\t}\n\t\tif (typeof (reason) != 'undefined')\n\t\t{\n\t\t\tdata.reason = reason;\n\t\t}\n\t\tthis.state = CallState.Proceeding;\n\t\tthis.runCallback(CallEvent.onLeave, {local: true});\n\n\t\t//clone users and append current user id to send event to all participants of the call\n\t\tdata.userId = this.users.slice(0).concat(this.userId);\n\t\tthis.signaling.sendHangup(data);\n\n\t\t// for future reconnections\n\t\tthis.reinitPeers();\n\n\t\tif (this.voximplantCall)\n\t\t{\n\t\t\tthis.voximplantCall._replaceVideoSharing = false;\n\t\t\ttry\n\t\t\t{\n\t\t\t\tthis.voximplantCall.hangup();\n\t\t\t} catch (e)\n\t\t\t{\n\t\t\t\tthis.log(\"Voximplant hangup error: \", e);\n\t\t\t\tconsole.error(\"Voximplant hangup error: \", e);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.log(\"Tried to hangup, but this.voximplantCall points nowhere\");\n\t\t\tconsole.error(\"Tried to hangup, but this.voximplantCall points nowhere\");\n\t\t}\n\n\t\tthis.screenShared = false;\n\t\tthis.#hideLocalVideo();\n\t};\n\n\tattachToConference(options: { joinAsViewer: ?boolean } = {})\n\t{\n\t\tconst joinAsViewer = options.joinAsViewer === true;\n\t\tif (this.voximplantCall && this.voximplantCall.state() === \"CONNECTED\")\n\t\t{\n\t\t\tif (this.joinedAsViewer === joinAsViewer)\n\t\t\t{\n\t\t\t\treturn Promise.resolve();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn Promise.reject(\"Already joined call in another mode\");\n\t\t\t}\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tthis.direction = joinAsViewer ? EndpointDirection.RecvOnly : EndpointDirection.SendRecv;\n\t\t\tthis.sendTelemetryEvent(\"call\");\n\n\t\t\tthis.getClient().then((voximplantClient) =>\n\t\t\t{\n\t\t\t\tthis.localUserState = UserState.Connecting;\n\n\t\t\t\t// workaround to set default video settings before starting call. ugly, but I do not see another way\n\t\t\t\tVoxImplant.Hardware.CameraManager.get().setDefaultVideoSettings(this.constructCameraParams());\n\t\t\t\tif (this.microphoneId)\n\t\t\t\t{\n\t\t\t\t\tVoxImplant.Hardware.AudioDeviceManager.get().setDefaultAudioSettings({\n\t\t\t\t\t\tinputId: this.microphoneId\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (Hardware.isCameraOn)\n\t\t\t\t{\n\t\t\t\t\tthis.#showLocalVideo();\n\t\t\t\t}\n\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tif (!this.ready)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.log(\"Error: trying to attach after hangup\");\n\t\t\t\t\t\treturn reject({code: \"VOX_NO_CALL\"});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (joinAsViewer)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.voximplantCall = voximplantClient.joinAsViewer(\"bx_conf_\" + this.id, {\n\t\t\t\t\t\t\t'X-Direction': EndpointDirection.RecvOnly\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.voximplantCall = voximplantClient.callConference({\n\t\t\t\t\t\t\tnumber: \"bx_conf_\" + this.id,\n\t\t\t\t\t\t\tvideo: {sendVideo: Hardware.isCameraOn, receiveVideo: true},\n\t\t\t\t\t\t\t// simulcast: (this.getUserCount() > MAX_USERS_WITHOUT_SIMULCAST),\n\t\t\t\t\t\t\t// simulcastProfileName: 'b24',\n\t\t\t\t\t\t\tcustomData: JSON.stringify({\n\t\t\t\t\t\t\t\tcameraState: Hardware.isCameraOn,\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} catch (e)\n\t\t\t\t{\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t\treturn reject(e);\n\t\t\t\t}\n\t\t\t\tthis.joinedAsViewer = joinAsViewer;\n\n\t\t\t\tif (!this.voximplantCall)\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"Error: could not create voximplant call\");\n\t\t\t\t\treturn reject({code: \"VOX_NO_CALL\"});\n\t\t\t\t}\n\n\t\t\t\tthis.runCallback(VoximplantCallEvent.onCallConference, {\n\t\t\t\t\tcall: this\n\t\t\t\t});\n\n\t\t\t\tthis.bindCallEvents();\n\t\t\t\tthis.subscribeHardwareChanges();\n\n\t\t\t\tthis.voximplantCall.on(\n\t\t\t\t\tVoxImplant.CallEvents.Connected,\n\t\t\t\t\t() =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#onCallConnected();\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t},\n\t\t\t\t\t{once: true});\n\t\t\t\tthis.voximplantCall.on(\n\t\t\t\t\tVoxImplant.CallEvents.Failed,\n\t\t\t\t\t(e) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#onCallFailed(e);\n\t\t\t\t\t\treject(e);\n\t\t\t\t\t},\n\t\t\t\t\t{once: true}\n\t\t\t\t);\n\t\t\t}).catch(this.#onFatalError.bind(this));\n\t\t});\n\t};\n\n\t#onCallConnected()\n\t{\n\t\tthis.log(\"Call connected\");\n\t\tthis.sendTelemetryEvent(\"connect\");\n\t\tthis.localUserState = UserState.Connected;\n\n\t\tthis.voximplantCall.on(VoxImplant.CallEvents.Failed, this.#onCallDisconnected);\n\n\t\tif (Hardware.isMicrophoneMuted)\n\t\t{\n\t\t\tthis.voximplantCall.muteMicrophone();\n\t\t}\n\n\t\tthis.signaling.sendMicrophoneState(!Hardware.isMicrophoneMuted);\n\t\tthis.signaling.sendCameraState(Hardware.isCameraOn);\n\n\t\tif (this.videoAllowedFrom == UserMnemonic.none)\n\t\t{\n\t\t\tthis.signaling.sendHideAll();\n\t\t}\n\t\telse if (Type.isArray(this.videoAllowedFrom))\n\t\t{\n\t\t\tthis.signaling.sendShowUsers(this.videoAllowedFrom);\n\t\t}\n\t};\n\n\t#onCallFailed(e)\n\t{\n\t\tthis.log(\"Could not attach to conference\", e);\n\t\tthis.sendTelemetryEvent(\"connect_failure\");\n\t\tthis.localUserState = UserState.Failed;\n\n\t\tconst client = VoxImplant.getInstance();\n\t\tclient.enableSilentLogging(false);\n\t\tclient.setLoggerCallback(null);\n\t};\n\n\tbindCallEvents()\n\t{\n\t\tthis.voximplantCall.on(VoxImplant.CallEvents.Disconnected, this.#onCallDisconnected);\n\t\tthis.voximplantCall.on(VoxImplant.CallEvents.MessageReceived, this.#onCallMessageReceived);\n\t\tif (Util.shouldCollectStats())\n\t\t{\n\t\t\tthis.voximplantCall.on(VoxImplant.CallEvents.CallStatsReceived, this.#onCallStatsReceived);\n\t\t}\n\n\t\tthis.voximplantCall.on(VoxImplant.CallEvents.EndpointAdded, this.#onCallEndpointAdded);\n\t\tif (VoxImplant.CallEvents.Reconnecting)\n\t\t{\n\t\t\tthis.voximplantCall.on(VoxImplant.CallEvents.Reconnecting, this.#onCallReconnecting);\n\t\t\tthis.voximplantCall.on(VoxImplant.CallEvents.Reconnected, this.#onCallReconnected);\n\t\t}\n\t};\n\n\tremoveCallEvents()\n\t{\n\t\tif (this.voximplantCall)\n\t\t{\n\t\t\tthis.voximplantCall.removeEventListener(VoxImplant.CallEvents.Disconnected, this.#onCallDisconnected);\n\t\t\tthis.voximplantCall.removeEventListener(VoxImplant.CallEvents.MessageReceived, this.#onCallMessageReceived);\n\t\t\tif (Util.shouldCollectStats())\n\t\t\t{\n\t\t\t\tthis.voximplantCall.removeEventListener(VoxImplant.CallEvents.CallStatsReceived, this.#onCallStatsReceived);\n\t\t\t}\n\t\t\tthis.voximplantCall.removeEventListener(VoxImplant.CallEvents.EndpointAdded, this.#onCallEndpointAdded);\n\t\t\tif (VoxImplant.CallEvents.Reconnecting)\n\t\t\t{\n\t\t\t\tthis.voximplantCall.removeEventListener(VoxImplant.CallEvents.Reconnecting, this.#onCallReconnecting);\n\t\t\t\tthis.voximplantCall.removeEventListener(VoxImplant.CallEvents.Reconnected, this.#onCallReconnected);\n\t\t\t}\n\t\t}\n\t};\n\n\tsubscribeHardwareChanges()\n\t{\n\t\tHardware.subscribe(Hardware.Events.onChangeMicrophoneMuted, this.setMuted);\n\t\tHardware.subscribe(Hardware.Events.onChangeCameraOn, this.setVideoEnabled);\n\t};\n\n\tunsubscribeHardwareChanges()\n\t{\n\t\tHardware.unsubscribe(Hardware.Events.onChangeMicrophoneMuted, this.setMuted);\n\t\tHardware.unsubscribe(Hardware.Events.onChangeCameraOn, this.setVideoEnabled);\n\t};\n\n\t/**\n\t * Adds new users to call\n\t * @param {Number[]} users\n\t */\n\taddJoinedUsers(users)\n\t{\n\t\tfor (let i = 0; i < users.length; i++)\n\t\t{\n\t\t\tconst userId = Number(users[i]);\n\t\t\tif (userId == this.userId || this.peers[userId])\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t\tif (!this.users.includes(userId))\n\t\t\t{\n\t\t\t\tthis.users.push(userId);\n\t\t\t}\n\t\t\tthis.runCallback(CallEvent.onUserInvited, {\n\t\t\t\tuserId: userId\n\t\t\t});\n\t\t}\n\t};\n\n\t/**\n\t * Adds users, invited by you or someone else\n\t * @param {Number[]} users\n\t */\n\taddInvitedUsers(users)\n\t{\n\t\tfor (let i = 0; i < users.length; i++)\n\t\t{\n\t\t\tconst userId = Number(users[i]);\n\t\t\tif (userId == this.userId)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (this.peers[userId])\n\t\t\t{\n\t\t\t\tif (this.peers[userId].calculatedState === UserState.Failed || this.peers[userId].calculatedState === UserState.Idle)\n\t\t\t\t{\n\t\t\t\t\tif (this.type === CallType.Instant)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.peers[userId].onInvited();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t\t\tif (this.type === CallType.Instant)\n\t\t\t\t{\n\t\t\t\t\tthis.peers[userId].onInvited();\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!this.users.includes(userId))\n\t\t\t{\n\t\t\t\tthis.users.push(userId);\n\t\t\t}\n\t\t\tthis.runCallback(CallEvent.onUserInvited, {\n\t\t\t\tuserId: userId\n\t\t\t});\n\t\t}\n\t};\n\n\tisAnyoneParticipating()\n\t{\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId].isParticipating())\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t};\n\n\tgetParticipatingUsers()\n\t{\n\t\tlet result = [];\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId].isParticipating())\n\t\t\t{\n\t\t\t\tresult.push(userId);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t};\n\n\tupdateRoom(roomData)\n\t{\n\t\tif (!this.rooms[roomData.id])\n\t\t{\n\t\t\tthis.rooms[roomData.id] = {\n\t\t\t\tid: roomData.id,\n\t\t\t\tusers: roomData.users,\n\t\t\t\tspeaker: roomData.speaker\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.rooms[roomData.id].users = roomData.users;\n\t\t\tthis.rooms[roomData.id].speaker = roomData.speaker;\n\t\t}\n\t}\n\n\tcurrentRoom()\n\t{\n\t\treturn this._currentRoomId ? this.rooms[this._currentRoomId] : null;\n\t}\n\n\tisRoomSpeaker()\n\t{\n\t\treturn this.currentRoom() ? this.currentRoom().speaker == this.userId : false;\n\t}\n\n\tjoinRoom(roomId)\n\t{\n\t\tthis.signaling.sendJoinRoom(roomId);\n\t}\n\n\trequestRoomSpeaker()\n\t{\n\t\tthis.signaling.sendRequestRoomSpeaker(this._currentRoomId);\n\t}\n\n\tleaveCurrentRoom()\n\t{\n\t\tthis.signaling.sendLeaveRoom(this._currentRoomId);\n\t}\n\n\tlistRooms()\n\t{\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tthis.signaling.sendListRooms();\n\t\t\tthis.__resolveListRooms = resolve;\n\t\t});\n\t}\n\n\t#onPeerStateChanged = (e) =>\n\t{\n\t\tthis.runCallback(CallEvent.onUserStateChanged, e);\n\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (e.state == UserState.Failed || e.state == UserState.Unavailable || e.state == UserState.Declined || e.state == UserState.Idle)\n\t\t{\n\t\t\tif (this.type == CallType.Instant && !this.isAnyoneParticipating())\n\t\t\t{\n\t\t\t\tthis.hangup();\n\t\t\t}\n\t\t}\n\t};\n\n\t#onPeerInviteTimeout = (e) =>\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.signaling.sendUserInviteTimeout({\n\t\t\tuserId: this.users,\n\t\t\tfailedUserId: e.userId\n\t\t})\n\t};\n\n\t__onPullEvent(command, params, extra)\n\t{\n\t\tif (this.pullEventHandlers[command])\n\t\t{\n\t\t\tif (command != 'Call::ping')\n\t\t\t{\n\t\t\t\tthis.log(\"Signaling: \" + command + \"; Parameters: \" + JSON.stringify(params));\n\t\t\t}\n\t\t\tthis.pullEventHandlers[command].call(this, params);\n\t\t}\n\t};\n\n\t#onPullEventAnswer = (params) =>\n\t{\n\t\tconst senderId = Number(params.senderId);\n\n\t\tif (senderId == this.userId)\n\t\t{\n\t\t\treturn this.__onPullEventAnswerSelf(params);\n\t\t}\n\n\t\tif (!this.peers[senderId])\n\t\t{\n\t\t\tthis.peers[senderId] = this.createPeer(senderId);\n\t\t\tthis.runCallback(CallEvent.onUserInvited, {\n\t\t\t\tuserId: senderId\n\t\t\t});\n\t\t}\n\n\t\tif (!this.users.includes(senderId))\n\t\t{\n\t\t\tthis.users.push(senderId);\n\t\t}\n\n\t\tthis.peers[senderId].setReady(true);\n\t};\n\n\t__onPullEventAnswerSelf(params)\n\t{\n\t\tif (params.callInstanceId === this.instanceId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// call was answered elsewhere\n\t\tthis.joinedElsewhere = true;\n\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\tlocal: false\n\t\t});\n\t};\n\n\t#onPullEventHangup = (params) =>\n\t{\n\t\tconst senderId = params.senderId;\n\t\tif (this.userId == senderId && this.instanceId != params.callInstanceId)\n\t\t{\n\t\t\t// Call declined by the same user elsewhere\n\t\t\tthis.runCallback(CallEvent.onLeave, {local: false});\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.peers[senderId])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.peers[senderId].setReady(false);\n\n\t\tif (params.code == 603)\n\t\t{\n\t\t\tthis.peers[senderId].setDeclined(true);\n\t\t}\n\t\telse if (params.code == 486)\n\t\t{\n\t\t\tthis.peers[senderId].setBusy(true);\n\t\t\tconsole.error(\"user \" + senderId + \" is busy\");\n\t\t}\n\n\t\tif (this.ready && this.type == CallType.Instant && !this.isAnyoneParticipating())\n\t\t{\n\t\t\tthis.hangup();\n\t\t}\n\t};\n\n\t#onPullEventUsersJoined = (params) =>\n\t{\n\t\tthis.log('__onPullEventUsersJoined', params);\n\t\tconst users = params.users;\n\n\t\tthis.addJoinedUsers(users);\n\t};\n\n\t#onPullEventUsersInvited = (params) =>\n\t{\n\t\tthis.log('__onPullEventUsersInvited', params);\n\t\tconst users = params.users;\n\n\t\tif (this.type === CallType.Instant)\n\t\t{\n\t\t\tthis.addInvitedUsers(users);\n\t\t}\n\t};\n\n\t#onPullEventUserInviteTimeout = (params) =>\n\t{\n\t\tthis.log('__onPullEventUserInviteTimeout', params);\n\t\tconst failedUserId = params.failedUserId;\n\n\t\tif (this.peers[failedUserId])\n\t\t{\n\t\t\tthis.peers[failedUserId].onInviteTimeout(false);\n\t\t}\n\t};\n\n\t#onPullEventPing = (params) =>\n\t{\n\t\tif (params.callInstanceId == this.instanceId)\n\t\t{\n\t\t\t// ignore self ping\n\t\t\treturn;\n\t\t}\n\n\t\tconst senderId = Number(params.senderId);\n\n\t\tif (senderId == this.userId)\n\t\t{\n\t\t\tif (!this.joinedElsewhere)\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\t\t\tlocal: false\n\t\t\t\t});\n\t\t\t\tthis.joinedElsewhere = true;\n\t\t\t}\n\t\t\tclearTimeout(this.lastSelfPingReceivedTimeout);\n\t\t\tthis.lastSelfPingReceivedTimeout = setTimeout(this.#onNoSelfPingsReceived, pingPeriod * 2.1);\n\t\t}\n\t\tclearTimeout(this.lastPingReceivedTimeout);\n\t\tthis.lastPingReceivedTimeout = setTimeout(this.#onNoPingsReceived, pingPeriod * 2.1);\n\t\tif (this.peers[senderId])\n\t\t{\n\t\t\tthis.peers[senderId].setReady(true);\n\t\t}\n\t};\n\n\t#onNoPingsReceived = () =>\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\tthis.destroy();\n\t\t}\n\t};\n\n\t#onNoSelfPingsReceived = () =>\n\t{\n\t\tthis.runCallback(CallEvent.onLeave, {\n\t\t\tlocal: false\n\t\t});\n\t\tthis.joinedElsewhere = false;\n\t};\n\n\t#onPullEventFinish = () =>\n\t{\n\t\tthis.destroy();\n\t};\n\n\t#onPullEventRepeatAnswer = () =>\n\t{\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.signaling.sendAnswer({userId: this.userId}, true);\n\t\t}\n\t}\n\n\t#onLocalMediaRendererAdded = (e) =>\n\t{\n\t\tconst renderer = e.renderer;\n\t\tconst trackLabel = renderer.stream.getVideoTracks().length > 0 ? renderer.stream.getVideoTracks()[0].label : \"\";\n\t\tthis.log(\"__onLocalMediaRendererAdded\", renderer.kind, trackLabel);\n\n\t\tif (renderer.kind === \"video\")\n\t\t{\n\t\t\tlet tag;\n\t\t\tif (trackLabel.match(/^screen|window|tab|web-contents-media-stream/i))\n\t\t\t{\n\t\t\t\ttag = \"screen\";\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\ttag = \"main\";\n\t\t\t}\n\n\t\t\tthis.screenShared = tag === \"screen\";\n\n\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\ttag: tag,\n\t\t\t\tstream: renderer.stream,\n\t\t\t});\n\t\t}\n\t\telse if (renderer.kind === \"sharing\")\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\ttag: \"screen\",\n\t\t\t\tstream: renderer.stream,\n\t\t\t});\n\t\t\tthis.screenShared = true;\n\t\t}\n\t};\n\n\t#onBeforeLocalMediaRendererRemoved = (e) =>\n\t{\n\t\tconst renderer = e.renderer;\n\t\tthis.log(\"__onBeforeLocalMediaRendererRemoved\", renderer.kind);\n\n\t\tif (renderer.kind === \"sharing\" && !Hardware.isCameraOn)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\ttag: \"main\",\n\t\t\t\tstream: new MediaStream(),\n\t\t\t});\n\t\t\tthis.screenShared = false;\n\t\t}\n\t};\n\n\t#onMicAccessResult = (e) =>\n\t{\n\t\tif (this.ready && e.result)\n\t\t{\n\t\t\tif (e.stream.getAudioTracks().length > 0)\n\t\t\t{\n\t\t\t\tif (this.localVAD)\n\t\t\t\t{\n\t\t\t\t\tthis.localVAD.destroy();\n\t\t\t\t}\n\t\t\t\tthis.localVAD = new SimpleVAD({\n\t\t\t\t\tmediaStream: e.stream,\n\t\t\t\t\tonVoiceStarted: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.runCallback(CallEvent.onUserVoiceStarted, {\n\t\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\t\tlocal: true\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tonVoiceStopped: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.runCallback(CallEvent.onUserVoiceStopped, {\n\t\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\t\tlocal: true\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tclearInterval(this.microphoneLevelInterval);\n\t\t\t\tthis.microphoneLevelInterval = setInterval(\n\t\t\t\t\t() =>this.microphoneLevel = this.localVAD.currentVolume,\n\t\t\t\t\t200\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t};\n\n\t#onCallReconnecting = () =>\n\t{\n\t\tthis.reconnectionEventCount++;\n\t}\n\n\t#onCallReconnected = () =>\n\t{\n\t\tthis.reconnectionEventCount--;\n\t}\n\n\t#onClientReconnecting = () =>\n\t{\n\t\tthis.reconnectionEventCount++;\n\t}\n\n\t#onClientReconnected = () =>\n\t{\n\t\tthis.reconnectionEventCount--;\n\t};\n\n\t#onCallDisconnected = (e) =>\n\t{\n\t\tthis.log(\"__onCallDisconnected\", (e && e.headers ? {headers: e.headers} : null));\n\t\tthis.sendTelemetryEvent(\"disconnect\");\n\t\tthis.localUserState = UserState.Idle;\n\n\t\tthis.ready = false;\n\t\tthis.joinedAsViewer = false;\n\t\tthis.reinitPeers();\n\n\t\tthis.#hideLocalVideo();\n\t\tthis.removeCallEvents();\n\t\tthis.unsubscribeHardwareChanges();\n\t\tthis.voximplantCall = null;\n\n\t\tconst client = VoxImplant.getInstance();\n\t\tclient.enableSilentLogging(false);\n\t\tclient.setLoggerCallback(null);\n\n\t\tthis.state = CallState.Proceeding;\n\t\tthis.runCallback(CallEvent.onLeave, {\n\t\t\tlocal: true\n\t\t});\n\t};\n\n\t#onWindowUnload = () =>\n\t{\n\t\tif (this.ready && this.voximplantCall)\n\t\t{\n\t\t\tthis.signaling.sendHangup({\n\t\t\t\tuserId: this.users\n\t\t\t});\n\t\t}\n\t};\n\n\t#onFatalError = (error) =>\n\t{\n\t\tif (error && error.call)\n\t\t{\n\t\t\tdelete error.call;\n\t\t}\n\t\tthis.log(\"onFatalError\", error);\n\n\t\tthis.ready = false;\n\t\tthis.localUserState = UserState.Failed;\n\t\tthis.reinitPeers();\n\n\t\tthis.#hideLocalVideo().then(() =>\n\t\t{\n\t\t\tif (this.voximplantCall)\n\t\t\t{\n\t\t\t\tthis.removeCallEvents();\n\t\t\t\tthis.unsubscribeHardwareChanges();\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tthis.voximplantCall.hangup({\n\t\t\t\t\t\t'X-Reason': 'Fatal error',\n\t\t\t\t\t\t'X-Error': typeof (error) === 'string' ? error : error.code || error.name\n\t\t\t\t\t})\n\t\t\t\t} catch (e)\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"Voximplant hangup error: \", e);\n\t\t\t\t\tconsole.error(\"Voximplant hangup error: \", e);\n\t\t\t\t}\n\t\t\t\tthis.voximplantCall = null;\n\t\t\t}\n\n\t\t\tif (typeof (VoxImplant) !== 'undefined')\n\t\t\t{\n\t\t\t\tconst client = VoxImplant.getInstance();\n\n\t\t\t\tclient.enableSilentLogging(false);\n\t\t\t\tclient.setLoggerCallback(null);\n\t\t\t}\n\n\t\t\tif (typeof (error) === \"string\")\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onCallFailure, {\n\t\t\t\t\tname: error\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (error.name)\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onCallFailure, error);\n\t\t\t}\n\t\t})\n\t};\n\n\t#setEndpointForUser(userName: string, endpoint)\n\t{\n\t\t// user connected to conference (userName is in format `user${id}`\n\t\tconst userId = parseInt(userName.substring(4));\n\t\tif (this.peers[userId])\n\t\t{\n\t\t\tthis.peers[userId].setEndpoint(endpoint);\n\t\t}\n\t\tthis.wasConnected = true;\n\t}\n\n\t#onCallEndpointAdded = (e) =>\n\t{\n\t\tconst endpoint = e.endpoint;\n\t\tconst userName = endpoint.userName;\n\t\tthis.log(\"__onCallEndpointAdded (\" + userName + \")\", e.endpoint);\n\t\tconsole.log(\"__onCallEndpointAdded (\" + userName + \")\", e.endpoint);\n\n\t\tif (Type.isStringFilled(userName) && userName.startsWith('user'))\n\t\t{\n\t\t\tthis.#setEndpointForUser(userName, endpoint)\n\t\t}\n\t\telse\n\t\t{\n\t\t\tendpoint.addEventListener(VoxImplant.EndpointEvents.InfoUpdated, (e) =>\n\t\t\t{\n\t\t\t\tconst endpoint = e.endpoint;\n\t\t\t\tconst userName = endpoint.userName;\n\t\t\t\tthis.log(\"VoxImplant.EndpointEvents.InfoUpdated (\" + userName + \")\", e.endpoint);\n\n\t\t\t\tif (Type.isStringFilled(userName) && userName.startsWith('user'))\n\t\t\t\t{\n\t\t\t\t\tthis.#setEndpointForUser(userName, endpoint)\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.log('Unknown endpoint ' + userName);\n\t\t\tconsole.warn('Unknown endpoint ' + userName);\n\t\t}\n\t};\n\n\t#onCallStatsReceived = (e) =>\n\t{\n\t\tif (this.logger)\n\t\t{\n\t\t\tthis.logger.sendStat(transformVoxStats(e.stats, this.voximplantCall));\n\t\t}\n\t}\n\n\t#onJoinRoomOffer = (e) =>\n\t{\n\t\tconsole.warn(\"__onJoinRoomOffer\", e)\n\t\tthis.updateRoom({\n\t\t\tid: e.roomId,\n\t\t\tusers: e.users,\n\t\t\tspeaker: e.speaker,\n\t\t});\n\t\tthis.runCallback(CallEvent.onJoinRoomOffer, {\n\t\t\troomId: e.roomId,\n\t\t\tusers: e.users,\n\t\t\tinitiator: e.initiator,\n\t\t\tspeaker: e.speaker,\n\t\t})\n\t}\n\n\t#onRoomUpdated = (e) =>\n\t{\n\t\tconst speakerChanged = (\n\t\t\te.roomId === this._currentRoomId\n\t\t\t&& this.rooms[e.roomId]\n\t\t\t&& this.rooms[e.roomId].speaker != e.speaker\n\t\t);\n\t\tconst previousSpeaker = speakerChanged && this.rooms[e.roomId].speaker;\n\n\t\tconsole.log(\"__onRoomUpdated; speakerChanged: \", speakerChanged)\n\t\tthis.updateRoom({\n\t\t\tid: e.roomId,\n\t\t\tusers: e.users,\n\t\t\tspeaker: e.speaker,\n\t\t});\n\n\t\tif (e.roomId === this._currentRoomId && e.users.indexOf(this.userId) === -1)\n\t\t{\n\t\t\tthis._currentRoomId = null;\n\t\t\tthis.runCallback(CallEvent.onLeaveRoom, {\n\t\t\t\troomId: e.roomId\n\t\t\t})\n\t\t}\n\t\telse if (e.roomId !== this._currentRoomId && e.users.indexOf(this.userId) !== -1)\n\t\t{\n\t\t\tthis._currentRoomId = e.roomId;\n\t\t\tthis.runCallback(CallEvent.onJoinRoom, {\n\t\t\t\troomId: e.roomId,\n\t\t\t\tspeaker: this.currentRoom().speaker,\n\t\t\t\tusers: this.currentRoom().users,\n\t\t\t})\n\t\t}\n\t\telse if (speakerChanged)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onTransferRoomSpeaker, {\n\t\t\t\troomId: e.roomId,\n\t\t\t\tspeaker: e.speaker,\n\t\t\t\tpreviousSpeaker: previousSpeaker,\n\t\t\t\tinitiator: e.initiator,\n\t\t\t})\n\t\t}\n\t};\n\n\t#onCallMessageReceived = (e) =>\n\t{\n\t\tlet message;\n\t\tlet peer;\n\n\t\ttry\n\t\t{\n\t\t\tmessage = JSON.parse(e.text);\n\t\t} catch (err)\n\t\t{\n\t\t\tthis.log(\"Could not parse scenario message.\", err);\n\t\t\treturn;\n\t\t}\n\n\t\tconst eventName = message.eventName;\n\t\tif (eventName === clientEvents.voiceStarted)\n\t\t{\n\t\t\t// todo: remove after switching to SDK VAD events\n\t\t\tthis.runCallback(CallEvent.onUserVoiceStarted, {\n\t\t\t\tuserId: message.senderId\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.voiceStopped)\n\t\t{\n\t\t\t// todo: remove after switching to SDK VAD events\n\t\t\tthis.runCallback(CallEvent.onUserVoiceStopped, {\n\t\t\t\tuserId: message.senderId\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.microphoneState)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserMicrophoneState, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\tmicrophoneState: message.microphoneState === \"Y\"\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.cameraState)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserCameraState, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\tcameraState: message.cameraState === \"Y\"\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.videoPaused)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserVideoPaused, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\tvideoPaused: message.videoPaused === \"Y\"\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.screenState)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserScreenState, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\tscreenState: message.screenState === \"Y\"\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.recordState)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserRecordState, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\trecordState: message.recordState\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.floorRequest)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserFloorRequest, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\trequestActive: message.requestActive === \"Y\"\n\t\t\t})\n\t\t}\n\t\telse if (eventName === clientEvents.emotion)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserEmotion, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\ttoUserId: message.toUserId,\n\t\t\t\temotion: message.emotion\n\t\t\t})\n\t\t}\n\t\telse if (eventName === clientEvents.customMessage)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onCustomMessage, {\n\t\t\t\tmessage: message.message\n\t\t\t})\n\t\t}\n\t\telse if (eventName === \"scenarioLogUrl\")\n\t\t{\n\t\t\tconsole.warn(\"scenario log url: \" + message.logUrl)\n\t\t}\n\t\telse if (eventName === scenarioEvents.joinRoomOffer)\n\t\t{\n\t\t\tconsole.log(message)\n\t\t\tthis.#onJoinRoomOffer(message);\n\t\t}\n\t\telse if (eventName === scenarioEvents.roomUpdated)\n\t\t{\n\t\t\t// console.log(message)\n\t\t\tthis.#onRoomUpdated(message);\n\t\t}\n\t\telse if (eventName === scenarioEvents.listRoomsResponse)\n\t\t{\n\t\t\tif (this.__resolveListRooms)\n\t\t\t{\n\t\t\t\tthis.__resolveListRooms(message.rooms)\n\t\t\t\tdelete this.__resolveListRooms;\n\t\t\t}\n\t\t}\n\t\telse if (eventName === scenarioEvents.viewerJoined)\n\t\t{\n\t\t\tconsole.log(\"viewer \" + message.senderId + \" joined\");\n\t\t\tpeer = this.peers[message.senderId];\n\t\t\tif (peer)\n\t\t\t{\n\t\t\t\tpeer.setDirection(EndpointDirection.RecvOnly);\n\t\t\t\tpeer.setReady(true);\n\t\t\t}\n\t\t}\n\t\telse if (eventName === scenarioEvents.viewerLeft)\n\t\t{\n\t\t\tconsole.log(\"viewer \" + message.senderId + \" left\");\n\t\t\tpeer = this.peers[message.senderId];\n\t\t\tif (peer)\n\t\t\t{\n\t\t\t\tpeer.setReady(false);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.log(\"Unknown scenario event \" + eventName);\n\t\t}\n\t};\n\n\tsendTelemetryEvent(eventName)\n\t{\n\t\tUtil.sendTelemetryEvent({\n\t\t\tcall_id: this.id,\n\t\t\tuser_id: this.userId,\n\t\t\tkind: \"voximplant\",\n\t\t\tevent: eventName,\n\t\t})\n\t};\n\n\tdestroy()\n\t{\n\t\tthis.ready = false;\n\t\tthis.joinedAsViewer = false;\n\t\tthis.#hideLocalVideo();\n\t\tif (this.localVAD)\n\t\t{\n\t\t\tthis.localVAD.destroy();\n\t\t\tthis.localVAD = null;\n\t\t}\n\t\tclearInterval(this.microphoneLevelInterval);\n\t\tif (this.voximplantCall)\n\t\t{\n\t\t\tthis.removeCallEvents();\n\t\t\tthis.unsubscribeHardwareChanges();\n\t\t\tif (this.voximplantCall.state() != \"ENDED\")\n\t\t\t{\n\t\t\t\tthis.voximplantCall.hangup();\n\t\t\t}\n\t\t\tthis.voximplantCall = null;\n\t\t}\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers.hasOwnProperty(userId) && this.peers[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId].destroy();\n\t\t\t}\n\t\t}\n\n\t\tthis.removeClientEvents();\n\n\t\tclearTimeout(this.lastPingReceivedTimeout);\n\t\tclearTimeout(this.lastSelfPingReceivedTimeout);\n\t\tclearInterval(this.pingUsersInterval);\n\t\tclearInterval(this.pingBackendInterval);\n\n\t\twindow.removeEventListener(\"unload\", this.#onWindowUnload);\n\t\treturn super.destroy();\n\t};\n}\n\nclass Signaling\n{\n\tconstructor(params)\n\t{\n\t\tthis.call = params.call;\n\t};\n\n\tinviteUsers(data)\n\t{\n\t\treturn this.#runRestAction(ajaxActions.invite, data);\n\t};\n\n\tsendAnswer(data, repeated)\n\t{\n\t\tif (repeated && CallEngine.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.answer, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.#runRestAction(ajaxActions.answer, data);\n\t\t}\n\t};\n\n\tsendCancel(data)\n\t{\n\t\treturn this.#runRestAction(ajaxActions.cancel, data);\n\t};\n\n\tsendHangup(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.hangup, data);\n\t\t\tdata.retransmit = false;\n\t\t\tthis.#runRestAction(ajaxActions.hangup, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdata.retransmit = true;\n\t\t\tthis.#runRestAction(ajaxActions.hangup, data);\n\t\t}\n\t};\n\n\tsendVoiceStarted(data)\n\t{\n\t\treturn this.#sendMessage(clientEvents.voiceStarted, data);\n\t};\n\n\tsendVoiceStopped(data)\n\t{\n\t\treturn this.#sendMessage(clientEvents.voiceStopped, data);\n\t};\n\n\tsendMicrophoneState(microphoneState)\n\t{\n\t\treturn this.#sendMessage(clientEvents.microphoneState, {\n\t\t\tmicrophoneState: microphoneState ? \"Y\" : \"N\"\n\t\t});\n\t};\n\n\tsendCameraState(cameraState)\n\t{\n\t\treturn this.#sendMessage(clientEvents.cameraState, {\n\t\t\tcameraState: cameraState ? \"Y\" : \"N\"\n\t\t});\n\t};\n\n\tsendScreenState(screenState)\n\t{\n\t\treturn this.#sendMessage(clientEvents.screenState, {\n\t\t\tscreenState: screenState ? \"Y\" : \"N\"\n\t\t});\n\t};\n\n\tsendRecordState(recordState)\n\t{\n\t\treturn this.#sendMessage(clientEvents.recordState, recordState);\n\t};\n\n\tsendFloorRequest(requestActive)\n\t{\n\t\treturn this.#sendMessage(clientEvents.floorRequest, {\n\t\t\trequestActive: requestActive ? \"Y\" : \"N\"\n\t\t});\n\t};\n\n\tsendEmotion(toUserId, emotion)\n\t{\n\t\treturn this.#sendMessage(clientEvents.emotion, {\n\t\t\ttoUserId: toUserId,\n\t\t\temotion: emotion\n\t\t});\n\t};\n\n\tsendCustomMessage(message, repeatOnConnect)\n\t{\n\t\treturn this.#sendMessage(clientEvents.customMessage, {\n\t\t\tmessage: message,\n\t\t\trepeatOnConnect: !!repeatOnConnect\n\t\t});\n\t};\n\n\tsendShowUsers(users)\n\t{\n\t\treturn this.#sendMessage(clientEvents.showUsers, {\n\t\t\tusers: users\n\t\t});\n\t};\n\n\tsendShowAll()\n\t{\n\t\treturn this.#sendMessage(clientEvents.showAll, {});\n\t};\n\n\tsendHideAll()\n\t{\n\t\treturn this.#sendMessage(clientEvents.hideAll, {});\n\t};\n\n\tsendPingToUsers(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.ping, data, 0);\n\t\t}\n\t};\n\n\tsendPingToBackend()\n\t{\n\t\tthis.#runRestAction(ajaxActions.ping, {retransmit: false});\n\t};\n\n\tsendUserInviteTimeout(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.userInviteTimeout, data, 0);\n\t\t}\n\t};\n\n\tsendJoinRoom(roomId)\n\t{\n\t\treturn this.#sendMessage(clientEvents.joinRoom, {\n\t\t\troomId: roomId\n\t\t});\n\t};\n\n\tsendLeaveRoom(roomId)\n\t{\n\t\treturn this.#sendMessage(clientEvents.leaveRoom, {\n\t\t\troomId: roomId\n\t\t});\n\t};\n\n\tsendListRooms()\n\t{\n\t\treturn this.#sendMessage(clientEvents.listRooms);\n\t};\n\n\tsendRequestRoomSpeaker(roomId)\n\t{\n\t\treturn this.#sendMessage(clientEvents.requestRoomSpeaker, {\n\t\t\troomId: roomId\n\t\t});\n\t};\n\n\t#sendPullEvent(eventName, data, expiry)\n\t{\n\t\texpiry = expiry || 5;\n\t\tif (!data.userId)\n\t\t{\n\t\t\tthrow new Error('userId is not found in data');\n\t\t}\n\n\t\tif (!Type.isArray(data.userId))\n\t\t{\n\t\t\tdata.userId = [data.userId];\n\t\t}\n\t\tif (data.userId.length === 0)\n\t\t{\n\t\t\t// nobody to send, exit\n\t\t\treturn;\n\t\t}\n\n\t\tdata.callInstanceId = this.call.instanceId;\n\t\tdata.senderId = this.call.userId;\n\t\tdata.callId = this.call.id;\n\t\tdata.requestId = Util.getUuidv4();\n\n\t\tthis.call.log('Sending p2p signaling event ' + eventName + '; ' + JSON.stringify(data));\n\t\tCallEngine.getPullClient().sendMessage(data.userId, 'im', eventName, data, expiry);\n\t};\n\n\t#sendMessage(eventName, data)\n\t{\n\t\tif (!this.call.voximplantCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!Type.isPlainObject(data))\n\t\t{\n\t\t\tdata = {};\n\t\t}\n\t\tdata.eventName = eventName;\n\t\tdata.requestId = Util.getUuidv4();\n\n\t\tthis.call.voximplantCall.sendMessage(JSON.stringify(data));\n\t};\n\n\t#runRestAction(signalName, data)\n\t{\n\t\tif (!Type.isPlainObject(data))\n\t\t{\n\t\t\tdata = {};\n\t\t}\n\n\t\tdata.callId = this.call.id;\n\t\tdata.callInstanceId = this.call.instanceId;\n\t\tdata.requestId = Util.getUuidv4();\n\t\treturn CallEngine.getRestClient().callMethod(signalName, data);\n\t};\n}\n\nclass Peer\n{\n\tcalculatedState: string\n\n\tconstructor(params)\n\t{\n\t\tthis.userId = params.userId;\n\t\tthis.call = params.call;\n\n\t\tthis.ready = !!params.ready;\n\t\tthis.calling = false;\n\t\tthis.declined = false;\n\t\tthis.busy = false;\n\t\tthis.inviteTimeout = false;\n\t\tthis.endpoint = null;\n\t\tthis.direction = params.direction || EndpointDirection.SendRecv;\n\n\t\tthis.stream = null;\n\t\tthis.mediaRenderers = [];\n\n\t\tthis.isIncomingVideoAllowed = params.isIncomingVideoAllowed !== false;\n\n\t\tthis.callingTimeout = 0;\n\t\tthis.connectionRestoreTimeout = 0;\n\n\t\tthis.callbacks = {\n\t\t\tonStateChanged: Type.isFunction(params.onStateChanged) ? params.onStateChanged : BX.DoNothing,\n\t\t\tonInviteTimeout: Type.isFunction(params.onInviteTimeout) ? params.onInviteTimeout : BX.DoNothing,\n\t\t\tonMediaReceived: Type.isFunction(params.onMediaReceived) ? params.onMediaReceived : BX.DoNothing,\n\t\t\tonMediaRemoved: Type.isFunction(params.onMediaRemoved) ? params.onMediaRemoved : BX.DoNothing,\n\t\t\tonVoiceStarted: Type.isFunction(params.onVoiceStarted) ? params.onVoiceStarted : BX.DoNothing,\n\t\t\tonVoiceEnded: Type.isFunction(params.onVoiceEnded) ? params.onVoiceEnded : BX.DoNothing,\n\t\t\tonMediaRenderEnabled: Type.isFunction(params.onMediaRenderEnabled) ? params.onMediaRenderEnabled : BX.DoNothing,\n\t\t\tonMediaRenderDisabled: Type.isFunction(params.onMediaRenderDisabled) ? params.onMediaRenderDisabled : BX.DoNothing,\n\t\t};\n\n\t\tthis.calculatedState = this.calculateState();\n\t};\n\n\tsetReady(ready)\n\t{\n\t\tready = !!ready;\n\t\tif (this.ready == ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.ready = ready;\n\t\tthis.readyStack = (new Error()).stack;\n\t\tif (this.calling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t\tthis.inviteTimeout = false;\n\t\t}\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.declined = false;\n\t\t\tthis.busy = false;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tclearTimeout(this.connectionRestoreTimeout);\n\t\t}\n\n\t\tthis.updateCalculatedState();\n\t}\n\n\tsetDirection(direction)\n\t{\n\t\tif (this.direction == direction)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.direction = direction;\n\t}\n\n\tsetDeclined(declined)\n\t{\n\t\tthis.declined = declined;\n\t\tif (this.calling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t}\n\t\tif (this.declined)\n\t\t{\n\t\t\tthis.ready = false;\n\t\t\tthis.busy = false;\n\t\t}\n\t\tclearTimeout(this.connectionRestoreTimeout);\n\t\tthis.updateCalculatedState();\n\t}\n\n\tsetBusy(busy)\n\t{\n\t\tthis.busy = busy;\n\t\tif (this.calling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t}\n\t\tif (this.busy)\n\t\t{\n\t\t\tthis.ready = false;\n\t\t\tthis.declined = false;\n\t\t}\n\t\tclearTimeout(this.connectionRestoreTimeout);\n\t\tthis.updateCalculatedState();\n\t}\n\n\tsetEndpoint(endpoint)\n\t{\n\t\tthis.log(\"Adding endpoint with \" + endpoint.mediaRenderers.length + \" media renderers\");\n\n\t\tthis.setReady(true);\n\t\tthis.inviteTimeout = false;\n\t\tthis.declined = false;\n\t\tclearTimeout(this.connectionRestoreTimeout);\n\n\t\tif (this.endpoint)\n\t\t{\n\t\t\tthis.removeEndpointEventHandlers();\n\t\t\tthis.endpoint = null;\n\t\t}\n\n\t\tthis.endpoint = endpoint;\n\n\t\tfor (let i = 0; i < this.endpoint.mediaRenderers.length; i++)\n\t\t{\n\t\t\tthis.addMediaRenderer(this.endpoint.mediaRenderers[i]);\n\t\t\tif (this.endpoint.mediaRenderers[i].element)\n\t\t\t{\n\t\t\t\t//BX.remove(this.endpoint.mediaRenderers[i].element);\n\t\t\t}\n\t\t}\n\n\t\tthis.bindEndpointEventHandlers();\n\t}\n\n\tallowIncomingVideo(isIncomingVideoAllowed)\n\t{\n\t\tif (this.isIncomingVideoAllowed == isIncomingVideoAllowed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isIncomingVideoAllowed = !!isIncomingVideoAllowed;\n\t}\n\n\taddMediaRenderer(mediaRenderer)\n\t{\n\t\tthis.log('Adding media renderer for user' + this.userId, mediaRenderer);\n\n\t\tthis.mediaRenderers.push(mediaRenderer);\n\t\tthis.callbacks.onMediaReceived({\n\t\t\tuserId: this.userId,\n\t\t\tkind: mediaRenderer.kind,\n\t\t\tmediaRenderer: mediaRenderer\n\t\t});\n\t\tthis.updateCalculatedState();\n\t}\n\n\tremoveMediaRenderer(mediaRenderer)\n\t{\n\t\tthis.log('Removing media renderer for user' + this.userId, mediaRenderer);\n\n\t\tlet i = this.mediaRenderers.indexOf(mediaRenderer);\n\t\tif (i >= 0)\n\t\t{\n\t\t\tthis.mediaRenderers.splice(i, 1);\n\t\t}\n\t\tthis.callbacks.onMediaRemoved({\n\t\t\tuserId: this.userId,\n\t\t\tkind: mediaRenderer.kind,\n\t\t\tmediaRenderer: mediaRenderer\n\t\t});\n\t\tthis.updateCalculatedState();\n\t}\n\n\tbindEndpointEventHandlers()\n\t{\n\t\tthis.endpoint.addEventListener(VoxImplant.EndpointEvents.RemoteMediaAdded, this.#onEndpointRemoteMediaAdded);\n\t\tthis.endpoint.addEventListener(VoxImplant.EndpointEvents.RemoteMediaRemoved, this.#onEndpointRemoteMediaRemoved);\n\t\tthis.endpoint.addEventListener(VoxImplant.EndpointEvents.VoiceStart, this.#onEndpointVoiceStart);\n\t\tthis.endpoint.addEventListener(VoxImplant.EndpointEvents.VoiceEnd, this.#onEndpointVoiceEnd);\n\t\tthis.endpoint.addEventListener(VoxImplant.EndpointEvents.Removed, this.#onEndpointRemoved);\n\t\tthis.endpoint.addEventListener(VoxImplant.EndpointEvents.MediaRenderEnabled, this.#onEndpointMediaRenderEnabled);\n\t\tthis.endpoint.addEventListener(VoxImplant.EndpointEvents.MediaRenderDisabled, this.#onEndpointMediaRenderDisabled);\n\t}\n\n\tremoveEndpointEventHandlers()\n\t{\n\t\tthis.endpoint.removeEventListener(VoxImplant.EndpointEvents.RemoteMediaAdded, this.#onEndpointRemoteMediaAdded);\n\t\tthis.endpoint.removeEventListener(VoxImplant.EndpointEvents.RemoteMediaRemoved, this.#onEndpointRemoteMediaRemoved);\n\t\tthis.endpoint.removeEventListener(VoxImplant.EndpointEvents.VoiceStart, this.#onEndpointVoiceStart);\n\t\tthis.endpoint.removeEventListener(VoxImplant.EndpointEvents.VoiceEnd, this.#onEndpointVoiceEnd);\n\t\tthis.endpoint.removeEventListener(VoxImplant.EndpointEvents.Removed, this.#onEndpointRemoved);\n\t\tthis.endpoint.removeEventListener(VoxImplant.EndpointEvents.MediaRenderEnabled, this.#onEndpointMediaRenderEnabled);\n\t\tthis.endpoint.removeEventListener(VoxImplant.EndpointEvents.MediaRenderDisabled, this.#onEndpointMediaRenderDisabled);\n\t}\n\n\tcalculateState()\n\t{\n\t\tif (this.endpoint)\n\t\t{\n\t\t\treturn UserState.Connected;\n\t\t}\n\n\t\tif (this.calling)\n\t\t{\n\t\t\treturn UserState.Calling;\n\t\t}\n\n\t\tif (this.inviteTimeout)\n\t\t{\n\t\t\treturn UserState.Unavailable;\n\t\t}\n\n\t\tif (this.declined)\n\t\t{\n\t\t\treturn UserState.Declined;\n\t\t}\n\n\t\tif (this.busy)\n\t\t{\n\t\t\treturn UserState.Busy;\n\t\t}\n\n\t\tif (this.ready)\n\t\t{\n\t\t\treturn UserState.Ready;\n\t\t}\n\n\t\treturn UserState.Idle;\n\t}\n\n\tupdateCalculatedState()\n\t{\n\t\tconst calculatedState = this.calculateState();\n\n\t\tif (this.calculatedState != calculatedState)\n\t\t{\n\t\t\tthis.callbacks.onStateChanged({\n\t\t\t\tuserId: this.userId,\n\t\t\t\tstate: calculatedState,\n\t\t\t\tpreviousState: this.calculatedState,\n\t\t\t\tdirection: this.direction,\n\t\t\t});\n\t\t\tthis.calculatedState = calculatedState;\n\t\t}\n\t}\n\n\tisParticipating()\n\t{\n\t\treturn ((this.calling || this.ready || this.endpoint) && !this.declined);\n\t}\n\n\twaitForConnectionRestore()\n\t{\n\t\tclearTimeout(this.connectionRestoreTimeout);\n\t\tthis.connectionRestoreTimeout = setTimeout(\n\t\t\tthis.onConnectionRestoreTimeout.bind(this),\n\t\t\tconnectionRestoreTime\n\t\t);\n\t}\n\n\tonInvited()\n\t{\n\t\tthis.ready = false;\n\t\tthis.inviteTimeout = false;\n\t\tthis.declined = false;\n\t\tthis.calling = true;\n\n\t\tclearTimeout(this.connectionRestoreTimeout);\n\t\tif (this.callingTimeout)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t}\n\t\tthis.callingTimeout = setTimeout(() => this.onInviteTimeout(true), 30000);\n\t\tthis.updateCalculatedState();\n\t}\n\n\tonInviteTimeout(internal)\n\t{\n\t\tclearTimeout(this.callingTimeout);\n\t\tif (!this.calling)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.calling = false;\n\t\tthis.inviteTimeout = true;\n\t\tif (internal)\n\t\t{\n\t\t\tthis.callbacks.onInviteTimeout({\n\t\t\t\tuserId: this.userId\n\t\t\t});\n\t\t}\n\t\tthis.updateCalculatedState();\n\t}\n\n\tonConnectionRestoreTimeout()\n\t{\n\t\tif (this.endpoint || !this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.log(\"Done waiting for connection restoration\");\n\t\tthis.setReady(false);\n\t}\n\n\t#onEndpointRemoteMediaAdded = (e) =>\n\t{\n\t\tthis.log(\"VoxImplant.EndpointEvents.RemoteMediaAdded\", e.mediaRenderer);\n\n\t\t// voximplant audio auto-play bug workaround:\n\t\tif (e.mediaRenderer.element)\n\t\t{\n\t\t\te.mediaRenderer.element.volume = 0;\n\t\t\te.mediaRenderer.element.srcObject = null;\n\t\t}\n\t\tthis.addMediaRenderer(e.mediaRenderer);\n\t}\n\n\t#onEndpointRemoteMediaRemoved = (e) =>\n\t{\n\t\tconsole.log(\"VoxImplant.EndpointEvents.RemoteMediaRemoved, \", e.mediaRenderer)\n\t\t//this.log(\"VoxImplant.EndpointEvents.RemoteMediaRemoved, \", e);\n\t\tthis.removeMediaRenderer(e.mediaRenderer);\n\t}\n\n\t#onEndpointVoiceStart = () =>\n\t{\n\t\tthis.callbacks.onVoiceStarted();\n\t}\n\n\t#onEndpointVoiceEnd = () =>\n\t{\n\t\tthis.callbacks.onVoiceEnded();\n\t}\n\n\t#onEndpointRemoved = (e) =>\n\t{\n\t\tthis.log(\"VoxImplant.EndpointEvents.Removed\", e);\n\n\t\tif (this.endpoint)\n\t\t{\n\t\t\tthis.removeEndpointEventHandlers();\n\t\t\tthis.endpoint = null;\n\t\t}\n\t\tif (this.stream)\n\t\t{\n\t\t\tthis.stream = null;\n\t\t}\n\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.waitForConnectionRestore();\n\t\t}\n\n\t\tthis.updateCalculatedState();\n\t}\n\n\t#onEndpointMediaRenderEnabled = (e) =>\n\t{\n\t\tthis.callbacks.onMediaRenderEnabled(e);\n\t}\n\n\t#onEndpointMediaRenderDisabled = (e) =>\n\t{\n\t\tthis.callbacks.onMediaRenderDisabled(e);\n\t}\n\n\tlog()\n\t{\n\t\tthis.call.log.apply(this.call, arguments);\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.stream)\n\t\t{\n\t\t\tUtil.stopMediaStream(this.stream);\n\t\t\tthis.stream = null;\n\t\t}\n\t\tif (this.endpoint)\n\t\t{\n\t\t\tthis.removeEndpointEventHandlers();\n\t\t\tthis.endpoint = null;\n\t\t}\n\n\t\tthis.callbacks.onStateChanged = BX.DoNothing;\n\t\tthis.callbacks.onInviteTimeout = BX.DoNothing;\n\t\tthis.callbacks.onMediaReceived = BX.DoNothing;\n\t\tthis.callbacks.onMediaRemoved = BX.DoNothing;\n\n\t\tclearTimeout(this.callingTimeout);\n\t\tclearTimeout(this.connectionRestoreTimeout);\n\t\tthis.callingTimeout = null;\n\t\tthis.connectionRestoreTimeout = null;\n\t}\n}\n\nconst transformVoxStats = function (s, voximplantCall)\n{\n\tlet result = {\n\t\tconnection: s.connection,\n\t\toutboundAudio: [],\n\t\toutboundVideo: [],\n\t\tinboundAudio: [],\n\t\tinboundVideo: [],\n\t}\n\n\tlet endpoints = {};\n\tif (voximplantCall.getEndpoints)\n\t{\n\t\tvoximplantCall.getEndpoints().forEach(endpoint => endpoints[endpoint.id] = endpoint)\n\t}\n\n\tif (!result.connection.timestamp)\n\t{\n\t\tresult.connection.timestamp = Date.now();\n\t}\n\tfor (let trackId in s.outbound)\n\t{\n\t\tif (!s.outbound.hasOwnProperty(trackId))\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\t\tconst statGroup = s.outbound[trackId];\n\t\tfor (let i = 0; i < statGroup.length; i++)\n\t\t{\n\t\t\tlet stat = statGroup[i];\n\t\t\tstat.trackId = trackId;\n\t\t\tif ('audioLevel' in stat)\n\t\t\t{\n\t\t\t\tresult.outboundAudio.push(stat)\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresult.outboundVideo.push(stat)\n\t\t\t}\n\t\t}\n\t}\n\tfor (let trackId in s.inbound)\n\t{\n\t\tif (!s.inbound.hasOwnProperty(trackId))\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\t\tlet stat = s.inbound[trackId];\n\t\tif (!('endpoint' in stat))\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\t\tstat.trackId = trackId;\n\t\tif ('audioLevel' in stat)\n\t\t{\n\t\t\tresult.inboundAudio.push(stat)\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (endpoints[stat.endpoint])\n\t\t\t{\n\t\t\t\tlet videoRenderer = endpoints[stat.endpoint].mediaRenderers.find(r => r.id == stat.trackId)\n\t\t\t\tif (videoRenderer && videoRenderer.element)\n\t\t\t\t{\n\t\t\t\t\tstat.actualHeight = videoRenderer.element.videoHeight;\n\t\t\t\t\tstat.actualWidth = videoRenderer.element.videoWidth;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tresult.inboundVideo.push(stat)\n\t\t}\n\t}\n\treturn result;\n\n}\n","import {Type} from 'main.core';\nimport {CallEvent, UserMnemonic} from './engine/engine';\nimport {View} from './view/view';\n\nconst StrategyType = {\n\tAllowAll: 'AllowAll',\n\tAllowNone: 'AllowNone',\n\tOnlySpeaker: 'OnlySpeaker',\n\tCurrentlyTalking: 'CurrentlyTalking'\n};\n\nconst HOLD_VIDEO_SECONDS = 20;\n\nexport class VideoStrategy\n{\n\tstatic Type = StrategyType\n\n\tcall: VoximplantCall\n\tcallView: View\n\tstrategyType: $Keys<typeof StrategyType>\n\tusers: {[string]: User}\n\n\tconstructor(config)\n\t{\n\t\tthis.call = config.call;\n\t\tthis.callView = config.callView;\n\t\tthis.strategyType = config.strategyType || StrategyType.AllowAll;\n\n\t\t// event handlers\n\t\tthis.onCallUserVoiceStartedHandler = this.onCallUserVoiceStarted.bind(this);\n\t\tthis.onCallUserVoiceStoppedHandler = this.onCallUserVoiceStopped.bind(this);\n\t\tthis.onCallViewSetCentralUserHandler = this.onCallViewSetCentralUser.bind(this);\n\t\tthis.onCallViewLayoutChangeHandler = this.onCallViewLayoutChange.bind(this);\n\n\t\tthis.users = {};\n\n\t\tthis.init();\n\t};\n\n\tinit()\n\t{\n\t\tif (this.strategyType === StrategyType.AllowAll)\n\t\t{\n\t\t\tthis.call.allowVideoFrom(UserMnemonic.all);\n\t\t}\n\t\telse if (this.strategyType === StrategyType.AllowNone)\n\t\t{\n\t\t\tthis.call.allowVideoFrom(UserMnemonic.none);\n\t\t}\n\t\tthis.bindEvents();\n\t};\n\n\tbindEvents()\n\t{\n\t\tthis.call.addEventListener(CallEvent.onUserVoiceStarted, this.onCallUserVoiceStartedHandler);\n\t\tthis.call.addEventListener(CallEvent.onUserVoiceStopped, this.onCallUserVoiceStoppedHandler);\n\t\tthis.callView.subscribe(View.Event.onSetCentralUser, this.onCallViewSetCentralUserHandler);\n\t\tthis.callView.subscribe(View.Event.onLayoutChange, this.onCallViewLayoutChangeHandler);\n\t};\n\n\tremoveEvents()\n\t{\n\t\tif (this.call)\n\t\t{\n\t\t\tthis.call.removeEventListener(CallEvent.onUserVoiceStarted, this.onCallUserVoiceStartedHandler);\n\t\t\tthis.call.removeEventListener(CallEvent.onUserVoiceStopped, this.onCallUserVoiceStoppedHandler);\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.unsubscribe(View.Event.onSetCentralUser, this.onCallViewSetCentralUserHandler);\n\t\t\tthis.callView.unsubscribe(View.Event.onLayoutChange, this.onCallViewLayoutChangeHandler);\n\t\t}\n\t};\n\n\tsetType(strategyType: $Keys<typeof StrategyType>)\n\t{\n\t\tif (strategyType == this.strategyType)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.strategyType = strategyType;\n\t\tthis.applyVideoLimit();\n\t};\n\n\tapplyVideoLimit()\n\t{\n\t\tif (this.strategyType === StrategyType.AllowAll)\n\t\t{\n\t\t\tthis.call.allowVideoFrom(UserMnemonic.all);\n\t\t}\n\t\telse if (this.strategyType === StrategyType.AllowNone)\n\t\t{\n\t\t\tthis.call.allowVideoFrom(UserMnemonic.none);\n\t\t}\n\t\telse if (this.strategyType === StrategyType.CurrentlyTalking)\n\t\t{\n\t\t\tlet talkingUsers = this.getActiveUsers();\n\t\t\tif (talkingUsers.length === 0)\n\t\t\t{\n\t\t\t\tthis.call.allowVideoFrom(UserMnemonic.none);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.call.allowVideoFrom(this.getActiveUsers());\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * return int[]\n\t */\n\tgetActiveUsers()\n\t{\n\t\tlet result = [];\n\t\tfor (let userId in this.users)\n\t\t{\n\t\t\tlet user = this.users[userId];\n\t\t\tif (user.active)\n\t\t\t{\n\t\t\t\tresult.push(user.id)\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t};\n\n\tonUserActiveChanged()\n\t{\n\t\tif (this.strategyType == StrategyType.CurrentlyTalking)\n\t\t{\n\t\t\tthis.applyVideoLimit();\n\t\t}\n\t};\n\n\tonCallUserVoiceStarted(data)\n\t{\n\t\tconst userId = data.userId;\n\t\tif (!this.users[userId])\n\t\t{\n\t\t\tthis.users[userId] = new User({\n\t\t\t\tid: userId,\n\t\t\t\tonActiveChanged: this.onUserActiveChanged.bind(this)\n\t\t\t});\n\t\t}\n\n\t\tthis.users[userId].setTalking(true);\n\t};\n\n\tonCallUserVoiceStopped(data)\n\t{\n\t\tconst userId = data.userId;\n\t\tif (!this.users[userId])\n\t\t{\n\t\t\tthis.users[userId] = new User({\n\t\t\t\tid: userId,\n\t\t\t\tonActiveChanged: this.onUserActiveChanged.bind(this)\n\t\t\t});\n\t\t}\n\n\t\tthis.users[userId].setTalking(false);\n\t};\n\n\tonCallViewSetCentralUser(event)\n\t{\n\t\tconst userId = event.data.userId;\n\n\t\tif (this.strategyType === StrategyType.OnlySpeaker)\n\t\t{\n\t\t\tthis.call.allowVideoFrom([userId]);\n\t\t}\n\t};\n\n\tonCallViewLayoutChange(event)\n\t{\n\n\t};\n\n\tdestroy()\n\t{\n\t\tthis.removeEvents();\n\t\tthis.call = null;\n\t\tthis.callView = null;\n\n\t\tfor (let userId in this.users)\n\t\t{\n\t\t\tif (this.users.hasOwnProperty(userId))\n\t\t\t{\n\t\t\t\tthis.users[userId].destroy();\n\t\t\t}\n\t\t}\n\t\tthis.users = {};\n\t};\n}\n\nclass User\n{\n\tid: number\n\ttalking = false\n\tsharing = false\n\tactive = false\n\n\tconstructor(config)\n\t{\n\t\tthis.id = config.id;\n\n\t\tthis.callbacks = {\n\t\t\tonActiveChanged: Type.isFunction(config.onActiveChanged) ? config.onActiveChanged : BX.DoNothing\n\t\t};\n\n\t\tthis.turnOffVideoTimeout = null;\n\t};\n\n\tsetTalking(talking: boolean)\n\t{\n\t\tif (this.talking == talking)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.talking = talking;\n\t\tif (this.talking)\n\t\t{\n\t\t\tthis.cancelTurnOffVideo();\n\t\t\tthis.updateActive();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.scheduleTurnOffVideo();\n\t\t}\n\t};\n\n\tsetSharing(sharing: boolean)\n\t{\n\t\tif (this.sharing == sharing)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.sharing = sharing;\n\t\tif (this.sharing)\n\t\t{\n\t\t\tthis.cancelTurnOffVideo();\n\t\t\tthis.updateActive();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.scheduleTurnOffVideo();\n\t\t}\n\t};\n\n\tupdateActive()\n\t{\n\t\tconst newActive = !!(this.sharing || this.talking || this.turnOffVideoTimeout);\n\t\tif (newActive !== this.active)\n\t\t{\n\t\t\tthis.active = newActive;\n\t\t}\n\t\tthis.callbacks.onActiveChanged({\n\t\t\tuserId: this.id,\n\t\t\tactive: this.active\n\t\t});\n\t};\n\n\tscheduleTurnOffVideo()\n\t{\n\t\tclearTimeout(this.turnOffVideoTimeout);\n\t\tthis.turnOffVideoTimeout = setTimeout(\n\t\t\t() =>\n\t\t\t{\n\t\t\t\tthis.turnOffVideoTimeout = null;\n\t\t\t\tthis.updateActive();\n\t\t\t},\n\t\t\tHOLD_VIDEO_SECONDS * 1000\n\t\t);\n\t};\n\n\tcancelTurnOffVideo()\n\t{\n\t\tclearTimeout(this.turnOffVideoTimeout);\n\t\tthis.turnOffVideoTimeout = null;\n\t};\n\n\tdestroy()\n\t{\n\t\tthis.callbacks.onActiveChanged = BX.DoNothing;\n\t\tclearTimeout(this.turnOffVideoTimeout);\n\t};\n}","import { Dom, Loc } from 'main.core';\nimport { Popup } from 'main.popup';\nimport { Analytics } from 'call.lib.analytics';\nimport '../css/copilot-popup.css';\nimport Util from '../util';\nimport { CallAI } from '../call_ai';\n\nexport class CopilotPopup\n{\n\tconstructor(config)\n\t{\n\t\tthis.popup = null;\n\t\tthis.popupTemplate = null;\n\t\tthis.isCopilotActive = config.isCopilotActive;\n\t\tthis.isCopilotFeaturesEnabled = config.isCopilotFeaturesEnabled;\n\t\tthis.callId = config.callId;\n\n\t\tthis.callbacks = {\n\t\t\tupdateCopilotState: BX.type.isFunction(config.updateCopilotState) ? config.updateCopilotState : BX.DoNothing,\n\t\t\tonClose: BX.type.isFunction(config.onClose) ? config.onClose : BX.DoNothing,\n\t\t}\n\t};\n\n\tgetPopupTemplate()\n\t{\n\t\tconst getButton = () => {\n\n\t\t\tif (!this.isCopilotFeaturesEnabled)\n\t\t\t{\n\t\t\t\tthis.sendAnalytics('private_coming_soon');\n\n\t\t\t\treturn {\n\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__button bx-call-copilot-popup__button_transparent' },\n\t\t\t\t\ttext: BX.message('CALL_COPILOT_POPUP_BUTTON_COMING_SOON'),\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!CallAI.settingsEnabled)\n\t\t\t{\n\t\t\t\tthis.sendAnalytics('error_turnedoff');\n\n\t\t\t\treturn {\n\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__button bx-call-copilot-popup__button_transparent' },\n\t\t\t\t\ttext: Loc.getMessage('CALL_COPILOT_POPUP_SETTINGS_DISABLED'),\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (!CallAI.tariffAvailable)\n\t\t\t{\n\t\t\t\tthis.sendAnalytics('tariff_limit');\n\n\t\t\t\treturn {\n\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__button bx-call-copilot-popup__button_green' },\n\t\t\t\t\ttext: BX.message('CALL_COPILOT_POPUP_TARIFF_UP'),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\tUtil.openArticle(CallAI.helpSlider);\n\t\t\t\t\t\t\tthis.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!CallAI.agreementAccepted)\n\t\t\t{\n\t\t\t\tthis.sendAnalytics('agreement_limit');\n\n\t\t\t\treturn {\n\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__button bx-call-copilot-popup__button_transparent' },\n\t\t\t\t\ttext: BX.message('CALL_COPILOT_POPUP_CONCERN_NOT_ACCEPTED'),\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.isCopilotActive)\n\t\t\t{\n\t\t\t\treturn {\n\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__button bx-call-copilot-popup__button_gray' },\n\t\t\t\t\ttext: BX.message('CALL_COPILOT_POPUP_BUTTON_DISABLE'),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\tthis.callbacks.updateCopilotState();\n\t\t\t\t\t\t\tthis.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!CallAI.baasAvailable)\n\t\t\t{\n\t\t\t\tthis.sendAnalytics('baas_limit');\n\n\t\t\t\treturn {\n\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__button bx-call-copilot-popup__button_green' },\n\t\t\t\t\ttext: BX.message('CALL_COPILOT_POPUP_BUTTON_BUY_BOOST'),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\tUtil.openArticle(CallAI.baasPromoSlider);\n\t\t\t\t\t\t\tthis.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tprops: { className: 'bx-call-copilot-popup__button bx-call-copilot-popup__button_green' },\n\t\t\t\ttext: BX.message('CALL_COPILOT_POPUP_BUTTON_ENABLE'),\n\t\t\t\tevents: {\n\t\t\t\t\tclick: () => {\n\t\t\t\t\t\tthis.callbacks.updateCopilotState();\n\t\t\t\t\t\tthis.close();\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tthis.popupTemplate = Dom.create(\"div\", {\n\t\t\tprops: { className: 'bx-call-copilot-popup__wrapper' },\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__content' },\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__title' },\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__title-icon-background' },\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__title-icon-image' },\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__title-text' },\n\t\t\t\t\t\t\t\t\ttext: BX.message('CALL_COPILOT_POPUP_TITLE'),\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__description' },\n\t\t\t\t\t\t\ttext: BX.message('CALL_COPILOT_POPUP_LIST_TITLE'),\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"ul\", {\n\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__list' },\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"li\", {\n\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__list-item' },\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__list-item-icon bx-call-copilot-popup__list-item-icon_ai' },\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__list-item-text' },\n\t\t\t\t\t\t\t\t\t\t\ttext: BX.message('CALL_COPILOT_POPUP_LIST_ITEM_AGENDA'),\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"li\", {\n\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__list-item' },\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__list-item-icon bx-call-copilot-popup__list-item-icon_pen' },\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__list-item-text' },\n\t\t\t\t\t\t\t\t\t\t\ttext: BX.message('CALL_COPILOT_POPUP_LIST_ITEM_AGREEMENTS_V2'),\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"li\", {\n\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__list-item' },\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__list-item-icon bx-call-copilot-popup__list-item-icon_magic-pen' },\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__list-item-text' },\n\t\t\t\t\t\t\t\t\t\t\ttext: BX.message('CALL_COPILOT_POPUP_LIST_ITEM_GRADE'),\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"li\", {\n\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__list-item' },\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__list-item-icon bx-call-copilot-popup__list-item-icon_list' },\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__list-item-text' },\n\t\t\t\t\t\t\t\t\t\t\ttext: BX.message('CALL_COPILOT_POPUP_LIST_ITEM_TRANSCRIPT_V2'),\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__actions' },\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create('button', getButton()),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t]\n\t\t})\n\t}\n\n\tclose()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t}\n\t}\n\n\tcreate()\n\t{\n\t\tconst copilotButton = document.querySelector('.bx-messenger-videocall-panel-background-copilot');\n\t\tconst self = this;\n\n\t\tif (!copilotButton)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getPopupTemplate();\n\n\t\tthis.popup = new Popup({\n\t\t\tclassName : \"bx-call-copilot-popup\",\n\t\t\tbindElement: copilotButton,\n\t\t\ttargetContainer: document.body,\n\t\t\tcontent: this.popupTemplate,\n\t\t\tbindOptions: {\n\t\t\t\tposition: \"top\"\n\t\t\t},\n\t\t\tautoHide: true,\n\t\t\tcloseByEsc: true,\n\t\t\tbackground: '#190A37',\n\t\t\tcontentBackground: '#190A37',\n\t\t\tdarkMode: true,\n\t\t\tcontentNoPaddings: true,\n\t\t\tanimation: \"fading\",\n\t\t\twidth: 364,\n\t\t\tpadding: 0,\n\t\t\tangle: {\n\t\t\t\toffset: 162,\n\t\t\t\tposition: 'bottom',\n\t\t\t},\n\t\t\toffsetLeft: -118,\n\t\t\tcontentBorderRadius: '18px',\n\t\t\tevents: {\n\t\t\t\tonPopupClose: function ()\n\t\t\t\t{\n\t\t\t\t\tself.callbacks.onClose();\n\t\t\t\t\tthis.destroy();\n\t\t\t\t},\n\t\t\t\tonPopupDestroy: function ()\n\t\t\t\t{\n\t\t\t\t\tself.popup = null;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tshow()\n\t{\n\t\tthis.create();\n\t\tthis.popup.show();\n\t}\n\n\ttoggle()\n\t{\n\t\tif (!this.popup)\n\t\t{\n\t\t\tthis.show();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.close();\n\t}\n\n\tsendAnalytics(popupType)\n\t{\n\t\tAnalytics.getInstance().copilot.onAIRestrictionsPopupShow({\n\t\t\tcallId: this.callId,\n\t\t\tpopupType,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\nimport { Popup } from 'main.popup';\nimport { EventEmitter } from 'main.core.events'\nimport '../css/participants-permission-popup.css';\nimport { Provider } from '../engine/engine';\nimport 'ui.switcher';\nimport Util from '../util';\n\nconst ParticipantsPermissionPopupEvents = {\n\tonTurnOffStreamForAll: 'onTurnOffStreamForAll',\n};\n\nexport class ParticipantsPermissionPopup\n{\n\tconstructor(config)\n\t{\n\t\tthis.popup = null;\n\n\t\tthis.roomPermissions = config.roomPermissions;\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\troomPermissions: null,\n\t\t\troomSettings: null,\n\t\t\tallParticipantsDeviceControl: null,\n\t\t};\n\n\t\tthis.roomSettingsElements = {\n\t\t\tmic: null,\n\t\t\tcam: null,\n\t\t\tscreenshare: null,\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tturnOffAllParticipansStream:\n\t\t\t\tBX.type.isFunction(config.turnOffAllParticipansStream)\n\t\t\t\t\t? config.turnOffAllParticipansStream\n\t\t\t\t\t: BX.DoNothing,\n\t\t\tonPermissionChanged:\n\t\t\t\tBX.type.isFunction(config.onPermissionChanged)\n\t\t\t\t\t? config.onPermissionChanged\n\t\t\t\t\t: BX.DoNothing,\n\t\t\tonPermissionCollapseStateChanged:\n\t\t\t\tBX.type.isFunction(config.onPermissionCollapseStateChanged)\n\t\t\t\t\t? config.onPermissionCollapseStateChanged\n\t\t\t\t\t: BX.DoNothing,\n\t\t\tonClose:\n\t\t\t\tBX.type.isFunction(config.onClose)\n\t\t\t\t\t? config.onClose\n\t\t\t\t\t: BX.DoNothing,\n\t\t\tonOpen:\n\t\t\t\tBX.type.isFunction(config.onOpen)\n\t\t\t\t\t? config.onOpen\n\t\t\t\t\t: BX.DoNothing,\n\t\t}\n\n\t\tthis.eventEmitter = new EventEmitter(this, 'ParticipantsPermissionPopup');\n\n\t\tthis.currentBitrixCall = Util.getCurrentBitrixCall();\n\n\t\tthis.isShowPopup =\n\t\t\tUtil.isUserControlFeatureEnabled()\n\t\t\t&& this.currentBitrixCall\n\t\t\t&& this.currentBitrixCall.provider !== Provider.Plain;\n\t\t\t/*&&\n\t\t\t\t!(this.currentBitrixCall.associatedEntity.type === 'chat'\n\t\t\t\t&& this.currentBitrixCall.associatedEntity.advanced['chatType'] === 'videoconf');*/\n\n\t\tthis.isShowRoomSettings = BX.prop.getObject(config, 'showRoomSettings', false);\n\t\t\n\t\tif (\n\t\t\t!Util.getRoomPermissions().ScreenShareEnabled\n\t\t\t|| !Util.getRoomPermissions().AudioEnabled\n\t\t\t|| !Util.getRoomPermissions().VideoEnabled)\n\t\t{\n\t\t\tthis.isShowRoomSettings = true;\n\t\t}\n\n\t\tlet events = BX.prop.getObject(config, 'events', {});\n\t\tfor (let eventName in events)\n\t\t{\n\t\t\tif (!events.hasOwnProperty(eventName))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tthis.eventEmitter.subscribe(eventName, events[eventName]);\n\t\t}\n\t}\n\n\trenderSettingsElements()\n\t{\n\t\tthis.roomSettingsElements.screenshare = ParticipantsPermissionSwitcher.create({\n\t\t\ttypeOfSetting: 'screenshare',\n\t\t\tcanControlPermission: true,\n\t\t\tsettingEnabled: Util.getRoomPermissions().ScreenShareEnabled,\n\t\t\tlabel: BX.message('CALL_CONTROL_PERMISSIONS_IN_CALL_LABEL_SCREENSHARE'),\n\t\t\tevents: {\n\t\t\t\tonSwitch: this.onPermissionChanged.bind(this)\n\t\t\t}\n\n\t\t});\n\t\tthis.roomSettingsElements.mic = ParticipantsPermissionSwitcher.create({\n\t\t\ttypeOfSetting: 'mic',\n\t\t\tcanControlPermission: true,\n\t\t\tsettingEnabled: Util.getRoomPermissions().AudioEnabled,\n\t\t\tlabel: BX.message('CALL_CONTROL_PERMISSIONS_IN_CALL_LABEL_MIC'),\n\t\t\tevents: {\n\t\t\t\tonSwitch: this.onPermissionChanged.bind(this)\n\t\t\t}\n\n\t\t});\n\t\tthis.roomSettingsElements.cam = ParticipantsPermissionSwitcher.create({\n\t\t\ttypeOfSetting: 'cam',\n\t\t\tcanControlPermission: true,\n\t\t\tsettingEnabled: Util.getRoomPermissions().VideoEnabled,\n\t\t\tlabel: BX.message('CALL_CONTROL_PERMISSIONS_IN_CALL_LABEL_CAM'),\n\t\t\tevents: {\n\t\t\t\tonSwitch: this.onPermissionChanged.bind(this)\n\t\t\t}\n\n\t\t});\n\n\t\treturn [\n\t\t\tthis.roomSettingsElements.screenshare.render(),\n\t\t\tthis.roomSettingsElements.mic.render(),\n\t\t\tthis.roomSettingsElements.cam.render(),\n\t\t];\n\t}\n\n\tupdateStatePermissions()\n\t{\n\t\tif (this.elements.roomSettings)\n\t\t{\n\t\t\tconst settingsElements = this.renderSettingsElements();\n\t\t\tthis.elements.roomSettings.innerHTML = '';\n\t\t\tthis.elements.roomSettings.append(...settingsElements);\n\t\t}\n\n\t}\n\n\ttoggleRoomSettings(e)\n\t{\n\t\tthis.isShowRoomSettings = !this.isShowRoomSettings;\n\n\t\tif (this.isShowRoomSettings)\n\t\t{\n\t\t\tthis.elements.roomPermissions.classList.add('permissions-uncollapsed');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.roomPermissions.classList.remove('permissions-uncollapsed');\n\t\t}\n\t\t\n\t\tthis.callbacks.onPermissionCollapseStateChanged(this.isShowRoomSettings);\n\t}\n\n\tgetPopupTemplate()\n\t{\n\t\treturn Dom.create('div', {\n\t\t\tprops: { className: 'bx-call-participants-permission-popup__wrapper' },\n\t\t\tchildren: [\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: { className: 'bx-call-participants-permission-popup__content' },\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.elements.roomPermissions = Dom.create('div', {\n\t\t\t\t\t\t\tprops: { className: 'bx-call-participants-permission-popup__permissions-wrapper' },\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\tprops: { className: 'bx-call-participants-permission-popup__permissions-title-wrapper' },\n\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\t\t\t\tthis.toggleRoomSettings();\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\tDom.create('span', {\n\t\t\t\t\t\t\t\t\t\tprops: {className: 'bx-call-participants-permission-popup__permissions-title'},\n\t\t\t\t\t\t\t\t\t\ttext: BX.message('CALL_CONTROL_PERMISSIONS_IN_CALL_TITLE'),\n\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-participants-permission-popup__permissions-title-arrow' },\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t]}),\n\n\t\t\t\t\t\t\t\tthis.elements.roomSettings = Dom.create('div', {\n\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-participants-permission-popup__permissions' },\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t}),\n\n\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\tprops: { className: 'bx-call-participants-permission-popup__control-buttons-label' },\n\t\t\t\t\t\t\ttext: BX.message('CALL_ADMIN_TURN_OFF_FOR_ALL_LABEL'),\n\t\t\t\t\t\t}),\n\n\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\tprops: { className: 'bx-call-participants-permission-popup__control-buttons' },\n\t\t\t\t\t\t\tchildren: [\n\n\t\t\t\t\t\t\t\tthis.turnOffMicContainer = ParticipantsStreamControlButton.create({\n\t\t\t\t\t\t\t\t\ttypeOfStream: 'mic',\n\t\t\t\t\t\t\t\t\tlabel: BX.message('CALL_TURN_OFF_MIC_FOR_ALL_PARTICIPANTS_MSGVER_1'),\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tonTurnOffStreamForAll: this.onTurnOffStreamForAll.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t}).render(),\n\n\t\t\t\t\t\t\t\tthis.turnOffMicContainer = ParticipantsStreamControlButton.create({\n\t\t\t\t\t\t\t\t\ttypeOfStream: 'cam',\n\t\t\t\t\t\t\t\t\tlabel: BX.message('CALL_TURN_OFF_CAM_FOR_ALL_PARTICIPANTS_MSGVER_1'),\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tonTurnOffStreamForAll: this.onTurnOffStreamForAll.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t}).render(),\n\n\t\t\t\t\t\t\t\tthis.turnOffMicContainer = ParticipantsStreamControlButton.create({\n\t\t\t\t\t\t\t\t\ttypeOfStream: 'screenshare',\n\t\t\t\t\t\t\t\t\tlabel: BX.message('CALL_TURN_OFF_SCREENSHARE_FOR_ALL_PARTICIPANTS_MSGVER_1'),\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tonTurnOffStreamForAll: this.onTurnOffStreamForAll.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t}).render(),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t]\n\t\t})\n\t}\n\n\tonPermissionChanged(e)\n\t{\n\t\tthis.callbacks.onPermissionChanged(e.data);\n\t}\n\n\tonTurnOffStreamForAll(e)\n\t{\n\t\tthis.callbacks.turnOffAllParticipansStream(e);\n\t\tthis.close();\n\t}\n\n\tclose()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t}\n\t}\n\n\tcreate()\n\t{\n\t\tconst participantsButton = document.querySelector('.bx-messenger-videocall-top-button-text.callcontrol');\n\t\tconst self = this;\n\t\t\n\t\tif (!participantsButton)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.isShowPopup)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.elements.root = this.getPopupTemplate();\n\n\t\tconst settingsElements = this.renderSettingsElements();\n\t\tthis.elements.roomSettings.innerHTML = '';\n\t\tthis.elements.roomSettings.append(...settingsElements);\n\t\t\n\t\tif (this.isShowRoomSettings)\n\t\t{\n\t\t\tthis.elements.roomPermissions?.classList.add('permissions-uncollapsed');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.roomPermissions?.classList.remove('permissions-uncollapsed');\n\t\t}\n\t\t\n\t\t\n\n\t\tthis.popup = new Popup({\n\t\t\tclassName : 'bx-call-participants-permission-popup',\n\t\t\tbindElement: participantsButton,\n\t\t\ttargetContainer: document.body,\n\t\t\tcontent: this.elements.root,\n\t\t\toffsetTop: 10,\n\t\t\tbindOptions: {\n\t\t\t\tposition: 'bottom'\n\t\t\t},\n\t\t\tautoHide: true,\n\t\t\tcloseByEsc: true,\n\t\t\tbackground: 'linear-gradient(327.21deg, #060825 -10.27%, #173855 103.11%)',\n\t\t\tangle: {position: 'top'},\n\t\t\tcontentNoPaddings: true,\n\t\t\tanimation: 'fading',\n\t\t\tevents: {\n\t\t\t\tonPopupClose: function ()\n\t\t\t\t{\n\t\t\t\t\tself.callbacks.onClose();\n\t\t\t\t\tthis.destroy();\n\t\t\t\t},\n\t\t\t\tonPopupShow: function ()\n\t\t\t\t{\n\t\t\t\t\tself.callbacks.onOpen();\n\t\t\t\t},\n\t\t\t\tonPopupDestroy: function ()\n\t\t\t\t{\n\t\t\t\t\tself.popup = null;\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n\n\tshow()\n\t{\n\t\tthis.create();\n\t\tthis.popup?.show();\n\t}\n\n\ttoggle()\n\t{\n\t\tif (!this.popup)\n\t\t{\n\t\t\tthis.show();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.close();\n\t}\n}\n\n\nconst ParticipantsStreamControlButtonEvents = {\n\tonTurnOffStreamForAll: 'onTurnOffStreamForAll'\n};\n\nclass ParticipantsStreamControlButton\n{\n\tconstructor(config)\n\t{\n\t\tconfig = BX.type.isObject(config) ? config : {};\n\n\t\tthis.label = config.label || '';\n\t\tthis.typeOfStream = config.typeOfStream || '';\n\t\tthis.eventEmitter = new EventEmitter(this, 'ParticipantsStreamControl');\n\n\t\tlet events = BX.prop.getObject(config, 'events', {});\n\t\tfor (let eventName in events)\n\t\t{\n\t\t\tif (!events.hasOwnProperty(eventName))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tthis.eventEmitter.subscribe(eventName, events[eventName]);\n\t\t}\n\t}\n\n\tstatic create(config)\n\t{\n\t\treturn new ParticipantsStreamControlButton(config);\n\t}\n\n\trender()\n\t{\n\t\treturn Dom.create('div', {\n\t\t\tprops: {className: 'bx-call-view-participants-control-stream-button'},\n\t\t\tchildren: [\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: {className: 'bx-call-view-participants-control-stream-button-icon bx-call-view-participants-control-stream-button-icon-' + this.typeOfStream},\n\n\t\t\t\t}),\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: {className: 'bx-call-view-participants-control-stream-button-action'},\n\t\t\t\t\ttext: this.label\n\t\t\t\t})\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: (e) =>\n\t\t\t\t{\n\t\t\t\t\tthis.eventEmitter.emit(ParticipantsStreamControlButtonEvents.onTurnOffStreamForAll, {\n\t\t\t\t\t\ttypeOfStream: this.typeOfStream\n\t\t\t\t\t})\n\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n}\n\nconst ParticipantsPermissionSwitcherEvents = {\n\tonSwitch: 'onSwitch',\n};\n\nclass ParticipantsPermissionSwitcher\n{\n\tconstructor(config)\n\t{\n\t\tconfig = BX.type.isObject(config) ? config : {};\n\n\t\tthis.label = config.label || '';\n\t\tthis.typeOfSetting = config.typeOfSetting || '';\n\t\tthis.canControlPermission = config.canControlPermission || false;\n\t\tthis.settingEnabled = config.settingEnabled || false;\n\t\tthis.eventEmitter = new EventEmitter(this, 'ParticipantsPermissionSwitcher');\n\n\t\tlet events = BX.prop.getObject(config, 'events', {});\n\t\tfor (let eventName in events)\n\t\t{\n\t\t\tif (!events.hasOwnProperty(eventName))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tthis.eventEmitter.subscribe(eventName, events[eventName]);\n\t\t}\n\t}\n\n\tstatic create(config)\n\t{\n\t\treturn new ParticipantsPermissionSwitcher(config);\n\t}\n\n\tonSwitchToggled(e)\n\t{\n\t\tif (!this.canControlPermission)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.settingEnabled = !this.settingEnabled;\n\n\t\tthis.eventEmitter.emit(ParticipantsPermissionSwitcherEvents.onSwitch, {\n\t\t\tsettingEnabled: this.settingEnabled,\n\t\t\ttypeOfSetting: this.typeOfSetting,\n\t\t})\n\t}\n\n\trender()\n\t{\n\t\treturn Dom.create('div', {\n\t\t\tprops: {\n\t\t\t\tclassName: 'bx-call-view-participants-permissions-switch-wrapper',\n\t\t\t},\n\t\t\tdataset: {\n\t\t\t\tid: 'call-participants-permissions-switch-' + this.typeOfSetting,\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create('span', {\n\t\t\t\t\tprops: {className: 'bx-call-view-participants-permissions-label'},\n\t\t\t\t\ttext: this.label\n\n\t\t\t\t}),\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: {className: 'bx-call-view-participants-permissions-switch'},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\t(new BX.UI.Switcher({\n\t\t\t\t\t\t\tsize: 'small',\n\t\t\t\t\t\t\tchecked: this.settingEnabled,\n\t\t\t\t\t\t\thandlers: {\n\t\t\t\t\t\t\t\ttoggled: this.onSwitchToggled.bind(this)\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tdisabled: !this.canControlPermission,\n\t\t\t\t\t\t})).getNode()\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t]\n\t\t});\n\t}\n}","import {Loc, Browser, Dom, Type, Text, Reflection, ZIndexManager} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {Popup, Menu} from 'main.popup';\nimport {MessageBox, MessageBoxButtons} from 'ui.dialogs.messagebox';\nimport {Button} from 'ui.buttons';\nimport {LocalStorage} from 'im.lib.localstorage';\nimport { DesktopApi } from 'im.v2.lib.desktop-api';\nimport { SoundType } from 'im.v2.const';\nimport {DesktopDownload} from 'intranet.desktop-download';\n\nimport {BackgroundDialog} from './dialogs/background_dialog'\nimport {PromoPopup, PromoPopup3D} from './dialogs/promo_popup';\nimport {IncomingNotification} from './dialogs/incoming_notification';\nimport {ConferenceNotifications} from './dialogs/conference_notification';\nimport {CallHint} from './call_hint_popup';\nimport { UnsupportedBrowserFeatures } from './engine/unsupported_features_in_browsers';\nimport {Sidebar} from './sidebar';\nimport { CopilotNotify, CopilotNotifyType } from './view/copilot-notify';\nimport { RecordWithCopilotPopup } from './view/record-with-copilot-popup';\nimport {WebScreenSharePopup} from './web_screenshare_popup';\nimport {FloatingScreenShare} from './floating_screenshare';\nimport {\n\tCallEngine,\n\tUserState,\n\tProvider,\n\tCallState,\n\tCallEvent,\n\tDisconnectReason,\n\tCallScheme,\n\tStartCallErrorCode,\n} from './engine/engine';\nimport {CallEngineLegacy} from './engine/engine_legacy';\nimport {BitrixCall} from './engine/bitrix_call_legacy'\nimport {VoximplantCall} from './engine/voximplant_call'\nimport {PlainCall} from './engine/plain_call';\nimport {SimpleVAD} from './engine/simple_vad';\nimport {Hardware} from './call_hardware';\nimport {View} from './view/view';\nimport {VideoStrategy} from './video_strategy';\nimport Util from './util';\nimport { Utils } from 'im.v2.lib.utils';\nimport { Analytics } from 'call.lib.analytics';\nimport { CallTokenManager } from 'call.lib.call-token-manager';\nimport { CopilotPopup, CopilotPopupType } from './view/copilot-popup';\nimport { CallAI } from './call_ai';\nimport { JoinResponseError, RecorderStatus } from './call_api.js';\nimport { ParticipantsPermissionPopup } from './view/participants-permission-popup';\nimport {PictureInPictureWindow} from './view/pictureInPictureWindow';\nimport { CallSettingsManager } from 'call.lib.settings-manager';\nimport { CallMultiChannel } from './call_multi_channel';\n\nimport './css/call-overlay.css';\n\nconst Events = {\n\tonViewStateChanged: 'onViewStateChanged',\n\tonOpenVideoConference: 'onOpenVideoConference',\n\tonPromoViewed: 'onPromoViewed',\n\tonCallJoined: 'onCallJoined',\n\tonCallLeft: 'onCallLeft',\n\tonCallDestroyed: 'onCallDestroyed',\n};\n\nconst ViewState = {\n\tOpened: 'Opened',\n\tClosed: 'Closed',\n\tFolded: 'Folded'\n};\n\nconst DocumentType = {\n\tResume: 'resume',\n\tBlank: 'blank'\n};\n\nconst FeatureState = {\n\tEnabled: 'enabled',\n\tDisabled: 'disabled',\n\tLimited: 'limited',\n}\n\nconst DOC_EDITOR_WIDTH = 961;\nconst DOC_TEMPLATE_WIDTH = 328;\nconst DOC_CREATED_EVENT = 'CallController::documentCreated';\nconst DOCUMENT_PROMO_CODE = 'im:call-document:16102021:web';\nconst DOCUMENT_PROMO_DELAY = 5 * 60 * 1000; // 5 minutes\nconst FILE_TYPE_DOCX = 'docx';\nconst FILE_TYPE_XLSX = 'xlsx';\nconst FILE_TYPE_PPTX = 'pptx';\n\nconst BALLOON_OFFSET_CLASS_NAME = 'bx-call-control-notification-right-offset';\n\nconst MASK_PROMO_CODE = 'im:mask:06122022:desktop';\nconst MASK_PROMO_DELAY = 5 * 60 * 1000; // 5 minutes\n\ntype UserData = {\n\tid: number,\n\tname: string,\n\tavatar: string,\n\tavatar_hr: string,\n\trole: string,\n\tgender: string\n}\n\ntype InviteParams = {\n\tviewElement: HTMLElement,\n\tbindElement: HTMLElement,\n\tzIndex: number,\n\tdarkMode: boolean,\n\tidleUsers: number[],\n\tallowNewUsers: boolean,\n\tonDestroy: () => void,\n\tonSelect: ({user: UserData}) => void\n}\n\ntype Closer = {\n\tclose: () => void\n}\n\ntype MessengerFacade = {\n\tgetDefaultZIndex: () => number,\n\tisThemeDark: () => boolean,\n\tgetContainer: () => HTMLElement,\n\topenMessenger: (dialogId: string) => Promise,\n\topenHistory: (dialogId: string) => Promise,\n\topenSettings: (params: any) => void,\n\topenHelpArticle: (string) => void,\n\tisPromoRequired: (string) => boolean,\n\tisMessengerOpen: () => boolean,\n\tisSliderFocused: () => boolean,\n\tshowUserSelector?: (params: InviteParams) => Promise<Closer>,\n\n\tgetMessageCount: () => number,\n\tgetCurrentDialogId: () => string,\n\n\trepeatSound: (string, number, boolean) => void,\n\tstopRepeatSound: (string) => void\n}\n\nexport class CallController extends EventEmitter\n{\n\tcurrentCall: BitrixCall | PlainCall | VoximplantCall | null\n\tcurrentCallIsNew: false\n\tcallNotification: ?IncomingNotification\n\tfloatingScreenShareWindow: ?FloatingScreenShare\n\tcallView: ?View\n\tlanguage: string\n\tincomingVideoStrategyType: string\n\tformatRecordDate: string\n\tmessengerFacade: MessengerFacade\n\n\tconstructor(config)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Call.Controller');\n\n\t\tconst needInit = BX.prop.getBoolean(config, \"init\", true);\n\n\t\tthis.language = config.language || 'en';\n\t\tthis.incomingVideoStrategyType = config.incomingVideoStrategyType || VideoStrategy.Type.AllowAll;\n\t\tthis.formatRecordDate = config.formatRecordDate || 'd.m.Y';\n\n\t\tthis.messengerFacade = config.messengerFacade;\n\n\t\tthis.inited = false;\n\t\tthis.debug = false;\n\n\t\tthis.container = null;\n\t\tthis.docEditor = null;\n\t\tthis.docEditorIframe = null;\n\t\tthis.maxEditorWidth = DOC_TEMPLATE_WIDTH;\n\t\tthis.docCreatedForCurrentCall = false;\n\n\t\tthis.folded = false;\n\n\t\tthis.localStream = null;\n\t\tthis.audioRingtone = SoundType.ringtoneModern;\n\n\t\t// for setting the camera after reconnect\n\t\tthis.lastUsedCameraId = null;\n\t\tthis.reconnectingCameraId = null;\n\n\t\tthis.childCall = null;\n\t\tthis.invitePopup = null;\n\t\t/** @var {VideoStrategy} this.currentCall */\n\t\tthis.videoStrategy = null;\n\n\t\tthis.isHttps = window.location.protocol === \"https:\";\n\t\tthis.callWithLegacyMobile = false;\n\n\t\tthis.featureScreenSharing = FeatureState.Enabled;\n\t\tthis.featureRecord = FeatureState.Enabled;\n\n\t\tthis.screenShareStartTime = null;\n\n\t\tthis.callRecordState = View.RecordState.Stopped;\n\t\tthis.callRecordType = View.RecordType.None;\n\t\tthis.callRecordInitiatorId = null;\n\t\tthis.callRecordInfo = null;\n\n\t\tthis.autoCloseCallView = true;\n\n\t\tthis.talkingUsers = {};\n\n\t\tthis.promotedToAdminTimeoutValue = 10 * 1000; // 10 sec\n\t\tthis.promotedToAdminTimeout = null;\n\n\t\tthis.clickLinkInterceptor = null;\n\n\t\tthis._callViewState = ViewState.Closed;\n\n\t\tthis.answeredOrDeclinedCalls = new Set();\n\n\t\t// event handlers\n\t\tthis._onCallUserInvitedHandler = this._onCallUserInvited.bind(this);\n\t\tthis._onCallUserJoinedHandler = this._onCallUserJoined.bind(this);\n\t\tthis._onCallDestroyHandler = this._onCallDestroy.bind(this);\n\t\tthis._onCallUserStateChangedHandler = this._onCallUserStateChanged.bind(this);\n\t\tthis._onCallUserMicrophoneStateHandler = this._onCallUserMicrophoneState.bind(this);\n\t\tthis._onCallUserCameraStateHandler = this._onCallUserCameraState.bind(this);\n\t\tthis._onNeedResetMediaDevicesStateHandler = this._onNeedResetMediaDevicesState.bind(this);\n\t\tthis._onCameraPublishingHandler = this._onCameraPublishing.bind(this);\n\t\tthis._onMicrophonePublishingdHandler = this._onMicrophonePublishingd.bind(this);\n\t\tthis._onCallUserVideoPausedHandler = this._onCallUserVideoPaused.bind(this);\n\t\tthis._onCallLocalMediaReceivedHandler = this._onCallLocalMediaReceived.bind(this);\n\t\tthis._onCallLocalMediaStoppedHandler = this._onCallLocalMediaStopped.bind(this);\n\t\tthis._onCallLocalScreenUpdatedHandler = this._onCallLocalScreenUpdated.bind(this);\n\t\tthis._onCallLocalCameraFlipHandler = this._onCallLocalCameraFlip.bind(this);\n\t\tthis._onCallLocalCameraFlipInDesktopHandler = this._onCallLocalCameraFlipInDesktop.bind(this);\n\t\tthis._onCallRemoteMediaReceivedHandler = this._onCallRemoteMediaReceived.bind(this);\n\t\tthis._onCallRemoteMediaStoppedHandler = this._onCallRemoteMediaStopped.bind(this);\n\t\tthis._onCallBadNetworkIndicatorHandler = this._onCallBadNetworkIndicator.bind(this);\n\t\tthis._onCallConnectionQualityChangedHandler = this._onCallConnectionQualityChanged.bind(this);\n\t\tthis._onCallToggleRemoteParticipantVideoHandler = this._onCallToggleRemoteParticipantVideo.bind(this);\n\t\tthis._onCallUserVoiceStartedHandler = this._onCallUserVoiceStarted.bind(this);\n\t\tthis._onCallUserVoiceStoppedHandler = this._onCallUserVoiceStopped.bind(this);\n\t\tthis._onAllParticipantsAudioMutedHandler = this._onAllParticipantsAudioMuted.bind(this);\n\t\tthis._onAllParticipantsVideoMutedHandler = this._onAllParticipantsVideoMuted.bind(this);\n\t\tthis._onAllParticipantsScreenshareHandler = this._onAllParticipantsScreenshareMuted.bind(this);\n\t\tthis._onYouMuteAllParticipantsHandler = this._onYouMuteAllParticipants.bind(this);\n\t\tthis._onRoomSettingsChangedHandler = this._onRoomSettingsChanged.bind(this);\n\t\tthis._onUserPermissionsChangedHandler = this._onUserPermissionsChanged.bind(this);\n\t\tthis._onUserRoleChangedHandler = this._onUserRoleChanged.bind(this);\n\t\tthis._onParticipantMutedHandler = this._onParticipantMuted.bind(this);\n\t\tthis._onUserStatsReceivedHandler = this._onUserStatsReceived.bind(this);\n\t\tthis._onTrackSubscriptionFailedHandler = this._onTrackSubscriptionFailed.bind(this);\n\t\tthis._onCallUserScreenStateHandler = this._onCallUserScreenState.bind(this);\n\t\tthis._onCallUserRecordStateHandler = this._onCallUserRecordState.bind(this);\n\t\tthis.onCallUserFloorRequestHandler = this._onCallUserFloorRequest.bind(this);\n\t\tthis._onCallFailureHandler = this._onCallFailure.bind(this);\n\t\tthis._onNetworkProblemHandler = this._onNetworkProblem.bind(this);\n\t\tthis._onMicrophoneLevelHandler = this._onMicrophoneLevel.bind(this);\n\t\tthis._onReconnectingHandler = this._onReconnecting.bind(this);\n\t\tthis._onReconnectedHandler = this._onReconnected.bind(this);\n\t\tthis._onReconnectingFailedHandler = this._onReconnectingFailed.bind(this);\n\t\tthis._onCustomMessageHandler = this._onCustomMessage.bind(this);\n\t\tthis._onJoinRoomOfferHandler = this._onJoinRoomOffer.bind(this);\n\t\tthis._onJoinRoomHandler = this._onJoinRoom.bind(this);\n\t\tthis._onLeaveRoomHandler = this._onLeaveRoom.bind(this);\n\t\tthis._onTransferRoomSpeakerHandler = this._onTransferRoomSpeaker.bind(this);\n\t\tthis._onCallLeaveHandler = this._onCallLeave.bind(this);\n\t\tthis._onCallJoinHandler = this._onCallJoin.bind(this);\n\t\tthis._onGetUserMediaEndedHandler = this._onGetUserMediaEnded.bind(this);\n\t\tthis._onUpdateLastUsedCameraIdHandler = this._onUpdateLastUsedCameraId.bind(this);\n\t\tthis._onSwitchTrackRecordStatusHandler = this._onSwitchTrackRecordStatus.bind(this);\n\t\tthis._onRecorderStatusChangedHandler = this._onRecorderStatusChanged.bind(this);\n\n\t\tthis._onBeforeUnloadHandler = this._onBeforeUnload.bind(this);\n\t\tthis._onImTabChangeHandler = this._onImTabChange.bind(this);\n\t\tthis._onUpdateChatCounterHandler = this._onUpdateChatCounter.bind(this);\n\n\t\tthis._onChildCallFirstMediaHandler = this.#onChildCallFirstMedia.bind(this);\n\t\tthis._onChildCallFirstUserJoinedHandler = this.#onChildCallFirstUserJoined.bind(this);\n\n\t\tthis._onWindowFocusHandler = this._onWindowFocus.bind(this);\n\t\tthis._onWindowBlurHandler = this._onWindowBlur.bind(this);\n\t\tthis._onDocumentBodyClickHandler = this._onDocumentBodyClick.bind(this);\n\n\t\tif (DesktopApi.isDesktop() && false)\n\t\t{\n\t\t\tthis.floatingWindow = new FloatingVideo({\n\t\t\t\tonMainAreaClick: this._onFloatingVideoMainAreaClick.bind(this),\n\t\t\t\tonButtonClick: this._onFloatingVideoButtonClick.bind(this)\n\t\t\t});\n\t\t\tthis.floatingWindowUser = 0;\n\t\t}\n\t\tthis.showFloatingWindowTimeout = 0;\n\t\tthis.hideIncomingCallTimeout = 0;\n\t\tthis.ignoreDeclinedCallsTimeout = {};\n\t\tthis.ignoreIncomingNotificationTimeouts = {};\n\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tthis.floatingScreenShareWindow = new FloatingScreenShare({\n\t\t\t\tdarkMode: this.messengerFacade.isThemeDark(),\n\t\t\t\tonBackToCallClick: this._onFloatingScreenShareBackToCallClick.bind(this),\n\t\t\t\tonStopSharingClick: this._onFloatingScreenShareStopClick.bind(this),\n\t\t\t\tonChangeScreenClick: this._onFloatingScreenShareChangeScreenClick.bind(this)\n\t\t\t});\n\t\t}\n\t\tthis.showFloatingScreenShareWindowTimeout = 0;\n\n\t\tthis.mutePopup = null;\n\t\tthis.riseYouHandToTalkPopup = null;\n\t\tthis.allowMutePopup = true;\n\n\t\tthis.webScreenSharePopup = null;\n\n\t\tthis.feedbackPopup = null;\n\n\t\tthis.resizeObserver = new BX.ResizeObserver(this._onResize.bind(this));\n\n\t\tthis.loopTimers = {};\n\n\t\tthis.lastCalledChangeSettingsUserName = BX.message('CALL_DEFAULT_NAME_OF_MODERATOR');\n\t\tthis.isFileChooserActive = false;\n\t\tthis.pictureInPictureDebounceForOpen = null;\n\t\tthis.isWindowFocus = true;\n\n\t\tthis.isCallHangupButtonPressed = false;\n\n\t\tthis.callMultiBroadcastClient = null;\n\n\t\tif (needInit)\n\t\t{\n\t\t\tthis.init();\n\t\t\tthis.#subscribeEvents(config);\n\t\t}\n\t}\n\n\t#subscribeEvents(config)\n\t{\n\t\tconst eventKeys = Object.keys(Events);\n\t\tfor (let eventName of eventKeys)\n\t\t{\n\t\t\tif (Type.isFunction(config.events[eventName]))\n\t\t\t{\n\t\t\t\tthis.subscribe(Events[eventName], config.events[eventName])\n\t\t\t}\n\t\t}\n\t}\n\n\tget userId()\n\t{\n\t\treturn Number(BX.message('USER_ID'))\n\t}\n\n\tget callViewState()\n\t{\n\t\treturn this._callViewState\n\t}\n\n\tset callViewState(newState)\n\t{\n\t\tif (this.callViewState == newState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._callViewState = newState;\n\t\tthis.emit(Events.onViewStateChanged, {\n\t\t\tcallViewState: newState\n\t\t})\n\t}\n\n\tinit()\n\t{\n\t\tBX.addCustomEvent(window, \"CallEvents::incomingCall\", this.onIncomingCall.bind(this));\n\t\tHardware.subscribe(Hardware.Events.deviceChanged, this._onDeviceChange.bind(this));\n\t\tHardware.subscribe(Hardware.Events.onChangeMirroringVideo, this._onCallLocalCameraFlipHandler);\n\n\t\twindow.addEventListener(\"blur\", this._onWindowBlurHandler);\n\t\twindow.addEventListener(\"focus\", this._onWindowFocusHandler);\n\t\tdocument.body.addEventListener('click',this._onDocumentBodyClickHandler);\n\n\t\tif (DesktopApi.isDesktop() && this.floatingWindow)\n\t\t{\n\t\t\twindow.addEventListener(\"blur\", this._onWindowBlurHandler);\n\t\t\twindow.addEventListener(\"focus\", this._onWindowFocusHandler);\n\t\t\tDesktopApi.subscribe(\"BXForegroundChanged\", (focus) =>\n\t\t\t{\n\t\t\t\tif (focus)\n\t\t\t\t{\n\t\t\t\t\tthis._onWindowDesktopFocus();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis._onWindowDesktopBlur();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (DesktopApi.isDesktop() && this.floatingScreenShareWindow)\n\t\t{\n\t\t\tDesktopApi.subscribe(\"BXScreenMediaSharing\", (id, title, x, y, width, height, app) =>\n\t\t\t{\n\t\t\t\tthis.floatingScreenShareWindow.close();\n\n\t\t\t\tthis.floatingScreenShareWindow.setSharingData({\n\t\t\t\t\ttitle: title,\n\t\t\t\t\tx: x,\n\t\t\t\t\ty: y,\n\t\t\t\t\twidth: width,\n\t\t\t\t\theight: height,\n\t\t\t\t\tapp: app\n\t\t\t\t}).then(() =>\n\t\t\t\t{\n\t\t\t\t\tthis.floatingScreenShareWindow.show();\n\t\t\t\t}).catch((error) =>\n\t\t\t\t{\n\t\t\t\t\tconsole.error('setSharingData error', error);\n\t\t\t\t});\n\t\t\t});\n\n\t\t\twindow.addEventListener(\"blur\", this._onWindowBlurHandler);\n\t\t\twindow.addEventListener(\"focus\", this._onWindowFocusHandler);\n\n\t\t\tDesktopApi.subscribe(\"BXForegroundChanged\", (focus) =>\n\t\t\t{\n\t\t\t\tif (focus)\n\t\t\t\t{\n\t\t\t\t\tthis._onWindowDesktopFocus();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis._onWindowDesktopBlur();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.subscribe(Hardware.Events.onChangeMirroringVideo, this._onCallLocalCameraFlipInDesktopHandler);\n\t\t}\n\n\t\tif (window['VoxImplant'])\n\t\t{\n\t\t\tVoxImplant.getInstance().addEventListener(VoxImplant.Events.MicAccessResult, this.voxMicAccessResult.bind(this));\n\t\t}\n\n\t\twindow.addEventListener(\"beforeunload\", this._onBeforeUnloadHandler);\n\t\tBX.addCustomEvent(\"OnDesktopTabChange\", this._onImTabChangeHandler);\n\n\t\tBX.addCustomEvent(window, \"onImUpdateCounterMessage\", this._onUpdateChatCounter.bind(this));\n\n\t\tBX.garbage(this.destroy, this);\n\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tthis.callMultiBroadcastClient = new CallMultiChannel('call_controller_multi_channel');\n\n\t\t\tthis.callMultiBroadcastClient.executer((callUuid) => {\n\t\t\t\tconst currentCallUuid = this.currentCall?.uuid;\n\t\t\t\tconst hasView = Boolean(this.callView);\n\n\t\t\t\tconst hasActiveCall = currentCallUuid === callUuid && hasView;\n\n\t\t\t\tif (hasActiveCall)\n\t\t\t\t{\n\t\t\t\t\tBXDesktopSystem.SetActiveTab();\n\t\t\t\t}\n\n\t\t\t\treturn hasActiveCall;\n\t\t\t});\n\t\t}\n\n\t\tCallEngine.multiBroadcastClient.executer(() => Boolean(this.callView));\n\n\t\tthis.inited = true;\n\t}\n\n\t/**\n\t * Workaround to get current microphoneId\n\t * @param e\n\t */\n\tvoxMicAccessResult(e)\n\t{\n\t\tif (e.stream && e.stream.getAudioTracks().length > 0 && this.callView)\n\t\t{\n\t\t\tthis.callView.microphoneId = e.stream.getAudioTracks()[0].getSettings().deviceId\n\t\t}\n\t}\n\n\tgetCallType(provider = '')\n\t{\n\t\tconst currentProvider = provider || this.currentCall?.provider;\n\n\t\tif (!currentProvider)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\treturn currentProvider === Provider.Plain\n\t\t\t? Analytics.AnalyticsType.private\n\t\t\t: Analytics.AnalyticsType.group\n\t\t;\n\t}\n\n\tgetCallUsers(includeSelf)\n\t{\n\t\tconst result = Object.keys(this.currentCall.getUsers());\n\t\tif (includeSelf)\n\t\t{\n\t\t\tresult.push(this.currentCall.userId);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetActiveCallUsers()\n\t{\n\t\tconst userStates = this.currentCall.getUsers();\n\t\tlet activeUsers = [];\n\n\t\tfor (let userId in userStates)\n\t\t{\n\t\t\tif (userStates.hasOwnProperty(userId))\n\t\t\t{\n\t\t\t\tif (userStates[userId] === UserState.Connected || userStates[userId] === UserState.Connecting || userStates[userId] === UserState.Calling)\n\t\t\t\t{\n\t\t\t\t\tactiveUsers.push(userId);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn activeUsers;\n\t}\n\n\tgetMaxActiveCallUsers()\n\t{\n\t\tconst userStates = this.currentCall.getUsers();\n\t\tlet activeUsers = [];\n\n\t\tfor (let userId in userStates)\n\t\t{\n\t\t\tif (userStates.hasOwnProperty(userId))\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\tuserStates[userId] !== UserState.Declined\n\t\t\t\t\t&& userStates[userId] !== UserState.Busy\n\t\t\t\t\t&& userStates[userId] !== UserState.Unavailable\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tactiveUsers.push(userId);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn activeUsers;\n\t}\n\n\tupdateFloatingWindowContent()\n\t{\n\t\tif (!this.floatingWindow || !this.currentCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.floatingWindow.setTitle(this.currentCall.associatedEntity.name);\n\n\t\tUtil.getUserAvatars(this.currentCall.id, this.getActiveCallUsers()).then((result) =>\n\t\t{\n\t\t\tthis.floatingWindow.setAvatars(result);\n\t\t});\n\t}\n\n\tupdateDeviceIdInChildCall()\n\t{\n\t\tif (!this.childCall || !this.currentCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.currentCall.microphoneId)\n\t\t{\n\t\t\tthis.childCall.setMicrophoneId(this.currentCall.microphoneId);\n\t\t}\n\n\t\tif (this.currentCall.cameraId)\n\t\t{\n\t\t\tthis.childCall.setCameraId(this.currentCall.cameraId);\n\t\t}\n\t}\n\n\tonIncomingCall(e)\n\t{\n\t\tconsole.warn(\"incoming.call\", e);\n\t\t/** @var {BitrixCall|PlainCall|VoximplantCall} newCall */\n\t\tconst newCall = e.call;\n\t\tconst isCurrentCallActive = this.currentCall && (this.callView || this.callNotification);\n\n\t\tthis.callWithLegacyMobile = (e.isLegacyMobile === true);\n\n\t\tconst newCallId = this._getCallIdentifier(newCall);\n\t\tconst currentCallId = this._getCallIdentifier(this.currentCall);\n\n\t\tif (!isCurrentCallActive)\n\t\t{\n\t\t\tif ((newCall.initiatorId == this.userId) || CallEngineLegacy.calls[newCall.parentId])\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.ignoreDeclinedCallsTimeout[newCallId])\n\t\t\t{\n\t\t\t\tclearTimeout(this.ignoreDeclinedCallsTimeout[newCallId]);\n\t\t\t\tthis.ignoreDeclinedCallsTimeout[newCallId] = setTimeout(\n\t\t\t\t\t() => this.answeredOrDeclinedCalls.delete(newCallId),\n\t\t\t\t\t15000\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tthis.callView\n\t\t\t\t|| this.answeredOrDeclinedCalls.has(newCallId)\n\t\t\t\t|| window.BXShowedIncomingCallNotification === newCallId\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.checkDesktop()\n\t\t\t.then(() => {\n\t\t\t\tthis.prepareIncomingCall(e);\n\t\t\t},\n\t\t\t(error) =>\n\t\t\t{\n\t\t\t\tif (this.currentCall)\n\t\t\t\t{\n\t\t\t\t\tthis.removeVideoStrategy();\n\t\t\t\t\tthis.removeCallEvents();\n\t\t\t\t\tthis.currentCall = null;\n\t\t\t\t}\n\n\t\t\t\tif (this.promotedToAdminTimeout)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.promotedToAdminTimeout);\n\t\t\t\t}\n\n\t\t\t\tconsole.error(error);\n\t\t\t\tthis.log(error);\n\t\t\t\tif (!this.isHttps)\n\t\t\t\t{\n\t\t\t\t\tthis.showNotification(BX.message(\"IM_CALL_INCOMING_ERROR_HTTPS_REQUIRED\"))\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.showNotification(BX.message(\"IM_CALL_INCOMING_UNSUPPORTED_BROWSER\"))\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (newCallId === currentCallId)\n\t\t\t{\n\t\t\t\t// ignoring\n\t\t\t}\n\t\t\telse if (newCall.parentUuid === this.currentCall.uuid || (this.currentCall.id && (newCall.parentId === this.currentCall.id)))\n\t\t\t{\n\t\t\t\tif (this.currentCall.isScreenSharingStarted())\n\t\t\t\t{\n\t\t\t\t\tthis.currentCall.stopScreenSharing();\n\t\t\t\t}\n\n\t\t\t\tif (!this.childCall)\n\t\t\t\t{\n\t\t\t\t\tthis.childCall = newCall;\n\t\t\t\t}\n\t\t\t\tthis.callView.removeScreenUsers();\n\n\t\t\t\tif (this.isLegacyCall(this.childCall.provider, this.childCall.scheme))\n\t\t\t\t{\n\t\t\t\t\tthis.childCall.users.forEach((userId) => this.callView.addUser(userId, UserState.Calling));\n\t\t\t\t\tthis.updateCallViewUsers(newCall.id, this.childCall.users);\n\t\t\t\t}\n\n\t\t\t\tthis.callView.updateCopilotFeatureState(this.childCall?.isCopilotFeaturesEnabled);\n\t\t\t\tthis.updateDeviceIdInChildCall();\n\t\t\t\tthis.answerChildCall();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// send busy\n\t\t\t\tnewCall.decline(486);\n\t\t\t\tconst isVideoconf =\n\t\t\t\t\tnewCall.associatedEntity.type === 'chat'\n\t\t\t\t\t&& newCall.associatedEntity.advanced['chatType'] === 'videoconf'\n\t\t\t\t;\n\t\t\t\tconst newCallType = newCall.provider === Provider.Plain\n\t\t\t\t\t? Analytics.AnalyticsType.private\n\t\t\t\t\t: Analytics.AnalyticsType.group\n\t\t\t\t;\n\n\t\t\t\tAnalytics.getInstance().onJoinCall({\n\t\t\t\t\tcallId: newCallId,\n\t\t\t\t\tcallType: isVideoconf ? Analytics.AnalyticsType.videoconf : newCallType,\n\t\t\t\t\tstatus: Analytics.AnalyticsStatus.busy,\n\t\t\t\t\tassociatedEntity: newCall.associatedEntity,\n\t\t\t\t});\n\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n\n\tprepareIncomingCall(e)\n\t{\n\t\t/** @var {BitrixCall|PlainCall|VoximplantCall} newCall */\n\t\tconst newCall = e.call;\n\t\tconst newCallId = this._getCallIdentifier(newCall);\n\n\t\t// don't wait for init here to speedup process\n\t\tHardware.init();\n\t\tif (this.currentCall || newCall.state == CallState.Finished)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.currentCall = newCall;\n\t\tif (!(this.currentCall instanceof PlainCall))\n\t\t{\n\t\t\tconst currentUser = BX.Messenger.v2.Lib.CallManager.getInstance().getCurrentUser();\n\t\t\tUtil.setUserData({[this.userId] : currentUser});\n\t\t}\n\n\t\tthis.bindCallEvents();\n\t\tthis.updateFloatingWindowContent();\n\t\twindow.BXShowedIncomingCallNotification = newCallId;\n\t\tthis.ignoreIncomingNotificationTimeouts[newCallId] = setTimeout(\n\t\t\t() => window.BXShowedIncomingCallNotification = null,\n\t\t\t10000\n\t\t);\n\n\t\tif (this.currentCall.associatedEntity.type === 'chat' && this.currentCall.associatedEntity.advanced['chatType'] === 'videoconf')\n\t\t{\n\t\t\tif (this.isConferencePageOpened(this.currentCall.associatedEntity.id))\n\t\t\t{\n\t\t\t\t// conference page is already opened, do nothing\n\t\t\t\tthis.removeCallEvents();\n\t\t\t\tthis.currentCall = null;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showIncomingConference();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet video = e.video === true;\n\t\t\tthis.showIncomingCall({ video: video });\n\n\t\t\tHardware.init().then(() =>\n\t\t\t{\n\t\t\t\tif (!Hardware.hasCamera())\n\t\t\t\t{\n\t\t\t\t\tif (video)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showNotification(BX.message('IM_CALL_ERROR_NO_CAMERA'));\n\t\t\t\t\t}\n\t\t\t\t\tif (this.callNotification)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.callNotification.setHasCamera(false);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}\n\n\tbindCallEvents()\n\t{\n\t\tthis.currentCall.addEventListener(CallEvent.onUserInvited, this._onCallUserInvitedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserJoined, this._onCallUserJoinedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onDestroy, this._onCallDestroyHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserStateChanged, this._onCallUserStateChangedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserMicrophoneState, this._onCallUserMicrophoneStateHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserCameraState, this._onCallUserCameraStateHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onNeedResetMediaDevicesState, this._onNeedResetMediaDevicesStateHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onCameraPublishing, this._onCameraPublishingHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onMicrophonePublishing, this._onMicrophonePublishingdHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserVideoPaused, this._onCallUserVideoPausedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserScreenState, this._onCallUserScreenStateHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserRecordState, this._onCallUserRecordStateHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserFloorRequest, this.onCallUserFloorRequestHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onLocalMediaReceived, this._onCallLocalMediaReceivedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onLocalMediaStopped, this._onCallLocalMediaStoppedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onLocalScreenUpdated, this._onCallLocalScreenUpdatedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onRemoteMediaReceived, this._onCallRemoteMediaReceivedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onRemoteMediaStopped, this._onCallRemoteMediaStoppedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onBadNetworkIndicator, this._onCallBadNetworkIndicatorHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onConnectionQualityChanged, this._onCallConnectionQualityChangedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onToggleRemoteParticipantVideo, this._onCallToggleRemoteParticipantVideoHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserVoiceStarted, this._onCallUserVoiceStartedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserVoiceStopped, this._onCallUserVoiceStoppedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onAllParticipantsAudioMuted, this._onAllParticipantsAudioMutedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onAllParticipantsVideoMuted, this._onAllParticipantsVideoMutedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onAllParticipantsScreenshareMuted, this._onAllParticipantsScreenshareHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onRoomSettingsChanged, this._onRoomSettingsChangedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserPermissionsChanged, this._onUserPermissionsChangedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserRoleChanged, this._onUserRoleChangedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onYouMuteAllParticipants, this._onYouMuteAllParticipantsHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onParticipantMuted, this._onParticipantMutedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserStatsReceived, this._onUserStatsReceivedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onTrackSubscriptionFailed, this._onTrackSubscriptionFailedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onCallFailure, this._onCallFailureHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onNetworkProblem, this._onNetworkProblemHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onMicrophoneLevel, this._onMicrophoneLevelHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onReconnecting, this._onReconnectingHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onReconnected, this._onReconnectedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onReconnectingFailed, this._onReconnectingFailedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onCustomMessage, this._onCustomMessageHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onJoinRoomOffer, this._onJoinRoomOfferHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onJoinRoom, this._onJoinRoomHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onLeaveRoom, this._onLeaveRoomHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onTransferRoomSpeaker, this._onTransferRoomSpeakerHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onJoin, this._onCallJoinHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onLeave, this._onCallLeaveHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onGetUserMediaEnded, this._onGetUserMediaEndedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUpdateLastUsedCameraId, this._onUpdateLastUsedCameraIdHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onSwitchTrackRecordStatus, this._onSwitchTrackRecordStatusHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onRecorderStatusChanged, this._onRecorderStatusChangedHandler);\n\t}\n\n\tremoveCallEvents()\n\t{\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserInvited, this._onCallUserInvitedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserJoined, this._onCallUserJoinedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onDestroy, this._onCallDestroyHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserStateChanged, this._onCallUserStateChangedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserMicrophoneState, this._onCallUserMicrophoneStateHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserCameraState, this._onCallUserCameraStateHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onNeedResetMediaDevicesState, this._onNeedResetMediaDevicesStateHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onCameraPublishing, this._onCameraPublishingHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onMicrophonePublishing, this._onMicrophonePublishingdHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserVideoPaused, this._onCallUserVideoPausedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserScreenState, this._onCallUserScreenStateHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserRecordState, this._onCallUserRecordStateHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserFloorRequest, this.onCallUserFloorRequestHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onLocalMediaReceived, this._onCallLocalMediaReceivedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onLocalMediaStopped, this._onCallLocalMediaStoppedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onLocalScreenUpdated, this._onCallLocalScreenUpdatedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onRemoteMediaReceived, this._onCallRemoteMediaReceivedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onRemoteMediaStopped, this._onCallRemoteMediaStoppedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onBadNetworkIndicator, this._onCallBadNetworkIndicatorHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onConnectionQualityChanged, this._onCallConnectionQualityChangedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onToggleRemoteParticipantVideo, this._onCallToggleRemoteParticipantVideoHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserVoiceStarted, this._onCallUserVoiceStartedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserVoiceStopped, this._onCallUserVoiceStoppedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onAllParticipantsAudioMuted, this._onAllParticipantsAudioMutedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onAllParticipantsVideoMuted, this._onAllParticipantsVideoMutedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onAllParticipantsScreenshareMuted, this._onAllParticipantsScreenshareMutedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onRoomSettingsChanged, this._onRoomSettingsChangedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserPermissionsChanged, this._onUserPermissionsChangedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserRoleChanged, this._onUserRoleChangedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onYouMuteAllParticipants, this._onYouMuteAllParticipantsHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onParticipantMuted, this._onParticipantMutedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserStatsReceived, this._onUserStatsReceivedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onTrackSubscriptionFailed, this._onTrackSubscriptionFailedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onCallFailure, this._onCallFailureHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onNetworkProblem, this._onNetworkProblemHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onMicrophoneLevel, this._onMicrophoneLevelHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onReconnecting, this._onReconnectingHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onReconnected, this._onReconnectedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onReconnectingFailed, this._onReconnectingFailedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onCustomMessage, this._onCustomMessageHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onJoin, this._onCallJoinHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onLeave, this._onCallLeaveHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onGetUserMediaEnded, this._onGetUserMediaEndedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUpdateLastUsedCameraId, this._onUpdateLastUsedCameraIdHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onSwitchTrackRecordStatus, this._onSwitchTrackRecordStatusHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onRecorderStatusChanged, this._onRecorderStatusChangedHandler);\n\t}\n\n\tbindCallViewEvents()\n\t{\n\t\tthis.callView.setCallback(View.Event.onShow, this._onCallViewShow.bind(this));\n\t\tthis.callView.setCallback(View.Event.onClose, this._onCallViewClose.bind(this));\n\t\tthis.callView.setCallback(View.Event.onDestroy, this._onCallViewDestroy.bind(this));\n\t\tthis.callView.setCallback(View.Event.onButtonClick, this._onCallViewButtonClick.bind(this));\n\t\tthis.callView.setCallback(View.Event.onBodyClick, this._onCallViewBodyClick.bind(this));\n\t\tthis.callView.setCallback(View.Event.onReplaceCamera, this._onCallViewReplaceCamera.bind(this));\n\t\tthis.callView.setCallback(View.Event.onReplaceMicrophone, this._onCallViewReplaceMicrophone.bind(this));\n\t\tthis.callView.setCallback(View.Event.onSetCentralUser, this._onCallViewSetCentralUser.bind(this));\n\t\tthis.callView.setCallback(View.Event.onChangeHdVideo, this._onCallViewChangeHdVideo.bind(this));\n\t\tthis.callView.setCallback(View.Event.onChangeMicAutoParams, this._onCallViewChangeMicAutoParams.bind(this));\n\t\tthis.callView.setCallback(View.Event.onChangeFaceImprove, this._onCallViewChangeFaceImprove.bind(this));\n\t\tthis.callView.setCallback(View.Event.onOpenAdvancedSettings, this._onCallViewOpenAdvancedSettings.bind(this));\n\t\tthis.callView.setCallback(View.Event.onReplaceSpeaker, this._onCallViewReplaceSpeaker.bind(this));\n\t\tthis.callView.setCallback(View.Event.onHasMainStream, this._onCallViewHasMainStream.bind(this));\n\t\tthis.callView.setCallback(View.Event.onTurnOffParticipantMic, this._onCallViewTurnOffParticipantMic.bind(this));\n\t\tthis.callView.setCallback(View.Event.onTurnOffParticipantCam, this._onCallViewTurnOffParticipantCam.bind(this));\n\t\tthis.callView.setCallback(View.Event.onTurnOffParticipantScreenshare, this._onCallViewTurnOffParticipantScreenshare.bind(this));\n\t\tthis.callView.setCallback(View.Event.onAllowSpeakPermission, this._onCallViewAllowSpeakPermission.bind(this));\n\t\tthis.callView.setCallback(View.Event.onDisallowSpeakPermission, this._onCallViewDisallowSpeakPermission.bind(this));\n\t\tthis.callView.setCallback(View.Event.onToggleSubscribe, this._onCallToggleSubscribe.bind(this));\n\t\tthis.callView.setCallback(View.Event.onUserClick, this._onCallUserClick.bind(this));\n\t\tthis.callView.setCallback(View.Event.onPiPClose, this._onPipClose.bind(this));\n\t}\n\n\tupdateCallViewUsers(callId, userList)\n\t{\n\t\tif (!this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst convertAllItemsToInt = (arr) => Array.from(arr, (item) => parseFloat(item))\n\t\tconst userListInt = convertAllItemsToInt(userList)\n\n\t\tlet userDataInt = []\n\t\tlet notIncludedEl = []\n\n\t\tif (this.currentCall.userData)\n\t\t{\n\t\t\tthis.callView.updateUserData(this.currentCall.userData);\n\n\t\t\tuserDataInt = convertAllItemsToInt(Object.keys(this.currentCall.userData));\n\t\t\tnotIncludedEl = userListInt.filter((id) => userDataInt.indexOf(id) === -1);\n\t\t}\n\n\t\tif (this.currentCall.userData && !notIncludedEl.length)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tUtil.getUsers(callId, userListInt).then((userData) =>\n\t\t{\n\t\t\tthis.callView.updateUserData(userData);\n\t\t});\n\t}\n\n\tcreateVideoStrategy()\n\t{\n\t\tif (this.videoStrategy)\n\t\t{\n\t\t\tthis.videoStrategy.destroy();\n\t\t}\n\n\t\tconst strategyType = this.incomingVideoStrategyType;\n\n\t\tthis.videoStrategy = new VideoStrategy({\n\t\t\tcall: this.currentCall,\n\t\t\tcallView: this.callView,\n\t\t\tstrategyType: strategyType\n\t\t});\n\t}\n\n\tremoveVideoStrategy()\n\t{\n\t\tif (this.videoStrategy)\n\t\t{\n\t\t\tthis.videoStrategy.destroy();\n\t\t}\n\t\tthis.videoStrategy = null;\n\t}\n\n\tsetFeatureScreenSharing(enable)\n\t{\n\t\tthis.featureScreenSharing = enable;\n\t}\n\n\tsetFeatureRecord(enable)\n\t{\n\t\tthis.featureRecord = enable;\n\t}\n\n\tsetVideoStrategyType(type)\n\t{\n\t\tif (this.videoStrategy)\n\t\t{\n\t\t\tthis.videoStrategy.setType(type)\n\t\t}\n\t}\n\n\tgetExternalContainer()\n\t{\n\t\tlet externalContainer = document.querySelector(`.${BX.Messenger.v2.Lib.CallManager.viewContainerClass}`);\n\n\t\tif (!externalContainer)\n\t\t{\n\t\t\texternalContainer = BX.create('div', {\n\t\t\t\tprops: { className: BX.Messenger.v2.Lib.CallManager.viewContainerClass },\n\t\t\t});\n\n\t\t\tdocument.body.appendChild(externalContainer);\n\t\t}\n\n\t\treturn externalContainer;\n\t}\n\n\tcreateContainer()\n\t{\n\t\tthis.container = BX.create(\"div\", {\n\t\t\tprops: {className: `bx-messenger-call-overlay ${Util.isChatMountInPage() ? '--fixed' : ''}`},\n\t\t});\n\n\t\tconst externalContainer = this.getExternalContainer();\n\t\texternalContainer.insertBefore(this.container, externalContainer.firstChild);\n\n\t\tZIndexManager.getOrAddStack(document.body).register(this.container);\n\n\t\texternalContainer.classList.add(\"bx-messenger-call\");\n\t}\n\n\tremoveContainer()\n\t{\n\t\tif (this.container)\n\t\t{\n\t\t\tZIndexManager.getStack(document.body).unregister(this.container);\n\t\t\tDom.remove(this.container);\n\t\t\tthis.container = null;\n\t\t\tthis.getExternalContainer().classList.remove(\"bx-messenger-call\");\n\t\t}\n\t}\n\n\tanswerChildCall()\n\t{\n\t\tthis.removeCallEvents();\n\t\tthis.removeVideoStrategy();\n\t\tthis.childCall.addEventListener(CallEvent.onUserJoined, this._onChildCallFirstUserJoinedHandler);\n\t\tthis.childCall.addEventListener(CallEvent.onRemoteMediaReceived, this._onChildCallFirstMediaHandler);\n\t\tthis.childCall.addEventListener(CallEvent.onLocalMediaReceived, this._onCallLocalMediaReceivedHandler);\n\t\tthis.childCall.answer();\n\t}\n\n\tsetReconnectingCameraId(id)\n\t{\n\t\tthis.reconnectingCameraId = id;\n\n\t\tif (id) {\n\t\t\tthis.updateCameraSettingsInCurrentCallAfterReconnecting(id)\n\t\t}\n\t}\n\n\tupdateCameraSettingsInCurrentCallAfterReconnecting(cameraId)\n\t{\n\n\t\tif (this.currentCall.cameraId === cameraId) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst devicesList = Hardware.getCameraList();\n\n\t\tif (!devicesList.find(device => device.deviceId === cameraId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.currentCall.setCameraId(cameraId);\n\t\tthis.setReconnectingCameraId(null);\n\t}\n\n\t#onChildCallFirstMedia(e)\n\t{\n\t\tif (!this.childCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#switchToChildCall();\n\t\tthis.#setUserMedia(e);\n\t}\n\n\t#onChildCallFirstUserJoined(e)\n\t{\n\t\tif (!this.childCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#switchToChildCall();\n\t\tthis._onCallUserJoined(e);\n\t}\n\n\t#switchToChildCall()\n\t{\n\t\tif (!this.childCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.log('Finishing one-to-one call, switching to group call');\n\n\t\tconst newCall = this.childCall;\n\t\tthis.childCall = null;\n\n\t\tlet previousRecordType = View.RecordType.None;\n\n\t\tif (this.isRecording())\n\t\t{\n\t\t\tpreviousRecordType = this.callRecordType;\n\t\t\tthis.#stopRecordCall();\n\t\t}\n\n\t\tthis.callView.showButtons(['floorRequest', 'hangupOptions'])\n\n\t\tnewCall.removeEventListener(CallEvent.onUserJoined, this._onChildCallFirstMediaHandler);\n\t\tnewCall.removeEventListener(CallEvent.onRemoteMediaReceived, this._onChildCallFirstUserJoinedHandler);\n\t\tnewCall.removeEventListener(CallEvent.onLocalMediaReceived, this._onCallLocalMediaReceivedHandler);\n\t\tnewCall.removeEventListener(CallEvent.onUserStateChanged, this._onCallUserStateChangedHandler);\n\n\t\tthis.removeCallEvents();\n\t\tconst oldCall = this.currentCall;\n\n\t\tAnalytics.getInstance().onFinishCall({\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t\tstatus: Analytics.AnalyticsStatus.privateToGroup,\n\t\t\tchatId: this.currentCall.associatedEntity.id,\n\t\t\tcallUsersCount: this.getMaxActiveCallUsers().length,\n\t\t\tcallLength: Util.getTimeInSeconds(this.currentCall.startDate),\n\t\t});\n\n\t\toldCall.hangup();\n\n\t\tthis.currentCall = newCall;\n\n\t\tif (this.currentCall.associatedEntity && this.currentCall.associatedEntity.id)\n\t\t{\n\t\t\tthis.messengerFacade.openMessenger(this.currentCall.associatedEntity.id);\n\t\t}\n\n\t\tthis.bindCallEvents();\n\t\tthis.createVideoStrategy();\n\n\t\tif (previousRecordType !== View.RecordType.None)\n\t\t{\n\t\t\tthis._startRecordCall(previousRecordType);\n\t\t}\n\t}\n\n\tcheckDesktop()\n\t{\n\t\tif (Reflection.getClass('BX.Messenger.v2.Lib.DesktopManager'))\n\t\t{\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tconst desktop = BX.Messenger.v2.Lib.DesktopManager.getInstance();\n\t\t\t\tdesktop.checkStatusInDifferentContext()\n\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\tif (result === false)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tif (Reflection.getClass('BX.desktopUtils'))\n\t\t{\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tBX.desktopUtils.runningCheck(\n\t\t\t\t\t() => {},\n\t\t\t\t\t() => resolve()\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\n\t\treturn Promise.resolve();\n\t}\n\n\tisMutedPopupAllowed()\n\t{\n\t\tif (!this.allowMutePopup || !this.currentCall)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst currentRoom = this.currentCall.currentRoom && this.currentCall.currentRoom();\n\t\treturn !currentRoom || currentRoom.speaker == this.userId;\n\t}\n\n\tisConferencePageOpened(dialogId)\n\t{\n\t\tconst tagPresent = LocalStorage.get(\n\t\t\tCallEngine.getSiteId(),\n\t\t\tCallEngine.getCurrentUserId(),\n\t\t\tCallEngine.getConferencePageTag(dialogId),\n\t\t\t'N'\n\t\t);\n\n\t\treturn tagPresent === 'Y';\n\t}\n\n\t/**\n\t * @param {Object} params\n\t * @param {bool} [params.video = false]\n\t */\n\tshowIncomingCall(params)\n\t{\n\t\tif (!Type.isPlainObject(params))\n\t\t{\n\t\t\tparams = {};\n\t\t}\n\t\tparams.video = params.video === true;\n\n\t\tif (this.feedbackPopup)\n\t\t{\n\t\t\tthis.feedbackPopup.close();\n\t\t}\n\n\t\tconst allowVideo = this.callWithLegacyMobile ? params.video === true : true;\n\n\t\tthis.callNotification = new IncomingNotification({\n\t\t\tcallerName: this.currentCall.associatedEntity.name,\n\t\t\tcallerAvatar: this.currentCall.associatedEntity.avatar,\n\t\t\tcallerType: this.currentCall.associatedEntity.advanced.chatType,\n\t\t\tcallerColor: this.currentCall.associatedEntity.avatarColor,\n\t\t\tvideo: params.video,\n\t\t\thasCamera: allowVideo,\n\t\t\tcameraState: allowVideo,\n\t\t\tmicrophoneState: !(this.currentCall.associatedEntity.userCounter > this.getMaxActiveMicrophonesCount()),\n\t\t\tzIndex: this.messengerFacade.getDefaultZIndex() + 200,\n\t\t\tonClose: this._onCallNotificationClose.bind(this),\n\t\t\tonDestroy: this._onCallNotificationDestroy.bind(this),\n\t\t\tonButtonClick: this._onCallNotificationButtonClick.bind(this),\n\t\t\tisMessengerOpen: this.messengerFacade.isMessengerOpen(),\n\t\t});\n\n\t\tthis.callNotification.show();\n\t\tthis.scheduleCancelNotification(false);\n\n\t\tthis.messengerFacade.repeatSound(this.audioRingtone, 3500, true);\n\t}\n\n\tshowIncomingConference()\n\t{\n\t\tthis.callNotification = new ConferenceNotifications({\n\t\t\tzIndex: this.messengerFacade.getDefaultZIndex() + 200,\n\t\t\tcallerName: this.currentCall.associatedEntity.name,\n\t\t\tcallerAvatar: this.currentCall.associatedEntity.avatar,\n\t\t\tcallerColor: this.currentCall.associatedEntity.avatarColor,\n\t\t\tonClose: this._onCallNotificationClose.bind(this),\n\t\t\tonDestroy: this._onCallNotificationDestroy.bind(this),\n\t\t\tonButtonClick: this._onCallConferenceNotificationButtonClick.bind(this)\n\t\t});\n\n\t\tthis.callNotification.show();\n\t\tthis.scheduleCancelNotification(true);\n\n\t\tthis.messengerFacade.repeatSound(this.audioRingtone, 3500, true);\n\t}\n\n\tscheduleCancelNotification(isIncomingConference = false)\n\t{\n\t\tclearTimeout(this.hideIncomingCallTimeout);\n\t\tthis.hideIncomingCallTimeout = setTimeout(() =>\n\t\t{\n\t\t\tAnalytics.getInstance().onJoinCall({\n\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\tcallType: isIncomingConference ? Analytics.AnalyticsType.videoconf : this.getCallType(),\n\t\t\t\tstatus: Analytics.AnalyticsStatus.noAnswer,\n\t\t\t\tassociatedEntity: this.currentCall.associatedEntity,\n\t\t\t});\n\n\t\t\tif (this.callNotification)\n\t\t\t{\n\t\t\t\tthis.callNotification.close();\n\t\t\t}\n\t\t\tif (this.currentCall)\n\t\t\t{\n\t\t\t\tthis.removeVideoStrategy();\n\t\t\t\tthis.removeCallEvents();\n\t\t\t\tthis.currentCall = null;\n\t\t\t}\n\t\t\tif (this.promotedToAdminTimeout)\n\t\t\t{\n\t\t\t\tclearTimeout(this.promotedToAdminTimeout);\n\t\t\t}\n\t\t}, 30 * 1000);\n\t}\n\n\tshowNotification(notificationText, actions)\n\t{\n\t\tif (!actions)\n\t\t{\n\t\t\tactions = [];\n\t\t}\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: Text.encode(notificationText),\n\t\t\tposition: \"top-right\",\n\t\t\tautoHideDelay: 5000,\n\t\t\tcloseButton: true,\n\t\t\tactions: actions\n\t\t});\n\t}\n\n\tshowNetworkProblemNotification(notificationText)\n\t{\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: Text.encode(notificationText),\n\t\t\tposition: \"top-right\",\n\t\t\tautoHideDelay: 5000,\n\t\t\tcloseButton: true,\n\t\t\tactions: [{\n\t\t\t\ttitle: BX.message(\"IM_M_CALL_HELP\"),\n\t\t\t\tevents: {\n\t\t\t\t\tclick: (event, balloon) =>\n\t\t\t\t\t{\n\t\t\t\t\t\ttop.BX.Helper.show('redirect=detail&code=12723718');\n\t\t\t\t\t\tballoon.close();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}]\n\t\t});\n\t}\n\n\tshowUnsupportedNotification()\n\t{\n\t\tlet messageBox;\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tmessageBox = new MessageBox({\n\t\t\t\tmessage: BX.message('IM_CALL_DESKTOP_TOO_OLD'),\n\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t\tokCaption: BX.message('IM_M_CALL_BTN_UPDATE'),\n\t\t\t\tcancelCaption: BX.message('IM_NOTIFY_CONFIRM_CLOSE'),\n\t\t\t\tonOk: () =>\n\t\t\t\t{\n\t\t\t\t\tconst url = DesktopDownload.getLinkForCurrentUser();\n\t\t\t\t\twindow.open(url, \"desktopApp\");\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t})\n\t\t}\n\t\telse\n\t\t{\n\t\t\tmessageBox = new MessageBox({\n\t\t\t\tmessage: BX.message('IM_CALL_WEBRTC_USE_CHROME_OR_DESKTOP'),\n\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t\tokCaption: BX.message(\"IM_CALL_DETAILS\"),\n\t\t\t\tcancelCaption: BX.message('IM_NOTIFY_CONFIRM_CLOSE'),\n\t\t\t\tonOk: () =>\n\t\t\t\t{\n\t\t\t\t\ttop.BX.Helper.show(\"redirect=detail&code=11387752\");\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t})\n\t\t}\n\t\tmessageBox.show();\n\t}\n\n\tisUserAgentSupported()\n\t{\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\treturn DesktopApi.getApiVersion() > 48;\n\t\t}\n\t\tif ('VoxImplant' in window)\n\t\t{\n\t\t\treturn VoxImplant.getInstance().isRTCsupported();\n\t\t}\n\t\treturn Util.isWebRTCSupported();\n\t}\n\n\tgetBlockedButtons(needBlockAddButton = false) :string[]\n\t{\n\t\tlet result = ['record', 'copilot'];\n\t\tif (!this.messengerFacade.showUserSelector || needBlockAddButton)\n\t\t{\n\t\t\tresult.push('add')\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprepareCall(callData)\n\t{\n\t\tthis.preparedCall = callData;\n\t}\n\n\tstartCall(dialogId, video, chatInfo)\n\t{\n\t\tif (!this.isUserAgentSupported())\n\t\t{\n\t\t\tthis.showUnsupportedNotification();\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.callView || this.currentCall)\n\t\t{\n\t\t\tthis.unfold();\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.initCallPromise)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.onConnectToCallClick = Date.now();\n\n\t\tif (this.feedbackPopup)\n\t\t{\n\t\t\tthis.feedbackPopup.close();\n\t\t}\n\n\t\tconst call = CallEngineLegacy.getCallWithDialogId(dialogId) || CallEngine.getCallWithDialogId(dialogId);\n\t\tif (call)\n\t\t{\n\t\t\tthis.joinCall(call.id, call.uuid, video, { chatInfo: call.associatedEntity, mustCreate: true });\n\n\t\t\treturn;\n\t\t}\n\n\t\tlet provider = Provider.Plain;\n\t\tif (dialogId.toString().startsWith(\"chat\"))\n\t\t{\n\t\t\tprovider = Util.getConferenceProvider();\n\t\t}\n\n\t\tconst isLegacyCall = this.isLegacyCall(provider);\n\n\t\tconst callTokenPromise = isLegacyCall\n\t\t\t? Promise.resolve()\n\t\t\t: CallTokenManager.getToken(chatInfo.chatId);\n\n\t\tconst isCallPrepared = this.preparedCall?.dialogId === dialogId;\n\n\t\tconst debug1 = +(new Date());\n\t\tthis.initCallPromise = this.messengerFacade.openMessenger(dialogId)\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\treturn Hardware.init();\n\t\t\t})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tif (video && isCallPrepared)\n\t\t\t\t{\n\t\t\t\t\tthis._prepareLocalStream(provider);\n\t\t\t\t}\n\n\t\t\t\tthis.createContainer();\n\t\t\t\tlet hiddenButtons = [];\n\t\t\t\tif (provider === Provider.Plain)\n\t\t\t\t{\n\t\t\t\t\thiddenButtons.push('floorRequest');\n\t\t\t\t\thiddenButtons.push('callconrol');\n\t\t\t\t\thiddenButtons.push('hangupOptions');\n\t\t\t\t}\n\t\t\t\tif (!Util.shouldShowDocumentButton())\n\t\t\t\t{\n\t\t\t\t\thiddenButtons.push('document');\n\t\t\t\t}\n\n\t\t\t\tHardware.isCameraOn = video;\n\n\t\t\t\tthis.callView = new View({\n\t\t\t\t\tcontainer: this.container,\n\t\t\t\t\tbaseZIndex: this.messengerFacade.getDefaultZIndex(),\n\t\t\t\t\tshowChatButtons: true,\n\t\t\t\t\tshowUsersButton: false,\n\t\t\t\t\tuserLimit: Util.getUserLimit(),\n\t\t\t\t\tlanguage: this.language,\n\t\t\t\t\tlayout: dialogId.toString().startsWith(\"chat\") ? View.Layout.Grid : View.Layout.Centered,\n\t\t\t\t\tmicrophoneId: Hardware.defaultMicrophone,\n\t\t\t\t\tshowShareButton: this.featureScreenSharing !== FeatureState.Disabled,\n\t\t\t\t\tshowRecordButton: this.featureRecord !== FeatureState.Disabled,\n\t\t\t\t\thiddenButtons: hiddenButtons,\n\t\t\t\t\tblockedButtons: this.getBlockedButtons(provider === Provider.Plain),\n\t\t\t\t\tshowAddUserButtonInList: provider === Provider.Plain,\n\t\t\t\t\tisCopilotFeaturesEnabled: provider === Provider.Bitrix,\n\t\t\t\t\tisCopilotActive: false,\n\t\t\t\t\tisWindowFocus: this.isWindowFocus,\n\t\t\t\t});\n\n\t\t\t\tthis.bindCallViewEvents();\n\n\t\t\t\tif (isCallPrepared)\n\t\t\t\t{\n\t\t\t\t\tthis.callView.isPreparing = true;\n\t\t\t\t\tif (this.preparedCall.user)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.callView.appendUsers({\n\t\t\t\t\t\t\t[this.preparedCall.user]: UserState.Calling,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tthis.callView.updateUserData(this.preparedCall.userData);\n\t\t\t\t\tUtil.setUserData(this.preparedCall.userData);\n\t\t\t\t\tif (this.localStream)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._setLocalStream(provider);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst style = 'background-color: #AA00AA; color: white;'\n\t\t\t\t\tconsole.log(`%c[debug] Time from click 'Start call' to show call card: ${Date.now() - this.onConnectToCallClick} ms`, style);\n\t\t\t\t\tthis.onCallViewRenderToMediaReceived = Date.now();\n\n\t\t\t\t\tthis.callView.show();\n\t\t\t\t}\n\n\t\t\t\tif (video && !Hardware.hasCamera())\n\t\t\t\t{\n\t\t\t\t\tthis.showNotification(BX.message('IM_CALL_ERROR_NO_CAMERA'));\n\t\t\t\t\tvideo = false;\n\t\t\t\t}\n\n\t\t\t\treturn callTokenPromise;\n\t\t\t})\n\t\t\t.then((callToken) =>\n\t\t\t{\n\t\t\t\tif (!this.isLegacyCall(provider) && !callToken)\n\t\t\t\t{\n\t\t\t\t\tthrow new Error('Empty callToken');\n\t\t\t\t}\n\n\t\t\t\tconst callEngine = isLegacyCall\n\t\t\t\t\t? CallEngineLegacy\n\t\t\t\t\t: CallEngine;\n\n\t\t\t\treturn callEngine.createCall({\n\t\t\t\t\tentityType: 'chat',\n\t\t\t\t\tentityId: dialogId,\n\t\t\t\t\tprovider: provider,\n\t\t\t\t\tvideoEnabled: !!video,\n\t\t\t\t\tenableMicAutoParameters: Hardware.enableMicAutoParameters,\n\t\t\t\t\tjoinExisting: true,\n\t\t\t\t\tdebug: this.debug,\n\t\t\t\t\ttoken: callToken,\n\t\t\t\t\tchatInfo: chatInfo,\n\t\t\t\t});\n\t\t\t})\n\t\t\t.then((e) => {\n\t\t\t\tif (!this.initCallPromise)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst debug2 = Date.now();\n\t\t\t\tthis.currentCall = e.call;\n\t\t\t\tthis.currentCallIsNew = e.isNew;\n\n\t\t\t\tif (this.promotedToAdminTimeout)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.promotedToAdminTimeout);\n\t\t\t\t}\n\n\t\t\t\tif (!this.callView)\n\t\t\t\t{\n\t\t\t\t\tthis.leaveCurrentCall(true);\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tif (isLegacyCall)\n\t\t\t\t{\n\t\t\t\t\tthis._onUpdateCallCopilotState(this.currentCall.isCopilotActive);\n\t\t\t\t}\n\n\t\t\t\tthis.log(\"Call creation time: \" + (debug2 - debug1) / 1000 + \" seconds\");\n\n\t\t\t\tif (this.currentCall.isCopilotActive && isLegacyCall)\n\t\t\t\t{\n\t\t\t\t\tthis.sendStartCopilotRecordAnalytics({ isAutostart: true });\n\t\t\t\t}\n\n\t\t\t\tthis.currentCall.useHdVideo(Hardware.preferHdQuality);\n\t\t\t\tif (Hardware.defaultMicrophone)\n\t\t\t\t{\n\t\t\t\t\tthis.currentCall.setMicrophoneId(Hardware.defaultMicrophone);\n\t\t\t\t}\n\t\t\t\tif (Hardware.defaultCamera)\n\t\t\t\t{\n\t\t\t\t\tthis.currentCall.setCameraId(Hardware.defaultCamera);\n\t\t\t\t}\n\n\t\t\t\tif (this.currentCall.associatedEntity && this.currentCall.associatedEntity.id)\n\t\t\t\t{\n\t\t\t\t\tif (this.messengerFacade.getCurrentDialogId() != this.currentCall.associatedEntity.id)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.messengerFacade.openMessenger(this.currentCall.associatedEntity.id);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.autoCloseCallView = true;\n\t\t\t\tthis.bindCallEvents();\n\t\t\t\tthis.createVideoStrategy();\n\n\t\t\t\tif (isCallPrepared)\n\t\t\t\t{\n\t\t\t\t\tthis.callView.isPreparing = false;\n\t\t\t\t}\n\n\t\t\t\tif (this.isLegacyCall(this.currentCall.provider, this.currentCall.scheme))\n\t\t\t\t{\n\t\t\t\t\tthis.callView.appendUsers(this.currentCall.getUsers());\n\t\t\t\t\tthis.updateCallViewUsers(this.currentCall.id, this.getCallUsers(true));\n\t\t\t\t}\n\n\t\t\t\tif (!isCallPrepared)\n\t\t\t\t{\n\t\t\t\t\tconst style = 'background-color: #AA00AA; color: white;'\n\t\t\t\t\tconsole.log(`%c[debug] Time from click 'Start call' to show call card: ${Date.now() - this.onConnectToCallClick} ms`, style);\n\t\t\t\t\tthis.onCallViewRenderToMediaReceived = Date.now();\n\t\t\t\t}\n\n\t\t\t\tthis.callView.show();\n\t\t\t\tthis.showCopilotNotify(true);\n\n\t\t\t\tthis.showDocumentPromo();\n\t\t\t\tthis.showMaskPromo();\n\n\t\t\t\tif (this.currentCallIsNew)\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"Inviting users\");\n\t\t\t\t\tAnalytics.getInstance().onStartCall({\n\t\t\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t\t\tmediaParams: {\n\t\t\t\t\t\t\tvideo: Hardware.isCameraOn,\n\t\t\t\t\t\t\taudio: !Hardware.isMicrophoneMuted,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tstatus: Analytics.AnalyticsStatus.success,\n\t\t\t\t\t\tassociatedEntity: this.currentCall.associatedEntity,\n\t\t\t\t\t\tisCopilotActive: false,\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.currentCall.inviteUsers({users: isLegacyCall ? this.getCallUsers() : []});\n\n\t\t\t\t\tthis.messengerFacade.repeatSound('dialtone', 5000, true);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"Joining existing call\");\n\t\t\t\t\tAnalytics.getInstance().onJoinCall({\n\t\t\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t\t\tmediaParams: {\n\t\t\t\t\t\t\tvideo: Hardware.isCameraOn,\n\t\t\t\t\t\t\taudio: !Hardware.isMicrophoneMuted,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsection: Analytics.AnalyticsSection.chatWindow,\n\t\t\t\t\t\telement: Analytics.AnalyticsElement.videocall,\n\t\t\t\t\t\tstatus: Analytics.AnalyticsStatus.success,\n\t\t\t\t\t\tassociatedEntity: this.currentCall.associatedEntity,\n\t\t\t\t\t});\n\n\t\t\t\t\tif (this.currentCall.associatedEntity.userCounter > this.getMaxActiveMicrophonesCount())\n\t\t\t\t\t{\n\t\t\t\t\t\tHardware.isMicrophoneMuted = true;\n\t\t\t\t\t\tthis.showAutoMicMuteNotification();\n\t\t\t\t\t}\n\t\t\t\t\tthis.currentCall.answer();\n\t\t\t\t}\n\n\t\t\t\tthis._onUpdateLastUsedCameraId();\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\tif (!this.initCallPromise)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconsole.error(error);\n\n\t\t\t\tlet errorCode;\n\t\t\t\tif (typeof (error) == \"string\")\n\t\t\t\t{\n\t\t\t\t\terrorCode = error;\n\t\t\t\t}\n\t\t\t\telse if (Type.isObject(error) && error instanceof JoinResponseError)\n\t\t\t\t{\n\t\t\t\t\terrorCode = error.name;\n\t\t\t\t}\n\t\t\t\telse if (typeof (error) == \"object\" && error.code)\n\t\t\t\t{\n\t\t\t\t\terrorCode = error.code == 'access_denied' ? 'ACCESS_DENIED' : error.code\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\terrorCode = 'UNKNOWN_ERROR';\n\t\t\t\t}\n\n\t\t\t\tif (errorCode === 'user_is_busy')\n\t\t\t\t{\n\t\t\t\t\tthis.leaveCurrentCall();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tAnalytics.getInstance().onStartCallError({\n\t\t\t\t\t\tcallType: this.getCallType(provider),\n\t\t\t\t\t\terrorCode,\n\t\t\t\t\t\terrorMessage: error?.message,\n\t\t\t\t\t});\n\n\t\t\t\t\tthis._onCallFailure({\n\t\t\t\t\t\tcode: errorCode,\n\t\t\t\t\t\tmessage: error.message || '',\n\t\t\t\t\t});\n\n\t\t\t\t\tthis._stopLocalStream();\n\t\t\t\t}\n\t\t\t})\n\t\t\t.finally(() =>\n\t\t\t{\n\t\t\t\tthis.initCallPromise = null;\n\t\t\t\tthis.preparedCall = null;\n\t\t\t});\n\t}\n\n\tcloseCallNotification()\n\t{\n\t\tif (this.callNotification)\n\t\t{\n\t\t\tthis.callNotification.close();\n\t\t}\n\t}\n\n\tjoinCall(\n\t\tcallId: number,\n\t\tcallUuid: string,\n\t\tvideo: boolean,\n\t\toptions: { joinAsViewer?: boolean, chatInfo: {}, mustCreate?: Boolean },\n\t)\n\t{\n\t\tconst joinAsViewer = BX.prop.getBoolean(options, \"joinAsViewer\", false);\n\n\t\tif (!this.isUserAgentSupported())\n\t\t{\n\t\t\tthis.showUnsupportedNotification();\n\t\t\treturn;\n\t\t}\n\n\t\tconst hasActiveCall = this.callView && this.currentCall;\n\n\t\tif (hasActiveCall && this.currentCall.uuid === callUuid)\n\t\t{\n\t\t\tthis.unfold();\n\t\t\treturn;\n\t\t}\n\n\t\tif (hasActiveCall && this.currentCall.uuid !== callUuid)\n\t\t{\n\t\t\tthis.leaveCurrentCall();\n\t\t}\n\n\t\tif (this.initCallPromise)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.onConnectToCallClick = Date.now();\n\n\t\tconst isCallPrepared = this.preparedCall?.dialogId === options.chatInfo.id;\n\t\tconst isGroupCall = options.chatInfo.id.toString().startsWith('chat');\n\t\tconst call = CallEngineLegacy.calls[callId] || CallEngine.calls[callUuid];\n\t\tconst defaultProvider = isGroupCall ? Util.getConferenceProvider() : Provider.Plain;\n\t\tconst provider = call?.provider || defaultProvider;\n\t\tconst isLegacyCall = this.isLegacyCall(provider, call?.scheme);\n\n\t\tthis.log(\"Joining call \" + callUuid);\n\n\t\tthis.initCallPromise = isLegacyCall\n\t\t\t? Promise.resolve()\n\t\t\t: CallTokenManager.getToken(options.chatInfo.chatId);\n\n\t\tthis.initCallPromise\n\t\t\t.then((callToken) => {\n\t\t\t\tlet config = null;\n\t\t\t\tif (options?.mustCreate)\n\t\t\t\t{\n\t\t\t\t\tconfig = {\n\t\t\t\t\t\tprovider,\n\t\t\t\t\t\tentityType: 'chat',\n\t\t\t\t\t\tentityId: options.chatInfo.id,\n\t\t\t\t\t\tvideoEnabled: Boolean(video),\n\t\t\t\t\t\tenableMicAutoParameters: Hardware.enableMicAutoParameters,\n\t\t\t\t\t\tjoinExisting: true,\n\t\t\t\t\t\troomId: callUuid,\n\t\t\t\t\t\tdebug: this.debug,\n\t\t\t\t\t\ttoken: callToken,\n\t\t\t\t\t\tchatInfo: options.chatInfo,\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\treturn isLegacyCall\n\t\t\t\t\t? CallEngineLegacy.getCallWithId(callId)\n\t\t\t\t\t: CallEngine.getCallWithId(callUuid, config);\n\t\t\t})\n\t\t\t.then((result) => {\n\t\t\t\tif (!this.currentCall || (this.currentCall.uuid !== callUuid))\n\t\t\t\t{\n\t\t\t\t\tUtil.setUserData(result.call.userData);\n\t\t\t\t\tthis.currentCall = result.call;\n\t\t\t\t}\n\n\t\t\t\tif (this.promotedToAdminTimeout)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.promotedToAdminTimeout);\n\t\t\t\t}\n\n\t\t\t\treturn this.messengerFacade.openMessenger(options.chatInfo.id);\n\t\t\t})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\treturn Hardware.init();\n\t\t\t})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.createContainer();\n\n\t\t\t\tlet hiddenButtons = [];\n\t\t\t\tif (this.currentCall.provider === Provider.Plain)\n\t\t\t\t{\n\t\t\t\t\thiddenButtons.push('floorRequest');\n\t\t\t\t\thiddenButtons.push('hangupOptions');\n\t\t\t\t\thiddenButtons.push('callconrol');\n\t\t\t\t}\n\t\t\t\tif (!Util.shouldShowDocumentButton())\n\t\t\t\t{\n\t\t\t\t\thiddenButtons.push('document');\n\t\t\t\t}\n\n\t\t\t\tHardware.isCameraOn = !!video;\n\n\t\t\t\tthis.callView = new View({\n\t\t\t\t\tcontainer: this.container,\n\t\t\t\t\tbaseZIndex: this.messengerFacade.getDefaultZIndex(),\n\t\t\t\t\tshowChatButtons: true,\n\t\t\t\t\tshowUsersButton: false,\n\t\t\t\t\tuserLimit: Util.getUserLimit(),\n\t\t\t\t\tlanguage: this.language,\n\t\t\t\t\tlayout: isGroupCall ? View.Layout.Grid : View.Layout.Centered,\n\t\t\t\t\tshowRecordButton: this.featureRecord !== FeatureState.Disabled,\n\t\t\t\t\tmicrophoneId: Hardware.defaultMicrophone,\n\t\t\t\t\thiddenButtons: hiddenButtons,\n\t\t\t\t\tblockedButtons: this.getBlockedButtons(this.currentCall.provider === Provider.Plain),\n\t\t\t\t\tshowAddUserButtonInList: this.currentCall.provider === Provider.Plain,\n\t\t\t\t\tisCopilotFeaturesEnabled: this.currentCall.isCopilotFeaturesEnabled,\n\t\t\t\t\tisCopilotActive: this.currentCall.isCopilotActive,\n\t\t\t\t\tisWindowFocus: this.isWindowFocus,\n\t\t\t\t});\n\t\t\t\tthis.autoCloseCallView = true;\n\t\t\t\tthis.bindCallViewEvents();\n\n\t\t\t\tif (isCallPrepared)\n\t\t\t\t{\n\t\t\t\t\tthis.callView.isPreparing = true;\n\t\t\t\t\tif (this.preparedCall.user)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.callView.appendUsers({\n\t\t\t\t\t\t\t[this.preparedCall.user]: UserState.Calling,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tthis.callView.updateUserData(this.preparedCall.userData);\n\t\t\t\t\tUtil.setUserData(this.preparedCall.userData);\n\t\t\t\t}\n\n\t\t\t\tif (this.isLegacyCall(this.currentCall.provider, this.currentCall.scheme))\n\t\t\t\t{\n\t\t\t\t\tthis.callView.appendUsers(this.currentCall.getUsers());\n\t\t\t\t\tthis.updateCallViewUsers(this.currentCall.id, this.getCallUsers(true));\n\t\t\t\t}\n\n\t\t\t\tconst style = 'background-color: #AA00AA; color: white;'\n\t\t\t\tconsole.log(`%c[debug] Time from click 'Join call' to show call card: ${Date.now() - this.onConnectToCallClick} ms`, style);\n\t\t\t\tthis.onCallViewRenderToMediaReceived = Date.now();\n\n\t\t\t\tthis.callView.show();\n\t\t\t\tthis.showDocumentPromo();\n\t\t\t\tthis.showCopilotNotify();\n\n\t\t\t\tthis.currentCall.useHdVideo(Hardware.preferHdQuality);\n\t\t\t\tif (Hardware.defaultMicrophone)\n\t\t\t\t{\n\t\t\t\t\tthis.currentCall.setMicrophoneId(Hardware.defaultMicrophone);\n\t\t\t\t}\n\t\t\t\tif (Hardware.defaultCamera)\n\t\t\t\t{\n\t\t\t\t\tthis.currentCall.setCameraId(Hardware.defaultCamera);\n\t\t\t\t}\n\n\t\t\t\tthis.bindCallEvents();\n\t\t\t\tthis.createVideoStrategy();\n\n\t\t\t\tif (video && !Hardware.hasCamera())\n\t\t\t\t{\n\t\t\t\t\tthis.showNotification(BX.message('IM_CALL_ERROR_NO_CAMERA'));\n\t\t\t\t\tvideo = false;\n\t\t\t\t}\n\n\t\t\t\tif (this.currentCall.associatedEntity.userCounter > this.getMaxActiveMicrophonesCount())\n\t\t\t\t{\n\t\t\t\t\tHardware.isMicrophoneMuted = true;\n\t\t\t\t\tthis.showAutoMicMuteNotification();\n\t\t\t\t}\n\n\t\t\t\tthis.currentCall.answer({\n\t\t\t\t\tjoinAsViewer: joinAsViewer\n\t\t\t\t});\n\n\t\t\t\tthis._onUpdateLastUsedCameraId();\n\n\t\t\t\tAnalytics.getInstance().onJoinCall({\n\t\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t\tmediaParams: {\n\t\t\t\t\t\tvideo: Hardware.isCameraOn,\n\t\t\t\t\t\taudio: !Hardware.isMicrophoneMuted,\n\t\t\t\t\t},\n\t\t\t\t\tsection: Analytics.AnalyticsSection.chatList,\n\t\t\t\t\telement: Analytics.AnalyticsElement.joinButton,\n\t\t\t\t\tstatus: Analytics.AnalyticsStatus.success,\n\t\t\t\t\tassociatedEntity: this.currentCall.associatedEntity,\n\t\t\t\t});\n\n\t\t\t\tif (isCallPrepared && this.callView)\n\t\t\t\t{\n\t\t\t\t\tthis.callView.isPreparing = false;\n\t\t\t\t}\n\n\t\t\t\tthis.initCallPromise = null;\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\tthis.initCallPromise = null;\n\t\t\t\tlet errorCode = 'UNKNOWN_ERROR';\n\t\t\t\tif (Type.isString(error))\n\t\t\t\t{\n\t\t\t\t\terrorCode = error;\n\t\t\t\t}\n\t\t\t\telse if (Type.isObject(error) && error instanceof JoinResponseError)\n\t\t\t\t{\n\t\t\t\t\terrorCode = error.name;\n\t\t\t\t}\n\t\t\t\telse if (Type.isObject(error) && error.code)\n\t\t\t\t{\n\t\t\t\t\terrorCode = error.code === 'access_denied' ? 'ACCESS_DENIED' : error.code;\n\t\t\t\t}\n\n\t\t\t\tAnalytics.getInstance().onJoinCallError({\n\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t\terrorCode,\n\t\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\t\terrorMessage: error?.message,\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tleaveCurrentCall(force, finishCall = false)\n\t{\n\t\tthis.initCallPromise = null;\n\t\tUtil.abortGetCallConnectionData();\n\n\t\tif (this.isRecording())\n\t\t{\n\t\t\tAnalytics.getInstance().onRecordStop({\n\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\tcallType: this.getCallType(),\n\t\t\t\tsubSection: finishCall ? Analytics.AnalyticsSubSection.contextMenu : Analytics.AnalyticsSubSection.window,\n\t\t\t\telement: finishCall ? Analytics.AnalyticsElement.finishForAllButton : Analytics.AnalyticsElement.disconnectButton,\n\t\t\t\trecordTime: Util.getRecordTimeText(this.callRecordInfo, true),\n\t\t\t});\n\n\t\t\tthis.callRecordInfo = null;\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.releaseLocalMedia();\n\t\t}\n\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.answeredOrDeclinedCalls.delete(this._getCallIdentifier(this.currentCall));\n\t\t\tthis.currentCall.hangup(force, '', finishCall);\n\t\t\tif (force)\n\t\t\t{\n\t\t\t\tthis.currentCall = null;\n\t\t\t}\n\n\t\t\tif (this.promotedToAdminTimeout)\n\t\t\t{\n\t\t\t\tclearTimeout(this.promotedToAdminTimeout);\n\t\t\t}\n\t\t}\n\n\t\tif (this.childCall)\n\t\t{\n\t\t\tthis.childCall.removeEventListener(CallEvent.onUserJoined, this._onChildCallFirstMediaHandler);\n\t\t\tthis.childCall.removeEventListener(CallEvent.onRemoteMediaReceived, this._onChildCallFirstUserJoinedHandler);\n\t\t\tthis.childCall.removeEventListener(CallEvent.onLocalMediaReceived, this._onCallLocalMediaReceivedHandler);\n\t\t\tthis.childCall.removeEventListener(CallEvent.onUserStateChanged, this._onCallUserStateChangedHandler);\n\t\t\tthis.childCall.hangup(force, '', finishCall);\n\t\t\tthis.childCall = null;\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.close();\n\t\t}\n\n\t\tthis.hasStreamFromCall = false;\n\t\tthis._stopLocalStream();\n\t}\n\n\thasActiveCall()\n\t{\n\t\treturn !!((this.currentCall && this.currentCall.isAnyoneParticipating()) || (this.callView));\n\t}\n\n\thasVisibleCall()\n\t{\n\t\treturn !!(this.callView && this.callView.visible && this.callView.size == View.Size.Full);\n\t}\n\n\tcanRecord()\n\t{\n\t\treturn DesktopApi.isDesktop() && DesktopApi.getApiVersion() >= 54;\n\t}\n\n\tisRecording()\n\t{\n\t\treturn this.canRecord() && this.callRecordState != View.RecordState.Stopped;\n\t}\n\n\tuseDevicesInCurrentCall(deviceList, isForceUse = false)\n\t{\n\t\tif (!this.currentCall || !this.currentCall.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let i = 0; i < deviceList.length; i++)\n\t\t{\n\t\t\tconst deviceInfo = deviceList[i];\n\n\t\t\tswitch (deviceInfo.kind)\n\t\t\t{\n\t\t\t\tcase \"audioinput\":\n\t\t\t\t\tif (deviceInfo.deviceId === 'default' || isForceUse)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst newDeviceId = Hardware.getDefaultDeviceIdByGroupId(deviceInfo.groupId, 'audioinput');\n\t\t\t\t\t\tthis.currentCall.setMicrophoneId(newDeviceId);\n\t\t\t\t\t\tthis.callView.setMicrophoneId(newDeviceId);\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"videoinput\":\n\t\t\t\t\tif (deviceInfo.deviceId === 'default' || isForceUse)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.currentCall.setCameraId(deviceInfo.deviceId);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.reconnectingCameraId === deviceInfo.deviceId && !Hardware.isCameraOn)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.updateCameraSettingsInCurrentCallAfterReconnecting(deviceInfo.deviceId)\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"audiooutput\":\n\t\t\t\t\tif (this.callView && deviceInfo.deviceId === 'default' || isForceUse)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst newDeviceId = Hardware.getDefaultDeviceIdByGroupId(deviceInfo.groupId, 'audiooutput');\n\t\t\t\t\t\tthis.callView.setSpeakerId(newDeviceId);\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tremoveDevicesFromCurrentCall(deviceList)\n\t{\n\t\tif (!this.currentCall || !this.currentCall.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let i = 0; i < deviceList.length; i++)\n\t\t{\n\t\t\tconst deviceInfo = deviceList[i];\n\n\t\t\tswitch (deviceInfo.kind)\n\t\t\t{\n\t\t\t\tcase \"audioinput\":\n\t\t\t\t\tif (this.currentCall.microphoneId == deviceInfo.deviceId)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst microphoneIds = Object.keys(Hardware.microphoneList);\n\t\t\t\t\t\tlet deviceId;\n\n\t\t\t\t\t\tif (microphoneIds.includes('default'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst deviceGroup = Hardware.getDeviceGroupIdByDeviceId('default', 'audioinput');\n\t\t\t\t\t\t\tdeviceId = Hardware.getDefaultDeviceIdByGroupId(deviceGroup, 'audioinput');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!deviceId)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdeviceId = microphoneIds.length > 0 ? microphoneIds[0] : \"\";\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.currentCall.setMicrophoneId(deviceId);\n\n\t\t\t\t\t\tif (this.currentCall.provider === Provider.Bitrix)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.callView.setMicrophoneId(deviceId);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"videoinput\":\n\t\t\t\t\tif (this.currentCall.cameraId == deviceInfo.deviceId)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst cameraIds = Object.keys(Hardware.cameraList);\n\t\t\t\t\t\tthis.currentCall.setCameraId(cameraIds.length > 0 ? cameraIds[0] : \"\");\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"audiooutput\":\n\t\t\t\t\tif (this.callView && this.callView.speakerId == deviceInfo.deviceId)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst speakerIds = Object.keys(Hardware.audioOutputList);\n\t\t\t\t\t\tlet deviceId;\n\n\t\t\t\t\t\tif (speakerIds.includes('default'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst deviceGroup = Hardware.getDeviceGroupIdByDeviceId('default', 'audiooutput');\n\t\t\t\t\t\t\tdeviceId = Hardware.getDefaultDeviceIdByGroupId(deviceGroup, 'audiooutput');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!deviceId)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdeviceId = speakerIds.length > 0 ? speakerIds[0] : \"\";\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.callView.setSpeakerId(deviceId);\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tshowChat()\n\t{\n\t\tif (DesktopApi.isDesktop() && this.floatingWindow)\n\t\t{\n\t\t\tthis.detached = true;\n\t\t\tthis.callView.hide();\n\t\t\tthis.floatingWindow.setTitle(this.currentCall.associatedEntity.name);\n\t\t\tUtil.getUserAvatars(this.currentCall.id, this.getActiveCallUsers()).then((result) => {\n\t\t\t\tthis.floatingWindow.setAvatars(result);\n\t\t\t\tthis.floatingWindow.show();\n\t\t\t});\n\n\t\t\tthis.container.style.width = 0;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.fold(Text.decode(this.currentCall.associatedEntity.name));\n\t\t}\n\t}\n\n\ttogglePictureInPictureCallWindow(config = {})\n\t{\n\t\tconst hasActiveCall = Boolean(this.currentCall);\n\t\tconst isFolded = this.folded;\n\t\tconst isScreenSharing = hasActiveCall && this.currentCall.isScreenSharingStarted();\n\t\tconst isForceOpen = config.isForceOpen;\n\t\tconst isForceClose = config.isForceClose;\n\n\t\tconst shouldOpenPiP = isFolded || isScreenSharing || isForceOpen;\n\t\tconst canStayOpen = shouldOpenPiP && !isForceClose;\n\n\t\tconst isActiveStatePictureInPictureCallWindow = hasActiveCall && canStayOpen;\n\n\t\tif (!this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callView.isActivePiPFromController = isActiveStatePictureInPictureCallWindow;\n\t\tthis.callView.toggleStatePictureInPictureCallWindow(isActiveStatePictureInPictureCallWindow);\n\t}\n\n\tfold(foldedCallTitle)\n\t{\n\t\tif (this.folded || (DesktopApi.isDesktop() && this.floatingWindow))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!foldedCallTitle && this.currentCall)\n\t\t{\n\t\t\tfoldedCallTitle = Text.decode(this.currentCall.associatedEntity.name)\n\t\t}\n\n\t\tthis.folded = true;\n\t\tif (this.resizeObserver)\n\t\t{\n\t\t\tthis.resizeObserver.unobserve(this.container);\n\t\t}\n\t\tthis.container.classList.add('bx-messenger-call-overlay-folded');\n\t\tthis.callView.setTitle(foldedCallTitle);\n\t\tthis.callView.setSize(View.Size.Folded);\n\t\tthis.callViewState = ViewState.Folded;\n\t\tif (this.sidebar)\n\t\t{\n\t\t\tthis.sidebar.toggleHidden(true);\n\t\t}\n\t\tthis.closePromo();\n\t\tthis.callView.closeCopilotNotify();\n\n\t\tBX.onCustomEvent(this, \"CallController::onFold\", {});\n\n\t\tthis.togglePictureInPictureCallWindow();\n\t}\n\n\tsetCallEditorMaxWidth(maxWidth)\n\t{\n\t\tif (maxWidth != this.maxEditorWidth)\n\t\t{\n\t\t\tthis.maxEditorWidth = maxWidth;\n\t\t\tthis._onResize();\n\t\t}\n\t}\n\n\tfindCallEditorWidth()\n\t{\n\t\tconst containerWidth = this.container.clientWidth;\n\t\tconst editorWidth = containerWidth < (this.maxEditorWidth + View.MIN_WIDTH) ? containerWidth - View.MIN_WIDTH : this.maxEditorWidth;\n\t\tconst callWidth = containerWidth - editorWidth;\n\n\t\treturn {callWidth: callWidth, editorWidth: editorWidth};\n\t}\n\n\tshowDocumentsMenu()\n\t{\n\t\tif (this.documentsMenu)\n\t\t{\n\t\t\tthis.documentsMenu.destroy();\n\t\t\treturn;\n\t\t}\n\n\t\tAnalytics.getInstance().onDocumentBtnClick({\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t});\n\n\t\tconst targetNodeWidth = this.callView.buttons.document.elements.root.offsetWidth;\n\t\tconst resumesArticleCode = Util.getResumesArticleCode();\n\t\tconst documentsArticleCode = Util.getDocumentsArticleCode();\n\n\t\tlet menuItems = [\n\t\t\t\t{\n\t\t\t\t\ttext: BX.message('IM_M_CALL_MENU_CREATE_RESUME_MSGVER_2'),\n\t\t\t\t\tonclick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.documentsMenu.close();\n\t\t\t\t\t\tthis.onDocumentCreateAnalyticsEvent(Analytics.AnalyticsType.resume);\n\t\t\t\t\t\tthis.maybeShowDocumentEditor({\n\t\t\t\t\t\t\ttype: DocumentType.Resume,\n\t\t\t\t\t\t}, resumesArticleCode);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttext: BX.message('IM_M_CALL_MENU_CREATE_FILE'),\n\t\t\t\t\titems: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_MENU_CREATE_FILE_DOC'),\n\t\t\t\t\t\t\tonclick: () =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.documentsMenu.close();\n\t\t\t\t\t\t\t\tthis.onDocumentCreateAnalyticsEvent(Analytics.AnalyticsType.doc);\n\t\t\t\t\t\t\t\tthis.maybeShowDocumentEditor({\n\t\t\t\t\t\t\t\t\ttype: DocumentType.Blank,\n\t\t\t\t\t\t\t\t\ttypeFile: FILE_TYPE_DOCX,\n\t\t\t\t\t\t\t\t}, documentsArticleCode);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_MENU_CREATE_FILE_XLS'),\n\t\t\t\t\t\t\tonclick: () =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.documentsMenu.close();\n\t\t\t\t\t\t\t\tthis.onDocumentCreateAnalyticsEvent(Analytics.AnalyticsType.sheet);\n\t\t\t\t\t\t\t\tthis.maybeShowDocumentEditor({\n\t\t\t\t\t\t\t\t\ttype: DocumentType.Blank,\n\t\t\t\t\t\t\t\t\ttypeFile: FILE_TYPE_XLSX,\n\t\t\t\t\t\t\t\t}, documentsArticleCode);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_MENU_CREATE_FILE_PPT'),\n\t\t\t\t\t\t\tonclick: () =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.documentsMenu.close();\n\t\t\t\t\t\t\t\tthis.onDocumentCreateAnalyticsEvent(Analytics.AnalyticsType.presentation);\n\t\t\t\t\t\t\t\tthis.maybeShowDocumentEditor({\n\t\t\t\t\t\t\t\t\ttype: DocumentType.Blank,\n\t\t\t\t\t\t\t\t\ttypeFile: FILE_TYPE_PPTX,\n\t\t\t\t\t\t\t\t}, documentsArticleCode);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t,\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t]\n\t\t;\n\n\t\tif (!resumesArticleCode)\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\ttext: BX.message('IM_M_CALL_MENU_OPEN_LAST_RESUME_MSGVER_2'),\n\t\t\t\tcacheable: true,\n\t\t\t\titems: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: \"loading\",\n\t\t\t\t\t\ttext: BX.message('IM_M_CALL_MENU_LOADING_RESUME_LIST'),\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\tonSubMenuShow: (e) => this.buildPreviousResumesSubmenu(e.target)\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tlet newStyleOptions = {\n\t\t\tclassName: 'bx-messenger-videocall-document-options-container',\n\t\t\tbackground: '#22272B',\n\t\t\tcontentBackground: '#22272B',\n\t\t\tdarkMode: true,\n\t\t\tcontentBorderRadius: '6px',\n\t\t};\n\n\t\tthis.documentsMenu = new BX.PopupMenuWindow({\n\t\t\t...newStyleOptions,\n\t\t\tangle: false,\n\t\t\tbindElement: this.callView.buttons.document.elements.root,\n\t\t\ttargetContainer: this.container,\n\t\t\toffsetTop: -15,\n\t\t\tbindOptions: {position: \"top\"},\n\t\t\tcacheable: false,\n\t\t\tsubMenuOptions: {\n\t\t\t\tmaxWidth: 450\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tonShow: (event) =>\n\t\t\t\t{\n\t\t\t\t\tconst popup = event.getTarget();\n\t\t\t\t\tpopup.getPopupContainer().style.display = 'block'; // bad hack\n\n\t\t\t\t\tconst offsetLeft = (targetNodeWidth / 2) - popup.getPopupContainer().offsetWidth / 2;\n\t\t\t\t\tpopup.setOffset({offsetLeft: offsetLeft + 40, offsetTop: 0});\n\t\t\t\t\tpopup.setAngle({offset: popup.getPopupContainer().offsetWidth / 2 - 17});\n\t\t\t\t},\n\t\t\t\tonDestroy: () => this.documentsMenu = null\n\t\t\t},\n\t\t\titems: menuItems,\n\t\t});\n\n\t\tthis.documentsMenu.show();\n\t}\n\n\tonDocumentCreateAnalyticsEvent(documentType)\n\t{\n\t\tAnalytics.getInstance().onDocumentCreate({\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t\ttype: documentType,\n\t\t});\n\t}\n\n\tbuildPreviousResumesSubmenu(menuItem)\n\t{\n\t\t// todo: check if it's correct\n\t\tBX.ajax.runAction('disk.api.integration.messengerCall.listResumesInChatByCall', {\n\t\t\tdata: {\n\t\t\t\tcallUuid: this.currentCall.uuid,\n\t\t\t}\n\t\t}).then((response) =>\n\t\t{\n\t\t\tconst resumeList = response.data.resumes;\n\n\t\t\tif (resumeList.length > 0)\n\t\t\t{\n\t\t\t\tresumeList.forEach((resume) =>\n\t\t\t\t{\n\t\t\t\t\tmenuItem.getSubMenu().addMenuItem({\n\t\t\t\t\t\tid: resume.id,\n\t\t\t\t\t\ttext: resume.object.createDate + ': ' + resume.object.name,\n\t\t\t\t\t\tonclick: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.documentsMenu.close();\n\t\t\t\t\t\t\tAnalytics.getInstance().onLastResumeOpen({\n\t\t\t\t\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tthis.viewDocumentByLink(resume.links.view);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tmenuItem.getSubMenu().addMenuItem({\n\t\t\t\t\tid: 'nothing',\n\t\t\t\t\ttext: BX.message('IM_M_CALL_MENU_NO_RESUME_MSGVER_2'),\n\t\t\t\t\tdisabled: true\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tmenuItem.getSubMenu().removeMenuItem('loading');\n\t\t\tmenuItem.adjustSubMenu();\n\t\t})\n\t}\n\n\tmaybeShowDocumentEditor(options, articleCode)\n\t{\n\t\tif (articleCode)\n\t\t{\n\t\t\tif (articleCode)\n\t\t\t{\n\t\t\t\tBX.UI.InfoHelper.show(articleCode);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tthis.showDocumentEditor(options);\n\t}\n\n\tshowDocumentEditor(options)\n\t{\n\t\toptions = options || {};\n\t\tlet openAnimation = true;\n\t\tif (this.sidebar)\n\t\t{\n\t\t\tif (options.force)\n\t\t\t{\n\t\t\t\tthis.sidebar.close(false);\n\t\t\t\tthis.sidebar.destroy();\n\t\t\t\tthis.sidebar = null;\n\t\t\t\topenAnimation = false;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setButtonActive('document', true);\n\t\t}\n\t\tclearTimeout(this.showPromoPopupTimeout);\n\n\t\tthis._createAndOpenSidebarWithIframe(\"about:blank\", openAnimation);\n\n\t\tBX.loadExt('disk.onlyoffice-im-integration')\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\t// todo: check if it's correct\n\t\t\t\tconst docEditor = new BX.Disk.OnlyOfficeImIntegration.CreateDocument({\n\t\t\t\t\tdialog: {\n\t\t\t\t\t\tid: this.currentCall.associatedEntity.id,\n\t\t\t\t\t},\n\t\t\t\t\tcall: {\n\t\t\t\t\t\tuuid: this.currentCall.uuid,\n\t\t\t\t\t},\n\t\t\t\t\tdelegate: {\n\t\t\t\t\t\tsetMaxWidth: this.setCallEditorMaxWidth.bind(this),\n\t\t\t\t\t\tonDocumentCreated: this._onDocumentCreated.bind(this),\n\t\t\t\t\t},\n\t\t\t\t\ttype: options.type,\n\t\t\t\t\ttypeFile: options?.typeFile,\n\t\t\t\t});\n\n\t\t\t\tlet promiseGetUrl;\n\t\t\t\tif (options.type === DocumentType.Resume)\n\t\t\t\t{\n\t\t\t\t\tpromiseGetUrl = docEditor.getIframeUrlForTemplates();\n\t\t\t\t}\n\t\t\t\telse if (options.type === DocumentType.Blank)\n\t\t\t\t{\n\t\t\t\t\tpromiseGetUrl = docEditor.getIframeUrlForCreate({\n\t\t\t\t\t\ttypeFile: options.typeFile\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tpromiseGetUrl = docEditor.getIframeUrl({\n\t\t\t\t\t\tviewerItem: options.viewerItem\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tpromiseGetUrl\n\t\t\t\t\t.then((url) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.docEditorIframe.src = url;\n\t\t\t\t\t})\n\t\t\t\t\t.catch((e) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tconsole.error(e)\n\t\t\t\t\t\tthis.closeDocumentEditor()\n\t\t\t\t\t\talert(BX.message(\"IM_F_ERROR\"));\n\t\t\t\t\t});\n\n\t\t\t\tthis.docEditor = docEditor;\n\t\t\t})\n\t\t\t.catch((error) =>\n\t\t\t{\n\t\t\t\tconsole.error(error);\n\t\t\t\tthis.closeDocumentEditor()\n\t\t\t\talert(BX.message(\"IM_F_ERROR\"));\n\t\t\t});\n\n\t\tif (this.resizeObserver)\n\t\t{\n\t\t\tthis.resizeObserver.observe(this.container);\n\t\t}\n\t}\n\n\tcloseDocumentEditor()\n\t{\n\t\tAnalytics.getInstance().onDocumentClose({\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t\ttype: this.getDocumentType(),\n\t\t});\n\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tif (this.docEditor && this.docEditorIframe)\n\t\t\t{\n\t\t\t\tthis.docEditor.onCloseIframe(this.docEditorIframe);\n\t\t\t}\n\t\t\tif (this.container && this.resizeObserver)\n\t\t\t{\n\t\t\t\tthis.resizeObserver.unobserve(this.container);\n\t\t\t}\n\t\t\tif (this.callView)\n\t\t\t{\n\t\t\t\tthis.callView.setButtonActive('document', false);\n\t\t\t\tthis.callView.removeMaxWidth();\n\t\t\t}\n\t\t\tif (!this.sidebar)\n\t\t\t{\n\t\t\t\treturn resolve();\n\t\t\t}\n\t\t\tconst oldSidebar = this.sidebar;\n\t\t\tthis.sidebar = null;\n\t\t\toldSidebar.close().then(() =>\n\t\t\t{\n\t\t\t\tthis.docEditor = null;\n\t\t\t\tthis.docEditorIframe = null;\n\t\t\t\toldSidebar.destroy();\n\t\t\t\tthis.maxEditorWidth = this.docCreatedForCurrentCall ? DOC_EDITOR_WIDTH : DOC_TEMPLATE_WIDTH;\n\t\t\t\tif (!this.callView)\n\t\t\t\t{\n\t\t\t\t\tthis.removeContainer();\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tclearPictureInPictureDebounceForOpen()\n\t{\n\t\tif (this.pictureInPictureDebounceForOpen)\n\t\t{\n\t\t\tclearTimeout(this.pictureInPictureDebounceForOpen);\n\t\t\tthis.pictureInPictureDebounceForOpen = null;\n\t\t}\n\t}\n\n\tonInputFileOpenedStateUpdate(isActive)\n\t{\n\t\tif (isActive)\n\t\t{\n\t\t\tthis.clearPictureInPictureDebounceForOpen();\n\t\t\tthis.togglePictureInPictureCallWindow({ isForceClose: true });\n\t\t\tthis.isFileChooserActive = true;\n\t\t}\n\n\t\tif (!isActive && !this.pictureInPictureDebounceForOpen)\n\t\t{\n\t\t\tthis.pictureInPictureDebounceForOpen = setTimeout(() => {\n\t\t\t\tthis.togglePictureInPictureCallWindow();\n\t\t\t\tthis.isFileChooserActive = false;\n\t\t\t\tthis.pictureInPictureDebounceForOpen = null;\n\t\t\t}, 1000);\n\t\t}\n\t}\n\n\tupdateWindowFocusState(isActive)\n\t{\n\t\tif (isActive === this.isWindowFocus)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isWindowFocus = isActive;\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setWindowFocusState(this.isWindowFocus);\n\t\t}\n\t}\n\n\tviewDocumentByLink(url)\n\t{\n\t\tif (this.sidebar)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setButtonActive('document', true);\n\t\t}\n\n\t\tthis.maxEditorWidth = DOC_EDITOR_WIDTH;\n\t\tthis._createAndOpenSidebarWithIframe(url);\n\t}\n\n\t_createAndOpenSidebarWithIframe(url, animation)\n\t{\n\t\tanimation = animation === true;\n\t\tconst result = this.findCallEditorWidth();\n\t\tconst callWidth = result.callWidth;\n\t\tconst editorWidth = result.editorWidth;\n\n\t\tthis.callView.setMaxWidth(callWidth);\n\t\tthis.sidebar = new Sidebar({\n\t\t\tcontainer: this.container,\n\t\t\twidth: editorWidth,\n\t\t\tevents: {\n\t\t\t\tonCloseClicked: this.onSideBarCloseClicked.bind(this)\n\t\t\t}\n\t\t});\n\t\tthis.sidebar.open(animation);\n\n\t\tconst loader = new BX.Loader({\n\t\t\ttarget: this.sidebar.elements.contentContainer\n\t\t});\n\t\tloader.show();\n\n\t\tconst docEditorIframe = BX.create(\"iframe\", {\n\t\t\tattrs: {\n\t\t\t\tsrc: url,\n\t\t\t\tframeborder: \"0\"\n\t\t\t},\n\t\t\tstyle: {\n\t\t\t\tdisplay: \"none\",\n\t\t\t\tborder: \"0\",\n\t\t\t\tmargin: \"0\",\n\t\t\t\twidth: \"100%\",\n\t\t\t\theight: \"100%\",\n\t\t\t}\n\t\t});\n\n\t\tdocEditorIframe.addEventListener('load',\n\t\t\t() =>\n\t\t\t{\n\t\t\t\tloader.destroy();\n\t\t\t\tdocEditorIframe.style.display = 'block';\n\t\t\t},\n\t\t\t{once: true}\n\t\t);\n\t\tdocEditorIframe.addEventListener('error', (error) =>\n\t\t{\n\t\t\tconsole.error(error);\n\t\t\tthis.closeDocumentEditor()\n\t\t\talert(BX.message(\"IM_F_ERROR\"));\n\t\t})\n\t\tthis.sidebar.elements.contentContainer.appendChild(docEditorIframe);\n\t\tthis.docEditorIframe = docEditorIframe;\n\t}\n\n\t_onDocumentCreated()\n\t{\n\t\tthis.docCreatedForCurrentCall = true;\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.currentCall.sendCustomMessage(DOC_CREATED_EVENT, true)\n\t\t}\n\n\t\tAnalytics.getInstance().onDocumentUpload({\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t\ttype: this.getDocumentType(),\n\t\t});\n\t}\n\n\tonSideBarCloseClicked()\n\t{\n\t\tthis.closeDocumentEditor();\n\t}\n\n\t_ensureDocumentEditorClosed()\n\t{\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tif (!this.sidebar)\n\t\t\t{\n\t\t\t\treturn resolve();\n\t\t\t}\n\n\t\t\tconst messageBox = new MessageBox({\n\t\t\t\tmessage: BX.message('IM_CALL_CLOSE_DOCUMENT_EDITOR_TO_ANSWER'),\n\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t\tokCaption: BX.message('IM_CALL_CLOSE_DOCUMENT_EDITOR_YES'),\n\t\t\t\tcancelCaption: BX.message('IM_CALL_CLOSE_DOCUMENT_EDITOR_NO'),\n\t\t\t\tonOk: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.closeDocumentEditor().then(() => resolve());\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t\tonCancel: () =>\n\t\t\t\t{\n\t\t\t\t\treject();\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\t\t\tmessageBox.show();\n\t\t})\n\t}\n\n\tonDocumentPromoActionClicked()\n\t{\n\t\tthis.closePromo();\n\n\t\tconst articleCode = Util.getResumesArticleCode();\n\t\tif (articleCode)\n\t\t{\n\t\t\tBX.UI.InfoHelper.show(articleCode); //@see \\Bitrix\\Disk\\Integration\\MessengerCall::getInfoHelperCodeForDocuments()\n\t\t\treturn;\n\t\t}\n\n\t\tthis.showDocumentEditor({\n\t\t\ttype: DocumentType.Resume,\n\t\t});\n\t}\n\n\tonDocumentPromoClosed(e)\n\t{\n\t\tconst data = e.getData();\n\t\tif (data.dontShowAgain)\n\t\t{\n\t\t\tthis.emit(Events.onPromoViewed, {\n\t\t\t\tcode: DOCUMENT_PROMO_CODE\n\t\t\t})\n\t\t}\n\n\t\tthis.documentPromoPopup = null;\n\t}\n\n\tgetDocumentType()\n\t{\n\t\tif (this.docEditor?.options?.type === DocumentType.Resume)\n\t\t{\n\t\t\treturn Analytics.AnalyticsType.resume;\n\t\t}\n\n\t\tswitch (this.docEditor?.options?.typeFile)\n\t\t{\n\t\t\tcase FILE_TYPE_DOCX:\n\t\t\t\treturn Analytics.AnalyticsType.doc;\n\t\t\tcase FILE_TYPE_XLSX:\n\t\t\t\treturn Analytics.AnalyticsType.sheet;\n\t\t\tcase FILE_TYPE_PPTX:\n\t\t\t\treturn Analytics.AnalyticsType.presentation;\n\t\t}\n\n\t\treturn '';\n\t}\n\n\tunfold(options = {})\n\t{\n\t\tconst { fromPiP = false } = options;\n\n\t\tif (this.detached)\n\t\t{\n\t\t\tthis.container.style.removeProperty('width');\n\t\t\tthis.callView.show();\n\n\t\t\tthis.detached = false;\n\t\t\tif (this.floatingWindow)\n\t\t\t{\n\t\t\t\tthis.floatingWindow.hide();\n\t\t\t}\n\t\t}\n\n\t\tif (this.folded)\n\t\t{\n\t\t\tthis.folded = false;\n\t\t\tthis.container.classList.remove('bx-messenger-call-overlay-folded');\n\t\t\tthis.callView.setSize(View.Size.Full);\n\t\t\tthis.callViewState = ViewState.Opened;\n\t\t\tZIndexManager.getStack(document.body).bringToFront(this.container);\n\t\t\tif (this.sidebar)\n\t\t\t{\n\t\t\t\tthis.sidebar.toggleHidden(false);\n\t\t\t\tif (this.resizeObserver)\n\t\t\t\t{\n\t\t\t\t\tthis.resizeObserver.observe(this.container);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.togglePictureInPictureCallWindow({ isForceClose: fromPiP });\n\t\t}\n\n\t\tBX.onCustomEvent(this, \"CallController::onUnfold\", {});\n\t}\n\n\tisFullScreen()\n\t{\n\t\tif (\"webkitFullscreenElement\" in document)\n\t\t{\n\t\t\treturn (!!document.webkitFullscreenElement);\n\t\t}\n\t\telse if (\"fullscreenElement\" in document)\n\t\t{\n\t\t\treturn (!!document.fullscreenElement);\n\t\t}\n\t\treturn false;\n\t}\n\n\ttoggleFullScreen()\n\t{\n\t\tif (this.isFullScreen())\n\t\t{\n\t\t\tthis.exitFullScreen();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.enterFullScreen();\n\t\t}\n\t}\n\n\tenterFullScreen()\n\t{\n\t\tif (!this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst element = this.callView.elements.root;\n\n\t\ttry\n\t\t{\n\t\t\tconst requestFullscreen = element.requestFullscreen\n\t\t\t\t|| element.webkitRequestFullscreen\n\t\t\t\t|| element.mozRequestFullScreen\n\t\t\t\t|| element.msRequestFullscreen\n\t\t\t;\n\n\t\t\tif (requestFullscreen)\n\t\t\t{\n\t\t\t\trequestFullscreen.call(element).catch((error) => {\n\t\t\t\t\tconsole.error('Failed to enter fullscreen mode:', error);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconsole.warn('Fullscreen API is not supported in this browser');\n\t\t\t}\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tconsole.error('Error attempting to enable fullscreen mode:', e);\n\t\t}\n\t}\n\n\texitFullScreen()\n\t{\n\t\ttry\n\t\t{\n\t\t\tconst exitFullscreen = document.exitFullscreen\n\t\t\t\t|| document.mozCancelFullScreen\n\t\t\t\t|| document.webkitExitFullscreen\n\t\t\t\t|| document.msExitFullscreen\n\t\t\t\t|| document.cancelFullScreen\n\t\t\t;\n\n\t\t\tif (exitFullscreen)\n\t\t\t{\n\t\t\t\texitFullscreen.call(document).catch((error) => {\n\t\t\t\t\tconsole.error('Failed to exit fullscreen mode:', error);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconsole.warn('Fullscreen API is not fully supported in this browser');\n\t\t\t}\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tconsole.error('Error attempting to exit fullscreen mode:', e);\n\t\t}\n\t}\n\n\tshowDocumentPromo()\n\t{\n\t\tif (!this.callView || !this.currentCall || !Util.shouldShowDocumentButton())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.messengerFacade.isPromoRequired(DOCUMENT_PROMO_CODE))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst documentButton = this.callView.buttons.document.elements.root;\n\t\tconst bindElement = documentButton.querySelector('.bx-messenger-videocall-panel-icon');\n\t\tif (!bindElement)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tthis.documentPromoPopup = new PromoPopup({\n\t\t\tbindElement: bindElement,\n\t\t\tpromoCode: DOCUMENT_PROMO_CODE,\n\t\t\tevents: {\n\t\t\t\tonActionClick: this.onDocumentPromoActionClicked.bind(this),\n\t\t\t\tonClose: this.onDocumentPromoClosed.bind(this)\n\t\t\t}\n\t\t});\n\t\tthis.showPromoPopupTimeout = setTimeout(() =>\n\t\t{\n\t\t\tif (this.folded)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis.documentPromoPopup.show();\n\t\t}, DOCUMENT_PROMO_DELAY);\n\t}\n\n\tshowMaskPromo()\n\t{\n\t\tif (!this.callView || !this.currentCall || !BackgroundDialog.isMaskAvailable())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.messengerFacade.isPromoRequired(MASK_PROMO_CODE))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.maskPromoPopup = new PromoPopup3D({\n\t\t\tcallView: this.callView,\n\t\t\tevents: {\n\t\t\t\tonClose: (e) =>\n\t\t\t\t{\n\t\t\t\t\tthis.emit(Events.onPromoViewed, {\n\t\t\t\t\t\tcode: MASK_PROMO_CODE\n\t\t\t\t\t})\n\t\t\t\t\tthis.maskPromoPopup = null\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.showPromoPopup3dTimeout = setTimeout(\n\t\t\t() =>\n\t\t\t{\n\t\t\t\tif (!this.folded)\n\t\t\t\t{\n\t\t\t\t\tthis.maskPromoPopup.show();\n\t\t\t\t}\n\t\t\t},\n\t\t\tMASK_PROMO_DELAY\n\t\t);\n\t}\n\n\tclosePromo()\n\t{\n\t\tif (this.documentPromoPopup)\n\t\t{\n\t\t\tthis.documentPromoPopup.close();\n\t\t}\n\n\t\tif (this.maskPromoPopup)\n\t\t{\n\t\t\tthis.maskPromoPopup.close();\n\t\t}\n\n\t\tclearTimeout(this.showPromoPopupTimeout);\n\t\tclearTimeout(this.showPromoPopup3dTimeout);\n\t}\n\n\t_startRecordCall(type)\n\t{\n\t\tthis.callView.setButtonActive('record', true);\n\t\tthis.callRecordType = type;\n\n\t\tthis.currentCall.sendRecordState({\n\t\t\taction: View.RecordState.Started,\n\t\t\tdate: new Date()\n\t\t});\n\n\t\tthis.callRecordState = View.RecordState.Started;\n\t}\n\n\t#stopRecordCall()\n\t{\n\t\tif (this.isRecording())\n\t\t{\n\t\t\tBXDesktopSystem.CallRecordStop();\n\n\t\t\tthis.callRecordState = View.RecordState.Stopped;\n\t\t\tthis.callRecordType = View.RecordType.None;\n\t\t\tthis.callView.setRecordState(this.callView.getDefaultRecordState());\n\t\t\tthis.callView.setButtonActive('record', false);\n\n\t\t\tthis.currentCall.sendRecordState({\n\t\t\t\taction: View.RecordState.Stopped,\n\t\t\t\tuserId: this.userId,\n\t\t\t});\n\t\t}\n\t}\n\n\t// event handlers\n\n\t_onCallNotificationClose()\n\t{\n\t\tclearTimeout(this.hideIncomingCallTimeout);\n\t\tthis.messengerFacade.stopRepeatSound(this.audioRingtone);\n\t\tif (this.callNotification)\n\t\t{\n\t\t\tthis.callNotification.destroy();\n\t\t}\n\t}\n\n\t_onCallNotificationDestroy()\n\t{\n\t\tthis.messengerFacade.stopRepeatSound(this.audioRingtone);\n\t\tthis.callNotification = null;\n\t}\n\n\tasync _onCallNotificationButtonClick(e)\n\t{\n\t\tconst data = e.data;\n\t\tclearTimeout(this.hideIncomingCallTimeout);\n\t\tthis.callNotification.close();\n\t\tswitch (data.button)\n\t\t{\n\t\t\tcase \"answer\":\n\t\t\t\tif (this.currentCall && !this.answeredOrDeclinedCalls.has(this._getCallIdentifier(this.currentCall)))\n\t\t\t\t{\n\t\t\t\t\tthis.answeredOrDeclinedCalls.add(this._getCallIdentifier(this.currentCall));\n\t\t\t\t\tconst callParams = {\n\t\t\t\t\t\tid: this.currentCall?.id,\n\t\t\t\t\t\tuuid: this.currentCall?.uuid,\n\t\t\t\t\t\tscheme: this.currentCall?.scheme || CallScheme.classic,\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.onAnswerButtonClick(data.mediaParams, callParams);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase \"decline\":\n\t\t\t\tif (this.currentCall)\n\t\t\t\t{\n\t\t\t\t\tconst callId = this._getCallIdentifier(this._getCallIdentifier(this.currentCall));\n\t\t\t\t\tthis.answeredOrDeclinedCalls.add(callId);\n\t\t\t\t\tthis.ignoreDeclinedCallsTimeout[callId] = setTimeout(\n\t\t\t\t\t\t() => this.answeredOrDeclinedCalls.delete(callId),\n\t\t\t\t\t\t15000\n\t\t\t\t\t);\n\t\t\t\t\tthis.removeVideoStrategy();\n\t\t\t\t\tthis.removeCallEvents();\n\n\t\t\t\t\tAnalytics.getInstance().onJoinCall({\n\t\t\t\t\t\tcallId: callId,\n\t\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t\t\tmediaParams: {\n\t\t\t\t\t\t\tvideo: Hardware.isCameraOn,\n\t\t\t\t\t\t\taudio: !Hardware.isMicrophoneMuted,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsection: Analytics.AnalyticsSection.callPopup,\n\t\t\t\t\t\telement: Analytics.AnalyticsElement.answerButton,\n\t\t\t\t\t\tstatus: Analytics.AnalyticsStatus.decline,\n\t\t\t\t\t\tassociatedEntity: this.currentCall.associatedEntity,\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.currentCall.decline(603);\n\t\t\t\t\tthis.currentCall = null;\n\n\t\t\t\t\tif (this.promotedToAdminTimeout)\n\t\t\t\t\t{\n\t\t\t\t\t\tclearTimeout(this.promotedToAdminTimeout);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tonAnswerButtonClick(mediaParams, callParams)\n\t{\n\t\tconst isLegacyCall= callParams.scheme === CallScheme.classic;\n\t\tconst currentCallPromise = isLegacyCall\n\t\t\t? CallEngineLegacy.getCallWithId(callParams.id)\n\t\t\t: CallEngine.getCallWithId(callParams.uuid)\n\t\t;\n\n\t\tcurrentCallPromise.then(result => {\n\t\t\tif (!this.currentCall)\n\t\t\t{\n\t\t\t\tthis.currentCall = result.call;\n\t\t\t\tthis.bindCallEvents();\n\t\t\t}\n\n\t\t\tif (DesktopApi.isDesktop())\n\t\t\t{\n\t\t\t\tDesktopApi.activateWindow();\n\t\t\t}\n\n\t\t\tif (!this.isUserAgentSupported())\n\t\t\t{\n\t\t\t\tthis.log(\"Error: unsupported user agent\");\n\t\t\t\tthis.removeVideoStrategy();\n\t\t\t\tthis.removeCallEvents();\n\t\t\t\tthis.currentCall.decline();\n\t\t\t\tthis.currentCall = null;\n\n\t\t\t\tif (this.promotedToAdminTimeout)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.promotedToAdminTimeout);\n\t\t\t\t}\n\n\t\t\t\tthis.showUnsupportedNotification();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tAnalytics.getInstance().onJoinCall({\n\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\tcallType: this.getCallType(),\n\t\t\t\tmediaParams,\n\t\t\t\tsection: Analytics.AnalyticsSection.callPopup,\n\t\t\t\telement: Analytics.AnalyticsElement.answerButton,\n\t\t\t\tstatus: Analytics.AnalyticsStatus.success,\n\t\t\t\tassociatedEntity: this.currentCall.associatedEntity,\n\t\t\t});\n\n\t\t\tif (this.callView)\n\t\t\t{\n\t\t\t\tthis.callView.destroy();\n\t\t\t}\n\n\t\t\tconst dialogId = this.currentCall.associatedEntity && this.currentCall.associatedEntity.id ? this.currentCall.associatedEntity.id : false;\n\t\t\tlet isGroupCall = dialogId.toString().startsWith(\"chat\");\n\t\t\tthis._ensureDocumentEditorClosed()\n\t\t\t\t.then(() =>\n\t\t\t\t{\n\t\t\t\t\treturn this.messengerFacade.openMessenger(dialogId);\n\t\t\t\t})\n\t\t\t\t.then(() =>\n\t\t\t\t{\n\t\t\t\t\treturn Hardware.init();\n\t\t\t\t})\n\t\t\t\t.then(() =>\n\t\t\t\t{\n\t\t\t\t\tif (!this.currentCall)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.log('The call was destroyed while being answered');\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.createContainer();\n\t\t\t\t\tlet hiddenButtons = [];\n\t\t\t\t\tif (this.currentCall.provider === Provider.Plain)\n\t\t\t\t\t{\n\t\t\t\t\t\thiddenButtons.push('floorRequest');\n\t\t\t\t\t\thiddenButtons.push('hangupOptions');\n\t\t\t\t\t\thiddenButtons.push('callconrol');\n\t\t\t\t\t}\n\t\t\t\t\tif (!Util.shouldShowDocumentButton())\n\t\t\t\t\t{\n\t\t\t\t\t\thiddenButtons.push('document');\n\t\t\t\t\t}\n\t\t\t\t\tHardware.isCameraOn = mediaParams.video && Hardware.hasCamera();\n\t\t\t\t\tthis.callView = new View({\n\t\t\t\t\t\tcontainer: this.container,\n\t\t\t\t\t\tbaseZIndex: this.messengerFacade.getDefaultZIndex(),\n\t\t\t\t\t\tusers: this.currentCall.users,\n\t\t\t\t\t\tuserStates: this.currentCall.getUsers(),\n\t\t\t\t\t\tshowChatButtons: true,\n\t\t\t\t\t\tshowUsersButton: false,\n\t\t\t\t\t\tshowRecordButton: this.featureRecord !== FeatureState.Disabled,\n\t\t\t\t\t\tuserLimit: Util.getUserLimit(),\n\t\t\t\t\t\tlayout: isGroupCall ? View.Layout.Grid : View.Layout.Centered,\n\t\t\t\t\t\tmicrophoneId: Hardware.defaultMicrophone,\n\t\t\t\t\t\tblockedButtons: this.getBlockedButtons(this.currentCall.provider === Provider.Plain),\n\t\t\t\t\t\thiddenButtons: hiddenButtons,\n\t\t\t\t\t\tlanguage: this.language,\n\t\t\t\t\t\tshowAddUserButtonInList: this.currentCall.provider === Provider.Plain,\n\t\t\t\t\t\tisCopilotFeaturesEnabled: this.currentCall.isCopilotFeaturesEnabled,\n\t\t\t\t\t\tisCopilotActive: this.currentCall.isCopilotActive,\n\t\t\t\t\tisWindowFocus: this.isWindowFocus,});\n\t\t\t\t\tthis.autoCloseCallView = true;\n\t\t\t\t\tif (this.callWithLegacyMobile)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.callView.blockAddUser();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.bindCallViewEvents();\n\n\t\t\t\t\tif (this.isLegacyCall(this.currentCall.provider, this.currentCall.scheme))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.updateCallViewUsers(this.currentCall.id, this.getCallUsers(true));\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tconst currentUser = BX.Messenger.v2.Lib.CallManager.getInstance().getCurrentUser();\n\t\t\t\t\t\tthis.callView.updateUserData({[this.userId]: currentUser});\n\t\t\t\t\t}\n\t\t\t\t\tthis.callView.show();\n\t\t\t\t\tthis.showDocumentPromo();\n\t\t\t\t\tthis.showMaskPromo();\n\t\t\t\t\tthis.showCopilotNotify();\n\n\t\t\t\t\tthis.currentCall.useHdVideo(Hardware.preferHdQuality);\n\t\t\t\t\tif (Hardware.defaultMicrophone)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.currentCall.setMicrophoneId(Hardware.defaultMicrophone);\n\t\t\t\t\t}\n\t\t\t\t\tif (Hardware.defaultCamera)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.currentCall.setCameraId(Hardware.defaultCamera);\n\t\t\t\t\t}\n\n\t\t\t\t\tHardware.isMicrophoneMuted = !mediaParams.audio;\n\n\t\t\t\t\tthis.currentCall.answer({\n\t\t\t\t\t\tenableMicAutoParameters: Hardware.enableMicAutoParameters\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.createVideoStrategy();\n\n\t\t\t\t\tthis._onUpdateLastUsedCameraId();\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tlet errorCode = 'UNKNOWN_ERROR';\n\t\t\t\t\tif (Type.isString(error))\n\t\t\t\t\t{\n\t\t\t\t\t\terrorCode = error;\n\t\t\t\t\t}\n\t\t\t\t\telse if (Type.isObject(error) && error instanceof JoinResponseError)\n\t\t\t\t\t{\n\t\t\t\t\t\terrorCode = error.name;\n\t\t\t\t\t}\n\t\t\t\t\telse if (Type.isObject(error) && error.code)\n\t\t\t\t\t{\n\t\t\t\t\t\terrorCode = error.code === 'access_denied' ? 'ACCESS_DENIED' : error.code;\n\t\t\t\t\t}\n\n\t\t\t\t\tAnalytics.getInstance().onJoinCallError({\n\t\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t\t\terrorCode,\n\t\t\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\t\t\terrorMessage: error?.message,\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t});\n\t}\n\n\t_onCallConferenceNotificationButtonClick(e)\n\t{\n\t\tclearTimeout(this.hideIncomingCallTimeout);\n\t\tthis.callNotification.close();\n\t\tswitch (e.button)\n\t\t{\n\t\t\tcase \"answerConference\":\n\t\t\t\tif (this.currentCall && 'id' in this.currentCall.associatedEntity)\n\t\t\t\t{\n\t\t\t\t\tAnalytics.getInstance().onAnswerConference({\n\t\t\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.answeredOrDeclinedCalls.add(this._getCallIdentifier(this.currentCall));\n\t\t\t\t\tlet dialogId = this.currentCall.associatedEntity.id.toString();\n\t\t\t\t\tif (dialogId.startsWith('chat'))\n\t\t\t\t\t{\n\t\t\t\t\t\tdialogId = dialogId.substring(4);\n\t\t\t\t\t}\n\t\t\t\t\tthis.emit(Events.onOpenVideoConference, {dialogId: dialogId});\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase \"skipConference\":\n\t\t\t\tif (this.currentCall)\n\t\t\t\t{\n\t\t\t\t\tAnalytics.getInstance().onDeclineConference({\n\t\t\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.answeredOrDeclinedCalls.add(this._getCallIdentifier(this.currentCall));\n\t\t\t\t\tthis.removeVideoStrategy();\n\t\t\t\t\tthis.removeCallEvents();\n\t\t\t\t\tthis.currentCall.decline();\n\t\t\t\t\tthis.currentCall = null;\n\t\t\t\t\tif (this.promotedToAdminTimeout)\n\t\t\t\t\t{\n\t\t\t\t\t\tclearTimeout(this.promotedToAdminTimeout);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t_onCallViewShow()\n\t{\n\t\tZIndexManager.getStack(document.body).bringToFront(this.container);\n\n\t\tthis.callView.setButtonCounter(\"chat\", this.messengerFacade.getMessageCount());\n\t\tthis.callViewState = ViewState.Opened;\n\t}\n\n\t_onCallViewClose()\n\t{\n\t\tthis.callView.destroy();\n\t\tthis.callViewState = ViewState.Closed;\n\t\tif (this.floatingWindow)\n\t\t{\n\t\t\tthis.floatingWindow.close();\n\t\t}\n\t\tif (this.floatingScreenShareWindow)\n\t\t{\n\t\t\tthis.floatingScreenShareWindow.close();\n\t\t}\n\t\tif (this.documentsMenu)\n\t\t{\n\t\t\tthis.documentsMenu.close();\n\t\t}\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.closeWindow(DesktopApi.findWindow('callBackground'));\n\t\t}\n\t\tthis.closePromo();\n\n\t\tif (this.mediaDevicesResetStateHintBaloon)\n\t\t{\n\t\t\tthis.mediaDevicesResetStateHintBaloon.close();\n\t\t\tthis.mediaDevicesResetStateHintBaloon = null;\n\t\t}\n\t\tthis._closeReconnectionBaloon();\n\t\tthis._closeParticipantsVideoBaloon();\n\n\t\tif (this.copilotPopup)\n\t\t{\n\t\t\tthis.copilotPopup.close();\n\t\t}\n\n\t\tif (this.riseYouHandToTalkPopup)\n\t\t{\n\t\t\tthis.riseYouHandToTalkPopup.close();\n\t\t\tthis.riseYouHandToTalkPopup = null;\n\t\t}\n\t}\n\n\t_onCallViewDestroy()\n\t{\n\t\tthis.callView = null;\n\t\tthis.folded = false;\n\t\tthis.autoCloseCallView = true;\n\t\tif (this.sidebar)\n\t\t{\n\t\t\tBX.adjust(this.container, {\n\t\t\t\tstyle: {\n\t\t\t\t\tbackgroundColor: \"rgba(0, 0, 0, 0.5)\",\n\t\t\t\t\tbackdropFilter: \"blur(5px)\"\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.removeContainer();\n\t\t\tthis.maxEditorWidth = DOC_TEMPLATE_WIDTH;\n\t\t}\n\t}\n\n\t_onCallViewBodyClick()\n\t{\n\t\tif (this.folded)\n\t\t{\n\t\t\tthis.unfold();\n\t\t}\n\t}\n\n\t_onPipClose()\n\t{\n\t\tconst isViewHidden = this.callView.viewVisibility.getCurrentVisibility() === View.DocumentVisibilityState.hidden;\n\t\tif (this.folded && isViewHidden)\n\t\t{\n\t\t\tthis.unfold({ fromPiP: true });\n\t\t}\n\t}\n\n\t_onCallViewButtonClick(e)\n\t{\n\t\tconst buttonName = e.buttonName;\n\n\t\tconst handlers = {\n\t\t\thangup: this._onCallViewHangupButtonClick.bind(this),\n\t\t\thangupOptions: this._onCallViewHangupOptionsButtonClick.bind(this),\n\t\t\tclose: this._onCallViewCloseButtonClick.bind(this),\n\t\t\ttoggleUsers: this._onCallViewUsersListButtonClick.bind(this),\n\t\t\tinviteUser: this._onCallViewInviteUserButtonClick.bind(this),\n\t\t\ttoggleMute: this._onCallViewToggleMuteButtonClick.bind(this),\n\t\t\ttoggleScreenSharing: this._onCallViewToggleScreenSharingButtonClick.bind(this),\n\t\t\trecord: this._onCallViewRecordButtonClick.bind(this),\n\t\t\ttoggleVideo: this._onCallViewToggleVideoButtonClick.bind(this),\n\t\t\ttoggleSpeaker: this._onCallViewToggleSpeakerButtonClick.bind(this),\n\t\t\tshowChat: this._onCallViewShowChatButtonClick.bind(this),\n\t\t\tfloorRequest: this._onCallViewFloorRequestButtonClick.bind(this),\n\t\t\tshowHistory: this._onCallViewShowHistoryButtonClick.bind(this),\n\t\t\tfullscreen: this._onCallViewFullScreenButtonClick.bind(this),\n\t\t\tdocument: this._onCallViewDocumentButtonClick.bind(this),\n\t\t\tmicrophoneSideIcon: this._onCallViewMicrophoneSideIconClick.bind(this),\n\t\t\tfeedback: this._onCallViewFeedbackButtonClick.bind(this),\n\t\t\tcallcontrol: this._onCallcontrolButtonClick.bind(this),\n\t\t\tcopilot: this._onCallViewCopilotButtonClick.bind(this),\n\t\t};\n\n\t\tif (Type.isFunction(handlers[buttonName]))\n\t\t{\n\t\t\thandlers[buttonName].call(this, e);\n\t\t}\n\t}\n\n\t_onCallViewHangupButtonClick()\n\t{\n\t\tAnalytics.getInstance().onDisconnectCall({\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t\tsubSection: Analytics.AnalyticsSubSection.finishButton,\n\t\t\tmediaParams: {\n\t\t\t\tvideo: Hardware.isCameraOn,\n\t\t\t\taudio: !Hardware.isMicrophoneMuted,\n\t\t\t},\n\t\t});\n\n\t\tthis.leaveCurrentCall();\n\t}\n\n\t_onCallViewHangupOptionsButtonClick()\n\t{\n\t\tif (this.hangupOptionsMenu)\n\t\t{\n\t\t\tthis.hangupOptionsMenu.destroy();\n\t\t\treturn;\n\t\t}\n\n\t\tconst targetNodeWidth = this.callView.buttons.hangupOptions.elements.root.offsetWidth;\n\n\t\tlet menuItems = [\n\t\t\t{\n\t\t\t\ttext: BX.message(\"CALL_M_BTN_HANGUP_OPTION_FINISH\"),\n\t\t\t\tonclick: () => {\n\t\t\t\t\tAnalytics.getInstance().onFinishCall({\n\t\t\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t\t\tstatus: Analytics.AnalyticsStatus.finishedForAll,\n\t\t\t\t\t\tchatId: this.currentCall.associatedEntity.id,\n\t\t\t\t\t\tcallUsersCount: this.getMaxActiveCallUsers().length,\n\t\t\t\t\t\tcallLength: Util.getTimeInSeconds(this.currentCall.startDate),\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.isCallHangupButtonPressed = true;\n\n\t\t\t\t\tthis.hangupOptionsMenu?.destroy();\n\n\t\t\t\t\tthis.leaveCurrentCall(false, true);\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: BX.message(\"CALL_M_BTN_HANGUP_OPTION_LEAVE\"),\n\t\t\t\tonclick: () => {\n\t\t\t\t\tAnalytics.getInstance().onDisconnectCall({\n\t\t\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t\t\tsubSection: Analytics.AnalyticsSubSection.contextMenu,\n\t\t\t\t\t\tmediaParams: {\n\t\t\t\t\t\t\tvideo: Hardware.isCameraOn,\n\t\t\t\t\t\t\taudio: !Hardware.isMicrophoneMuted,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.hangupOptionsMenu?.destroy();\n\n\t\t\t\t\tthis.leaveCurrentCall();\n\t\t\t\t},\n\t\t\t},\n\t\t];\n\n\t\tthis.hangupOptionsMenu = new BX.PopupMenuWindow({\n\t\t\tclassName: 'bx-messenger-videocall-hangup-options-container',\n\t\t\tbackground: '#22272B',\n\t\t\tcontentBackground: '#22272B',\n\t\t\tdarkMode: true,\n\t\t\tcontentBorderRadius: '6px',\n\t\t\tangle: false,\n\t\t\tbindElement: this.callView.buttons.hangupOptions.elements.root,\n\t\t\ttargetContainer: this.container,\n\t\t\toffsetTop: -15,\n\t\t\tbindOptions: {position: \"top\"},\n\t\t\tcacheable: false,\n\t\t\tsubMenuOptions: {\n\t\t\t\tmaxWidth: 450\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tonShow: (event) =>\n\t\t\t\t{\n\t\t\t\t\tconst popup = event.getTarget();\n\t\t\t\t\tpopup.getPopupContainer().style.display = 'block'; // bad hack\n\n\t\t\t\t\tconst offsetLeft = (targetNodeWidth / 2) - popup.getPopupContainer().offsetWidth / 2;\n\t\t\t\t\tpopup.setOffset({offsetLeft: offsetLeft + 40, offsetTop: 0});\n\t\t\t\t\tpopup.setAngle({offset: popup.getPopupContainer().offsetWidth / 2 - 17});\n\t\t\t\t},\n\t\t\t\tonDestroy: () => this.hangupOptionsMenu = null\n\t\t\t},\n\t\t\titems: menuItems,\n\t\t});\n\n\t\tthis.hangupOptionsMenu.show();\n\t}\n\n\t_onCallViewCloseButtonClick()\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.close();\n\t\t}\n\t}\n\n\t_onCallViewShowChatButtonClick()\n\t{\n\t\tif (!this.currentCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tAnalytics.getInstance().onShowChat({\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t});\n\n\t\tthis.messengerFacade.openMessenger(this.currentCall.associatedEntity.id);\n\t\tthis.showChat();\n\t}\n\n\t_onCallViewFloorRequestButtonClick()\n\t{\n\t\tAnalytics.getInstance().onFloorRequest({\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t});\n\n\t\tconst floorState = this.callView.getUserFloorRequestState(CallEngine.getCurrentUserId());\n\t\tconst talkingState = this.callView.getUserTalking(CallEngine.getCurrentUserId());\n\t\tthis.callView.setUserFloorRequestState(CallEngine.getCurrentUserId(), !floorState);\n\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.currentCall.requestFloor(!floorState);\n\t\t}\n\n\t\tclearTimeout(this.callViewFloorRequestTimeout);\n\t\tif (talkingState && !floorState)\n\t\t{\n\t\t\tthis.callViewFloorRequestTimeout = setTimeout(() =>\n\t\t\t{\n\t\t\t\tif (this.currentCall)\n\t\t\t\t{\n\t\t\t\t\tthis.currentCall.requestFloor(false);\n\t\t\t\t}\n\t\t\t}, 1500);\n\t\t}\n\n\t\tif (this.riseYouHandToTalkPopup && !floorState)\n\t\t{\n\t\t\tthis.riseYouHandToTalkPopup.close();\n\t\t\tthis.riseYouHandToTalkPopup = null;\n\t\t}\n\t}\n\n\t_onCallViewTurnOffAllParticipansStreamButtonClick(options)\n\t{\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.currentCall.turnOffAllParticipansStream(options);\n\t\t}\n\t}\n\n\t/**\n\t * Returns list of users, that are not currently connected\n\t * @return {Array}\n\t * @private\n\t */\n\t_getDisconnectedUsers()\n\t{\n\t\tconst result = [];\n\t\tconst userStates = this.currentCall.getUsers();\n\n\t\tfor (let userId in userStates)\n\t\t{\n\t\t\tif (userStates[userId] !== UserState.Connected)\n\t\t\t{\n\t\t\t\tconst userData = Util.getUserCached(userId)\n\t\t\t\tif (userData)\n\t\t\t\t{\n\t\t\t\t\tresult.push(userData);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t_closeReconnectionBaloon()\n\t{\n\t\tif (this.reconnectionBaloon)\n\t\t{\n\t\t\tthis.reconnectionBaloon.close();\n\t\t\tthis.reconnectionBaloon = null;\n\t\t}\n\t}\n\n\t_onCallViewUsersListButtonClick(e)\n\t{\n\n\t}\n\n\t_onCallcontrolButtonClick(e)\n\t{\n\t\tif (!Util.canControlChangeSettings())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.participantsPermissionPopup)\n\t\t{\n\t\t\tthis.participantsPermissionPopup.close();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.participantsPermissionPopup = new ParticipantsPermissionPopup({\n\t\t\tturnOffAllParticipansStream: (options) => {\n\t\t\t\tthis._onCallViewTurnOffAllParticipansStreamButtonClick(options);\n\n\t\t\t\tAnalytics.getInstance().onTurnOffAllParticipansStream({\n\t\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t\ttypeOfStream: options.data?.typeOfStream,\n\t\t\t\t});\n\t\t\t},\n\t\t\tonPermissionChanged: (options) => {\n\t\t\t\tthis.currentCall.changeSettings(options);\n\n\t\t\t\tif (!options.settingEnabled) // send only when it turned off\n\t\t\t\t{\n\t\t\t\t\tAnalytics.getInstance().onCallSettingsChanged({\n\t\t\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t\t\ttypeOfSetting: options.typeOfSetting,\n\t\t\t\t\t\tsettingEnabled: options.settingEnabled,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\tonClose: () => {\n\t\t\t\tthis.participantsPermissionPopup = null;\n\t\t\t\tthis._afterCloseParticipantsPermissionPopup();\n\t\t\t},\n\t\t\tonOpen: () => {\n\t\t\t\tthis._afterOpenParticipantsPermissionPopup();\n\n\t\t\t\tAnalytics.getInstance().onOpenCallSettings({\n\t\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t});\n\t\t\t},\n\t\t});\n\n\t\tif (this.participantsPermissionPopup)\n\t\t{\n\t\t\tthis.participantsPermissionPopup.toggle();\n\t\t}\n\t}\n\n\t_onCallViewInviteUserButtonClick(e)\n\t{\n\t\tif (!this.messengerFacade.showUserSelector)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst userStates = this.currentCall ? this.currentCall.getUsers() : {};\n\t\tconst idleUsers = this.currentCall ? this._getDisconnectedUsers() : [];\n\n\t\tthis.messengerFacade.showUserSelector({\n\t\t\tviewElement: this.callView.container,\n\t\t\tbindElement: e.node,\n\t\t\tzIndex: this.messengerFacade.getDefaultZIndex() + 200,\n\t\t\tdarkMode: this.messengerFacade.isThemeDark(),\n\t\t\tidleUsers: idleUsers,\n\t\t\tallowNewUsers: Object.keys(userStates).length < Util.getUserLimit() - 1,\n\t\t\tonDestroy: this._onInvitePopupDestroy.bind(this),\n\t\t\tonSelect: this._onInvitePopupSelect.bind(this)\n\t\t}).then((inviteCloser) => {\n\t\t\tthis.invitePopup = inviteCloser;\n\t\t\tthis.callView.setHotKeyTemporaryBlock(true);\n\t\t});\n\t}\n\n\t_onCallViewToggleMuteHandler(e)\n\t{\n\t\tif (!e.muted && !Hardware?.hasMicrophone())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentRoom = this.currentCall.currentRoom && this.currentCall.currentRoom();\n\t\tif (currentRoom && currentRoom.speaker != this.userId && !e.muted)\n\t\t{\n\t\t\tthis.currentCall.requestRoomSpeaker();\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.currentCall.microphoneId && !e.muted)\n\t\t{\n\t\t\tthis.currentCall.setMicrophoneId(Hardware.defaultMicrophone);\n\t\t}\n\n\t\tHardware.setIsMicrophoneMuted({isMicrophoneMuted: e.muted, calledProgrammatically: !!e.calledProgrammatically});\n\n\t\tif (this.floatingWindow)\n\t\t{\n\t\t\tthis.floatingWindow.setAudioMuted(e.muted);\n\t\t}\n\n\t\tif (this.mutePopup)\n\t\t{\n\t\t\tthis.mutePopup.close();\n\t\t}\n\t\tif (!e.muted)\n\t\t{\n\t\t\tif (!Util.havePermissionToBroadcast('mic'))\n\t\t\t{\n\t\t\t\tthis.showRiseYouHandToTalkNotification({initiatorName: this.lastCalledChangeSettingsUserName});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.allowMutePopup = true;\n\t\t\t}\n\t\t}\n\t\tif (this.isRecording())\n\t\t{\n\t\t\tBXDesktopSystem.CallRecordMute(e.muted);\n\t\t}\n\t}\n\n\t_onCallViewToggleMuteButtonClick(e)\n\t{\n\t\tAnalytics.getInstance().onToggleMicrophone({\n\t\t\tmuted: e.muted,\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t});\n\n\t\tthis._onCallViewToggleMuteHandler(e);\n\t}\n\n\t_onCallViewRecordButtonClick(event)\n\t{\n\t\tAnalytics.getInstance().onRecordBtnClick({\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t});\n\n\t\tif (event.recordState === View.RecordState.Started)\n\t\t{\n\t\t\tif (this.featureRecord === FeatureState.Limited)\n\t\t\t{\n\t\t\t\tthis.messengerFacade.openHelpArticle('call_record');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.featureRecord === FeatureState.Disabled)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.canRecord())\n\t\t\t{\n\t\t\t\tconst forceRecord = BX.prop.getBoolean(event, \"forceRecord\", View.RecordType.None);\n\t\t\t\tif (forceRecord !== View.RecordType.None)\n\t\t\t\t{\n\t\t\t\t\tthis._startRecordCall(forceRecord);\n\t\t\t\t}\n\t\t\t\telse if (DesktopApi.isDesktop() && DesktopApi.getApiVersion() > 55)\n\t\t\t\t{\n\t\t\t\t\tif (!this.callRecordMenu)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst setIsRecordWhenCopilotActivePopupAlreadyShow = () => {\n\t\t\t\t\t\t\tif (this.currentCall)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.currentCall.isRecordWhenCopilotActivePopupAlreadyShow = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.callRecordMenu = new BX.PopupMenuWindow({\n\t\t\t\t\t\t\tbindElement: event.node,\n\t\t\t\t\t\t\ttargetContainer: this.callView.container,\n\t\t\t\t\t\t\titems: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_MENU_RECORD_VIDEO'),\n\t\t\t\t\t\t\t\t\tonclick: (event, item) =>\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tthis._startRecordCall(View.RecordType.Video);\n\t\t\t\t\t\t\t\t\t\titem.getMenuWindow().close();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_MENU_RECORD_AUDIO'),\n\t\t\t\t\t\t\t\t\tonclick: (event, item) =>\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\titem.getMenuWindow().close();\n\n\t\t\t\t\t\t\t\t\t\tif (!this.currentCall)\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (this.currentCall.isRecordWhenCopilotActivePopupAlreadyShow || !this.currentCall.isCopilotActive)\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tthis._startRecordCall(View.RecordType.Audio);\n\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tthis.recordWhenCopilotActivePopup = new RecordWithCopilotPopup({\n\t\t\t\t\t\t\t\t\t\t\tonClose: ()=>\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tsetIsRecordWhenCopilotActivePopupAlreadyShow();\n\t\t\t\t\t\t\t\t\t\t\t\tthis.recordWhenCopilotActivePopup = null;\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tonClickNoButton: () =>\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tthis._startRecordCall(View.RecordType.Audio);\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\ttitle: BX.message('CALL_RECORD_AUDIO_WITH_COPILOT_TITLE'),\n\t\t\t\t\t\t\t\t\t\t\tmessage: BX.message('CALL_RECORD_AUDIO_WITH_COPILOT_MESSAGE'),\n\t\t\t\t\t\t\t\t\t\t\tyesButtonText: BX.message('CALL_RECORD_AUDIO_WITH_COPILOT_YES_BUTTON'),\n\t\t\t\t\t\t\t\t\t\t\tnoButtonText:  BX.message('CALL_RECORD_AUDIO_WITH_COPILOT_NO_BUTTON'),\n\t\t\t\t\t\t\t\t\t\t})\n\n\t\t\t\t\t\t\t\t\t\tthis.recordWhenCopilotActivePopup.show();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tautoHide: true,\n\t\t\t\t\t\t\tangle: {position: \"top\", offset: 80},\n\t\t\t\t\t\t\toffsetTop: 0,\n\t\t\t\t\t\t\toffsetLeft: -25,\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tonPopupClose: () => this.callRecordMenu.destroy(),\n\t\t\t\t\t\t\t\tonPopupDestroy: () => this.callRecordMenu = null\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tthis.callRecordMenu.toggle();\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.callView.setButtonActive('record', true);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (window.BX.Helper)\n\t\t\t\t{\n\t\t\t\t\twindow.BX.Helper.show(\"redirect=detail&code=22079566\");\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\telse if (event.recordState === View.RecordState.Paused)\n\t\t{\n\t\t\tif (this.canRecord())\n\t\t\t{\n\t\t\t\tBXDesktopSystem.CallRecordPause(true);\n\t\t\t}\n\t\t}\n\t\telse if (event.recordState === View.RecordState.Resumed)\n\t\t{\n\t\t\tif (this.canRecord())\n\t\t\t{\n\t\t\t\tBXDesktopSystem.CallRecordPause(false);\n\t\t\t}\n\t\t}\n\t\telse if (event.recordState === View.RecordState.Stopped)\n\t\t{\n\t\t\tthis.callView.setButtonActive('record', false);\n\t\t}\n\n\t\tthis.currentCall.sendRecordState({\n\t\t\taction: event.recordState,\n\t\t\tdate: new Date()\n\t\t});\n\n\t\tthis.callRecordState = event.recordState;\n\t}\n\n\t_onChangeStateCopilot()\n\t{\n\t\tif (this.currentCall.isCopilotActive)\n\t\t{\n\t\t\tAnalytics.getInstance().copilot.onClickAIOff({\n\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\tcallType: this.getCallType(),\n\t\t\t});\n\n\t\t\tthis.deleteCopilotRecordPopup = new RecordWithCopilotPopup({\n\t\t\t\tonClose: ()=> this.deleteCopilotRecordPopup = null,\n\t\t\t\tonClickYesButton: () => {\n\t\t\t\t\tAnalytics.getInstance().copilot.onSelectAIOff({\n\t\t\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t\t});\n\n\t\t\t\t\tthis._onChangeStateCopilotAction(RecorderStatus.PAUSED);\n\t\t\t\t},\n\t\t\t\tonClickNoButton: () => {\n\t\t\t\t\tAnalytics.getInstance().copilot.onSelectAIDelete({\n\t\t\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t\t});\n\n\t\t\t\t\tthis._onChangeStateCopilotAction(RecorderStatus.DESTROYED);\n\t\t\t\t},\n\t\t\t\ttitle: BX.message('CALL_AI_RECORD_STOP_TITLE'),\n\t\t\t\tmessage: BX.message('CALL_AI_RECORD_STOP_MESSAGE'),\n\t\t\t\tyesButtonText: BX.message('CALL_AI_RECORD_STOP_YES_BUTTON'),\n\t\t\t\tnoButtonText:  BX.message('CALL_AI_RECORD_STOP_NO_BUTTON'),\n\t\t\t})\n\n\t\t\tthis.deleteCopilotRecordPopup.show();\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis._onChangeStateCopilotAction(RecorderStatus.ENABLED);\n\t}\n\n\t_onChangeStateCopilotAction(state)\n\t{\n\t\tlet url;\n\t\tswitch (state)\n\t\t{\n\t\t\tcase RecorderStatus.ENABLED:\n\t\t\t\turl = 'call.Track.start';\n\t\t\t\tbreak;\n\n\t\t\tcase RecorderStatus.PAUSED:\n\t\t\t\turl = 'call.Track.stop';\n\t\t\t\tbreak;\n\n\t\t\tcase RecorderStatus.DESTROYED:\n\t\t\t\turl = 'call.Track.destroy';\n\t\t\t\tbreak;\n\t\t}\n\t\tif (this.isLegacyCall(this.currentCall.provider, this.currentCall.scheme))\n\t\t{\n\t\t\tBX.ajax.runAction(url, {\n\t\t\t\tdata: { callId: this.currentCall.id, callUuid: this.currentCall.uuid }\n\t\t\t}).then(() => {\n\t\t\t\tconst newCopilotState = !this.currentCall.isCopilotActive;\n\t\t\t\tthis._onUpdateCallCopilotState(newCopilotState);\n\n\t\t\t\tAnalytics.getInstance().copilot.onAIRecordStatusChanged({\n\t\t\t\t\tisAIOn: newCopilotState,\n\t\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t});\n\n\t\t\t\tif (!newCopilotState)\n\t\t\t\t{\n\t\t\t\t\tthis.showCopilotResultNotify();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.sendStartCopilotRecordAnalytics({ isAutostart: false });\n\t\t\t\t}\n\t\t\t}).catch((error) => {\n\t\t\t\tconst errorCode = error.errors[0].code;\n\t\t\t\tCallAI.handleCopilotError(errorCode);\n\n\t\t\t\tif (this.callView)\n\t\t\t\t{\n\t\t\t\t\tthis.callView.showCopilotErrorNotify(errorCode);\n\t\t\t\t}\n\n\t\t\t\tAnalytics.getInstance().copilot.onAIRecordStatusChanged({\n\t\t\t\t\tisAIOn: newCopilotState,\n\t\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t\terror: errorCode,\n\t\t\t\t});\n\t\t\t\tthis.sendStartCopilotRecordAnalytics({ errorCode, isAutostart: false });\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst newCopilotState = !this.currentCall.isCopilotActive;\n\t\t\tthis._onUpdateCallCopilotState(newCopilotState);\n\t\t\tthis.currentCall.setRecorderState(state);\n\n\t\t\tBX.ajax.runAction(url, {\n\t\t\t\tdata: { callId: this.currentCall.id, callUuid: this.currentCall.uuid }\n\t\t\t});\n\n\t\t\tif (!newCopilotState)\n\t\t\t{\n\t\t\t\tthis.showCopilotResultNotify();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.sendStartCopilotRecordAnalytics({ isAutostart: false });\n\t\t\t}\n\t\t}\n\t}\n\n\t_onCallViewCopilotButtonClick()\n\t{\n\t\tif (this.copilotPopup)\n\t\t{\n\t\t\tthis.copilotPopup.close();\n\t\t\treturn;\n\t\t}\n\n\t\tconst isPlainCall = this.currentCall.provider === Provider.Plain;\n\n\t\tif (!isPlainCall && CallAI.settingsEnabled && !CallAI.tariffAvailable)\n\t\t{\n\t\t\tUtil.openArticle(CallAI.helpSlider);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.copilotPopup = new CopilotPopup({\n\t\t\tisCopilotActive: this.currentCall.isCopilotActive,\n\t\t\tisCopilotFeaturesEnabled: this.currentCall.isCopilotFeaturesEnabled,\n\t\t\tcallId: this.currentCall.id,\n\t\t\tupdateCopilotState: () => {\n\t\t\t\tthis._onChangeStateCopilot();\n\t\t\t},\n\t\t\tonClose: () => {\n\t\t\t\tthis.copilotPopup = null;\n\t\t\t}\n\t\t});\n\n\t\tif (this.copilotPopup)\n\t\t{\n\t\t\tthis.callView.closeCopilotNotify();\n\t\t\tthis.copilotPopup.toggle();\n\t\t}\n\t}\n\n\t_onUpdateCallCopilotState(state)\n\t{\n\t\tif (this.isLegacyCall(this.currentCall.provider, this.currentCall.scheme))\n\t\t{\n\t\t\tthis.currentCall.isCopilotActive = state;\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.updateCopilotState(state);\n\t\t}\n\t}\n\n\t_onSwitchTrackRecordStatus({ isTrackRecordOn, errorCode })\n\t{\n\t\tthis._onUpdateCallCopilotState(isTrackRecordOn);\n\n\t\tif (errorCode)\n\t\t{\n\t\t\tthis.showCopilotNotify(true, errorCode);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (isTrackRecordOn)\n\t\t{\n\t\t\tthis.showCopilotNotify();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.closeCopilotNotify();\n\t\t\tthis.showCopilotResultNotify();\n\t\t}\n\t}\n\n\t_onRecorderStatusChanged({ status, error })\n\t{\n\t\tthis._onUpdateCallCopilotState(status);\n\n\t\tif (!CallAI.tariffAvailable)\n\t\t{\n\t\t\tthis.callView.unblockButtons(['copilot']);\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.currentCall.isCopilotInitialized)\n\t\t{\n\t\t\tif (!this.currentCall.initiatorId && status)\n\t\t\t{\n\t\t\t\tthis.sendStartCopilotRecordAnalytics({ isAutostart: true });\n\t\t\t}\n\t\t\tthis.callView.unblockButtons(['copilot']);\n\t\t}\n\n\t\tif (error)\n\t\t{\n\t\t\tCallAI.handleCopilotError(error);\n\n\t\t\tif (this.callView)\n\t\t\t{\n\t\t\t\tconst errorType = status\n\t\t\t\t\t? CopilotNotifyType.DISABLE_AI_INTERNAL_ERROR\n\t\t\t\t\t: CopilotNotifyType.ENABLE_AI_INTERNAL_ERROR;\n\t\t\t\tthis.callView.showCopilotErrorNotify(errorType);\n\t\t\t}\n\t\t\tthis.sendStartCopilotRecordAnalytics({ error, isAutostart: false });\n\t\t}\n\t\telse if (status)\n\t\t{\n\t\t\tthis.showCopilotNotify();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.closeCopilotNotify();\n\t\t\tthis.showCopilotResultNotify();\n\t\t}\n\t}\n\n\tshowCopilotNotify(force = false, errorCode = '')\n\t{\n\t\tif (\n\t\t\t(this.currentCall.isCopilotActive || force)\n\t\t\t&& this.currentCall.provider !== Provider.Plain\n\t\t\t&& this.callView\n\t\t)\n\t\t{\n\t\t\tthis.callView.showCopilotNotify(this._getCallIdentifier(this.currentCall), errorCode)\n\t\t}\n\t}\n\n\tshowCopilotResultNotify()\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.showCopilotResultNotify()\n\t\t}\n\t}\n\n\tcloseCopilotNotify()\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.closeCopilotNotify();\n\t\t}\n\t}\n\n\tsendStartCopilotRecordAnalytics({ errorCode = null, isAutostart })\n\t{\n\t\tconst params = {\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t\terrorCode: errorCode,\n\t\t\tchatUserCount: this.currentCall?.associatedEntity.userCounter,\n\t\t\tisAutostart,\n\t\t};\n\n\t\tconst userCount = this.getActiveCallUsers().length;\n\t\tif (userCount)\n\t\t{\n\t\t\tparams.userCount = userCount + 1;\n\t\t}\n\t\tAnalytics.getInstance().copilot.onAIRecordStart(params);\n\t}\n\n\t_onCallViewToggleScreenSharingButtonClick()\n\t{\n\t\tAnalytics.getInstance().onScreenShareBtnClick({\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t});\n\n\t\tif (this.featureScreenSharing === FeatureState.Limited)\n\t\t{\n\t\t\tthis.messengerFacade.openHelpArticle('call_screen_sharing');\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.featureScreenSharing === FeatureState.Disabled)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.currentCall.isScreenSharingStarted())\n\t\t{\n\t\t\tif (this.floatingScreenShareWindow)\n\t\t\t{\n\t\t\t\tthis.floatingScreenShareWindow.close();\n\t\t\t}\n\t\t\tif (this.webScreenSharePopup)\n\t\t\t{\n\t\t\t\tthis.webScreenSharePopup.close();\n\t\t\t}\n\t\t\tif (this.documentPromoPopup)\n\t\t\t{\n\t\t\t\tthis.documentPromoPopup.close();\n\t\t\t}\n\t\t\tthis.currentCall.stopScreenSharing();\n\n\t\t\tif (this.isRecording())\n\t\t\t{\n\t\t\t\tBXDesktopSystem.CallRecordStopSharing();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.currentCall.startScreenSharing();\n\t\t\tthis.togglePictureInPictureCallWindow();\n\t\t\tBX.ajax.runAction('call.Call.onShareScreen', { data: { callId: this.currentCall.id, callUuid: this.currentCall.uuid } });\n\t\t}\n\t}\n\n\t_onCallViewToggleVideoButtonClickHandler(e)\n\t{\n\t\tif (!Hardware.initialized)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (e.video && Object.values(Hardware.cameraList).length === 0)\n\t\t{\n\t\t\tthis.showNotification(BX.message(\"IM_CALL_CAMERA_ERROR_FALLBACK_TO_MIC\"));\n\t\t\treturn;\n\t\t}\n\n\t\tHardware.setIsCameraOn({isCameraOn: e.video, calledProgrammatically: !!e.calledProgrammatically});\n\n\t\tif (!e.video && !this.currentCall.isScreenSharingStarted())\n\t\t{\n\t\t\tthis.callView.releaseLocalMedia();\n\t\t}\n\n\t\tif (!this.currentCall.cameraId && e.video)\n\t\t{\n\t\t\tthis.currentCall.setCameraId(Hardware.defaultCamera);\n\t\t}\n\t}\n\n\t_onCallViewToggleVideoButtonClick(e)\n\t{\n\t\tAnalytics.getInstance().onToggleCamera({\n\t\t\tvideo: e.video,\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t});\n\n\t\tthis._onCallViewToggleVideoButtonClickHandler(e);\n\t}\n\n\t_onCallViewToggleSpeakerButtonClick(e)\n\t{\n\t\tconst currentRoom = this.currentCall.currentRoom && this.currentCall.currentRoom();\n\t\tif (currentRoom && currentRoom.speaker != this.userId)\n\t\t{\n\t\t\talert(\"only room speaker can turn on sound\");\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callView.muteSpeaker(!e.speakerMuted);\n\n\t\tif (e.fromHotKey)\n\t\t{\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tcontent: BX.message(this.callView.speakerMuted ? 'IM_M_CALL_MUTE_SPEAKERS_OFF' : 'IM_M_CALL_MUTE_SPEAKERS_ON'),\n\t\t\t\tposition: \"top-right\",\n\t\t\t\tautoHideDelay: 3000,\n\t\t\t\tcloseButton: true\n\t\t\t});\n\t\t}\n\t}\n\n\t_onCallViewMicrophoneSideIconClick()\n\t{\n\t\tconst currentRoom = this.currentCall.currentRoom && this.currentCall.currentRoom();\n\t\tif (currentRoom)\n\t\t{\n\t\t\tthis.toggleRoomMenu(this.callView.buttons.microphone.elements.icon);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.toggleRoomListMenu(this.callView.buttons.microphone.elements.icon);\n\t\t}\n\t}\n\n\t_onCallViewFeedbackButtonClick()\n\t{\n\t\tBX.loadExt('ui.feedback.form').then(() => {\n\t\t\tBX.UI.Feedback.Form.open({\n\t\t\t\tid: `call_feedback_${this._getCallIdentifier(this.currentCall)}-${this.currentCall.instanceId}-${Math.random()}`,\n\t\t\t\tforms: [\n\t\t\t\t\t{ zones: ['ru', 'by', 'kz'], id: 406, sec: '9lhjhn', lang: 'ru' },\n\t\t\t\t\t{ zones: ['de'], id: 754, sec: '6upe49', lang: 'de' },\n\t\t\t\t\t{ zones: ['es'], id: 750, sec: 'whk4la', lang: 'es' },\n\t\t\t\t\t{ zones: ['com.br'], id: 752, sec: 'is01cs', lang: 'com.br' },\n\t\t\t\t\t{ zones: ['en'], id: 748, sec: 'pds0h6', lang: 'en' },\n\t\t\t\t],\n\t\t\t\tpresets: {\n\t\t\t\t\tsender_page: 'call',\n\t\t\t\t\tcall_type: this.currentCall.provider,\n\t\t\t\t\tcall_amount: this.currentCall.users.length + 1,\n\t\t\t\t\tcall_id: `id: ${this._getCallIdentifier(this.currentCall)}, instanceId: ${this.currentCall.instanceId}`,\n\t\t\t\t\tid_of_user: this.currentCall.userId,\n\t\t\t\t\tfrom_domain: location.origin\n\t\t\t\t},\n\t\t\t});\n\t\t})\n\t}\n\n\t_onCallViewShowHistoryButtonClick()\n\t{\n\t\tthis.messengerFacade.openHistory(this.currentCall.associatedEntity.id);\n\t}\n\n\t_onCallViewFullScreenButtonClick()\n\t{\n\t\tif (this.folded)\n\t\t{\n\t\t\tthis.unfold();\n\t\t}\n\t\tthis.toggleFullScreen();\n\t}\n\n\t_onCallViewDocumentButtonClick()\n\t{\n\t\tthis.sidebar ? this.closeDocumentEditor() : this.showDocumentsMenu();\n\t}\n\n\t_onCallViewReplaceCamera(e)\n\t{\n\t\tif (this.reconnectingCameraId) {\n\t\t\tthis.setReconnectingCameraId(null);\n\t\t}\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.currentCall.setCameraId(e.deviceId);\n\t\t}\n\n\t\t// update default camera\n\t\tHardware.defaultCamera = e.deviceId;\n\t}\n\n\t_onCallViewReplaceMicrophone(e)\n\t{\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.currentCall.setMicrophoneId(e.deviceId)\n\t\t\tthis.callView.setMicrophoneId(e.deviceId);\n\t\t}\n\n\t\t// update default microphone\n\t\tHardware.defaultMicrophone = e.deviceId;\n\t}\n\n\t_onCallViewReplaceSpeaker(e)\n\t{\n\t\tHardware.defaultSpeaker = e.deviceId;\n\t}\n\n\t_onCallViewHasMainStream(e)\n\t{\n\t\tif (this.currentCall && this.currentCall.provider === Provider.Bitrix)\n\t\t{\n\t\t\tthis.currentCall.setMainStream(e.userId);\n\t\t}\n\t}\n\n\t_onCallViewTurnOffParticipantMic(e)\n\t{\n\t\tthis.currentCall.turnOffParticipantStream({typeOfStream: 'mic', userId: e.userId, fromUserId: CallEngine.getCurrentUserId()});\n\n\t\tAnalytics.getInstance().onTurnOffParticipantStream({\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t\ttypeOfSetting: 'mic',\n\t\t});\n\t}\n\n\t_onCallViewTurnOffParticipantCam(e)\n\t{\n\t\tthis.currentCall.turnOffParticipantStream({typeOfStream: 'cam', userId: e.userId, fromUserId: CallEngine.getCurrentUserId()});\n\n\t\tAnalytics.getInstance().onTurnOffParticipantStream({\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t\ttypeOfSetting: 'cam',\n\t\t});\n\t}\n\n\t_onCallViewTurnOffParticipantScreenshare(e)\n\t{\n\t\tthis.currentCall.turnOffParticipantStream({typeOfStream: 'screenshare', userId: e.userId, fromUserId: CallEngine.getCurrentUserId()});\n\n\t\tAnalytics.getInstance().onTurnOffParticipantStream({\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t\ttypeOfSetting: 'screenshare',\n\t\t});\n\t}\n\n\t_onCallViewAllowSpeakPermission(e)\n\t{\n\t\tthis.currentCall.allowSpeakPermission({allow: true, userId: e.userId});\n\n\t\tAnalytics.getInstance().onAllowPermissionToSpeakResponse({\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t});\n\t}\n\n\t_onCallViewDisallowSpeakPermission(e)\n\t{\n\t\tthis.currentCall.allowSpeakPermission({allow: false, userId: e.userId});\n\n\t\tAnalytics.getInstance().onDisallowPermissionToSpeakResponse({\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t});\n\t}\n\n\t_onCallViewChangeHdVideo(e)\n\t{\n\t\tHardware.preferHdQuality = e.allowHdVideo;\n\t}\n\n\t_onCallViewChangeMicAutoParams(e)\n\t{\n\t\tHardware.enableMicAutoParameters = e.allowMicAutoParams;\n\t}\n\n\t_onCallViewChangeFaceImprove(e)\n\t{\n\t\tif (!DesktopApi.isDesktop())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDesktopApi.setCameraSmoothingStatus(e.faceImproveEnabled);\n\t}\n\n\t_onCallViewOpenAdvancedSettings()\n\t{\n\t\tthis.messengerFacade.openSettings({onlyPanel: 'hardware'});\n\t}\n\n\t_onCallViewSetCentralUser(e)\n\t{\n\t\tif (e.stream && this.floatingWindow)\n\t\t{\n\t\t\tthis.floatingWindowUser = e.userId;\n\t\t\t//this.floatingWindow.setStream(e.stream);\n\t\t}\n\t}\n\n\t_onCallUserInvited(e)\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tif (this.isLegacyCall(this.currentCall.provider, this.currentCall.scheme))\n\t\t\t{\n\t\t\t\tthis.updateCallViewUsers(this.currentCall.id, [e.userId]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tUtil.setUserData(e.userData);\n\t\t\t\tthis.callView.updateUserData(e.userData);\n\t\t\t}\n\t\t\tthis.callView.addUser(e.userId);\n\t\t}\n\t}\n\n\t_onCallUserJoined(e) {\n\t\tUtil.setUserData(e.userData);\n\t\tsetTimeout(this.updateFloatingWindowContent.bind(this), 100);\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.updateUserData(e.userData);\n\t\t\tthis.callView.addUser(e.userId, UserState.Connected);\n\t\t}\n\t}\n\n\t_onCallDestroy()\n\t{\n\t\tlet callDetails;\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.removeVideoStrategy();\n\t\t\tthis.removeCallEvents();\n\t\t\tcallDetails = this.#getCallDetail(this.currentCall);\n\t\t\tthis.currentCall = null;\n\t\t}\n\n\t\tif (this.promotedToAdminTimeout)\n\t\t{\n\t\t\tclearTimeout(this.promotedToAdminTimeout);\n\t\t}\n\n\t\tif (this.childCall)\n\t\t{\n\t\t\tthis.childCall.removeEventListener(CallEvent.onUserJoined, this._onChildCallFirstMediaHandler);\n\t\t\tthis.childCall.removeEventListener(CallEvent.onRemoteMediaReceived, this._onChildCallFirstUserJoinedHandler);\n\t\t\tthis.childCall.removeEventListener(CallEvent.onLocalMediaReceived, this._onCallLocalMediaReceivedHandler);\n\t\t\tthis.childCall.removeEventListener(CallEvent.onUserStateChanged, this._onCallUserStateChangedHandler);\n\t\t\tthis.childCall.hangup(false, '', true);\n\t\t\tthis.childCall = null;\n\t\t}\n\n\t\tthis.callWithLegacyMobile = false;\n\n\t\tif (this.callNotification)\n\t\t{\n\t\t\tthis.callNotification.close();\n\t\t}\n\t\tif (this.participantsPermissionPopup)\n\t\t{\n\t\t\tthis.participantsPermissionPopup.close();\n\t\t}\n\t\tif (this.invitePopup)\n\t\t{\n\t\t\tthis.invitePopup.close();\n\t\t}\n\n\t\tthis.#stopRecordCall();\n\n\t\tif (this.callRecordMenu)\n\t\t{\n\t\t\tthis.callRecordMenu.close();\n\t\t}\n\n\t\tif (this.callView && this.autoCloseCallView)\n\t\t{\n\t\t\tthis.callView.close();\n\t\t}\n\n\t\tthis.hasStreamFromCall = false;\n\t\tthis._stopLocalStream();\n\n\t\tif (this.floatingWindow)\n\t\t{\n\t\t\tthis.floatingWindow.close();\n\t\t}\n\t\tif (this.floatingScreenShareWindow)\n\t\t{\n\t\t\tthis.floatingScreenShareWindow.close();\n\t\t}\n\t\tif (this.webScreenSharePopup)\n\t\t{\n\t\t\tthis.webScreenSharePopup.close();\n\t\t}\n\t\tif (this.mutePopup)\n\t\t{\n\t\t\tthis.mutePopup.close();\n\t\t}\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.closeWindow(DesktopApi.findWindow('callBackground'));\n\t\t}\n\t\tif (this.riseYouHandToTalkPopup)\n\t\t{\n\t\t\tthis.riseYouHandToTalkPopup.close();\n\t\t\tthis.riseYouHandToTalkPopup = null;\n\t\t}\n\t\tthis.closePromo();\n\n\t\tthis.allowMutePopup = true;\n\t\tthis.docCreatedForCurrentCall = false;\n\t\tthis._closeReconnectionBaloon();\n\t\tthis._closeParticipantsVideoBaloon();\n\n\t\tthis.messengerFacade.stopRepeatSound('dialtone');\n\t\tthis.messengerFacade.stopRepeatSound(this.audioRingtone);\n\n\t\tthis.emit(Events.onCallDestroyed, {\n\t\t\tcallDetails: callDetails\n\t\t})\n\t}\n\n\tloopConnectionQuality(userId, quality, timeout = 200)\n\t{\n\t\tthis.loopTimers[userId] = setTimeout(() => {\n\t\t\tif (this.callView)\n\t\t\t{\n\t\t\t\tthis.callView.setUserConnectionQuality(userId, quality);\n\t\t\t\tconst newQuality = quality >= 4 ? 1 : quality + 1;\n\t\t\t\tthis.loopConnectionQuality(userId, newQuality, timeout);\n\t\t\t}\n\t\t}, timeout);\n\t}\n\n\tclearConnectionQualityTimer(userId)\n\t{\n\t\tif (this.loopTimers[userId] !== undefined)\n\t\t{\n\t\t\tclearTimeout(this.loopTimers[userId]);\n\t\t\tdelete this.loopTimers[userId];\n\t\t}\n\t};\n\n\t_onCallUserStateChanged(e)\n\t{\n\t\tsetTimeout(this.updateFloatingWindowContent.bind(this), 100);\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setUserState(e.userId, e.state);\n\t\t\tif (e.isLegacyMobile)\n\t\t\t{\n\t\t\t\tthis.callView.blockAddUser();\n\t\t\t\tthis.callView.blockSwitchCamera();\n\t\t\t\tthis.callView.blockScreenSharing();\n\t\t\t\tthis.callView.disableMediaSelection();\n\t\t\t\tthis.callView.updateButtons();\n\t\t\t}\n\t\t}\n\n\t\tif (e.state !== UserState.Connected && this.loopTimers[e.userId] === undefined)\n\t\t{\n\t\t\tthis.loopConnectionQuality(e.userId, 1);\n\t\t}\n\n\t\tif (e.state == UserState.Connecting || e.state == UserState.Connected)\n\t\t{\n\t\t\tthis.messengerFacade.stopRepeatSound('dialtone');\n\t\t}\n\n\t\tif (e.state == UserState.Connected)\n\t\t{\n\t\t\tthis.clearConnectionQualityTimer(e.userId);\n\t\t\tthis.callView.setUserConnectionQuality(e.userId, 5);\n\n\t\t\tconst unblockButtonsList = [];\n\t\t\tconst isNeedUnblockCameraButton = ((this.currentCall.provider === Provider.Bitrix && this.currentCall.isGetUserMediaFulfilled()) || this.currentCall.provider === Provider.Plain) && Hardware.hasCamera();\n\n\t\t\tif (!e.isLegacyMobile)\n\t\t\t{\n\t\t\t\tunblockButtonsList.push('floorRequest', 'screen');\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t!e.isLegacyMobile\n\t\t\t\t&& this.isLegacyCall(this.currentCall.provider, this.currentCall.scheme)\n\t\t\t\t&& CallAI.serviceEnabled\n\t\t\t)\n\t\t\t{\n\t\t\t\tunblockButtonsList.push('copilot');\n\t\t\t}\n\n\t\t\tif (!e.isLegacyMobile && isNeedUnblockCameraButton)\n\t\t\t{\n\t\t\t\tunblockButtonsList.push('camera');\n\t\t\t}\n\n\t\t\tif (!!unblockButtonsList.length)\n\t\t\t{\n\t\t\t\tthis.callView.unblockButtons(unblockButtonsList);\n\t\t\t}\n\n\t\t\tif (this.callRecordState === View.RecordState.Stopped)\n\t\t\t{\n\t\t\t\tthis.callView.unblockButtons(['record']);\n\t\t\t}\n\n\t\t\tif (this.currentCall.provider === Provider.Plain) {\n\t\t\t\tthis.callView.unblockAddUser();\n\t\t\t}\n\n\t\t\t/*Util.getUser(e.userId).then(function(userData)\n\t\t\t\t{\n\t\t\t\t\tthis.showNotification(Util.getCustomMessage(\"IM_M_CALL_USER_CONNECTED\", {\n\t\t\t\t\t\tgender: userData.gender,\n\t\t\t\t\t\tname: userData.name\n\t\t\t\t\t}));\n\t\t\t\t}.bind(this));*/\n\t\t}\n\t\telse if (e.state == UserState.Idle && e.previousState == UserState.Connected)\n\t\t{\n\t\t\t/*Util.getUser(e.userId).then(function(userData)\n\t\t\t\t{\n\t\t\t\t\tthis.showNotification(Util.getCustomMessage(\"IM_M_CALL_USER_DISCONNECTED\", {\n\t\t\t\t\t\tgender: userData.gender,\n\t\t\t\t\t\tname: userData.name\n\t\t\t\t\t}));\n\t\t\t\t}.bind(this));*/\n\n\t\t\tif (e.userId === this.callRecordInitiatorId)\n\t\t\t{\n\t\t\t\tthis.callRecordState = View.RecordState.Stopped;\n\t\t\t\tthis.callRecordType = View.RecordType.None;\n\t\t\t\tthis.callView.setRecordState(this.callView.getDefaultRecordState());\n\t\t\t\tthis.callView.setButtonActive('record', false);\n\t\t\t}\n\t\t}\n\t\telse if (e.state == UserState.Failed)\n\t\t{\n\t\t\tif (e.networkProblem)\n\t\t\t{\n\t\t\t\tthis.showNetworkProblemNotification(BX.message(\"IM_M_CALL_TURN_UNAVAILABLE\"));\n\t\t\t}\n\t\t\telse if (this.currentCall instanceof PlainCall)\n\t\t\t{\n\t\t\t\tUtil.getUser(this.currentCall.id, e.userId).then((userData) =>\n\t\t\t\t{\n\t\t\t\t\tthis.showNotification(Util.getCustomMessage(\"IM_M_CALL_USER_FAILED\", {\n\t\t\t\t\t\tgender: userData.gender,\n\t\t\t\t\t\tname: userData.name\n\t\t\t\t\t}));\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse if (e.state == UserState.Declined)\n\t\t{\n\t\t\tconst isLegacyCall = this.isLegacyCall(this.currentCall.provider, this.currentCall.scheme);\n\t\t\tconst isBitrixCall = this.currentCall.provider === Provider.Bitrix;\n\t\t\tconst callId = isLegacyCall || !isBitrixCall ? this.currentCall.id : e.callId;\n\t\t\tif (this.callView)\n\t\t\t{\n\t\t\t\t(async () => {\n\t\t\t\t\ttry\n\t\t\t\t\t{\n\t\t\t\t\t\tconst userData = await Util.getUser(callId, e.userId);\n\t\t\t\t\t\tconst notyText = Util.getCustomMessage('IM_M_CALL_USER_DECLINED', {\n\t\t\t\t\t\t\tgender: userData.gender,\n\t\t\t\t\t\t\tname: userData.name,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.showNotification(notyText);\n\t\t\t\t\t}\n\t\t\t\t\tcatch (error)\n\t\t\t\t\t{\n\t\t\t\t\t\tconsole.warn('not found userData:', error);\n\t\t\t\t\t}\n\t\t\t\t})();\n\t\t\t}\n\t\t}\n\t\telse if (e.state === UserState.Busy && this.isLegacyCall(this.currentCall.provider, this.currentCall.scheme))\n\t\t{\n\t\t\tUtil.getUser(this.currentCall.id, e.userId).then((userData) =>\n\t\t\t{\n\t\t\t\tthis.showNotification(Util.getCustomMessage(\"IM_M_CALL_USER_BUSY\", {\n\t\t\t\t\tgender: userData.gender,\n\t\t\t\t\tname: userData.name\n\t\t\t\t}));\n\t\t\t});\n\t\t}\n\t}\n\n\t_onCallUserMicrophoneState(e)\n\t{\n\t\tif (!this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (e.userId == this.userId)\n\t\t{\n\t\t\tHardware.isMicrophoneMuted = !e.microphoneState;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callView.setUserMicrophoneState(e.userId, e.microphoneState);\n\t\t}\n\t}\n\n\t_onCallUserCameraState(e)\n\t{\n\t\tif (!this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.callView.setUserCameraState(e.userId, e.cameraState);\n\t}\n\n\t_onNeedResetMediaDevicesState(e)\n\t{\n\t\tconsole.log('_onNeedResetMediaDevicesState');\n\t\tHardware.isMicrophoneMuted = true;\n\t\tHardware.isCameraOn = false;\n\n\t\tif (this.mediaDevicesResetStateHintBaloon)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.mediaDevicesResetStateHintBaloon = BX.UI.Notification.Center.notify({\n\t\t\tcontent: Text.encode(BX.message('CALL_MEDIA_DEVICES_RESET_STATE_HINT')),\n\t\t\tautoHide: false,\n\t\t\tposition: \"top-right\",\n\t\t\tcloseButton: true,\n\t\t});\n\t}\n\n\t_onBlockCameraButton()\n\t{\n\t\tif (!this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callView.blockSwitchCamera();\n\t}\n\n\t_onUnblockCameraButton()\n\t{\n\t\tif (!this.callView) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callView.unblockSwitchCamera();\n\t}\n\n\t_onBlockMicrophoneButton()\n\t{\n\t\tif (!this.callView) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callView.blockSwitchMicrophone();\n\t}\n\n\t_onUnblockMicrophoneButton()\n\t{\n\t\tif (!this.callView) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callView.unblockSwitchMicrophone();\n\t}\n\n\t_onCameraPublishing(e)\n\t{\n\t\tif (e.publishing)\n\t\t{\n\t\t\tthis._onBlockCameraButton();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._onUnblockCameraButton();\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.updateButtons();\n\t\t}\n\t}\n\n\t_onMicrophonePublishingd(e)\n\t{\n\t\tif (!this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (e.publishing)\n\t\t{\n\t\t\tthis._onBlockMicrophoneButton();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._onUnblockMicrophoneButton();\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.updateButtons();\n\t\t}\n\t}\n\n\t_onCallUserVideoPaused(e)\n\t{\n\t\tif (!this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.callView.setUserVideoPaused(e.userId, e.videoPaused);\n\t}\n\n\t_onCallLocalScreenUpdated(e)\n\t{\n\t\tconst { track } = e;\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setLocalStreamVideoTrack(track)\n\t\t}\n\t}\n\n\t_onCallLocalMediaReceived(e)\n\t{\n\t\tthis.log(\"Received local media stream \" + e.tag);\n\t\tthis.hasStreamFromCall = true;\n\t\tif (this.callView)\n\t\t{\n\t\t\tconst flipVideo = (e.tag === \"main\" || e.mediaRenderer) ? Hardware.enableMirroring : false;\n\n\t\t\tthis.callView.setLocalStream(e);\n\t\t\tthis.callView.flipLocalVideo(flipVideo);\n\n\t\t\tthis.callView.setButtonActive(\"screen\", this.currentCall.isScreenSharingStarted());\n\t\t\tif (this.currentCall.isScreenSharingStarted())\n\t\t\t{\n\t\t\t\tthis.screenShareStartTime = new Date();\n\t\t\t\tAnalytics.getInstance().onScreenShareStarted({\n\t\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t});\n\n\t\t\t\tthis.togglePictureInPictureCallWindow();\n\n\t\t\t\tif (!DesktopApi.isDesktop())\n\t\t\t\t{\n\t\t\t\t\tthis.showWebScreenSharePopup();\n\t\t\t\t}\n\n\t\t\t\tthis.callView.updateButtons();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tAnalytics.getInstance().onScreenShareStopped({\n\t\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t\tstatus: Analytics.AnalyticsStatus.success,\n\t\t\t\t\tscreenShareLength: Util.getTimeInSeconds(this.screenShareStartTime),\n\t\t\t\t});\n\t\t\t\tthis.screenShareStartTime = null;\n\n\t\t\t\tthis.togglePictureInPictureCallWindow();\n\n\t\t\t\tif (this.floatingScreenShareWindow)\n\t\t\t\t{\n\t\t\t\t\tthis.floatingScreenShareWindow.close();\n\t\t\t\t}\n\t\t\t\tif (this.webScreenSharePopup)\n\t\t\t\t{\n\t\t\t\t\tthis.webScreenSharePopup.close();\n\t\t\t\t}\n\t\t\t\tif (this.isRecording())\n\t\t\t\t{\n\t\t\t\t\tBXDesktopSystem.CallRecordStopSharing();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!this.currentCall.callFromMobile)\n\t\t\t{\n\t\t\t\tthis.callView.unblockSwitchCamera();\n\t\t\t\tthis.callView.updateButtons();\n\t\t\t}\n\n\t\t\tif (this.localStream)\n\t\t\t{\n\t\t\t\tthis._stopLocalStream();\n\t\t\t}\n\t\t}\n\n\t\tif (this.currentCall && Hardware.isCameraOn && e.tag === 'main' && e.stream.getVideoTracks().length === 0)\n\t\t{\n\t\t\tif (this.currentCall.canChangeMediaDevices())\n\t\t\t{\n\t\t\t\tthis.showNotification(BX.message(\"IM_CALL_CAMERA_ERROR_FALLBACK_TO_MIC\"));\n\t\t\t}\n\t\t\tHardware.isCameraOn = false;\n\t\t}\n\t}\n\n\t_onCallLocalCameraFlip(e)\n\t{\n\t\tthis._onCallLocalCameraFlipInDesktop(e.data.enableMirroring);\n\t}\n\n\t_onCallLocalCameraFlipInDesktop(e)\n\t{\n\t\tconsole.error('FLIPPING LOCAL VIDEO');\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.flipLocalVideo(e);\n\t\t}\n\t}\n\n\t_onCallLocalMediaStopped(e)\n\t{\n\t\t// do nothing\n\t}\n\n\t#setUserMedia(e)\n\t{\n\t\tif (!this.callView)\n\t\t{\n\t\t\tUtil.sendLog({\n\t\t\t\tdescription: 'trying to do #setUserMedia, but callView is not initialized yet',\n\t\t\t\tuserId: e.userId,\n\t\t\t\tkind: e.kind,\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tif ('track' in e)\n\t\t{\n\t\t\tthis.callView.setUserMedia(e.userId, e.kind, e.track);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif ('mediaRenderer' in e)\n\t\t{\n\t\t\tconst kind = e.mediaRenderer.kind;\n\t\t\tconst audioTrack = e.mediaRenderer.stream?.getAudioTracks()?.[0];\n\t\t\tconst videoTrack = e.mediaRenderer.stream?.getVideoTracks()?.[0];\n\n\t\t\tif ((kind === 'audio' || kind === 'sharingAudio') && audioTrack)\n\t\t\t{\n\t\t\t\tthis.callView.setUserMedia(e.userId, kind, audioTrack);\n\t\t\t}\n\t\t\telse if ((kind === 'video' || kind === 'sharing') && videoTrack)\n\t\t\t{\n\t\t\t\tthis.callView.setVideoRenderer(e.userId, e.mediaRenderer);\n\t\t\t}\n\t\t}\n\t}\n\n\t_onCallRemoteMediaReceived(e)\n\t{\n\t\tif (this.onCallViewRenderToMediaReceived)\n\t\t{\n\t\t\tconst style = 'background-color: #00F; color: white;'\n\t\t\tconsole.log(`%c[debug] Time from view render to the first media received: ${Date.now() - this.onCallViewRenderToMediaReceived} ms`, style);\n\n\t\t\tthis.onCallViewRenderToMediaReceived = null;\n\t\t}\n\n\t\tif (this.onConnectToCallClick)\n\t\t{\n\t\t\tconst style = 'background-color: #AA00AA; color: white;'\n\t\t\tconsole.log(`%c[debug] Time from click to the first media received: ${Date.now() - this.onConnectToCallClick} ms`, style);\n\n\t\t\tthis.onConnectToCallClick = null;\n\t\t}\n\n\t\tthis.#setUserMedia(e);\n\t}\n\n\t_onCallRemoteMediaStopped(e)\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tif ('mediaRenderer' in e)\n\t\t\t{\n\t\t\t\tif (e.kind === 'video' || e.kind === 'sharing')\n\t\t\t\t{\n\t\t\t\t\te.mediaRenderer.stream = null;\n\t\t\t\t\tthis.callView.setVideoRenderer(e.userId, e.mediaRenderer);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.callView.setUserMedia(e.userId, e.kind, null);\n\t\t\t}\n\t\t}\n\t}\n\n\tisLegacyCall(provider, scheme = null): boolean\n\t{\n\t\tif (scheme)\n\t\t{\n\t\t\treturn scheme === CallScheme.classic;\n\t\t}\n\n\t\tconst isLegacyPlainCall = provider === Provider.Plain && !CallSettingsManager.isJwtInPlainCallsEnabled();\n\t\tconst isLegacyBitrixCall = provider === Provider.Bitrix && !CallSettingsManager.jwtCallsEnabled;\n\n\t\treturn isLegacyPlainCall || isLegacyBitrixCall;\n\t}\n\n\t_getCallIdentifier(call)\n\t{\n\t\tif (!call)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn this.isLegacyCall(call.provider, call.scheme) ? call.id : call.uuid;\n\t}\n\n\t_prepareLocalStream(provider, fallback = false)\n\t{\n\t\tconst video = {};\n\n\t\tif (Hardware.defaultCamera)\n\t\t{\n\t\t\tvideo.deviceId = { exact: Hardware.defaultCamera };\n\t\t}\n\n\t\tif (!fallback)\n\t\t{\n\t\t\tvideo.width = { ideal: 1280 };\n\t\t\tvideo.height = { ideal: 720 };\n\t\t}\n\n\t\tconst isNotSupportDevicesListBeforeStream = UnsupportedBrowserFeatures.isNotSupportDevicesListBeforeStream;\n\t\tconst constraints = { audio: isNotSupportDevicesListBeforeStream, video };\n\t\t\tHardware.getUserMedia(constraints).then((stream) =>\n\t\t\t{\n\t\t\t\tthis.localStream = stream;\n\n\t\t\t\tif (!this.initCallPromise || !Hardware.isCameraOn)\n\t\t\t\t{\n\t\t\t\t\tthis._stopLocalStream();\n\t\t\t\t}\n\t\t\t\telse if (this.callView)\n\t\t\t\t{\n\t\t\t\t\tthis._setLocalStream(provider);\n\t\t\t\t}\n\t\t\t\tif (isNotSupportDevicesListBeforeStream)\n\t\t\t\t{\n\t\t\t\t\tthis._onGetUserMediaEnded();\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((error) =>\n\t\t\t{\n\t\t\t\tthis.log(`Attempt to get video (fallback: ${!!fallback}) for call before it has been created failed`, error);\n\t\t\t\tif (!fallback)\n\t\t\t\t{\n\t\t\t\t\tthis._prepareLocalStream(provider, true);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\t_setLocalStream(provider)\n\t{\n\t\tlet streamData;\n\t\tif (provider === Provider.Plain)\n\t\t{\n\t\t\tstreamData = {\n\t\t\t\tstream: this.localStream,\n\t\t\t\ttag: 'main',\n\t\t\t\tflipVideo: Hardware.enableMirroring,\n\t\t\t};\n\t\t}\n\t\telse\n\t\t{\n\t\t\tstreamData = {\n\t\t\t\tmediaRenderer: {\n\t\t\t\t\tkind: 'video',\n\n\t\t\t\t\tstream: this.localStream,\n\n\t\t\t\t\trender(el)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!el.srcObject || !el.srcObject.active || el.srcObject.id !== this.stream.id)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tel.srcObject = this.stream;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\n\t\t\t\t\trequestVideoSize()\n\t\t\t\t\t{\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\ttag: 'main',\n\t\t\t\tstream: this.localStream,\n\t\t\t\tflipVideo: Hardware.enableMirroring,\n\t\t\t};\n\t\t}\n\n\t\tthis.callView.setLocalStream(streamData);\n\t}\n\n\t_stopLocalStream()\n\t{\n\t\tif (this.localStream)\n\t\t{\n\t\t\tUtil.sendLog({ description: 'Stop local media stream' });\n\t\t\tUtil.stopMediaStream(this.localStream);\n\t\t\tthis.localStream = null;\n\t\t}\n\t}\n\n\t_onCallBadNetworkIndicator(e)\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setBadNetworkIndicator(e.userId, e.badNetworkIndicator);\n\t\t}\n\t}\n\n\t_onCallConnectionQualityChanged(e)\n\t{\n\t\tthis.clearConnectionQualityTimer(e.userId);\n\n\t\tthis.callView.setUserConnectionQuality(e.userId, e.score);\n\t}\n\n\t_onCallToggleRemoteParticipantVideo(e)\n\t{\n\t\tif (this.toogleParticipantsVideoBaloon)\n\t\t{\n\t\t\tif (e.isVideoShown)\n\t\t\t{\n\t\t\t\tthis._closeParticipantsVideoBaloon();\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!e.isVideoShown)\n\t\t{\n\t\t\tthis.toogleParticipantsVideoBaloon = BX.UI.Notification.Center.notify({\n\t\t\t\tcontent: Text.encode(BX.message('IM_M_CALL_REMOTE_PARTICIPANTS_VIDEO_MUTED')),\n\t\t\t\tautoHide: false,\n\t\t\t\tposition: \"top-right\",\n\t\t\t\tcloseButton: false,\n\t\t\t})\n\t\t}\n\t}\n\n\t_closeParticipantsVideoBaloon()\n\t{\n\t\tif (this.toogleParticipantsVideoBaloon)\n\t\t{\n\t\t\tthis.toogleParticipantsVideoBaloon.close();\n\t\t\tthis.toogleParticipantsVideoBaloon = null;\n\t\t}\n\t}\n\n\t_onCallUserVoiceStarted(e)\n\t{\n\t\tif (e.local)\n\t\t{\n\t\t\tif (this.currentCall.muted && this.isMutedPopupAllowed())\n\t\t\t{\n\t\t\t\tthis.showMicMutedNotification();\n\t\t\t}\n\n\t\t\tif (this.currentCall.muted)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.talkingUsers[e.userId] = true;\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setUserTalking(e.userId, true);\n\t\t\tif (e.userId == this.callView.localUser.id)\n\t\t\t{\n\t\t\t\tthis.callView.setUserFloorRequestState(e.userId, false);\n\t\t\t}\n\n\t\t}\n\t\tif (this.floatingWindow)\n\t\t{\n\t\t\tthis.floatingWindow.setTalking(Object.keys(this.talkingUsers).map(function (id)\n\t\t\t{\n\t\t\t\treturn Number(id);\n\t\t\t}));\n\t\t}\n\t}\n\n\t_onCallUserVoiceStopped(e)\n\t{\n\t\tif (this.talkingUsers[e.userId])\n\t\t{\n\t\t\tdelete this.talkingUsers[e.userId];\n\t\t}\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setUserTalking(e.userId, false);\n\t\t}\n\t\tif (this.floatingWindow)\n\t\t{\n\t\t\tthis.floatingWindow.setTalking(Object.keys(this.talkingUsers).map(function (id)\n\t\t\t{\n\t\t\t\treturn Number(id);\n\t\t\t}));\n\t\t}\n\t}\n\n\t_onBlockUnblockCamMicButtons()\n\t{\n\t\tif (Util.havePermissionToBroadcast('cam'))\n\t\t{\n\t\t\tthis._onUnblockCameraButton();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._onBlockCameraButton();\n\t\t}\n\n\t\tif (Util.havePermissionToBroadcast('mic'))\n\t\t{\n\t\t\tthis._onUnblockMicrophoneButton();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._onBlockMicrophoneButton();\n\t\t}\n\t}\n\n\t_onAllParticipantsAudioMuted(e)\n\t{\n\t\tconst userModel = this.callView.userRegistry.get(e.userId);\n\n\t\tlet content = '<div class = \"bx-call-view-participants-control-stream-notify-icon bx-call-view-mic-muted\"></div>'\n\t\t\t+ (Text.encode(Util.getCustomMessage(\"CALL_USER_TURNED_OFF_MIC_FOR_ALL_MSGVER_1\", {\n\t\t\t\tgender: (userModel.data.gender? userModel.data.gender.toUpperCase() : 'M'),\n\t\t\t\tname: userModel.data.name\n\t\t\t})));\n\n\t\tif (content && (!e.reason || e.reason !== 'settings'))\n\t\t{\n\t\t\tthis.createCallControlNotify({content: content, isAllow: false});\n\t\t}\n\n\t\tif (Util.isRegularUser(Util.getCurrentUserRole()))\n\t\t{\n\t\t\tthis._onCallViewToggleMuteHandler({muted: true, calledProgrammatically: true});\n\t\t}\n\t}\n\n\t_onAllParticipantsVideoMuted(e)\n\t{\n\n\t\tconst userModel = this.callView.userRegistry.get(e.userId);\n\n\t\tlet content = '<div class = \"bx-call-view-participants-control-stream-notify-icon bx-call-view-cam-muted\"></div>'\n\t\t\t+ (Text.encode(Util.getCustomMessage(\"CALL_USER_TURNED_OFF_CAM_FOR_ALL_MSGVER_1\", {\n\t\t\t\tgender: (userModel.data.gender? userModel.data.gender.toUpperCase() : 'M'),\n\t\t\t\tname: userModel.data.name\n\t\t\t})));\n\n\t\tif (content && (!e.reason || e.reason !== 'settings'))\n\t\t{\n\t\t\tthis.createCallControlNotify({content: content, isAllow: false});\n\t\t}\n\n\t\tif (Util.isRegularUser(Util.getCurrentUserRole()))\n\t\t{\n\t\t\tthis._onCallViewToggleVideoButtonClickHandler({video: false, calledProgrammatically: true});\n\t\t}\n\t}\n\n\t_onAllParticipantsScreenshareMuted(e)\n\t{\n\t\tconst userModel = this.callView.userRegistry.get(e.userId);\n\n\t\tlet content = '<div class = \"bx-call-view-participants-control-stream-notify-icon bx-call-view-cam-muted\"></div>'\n\t\t\t+ (Text.encode(Util.getCustomMessage(\"CALL_USER_TURNED_OFF_SCREENSHARE_FOR_ALL_MSGVER_1\", {\n\t\t\t\tgender: (userModel.data.gender? userModel.data.gender.toUpperCase() : 'M'),\n\t\t\t\tname: userModel.data.name\n\t\t\t})));\n\n\t\tif (content && (!e.reason || e.reason !== 'settings'))\n\t\t{\n\t\t\tthis.createCallControlNotify({content: content, isAllow: false});\n\t\t}\n\n\t\tif (this.currentCall.isScreenSharingStarted() && Util.isRegularUser(Util.getCurrentUserRole()))\n\t\t{\n\t\t\tthis._onCallViewToggleScreenSharingButtonClick();\n\t\t}\n\t}\n\n\t_onParticipantMuted(e)\n\t{\n\t\tif (e.data?.track.muted) // tbh always should be in \"true\"..\n\t\t{\n\t\t\tlet contentIcon = 'mic';\n\t\t\tlet contentPhrase = '';\n\t\t\tconst initiatorUserModel = this.callView.userRegistry.get(e.data.fromUserId);\n\t\t\tconst targetUserModel = this.callView.userRegistry.get(e.data.toUserId);\n\t\t\tconst initiatorGender = (initiatorUserModel.data.gender ? initiatorUserModel.data.gender.toUpperCase() : 'M');\n\n\t\t\tif (e.data.toUserId == CallEngine.getCurrentUserId())\n\t\t\t{\n\t\t\t\tif (e.data.track.type === 0)\n\t\t\t\t{\n\t\t\t\t\tcontentPhrase = 'CALL_CONTROL_MODERATOR_TURNED_OFF_YOUR_MIC_MSGVER_1' + '_' + initiatorGender;\n\t\t\t\t\tthis._onCallViewToggleMuteHandler({muted: true, calledProgrammatically: true});\n\t\t\t\t}\n\t\t\t\telse if (e.data.track.type === 1)\n\t\t\t\t{\n\t\t\t\t\tcontentIcon = 'cam';\n\t\t\t\t\tcontentPhrase = 'CALL_CONTROL_MODERATOR_TURNED_OFF_YOUR_CAM_MSGVER_1' + '_' + initiatorGender;\n\t\t\t\t\tthis._onCallViewToggleVideoButtonClickHandler({video: false, calledProgrammatically: true});\n\t\t\t\t}\n\t\t\t\telse if (e.data.track.type === 2)\n\t\t\t\t{\n\t\t\t\t\tcontentIcon = 'screenshare';\n\t\t\t\t\tcontentPhrase = 'CALL_CONTROL_MODERATOR_TURNED_OFF_YOUR_SCREENSHARE' + '_' + initiatorGender;\n\t\t\t\t\tif (this.currentCall.isScreenSharingStarted())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._onCallViewToggleScreenSharingButtonClick();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (e.data.fromUserId == CallEngine.getCurrentUserId())\n\t\t\t\t{\n\t\t\t\t\tif (e.data.track.type === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tcontentPhrase = 'CALL_CONTROL_YOU_TURNED_OFF_USER_MIC';\n\t\t\t\t\t}\n\t\t\t\t\telse if (e.data.track.type === 1)\n\t\t\t\t\t{\n\t\t\t\t\t\tcontentIcon = 'cam';\n\t\t\t\t\t\tcontentPhrase = 'CALL_CONTROL_YOU_TURNED_OFF_USER_CAM';\n\t\t\t\t\t}\n\t\t\t\t\telse if (e.data.track.type === 2)\n\t\t\t\t\t{\n\t\t\t\t\t\tcontentIcon = 'screenshare';\n\t\t\t\t\t\tcontentPhrase = 'CALL_CONTROL_YOU_TURNED_OFF_USER_SCREENSHARE';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tif (e.data.track.type === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tcontentPhrase = 'CALL_CONTROL_MODERATOR_TURNED_OFF_USER_MIC_MSGVER_1' + '_' + initiatorGender;\n\t\t\t\t\t}\n\t\t\t\t\telse if (e.data.track.type === 1)\n\t\t\t\t\t{\n\t\t\t\t\t\tcontentIcon = 'cam';\n\t\t\t\t\t\tcontentPhrase = 'CALL_CONTROL_MODERATOR_TURNED_OFF_USER_CAM_MSGVER_1' + '_' + initiatorGender;\n\t\t\t\t\t}\n\t\t\t\t\telse if (e.data.track.type === 2)\n\t\t\t\t\t{\n\t\t\t\t\t\tcontentIcon = 'screenshare';\n\t\t\t\t\t\tcontentPhrase = 'CALL_CONTROL_MODERATOR_TURNED_OFF_USER_SCREENSHARE' + '_' + initiatorGender;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet content =\n\t\t\t\t'<div class = \"bx-call-view-participants-control-stream-notify-icon bx-call-view-'+contentIcon+'-muted\"></div>'\n\t\t\t\t+ (Text.encode(Util.getCustomMessage(contentPhrase, {\n\t\t\t\t\tgender: initiatorGender,\n\t\t\t\t\tinitiator_name: initiatorUserModel.data.name,\n\t\t\t\t\ttarget_name: targetUserModel.data.name,\n\t\t\t\t})));\n\n\t\t\tthis.createCallControlNotify({content: content, isAllow: false});\n\t\t}\n\t}\n\n\t_onYouMuteAllParticipants(e)\n\t{\n\t\tlet typesOfMute = {0: 'mic', 1: 'cam', 2: 'screenshare'};\n\t\tlet typesOfMuteMessage = {0: 'CALL_YOU_TURNED_OFF_MIC_FOR_ALL_MSGVER_1', 1: 'CALL_YOU_TURNED_OFF_CAM_FOR_ALL_MSGVER_1', 2: 'CALL_YOU_TURNED_OFF_SCREENSHARE_FOR_ALL_MSGVER_1'};\n\n\t\tlet content = '<div class = \"bx-call-view-participants-control-stream-notify-icon bx-call-view-'+(typesOfMute[e.data.track.type])+'-muted\"></div>'\n\t\t+ (BX.message[(typesOfMuteMessage[e.data.track.type])]);\n\n\t\tthis.createCallControlNotify({content: content, isAllow: false});\n\t}\n\n\t_onUserPermissionsChanged(e)\n\t{\n\t\tconst initiatorUserModel = this.callView.userRegistry.get(e.data.fromUserId);\n\t\tconst initiatorGender = (initiatorUserModel.data.gender ? initiatorUserModel.data.gender.toUpperCase() : 'M');\n\n\t\tlet contentPhrase = 'CALL_ADMIN_ALLOWED_TURN_ON_ALL_FOR_YOU_BY_HANDRAISE_' + initiatorGender;\n\n\t\tif (!e.data.allow)\n\t\t{\n\t\t\tcontentPhrase = 'CALL_ADMIN_NOT_ALLOWED_TURN_ON_ALL_FOR_YOU_BY_HANDRAISE_' + initiatorGender;\n\t\t\tconst floorState = this.callView.getUserFloorRequestState(CallEngine.getCurrentUserId());\n\n\t\t\tif (floorState)\n\t\t\t{\n\t\t\t\tthis._onCallViewFloorRequestButtonClick();\n\t\t\t}\n\t\t}\n\n\t\tconst content = Text.encode(Util.getCustomMessage(contentPhrase, {\n\t\t\tgender: initiatorGender,\n\t\t\tinitiator_name: initiatorUserModel.data.name,\n\t\t}));\n\n\t\tif (content)\n\t\t{\n\t\t\tthis.createCallControlNotify({content: content, isAllow: e.data.allow});\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setUserPermissionToSpeakState(e.data.toUserId, e.data.allow);\n\t\t}\n\n\t\tthis.callView.updateButtons();\n\t\tthis._onBlockUnblockCamMicButtons();\n\t}\n\n\t_onUserRoleChanged(e)\n\t{\n\t\tif (e.data.toUserId == CallEngine.getCurrentUserId())\n\t\t{\n\t\t\tconst content = BX.message('CALL_YOU_HAVE_BEEN_APPOINTED_AS_ADMIN');\n\n\t\t\tif (content)\n\t\t\t{\n\t\t\t\tthis.promotedToAdminTimeout = setTimeout(\n\t\t\t\t\t() => this.createCallControlNotify({content: content, isAllow: true}),\n\t\t\t\t\tthis.promotedToAdminTimeoutValue\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (this.riseYouHandToTalkPopup)\n\t\t\t{\n\t\t\t\tthis.riseYouHandToTalkPopup.close();\n\t\t\t\tthis.riseYouHandToTalkPopup = null;\n\t\t\t}\n\n\t\t\tif (this.callView)\n\t\t\t{\n\t\t\t\tthis.callView.updateButtons();\n\t\t\t\tthis.callView.updateFloorRequestNotification();\n\t\t\t}\n\n\t\t\tthis._onBlockUnblockCamMicButtons();\n\t\t}\n\t}\n\n\t_onRoomSettingsChanged(e)\n\t{\n\t\tlet typesOfMute = {'audio': 'mic', 'video': 'cam', 'screen_share': 'screenshare'};\n\n\t\tlet content = '';\n\t\tlet isAllow = false;\n\n\t\tconst initiatorUserModel = this.callView.userRegistry.get(e.data.fromUserId);\n\t\tconst initiatorGender = (initiatorUserModel.data.gender ? initiatorUserModel.data.gender.toUpperCase() : 'M');\n\n\t\tif (e.data.eft === true)\n\t\t{\n\t\t\tif (e.data.fromUserId == this.currentCall.userId)\n\t\t\t{\n\t\t\t\tconst typesOfMuteMessage =\n\t\t\t\t{\n\t\t\t\t\t'audio': 'CALL_YOU_PROHIBITED_MIC_FOR_ALL_BY_SETTINGS',\n\t\t\t\t\t'video': 'CALL_YOU_PROHIBITED_CAM_FOR_ALL_BY_SETTINGS',\n\t\t\t\t\t'screen_share': 'CALL_YOU_PROHIBITED_SCREENSHARE_FOR_ALL_BY_SETTINGS',\n\t\t\t\t};\n\n\t\t\t\tcontent = '<div class = \"bx-call-view-participants-control-stream-notify-icon bx-call-view-'+(typesOfMute[e.data.act])+'-muted\"></div>'\n\t\t\t\t+ (BX.message[(typesOfMuteMessage[e.data.act])]);\n\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst typesOfMuteMessage =\n\t\t\t\t{\n\t\t\t\t\t'audio': 'CALL_ADMIN_PROHIBITED_MIC_FOR_ALL_BY_SETTINGS',\n\t\t\t\t\t'video': 'CALL_ADMIN_PROHIBITED_CAM_FOR_ALL_BY_SETTINGS',\n\t\t\t\t\t'screen_share': 'CALL_ADMIN_PROHIBITED_SCREENSHARE_FOR_ALL_BY_SETTINGS',\n\t\t\t\t};\n\n\t\t\t\tlet contentPhrase = typesOfMuteMessage[e.data.act] + '_' + initiatorGender;\n\n\t\t\t\tcontent = '<div class = \"bx-call-view-participants-control-stream-notify-icon bx-call-view-'+(typesOfMute[e.data.act])+'-muted\"></div>'\n\t\t\t\t+ (Text.encode(Util.getCustomMessage(contentPhrase, {\n\t\t\t\t\tgender: initiatorGender,\n\t\t\t\t\tinitiator_name: initiatorUserModel.data.name,\n\t\t\t\t})));\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tisAllow = true;\n\t\t\tif (e.data.fromUserId == this.currentCall.userId)\n\t\t\t{\n\t\t\t\tif (this.riseYouHandToTalkPopup)\n\t\t\t\t{\n\t\t\t\t\tthis.riseYouHandToTalkPopup.close();\n\t\t\t\t\tthis.riseYouHandToTalkPopup = null;\n\t\t\t\t}\n\t\t\t\tconst typesOfMuteMessage =\n\t\t\t\t{\n\t\t\t\t\t'audio': 'CALL_YOU_ALLOWED_MIC_FOR_ALL_BY_SETTINGS',\n\t\t\t\t\t'video': 'CALL_YOU_ALLOWED_CAM_FOR_ALL_BY_SETTINGS',\n\t\t\t\t\t'screen_share': 'CALL_YOU_ALLOWED_SCREENSHARE_FOR_ALL_BY_SETTINGS',\n\t\t\t\t};\n\n\t\t\t\tcontent = '<div class = \"bx-call-view-participants-control-stream-notify-icon bx-call-view-'+(typesOfMute[e.data.act])+'-unmuted\"></div>'\n\t\t\t\t+ (BX.message[(typesOfMuteMessage[e.data.act])]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst typesOfMuteMessage =\n\t\t\t\t{\n\t\t\t\t\t'audio': 'CALL_ADMIN_ALLOWED_MIC_FOR_ALL_BY_SETTINGS',\n\t\t\t\t\t'video': 'CALL_ADMIN_ALLOWED_CAM_FOR_ALL_BY_SETTINGS',\n\t\t\t\t\t'screen_share': 'CALL_ADMIN_ALLOWED_SCREENSHARE_FOR_ALL_BY_SETTINGS',\n\t\t\t\t};\n\n\t\t\t\tlet contentPhrase = typesOfMuteMessage[e.data.act] + '_' + initiatorGender;\n\n\t\t\t\tcontent = '<div class = \"bx-call-view-participants-control-stream-notify-icon bx-call-view-'+(typesOfMute[e.data.act])+'-unmuted\"></div>'\n\t\t\t\t+ (Text.encode(Util.getCustomMessage(contentPhrase, {\n\t\t\t\t\tgender: initiatorGender,\n\t\t\t\t\tinitiator_name: initiatorUserModel.data.name,\n\t\t\t\t})));\n\n\t\t\t\tif (this.riseYouHandToTalkPopup && e.data.act === 'audio')\n\t\t\t\t{\n\t\t\t\t\tthis.riseYouHandToTalkPopup.close();\n\t\t\t\t\tthis.riseYouHandToTalkPopup = null;\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\n\t\tif (this.callView && !isAllow)\n\t\t{\n\t\t\tthis.callView.setAllUserPermissionToSpeakState(false);\n\t\t}\n\n\t\tif (content)\n\t\t{\n\t\t\tthis.createCallControlNotify({content: content, isAllow: isAllow});\n\t\t}\n\n\t\tif (this.participantsPermissionPopup)\n\t\t{\n\t\t\tthis.participantsPermissionPopup.updateStatePermissions();\n\t\t}\n\n\t\tif (e.data.eft === true && e.data.act === 'audio' && !Util.havePermissionToBroadcast('mic'))\n\t\t{\n\t\t\tthis.lastCalledChangeSettingsUserName = initiatorUserModel.data.name;\n\t\t\tthis.showRiseYouHandToTalkNotification({initiatorName: this.lastCalledChangeSettingsUserName});\n\t\t}\n\n\t\tthis.callView.updateButtons();\n\t\tthis._onBlockUnblockCamMicButtons();\n\t}\n\n\t_afterOpenParticipantsPermissionPopup()\n\t{\n\t\tif (this.participantsPermissionPopup)\n\t\t\t{\n\t\t\tlet balloons = BX.UI.Notification.Center.balloons;\n\n\t\t\tfor (let baloonId in balloons)\n\t\t\t{\n\t\t\t\tballoons[baloonId].container?.classList.add(BALLOON_OFFSET_CLASS_NAME);\n\t\t\t\tballoons[baloonId].offsetClassNameSetted = true;\n\t\t\t}\n\t\t}\n\t}\n\n\t_afterCloseParticipantsPermissionPopup()\n\t{\n\t\tlet balloons = BX.UI.Notification.Center.balloons;\n\n\t\tfor (let baloonId in balloons)\n\t\t{\n\t\t\tballoons[baloonId].container?.classList.remove(BALLOON_OFFSET_CLASS_NAME);\n\t\t\tballoons[baloonId].offsetClassNameSetted = false;\n\t\t}\n\t}\n\n\tcreateCallControlNotify(_p)\n\t{\n\t\tif (!this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet balloonClassName = 'ui-notification-balloon-content bx-call-control-notification ';\n\n\t\tif (_p.isAllow === false)\n\t\t{\n\t\t\tballoonClassName += 'bx-call-control-notification-disallow ';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tballoonClassName += 'bx-call-control-notification-allow ';\n\t\t}\n\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: _p.content,\n\t\t\tposition: \"top-right\",\n\t\t\tautoHideDelay: 8000,\n\t\t\tcategory: _p.category || '',\n\t\t\tcloseButton: true,\n\t\t\trender: function() {\n\n\t\t\t\tconst actions = this.getActions().map(action => action.getContainer());\n\n\t\t\t\treturn BX.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: balloonClassName,\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tBX.create(\"div\", {\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tclassName: \"ui-notification-balloon-message\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\thtml: this.getContent(),\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tBX.create(\"div\", {\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tclassName: \"ui-notification-balloon-actions\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tchildren: actions\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.isCloseButtonVisible() ?  this.getCloseButton(): null\n\t\t\t\t\t]\n\t\t\t\t});\n\t\t\t},\n\t\t});\n\n\t\tthis._afterOpenParticipantsPermissionPopup();\n\t}\n\n\t_onUserStatsReceived(e)\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setUserStats(e.userId, e.report);\n\t\t}\n\t}\n\n\t_onTrackSubscriptionFailed(e)\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setTrackSubscriptionFailed(e);\n\t\t}\n\t}\n\n\t_onCallUserScreenState(e)\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setUserScreenState(e.userId, e.screenState);\n\t\t}\n\t\tif (e.userId == CallEngine.getCurrentUserId())\n\t\t{\n\t\t\tthis.callView.setButtonActive(\"screen\", e.screenState);\n\n\t\t\tif (e.screenState)\n\t\t\t{\n\t\t\t\tif (!DesktopApi.isDesktop())\n\t\t\t\t{\n\t\t\t\t\tthis.showWebScreenSharePopup();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (this.floatingScreenShareWindow)\n\t\t\t\t{\n\t\t\t\t\tthis.floatingScreenShareWindow.close();\n\t\t\t\t}\n\t\t\t\tif (this.webScreenSharePopup)\n\t\t\t\t{\n\t\t\t\t\tthis.webScreenSharePopup.close();\n\t\t\t\t}\n\t\t\t\tif (this.isRecording())\n\t\t\t\t{\n\t\t\t\t\tBXDesktopSystem.CallRecordStopSharing();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.currentCall && this.currentCall.provider === 'Plain')\n\t\t\t{\n\t\t\t\tthis.togglePictureInPictureCallWindow();\n\t\t\t}\n\n\t\t\tthis.callView.updateButtons();\n\t\t}\n\t}\n\n\t_onCallUserRecordState(event)\n\t{\n\t\tthis.callRecordState = event.recordState.state;\n\t\tthis.callView.setRecordState(event.recordState);\n\t\tthis.callRecordInitiatorId = event.userId;\n\n\t\tif (event.recordState.state !== View.RecordState.Stopped)\n\t\t{\n\t\t\tthis.callRecordInfo = event.recordState;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callRecordInitiatorId = null;\n\t\t}\n\n\t\tif (!this.canRecord() || event.userId != BX.message['USER_ID'])\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (\n\t\t\tevent.recordState.state === View.RecordState.Started\n\t\t\t&& event.recordState.userId == BX.message['USER_ID']\n\t\t)\n\t\t{\n\t\t\tconst windowId = View.RecordSource.Chat;\n\t\t\tconst dialogId = this.currentCall.associatedEntity.id;\n\t\t\tconst dialogName = this.currentCall.associatedEntity.name;\n\t\t\tconst callId = this._getCallIdentifier(this.currentCall);\n\t\t\tconst callDate = BX?.date.format(this.formatRecordDate) || BX.Main.Date.format(this.formatRecordDate);\n\n\t\t\tlet fileName = BX.message('IM_CALL_RECORD_NAME');\n\t\t\tif (fileName)\n\t\t\t{\n\t\t\t\tfileName = fileName\n\t\t\t\t\t.replace('#CHAT_TITLE#', dialogName)\n\t\t\t\t\t.replace('#CALL_ID#', callId)\n\t\t\t\t\t.replace('#DATE#', callDate)\n\t\t\t\t;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfileName = \"call_record_\" + callId;\n\t\t\t}\n\n\t\t\tBX.ajax.runAction('call.Call.onStartRecord', { data: { callId: this.currentCall.id, callUuid: this.currentCall.uuid } });\n\n\t\t\tAnalytics.getInstance().onRecordStart({\n\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\tcallType: this.getCallType(),\n\t\t\t});\n\n\t\t\tBXDesktopSystem.CallRecordStart({\n\t\t\t\twindowId: windowId,\n\t\t\t\tfileName: fileName,\n\t\t\t\tcallId: callId,\n\t\t\t\tcallDate: callDate,\n\t\t\t\tdialogId: dialogId,\n\t\t\t\tdialogName: dialogName,\n\t\t\t\tvideo: this.callRecordType !== View.RecordType.Audio,\n\t\t\t\tmuted: Hardware.isMicrophoneMuted,\n\t\t\t\tcropTop: 72,\n\t\t\t\tcropBottom: 90,\n\t\t\t\tshareMethod: 'im.disk.record.share',\n\t\t\t\tcallType: this.getCallType(),\n\t\t\t});\n\t\t}\n\t\telse if (event.recordState.state === View.RecordState.Stopped)\n\t\t{\n\t\t\tAnalytics.getInstance().onRecordStop({\n\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\tcallType: this.getCallType(),\n\t\t\t\tsubSection: Analytics.AnalyticsSubSection.window,\n\t\t\t\telement: Analytics.AnalyticsElement.recordButton,\n\t\t\t\trecordTime: Util.getRecordTimeText(this.callRecordInfo, true),\n\t\t\t});\n\t\t\tthis.callRecordInfo = null;\n\t\t\tBXDesktopSystem.CallRecordStop();\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t_onCallUserFloorRequest(e)\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setUserFloorRequestState(e.userId, e.requestActive);\n\t\t}\n\t}\n\n\t_onCallFailure(e)\n\t{\n\t\tconst errorCode = e.code || e.name || e.error;\n\n\t\tlet errorMessage = '';\n\t\tlet isUnknownError = false;\n\n\t\tif (e.name === 'VoxConnectionError' || e.name === 'AuthResult')\n\t\t{\n\t\t\tUtil.reportConnectionResult(e.call.id, false);\n\t\t}\n\n\t\tswitch (errorCode)\n\t\t{\n\t\t\tcase StartCallErrorCode.ErrorUnexpectedAnswer:\n\t\t\t\terrorMessage = Loc.getMessage('IM_CALL_ERROR_UNEXPECTED_ANSWER');\n\t\t\t\tbreak;\n\n\t\t\tcase StartCallErrorCode.BlankAnswerWithErrorCode:\n\t\t\t\terrorMessage = Loc.getMessage('IM_CALL_ERROR_BLANK_ANSWER');\n\t\t\t\tbreak;\n\n\t\t\tcase StartCallErrorCode.BlankAnswer:\n\t\t\t\terrorMessage = Loc.getMessage('IM_CALL_ERROR_BLANK_ANSWER');\n\t\t\t\tbreak;\n\n\t\t\tcase StartCallErrorCode.AccessDenied:\n\t\t\t\terrorMessage = Loc.getMessage('IM_CALL_ERROR_ACCESS_DENIED');\n\t\t\t\tbreak;\n\n\t\t\tcase StartCallErrorCode.NoWebrtc:\n\t\t\t\terrorMessage = Loc.getMessage(this.isHttps ? 'IM_CALL_NO_WEBRT' : 'IM_CALL_ERROR_HTTPS_REQUIRED');\n\t\t\t\tbreak;\n\n\t\t\tcase StartCallErrorCode.UnknownError:\n\t\t\t\tisUnknownError = true;\n\t\t\t\terrorMessage = Loc.getMessage('IM_CALL_ERROR_UNKNOWN');\n\t\t\t\tbreak;\n\n\t\t\tcase StartCallErrorCode.NetworkError:\n\t\t\t\terrorMessage = Loc.getMessage('IM_CALL_ERROR_NETWORK');\n\t\t\t\tbreak;\n\n\t\t\tcase StartCallErrorCode.NotAllowedError:\n\t\t\t\terrorMessage = Loc.getMessage('IM_CALL_ERROR_HARDWARE_ACCESS_DENIED');\n\t\t\t\tbreak;\n\n\t\t\tcase StartCallErrorCode.NotReadableError:\n\t\t\t\terrorMessage = Loc.getMessage('IM_CALL_ERROR_HARDWARE');\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tif (errorCode === StartCallErrorCode.AuthorizeError || e.name === 'AuthResult')\n\t\t\t\t{\n\t\t\t\t\terrorMessage = Loc.getMessage('IM_CALL_ERROR_AUTHORIZATION');\n\t\t\t\t}\n\t\t\t\telse if (errorCode == 403 && e.name === 'Failed')\n\t\t\t\t{\n\t\t\t\t\terrorMessage = Loc.getMessage('IM_CALL_ERROR_HARDWARE_ACCESS_DENIED');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tisUnknownError = true;\n\t\t\t\t\terrorMessage = Loc.getMessage('IM_CALL_ERROR_UNKNOWN_WITH_CODE', { '#ERROR_CODE#': errorCode });\n\t\t\t\t}\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tif (isUnknownError)\n\t\t\t{\n\t\t\t\tthis.callView.showSelfTest();\n\t\t\t}\n\t\t\telse if (errorCode === DisconnectReason.SecurityKeyChanged)\n\t\t\t{\n\t\t\t\tthis.callView.showSecurityKeyError();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.callView.showFatalError({ text: errorMessage });\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.showNotification(errorMessage);\n\t\t}\n\n\t\tthis.messengerFacade.stopRepeatSound('dialtone');\n\t\tthis.autoCloseCallView = false;\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.removeVideoStrategy();\n\t\t\tthis.removeCallEvents();\n\n\t\t\tif (this.currentCallIsNew && this.isLegacyCall(this.currentCall.provider, this.currentCall.scheme))\n\t\t\t{\n\t\t\t\tBX.ajax.runAction('im.call.interrupt', { data: { callId: this.currentCall.id } });\n\t\t\t}\n\n\t\t\tthis.currentCall.destroy();\n\t\t\tthis.currentCall = null;\n\t\t\tthis.currentCallIsNew = false;\n\t\t}\n\n\t\tif (this.promotedToAdminTimeout)\n\t\t{\n\t\t\tclearTimeout(this.promotedToAdminTimeout);\n\t\t}\n\n\t\tHardware.isMicrophoneMuted = false;\n\t}\n\n\t_onNetworkProblem()\n\t{\n\t\tthis.showNetworkProblemNotification(BX.message(\"IM_M_CALL_TURN_UNAVAILABLE\"));\n\t}\n\n\t_onMicrophoneLevel(e)\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setMicrophoneLevel(e.level)\n\t\t}\n\t}\n\n\t_onReconnecting(e)\n\t{\n\t\t// todo: restore after fixing balloon resurrection issue\n\t\t// related to multiple simultaneous calls to the balloon manager\n\t\t// now it's enabled for calls as a temp solution\n\n\t\tAnalytics.getInstance().onReconnect({\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t\treconnectionReason: e.reconnectionReason,\n\t\t\treconnectionReasonInfo: e.reconnectionReasonInfo,\n\t\t\treconnectionEventCount: e.reconnectionEventCount,\n\t\t});\n\n\t\t// noinspection UnreachableCodeJS\n\t\tif (this.reconnectionBaloon)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.reconnectionBaloon = BX.UI.Notification.Center.notify({\n\t\t\tcontent: Text.encode(BX.message('IM_CALL_RECONNECTING')),\n\t\t\tautoHide: false,\n\t\t\tposition: \"top-right\",\n\t\t\tcloseButton: false,\n\t\t})\n\t}\n\n\t_onReconnected()\n\t{\n\t\tthis.setReconnectingCameraId(this.lastUsedCameraId)\n\t\t// todo: restore after fixing balloon resurrection issue\n\t\t// related to multiple simultaneous calls to the balloon manager\n\t\t// now it's enabled for calls as a temp solution\n\n\t\t// noinspection UnreachableCodeJS\n\t\tthis._closeReconnectionBaloon();\n\t}\n\n\t_onReconnectingFailed(e)\n\t{\n\t\tAnalytics.getInstance().onReconnectError({\n\t\t\tcallId:  this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t\terrorCode: e?.error?.code,\n\t\t\terrorMessage: e?.error?.message,\n\t\t});\n\t}\n\n\t_onCustomMessage(event)\n\t{\n\t\t// there will be no more template selector in this call\n\t\tif (event.message === DOC_CREATED_EVENT)\n\t\t{\n\t\t\tthis.docCreatedForCurrentCall = true;\n\t\t\tthis.maxEditorWidth = DOC_EDITOR_WIDTH;\n\t\t}\n\t}\n\n\t_onJoinRoomOffer(event)\n\t{\n\t\tconsole.log(\"_onJoinRoomOffer\", event)\n\t\tif (!event.initiator && !this.currentCall.currentRoom())\n\t\t{\n\t\t\tthis.currentCall.joinRoom(event.roomId);\n\t\t\tthis.showRoomJoinedPopup(true, event.speaker == this.userId, event.users);\n\t\t}\n\t}\n\n\t_onJoinRoom(event)\n\t{\n\t\tconsole.log(\"_onJoinRoom\", event)\n\t\tif (event.speaker == this.userId)\n\t\t{\n\t\t\tthis.callView.setRoomState(View.RoomState.Speaker);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tHardware.isMicrophoneMuted = true;\n\t\t\tthis.callView.muteSpeaker(true);\n\n\t\t\tthis.callView.setRoomState(View.RoomState.NonSpeaker);\n\t\t}\n\t}\n\n\t_onLeaveRoom()\n\t{\n\t\t// this.callView.setRoomState(View.RoomState.None);\n\t\tthis.callView.setRoomState(View.RoomState.Speaker);\n\t\tthis.callView.muteSpeaker(false);\n\t}\n\n\t_onTransferRoomSpeaker(event)\n\t{\n\t\tconsole.log(\"_onTransferRoomSpeaker\", event);\n\t\tif (event.speaker == this.userId)\n\t\t{\n\t\t\tHardware.isMicrophoneMuted = false;\n\t\t\tthis.callView.setRoomState(View.RoomState.Speaker);\n\n\t\t\tif (event.initiator == this.userId)\n\t\t\t{\n\t\t\t\tthis.callView.muteSpeaker(false);\n\t\t\t\tthis.showMicTakenFromPopup(event.previousSpeaker);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tHardware.isMicrophoneMuted = true;\n\t\t\tthis.callView.muteSpeaker(true);\n\t\t\tthis.callView.setRoomState(View.RoomState.NonSpeaker);\n\n\t\t\tthis.showMicTakenByPopup(event.speaker);\n\t\t}\n\t}\n\n\t_onCallJoin(e)\n\t{\n\t\tif (this.callView && !this.clickLinkInterceptor)\n\t\t{\n\t\t\tthis.clickLinkInterceptor = this.getClickLinkInterceptor();\n\t\t\tthis.clickLinkInterceptor.startIntercepting();\n\t\t}\n\n\t\tif (e.local)\n\t\t{\n\t\t\t// self answer\n\t\t\tif (this.currentCall && (this.currentCall instanceof VoximplantCall))\n\t\t\t{\n\t\t\t\tUtil.reportConnectionResult(this.currentCall.id, true);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\t\t// remote answer, stop ringing and hide incoming cal notification\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.removeVideoStrategy();\n\t\t\tthis.removeCallEvents();\n\t\t\tthis.currentCall = null;\n\t\t}\n\n\t\tif (this.promotedToAdminTimeout)\n\t\t{\n\t\t\tclearTimeout(this.promotedToAdminTimeout);\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.close();\n\t\t}\n\n\t\tif (this.callNotification)\n\t\t{\n\t\t\tthis.callNotification.close();\n\t\t}\n\n\t\tif (this.participantsPermissionPopup)\n\t\t{\n\t\t\tthis.participantsPermissionPopup.close();\n\t\t}\n\n\t\tif (this.invitePopup)\n\t\t{\n\t\t\tthis.invitePopup.close();\n\t\t}\n\n\t\tif (this.floatingWindow)\n\t\t{\n\t\t\tthis.floatingWindow.close();\n\t\t}\n\n\t\tif (this.mutePopup)\n\t\t{\n\t\t\tthis.mutePopup.close();\n\t\t}\n\n\t\tthis.messengerFacade.stopRepeatSound('dialtone');\n\t\tthis.messengerFacade.stopRepeatSound(this.audioRingtone);\n\t}\n\n\t_onCallLeave(e)\n\t{\n\t\tconsole.log(\"_onCallLeave\", e);\n\t\tif (!e.local && this.currentCall && this.currentCall.ready)\n\t\t{\n\t\t\tthis.log(new Error(\"received remote leave with active call!\"));\n\t\t\treturn;\n\t\t}\n\n\t\tHardware.isMicrophoneMuted = false;\n\n\t\tthis.#stopRecordCall();\n\n\t\tthis.docCreatedForCurrentCall = false;\n\t\tlet callDetails;\n\n\t\tif (!this.getActiveCallUsers().length && Boolean(this.callView) && !this.isCallHangupButtonPressed)\n\t\t{\n\t\t\tAnalytics.getInstance().onFinishCall({\n\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\tcallType: this.getCallType(),\n\t\t\t\tstatus: Analytics.AnalyticsStatus.lastUserLeft,\n\t\t\t\tchatId: this.currentCall.associatedEntity.id,\n\t\t\t\tcallUsersCount: this.getMaxActiveCallUsers().length,\n\t\t\t\tcallLength: Util.getTimeInSeconds(this.currentCall.startDate),\n\t\t\t});\n\n\t\t\tthis.isCallHangupButtonPressed = false;\n\t\t}\n\n\t\tif (this.currentCall && this.currentCall.associatedEntity)\n\t\t{\n\t\t\tthis.removeVideoStrategy();\n\t\t\tthis.removeCallEvents();\n\n\t\t\tcallDetails = this.#getCallDetail(this.currentCall);\n\t\t\tthis.currentCall = null;\n\t\t}\n\n\t\tif (this.promotedToAdminTimeout)\n\t\t{\n\t\t\tclearTimeout(this.promotedToAdminTimeout);\n\t\t}\n\n\t\tif (this.childCall)\n\t\t{\n\t\t\tthis.childCall.removeEventListener(CallEvent.onUserJoined, this._onChildCallFirstMediaHandler);\n\t\t\tthis.childCall.removeEventListener(CallEvent.onRemoteMediaReceived, this._onChildCallFirstUserJoinedHandler);\n\t\t\tthis.childCall.removeEventListener(CallEvent.onLocalMediaReceived, this._onCallLocalMediaReceivedHandler);\n\t\t\tthis.childCall.removeEventListener(CallEvent.onUserStateChanged, this._onCallUserStateChangedHandler);\n\t\t\tthis.childCall.hangup(false, '', true);\n\t\t\tthis.childCall = null;\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.close();\n\t\t}\n\n\t\tthis.hasStreamFromCall = false;\n\t\tthis._stopLocalStream();\n\n\t\tif (this.invitePopup)\n\t\t{\n\t\t\tthis.invitePopup.close();\n\t\t}\n\n\t\tif (this.floatingWindow)\n\t\t{\n\t\t\tthis.floatingWindow.close();\n\t\t}\n\n\t\tif (this.floatingScreenShareWindow)\n\t\t{\n\t\t\tthis.floatingScreenShareWindow.close();\n\t\t}\n\n\t\tif (this.webScreenSharePopup)\n\t\t{\n\t\t\tthis.webScreenSharePopup.close();\n\t\t}\n\n\t\tif (this.callNotification)\n\t\t{\n\t\t\tthis.callNotification.close();\n\t\t}\n\n\t\tif (this.participantsPermissionPopup)\n\t\t{\n\t\t\tthis.participantsPermissionPopup.close();\n\t\t}\n\n\t\tif (this.mutePopup)\n\t\t{\n\t\t\tthis.mutePopup.close();\n\t\t}\n\n\t\tthis.togglePictureInPictureCallWindow({ isForceClose: true });\n\n\t\tthis.allowMutePopup = true;\n\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.closeWindow(DesktopApi.findWindow('callBackground'));\n\t\t}\n\n\t\tthis.closePromo();\n\n\t\tthis._closeReconnectionBaloon();\n\t\tthis._closeParticipantsVideoBaloon();\n\n\t\tthis.messengerFacade.stopRepeatSound('dialtone');\n\t\tthis.messengerFacade.stopRepeatSound(this.audioRingtone);\n\n\t\tthis.hangupOptionsMenu?.destroy();\n\n\t\tif (this.clickLinkInterceptor)\n\t\t{\n\t\t\tthis.clickLinkInterceptor.stopIntercepting();\n\t\t\tthis.clickLinkInterceptor = null;\n\t\t}\n\n\t\tthis.emit(Events.onCallLeft, {\n\t\t\tcallDetails: callDetails\n\t\t});\n\t}\n\n\t_onGetUserMediaEnded()\n\t{\n\t\tHardware.getCurrentDeviceList();\n\t}\n\n\t_onUpdateLastUsedCameraId()\n\t{\n\t\tconst cameraId = this.currentCall.cameraId;\n\n\t\tif (cameraId)\n\t\t{\n\t\t\tthis.lastUsedCameraId = cameraId;\n\t\t}\n\t}\n\n\t#getCallDetail(call)\n\t{\n\t\treturn {\n\t\t\tid: this._getCallIdentifier(call),\n\t\t\tprovider: call.provider,\n\t\t\tchatId: call.associatedEntity.id,\n\t\t\tuserCount: call.users.length,\n\t\t\tbrowser: Util.getBrowserForStatistics(),\n\t\t\tisMobile: Browser.isMobile(),\n\t\t\tisConference: false,\n\t\t\twasConnected: call.wasConnected\n\t\t};\n\t}\n\n\t_onInvitePopupDestroy()\n\t{\n\t\tthis.invitePopup = null;\n\t\tthis.callView.setHotKeyTemporaryBlock(false);\n\t}\n\n\t_onInvitePopupSelect(e: {users: UserData})\n\t{\n\t\tthis.invitePopup.close();\n\n\t\tif (!this.currentCall || !e.users.length)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tAnalytics.getInstance().onInviteUser({\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t\tchatId: this.currentCall.associatedEntity.id,\n\t\t});\n\n\t\tconst currentUsers = this.currentCall.getUsers();\n\t\tconst usersToInvite = [];\n\t\tconst userData = {};\n\t\tlet totalUsers = Object.keys(currentUsers).length;\n\n\t\tconst newProvider = Util.getConferenceProvider();\n\t\tconst isLegacyCall = this.isLegacyCall(newProvider);\n\n\t\te.users.forEach((user) =>\n\t\t{\n\t\t\tconst userId = user.id;\n\t\t\tuserData[userId] = user;\n\n\t\t\tif (totalUsers < Util.getUserLimit() - 1 || currentUsers.hasOwnProperty(userId))\n\t\t\t{\n\t\t\t\ttotalUsers++;\n\t\t\t\tusersToInvite.push(userId);\n\t\t\t\tthis.callView.addUser(userId, UserState.Calling);\n\t\t\t}\n\t\t});\n\n\t\tUtil.setUserData(userData);\n\t\tthis.callView.updateUserData(userData);\n\n\t\tif (Util.isCallServerAllowed() && this.currentCall.provider === Provider.Plain)\n\t\t{\n\t\t\t// trying to switch to the server version of the call\n\t\t\tthis.removeVideoStrategy();\n\t\t\tthis.removeCallEvents();\n\t\t\tif (this.currentCall.isScreenSharingStarted())\n\t\t\t{\n\t\t\t\tthis.currentCall.stopScreenSharing();\n\t\t\t}\n\n\t\t\tconst onInviteSuccess = (call) => {\n\t\t\t\tthis.childCall = call;\n\t\t\t\tthis.childCall.addEventListener(CallEvent.onUserJoined, this._onChildCallFirstUserJoinedHandler);\n\t\t\t\tthis.childCall.addEventListener(CallEvent.onRemoteMediaReceived, this._onChildCallFirstMediaHandler);\n\t\t\t\tthis.childCall.addEventListener(CallEvent.onLocalMediaReceived, this._onCallLocalMediaReceivedHandler);\n\t\t\t\tthis.childCall.addEventListener(CallEvent.onUserStateChanged, this._onCallUserStateChangedHandler);\n\n\t\t\t\tthis.updateDeviceIdInChildCall();\n\n\t\t\t\tconst options = {\n\t\t\t\t\tusers: isLegacyCall ? this.childCall.users : usersToInvite,\n\t\t\t\t\tshow: isLegacyCall,\n\t\t\t\t};\n\n\t\t\t\tthis.childCall.inviteUsers(options);\n\n\t\t\t\tthis.callView.updateCopilotFeatureState(this.childCall?.isCopilotFeaturesEnabled);\n\t\t\t};\n\n\t\t\tconst onInviteFailure = (error) => {\n\t\t\t\tthis.log('Can\\'t invite users', error);\n\t\t\t\tthis.bindCallEvents();\n\n\t\t\t\tusersToInvite.forEach((userId) => {\n\t\t\t\t\tthis.callView.setUserState(userId, UserState.Idle);\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tconst createChildCallPromise = isLegacyCall\n\t\t\t\t? CallEngineLegacy.createChildCall(\n\t\t\t\t\tthis.currentCall.id,\n\t\t\t\t\tnewProvider,\n\t\t\t\t\tusersToInvite,\n\t\t\t\t\t{ debug: this.debug },\n\t\t\t\t)\n\t\t\t\t: CallEngine.createChildCall(\n\t\t\t\t\tthis.currentCall,\n\t\t\t\t\tnewProvider,\n\t\t\t\t\tusersToInvite,\n\t\t\t\t\t{ debug: this.debug, videoEnabled: Hardware.isCameraOn },\n\t\t\t\t);\n\n\t\t\tcreateChildCallPromise\n\t\t\t\t.then((callData) => onInviteSuccess(callData.call))\n\t\t\t\t.catch((error) => onInviteFailure(error));\n\n\t\t\tthis.callView.removeScreenUsers();\n\t\t}\n\t\telse if (usersToInvite.length > 0)\n\t\t{\n\t\t\tthis.currentCall.inviteUsers({\n\t\t\t\tuserData,\n\t\t\t\tusers: usersToInvite,\n\t\t\t\tshow: true,\n\t\t\t});\n\t\t}\n\t}\n\n\t_onDocumentBodyClick(event)\n\t{\n\t\tconst { target } = event;\n\n\t\tif (target.matches('input[type=\"file\"]'))\n\t\t{\n\t\t\tthis.onInputFileOpenedStateUpdate(true);\n\t\t}\n\t}\n\n\t_onWindowFocus()\n\t{\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tthis._onWindowDesktopFocus();\n\t\t}\n\n\t\tif (DesktopApi.isDesktop() && this.isFileChooserActive)\n\t\t{\n\t\t\tthis.onInputFileOpenedStateUpdate(false);\n\t\t}\n\n\t\tthis.updateWindowFocusState(true);\n\t}\n\n\n\t_onWindowBlur()\n\t{\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tthis._onWindowDesktopBlur();\n\t\t}\n\n\t\tthis.updateWindowFocusState(false);\n\t}\n\n\t_onWindowDesktopFocus()\n\t{\n\t\tif (!this.detached)\n\t\t{\n\t\t\tclearTimeout(this.showFloatingWindowTimeout);\n\t\t\tclearTimeout(this.showFloatingScreenShareWindowTimeout);\n\t\t\tif (this.floatingWindow)\n\t\t\t{\n\t\t\t\tthis.floatingWindow.hide();\n\t\t\t}\n\t\t\tif (this.floatingScreenShareWindow)\n\t\t\t{\n\t\t\t\tthis.floatingScreenShareWindow.hide();\n\t\t\t}\n\t\t}\n\t}\n\n\t_onWindowDesktopBlur()\n\t{\n\t\tclearTimeout(this.showFloatingWindowTimeout);\n\t\tclearTimeout(this.showFloatingScreenShareWindowTimeout);\n\t\tif (this.currentCall && this.floatingWindow && this.callView)\n\t\t{\n\t\t\tthis.showFloatingWindowTimeout = setTimeout(() =>\n\t\t\t{\n\t\t\t\tif (this.currentCall && this.floatingWindow && this.callView)\n\t\t\t\t{\n\t\t\t\t\tthis.floatingWindow.setTitle(this.currentCall.associatedEntity.name);\n\t\t\t\t\tUtil.getUserAvatars(this.currentCall.id, this.getActiveCallUsers()).then((result) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.floatingWindow.setAvatars(result);\n\t\t\t\t\t\tthis.floatingWindow.show();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}, 300);\n\t\t}\n\n\t\tif (this.currentCall && this.floatingScreenShareWindow && this.callView && this.currentCall.isScreenSharingStarted())\n\t\t{\n\t\t\tthis.showFloatingScreenShareWindowTimeout = setTimeout(() =>\n\t\t\t{\n\t\t\t\tif (this.currentCall && this.floatingScreenShareWindow && this.callView && this.currentCall.isScreenSharingStarted())\n\t\t\t\t{\n\t\t\t\t\tthis.floatingScreenShareWindow.show();\n\t\t\t\t}\n\t\t\t}, 300);\n\t\t}\n\t}\n\n\t_onBeforeUnload(e)\n\t{\n\t\tif (this.floatingWindow)\n\t\t{\n\t\t\tthis.floatingWindow.close();\n\t\t}\n\t\tif (this.callNotification)\n\t\t{\n\t\t\tthis.callNotification.close();\n\t\t}\n\t\tif (this.floatingScreenShareWindow)\n\t\t{\n\t\t\tthis.floatingScreenShareWindow.close();\n\t\t}\n\t\tif (this.participantsPermissionPopup)\n\t\t{\n\t\t\tthis.participantsPermissionPopup.close();\n\t\t}\n\t\tif (this.hasActiveCall())\n\t\t{\n\t\t\te.preventDefault();\n\t\t\te.returnValue = '';\n\t\t}\n\t}\n\n\t_onImTabChange(currentTab)\n\t{\n\t\tif (currentTab === \"notify\" && this.currentCall && this.callView)\n\t\t{\n\t\t\tthis.fold(Text.decode(this.currentCall.associatedEntity.name));\n\t\t}\n\t}\n\n\t_onUpdateChatCounter(counter)\n\t{\n\t\tif (!this.currentCall || !this.currentCall.associatedEntity || !this.currentCall.associatedEntity.id || !this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callView.setButtonCounter(\"chat\", counter);\n\t}\n\n\t_onDeviceChange(e)\n\t{\n\t\tif (!this.currentCall || !this.currentCall.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst allAddedDevice = e.data.added;\n\t\tconst allRemovedDevice = e.data.removed\n\t\tconst removed = Hardware.getRemovedUsedDevices(\n\t\t\te.data.removed,\n\t\t\t{\n\t\t\t\tmicrophoneId: this.currentCall.microphoneId,\n\t\t\t\tcameraId: this.currentCall.cameraId,\n\t\t\t\tspeakerId: this.callView.speakerId,\n\t\t\t}\n\t\t);\n\n\t\tthis.log(\"New devices: \", allAddedDevice);\n\t\tif (allAddedDevice)\n\t\t{\n\t\t\tsetTimeout(() => this.useDevicesInCurrentCall(allAddedDevice), 500);\n\t\t}\n\n\t\tthis.log(\"Removed devices: \", allRemovedDevice);\n\t\tif (removed.length > 0)\n\t\t{\n\t\t\tthis.log(\"Removed devices: \", removed);\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tcontent: BX.message(\"IM_CALL_DEVICES_DETACHED\") + \"<br><ul>\" + removed.map(function (deviceInfo)\n\t\t\t\t{\n\t\t\t\t\treturn \"<li>\" + deviceInfo.label\n\t\t\t\t}) + \"</ul>\",\n\t\t\t\tposition: \"top-right\",\n\t\t\t\tautoHideDelay: 10000,\n\t\t\t\tcloseButton: true,\n\t\t\t\t//category: \"call-device-change\",\n\t\t\t\tactions: [{\n\t\t\t\t\ttitle: BX.message(\"IM_CALL_DEVICES_CLOSE\"),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: function (event, balloon)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tballoon.close();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}]\n\t\t\t});\n\t\t}\n\n\t\tif (allRemovedDevice)\n\t\t{\n\t\t\tsetTimeout(() => this.removeDevicesFromCurrentCall(allRemovedDevice), 500);\n\t\t}\n\t}\n\n\t_onFloatingVideoMainAreaClick()\n\t{\n\t\tDesktopApi.activateWindow();\n\t\tDesktopApi.changeTab(\"im\");\n\n\t\tif (!this.currentCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.currentCall.associatedEntity && this.currentCall.associatedEntity.id)\n\t\t{\n\t\t\tthis.messengerFacade.openMessenger(this.currentCall.associatedEntity.id);\n\t\t}\n\t\telse if (!this.messengerFacade.isMessengerOpen())\n\t\t{\n\t\t\tthis.messengerFacade.openMessenger();\n\t\t}\n\n\t\tif (this.detached)\n\t\t{\n\t\t\tthis.container.style.removeProperty('width');\n\t\t\tthis.callView.show();\n\t\t\tthis.detached = false;\n\t\t}\n\t}\n\n\t_onFloatingVideoButtonClick(e)\n\t{\n\t\tswitch (e.buttonName)\n\t\t{\n\t\t\tcase \"toggleMute\":\n\t\t\t\tthis._onCallViewToggleMuteButtonClick(e);\n\t\t\t\tbreak;\n\t\t\tcase \"hangup\":\n\t\t\t\tthis._onCallViewHangupButtonClick();\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t_onFloatingScreenShareBackToCallClick()\n\t{\n\t\tDesktopApi.activateWindow();\n\t\tDesktopApi.changeTab(\"im\");\n\t\tif (this.floatingScreenShareWindow)\n\t\t{\n\t\t\tthis.floatingScreenShareWindow.hide();\n\t\t}\n\t}\n\n\t_onFloatingScreenShareStopClick()\n\t{\n\t\tDesktopApi.activateWindow();\n\t\tDesktopApi.changeTab(\"im\");\n\n\t\tthis.currentCall.stopScreenSharing();\n\n\t\tif (this.floatingScreenShareWindow)\n\t\t{\n\t\t\tthis.floatingScreenShareWindow.close();\n\t\t}\n\n\t\tif (this.isRecording())\n\t\t{\n\t\t\tBXDesktopSystem.CallRecordStopSharing();\n\t\t}\n\t}\n\n\t_onFloatingScreenShareChangeScreenClick()\n\t{\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.currentCall.startScreenSharing(true);\n\t\t}\n\t}\n\n\t_onResize()\n\t{\n\t\tif (this.sidebar && this.callView)\n\t\t{\n\t\t\tconst result = this.findCallEditorWidth();\n\t\t\tconst callWidth = result.callWidth;\n\t\t\tconst editorWidth = result.editorWidth;\n\n\t\t\tthis.callView.setMaxWidth(callWidth);\n\t\t\tthis.sidebar.setWidth(editorWidth);\n\t\t}\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.floatingWindow)\n\t\t{\n\t\t\tthis.floatingWindow.destroy();\n\t\t\tthis.floatingWindow = null;\n\t\t}\n\t\tif (this.floatingScreenShareWindow)\n\t\t{\n\t\t\tthis.floatingScreenShareWindow.destroy();\n\t\t\tthis.floatingScreenShareWindow = null;\n\t\t}\n\t\tif (this.resizeObserver)\n\t\t{\n\t\t\tthis.resizeObserver.disconnect();\n\t\t\tthis.resizeObserver = null;\n\t\t}\n\n\t\tthis.callMultiBroadcastClient && this.callMultiBroadcastClient.destroy()\n\n\t\tHardware.unsubscribe(Hardware.Events.onChangeMirroringVideo, this._onCallLocalCameraFlipHandler);\n\t}\n\n\tlog()\n\t{\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tlet arr = [this._getCallIdentifier(this.currentCall)];\n\n\t\t\tCallEngine.log.apply(CallEngine, arr.concat(Array.prototype.slice.call(arguments)));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tCallEngine.log.apply(CallEngine, arguments);\n\t\t}\n\t}\n\n\ttest(users = [473, 464], videoOptions = {width: 320, height: 180}, audioOptions = false)\n\t{\n\t\tthis.messengerFacade.openMessenger().then(() =>\n\t\t{\n\t\t\treturn (videoOptions || audioOptions) ? Hardware.init() : null;\n\t\t}).then(() =>\n\t\t{\n\t\t\tthis.createContainer();\n\t\t\tlet hiddenButtons = ['floorRequest'];\n\t\t\tif (!Util.shouldShowDocumentButton())\n\t\t\t{\n\t\t\t\thiddenButtons.push('document');\n\t\t\t}\n\n\t\t\tthis.callView = new View({\n\t\t\t\tcontainer: this.container,\n\t\t\t\tbaseZIndex: this.messengerFacade.getDefaultZIndex(),\n\t\t\t\tshowChatButtons: true,\n\t\t\t\tshowUsersButton: true,\n\t\t\t\tuserLimit: 48,\n\t\t\t\tlanguage: this.language,\n\t\t\t\tlayout: View.Layout.Grid,\n\t\t\t\thiddenButtons: hiddenButtons,\n\t\t\t\tblockedButtons: this.getBlockedButtons(),\n\t\t\t\tisWindowFocus: this.isWindowFocus,\n\t\t\t});\n\n\t\t\tthis.lastUserId = 1;\n\n\t\t\tthis.callView.setCallback('onButtonClick', (e) => this._onTestCallViewButtonClick(e));\n\t\t\t//this.callView.blockAddUser();\n\t\t\tthis.callView.setCallback(View.Event.onUserClick, (e) =>\n\t\t\t{\n\t\t\t\tif (!e.stream)\n\t\t\t\t{\n\t\t\t\t\tthis.callView.setUserState(e.userId, UserState.Connected);\n\t\t\t\t\tthis.callView.setUserMedia(e.userId, 'video', this.stream2.getVideoTracks()[0]);\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.callView.setUiState(View.UiState.Connected);\n\t\t\tthis.callView.setCallback(View.Event.onBodyClick, this._onCallViewBodyClick.bind(this));\n\t\t\tthis.callView.setCallback('onShow', this._onCallViewShow.bind(this));\n\t\t\tthis.callView.setCallback('onClose', this._onCallViewClose.bind(this));\n\t\t\tthis.callView.setCallback('onReplaceMicrophone', function (e)\n\t\t\t{\n\t\t\t\tconsole.log(\"onReplaceMicrophone\", e);\n\t\t\t});\n\t\t\tthis.callView.setCallback('onReplaceCamera', function (e)\n\t\t\t{\n\t\t\t\tconsole.log(\"onReplaceCamera\", e);\n\t\t\t});\n\t\t\tthis.callView.setCallback('onReplaceSpeaker', function (e)\n\t\t\t{\n\t\t\t\tconsole.log(\"onReplaceSpeaker\", e);\n\t\t\t});\n\t\t\tthis.callView.setCallback(View.Event.onOpenAdvancedSettings,  (e) =>\n\t\t\t{\n\t\t\t\tconsole.log(\"onOpenAdvancedSettings\", e);\n\t\t\t\tthis._onCallViewOpenAdvancedSettings()\n\t\t\t});\n\t\t\tthis.callView.show();\n\n\t\t\tif (audioOptions || videoOptions)\n\t\t\t{\n\t\t\t\treturn Hardware.getUserMedia({\n\t\t\t\t\taudio: audioOptions,\n\t\t\t\t\tvideo: videoOptions,\n\t\t\t\t})\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn new MediaStream();\n\t\t\t}\n\n\t\t}).then((s) =>\n\t\t{\n\t\t\tthis.stream = s;\n\t\t\tconst streamData = {\n\t\t\t\tstream: this.stream,\n\t\t\t};\n\t\t\tthis.callView.setLocalStream(streamData);\n\t\t\tusers.forEach(userId => this.callView.addUser(userId, UserState.Connected));\n\n\t\t\tif (audioOptions !== false)\n\t\t\t{\n\t\t\t\tthis.vad = new SimpleVAD({\n\t\t\t\t\tmediaStream: this.stream\n\t\t\t\t});\n\t\t\t\tsetInterval(() => this.callView.setMicrophoneLevel(this.vad.currentVolume), 100)\n\t\t\t}\n\n\t\t\tif (videoOptions)\n\t\t\t{\n\t\t\t\treturn Hardware.getUserMedia({\n\t\t\t\t\taudio: false,\n\t\t\t\t\tvideo: {\n\t\t\t\t\t\twidth: 320,\n\t\t\t\t\t\theight: 180\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn new MediaStream();\n\t\t\t}\n\n\t\t}).then((s2) =>\n\t\t{\n\t\t\tthis.stream2 = s2;\n\t\t\t/*users.forEach(function(userId)\n\t\t\t\t {\n\t\t\t\t\tthis.callView.setUserMedia(userId, 'video', stream2.getVideoTracks()[0]);\n\t\t\t\t},this);*/\n\n\t\t\tthis.callView.setUserMedia(users[0], 'video', this.stream2.getVideoTracks()[0]);\n\n\t\t\tBX.rest.callMethod('im.user.list.get', {\n\t\t\t\t'ID': users.concat(this.userId),\n\t\t\t\t'AVATAR_HR': 'Y'\n\t\t\t}).then((response) => this.callView.updateUserData(response.data()));\n\n\t\t});\n\t}\n\n\t_onTestCallViewButtonClick(e)\n\t{\n\t\tconsole.log(e.buttonName);\n\t\tswitch (e.buttonName)\n\t\t{\n\t\t\tcase \"hangup\":\n\t\t\tcase \"close\":\n\t\t\t\tthis.callView.close();\n\t\t\t\tbreak;\n\t\t\tcase \"inviteUser\":\n\t\t\t\t/*this.lastUserId++;\n\t\t\t\tBX.rest.callMethod('im.user.list.get', {\n\t\t\t\t\t'ID': [this.lastUserId],\n\t\t\t\t\t'AVATAR_HR': 'Y'\n\t\t\t\t}).then((response) => this.callView.updateUserData(response.data()))\n\n\t\t\t\tthis.callView.addUser(this.lastUserId, UserState.Connecting);*/\n\n\t\t\t\tthis._onCallViewInviteUserButtonClick(e)\n\t\t\t\t//this.callView.setStream(lastUserId, stream2);\n\t\t\t\tbreak;\n\t\t\tcase \"fullscreen\":\n\t\t\t\tthis.toggleFullScreen();\n\n\t\t\t\tbreak;\n\t\t\tcase \"record\":\n\t\t\t\tthis._onCallViewRecordButtonClick(e);\n\n\t\t\t\tbreak;\n\t\t\tcase \"floorRequest\":\n\t\t\t\tthis._onCallViewFloorRequestButtonClick(e);\n\t\t\t\tbreak;\n\n\t\t\tcase \"showChat\":\n\t\t\t\tthis.fold(\"asd \\\"asd\\\"\");\n\n\t\t\t\tbreak;\n\n\t\t\tcase \"toggleScreenSharing\":\n\t\t\t\tthis.callView.setUserMedia(464, 'screen', this.stream2.getVideoTracks()[0]);\n\n\t\t\t\t/*setTimeout(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.callView.setUserScreenState(464, true);\n\t\t\t\t\t}.bind(this), 0);*/\n\t\t\t\tbreak;\n\n\t\t\tcase \"returnToCall\":\n\t\t\t\tbreak;\n\n\t\t\tcase \"document\":\n\t\t\t\tthis._onCallViewDocumentButtonClick();\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\ttestIncoming(hasCamera)\n\t{\n\t\tthis.callNotification = new IncomingNotification({\n\t\t\tcallerName: \"this.currentCall.associatedEntity.name\",\n\t\t\tcallerAvatar: \"this.currentCall.associatedEntity.avatar\",\n\t\t\tcallerType: \"this.currentCall.associatedEntity.advanced.chatType\",\n\t\t\tcallerColor: \"\",\n\t\t\tvideo: true,\n\t\t\thasCamera: !!hasCamera,\n\t\t\tzIndex: this.messengerFacade.getDefaultZIndex() + 200,\n\t\t\tonClose: this._onCallNotificationClose.bind(this),\n\t\t\tonDestroy: this._onCallNotificationDestroy.bind(this),\n\t\t\tonButtonClick: (e) =>\n\t\t\t{\n\t\t\t\tconsole.log('button pressed', e.data);\n\t\t\t\tthis.callNotification.close()\n\t\t\t}\n\t\t});\n\n\t\tthis.callNotification.show();\n\t}\n\n\tgetMaxActiveMicrophonesCount()\n\t{\n\t\treturn 4;\n\t}\n\n\tshowRiseYouHandToTalkNotification(params)\n\t{\n\t\tif (!this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.riseYouHandToTalkPopup)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.mutePopup)\n\t\t{\n\t\t\tthis.mutePopup.close();\n\t\t\tthis.mutePopup = null;\n\t\t}\n\n\t\tthis.riseYouHandToTalkPopup = new CallHint({\n\t\t\tcallFolded: this.folded,\n\t\t\tbindElement: this.folded ? null : this.callView.buttons.microphone.elements.icon,\n\t\t\ttargetContainer: this.folded ? this.getExternalContainer() : this.callView.container,\n\t\t\ticon: 'raise-hand',\n\t\t\tshowAngle: true,\n\t\t\tinitiatorName: params.initiatorName,\n\t\t\tcustomClassName: 'bx-call-view-popup-call-hint-rise-hand-to-talk',\n\t\t\tautoCloseDelay: (30 * 60 * 1000), // show it 30 minutes\n\t\t\tcustomRender: function(){\n\t\t\t\tlet handRaiseContentElement = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-popup-call-hint-rise-block\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tLoc.getMessage('CALL_ADMIN_PROHIBITED_TURN_ON_PARTICIPANTS_MICROPHONES_HINT', {\n\t\t\t\t\t\t\t'#INITIATOR_NAME#': this.initiatorName,\n\t\t\t\t\t\t\t'[hint-label]': `<div class=\"bx-call-view-popup-call-hint-text\">`,\n\t\t\t\t\t\t\t'[/hint-label]': '</div>',\n\t\t\t\t\t\t\t'#RISE_HAND_ICON#': `<div class=\"bx-call-view-popup-call-hint-hand-raise-icon\"></div>`,\n\t\t\t\t\t\t\t'[label-or]': `<div class=\"bx-call-view-popup-call-hint-hand-raise-or-label\">`,\n\t\t\t\t\t\t\t'[/label-or]': '</div>',\n\t\t\t\t\t\t\t'#REQUEST_NOW_BUTTON#': `<div class = \"bx-call-view-popup-call-hint-button-placeholder\"></div>`,\n\t\t\t\t\t\t}),\n\t\t\t\t\t],\n\t\t\t\t});\n\n\t\t\t\tlet buttonPlaceholder = handRaiseContentElement.getElementsByClassName('bx-call-view-popup-call-hint-button-placeholder')[0];\n\n\t\t\t\tbuttonPlaceholder.replaceWith(this.createAskSpeakButton().render());\n\n\t\t\t\treturn handRaiseContentElement;\n\t\t\t},\n\t\t\tbuttons: [],\n\t\t\tonClose: () =>\n\t\t\t{\n\t\t\t\tthis.riseYouHandToTalkPopup.close();\n\t\t\t\tthis.riseYouHandToTalkPopup = null;\n\t\t\t},\n\t\t\tonAskSpeakButtonClicked: () =>\n\t\t\t{\n\t\t\t\tthis._onCallViewFloorRequestButtonClick();\n\n\t\t\t\tif (this.riseYouHandToTalkPopup)\n\t\t\t\t{\n\t\t\t\t\tthis.riseYouHandToTalkPopup.close();\n\t\t\t\t\tthis.riseYouHandToTalkPopup = null;\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t\tthis.riseYouHandToTalkPopup.show();\n\t}\n\n\tshowMicMutedNotification()\n\t{\n\t\tif (this.mutePopup || !this.callView || this.riseYouHandToTalkPopup || !Util.havePermissionToBroadcast('mic'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.mutePopup = new CallHint({\n\t\t\tcallFolded: this.folded,\n\t\t\tbindElement: this.folded ? null : this.callView.buttons.microphone.elements.icon,\n\t\t\ttargetContainer: this.folded ? this.getExternalContainer() : this.callView.container,\n\t\t\ticon: 'mic-off',\n\t\t\tbuttons: [\n\t\t\t\tthis.createUnmuteButton()\n\t\t\t],\n\t\t\tonClose: () =>\n\t\t\t{\n\t\t\t\tthis.allowMutePopup = false;\n\t\t\t\tthis.mutePopup.destroy();\n\t\t\t\tthis.mutePopup = null;\n\t\t\t},\n\t\t});\n\t\tthis.mutePopup.show();\n\t}\n\n\tshowAutoMicMuteNotification()\n\t{\n\t\tif (this.mutePopup || !this.callView || this.riseYouHandToTalkPopup || !Util.havePermissionToBroadcast('mic'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.mutePopup = new CallHint({\n\t\t\tcallFolded: this.folded,\n\t\t\tbindElement: this.folded ? null : this.callView.buttons.microphone.elements.icon,\n\t\t\ttargetContainer: this.folded ? this.getExternalContainer() : this.callView.container,\n\t\t\ttitle: Text.encode(BX.message(\"IM_CALL_MIC_AUTO_MUTED\")),\n\t\t\ticon: 'mic-off',\n\t\t\tbuttons: [\n\t\t\t\tthis.createUnmuteButton()\n\t\t\t],\n\t\t\tonClose: () =>\n\t\t\t{\n\t\t\t\tthis.mutePopup.destroy();\n\t\t\t\tthis.mutePopup = null;\n\t\t\t},\n\t\t});\n\t\tthis.mutePopup.show();\n\t}\n\n\tcreateUnmuteButton()\n\t{\n\t\treturn new BX.UI.Button({\n\t\t\tbaseClass: \"ui-btn ui-btn-icon-mic\",\n\t\t\ttext: BX.message(\"IM_CALL_UNMUTE_MIC\"),\n\t\t\tsize: BX.UI.Button.Size.EXTRA_SMALL,\n\t\t\tcolor: BX.UI.Button.Color.LIGHT_BORDER,\n\t\t\tnoCaps: true,\n\t\t\tround: true,\n\t\t\tevents: {\n\t\t\t\tclick: () =>\n\t\t\t\t{\n\t\t\t\t\tthis._onCallViewToggleMuteButtonClick({\n\t\t\t\t\t\tmuted: false\n\t\t\t\t\t});\n\t\t\t\t\tif (this.mutePopup)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.mutePopup.destroy();\n\t\t\t\t\t\tthis.mutePopup = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\n\t_onCallToggleSubscribe(e) {\n\t\tif (this.currentCall && this.currentCall.provider === Provider.Bitrix)\n\t\t{\n\t\t\tthis.currentCall.toggleRemoteParticipantVideo(e.participantIds, e.showVideo, true)\n\t\t}\n\t}\n\n\t_onCallUserClick(e)\n\t{\n\t\tAnalytics.getInstance().onClickUser({\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t\tlayout: Object.keys(View.Layout).find(key => View.Layout[key] === e.layout),\n\t\t});\n\t}\n\n\ttoggleRoomMenu(bindElement)\n\t{\n\t\tif (this.roomMenu)\n\t\t{\n\t\t\tthis.roomMenu.destroy();\n\t\t\treturn;\n\t\t}\n\n\t\tconst roomSpeaker = this.currentCall.currentRoom().speaker;\n\t\tconst speakerModel = this.callView.userRegistry.get(roomSpeaker);\n\t\tlet avatarText = ''\n\n\t\tif (!speakerModel)\n\t\t{\n\t\t\tavatarText = Utils.text.getFirstLetters(speakerModel.name).toUpperCase();\n\t\t}\n\n\t\tthis.roomMenu = new Menu({\n\t\t\ttargetContainer: this.container,\n\t\t\tbindElement: bindElement,\n\t\t\titems: [\n\t\t\t\t{text: BX.message(\"IM_CALL_SOUND_PLAYS_VIA\"), disabled: true},\n\t\t\t\t{html: `<div class=\"bx-messenger-videocall-room-menu-avatar\" style=\"--avatar: url('${Text.encode(speakerModel.avatar)}')\">${avatarText}</div>${Text.encode(speakerModel.name)}`},\n\t\t\t\t{delimiter: true},\n\t\t\t\t{\n\t\t\t\t\ttext: BX.message(\"IM_CALL_LEAVE_ROOM\"),\n\t\t\t\t\tonclick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.currentCall.leaveCurrentRoom();\n\t\t\t\t\t\tthis.roomMenu.close();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{delimiter: true},\n\t\t\t\t{\n\t\t\t\t\ttext: BX.message(\"IM_CALL_HELP\"),\n\t\t\t\t\tonclick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showRoomHelp();\n\t\t\t\t\t\tthis.roomMenu.close();\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tonDestroy: () => this.roomMenu = null\n\t\t\t}\n\t\t});\n\t\tthis.roomMenu.show();\n\t}\n\n\ttoggleRoomListMenu(bindElement)\n\t{\n\t\tif (this.roomListMenu)\n\t\t{\n\t\t\tthis.roomListMenu.destroy();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.currentCall.listRooms().then((roomList) =>\n\t\t{\n\t\t\tthis.roomListMenu = new BX.PopupMenuWindow({\n\t\t\t\ttargetContainer: this.container,\n\t\t\t\tbindElement: bindElement,\n\t\t\t\titems: this.prepareRoomListMenuItems(roomList),\n\t\t\t\tevents: {\n\t\t\t\t\tonDestroy: () => this.roomListMenu = null\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.roomListMenu.show();\n\t\t})\n\t}\n\n\tprepareRoomListMenuItems(roomList)\n\t{\n\t\tlet menuItems = [\n\t\t\t{text: BX.message(\"IM_CALL_JOIN_ROOM\"), disabled: true},\n\t\t\t{delimiter: true},\n\t\t];\n\t\tmenuItems = menuItems.concat(...roomList.map(room =>\n\t\t{\n\t\t\treturn {\n\t\t\t\ttext: this.getRoomDescription(room),\n\t\t\t\tonclick: () =>\n\t\t\t\t{\n\t\t\t\t\tif (this.currentCall && this.currentCall.joinRoom)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.currentCall.joinRoom(room.id);\n\t\t\t\t\t}\n\t\t\t\t\tthis.roomListMenu.destroy();\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\n\t\tmenuItems.push({delimiter: true});\n\t\tmenuItems.push({\n\t\t\ttext: BX.message(\"IM_CALL_HELP\"),\n\t\t\tonclick: () =>\n\t\t\t{\n\t\t\t\tthis.showRoomHelp();\n\t\t\t\tthis.roomMenu.close();\n\t\t\t}\n\t\t})\n\n\t\treturn menuItems;\n\t}\n\n\tshowRoomHelp()\n\t{\n\t\tBX.loadExt('ui.dialogs.messagebox').then(() =>\n\t\t{\n\t\t\tBX.UI.Dialogs.MessageBox.alert(\n\t\t\t\tBX.message(\"IM_CALL_HELP_TEXT\"),\n\t\t\t\tBX.message(\"IM_CALL_HELP\")\n\t\t\t);\n\t\t})\n\t}\n\n\tgetRoomDescription(roomFields)\n\t{\n\t\tconst userNames = roomFields.userList.map(userId =>\n\t\t{\n\t\t\tconst userModel = this.callView.userRegistry.get(userId);\n\t\t\treturn userModel.name;\n\t\t})\n\n\t\tlet result = BX.message(\"IM_CALL_ROOM_DESCRIPTION\");\n\t\tresult = result.replace(\"#ROOM_ID#\", roomFields.id)\n\t\tresult = result.replace(\"#PARTICIPANTS_LIST#\", userNames.join(\", \"))\n\t\treturn result;\n\t}\n\n\tshowRoomJoinedPopup(isAuto, isSpeaker, userIdList)\n\t{\n\t\tif (this.roomJoinedPopup || !this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet title;\n\t\tif (!isAuto)\n\t\t{\n\t\t\ttitle = BX.message(\"IM_CALL_ROOM_JOINED_MANUALLY\") + \"<p>\" + BX.message(\"IM_CALL_ROOM_JOINED_P2\") + \"</p>\";\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst userNames = userIdList.filter(userId => userId != this.userId).map(userId =>\n\t\t\t{\n\t\t\t\tconst userModel = this.callView.userRegistry.get(userId);\n\t\t\t\treturn userModel.name;\n\t\t\t})\n\n\t\t\tconst usersInRoom = userNames.join(\", \");\n\t\t\tif (isSpeaker)\n\t\t\t{\n\t\t\t\ttitle = BX.Text.encode(BX.message(\"IM_CALL_ROOM_JOINED_AUTO_SPEAKER\").replace(\"#PARTICIPANTS_LIST#\", usersInRoom));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\ttitle = BX.Text.encode(BX.message(\"IM_CALL_ROOM_JOINED_AUTO\").replace(\"#PARTICIPANTS_LIST#\", usersInRoom));\n\t\t\t\ttitle += \"<p>\" + BX.Text.encode(BX.message(\"IM_CALL_ROOM_JOINED_P2\")) + \"</p>\";\n\t\t\t}\n\t\t}\n\n\t\tthis.roomJoinedPopup = new CallHint({\n\t\t\tcallFolded: this.folded,\n\t\t\tbindElement: this.folded ? null : this.callView.buttons.microphone.elements.icon,\n\t\t\ttargetContainer: this.folded ? this.getExternalContainer() : this.callView.container,\n\t\t\ttitle: title,\n\t\t\tbuttonsLayout: \"bottom\",\n\t\t\tautoCloseDelay: 0,\n\t\t\tbuttons: [\n\t\t\t\tnew Button({\n\t\t\t\t\tbaseClass: \"ui-btn\",\n\t\t\t\t\ttext: BX.message(\"IM_CALL_ROOM_JOINED_UNDERSTOOD\"),\n\t\t\t\t\tsize: Button.Size.EXTRA_SMALL,\n\t\t\t\t\tcolor: Button.Color.LIGHT_BORDER,\n\t\t\t\t\tnoCaps: true,\n\t\t\t\t\tround: true,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.roomJoinedPopup.destroy();\n\t\t\t\t\t\t\tthis.roomJoinedPopup = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tnew Button({\n\t\t\t\t\ttext: BX.message(\"IM_CALL_ROOM_WRONG_ROOM\"),\n\t\t\t\t\tsize: Button.Size.EXTRA_SMALL,\n\t\t\t\t\tcolor: Button.Color.LINK,\n\t\t\t\t\tnoCaps: true,\n\t\t\t\t\tround: true,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.roomJoinedPopup.destroy();\n\t\t\t\t\t\t\tthis.roomJoinedPopup = null;\n\t\t\t\t\t\t\tthis.currentCall.leaveCurrentRoom();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t],\n\t\t\tonClose: () =>\n\t\t\t{\n\t\t\t\tthis.roomJoinedPopup.destroy();\n\t\t\t\tthis.roomJoinedPopup = null;\n\t\t\t},\n\t\t});\n\t\tthis.roomJoinedPopup.show();\n\t}\n\n\tshowMicTakenFromPopup(fromUserId)\n\t{\n\t\tif (this.micTakenFromPopup || !this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst userModel = this.callView.userRegistry.get(fromUserId);\n\t\tconst title = BX.message(\"IM_CALL_ROOM_MIC_TAKEN_FROM\").replace('#USER_NAME#', userModel.name);\n\t\tthis.micTakenFromPopup = new CallHint({\n\t\t\tcallFolded: this.folded,\n\t\t\tbindElement: this.folded ? null : this.callView.buttons.microphone.elements.icon,\n\t\t\ttargetContainer: this.folded ? this.getExternalContainer() : this.callView.container,\n\t\t\ttitle: BX.Text.encode(title),\n\t\t\tbuttonsLayout: \"right\",\n\t\t\tautoCloseDelay: 5000,\n\t\t\tbuttons: [\n\t\t\t\t/*new Button({\n\t\t\t\t\t\ttext: BX.message(\"IM_CALL_ROOM_DETAILS\"),\n\t\t\t\t\t\tsize: Button.Size.SMALL,\n\t\t\t\t\t\tcolor: Button.Color.LINK,\n\t\t\t\t\t\tnoCaps: true,\n\t\t\t\t\t\tround: true,\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tclick: () => {this.micTakenFromPopup.destroy(); this.micTakenFromPopup = null;}\n\t\t\t\t\t\t}\n\t\t\t\t\t}),*/\n\t\t\t],\n\t\t\tonClose: () =>\n\t\t\t{\n\t\t\t\tthis.micTakenFromPopup.destroy();\n\t\t\t\tthis.micTakenFromPopup = null;\n\t\t\t},\n\t\t});\n\t\tthis.micTakenFromPopup.show();\n\t}\n\n\tshowMicTakenByPopup(byUserId)\n\t{\n\t\tif (this.micTakenByPopup || !this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst userModel = this.callView.userRegistry.get(byUserId);\n\n\t\tthis.micTakenByPopup = new CallHint({\n\t\t\tcallFolded: this.folded,\n\t\t\tbindElement: this.folded ? null : this.callView.buttons.microphone.elements.icon,\n\t\t\ttargetContainer: this.folded ? this.getExternalContainer() : this.callView.container,\n\t\t\ttitle: BX.Text.encode(BX.message(\"IM_CALL_ROOM_MIC_TAKEN_BY\").replace('#USER_NAME#', userModel.name)),\n\t\t\tbuttonsLayout: \"right\",\n\t\t\tautoCloseDelay: 5000,\n\t\t\tbuttons: [\n\t\t\t\t/*new Button({\n\t\t\t\t\t\ttext: BX.message(\"IM_CALL_ROOM_DETAILS\"),\n\t\t\t\t\t\tsize: Button.Size.SMALL,\n\t\t\t\t\t\tcolor: Button.Color.LINK,\n\t\t\t\t\t\tnoCaps: true,\n\t\t\t\t\t\tround: true,\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tclick: () => {this.micTakenByPopup.destroy(); this.micTakenByPopup = null;}\n\t\t\t\t\t\t}\n\t\t\t\t\t}),*/\n\t\t\t],\n\t\t\tonClose: () =>\n\t\t\t{\n\t\t\t\tthis.micTakenByPopup.destroy();\n\t\t\t\tthis.micTakenByPopup = null;\n\t\t\t},\n\t\t});\n\t\tthis.micTakenByPopup.show();\n\t}\n\n\tshowWebScreenSharePopup()\n\t{\n\t\tif (this.webScreenSharePopup)\n\t\t{\n\t\t\tthis.webScreenSharePopup.show();\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.webScreenSharePopup = new WebScreenSharePopup({\n\t\t\tbindElement: this.callView.buttons.screen.elements.root,\n\t\t\ttargetContainer: this.callView.container,\n\t\t\tonClose: () =>\n\t\t\t{\n\t\t\t\tthis.webScreenSharePopup.destroy();\n\t\t\t\tthis.webScreenSharePopup = null;\n\t\t\t},\n\t\t\tonStopSharingClick: () =>\n\t\t\t{\n\t\t\t\tthis._onCallViewToggleScreenSharingButtonClick();\n\t\t\t\tthis.webScreenSharePopup.destroy();\n\t\t\t\tthis.webScreenSharePopup = null;\n\t\t\t}\n\t\t});\n\t\tthis.webScreenSharePopup.show();\n\t}\n\n\tshowFeedbackPopup(callDetails)\n\t{\n\t\tif (!callDetails)\n\t\t{\n\t\t\tif (this.lastCallDetails)\n\t\t\t{\n\t\t\t\tcallDetails = this.lastCallDetails;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconsole.error('Could not show feedback without call ')\n\t\t\t}\n\t\t}\n\n\t\tBX.loadExt('ui.feedback.form').then(() =>\n\t\t{\n\t\t\tBX.UI.Feedback.Form.open({\n\t\t\t\tid: 'call_feedback_' + Math.random(),\n\t\t\t\tforms: [\n\t\t\t\t\t{zones: ['ru'], id: 406, sec: '9lhjhn', lang: 'ru'},\n\t\t\t\t],\n\t\t\t\tpresets: {\n\t\t\t\t\tcall_id: callDetails.id || 0,\n\t\t\t\t\tcall_amount: callDetails.userCount || 0,\n\t\t\t\t},\n\t\t\t});\n\t\t})\n\t}\n\n\tshowFeedbackPopup_(callDetails)\n\t{\n\t\tif (this.feedbackPopup)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!callDetails)\n\t\t{\n\t\t\tcallDetails = this.lastCallDetails;\n\t\t}\n\t\tconst darkMode = this.messengerFacade.isThemeDark();\n\t\tif (!Type.isPlainObject(callDetails))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tBX.loadExt('im.component.call-feedback').then(() =>\n\t\t{\n\t\t\tlet vueInstance;\n\t\t\tthis.feedbackPopup = new Popup({\n\t\t\t\tid: 'im-call-feedback',\n\t\t\t\tcontent: '',\n\t\t\t\ttitleBar: BX.message('IM_CALL_QUALITY_FEEDBACK'),\n\t\t\t\tcloseIcon: true,\n\t\t\t\tnoAllPaddings: true,\n\t\t\t\tcacheable: false,\n\t\t\t\tbackground: darkMode ? '#3A414B' : null,\n\t\t\t\tdarkMode: darkMode,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tautoHide: true,\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupDestroy: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tif (vueInstance)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvueInstance.$destroy();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.feedbackPopup = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst template = '<bx-im-component-call-feedback ' +\n\t\t\t\t'@feedbackSent=\"onFeedbackSent\" ' +\n\t\t\t\t':darkMode=\"darkMode\" ' +\n\t\t\t\t':callDetails=\"callDetails\" />';\n\n\t\t\tvueInstance = BX.Vue.createApp({\n\t\t\t\ttemplate: template,\n\t\t\t\tdata: function ()\n\t\t\t\t{\n\t\t\t\t\treturn {\n\t\t\t\t\t\tdarkMode: darkMode,\n\t\t\t\t\t\tcallDetails: callDetails\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tmethods: {\n\t\t\t\t\tonFeedbackSent: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tsetTimeout(\n\t\t\t\t\t\t\t() =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (this.feedbackPopup)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.feedbackPopup.close()\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t1500\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tvueInstance.mount('#' + this.feedbackPopup.getContentContainer().id);\n\n\t\t\tthis.feedbackPopup.show();\n\n\t\t})\n\t}\n\n\tgetClickLinkInterceptor()\n\t{\n\t\tconst handleClick = (event) => {\n\t\t\tconst link = event.target.closest('a');\n\n\t\t\tif (!link)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst href = link.getAttribute('href');\n\n\t\t\tif (!href)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (event.defaultPrevented)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\twindow.open(href, '_blank');\n\t\t\tevent.preventDefault();\n\t\t};\n\n\t\tconst startIntercepting = () => {\n\t\t\tdocument.addEventListener('click', handleClick, { capture: true });\n\t\t};\n\n\t\tconst stopIntercepting = () => {\n\t\t\tdocument.removeEventListener('click', handleClick, { capture: true });\n\t\t};\n\n\t\treturn {\n\t\t\tstartIntercepting,\n\t\t\tstopIntercepting,\n\t\t};\n\t}\n\n\tstatic FeatureState = FeatureState;\n\tstatic Events = Events;\n\tstatic ViewState = ViewState;\n\tstatic DocumentType = DocumentType;\n}","import {applyHacks} from './hacks';\nimport {BackgroundDialog} from './dialogs/background_dialog';\nimport {IncomingNotificationContent} from './dialogs/incoming_notification';\nimport {NotificationConferenceContent} from './dialogs/conference_notification';\nimport {FloatingScreenShare} from './floating_screenshare';\nimport {FloatingScreenShareContent} from './floating_screenshare';\nimport {CallHint} from './call_hint_popup'\nimport {CallController} from './controller';\nimport {\n\tCallEngine,\n\tCallEvent,\n\tEndpointDirection,\n\tUserState,\n\tProvider,\n\tCallType,\n\tCallState,\n\tStartCallErrorCode,\n\tDisconnectReason,\n\tCallScheme,\n} from './engine/engine';\nimport {CallEngineLegacy} from './engine/engine_legacy';\nimport {Hardware} from './call_hardware';\nimport Util from './util';\nimport { CallAI } from './call_ai';\nimport {VideoStrategy} from './video_strategy';\nimport { JoinResponseError } from './call_api';\nimport {View} from './view/view';\nimport { CopilotPopup } from './view/copilot-popup';\nimport { ParticipantsPermissionPopup } from './view/participants-permission-popup';\nimport {WebScreenSharePopup} from './web_screenshare_popup';\nimport { UserListPopup } from 'call.component.user-list-popup';\nimport { UserList } from 'call.component.user-list';\nimport { CallMultiChannel } from './call_multi_channel';\nimport 'loader';\nimport 'resize_observer';\nimport 'webrtc_adapter';\nimport 'im.lib.localstorage';\nimport 'ui.hint';\nimport 'voximplant';\n\napplyHacks();\n\nexport {\n\tJoinResponseError,\n\tBackgroundDialog,\n\tCallController as Controller,\n\tCallEngine as Engine,\n\tCallEvent as Event,\n\tCallHint as Hint,\n\tCallState as State,\n\tCallEngineLegacy as EngineLegacy,\n\tEndpointDirection,\n\tStartCallErrorCode,\n\tDisconnectReason,\n\tFloatingScreenShare,\n\tFloatingScreenShareContent,\n\tIncomingNotificationContent,\n\tNotificationConferenceContent,\n\tHardware,\n\tProvider,\n\tCallType as Type,\n\tUserState,\n\tUtil,\n\tVideoStrategy,\n\tView,\n\tWebScreenSharePopup,\n\tUserListPopup,\n\tCopilotPopup,\n\tUserList,\n\tCallAI,\n\tCallScheme,\n\tParticipantsPermissionPopup,\n\tCallMultiChannel,\n};\n\n// compatibility\nBX.CallEngine = CallEngine;"],"names":["applyHacks","window","navigator","mediaParams","audio","video","mandatory","chromeMediaSource","maxWidth","screen","width","maxHeight","height","optional","googTemporalLayeredScreencast","mediaDevices","getUserMedia","BackgroundDialog","MessengerUtils","platform","getDesktopVersion","isDesktopFeatureEnabled","options","Type","isPlainObject","tab","isStringFilled","isAvailable","BX","Helper","show","html","js","DesktopApi","createWindow","controller","title","isMaskAvailable","message","SetProperty","Width","Height","ExecuteCommand","prepareHtml","lsKey","defaultMicrophone","defaultCamera","defaultSpeaker","Events","initialized","deviceChanged","HardwareManager","setEventNamespace","_currentDeviceList","updating","Promise","resolve","initPromise","_checkPermissions","reject","enumerateDevices","then","deviceList","filterDeviceList","addEventListener","debounce","onNavigatorDeviceChanged","bind","emit","e","permissions","query","name","cameraPermission","microphonePermission","onchange","status","getCurrentDeviceList","constraints","error","Error","code","stream","err","devices","Object","keys","cameraList","length","microphoneList","values","filter","deviceInfo","kind","deviceId","HTMLMediaElement","prototype","removedDevices","addedDevices","shouldSkipDeviceChangedEvent","every","label","forEach","index","findIndex","dev","groupId","splice","push","added","removed","browserDeviceList","device","isDeviceInBlackList","deviceBlackList","result","item","toLowerCase","includes","updateDeviceList","deviceKind","i","resultDeviceList","currentDevices","microphoneId","speakerId","cameraId","_getDeviceMap","localStorage","getItem","getDefaultDeviceIdByGroupId","getDeviceGroupIdByDeviceId","setItem","audioOutputList","EventEmitter","enableMicAutoParameters","preferHd","enableMirroring","CallEvents","onChangeMirroringVideo","onChangeMicrophoneMuted","onChangeCameraOn","CallHardwareManager","_isCameraOn","_isMicrophoneMuted","assign","isCameraOn","isMicrophoneMuted","preferHdQuality","isDesktop","Hardware","ClientPlatform","ClientVersion","MediaStreamsKinds","Camera","Microphone","Screen","ScreenAudio","Track","id","track","source","Message","text","from","senderSid","timestamp","Math","floor","Date","now","STREAM_QUALITY","HIGH","MEDIUM","LOW","CALL_STATE","CONNECTED","PROGRESSING","TERMINATED","VIDEO_QUEUE","INITIAL","ENABLE","DISABLE","LOG_LEVEL","INFO","WARNING","ERROR","MONITORING_EVENTS_NAME_LIST","TRACK_SUBSCRIPTION_FAILED","TRACK_SUBSCRIPTION_DELAY","HIGH_PACKET_LOSS_SEND","HIGH_PACKET_LOSS_RECEIVE","CPU_ISSUES","NETWORK_ISSUES","PEER_CONNECTION_REFUSED","PEER_CONNECTION_ISSUES","USER_CAMERA_DISABLED","USER_RECONNECTED","LOCAL_VIDEO_STREAM_RECEIVING_FAILED","LOCAL_MICROPHONE_STREAM_RECEIVING_FAILED","LOCAL_SCREEN_STREAM_RECEIVING_FAILED","LOCAL_VIDEO_STREAM_PUBLICATION_FAILED","LOCAL_MICROPHONE_STREAM_PUBLICATION_FAILED","LOCAL_SCREEN_STREAM_PUBLICATION_FAILED","MONITORING_METRICS_NAME_LIST","COUNT_TRACKS","PACKET_LOST_RECEIVE","BITRATE_IN","BITRATE_OUT","CONN_SCORE_CURRENT","FRAMES_LOSS","FREEZE_COUNT","TOTAL_FREEZE_DURATION","JITTER","FRAMES_DECODED","FRAMES_DROPPED","FRAMES_RECEIVED","PACKET_LOST_SEND","RecorderStatus","UNAVAILABLE","NONE","ENABLED","DISABLED","PAUSED","DESTROYED","ReconnectionReason","NetworkError","PingPongMissed","PeerConnectionFailed","WsTransportClosed","LeaveCommand","JoinResponseError","JoinRequestFailedCodes","CanNotCreateRoom","InputError","AccessDenied","RoomNotFound","MalfunctioningSignaling","JsonParsingError","UnexpectedResponse","UnknownError","errorCode","fondedCodePair","entries","find","_","failedCode","Call","codec","canReconnect","logs","isloggingEnable","loggerCallback","abortController","AbortController","isWaitAnswer","reportsForIncomingTracks","reportsForOutgoingTracks","prevParticipantsWithLargeDataLoss","Set","tracksDataFromSocket","realTracksIds","mediaServerUrl","roomData","roomId","isLegacy","token","endpoint","jwt","iceServers","socketConnect","peerConnectionFailed","pendingOffer","pendingCandidates","recipient","sender","pendingPublications","pendingSubscriptions","publicationTimeout","subscriptionTimeout","subscriptionTries","cameraStream","microphoneStream","screenStream","mediaMutedBySystem","needToEnableAudioAfterSystemMuted","needToDisableAudioAfterPublish","localTracks","localConnectionQuality","minimalConnectionQuality","rtt","pingIntervalDuration","pingTimeoutDuration","ontrackData","remoteTracks","remoteParticipants","mainStream","pingPongTimeout","pingPongInterval","userId","localParticipantSid","defaultVideoResolution","defaultSimulcastBitrate","q","h","f","defaultRemoteStreamsQuality","audioBitrate","videoBitrate","screenBitrate","videoSimulcast","screenSimulcast","events","Map","offersStack","audioDeviceId","switchActiveAudioDeviceInProgress","switchActiveAudioDevicePending","videoDeviceId","switchActiveVideoDeviceInProgress","switchActiveVideoDevicePending","isReconnecting","reconnectionAttempt","reconnectionTimeout","lastReconnectionReason","fastReconnectionDelay","reconnectionDelay","callStatsInterval","callState","wasConnected","packetLostThreshold","statsTimeout","videoQueue","videoStreamSetupErrorList","sendLeaveBound","beforeDisconnectBound","monitoringEvents","monitoringDelayTime","monitoringIntervalTime","countMetricsInMetricsInterval","monitoringInterval","currentMonitoringEventsObject","startTimestampGrabMetrics","currentMonitoringErrorsObject","prevInboundRtpStatsSum","freezeCount","totalFreezesDuration","jitter","framesDecoded","framesDropped","framesReceived","Event","subscribe","event","setLog","data","initConnectionEvent","connection","reconnectionReason","reconnectionReasonInfo","mozConnection","webkitConnection","onChangeConnection","callback","Util","isNewQOSEnabled","bitrateArray","Array","isArray","reduce","acc","currentValue","bitrate","additionalData","metricValue","metricKey","metrics","isValidMetricValue","Number","isNaN","countVideoTracks","countAudioTracks","value","undefined","withCounter","currentEventIndex","evt","lastTimestamp","fillDefaultValueMonitoringMetrics","startTimestamp","participant","getTrack","isMutedVideo","isLocalVideoMute","isMutedAudio","key","getDefaultValueMonitoringMetric","setClearValuesForCurrentMonitoringEventsObject","setInterval","getCountRemoteTracks","monitoringTimeout","setTimeout","clearTimeout","sendMonitoringEvents","isErrorsListNotEmpty","JSON","stringify","withRestart","eventsToSend","eventsToLog","eventName","eventList","eventData","mediaServerId","eventTime","round","eventTypeId","objForSend","audioSubscribed","videoSubscribed","packetLoss","bitrateIn","bitrateOut","connScore","framesLoss","sendQoS","sendLogMonitoringErrors","clearInterval","startAggregateMonitoringEvents","triggerEvents","checkQosFeatureAndExecutionCallback","addMonitoringEvents","replace","canConnect","getMediaServerInfo","mediaServerInfo","signal","aborted","WebSocket","onmessage","socketOnMessageHandler","onopen","socketOnOpenHandler","onerror","socketOnErrorHandler","onclose","socketOnCloseHandler","request","url","fetch","method","response","json","getCallConnectionDataById","isErrorPreventingReconnection","reconnectionStoppableCodeNames","some","failedName","has","abort","createOffer","offer","useTcpSdp","type","sdp","setLocalDescription","getLocalVideo","videoTrack","publishTrack","onPublishFailed","getLocalAudio","audioTrack","parse","answer","joinResponse","role","setCurrentUserRole","removeEventListener","localParticipant","sid","connectedEvent","roomState","setRoomPermissions","setUserPermissionsByRoomPermissions","participantsToDelete","otherParticipants","p","recorderStatus","recorderRespStatus","errMsg","pingInterval","participantJoined","participantLeft","participantId","trackId","timeout","trackCreated","cid","disableAudio","videoEnabled","audioEnabled","screenSharingEnabled","trackDeleted","publisher","shortId","pendingSubscription","tracks","removeTrack","trackMuted","trickle","newMessage","handRaised","isHandRaised","speakersChanged","connectionQuality","updates","participants","participantsToUpdate","remoteParticipant","hasGoodQuality","score","participantSid","isLocalVideoMuted","muted","addValidatedMonitoringMetricWithLogging","pongResp","lastPingTimestamp","leave","reason","reasonsToReconnect","leaveInformation","onErrorResponse","onActionSent","changeSettings","givePermissions","participantMuted","allParticipantsMuted","updateRole","target","candidate","protocol","candidateInit","sdpMid","sdpMLineIndex","usernameFragment","subscriber","state","connectionState","logMessage","iceConnectionState","eventType","handler","set","args","get","console","log","MediaStreamKind","isSimulcast","getVideoTracks","getAudioTracks","senders","getSenders","params","getParameters","encodings","encoding","maxBitrate","rid","setParameters","transceiver","RTCRtpReceiver","cap","getCapabilities","matched","partialMatched","unmatched","codecs","c","mimeType","matchesVideoCodec","sdpFmtpLine","setCodecPreferences","concat","MediaStreamTrack","StreamQualityOptions","getSettings","replaceTrack","addTransceiver","direction","streams","sendEncodings","setCodec","setBitrate","sendOffer","republishTrack","unpublishTrack","participantIds","showVideo","isPaginateToggle","closeRoom","errorInVideoStreamSetupErrorList","kindInListKinds","kindsArray","setVideoStreamSetupErrorList","mediaStreamKind","trackSid","keepTrack","mute","bySystem","enabled","pauseTrack","disabled","havePermissionToBroadcast","canUseUnpauseSignal","needToGetNewTrack","readyState","unpauseTrack","calledFrom","hasQueue","stop","skipUnpause","hasTrack","getLocalScreen","sendMessage","send1to1Info","raised","raiseHand","isUserControlFeatureEnabled","settingsObj","typeOfSetting","settingEnabled","sendAction","act","changeSettingsPayload","typeOfStream","muteAllParticipantPayload","audioMutedEvent","videoMutedEvent","screenShareMutedEvent","muteParticipantPayload","canControlGiveSpeakPermission","allow","readyStateInfo","onended","interrupted","force","fulfilled","promise","prevStream","prevTrack","prevTrackEnabledState","prevTrackId","isAudioPublished","switchActiveAudioDevice","isVideoPublished","switchActiveVideoDevice","recorderControl","isConnected","level","desktopVersion","ApiVersion","version","timestampMS","client","appVersion","logLength","lastSentLog","slice","enable","reconnect","connect","close","pingTimeout","pingReq","tries","maxEncodings","rids","active","scaleResolutionDownBy","max","map","quality","encodingByRid","el","subscription","trackSids","participantTracks","trackSource","pause","videoPaused","trackSetting","exactUser","exactTrack","getParticipants","setStreamQuality","enableVideo","disableVideo","fallbackMode","ideal","exact","trackMuteHandlersAreAddedInfo","GET_LOCAL_TRACK_ERROR","GetProperty","maxFrameRate","getDisplayMedia","cursor","systemAudio","onmute","onunmute","enableAudio","isKibanaLogsEnabled","sendLog","userName","msgLevel","updatedSdp","split","RegExp","test","startsWith","join","hasError","setRemoteDescription","addIceCandidate","createAnswer","remoteDescription","_permissionsJSON","setUserPermissions","participantEvent","Participant","kindArray","setMainStream","trackData","layers","remoteTrack","addTrack","streamRemovingId","getUuidv4","onremovetrack","speakers","speaker","isSpeaking","awaitedTrack","isMuted","toUserId","fromUserId","screenAudioTrack","hasOwnProperty","isRegularUser","getUserRoleByUserId","getCurrentUserRole","getUserPermissions","screen_share","newRoomSettings","getRoomPermissions","eft","AudioEnabled","VideoEnabled","ScreenShareEnabled","updateUserPermissionByNewRoomPermission","config","RTCPeerConnection","onIceCandidate","onConnectionStateChange","onIceConnectionStateChange","ontrack","ids","getStatsHandle","statsAll","packetLostEventAdded","getStats","stats","statsOutput","reportsWithoutCodecs","remoteReports","reportsWithoutRemoteInfo","isQualityLimitationSent","totalBitrateOut","report","processReportsWithoutCodecs","reportId","localId","packetsLostData","calcLocalPacketsLost","currentPercentPacketLost","currentReportPacketsSent","packetsSent","prevReportPacketsSent","prevReportPacketsLost","packetsLost","remoteReportPacketsLost","totalPacketsLost","packetsLostExtended","formatPacketsLostData","calcBitrate","contentType","qualityLimitationReason","qualityLimitationDurations","accumulator","setCodecToReport","saveReportWithoutCodecs","setLocalPacketsLostOrSaveReport","bitrateSumOut","calcBitrateSumFromArray","formattedBitrateOut","parseFloat","toFixed","bitrateList","participantsWithLargeDataLoss","totalBitrateIn","currentPacketLostReceiveCount","inboundRtpStatsArray","needCheckPacketLosts","trackIdentifier","calcRemotePacketsLost","realTrackId","prevReport","inRemoteTracks","number","decimal","pow","addValueInboundRTCStatsToMetrics","metricsKey","isSum","interval","inboundRtpStatsArraySumByKey","prevInboundRtpStatsArraySumByKey","diffInboundRtpStatsArraySumByKey","inboundRtpStatsArrayByKey","currentFramesReceivedArray","currentFramesDroppedArray","currentFramesReceived","currentFramesDropped","currentFramesLoss","bitrateSumIn","formattedBitrateIn","size","streamType","getTracks","s","send","socket","image","cameraStreamQuality","currentVideoQuality","Logger","serviceUrl","attempt","reconnectTimeout","unsentMessages","onSocketOpenHandler","onSocketOpen","onSocketCloseHandler","onSocketClose","onSocketErrorHandler","onSocketError","action","statRecord","bindSocketEvents","getConnectionDelay","removeSocketEvents","scheduleReconnect","disconnect","AbstractCall","uuid","instanceId","parentId","parentUuid","scheme","prop","getInteger","CallType","Instant","getString","CallState","Idle","ready","CallEngine","getCurrentUserId","userData","initiatorId","users","associatedEntity","startDate","videoHd","logToken","getLogService","logger","localStreams","main","eventListeners","initEventListeners","connectionData","_microphoneLevel","dialogInfo","listener","isFunction","indexOf","listenerIndex","eventFields","call","tag","mediaStream","command","getLogMessage","apply","arguments","writeToLogFile","substr","debugFlag","a","getTimeForLog","MessengerDebug","addLog","destroy","Finished","runCallback","CallEvent","onDestroy","onMicrophoneLevel","logPlaybackError","description","checkAndEncodeURI","uri","decodeURI","encodeURI","UserModel","avatar","gender","UserState","talking","getBoolean","cameraState","prevCameraState","microphoneState","screenState","floorRequestState","permissionToSpeak","localUser","centralUser","pinned","presenter","order","prevOrder","allowRename","wasRenamed","renameRequested","EndpointDirection","SendRecv","fieldName","defineProperty","_getField","_setField","onUpdate","_onUpdateTalking","_onUpdateState","talkingStop","eventEmitter","newValue","oldValue","user","getTime","Connected","Infinity","unsubscribe","UserRegistry","_onUserChanged","_sort","sort","b","createSVG","elementName","element","document","createElementNS","isObject","attrNS","setAttributeNS","Dom","adjust","createCssTooltip","tooltipWidth","position","tooltipPosition","getText","getTooltipText","hasTooltip","Boolean","tooltipText","tooltipPositionClass","tooltipClass","tooltipTextVarName","tooltipStyle","TitleButton","elements","root","isGroupCall","create","props","className","getTitle","prettyName","Text","encode","innerHTML","SimpleButton","backgroundClass","blocked","tooltip","getObject","isActive","counter","isComingSoon","comingSoon","callbacks","onClick","getFunction","DoNothing","textNode","attrs","style","children","dataset","counterType","visible","click","classList","add","remove","setProperty","isBlocked","parseInt","counterLabel","toString","innerText","DeviceButton","arrowEnabled","arrowHidden","showLevel","sideIcon","iconContainer","icon","arrow","levelMeter","pointer","ellipsis","onArrowClick","onSideIconClick","getIconContainerClass","getIconClass","stopPropagation","appendChild","viewBox","fill","x1","y1","x2","y2","gradientStop1","offset","gradientStop2","d","x","y","rx","opacity","insertAfter","setAttribute","removeChild","WaterMarkButton","language","src","getWatermarkUrl","TopButton","iconClass","TopFramelessButton","textClass","ParticipantsButton","count","foldButtonState","FoldButtonState","Hidden","allowAdding","leftContainer","rightContainer","foldIcon","separator","onListClick","onAddClick","parentElement","Active","Fold","Unfold","ParticipantsButtonMobile","RecordStatusButton","recordState","updateViewInterval","timeText","stateText","onPauseClick","onStopClick","getRecordTimeText","View","RecordState","Started","updateView","contains","CallUserMobile","userModel","avatarOutline","userStatus","menuArrow","floorRequest","mic","cam","_onUserFieldChangeHandler","_onUserFieldChange","avatarBackground","getAvatarBackground","removeProperty","Utils","getFirstLetters","toUpperCase","toggle","render","update","UserSelectorMobile","userRegistry","_onUserAdded","updateUsers","userFields","cx","cy","r","newNode","renderUser","MobileSlider","parent","content","background","handle","body","onClose","touchStartY","processedTouchId","_onBackgroundClick","touchstart","_onTouchStart","touchmove","_onTouchMove","touchend","_onTouchEnd","pageY","touches","header","scrollTop","identifier","delta","bottom","preventDefault","allowProcessing","changedTouches","closeWithAnimation","MobileMenu","largeIcons","slider","items","getArray","MobileMenuItem","createFragment","onSliderClose","onSliderDestroy","showSubMenu","_userChangeHandler","_onUserChange","subscribeUserEvents","iconText","iconBackground","submenu","clickSubMenu","backgroundImage","prepend","updateUserIcons","CallUser","_onUserFieldChangedHandler","_onUserFieldChanged","parentContainer","screenSharingUser","isBoolean","allowBackgroundItem","allowMaskItem","_allowPinButton","allowPinButton","_visible","_audioTrack","_screenAudioTrack","_audioStream","MediaStream","_screenAudioStream","_videoTrack","_stream","_videoRenderer","_previewRenderer","_flipVideo","flipVideo","_tracksSubscriptionFailed","_alwaysShowName","alwaysShowName","_hiddenFloorRequest","hiddenFloorRequest","_hiddenRemoteParticipantButtonMenu","hiddenRemoteParticipantButtonMenu","hidden","videoBlurState","isChangingName","_badNetworkIndicator","incomingVideoConstraints","audioElement","screenAudioElement","screenAudio","callBacks","onUserRename","onUserRenameInputFocus","onUserRenameInputBlur","onPin","onUnPin","onTurnOffParticipantMic","onTurnOffParticipantCam","onTurnOffParticipantScreenshare","checkAspectInterval","checkVideoAspect","hintManager","UI","Hint","createInstance","popupParameters","targetContainer","bindOptions","forceBindPosition","connectionStats","connectionStatsVisible","removeAvatarPulseTimer","hideUserNameTimer","toggleStateUserName","isVisibleMediaStateIcon","statsOverlay","showConnectionStats","videoBorder","container","avatarContainer","panel","getStateMessage","userBottomContainer","nameContainer","changeNameIcon","toggleNameInput","changeNameContainer","changeNameCancel","changeNameInput","keydown","onNameInputKeyDown","focus","blur","changeNameConfirm","changeName","changeNameLoader","introduceYourselfContainer","updateAvatarPulseState","debugPanel","connectionQualityIcon","connectionProblem","mouseover","currentTarget","mouseout","hide","getAvatarInnerText","videoContainer","volume","autoplay","playsinline","preview","srcObject","isVisibleCameraStateIcon","isVisibleMicStateIcon","buttonBackground","open","buttonMenu","showMenu","remoteParticipantButtonMenu","showRemoteParticipantMenu","buttonPin","buttonUnPin","micState","updatePanelDeferred","statsString","cameraStats","screenStats","audioStats","failedTracksResult","_formatFailedSubscribtionTracks","_formatVideoStats","codecName","videoRenderer","requestVideoSize","updateId","updateName","updateAvatar","updateState","updateTalking","updateMicrophoneState","updateCameraState","updateVideoPaused","updateFloorRequestState","updateScreenState","updatePanel","updateRenameAllowed","updateWasRenamed","updateRenameRequested","updateOrder","select","keyCode","inputValue","newName","trim","needToUpdate","menuItems","onclick","menu","rect","getRelativePosition","Menu","bindElement","left","top","autoHide","closeByEsc","offsetTop","offsetLeft","angle","overlay","backgroundColor","cacheable","onPopupDestroy","remoteParticipantMenu","darkMode","onShow","popup","getTarget","adjustPosition","isMounted","offsetWidth","initialUpdate","hasChildNodes","lastWIdth","canChangeBackground","needChangeBackgroundButton","needChangePinButton","needChangeUnPinButton","clean","append","currentBitrixCall","getCurrentBitrixCall","isShowRemoteParticipantButtonMenu","canControlChangeSettings","provider","Provider","Plain","videoElement","hasVideoEl","isCanPlaying","isReadyPlaying","HAVE_CURRENT_DATA","isEnded","ended","play","load","onloadeddata","playVideoElements","hasVideo","isCallServerAllowed","audioStream","userModelId","setSinkId","screenAudioStream","blurState","userState","Calling","Declined","Ready","Connecting","Failed","Unavailable","initUserNameState","addAvatarPulseTimer","clearAvatarPulseTimer","updateRemoteParticipantMenuState","blurVideo","videoHeight","videoWidth","videoStats","resultString","limitationsString","frameWidth","frameHeight","qualityLimitationResolutionChanges","framesPerSecond","limitations","trackIndex","_getVideoStats","activeClassName","hasActiveClass","releaseStream","playAudio","playScreenAudio","updateRendererState","_tempVideoRenderer","currentVideoRendererKind","newVideoRendererKind","badNetworkIndicator","hasConnectionProblem","_hasConnectionProblem","_connectionQuality","connectionQualityIcons","excellent","good","poor","bad","resultIcon","FloorRequest","hideTime","isShowAllowPermissionButton","_canChangeSpeakPermission","onAllowSpeakPermissionClicked","onDisallowSpeakPermissionClicked","_hideTimeout","_onUserModelChangedHandler","_onUserModelChanged","scheduleDismount","dismount","util","htmlspecialchars","createAllowPermissionButton","onCloseClicked","dismountWithAnimation","Button","baseClass","Size","EXTRA_SMALL","color","Color","LIGHT_BORDER","noCaps","_allowPermissionHandler","innerHtml","maximumNotifications","instance","NotificationManager","maxNotification","notifications","notification","onNotificationDestroy","firstNotification","shift","DeviceSelectorEvents","onMicrophoneSelect","onMicrophoneSwitch","onCameraSelect","onCameraSwitch","onSpeakerSelect","onSpeakerSwitch","onChangeHdVideo","onChangeMicAutoParams","onChangeFaceImprove","onAdvancedSettingsClick","DeviceSelector","viewElement","zIndex","cameraEnabled","microphoneEnabled","speakerEnabled","allowHdVideo","faceImproveEnabled","allowFaceImprove","allowBackground","allowMask","allowAdvancedSettings","switchCameraBlocked","switchMicrophoneBlocked","isDestroying","micContainer","cameraContainer","speakerContainer","Popup","onPopupClose","microphoneContainer","DeviceMenu","deviceLabel","getMicrophoneList","selectedDevice","deviceEnabled","icons","onSwitch","onSelect","getCameraList","canSelectSpeaker","getSpeakerList","checked","change","onAllowHdVideoChange","onFaceImproveChange","startSelfTest","MessengerCommon","available","unblock","block","DeviceMenuEvents","menuBlocked","switchIcon","menuInner","getDeviceIconClass","Switcher","handlers","toggled","onSwitchToggled","getNode","renderDevice","deviceElements","onMenuItemClick","currentDevice","CopilotNotifyType","COPILOT_ENABLED","COPILOT_DISABLED","COPILOT_RESULT","AI_UNAVAILABLE_ERROR","AI_SETTINGS_ERROR","AI_AGREEMENT_ERROR","AI_NOT_ENOUGH_BAAS_ERROR","AI_MODULE_ERROR","ENABLE_AI_INTERNAL_ERROR","DISABLE_AI_INTERNAL_ERROR","CopilotNotify","callId","notifyText","promoId","popupTemplate","notifyColor","setAdditionalInformation","Loc","getMessage","self","getPopupTemplate","padding","contentBorderRadius","contentBackground","contentNoPaddings","animation","popupWidth","getPopupContainer","elementWidth","offsetFix","setOffset","setAngle","PromoManager","getInstance","markAsWatched","canShowCopilotNotify","Analytics","copilot","onCopilotNotifyShow","isCopilotActive","needToShow","CallAiError","CallAi","serviceEnabled","settingsEnabled","recordingMinUsers","agreementAccepted","tariffAvailable","baasAvailable","feedBackLink","baasPromoSlider","helpSlider","disclaimerArticleCode","Extension","ai","setup","errorType","_serviceEnabled","flag","_settingsEnabled","_recordingMinUsers","_agreementAccepted","_tariffAvailable","_baasAvailable","_feedBackLink","_baasPromoSlider","_helpSlider","_disclaimerArticleCode","CallAI","MediaRenderer","UnsupportedBrowserFeatures","listOfDevicesBeforeStream","browser","listOfPiPAvailable","IsFirefox","IsChrome","PictureInPictureWindow","pictureWindow","template","userPanel","actionsPanel","notificationPanel","buttons","microphone","camera","returnToCall","stopScreen","preferInitialWindowPlacement","currentUser","blockedButtons","previousFloorRequestNotifications","floorRequestNotifications","onButtonClick","isMinSize","floorRequestElements","mainNotification","floorRequestsList","floorRequestTimeForHidden","floorRequestTimeout","baseWidthPopup","buttonName","showStats","mount","mediaRenderer","hasUser","isCurrentUser","destroyCurrentUser","renderUserPanel","buttonsList","renderButtons","Buttons","getButtonTextBySizePictureWindow","showPointer","isButtonBlocked","_onButtonClick","previewRenderer","floorRequestsListItem","avatarBackgroundColor","initials","updateFloorRequestCounter","userInFloorRequestsListIndex","hasUserInFloorRequestsList","isActiveFloorRequestState","withoutRenderTemplate","updateVisibilityFloorRequestCounter","updateTemplateForFloorRequestsPopup","floorRequestsListItemIndex","avatarElement","tmpTemplate","getTemplateForFloorRequestsPopup","setContent","withoutAdditionInList","withoutDismount","updateFloorRequestsList","updateFloorRequestMainNotification","renderNotificationPanel","closeFloorRequestMainNotification","isHidden","renderFloorRequestCounter","hiddenClass","hasHiddenClass","composedPath","clientHeight","clientWidth","bindElementPos","getBoundingClientRect","baseOffsetHorizontalPopup","baseOffsetVerticalPopup","maxWidthPopup","widthPopup","heightWidth","setWidth","setMaxHeight","setNewSettingForPopup","pictureWindowHeight","updateButtons","avatarSize","avatarTextSize","onMouseOutCallbackForPopup","setAvatarSettings","setSizePictureWindow","onResize","onMouseMove","documentPictureInPicture","requestWindow","disallowReturnToOpener","toggleEvents","styleSheets","styleSheet","cssRules","rule","cssText","createElement","textContent","head","link","rel","media","href","warn","isPiPAvailable","UserSelector","userList","current","popupWindow","MenuManager","SPOTLIGHT_ID_PREFIX","AhaMomentNotify","random","notifyTitle","spotlight","SpotLight","targetElement","targetVertex","lightMode","getSpotlight","getTargetContainer","Layouts","Grid","Centered","Mobile","RerenderReason","VideoDisabled","UserDisconnected","SwapType","Direct","Replace","UiState","Preparing","Initializing","Folded","Full","Resumed","Paused","Stopped","RecordType","None","Video","Audio","RoomState","Speaker","NonSpeaker","EventName","onBodyClick","onReplaceCamera","onReplaceMicrophone","onReplaceSpeaker","onSetCentralUser","onLayoutChange","onUserClick","onUserPinned","onDeviceSelectorShow","onOpenAdvancedSettings","onHasMainStream","onAllowSpeakPermission","onDisallowSpeakPermission","onToggleSubscribe","onUnfold","onPiPClose","beginingPosition","newUserPosition","addButtonPosition","MIN_WIDTH","SIDE_USER_WIDTH","SIDE_USER_HEIGHT","MAX_USERS_PER_PAGE","MIN_GRID_USER_WIDTH","MIN_GRID_USER_HEIGHT","CHANGE_VIDEO_RERENDER_DELAY","WAITING_VIDEO_DELAY","CALLCONTROL_PROMO_ID","DocumentVisibilityState","_classPrivateMethodInitSpec","disable","pictureInPictureCallWindow","setButtons","getPictureInPictureCallWindowGetButtonsList","baseZIndex","speakerMuted","showChatButtons","showUsersButton","showShareButton","showRecordButton","showDocumentButton","showCopilotButton","showButtonPanel","showAddUserButtonInList","preferInitialWindowPlacementPictureInPicture","limitation","inactiveUsers","activeUsers","rerenderTimeout","waitingForUserMediaTimeouts","rerenderQueue","shelvedRerenderQueue","broadcastingMode","broadcastingPresenters","currentPage","pagesCount","usersPerPage","lastPosition","updateUserData","userLimit","isIntranetOrExtranet","screenUsers","localUserModel","avatar_hr","cache","_onUserRename","_onUserRenameInputFocus","_onUserRenameInputBlur","_onUserClick","_onTurnOffParticipantMic","_onTurnOffParticipantCam","_onTurnOffParticipantScreenshare","_onUserPin","_onUserUnPin","centralUserMobile","pinnedUser","presenterId","localUserRecivedStats","returnToGridAfterScreenStopped","mediaSelectionBlocked","wrap","watermark","topPanel","audioContainer","screenAudioContainer","center","localUserMobile","userBlock","ear","right","addButton","userSelectorContainer","pinnedUserContainer","renameSlider","input","button","pageNavigatorLeft","pageNavigatorLeftCounter","pageNavigatorRight","pageNavigatorRightCounter","grid","share","record","mobileMenu","chat","history","hangup","fullscreen","recordStatus","participantsMobile","hd","more","hangupOptions","previousTopButtonList","needToRerenderTopButtonList","previousButtonList","needToRerenderButtonList","isFullScreen","isUserBlockFolded","getDefaultRecordState","configBlockedButtons","buttonCode","hiddenButtons","overflownButtons","configHiddenButtons","hiddenTopButtons","configHiddenTopButtons","uiState","layout","whiteSpaceInUserGrid","scrollInterval","_onFullScreenChangeHandler","_onFullScreenChange","_onResizeHandler","_onResize","_onOrientationChangeHandler","_onOrientationChange","_onKeyDownHandler","_onKeyDown","_onKeyUpHandler","_onKeyUp","resizeObserver","ResizeObserver","intersectionObserver","switchPresenterTimeout","deviceSelector","userSelector","userSize","hotKey","all","microphoneSpace","muteSpeaker","hotKeyTemporaryBlock","_isPreparing","_videoRerenderDelay","isWindowFocus","isDocumentHidden","_isActivePiPFromController","pictureInPictureUpdateButtonHandler","viewVisibility","init","subscribeEvents","userStates","appendUsers","hideEarTimer","isCopilotFeaturesEnabled","copilotNotify","ahaMomentNotify","currentPiPUserId","isVideoconf","needToShowCallcontrolPromo","articleCode","infoHelper","InfoHelper","isOpen","limitObj","_onBodyClick","openArticle","getCallFeatures","defaultLimitation","currentLimitation","getLimitationByType","isDesktopCall","getBackgroundImage","backgroundId","setCallBackground","addClass","removeClass","getLimitation","checkAvailableBackgroundImage","isFullScreenSupported","Browser","isChrome","isSafari","isFirefox","isMobile","documentElement","innerHeight","setSpeakerId","setMuted","setCameraState","onMouseMoveHandler","toggleVisibilityEar","keyModifierForCss","isMac","startViewVisibilityChange","setCallback","cb","userIds","addUser","previousCentralUser","updateUserList","setUserModel","showUserMenu","candidateUserId","userModels","totalUserModels","withYou","getConnectedUsers","isUserHasActiveState","hasOwn","currentPresenterId","getConnectedUserCount","currentPresenterModel","wasTalkingAgo","minTalkingAgo","minTalkingAgoUserId","userWasTalkingAgo","newPresenterId","getPresenterUserId","setCurrentUser","getPictureInPictureCallWindowUser","setCentralUser","switchPresenter","newLayout","useShelvedRerenderQueue","playVideo","unpinUser","setUserBlockFolded","toggleEars","setSideIcon","getMicrophoneSideIcon","pageNumber","recalculateUsersPerPage","renderUserList","containerSize","columns","rows","rowsWithoutGap","rowGap","elementSize","findBestElementSize","pages","ceil","getDisplayedUsers","calculateUsersPerPage","calculatePagesCount","displayedUsers","userPosition","microphoneLevel","setLevel","RecvOnly","getNextPosition","updateUserButtons","newState","setUiState","usersWithVideo","getUsersWithVideo","connectedUsers","timer","setUserFloorRequestState","setUserPermissionToSpeakState","hasCameraVideo","skippedElementsList","switchPresenterDeferred","setStats","showTrackSubscriptionFailed","isMicrophoneOn","updateRerenderQueue","userFloorRequestState","userActive","Busy","updateFloorRequestNotifications","showFloorRequestNotification","setButtonActive","permissionToSpeakState","indexFloorRequestInList","req","hasFloorRequestInList","currentUserData","_userModel","_onAllowSpeakPermissionClickedHandler","_onDisallowSpeakPermissionClickedHandler","Instance","addNotification","updatePermissionButtonState","Layout","setLayout","hasUserWithScreenSharing","streamData","setVideoRenderer","isUndefined","flipLocalVideo","videoTracks","videoTrackSettings","audioTracks","audioTrackSettings","localStreamVideoTrack","hideArrow","showArrow","videoRerenderDelay","userHasCameraVideo","setUserScreenState","setIncomingVideoConstraints","date","start","unblockButtons","blockButtons","startIntersectionObserver","resumeVideo","disableFaceImprove","checkPanelOverflow","closeCopilotNotify","clearCallcontrolPromo","overflownButtonsPopup","IntersectionObserver","_onIntersectionChange","threshold","callUser","observe","unobserve","getCameraSmoothingStatus","BXIM","_onMicrophoneSelected","_onMicrophoneButtonClick","_onCameraSelected","_onCameraButtonClick","_onSpeakerSelected","_onSpeakerButtonClick","_onChangeHdVideo","_onChangeMicAutoParams","_onChangeFaceImprove","_onMobileCallMenuFloorRequestClick","_onMobileCallMenShowParticipantsClick","_onMobileCallMenuCopyInviteClick","callMenu","showRenameSlider","_onMobileCallMenuCancelClick","pinItem","userMenu","pinUser","participantsMenu","statusNode","_classPrivateMethodGet","errorContainer","location","reload","showMessage","renderReloadPageLayout","renderSelfTestCallLayout","stopViewUpdate","toggleStatePictureInPictureCallWindow","isUiBlocked","isForceBlock","noCamPermission","isUserConnecting","isScreenSharingSupported","showButtons","hideButtons","scrollWidth","mediumButtonMinWidth","countOfButtonsToHide","getButtonList","hiddenButtonsCount","unusedPanelSpace","calculateUnusedPanelSpace","countOfButtonsToShow","min","buttonsLeftHidden","toggleCameraAvailability","toggleMicrophoneAvailability","setBlocked","updateBlockButtons","getBlockedButtonsListPictureInPictureCallWindow","isMediaSelectionAllowed","previousButtonCode","_onCenterTouchStart","_onCenterTouchEnd","_onLeftPageNavigatorClick","_onRightPageNavigatorClick","_onLeftEarClick","_onRightEarClick","innerWidth","_onTopPageNavigatorClick","_onBottomPageNavigatorClick","scroll","Runtime","wheel","deltaY","_onAddButtonClick","rules","clear","changes","to","diffBetweenChanges","lessChangesField","moreChangesField","toUser","fromUser","orderChanges","applyOrderChanges","abs","incompleteSwaps","disconnectedUserHadVideo","swapRemains","usersWithEnabledVideo","pop","usersToKeepActive","userEnabledVideo","currenUserFromCurrentPage","possibleActiveUsers","changedUserFromCurrentPage","skipDeactivation","currentPageUsers","usersToDeactivate","usersToForceDeactivation","usersProcessed","userWithoutVideo","userWithoutVideoIndex","userWithoutVideoPage","skipUsers","numberOfUsersWithVideoForSwap","userToSwap","canCompleteVideoSwap","userToSwapIndex","userToSwapPage","userSkipped","disconnectedUser","lowerOrderOnCurrentPage","higherOrderOnCurrentPage","disconnectedUserFromCurrentPage","activeUsersFromPreviousPage","lastActiveUserFromPreviousPage","showAdd","pageChange","showLocalUser","shouldShowLocalUser","userCount","skippedUsers","renderedUsers","orderingRules","getOrderingRules","orderingParams","usersWithDisabledVideo","videoDisabledProceed","processVideoRules","processDisconnectRules","getActiveUsers","getUsersWithCamera","completeVideoDisabledSwap","completeDisconnectSwap","screenUser","unobserveIntersections","previousIncompleteSwaps","currentUserFromCurrentPage","completeVideoEnableSwap","swapCompleted","calculateUserActive","isPreparing","observeIntersections","updateGridUserSize","updateCentralUserAvatarSize","applyIncomingVideoConstraints","renderAddUserButtonInList","childElementCount","currentActiveUsers","currentInactiveUsers","currentPiPUserIndexInInactiveUsers","toggleSubscribingVideoInRenderUserList","rerender","panelInner","_onShareButtonClick","_onMicrophoneArrowClick","_onMicrophoneSideIconClick","_onCameraArrowClick","_onScreenButtonClick","_onRecordToggleClick","_onDocumentButtonClick","setActive","_onCopilotButtonClick","_onHangupButtonClick","_onHangupOptionsButtonClick","_onCloseButtonClick","_onMobileMenuButtonClick","_onChatButtonClick","_onFloorRequestButtonClick","_onMoreButtonClick","waterMark","_onRecordPauseClick","_onRecordStopClick","recordingUserName","_onGridButtonClick","_onFullScreenButtonClick","feedback","_onFeedbackButtonClick","callcontrol","_onCallcontrolButtonClick","_onParticipantsButtonListClick","_onParticipantsButtonMobileListClick","isEnabled","setIsComingSoon","notifyType","createCopilotNotify","ahaMomentNotifyCallcontrol","buttonList","totalButtonWidth","buttonWidth","getButtonActive","isViewHidden","getCurrentVisibility","currentUserId","isLocalUser","isCurrentPiPUser","modifiedCurrentUser","isPictureInPictureFeatureEnabled","_onPiPClose","checkAvailableAndCreate","setCounter","recalculatePages","closeIcon","currentConnectedUserCount","previousConnectedUserCount","topButtonList","getTopButtonList","renderTopButtons","setCount","showCallcontrolPromoPopupTimeout","createAhaMomentNotifyCallcontrol","isAvatarBlank","BXDesktopSystem","IsSafari","webkitFullscreenEnabled","fullscreenEnabled","toggleTopEar","toggleBottomEar","stopScroll","isButtonHidden","centerTouchX","pageX","getRightUser","getLeftUser","webkitFullscreenElement","fullscreenElement","t","intersectionEntry","isIntersecting","IsMobile","rootDimensions","shiftKey","ctrlKey","metaKey","repeat","callMinimized","isHotKeyActive","pushToTalk","microphoneHotkeyTimerId","_onUsersButtonClick","isRecordingHotKeySupported","_onForceRecordToggleClick","_destroyHotKeyHint","fromHotKey","setHotKeyTemporaryBlock","getRecordLimitation","onClickButtonWithLimit","_onRecordStartClick","_onForceRecordStartClick","recordType","forceRecord","node","showDeviceSelector","getScreenSharingLimitation","showCallMenu","showOverflownButtonsPopup","clearNewLogicRules","viewEvent","BaseEvent","compatData","isDefaultPrevented","showParticipantsMenu","renderRenameSlider","_onMobileUserRename","toggleRenameSliderInputLoader","setCurrentPage","MAX_WIDTH_SPEAKER_MODE","animateUnsetProperty","_applyMaxWidth","setMaxWidth","containerDimensions","once","destroyed","unsubscribeAll","stopViewVisibilityChange","listners","listner","visibilityState","capture","Chat","VOLUME_THRESHOLD","INACTIVITY_TIME","AVERAGING_COEFFICIENT","SimpleVAD","clone","audioContext","mediaStreamNode","analyserNode","audioTimeDomainData","voiceState","measureInterval","inactivityTimeout","currentVolume","voiceStarted","onVoiceStarted","voiceStopped","onVoiceStopped","isSupported","AudioContext","webkitAudioContext","createAnalyser","fftSize","createMediaStreamSource","Float32Array","analyzeAudioStream","getFloatTimeDomainData","updateCurrentVolume","setVoiceState","onInactivityTimeout","sum","rms","sqrt","AnalyserNode","ajaxActions","decline","clientEvents","negotiationNeeded","connectionOffer","connectionAnswer","iceCandidate","customMessage","usersInvited","userInviteTimeout","defaultConnectionOptions","offerToReceiveVideo","offerToReceiveAudio","signalingConnectionRefreshPeriod","signalingWaitReplyPeriod","invitePeriod","ServerPlainCall","hasVideoTracks","replaceLocalMediaStream","signaling","sendCameraState","onLocalMediaReceived","sendMicrophoneState","sendTalkingState","_classPrivateFieldInitSpec","waitForAnswerTimeout","peer","peers","createPeer","onUserJoined","setSignalingConnected","setReady","sendAllStreams","isAnyoneParticipating","onCustomMessage","_reconnectionEventCount","onReconnecting","reconnectionEventCount","onReconnected","DisconnectReason","SecurityKeyChanged","onCallFailure","onReconnectingFailed","callFromMobile","initPeers","Signaling","turnServer","turnServerLogin","turnServerPassword","_onUnloadHandler","microphoneLevelInterval","Peer","signalingConnected","isLegacyMobile","onMediaReceived","onRemoteMediaReceived","onMediaStopped","onRemoteMediaStopped","onStateChanged","onInviteTimeout","onRTCStatsReceived","onRTCQualityChanged","onNetworkProblem","onUpdateLastUsedCameraId","calculatedState","onNeedResetMediaDevicesState","changedMediaMutedBySystem","replaceLocalAudioStream","senderId","sendRecordState","localStream","getLocalMediaStream","attachToConference","onInvited","sendUsersInvited","CallApi","getState","bindCallEvents","on","subscribeHardwareChanges","onJoin","local","setVideoEnabled","hdVideo","supportedConstraints","getSupportedConstraints","echoCancellation","noiseSuppression","autoGainControl","constraintsArray","currentConstraints","fallbackToAudio","getMediaConstraints","onLocalVideoTrackEnded","onLocalVideoTrackMute","onLocalVideoTrackUnmute","onLocalAudioTrackEnded","setPublishingState","attachVoiceDetection","onDeviceListUpdated","deviceType","publishing","onCameraPublishing","onMicrophonePublishing","voiceDetection","onLocalVoiceStarted","onLocalVoiceStopped","changeSource","stopScreenSharing","onUserScreenState","sendMedia","stopMediaStreamVideoTracks","stopMediaStreamAudioTracks","prevMainStream","isReady","replaceMediaStream","stopMediaStream","onUserVoiceStarted","sendVoiceStarted","onUserVoiceStopped","sendVoiceStopped","sendCustomMessage","callUuid","callInstanceId","getRestClient","callMethod","tempError","stack","Proceeding","onLeave","getLocalAudioStream","isParticipating","onUserInvited","extra","finishCall","finish","pauseElement","addJoinedUsers","addInvitedUsers","setDeclined","restart","onNegotiationNeeded","setUserAgent","userAgent","setConnectionOffer","connectionId","setConnectionAnswer","candidates","onUserMicrophoneState","onUserCameraState","onUserVideoPaused","holdOutgoingVideo","onUserRecordState","ASSOCIATED_ENTITY","onUserStateChanged","remoteReportsToShow","localReportsToShow","onUserStatsReceived","onConnectionQualityChanged","removeCallEvents","unsubscribeHardwareChanges","statsInterval","getPullClient","isPublishingSupported","requestId","calling","inviteTimeout","declined","busy","failureReason","calculateState","pendingIceCandidates","localIceCandidates","trackList","answerTimeout","callingTimeout","connectionTimeout","signalingConnectionTimeout","candidatesTimeout","connectionOfferReplyTimeout","negotiationNeededReplyTimeout","reconnectAfterDisconnectTimeout","connectionAttempt","hasStun","hasTurn","_outgoingVideoTrack","outgoingVideoHoldState","_outgoingScreenTrack","_incomingAudioTrack","_incomingScreenAudioTrack","_incomingVideoTrack","_incomingScreenTrack","_mediaGetter","_mediaSetter","_onPeerConnectionIceCandidateHandler","_onPeerConnectionIceCandidate","_onPeerConnectionConnectionStateChangeHandler","_onPeerConnectionIceGatheringStateChangeHandler","_onPeerConnectionSignalingStateChangeHandler","_onPeerConnectionTrackHandler","_onPeerConnectionRemoveStreamHandler","_updateTracksDebounced","_waitTurnCandidatesTimeout","prevPercentPacketLostList","incomingPacketLost","outgoingPacketLost","screenShareBitrate","maxConnectionScore","incomingConnectionScore","outgoingConnectionScore","trackVariable","skipOffer","peerConnection","isInitiator","sendNegotiationNeeded","updateOutgoingTracks","applyResolutionScale","createAndSendOffer","screenTrack","outgoingVideoTrack","outgoingScreenTrack","tracksToSend","videoSender","screenSender","screenAudioSender","audioSender","rtpSender","getTransceivers","mid","factor","scaleFactor","rate","videoParams","screenParams","isRenegotiationSupported","getLocalStream","holdState","updateCalculatedState","internal","refreshSignalingTimeout","stopSignalingTimeout","previousState","networkProblem","incomingDataLoss","outgoingDataLoss","needCheckInputPacketLost","newIncomingConnectionDataLoss","newIncomingConnectionScore","calcNewConnectionScore","newOutgoingConnectionDataLoss","newOutgoingConnectionScore","dataLoss","sendIceCandidates","getSignaling","sendIceCandidate","peerConnectionId","stopStatisticsGathering","incomingAudioTrack","incomingScreenAudioTrack","incomingVideoTrack","incomingScreenTrack","isIceTricklingAllowed","toJSON","updateCandidatesTimeout","match","array_flip","_destroyPeerConnection","applyOfferAndSendAnswer","connectionConfig","_onConnectionOfferReplyTimeout","sendConnectionOffer","localDescription","getSenderMid","sharingAudio","_onNegotiationNeededReplyTimeout","sessionDescription","RTCSessionDescription","pendingRemoteSdpDelay","pendingRemoteSdp","applyPendingIceCandidates","sendConnectionAnswer","signalingState","iceRestart","urls","username","credential","startStatisticsGathering","iceGatheringState","tr","currentDirection","receiver","invite","emotion","showUsers","showAll","hideAll","scenarioEvents","viewerJoined","viewerLeft","BitrixCallEvent","onCallConference","MediaKinds","reinvitePeriod","BitrixCall","calledProgrammatically","localVideoShown","sendUserInviteTimeout","failedUserId","__onPullEventAnswerSelf","pullEvent","setBusy","onSwitchTrackRecordStatus","isTrackRecordOn","isNotSupportDevicesListBeforeStream","onGetUserMediaEnded","screenShared","waitingLocalScreenShare","getUserMediaFulfilled","stopScreenShare","addMediaRenderer","cameraStateInfo","removeMediaRenderer","onUserFloorRequest","requestActive","localVAD","requestFloor","sendTelemetryEvent","localUserState","startScreenShare","videoAllowedFrom","UserMnemonic","none","sendHideAll","sendShowUsers","floorRequestActive","logData","headers","joinedAsViewer","reinitPeers","RoomClosed","onTrackSubscriptionFailed","usersToSendReports","statsIndexByRid","prevPeersWithBadConnection","peersWithBadConnection","isVideoShown","onToggleRemoteParticipantVideo","onUserEmotion","setDirection","onAllParticipantsAudioMuted","onAllParticipantsVideoMuted","onAllParticipantsScreenshareMuted","onYouMuteAllParticipants","onRoomSettingsChanged","onUserPermissionsChanged","onUserRoleChanged","onParticipantMuted","ignoreError","_recorderState","_recorderStateHasChange","onRecorderStatusChanged","videoQuality","Quality","VeryHigh","_localUserState","clientEventsBound","_screenShared","reinviteTimeout","pullEventHandlers","_isCopilotFeaturesEnabled","_isRecordWhenCopilotActivePopupAlreadyShow","_isBoostExpired","incomingVideoAllowed","allowedUserId","isIncomingVideoAllowed","onMediaRemoved","isMediaMutedBySystem","canChangeMediaDevices","setRecorderState","resetMainStream","turnOffAllParticipansStream","turnOffParticipantStream","allowSpeakPermission","repeatOnConnect","sendShowAll","allowIncomingVideo","usersToInvite","inviteParams","repeated","inviteUsers","scheduleRepeatInvite","repeatInviteUsers","usersToRepeatInvite","joinAsViewer","ajax","runAction","_replaceVideoSharing","userRole","toggleRemoteParticipantVideo","call_id","user_id","Bitrix","sendScreenState","isBoostExpired","isRecordWhenCopilotActivePopupAlreadyShow","MAX_USERS_WITH_VIDEO","countDisableCameraNewJoinedUsersFeature","isDisableCameraNewJoinedUsersFeatureEnabled","remoteParticipantsCount","enableSilentLogging","setLoggerCallback","signalName","mediaRenderers","CallStub","lifetime","onDelete","deleteTimeout","CallMultiChannel","channel","BroadcastChannel","requests","payload","responders","responses","deadline","postMessage","SendOnly","Permanent","RoomType","Small","Conference","Large","Personal","Direction","Incoming","Outgoing","High","Medium","Low","VeryLow","StartCallErrorCode","AuthorizeError","BlankAnswer","BlankAnswerWithErrorCode","ErrorUnexpectedAnswer","NoWebrtc","NotAllowedError","NotReadableError","onLocalMediaStopped","onLocalScreenUpdated","onBadNetworkIndicator","onJoinRoomOffer","onJoinRoom","onLeaveRoom","onListRooms","onUpdateRoom","onTransferRoomSpeakerRequest","onTransferRoomSpeaker","createCall","createChatForChildCall","getPublicChannels","getCall","CallScheme","classic","Engine","calls","siteId","unknownCalls","restClient","pullClient","finishedCalls","multiBroadcastClient","addCustomEvent","rest","PULL","onCustomEvent","callType","callProvider","getDefaultProvider","joinExisting","entityType","entityId","onCallCreated","isNew","getCallConnectionData","callToken","isVideo","chatInfo","chatId","aiSettings","getAiSettings","callFactory","debug","parentCall","newProvider","newUsers","callParameters","createCallResponse","callFields","UUID","CallTokenManager","setToken","userCounter","hasConnectionData","dialogId","chatDialogId","participantsCount","jwtPullHandlers","callScheme","SCHEME","addDialogInfo","__onPullEvent","server_time_ago","broadcastRequest","broadcastResponse","hasActiveCalls","res","clearTokenList","CallSettingsManager","jwtCallsEnabled","isJwtEnabled","plainCallsUseJwt","isPlainUseJwt","callBalancerUrl","providerType","PlainCallFactory","BitrixCallFactory","cancel","ping","pullEvents","pingPeriod","backendPingPeriod","PlainCall","pingUsersInterval","pingUsers","pingBackendInterval","pingBackend","_onOnlineHandler","_isCopilotActive","sendAnswer","sendHangup","sendPingToUsers","sendPingToBackend","isPublishingEnabled","retransmit","expiry","lastSuccessedLocaleCandidate","lastSuccessedRemoteCandidate","bytesReceived","bytesSent","lastSuccessedLocaleCandidateId","localCandidateId","lastSuccessedRemoteCandidateId","remoteCandidateId","reconnectInfoObject","repeatAnswer","BitrixCallLegacy","joinedElsewhere","lastSelfPingReceivedTimeout","lastPingReceivedTimeout","_outgoingAnswer","CallEngineLegacy","sendFinish","backgroundCalling","showUser","createChildCall","EngineLegacy","getError","error_description","setUserData","publicChannels","setPublicIds","TYPE","START_DATE","instantiateCall","publicIds","ID","PROVIDER","PARENT_ID","invitedUsers","getCallWithId","Messenger","Application","conference","inited","blankAvatar","usersInProcess","roomPermissions","userPermissions","ask","can_approve","change_role","change_settings","end_call","give_permissions","join_call","kick_user","mute_others","record_call","view_users","UsersRoles","ADMIN","MANAGER","USER","regularUserRoles","currentUserRole","_roomPermissions","permission","_roomPermission","_role","_userPermissions","havePermission","usersToUpdate","getDateForLog","getFullYear","lpad","getMonth","getDate","getHours","getMinutes","getSeconds","getMilliseconds","str","chr","getUser","getUserCached","getUsers","getUserName","getUserAvatar","isBlank","getUserAvatars","getCustomMessage","messageText","convertKeysToUpper","placeHolder","obj","objectClone","k","u","appendChildren","child","containsVideoTrack","hasHdVideo","trackSettings","minWidth","minHeight","bestFilledArea","area","getFilledArea","elementHeight","bestWidth","bestHeight","rowCount","columnCount","maxElementWidth","maxElementHeight","ratio","neededRatio","expectedElementHeight","expectedElementWidth","isWebRTCSupported","webkitRTCPeerConnection","mozRTCPeerConnection","isFeedbackAllowed","shouldCollectStats","shouldShowDocumentButton","getDocumentsArticleCode","getResumesArticleCode","getUserLimit","getClientSelfTestUrl","v","reportConnectionResult","connectionResult","BXDesktopWindow","getBrowserForStatistics","IsOpera","endsWith","getConferenceProvider","codecId","currentReport","isLocal","bytes","time","trunc","remoteReport","deltaPacketsSent","deltaPacketsLost","percentPacketLost","percentPacketLostTotal","currentPacketsLost","totalPercentPacketLost","deltaPacketsReceived","packetsReceived","colorList","returnInSeconds","nowDate","pauseTime","totalTime","second","hour","minute","padStart","getTimeText","startTime","getTimeInSeconds","isConferenceChatEnabled","callOptions","mustCreate","roomType","isJwtInPlainCallsEnabled","getUserToken","userToken","clientVersion","clientPlatform","responseInfo","ok","SyntaxError","xhr","responseText","getTokenCached","abortGetCallConnectionData","isChatMountInPage","isAirDesignEnabled","shouldHideQuickAccess","evnt","InternalEvents","setHasCamera","contentReady","FirstDesktopVersionWithChrome","BroadcastChannelName","IncomingNotification","callerAvatar","callerName","callerType","callerColor","hasCamera","isMessengerOpen","postponedEvents","onButtonClickHandler","onContentReadyHandler","broadcastChannel","desktopWindowIsReady","isChatWindow","IncomingNotificationContent","htmlContent","createTopmostWindow","createPopup","noAllPaddings","disableScroll","draggable","restrict","borderRadius","eventKeys","opener","callController","callNotification","X","Y","sendPostponedEvents","answerVideo","onHasCameraHandler","emitToMainWindow","callerPrefix","avatarClass","avatarImageStyles","avatarImageText","backgroundSize","backgroundPosition","decode","windowBottom","buttonsBlock","toggleMicrophoneIcon","toggleCameraIcon","withBlur","closeWindow","ConferenceNotifications","_onContentButtonClickHandler","_onContentButtonClick","NotificationConferenceContent","backgroundRepeat","_onSkipConferenceButtonClick","_onAnswerConferenceButtonClick","setWindowPosition","STP_CENTER","STP_VCENTER","onBackToCallClick","onStopSharingClick","onChangeScreenClick","POPUP_WIDTH","POPUP_HEIGHT","POPUP_OFFSET_X","POPUP_OFFSET_Y","FloatingScreenShare","sharedWindowX","sharedWindowY","sharedWindowHeight","sharedWindowWidth","app","screens","screenToUse","_onBackToCallClickHandler","_onBackToCallClick","_onStopSharingClickHandler","_onStopSharingClick","_onChangeScreenClickHandler","_onChangeScreenClick","bindEventHandlers","ListScreenMedia","saveExistingScreens","getApiVersion","FloatingScreenShareContent","adjustWindow","dispatchEvent","blockOffset","popupPadding","leftBlockWidth","querySelector","centerBlockWidth","rightBlockWidth","fullWidth","Mode","STP_FRONT","convertedParams","mainWindow","BXWindows","windowItem","DispatchCustomEvent","CallHint","getElementNode","callFolded","showAngle","autoCloseDelay","customClassName","initiatorName","customRender","buttonsLayout","onAskSpeakButtonClicked","autoCloseTimeout","onAutoClose","contentPadding","renderPopupMessage","getPopupMessage","hotKeyMessage","hotkey","IsMac","onActionClick","PromoPopup","promoCode","dontShowAgain","subscribeToEvents","onCheckboxChange","PromoPopup3D","callView","openWindow","forceTop","forceLeft","btnText","openLearningPopup","Sidebar","contentContainer","RecordWithCopilotPopup","onClickYesButton","onClickNoButton","isString","yesButtonText","noButtonText","Dialogs","MessageBox","modal","popupOptions","WebScreenSharePopup","joinRoom","leaveRoom","listRooms","requestRoomSpeaker","joinRoomOffer","transferRoomHost","listRoomsResponse","roomUpdated","VoximplantCallEvent","connectionRestoreTime","VoximplantCall","voximplantCall","muteMicrophone","unmuteMicrophone","VoxImplant","StreamManager","hideLocalVideo","sendVideo","renderer","trackLabel","EndpointEvents","InfoUpdated","sendStat","transformVoxStats","updateRoom","initiator","speakerChanged","_currentRoomId","rooms","previousSpeaker","currentRoom","logUrl","__resolveListRooms","onMediaRenderEnabled","substring","onMediaRenderDisabled","onVoiceEnded","Voximplant","getClient","bindClientEvents","streamManager","MicAccessResult","Reconnecting","Reconnected","HardwareEvents","MediaRendererAdded","MediaRendererUpdated","BeforeMediaRendererRemoved","off","CameraManager","getInputDevices","setCallVideoSettings","constructCameraParams","AudioDeviceManager","setCallAudioSettings","inputId","impl","transceivers","VideoQuality","VIDEO_SIZE_HD","VIDEO_SIZE_nHD","facingMode","sendFloorRequest","sendEmotion","showLocalView","shareScreen","stopSharingScreen","voximplantClient","setDefaultVideoSettings","setDefaultAudioSettings","callConference","receiveVideo","customData","Disconnected","MessageReceived","CallStatsReceived","EndpointAdded","sendJoinRoom","sendRequestRoomSpeaker","sendLeaveRoom","sendListRooms","removeClientEvents","showLocalVideo","setEndpoint","removeEndpointEventHandlers","waitForConnectionRestore","connectionRestoreTimeout","readyStack","bindEndpointEventHandlers","RemoteMediaAdded","RemoteMediaRemoved","VoiceStart","VoiceEnd","Removed","MediaRenderEnabled","MediaRenderDisabled","onConnectionRestoreTimeout","outboundAudio","outboundVideo","inboundAudio","inboundVideo","endpoints","getEndpoints","outbound","statGroup","stat","inbound","actualHeight","actualWidth","StrategyType","AllowAll","AllowNone","OnlySpeaker","CurrentlyTalking","HOLD_VIDEO_SECONDS","VideoStrategy","strategyType","onCallUserVoiceStartedHandler","onCallUserVoiceStarted","onCallUserVoiceStoppedHandler","onCallUserVoiceStopped","onCallViewSetCentralUserHandler","onCallViewSetCentralUser","onCallViewLayoutChangeHandler","onCallViewLayoutChange","allowVideoFrom","bindEvents","applyVideoLimit","talkingUsers","User","onActiveChanged","onUserActiveChanged","setTalking","removeEvents","turnOffVideoTimeout","cancelTurnOffVideo","updateActive","scheduleTurnOffVideo","sharing","newActive","CopilotPopup","updateCopilotState","getButton","sendAnalytics","copilotButton","popupType","onAIRestrictionsPopupShow","ParticipantsPermissionPopup","roomSettings","allParticipantsDeviceControl","roomSettingsElements","screenshare","onPermissionChanged","onPermissionCollapseStateChanged","onOpen","isShowPopup","isShowRoomSettings","ParticipantsPermissionSwitcher","canControlPermission","settingsElements","renderSettingsElements","toggleRoomSettings","turnOffMicContainer","ParticipantsStreamControlButton","onTurnOffStreamForAll","participantsButton","onPopupShow","ParticipantsStreamControlButtonEvents","ParticipantsPermissionSwitcherEvents","onViewStateChanged","onOpenVideoConference","onPromoViewed","onCallJoined","onCallLeft","onCallDestroyed","ViewState","Opened","Closed","DocumentType","Resume","Blank","FeatureState","Enabled","Disabled","Limited","DOC_EDITOR_WIDTH","DOC_TEMPLATE_WIDTH","DOC_CREATED_EVENT","DOCUMENT_PROMO_CODE","DOCUMENT_PROMO_DELAY","FILE_TYPE_DOCX","FILE_TYPE_XLSX","FILE_TYPE_PPTX","BALLOON_OFFSET_CLASS_NAME","MASK_PROMO_CODE","MASK_PROMO_DELAY","CallController","needInit","incomingVideoStrategyType","formatRecordDate","messengerFacade","docEditor","docEditorIframe","maxEditorWidth","docCreatedForCurrentCall","folded","audioRingtone","SoundType","ringtoneModern","lastUsedCameraId","reconnectingCameraId","childCall","invitePopup","videoStrategy","isHttps","callWithLegacyMobile","featureScreenSharing","featureRecord","screenShareStartTime","callRecordState","callRecordType","callRecordInitiatorId","callRecordInfo","autoCloseCallView","promotedToAdminTimeoutValue","promotedToAdminTimeout","clickLinkInterceptor","_callViewState","answeredOrDeclinedCalls","_onCallUserInvitedHandler","_onCallUserInvited","_onCallUserJoinedHandler","_onCallUserJoined","_onCallDestroyHandler","_onCallDestroy","_onCallUserStateChangedHandler","_onCallUserStateChanged","_onCallUserMicrophoneStateHandler","_onCallUserMicrophoneState","_onCallUserCameraStateHandler","_onCallUserCameraState","_onNeedResetMediaDevicesStateHandler","_onNeedResetMediaDevicesState","_onCameraPublishingHandler","_onCameraPublishing","_onMicrophonePublishingdHandler","_onMicrophonePublishingd","_onCallUserVideoPausedHandler","_onCallUserVideoPaused","_onCallLocalMediaReceivedHandler","_onCallLocalMediaReceived","_onCallLocalMediaStoppedHandler","_onCallLocalMediaStopped","_onCallLocalScreenUpdatedHandler","_onCallLocalScreenUpdated","_onCallLocalCameraFlipHandler","_onCallLocalCameraFlip","_onCallLocalCameraFlipInDesktopHandler","_onCallLocalCameraFlipInDesktop","_onCallRemoteMediaReceivedHandler","_onCallRemoteMediaReceived","_onCallRemoteMediaStoppedHandler","_onCallRemoteMediaStopped","_onCallBadNetworkIndicatorHandler","_onCallBadNetworkIndicator","_onCallConnectionQualityChangedHandler","_onCallConnectionQualityChanged","_onCallToggleRemoteParticipantVideoHandler","_onCallToggleRemoteParticipantVideo","_onCallUserVoiceStartedHandler","_onCallUserVoiceStarted","_onCallUserVoiceStoppedHandler","_onCallUserVoiceStopped","_onAllParticipantsAudioMutedHandler","_onAllParticipantsAudioMuted","_onAllParticipantsVideoMutedHandler","_onAllParticipantsVideoMuted","_onAllParticipantsScreenshareHandler","_onAllParticipantsScreenshareMuted","_onYouMuteAllParticipantsHandler","_onYouMuteAllParticipants","_onRoomSettingsChangedHandler","_onRoomSettingsChanged","_onUserPermissionsChangedHandler","_onUserPermissionsChanged","_onUserRoleChangedHandler","_onUserRoleChanged","_onParticipantMutedHandler","_onParticipantMuted","_onUserStatsReceivedHandler","_onUserStatsReceived","_onTrackSubscriptionFailedHandler","_onTrackSubscriptionFailed","_onCallUserScreenStateHandler","_onCallUserScreenState","_onCallUserRecordStateHandler","_onCallUserRecordState","onCallUserFloorRequestHandler","_onCallUserFloorRequest","_onCallFailureHandler","_onCallFailure","_onNetworkProblemHandler","_onNetworkProblem","_onMicrophoneLevelHandler","_onMicrophoneLevel","_onReconnectingHandler","_onReconnecting","_onReconnectedHandler","_onReconnected","_onReconnectingFailedHandler","_onReconnectingFailed","_onCustomMessageHandler","_onCustomMessage","_onJoinRoomOfferHandler","_onJoinRoomOffer","_onJoinRoomHandler","_onJoinRoom","_onLeaveRoomHandler","_onLeaveRoom","_onTransferRoomSpeakerHandler","_onTransferRoomSpeaker","_onCallLeaveHandler","_onCallLeave","_onCallJoinHandler","_onCallJoin","_onGetUserMediaEndedHandler","_onGetUserMediaEnded","_onUpdateLastUsedCameraIdHandler","_onUpdateLastUsedCameraId","_onSwitchTrackRecordStatusHandler","_onSwitchTrackRecordStatus","_onRecorderStatusChangedHandler","_onRecorderStatusChanged","_onBeforeUnloadHandler","_onBeforeUnload","_onImTabChangeHandler","_onImTabChange","_onUpdateChatCounterHandler","_onUpdateChatCounter","_onChildCallFirstMediaHandler","_onChildCallFirstUserJoinedHandler","_onWindowFocusHandler","_onWindowFocus","_onWindowBlurHandler","_onWindowBlur","_onDocumentBodyClickHandler","_onDocumentBodyClick","floatingWindow","FloatingVideo","onMainAreaClick","_onFloatingVideoMainAreaClick","_onFloatingVideoButtonClick","floatingWindowUser","showFloatingWindowTimeout","hideIncomingCallTimeout","ignoreDeclinedCallsTimeout","ignoreIncomingNotificationTimeouts","floatingScreenShareWindow","isThemeDark","_onFloatingScreenShareBackToCallClick","_onFloatingScreenShareStopClick","_onFloatingScreenShareChangeScreenClick","showFloatingScreenShareWindowTimeout","mutePopup","riseYouHandToTalkPopup","allowMutePopup","webScreenSharePopup","feedbackPopup","loopTimers","lastCalledChangeSettingsUserName","isFileChooserActive","pictureInPictureDebounceForOpen","isCallHangupButtonPressed","callMultiBroadcastClient","onIncomingCall","_onDeviceChange","_onWindowDesktopFocus","_onWindowDesktopBlur","setSharingData","voxMicAccessResult","garbage","executer","currentCallUuid","currentCall","hasView","hasActiveCall","SetActiveTab","currentProvider","AnalyticsType","group","includeSelf","setTitle","getActiveCallUsers","setAvatars","setMicrophoneId","setCameraId","newCall","isCurrentCallActive","newCallId","_getCallIdentifier","currentCallId","BXShowedIncomingCallNotification","checkDesktop","prepareIncomingCall","removeVideoStrategy","showNotification","isScreenSharingStarted","removeScreenUsers","isLegacyCall","updateCallViewUsers","updateCopilotFeatureState","updateDeviceIdInChildCall","answerChildCall","advanced","newCallType","onJoinCall","videoconf","AnalyticsStatus","v2","Lib","CallManager","getCurrentUser","updateFloatingWindowContent","isConferencePageOpened","showIncomingConference","showIncomingCall","_onAllParticipantsScreenshareMutedHandler","_onCallViewShow","_onCallViewClose","_onCallViewDestroy","_onCallViewButtonClick","_onCallViewBodyClick","_onCallViewReplaceCamera","_onCallViewReplaceMicrophone","_onCallViewSetCentralUser","_onCallViewChangeHdVideo","_onCallViewChangeMicAutoParams","_onCallViewChangeFaceImprove","_onCallViewOpenAdvancedSettings","_onCallViewReplaceSpeaker","_onCallViewHasMainStream","_onCallViewTurnOffParticipantMic","_onCallViewTurnOffParticipantCam","_onCallViewTurnOffParticipantScreenshare","_onCallViewAllowSpeakPermission","_onCallViewDisallowSpeakPermission","_onCallToggleSubscribe","_onCallUserClick","_onPipClose","convertAllItemsToInt","arr","userListInt","userDataInt","notIncludedEl","setType","externalContainer","viewContainerClass","getExternalContainer","insertBefore","firstChild","ZIndexManager","getOrAddStack","register","getStack","unregister","updateCameraSettingsInCurrentCallAfterReconnecting","devicesList","setReconnectingCameraId","Reflection","getClass","desktop","DesktopManager","checkStatusInDifferentContext","desktopUtils","runningCheck","tagPresent","LocalStorage","getSiteId","getConferencePageTag","allowVideo","chatType","avatarColor","getMaxActiveMicrophonesCount","getDefaultZIndex","_onCallNotificationClose","_onCallNotificationDestroy","_onCallNotificationButtonClick","scheduleCancelNotification","repeatSound","_onCallConferenceNotificationButtonClick","isIncomingConference","getCallType","noAnswer","notificationText","actions","Notification","Center","notify","autoHideDelay","closeButton","balloon","messageBox","MessageBoxButtons","OK_CANCEL","okCaption","cancelCaption","onOk","DesktopDownload","getLinkForCurrentUser","isRTCsupported","needBlockAddButton","showUserSelector","callData","preparedCall","isUserAgentSupported","showUnsupportedNotification","unfold","initCallPromise","onConnectToCallClick","getCallWithDialogId","joinCall","callTokenPromise","getToken","isCallPrepared","debug1","openMessenger","_prepareLocalStream","createContainer","getBlockedButtons","bindCallViewEvents","_setLocalStream","onCallViewRenderToMediaReceived","callEngine","debug2","currentCallIsNew","leaveCurrentCall","_onUpdateCallCopilotState","sendStartCopilotRecordAnalytics","isAutostart","useHdVideo","getCurrentDialogId","createVideoStrategy","getCallUsers","showCopilotNotify","showDocumentPromo","showMaskPromo","onStartCall","success","section","AnalyticsSection","chatWindow","AnalyticsElement","videocall","showAutoMicMuteNotification","onStartCallError","errorMessage","_stopLocalStream","defaultProvider","chatList","joinButton","onJoinCallError","isRecording","onRecordStop","subSection","AnalyticsSubSection","contextMenu","finishForAllButton","disconnectButton","recordTime","releaseLocalMedia","hasStreamFromCall","canRecord","isForceUse","newDeviceId","microphoneIds","deviceGroup","cameraIds","speakerIds","detached","fold","isFolded","isScreenSharing","isForceOpen","isForceClose","shouldOpenPiP","canStayOpen","isActiveStatePictureInPictureCallWindow","isActivePiPFromController","foldedCallTitle","setSize","callViewState","sidebar","toggleHidden","closePromo","togglePictureInPictureCallWindow","containerWidth","editorWidth","callWidth","documentsMenu","onDocumentBtnClick","targetNodeWidth","resumesArticleCode","documentsArticleCode","onDocumentCreateAnalyticsEvent","resume","maybeShowDocumentEditor","doc","typeFile","sheet","presentation","onSubMenuShow","buildPreviousResumesSubmenu","newStyleOptions","PopupMenuWindow","subMenuOptions","display","documentType","onDocumentCreate","menuItem","resumeList","resumes","getSubMenu","addMenuItem","object","createDate","onLastResumeOpen","viewDocumentByLink","links","view","removeMenuItem","adjustSubMenu","showDocumentEditor","openAnimation","showPromoPopupTimeout","_createAndOpenSidebarWithIframe","loadExt","Disk","OnlyOfficeImIntegration","CreateDocument","dialog","delegate","setCallEditorMaxWidth","onDocumentCreated","_onDocumentCreated","promiseGetUrl","getIframeUrlForTemplates","getIframeUrlForCreate","getIframeUrl","viewerItem","closeDocumentEditor","alert","onDocumentClose","getDocumentType","onCloseIframe","removeMaxWidth","oldSidebar","removeContainer","clearPictureInPictureDebounceForOpen","setWindowFocusState","findCallEditorWidth","onSideBarCloseClicked","loader","Loader","frameborder","border","margin","onDocumentUpload","onCancel","getData","documentPromoPopup","fromPiP","bringToFront","exitFullScreen","enterFullScreen","requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen","exitFullscreen","mozCancelFullScreen","webkitExitFullscreen","msExitFullscreen","cancelFullScreen","isPromoRequired","documentButton","onDocumentPromoActionClicked","onDocumentPromoClosed","maskPromoPopup","showPromoPopup3dTimeout","stopRepeatSound","callParams","onAnswerButtonClick","callPopup","answerButton","currentCallPromise","activateWindow","_ensureDocumentEditorClosed","blockAddUser","onAnswerConference","onDeclineConference","setButtonCounter","getMessageCount","findWindow","mediaDevicesResetStateHintBaloon","_closeReconnectionBaloon","_closeParticipantsVideoBaloon","copilotPopup","backdropFilter","_onCallViewHangupButtonClick","_onCallViewHangupOptionsButtonClick","_onCallViewCloseButtonClick","toggleUsers","_onCallViewUsersListButtonClick","inviteUser","_onCallViewInviteUserButtonClick","toggleMute","_onCallViewToggleMuteButtonClick","toggleScreenSharing","_onCallViewToggleScreenSharingButtonClick","_onCallViewRecordButtonClick","toggleVideo","_onCallViewToggleVideoButtonClick","toggleSpeaker","_onCallViewToggleSpeakerButtonClick","showChat","_onCallViewShowChatButtonClick","_onCallViewFloorRequestButtonClick","showHistory","_onCallViewShowHistoryButtonClick","_onCallViewFullScreenButtonClick","_onCallViewDocumentButtonClick","microphoneSideIcon","_onCallViewMicrophoneSideIconClick","_onCallViewFeedbackButtonClick","_onCallViewCopilotButtonClick","onDisconnectCall","finishButton","hangupOptionsMenu","onFinishCall","finishedForAll","callUsersCount","getMaxActiveCallUsers","callLength","onShowChat","onFloorRequest","floorState","getUserFloorRequestState","talkingState","getUserTalking","callViewFloorRequestTimeout","reconnectionBaloon","participantsPermissionPopup","_onCallViewTurnOffAllParticipansStreamButtonClick","onTurnOffAllParticipansStream","onCallSettingsChanged","_afterCloseParticipantsPermissionPopup","_afterOpenParticipantsPermissionPopup","onOpenCallSettings","idleUsers","_getDisconnectedUsers","allowNewUsers","_onInvitePopupDestroy","_onInvitePopupSelect","inviteCloser","hasMicrophone","setIsMicrophoneMuted","setAudioMuted","showRiseYouHandToTalkNotification","CallRecordMute","onToggleMicrophone","_onCallViewToggleMuteHandler","onRecordBtnClick","openHelpArticle","_startRecordCall","callRecordMenu","setIsRecordWhenCopilotActivePopupAlreadyShow","getMenuWindow","recordWhenCopilotActivePopup","CallRecordPause","onClickAIOff","deleteCopilotRecordPopup","onSelectAIOff","_onChangeStateCopilotAction","onSelectAIDelete","newCopilotState","onAIRecordStatusChanged","isAIOn","showCopilotResultNotify","errors","handleCopilotError","showCopilotErrorNotify","isPlainCall","_onChangeStateCopilot","isCopilotInitialized","chatUserCount","onAIRecordStart","onScreenShareBtnClick","CallRecordStopSharing","startScreenSharing","setIsCameraOn","onToggleCamera","_onCallViewToggleVideoButtonClickHandler","toggleRoomMenu","toggleRoomListMenu","Feedback","Form","forms","zones","sec","lang","presets","sender_page","call_type","call_amount","id_of_user","from_domain","origin","openHistory","toggleFullScreen","showDocumentsMenu","onTurnOffParticipantStream","onAllowPermissionToSpeakResponse","onDisallowPermissionToSpeakResponse","allowMicAutoParams","setCameraSmoothingStatus","openSettings","onlyPanel","callDetails","setUserConnectionQuality","newQuality","loopConnectionQuality","setUserState","blockSwitchCamera","blockScreenSharing","disableMediaSelection","clearConnectionQualityTimer","unblockButtonsList","isNeedUnblockCameraButton","isGetUserMediaFulfilled","unblockAddUser","setRecordState","showNetworkProblemNotification","isBitrixCall","notyText","setUserMicrophoneState","setUserCameraState","unblockSwitchCamera","blockSwitchMicrophone","unblockSwitchMicrophone","_onBlockCameraButton","_onUnblockCameraButton","_onBlockMicrophoneButton","_onUnblockMicrophoneButton","setUserVideoPaused","setLocalStreamVideoTrack","setLocalStream","onScreenShareStarted","showWebScreenSharePopup","onScreenShareStopped","screenShareLength","setUserMedia","isLegacyPlainCall","isLegacyBitrixCall","fallback","setBadNetworkIndicator","toogleParticipantsVideoBaloon","isMutedPopupAllowed","showMicMutedNotification","setUserTalking","createCallControlNotify","isAllow","contentIcon","contentPhrase","initiatorUserModel","targetUserModel","initiatorGender","initiator_name","target_name","typesOfMute","typesOfMuteMessage","_onBlockUnblockCamMicButtons","updateFloorRequestNotification","setAllUserPermissionToSpeakState","updateStatePermissions","balloons","baloonId","offsetClassNameSetted","_p","balloonClassName","category","getActions","getContainer","getContent","isCloseButtonVisible","getCloseButton","setUserStats","setTrackSubscriptionFailed","windowId","RecordSource","dialogName","callDate","format","Main","fileName","onRecordStart","CallRecordStart","cropTop","cropBottom","shareMethod","recordButton","CallRecordStop","isUnknownError","showSelfTest","showSecurityKeyError","showFatalError","setMicrophoneLevel","onReconnect","onReconnectError","showRoomJoinedPopup","setRoomState","showMicTakenFromPopup","showMicTakenByPopup","getClickLinkInterceptor","startIntercepting","lastUserLeft","stopIntercepting","onInviteUser","currentUsers","totalUsers","onInviteSuccess","onInviteFailure","createChildCallPromise","matches","onInputFileOpenedStateUpdate","updateWindowFocusState","returnValue","currentTab","allAddedDevice","allRemovedDevice","getRemovedUsedDevices","useDevicesInCurrentCall","removeDevicesFromCurrentCall","changeTab","videoOptions","audioOptions","lastUserId","_onTestCallViewButtonClick","stream2","vad","s2","handRaiseContentElement","buttonPlaceholder","getElementsByClassName","replaceWith","createAskSpeakButton","createUnmuteButton","onClickUser","roomMenu","roomSpeaker","speakerModel","avatarText","delimiter","leaveCurrentRoom","showRoomHelp","roomListMenu","roomList","prepareRoomListMenuItems","room","getRoomDescription","roomFields","userNames","isAuto","isSpeaker","userIdList","roomJoinedPopup","usersInRoom","LINK","micTakenFromPopup","byUserId","micTakenByPopup","lastCallDetails","vueInstance","titleBar","$destroy","Vue","createApp","methods","onFeedbackSent","getContentContainer","handleClick","closest","getAttribute","defaultPrevented","previousRecordType","oldCall","privateToGroup","isConference"],"mappings":"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"}