{"version":3,"file":"share-popup.bundle.js","sources":["../src/share-popup.js"],"sourcesContent":["import {Cache, Reflection, Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {FeaturesPopup} from 'landing.features-popup';\nimport {Loc} from 'landing.loc';\nimport {PageObject} from 'landing.pageobject';\nimport {Env} from 'landing.env';\nimport {Embed} from 'crm.form.embed';\nimport 'ui.feedback.form';\nimport {PhoneVerify} from 'bitrix24.phoneverify';\n\nimport './css/style.css';\n\nconst PHONE_VERIFY_FORM_ENTITY = 'crm_webform';\n\n/**\n * @memberOf BX.Landing.Form\n */\nexport class SharePopup extends EventEmitter\n{\n\t#cache = new Cache.MemoryCache();\n\n\tconstructor(options = {})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Landing.Form.SharePopup');\n\t\tthis.subscribeFromOptions(options.events);\n\t\tthis.setOptions(options);\n\t}\n\n\tsetOptions(options)\n\t{\n\t\tthis.#cache.set('options', {...options});\n\t}\n\n\tgetOptions(): {[key: string]: any}\n\t{\n\t\treturn this.#cache.get('options', {});\n\t}\n\n\t#getFeaturesPopup(): FeaturesPopup\n\t{\n\t\treturn this.#cache.remember('featuresPopup', () => {\n\t\t\treturn new FeaturesPopup({\n\t\t\t\tbindElement: this.getOptions().bindElement,\n\t\t\t\titems: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'share',\n\t\t\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SHARE__SHARE_TITLE'),\n\t\t\t\t\t\ttheme: FeaturesPopup.Themes.Highlight,\n\t\t\t\t\t\ticon: {\n\t\t\t\t\t\t\tclassName: 'landing-form-features-share-icon',\n\t\t\t\t\t\t},\n\t\t\t\t\t\tlink: {\n\t\t\t\t\t\t\tlabel: Loc.getMessage('LANDING_FORM_SHARE__SHARE_LINK_LABEL'),\n\t\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\t\tif (!Type.isNil(BX.Helper))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tBX.Helper.show('redirect=detail&code=13003062');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\tactionButton: {\n\t\t\t\t\t\t\tlabel: Loc.getMessage('LANDING_FORM_SHARE__SHARE_ACTION_LABEL'),\n\t\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\t\tconst editorWindow = PageObject.getEditorWindow();\n\t\t\t\t\t\t\t\tconst {formEditorData} = editorWindow.BX.Landing.Env.getInstance().getOptions();\n\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\tType.isPlainObject(formEditorData)\n\t\t\t\t\t\t\t\t\t&& Type.isPlainObject(formEditorData.formOptions)\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tif (this.getOptions()?.phoneVerified)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tEmbed.openSlider(formEditorData.formOptions.id);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tthis.#showPhoneVerifySlider(formEditorData.formOptions.id).then((verified) => {\n\t\t\t\t\t\t\t\t\t\t\tif (verified)\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tEmbed.openSlider(formEditorData.formOptions.id);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'communication',\n\t\t\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SHARE__COMMUNICATION_TITLE'),\n\t\t\t\t\t\ticon: {\n\t\t\t\t\t\t\tclassName: 'landing-form-features-communication-icon',\n\t\t\t\t\t\t},\n\t\t\t\t\t\tlink: {\n\t\t\t\t\t\t\tlabel: Loc.getMessage('LANDING_FORM_SHARE__COMMUNICATION_LINK_LABEL'),\n\t\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\t\tif (!Type.isNil(BX.Helper))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tBX.Helper.show('redirect=detail&code=6986667');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\tactionButton: {\n\t\t\t\t\t\t\tlabel: Loc.getMessage('LANDING_FORM_SHARE__COMMUNICATION_ACTION_LABEL'),\n\t\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\t\tconst {landingParams} = PageObject.getRootWindow();\n\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t!Type.isNil(landingParams)\n\t\t\t\t\t\t\t\t\t&& Type.isStringFilled(landingParams.PAGE_URL_LANDING_SETTINGS)\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tconst SidePanel: BX.SidePanel = Reflection.getClass('BX.SidePanel');\n\t\t\t\t\t\t\t\t\tif (!Type.isNil(SidePanel))\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tSidePanel.Instance.open(\n\t\t\t\t\t\t\t\t\t\t\t`${landingParams['PAGE_URL_LANDING_SETTINGS']}#b24widget`,\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t[\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'help',\n\t\t\t\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SHARE__HELP_TITLE_MSGVER_1'),\n\t\t\t\t\t\t\ticon: {\n\t\t\t\t\t\t\t\tclassName: 'landing-form-features-help-icon',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tlink: {\n\t\t\t\t\t\t\t\tlabel: Loc.getMessage('LANDING_FORM_SHARE__HELP_LINK_LABEL_MSGVER_1'),\n\t\t\t\t\t\t\t\tonClick: () => {},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\t\tBX.UI.Feedback.Form.open({\n\t\t\t\t\t\t\t\t\tid: 'form-editor-feedback-form',\n\t\t\t\t\t\t\t\t\tportalUri: this.getOptions().portalUri,\n\t\t\t\t\t\t\t\t\tforms: this.getOptions().forms,\n\t\t\t\t\t\t\t\t\tpresets: {\n\t\t\t\t\t\t\t\t\t\tsource: 'landing',\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'settings',\n\t\t\t\t\t\t\ticon: {\n\t\t\t\t\t\t\t\tclassName: 'landing-form-features-settings-icon',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\t\tconst {landingParams} = PageObject.getRootWindow();\n\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t!Type.isNil(landingParams)\n\t\t\t\t\t\t\t\t\t&& Type.isStringFilled(landingParams.PAGE_URL_LANDING_SETTINGS)\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tconst SidePanel: BX.SidePanel = Reflection.getClass('BX.SidePanel');\n\t\t\t\t\t\t\t\t\tif (!Type.isNil(SidePanel))\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tSidePanel.Instance.open(landingParams['PAGE_URL_LANDING_SETTINGS']);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t],\n\t\t\t});\n\t\t});\n\t}\n\n\tshow()\n\t{\n\t\tthis.#getFeaturesPopup().show();\n\t}\n\n\thide()\n\t{\n\t\tthis.#getFeaturesPopup().hide();\n\t}\n\n\t#showPhoneVerifySlider(formId: number): Promise\n\t{\n\t\tif (typeof PhoneVerify !== 'undefined')\n\t\t{\n\t\t\treturn PhoneVerify.getInstance()\n\t\t\t\t.setEntityType(PHONE_VERIFY_FORM_ENTITY)\n\t\t\t\t.setEntityId(formId)\n\t\t\t\t.startVerify({\n\t\t\t\t\tsliderTitle: Loc.getMessage('LANDING_FORM_PHONE_VERIFY_CUSTOM_SLIDER_TITLE'),\n\t\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_PHONE_VERIFY_CUSTOM_TITLE'),\n\t\t\t\t\tdescription: Loc.getMessage('LANDING_FORM_PHONE_VERIFY_CUSTOM_DESCRIPTION'),\n\t\t\t\t});\n\t\t}\n\t\treturn Promise.resolve(true);\n\t}\n}\n"],"names":["PHONE_VERIFY_FORM_ENTITY","SharePopup","EventEmitter","constructor","options","Cache","MemoryCache","setEventNamespace","subscribeFromOptions","events","setOptions","set","getOptions","get","show","hide","remember","FeaturesPopup","bindElement","items","id","title","Loc","getMessage","theme","Themes","Highlight","icon","className","link","label","onClick","Type","isNil","BX","Helper","actionButton","editorWindow","PageObject","getEditorWindow","formEditorData","Landing","Env","getInstance","isPlainObject","formOptions","phoneVerified","Embed","openSlider","then","verified","landingParams","getRootWindow","isStringFilled","PAGE_URL_LANDING_SETTINGS","SidePanel","Reflection","getClass","Instance","open","UI","Feedback","Form","portalUri","forms","presets","source","formId","PhoneVerify","setEntityType","setEntityId","startVerify","sliderTitle","description","Promise","resolve"],"mappings":";;;;;;CAYA,MAAMA,wBAAwB,GAAG,aAAa;;CAE9C;CACA;CACA;CAFA;CAAA;CAAA;AAGA,CAAO,MAAMC,UAAU,SAASC,6BAAY,CAC5C;GAGCC,WAAW,CAACC,OAAO,GAAG,EAAE,EACxB;KACC,KAAK,EAAE;KAAC;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA,OAJA,IAAIC,eAAK,CAACC,WAAW;;KAK7B,IAAI,CAACC,iBAAiB,CAAC,4BAA4B,CAAC;KACpD,IAAI,CAACC,oBAAoB,CAACJ,OAAO,CAACK,MAAM,CAAC;KACzC,IAAI,CAACC,UAAU,CAACN,OAAO,CAAC;;GAGzBM,UAAU,CAACN,OAAO,EAClB;KACC,4CAAI,kBAAQO,GAAG,CAAC,SAAS,EAAE;OAAC,GAAGP;MAAQ,CAAC;;GAGzCQ,UAAU,GACV;KACC,OAAO,4CAAI,kBAAQC,GAAG,CAAC,SAAS,EAAE,EAAE,CAAC;;GAuItCC,IAAI,GACJ;KACC,4CAAI,0CAAqBA,IAAI,EAAE;;GAGhCC,IAAI,GACJ;KACC,4CAAI,0CAAqBA,IAAI,EAAE;;CAkBjC;CAAC,8BA5JA;GACC,OAAO,4CAAI,kBAAQC,QAAQ,CAAC,eAAe,EAAE,MAAM;KAClD,OAAO,IAAIC,mCAAa,CAAC;OACxBC,WAAW,EAAE,IAAI,CAACN,UAAU,EAAE,CAACM,WAAW;OAC1CC,KAAK,EAAE,CACN;SACCC,EAAE,EAAE,OAAO;SACXC,KAAK,EAAEC,eAAG,CAACC,UAAU,CAAC,iCAAiC,CAAC;SACxDC,KAAK,EAAEP,mCAAa,CAACQ,MAAM,CAACC,SAAS;SACrCC,IAAI,EAAE;WACLC,SAAS,EAAE;UACX;SACDC,IAAI,EAAE;WACLC,KAAK,EAAER,eAAG,CAACC,UAAU,CAAC,sCAAsC,CAAC;WAC7DQ,OAAO,EAAE,MAAM;aACd,IAAI,CAACC,cAAI,CAACC,KAAK,CAACC,EAAE,CAACC,MAAM,CAAC,EAC1B;eACCD,EAAE,CAACC,MAAM,CAACrB,IAAI,CAAC,+BAA+B,CAAC;;;UAGjD;SACDsB,YAAY,EAAE;WACbN,KAAK,EAAER,eAAG,CAACC,UAAU,CAAC,wCAAwC,CAAC;WAC/DQ,OAAO,EAAE,MAAM;aACd,MAAMM,YAAY,GAAGC,6BAAU,CAACC,eAAe,EAAE;aACjD,MAAM;eAACC;cAAe,GAAGH,YAAY,CAACH,EAAE,CAACO,OAAO,CAACC,GAAG,CAACC,WAAW,EAAE,CAAC/B,UAAU,EAAE;aAC/E,IACCoB,cAAI,CAACY,aAAa,CAACJ,cAAc,CAAC,IAC/BR,cAAI,CAACY,aAAa,CAACJ,cAAc,CAACK,WAAW,CAAC,EAElD;eAAA;eACC,wBAAI,IAAI,CAACjC,UAAU,EAAE,aAAjB,iBAAmBkC,aAAa,EACpC;iBACCC,oBAAK,CAACC,UAAU,CAACR,cAAc,CAACK,WAAW,CAACzB,EAAE,CAAC;gBAC/C,MAED;iBACC,4CAAI,kDAAwBoB,cAAc,CAACK,WAAW,CAACzB,EAAE,EAAE6B,IAAI,CAAEC,QAAQ,IAAK;mBAC7E,IAAIA,QAAQ,EACZ;qBACCH,oBAAK,CAACC,UAAU,CAACR,cAAc,CAACK,WAAW,CAACzB,EAAE,CAAC;;kBAEhD,CAAC;;;;;QAKN,EACD;SACCA,EAAE,EAAE,eAAe;SACnBC,KAAK,EAAEC,eAAG,CAACC,UAAU,CAAC,yCAAyC,CAAC;SAChEI,IAAI,EAAE;WACLC,SAAS,EAAE;UACX;SACDC,IAAI,EAAE;WACLC,KAAK,EAAER,eAAG,CAACC,UAAU,CAAC,8CAA8C,CAAC;WACrEQ,OAAO,EAAE,MAAM;aACd,IAAI,CAACC,cAAI,CAACC,KAAK,CAACC,EAAE,CAACC,MAAM,CAAC,EAC1B;eACCD,EAAE,CAACC,MAAM,CAACrB,IAAI,CAAC,8BAA8B,CAAC;;;UAGhD;SACDsB,YAAY,EAAE;WACbN,KAAK,EAAER,eAAG,CAACC,UAAU,CAAC,gDAAgD,CAAC;WACvEQ,OAAO,EAAE,MAAM;aACd,MAAM;eAACoB;cAAc,GAAGb,6BAAU,CAACc,aAAa,EAAE;aAClD,IACC,CAACpB,cAAI,CAACC,KAAK,CAACkB,aAAa,CAAC,IACvBnB,cAAI,CAACqB,cAAc,CAACF,aAAa,CAACG,yBAAyB,CAAC,EAEhE;eACC,MAAMC,SAAuB,GAAGC,oBAAU,CAACC,QAAQ,CAAC,cAAc,CAAC;eACnE,IAAI,CAACzB,cAAI,CAACC,KAAK,CAACsB,SAAS,CAAC,EAC1B;iBACCA,SAAS,CAACG,QAAQ,CAACC,IAAI,CACrB,GAAER,aAAa,CAAC,2BAA2B,CAAE,YAAW,CACzD;;;;;QAKL,EACD,CACC;SACC/B,EAAE,EAAE,MAAM;SACVC,KAAK,EAAEC,eAAG,CAACC,UAAU,CAAC,yCAAyC,CAAC;SAChEI,IAAI,EAAE;WACLC,SAAS,EAAE;UACX;SACDC,IAAI,EAAE;WACLC,KAAK,EAAER,eAAG,CAACC,UAAU,CAAC,8CAA8C,CAAC;WACrEQ,OAAO,EAAE,MAAM;UACf;SACDA,OAAO,EAAE,MAAM;WACdG,EAAE,CAAC0B,EAAE,CAACC,QAAQ,CAACC,IAAI,CAACH,IAAI,CAAC;aACxBvC,EAAE,EAAE,2BAA2B;aAC/B2C,SAAS,EAAE,IAAI,CAACnD,UAAU,EAAE,CAACmD,SAAS;aACtCC,KAAK,EAAE,IAAI,CAACpD,UAAU,EAAE,CAACoD,KAAK;aAC9BC,OAAO,EAAE;eACRC,MAAM,EAAE;;YAET,CAAC;;QAEH,EACD;SACC9C,EAAE,EAAE,UAAU;SACdO,IAAI,EAAE;WACLC,SAAS,EAAE;UACX;SACDG,OAAO,EAAE,MAAM;WACd,MAAM;aAACoB;YAAc,GAAGb,6BAAU,CAACc,aAAa,EAAE;WAClD,IACC,CAACpB,cAAI,CAACC,KAAK,CAACkB,aAAa,CAAC,IACvBnB,cAAI,CAACqB,cAAc,CAACF,aAAa,CAACG,yBAAyB,CAAC,EAEhE;aACC,MAAMC,SAAuB,GAAGC,oBAAU,CAACC,QAAQ,CAAC,cAAc,CAAC;aACnE,IAAI,CAACzB,cAAI,CAACC,KAAK,CAACsB,SAAS,CAAC,EAC1B;eACCA,SAAS,CAACG,QAAQ,CAACC,IAAI,CAACR,aAAa,CAAC,2BAA2B,CAAC,CAAC;;;;QAItE,CACD;MAEF,CAAC;IACF,CAAC;CACH;CAAC,iCAYsBgB,MAAc,EACrC;GACC,IAAI,OAAOC,gCAAW,KAAK,WAAW,EACtC;KACC,OAAOA,gCAAW,CAACzB,WAAW,EAAE,CAC9B0B,aAAa,CAACrE,wBAAwB,CAAC,CACvCsE,WAAW,CAACH,MAAM,CAAC,CACnBI,WAAW,CAAC;OACZC,WAAW,EAAElD,eAAG,CAACC,UAAU,CAAC,+CAA+C,CAAC;OAC5EF,KAAK,EAAEC,eAAG,CAACC,UAAU,CAAC,wCAAwC,CAAC;OAC/DkD,WAAW,EAAEnD,eAAG,CAACC,UAAU,CAAC,8CAA8C;MAC1E,CAAC;;GAEJ,OAAOmD,OAAO,CAACC,OAAO,CAAC,IAAI,CAAC;CAC7B;;;;;;;;"}