this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};this.BX.Tasks.V2=this.BX.Tasks.V2||{};(function(t,e,s,a){"use strict";var r;const n=e.Extension.getSettings("tasks.v2.lib.calendar").calendarSettings;const o=new Set(n.HOLIDAYS.map((({M:t,D:e})=>`${t}.${e}`)));const i=new Set(n.WEEKEND.map((t=>({SU:0,MO:1,TU:2,WE:3,TH:4,FR:5,SA:6}[t]))));const{H:l,M:c}=n.HOURS.START;const{H:u,M:T}=n.HOURS.END;const h=s.DurationFormat.getUnitDurations().d;const D=(u*60+T-(l*60+c))*6e4;const g=D*(7-i.size);const H=new(r=babelHelpers.classPrivateFieldLooseKey("calculateRangeTs"),class{constructor(){Object.defineProperty(this,r,{value:m})}get workdayDuration(){return D}get workdayStart(){return n.HOURS.START}get defaultTime(){return`${String(u).padStart(2,"0")}:${String(T).padStart(2,"0")}`}formatDateTime(t,{forceYear:r}={}){if(!t){return""}const n=r||new Date(t).getFullYear()!==(new Date).getFullYear();const o=e.Loc.getMessage("TASKS_V2_DATE_TIME_FORMAT",{"#DATE#":s.DateTimeFormat.getFormat(n?"LONG_DATE_FORMAT":"DAY_MONTH_FORMAT"),"#TIME#":s.DateTimeFormat.getFormat("SHORT_TIME_FORMAT")});const i=a.timezone.getOffset(t);return s.DateTimeFormat.format(o,(t+i)/1e3)}calculateDuration(t,e){const s=this.setHours(t,u,T);if(e<s){return e-t}let a=this.setHours(t+h,l,c);let r=s-t;while(a<e){if(this.isWorkDay(a)){r+=Math.min(a+D,e)-a}a+=h}return r}calculateStartTs(t,e,s){return t!=null?t:babelHelpers.classPrivateFieldLooseBase(this,r)[r](e,s,true)}calculateEndTs(t,e,s){if(!t){return e}let o=s;let u=t;const T=(1+7-new Date(u-a.timezone.getOffset(u)).getDay())%7;const H=this.setHours(u+h*T,l,c);const m=this.calculateDuration(u,H);if(o<=m){return babelHelpers.classPrivateFieldLooseBase(this,r)[r](u,o)}o-=m;u=H;const M=new Date(u).setHours(0,0,0);const S=Math.max(Math.floor(o/g)-1,0);o-=g*S;u=this.setHours(u+h*S*7,l,c);const f=new Date(u).setHours(0,0,0)-h;const F=new Date(M).getFullYear();const O=new Date(f).getFullYear();const w=Array.from({length:O-F+1},((t,e)=>e+F)).flatMap((t=>n.HOLIDAYS.map((({M:e,D:s})=>new Date(t,e-1,s).getTime())))).filter((t=>M<=t&&t<=f&&!i.has(new Date(t).getDay())));if(w.length>0){return this.calculateEndTs(u,e,o+D*w.length)}return babelHelpers.classPrivateFieldLooseBase(this,r)[r](u,o)}clampWorkDateTime(t){if(!t){return null}let e=t;while(!this.isWorkDay(e)){e=this.setHours(e+h,l,c)}const s=this.setHours(e,l,c);const a=this.setHours(e,u,T);return Math.min(Math.max(e,s),a)}isWorkDay(t){const e=new Date(t);return!i.has(e.getUTCDay())&&!o.has(`${e.getUTCMonth()+1}.${e.getUTCDate()}`)}setHours(t,e,s){return new Date(t).setHours(e,s,0,0)-a.timezone.getOffset(t)}createDateFromUtc(t){return new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes())}});function m(t,e,s){const a=s?-1:1;const r=s?n.HOURS.END:n.HOURS.START;const o=s?n.HOURS.START:n.HOURS.END;let i=t;let l=e;while(l>0){if(this.isWorkDay(i)){const t=Math.abs(i-this.setHours(i,o.H,o.M));const e=i+Math.min(t,l,D)*a;l-=Math.abs(i-e);if(l===0){return e}}i=this.setHours(i+h*a,r.H,r.M)}return t}t.calendar=H})(this.BX.Tasks.V2.Lib=this.BX.Tasks.V2.Lib||{},BX,BX.Main,BX.Tasks.V2.Lib);
//# sourceMappingURL=calendar.bundle.map.js