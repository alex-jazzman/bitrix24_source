{"version":3,"file":"date-plan.bundle.js","sources":["../src/components/date-plan-date.js","../src/components/date-plan-content.js","../src/date-plan-meta.js","../src/date-plan.js","../src/date-plan-chip.js","../src/components/date-plan-switcher.js","../src/date-plan-sheet.js"],"sourcesContent":["import { HoverPill } from 'tasks.v2.component.elements.hover-pill';\nimport { calendar } from 'tasks.v2.lib.calendar';\n\nexport const DatePlanDate = {\n\tcomponents: {\n\t\tHoverPill,\n\t},\n\tprops: {\n\t\tdateTs: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\treadonly: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tcomputed: {\n\t\tdateFormatted(): string\n\t\t{\n\t\t\treturn calendar.formatDateTime(this.dateTs, { forceYear: true });\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"tasks-field-date-plan-date-container\">\n\t\t\t<HoverPill :readonly=\"readonly\">\n\t\t\t\t<div class=\"tasks-field-date-plan-date\">{{ dateFormatted }}</div>\n\t\t\t</HoverPill>\n\t\t</div>\n\t`,\n};\n","import { hint, type HintParams } from 'ui.vue3.directives.hint';\nimport { Outline } from 'ui.icon-set.api.vue';\nimport 'ui.icon-set.outline';\n\nimport { Model } from 'tasks.v2.const';\nimport { HoverPill } from 'tasks.v2.component.elements.hover-pill';\nimport { FieldAdd } from 'tasks.v2.component.elements.field-add';\nimport { tooltip } from 'tasks.v2.component.elements.hint';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nexport const DatePlanContent = {\n\tcomponents: {\n\t\tHoverPill,\n\t\tFieldAdd,\n\t},\n\tdirectives: { hint },\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t},\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tOutline,\n\t\t};\n\t},\n\tcomputed: {\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.taskId);\n\t\t},\n\t\ttooltip(): Function\n\t\t{\n\t\t\treturn (): HintParams => tooltip({\n\t\t\t\ttext: this.loc('TASKS_V2_DATE_PLAN_NO_SUBTASKS_HINT'),\n\t\t\t\tpopupOptions: {\n\t\t\t\t\toffsetLeft: this.$refs.hint.offsetWidth / 2,\n\t\t\t\t},\n\t\t\t\ttimeout: 100,\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<HoverPill v-if=\"task.matchesSubTasksTime\" :readonly=\"true\">\n\t\t\t<div class=\"tasks-field-date-plan-content\">\n\t\t\t\t<div>{{ loc('TASKS_V2_DATE_PLAN_MATCH_SUBTASKS_TIME_STATE') }}</div>\n\t\t\t\t<div v-hint=\"tooltip\" class=\"tasks-hint-badge\" ref=\"hint\">?</div>\n\t\t\t</div>\n\t\t</HoverPill>\n\t\t<FieldAdd v-else :icon=\"Outline.PLANNING\"/>\n\t`,\n};\n","import { Loc } from 'main.core';\nimport { TaskField } from 'tasks.v2.const';\n\nexport const datePlanMeta = Object.freeze({\n\tid: TaskField.DatePlan,\n\ttitle: Loc.getMessage('TASKS_V2_DATE_PLAN_TITLE'),\n});\n","import { FieldList } from 'tasks.v2.component.elements.field-list';\nimport { Model } from 'tasks.v2.const';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nimport { DatePlanDate } from './components/date-plan-date';\nimport { DatePlanContent } from './components/date-plan-content';\nimport { datePlanMeta } from './date-plan-meta';\nimport './date-plan.css';\n\n// @vue/component\nexport const DatePlan = {\n\tcomponents: {\n\t\tFieldList,\n\t},\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['open'],\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tdatePlanMeta,\n\t\t};\n\t},\n\tcomputed: {\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.taskId);\n\t\t},\n\t\twasFilled(): boolean\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/wasFieldFilled`](this.taskId, datePlanMeta.id);\n\t\t},\n\t\tfields(): string[]\n\t\t{\n\t\t\tconst isEmpty = !this.task.startPlanTs && !this.task.endPlanTs;\n\t\t\tif (isEmpty && (this.wasFilled || this.task.matchesSubTasksTime))\n\t\t\t{\n\t\t\t\treturn [{\n\t\t\t\t\ttitle: datePlanMeta.title,\n\t\t\t\t\tcomponent: DatePlanContent,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\ttaskId: this.taskId,\n\t\t\t\t\t},\n\t\t\t\t}];\n\t\t\t}\n\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\ttitle: this.loc('TASKS_V2_DATE_PLAN_FIELD_START'),\n\t\t\t\t\tcomponent: DatePlanDate,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tdateTs: this.task.startPlanTs,\n\t\t\t\t\t\treadonly: this.readonly,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttitle: this.loc('TASKS_V2_DATE_PLAN_FIELD_END'),\n\t\t\t\t\tcomponent: DatePlanDate,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tdateTs: this.task.endPlanTs,\n\t\t\t\t\t\treadonly: this.readonly,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t].filter(({ props: { dateTs } }) => dateTs);\n\t\t},\n\t\treadonly(): boolean\n\t\t{\n\t\t\treturn !this.task.rights.datePlan;\n\t\t},\n\t},\n\tmethods: {\n\t\thandleClick(): void\n\t\t{\n\t\t\tif (!this.readonly)\n\t\t\t{\n\t\t\t\tthis.$emit('open');\n\t\t\t}\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"tasks-field-date-plan\"\n\t\t\t:class=\"{ '--readonly': readonly }\"\n\t\t\t:data-task-id=\"taskId\"\n\t\t\t:data-task-field-id=\"datePlanMeta.id\"\n\t\t\t:data-task-plan-start=\"task.startPlanTs\"\n\t\t\t:data-task-plan-end=\"task.endPlanTs\"\n\t\t\t@click=\"handleClick\"\n\t\t>\n\t\t\t<FieldList :fields=\"fields\"/>\n\t\t</div>\n\t`,\n};\n","import { Chip, ChipDesign } from 'ui.system.chip.vue';\nimport { Outline } from 'ui.icon-set.api.core';\nimport 'ui.icon-set.outline';\n\nimport { Model } from 'tasks.v2.const';\nimport { fieldHighlighter } from 'tasks.v2.lib.field-highlighter';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nimport { datePlanMeta } from './date-plan-meta';\n\n// @vue/component\nexport const DatePlanChip = {\n\tcomponents: {\n\t\tChip,\n\t},\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['open'],\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tOutline,\n\t\t\tdatePlanMeta,\n\t\t};\n\t},\n\tcomputed: {\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.taskId);\n\t\t},\n\t\tdesign(): string\n\t\t{\n\t\t\treturn this.isSelected ? ChipDesign.ShadowAccent : ChipDesign.ShadowNoAccent;\n\t\t},\n\t\tisSelected(): boolean\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/wasFieldFilled`](this.taskId, datePlanMeta.id);\n\t\t},\n\t\treadonly(): boolean\n\t\t{\n\t\t\treturn !this.task.rights.edit;\n\t\t},\n\t},\n\tmethods: {\n\t\thandleClick(): void\n\t\t{\n\t\t\tif (this.isSelected)\n\t\t\t{\n\t\t\t\tthis.highlightField();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$emit('open');\n\t\t},\n\t\thighlightField(): void\n\t\t{\n\t\t\tvoid fieldHighlighter.setContainer(this.$root.$el).highlight(datePlanMeta.id);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Chip\n\t\t\tv-if=\"isSelected || !readonly\"\n\t\t\t:design=\"design\"\n\t\t\t:icon=\"Outline.PLANNING\"\n\t\t\t:text=\"loc('TASKS_V2_DATE_PLAN_TITLE_CHIP')\"\n\t\t\t:data-task-id=\"taskId\"\n\t\t\t:data-task-chip-id=\"datePlanMeta.id\"\n\t\t\t:data-task-plan-start=\"task.startPlanTs\"\n\t\t\t:data-task-plan-end=\"task.endPlanTs\"\n\t\t\t@click=\"handleClick\"\n\t\t/>\n\t`,\n};\n","import { TextSm } from 'ui.system.typography.vue';\nimport { SwitcherSize, type SwitcherOptions } from 'ui.switcher';\nimport { Switcher } from 'ui.vue3.components.switcher';\nimport { hint, type HintParams } from 'ui.vue3.directives.hint';\n\nimport { tooltip } from 'tasks.v2.component.elements.hint';\n\nexport const DatePlanSwitcher = {\n\tcomponents: {\n\t\tTextSm,\n\t\tSwitcher,\n\t},\n\tdirectives: { hint },\n\tprops: {\n\t\tmodelValue: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\ttext: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\thint: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\tcomputed: {\n\t\tswitcherOptions(): SwitcherOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tsize: SwitcherSize.extraSmall,\n\t\t\t\tuseAirDesign: true,\n\t\t\t};\n\t\t},\n\t\ttooltip(): Function\n\t\t{\n\t\t\treturn (): HintParams => tooltip({\n\t\t\t\ttext: this.hint,\n\t\t\t\tpopupOptions: {\n\t\t\t\t\toffsetLeft: this.$refs.hint.offsetWidth / 2,\n\t\t\t\t},\n\t\t\t\ttimeout: 100,\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"tasks-field-date-plan-switcher\" @click=\"$emit('update:modelValue', !modelValue)\">\n\t\t\t<Switcher :isChecked=\"modelValue\" :options=\"switcherOptions\"/>\n\t\t\t<TextSm>{{ text }}</TextSm>\n\t\t\t<div v-if=\"hint\" v-hint=\"tooltip\" class=\"tasks-hint-badge\" ref=\"hint\" @click.capture.stop>?</div>\n\t\t</div>\n\t`,\n};\n","import { Runtime } from 'main.core';\nimport { DurationFormat } from 'main.date';\n\nimport { DatePicker, DatePickerEvent } from 'ui.date-picker';\nimport { mapGetters } from 'ui.vue3.vuex';\nimport { Button as UiButton, ButtonColor, ButtonSize } from 'ui.vue3.components.button';\nimport { HeadlineMd, TextSm } from 'ui.system.typography.vue';\nimport { BInput, InputDesign } from 'ui.system.input.vue';\nimport { BMenu, type MenuOptions } from 'ui.vue3.components.menu';\nimport { BIcon, Outline } from 'ui.icon-set.api.vue';\nimport 'ui.icon-set.outline';\n\nimport { Model, DurationUnit } from 'tasks.v2.const';\nimport { BottomSheet } from 'tasks.v2.component.elements.bottom-sheet';\nimport { fieldHighlighter } from 'tasks.v2.lib.field-highlighter';\nimport { calendar } from 'tasks.v2.lib.calendar';\nimport { timezone } from 'tasks.v2.lib.timezone';\nimport { taskService } from 'tasks.v2.provider.service.task-service';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nimport { datePlanMeta } from './date-plan-meta';\nimport { DatePlanSwitcher } from './components/date-plan-switcher';\nimport './date-plan.css';\n\ntype UnitParams = {\n\tduration: number,\n\ttitle: string,\n};\n\nconst MAX_INT = 2 ** 31;\n\n// @vue/component\nexport const DatePlanSheet = {\n\tcomponents: {\n\t\tBottomSheet,\n\t\tBIcon,\n\t\tUiButton,\n\t\tHeadlineMd,\n\t\tTextSm,\n\t\tBInput,\n\t\tBMenu,\n\t\tDatePlanSwitcher,\n\t},\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tisShown: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tgetBindElement: {\n\t\t\ttype: Function,\n\t\t\tdefault: null,\n\t\t},\n\t\tgetTargetContainer: {\n\t\t\ttype: Function,\n\t\t\tdefault: null,\n\t\t},\n\t},\n\temits: ['close'],\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tOutline,\n\t\t\tInputDesign,\n\t\t\tButtonSize,\n\t\t\tButtonColor,\n\t\t\twasEmpty: false,\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tisEndPicker: false,\n\t\t\tisEndDuration: false,\n\t\t\tisPickerShown: false,\n\t\t\tisMenuShown: false,\n\t\t\tunitId: DurationUnit.Days,\n\t\t\tdurationValue: '',\n\t\t\tstartTsTemp: null,\n\t\t\tendTsTemp: null,\n\t\t\tmatchesWorkTimeTemp: null,\n\t\t};\n\t},\n\tcomputed: {\n\t\t...mapGetters({\n\t\t\ttitleFieldOffsetHeight: `${Model.Interface}/titleFieldOffsetHeight`,\n\t\t}),\n\t\tisEdit(): boolean\n\t\t{\n\t\t\treturn Number.isInteger(this.taskId) && this.taskId > 0;\n\t\t},\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.taskId);\n\t\t},\n\t\t// do not remove startPlanTs, otherwise startTs is not updated\n\t\tstartPlanTs(): number\n\t\t{\n\t\t\treturn this.task.startPlanTs;\n\t\t},\n\t\tendPlanTs(): number\n\t\t{\n\t\t\treturn this.task.endPlanTs;\n\t\t},\n\t\tstartTs(): number\n\t\t{\n\t\t\treturn this.startTsTemp ?? this.startPlanTs;\n\t\t},\n\t\tendTs(): number\n\t\t{\n\t\t\treturn this.endTsTemp ?? this.endPlanTs;\n\t\t},\n\t\twasFilled(): boolean\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/wasFieldFilled`](this.taskId, datePlanMeta.id);\n\t\t},\n\t\tallowsChangeDatePlan: {\n\t\t\tget(): boolean\n\t\t\t{\n\t\t\t\treturn this.task.allowsChangeDatePlan ?? false;\n\t\t\t},\n\t\t\tset(allowsChangeDatePlan: boolean): void\n\t\t\t{\n\t\t\t\tvoid taskService.update(this.taskId, { allowsChangeDatePlan });\n\t\t\t},\n\t\t},\n\t\tmatchesWorkTime: {\n\t\t\tget(): boolean\n\t\t\t{\n\t\t\t\treturn this.matchesWorkTimeTemp ?? this.task.matchesWorkTime ?? false;\n\t\t\t},\n\t\t\tset(matchesWorkTime: boolean): void\n\t\t\t{\n\t\t\t\tthis.matchesWorkTimeTemp = matchesWorkTime;\n\n\t\t\t\tthis.update();\n\n\t\t\t\tif (!this.maxDurationReached)\n\t\t\t\t{\n\t\t\t\t\tvoid taskService.update(this.taskId, { matchesWorkTime });\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\tmatchesSubTasksTime: {\n\t\t\tget(): boolean\n\t\t\t{\n\t\t\t\treturn this.task.matchesSubTasksTime ?? false;\n\t\t\t},\n\t\t\tset(matchesSubTasksTime: boolean): void\n\t\t\t{\n\t\t\t\tvoid taskService.update(this.taskId, { matchesSubTasksTime });\n\t\t\t},\n\t\t},\n\t\tmaxDurationReached(): boolean\n\t\t{\n\t\t\treturn this.endTs && this.startTs && Math.floor((this.endTs - this.startTs) / 1000) >= MAX_INT;\n\t\t},\n\t\tmenuOptions(): Function\n\t\t{\n\t\t\treturn (): MenuOptions => ({\n\t\t\t\tbindElement: this.$refs.unit.$el,\n\t\t\t\titems: [DurationUnit.Days, DurationUnit.Hours, DurationUnit.Minutes].map((unitId) => {\n\t\t\t\t\tconst unit = this.units[unitId];\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttitle: unit.title,\n\t\t\t\t\t\tisSelected: unitId === this.unitId,\n\t\t\t\t\t\tonClick: (): void => {\n\t\t\t\t\t\t\tthis.unitId = unitId;\n\n\t\t\t\t\t\t\tthis.update();\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t}),\n\t\t\t});\n\t\t},\n\t\tunits(): { [unitId: string]: UnitParams }\n\t\t{\n\t\t\tconst unitDurations = DurationFormat.getUnitDurations();\n\n\t\t\treturn {\n\t\t\t\t[DurationUnit.Days]: {\n\t\t\t\t\tduration: this.matchesWorkTime ? calendar.workdayDuration : unitDurations.d,\n\t\t\t\t\ttitle: this.loc('TASKS_V2_DATE_PLAN_DAYS'),\n\t\t\t\t},\n\t\t\t\t[DurationUnit.Hours]: {\n\t\t\t\t\tduration: unitDurations.H,\n\t\t\t\t\ttitle: this.loc('TASKS_V2_DATE_PLAN_HOURS'),\n\t\t\t\t},\n\t\t\t\t[DurationUnit.Minutes]: {\n\t\t\t\t\tduration: unitDurations.i,\n\t\t\t\t\ttitle: this.loc('TASKS_V2_DATE_PLAN_MINUTES'),\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\tinputDesign(): string\n\t\t{\n\t\t\treturn this.matchesSubTasksTime ? InputDesign.Disabled : InputDesign.Grey;\n\t\t},\n\t},\n\twatch: {\n\t\tisShown(isShown: boolean): void\n\t\t{\n\t\t\tif (isShown)\n\t\t\t{\n\t\t\t\tthis.clearTemps();\n\t\t\t\tthis.updateDuration(this.task.startPlanTs, this.task.endPlanTs);\n\t\t\t\tthis.wasEmpty = !this.wasFilled;\n\t\t\t}\n\t\t},\n\t\ttitleFieldOffsetHeight(): void\n\t\t{\n\t\t\tthis.$refs.bottomSheet?.adjustPosition();\n\t\t},\n\t},\n\tmounted(): void\n\t{\n\t\tthis.updateDuration(this.task.startPlanTs, this.task.endPlanTs);\n\t},\n\tmethods: {\n\t\tclearStart(): void\n\t\t{\n\t\t\tthis.clearTemps();\n\t\t\tthis.durationValue = '';\n\t\t\tthis.updateTaskPlan(null, this.task.endPlanTs);\n\t\t},\n\t\tclearEnd(): void\n\t\t{\n\t\t\tthis.clearTemps();\n\t\t\tthis.durationValue = '';\n\t\t\tthis.updateTaskPlan(this.task.startPlanTs, null);\n\t\t},\n\t\thandleDateClick({ target }: { target: HTMLElement }, { isEnd }: { isEnd: boolean }): void\n\t\t{\n\t\t\tthis.clearTemps();\n\t\t\tthis.updateDuration(this.task.startPlanTs, this.task.endPlanTs);\n\t\t\tthis.isEndPicker = isEnd;\n\n\t\t\tconst datePicker = this.getDatePicker();\n\t\t\tdatePicker.setTargetNode(target);\n\t\t\tdatePicker.show();\n\t\t\tif (this.isEndPicker && this.task.endPlanTs)\n\t\t\t{\n\t\t\t\tdatePicker.setFocusDate(this.task.endPlanTs + timezone.getOffset(this.task.endPlanTs));\n\t\t\t}\n\t\t},\n\t\tgetDatePicker(): DatePicker\n\t\t{\n\t\t\tthis.handlePickerChangedDebounced ??= Runtime.debounce(this.handlePickerChanged, 10, this);\n\t\t\tthis.datePicker ??= new DatePicker({\n\t\t\t\tenableTime: true,\n\t\t\t\tselectionMode: 'range',\n\t\t\t\tdefaultTime: calendar.defaultTime,\n\t\t\t\tevents: {\n\t\t\t\t\t[DatePickerEvent.SELECT]: this.handlePickerChangedDebounced,\n\t\t\t\t\t[DatePickerEvent.DESELECT]: this.handlePickerChangedDebounced,\n\t\t\t\t\tonShow: (): void => {\n\t\t\t\t\t\tthis.isPickerShown = true;\n\t\t\t\t\t},\n\t\t\t\t\tonHide: (): void => {\n\t\t\t\t\t\tthis.isPickerShown = false;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\treturn this.datePicker;\n\t\t},\n\t\thandlePickerChanged(): void\n\t\t{\n\t\t\tlet startPlanTs = this.preparePickerTimestamp(this.datePicker.getRangeStart());\n\t\t\tlet endPlanTs = this.preparePickerTimestamp(this.datePicker.getRangeEnd());\n\t\t\tif (this.isEndPicker && !endPlanTs && !this.task.startPlanTs)\n\t\t\t{\n\t\t\t\t[startPlanTs, endPlanTs] = [null, startPlanTs];\n\t\t\t}\n\n\t\t\tif (startPlanTs && !this.task.startPlanTs)\n\t\t\t{\n\t\t\t\tstartPlanTs = calendar.setHours(startPlanTs, calendar.workdayStart.H, calendar.workdayStart.M);\n\t\t\t}\n\n\t\t\tthis.updateDuration(startPlanTs, endPlanTs);\n\t\t},\n\t\tupdateDuration(startTs: number, endTs: number): void\n\t\t{\n\t\t\tconst [startPlanTs, endPlanTs] = this.prepareRange(startTs, endTs);\n\t\t\tif (!startPlanTs || !endPlanTs)\n\t\t\t{\n\t\t\t\tthis.durationValue = '';\n\n\t\t\t\tthis.updateTaskPlan(startPlanTs, endPlanTs);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst [durationValue, unitId] = this.calculateDurationValue(startPlanTs, endPlanTs, this.matchesWorkTime);\n\t\t\tthis.durationValue = String(durationValue);\n\t\t\tthis.unitId = unitId;\n\n\t\t\tthis.updateTaskPlan(startPlanTs, endPlanTs);\n\t\t},\n\t\tupdate(): void\n\t\t{\n\t\t\tconst [startPlanTs, endPlanTs] = this.prepareRange(this.task.startPlanTs, this.task.endPlanTs);\n\t\t\tif (startPlanTs && endPlanTs)\n\t\t\t{\n\t\t\t\tthis.updateRangeFromDuration();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.updateTaskPlan(startPlanTs, endPlanTs);\n\t\t\t}\n\t\t},\n\t\tupdateRangeFromDuration(): void\n\t\t{\n\t\t\tlet [startPlanTs, endPlanTs] = this.prepareRange(this.task.startPlanTs, this.task.endPlanTs);\n\t\t\tif (!startPlanTs && !endPlanTs)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.isEndDuration)\n\t\t\t{\n\t\t\t\tstartPlanTs = null;\n\t\t\t}\n\n\t\t\tthis.durationValue = this.durationValue.replaceAll(/\\D/g, '');\n\t\t\tconst duration = this.durationValue * this.units[this.unitId].duration;\n\t\t\tif (this.matchesWorkTime)\n\t\t\t{\n\t\t\t\tstartPlanTs = calendar.calculateStartTs(startPlanTs, endPlanTs, duration);\n\t\t\t\tendPlanTs = calendar.calculateEndTs(startPlanTs, endPlanTs, duration);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tstartPlanTs ??= endPlanTs - duration;\n\t\t\t\tendPlanTs = startPlanTs + duration;\n\t\t\t}\n\n\t\t\tthis.updateTaskPlan(startPlanTs, endPlanTs);\n\t\t},\n\t\tcalculateDurationValue(startTs: number, endTs: number, matchWorkTime: boolean): [number, string]\n\t\t{\n\t\t\tconst duration = matchWorkTime ? calendar.calculateDuration(startTs, endTs) : endTs - startTs;\n\t\t\tconst minutes = duration / this.units[DurationUnit.Minutes].duration;\n\t\t\tconst hours = duration / this.units[DurationUnit.Hours].duration;\n\t\t\tconst days = duration / this.units[DurationUnit.Days].duration;\n\n\t\t\treturn {\n\t\t\t\t[true]: [minutes, DurationUnit.Minutes],\n\t\t\t\t[Number.isInteger(hours)]: [hours, DurationUnit.Hours],\n\t\t\t\t[Number.isInteger(days)]: [days, DurationUnit.Days],\n\t\t\t}.true;\n\t\t},\n\t\tupdateTaskPlan(startPlanTs: ?number, endPlanTs: ?number): void\n\t\t{\n\t\t\tthis.startTsTemp = startPlanTs;\n\t\t\tthis.endTsTemp = endPlanTs;\n\t\t\tif (this.maxDurationReached)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.clearTemps();\n\n\t\t\tconst datePicker = this.getDatePicker();\n\t\t\tconst options = { emitEvents: false };\n\t\t\tif (startPlanTs || endPlanTs)\n\t\t\t{\n\t\t\t\tconst rangeStart = startPlanTs + timezone.getOffset(startPlanTs);\n\t\t\t\tconst rangeEnd = endPlanTs ? endPlanTs + timezone.getOffset(endPlanTs) : null;\n\t\t\t\tif (startPlanTs)\n\t\t\t\t{\n\t\t\t\t\tdatePicker.selectRange(rangeStart, rangeEnd, options);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tdatePicker.selectRange(rangeEnd, null, options);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tdatePicker.deselectAll(options);\n\t\t\t}\n\n\t\t\tvoid taskService.update(this.taskId, { startPlanTs, endPlanTs });\n\t\t},\n\t\tclearTemps(): void\n\t\t{\n\t\t\tthis.startTsTemp = null;\n\t\t\tthis.endTsTemp = null;\n\t\t\tthis.matchesWorkTimeTemp = null;\n\t\t},\n\t\tprepareRange(startTs: number, endTs: number): [?number, ?number]\n\t\t{\n\t\t\tif (this.matchesWorkTime)\n\t\t\t{\n\t\t\t\treturn [calendar.clampWorkDateTime(startTs), calendar.clampWorkDateTime(endTs)];\n\t\t\t}\n\n\t\t\treturn [startTs, endTs];\n\t\t},\n\t\tpreparePickerTimestamp(date: ?Date): ?number\n\t\t{\n\t\t\tif (!date)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst dateTs = calendar.createDateFromUtc(date).getTime();\n\n\t\t\treturn dateTs - timezone.getOffset(dateTs);\n\t\t},\n\t\tformatDate(timestamp: number): string\n\t\t{\n\t\t\treturn calendar.formatDateTime(timestamp, { forceYear: true });\n\t\t},\n\t\tclose(): void\n\t\t{\n\t\t\tif (this.wasEmpty && this.wasFilled)\n\t\t\t{\n\t\t\t\tvoid fieldHighlighter.setContainer(this.$root.$el).highlight(datePlanMeta.id);\n\t\t\t}\n\n\t\t\tif (this.task.matchesSubTasksTime && !this.isEdit)\n\t\t\t{\n\t\t\t\tthis.updateDuration(null, null);\n\t\t\t}\n\n\t\t\tthis.$emit('close');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<BottomSheet\n\t\t\tv-if=\"isShown\"\n\t\t\t:getBindElement=\"getBindElement\"\n\t\t\t:getTargetContainer=\"getTargetContainer\"\n\t\t\tref=\"bottomSheet\"\n\t\t>\n\t\t\t<div class=\"tasks-field-date-plan-sheet\">\n\t\t\t\t<div class=\"tasks-field-date-plan-header\">\n\t\t\t\t\t<HeadlineMd>{{ loc('TASKS_V2_DATE_PLAN_TITLE_SHEET') }}</HeadlineMd>\n\t\t\t\t\t<BIcon class=\"tasks-field-date-plan-close\" :name=\"Outline.CROSS_L\" :hoverable=\"true\" @click=\"close\"/>\n\t\t\t\t</div>\n\t\t\t\t<TextSm class=\"tasks-field-date-plan-description\">{{ loc('TASKS_V2_DATE_PLAN_DESCRIPTION') }}</TextSm>\n\t\t\t\t<div class=\"tasks-field-date-plan-fields\">\n\t\t\t\t\t<BInput\n\t\t\t\t\t\t:modelValue=\"formatDate(startTs)\"\n\t\t\t\t\t\t:label=\"loc('TASKS_V2_DATE_PLAN_START')\"\n\t\t\t\t\t\t:design=\"inputDesign\"\n\t\t\t\t\t\t:icon=\"Outline.CALENDAR_WITH_SLOTS\"\n\t\t\t\t\t\t:withClear=\"Boolean(startTs)\"\n\t\t\t\t\t\t:active=\"isPickerShown && !isEndPicker\"\n\t\t\t\t\t\t@clear=\"clearStart\"\n\t\t\t\t\t\t@click=\"handleDateClick($event, { isEnd: false })\"\n\t\t\t\t\t\t@focus=\"$event.target.blur()\"\n\t\t\t\t\t/>\n\t\t\t\t\t<BInput\n\t\t\t\t\t\t:modelValue=\"formatDate(endTs)\"\n\t\t\t\t\t\t:label=\"loc('TASKS_V2_DATE_PLAN_END')\"\n\t\t\t\t\t\t:design=\"inputDesign\"\n\t\t\t\t\t\t:icon=\"Outline.CALENDAR_WITH_SLOTS\"\n\t\t\t\t\t\t:withClear=\"Boolean(endTs)\"\n\t\t\t\t\t\t:active=\"isPickerShown && isEndPicker\"\n\t\t\t\t\t\t@clear=\"clearEnd\"\n\t\t\t\t\t\t@click=\"handleDateClick($event, { isEnd: true })\"\n\t\t\t\t\t\t@focus=\"$event.target.blur()\"\n\t\t\t\t\t/>\n\t\t\t\t\t<div class=\"tasks-field-date-plan-duration\">\n\t\t\t\t\t\t<BInput\n\t\t\t\t\t\t\tv-model=\"durationValue\"\n\t\t\t\t\t\t\t:label=\"loc('TASKS_V2_DATE_PLAN_DURATION')\"\n\t\t\t\t\t\t\t:design=\"inputDesign\"\n\t\t\t\t\t\t\t:error=\"maxDurationReached ? ' ' : null\"\n\t\t\t\t\t\t\t@input=\"updateRangeFromDuration\"\n\t\t\t\t\t\t\t@focus=\"isEndDuration = !task.startPlanTs\"\n\t\t\t\t\t\t\t@blur=\"isEndDuration = false\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<BInput\n\t\t\t\t\t\t\t:modelValue=\"units[unitId].title\"\n\t\t\t\t\t\t\t:design=\"inputDesign\"\n\t\t\t\t\t\t\t:dropdown=\"true\"\n\t\t\t\t\t\t\t:active=\"isMenuShown\"\n\t\t\t\t\t\t\tref=\"unit\"\n\t\t\t\t\t\t\t@click=\"isMenuShown = true\"\n\t\t\t\t\t\t\t@focus=\"$event.target.blur()\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tasks-field-date-plan-switchers\">\n\t\t\t\t\t<DatePlanSwitcher\n\t\t\t\t\t\tv-if=\"task.rights.edit\"\n\t\t\t\t\t\tv-model=\"allowsChangeDatePlan\"\n\t\t\t\t\t\t:text=\"loc('TASKS_V2_DATE_PLAN_ALLOW_CHANGE')\"\n\t\t\t\t\t/>\n\t\t\t\t\t<DatePlanSwitcher\n\t\t\t\t\t\tv-model=\"matchesWorkTime\"\n\t\t\t\t\t\t:text=\"loc('TASKS_V2_DATE_PLAN_MATCH_WORK_TIME')\"\n\t\t\t\t\t\t:hint=\"loc('TASKS_V2_DATE_PLAN_MATCH_WORK_TIME_HINT')\"\n\t\t\t\t\t/>\n\t\t\t\t\t<DatePlanSwitcher\n\t\t\t\t\t\tv-model=\"matchesSubTasksTime\"\n\t\t\t\t\t\t:text=\"loc('TASKS_V2_DATE_PLAN_MATCH_SUBTASKS_TIME')\"\n\t\t\t\t\t\t:hint=\"loc('TASKS_V2_DATE_PLAN_MATCH_SUBTASKS_TIME_HINT')\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tasks-field-date-plan-footer\">\n\t\t\t\t\t<UiButton\n\t\t\t\t\t\t:text=\"loc('TASKS_V2_DATE_PLAN_BUTTON_SAVE')\"\n\t\t\t\t\t\t:size=\"ButtonSize.MEDIUM\"\n\t\t\t\t\t\t:color=\"ButtonColor.PRIMARY\"\n\t\t\t\t\t\t@click=\"close\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</BottomSheet>\n\t\t<BMenu v-if=\"isMenuShown\" :options=\"menuOptions()\" @close=\"isMenuShown = false\"/>\n\t`,\n};\n"],"names":["DatePlanDate","components","HoverPill","props","dateTs","type","Number","required","readonly","Boolean","default","computed","dateFormatted","calendar","formatDateTime","forceYear","template","DatePlanContent","FieldAdd","directives","hint","taskId","String","setup","Outline","task","$store","getters","Model","Tasks","tooltip","text","loc","popupOptions","offsetLeft","$refs","offsetWidth","timeout","datePlanMeta","Object","freeze","id","TaskField","DatePlan","title","Loc","getMessage","FieldList","emits","wasFilled","fields","isEmpty","startPlanTs","endPlanTs","matchesSubTasksTime","component","filter","rights","datePlan","methods","handleClick","$emit","DatePlanChip","Chip","design","isSelected","ChipDesign","ShadowAccent","ShadowNoAccent","edit","highlightField","fieldHighlighter","setContainer","$root","$el","highlight","DatePlanSwitcher","TextSm","Switcher","modelValue","switcherOptions","size","SwitcherSize","extraSmall","useAirDesign","MAX_INT","DatePlanSheet","BottomSheet","BIcon","UiButton","HeadlineMd","BInput","BMenu","isShown","getBindElement","Function","getTargetContainer","InputDesign","ButtonSize","ButtonColor","wasEmpty","data","isEndPicker","isEndDuration","isPickerShown","isMenuShown","unitId","DurationUnit","Days","durationValue","startTsTemp","endTsTemp","matchesWorkTimeTemp","mapGetters","titleFieldOffsetHeight","Interface","isEdit","isInteger","startTs","endTs","allowsChangeDatePlan","get","set","taskService","update","matchesWorkTime","maxDurationReached","Math","floor","menuOptions","bindElement","unit","items","Hours","Minutes","map","units","onClick","unitDurations","DurationFormat","getUnitDurations","duration","workdayDuration","d","H","i","inputDesign","Disabled","Grey","watch","clearTemps","updateDuration","bottomSheet","adjustPosition","mounted","clearStart","updateTaskPlan","clearEnd","handleDateClick","target","isEnd","datePicker","getDatePicker","setTargetNode","show","setFocusDate","timezone","getOffset","handlePickerChangedDebounced","Runtime","debounce","handlePickerChanged","DatePicker","enableTime","selectionMode","defaultTime","events","DatePickerEvent","SELECT","DESELECT","onShow","onHide","preparePickerTimestamp","getRangeStart","getRangeEnd","setHours","workdayStart","M","prepareRange","calculateDurationValue","updateRangeFromDuration","replaceAll","calculateStartTs","calculateEndTs","matchWorkTime","calculateDuration","minutes","hours","days","true","options","emitEvents","rangeStart","rangeEnd","selectRange","deselectAll","clampWorkDateTime","date","createDateFromUtc","getTime","formatDate","timestamp","close"],"mappings":"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"}