this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};this.BX.Tasks.V2=this.BX.Tasks.V2||{};this.BX.Tasks.V2.Component=this.BX.Tasks.V2.Component||{};(function(t,e,s,i,n,a,d,l,o,r,c,h,p,u,T,k){"use strict";const m={components:{BIcon:o.BIcon},inject:["analytics","cardType"],props:{taskId:{type:[Number,String],required:true}},emits:["update","close"],setup(){return{Outline:r.Outline,today:new Date,datePicker:null,dateTs:null,hour:null}},computed:{task(){return this.$store.getters[`${k.Model.Tasks}/getById`](this.taskId)},presets(){const[t,e,s]=[this.today.getFullYear(),this.today.getMonth(),this.today.getDate()];const i=d.DateTimeFormat.getFormat("DAY_OF_WEEK_MONTH_FORMAT");return[{id:`today-${this.taskId}`,title:this.loc("TASKS_V2_DEADLINE_TODAY"),date:new Date(t,e,s)},{id:`tomorrow-${this.taskId}`,title:this.loc("TASKS_V2_DEADLINE_TOMORROW"),date:new Date(t,e,s+1)},{id:`end-week-${this.taskId}`,title:this.loc("TASKS_V2_DEADLINE_IN_THE_END_OF_THE_WEEK"),date:new Date(t,e,s-this.today.getDay()+5)},{id:`in-week-${this.taskId}`,title:this.loc("TASKS_V2_DEADLINE_IN_A_WEEK"),date:new Date(t,e,s+7)},{id:`month-${this.taskId}`,title:this.loc("TASKS_V2_DEADLINE_IN_THE_END_OF_THE_MONTH"),date:new Date(t,e+1,0)}].map((t=>({id:t.id,title:t.title,timestamp:t.date.getTime(),formatted:d.DateTimeFormat.format(i,t.date)})))}},created(){this.datePicker=this.createDatePicker();const t=new Date(this.task.deadlineTs+p.timezone.getOffset(this.task.deadlineTs));this.dateTs=new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime();this.hour=t.getHours()},mounted(){this.datePicker.setTargetNode(this.$refs.picker);this.datePicker.show()},beforeUnmount(){this.datePicker.destroy()},methods:{createDatePicker(){const t=p.timezone.getOffset(this.task.deadlineTs);const e=new l.DatePicker({selectedDates:this.task.deadlineTs?[this.task.deadlineTs+t]:null,defaultTime:h.calendar.defaultTime,inline:true,enableTime:true,events:{[l.DatePickerEvent.SELECT]:t=>{const{date:e}=t.getData();const s=h.calendar.createDateFromUtc(e).getTime();this.$emit("update",s-p.timezone.getOffset(s))}}});e.getPicker("day").subscribe("onSelect",(t=>{const{year:e,month:s,day:i}=t.getData();const n=new Date(e,s,i).getTime();this.close();this.sendAnalytics(k.Analytics.Element.Calendar);this.dateTs=n}));e.getPicker("time").subscribe("onSelect",(t=>{const{hour:e,minute:s}=t.getData();if(Number.isInteger(s)||e===this.hour){this.close()}this.sendAnalytics(k.Analytics.Element.Calendar);this.hour=e}));return e},focusDate(t){this.datePicker.setFocusDate(t)},selectPresetDate(t){const e=new Date(t);const[s,i,n]=[e.getFullYear(),e.getMonth(),e.getDate()];this.datePicker.selectDate(new Date(`${i+1}/${n}/${s} ${h.calendar.defaultTime}`));this.sendAnalytics(k.Analytics.Element.DeadlinePreset);this.close()},close(){this.$emit("close")},sendAnalytics(t){u.analytics.sendDeadlineSet(this.analytics,{cardType:this.cardType,element:t})}},template:`\n\t\t<div class="tasks-field-deadline-popup">\n\t\t\t<div class="tasks-field-deadline-picker-container">\n\t\t\t\t<div class="tasks-field-deadline-picker" ref="picker">\n\t\t\t\t\t<BIcon v-if="false" class="tasks-field-deadline-picker-settings" :name="Outline.FILTER_2_LINES"/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="tasks-field-deadline-presets">\n\t\t\t\t<template v-for="(preset, index) of presets" :key="index">\n\t\t\t\t\t<div\n\t\t\t\t\t\t:data-task-preset-id="preset.id"\n\t\t\t\t\t\tclass="tasks-field-deadline-preset"\n\t\t\t\t\t\t@click="selectPresetDate(preset.timestamp)"\n\t\t\t\t\t\t@mouseenter="focusDate(preset.timestamp)"\n\t\t\t\t\t\t@mouseleave="focusDate(null)"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="tasks-field-deadline-preset-title">{{ preset.title }}</div>\n\t\t\t\t\t\t<div class="tasks-field-deadline-preset-date">{{ preset.formatted }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t\t<div v-if="false" class="tasks-field-deadline-settings">\n\t\t\t</div>\n\t\t</div>\n\t`};const D={components:{Popup:n.Popup,DeadlinePopupContent:m},props:{taskId:{type:[Number,String],required:true},bindElement:{type:HTMLElement,required:true}},emits:["update","close"],computed:{popupOptions(){return{id:`tasks-field-deadline-popup-${this.taskId}`,bindElement:this.bindElement,padding:24,offsetTop:5,offsetLeft:-100,targetContainer:document.body}}},methods:{clear(){this.deadlineTs=null},handleUpdate(t){this.deadlineTs=t;this.$emit("update",t)},handleClose(){if(this.deadlineTs){void a.taskService.update(this.taskId,{deadlineTs:this.deadlineTs})}this.$emit("close")}},template:`\n\t\t<Popup\n\t\t\t:options="popupOptions"\n\t\t\t@close="handleClose"\n\t\t>\n\t\t\t<DeadlinePopupContent :taskId="taskId" @update="handleUpdate" @close="handleClose"/>\n\t\t</Popup>\n\t`};const f=Object.freeze({id:k.TaskField.Deadline,title:T.Loc.getMessage("TASKS_V2_DEADLINE_TITLE")});const I={components:{TextMd:e.TextMd,Text2Xs:e.Text2Xs,HoverPill:s.HoverPill,BIcon:o.BIcon,DeadlinePopup:D},props:{taskId:{type:[Number,String],required:true}},setup(){return{deadlineMeta:f}},data(){return{nowTs:Date.now(),isPopupShown:false,selectingDeadlineTs:null}},computed:{task(){return this.$store.getters[`${k.Model.Tasks}/getById`](this.taskId)},deadlineTs(){var t;return(t=this.selectingDeadlineTs)!=null?t:this.task.deadlineTs},expiredDuration(){if(!this.deadlineTs){return 0}return this.nowTs-this.deadlineTs},isExpired(){return this.expiredDuration>0&&!this.isFlowFilledOnAdd},expiredFormatted(){return this.loc("TASKS_V2_DEADLINE_EXPIRED",{"#EXPIRED_DURATION#":new d.DurationFormat(this.expiredDuration).formatClosest()})},deadlineFormatted(){if(this.isFlowFilledOnAdd){return this.loc("TASKS_V2_DEADLINE_AUTO")}if(!this.deadlineTs){return this.loc("TASKS_V2_DEADLINE_EMPTY")}return h.calendar.formatDateTime(this.deadlineTs)},iconName(){if(this.isFlowFilledOnAdd){return o.Outline.BOTTLENECK}return o.Outline.CALENDAR_WITH_SLOTS},isEdit(){return Number.isInteger(this.taskId)&&this.taskId>0},isFlowFilledOnAdd(){return this.task.flowId>0&&!this.isEdit},readonly(){return!this.task.rights.deadline||this.isFlowFilledOnAdd}},mounted(){i.heightTransition.animate(this.$refs.container);this.nowTsInterval=setInterval((()=>{this.nowTs=Date.now()}),1e3)},updated(){i.heightTransition.animate(this.$refs.container)},beforeUnmount(){clearInterval(this.nowTsInterval)},methods:{handleClick(){if(this.readonly){return}this.isPopupShown=true},handleCrossClick(){var t;(t=this.$refs.popup)==null?void 0:t.clear();void a.taskService.update(this.taskId,{deadlineTs:0})},handleUpdate(t){this.selectingDeadlineTs=t},handleClose(){var t,e;this.isPopupShown=false;this.selectingDeadlineTs=null;(t=this.$refs.deadline)==null?void 0:(e=t.$el)==null?void 0:e.focus()},handleKeydown(t){if(t.key==="Enter"&&!(t.ctrlKey||t.metaKey)){void this.handleClick()}}},template:`\n\t\t<div\n\t\t\tclass="tasks-field-deadline"\n\t\t\t:class="{ '--expired': isExpired, '--readonly': readonly, '--filled': deadlineTs }"\n\t\t\t:data-task-id="taskId"\n\t\t\t:data-task-field-id="deadlineMeta.id"\n\t\t\t:data-task-field-value="task.deadlineTs"\n\t\t\tref="container"\n\t\t>\n\t\t\t<HoverPill\n\t\t\t\t:withClear="Boolean(deadlineTs) && !readonly"\n\t\t\t\t:readonly="readonly"\n\t\t\t\tref="deadline"\n\t\t\t\t@click="handleClick"\n\t\t\t\t@clear="handleCrossClick"\n\t\t\t\t@keydown="handleKeydown"\n\t\t\t>\n\t\t\t\t<BIcon class="tasks-field-deadline-icon" :name="iconName"/>\n\t\t\t\t<TextMd class="tasks-field-deadline-text" :accent="isExpired">{{ deadlineFormatted }}</TextMd>\n\t\t\t</HoverPill>\n\t\t\t<Text2Xs v-if="isExpired" class="tasks-field-deadline-expired">{{ expiredFormatted }}</Text2Xs>\n\t\t</div>\n\t\t<DeadlinePopup\n\t\t\tv-if="isPopupShown"\n\t\t\t:taskId="taskId"\n\t\t\t:bindElement="$refs.deadline.$el"\n\t\t\tref="popup"\n\t\t\t@update="handleUpdate"\n\t\t\t@close="handleClose"\n\t\t/>\n\t`};t.Deadline=I;t.DeadlinePopup=D;t.deadlineMeta=f})(this.BX.Tasks.V2.Component.Fields=this.BX.Tasks.V2.Component.Fields||{},BX.UI.System.Typography.Vue,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Lib,BX.UI.Vue3.Components,BX.Tasks.V2.Provider.Service,BX.Main,BX.UI.DatePicker,BX.UI.IconSet,BX.UI.IconSet,BX,BX.Tasks.V2.Lib,BX.Tasks.V2.Lib,BX.Tasks.V2.Lib,BX,BX.Tasks.V2.Const);
//# sourceMappingURL=deadline.bundle.map.js