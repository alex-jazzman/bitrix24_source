this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};this.BX.Tasks.V2=this.BX.Tasks.V2||{};this.BX.Tasks.V2.Component=this.BX.Tasks.V2.Component||{};(function(t,e,s,a,i,r,n,l,o,d,h,c,p,k,u,b,v){"use strict";const T=Object.freeze({id:u.TaskField.Parent,title:l.Loc.getMessage("TASKS_V2_PARENT_TASK_TITLE")});var B=babelHelpers.classPrivateFieldLooseKey("taskId");var P=babelHelpers.classPrivateFieldLooseKey("dialog");var I=babelHelpers.classPrivateFieldLooseKey("onUpdateOnce");var f=babelHelpers.classPrivateFieldLooseKey("createDialog");var y=babelHelpers.classPrivateFieldLooseKey("onItemChange");var m=babelHelpers.classPrivateFieldLooseKey("clearOnUpdateOnce");var g=babelHelpers.classPrivateFieldLooseKey("items");var L=babelHelpers.classPrivateFieldLooseKey("task");class F{constructor(){Object.defineProperty(this,L,{get:X,set:void 0});Object.defineProperty(this,g,{get:C,set:void 0});Object.defineProperty(this,y,{value:H});Object.defineProperty(this,f,{value:S});Object.defineProperty(this,B,{writable:true,value:void 0});Object.defineProperty(this,P,{writable:true,value:void 0});Object.defineProperty(this,I,{writable:true,value:null});Object.defineProperty(this,m,{writable:true,value:()=>{babelHelpers.classPrivateFieldLooseBase(this,I)[I]=null}})}setTaskId(t){babelHelpers.classPrivateFieldLooseBase(this,B)[B]=t;return this}showTo(t){var e,s;(s=(e=babelHelpers.classPrivateFieldLooseBase(this,P))[P])!=null?s:e[P]=babelHelpers.classPrivateFieldLooseBase(this,f)[f]();babelHelpers.classPrivateFieldLooseBase(this,P)[P].selectItemsByIds(babelHelpers.classPrivateFieldLooseBase(this,g)[g]);babelHelpers.classPrivateFieldLooseBase(this,P)[P].showTo(t)}onUpdateOnce(t){babelHelpers.classPrivateFieldLooseBase(this,I)[I]=t}}function S(){const t=l.Runtime.debounce(babelHelpers.classPrivateFieldLooseBase(this,y)[y],10,this);return new c.EntitySelectorDialog({context:"tasks-card",multiple:false,enableSearch:true,width:500,entities:[{id:u.EntitySelectorEntity.Task}],preselectedItems:babelHelpers.classPrivateFieldLooseBase(this,g)[g],events:{"Item:onSelect":t,"Item:onDeselect":t,onHide:babelHelpers.classPrivateFieldLooseBase(this,m)[m],onDestroy:babelHelpers.classPrivateFieldLooseBase(this,m)[m]}})}async function H(){var t,e,s,a;const i=(t=(e=babelHelpers.classPrivateFieldLooseBase(this,P)[P].getSelectedItems()[0])==null?void 0:e.getId())!=null?t:0;if(i>0){const t=await h.subTasksService.setParent(babelHelpers.classPrivateFieldLooseBase(this,B)[B],i);if(t){void d.relationError.setTaskId(babelHelpers.classPrivateFieldLooseBase(this,B)[B]).showError(t,u.TaskField.Parent);return}}else if(i===0&&babelHelpers.classPrivateFieldLooseBase(this,L)[L].parentId>0){await h.subTasksService.delete(babelHelpers.classPrivateFieldLooseBase(this,L)[L].parentId,[babelHelpers.classPrivateFieldLooseBase(this,B)[B]])}(s=(a=babelHelpers.classPrivateFieldLooseBase(this,I))[I])==null?void 0:s.call(a);babelHelpers.classPrivateFieldLooseBase(this,m)[m]()}function C(){return babelHelpers.classPrivateFieldLooseBase(this,L)[L].parentId?[[u.EntitySelectorEntity.Task,babelHelpers.classPrivateFieldLooseBase(this,L)[L].parentId]]:[]}function X(){return o.Core.getStore().getters[`${u.Model.Tasks}/getById`](babelHelpers.classPrivateFieldLooseBase(this,B)[B])}const O=new F;const w={name:"TaskParentTask",components:{BIcon:a.BIcon,TaskList:i.TaskList,TextMd:s.TextMd},directives:{hint:e.hint},props:{taskId:{type:[Number,String],required:true}},setup(){return{Outline:a.Outline,parentTaskMeta:T}},computed:{task(){return this.$store.getters[`${u.Model.Tasks}/getById`](this.taskId)},parentTask(){return this.$store.getters[`${u.Model.Tasks}/getById`](this.parentId)},parentId(){return this.task.parentId},hasParent(){return this.task.parentId>0},parentTaskIds(){return this.hasParent?[this.task.parentId]:[]},text(){return T.title},context(){return T.id},readonly(){return!this.task.rights.edit},tooltip(){return()=>r.tooltip({text:this.loc("TASKS_V2_PARENT_TASK_SELECT"),popupOptions:{offsetLeft:this.$refs.add.$el.offsetWidth/2}})}},watch:{parentId:{immediate:true,handler(){if(this.hasParent){void this.loadParentTask()}}}},methods:{async loadParentTask(){if(this.parentTask){return}await n.taskService.getById(this.parentId)},handleTitleClick(){if(this.readonly){return}O.setTaskId(this.taskId).showTo(this.$refs.title)},handleEditClick(){O.setTaskId(this.taskId).showTo(this.$refs.add.$el)},async handleRemoveParentTask(t){await h.subTasksService.delete(t,[this.taskId])}},template:`\n\t\t<div\n\t\t\tclass="tasks-field-parent-task"\n\t\t\t:data-task-id="taskId"\n\t\t\t:data-task-field-id="parentTaskMeta.id"\n\t\t>\n\t\t\t<div class="tasks-field-parent-task-title">\n\t\t\t\t<div\n\t\t\t\t\tclass="tasks-field-parent-task-main"\n\t\t\t\t\t:class="{ '--readonly': readonly }"\n\t\t\t\t\tref="title"\n\t\t\t\t\t@click="handleTitleClick"\n\t\t\t\t>\n\t\t\t\t\t<BIcon :name="Outline.SUBTASK"/>\n\t\t\t\t\t<TextMd :accent="true">{{ text }}</TextMd>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tv-if="!readonly"\n\t\t\t\t\tv-hint="tooltip"\n\t\t\t\t\tclass="tasks-field-parent-task-edit-container"\n\t\t\t\t>\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\tclass="tasks-field-parent-task-icon"\n\t\t\t\t\t\t:name="Outline.PLUS_L"\n\t\t\t\t\t\t:hoverable="true"\n\t\t\t\t\t\t:data-task-relation-add="parentTaskMeta.id"\n\t\t\t\t\t\tref="add"\n\t\t\t\t\t\t@click="handleEditClick"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<TaskList\n\t\t\t\tv-if="hasParent"\n\t\t\t\t:readonly="readonly"\n\t\t\t\t:context="context"\n\t\t\t\t:taskIds="parentTaskIds"\n\t\t\t\t@removeTask="handleRemoveParentTask"\n\t\t\t/>\n\t\t</div>\n\t`};const A={components:{Chip:b.Chip},props:{taskId:{type:[Number,String],required:true},isAutonomous:{type:Boolean,default:false}},setup(){return{parentTaskMeta:T,Outline:p.Outline}},computed:{task(){return this.$store.getters[`${u.Model.Tasks}/getById`](this.taskId)},parentTask(){return this.$store.getters[`${u.Model.Tasks}/getById`](this.task.parentId)},hasParent(){return this.task.parentId>0},icon(){return p.Outline.SUBTASK},design(){return{[!this.isAutonomous&&!this.isSelected]:b.ChipDesign.ShadowNoAccent,[!this.isAutonomous&&this.isSelected]:b.ChipDesign.ShadowAccent,[this.isAutonomous&&!this.isSelected]:b.ChipDesign.OutlineNoAccent,[this.isAutonomous&&this.isSelected]:b.ChipDesign.OutlineAccent}.true},isSelected(){if(this.isAutonomous){return this.hasParent}return this.$store.getters[`${u.Model.Tasks}/wasFieldFilled`](this.taskId,T.id)},readonly(){return!this.task.rights.edit},text(){return T.title}},methods:{handleClick(){if(!this.isAutonomous&&this.isSelected){this.highlightField();return}O.setTaskId(this.taskId).showTo(this.$el);if(!this.isAutonomous){O.onUpdateOnce(this.highlightField)}},highlightField(){void v.fieldHighlighter.setContainer(this.$root.$el).highlight(T.id)}},template:`\n\t\t<Chip\n\t\t\tv-if="isSelected || !readonly"\n\t\t\t:design="design"\n\t\t\t:text="text"\n\t\t\t:icon="icon"\n\t\t\t:data-task-id="taskId"\n\t\t\t:data-task-chip-id="parentTaskMeta.id"\n\t\t\tref="chip"\n\t\t\t@click="handleClick"\n\t\t/>\n\t`};t.ParentTask=w;t.ParentTaskChip=A;t.parentTaskMeta=T})(this.BX.Tasks.V2.Component.Fields=this.BX.Tasks.V2.Component.Fields||{},BX.Vue3.Directives,BX.UI.System.Typography.Vue,BX.UI.IconSet,BX.Tasks.V2.Component,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Provider.Service,BX,BX.Tasks.V2,BX.Tasks.V2.Lib,BX.Tasks.V2.Provider.Service,BX.Tasks.V2.Lib,BX.UI.IconSet,BX,BX.Tasks.V2.Const,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Lib);
//# sourceMappingURL=parent-task.bundle.map.js