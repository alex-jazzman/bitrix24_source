{"version":3,"file":"drop-zone.bundle.js","sources":["../src/drop-zone.js"],"sourcesContent":["import { Event, Type } from 'main.core';\n\nimport { hasDataTransferOnlyFiles } from 'ui.uploader.core';\nimport { BIcon, Main } from 'ui.icon-set.api.vue';\nimport 'ui.icon-set.main';\n\nimport { Model } from 'tasks.v2.const';\nimport { fileService, type FileService } from 'tasks.v2.provider.service.file-service';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nimport './drop-zone.css';\n\n// @vue/component\nexport const DropZone = {\n\tcomponents: {\n\t\tBIcon,\n\t},\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tbottom: {\n\t\t\ttype: Number,\n\t\t\tdefault: 100,\n\t\t},\n\t},\n\tsetup(props): { fileService: FileService }\n\t{\n\t\treturn {\n\t\t\tMain,\n\t\t\tfileService: fileService.get(props.taskId),\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tshowDropArea: false,\n\t\t\tlastDropAreaEnterTarget: null,\n\t\t};\n\t},\n\tcomputed: {\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.taskId);\n\t\t},\n\t\treadonly(): boolean\n\t\t{\n\t\t\treturn !this.task.rights.edit;\n\t\t},\n\t\tdropAreaStyles(): {[bottom: string]: string}\n\t\t{\n\t\t\treturn {\n\t\t\t\tbottom: `${this.bottom}px`,\n\t\t\t};\n\t\t},\n\t\ticonSize(): number\n\t\t{\n\t\t\treturn 69;\n\t\t},\n\t\tcontainer(): ?HTMLElement\n\t\t{\n\t\t\treturn this.$parent?.$el;\n\t\t},\n\t},\n\tmounted(): void\n\t{\n\t\tif (!Type.isElementNode(this.container) || this.readonly)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.bindEvents();\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tif (!Type.isElementNode(this.container) || this.readonly)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.unbindEvents();\n\t},\n\tmethods: {\n\t\tbindEvents(): void\n\t\t{\n\t\t\tthis.fileService.getAdapter().getUploader().assignDropzone(this.container);\n\n\t\t\tEvent.bind(this.container, 'dragenter', this.onDragEnter);\n\t\t\tEvent.bind(this.container, 'dragleave', this.onDragLeave);\n\t\t\tEvent.bind(this.container, 'drop', this.onDrop);\n\t\t},\n\t\tunbindEvents(): void\n\t\t{\n\t\t\tthis.fileService.getAdapter().getUploader().unassignDropzone(this.container);\n\n\t\t\tEvent.unbind(this.container, 'dragenter', this.onDragEnter);\n\t\t\tEvent.unbind(this.container, 'dragleave', this.onDragLeave);\n\t\t\tEvent.unbind(this.container, 'drop', this.onDrop);\n\t\t},\n\t\tasync onDragEnter(event: DragEvent): Promise<void>\n\t\t{\n\t\t\tevent.stopPropagation();\n\t\t\tevent.preventDefault();\n\n\t\t\tconst success = await hasDataTransferOnlyFiles(event.dataTransfer, false);\n\t\t\tif (!success)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.lastDropAreaEnterTarget = event.target;\n\t\t\tthis.showDropArea = true;\n\t\t},\n\t\tonDragLeave(event: DragEvent): void\n\t\t{\n\t\t\tevent.stopPropagation();\n\t\t\tevent.preventDefault();\n\n\t\t\tif (this.lastDropAreaEnterTarget !== event.target)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.showDropArea = false;\n\t\t},\n\t\tasync onDrop(event: DragEvent): Promise<void>\n\t\t{\n\t\t\tevent.preventDefault();\n\n\t\t\tthis.showDropArea = false;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Transition name=\"tasks-drop-zone-fade\">\n\t\t\t<div v-if=\"showDropArea\" :style=\"dropAreaStyles\" class=\"tasks-drop-zone__container\">\n\t\t\t\t<div class=\"tasks-drop-zone__box\">\n\t\t\t\t\t<BIcon :name=\"Main.ATTACH\" :size=\"iconSize\" class=\"tasks-drop-zone__icon\"/>\n\t\t\t\t\t<label class=\"tasks-drop-zone__label_text\">{{ loc('TASKS_V2_DROP_ZONE_TITLE') }}</label>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</Transition>\n\t`,\n};\n"],"names":["DropZone","components","BIcon","props","taskId","type","Number","String","required","bottom","default","setup","Main","fileService","get","data","showDropArea","lastDropAreaEnterTarget","computed","task","$store","getters","Model","Tasks","readonly","rights","edit","dropAreaStyles","iconSize","container","$parent","$el","mounted","Type","isElementNode","bindEvents","beforeUnmount","unbindEvents","methods","getAdapter","getUploader","assignDropzone","Event","bind","onDragEnter","onDragLeave","onDrop","unassignDropzone","unbind","event","stopPropagation","preventDefault","success","hasDataTransferOnlyFiles","dataTransfer","target","template"],"mappings":"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"}