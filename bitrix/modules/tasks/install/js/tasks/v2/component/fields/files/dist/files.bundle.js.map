{"version":3,"file":"files.bundle.js","sources":["../src/files-meta.js","../src/files.js","../src/component/upload-button.js","../src/component/download-archive-button.js","../src/files-sheet.js","../src/files-popup/files-popup.js","../src/files-chip.js"],"sourcesContent":["import { Loc } from 'main.core';\nimport { TaskField } from 'tasks.v2.const';\n\nexport const filesMeta = Object.freeze({\n\tid: TaskField.Files,\n\ttitle: Loc.getMessage('TASKS_V2_FILES_TITLE'),\n});\n","import { Type } from 'main.core';\nimport { FileStatus } from 'ui.uploader.core';\nimport { BIcon } from 'ui.icon-set.api.vue';\nimport { Animated, Outline } from 'ui.icon-set.api.core';\nimport 'ui.icon-set.animated';\nimport 'ui.icon-set.outline';\nimport type { VueUploaderAdapter } from 'ui.uploader.vue';\nimport { hint, type HintParams } from 'ui.vue3.directives.hint';\n\nimport { UserFieldWidgetComponent, type UserFieldWidgetOptions } from 'disk.uploader.user-field-widget';\nimport { Model } from 'tasks.v2.const';\nimport { fileService, type FileService } from 'tasks.v2.provider.service.file-service';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\nimport { tooltip } from 'tasks.v2.component.elements.hint';\n\nimport { filesMeta } from './files-meta';\nimport './files.css';\n\n// @vue/component\nexport const Files = {\n\tname: 'TaskFiles',\n\tcomponents: {\n\t\tBIcon,\n\t\tUserFieldWidgetComponent,\n\t},\n\tdirectives: { hint },\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['open'],\n\tsetup(props): { uploaderAdapter: VueUploaderAdapter, fileService: FileService }\n\t{\n\t\treturn {\n\t\t\tAnimated,\n\t\t\tOutline,\n\t\t\tfilesMeta,\n\t\t\tfileService: fileService.get(props.taskId),\n\t\t\tuploaderAdapter: fileService.get(props.taskId).getAdapter(),\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tfiles: this.fileService.getFiles(),\n\t\t\tisFilesScrollable: false,\n\t\t\tshowPreview: false,\n\t\t};\n\t},\n\tcomputed: {\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.taskId);\n\t\t},\n\t\tfilesCount(): number\n\t\t{\n\t\t\treturn this.files.length;\n\t\t},\n\t\ttextFormatted(): string\n\t\t{\n\t\t\tif (this.filesCount > 0)\n\t\t\t{\n\t\t\t\treturn this.loc('TASKS_V2_FILES_COUNT', {\n\t\t\t\t\t'#COUNT#': this.filesCount,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn this.loc('TASKS_V2_FILES_TITLE');\n\t\t},\n\t\tisUploading(): boolean\n\t\t{\n\t\t\treturn this.files.some(({ status }) => [\n\t\t\t\tFileStatus.UPLOADING,\n\t\t\t\tFileStatus.LOADING,\n\t\t\t].includes(status));\n\t\t},\n\t\tcanAttachFiles(): boolean\n\t\t{\n\t\t\treturn this.task.rights.attachFile || this.task.rights.edit;\n\t\t},\n\t\tisEdit(): boolean\n\t\t{\n\t\t\treturn Type.isNumber(this.taskId) && this.taskId > 0;\n\t\t},\n\t\twidgetOptions(): UserFieldWidgetOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tisEmbedded: true,\n\t\t\t\twithControlPanel: false,\n\t\t\t\tcanCreateDocuments: false,\n\t\t\t\ttileWidgetOptions: {\n\t\t\t\t\tcompact: true,\n\t\t\t\t\thideDropArea: true,\n\t\t\t\t\tenableDropzone: false,\n\t\t\t\t\treadonly: !this.canAttachFiles,\n\t\t\t\t\tautoCollapse: false,\n\t\t\t\t\tremoveFromServer: !this.isEdit,\n\t\t\t\t\tforceDisableSelection: true,\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\ttooltip(): Function\n\t\t{\n\t\t\treturn (): HintParams => tooltip({\n\t\t\t\ttext: this.loc('TASKS_V2_FILES_ADD'),\n\t\t\t\tpopupOptions: {\n\t\t\t\t\toffsetLeft: this.$refs.add.$el.offsetWidth / 2,\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t},\n\twatch: {\n\t\tfiles: {\n\t\t\thandler(newFiles): void\n\t\t\t{\n\t\t\t\tif (newFiles.length > 0 && this.fileService.isFileBrowserClosed())\n\t\t\t\t{\n\t\t\t\t\tthis.showPreview = true;\n\t\t\t\t\tthis.fileService.resetFileBrowserClosedState();\n\t\t\t\t}\n\t\t\t\tthis.handleFilesScrollable();\n\t\t\t},\n\t\t\tdeep: true,\n\t\t},\n\t},\n\tmounted(): void\n\t{\n\t\tthis.showPreview = this.isEdit;\n\n\t\tthis.fileService.subscribe('onFileAdd', this.handleFilesScrollable);\n\t\tthis.fileService.subscribe('onFileRemove', this.handleFilesScrollable);\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tthis.fileService.unsubscribe('onFileAdd', this.handleFilesScrollable);\n\t\tthis.fileService.unsubscribe('onFileRemove', this.handleFilesScrollable);\n\t},\n\tmethods: {\n\t\thandleAddClick(): void\n\t\t{\n\t\t\tthis.fileService.browse({\n\t\t\t\tbindElement: this.$refs.add.$el,\n\t\t\t\tonHideCallback: this.onFileBrowserClose,\n\t\t\t});\n\t\t},\n\t\thandleOpenClick(): void\n\t\t{\n\t\t\tif (this.filesCount === 0)\n\t\t\t{\n\t\t\t\tthis.fileService.browse({\n\t\t\t\t\tbindElement: this.$refs.title,\n\t\t\t\t\tonHideCallback: this.onFileBrowserClose,\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.$emit('open');\n\t\t\t}\n\t\t},\n\t\tasync handleFilesScrollable(): void\n\t\t{\n\t\t\tawait this.$nextTick();\n\n\t\t\tthis.checkFilesScrollable();\n\t\t},\n\t\tcheckFilesScrollable(): void\n\t\t{\n\t\t\tif (this.$refs.files)\n\t\t\t{\n\t\t\t\tthis.isFilesScrollable = this.$refs.files.scrollHeight > this.$refs.files.clientHeight;\n\t\t\t}\n\t\t},\n\t\tonFileBrowserClose(): void\n\t\t{\n\t\t\tthis.fileService.setFileBrowserClosed(true);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"tasks-field-files\"\n\t\t\t:data-task-id=\"taskId\"\n\t\t\t:data-task-field-id=\"filesMeta.id\"\n\t\t\t:data-task-files-count=\"filesCount\"\n\t\t>\n\t\t\t<div class=\"tasks-field-files-title\">\n\t\t\t\t<div\n\t\t\t\t\tclass=\"tasks-field-files-main\"\n\t\t\t\t\tdata-task-files-open\n\t\t\t\t\t@click=\"handleOpenClick\"\n\t\t\t\t\tref=\"title\"\n\t\t\t\t>\n\t\t\t\t\t<template v-if=\"isUploading\">\n\t\t\t\t\t\t<BIcon class=\"tasks-field-files-icon\" :name=\"Animated.LOADER_WAIT\"/>\n\t\t\t\t\t\t<div class=\"tasks-field-files-text\">{{ loc('TASKS_V2_FILES_LOADING') }}</div>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t<BIcon class=\"tasks-field-files-icon\" :name=\"Outline.ATTACH\"/>\n\t\t\t\t\t\t<div class=\"tasks-field-files-text\">{{ textFormatted }}</div>\n\t\t\t\t\t</template>\n\t\t\t\t</div>\n\t\t\t\t<div v-if=\"canAttachFiles\" class=\"tasks-field-files-add-container\" v-hint=\"tooltip\">\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\tclass=\"tasks-field-files-add\"\n\t\t\t\t\t\t:name=\"Outline.PLUS_L\"\n\t\t\t\t\t\t:hoverable=\"true\"\n\t\t\t\t\t\tdata-task-files-plus\n\t\t\t\t\t\t@click=\"handleAddClick\"\n\t\t\t\t\t\tref=\"add\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if=\"showPreview && filesCount > 0\"\n\t\t\t\tclass=\"tasks-field-files-list --card\"\n\t\t\t\tref=\"files\"\n\t\t\t>\n\t\t\t\t<UserFieldWidgetComponent\n\t\t\t\t\t:uploaderAdapter=\"uploaderAdapter\"\n\t\t\t\t\t:widgetOptions=\"widgetOptions\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<template v-if=\"isFilesScrollable\">\n\t\t\t\t<div class=\"tasks-field-files-shadow\">\n\t\t\t\t\t<div class=\"tasks-field-files-shadow-white\"/>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tclass=\"tasks-field-files-more-button\"\n\t\t\t\t\t@click=\"$emit('open')\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"tasks-field-files-more-button-text\">\n\t\t\t\t\t\t{{ loc('TASKS_V2_FILES_MORE') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\t`,\n};\n","import { fileService } from 'tasks.v2.provider.service.file-service';\nimport { Button as UiButton, ButtonSize, AirButtonStyle } from 'ui.vue3.components.button';\nimport { Outline } from 'ui.icon-set.api.vue';\n\n// @vue/component\nexport const UploadButton = {\n\tcomponents: {\n\t\tUiButton,\n\t},\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t},\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tButtonSize,\n\t\t\tAirButtonStyle,\n\t\t\tOutline,\n\t\t};\n\t},\n\tmethods: {\n\t\thandleClick(): void\n\t\t{\n\t\t\tfileService.get(this.taskId).browse({\n\t\t\t\tbindElement: this.$el,\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<span data-task-files-upload>\n\t\t\t<UiButton\n\t\t\t\t:text=\"loc('TASKS_V2_FILES_UPLOAD')\"\n\t\t\t\t:size=\"ButtonSize.MEDIUM\"\n\t\t\t\t:style=\"AirButtonStyle.SELECTION\"\n\t\t\t\t:leftIcon=\"Outline.ATTACH\"\n\t\t\t\t@click=\"handleClick\"\n\t\t\t/>\n\t\t</span>\n\t`,\n};\n","import { type UploaderFileInfo, formatFileSize } from 'ui.uploader.core';\nimport { Button as UiButton, ButtonSize, AirButtonStyle, ButtonCounterColor } from 'ui.vue3.components.button';\nimport { Outline } from 'ui.icon-set.api.vue';\n\nimport { Model } from 'tasks.v2.const';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\n// @vue/component\nexport const DownloadArchiveButton = {\n\tcomponents: {\n\t\tUiButton,\n\t},\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tfiles: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tButtonSize,\n\t\t\tAirButtonStyle,\n\t\t\tButtonCounterColor,\n\t\t\tOutline,\n\t\t};\n\t},\n\tcomputed: {\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.taskId);\n\t\t},\n\t\tarchiveLink(): ?string\n\t\t{\n\t\t\treturn this.task.archiveLink;\n\t\t},\n\t\tfilesSize(): number\n\t\t{\n\t\t\treturn this.files.reduce((total, file: UploaderFileInfo) => total + file.size, 0);\n\t\t},\n\t\tformattedFilesSize(): string\n\t\t{\n\t\t\treturn formatFileSize(this.filesSize);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<a :href=\"archiveLink\" data-task-files-download-archive>\n\t\t\t<UiButton\n\t\t\t\t:text=\"loc('TASKS_V2_FILES_DOWNLOAD_ARCHIVE', { '#FILES_SIZE#': formattedFilesSize })\"\n\t\t\t\t:size=\"ButtonSize.MEDIUM\"\n\t\t\t\t:style=\"AirButtonStyle.PLAIN_NO_ACCENT\"\n\t\t\t/>\n\t\t</a>\n\t`,\n};\n","import { Type } from 'main.core';\n\nimport { mapGetters } from 'ui.vue3.vuex';\nimport { BIcon } from 'ui.icon-set.api.vue';\nimport { Outline } from 'ui.icon-set.api.core';\nimport 'ui.icon-set.outline';\nimport type { VueUploaderAdapter } from 'ui.uploader.vue';\n\nimport { UserFieldWidgetComponent, type UserFieldWidgetOptions } from 'disk.uploader.user-field-widget';\nimport { Model } from 'tasks.v2.const';\nimport { BottomSheet } from 'tasks.v2.component.elements.bottom-sheet';\nimport { DropZone } from 'tasks.v2.component.drop-zone';\nimport { type FileService, fileService } from 'tasks.v2.provider.service.file-service';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nimport { UploadButton } from './component/upload-button';\nimport { DownloadArchiveButton } from './component/download-archive-button';\n\n// @vue/component\nexport const FilesSheet = {\n\tname: 'TaskFilesSheet',\n\tcomponents: {\n\t\tUserFieldWidgetComponent,\n\t\tUploadButton,\n\t\tDownloadArchiveButton,\n\t\tBottomSheet,\n\t\tBIcon,\n\t\tDropZone,\n\t},\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tisShown: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tgetBindElement: {\n\t\t\ttype: Function,\n\t\t\tdefault: null,\n\t\t},\n\t\tgetTargetContainer: {\n\t\t\ttype: Function,\n\t\t\tdefault: null,\n\t\t},\n\t},\n\temits: ['close'],\n\tsetup(props): { fileService: FileService, uploaderAdapter: VueUploaderAdapter }\n\t{\n\t\treturn {\n\t\t\tOutline,\n\t\t\tfileService: fileService.get(props.taskId),\n\t\t\tuploaderAdapter: fileService.get(props.taskId).getAdapter(),\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tfiles: this.fileService.getFiles(),\n\t\t};\n\t},\n\tcomputed: {\n\t\t...mapGetters({\n\t\t\ttitleFieldOffsetHeight: `${Model.Interface}/titleFieldOffsetHeight`,\n\t\t}),\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.taskId);\n\t\t},\n\t\tcanAttachFiles(): boolean\n\t\t{\n\t\t\treturn this.task.rights.attachFile || this.task.rights.edit;\n\t\t},\n\t\tfilesCount(): number\n\t\t{\n\t\t\treturn this.files.length;\n\t\t},\n\t\tarchiveLink(): ?string\n\t\t{\n\t\t\treturn this.task.archiveLink;\n\t\t},\n\t\tisEdit(): boolean\n\t\t{\n\t\t\treturn Type.isNumber(this.taskId) && this.taskId > 0;\n\t\t},\n\t\twidgetOptions(): UserFieldWidgetOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tisEmbedded: true,\n\t\t\t\twithControlPanel: false,\n\t\t\t\tcanCreateDocuments: false,\n\t\t\t\ttileWidgetOptions: {\n\t\t\t\t\tcompact: true,\n\t\t\t\t\tautoCollapse: false,\n\t\t\t\t\treadonly: !this.canAttachFiles,\n\t\t\t\t\tenableDropzone: false,\n\t\t\t\t\thideDropArea: true,\n\t\t\t\t\tremoveFromServer: !this.isEdit,\n\t\t\t\t\tforceDisableSelection: true,\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\tshowFooter(): boolean\n\t\t{\n\t\t\treturn this.filesCount > 1 || this.canAttachFiles;\n\t\t},\n\t\tcanDownloadArchive(): boolean\n\t\t{\n\t\t\treturn this.filesCount > 1 && this.archiveLink;\n\t\t},\n\t},\n\twatch: {\n\t\ttitleFieldOffsetHeight(): void\n\t\t{\n\t\t\tthis.$refs.bottomSheet?.adjustPosition();\n\t\t},\n\t},\n\ttemplate: `\n\t\t<BottomSheet\n\t\t\tv-if=\"isShown\"\n\t\t\t:getBindElement=\"getBindElement\"\n\t\t\t:getTargetContainer=\"getTargetContainer\"\n\t\t\tref=\"bottomSheet\"\n\t\t>\n\t\t\t<div class=\"tasks-field-files-sheet\" :data-task-id=\"taskId\">\n\t\t\t\t<div class=\"tasks-field-files-header\">\n\t\t\t\t\t<div class=\"tasks-field-files-title\">\n\t\t\t\t\t\t{{ loc('TASKS_V2_FILES_TITLE') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\tdata-task-files-close\n\t\t\t\t\t\tclass=\"tasks-field-files-close\"\n\t\t\t\t\t\t:hoverable=\"true\"\n\t\t\t\t\t\t:name=\"Outline.CROSS_L\"\n\t\t\t\t\t\t@click=\"$emit('close')\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tasks-field-files-list\">\n\t\t\t\t\t<UserFieldWidgetComponent\n\t\t\t\t\t\t:uploaderAdapter=\"uploaderAdapter\"\n\t\t\t\t\t\t:widgetOptions=\"widgetOptions\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"showFooter\"\n\t\t\t\t\tclass=\"tasks-field-files-footer\"\n\t\t\t\t\t:class=\"{ '--with-archive': canDownloadArchive }\"\n\t\t\t\t>\n\t\t\t\t\t<DownloadArchiveButton\n\t\t\t\t\t\tv-if=\"canDownloadArchive\"\n\t\t\t\t\t\t:taskId=\"taskId\"\n\t\t\t\t\t\t:files=\"files\"\n\t\t\t\t\t/>\n\t\t\t\t\t<UploadButton v-if=\"canAttachFiles\" :taskId=\"taskId\"/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<DropZone :taskId=\"taskId\"/>\n\t\t</BottomSheet>\n\t`,\n};\n","import type { PopupOptions } from 'main.popup';\n\nimport { Popup } from 'ui.vue3.components.popup';\nimport { Button as UiButton, AirButtonStyle, ButtonSize, ButtonIcon } from 'ui.vue3.components.button';\nimport { Outline } from 'ui.icon-set.api.core';\nimport 'ui.icon-set.outline';\nimport type { VueUploaderAdapter } from 'ui.uploader.vue';\n\nimport { UserFieldWidgetComponent, type UserFieldWidgetOptions } from 'disk.uploader.user-field-widget';\nimport { fileService } from 'tasks.v2.provider.service.file-service';\nimport './files-popup.css';\n\n// @vue/component\nexport const FilesPopup = {\n\tcomponents: {\n\t\tPopup,\n\t\tUiButton,\n\t\tUserFieldWidgetComponent,\n\t},\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tgetBindElement: {\n\t\t\ttype: Function,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['upload', 'close'],\n\tsetup(props): { uploaderAdapter: VueUploaderAdapter }\n\t{\n\t\treturn {\n\t\t\tButtonSize,\n\t\t\tAirButtonStyle,\n\t\t\tButtonIcon,\n\t\t\tOutline,\n\t\t\tuploaderAdapter: fileService.get(props.taskId).getAdapter(),\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tfiles: fileService.get(this.taskId).getFiles(),\n\t\t};\n\t},\n\tcomputed: {\n\t\tbindElement(): HTMLElement\n\t\t{\n\t\t\treturn this.getBindElement();\n\t\t},\n\t\tpopupOptions(): PopupOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tid: 'tasks-field-files-popup',\n\t\t\t\tbindElement: this.bindElement,\n\t\t\t\tminWidth: 380,\n\t\t\t\tmaxHeight: 320,\n\t\t\t\tpadding: 18,\n\t\t\t\tbindOptions: {\n\t\t\t\t\tforceBindPosition: true,\n\t\t\t\t\tforceTop: true,\n\t\t\t\t\tposition: 'top',\n\t\t\t\t},\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tautoHideHandler: (event: MouseEvent): boolean => {\n\t\t\t\t\tconst anyTileMenuShown = this.files.some(({ isMenuShown }) => isMenuShown);\n\n\t\t\t\t\treturn this.$refs.popup?.autoHideHandler(event) && !anyTileMenuShown;\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\twidgetOptions(): UserFieldWidgetOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tisEmbedded: true,\n\t\t\t\twithControlPanel: false,\n\t\t\t\tcanCreateDocuments: false,\n\t\t\t\ttileWidgetOptions: {\n\t\t\t\t\thideDropArea: true,\n\t\t\t\t\tenableDropzone: false,\n\t\t\t\t\tcompact: true,\n\t\t\t\t\tautoCollapse: false,\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\tfilesCount(): number\n\t\t{\n\t\t\treturn this.files.length;\n\t\t},\n\t},\n\twatch: {\n\t\tfilesCount(): void\n\t\t{\n\t\t\tif (this.filesCount === 0)\n\t\t\t{\n\t\t\t\tthis.closePopup();\n\t\t\t}\n\t\t},\n\t},\n\tmethods: {\n\t\thandleClearClick(): void\n\t\t{\n\t\t\tfileService.get(this.taskId).getAdapter().getUploader().removeFiles();\n\n\t\t\tthis.closePopup();\n\t\t},\n\t\thandleUploadClick(): void\n\t\t{\n\t\t\tfileService.get(this.taskId).browseFiles();\n\t\t},\n\t\thandleMyDriveClick(): void\n\t\t{\n\t\t\tfileService.get(this.taskId).browseMyDrive();\n\t\t},\n\t\tclosePopup(): void\n\t\t{\n\t\t\tthis.$emit('close');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Popup\n\t\t\t:options=\"popupOptions\"\n\t\t\tref=\"popup\"\n\t\t\t@close=\"closePopup\"\n\t\t>\n\t\t\t<div class=\"tasks-field-files-popup\">\n\t\t\t\t<div class=\"tasks-field-files-popup-files\">\n\t\t\t\t\t<UserFieldWidgetComponent :uploaderAdapter=\"uploaderAdapter\" :widgetOptions=\"widgetOptions\"/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tasks-field-files-popup-footer\">\n\t\t\t\t\t<div class=\"tasks-field-files-popup-add-buttons\">\n\t\t\t\t\t\t<UiButton\n\t\t\t\t\t\t\t:text=\"loc('TASKS_V2_FILES_UPLOAD_BUTTON')\"\n\t\t\t\t\t\t\t:size=\"ButtonSize.SMALL\"\n\t\t\t\t\t\t\t:style=\"AirButtonStyle.TINTED\"\n\t\t\t\t\t\t\t:leftIcon=\"Outline.DOWNLOAD\"\n\t\t\t\t\t\t\t@click=\"handleUploadClick\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<UiButton\n\t\t\t\t\t\t\t:text=\"loc('TASKS_V2_FILES_MY_DRIVE')\"\n\t\t\t\t\t\t\t:size=\"ButtonSize.SMALL\"\n\t\t\t\t\t\t\t:style=\"AirButtonStyle.TINTED\"\n\t\t\t\t\t\t\t:leftIcon=\"Outline.UPLOAD\"\n\t\t\t\t\t\t\t@click=\"handleMyDriveClick\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<UiButton\n\t\t\t\t\t\t:text=\"loc('TASKS_V2_FILES_CLEAR')\"\n\t\t\t\t\t\t:size=\"ButtonSize.SMALL\"\n\t\t\t\t\t\t:style=\"AirButtonStyle.PLAIN_NO_ACCENT\"\n\t\t\t\t\t\t:leftIcon=\"Outline.TRASHCAN\"\n\t\t\t\t\t\t@click=\"handleClearClick\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</Popup>\n\t`,\n};\n","import { FileStatus, UploaderFileInfo } from 'ui.uploader.core';\nimport { Animated, Outline } from 'ui.icon-set.api.core';\nimport 'ui.icon-set.animated';\nimport 'ui.icon-set.outline';\n\nimport { Chip, ChipDesign } from 'tasks.v2.component.elements.chip';\nimport { GroupType, Model, CardType } from 'tasks.v2.const';\nimport { fieldHighlighter } from 'tasks.v2.lib.field-highlighter';\nimport { analytics } from 'tasks.v2.lib.analytics';\nimport { fileService, type FileService } from 'tasks.v2.provider.service.file-service';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\nimport type { GroupModel } from 'tasks.v2.model.groups';\n\nimport { filesMeta } from './files-meta';\nimport { FilesPopup } from './files-popup/files-popup';\n\n// @vue/component\nexport const FilesChip = {\n\tcomponents: {\n\t\tChip,\n\t\tFilesPopup,\n\t},\n\tinject: ['analytics', 'cardType'],\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tisAutonomous: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tsetup(props): { fileService: FileService }\n\t{\n\t\treturn {\n\t\t\tfilesMeta,\n\t\t\tfileService: fileService.get(props.taskId),\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tfiles: this.fileService.getFiles(),\n\t\t\tisPopupShown: false,\n\t\t\tisPopupShownWithFiles: false,\n\t\t};\n\t},\n\tcomputed: {\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.taskId);\n\t\t},\n\t\tgroup(): ?GroupModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Groups}/getById`](this.task.groupId);\n\t\t},\n\t\tfilesCount(): number\n\t\t{\n\t\t\treturn this.files.length;\n\t\t},\n\t\tdesign(): string\n\t\t{\n\t\t\treturn {\n\t\t\t\t[!this.isAutonomous && !this.isSelected]: ChipDesign.ShadowNoAccent,\n\t\t\t\t[!this.isAutonomous && this.isSelected]: ChipDesign.ShadowAccent,\n\t\t\t\t[this.isAutonomous && !this.isSelected]: ChipDesign.OutlineNoAccent,\n\t\t\t\t[this.isAutonomous && this.isSelected]: ChipDesign.OutlineAccent,\n\t\t\t\t[this.hasError]: ChipDesign.OutlineAlert,\n\t\t\t}.true;\n\t\t},\n\t\tisSelected(): boolean\n\t\t{\n\t\t\tif (this.isAutonomous)\n\t\t\t{\n\t\t\t\treturn this.files.length > 0;\n\t\t\t}\n\n\t\t\tconst wasFilesFilled = this.$store.getters[`${Model.Tasks}/wasFieldFilled`](this.taskId, filesMeta.id);\n\n\t\t\treturn wasFilesFilled || this.files.length > 0;\n\t\t},\n\t\ticon(): string\n\t\t{\n\t\t\tif (this.isAutonomous && this.isUploading)\n\t\t\t{\n\t\t\t\treturn Animated.LOADER_WAIT;\n\t\t\t}\n\n\t\t\treturn Outline.ATTACH;\n\t\t},\n\t\ttext(): string\n\t\t{\n\t\t\tif (this.isAutonomous && this.filesCount > 0)\n\t\t\t{\n\t\t\t\treturn this.loc('TASKS_V2_FILES_COUNT', {\n\t\t\t\t\t'#COUNT#': this.filesCount,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn filesMeta.title;\n\t\t},\n\t\tisUploading(): boolean\n\t\t{\n\t\t\treturn this.fileService.isUploading();\n\t\t},\n\t\thasError(): boolean\n\t\t{\n\t\t\treturn this.files.some(({ status }) => [FileStatus.UPLOAD_FAILED, FileStatus.LOAD_FAILED].includes(status));\n\t\t},\n\t\tcanAttachFiles(): boolean\n\t\t{\n\t\t\treturn this.task.rights.attachFile || this.task.rights.edit;\n\t\t},\n\t\tpopupHasAlreadyBeenShown(): boolean\n\t\t{\n\t\t\treturn this.filesCount > 0 && this.isPopupShownWithFiles;\n\t\t},\n\t},\n\tmounted(): void\n\t{\n\t\tthis.fileService.subscribe('onFileAdd', this.handleFileAdd);\n\t\tthis.fileService.subscribe('onFileComplete', this.handleFileComplete);\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tthis.fileService.unsubscribe('onFileAdd', this.handleFileAdd);\n\t\tthis.fileService.unsubscribe('onFileComplete', this.handleFileComplete);\n\t},\n\tmethods: {\n\t\thandleFileAdd(): void\n\t\t{\n\t\t\tif (this.isAutonomous && this.popupHasAlreadyBeenShown)\n\t\t\t{\n\t\t\t\tthis.showPopup();\n\t\t\t}\n\t\t},\n\t\thandleFileComplete(event): void\n\t\t{\n\t\t\tthis.sendAnalytics(event.getData());\n\t\t},\n\t\tsendAnalytics(file: UploaderFileInfo): void\n\t\t{\n\t\t\tanalytics.sendAttachFile(this.analytics, {\n\t\t\t\tcardType: this.cardType,\n\t\t\t\tcollabId: this.group?.type === GroupType.Collab ? this.group.id : null,\n\t\t\t\tfileOrigin: file.origin,\n\t\t\t\tfileSize: file.size,\n\t\t\t\tfileExtension: file.extension,\n\t\t\t\tfilesCount: this.filesCount,\n\t\t\t});\n\t\t},\n\t\thandleClick(): void\n\t\t{\n\t\t\tif (!this.isAutonomous && this.isSelected)\n\t\t\t{\n\t\t\t\tthis.highlightField();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.files.length > 0)\n\t\t\t{\n\t\t\t\tthis.isPopupShownWithFiles = true;\n\n\t\t\t\tthis.showPopup();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.browseFiles();\n\t\t\t}\n\t\t},\n\t\tshowPopup(): void\n\t\t{\n\t\t\tthis.isPopupShown = true;\n\t\t},\n\t\tclosePopup(): void\n\t\t{\n\t\t\tthis.isPopupShown = false;\n\n\t\t\tif (!this.filesCount)\n\t\t\t{\n\t\t\t\tthis.isPopupShownWithFiles = false;\n\t\t\t}\n\t\t},\n\t\tbrowseFiles(): void\n\t\t{\n\t\t\tthis.fileService.browse({\n\t\t\t\tbindElement: this.$refs.chip.$el,\n\t\t\t\tonHideCallback: this.onFileBrowserClose,\n\t\t\t\tcompact: this.cardType === CardType.Compact,\n\t\t\t});\n\t\t},\n\t\thighlightField(): void\n\t\t{\n\t\t\tvoid fieldHighlighter.setContainer(this.$root.$el).highlight(filesMeta.id);\n\t\t},\n\t\tonFileBrowserClose(): void\n\t\t{\n\t\t\tthis.$refs.chip?.$el.focus();\n\t\t\tthis.fileService.setFileBrowserClosed(true);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Chip\n\t\t\tv-if=\"isSelected || canAttachFiles\"\n\t\t\t:design=\"design\"\n\t\t\t:icon=\"icon\"\n\t\t\t:text=\"text\"\n\t\t\t:data-task-id=\"taskId\"\n\t\t\t:data-task-chip-id=\"filesMeta.id\"\n\t\t\tref=\"chip\"\n\t\t\t@click=\"handleClick\"\n\t\t/>\n\t\t<FilesPopup\n\t\t\tv-if=\"isPopupShown\"\n\t\t\t:taskId=\"taskId\"\n\t\t\t:getBindElement=\"() => $refs.chip.$el\"\n\t\t\t@upload=\"browseFiles\"\n\t\t\t@close=\"closePopup\"\n\t\t/>\n\t`,\n};\n"],"names":["filesMeta","Object","freeze","id","TaskField","Files","title","Loc","getMessage","name","components","BIcon","UserFieldWidgetComponent","directives","hint","props","taskId","type","Number","String","required","emits","setup","Animated","Outline","fileService","get","uploaderAdapter","getAdapter","data","files","getFiles","isFilesScrollable","showPreview","computed","task","$store","getters","Model","Tasks","filesCount","length","textFormatted","loc","isUploading","some","status","FileStatus","UPLOADING","LOADING","includes","canAttachFiles","rights","attachFile","edit","isEdit","Type","isNumber","widgetOptions","isEmbedded","withControlPanel","canCreateDocuments","tileWidgetOptions","compact","hideDropArea","enableDropzone","readonly","autoCollapse","removeFromServer","forceDisableSelection","tooltip","text","popupOptions","offsetLeft","$refs","add","$el","offsetWidth","watch","handler","newFiles","isFileBrowserClosed","resetFileBrowserClosedState","handleFilesScrollable","deep","mounted","subscribe","beforeUnmount","unsubscribe","methods","handleAddClick","browse","bindElement","onHideCallback","onFileBrowserClose","handleOpenClick","$emit","$nextTick","checkFilesScrollable","scrollHeight","clientHeight","setFileBrowserClosed","template","UploadButton","UiButton","ButtonSize","AirButtonStyle","handleClick","DownloadArchiveButton","Array","ButtonCounterColor","archiveLink","filesSize","reduce","total","file","size","formattedFilesSize","formatFileSize","FilesSheet","BottomSheet","DropZone","isShown","Boolean","getBindElement","Function","default","getTargetContainer","mapGetters","titleFieldOffsetHeight","Interface","showFooter","canDownloadArchive","bottomSheet","adjustPosition","FilesPopup","Popup","ButtonIcon","minWidth","maxHeight","padding","bindOptions","forceBindPosition","forceTop","position","closeByEsc","autoHideHandler","event","anyTileMenuShown","isMenuShown","popup","closePopup","handleClearClick","getUploader","removeFiles","handleUploadClick","browseFiles","handleMyDriveClick","browseMyDrive","FilesChip","Chip","inject","isAutonomous","isPopupShown","isPopupShownWithFiles","group","Groups","groupId","design","isSelected","ChipDesign","ShadowNoAccent","ShadowAccent","OutlineNoAccent","OutlineAccent","hasError","OutlineAlert","true","wasFilesFilled","icon","LOADER_WAIT","ATTACH","UPLOAD_FAILED","LOAD_FAILED","popupHasAlreadyBeenShown","handleFileAdd","handleFileComplete","showPopup","sendAnalytics","getData","analytics","sendAttachFile","cardType","collabId","GroupType","Collab","fileOrigin","origin","fileSize","fileExtension","extension","highlightField","chip","CardType","Compact","fieldHighlighter","setContainer","$root","highlight","focus"],"mappings":";;;;;;;;OAGaA,SAAS,GAAGC,MAAM,CAACC,MAAM,CAAC;GACtCC,EAAE,EAAEC,wBAAS,CAACC,KAAK;GACnBC,KAAK,EAAEC,aAAG,CAACC,UAAU,CAAC,sBAAsB;CAC7C,CAAC,CAAC;;CCYF;AACA,OAAaH,KAAK,GAAG;GACpBI,IAAI,EAAE,WAAW;GACjBC,UAAU,EAAE;YACXC,wBAAK;+BACLC;IACA;GACDC,UAAU,EAAE;WAAEC;IAAM;GACpBC,KAAK,EAAE;KACNC,MAAM,EAAE;OACPC,IAAI,EAAE,CAACC,MAAM,EAAEC,MAAM,CAAC;OACtBC,QAAQ,EAAE;;IAEX;GACDC,KAAK,EAAE,CAAC,MAAM,CAAC;GACfC,KAAK,CAACP,KAAK,EACX;KACC,OAAO;iBACNQ,4BAAQ;gBACRC,2BAAO;OACPxB,SAAS;OACTyB,WAAW,EAAEA,iDAAW,CAACC,GAAG,CAACX,KAAK,CAACC,MAAM,CAAC;OAC1CW,eAAe,EAAEF,iDAAW,CAACC,GAAG,CAACX,KAAK,CAACC,MAAM,CAAC,CAACY,UAAU;MACzD;IACD;GACDC,IAAI,GACJ;KACC,OAAO;OACNC,KAAK,EAAE,IAAI,CAACL,WAAW,CAACM,QAAQ,EAAE;OAClCC,iBAAiB,EAAE,KAAK;OACxBC,WAAW,EAAE;MACb;IACD;GACDC,QAAQ,EAAE;KACTC,IAAI,GACJ;OACC,OAAO,IAAI,CAACC,MAAM,CAACC,OAAO,CAAE,GAAEC,oBAAK,CAACC,KAAM,UAAS,CAAC,CAAC,IAAI,CAACvB,MAAM,CAAC;MACjE;KACDwB,UAAU,GACV;OACC,OAAO,IAAI,CAACV,KAAK,CAACW,MAAM;MACxB;KACDC,aAAa,GACb;OACC,IAAI,IAAI,CAACF,UAAU,GAAG,CAAC,EACvB;SACC,OAAO,IAAI,CAACG,GAAG,CAAC,sBAAsB,EAAE;WACvC,SAAS,EAAE,IAAI,CAACH;UAChB,CAAC;;OAGH,OAAO,IAAI,CAACG,GAAG,CAAC,sBAAsB,CAAC;MACvC;KACDC,WAAW,GACX;OACC,OAAO,IAAI,CAACd,KAAK,CAACe,IAAI,CAAC,CAAC;SAAEC;QAAQ,KAAK,CACtCC,2BAAU,CAACC,SAAS,EACpBD,2BAAU,CAACE,OAAO,CAClB,CAACC,QAAQ,CAACJ,MAAM,CAAC,CAAC;MACnB;KACDK,cAAc,GACd;OACC,OAAO,IAAI,CAAChB,IAAI,CAACiB,MAAM,CAACC,UAAU,IAAI,IAAI,CAAClB,IAAI,CAACiB,MAAM,CAACE,IAAI;MAC3D;KACDC,MAAM,GACN;OACC,OAAOC,cAAI,CAACC,QAAQ,CAAC,IAAI,CAACzC,MAAM,CAAC,IAAI,IAAI,CAACA,MAAM,GAAG,CAAC;MACpD;KACD0C,aAAa,GACb;OACC,OAAO;SACNC,UAAU,EAAE,IAAI;SAChBC,gBAAgB,EAAE,KAAK;SACvBC,kBAAkB,EAAE,KAAK;SACzBC,iBAAiB,EAAE;WAClBC,OAAO,EAAE,IAAI;WACbC,YAAY,EAAE,IAAI;WAClBC,cAAc,EAAE,KAAK;WACrBC,QAAQ,EAAE,CAAC,IAAI,CAACf,cAAc;WAC9BgB,YAAY,EAAE,KAAK;WACnBC,gBAAgB,EAAE,CAAC,IAAI,CAACb,MAAM;WAC9Bc,qBAAqB,EAAE;;QAExB;MACD;KACDC,OAAO,GACP;OACC,OAAO,MAAkBA,wCAAO,CAAC;SAChCC,IAAI,EAAE,IAAI,CAAC5B,GAAG,CAAC,oBAAoB,CAAC;SACpC6B,YAAY,EAAE;WACbC,UAAU,EAAE,IAAI,CAACC,KAAK,CAACC,GAAG,CAACC,GAAG,CAACC,WAAW,GAAG;;QAE9C,CAAC;;IAEH;GACDC,KAAK,EAAE;KACNhD,KAAK,EAAE;OACNiD,OAAO,CAACC,QAAQ,EAChB;SACC,IAAIA,QAAQ,CAACvC,MAAM,GAAG,CAAC,IAAI,IAAI,CAAChB,WAAW,CAACwD,mBAAmB,EAAE,EACjE;WACC,IAAI,CAAChD,WAAW,GAAG,IAAI;WACvB,IAAI,CAACR,WAAW,CAACyD,2BAA2B,EAAE;;SAE/C,IAAI,CAACC,qBAAqB,EAAE;QAC5B;OACDC,IAAI,EAAE;;IAEP;GACDC,OAAO,GACP;KACC,IAAI,CAACpD,WAAW,GAAG,IAAI,CAACsB,MAAM;KAE9B,IAAI,CAAC9B,WAAW,CAAC6D,SAAS,CAAC,WAAW,EAAE,IAAI,CAACH,qBAAqB,CAAC;KACnE,IAAI,CAAC1D,WAAW,CAAC6D,SAAS,CAAC,cAAc,EAAE,IAAI,CAACH,qBAAqB,CAAC;IACtE;GACDI,aAAa,GACb;KACC,IAAI,CAAC9D,WAAW,CAAC+D,WAAW,CAAC,WAAW,EAAE,IAAI,CAACL,qBAAqB,CAAC;KACrE,IAAI,CAAC1D,WAAW,CAAC+D,WAAW,CAAC,cAAc,EAAE,IAAI,CAACL,qBAAqB,CAAC;IACxE;GACDM,OAAO,EAAE;KACRC,cAAc,GACd;OACC,IAAI,CAACjE,WAAW,CAACkE,MAAM,CAAC;SACvBC,WAAW,EAAE,IAAI,CAAClB,KAAK,CAACC,GAAG,CAACC,GAAG;SAC/BiB,cAAc,EAAE,IAAI,CAACC;QACrB,CAAC;MACF;KACDC,eAAe,GACf;OACC,IAAI,IAAI,CAACvD,UAAU,KAAK,CAAC,EACzB;SACC,IAAI,CAACf,WAAW,CAACkE,MAAM,CAAC;WACvBC,WAAW,EAAE,IAAI,CAAClB,KAAK,CAACpE,KAAK;WAC7BuF,cAAc,EAAE,IAAI,CAACC;UACrB,CAAC;QACF,MAED;SACC,IAAI,CAACE,KAAK,CAAC,MAAM,CAAC;;MAEnB;KACD,MAAMb,qBAAqB,GAC3B;OACC,MAAM,IAAI,CAACc,SAAS,EAAE;OAEtB,IAAI,CAACC,oBAAoB,EAAE;MAC3B;KACDA,oBAAoB,GACpB;OACC,IAAI,IAAI,CAACxB,KAAK,CAAC5C,KAAK,EACpB;SACC,IAAI,CAACE,iBAAiB,GAAG,IAAI,CAAC0C,KAAK,CAAC5C,KAAK,CAACqE,YAAY,GAAG,IAAI,CAACzB,KAAK,CAAC5C,KAAK,CAACsE,YAAY;;MAEvF;KACDN,kBAAkB,GAClB;OACC,IAAI,CAACrE,WAAW,CAAC4E,oBAAoB,CAAC,IAAI,CAAC;;IAE5C;GACDC,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CA2DZ,CAAC;;CC1OD;AACA,CAAO,MAAMC,YAAY,GAAG;GAC3B7F,UAAU,EAAE;eACX8F;IACA;GACDzF,KAAK,EAAE;KACNC,MAAM,EAAE;OACPC,IAAI,EAAE,CAACC,MAAM,EAAEC,MAAM,CAAC;OACtBC,QAAQ,EAAE;;IAEX;GACDE,KAAK,GACL;KACC,OAAO;mBACNmF,oCAAU;uBACVC,wCAAc;gBACdlF;MACA;IACD;GACDiE,OAAO,EAAE;KACRkB,WAAW,GACX;OACClF,iDAAW,CAACC,GAAG,CAAC,IAAI,CAACV,MAAM,CAAC,CAAC2E,MAAM,CAAC;SACnCC,WAAW,EAAE,IAAI,CAAChB;QAClB,CAAC;;IAEH;GACD0B,QAAQ,EAAG;;;;;;;;;;;CAWZ,CAAC;;CCnCD;AACA,CAAO,MAAMM,qBAAqB,GAAG;GACpClG,UAAU,EAAE;eACX8F;IACA;GACDzF,KAAK,EAAE;KACNC,MAAM,EAAE;OACPC,IAAI,EAAE,CAACC,MAAM,EAAEC,MAAM,CAAC;OACtBC,QAAQ,EAAE;MACV;KACDU,KAAK,EAAE;OACNb,IAAI,EAAE4F,KAAK;OACXzF,QAAQ,EAAE;;IAEX;GACDE,KAAK,GACL;KACC,OAAO;mBACNmF,oCAAU;uBACVC,wCAAc;2BACdI,4CAAkB;gBAClBtF;MACA;IACD;GACDU,QAAQ,EAAE;KACTC,IAAI,GACJ;OACC,OAAO,IAAI,CAACC,MAAM,CAACC,OAAO,CAAE,GAAEC,oBAAK,CAACC,KAAM,UAAS,CAAC,CAAC,IAAI,CAACvB,MAAM,CAAC;MACjE;KACD+F,WAAW,GACX;OACC,OAAO,IAAI,CAAC5E,IAAI,CAAC4E,WAAW;MAC5B;KACDC,SAAS,GACT;OACC,OAAO,IAAI,CAAClF,KAAK,CAACmF,MAAM,CAAC,CAACC,KAAK,EAAEC,IAAsB,KAAKD,KAAK,GAAGC,IAAI,CAACC,IAAI,EAAE,CAAC,CAAC;MACjF;KACDC,kBAAkB,GAClB;OACC,OAAOC,+BAAc,CAAC,IAAI,CAACN,SAAS,CAAC;;IAEtC;GACDV,QAAQ,EAAG;;;;;;;;;CASZ,CAAC;;CCxCD;AACA,OAAaiB,UAAU,GAAG;GACzB9G,IAAI,EAAE,gBAAgB;GACtBC,UAAU,EAAE;+BACXE,sDAAwB;KACxB2F,YAAY;KACZK,qBAAqB;kBACrBY,mDAAW;YACX7G,wBAAK;eACL8G;IACA;GACD1G,KAAK,EAAE;KACNC,MAAM,EAAE;OACPC,IAAI,EAAE,CAACC,MAAM,EAAEC,MAAM,CAAC;OACtBC,QAAQ,EAAE;MACV;KACDsG,OAAO,EAAE;OACRzG,IAAI,EAAE0G,OAAO;OACbvG,QAAQ,EAAE;MACV;KACDwG,cAAc,EAAE;OACf3G,IAAI,EAAE4G,QAAQ;OACdC,OAAO,EAAE;MACT;KACDC,kBAAkB,EAAE;OACnB9G,IAAI,EAAE4G,QAAQ;OACdC,OAAO,EAAE;;IAEV;GACDzG,KAAK,EAAE,CAAC,OAAO,CAAC;GAChBC,KAAK,CAACP,KAAK,EACX;KACC,OAAO;gBACNS,2BAAO;OACPC,WAAW,EAAEA,iDAAW,CAACC,GAAG,CAACX,KAAK,CAACC,MAAM,CAAC;OAC1CW,eAAe,EAAEF,iDAAW,CAACC,GAAG,CAACX,KAAK,CAACC,MAAM,CAAC,CAACY,UAAU;MACzD;IACD;GACDC,IAAI,GACJ;KACC,OAAO;OACNC,KAAK,EAAE,IAAI,CAACL,WAAW,CAACM,QAAQ;MAChC;IACD;GACDG,QAAQ,EAAE;KACT,GAAG8F,uBAAU,CAAC;OACbC,sBAAsB,EAAG,GAAE3F,oBAAK,CAAC4F,SAAU;MAC3C,CAAC;KACF/F,IAAI,GACJ;OACC,OAAO,IAAI,CAACC,MAAM,CAACC,OAAO,CAAE,GAAEC,oBAAK,CAACC,KAAM,UAAS,CAAC,CAAC,IAAI,CAACvB,MAAM,CAAC;MACjE;KACDmC,cAAc,GACd;OACC,OAAO,IAAI,CAAChB,IAAI,CAACiB,MAAM,CAACC,UAAU,IAAI,IAAI,CAAClB,IAAI,CAACiB,MAAM,CAACE,IAAI;MAC3D;KACDd,UAAU,GACV;OACC,OAAO,IAAI,CAACV,KAAK,CAACW,MAAM;MACxB;KACDsE,WAAW,GACX;OACC,OAAO,IAAI,CAAC5E,IAAI,CAAC4E,WAAW;MAC5B;KACDxD,MAAM,GACN;OACC,OAAOC,cAAI,CAACC,QAAQ,CAAC,IAAI,CAACzC,MAAM,CAAC,IAAI,IAAI,CAACA,MAAM,GAAG,CAAC;MACpD;KACD0C,aAAa,GACb;OACC,OAAO;SACNC,UAAU,EAAE,IAAI;SAChBC,gBAAgB,EAAE,KAAK;SACvBC,kBAAkB,EAAE,KAAK;SACzBC,iBAAiB,EAAE;WAClBC,OAAO,EAAE,IAAI;WACbI,YAAY,EAAE,KAAK;WACnBD,QAAQ,EAAE,CAAC,IAAI,CAACf,cAAc;WAC9Bc,cAAc,EAAE,KAAK;WACrBD,YAAY,EAAE,IAAI;WAClBI,gBAAgB,EAAE,CAAC,IAAI,CAACb,MAAM;WAC9Bc,qBAAqB,EAAE;;QAExB;MACD;KACD8D,UAAU,GACV;OACC,OAAO,IAAI,CAAC3F,UAAU,GAAG,CAAC,IAAI,IAAI,CAACW,cAAc;MACjD;KACDiF,kBAAkB,GAClB;OACC,OAAO,IAAI,CAAC5F,UAAU,GAAG,CAAC,IAAI,IAAI,CAACuE,WAAW;;IAE/C;GACDjC,KAAK,EAAE;KACNmD,sBAAsB,GACtB;OAAA;OACC,6BAAI,CAACvD,KAAK,CAAC2D,WAAW,qBAAtB,sBAAwBC,cAAc,EAAE;;IAEzC;GACDhC,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CA0CZ,CAAC;;CCpJD;AACA,CAAO,MAAMiC,UAAU,GAAG;GACzB7H,UAAU,EAAE;YACX8H,8BAAK;eACLhC,gCAAQ;+BACR5F;IACA;GACDG,KAAK,EAAE;KACNC,MAAM,EAAE;OACPC,IAAI,EAAE,CAACC,MAAM,EAAEC,MAAM,CAAC;OACtBC,QAAQ,EAAE;MACV;KACDwG,cAAc,EAAE;OACf3G,IAAI,EAAE4G,QAAQ;OACdzG,QAAQ,EAAE;;IAEX;GACDC,KAAK,EAAE,CAAC,QAAQ,EAAE,OAAO,CAAC;GAC1BC,KAAK,CAACP,KAAK,EACX;KACC,OAAO;mBACN0F,oCAAU;uBACVC,wCAAc;mBACd+B,oCAAU;gBACVjH,2BAAO;OACPG,eAAe,EAAEF,iDAAW,CAACC,GAAG,CAACX,KAAK,CAACC,MAAM,CAAC,CAACY,UAAU;MACzD;IACD;GACDC,IAAI,GACJ;KACC,OAAO;OACNC,KAAK,EAAEL,iDAAW,CAACC,GAAG,CAAC,IAAI,CAACV,MAAM,CAAC,CAACe,QAAQ;MAC5C;IACD;GACDG,QAAQ,EAAE;KACT0D,WAAW,GACX;OACC,OAAO,IAAI,CAACgC,cAAc,EAAE;MAC5B;KACDpD,YAAY,GACZ;OACC,OAAO;SACNrE,EAAE,EAAE,yBAAyB;SAC7ByF,WAAW,EAAE,IAAI,CAACA,WAAW;SAC7B8C,QAAQ,EAAE,GAAG;SACbC,SAAS,EAAE,GAAG;SACdC,OAAO,EAAE,EAAE;SACXC,WAAW,EAAE;WACZC,iBAAiB,EAAE,IAAI;WACvBC,QAAQ,EAAE,IAAI;WACdC,QAAQ,EAAE;UACV;SACDC,UAAU,EAAE,IAAI;SAChBC,eAAe,EAAGC,KAAiB,IAAc;WAAA;WAChD,MAAMC,gBAAgB,GAAG,IAAI,CAACtH,KAAK,CAACe,IAAI,CAAC,CAAC;aAAEwG;YAAa,KAAKA,WAAW,CAAC;WAE1E,OAAO,0BAAI,CAAC3E,KAAK,CAAC4E,KAAK,qBAAhB,kBAAkBJ,eAAe,CAACC,KAAK,CAAC,KAAI,CAACC,gBAAgB;;QAErE;MACD;KACD1F,aAAa,GACb;OACC,OAAO;SACNC,UAAU,EAAE,IAAI;SAChBC,gBAAgB,EAAE,KAAK;SACvBC,kBAAkB,EAAE,KAAK;SACzBC,iBAAiB,EAAE;WAClBE,YAAY,EAAE,IAAI;WAClBC,cAAc,EAAE,KAAK;WACrBF,OAAO,EAAE,IAAI;WACbI,YAAY,EAAE;;QAEf;MACD;KACD3B,UAAU,GACV;OACC,OAAO,IAAI,CAACV,KAAK,CAACW,MAAM;;IAEzB;GACDqC,KAAK,EAAE;KACNtC,UAAU,GACV;OACC,IAAI,IAAI,CAACA,UAAU,KAAK,CAAC,EACzB;SACC,IAAI,CAAC+G,UAAU,EAAE;;;IAGnB;GACD9D,OAAO,EAAE;KACR+D,gBAAgB,GAChB;OACC/H,iDAAW,CAACC,GAAG,CAAC,IAAI,CAACV,MAAM,CAAC,CAACY,UAAU,EAAE,CAAC6H,WAAW,EAAE,CAACC,WAAW,EAAE;OAErE,IAAI,CAACH,UAAU,EAAE;MACjB;KACDI,iBAAiB,GACjB;OACClI,iDAAW,CAACC,GAAG,CAAC,IAAI,CAACV,MAAM,CAAC,CAAC4I,WAAW,EAAE;MAC1C;KACDC,kBAAkB,GAClB;OACCpI,iDAAW,CAACC,GAAG,CAAC,IAAI,CAACV,MAAM,CAAC,CAAC8I,aAAa,EAAE;MAC5C;KACDP,UAAU,GACV;OACC,IAAI,CAACvD,KAAK,CAAC,OAAO,CAAC;;IAEpB;GACDM,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAsCZ,CAAC;;CC9ID;AACA,OAAayD,SAAS,GAAG;GACxBrJ,UAAU,EAAE;WACXsJ,qCAAI;KACJzB;IACA;GACD0B,MAAM,EAAE,CAAC,WAAW,EAAE,UAAU,CAAC;GACjClJ,KAAK,EAAE;KACNC,MAAM,EAAE;OACPC,IAAI,EAAE,CAACC,MAAM,EAAEC,MAAM,CAAC;OACtBC,QAAQ,EAAE;MACV;KACD8I,YAAY,EAAE;OACbjJ,IAAI,EAAE0G,OAAO;OACbG,OAAO,EAAE;;IAEV;GACDxG,KAAK,CAACP,KAAK,EACX;KACC,OAAO;OACNf,SAAS;OACTyB,WAAW,EAAEA,iDAAW,CAACC,GAAG,CAACX,KAAK,CAACC,MAAM;MACzC;IACD;GACDa,IAAI,GACJ;KACC,OAAO;OACNC,KAAK,EAAE,IAAI,CAACL,WAAW,CAACM,QAAQ,EAAE;OAClCoI,YAAY,EAAE,KAAK;OACnBC,qBAAqB,EAAE;MACvB;IACD;GACDlI,QAAQ,EAAE;KACTC,IAAI,GACJ;OACC,OAAO,IAAI,CAACC,MAAM,CAACC,OAAO,CAAE,GAAEC,oBAAK,CAACC,KAAM,UAAS,CAAC,CAAC,IAAI,CAACvB,MAAM,CAAC;MACjE;KACDqJ,KAAK,GACL;OACC,OAAO,IAAI,CAACjI,MAAM,CAACC,OAAO,CAAE,GAAEC,oBAAK,CAACgI,MAAO,UAAS,CAAC,CAAC,IAAI,CAACnI,IAAI,CAACoI,OAAO,CAAC;MACxE;KACD/H,UAAU,GACV;OACC,OAAO,IAAI,CAACV,KAAK,CAACW,MAAM;MACxB;KACD+H,MAAM,GACN;OACC,OAAO;SACN,CAAC,CAAC,IAAI,CAACN,YAAY,IAAI,CAAC,IAAI,CAACO,UAAU,GAAGC,2CAAU,CAACC,cAAc;SACnE,CAAC,CAAC,IAAI,CAACT,YAAY,IAAI,IAAI,CAACO,UAAU,GAAGC,2CAAU,CAACE,YAAY;SAChE,CAAC,IAAI,CAACV,YAAY,IAAI,CAAC,IAAI,CAACO,UAAU,GAAGC,2CAAU,CAACG,eAAe;SACnE,CAAC,IAAI,CAACX,YAAY,IAAI,IAAI,CAACO,UAAU,GAAGC,2CAAU,CAACI,aAAa;SAChE,CAAC,IAAI,CAACC,QAAQ,GAAGL,2CAAU,CAACM;QAC5B,CAACC,IAAI;MACN;KACDR,UAAU,GACV;OACC,IAAI,IAAI,CAACP,YAAY,EACrB;SACC,OAAO,IAAI,CAACpI,KAAK,CAACW,MAAM,GAAG,CAAC;;OAG7B,MAAMyI,cAAc,GAAG,IAAI,CAAC9I,MAAM,CAACC,OAAO,CAAE,GAAEC,oBAAK,CAACC,KAAM,iBAAgB,CAAC,CAAC,IAAI,CAACvB,MAAM,EAAEhB,SAAS,CAACG,EAAE,CAAC;OAEtG,OAAO+K,cAAc,IAAI,IAAI,CAACpJ,KAAK,CAACW,MAAM,GAAG,CAAC;MAC9C;KACD0I,IAAI,GACJ;OACC,IAAI,IAAI,CAACjB,YAAY,IAAI,IAAI,CAACtH,WAAW,EACzC;SACC,OAAOrB,4BAAQ,CAAC6J,WAAW;;OAG5B,OAAO5J,2BAAO,CAAC6J,MAAM;MACrB;KACD9G,IAAI,GACJ;OACC,IAAI,IAAI,CAAC2F,YAAY,IAAI,IAAI,CAAC1H,UAAU,GAAG,CAAC,EAC5C;SACC,OAAO,IAAI,CAACG,GAAG,CAAC,sBAAsB,EAAE;WACvC,SAAS,EAAE,IAAI,CAACH;UAChB,CAAC;;OAGH,OAAOxC,SAAS,CAACM,KAAK;MACtB;KACDsC,WAAW,GACX;OACC,OAAO,IAAI,CAACnB,WAAW,CAACmB,WAAW,EAAE;MACrC;KACDmI,QAAQ,GACR;OACC,OAAO,IAAI,CAACjJ,KAAK,CAACe,IAAI,CAAC,CAAC;SAAEC;QAAQ,KAAK,CAACC,2BAAU,CAACuI,aAAa,EAAEvI,2BAAU,CAACwI,WAAW,CAAC,CAACrI,QAAQ,CAACJ,MAAM,CAAC,CAAC;MAC3G;KACDK,cAAc,GACd;OACC,OAAO,IAAI,CAAChB,IAAI,CAACiB,MAAM,CAACC,UAAU,IAAI,IAAI,CAAClB,IAAI,CAACiB,MAAM,CAACE,IAAI;MAC3D;KACDkI,wBAAwB,GACxB;OACC,OAAO,IAAI,CAAChJ,UAAU,GAAG,CAAC,IAAI,IAAI,CAAC4H,qBAAqB;;IAEzD;GACD/E,OAAO,GACP;KACC,IAAI,CAAC5D,WAAW,CAAC6D,SAAS,CAAC,WAAW,EAAE,IAAI,CAACmG,aAAa,CAAC;KAC3D,IAAI,CAAChK,WAAW,CAAC6D,SAAS,CAAC,gBAAgB,EAAE,IAAI,CAACoG,kBAAkB,CAAC;IACrE;GACDnG,aAAa,GACb;KACC,IAAI,CAAC9D,WAAW,CAAC+D,WAAW,CAAC,WAAW,EAAE,IAAI,CAACiG,aAAa,CAAC;KAC7D,IAAI,CAAChK,WAAW,CAAC+D,WAAW,CAAC,gBAAgB,EAAE,IAAI,CAACkG,kBAAkB,CAAC;IACvE;GACDjG,OAAO,EAAE;KACRgG,aAAa,GACb;OACC,IAAI,IAAI,CAACvB,YAAY,IAAI,IAAI,CAACsB,wBAAwB,EACtD;SACC,IAAI,CAACG,SAAS,EAAE;;MAEjB;KACDD,kBAAkB,CAACvC,KAAK,EACxB;OACC,IAAI,CAACyC,aAAa,CAACzC,KAAK,CAAC0C,OAAO,EAAE,CAAC;MACnC;KACDD,aAAa,CAACzE,IAAsB,EACpC;OAAA;OACC2E,gCAAS,CAACC,cAAc,CAAC,IAAI,CAACD,SAAS,EAAE;SACxCE,QAAQ,EAAE,IAAI,CAACA,QAAQ;SACvBC,QAAQ,EAAE,oBAAI,CAAC5B,KAAK,qBAAV,YAAYpJ,IAAI,MAAKiL,wBAAS,CAACC,MAAM,GAAG,IAAI,CAAC9B,KAAK,CAAClK,EAAE,GAAG,IAAI;SACtEiM,UAAU,EAAEjF,IAAI,CAACkF,MAAM;SACvBC,QAAQ,EAAEnF,IAAI,CAACC,IAAI;SACnBmF,aAAa,EAAEpF,IAAI,CAACqF,SAAS;SAC7BhK,UAAU,EAAE,IAAI,CAACA;QACjB,CAAC;MACF;KACDmE,WAAW,GACX;OACC,IAAI,CAAC,IAAI,CAACuD,YAAY,IAAI,IAAI,CAACO,UAAU,EACzC;SACC,IAAI,CAACgC,cAAc,EAAE;SAErB;;OAGD,IAAI,IAAI,CAAC3K,KAAK,CAACW,MAAM,GAAG,CAAC,EACzB;SACC,IAAI,CAAC2H,qBAAqB,GAAG,IAAI;SAEjC,IAAI,CAACuB,SAAS,EAAE;QAChB,MAED;SACC,IAAI,CAAC/B,WAAW,EAAE;;MAEnB;KACD+B,SAAS,GACT;OACC,IAAI,CAACxB,YAAY,GAAG,IAAI;MACxB;KACDZ,UAAU,GACV;OACC,IAAI,CAACY,YAAY,GAAG,KAAK;OAEzB,IAAI,CAAC,IAAI,CAAC3H,UAAU,EACpB;SACC,IAAI,CAAC4H,qBAAqB,GAAG,KAAK;;MAEnC;KACDR,WAAW,GACX;OACC,IAAI,CAACnI,WAAW,CAACkE,MAAM,CAAC;SACvBC,WAAW,EAAE,IAAI,CAAClB,KAAK,CAACgI,IAAI,CAAC9H,GAAG;SAChCiB,cAAc,EAAE,IAAI,CAACC,kBAAkB;SACvC/B,OAAO,EAAE,IAAI,CAACiI,QAAQ,KAAKW,uBAAQ,CAACC;QACpC,CAAC;MACF;KACDH,cAAc,GACd;OACC,KAAKI,8CAAgB,CAACC,YAAY,CAAC,IAAI,CAACC,KAAK,CAACnI,GAAG,CAAC,CAACoI,SAAS,CAAChN,SAAS,CAACG,EAAE,CAAC;MAC1E;KACD2F,kBAAkB,GAClB;OAAA;OACC,wBAAI,CAACpB,KAAK,CAACgI,IAAI,qBAAf,iBAAiB9H,GAAG,CAACqI,KAAK,EAAE;OAC5B,IAAI,CAACxL,WAAW,CAAC4E,oBAAoB,CAAC,IAAI,CAAC;;IAE5C;GACDC,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;CAmBZ,CAAC;;;;;;;;;;;"}