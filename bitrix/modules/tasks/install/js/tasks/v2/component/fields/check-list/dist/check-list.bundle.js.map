{"version":3,"file":"check-list.bundle.js","sources":["../src/components/check-list/check-list-stub.js","../src/components/check-list-popup/check-list-popup.js","../src/components/check-list-sheet/check-list-sheet.js","../src/lib/check-list-manager.js","../src/lib/check-list-meta.js","../src/components/check-list-list/check-list-list.js","../src/lib/highlighter/highlighter.js","../src/components/check-list-widget/component/check-list-item-mixin.js","../src/components/check-list-widget/component/check-list-parent-item.js","../src/components/check-list-widget/component/check-list-child-item.js","../src/components/check-list-widget/component/check-list-add-item.js","../src/components/check-list-widget/component/check-list-group-completed-list.js","../src/components/check-list-widget/check-list-widget.js","../src/components/check-list-item-panel/check-list-item-panel-meta.js","../src/components/check-list-item-panel/check-list-item-panel.js","../src/lib/check-list-notifier.js","../src/components/check-list/check-list.js","../src/check-list-chip.js"],"sourcesContent":["import { Button as UiButton, ButtonSize } from 'ui.vue3.components.button';\n\n// @vue/component\nexport const CheckListStub = {\n\tname: 'CheckListStub',\n\tcomponents: {\n\t\tUiButton,\n\t},\n\temits: ['click'],\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tButtonSize,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<div class=\"check-list-stub\">\n\t\t\t<div class=\"check-list-stub-title\">\n\t\t\t\t{{ loc('TASKS_V2_CHECK_LIST_STUB_TITLE') }}\n\t\t\t</div>\n\t\t\t<div class=\"check-list-stub-icon\"></div>\n\t\t\t<div class=\"check-list-stub-btn\">\n\t\t\t\t<UiButton\n\t\t\t\t\t:text=\"loc('TASKS_V2_CHECK_LIST_STUB_BTN')\"\n\t\t\t\t\t:size=\"ButtonSize.MEDIUM\"\n\t\t\t\t\t@click=\"$emit('click')\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Event } from 'main.core';\nimport type { PopupOptions } from 'main.popup';\n\nimport { Popup } from 'ui.vue3.components.popup';\nimport { mapGetters } from 'ui.vue3.vuex';\n\nimport { EventName, Model } from 'tasks.v2.const';\n\nimport './check-list-popup.css';\n\n// @vue/component\nexport const CheckListPopup = {\n\tname: 'TaskCheckListPopup',\n\tcomponents: {\n\t\tPopup,\n\t},\n\tinheritAttrs: false,\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['show', 'close', 'resize'],\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tresizeObserver: null,\n\t\t};\n\t},\n\tcomputed: {\n\t\tpopupId(): string\n\t\t{\n\t\t\treturn `tasks-check-list-popup-${this.taskId}`;\n\t\t},\n\t\tpopupOptions(): PopupOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tclassName: 'tasks-check-list-popup',\n\t\t\t\twidth: 580,\n\t\t\t\theight: 500,\n\t\t\t\tborderRadius: '18px',\n\t\t\t\toffsetTop: 0,\n\t\t\t\tpadding: 0,\n\t\t\t\tautoHide: true,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tanimation: {\n\t\t\t\t\tshowClassName: 'tasks-check-list-popup-show',\n\t\t\t\t\tcloseClassName: 'tasks-check-list-popup-close',\n\t\t\t\t\tcloseAnimationType: 'animation',\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: this.handleClose.bind(this),\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\t...mapGetters({\n\t\t\ttitleFieldOffsetHeight: `${Model.Interface}/titleFieldOffsetHeight`,\n\t\t}),\n\t},\n\twatch: {\n\t\tasync titleFieldOffsetHeight(): Promise<void>\n\t\t{\n\t\t\tif (!this.$refs.childComponent)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait this.$nextTick();\n\n\t\t\tthis.resize();\n\t\t},\n\t},\n\tcreated(): void\n\t{\n\t\tthis.resizeObserver = new ResizeObserver((entries: ResizeObserverEntry[]) => {\n\t\t\tfor (const entry of entries)\n\t\t\t{\n\t\t\t\tif (entry.target === this.$refs.wrapper)\n\t\t\t\t{\n\t\t\t\t\tthis.resize();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\tmounted(): void\n\t{\n\t\tEvent.bind(window, 'resize', this.resize);\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tEvent.unbind(window, 'resize', this.resize);\n\t},\n\tmethods: {\n\t\tresize(): void\n\t\t{\n\t\t\tconst popupInstance = this.$refs.childComponent?.getPopupInstance();\n\t\t\tif (popupInstance)\n\t\t\t{\n\t\t\t\tthis.$emit('resize');\n\n\t\t\t\tpopupInstance.adjustPosition();\n\t\t\t}\n\t\t},\n\t\thandleShow(): void\n\t\t{\n\t\t\tthis.$emit('show', { popupInstance: this.$refs.childComponent.getPopupInstance() });\n\n\t\t\tthis.$refs.childComponent?.getPopupInstance().adjustPosition();\n\t\t\tsetTimeout(() => this.resizeObserver.observe(this.$parent.$refs.wrapper), 300);\n\t\t},\n\t\thandleClose(): void\n\t\t{\n\t\t\tthis.resizeObserver.disconnect();\n\t\t\tthis.$bitrix.eventEmitter.emit(EventName.CloseCheckList);\n\n\t\t\tthis.$emit('close');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Popup :options=\"popupOptions\" ref=\"childComponent\">\n\t\t\t<slot\n\t\t\t\t:handleShow=\"handleShow\"\n\t\t\t\t:handleClose=\"handleClose\"\n\t\t\t></slot>\n\t\t</Popup>\n\t`,\n};\n","import { Event } from 'main.core';\nimport { mapGetters } from 'ui.vue3.vuex';\nimport { BottomSheet } from 'tasks.v2.component.elements.bottom-sheet';\nimport { Model } from 'tasks.v2.const';\n\n// @vue/component\nexport const CheckListSheet = {\n\tname: 'TaskCheckListSheet',\n\tcomponents: {\n\t\tBottomSheet,\n\t},\n\tprops: {\n\t\tisShown: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tgetBindElement: {\n\t\t\ttype: Function,\n\t\t\tdefault: null,\n\t\t},\n\t\tgetTargetContainer: {\n\t\t\ttype: Function,\n\t\t\tdefault: null,\n\t\t},\n\t},\n\temits: ['show', 'close', 'isShown'],\n\tcomputed: {\n\t\t...mapGetters({\n\t\t\ttitleFieldOffsetHeight: `${Model.Interface}/titleFieldOffsetHeight`,\n\t\t}),\n\t},\n\twatch: {\n\t\ttitleFieldOffsetHeight(): void\n\t\t{\n\t\t\tthis.$refs.childComponent?.adjustPosition();\n\t\t},\n\t\tasync isShown(value): void\n\t\t{\n\t\t\tawait this.$nextTick();\n\n\t\t\tif (value === true)\n\t\t\t{\n\t\t\t\tEvent.bind(document, 'keydown', this.handleKeyDown, { capture: true });\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tEvent.unbind(document, 'keydown', this.handleKeyDown, { capture: true });\n\t\t\t}\n\n\t\t\tthis.$emit('isShown', value);\n\t\t},\n\t},\n\tmethods: {\n\t\thandleShow(): void\n\t\t{\n\t\t\tthis.$emit('show');\n\t\t},\n\t\thandleClose(): void\n\t\t{\n\t\t\tthis.$emit('close');\n\t\t},\n\t\thandleKeyDown(event: KeyboardEvent): void\n\t\t{\n\t\t\tif (event.key === 'Escape')\n\t\t\t{\n\t\t\t\tthis.handleClose();\n\n\t\t\t\tevent.stopPropagation();\n\t\t\t}\n\t\t},\n\t},\n\ttemplate: `\n\t\t<BottomSheet\n\t\t\tv-if=\"isShown\"\n\t\t\t:padding=\"0\"\n\t\t\t:getBindElement=\"getBindElement\"\n\t\t\t:getTargetContainer=\"getTargetContainer\"\n\t\t\tref=\"childComponent\"\n\t\t>\n\t\t\t<slot\n\t\t\t\t:handleShow=\"handleShow\"\n\t\t\t\t:handleClose=\"handleClose\"\n\t\t\t></slot>\n\t\t</BottomSheet>\n\t`,\n};\n","import type { CheckListModel } from 'tasks.v2.model.check-list';\nimport type { UserModel } from 'tasks.v2.model.users';\n\ntype Params = {\n\tcomputed?: {\n\t\tcheckLists: () => CheckListModel[],\n\t},\n};\n\nexport class CheckListManager\n{\n\t#params: Params;\n\n\tconstructor(params: Params)\n\t{\n\t\tthis.#params = params;\n\t}\n\n\tgetItem(itemId: number | string): ?CheckListModel\n\t{\n\t\treturn this.#getCheckLists().find((item: CheckListModel) => item.id === itemId);\n\t}\n\n\tgetItemsOnLevel(parentId: number | string): CheckListModel[]\n\t{\n\t\treturn this.#getCheckLists()\n\t\t\t.filter((item: CheckListModel) => item.parentId === parentId)\n\t\t\t.sort((a: CheckListModel, b: CheckListModel) => a.sortIndex - b.sortIndex);\n\t}\n\n\tgetItemLevel(checkListItem: CheckListModel): number\n\t{\n\t\tlet level = 0;\n\t\tlet current = checkListItem;\n\n\t\tconst visitedIds = new Set();\n\n\t\tconst findParent = (parentId) => this.#getCheckLists().find((item: CheckListModel) => item.id === parentId);\n\n\t\twhile (current.parentId !== 0)\n\t\t{\n\t\t\tif (visitedIds.has(current.id))\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tvisitedIds.add(current.id);\n\n\t\t\tcurrent = findParent(current.parentId);\n\t\t\tif (!current)\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tlevel++;\n\t\t}\n\n\t\treturn level;\n\t}\n\n\tisItemDescendant(potentialAncestor: ?CheckListModel, item?: CheckListModel): boolean\n\t{\n\t\tif (item?.parentId === potentialAncestor?.id)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (item?.parentId === 0)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst parent = this.#getCheckLists().find((i: CheckListModel) => i.id === item?.parentId);\n\t\tif (!parent)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.isItemDescendant(potentialAncestor, parent);\n\t}\n\n\tshowItems(\n\t\titemIds: (number | string)[],\n\t\tupdateFn: (updates: CheckListModel[]) => void,\n\t): void\n\t{\n\t\tconst updates: CheckListModel[] = [];\n\n\t\titemIds.forEach((itemId: number | string) => this.#setItemsVisibility(itemId, false, updates));\n\n\t\tif (updates.length > 0)\n\t\t{\n\t\t\tupdateFn(updates);\n\t\t}\n\t}\n\n\thideItems(\n\t\titemIds: (number | string)[],\n\t\tupdateFn: (updates: CheckListModel[]) => void,\n\t): void\n\t{\n\t\tconst updates: CheckListModel[] = [];\n\n\t\titemIds.forEach((itemId: number | string) => this.#setItemsVisibility(itemId, true, updates));\n\n\t\tif (updates.length > 0)\n\t\t{\n\t\t\tupdateFn(updates);\n\t\t}\n\t}\n\n\tsyncParentCompletionState(\n\t\titemId: number | string,\n\t\tupdateFn: (id: string | number, fields: Partial<CheckListModel>) => void,\n\t\tparentItemId?: number | string,\n\t): void\n\t{\n\t\tconst changedItem = this.#getCheckLists().find((item: CheckListModel) => item.id === itemId);\n\n\t\tif ((!changedItem || !changedItem.parentId) && !parentItemId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst parentId = parentItemId || changedItem.parentId;\n\n\t\tconst parentItem = this.#getCheckLists().find((item: CheckListModel) => item.id === parentId);\n\t\tif (!parentItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst childrenItems = this.#getCheckLists().filter((item: CheckListModel) => item.parentId === parentItem.id);\n\t\tconst isEmptyParent = (childrenItems.length === 0);\n\n\t\tconst allChildrenCompleted = childrenItems.every((child: CheckListModel) => {\n\t\t\treturn child.localCompleteState ?? child.isComplete;\n\t\t});\n\t\tconst someChildrenIncomplete = !allChildrenCompleted;\n\n\t\tconst parentCompleted = parentItem.localCompleteState ?? parentItem.isComplete;\n\t\tconst shouldUpdateParent = (\n\t\t\tisEmptyParent\n\t\t\t|| (allChildrenCompleted && !parentCompleted)\n\t\t\t|| (someChildrenIncomplete && parentCompleted)\n\t\t);\n\t\tif (!shouldUpdateParent)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tupdateFn(parentItem.id, {\n\t\t\tisComplete: allChildrenCompleted && !isEmptyParent,\n\t\t});\n\n\t\tif (parentItem.parentId)\n\t\t{\n\t\t\tthis.syncParentCompletionState(parentItem.id, updateFn);\n\t\t}\n\t}\n\n\tgetAllGroupModeItems(): CheckListModel[]\n\t{\n\t\treturn this.#getCheckLists().filter((item: CheckListModel) => item.groupMode?.active === true);\n\t}\n\n\tgetAllSelectedItems(): CheckListModel[]\n\t{\n\t\treturn this.#getCheckLists().filter((item: CheckListModel) => {\n\t\t\treturn (item.parentId !== 0 && item.groupMode?.selected === true);\n\t\t});\n\t}\n\n\tgetAllSelectedItemsWithChildren(): CheckListModel[]\n\t{\n\t\tconst result = new Map();\n\n\t\tconst selectedItems = this.getAllSelectedItems();\n\t\tconst allItems = this.#getCheckLists();\n\n\t\tselectedItems.forEach((item: CheckListModel) => result.set(item.id, item));\n\n\t\tconst getChildren = (parentIds: (string | number)[]): void => {\n\t\t\tconst children = allItems.filter((item: CheckListModel) => {\n\t\t\t\treturn parentIds.includes(item.parentId) && !result.has(item.id);\n\t\t\t});\n\n\t\t\tchildren.forEach((child: CheckListModel) => result.set(child.id, child));\n\n\t\t\tif (children.length > 0)\n\t\t\t{\n\t\t\t\tgetChildren(children.map((child: CheckListModel) => child.id));\n\t\t\t}\n\t\t};\n\n\t\tgetChildren(selectedItems.map((item: CheckListModel) => item.id));\n\n\t\treturn [...result.values()];\n\t}\n\n\tgetAllChildren(itemId: number | string): CheckListModel[]\n\t{\n\t\tconst visited = new Set();\n\n\t\tconst result = [];\n\n\t\tconst collectChildren = (currentId: number | string) => {\n\t\t\tif (visited.has(currentId))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvisited.add(currentId);\n\n\t\t\tconst children = this.#getCheckLists()\n\t\t\t\t.filter((item: CheckListModel) => item.parentId === currentId)\n\t\t\t\t.sort((a: CheckListModel, b: CheckListModel) => a.sortIndex - b.sortIndex);\n\n\t\t\tchildren.forEach((child: CheckListModel) => {\n\t\t\t\tif (!visited.has(child.id))\n\t\t\t\t{\n\t\t\t\t\tresult.push(child);\n\t\t\t\t\tcollectChildren(child.id);\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\tcollectChildren(itemId);\n\n\t\treturn result;\n\t}\n\n\tgetAllCompletedChildren(itemId: number | string): CheckListModel[]\n\t{\n\t\treturn this.getAllChildren(itemId).filter((item: CheckListModel) => {\n\t\t\treturn (item.localCompleteState ?? item.isComplete) === true;\n\t\t});\n\t}\n\n\tgetChildren(itemId: number | string): CheckListModel[]\n\t{\n\t\treturn this.#getCheckLists().filter((item: CheckListModel) => {\n\t\t\treturn item.parentId === itemId;\n\t\t});\n\t}\n\n\tgetSiblings(itemId: number | string, parentId: number | string): CheckListModel[]\n\t{\n\t\treturn this.#getCheckLists()\n\t\t\t.filter((sibling: CheckListModel) => sibling.parentId === parentId && sibling.id !== itemId)\n\t\t\t.sort((a: CheckListModel, b: CheckListModel) => a.sortIndex - b.sortIndex);\n\t}\n\n\tresortItemsOnLevel(\n\t\tparentId: number | string,\n\t\tupdateFn: (updates: CheckListModel[]) => void,\n\t): void\n\t{\n\t\tconst allItems = this.#getCheckLists()\n\t\t\t.filter((item: CheckListModel) => item.parentId === parentId);\n\n\t\tconst sortedItems = [...allItems].sort((a: CheckListModel, b: CheckListModel) => a.sortIndex - b.sortIndex);\n\n\t\tconst updates = sortedItems\n\t\t\t.map((item: CheckListModel, newIndex: number) => ({\n\t\t\t\t...item,\n\t\t\t\tsortIndex: newIndex,\n\t\t\t}));\n\n\t\tif (updates.length > 0)\n\t\t{\n\t\t\tupdateFn(updates);\n\t\t}\n\t}\n\n\tresortItemsAfterIndex(\n\t\tparentId: number | string,\n\t\tsortIndex: number,\n\t\tupdateFn: (updates: CheckListModel[]) => void,\n\t): void\n\t{\n\t\tconst allItems = this.#getCheckLists()\n\t\t\t.filter((item: CheckListModel) => item.parentId === parentId);\n\n\t\tconst itemsToResort = allItems\n\t\t\t.filter((item: CheckListModel) => item.sortIndex >= sortIndex)\n\t\t\t.sort((a: CheckListModel, b: CheckListModel) => a.sortIndex - b.sortIndex);\n\n\t\tconst updates = itemsToResort\n\t\t\t.map((item: CheckListModel) => ({\n\t\t\t\t...item,\n\t\t\t\tsortIndex: item.sortIndex + 1,\n\t\t\t}));\n\n\t\tif (updates.length > 0)\n\t\t{\n\t\t\tupdateFn(updates);\n\t\t}\n\t}\n\n\tmoveRight(item: CheckListModel, updateFn: (updates: CheckListModel[]) => void): void\n\t{\n\t\tif (item.parentId === 0 || this.getItemLevel(item) > 5)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst itemsOnLevel = this.getItemsOnLevel(item.parentId);\n\n\t\tconst currentIndex = itemsOnLevel.findIndex((sibling: CheckListModel) => sibling.id === item.id);\n\t\tif (currentIndex <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet newParent = null;\n\t\tfor (let i = currentIndex - 1; i >= 0; i--)\n\t\t{\n\t\t\tconst candidate = itemsOnLevel[i];\n\t\t\tif (!this.isItemDescendant(candidate, item))\n\t\t\t{\n\t\t\t\tnewParent = candidate;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (!newParent)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst newParentChildren = this.#getCheckLists()\n\t\t\t.filter((child: CheckListModel) => child.parentId === newParent.id)\n\t\t\t.sort((a: CheckListModel, b: CheckListModel) => a.sortIndex - b.sortIndex);\n\n\t\tconst updates = itemsOnLevel\n\t\t\t.filter((sibling: CheckListModel, index: number) => index > currentIndex)\n\t\t\t.map((sibling: CheckListModel) => ({\n\t\t\t\t...sibling,\n\t\t\t\tsortIndex: sibling.sortIndex - 1,\n\t\t\t}));\n\n\t\tupdates.push({\n\t\t\t...item,\n\t\t\tparentId: newParent.id,\n\t\t\tparentNodeId: newParent.nodeId,\n\t\t\tsortIndex: newParentChildren.length > 0\n\t\t\t\t? newParentChildren[newParentChildren.length - 1].sortIndex + 1\n\t\t\t\t: 0,\n\t\t});\n\n\t\tupdateFn(updates);\n\t}\n\n\tmoveLeft(item: CheckListModel, updateFn: (updates: CheckListModel[]) => void): void\n\t{\n\t\tif (item.parentId === 0 || this.getItemLevel(item) <= 1)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentParent = this.#getCheckLists().find((parent: CheckListModel) => parent.id === item.parentId);\n\t\tif (!currentParent)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst itemsOnLevel = this.getItemsOnLevel(currentParent.parentId);\n\n\t\tconst parentInNewListIndex = itemsOnLevel\n\t\t\t.findIndex((sibling: CheckListModel) => sibling.id === currentParent.id);\n\n\t\tconst currentSiblingsUpdates = this.#getCheckLists()\n\t\t\t.filter((sibling: CheckListModel) => (\n\t\t\t\tsibling.parentId === item.parentId\n\t\t\t\t&& sibling.sortIndex > item.sortIndex\n\t\t\t))\n\t\t\t.map((sibling: CheckListModel) => ({\n\t\t\t\t...sibling,\n\t\t\t\tsortIndex: sibling.sortIndex - 1,\n\t\t\t}));\n\n\t\tlet newSortIndex = 0;\n\t\tif (\n\t\t\tparentInNewListIndex === -1\n\t\t\t|| parentInNewListIndex === itemsOnLevel.length - 1\n\t\t)\n\t\t{\n\t\t\tnewSortIndex = itemsOnLevel.length > 0 ? itemsOnLevel[itemsOnLevel.length - 1].sortIndex + 1 : 0;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tnewSortIndex = itemsOnLevel[parentInNewListIndex].sortIndex + 1;\n\n\t\t\tconst shiftUpdates = itemsOnLevel\n\t\t\t\t.filter((sibling: CheckListModel) => sibling.sortIndex >= newSortIndex)\n\t\t\t\t.map((sibling: CheckListModel) => ({\n\t\t\t\t\t...sibling,\n\t\t\t\t\tsortIndex: sibling.sortIndex + 1,\n\t\t\t\t}));\n\n\t\t\tcurrentSiblingsUpdates.push(...shiftUpdates);\n\t\t}\n\n\t\tconst movedItemUpdate = {\n\t\t\t...item,\n\t\t\tparentId: currentParent.parentId,\n\t\t\tparentNodeId: currentParent.parentNodeId || null,\n\t\t\tsortIndex: newSortIndex,\n\t\t};\n\n\t\tupdateFn([...currentSiblingsUpdates, movedItemUpdate]);\n\t}\n\n\tfindNearestItem(\n\t\tinitialItem: CheckListModel,\n\t\tselected: boolean,\n\t\texcludeChildrenOf: CheckListModel[] = [],\n\t): ?CheckListModel\n\t{\n\t\tif (!initialItem)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst rootParent = this.#getRootParent(initialItem);\n\t\tif (!rootParent)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst currentSortIndex = initialItem.sortIndex;\n\n\t\tconst excludedParentIds = new Set(excludeChildrenOf.map((item: CheckListModel) => item.id));\n\n\t\tconst eligibleItems = this.#getCheckLists()\n\t\t\t.sort((a: CheckListModel, b: CheckListModel) => a.sortIndex - b.sortIndex)\n\t\t\t.filter((item: CheckListModel) => {\n\t\t\t\tconst isChildOfExcluded = excludedParentIds.has(item.parentId);\n\n\t\t\t\treturn (\n\t\t\t\t\titem.id !== initialItem.id\n\t\t\t\t\t&& item.parentId !== 0\n\t\t\t\t\t&& item.groupMode?.selected === selected\n\t\t\t\t\t&& this.#getRootParent(item)?.id === rootParent.id\n\t\t\t\t\t&& !isChildOfExcluded\n\t\t\t\t);\n\t\t\t});\n\n\t\tif (eligibleItems.length === 0)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn eligibleItems.reduce((nearest: CheckListModel, item: CheckListModel) => {\n\t\t\treturn (\n\t\t\t\titem.sortIndex > currentSortIndex\n\t\t\t\t&& (\n\t\t\t\t\titem.sortIndex < nearest.sortIndex\n\t\t\t\t\t|| nearest.sortIndex <= currentSortIndex\n\t\t\t\t)\n\t\t\t) ? item : nearest;\n\t\t});\n\t}\n\n\tgetFirstChild(itemId: number | string): ?CheckListModel\n\t{\n\t\tconst children = this.#getCheckLists()\n\t\t\t.filter((item: CheckListModel) => item.parentId === itemId)\n\t\t\t.sort((a: CheckListModel, b: CheckListModel) => a.sortIndex - b.sortIndex);\n\n\t\treturn children[0] || null;\n\t}\n\n\thasEmptyItemWithFiles(hasItemFiles: (item: CheckListModel) => boolean): boolean\n\t{\n\t\treturn this.#getCheckLists().some((item: CheckListModel) => {\n\t\t\treturn item.title === '' && hasItemFiles(item);\n\t\t});\n\t}\n\n\thasItemWithFiles(hasItemFiles: (item: CheckListModel) => boolean): boolean\n\t{\n\t\treturn this.#getCheckLists().some((item: CheckListModel) => {\n\t\t\treturn hasItemFiles(item);\n\t\t});\n\t}\n\n\thasEmptyParentItem(): boolean\n\t{\n\t\treturn this.#getCheckLists().some((item: CheckListModel) => {\n\t\t\treturn item.parentId === 0 && item.title === '';\n\t\t});\n\t}\n\n\tgetFirstEmptyItem(): ?CheckListModel\n\t{\n\t\tconst items = this.#getCheckLists()\n\t\t\t.filter((item: CheckListModel) => item.title === '')\n\t\t\t.sort((a: CheckListModel, b: CheckListModel) => a.sortIndex - b.sortIndex);\n\n\t\treturn items[0] || null;\n\t}\n\n\tgetChildWithEmptyTitle(itemId: number | string): ?CheckListModel\n\t{\n\t\tconst children = this.#getCheckLists()\n\t\t\t.filter((item: CheckListModel) => item.parentId === itemId)\n\t\t\t.sort((a: CheckListModel, b: CheckListModel) => b.sortIndex - a.sortIndex)\n\t\t\t.find((item: CheckListModel) => item.title === '');\n\n\t\treturn children || null;\n\t}\n\n\tisItemCollapsed(item: CheckListModel, isPreview: boolean, positionIndex: number): boolean\n\t{\n\t\tif (item.localCollapsedState !== null)\n\t\t{\n\t\t\treturn item.localCollapsedState;\n\t\t}\n\n\t\tif (!isPreview)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (item.collapsed && !item.expanded)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (item.expanded)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn positionIndex !== 0;\n\t}\n\n\tgetRootParentByChildId(itemId: number | string): ?CheckListModel\n\t{\n\t\tconst childItem = this.getItem(itemId);\n\t\tif (!childItem)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tif (childItem.parentId === 0)\n\t\t{\n\t\t\treturn childItem;\n\t\t}\n\n\t\tlet currentItem = childItem;\n\n\t\tconst visitedIds = new Set();\n\n\t\twhile (currentItem && currentItem.parentId !== 0)\n\t\t{\n\t\t\tif (visitedIds.has(currentItem.id))\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tvisitedIds.add(currentItem.id);\n\n\t\t\tconst parent = this.getItem(currentItem.parentId);\n\t\t\tif (!parent)\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcurrentItem = parent;\n\t\t}\n\n\t\treturn currentItem?.parentId === 0 ? currentItem : null;\n\t}\n\n\texpandIdsWithChildren(itemIds: Set<string | number>): Set<string | number>\n\t{\n\t\tconst fullSet = new Set(itemIds);\n\n\t\tif (itemIds.size === 0 || this.#getCheckLists().length === 0)\n\t\t{\n\t\t\treturn fullSet;\n\t\t}\n\n\t\tconst checkListMap = new Map(this.#getCheckLists().map((item: CheckListModel) => [item.id, item]));\n\n\t\tconst processedIds = new Set();\n\n\t\titemIds.forEach((id: string | number) => {\n\t\t\tif (!processedIds.has(id))\n\t\t\t{\n\t\t\t\tthis.#findNestedChildren(id, checkListMap, fullSet, processedIds);\n\t\t\t}\n\t\t});\n\n\t\treturn fullSet;\n\t}\n\n\tfindItemIdsWithUser(rootId: number | string, userId: number): Set<string | number>\n\t{\n\t\tconst allItems = this.getAllChildren(rootId);\n\t\tconst rootItem = this.getItem(rootId);\n\n\t\tif (rootItem)\n\t\t{\n\t\t\tallItems.unshift(rootItem);\n\t\t}\n\n\t\tconst result = new Set();\n\t\tallItems.forEach((item: CheckListModel) => {\n\t\t\tconst hasUser = (\n\t\t\t\titem.accomplices?.some((user: UserModel) => user.id === userId)\n\t\t\t\t|| item.auditors?.some((user: UserModel) => user.id === userId)\n\t\t\t);\n\n\t\t\tif (hasUser && item.parentId !== 0)\n\t\t\t{\n\t\t\t\tresult.add(item.id);\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t}\n\n\t#setItemsVisibility(\n\t\titemId: number | string,\n\t\thidden: boolean,\n\t\tupdates: CheckListModel[],\n\t): void\n\t{\n\t\tconst item = this.getItem(itemId);\n\t\tif (!item || item.hidden === hidden)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst updatedItem = { ...item, hidden };\n\t\tupdates.push(updatedItem);\n\n\t\tconst children = this.getChildren(itemId);\n\t\tchildren.forEach((child: CheckListModel) => {\n\t\t\tthis.#setItemsVisibility(child.id, hidden, updates);\n\t\t});\n\t}\n\n\t#findNestedChildren(\n\t\tparentId: string | number,\n\t\tcheckListMap: Map<string | number, CheckListModel>,\n\t\tresultSet: Set<string | number>,\n\t\tprocessedIds: Set<string | number>,\n\t): void\n\t{\n\t\tif (processedIds.has(parentId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tprocessedIds.add(parentId);\n\n\t\tcheckListMap.forEach((item: CheckListModel) => {\n\t\t\tif (item.parentId === parentId && !resultSet.has(item.id))\n\t\t\t{\n\t\t\t\tresultSet.add(item.id);\n\n\t\t\t\tthis.#findNestedChildren(item.id, checkListMap, resultSet, processedIds);\n\t\t\t}\n\t\t});\n\t}\n\n\t#getRootParent(item: CheckListModel): ?CheckListModel\n\t{\n\t\tif (!item || item.parentId === 0)\n\t\t{\n\t\t\treturn item || null;\n\t\t}\n\n\t\tconst parentItem = this.#getCheckLists().find((parent: CheckListModel) => parent.id === item.parentId);\n\t\tif (!parentItem)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn this.#getRootParent(parentItem);\n\t}\n\n\t#getCheckLists(): CheckListModel[]\n\t{\n\t\treturn this.#params?.computed?.checkLists() ?? [];\n\t}\n}\n","import { Loc } from 'main.core';\nimport { TaskField } from 'tasks.v2.const';\n\nexport const checkListMeta = Object.freeze({\n\tid: TaskField.CheckList,\n\ttitle: Loc.getMessage('TASKS_V2_CHECK_LIST_TITLE'),\n});\n","import { Type } from 'main.core';\nimport { mapGetters } from 'ui.vue3.vuex';\nimport { BIcon, Animated, Outline } from 'ui.icon-set.api.vue';\n\nimport { Model } from 'tasks.v2.const';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\nimport type { CheckListModel } from 'tasks.v2.model.check-list';\nimport { checkListService } from 'tasks.v2.provider.service.check-list-service';\n\nimport { CheckListManager } from '../../lib/check-list-manager';\nimport { checkListMeta } from '../../lib/check-list-meta';\n\nimport './check-list-list.css';\n\n// @vue/component\nexport const CheckListList = {\n\tname: 'TaskCheckListList',\n\tcomponents: {\n\t\tBIcon,\n\t},\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tisEmpty: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: ['open', 'addFastCheckList'],\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tAnimated,\n\t\t\tOutline,\n\t\t\tcheckListMeta,\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tisLoading: null,\n\t\t};\n\t},\n\tcomputed: {\n\t\t...mapGetters({\n\t\t\tdeletingCheckListIds: `${Model.Interface}/deletingCheckListIds`,\n\t\t\tdisableCheckListAnimations: `${Model.Interface}/disableCheckListAnimations`,\n\t\t}),\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.taskId);\n\t\t},\n\t\tisEdit(): boolean\n\t\t{\n\t\t\treturn Type.isNumber(this.taskId) && this.taskId > 0;\n\t\t},\n\t\tcheckLists(): CheckListModel[]\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.CheckList}/getByIds`](this.task.checklist);\n\t\t},\n\t\tisFilledEmpty(): boolean\n\t\t{\n\t\t\treturn this.checkListLength === 0 && this.wasFilled;\n\t\t},\n\t\tcheckListLength(): number\n\t\t{\n\t\t\tconst deletingRootIds = Object.values(this.deletingCheckListIds);\n\n\t\t\tconst deletingIds = new Set();\n\n\t\t\tdeletingRootIds.forEach((rootId: string | number) => {\n\t\t\t\tdeletingIds.add(rootId);\n\n\t\t\t\tthis.checkListManager\n\t\t\t\t\t.getAllChildren(rootId)\n\t\t\t\t\t.forEach((child: CheckListModel) => {\n\t\t\t\t\t\tdeletingIds.add(child.id);\n\t\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn this.checkLists.filter(({ id }) => !deletingIds.has(id)).length;\n\t\t},\n\t\tcontainsChecklist(): boolean\n\t\t{\n\t\t\treturn this.task.containsChecklist;\n\t\t},\n\t\twasFilled(): boolean\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/wasFieldFilled`](this.taskId, checkListMeta.id);\n\t\t},\n\t\tloading(): boolean\n\t\t{\n\t\t\treturn this.isLoading === true && this.isEdit;\n\t\t},\n\t\tcanCheckListAdd(): boolean\n\t\t{\n\t\t\tif (!this.isEdit)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn this.task.rights.checklistAdd === true;\n\t\t},\n\t},\n\tasync created(): void\n\t{\n\t\tthis.checkListManager = new CheckListManager({\n\t\t\tcomputed: {\n\t\t\t\tcheckLists: () => this.checkLists,\n\t\t\t},\n\t\t});\n\n\t\tif (this.containsChecklist && this.checkLists.length === 0)\n\t\t{\n\t\t\tthis.isLoading = true;\n\n\t\t\tawait this.loadData();\n\n\t\t\tthis.isLoading = false;\n\t\t}\n\t},\n\tmethods: {\n\t\tasync loadData(): Promise<void>\n\t\t{\n\t\t\tawait checkListService.load(this.taskId);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\t:data-task-field-id=\"checkListMeta.id\"\n\t\t\tclass=\"tasks-check-list-list\"\n\t\t\t:class=\"{ '--default': loading || isFilledEmpty }\"\n\t\t>\n\t\t\t<div\n\t\t\t\tclass=\"tasks-check-list-list-content\"\n\t\t\t\t:class=\"{ '--default': loading || isFilledEmpty }\"\n\t\t\t>\n\t\t\t\t<Transition name=\"check-list-fade\" mode=\"in-out\" :css=\"!disableCheckListAnimations\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"loading\"\n\t\t\t\t\t\tkey=\"loading\"\n\t\t\t\t\t\tclass=\"tasks-check-list-list-transition-content\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"tasks-check-list-list-content-row\">\n\t\t\t\t\t\t\t<BIcon :name=\"Animated.LOADER_WAIT\"/>\n\t\t\t\t\t\t\t<div class=\"tasks-check-list-list-content-text\">\n\t\t\t\t\t\t\t\t{{ loc('TASKS_V2_CHECK_LIST_LOADING') }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</Transition>\n\t\t\t\t<Transition name=\"check-list-fade\" mode=\"in-out\" :css=\"!disableCheckListAnimations\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"!loading && isFilledEmpty\"\n\t\t\t\t\t\tkey=\"empty\"\n\t\t\t\t\t\tclass=\"tasks-check-list-list-transition-content\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"tasks-check-list-list-content-row --stub\" @click=\"$emit('addFastCheckList')\">\n\t\t\t\t\t\t\t<BIcon :name=\"Outline.CHECK_LIST\"/>\n\t\t\t\t\t\t\t<div class=\"tasks-check-list-list-content-text\">\n\t\t\t\t\t\t\t\t{{ loc('TASKS_V2_CHECK_LIST_CHIP_TITLE') }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<BIcon class=\"tasks-check-list-list-content-row-plus\" :name=\"Outline.PLUS_L\"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</Transition>\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"!loading && !isFilledEmpty\"\n\t\t\t\t\tkey=\"content\"\n\t\t\t\t\tclass=\"tasks-check-list-list-transition-content\"\n\t\t\t\t>\n\t\t\t\t\t<slot></slot>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"canCheckListAdd\"\n\t\t\t\t\t\tclass=\"tasks-check-list-list-content-row --footer\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"tasks-check-list-list-content-btn\"\n\t\t\t\t\t\t\t:class=\"{ '--empty': isEmpty }\"\n\t\t\t\t\t\t\t@click=\"$emit('addFastCheckList')\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<BIcon :name=\"Outline.PLUS_L\"/>\n\t\t\t\t\t\t\t<div class=\"tasks-check-list-list-content-btn-text\">\n\t\t\t\t\t\t\t\t{{ loc('TASKS_V2_CHECK_LIST_ADD_LABEL') }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Dom, Event } from 'main.core';\n\nimport './highlighter.css';\n\nexport class Highlighter\n{\n\tstatic HIGHLIGHT_CLASS = 'element-highlight';\n\tstatic ANIMATE_CLASS = '--animate';\n\tstatic ANIMATION_DURATION = 1500;\n\n\t#activeHighlights = new WeakMap();\n\n\tasync highlight(element: HTMLElement): Promise<void>\n\t{\n\t\tawait this.#nextTick();\n\n\t\tthis.#cleanup(element);\n\n\t\tthis.#activeHighlights.set(element, {\n\t\t\tanimationStart: null,\n\t\t\ttimeoutId: null,\n\t\t\thandler: null,\n\t\t});\n\n\t\tthis.#startAnimation(element);\n\n\t\tconst handler = () => this.#cleanup(element);\n\n\t\tEvent.bind(window, 'click', handler);\n\t\tEvent.bind(window, 'keydown', handler);\n\n\t\tconst state = this.#activeHighlights.get(element);\n\t\tstate.handler = handler;\n\t\tstate.timeoutId = setTimeout(\n\t\t\t() => this.#cleanup(element),\n\t\t\tHighlighter.ANIMATION_DURATION,\n\t\t);\n\t}\n\n\t#startAnimation(element: HTMLElement): void\n\t{\n\t\tDom.addClass(element, [Highlighter.HIGHLIGHT_CLASS, Highlighter.ANIMATE_CLASS]);\n\n\t\tconst state = this.#activeHighlights.get(element);\n\t\tif (state)\n\t\t{\n\t\t\tstate.animationStart = Date.now();\n\t\t}\n\t}\n\n\t#cleanup(element: HTMLElement): void\n\t{\n\t\tconst state = this.#activeHighlights.get(element);\n\t\tif (!state)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.removeClass(element, [Highlighter.HIGHLIGHT_CLASS, Highlighter.ANIMATE_CLASS]);\n\n\t\tif (state.timeoutId)\n\t\t{\n\t\t\tclearTimeout(state.timeoutId);\n\t\t}\n\n\t\tif (state.handler)\n\t\t{\n\t\t\tEvent.unbind(window, 'click', state.handler);\n\t\t\tEvent.unbind(window, 'keydown', state.handler);\n\t\t}\n\n\t\tthis.#activeHighlights.delete(element);\n\t}\n\n\t#nextTick(): Promise<void>\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\t// eslint-disable-next-line no-promise-executor-return\n\t\t\treturn setTimeout(resolve, 0);\n\t\t});\n\t}\n}\n","import { Dom, Type } from 'main.core';\nimport { mapActions, mapGetters } from 'ui.vue3.vuex';\nimport { Model } from 'tasks.v2.const';\nimport { checkListService } from 'tasks.v2.provider.service.check-list-service';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\nimport type { CheckListModel } from 'tasks.v2.model.check-list';\nimport type { UserModel } from 'tasks.v2.model.users';\n\n// @vue/component\nexport const CheckListItemMixin = {\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tid: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tisPreview: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: [\n\t\t'update',\n\t\t'addItem',\n\t\t'removeItem',\n\t\t'focus',\n\t\t'blur',\n\t\t'emptyBlur',\n\t\t'show',\n\t\t'hide',\n\t],\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tisHovered: false,\n\t\t\tscrollContainer: null,\n\t\t};\n\t},\n\tcomputed: {\n\t\t...mapGetters({\n\t\t\tcurrentUserId: `${Model.Interface}/currentUserId`,\n\t\t}),\n\t\tisEdit(): boolean\n\t\t{\n\t\t\treturn Type.isNumber(this.taskId) && this.taskId > 0;\n\t\t},\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.taskId);\n\t\t},\n\t\tcheckLists(): CheckListModel[]\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.CheckList}/getByIds`](this.task.checklist);\n\t\t},\n\t\titem(): CheckListModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.CheckList}/getById`](this.id);\n\t\t},\n\t\tcanSave(): boolean\n\t\t{\n\t\t\tif (!this.isEdit)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn this.task.rights.checklistSave === true;\n\t\t},\n\t\tcanAdd(): boolean\n\t\t{\n\t\t\tif (!this.isEdit)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn this.task.rights.checklistAdd === true;\n\t\t},\n\t\tcanEdit(): boolean\n\t\t{\n\t\t\tif (!this.isEdit)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn (\n\t\t\t\tthis.canSave\n\t\t\t\t&& (\n\t\t\t\t\tthis.task.rights.checklistEdit === true\n\t\t\t\t\t|| this.item.creator?.id === this.currentUserId\n\t\t\t\t)\n\t\t\t);\n\t\t},\n\t\tcanCheckListToggle(): boolean\n\t\t{\n\t\t\tif (!this.isEdit)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn this.task.rights.checklistToggle === true;\n\t\t},\n\t\tcanModify(): boolean\n\t\t{\n\t\t\tif (this.canEdit === true)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn this.item.actions.modify === true;\n\t\t},\n\t\tcanRemove(): boolean\n\t\t{\n\t\t\tif (this.canEdit === true)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn this.item.actions.remove === true;\n\t\t},\n\t\tcanToggle(): boolean\n\t\t{\n\t\t\tif (this.canCheckListToggle === true)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn this.item.actions.toggle === true;\n\t\t},\n\t\thasAttachments(): boolean\n\t\t{\n\t\t\treturn this.hasUsers;\n\t\t},\n\t\thasUsers(): boolean\n\t\t{\n\t\t\treturn (\n\t\t\t\tthis.hasAccomplices\n\t\t\t\t|| this.hasAuditors\n\t\t\t);\n\t\t},\n\t\thasAccomplices(): boolean\n\t\t{\n\t\t\treturn this.accomplices?.length > 0;\n\t\t},\n\t\thasAuditors(): boolean\n\t\t{\n\t\t\treturn this.auditors?.length > 0;\n\t\t},\n\t\taccomplices(): ?UserModel[]\n\t\t{\n\t\t\treturn this.item.accomplices;\n\t\t},\n\t\tauditors(): ?UserModel[]\n\t\t{\n\t\t\treturn this.item.auditors;\n\t\t},\n\t\tfiles(): ?[]\n\t\t{\n\t\t\treturn this.item.attachments;\n\t\t},\n\t\ttextColor(): string\n\t\t{\n\t\t\treturn this.completed ? 'var(--ui-color-base-4)' : 'var(--ui-color-base-1)';\n\t\t},\n\t\tgroupMode(): boolean\n\t\t{\n\t\t\treturn this.item.groupMode?.active === true;\n\t\t},\n\t\tgroupModeSelected(): boolean\n\t\t{\n\t\t\treturn this.item.groupMode?.selected === true;\n\t\t},\n\t\tcompleted(): boolean\n\t\t{\n\t\t\treturn this.item.localCompleteState ?? this.item.isComplete;\n\t\t},\n\t},\n\tmethods: {\n\t\t...mapActions(Model.Interface, [\n\t\t\t'addCheckListCompletionCallback',\n\t\t]),\n\t\thandleFocus(): void\n\t\t{\n\t\t\tthis.$emit('focus', this.id);\n\t\t},\n\t\thandleBlur(): void\n\t\t{\n\t\t\tthis.$emit('blur', this.id);\n\t\t},\n\t\thandleEmptyBlur(): void\n\t\t{\n\t\t\tthis.$emit('emptyBlur', this.id);\n\t\t},\n\t\tupdateCheckList(id: number | string, fields: Partial<CheckListModel>): Promise<void>\n\t\t{\n\t\t\tthis.$emit('update', this.id);\n\n\t\t\treturn this.$store.dispatch(`${Model.CheckList}/update`, { id, fields });\n\t\t},\n\t\tupsertCheckLists(items: CheckListModel[]): Promise<void>\n\t\t{\n\t\t\tthis.$emit('update', this.id);\n\n\t\t\treturn this.$store.dispatch(`${Model.CheckList}/upsertMany`, items);\n\t\t},\n\t\tupdateTitle(title: string = ''): void\n\t\t{\n\t\t\tthis.$store.dispatch(`${Model.CheckList}/update`, {\n\t\t\t\tid: this.id,\n\t\t\t\tfields: { title },\n\t\t\t});\n\n\t\t\tthis.$emit('update', this.id);\n\t\t},\n\t\taddItem(sort: ?number): void\n\t\t{\n\t\t\tthis.$emit(\n\t\t\t\t'addItem',\n\t\t\t\t{\n\t\t\t\t\tid: this.id,\n\t\t\t\t\tsort: Type.isNumber(sort) ? sort : null,\n\t\t\t\t},\n\t\t\t);\n\t\t},\n\t\tremoveItem(): void\n\t\t{\n\t\t\tthis.$emit('removeItem', this.id);\n\t\t},\n\t\tasync complete(isComplete: boolean): void\n\t\t{\n\t\t\tif (this.canToggle === false)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait this.updateCheckList(this.id, { localCompleteState: isComplete });\n\n\t\t\tconst listParents = new Map();\n\t\t\tthis.checkListManager.syncParentCompletionState(\n\t\t\t\tthis.id,\n\t\t\t\tasync (id: string | number, fields: Partial<CheckListModel>) => {\n\t\t\t\t\tlistParents.set(id, fields);\n\t\t\t\t\tawait this.updateCheckList(id, { localCompleteState: fields.isComplete });\n\t\t\t\t},\n\t\t\t);\n\n\t\t\tthis.$emit('update', this.id);\n\n\t\t\tconst completionCallback = async () => {\n\t\t\t\tawait this.updateCheckList(this.id, { isComplete });\n\t\t\t\tlistParents.forEach(async (fields: Partial<CheckListModel>, id: string | number) => {\n\t\t\t\t\tawait this.updateCheckList(id, fields);\n\t\t\t\t\tthis.saveCompleteState(id, fields.isComplete);\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tthis.addCheckListCompletionCallback({\n\t\t\t\tid: this.id,\n\t\t\t\tcallback: completionCallback,\n\t\t\t});\n\n\t\t\tthis.saveCompleteState(this.id, isComplete);\n\t\t},\n\t\tsaveCompleteState(itemId: string | number, isComplete: boolean): void\n\t\t{\n\t\t\tif (!this.isPreview || !this.isEdit)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (isComplete)\n\t\t\t{\n\t\t\t\tvoid checkListService.complete(this.taskId, itemId);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tvoid checkListService.renew(this.taskId, itemId);\n\t\t\t}\n\t\t},\n\t\tfocusToItem(): void\n\t\t{\n\t\t\tconst item = this.$refs.item;\n\t\t\tconst scrollContainer = this.$parent.$el?.closest('[data-list]');\n\n\t\t\tconst itemRect = Dom.getPosition(item);\n\t\t\tconst containerRect = Dom.getPosition(scrollContainer);\n\n\t\t\tconst offsetTopInsideContainer = itemRect.top - containerRect.top + scrollContainer.scrollTop;\n\n\t\t\tscrollContainer.scrollTo({\n\t\t\t\ttop: offsetTopInsideContainer - 200,\n\t\t\t\tbehavior: 'smooth',\n\t\t\t});\n\t\t},\n\t},\n};\n","import { Event, Text } from 'main.core';\n\nimport { hint, type HintParams } from 'ui.vue3.directives.hint';\nimport { BIcon } from 'ui.icon-set.api.vue';\nimport { BMenu, type MenuOptions, type MenuItemOptions } from 'ui.vue3.components.menu';\nimport { Actions, Outline } from 'ui.icon-set.api.core';\n\nimport { Model } from 'tasks.v2.const';\nimport { GrowingTextArea } from 'tasks.v2.component.elements.growing-text-area';\nimport { UserAvatarList } from 'tasks.v2.component.elements.user-avatar-list';\nimport { UserCheckbox } from 'tasks.v2.component.elements.user-checkbox';\nimport { ProgressBar } from 'tasks.v2.component.elements.progress-bar';\nimport { tooltip } from 'tasks.v2.component.elements.hint';\nimport { checkListService } from 'tasks.v2.provider.service.check-list-service';\n\nimport type { CheckListModel } from 'tasks.v2.model.check-list';\nimport type { UserModel } from 'tasks.v2.model.users';\n\nimport { CheckListItemMixin } from './check-list-item-mixin';\nimport { CheckListManager } from '../../../lib/check-list-manager';\n\n// @vue/component\nexport const CheckListParentItem = {\n\tname: 'CheckListParentItem',\n\tcomponents: {\n\t\tBIcon,\n\t\tBMenu,\n\t\tGrowingTextArea,\n\t\tUserAvatarList,\n\t\tUserCheckbox,\n\t\tProgressBar,\n\t},\n\tdirectives: { hint },\n\tmixins: [\n\t\tCheckListItemMixin,\n\t],\n\tinject: ['setItemsRef'],\n\tprops: {\n\t\tpositionIndex: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: [\n\t\t'startGroupMode',\n\t\t'openCheckList',\n\t],\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tActions,\n\t\t\tOutline,\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tisSticky: false,\n\t\t\tisMenuShown: false,\n\t\t\tmenuRemoveSectionCode: 'removeSection',\n\t\t};\n\t},\n\tcomputed: {\n\t\tmenuOptions(): MenuOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tid: `check-list-parent-item-action-menu-${Text.getRandom()}`,\n\t\t\t\tbindElement: this.$refs.more.$el,\n\t\t\t\tminWidth: 250,\n\t\t\t\toffsetLeft: -100,\n\t\t\t\tsections: [\n\t\t\t\t\t{\n\t\t\t\t\t\tcode: this.menuRemoveSectionCode,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\titems: this.menuItems,\n\t\t\t\ttargetContainer: document.body,\n\t\t\t\tcloseByEsc: true,\n\t\t\t};\n\t\t},\n\t\tmenuItems(): MenuItemOptions[]\n\t\t{\n\t\t\tconst collapseItem = {\n\t\t\t\ttitle: (this.item.areCompletedCollapsed\n\t\t\t\t\t? this.loc('TASKS_V2_CHECK_LIST_ITEM_MENU_SHOW')\n\t\t\t\t\t: this.loc('TASKS_V2_CHECK_LIST_ITEM_MENU_HIDE')\n\t\t\t\t),\n\t\t\t\ticon: this.item.areCompletedCollapsed ? Outline.OBSERVER : Outline.CROSSED_EYE,\n\t\t\t\tdataset: {\n\t\t\t\t\tid: `MenuProfileHide-${this.id}`,\n\t\t\t\t},\n\t\t\t\tonClick: () => {\n\t\t\t\t\tconst newValue = !this.item.areCompletedCollapsed;\n\n\t\t\t\t\tvoid this.updateCheckList(this.id, { areCompletedCollapsed: newValue });\n\n\t\t\t\t\tthis.toggleCompleted(this.id, newValue);\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tconst groupActionsItem = {\n\t\t\t\ttitle: this.loc('TASKS_V2_CHECK_LIST_ITEM_MENU_GROUP'),\n\t\t\t\ticon: Outline.MULTICHOICE_ON,\n\t\t\t\tdataset: {\n\t\t\t\t\tid: `MenuProfileGroup-${this.id}`,\n\t\t\t\t},\n\t\t\t\tonClick: () => {\n\t\t\t\t\tif (this.isCollapsed(this.item))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.toggleCollapse();\n\t\t\t\t\t}\n\t\t\t\t\tthis.$emit('startGroupMode', this.id);\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tconst editItem = {\n\t\t\t\tsectionCode: this.menuRemoveSectionCode,\n\t\t\t\ttitle: this.loc('TASKS_V2_CHECK_LIST_ITEM_MENU_EDIT'),\n\t\t\t\ticon: Outline.EDIT_L,\n\t\t\t\tdataset: {\n\t\t\t\t\tid: `MenuProfileEdit-${this.id}`,\n\t\t\t\t},\n\t\t\t\tonClick: () => {\n\t\t\t\t\tif (this.canEdit)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$emit('openCheckList', this.id);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tconst removeItem = {\n\t\t\t\tsectionCode: this.menuRemoveSectionCode,\n\t\t\t\tdesign: 'alert',\n\t\t\t\ttitle: this.loc('TASKS_V2_CHECK_LIST_ITEM_MENU_REMOVE'),\n\t\t\t\ticon: Outline.TRASHCAN,\n\t\t\t\tdataset: {\n\t\t\t\t\tid: `MenuProfileRemove-${this.id}`,\n\t\t\t\t},\n\t\t\t\tonClick: this.removeItem.bind(this),\n\t\t\t};\n\n\t\t\tif (this.isPreview)\n\t\t\t{\n\t\t\t\treturn [\n\t\t\t\t\tcollapseItem,\n\t\t\t\t\tthis.canModify ? editItem : null,\n\t\t\t\t\tthis.canModify ? removeItem : null,\n\t\t\t\t];\n\t\t\t}\n\n\t\t\treturn [\n\t\t\t\tcollapseItem,\n\t\t\t\tgroupActionsItem,\n\t\t\t\tremoveItem,\n\t\t\t];\n\t\t},\n\t\titemIcon(): string\n\t\t{\n\t\t\treturn this.completed ? Outline.CHECK_L : Outline.CHECK_LIST;\n\t\t},\n\t\tcheckListStatus(): string\n\t\t{\n\t\t\tconst label = this.loc('TASKS_V2_CHECK_LIST_STATUS_LABEL_NEW');\n\n\t\t\treturn label\n\t\t\t\t.replace('#completed#', this.completedCount)\n\t\t\t\t.replace('#total#', this.totalCount);\n\t\t},\n\t\tcompletedCount(): number\n\t\t{\n\t\t\treturn this.checkLists.filter((checklist: CheckListModel) => {\n\t\t\t\treturn (\n\t\t\t\t\tchecklist.parentId === this.id\n\t\t\t\t\t&& (checklist.isComplete || checklist.localCompleteState)\n\t\t\t\t);\n\t\t\t}).length;\n\t\t},\n\t\ttotalCount(): number\n\t\t{\n\t\t\treturn this.checkLists.filter((checklist: CheckListModel) => {\n\t\t\t\treturn checklist.parentId === this.id;\n\t\t\t}).length;\n\t\t},\n\t\tcurrentUserResponsible(): boolean\n\t\t{\n\t\t\treturn this.currentUserId === this.task.responsibleId;\n\t\t},\n\t\tcurrentUser(): UserModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Users}/getById`](this.currentUserId);\n\t\t},\n\t\tnumberMyItems(): number\n\t\t{\n\t\t\treturn this.checkListManager.findItemIdsWithUser(this.id, this.currentUserId).size;\n\t\t},\n\t\tmyFilterTooltip(): Function\n\t\t{\n\t\t\treturn (): HintParams => tooltip({\n\t\t\t\ttext: (\n\t\t\t\t\tthis.myFilterActive\n\t\t\t\t\t\t? this.loc('TASKS_V2_CHECK_LIST_MY_FILTER_HINT_ALL')\n\t\t\t\t\t\t: this.loc('TASKS_V2_CHECK_LIST_MY_FILTER_HINT_MY')\n\t\t\t\t),\n\t\t\t\tpopupOptions: {\n\t\t\t\t\toffsetLeft: this.$refs.myFilter.offsetWidth / 2,\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t\tmyFilterActive(): boolean\n\t\t{\n\t\t\treturn this.item.myFilterActive;\n\t\t},\n\t},\n\twatch: {\n\t\tmyFilterActive(value: boolean): void\n\t\t{\n\t\t\tthis.handleMyFilter(value);\n\t\t},\n\t},\n\tcreated(): void\n\t{\n\t\tthis.checkListManager = new CheckListManager({\n\t\t\tcomputed: {\n\t\t\t\tcheckLists: () => this.checkLists,\n\t\t\t},\n\t\t});\n\t},\n\tmounted(): void\n\t{\n\t\tthis.scrollContainer = this.$parent.$el?.closest('[data-list]');\n\n\t\tif (this.setItemsRef)\n\t\t{\n\t\t\tthis.setItemsRef(this.id, this);\n\t\t}\n\n\t\tif (this.scrollContainer)\n\t\t{\n\t\t\tEvent.bind(this.scrollContainer, 'scroll', this.handleScroll);\n\n\t\t\tvoid this.$nextTick(this.checkSticky);\n\n\t\t\tthis.mutationObserver = new MutationObserver(() => {\n\t\t\t\tthis.checkSticky();\n\t\t\t});\n\t\t\tthis.mutationObserver.observe(\n\t\t\t\tthis.scrollContainer,\n\t\t\t\t{\n\t\t\t\t\tchildList: true,\n\t\t\t\t\tsubtree: true,\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tif (this.scrollContainer)\n\t\t{\n\t\t\tEvent.unbind(this.scrollContainer, 'scroll', this.handleScroll);\n\t\t}\n\n\t\tif (this.mutationObserver)\n\t\t{\n\t\t\tthis.mutationObserver.disconnect();\n\t\t}\n\n\t\tif (this.setItemsRef)\n\t\t{\n\t\t\tthis.setItemsRef(this.id, null);\n\t\t}\n\t},\n\tmethods: {\n\t\thandleScroll(): void\n\t\t{\n\t\t\tthis.checkSticky();\n\t\t},\n\t\thandleTextClick(): void\n\t\t{\n\t\t\tif (this.isPreview && this.canModify)\n\t\t\t{\n\t\t\t\tthis.$emit('openCheckList', this.id);\n\t\t\t}\n\t\t},\n\t\thandleMyFilter(checked: boolean): void\n\t\t{\n\t\t\tconst myItemIds = this.checkListManager.findItemIdsWithUser(\n\t\t\t\tthis.id,\n\t\t\t\tthis.currentUserId,\n\t\t\t);\n\n\t\t\tthis.$store.dispatch(`${Model.CheckList}/update`, {\n\t\t\t\tid: this.id,\n\t\t\t\tfields: { myFilterActive: checked },\n\t\t\t});\n\n\t\t\tif (checked === true)\n\t\t\t{\n\t\t\t\tconst idsToHide = this.checkListManager.getAllChildren(this.id)\n\t\t\t\t\t.filter((item: CheckListModel) => !myItemIds.has(item.id))\n\t\t\t\t\t.map((item: CheckListModel) => item.id);\n\n\t\t\t\tthis.checkListManager.hideItems(\n\t\t\t\t\tidsToHide,\n\t\t\t\t\t(updates: CheckListModel[]) => this.upsertCheckLists(updates),\n\t\t\t\t);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst childrenIds = this.checkListManager\n\t\t\t\t\t.getAllChildren(this.id)\n\t\t\t\t\t.map((item: CheckListModel) => item.id);\n\n\t\t\t\tthis.checkListManager.showItems(\n\t\t\t\t\tchildrenIds,\n\t\t\t\t\t(updates: CheckListModel[]) => this.upsertCheckLists(updates),\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\tcheckSticky(): void\n\t\t{\n\t\t\tif (!this.scrollContainer || !this.$refs.item)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst stickyRect = this.$refs.item.getBoundingClientRect();\n\t\t\tconst containerRect = this.scrollContainer.getBoundingClientRect();\n\n\t\t\tthis.isSticky = stickyRect.top <= (containerRect.top + stickyRect.height / 2);\n\t\t},\n\t\tshowMenu(): void\n\t\t{\n\t\t\tthis.isMenuShown = true;\n\t\t},\n\t\ttoggleCollapse(): void\n\t\t{\n\t\t\tconst localCollapsedState = !this.isCollapsed(this.item);\n\n\t\t\tif (this.isPreview && this.isEdit)\n\t\t\t{\n\t\t\t\tif (localCollapsedState === true)\n\t\t\t\t{\n\t\t\t\t\tvoid checkListService.collapse(this.taskId, this.id);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tvoid checkListService.expand(this.taskId, this.id);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.$store.dispatch(`${Model.CheckList}/update`, {\n\t\t\t\tid: this.id,\n\t\t\t\tfields: { localCollapsedState },\n\t\t\t});\n\t\t},\n\t\tisCollapsed(item: CheckListModel): boolean\n\t\t{\n\t\t\treturn this.checkListManager.isItemCollapsed(item, this.isPreview, this.positionIndex);\n\t\t},\n\t\ttoggleCompleted(itemId: number | string, collapsed: boolean): void\n\t\t{\n\t\t\tthis.checkListManager.getAllCompletedChildren(itemId)\n\t\t\t\t.forEach((item: CheckListModel) => {\n\t\t\t\t\tif (collapsed === false)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.checkListManager.showItems(\n\t\t\t\t\t\t\t[item.id],\n\t\t\t\t\t\t\t(updates: CheckListModel[]) => this.upsertCheckLists(updates),\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.checkListManager.hideItems(\n\t\t\t\t\t\t\t[item.id],\n\t\t\t\t\t\t\t(updates: CheckListModel[]) => this.upsertCheckLists(updates),\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tref=\"item\"\n\t\t\tclass=\"check-list-widget-parent-item\"\n\t\t\t:class=\"{\n\t\t\t\t'--complete': completed,\n\t\t\t\t'--collapsed': isCollapsed(item),\n\t\t\t\t'--preview': isPreview,\n\t\t\t\t'--editable': canModify,\n\t\t\t}\"\n\t\t\t:data-id=\"id\"\n\t\t\t:data-parent=\"id\"\n\t\t>\n\t\t\t<div class=\"check-list-widget-parent-item-label-container\">\n\t\t\t\t<BIcon :name=\"itemIcon\"/>\n\t\t\t</div>\n\t\t\t<div class=\"check-list-widget-parent-item-title-container\">\n\t\t\t\t<GrowingTextArea\n\t\t\t\t\tref=\"growingTextArea\"\n\t\t\t\t\tclass=\"check-list-widget-parent-item-title\"\n\t\t\t\t\t:data-check-list-id=\"'check-list-parent-item-title-' + id\"\n\t\t\t\t\t:modelValue=\"item.title\"\n\t\t\t\t\t:placeholder=\"loc('TASKS_V2_CHECK_LIST_ITEM_PLACEHOLDER')\"\n\t\t\t\t\t:readonly=\"groupMode || isPreview\"\n\t\t\t\t\t:fontColor=\"textColor\"\n\t\t\t\t\t:fontSize=\"17\"\n\t\t\t\t\t:lineHeight=\"20\"\n\t\t\t\t\t:fontWeight=\"500\"\n\t\t\t\t\t@click=\"handleTextClick\"\n\t\t\t\t\t@update:modelValue=\"updateTitle\"\n\t\t\t\t\t@input=\"updateTitle\"\n\t\t\t\t\t@focus=\"handleFocus\"\n\t\t\t\t\t@emptyFocus=\"focusToItem\"\n\t\t\t\t\t@blur=\"handleBlur\"\n\t\t\t\t\t@emptyBlur=\"handleEmptyBlur\"\n\t\t\t\t/>\n\t\t\t\t<template v-if=\"hasAttachments\">\n\t\t\t\t\t<div class=\"check-list-widget-item-attach --parent\">\n\t\t\t\t\t\t<div v-if=\"hasUsers\" class=\"check-list-widget-item-attach-users\">\n\t\t\t\t\t\t\t<div v-if=\"hasAccomplices\" class=\"check-list-widget-item-attach-users-list\">\n\t\t\t\t\t\t\t\t<BIcon :name=\"Outline.GROUP\"/>\n\t\t\t\t\t\t\t\t<UserAvatarList :users=\"accomplices\"/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div v-if=\"hasAuditors\" class=\"check-list-widget-item-attach-users-list\">\n\t\t\t\t\t\t\t\t<BIcon :name=\"Outline.OBSERVER\"/>\n\t\t\t\t\t\t\t\t<UserAvatarList :users=\"auditors\"/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<div class=\"check-list-widget-parent-item-title-status\">\n\t\t\t\t\t<div class=\"check-list-widget-parent-item-title-status-label\">\n\t\t\t\t\t\t{{ checkListStatus }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<ProgressBar\n\t\t\t\t\t\t:totalValue=\"totalCount\"\n\t\t\t\t\t\t:completedValue=\"completedCount\"\n\t\t\t\t\t\t:width=\"56\"\n\t\t\t\t\t\t:height=\"5\"\n\t\t\t\t\t\tcolor=\"var(--ui-color-accent-main-primary-alt)\"\n\t\t\t\t\t\tbgColor=\"var(--ui-color-base-7)\"\n\t\t\t\t\t\t:borderRadius=\"30\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"check-list-widget-parent-item-action\">\n\t\t\t\t<div class=\"check-list-widget-parent-item-main-action\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tref=\"myFilter\"\n\t\t\t\t\t\tclass=\"check-list-widget-parent-item-main-action-filter\"\n\t\t\t\t\t\tv-hint=\"myFilterTooltip\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<UserCheckbox\n\t\t\t\t\t\t\tv-if=\"!currentUserResponsible && numberMyItems > 0\"\n\t\t\t\t\t\t\t:init-user=\"currentUser\"\n\t\t\t\t\t\t\t:number=\"numberMyItems\"\n\t\t\t\t\t\t\tv-model:checked=\"item.myFilterActive\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"check-list-widget-parent-item-main-action-actions\">\n\t\t\t\t\t\t<BIcon ref=\"more\" :name=\"Outline.MORE_L\" @click=\"showMenu\" />\n\t\t\t\t\t\t<BIcon\n\t\t\t\t\t\t\t:name=\"isCollapsed(item) ? Actions.CHEVRON_DOWN : Actions.CHEVRON_UP\"\n\t\t\t\t\t\t\t@click=\"toggleCollapse()\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-if=\"isSticky && !isPreview\" class=\"check-list-widget-parent-item-empty\"></div>\n\t\t\t</div>\n\t\t\t<BMenu v-if=\"isMenuShown\" :options=\"menuOptions\" @close=\"isMenuShown = false\"/>\n\t\t</div>\n\t`,\n};\n","import { Dom } from 'main.core';\nimport { BIcon } from 'ui.icon-set.api.vue';\nimport { Outline } from 'ui.icon-set.api.core';\nimport { BLine } from 'ui.system.skeleton.vue';\nimport type { VueUploaderAdapter } from 'ui.uploader.vue';\n\nimport { UserFieldWidgetComponent, type UserFieldWidgetOptions } from 'disk.uploader.user-field-widget';\n\nimport { Model } from 'tasks.v2.const';\nimport { GrowingTextArea } from 'tasks.v2.component.elements.growing-text-area';\nimport { UserAvatarList } from 'tasks.v2.component.elements.user-avatar-list';\nimport { fileService, EntityTypes } from 'tasks.v2.provider.service.file-service';\n\nimport { CheckListManager } from '../../../lib/check-list-manager';\nimport { CheckListItemMixin } from './check-list-item-mixin';\n\n// @vue/component\nexport const CheckListChildItem = {\n\tname: 'CheckListChildItem',\n\tcomponents: {\n\t\tBIcon,\n\t\tBLine,\n\t\tGrowingTextArea,\n\t\tUserAvatarList,\n\t\tUserFieldWidgetComponent,\n\t},\n\tmixins: [\n\t\tCheckListItemMixin,\n\t],\n\tinject: ['setItemsRef'],\n\tprops: {\n\t\titemOffset: {\n\t\t\ttype: String,\n\t\t\tdefault: '0',\n\t\t},\n\t},\n\temits: [\n\t\t'toggleGroupModeSelected',\n\t],\n\tsetup(props: Object): { uploaderAdapter: VueUploaderAdapter }\n\t{\n\t\tconst fileServiceInstance = fileService.get(\n\t\t\tprops.id,\n\t\t\tEntityTypes.CheckListItem,\n\t\t\t{ parentEntityId: props.taskId },\n\t\t);\n\n\t\treturn {\n\t\t\tOutline,\n\t\t\tfileService: fileServiceInstance,\n\t\t\tuploaderAdapter: fileServiceInstance.getAdapter(),\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tuploadingFiles: this.fileService.getFiles(),\n\t\t\tfilesLoading: false,\n\t\t};\n\t},\n\tcomputed: {\n\t\twidgetOptions(): UserFieldWidgetOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tisEmbedded: true,\n\t\t\t\twithControlPanel: false,\n\t\t\t\tcanCreateDocuments: false,\n\t\t\t\ttileWidgetOptions: {\n\t\t\t\t\tcompact: true,\n\t\t\t\t\thideDropArea: true,\n\t\t\t\t\tenableDropzone: false,\n\t\t\t\t\treadonly: this.isPreview,\n\t\t\t\t\tautoCollapse: false,\n\t\t\t\t\tremoveFromServer: !this.isEdit,\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\thasAttachments(): boolean\n\t\t{\n\t\t\treturn this.hasUsers || this.hasFilesAttach;\n\t\t},\n\t\thasFilesAttach(): boolean\n\t\t{\n\t\t\treturn (\n\t\t\t\tthis.hasFiles\n\t\t\t\t|| this.fileService.isUploading()\n\t\t\t\t|| this.fileService.hasUploadingError()\n\t\t\t);\n\t\t},\n\t\thasFiles(): boolean\n\t\t{\n\t\t\treturn this.filesNumber > 0;\n\t\t},\n\t\tfilesNumber(): boolean\n\t\t{\n\t\t\tif (!this.files)\n\t\t\t{\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\treturn this.files.length;\n\t\t},\n\t\thasTrashcanIcon(): boolean\n\t\t{\n\t\t\treturn (\n\t\t\t\tthis.isHovered\n\t\t\t\t&& !this.item.panelIsShown\n\t\t\t\t&& !this.groupMode\n\t\t\t\t&& !this.isPreview\n\t\t\t);\n\t\t},\n\t\treadOnly(): boolean\n\t\t{\n\t\t\treturn this.isPreview;\n\t\t},\n\t},\n\tcreated(): void\n\t{\n\t\tif (this.hasFilesAttach)\n\t\t{\n\t\t\tvoid this.loadFiles();\n\t\t}\n\n\t\tthis.checkListManager = new CheckListManager({\n\t\t\tcomputed: {\n\t\t\t\tcheckLists: () => this.checkLists,\n\t\t\t},\n\t\t});\n\t},\n\tmounted(): void\n\t{\n\t\tif (this.setItemsRef)\n\t\t{\n\t\t\tthis.setItemsRef(this.id, this);\n\t\t}\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tif (this.setItemsRef)\n\t\t{\n\t\t\tthis.setItemsRef(this.id, null);\n\t\t}\n\t},\n\tmethods: {\n\t\ttoggleGroupModeSelected(): void\n\t\t{\n\t\t\tthis.$store.dispatch(`${Model.CheckList}/update`, {\n\t\t\t\tid: this.id,\n\t\t\t\tfields: {\n\t\t\t\t\tgroupMode: {\n\t\t\t\t\t\tactive: true,\n\t\t\t\t\t\tselected: !this.groupModeSelected,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tthis.$emit('toggleGroupModeSelected', this.id);\n\t\t},\n\t\tasync loadFiles(): Promise<void>\n\t\t{\n\t\t\tthis.filesLoading = true;\n\n\t\t\tconst ids = this.files?.map((file) => file?.id ?? file);\n\n\t\t\tawait this.fileService.list(ids ?? []);\n\n\t\t\tthis.filesLoading = false;\n\t\t},\n\t\thandleEnter(): void\n\t\t{\n\t\t\tif (!this.item)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.addItem(this.item.sortIndex + 1);\n\t\t},\n\t\thandleClick(event: PointerEvent): void\n\t\t{\n\t\t\tconst filesWidget = this.$refs['files-widget'];\n\n\t\t\tif (this.isClickInsideFilesWidget(filesWidget?.$el, event.target))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.groupMode)\n\t\t\t{\n\t\t\t\tthis.toggleGroupModeSelected();\n\t\t\t}\n\n\t\t\tif (this.isPreview)\n\t\t\t{\n\t\t\t\tthis.complete(!this.completed);\n\t\t\t}\n\t\t},\n\t\tisClickInsideFilesWidget(filesNode: HTMLElement, target: HTMLElement): boolean\n\t\t{\n\t\t\tif (!filesNode || !target)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst excludedClasses = ['ui-tile-uploader-items'];\n\n\t\t\tconst isInsideWidget = filesNode.contains(target);\n\t\t\tif (!isInsideWidget)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst hasExcludedClass = excludedClasses.some((className: string) => Dom.hasClass(target, className));\n\n\t\t\treturn !hasExcludedClass;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tref=\"item\"\n\t\t\tclass=\"check-list-widget-child-item\"\n\t\t\t:class=\"{\n\t\t\t\t'--complete': completed,\n\t\t\t\t'--group-mode': groupMode,\n\t\t\t\t'--group-mode-selected': groupModeSelected,\n\t\t\t\t'--preview': isPreview,\n\t\t\t\t'--toggleable': canToggle,\n\t\t\t}\"\n\t\t\t:data-id=\"id\"\n\t\t\t:style=\"{ marginLeft: itemOffset }\"\n\t\t\t@mouseover=\"isHovered = true\"\n\t\t\t@mouseleave=\"isHovered = false\"\n\t\t\t@click=\"handleClick\"\n\t\t>\n\t\t\t<div class=\"check-list-widget-child-item-base\">\n\t\t\t\t<label\n\t\t\t\t\tclass=\"check-list-widget-child-item-checkbox\"\n\t\t\t\t\t:class=\"{'--important': !item.isImportant}\"\n\t\t\t\t>\n\t\t\t\t\t<input\n\t\t\t\t\t\tref=\"checkbox\"\n\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\t:checked=\"completed\"\n\t\t\t\t\t\t:disabled=\"!canToggle || groupMode\"\n\t\t\t\t\t\t@click.stop=\"complete(!completed)\"\n\t\t\t\t\t>\n\t\t\t\t</label>\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"item.isImportant\"\n\t\t\t\t\tclass=\"check-list-widget-child-item-important\"\n\t\t\t\t>\n\t\t\t\t\t<BIcon :name=\"Outline.FIRE_SOLID\" :hoverable=\"false\"/>\n\t\t\t\t</div>\n\t\t\t\t<GrowingTextArea\n\t\t\t\t\tref=\"growingTextArea\"\n\t\t\t\t\tclass=\"check-list-widget-child-item-title\"\n\t\t\t\t\t:data-check-list-id=\"'check-list-child-item-title-' + item.id\"\n\t\t\t\t\t:modelValue=\"item.title\"\n\t\t\t\t\t:placeholder=\"loc('TASKS_V2_CHECK_LIST_ITEM_PLACEHOLDER')\"\n\t\t\t\t\t:readonly=\"groupMode || isPreview\"\n\t\t\t\t\t:fontColor=\"textColor\"\n\t\t\t\t\t:fontSize=\"15\"\n\t\t\t\t\t:lineHeight=\"20\"\n\t\t\t\t\t@update:modelValue=\"updateTitle\"\n\t\t\t\t\t@input=\"updateTitle\"\n\t\t\t\t\t@focus=\"handleFocus\"\n\t\t\t\t\t@blur=\"handleBlur\"\n\t\t\t\t\t@emptyBlur=\"handleEmptyBlur\"\n\t\t\t\t\t@emptyFocus=\"focusToItem\"\n\t\t\t\t\t@enterBlur=\"handleEnter\"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"hasTrashcanIcon\"\n\t\t\t\t\tclass=\"check-list-widget-child-item-action\"\n\t\t\t\t\t@click=\"removeItem\"\n\t\t\t\t>\n\t\t\t\t\t<BIcon :name=\"Outline.TRASHCAN\"/>\n\t\t\t\t</div>\n\t\t\t\t<div v-else-if=\"groupMode\" class=\"check-list-widget-child-item-action-checkbox\">\n\t\t\t\t\t<input\n\t\t\t\t\t\tref=\"checkbox\"\n\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\t:checked=\"groupModeSelected\"\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t\t<div v-else class=\"check-list-widget-child-item-action-stub\"></div>\n\t\t\t</div>\n\t\t\t<template v-if=\"hasAttachments\">\n\t\t\t\t<div class=\"check-list-widget-item-attach\">\n\t\t\t\t\t<div v-if=\"hasUsers\" class=\"check-list-widget-item-attach-users\">\n\t\t\t\t\t\t<div v-if=\"hasAccomplices\" class=\"check-list-widget-item-attach-users-list\">\n\t\t\t\t\t\t\t<BIcon :name=\"Outline.GROUP\"/>\n\t\t\t\t\t\t\t<UserAvatarList :users=\"accomplices\"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-if=\"hasAuditors\" class=\"check-list-widget-item-attach-users-list\">\n\t\t\t\t\t\t\t<BIcon :name=\"Outline.OBSERVER\"/>\n\t\t\t\t\t\t\t<UserAvatarList :users=\"auditors\"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if=\"hasFilesAttach\" class=\"check-list-widget-item-attach-files\">\n\t\t\t\t\t\t<div class=\"check-list-widget-item-attach-files-list\">\n\t\t\t\t\t\t\t<template v-if=\"filesLoading\">\n\t\t\t\t\t\t\t\t<div class=\"check-list-widget-item-attach-files-list-skeleton\">\n\t\t\t\t\t\t\t\t\t<BLine\n\t\t\t\t\t\t\t\t\t\tv-for=\"index in filesNumber\"\n\t\t\t\t\t\t\t\t\t\t:key=\"index\"\n\t\t\t\t\t\t\t\t\t\t:width=\"114\"\n\t\t\t\t\t\t\t\t\t\t:height=\"90\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t<UserFieldWidgetComponent\n\t\t\t\t\t\t\t\t\tref=\"files-widget\"\n\t\t\t\t\t\t\t\t\t:uploaderAdapter=\"uploaderAdapter\"\n\t\t\t\t\t\t\t\t\t:widgetOptions=\"widgetOptions\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\t`,\n};\n","import { BIcon } from 'ui.icon-set.api.vue';\nimport { Outline } from 'ui.icon-set.api.core';\n\n// @vue/component\nexport const CheckListAddItem = {\n\tname: 'CheckListAddItem',\n\tcomponents: {\n\t\tBIcon,\n\t},\n\tprops: {\n\t\tisPreview: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: ['addItem'],\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tOutline,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"check-list-widget-add-item\"\n\t\t\t:class=\"{'--preview': isPreview}\"\n\t\t\t@mousedown=\"$emit('addItem')\"\n\t\t>\n\t\t\t<div class=\"check-list-widget-add-item-icon\">\n\t\t\t\t<BIcon :name=\"Outline.PLUS_L\"/>\n\t\t\t</div>\n\t\t\t<div class=\"check-list-widget-add-item-title\">\n\t\t\t\t{{ loc('TASKS_V2_CHECK_LIST_ITEM_ADD_BTN') }}\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { BIcon, Actions, Outline } from 'ui.icon-set.api.vue';\n\nimport 'ui.icon-set.actions';\nimport 'ui.icon-set.outline';\n\n// @vue/component\nexport const CheckListGroupCompletedList = {\n\tname: 'CheckListGroupCompletedList',\n\tcomponents: {\n\t\tBIcon,\n\t},\n\tprops: {\n\t\ttotalCompletedParents: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tActions,\n\t\t\tOutline,\n\t\t};\n\t},\n\tcomputed: {\n\t\tcompletedParentsLabel(): string\n\t\t{\n\t\t\treturn this.loc(\n\t\t\t\t'TASKS_V2_CHECK_LIST_PREVIEW_COMPLETED',\n\t\t\t\t{ '#number#': this.totalCompletedParents },\n\t\t\t);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"check-list-widget-group-completed-list\">\n\t\t\t<div class=\"check-list-widget-group-completed-list-icon\">\n\t\t\t\t<BIcon :name=\"Outline.CHECK_L\"/>\n\t\t\t</div>\n\t\t\t<div class=\"check-list-widget-group-completed-list-title\">\n\t\t\t\t{{ completedParentsLabel }}\n\t\t\t</div>\n\t\t\t<div class=\"check-list-widget-group-completed-list-action\">\n\t\t\t\t<BIcon :name=\"Actions.CHEVRON_RIGHT\" />\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Type } from 'main.core';\nimport { Model } from 'tasks.v2.const';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\nimport type { CheckListModel } from 'tasks.v2.model.check-list';\nimport { mapGetters } from 'ui.vue3.vuex';\n\nimport { CheckListManager } from '../../lib/check-list-manager';\nimport { Highlighter } from '../../lib/highlighter/highlighter';\n\nimport { CheckListParentItem } from './component/check-list-parent-item';\nimport { CheckListChildItem } from './component/check-list-child-item';\nimport { CheckListAddItem } from './component/check-list-add-item';\nimport { CheckListGroupCompletedList } from './component/check-list-group-completed-list';\n\nimport './check-list-widget.css';\n\n// @vue/component\nexport const CheckListWidget = {\n\tname: 'CheckListWidget',\n\tcomponents: {\n\t\tCheckListParentItem,\n\t\tCheckListChildItem,\n\t\tCheckListAddItem,\n\t\tCheckListGroupCompletedList,\n\t},\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tcheckListId: {\n\t\t\ttype: [Number, String],\n\t\t\tdefault: 0,\n\t\t},\n\t\tparentId: {\n\t\t\ttype: [Number, String],\n\t\t\tdefault: 0,\n\t\t},\n\t\tisPreview: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: [\n\t\t'show',\n\t\t'update',\n\t\t'addItem',\n\t\t'addItemFromBtn',\n\t\t'removeItem',\n\t\t'focus',\n\t\t'blur',\n\t\t'emptyBlur',\n\t\t'startGroupMode',\n\t\t'toggleGroupModeSelected',\n\t\t'openCheckList',\n\t],\n\tdata(): Object\n\t{\n\t\treturn {};\n\t},\n\tcomputed: {\n\t\t...mapGetters({\n\t\t\tcurrentUserId: `${Model.Interface}/currentUserId`,\n\t\t\tdisableCheckListAnimations: `${Model.Interface}/disableCheckListAnimations`,\n\t\t}),\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.taskId);\n\t\t},\n\t\tisEdit(): boolean\n\t\t{\n\t\t\treturn Type.isNumber(this.taskId) && this.taskId > 0;\n\t\t},\n\t\tcheckLists(): CheckListModel[]\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.CheckList}/getByIds`](this.task.checklist);\n\t\t},\n\t\tparentCheckLists(): CheckListModel[] {\n\t\t\treturn this.checkLists\n\t\t\t\t.filter((checkList: CheckListModel) => {\n\t\t\t\t\tif (checkList.parentId !== 0 || checkList.hidden)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tthis.isEdit\n\t\t\t\t\t\t&& !this.isPreview\n\t\t\t\t\t\t&& !this.canEditCheckList(checkList)\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn !(this.isPreview && checkList.isComplete);\n\t\t\t\t})\n\t\t\t\t.sort((a: CheckListModel, b: CheckListModel) => {\n\t\t\t\t\tif (a.isComplete === b.isComplete)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn a.sortIndex - b.sortIndex;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn a.isComplete ? 1 : -1;\n\t\t\t\t});\n\t\t},\n\t\ttotalCompletedParents(): number\n\t\t{\n\t\t\treturn this.checkLists.filter((checkList: CheckListModel) => {\n\t\t\t\treturn checkList.parentId === 0 && checkList.isComplete;\n\t\t\t}).length;\n\t\t},\n\t\tsiblings(): CheckListModel[]\n\t\t{\n\t\t\treturn this.checkLists\n\t\t\t\t.filter((item: CheckListModel) => item.parentId === this.parentId)\n\t\t\t\t.sort((a: CheckListModel, b: CheckListModel) => a.sortIndex - b.sortIndex);\n\t\t},\n\t\tcanAddItem(): boolean\n\t\t{\n\t\t\tif (!this.isEdit)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn this.task.rights.checklistAdd === true;\n\t\t},\n\t},\n\tcreated(): void\n\t{\n\t\tthis.checkListManager = new CheckListManager({\n\t\t\tcomputed: {\n\t\t\t\tcheckLists: () => this.checkLists,\n\t\t\t},\n\t\t});\n\t},\n\tmounted(): void\n\t{\n\t\tif (this.checkListManager.getItem(this.checkListId))\n\t\t{\n\t\t\tthis.scrollContainer = this.$root.$el?.querySelector(['[data-list]']);\n\n\t\t\tconst childWithEmptyTitle = this.checkListManager.getChildWithEmptyTitle(this.checkListId);\n\n\t\t\tconst isFocusToCheckList = !childWithEmptyTitle;\n\n\t\t\tconst targetItemId = isFocusToCheckList ? this.checkListId : childWithEmptyTitle.id;\n\t\t\tconst scrollOffset = isFocusToCheckList ? 0 : 140;\n\n\t\t\tconst targetItem = this.scrollContainer.querySelector([`[data-id=\"${targetItemId}\"]`]);\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (isFocusToCheckList)\n\t\t\t\t{\n\t\t\t\t\tconst highlightElement = this.scrollContainer.querySelector(\n\t\t\t\t\t\t[`[data-parent-container=\"${this.checkListId}\"]`],\n\t\t\t\t\t);\n\n\t\t\t\t\tif (highlightElement)\n\t\t\t\t\t{\n\t\t\t\t\t\tvoid (new Highlighter()).highlight(highlightElement);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (targetItem)\n\t\t\t\t{\n\t\t\t\t\tthis.scrollContainer.scrollTop = targetItem.offsetTop - scrollOffset;\n\t\t\t\t}\n\t\t\t}, 0);\n\t\t}\n\n\t\tthis.$emit('show');\n\t},\n\tmethods: {\n\t\tgetItemOffset(item: CheckListModel): string\n\t\t{\n\t\t\tif (item.parentId === 0)\n\t\t\t{\n\t\t\t\treturn '0';\n\t\t\t}\n\n\t\t\tconst level = this.checkListManager.getItemLevel(item);\n\t\t\tif (level === 1)\n\t\t\t{\n\t\t\t\treturn '0';\n\t\t\t}\n\n\t\t\treturn `${(level - 1) * 12}px`;\n\t\t},\n\t\tgetChildren(parent: CheckListModel): CheckListModel[]\n\t\t{\n\t\t\treturn this.checkListManager\n\t\t\t\t.getAllChildren(parent.id)\n\t\t\t\t.filter((checkList: CheckListModel) => !checkList.hidden);\n\t\t},\n\t\tisCollapsed(item: CheckListModel, positionIndex: number): boolean\n\t\t{\n\t\t\treturn this.checkListManager.isItemCollapsed(item, this.isPreview, positionIndex);\n\t\t},\n\t\tgetFirstCompletedCheckList(): ?CheckListModel\n\t\t{\n\t\t\tconst completedCheckLists = this.checkLists\n\t\t\t\t.filter((checkList: CheckListModel) => {\n\t\t\t\t\treturn checkList.parentId === 0 && checkList.isComplete === true;\n\t\t\t\t})\n\t\t\t\t.sort((a: CheckListModel, b: CheckListModel) => a.sortIndex - b.sortIndex);\n\n\t\t\treturn completedCheckLists[0];\n\t\t},\n\t\tshowFirstCompletedCheckList(): void\n\t\t{\n\t\t\tconst firstCompletedCheckList = this.getFirstCompletedCheckList();\n\n\t\t\tthis.$emit('openCheckList', firstCompletedCheckList.id);\n\t\t},\n\t\tcanEditCheckList(item: CheckListModel): boolean\n\t\t{\n\t\t\tif (!item.creator)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn (\n\t\t\t\tthis.task.rights.checklistEdit === true\n\t\t\t\t|| item.creator.id === this.currentUserId\n\t\t\t);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"check-list-widget-container\">\n\t\t\t<TransitionGroup\n\t\t\t\t:css=\"!disableCheckListAnimations\"\n\t\t\t\tname=\"check-list\"\n\t\t\t\tmode=\"out-in\"\n\t\t\t\ttag=\"ul\"\n\t\t\t\tclass=\"check-list-widget --parent\"\n\t\t\t\t:class=\"{'--preview': isPreview}\"\n\t\t\t>\n\t\t\t\t<li\n\t\t\t\t\tv-for=\"(parentItem, parentItemIndex) in parentCheckLists\"\n\t\t\t\t\t:key=\"parentItem.id\"\n\t\t\t\t\tclass=\"check-list-widget-item --parent\"\n\t\t\t\t\t:class=\"{\n\t\t\t\t\t\t'--preview': isPreview,\n\t\t\t\t\t\t'--collapsed': isCollapsed(parentItem, parentItemIndex),\n\t\t\t\t\t\t'--hidden': parentItem.hidden,\n\t\t\t\t\t}\"\n\t\t\t\t\t:data-parent-container=\"parentItem.id\"\n\t\t\t\t>\n\t\t\t\t\t<CheckListParentItem\n\t\t\t\t\t\t:id=\"parentItem.id\"\n\t\t\t\t\t\t:taskId=\"taskId\"\n\t\t\t\t\t\t:isPreview=\"isPreview\"\n\t\t\t\t\t\t:positionIndex=\"parentItemIndex\"\n\t\t\t\t\t\t@update=\"(id) => $emit('update', id)\"\n\t\t\t\t\t\t@removeItem=\"(id) => $emit('removeItem', id)\"\n\t\t\t\t\t\t@focus=\"(id) => $emit('focus', id)\"\n\t\t\t\t\t\t@blur=\"(id) => $emit('blur', id)\"\n\t\t\t\t\t\t@emptyBlur=\"(id) => $emit('emptyBlur', id)\"\n\t\t\t\t\t\t@startGroupMode=\"(id) => $emit('startGroupMode', id)\"\n\t\t\t\t\t\t@openCheckList=\"(id) => $emit('openCheckList', id)\"\n\t\t\t\t\t/>\n\t\t\t\t\t<TransitionGroup\n\t\t\t\t\t\t:css=\"!disableCheckListAnimations\"\n\t\t\t\t\t\tname=\"check-list\"\n\t\t\t\t\t\tmode=\"out-in\"\n\t\t\t\t\t\ttag=\"ul\"\n\t\t\t\t\t\tclass=\"check-list-widget\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<li\n\t\t\t\t\t\t\tv-if=\"!isCollapsed(parentItem, parentItemIndex)\"\n\t\t\t\t\t\t\tv-for=\"childItem in getChildren(parentItem)\"\n\t\t\t\t\t\t\t:key=\"childItem.id\"\n\t\t\t\t\t\t\tclass=\"check-list-widget-item\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<CheckListChildItem\n\t\t\t\t\t\t\t\t:id=\"childItem.id\"\n\t\t\t\t\t\t\t\t:taskId=\"taskId\"\n\t\t\t\t\t\t\t\t:itemOffset=\"getItemOffset(childItem)\"\n\t\t\t\t\t\t\t\t:isPreview=\"isPreview\"\n\t\t\t\t\t\t\t\t@update=\"(id) => $emit('update', id)\"\n\t\t\t\t\t\t\t\t@addItem=\"(data) => $emit('addItem', data)\"\n\t\t\t\t\t\t\t\t@removeItem=\"(id) => $emit('removeItem', id)\"\n\t\t\t\t\t\t\t\t@focus=\"(id) => $emit('focus', id)\"\n\t\t\t\t\t\t\t\t@blur=\"(id) => $emit('blur', id)\"\n\t\t\t\t\t\t\t\t@emptyBlur=\"(id) => $emit('emptyBlur', id)\"\n\t\t\t\t\t\t\t\t@toggleGroupModeSelected=\"(id) => $emit('toggleGroupModeSelected', id)\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li\n\t\t\t\t\t\t\tv-if=\"!isCollapsed(parentItem, parentItemIndex) && canAddItem\"\n\t\t\t\t\t\t\tkey=\"add-item\"\n\t\t\t\t\t\t\tclass=\"check-list-widget-item\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<CheckListAddItem\n\t\t\t\t\t\t\t\t:isPreview=\"isPreview\"\n\t\t\t\t\t\t\t\t@addItem=\"$emit('addItemFromBtn', parentItem.id)\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t</TransitionGroup>\n\t\t\t\t</li>\n\t\t\t\t<li\n\t\t\t\t\tv-if=\"isPreview && totalCompletedParents > 0\"\n\t\t\t\t\tkey=\"completed-list\"\n\t\t\t\t\tclass=\"check-list-widget-item --completed-list\"\n\t\t\t\t>\n\t\t\t\t\t<CheckListGroupCompletedList\n\t\t\t\t\t\t:totalCompletedParents=\"totalCompletedParents\"\n\t\t\t\t\t\t@click=\"showFirstCompletedCheckList\"\n\t\t\t\t\t/>\n\t\t\t\t</li>\n\t\t\t</TransitionGroup>\n\t\t</div>\n\t`,\n};\n","import { Outline } from 'ui.icon-set.api.core';\n\nexport const PanelSection = Object.freeze({\n\tImportant: 'important',\n\tAttachments: 'attachments',\n\tMovement: 'movement',\n\tAccomplice: 'accomplice',\n\tAuditor: 'auditor',\n\tForward: 'forward',\n\tDelete: 'delete',\n\tCancel: 'cancel',\n});\n\nexport const PanelAction = Object.freeze({\n\tSetImportant: 'setImportant',\n\tAttachFile: 'attachFile',\n\tMoveRight: 'moveRight',\n\tMoveLeft: 'moveLeft',\n\tAssignAccomplice: 'assignAccomplice',\n\tAssignAuditor: 'assignAuditor',\n\tForward: 'forward',\n\tDelete: 'delete',\n\tCancel: 'cancel',\n});\n\nexport const PanelMeta = Object.freeze({\n\tdefaultSections: [\n\t\t{\n\t\t\tname: PanelSection.Important,\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\ticon: Outline.FIRE,\n\t\t\t\t\tactiveIcon: Outline.FIRE_SOLID,\n\t\t\t\t\taction: PanelAction.SetImportant,\n\t\t\t\t\thint: 'TASKS_V2_CHECK_LIST_ITEM_IMPORTANT_HINT',\n\t\t\t\t\tclassName: '--important',\n\t\t\t\t\thoverable: false,\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\t{\n\t\t\tname: PanelSection.Attachments,\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\ticon: Outline.ATTACH,\n\t\t\t\t\taction: PanelAction.AttachFile,\n\t\t\t\t\thint: 'TASKS_V2_CHECK_LIST_ITEM_ATTACH_HINT',\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\t{\n\t\t\tname: PanelSection.Movement,\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\ticon: Outline.POINT_RIGHT,\n\t\t\t\t\taction: PanelAction.MoveRight,\n\t\t\t\t\thint: 'TASKS_V2_CHECK_LIST_ITEM_MOVE_RIGHT_HINT',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ticon: Outline.POINT_LEFT,\n\t\t\t\t\taction: PanelAction.MoveLeft,\n\t\t\t\t\thint: 'TASKS_V2_CHECK_LIST_ITEM_MOVE_LEFT_HINT',\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\t{\n\t\t\tname: PanelSection.Accomplice,\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\ticon: Outline.PERSON,\n\t\t\t\t\taction: PanelAction.AssignAccomplice,\n\t\t\t\t\thint: 'TASKS_V2_CHECK_LIST_ITEM_ACCOMPLICE_HINT',\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\t{\n\t\t\tname: PanelSection.Auditor,\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\ticon: Outline.OBSERVER,\n\t\t\t\t\taction: PanelAction.AssignAuditor,\n\t\t\t\t\thint: 'TASKS_V2_CHECK_LIST_ITEM_AUDITOR_HINT',\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\t{\n\t\t\tname: PanelSection.Forward,\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\ticon: Outline.FORWARD,\n\t\t\t\t\taction: PanelAction.Forward,\n\t\t\t\t\thint: 'TASKS_V2_CHECK_LIST_ITEM_FORWARD_HINT',\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\t{\n\t\t\tname: PanelSection.Delete,\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\ticon: Outline.TRASHCAN,\n\t\t\t\t\taction: PanelAction.Delete,\n\t\t\t\t\thint: 'TASKS_V2_CHECK_LIST_ITEM_REMOVE_HINT',\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\t{\n\t\t\tname: PanelSection.Cancel,\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\ticon: Outline.CROSS_L,\n\t\t\t\t\taction: PanelAction.Cancel,\n\t\t\t\t\thint: 'TASKS_V2_CHECK_LIST_ITEM_CANCEL_HINT',\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t],\n});\n\nexport type Section = {\n\tname: string,\n\titems: Item[],\n};\n\nexport type Item = {\n\ticon: string,\n\tactiveIcon?: string,\n\taction: string,\n\tlabel?: string,\n\thint?: string,\n\tactive?: boolean,\n\thoverable?: boolean,\n\tdisabled?: boolean,\n\tclassName?: string,\n};\n\nexport type VisibleSections = Section[];\nexport type VisibleActions = string[];\nexport type ActiveActions = string[];\n","import { hint, type HintParams } from 'ui.vue3.directives.hint';\nimport { BIcon } from 'ui.icon-set.api.vue';\n\nimport { Core } from 'tasks.v2.core';\nimport { Model } from 'tasks.v2.const';\n\nimport 'tasks.v2.component.elements.hint';\n\nimport type { CheckListModel } from 'tasks.v2.model.check-list';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nimport { PanelAction, PanelMeta } from './check-list-item-panel-meta';\nimport { CheckListManager } from '../../lib/check-list-manager';\n\nimport type { VisibleSections, VisibleActions, Section, Item, ActiveActions } from './check-list-item-panel-meta';\n\nimport './check-list-item-panel.css';\n\n// @vue/component\nexport const CheckListItemPanel = {\n\tname: 'CheckListItemPanel',\n\tcomponents: {\n\t\tBIcon,\n\t},\n\tdirectives: { hint },\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tcurrentItem: {\n\t\t\ttype: Object,\n\t\t\tdefault: () => null,\n\t\t},\n\t},\n\temits: ['action'],\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tcurrentHintElement: null,\n\t\t\tcurrentHintText: '',\n\t\t};\n\t},\n\tcomputed: {\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.taskId);\n\t\t},\n\t\tcheckLists(): CheckListModel[]\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.CheckList}/getByIds`](this.task.checklist);\n\t\t},\n\t\tsections(): VisibleSections\n\t\t{\n\t\t\treturn PanelMeta.defaultSections\n\t\t\t\t.filter((section) => this.visibleSections.includes(section.name))\n\t\t\t\t.map((section) => ({\n\t\t\t\t\t...section,\n\t\t\t\t\titems: section.items\n\t\t\t\t\t\t.filter((item: Item) => this.visibleActions.includes(item.action))\n\t\t\t\t\t\t.map((item: Item) => ({\n\t\t\t\t\t\t\t...item,\n\t\t\t\t\t\t\tdisabled: this.isItemDisabled(item),\n\t\t\t\t\t\t\tactive: this.isItemActive(item),\n\t\t\t\t\t\t\thoverable: item.hoverable ?? true,\n\t\t\t\t\t\t})),\n\t\t\t\t}))\n\t\t\t\t.filter((section) => section.items.length > 0)\n\t\t\t;\n\t\t},\n\t\ttooltip(): Function\n\t\t{\n\t\t\treturn (): HintParams => ({\n\t\t\t\ttext: this.currentHintText,\n\t\t\t\ttimeout: 500,\n\t\t\t\tpopupOptions: {\n\t\t\t\t\tclassName: 'tasks-hint',\n\t\t\t\t\tbackground: 'var(--ui-color-bg-content-inapp)',\n\t\t\t\t\tdarkMode: false,\n\t\t\t\t\toffsetLeft: -(this.currentHintElement?.offsetWidth ?? 0),\n\t\t\t\t\tpadding: 6,\n\t\t\t\t\tbindOptions: {\n\t\t\t\t\t\tforceBindPosition: true,\n\t\t\t\t\t\tforceTop: true,\n\t\t\t\t\t\tposition: 'top',\n\t\t\t\t\t},\n\t\t\t\t\ttargetContainer: document.body,\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t\tvisibleSections(): VisibleSections\n\t\t{\n\t\t\treturn PanelMeta.defaultSections.map((section: Section) => section.name);\n\t\t},\n\t\tvisibleActions(): VisibleActions\n\t\t{\n\t\t\tif (!this.currentItem)\n\t\t\t{\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tlet actions = [\n\t\t\t\tPanelAction.SetImportant,\n\t\t\t\tPanelAction.MoveRight,\n\t\t\t\tPanelAction.MoveLeft,\n\t\t\t\tPanelAction.AssignAccomplice,\n\t\t\t\tPanelAction.AssignAuditor,\n\t\t\t\tPanelAction.Forward,\n\t\t\t\tPanelAction.Delete,\n\t\t\t];\n\n\t\t\tif (this.itemGroupModeSelected)\n\t\t\t{\n\t\t\t\tactions.push(PanelAction.Cancel);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tactions.push(PanelAction.AttachFile);\n\t\t\t}\n\n\t\t\tif (this.currentItem.parentId === 0)\n\t\t\t{\n\t\t\t\tactions = [\n\t\t\t\t\tPanelAction.AssignAccomplice,\n\t\t\t\t\tPanelAction.AssignAuditor,\n\t\t\t\t];\n\t\t\t}\n\n\t\t\tconst limits = Core.getParams().limits;\n\t\t\tconst stakeholdersActions = new Set([\n\t\t\t\tPanelAction.AssignAccomplice,\n\t\t\t\tPanelAction.AssignAuditor,\n\t\t\t]);\n\n\t\t\treturn actions.filter((action: string) => {\n\t\t\t\tconst isDisabledStakeholders = stakeholdersActions.has(action) && !limits.stakeholders;\n\n\t\t\t\treturn !isDisabledStakeholders;\n\t\t\t});\n\t\t},\n\t\tdisabledActions(): []\n\t\t{\n\t\t\tif (!this.currentItem)\n\t\t\t{\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tconst disabledActions = [];\n\n\t\t\tconst itemLevel = this.checkListManager.getItemLevel(this.currentItem);\n\t\t\tconst canModify = this.currentItem.actions.modify === true;\n\t\t\tconst canRemove = this.currentItem.actions.remove === true;\n\n\t\t\tconst conditionHandlers = {\n\t\t\t\t[PanelAction.SetImportant]: () => {\n\t\t\t\t\treturn canModify === false;\n\t\t\t\t},\n\t\t\t\t[PanelAction.AttachFile]: () => {\n\t\t\t\t\treturn canModify === false;\n\t\t\t\t},\n\t\t\t\t[PanelAction.MoveLeft]: () => {\n\t\t\t\t\treturn itemLevel === 1 || canModify === false;\n\t\t\t\t},\n\t\t\t\t[PanelAction.MoveRight]: () => {\n\t\t\t\t\treturn (\n\t\t\t\t\t\titemLevel === 5\n\t\t\t\t\t\t|| this.currentItem.sortIndex === 0\n\t\t\t\t\t\t|| canModify === false\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t\t[PanelAction.AssignAccomplice]: () => {\n\t\t\t\t\treturn canModify === false;\n\t\t\t\t},\n\t\t\t\t[PanelAction.AssignAuditor]: () => {\n\t\t\t\t\treturn canModify === false;\n\t\t\t\t},\n\t\t\t\t[PanelAction.Forward]: () => {\n\t\t\t\t\treturn (\n\t\t\t\t\t\tcanModify === false\n\t\t\t\t\t\t|| this.currentItem.title === ''\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t\t[PanelAction.Delete]: () => {\n\t\t\t\t\treturn canRemove === false;\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tObject.entries(conditionHandlers)\n\t\t\t\t.forEach(([action: string, condition: function]) => {\n\t\t\t\t\tif (condition())\n\t\t\t\t\t{\n\t\t\t\t\t\tdisabledActions.push(action);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t;\n\n\t\t\treturn disabledActions;\n\t\t},\n\t\tactiveActions(): ActiveActions\n\t\t{\n\t\t\tif (!this.currentItem)\n\t\t\t{\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tconst actions = [];\n\n\t\t\tif (this.currentItem.isImportant)\n\t\t\t{\n\t\t\t\tactions.push(PanelAction.SetImportant);\n\t\t\t}\n\n\t\t\treturn actions;\n\t\t},\n\t\titemGroupModeSelected(): boolean\n\t\t{\n\t\t\tif (!this.currentItem)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.currentItem.groupMode?.selected === true;\n\t\t},\n\t},\n\tcreated(): void\n\t{\n\t\tthis.checkListManager = new CheckListManager({\n\t\t\tcomputed: {\n\t\t\t\tcheckLists: () => this.checkLists,\n\t\t\t},\n\t\t});\n\t},\n\tmethods: {\n\t\tisItemDisabled(item: Item): boolean\n\t\t{\n\t\t\treturn item.disabled ?? this.disabledActions.includes(item.action);\n\t\t},\n\t\tisItemActive(item: Item): boolean\n\t\t{\n\t\t\treturn item.active ?? this.activeActions.includes(item.action);\n\t\t},\n\t\tgetItemIcon(item: Item): string\n\t\t{\n\t\t\treturn (item.active && item.activeIcon) ? item.activeIcon : item.icon;\n\t\t},\n\t\thandleItemClick(event: MouseEvent, item: Item): void\n\t\t{\n\t\t\tif (!item.disabled)\n\t\t\t{\n\t\t\t\tthis.$emit('action', {\n\t\t\t\t\taction: item.action,\n\t\t\t\t\tnode: event.currentTarget,\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\thandleItemMouseEnter(event: MouseEvent, item: Item): void\n\t\t{\n\t\t\tthis.currentHintElement = event.currentTarget;\n\t\t\tthis.currentHintText = item.hint ? this.loc(item.hint) : null;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div v-if=\"sections.length > 0\" class=\"check-list-widget-item-panel\" @mousedown.prevent>\n\t\t\t<template v-for=\"section in sections\" :key=\"section.name\">\n\t\t\t\t<div class=\"check-list-widget-item-panel-section\" :class=\"'--' + section.name\">\n\t\t\t\t\t<template v-for=\"item in section.items\" :key=\"item.action\" >\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-hint=\"tooltip\"\n\t\t\t\t\t\t\tclass=\"check-list-widget-item-panel-section-item\"\n\t\t\t\t\t\t\t:class=\"{\n\t\t\t\t\t\t\t\t'--disabled': item.disabled,\n\t\t\t\t\t\t\t\t'--active': item.active,\n\t\t\t\t\t\t\t\t[item.className]: Boolean(item.className),\n\t\t\t\t\t\t\t}\"\n\t\t\t\t\t\t\t@click=\"handleItemClick($event, item)\"\n\t\t\t\t\t\t\t@mouseenter=\"handleItemMouseEnter($event, item)\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<BIcon :name=\"getItemIcon(item)\" :hoverable=\"item.hoverable\"/>\n\t\t\t\t\t\t\t<span v-if=\"item.label\">{{ loc(item.label) }}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\t`,\n};\n","import { Loc, Text, Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { UI } from 'ui.notification';\n\ntype Params = {\n\tcontent: string,\n\ttimerValue?: number,\n}\n\nexport class CheckListNotifier extends EventEmitter\n{\n\t#interval: ?number = null;\n\t#timerValue: number = 5;\n\t#counter: number = 5;\n\t#content: string = '';\n\n\t#balloonWithTimer: BX.UI.Notification.Balloon;\n\n\tconstructor(params: Params)\n\t{\n\t\tsuper();\n\n\t\tthis.setEventNamespace('Tasks.V2.CheckList.CheckListNotifier');\n\n\t\tthis.#content = params.content;\n\t\tthis.#timerValue = Type.isUndefined(params.timerValue) ? this.#timerValue : params.timerValue;\n\t}\n\n\tshowBalloonWithTimer(): void\n\t{\n\t\tthis.#counter = this.#timerValue;\n\n\t\tthis.#balloonWithTimer = UI.Notification.Center.notify({\n\t\t\tid: `check-list-balloon-${Text.getRandom()}`,\n\t\t\tcontent: this.#getBalloonContent(),\n\t\t\tactions: [{\n\t\t\t\ttitle: Loc.getMessage('TASKS_V2_CHECK_LIST_BALLOON_CANCEL'),\n\t\t\t\tevents: {\n\t\t\t\t\tmouseup: this.#handleCancelClick.bind(this),\n\t\t\t\t},\n\t\t\t}],\n\t\t\tevents: {\n\t\t\t\tonClose: this.#handleClosingBalloon.bind(this),\n\t\t\t},\n\t\t});\n\n\t\tthis.#startTimer();\n\t}\n\n\tstopTimer(): void\n\t{\n\t\tthis.emit('complete', true);\n\n\t\tthis.#balloonWithTimer.close();\n\t}\n\n\t#startTimer(): void\n\t{\n\t\tthis.#interval = setInterval(() => {\n\t\t\tthis.#counter--;\n\n\t\t\tthis.#balloonWithTimer.update({ content: this.#getBalloonContent() });\n\n\t\t\tif (this.#counter <= 0)\n\t\t\t{\n\t\t\t\tthis.emit('complete', true);\n\n\t\t\t\tthis.#balloonWithTimer.close();\n\t\t\t}\n\t\t}, 1000);\n\t}\n\n\t#handleCancelClick()\n\t{\n\t\tthis.#balloonWithTimer.close();\n\t}\n\n\t#handleClosingBalloon()\n\t{\n\t\tclearInterval(this.#interval);\n\n\t\tthis.emit('complete', false);\n\t}\n\n\t#getBalloonContent(): string\n\t{\n\t\treturn this.#content.replace('#countdown#', this.#counter);\n\t}\n}\n","import { Dom, Event, Text, Type } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Popup } from 'main.popup';\n\nimport { mapActions, mapGetters } from 'ui.vue3.vuex';\nimport type { BitrixVueComponentProps } from 'ui.vue3';\nimport { Item } from 'ui.entity-selector';\nimport type { MenuItemOptions, MenuOptions } from 'ui.system.menu';\nimport { Button as UiButton, AirButtonStyle, ButtonSize, ButtonIcon } from 'ui.vue3.components.button';\nimport { BIcon } from 'ui.icon-set.api.vue';\nimport { BMenu } from 'ui.vue3.components.menu';\nimport { Outline } from 'ui.icon-set.api.core';\nimport 'ui.icon-set.animated';\nimport 'ui.icon-set.outline';\n\nimport { Model } from 'tasks.v2.const';\nimport { participantMeta } from 'tasks.v2.component.elements.participant-list';\nimport { EntitySelectorDialog } from 'tasks.v2.lib.entity-selector-dialog';\nimport { checkListService } from 'tasks.v2.provider.service.check-list-service';\nimport { EntityTypes, FileService, fileService } from 'tasks.v2.provider.service.file-service';\n\nimport type { UserModel } from 'tasks.v2.model.users';\nimport type { CheckListModel } from 'tasks.v2.model.check-list';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nimport { CheckListStub } from './check-list-stub';\nimport { CheckListPopup } from '../check-list-popup/check-list-popup';\nimport { CheckListSheet } from '../check-list-sheet/check-list-sheet';\nimport { CheckListList } from '../check-list-list/check-list-list';\nimport { CheckListWidget } from '../check-list-widget/check-list-widget';\nimport { CheckListItemPanel } from '../check-list-item-panel/check-list-item-panel';\n\nimport { CheckListManager } from '../../lib/check-list-manager';\nimport { CheckListNotifier } from '../../lib/check-list-notifier';\nimport { Highlighter } from '../../lib/highlighter/highlighter';\n\nimport { PanelAction } from '../check-list-item-panel/check-list-item-panel-meta';\n\nimport './check-list.css';\n\nconst Context = Object.freeze({\n\tSheet: 'sheet',\n\tPopup: 'popup',\n\tPreview: 'preview',\n});\n\n// @vue/component\nexport const CheckList = {\n\tname: 'TaskCheckList',\n\tcomponents: {\n\t\tCheckListWidget,\n\t\tCheckListItemPanel,\n\t\tCheckListStub,\n\t\tUiButton,\n\t\tBIcon,\n\t\tBMenu,\n\t},\n\tprovide(): Object\n\t{\n\t\treturn {\n\t\t\tsetItemsRef: this.setItemsRef,\n\t\t\tgetItemsRef: this.getItemsRef,\n\t\t};\n\t},\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tisAutonomous: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tisPreview: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tisComponentShown: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t\tcheckListId: {\n\t\t\ttype: [Number, String],\n\t\t\tdefault: 0,\n\t\t},\n\t\tisShown: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tgetBindElement: {\n\t\t\ttype: Function,\n\t\t\tdefault: null,\n\t\t},\n\t\tgetTargetContainer: {\n\t\t\ttype: Function,\n\t\t\tdefault: null,\n\t\t},\n\t},\n\temits: ['show', 'close', 'resize', 'open'],\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tresizeObserver: null,\n\t\t\tAirButtonStyle,\n\t\t\tButtonSize,\n\t\t\tButtonIcon,\n\t\t\tOutline,\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\titemPanelIsShown: false,\n\t\t\tcheckListWasUpdated: false,\n\t\t\tlastUpdatedCheckListId: 0,\n\t\t\titemId: null,\n\t\t\titemPanelStyles: {\n\t\t\t\ttop: '0',\n\t\t\t\tdisplay: 'flex',\n\t\t\t},\n\t\t\tisItemPanelFreeze: false,\n\t\t\titemPanelTopOffset: this.isAutonomous ? 5 : 2,\n\t\t\titemPanelTopLimit: this.isAutonomous ? 450 : 700,\n\t\t\titemsRefs: {},\n\t\t\tisForwardMenuShown: false,\n\t\t\tforwardMenuSectionCode: 'createSection',\n\t\t\tforwardBindElement: null,\n\t\t\tshownPopups: new Set(),\n\t\t\tnotifiers: new Map(),\n\t\t};\n\t},\n\tcomputed: {\n\t\t...mapGetters({\n\t\t\tdeletingCheckListIds: `${Model.Interface}/deletingCheckListIds`,\n\t\t\tcheckListCompletionCallback: `${Model.Interface}/checkListCompletionCallback`,\n\t\t}),\n\t\tcomponentName(): BitrixVueComponentProps\n\t\t{\n\t\t\treturn {\n\t\t\t\t[Context.Sheet]: CheckListSheet,\n\t\t\t\t[Context.Popup]: CheckListPopup,\n\t\t\t\t[Context.Preview]: CheckListList,\n\t\t\t}[this.context];\n\t\t},\n\t\tcontext(): string\n\t\t{\n\t\t\treturn {\n\t\t\t\t[true]: Context.Sheet,\n\t\t\t\t[this.isAutonomous]: Context.Popup,\n\t\t\t\t[this.isPreview]: Context.Preview,\n\t\t\t}.true;\n\t\t},\n\t\tcontextClass(): string\n\t\t{\n\t\t\treturn `--${this.context}`;\n\t\t},\n\t\tcomponentShown(): boolean\n\t\t{\n\t\t\tif (this.isPreview)\n\t\t\t{\n\t\t\t\treturn this.isComponentShown;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\t\tisEdit(): boolean\n\t\t{\n\t\t\treturn Type.isNumber(this.taskId) && this.taskId > 0;\n\t\t},\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.taskId);\n\t\t},\n\t\tcanSaveCheckList(): boolean\n\t\t{\n\t\t\treturn this.task.rights.checklistSave === true;\n\t\t},\n\t\tcheckLists(): CheckListModel[]\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.CheckList}/getByIds`](this.task.checklist);\n\t\t},\n\t\tparentCheckLists(): CheckListModel[]\n\t\t{\n\t\t\treturn this.checkLists.filter((checkList: CheckListModel) => checkList.parentId === 0);\n\t\t},\n\t\thasFewParentCheckLists(): boolean\n\t\t{\n\t\t\treturn this.parentCheckLists.length > 1;\n\t\t},\n\t\tcurrentItem(): ?CheckListModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.CheckList}/getById`](this.itemId);\n\t\t},\n\t\titemGroupModeSelected(): boolean\n\t\t{\n\t\t\tif (!this.currentItem)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.currentItem.groupMode?.selected === true;\n\t\t},\n\t\tforwardMenuOptions(): MenuOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tid: `check-list-item-forward-menu-${this.currentItem.id}`,\n\t\t\t\tbindElement: this.forwardBindElement,\n\t\t\t\tmaxWidth: 400,\n\t\t\t\tmaxHeight: 300,\n\t\t\t\toffsetLeft: -110,\n\t\t\t\tsections: [\n\t\t\t\t\t{\n\t\t\t\t\t\tcode: this.forwardMenuSectionCode,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\titems: this.forwardMenuItems,\n\t\t\t\ttargetContainer: document.body,\n\t\t\t};\n\t\t},\n\t\tforwardMenuItems(): MenuItemOptions[]\n\t\t{\n\t\t\tconst checklistItems = this.parentCheckLists\n\t\t\t\t.filter((checkList: CheckListModel) => checkList.id !== this.currentItem.parentId)\n\t\t\t\t.map((checkList: CheckListModel) => ({\n\t\t\t\t\ttitle: checkList.title,\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\tid: `ForwardMenuCheckList-${checkList.id}`,\n\t\t\t\t\t},\n\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\tthis.hideItemPanel();\n\t\t\t\t\t\tif (this.itemGroupModeSelected)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvoid this.forwardGroupItemsToChecklist(checkList.id);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.forwardToChecklist(checkList.id);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t}));\n\n\t\t\treturn [\n\t\t\t\t...checklistItems,\n\t\t\t\t{\n\t\t\t\t\tsectionCode: this.forwardMenuSectionCode,\n\t\t\t\t\ttitle: this.loc('TASKS_V2_CHECK_LIST_ITEM_FORWARD_MENU_CREATE'),\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\tid: `ForwardMenuCreateNew-${this.currentItem.id}`,\n\t\t\t\t\t},\n\t\t\t\t\tonClick: this.forwardToNewChecklist.bind(this),\n\t\t\t\t},\n\t\t\t];\n\t\t},\n\t\tstub(): boolean\n\t\t{\n\t\t\treturn this.checkLists.length === 0 || this.emptyList === true;\n\t\t},\n\t\temptyList(): boolean\n\t\t{\n\t\t\tconst siblings = this.parentCheckLists\n\t\t\t\t.filter((item: CheckListModel) => !this.deletingCheckListIds[item.id]);\n\n\t\t\treturn siblings.length === 0;\n\t\t},\n\t},\n\twatch: {\n\t\tasync titleFieldOffsetHeight(): Promise<void>\n\t\t{\n\t\t\tif (!this.$refs.popupComponent)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait this.$nextTick();\n\t\t\tthis.resize();\n\t\t},\n\t\tcomponentShown(value: boolean): void\n\t\t{\n\t\t\tif (!this.isPreview)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.executeCheckListCompletionCallbacks();\n\n\t\t\tvoid this.$nextTick(() => {\n\t\t\t\tif (value)\n\t\t\t\t{\n\t\t\t\t\tthis.subscribeToEvents();\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tthis.checkListManager.getItem(this.checkListId)\n\t\t\t\t\t\t&& this.$refs.list\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst checkListNode = this.$refs.list.querySelector([`[data-id=\"${this.checkListId}\"]`]);\n\t\t\t\t\t\tcheckListNode?.scrollIntoView({\n\t\t\t\t\t\t\tblock: 'center',\n\t\t\t\t\t\t\tbehavior: 'instant',\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.unsubscribeFromEvents();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tcheckListWasUpdated(value: boolean): void\n\t\t{\n\t\t\tif (!this.currentItem)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (value === true)\n\t\t\t{\n\t\t\t\tconst parentItem = this.checkListManager.getRootParentByChildId(this.currentItem.id);\n\n\t\t\t\tthis.lastUpdatedCheckListId = parentItem ? parentItem.id : 0;\n\t\t\t}\n\t\t},\n\t\tcheckListId(value: boolean): void\n\t\t{\n\t\t\tconst isNewCheckList = Type.isString(value);\n\t\t\tif (isNewCheckList)\n\t\t\t{\n\t\t\t\tthis.checkListWasUpdated = true;\n\t\t\t}\n\t\t},\n\t},\n\tcreated(): void\n\t{\n\t\tthis.checkListManager = new CheckListManager({\n\t\t\tcomputed: {\n\t\t\t\tcheckLists: () => this.checkLists,\n\t\t\t},\n\t\t});\n\t},\n\tmounted(): void\n\t{\n\t\tif (this.isAutonomous || this.isPreview)\n\t\t{\n\t\t\tthis.subscribeToEvents();\n\t\t}\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tif (this.isAutonomous || this.isPreview)\n\t\t{\n\t\t\tthis.unsubscribeFromEvents();\n\t\t}\n\n\t\tif (this.isPreview)\n\t\t{\n\t\t\tthis.executeCheckListCompletionCallbacks();\n\t\t}\n\t},\n\tmethods: {\n\t\t...mapActions(Model.Interface, [\n\t\t\t'addCheckListItemToDeleting',\n\t\t\t'removeCheckListItemFromDeleting',\n\t\t\t'executeCheckListCompletionCallbacks',\n\t\t\t'clearCheckListCompletionCallbacks',\n\t\t]),\n\t\tsubscribeToEvents(): void\n\t\t{\n\t\t\tEvent.bind(this.$refs.list, 'scroll', this.handleScroll);\n\n\t\t\tEventEmitter.subscribe('BX.Main.Popup:onInit', this.handleInitPopup);\n\t\t\tEventEmitter.subscribe('BX.Main.Popup:onShow', this.handleShowPopup);\n\t\t\tEventEmitter.subscribe('BX.Main.Popup:onClose', this.handleClosePopup);\n\t\t},\n\t\tunsubscribeFromEvents(): void\n\t\t{\n\t\t\tEvent.unbind(this.$refs.list, 'scroll', this.handleScroll);\n\n\t\t\tEventEmitter.unsubscribe('BX.Main.Popup:onInit', this.handleInitPopup);\n\t\t\tEventEmitter.unsubscribe('BX.Main.Popup:onShow', this.handleShowPopup);\n\t\t\tEventEmitter.unsubscribe('BX.Main.Popup:onClose', this.handleClosePopup);\n\t\t},\n\t\thandleUpdate(itemId: number | string): void\n\t\t{\n\t\t\tthis.itemId = itemId;\n\n\t\t\tthis.checkListWasUpdated = true;\n\t\t},\n\t\thandleRemove(itemId: number | string): void\n\t\t{\n\t\t\tthis.itemId = itemId;\n\n\t\t\tthis.freeze();\n\n\t\t\tthis.addItemToDelete(itemId);\n\n\t\t\tthis.checkListManager.hideItems(\n\t\t\t\t[itemId],\n\t\t\t\t(updates: CheckListModel[]) => this.upsertCheckLists(updates),\n\t\t\t);\n\n\t\t\tconst messageKey = (\n\t\t\t\tthis.currentItem.parentId === 0\n\t\t\t\t\t? 'TASKS_V2_CHECK_LIST_ITEM_REMOVE_BALLOON_PARENT'\n\t\t\t\t\t: 'TASKS_V2_CHECK_LIST_ITEM_REMOVE_BALLOON_CHILD'\n\t\t\t);\n\n\t\t\tconst notifier = new CheckListNotifier({\n\t\t\t\tcontent: this.loc(messageKey),\n\t\t\t});\n\t\t\tnotifier.subscribeOnce('complete', (baseEvent: BaseEvent) => {\n\t\t\t\tconst timerHasEnded = baseEvent.getData();\n\n\t\t\t\tif (timerHasEnded)\n\t\t\t\t{\n\t\t\t\t\tthis.removeItem(itemId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.checkListManager.showItems(\n\t\t\t\t\t\t[itemId],\n\t\t\t\t\t\t(updates: CheckListModel[]) => this.upsertCheckLists(updates),\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tthis.removeItemFromDelete(itemId);\n\n\t\t\t\tthis.unfreeze();\n\n\t\t\t\tthis.notifiers.delete(itemId);\n\t\t\t});\n\n\t\t\tthis.notifiers.set(itemId, notifier);\n\n\t\t\tnotifier.showBalloonWithTimer();\n\n\t\t\tif (this.isCurrentItemEmpty())\n\t\t\t{\n\t\t\t\tnotifier.stopTimer();\n\t\t\t}\n\t\t},\n\t\thandleScroll(): void\n\t\t{\n\t\t\tthis.isForwardMenuShown = false;\n\n\t\t\tthis.updatePanelPosition();\n\t\t},\n\t\thandleShow(data): void\n\t\t{\n\t\t\tthis.$emit('show', data);\n\t\t},\n\t\tasync handleClose(): void\n\t\t{\n\t\t\tthis.cleanNotifiers();\n\t\t\tthis.cancelGroupMode();\n\t\t\tthis.cleanCollapsedState();\n\t\t\tthis.executeCheckListCompletionCallbacks();\n\n\t\t\tif (\n\t\t\t\tthis.checkListManager.hasEmptyItemWithFiles(this.hasItemFiles)\n\t\t\t\t|| this.checkListManager.hasEmptyParentItem()\n\t\t\t)\n\t\t\t{\n\t\t\t\tconst firstEmptyItem = this.checkListManager.getFirstEmptyItem();\n\n\t\t\t\tthis.focusToItem(firstEmptyItem.id, true);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst getItemIdWithUploadingFiles = (): string | number | undefined => {\n\t\t\t\treturn [...this.fileServiceInstances.values()].find(\n\t\t\t\t\t(fileServiceInstance: FileService) => fileServiceInstance.isUploading(),\n\t\t\t\t)?.getEntityId();\n\t\t\t};\n\n\t\t\tconst itemIdWithUploadingFiles = this.fileServiceInstances ? getItemIdWithUploadingFiles() : null;\n\t\t\tif (itemIdWithUploadingFiles)\n\t\t\t{\n\t\t\t\tthis.focusToItem(itemIdWithUploadingFiles, true);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.cleanEmptyCurrentItem();\n\n\t\t\tconst checkListId = this.lastUpdatedCheckListId === 0 ? this.checkListId : this.lastUpdatedCheckListId;\n\n\t\t\tthis.saveCheckList();\n\n\t\t\tthis.$emit('close', this.deletingCheckListIds[checkListId] ? 0 : checkListId);\n\t\t},\n\t\thandleIsShown(isShown: boolean): void\n\t\t{\n\t\t\tif (isShown)\n\t\t\t{\n\t\t\t\tthis.subscribeToEvents();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.unsubscribeFromEvents();\n\t\t\t}\n\t\t},\n\t\thandleInitPopup(baseEvent: BaseEvent): void\n\t\t{\n\t\t\tconst [id, bindElement, params] = baseEvent.getCompatData();\n\t\t\tif (id === 'b24-bottom-sheet' || id === 'tasks-relation-error')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (Type.isDomNode(bindElement))\n\t\t\t{\n\t\t\t\tconst excludedIds = ['popup-submenu-'];\n\t\t\t\tconst shouldExclude = excludedIds.some((excludedId: string) => id.includes(excludedId));\n\n\t\t\t\tif (\n\t\t\t\t\tthis.$refs.list?.contains(bindElement)\n\t\t\t\t\t&& !shouldExclude\n\t\t\t\t\t&& !this.isPreview\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tparams.targetContainer = this.$refs.list;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tparams.targetContainer = document.body;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\thandleShowPopup(baseEvent: BaseEvent): void\n\t\t{\n\t\t\tconst [popup] = baseEvent.getCompatData();\n\n\t\t\tthis.shownPopups.add(popup.getId());\n\n\t\t\tthis.freeze();\n\t\t},\n\t\thandleClosePopup(baseEvent: BaseEvent): void\n\t\t{\n\t\t\tconst [popup] = baseEvent.getCompatData();\n\n\t\t\tthis.shownPopups.delete(popup.getId());\n\n\t\t\tthis.unfreeze();\n\t\t},\n\t\tasync handleGroupRemove(itemId: number | string): Promise<void>\n\t\t{\n\t\t\tthis.itemId = itemId;\n\n\t\t\tthis.freeze();\n\n\t\t\tthis.addItemToDelete(itemId);\n\n\t\t\tthis.hideItemPanel(itemId);\n\n\t\t\tconst allSelectedItems = this.checkListManager.getAllSelectedItems();\n\n\t\t\tconst nearestItem = this.checkListManager.findNearestItem(this.currentItem, false);\n\t\t\tif (nearestItem)\n\t\t\t{\n\t\t\t\tawait this.updateCheckList(nearestItem.id, {\n\t\t\t\t\tgroupMode: {\n\t\t\t\t\t\tactive: true,\n\t\t\t\t\t\tselected: true,\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.showItemPanel(nearestItem.id);\n\t\t\t\t}, 0);\n\t\t\t}\n\n\t\t\tconst allSelectedItemIds = allSelectedItems.map((item: CheckListModel) => item.id);\n\n\t\t\tthis.checkListManager.hideItems(\n\t\t\t\tallSelectedItemIds,\n\t\t\t\t(updates: CheckListModel[]) => this.upsertCheckLists(updates),\n\t\t\t);\n\n\t\t\tconst messageKey = (\n\t\t\t\tallSelectedItems.length > 1\n\t\t\t\t\t? 'TASKS_V2_CHECK_LIST_ITEM_REMOVE_BALLOON_CHILDREN'\n\t\t\t\t\t: 'TASKS_V2_CHECK_LIST_ITEM_REMOVE_BALLOON_CHILD'\n\t\t\t);\n\n\t\t\tconst notifier = new CheckListNotifier({\n\t\t\t\tcontent: this.loc(messageKey),\n\t\t\t});\n\t\t\tnotifier.subscribeOnce('complete', (baseEvent: BaseEvent) => {\n\t\t\t\tconst timerHasEnded = baseEvent.getData();\n\t\t\t\tconst idsToShow = [];\n\t\t\t\tallSelectedItems.forEach((item: CheckListModel) => {\n\t\t\t\t\tif (timerHasEnded)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.removeItem(item.id);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tidsToShow.push(item.id);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.removeItemFromDelete(item.id);\n\t\t\t\t});\n\n\t\t\t\tthis.checkListManager.showItems(\n\t\t\t\t\tidsToShow,\n\t\t\t\t\t(updates: CheckListModel[]) => this.upsertCheckLists(updates),\n\t\t\t\t);\n\n\t\t\t\tif (timerHasEnded)\n\t\t\t\t{\n\t\t\t\t\tif (nearestItem && !this.deletingCheckListIds[nearestItem.id])\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showItemPanel(nearestItem.id);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.cancelGroupMode();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.showItemPanel(this.currentItem.id);\n\t\t\t\t}\n\n\t\t\t\tthis.unfreeze();\n\n\t\t\t\tthis.notifiers.delete(itemId);\n\t\t\t});\n\n\t\t\tthis.notifiers.set(itemId, notifier);\n\n\t\t\tnotifier.showBalloonWithTimer();\n\t\t},\n\t\thandleFocus(itemId: number | string): void\n\t\t{\n\t\t\tthis.isItemPanelFreeze = false;\n\n\t\t\tthis.showItemPanel(itemId);\n\t\t},\n\t\thandleBlur(itemId: number | string): void\n\t\t{\n\t\t\tthis.itemId = itemId;\n\n\t\t\tif (\n\t\t\t\tthis.isCurrentItemEmpty()\n\t\t\t\t&& this.hasItemFiles(this.currentItem)\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.isItemPanelFreeze === false)\n\t\t\t{\n\t\t\t\tthis.hideItemPanel(itemId);\n\t\t\t}\n\t\t},\n\t\thandleEmptyBlur(itemId: number | string): void\n\t\t{\n\t\t\tthis.itemId = itemId;\n\n\t\t\tif (this.currentItem.parentId === 0)\n\t\t\t{\n\t\t\t\tthis.setDefaultCheckListTitle(itemId);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.hasItemFiles(this.currentItem))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.isItemPanelFreeze === false)\n\t\t\t{\n\t\t\t\tthis.removeItem(itemId);\n\t\t\t}\n\t\t},\n\t\thandleGroupMode(itemId: number | string): void\n\t\t{\n\t\t\tthis.itemId = itemId;\n\n\t\t\tthis.cancelGroupMode();\n\n\t\t\tconst firstChild = this.checkListManager.getFirstChild(itemId);\n\t\t\tif (!firstChild)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.activateGroupMode(itemId);\n\t\t\tthis.showItemPanel(firstChild.id);\n\t\t},\n\t\thandleGroupModeSelect(itemId: number | string): void\n\t\t{\n\t\t\tthis.itemId = itemId;\n\n\t\t\tif (this.itemGroupModeSelected)\n\t\t\t{\n\t\t\t\tthis.showItemPanel(itemId);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showItemPanelOnNearestSelectedItem(itemId);\n\t\t\t}\n\t\t},\n\t\thandlePanelAction({ action, node }: {action: string, node: HTMLElement}): void\n\t\t{\n\t\t\tconst actionHandlers = {\n\t\t\t\t[PanelAction.SetImportant]: (n) => this.setImportant(n),\n\t\t\t\t[PanelAction.AttachFile]: (n) => this.attachFile(n),\n\t\t\t\t[PanelAction.MoveRight]: (n) => this.moveGroupToRight(n),\n\t\t\t\t[PanelAction.MoveLeft]: (n) => this.moveGroupToLeft(n),\n\t\t\t\t[PanelAction.AssignAccomplice]: (n) => {\n\t\t\t\t\tif (!this.isItemPanelFreeze)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showParticipantDialog(n, 'accomplices');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t[PanelAction.AssignAuditor]: (n) => {\n\t\t\t\t\tif (!this.isItemPanelFreeze)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showParticipantDialog(n, 'auditors');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t[PanelAction.Forward]: (n) => this.forward(n),\n\t\t\t\t[PanelAction.Delete]: (n) => this.delete(n),\n\t\t\t\t[PanelAction.Cancel]: (n) => this.cancelGroupMode(n),\n\t\t\t};\n\n\t\t\tactionHandlers[action]?.(node);\n\t\t},\n\t\thandleOpenCheckList(checkListId: number | string): void\n\t\t{\n\t\t\tthis.cleanNotifiers();\n\t\t\tthis.cleanCollapsedState();\n\n\t\t\tthis.$emit('open', checkListId);\n\t\t},\n\t\tupdateCheckList(id: number | string, fields: Partial<CheckListModel>): Promise<void>\n\t\t{\n\t\t\treturn this.$store.dispatch(`${Model.CheckList}/update`, { id, fields });\n\t\t},\n\t\tupdateTask(fields: Partial<TaskModel>): Promise<void>\n\t\t{\n\t\t\treturn this.$store.dispatch(`${Model.Tasks}/update`, {\n\t\t\t\tid: this.taskId,\n\t\t\t\tfields,\n\t\t\t});\n\t\t},\n\t\tupsertCheckLists(items: CheckListModel[]): Promise<void>\n\t\t{\n\t\t\treturn this.$store.dispatch(`${Model.CheckList}/upsertMany`, items);\n\t\t},\n\n\t\tinsertCheckList(item: CheckListModel): Promise<void>\n\t\t{\n\t\t\treturn this.$store.dispatch(`${Model.CheckList}/insert`, item);\n\t\t},\n\n\t\tinsertManyCheckLists(items: CheckListModel[]): Promise<void>\n\t\t{\n\t\t\treturn this.$store.dispatch(`${Model.CheckList}/insertMany`, items);\n\t\t},\n\n\t\tdeleteCheckList(id: number | string): Promise<void>\n\t\t{\n\t\t\treturn this.$store.dispatch(`${Model.CheckList}/delete`, id);\n\t\t},\n\t\tsaveCheckList(): void\n\t\t{\n\t\t\tif (!this.isDemoCheckListModified())\n\t\t\t{\n\t\t\t\tthis.removeChecklists();\n\n\t\t\t\tthis.checkListWasUpdated = false;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tthis.checkListWasUpdated\n\t\t\t\t&& this.isEdit\n\t\t\t\t&& this.canSaveCheckList\n\t\t\t)\n\t\t\t{\n\t\t\t\tconst deletingIds = new Set(Object.values(this.deletingCheckListIds));\n\t\t\t\tconst fullListDeletingIds = this.checkListManager.expandIdsWithChildren(deletingIds);\n\n\t\t\t\tconst checkListsToSave = this.checkLists.filter((checkList: CheckListModel) => {\n\t\t\t\t\treturn !fullListDeletingIds.has(checkList.id);\n\t\t\t\t});\n\n\t\t\t\tvoid checkListService.save(this.taskId, checkListsToSave);\n\t\t\t}\n\n\t\t\tthis.checkListWasUpdated = false;\n\t\t},\n\t\tisDemoCheckListModified(): boolean\n\t\t{\n\t\t\tif (this.getCheckListsNumber() > 1)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tconst [checkList] = this.checkLists;\n\t\t\tif (!checkList)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst demoTitle = this.loc('TASKS_V2_CHECK_LIST_TITLE_NUMBER', { '#number#': 1 });\n\n\t\t\treturn (\n\t\t\t\tcheckList.title !== demoTitle\n\t\t\t\t|| this.checkListManager.getChildren(checkList.id).length > 0\n\t\t\t\t|| this.hasItemUsers(checkList)\n\t\t\t\t|| this.hasItemFiles(checkList)\n\t\t\t);\n\t\t},\n\t\tremoveChecklists(): void\n\t\t{\n\t\t\tthis.checkLists\n\t\t\t\t.filter((checklist: CheckListModel) => checklist.parentId === 0)\n\t\t\t\t.forEach((item: CheckListModel) => {\n\t\t\t\t\tthis.removeItem(item.id);\n\t\t\t\t});\n\t\t},\n\t\tasync addCheckList(empty: boolean = false): Promise<string>\n\t\t{\n\t\t\tconst parentId = Text.getRandom();\n\t\t\tconst childId = Text.getRandom();\n\n\t\t\tconst items = [this.getDataForNewCheckList(parentId)];\n\t\t\tif (!empty)\n\t\t\t{\n\t\t\t\titems.push({\n\t\t\t\t\tid: childId,\n\t\t\t\t\tnodeId: childId,\n\t\t\t\t\tparentId,\n\t\t\t\t\tsortIndex: 0,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tawait this.insertManyCheckLists(items);\n\t\t\tvoid this.updateTask({ checklist: [...this.task.checklist, parentId, childId] });\n\n\t\t\tthis.checkListWasUpdated = true;\n\n\t\t\treturn parentId;\n\t\t},\n\t\tasync addFastCheckList(): void\n\t\t{\n\t\t\tconst checkListId = await this.addCheckList();\n\n\t\t\tthis.handleOpenCheckList(checkListId);\n\t\t},\n\t\tshowForwardMenu(node: HTMLElement): void\n\t\t{\n\t\t\tthis.forwardBindElement = node;\n\n\t\t\tthis.isForwardMenuShown = true;\n\t\t},\n\t\tgetCheckListsNumber(): number\n\t\t{\n\t\t\treturn this.checkLists.filter((checklist: CheckListModel) => {\n\t\t\t\treturn checklist.parentId === 0 && !this.deletingCheckListIds[checklist.id];\n\t\t\t}).length;\n\t\t},\n\t\tgetDataForNewCheckList(parentId: string): CheckListModel\n\t\t{\n\t\t\treturn {\n\t\t\t\tid: parentId,\n\t\t\t\tnodeId: parentId,\n\t\t\t\ttitle: this.loc('TASKS_V2_CHECK_LIST_TITLE_NUMBER', { '#number#': this.getCountForNewCheckList() }),\n\t\t\t\tsortIndex: this.getSortForNewCheckList(),\n\t\t\t};\n\t\t},\n\t\tgetSortForNewCheckList(): number\n\t\t{\n\t\t\treturn this.getCheckListsNumber();\n\t\t},\n\t\tgetCountForNewCheckList(): number\n\t\t{\n\t\t\treturn this.getCheckListsNumber() + 1;\n\t\t},\n\t\tsetItemsRef(id, ref): void\n\t\t{\n\t\t\tthis.itemsRefs[id] = ref;\n\t\t},\n\t\tgetItemsRef(id): Object\n\t\t{\n\t\t\treturn this.itemsRefs[id];\n\t\t},\n\t\tfocusToItem(itemId: number | string, highlight: boolean = false): void\n\t\t{\n\t\t\tvoid this.$nextTick(() => {\n\t\t\t\tconst itemRef = this.getItemsRef(itemId);\n\t\t\t\titemRef?.$refs.growingTextArea?.focusTextarea();\n\t\t\t\tif (highlight)\n\t\t\t\t{\n\t\t\t\t\tvoid (new Highlighter()).highlight(itemRef?.$refs.item);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\taddItem({ id, sort }: {id: number | string, sort: number}): void\n\t\t{\n\t\t\tif (this.hasActiveGroupMode())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.itemId = id;\n\n\t\t\tconst childId = Text.getRandom();\n\t\t\tconst parentId = this.currentItem.parentId;\n\n\t\t\tthis.resortItemsAfterIndex(parentId, sort);\n\n\t\t\tthis.insertItem(parentId, childId, sort);\n\t\t},\n\t\taddItemFromBtn(checkListId: number | string): void\n\t\t{\n\t\t\tif (this.isPreview)\n\t\t\t{\n\t\t\t\tthis.handleOpenCheckList(checkListId);\n\t\t\t}\n\n\t\t\tif (this.hasActiveGroupMode())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst childId = Text.getRandom();\n\t\t\tconst sortIndex = this.checkListManager.getChildren(checkListId).length;\n\n\t\t\tthis.insertItem(checkListId, childId, sortIndex);\n\t\t},\n\t\tinsertItem(parentId: number, childId: number, sortIndex: number): void\n\t\t{\n\t\t\tvoid this.insertCheckList({\n\t\t\t\tid: childId,\n\t\t\t\tnodeId: childId,\n\t\t\t\tparentId,\n\t\t\t\tsortIndex,\n\t\t\t});\n\t\t\tvoid this.updateTask({ checklist: [...this.task.checklist, childId] });\n\n\t\t\tthis.syncParentCompletionState(childId);\n\t\t},\n\t\tremoveItem(id: number | string, isRootCall: boolean = true): void\n\t\t{\n\t\t\tif (!this.task)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst item = this.checkListManager.getItem(id);\n\t\t\tif (!item)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst children = this.checkListManager.getChildren(item.id);\n\n\t\t\tif (\n\t\t\t\titem?.title\n\t\t\t\t|| item.parentId === 0\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.checkListWasUpdated = true;\n\t\t\t}\n\n\t\t\tif (children.length > 0)\n\t\t\t{\n\t\t\t\tchildren.forEach((child: CheckListModel) => {\n\t\t\t\t\tthis.removeItem(child.id, false);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst checkListIds = this.task.checklist.filter((itemId) => itemId !== item.id);\n\t\t\tvoid this.updateTask({\n\t\t\t\tcontainsChecklist: checkListIds.length > 0,\n\t\t\t\tchecklist: checkListIds,\n\t\t\t});\n\t\t\tvoid this.deleteCheckList(item.id);\n\n\t\t\tif (isRootCall)\n\t\t\t{\n\t\t\t\tthis.resortItemsOnLevel(item.parentId);\n\t\t\t}\n\n\t\t\tthis.syncParentCompletionState(item.id, item.parentId);\n\n\t\t\tfileService.delete(item.id, EntityTypes.CheckListItem);\n\t\t},\n\t\taddItemToDelete(itemId: number | string): void\n\t\t{\n\t\t\tthis.addCheckListItemToDeleting(itemId);\n\t\t},\n\t\tremoveItemFromDelete(itemId: number | string): void\n\t\t{\n\t\t\tthis.removeCheckListItemFromDeleting(itemId);\n\n\t\t\tif (this.checkListWasUpdated === true && this.isEdit && Type.isNumber(itemId))\n\t\t\t{\n\t\t\t\tvoid checkListService.delete(this.taskId, itemId);\n\t\t\t}\n\t\t},\n\t\tresortItemsAfterIndex(parentId: number | string, sortIndex: number): void\n\t\t{\n\t\t\tthis.checkListManager.resortItemsAfterIndex(\n\t\t\t\tparentId,\n\t\t\t\tsortIndex,\n\t\t\t\t(updates: CheckListModel[]) => {\n\t\t\t\t\tvoid this.upsertCheckLists(updates);\n\t\t\t\t},\n\t\t\t);\n\t\t},\n\t\tresortItemsOnLevel(parentId: number | string): void\n\t\t{\n\t\t\tthis.checkListManager.resortItemsOnLevel(\n\t\t\t\tparentId,\n\t\t\t\t(updates: CheckListModel[]) => this.upsertCheckLists(updates),\n\t\t\t);\n\t\t},\n\t\tsyncParentCompletionState(itemId: number | string, parentId: number | string): void\n\t\t{\n\t\t\tthis.checkListManager.syncParentCompletionState(\n\t\t\t\titemId,\n\t\t\t\t(id: string | number, fields: Partial<CheckListModel>) => this.updateCheckList(id, fields),\n\t\t\t\tparentId,\n\t\t\t);\n\t\t},\n\t\tshowItemPanel(itemId: number | string): void\n\t\t{\n\t\t\tif (this.isPreview)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.itemId = itemId;\n\n\t\t\tthis.itemPanelIsShown = true;\n\n\t\t\tvoid this.updateCheckList(itemId, { panelIsShown: true });\n\n\t\t\tvoid this.$nextTick(() => this.updatePanelPosition());\n\t\t},\n\t\thideItemPanel(itemId: number | string): void\n\t\t{\n\t\t\tif (this.isPreview)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.itemPanelIsShown = false;\n\n\t\t\tif (this.hasActiveGroupMode() && this.checkListManager.getAllSelectedItems().length === 0)\n\t\t\t{\n\t\t\t\tthis.deactivateGroupMode();\n\t\t\t}\n\n\t\t\tconst item = this.checkListManager.getItem(itemId);\n\t\t\tif (item)\n\t\t\t{\n\t\t\t\tvoid this.updateCheckList(itemId, { panelIsShown: false });\n\t\t\t}\n\n\t\t\tthis.isItemPanelFreeze = false;\n\t\t},\n\t\tshowItemPanelOnNearestSelectedItem(itemId: number | string): void\n\t\t{\n\t\t\t// eslint-disable-next-line no-lonely-if\n\t\t\tconst nearestSelectedItem = this.checkListManager.findNearestItem(this.currentItem, true);\n\t\t\tif (nearestSelectedItem)\n\t\t\t{\n\t\t\t\tthis.showItemPanel(nearestSelectedItem.id);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.hideItemPanel(itemId);\n\t\t\t}\n\t\t},\n\t\tupdatePanelPosition()\n\t\t{\n\t\t\tif (this.itemPanelIsShown === false)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst itemRef = this.$refs.list.querySelector([`[data-id=\"${this.currentItem.id}\"]`]);\n\n\t\t\tconst panelRect = Dom.getPosition(this.$refs.panel.$el);\n\t\t\tconst listRect = Dom.getPosition(this.$refs.list);\n\t\t\tconst itemRect = Dom.getRelativePosition(itemRef, this.$refs.list);\n\t\t\tconst isParentItem = (this.currentItem.parentId === 0);\n\n\t\t\tconst paddingOffset = 18;\n\t\t\tconst panelWidth = panelRect.width === 0 ? 304 : panelRect.width;\n\n\t\t\tconst top = itemRect.top - 28;\n\n\t\t\tif (isParentItem)\n\t\t\t{\n\t\t\t\tconst left = listRect.width - panelWidth - (paddingOffset * 2) - 80;\n\t\t\t\tconst display = top > -30 && top < this.itemPanelTopLimit ? 'flex' : 'none';\n\n\t\t\t\tthis.itemPanelStyles = {\n\t\t\t\t\ttop: `${top}px`,\n\t\t\t\t\tleft: `${left}px`,\n\t\t\t\t\tdisplay,\n\t\t\t\t};\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst left = listRect.width - panelWidth - paddingOffset;\n\t\t\t\tconst display = top > 40 && top < this.itemPanelTopLimit ? 'flex' : 'none';\n\n\t\t\t\tthis.itemPanelStyles = {\n\t\t\t\t\ttop: `${top}px`,\n\t\t\t\t\tleft: `${left}px`,\n\t\t\t\t\tdisplay,\n\t\t\t\t};\n\t\t\t}\n\t\t},\n\t\tsetImportant(): void\n\t\t{\n\t\t\tif (this.itemGroupModeSelected)\n\t\t\t{\n\t\t\t\tconst updates = this.checkListManager.getAllSelectedItems()\n\t\t\t\t\t.map((item: CheckListModel) => ({\n\t\t\t\t\t\t...item,\n\t\t\t\t\t\tisImportant: !item.isImportant,\n\t\t\t\t\t}));\n\n\t\t\t\tvoid this.upsertCheckLists(updates);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tvoid this.updateCheckList(this.currentItem.id, { isImportant: !this.currentItem.isImportant });\n\t\t\t}\n\n\t\t\tthis.checkListWasUpdated = true;\n\t\t},\n\t\tattachFile(node: HTMLElement): void\n\t\t{\n\t\t\tthis.fileServiceInstances ??= new Map();\n\n\t\t\tconst fileServiceInstance = this.getCurrentFileService();\n\n\t\t\tthis.fileServiceInstances.set(this.currentItem.id, fileServiceInstance);\n\n\t\t\tfileServiceInstance.browse({\n\t\t\t\tbindElement: node,\n\t\t\t\tonShowCallback: () => {\n\t\t\t\t\tthis.isItemPanelFreeze = true;\n\t\t\t\t},\n\t\t\t\tonHideCallback: () => {\n\t\t\t\t\tthis.isItemPanelFreeze = false;\n\t\t\t\t},\n\t\t\t});\n\t\t\tfileServiceInstance.subscribe('onFileComplete', () => {\n\t\t\t\tthis.isItemPanelFreeze = fileServiceInstance.isUploading();\n\t\t\t\tthis.focusToItem(this.currentItem.id);\n\t\t\t\tthis.checkListWasUpdated = true;\n\t\t\t});\n\t\t},\n\t\tgetCurrentFileService(): ?FileService\n\t\t{\n\t\t\tif (!this.currentItem)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn fileService.get(\n\t\t\t\tthis.currentItem.id,\n\t\t\t\tEntityTypes.CheckListItem,\n\t\t\t\t{ parentEntityId: this.taskId },\n\t\t\t);\n\t\t},\n\t\thasItemFiles(item: CheckListModel): boolean\n\t\t{\n\t\t\tif (!item)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst fileServiceInstance = this.getCurrentFileService();\n\n\t\t\tconst files = item.attachments;\n\n\t\t\treturn (\n\t\t\t\tfiles.length > 0\n\t\t\t\t|| fileServiceInstance?.isUploading()\n\t\t\t\t|| fileServiceInstance?.hasUploadingError()\n\t\t\t);\n\t\t},\n\t\thasItemUsers(item: CheckListModel): boolean\n\t\t{\n\t\t\treturn (item.accomplices.length > 0 || item.auditors.length > 0);\n\t\t},\n\t\tisCurrentItemEmpty(): boolean\n\t\t{\n\t\t\tif (!this.currentItem)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn this.currentItem.title === '';\n\t\t},\n\t\tmoveGroupToRight(): void\n\t\t{\n\t\t\tif (this.itemGroupModeSelected)\n\t\t\t{\n\t\t\t\tthis.checkListManager.getAllSelectedItems()\n\t\t\t\t\t.sort((a: CheckListModel, b: CheckListModel) => a.sortIndex - b.sortIndex)\n\t\t\t\t\t.forEach((item: CheckListModel) => {\n\t\t\t\t\t\tthis.moveRight(item);\n\t\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.moveRight(this.currentItem);\n\t\t\t}\n\t\t},\n\t\tmoveRight(item: CheckListModel): void\n\t\t{\n\t\t\tthis.checkListManager.moveRight(\n\t\t\t\titem,\n\t\t\t\t(updates: CheckListModel[]) => {\n\t\t\t\t\tvoid this.upsertCheckLists(updates);\n\t\t\t\t\tthis.checkListWasUpdated = true;\n\n\t\t\t\t\tif (!item.groupMode?.active)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.focusToItem(item.id);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t);\n\t\t},\n\t\tmoveGroupToLeft(): void\n\t\t{\n\t\t\tif (this.itemGroupModeSelected)\n\t\t\t{\n\t\t\t\tthis.checkListManager.getAllSelectedItems()\n\t\t\t\t\t.sort((a: CheckListModel, b: CheckListModel) => b.sortIndex - a.sortIndex)\n\t\t\t\t\t.forEach((item: CheckListModel) => {\n\t\t\t\t\t\tthis.moveLeft(item);\n\t\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.moveLeft(this.currentItem);\n\t\t\t}\n\t\t},\n\t\tmoveLeft(item: CheckListModel): void\n\t\t{\n\t\t\tthis.checkListManager.moveLeft(\n\t\t\t\titem,\n\t\t\t\t(updates: CheckListModel[]) => {\n\t\t\t\t\tvoid this.upsertCheckLists(updates);\n\t\t\t\t\tthis.checkListWasUpdated = true;\n\n\t\t\t\t\tif (!item.groupMode?.active)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.focusToItem(item.id);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t);\n\t\t},\n\t\tasync forward(node: HTMLElement): Promise<void>\n\t\t{\n\t\t\tif (this.hasFewParentCheckLists)\n\t\t\t{\n\t\t\t\tthis.showForwardMenu(node);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.hideItemPanel();\n\n\t\t\t\tvoid this.forwardToNewChecklist();\n\t\t\t}\n\n\t\t\tthis.checkListWasUpdated = true;\n\t\t},\n\t\tasync forwardToNewChecklist(): Promise<void>\n\t\t{\n\t\t\tconst newParentId = await this.addCheckList(true);\n\n\t\t\tif (this.itemGroupModeSelected)\n\t\t\t{\n\t\t\t\tvoid this.forwardGroupItemsToChecklist(newParentId);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.forwardToChecklist(newParentId);\n\t\t\t}\n\t\t},\n\t\tforwardToChecklist(checkListId: number | string): void\n\t\t{\n\t\t\tconst finalSortIndex = this.checkListManager.getChildren(checkListId).length;\n\n\t\t\tvoid this.updateCheckList(this.currentItem.id, {\n\t\t\t\tparentId: checkListId,\n\t\t\t\tsortIndex: finalSortIndex,\n\t\t\t});\n\n\t\t\tthis.resortItemsOnLevel(checkListId);\n\t\t\tthis.resortItemsOnLevel(this.currentItem.parentId);\n\t\t},\n\t\tasync forwardGroupItemsToChecklist(checkListId: number | string): Promise<void>\n\t\t{\n\t\t\tconst finalSortIndex = this.checkListManager.getChildren(checkListId).length;\n\n\t\t\tconst checkListIdsFromWhichWereForwarded = new Set();\n\n\t\t\tconst allSelectedItems = this.checkListManager.getAllSelectedItems();\n\t\t\tconst nearestItem = this.checkListManager.findNearestItem(this.currentItem, false, allSelectedItems);\n\t\t\tif (nearestItem)\n\t\t\t{\n\t\t\t\tthis.showItemPanel(nearestItem.id);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.cancelGroupMode();\n\t\t\t}\n\n\t\t\tconst allSelectedWithChildren = this.checkListManager.getAllSelectedItemsWithChildren();\n\n\t\t\tconst selectedItemsIds = new Set(allSelectedItems.map((item: CheckListModel) => item.id));\n\n\t\t\tconst updates = [];\n\n\t\t\tallSelectedItems.forEach((item: CheckListModel) => {\n\t\t\t\tconst shouldUpdateParentId = !selectedItemsIds.has(item.parentId);\n\n\t\t\t\tcheckListIdsFromWhichWereForwarded.add(item.parentId);\n\n\t\t\t\tupdates.push({\n\t\t\t\t\t...item,\n\t\t\t\t\tparentId: shouldUpdateParentId ? checkListId : item.parentId,\n\t\t\t\t\tgroupMode: {\n\t\t\t\t\t\tactive: false,\n\t\t\t\t\t\tselected: false,\n\t\t\t\t\t},\n\t\t\t\t\tsortIndex: shouldUpdateParentId ? finalSortIndex : item.sortIndex,\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tallSelectedWithChildren.forEach((item: CheckListModel) => {\n\t\t\t\tif (!selectedItemsIds.has(item.id))\n\t\t\t\t{\n\t\t\t\t\tupdates.push({\n\t\t\t\t\t\t...item,\n\t\t\t\t\t\tgroupMode: {\n\t\t\t\t\t\t\tactive: false,\n\t\t\t\t\t\t\tselected: false,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tawait this.upsertCheckLists(updates);\n\n\t\t\tif (nearestItem)\n\t\t\t{\n\t\t\t\tvoid this.updateCheckList(nearestItem.id, {\n\t\t\t\t\tgroupMode: {\n\t\t\t\t\t\tactive: true,\n\t\t\t\t\t\tselected: true,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.resortItemsOnLevel(checkListId);\n\t\t\tcheckListIdsFromWhichWereForwarded.forEach((id: number | string) => {\n\t\t\t\tthis.resortItemsOnLevel(id);\n\t\t\t});\n\t\t},\n\t\tdelete(): void\n\t\t{\n\t\t\tif (this.itemGroupModeSelected)\n\t\t\t{\n\t\t\t\tvoid this.handleGroupRemove(this.currentItem.id);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.hideItemPanel();\n\t\t\t\tthis.handleRemove(this.currentItem.id);\n\t\t\t}\n\t\t},\n\t\tcancelGroupMode(): void\n\t\t{\n\t\t\tthis.deactivateGroupMode();\n\t\t\tthis.hideItemPanel();\n\t\t},\n\t\tcleanCollapsedState(): void\n\t\t{\n\t\t\tconst updates = this.parentCheckLists\n\t\t\t\t.map((item: CheckListModel) => ({\n\t\t\t\t\t...item,\n\t\t\t\t\tlocalCollapsedState: null,\n\t\t\t\t}));\n\n\t\t\tvoid this.upsertCheckLists(updates);\n\t\t},\n\t\tcleanEmptyCurrentItem(): void\n\t\t{\n\t\t\tif (this.currentItem && this.isCurrentItemEmpty())\n\t\t\t{\n\t\t\t\tthis.removeItem(this.currentItem.id);\n\t\t\t}\n\t\t},\n\t\tshowParticipantDialog(targetNode: HTMLElement, type: 'accomplices' | 'auditors'): void\n\t\t{\n\t\t\tthis.isItemPanelFreeze = true;\n\n\t\t\tconst preselected = this.currentItem[type].map((user: UserModel) => ['user', user.id]);\n\n\t\t\tthis.selector ??= new EntitySelectorDialog({\n\t\t\t\t...participantMeta.dialogOptions(this.taskId, 'check-list'),\n\t\t\t\tpreselectedItems: preselected,\n\t\t\t\tpopupOptions: {\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonShow: (baseEvent: BaseEvent): void => {\n\t\t\t\t\t\t\tconst popup = baseEvent.getTarget();\n\t\t\t\t\t\t\tconst popupWidth = popup.getPopupContainer().offsetWidth;\n\t\t\t\t\t\t\tconst targetNodeWidth = 10;\n\n\t\t\t\t\t\t\tconst offsetLeft = targetNodeWidth - (popupWidth / 2);\n\t\t\t\t\t\t\tconst angleShift = Popup.getOption('angleLeftOffset') - Popup.getOption('angleMinTop');\n\n\t\t\t\t\t\t\tpopup.setAngle({ offset: popupWidth / 2 - angleShift });\n\t\t\t\t\t\t\tpopup.setOffset({ offsetLeft: offsetLeft + Popup.getOption('angleLeftOffset') });\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonClose: (): void => {\n\t\t\t\t\t\t\tconst users = this.selector.getSelectedItems().map((item: Item) => ({\n\t\t\t\t\t\t\t\tid: item.getId(),\n\t\t\t\t\t\t\t\tname: item.getTitle(),\n\t\t\t\t\t\t\t\timage: item.getAvatar(),\n\t\t\t\t\t\t\t\ttype: item.getEntityType(),\n\t\t\t\t\t\t\t}));\n\n\t\t\t\t\t\t\tthis.saveParticipants(this.selector.params.itemId, this.selector.params.type, users);\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonHide: (): void => {\n\t\t\t\t\t\tthis.isItemPanelFreeze = false;\n\n\t\t\t\t\t\tif (!this.itemGroupModeSelected && this.currentItem.id === this.selector.params.itemId)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.focusToItem(this.selector.params.itemId);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.updatePanelPosition();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tthis.selector.selectItemsByIds(preselected);\n\t\t\tthis.selector.params = {\n\t\t\t\titemId: this.currentItem.id,\n\t\t\t\ttype,\n\t\t\t};\n\n\t\t\tthis.selector.showTo(targetNode);\n\t\t},\n\t\tsaveParticipants(id: number | string, type: 'accomplices' | 'auditors', users: UserModel[]): void\n\t\t{\n\t\t\tif (this.itemGroupModeSelected)\n\t\t\t{\n\t\t\t\tconst updates = this.checkListManager.getAllSelectedItems()\n\t\t\t\t\t.map((item: CheckListModel) => ({\n\t\t\t\t\t\t...item,\n\t\t\t\t\t\t[type]: users,\n\t\t\t\t\t}));\n\n\t\t\t\tvoid this.upsertCheckLists(updates);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tvoid this.updateCheckList(id, {\n\t\t\t\t\t[type]: users,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst ids = users.map((user: UserModel) => user.id);\n\t\t\tconst fields = {\n\t\t\t\t[`${type}Ids`]: ids,\n\t\t\t};\n\n\t\t\tvoid this.updateTask(fields);\n\n\t\t\tthis.checkListWasUpdated = true;\n\t\t},\n\t\tactivateGroupMode(parentItemId: number | string): void\n\t\t{\n\t\t\tthis.itemId = parentItemId;\n\n\t\t\tconst updates = this.checkListManager.getAllChildren(parentItemId)\n\t\t\t\t.map((item: CheckListModel, index: number) => ({\n\t\t\t\t\t...item,\n\t\t\t\t\tgroupMode: {\n\t\t\t\t\t\tactive: true,\n\t\t\t\t\t\tselected: index === 0,\n\t\t\t\t\t},\n\t\t\t\t}));\n\n\t\t\tupdates.push({\n\t\t\t\t...this.currentItem,\n\t\t\t\tgroupMode: {\n\t\t\t\t\tactive: true,\n\t\t\t\t\tselected: false,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tvoid this.upsertCheckLists(updates);\n\t\t},\n\t\tdeactivateGroupMode(): void\n\t\t{\n\t\t\tconst updates = this.checkListManager.getAllGroupModeItems()\n\t\t\t\t.map((item: CheckListModel) => ({\n\t\t\t\t\t...item,\n\t\t\t\t\tgroupMode: {\n\t\t\t\t\t\tactive: false,\n\t\t\t\t\t\tselected: false,\n\t\t\t\t\t},\n\t\t\t\t}));\n\n\t\t\tvoid this.upsertCheckLists(updates);\n\t\t},\n\t\thasActiveGroupMode(): boolean\n\t\t{\n\t\t\treturn this.checkListManager.getAllGroupModeItems().length > 0;\n\t\t},\n\t\tfreeze()\n\t\t{\n\t\t\tthis.$refs.childComponent?.$refs?.childComponent?.freeze();\n\t\t},\n\t\tunfreeze()\n\t\t{\n\t\t\tif (\n\t\t\t\tthis.shownPopups.size === 0\n\t\t\t\t&& Object.keys(this.deletingCheckListIds).length === 0\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.$refs.childComponent?.$refs?.childComponent?.unfreeze();\n\t\t\t}\n\t\t},\n\t\tsetDefaultCheckListTitle(itemId: number | string): void\n\t\t{\n\t\t\tvoid this.updateCheckList(itemId, {\n\t\t\t\ttitle: this.loc(\n\t\t\t\t\t'TASKS_V2_CHECK_LIST_TITLE_NUMBER',\n\t\t\t\t\t{ '#number#': this.getCheckListsNumber() },\n\t\t\t\t),\n\t\t\t});\n\t\t},\n\t\tcleanNotifiers(): void\n\t\t{\n\t\t\tthis.notifiers.forEach((notifier: CheckListNotifier) => notifier.stopTimer());\n\t\t\tthis.notifiers.clear();\n\t\t},\n\t},\n\ttemplate: `\n\t\t<component\n\t\t\tv-if=\"componentShown\"\n\t\t\tref=\"childComponent\"\n\t\t\t:is=\"componentName\"\n\t\t\t:taskId=\"taskId\"\n\t\t\t:isShown=\"isShown\"\n\t\t\t:getBindElement=\"getBindElement\"\n\t\t\t:getTargetContainer=\"getTargetContainer\"\n\t\t\t:isEmpty=\"emptyList\"\n\t\t\t@show=\"handleShow\"\n\t\t\t@close=\"handleClose\"\n\t\t\t@isShown=\"handleIsShown\"\n\t\t\t@addFastCheckList=\"addFastCheckList\"\n\t\t\t@resize=\"$emit('resize')\"\n\t\t>\n\t\t\t<template v-slot:default=\"{ handleShow, handleClose }\">\n\t\t\t\t<div ref=\"wrapper\" class=\"tasks-check-list-wrapper\" :class=\"contextClass\">\n\t\t\t\t\t<div v-if=\"!isPreview\" class=\"tasks-check-list-close-icon\" :class=\"contextClass\">\n\t\t\t\t\t\t<BIcon :name=\"Outline.CROSS_L\" @click=\"handleClose\"/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div ref=\"list\" data-list class=\"tasks-check-list-content\" :class=\"contextClass\">\n\t\t\t\t\t\t<CheckListWidget\n\t\t\t\t\t\t\tv-show=\"!stub\"\n\t\t\t\t\t\t\t:taskId=\"taskId\"\n\t\t\t\t\t\t\t:checkListId=\"checkListId\"\n\t\t\t\t\t\t\t:isPreview=\"isPreview\"\n\t\t\t\t\t\t\t@update=\"handleUpdate\"\n\t\t\t\t\t\t\t@show=\"handleShow\"\n\t\t\t\t\t\t\t@addItem=\"addItem\"\n\t\t\t\t\t\t\t@addItemFromBtn=\"addItemFromBtn\"\n\t\t\t\t\t\t\t@removeItem=\"handleRemove\"\n\t\t\t\t\t\t\t@focus=\"handleFocus\"\n\t\t\t\t\t\t\t@blur=\"handleBlur\"\n\t\t\t\t\t\t\t@emptyBlur=\"handleEmptyBlur\"\n\t\t\t\t\t\t\t@startGroupMode=\"handleGroupMode\"\n\t\t\t\t\t\t\t@toggleGroupModeSelected=\"handleGroupModeSelect\"\n\t\t\t\t\t\t\t@openCheckList=\"handleOpenCheckList\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<CheckListStub v-if=\"stub && !isPreview\" @click=\"addCheckList\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-show=\"!stub && !isPreview\" class=\"tasks-check-list-footer\" :class=\"contextClass\">\n\t\t\t\t\t\t<UiButton\n\t\t\t\t\t\t\t:text=\"loc('TASKS_V2_CHECK_LIST_NEW_BTN')\"\n\t\t\t\t\t\t\t:size=\"ButtonSize.MEDIUM\"\n\t\t\t\t\t\t\t:leftIcon=\"ButtonIcon.ADD\"\n\t\t\t\t\t\t\t:style=\"AirButtonStyle.PLAIN_NO_ACCENT\"\n\t\t\t\t\t\t\t@click=\"addCheckList\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<UiButton\n\t\t\t\t\t\t\t:text=\"loc('TASKS_V2_CHECK_LIST_READY_BTN')\"\n\t\t\t\t\t\t\t:size=\"ButtonSize.MEDIUM\"\n\t\t\t\t\t\t\t@click=\"handleClose\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<CheckListItemPanel\n\t\t\t\t\t\tv-if=\"itemPanelIsShown && !isPreview\"\n\t\t\t\t\t\tref=\"panel\"\n\t\t\t\t\t\t:taskId=\"taskId\"\n\t\t\t\t\t\t:currentItem=\"currentItem\"\n\t\t\t\t\t\t:style=\"itemPanelStyles\"\n\t\t\t\t\t\t@action=\"handlePanelAction\"\n\t\t\t\t\t/>\n\t\t\t\t\t<BMenu\n\t\t\t\t\t\tv-if=\"isForwardMenuShown\"\n\t\t\t\t\t\t:options=\"forwardMenuOptions\"\n\t\t\t\t\t\t@close=\"isForwardMenuShown = false\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</component>\n\t`,\n};\n","import { Text } from 'main.core';\n\nimport { Animated, Outline } from 'ui.icon-set.api.core';\nimport 'ui.icon-set.outline';\n\nimport { fieldHighlighter } from 'tasks.v2.lib.field-highlighter';\nimport { Chip, ChipDesign } from 'tasks.v2.component.elements.chip';\nimport { fileService, EntityTypes } from 'tasks.v2.provider.service.file-service';\nimport { EventName, Model } from 'tasks.v2.const';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\nimport type { CheckListModel } from 'tasks.v2.model.check-list';\n\nimport { checkListMeta } from './lib/check-list-meta';\n\n// @vue/component\nexport const CheckListChip = {\n\tcomponents: {\n\t\tChip,\n\t},\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tisAutonomous: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: ['showCheckList'],\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tOutline,\n\t\t\tcheckListMeta,\n\t\t};\n\t},\n\tcomputed: {\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.taskId);\n\t\t},\n\t\tcheckLists(): CheckListModel[]\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.CheckList}/getByIds`](this.task.checklist);\n\t\t},\n\t\tisUploading(): boolean\n\t\t{\n\t\t\treturn this.task.checklist?.some((itemId) => {\n\t\t\t\treturn fileService.get(\n\t\t\t\t\titemId,\n\t\t\t\t\tEntityTypes.CheckListItem,\n\t\t\t\t\t{ parentEntityId: this.taskId },\n\t\t\t\t).isUploading();\n\t\t\t});\n\t\t},\n\t\tdesign(): string\n\t\t{\n\t\t\treturn {\n\t\t\t\t[!this.isAutonomous && !this.isSelected]: ChipDesign.ShadowNoAccent,\n\t\t\t\t[!this.isAutonomous && this.isSelected]: ChipDesign.ShadowAccent,\n\t\t\t\t[this.isAutonomous && !this.isSelected]: ChipDesign.OutlineNoAccent,\n\t\t\t\t[this.isAutonomous && this.isSelected]: ChipDesign.OutlineAccent,\n\t\t\t}.true;\n\t\t},\n\t\tisSelected(): boolean\n\t\t{\n\t\t\tif (this.isAutonomous)\n\t\t\t{\n\t\t\t\treturn this.checkLists.length > 0;\n\t\t\t}\n\n\t\t\treturn this.wasFilled || this.checkLists.length > 0;\n\t\t},\n\t\twasFilled(): boolean\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/wasFieldFilled`](this.taskId, checkListMeta.id);\n\t\t},\n\t\tcheckListItemCount(): number\n\t\t{\n\t\t\treturn (this.checkLists.filter((checkList: CheckListModel) => checkList.parentId !== 0)).length;\n\t\t},\n\t\ttext(): string\n\t\t{\n\t\t\tif (this.isAutonomous && this.checkListItemCount > 0)\n\t\t\t{\n\t\t\t\tconst completedCount = this.getCompletedCount();\n\n\t\t\t\treturn this.loc(\n\t\t\t\t\t'TASKS_V2_CHECK_LIST_COUNT_TITLE',\n\t\t\t\t\t{\n\t\t\t\t\t\t'#count#': completedCount,\n\t\t\t\t\t\t'#total#': this.checkListItemCount,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn this.loc('TASKS_V2_CHECK_LIST_CHIP_TITLE');\n\t\t},\n\t\ticon(): string\n\t\t{\n\t\t\tif (this.isUploading && !this.wasFilled)\n\t\t\t{\n\t\t\t\treturn Animated.LOADER_WAIT;\n\t\t\t}\n\n\t\t\treturn Outline.CHECK_LIST;\n\t\t},\n\t},\n\tmounted(): void\n\t{\n\t\tthis.$bitrix.eventEmitter.subscribe(EventName.CloseCheckList, this.handleFieldClose);\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tthis.$bitrix.eventEmitter.unsubscribe(EventName.CloseCheckList, this.handleFieldClose);\n\t},\n\tmethods: {\n\t\thandleClick(): void\n\t\t{\n\t\t\tif (this.isAutonomous)\n\t\t\t{\n\t\t\t\tvoid this.showCheckList();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// eslint-disable-next-line no-lonely-if\n\t\t\t\tif (this.isSelected)\n\t\t\t\t{\n\t\t\t\t\tthis.highlightField();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tvoid this.showCheckList();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tasync showCheckList(): Promise<void>\n\t\t{\n\t\t\tif (!this.isSelected)\n\t\t\t{\n\t\t\t\tawait this.buildEmptyCheckList();\n\t\t\t}\n\n\t\t\tthis.$emit('showCheckList');\n\t\t},\n\t\tasync buildEmptyCheckList(): Promise<void>\n\t\t{\n\t\t\tconst parentId = Text.getRandom();\n\t\t\tconst childId = Text.getRandom();\n\n\t\t\tawait this.$store.dispatch(`${Model.CheckList}/insertMany`, [\n\t\t\t\t{\n\t\t\t\t\tid: parentId,\n\t\t\t\t\tnodeId: parentId,\n\t\t\t\t\ttitle: this.loc('TASKS_V2_CHECK_LIST_TITLE_NUMBER', { '#number#': 1 }),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: childId,\n\t\t\t\t\tnodeId: childId,\n\t\t\t\t\tparentId,\n\t\t\t\t},\n\t\t\t]);\n\n\t\t\tawait this.$store.dispatch(`${Model.Tasks}/update`, {\n\t\t\t\tid: this.taskId,\n\t\t\t\tfields: {\n\t\t\t\t\tchecklist: [parentId, childId],\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t\thighlightField(): void\n\t\t{\n\t\t\tvoid fieldHighlighter.setContainer(this.$root.$el).highlight(checkListMeta.id);\n\t\t},\n\t\tgetCompletedCount(): number\n\t\t{\n\t\t\treturn this.checkLists.filter((checklist: CheckListModel) => {\n\t\t\t\treturn checklist.isComplete && checklist.parentId !== 0;\n\t\t\t}).length;\n\t\t},\n\t\thandleFieldClose(): void\n\t\t{\n\t\t\tif (this.isAutonomous)\n\t\t\t{\n\t\t\t\tthis.$el.focus();\n\t\t\t}\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Chip\n\t\t\t:design=\"design\"\n\t\t\t:icon=\"icon\"\n\t\t\t:text=\"text\"\n\t\t\t:data-task-id=\"taskId\"\n\t\t\t:data-task-chip-id=\"checkListMeta.id\"\n\t\t\t@click=\"handleClick\"\n\t\t/>\n\t`,\n};\n"],"names":["CheckListStub","name","components","UiButton","emits","setup","ButtonSize","template","CheckListPopup","Popup","inheritAttrs","props","taskId","type","Number","String","required","resizeObserver","computed","popupId","popupOptions","className","width","height","borderRadius","offsetTop","padding","autoHide","closeByEsc","animation","showClassName","closeClassName","closeAnimationType","events","onClose","handleClose","bind","mapGetters","titleFieldOffsetHeight","Model","Interface","watch","$refs","childComponent","$nextTick","resize","created","ResizeObserver","entries","entry","target","wrapper","mounted","Event","window","beforeUnmount","unbind","methods","popupInstance","getPopupInstance","$emit","adjustPosition","handleShow","setTimeout","observe","$parent","disconnect","$bitrix","eventEmitter","emit","EventName","CloseCheckList","CheckListSheet","BottomSheet","isShown","Boolean","getBindElement","Function","default","getTargetContainer","value","document","handleKeyDown","capture","event","key","stopPropagation","CheckListManager","constructor","params","getItem","itemId","find","item","id","getItemsOnLevel","parentId","filter","sort","a","b","sortIndex","getItemLevel","checkListItem","level","current","visitedIds","Set","findParent","has","add","isItemDescendant","potentialAncestor","parent","i","showItems","itemIds","updateFn","updates","forEach","length","hideItems","syncParentCompletionState","parentItemId","changedItem","parentItem","childrenItems","isEmptyParent","allChildrenCompleted","every","child","localCompleteState","isComplete","someChildrenIncomplete","parentCompleted","shouldUpdateParent","getAllGroupModeItems","groupMode","active","getAllSelectedItems","selected","getAllSelectedItemsWithChildren","result","Map","selectedItems","allItems","set","getChildren","parentIds","children","includes","map","values","getAllChildren","visited","collectChildren","currentId","push","getAllCompletedChildren","getSiblings","sibling","resortItemsOnLevel","sortedItems","newIndex","resortItemsAfterIndex","itemsToResort","moveRight","itemsOnLevel","currentIndex","findIndex","newParent","candidate","newParentChildren","index","parentNodeId","nodeId","moveLeft","currentParent","parentInNewListIndex","currentSiblingsUpdates","newSortIndex","shiftUpdates","movedItemUpdate","findNearestItem","initialItem","excludeChildrenOf","rootParent","currentSortIndex","excludedParentIds","eligibleItems","isChildOfExcluded","reduce","nearest","getFirstChild","hasEmptyItemWithFiles","hasItemFiles","some","title","hasItemWithFiles","hasEmptyParentItem","getFirstEmptyItem","items","getChildWithEmptyTitle","isItemCollapsed","isPreview","positionIndex","localCollapsedState","collapsed","expanded","getRootParentByChildId","childItem","currentItem","expandIdsWithChildren","fullSet","size","checkListMap","processedIds","findItemIdsWithUser","rootId","userId","rootItem","unshift","hasUser","accomplices","user","auditors","hidden","updatedItem","resultSet","checkLists","checkListMeta","Object","freeze","TaskField","CheckList","Loc","getMessage","CheckListList","BIcon","isEmpty","Animated","Outline","data","isLoading","deletingCheckListIds","disableCheckListAnimations","task","$store","getters","Tasks","isEdit","Type","isNumber","checklist","isFilledEmpty","checkListLength","wasFilled","deletingRootIds","deletingIds","checkListManager","containsChecklist","loading","canCheckListAdd","rights","checklistAdd","loadData","checkListService","load","Highlighter","WeakMap","highlight","element","animationStart","timeoutId","handler","state","get","ANIMATION_DURATION","Dom","addClass","HIGHLIGHT_CLASS","ANIMATE_CLASS","Date","now","removeClass","clearTimeout","delete","Promise","resolve","CheckListItemMixin","isHovered","scrollContainer","currentUserId","canSave","checklistSave","canAdd","canEdit","checklistEdit","creator","canCheckListToggle","checklistToggle","canModify","actions","modify","canRemove","remove","canToggle","toggle","hasAttachments","hasUsers","hasAccomplices","hasAuditors","files","attachments","textColor","completed","groupModeSelected","mapActions","handleFocus","handleBlur","handleEmptyBlur","updateCheckList","fields","dispatch","upsertCheckLists","updateTitle","addItem","removeItem","complete","listParents","completionCallback","saveCompleteState","addCheckListCompletionCallback","callback","renew","focusToItem","$el","closest","itemRect","getPosition","containerRect","offsetTopInsideContainer","top","scrollTop","scrollTo","behavior","CheckListParentItem","BMenu","GrowingTextArea","UserAvatarList","UserCheckbox","ProgressBar","directives","hint","mixins","inject","Actions","isSticky","isMenuShown","menuRemoveSectionCode","menuOptions","Text","getRandom","bindElement","more","minWidth","offsetLeft","sections","code","menuItems","targetContainer","body","collapseItem","areCompletedCollapsed","loc","icon","OBSERVER","CROSSED_EYE","dataset","onClick","newValue","toggleCompleted","groupActionsItem","MULTICHOICE_ON","isCollapsed","toggleCollapse","editItem","sectionCode","EDIT_L","design","TRASHCAN","itemIcon","CHECK_L","CHECK_LIST","checkListStatus","label","replace","completedCount","totalCount","currentUserResponsible","responsibleId","currentUser","Users","numberMyItems","myFilterTooltip","tooltip","text","myFilterActive","myFilter","offsetWidth","handleMyFilter","setItemsRef","handleScroll","checkSticky","mutationObserver","MutationObserver","childList","subtree","handleTextClick","checked","myItemIds","idsToHide","childrenIds","stickyRect","getBoundingClientRect","showMenu","collapse","expand","CheckListChildItem","BLine","UserFieldWidgetComponent","itemOffset","fileServiceInstance","fileService","EntityTypes","CheckListItem","parentEntityId","uploaderAdapter","getAdapter","uploadingFiles","getFiles","filesLoading","widgetOptions","isEmbedded","withControlPanel","canCreateDocuments","tileWidgetOptions","compact","hideDropArea","enableDropzone","readonly","autoCollapse","removeFromServer","hasFilesAttach","hasFiles","isUploading","hasUploadingError","filesNumber","hasTrashcanIcon","panelIsShown","readOnly","loadFiles","toggleGroupModeSelected","ids","file","list","handleEnter","handleClick","filesWidget","isClickInsideFilesWidget","filesNode","excludedClasses","isInsideWidget","contains","hasExcludedClass","hasClass","CheckListAddItem","CheckListGroupCompletedList","totalCompletedParents","completedParentsLabel","CheckListWidget","checkListId","parentCheckLists","checkList","canEditCheckList","siblings","canAddItem","$root","querySelector","childWithEmptyTitle","isFocusToCheckList","targetItemId","scrollOffset","targetItem","highlightElement","getItemOffset","getFirstCompletedCheckList","completedCheckLists","showFirstCompletedCheckList","firstCompletedCheckList","PanelSection","Important","Attachments","Movement","Accomplice","Auditor","Forward","Delete","Cancel","PanelAction","SetImportant","AttachFile","MoveRight","MoveLeft","AssignAccomplice","AssignAuditor","PanelMeta","defaultSections","FIRE","activeIcon","FIRE_SOLID","action","hoverable","ATTACH","POINT_RIGHT","POINT_LEFT","PERSON","FORWARD","CROSS_L","CheckListItemPanel","currentHintElement","currentHintText","section","visibleSections","visibleActions","disabled","isItemDisabled","isItemActive","timeout","background","darkMode","bindOptions","forceBindPosition","forceTop","position","itemGroupModeSelected","limits","Core","getParams","stakeholdersActions","isDisabledStakeholders","stakeholders","disabledActions","itemLevel","conditionHandlers","condition","activeActions","isImportant","getItemIcon","handleItemClick","node","currentTarget","handleItemMouseEnter","CheckListNotifier","EventEmitter","setEventNamespace","content","isUndefined","timerValue","showBalloonWithTimer","UI","Notification","Center","notify","mouseup","stopTimer","close","setInterval","update","clearInterval","Context","Sheet","Preview","provide","getItemsRef","isAutonomous","isComponentShown","AirButtonStyle","ButtonIcon","itemPanelIsShown","checkListWasUpdated","lastUpdatedCheckListId","itemPanelStyles","display","isItemPanelFreeze","itemPanelTopOffset","itemPanelTopLimit","itemsRefs","isForwardMenuShown","forwardMenuSectionCode","forwardBindElement","shownPopups","notifiers","checkListCompletionCallback","componentName","context","true","contextClass","componentShown","canSaveCheckList","hasFewParentCheckLists","forwardMenuOptions","maxWidth","maxHeight","forwardMenuItems","checklistItems","hideItemPanel","forwardGroupItemsToChecklist","forwardToChecklist","forwardToNewChecklist","stub","emptyList","popupComponent","executeCheckListCompletionCallbacks","subscribeToEvents","checkListNode","scrollIntoView","block","unsubscribeFromEvents","isNewCheckList","isString","subscribe","handleInitPopup","handleShowPopup","handleClosePopup","unsubscribe","handleUpdate","handleRemove","addItemToDelete","messageKey","notifier","subscribeOnce","baseEvent","timerHasEnded","getData","removeItemFromDelete","unfreeze","isCurrentItemEmpty","updatePanelPosition","cleanNotifiers","cancelGroupMode","cleanCollapsedState","firstEmptyItem","getItemIdWithUploadingFiles","fileServiceInstances","getEntityId","itemIdWithUploadingFiles","cleanEmptyCurrentItem","saveCheckList","handleIsShown","getCompatData","isDomNode","excludedIds","shouldExclude","excludedId","popup","getId","handleGroupRemove","allSelectedItems","nearestItem","showItemPanel","allSelectedItemIds","idsToShow","setDefaultCheckListTitle","handleGroupMode","firstChild","activateGroupMode","handleGroupModeSelect","showItemPanelOnNearestSelectedItem","handlePanelAction","actionHandlers","n","setImportant","attachFile","moveGroupToRight","moveGroupToLeft","showParticipantDialog","forward","handleOpenCheckList","updateTask","insertCheckList","insertManyCheckLists","deleteCheckList","isDemoCheckListModified","removeChecklists","fullListDeletingIds","checkListsToSave","save","getCheckListsNumber","demoTitle","hasItemUsers","addCheckList","empty","childId","getDataForNewCheckList","addFastCheckList","showForwardMenu","getCountForNewCheckList","getSortForNewCheckList","ref","itemRef","growingTextArea","focusTextarea","hasActiveGroupMode","insertItem","addItemFromBtn","isRootCall","checkListIds","addCheckListItemToDeleting","removeCheckListItemFromDeleting","deactivateGroupMode","nearestSelectedItem","panelRect","panel","listRect","getRelativePosition","isParentItem","paddingOffset","panelWidth","left","getCurrentFileService","browse","onShowCallback","onHideCallback","newParentId","finalSortIndex","checkListIdsFromWhichWereForwarded","allSelectedWithChildren","selectedItemsIds","shouldUpdateParentId","targetNode","preselected","selector","EntitySelectorDialog","participantMeta","dialogOptions","preselectedItems","onShow","getTarget","popupWidth","getPopupContainer","targetNodeWidth","angleShift","getOption","setAngle","offset","setOffset","users","getSelectedItems","getTitle","image","getAvatar","getEntityType","saveParticipants","onHide","selectItemsByIds","showTo","keys","clear","CheckListChip","Chip","isSelected","ChipDesign","ShadowNoAccent","ShadowAccent","OutlineNoAccent","OutlineAccent","checkListItemCount","getCompletedCount","LOADER_WAIT","handleFieldClose","showCheckList","highlightField","buildEmptyCheckList","fieldHighlighter","setContainer","focus"],"mappings":"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"}