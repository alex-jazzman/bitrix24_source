this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};this.BX.Tasks.V2=this.BX.Tasks.V2||{};this.BX.Tasks.V2.Component=this.BX.Tasks.V2.Component||{};(function(t,e,s,i,a,d,n,o,c,r,l,h){"use strict";const p=Object.freeze({id:o.TaskField.Accomplices,title:e.Loc.getMessage("TASKS_V2_ACCOMPLICES_TITLE")});const k={methods:{update(t){this.insertUsers(t);this.updateTask(t.map((({id:t})=>t)))},insertUsers(t){void s.Core.getStore().dispatch(`${o.Model.Users}/upsertMany`,t)},updateTask(t){void i.taskService.update(this.taskId,{accomplicesIds:t})}}};const m={name:"TaskAccomplices",components:{ParticipantList:r.ParticipantList},mixins:[k],props:{taskId:{type:[Number,String],required:true}},computed:{task(){return this.$store.getters[`${o.Model.Tasks}/getById`](this.taskId)},users(){return this.$store.getters[`${o.Model.Users}/getByIds`](this.task.accomplicesIds)},dataset(){return{"data-task-id":this.taskId,"data-task-field-id":p.id,"data-task-field-value":this.task.accomplicesIds.join(",")}}},template:`\n\t\t<ParticipantList\n\t\t\t:taskId="taskId"\n\t\t\tcontext="accomplices"\n\t\t\t:users="users"\n\t\t\t:dataset="dataset"\n\t\t\t@update="update"\n\t\t/>\n\t`};const u={components:{Chip:c.Chip},mixins:[k],props:{taskId:{type:[Number,String],required:true}},setup(){return{Outline:d.Outline,accomplicesMeta:p}},computed:{task(){return this.$store.getters[`${o.Model.Tasks}/getById`](this.taskId)},preselected(){return this.task.accomplicesIds.map((t=>["user",t]))},design(){return this.isSelected?c.ChipDesign.ShadowAccent:c.ChipDesign.ShadowNoAccent},isSelected(){return this.$store.getters[`${o.Model.Tasks}/wasFieldFilled`](this.taskId,p.id)},readonly(){return!this.task.rights.edit}},unmounted(){var t;(t=this.selector)==null?void 0:t.destroy()},methods:{showDialog(){var t;if(this.isSelected){this.highlightField();return}(t=this.selector)!=null?t:this.selector=new h.UserSelectorDialog({taskId:this.taskId,preselected:this.preselected,dialogOptions:r.participantMeta.dialogOptions(this.taskId,"accomplices"),events:{onHide:()=>{const t=this.selector.getDialog().getSelectedItems().map((t=>({id:t.getId(),name:t.getTitle(),image:t.getAvatar()})));if(!this.isSelected&&t.length>0){this.highlightField()}this.update(t)}}});this.selector.selectItemsByIds(this.preselected);this.selector.show(this.$el)},highlightField(){void l.fieldHighlighter.setContainer(this.$root.$el).highlight(p.id)}},template:`\n\t\t<Chip\n\t\t\tv-if="isSelected || !readonly"\n\t\t\t:design="design"\n\t\t\t:icon="Outline.PERSON"\n\t\t\t:text="loc('TASKS_V2_ACCOMPLICES_TITLE_CHIP')"\n\t\t\t:data-task-id="taskId"\n\t\t\t:data-task-chip-id="accomplicesMeta.id"\n\t\t\t:data-task-chip-value="task.accomplicesIds.join(',')"\n\t\t\t@click="showDialog"\n\t\t/>\n\t`};t.Accomplices=m;t.AccomplicesChip=u;t.accomplicesMeta=p})(this.BX.Tasks.V2.Component.Fields=this.BX.Tasks.V2.Component.Fields||{},BX,BX.Tasks.V2,BX.Tasks.V2.Provider.Service,BX.UI.EntitySelector,BX.UI.IconSet,BX,BX.Tasks.V2.Const,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Lib,BX.Tasks.V2.Lib);
//# sourceMappingURL=accomplices.bundle.map.js