this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};this.BX.Tasks.V2=this.BX.Tasks.V2||{};this.BX.Tasks.V2.Component=this.BX.Tasks.V2.Component||{};(function(t,e,s,i,n,r,o,a,l,c,d,h,u,m,p,I,f,v,k,C,L,g,b,S,w,T,M,E,P,A,B,y){"use strict";const _={name:"CheckListStub",components:{UiButton:o.Button},emits:["click"],setup(){return{ButtonSize:o.ButtonSize}},template:`\n\t\t<div class="check-list-stub">\n\t\t\t<div class="check-list-stub-title">\n\t\t\t\t{{ loc('TASKS_V2_CHECK_LIST_STUB_TITLE') }}\n\t\t\t</div>\n\t\t\t<div class="check-list-stub-icon"></div>\n\t\t\t<div class="check-list-stub-btn">\n\t\t\t\t<UiButton\n\t\t\t\t\t:text="loc('TASKS_V2_CHECK_LIST_STUB_BTN')"\n\t\t\t\t\t:size="ButtonSize.MEDIUM"\n\t\t\t\t\t@click="$emit('click')"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`};const F={name:"TaskCheckListPopup",components:{Popup:a.Popup},inheritAttrs:false,props:{taskId:{type:[Number,String],required:true}},emits:["show","close","resize"],setup(){return{resizeObserver:null}},computed:{popupId(){return`tasks-check-list-popup-${this.taskId}`},popupOptions(){return{className:"tasks-check-list-popup",width:580,height:500,borderRadius:"18px",offsetTop:0,padding:0,autoHide:true,closeByEsc:true,animation:{showClassName:"tasks-check-list-popup-show",closeClassName:"tasks-check-list-popup-close",closeAnimationType:"animation"},events:{onClose:this.handleClose.bind(this)}}},...u.mapGetters({titleFieldOffsetHeight:`${y.Model.Interface}/titleFieldOffsetHeight`})},watch:{async titleFieldOffsetHeight(){if(!this.$refs.childComponent){return}await this.$nextTick();this.resize()}},created(){this.resizeObserver=new ResizeObserver((t=>{for(const e of t){if(e.target===this.$refs.wrapper){this.resize()}}}))},mounted(){T.Event.bind(window,"resize",this.resize)},beforeUnmount(){T.Event.unbind(window,"resize",this.resize)},methods:{resize(){var t;const e=(t=this.$refs.childComponent)==null?void 0:t.getPopupInstance();if(e){this.$emit("resize");e.adjustPosition()}},handleShow(){var t;this.$emit("show",{popupInstance:this.$refs.childComponent.getPopupInstance()});(t=this.$refs.childComponent)==null?void 0:t.getPopupInstance().adjustPosition();setTimeout((()=>this.resizeObserver.observe(this.$parent.$refs.wrapper)),300)},handleClose(){this.resizeObserver.disconnect();this.$bitrix.eventEmitter.emit(y.EventName.CloseCheckList);this.$emit("close")}},template:`\n\t\t<Popup :options="popupOptions" ref="childComponent">\n\t\t\t<slot\n\t\t\t\t:handleShow="handleShow"\n\t\t\t\t:handleClose="handleClose"\n\t\t\t></slot>\n\t\t</Popup>\n\t`};const H={name:"TaskCheckListSheet",components:{BottomSheet:l.BottomSheet},props:{isShown:{type:Boolean,required:true},getBindElement:{type:Function,default:null},getTargetContainer:{type:Function,default:null}},emits:["show","close","isShown"],computed:{...u.mapGetters({titleFieldOffsetHeight:`${y.Model.Interface}/titleFieldOffsetHeight`})},watch:{titleFieldOffsetHeight(){var t;(t=this.$refs.childComponent)==null?void 0:t.adjustPosition()},async isShown(t){await this.$nextTick();if(t===true){T.Event.bind(document,"keydown",this.handleKeyDown,{capture:true})}else{T.Event.unbind(document,"keydown",this.handleKeyDown,{capture:true})}this.$emit("isShown",t)}},methods:{handleShow(){this.$emit("show")},handleClose(){this.$emit("close")},handleKeyDown(t){if(t.key==="Escape"){this.handleClose();t.stopPropagation()}}},template:`\n\t\t<BottomSheet\n\t\t\tv-if="isShown"\n\t\t\t:padding="0"\n\t\t\t:getBindElement="getBindElement"\n\t\t\t:getTargetContainer="getTargetContainer"\n\t\t\tref="childComponent"\n\t\t>\n\t\t\t<slot\n\t\t\t\t:handleShow="handleShow"\n\t\t\t\t:handleClose="handleClose"\n\t\t\t></slot>\n\t\t</BottomSheet>\n\t`};var O=babelHelpers.classPrivateFieldLooseKey("params");var $=babelHelpers.classPrivateFieldLooseKey("setItemsVisibility");var x=babelHelpers.classPrivateFieldLooseKey("findNestedChildren");var N=babelHelpers.classPrivateFieldLooseKey("getRootParent");var R=babelHelpers.classPrivateFieldLooseKey("getCheckLists");class U{constructor(t){Object.defineProperty(this,R,{value:G});Object.defineProperty(this,N,{value:D});Object.defineProperty(this,x,{value:V});Object.defineProperty(this,$,{value:K});Object.defineProperty(this,O,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,O)[O]=t}getItem(t){return babelHelpers.classPrivateFieldLooseBase(this,R)[R]().find((e=>e.id===t))}getItemsOnLevel(t){return babelHelpers.classPrivateFieldLooseBase(this,R)[R]().filter((e=>e.parentId===t)).sort(((t,e)=>t.sortIndex-e.sortIndex))}getItemLevel(t){let e=0;let s=t;const i=new Set;const n=t=>babelHelpers.classPrivateFieldLooseBase(this,R)[R]().find((e=>e.id===t));while(s.parentId!==0){if(i.has(s.id)){break}i.add(s.id);s=n(s.parentId);if(!s){break}e++}return e}isItemDescendant(t,e){if((e==null?void 0:e.parentId)===(t==null?void 0:t.id)){return true}if((e==null?void 0:e.parentId)===0){return false}const s=babelHelpers.classPrivateFieldLooseBase(this,R)[R]().find((t=>t.id===(e==null?void 0:e.parentId)));if(!s){return false}return this.isItemDescendant(t,s)}showItems(t,e){const s=[];t.forEach((t=>babelHelpers.classPrivateFieldLooseBase(this,$)[$](t,false,s)));if(s.length>0){e(s)}}hideItems(t,e){const s=[];t.forEach((t=>babelHelpers.classPrivateFieldLooseBase(this,$)[$](t,true,s)));if(s.length>0){e(s)}}syncParentCompletionState(t,e,s){var i;const n=babelHelpers.classPrivateFieldLooseBase(this,R)[R]().find((e=>e.id===t));if((!n||!n.parentId)&&!s){return}const r=s||n.parentId;const o=babelHelpers.classPrivateFieldLooseBase(this,R)[R]().find((t=>t.id===r));if(!o){return}const a=babelHelpers.classPrivateFieldLooseBase(this,R)[R]().filter((t=>t.parentId===o.id));const l=a.length===0;const c=a.every((t=>{var e;return(e=t.localCompleteState)!=null?e:t.isComplete}));const d=!c;const h=(i=o.localCompleteState)!=null?i:o.isComplete;const u=l||c&&!h||d&&h;if(!u){return}e(o.id,{isComplete:c&&!l});if(o.parentId){this.syncParentCompletionState(o.id,e)}}getAllGroupModeItems(){return babelHelpers.classPrivateFieldLooseBase(this,R)[R]().filter((t=>{var e;return((e=t.groupMode)==null?void 0:e.active)===true}))}getAllSelectedItems(){return babelHelpers.classPrivateFieldLooseBase(this,R)[R]().filter((t=>{var e;return t.parentId!==0&&((e=t.groupMode)==null?void 0:e.selected)===true}))}getAllSelectedItemsWithChildren(){const t=new Map;const e=this.getAllSelectedItems();const s=babelHelpers.classPrivateFieldLooseBase(this,R)[R]();e.forEach((e=>t.set(e.id,e)));const i=e=>{const n=s.filter((s=>e.includes(s.parentId)&&!t.has(s.id)));n.forEach((e=>t.set(e.id,e)));if(n.length>0){i(n.map((t=>t.id)))}};i(e.map((t=>t.id)));return[...t.values()]}getAllChildren(t){const e=new Set;const s=[];const i=t=>{if(e.has(t)){return}e.add(t);const n=babelHelpers.classPrivateFieldLooseBase(this,R)[R]().filter((e=>e.parentId===t)).sort(((t,e)=>t.sortIndex-e.sortIndex));n.forEach((t=>{if(!e.has(t.id)){s.push(t);i(t.id)}}))};i(t);return s}getAllCompletedChildren(t){return this.getAllChildren(t).filter((t=>{var e;return((e=t.localCompleteState)!=null?e:t.isComplete)===true}))}getChildren(t){return babelHelpers.classPrivateFieldLooseBase(this,R)[R]().filter((e=>e.parentId===t))}getSiblings(t,e){return babelHelpers.classPrivateFieldLooseBase(this,R)[R]().filter((s=>s.parentId===e&&s.id!==t)).sort(((t,e)=>t.sortIndex-e.sortIndex))}resortItemsOnLevel(t,e){const s=babelHelpers.classPrivateFieldLooseBase(this,R)[R]().filter((e=>e.parentId===t));const i=[...s].sort(((t,e)=>t.sortIndex-e.sortIndex));const n=i.map(((t,e)=>({...t,sortIndex:e})));if(n.length>0){e(n)}}resortItemsAfterIndex(t,e,s){const i=babelHelpers.classPrivateFieldLooseBase(this,R)[R]().filter((e=>e.parentId===t));const n=i.filter((t=>t.sortIndex>=e)).sort(((t,e)=>t.sortIndex-e.sortIndex));const r=n.map((t=>({...t,sortIndex:t.sortIndex+1})));if(r.length>0){s(r)}}moveRight(t,e){if(t.parentId===0||this.getItemLevel(t)>5){return}const s=this.getItemsOnLevel(t.parentId);const i=s.findIndex((e=>e.id===t.id));if(i<=0){return}let n=null;for(let e=i-1;e>=0;e--){const i=s[e];if(!this.isItemDescendant(i,t)){n=i;break}}if(!n){return}const r=babelHelpers.classPrivateFieldLooseBase(this,R)[R]().filter((t=>t.parentId===n.id)).sort(((t,e)=>t.sortIndex-e.sortIndex));const o=s.filter(((t,e)=>e>i)).map((t=>({...t,sortIndex:t.sortIndex-1})));o.push({...t,parentId:n.id,parentNodeId:n.nodeId,sortIndex:r.length>0?r[r.length-1].sortIndex+1:0});e(o)}moveLeft(t,e){if(t.parentId===0||this.getItemLevel(t)<=1){return}const s=babelHelpers.classPrivateFieldLooseBase(this,R)[R]().find((e=>e.id===t.parentId));if(!s){return}const i=this.getItemsOnLevel(s.parentId);const n=i.findIndex((t=>t.id===s.id));const r=babelHelpers.classPrivateFieldLooseBase(this,R)[R]().filter((e=>e.parentId===t.parentId&&e.sortIndex>t.sortIndex)).map((t=>({...t,sortIndex:t.sortIndex-1})));let o=0;if(n===-1||n===i.length-1){o=i.length>0?i[i.length-1].sortIndex+1:0}else{o=i[n].sortIndex+1;const t=i.filter((t=>t.sortIndex>=o)).map((t=>({...t,sortIndex:t.sortIndex+1})));r.push(...t)}const a={...t,parentId:s.parentId,parentNodeId:s.parentNodeId||null,sortIndex:o};e([...r,a])}findNearestItem(t,e,s=[]){if(!t){return null}const i=babelHelpers.classPrivateFieldLooseBase(this,N)[N](t);if(!i){return null}const n=t.sortIndex;const r=new Set(s.map((t=>t.id)));const o=babelHelpers.classPrivateFieldLooseBase(this,R)[R]().sort(((t,e)=>t.sortIndex-e.sortIndex)).filter((s=>{var n,o;const a=r.has(s.parentId);return s.id!==t.id&&s.parentId!==0&&((n=s.groupMode)==null?void 0:n.selected)===e&&((o=babelHelpers.classPrivateFieldLooseBase(this,N)[N](s))==null?void 0:o.id)===i.id&&!a}));if(o.length===0){return null}return o.reduce(((t,e)=>e.sortIndex>n&&(e.sortIndex<t.sortIndex||t.sortIndex<=n)?e:t))}getFirstChild(t){const e=babelHelpers.classPrivateFieldLooseBase(this,R)[R]().filter((e=>e.parentId===t)).sort(((t,e)=>t.sortIndex-e.sortIndex));return e[0]||null}hasEmptyItemWithFiles(t){return babelHelpers.classPrivateFieldLooseBase(this,R)[R]().some((e=>e.title===""&&t(e)))}hasItemWithFiles(t){return babelHelpers.classPrivateFieldLooseBase(this,R)[R]().some((e=>t(e)))}hasEmptyParentItem(){return babelHelpers.classPrivateFieldLooseBase(this,R)[R]().some((t=>t.parentId===0&&t.title===""))}getFirstEmptyItem(){const t=babelHelpers.classPrivateFieldLooseBase(this,R)[R]().filter((t=>t.title==="")).sort(((t,e)=>t.sortIndex-e.sortIndex));return t[0]||null}getChildWithEmptyTitle(t){const e=babelHelpers.classPrivateFieldLooseBase(this,R)[R]().filter((e=>e.parentId===t)).sort(((t,e)=>e.sortIndex-t.sortIndex)).find((t=>t.title===""));return e||null}isItemCollapsed(t,e,s){if(t.localCollapsedState!==null){return t.localCollapsedState}if(!e){return false}if(t.collapsed&&!t.expanded){return true}if(t.expanded){return false}return s!==0}getRootParentByChildId(t){var e;const s=this.getItem(t);if(!s){return null}if(s.parentId===0){return s}let i=s;const n=new Set;while(i&&i.parentId!==0){if(n.has(i.id)){break}n.add(i.id);const t=this.getItem(i.parentId);if(!t){break}i=t}return((e=i)==null?void 0:e.parentId)===0?i:null}expandIdsWithChildren(t){const e=new Set(t);if(t.size===0||babelHelpers.classPrivateFieldLooseBase(this,R)[R]().length===0){return e}const s=new Map(babelHelpers.classPrivateFieldLooseBase(this,R)[R]().map((t=>[t.id,t])));const i=new Set;t.forEach((t=>{if(!i.has(t)){babelHelpers.classPrivateFieldLooseBase(this,x)[x](t,s,e,i)}}));return e}findItemIdsWithUser(t,e){const s=this.getAllChildren(t);const i=this.getItem(t);if(i){s.unshift(i)}const n=new Set;s.forEach((t=>{var s,i;const r=((s=t.accomplices)==null?void 0:s.some((t=>t.id===e)))||((i=t.auditors)==null?void 0:i.some((t=>t.id===e)));if(r&&t.parentId!==0){n.add(t.id)}}));return n}}function K(t,e,s){const i=this.getItem(t);if(!i||i.hidden===e){return}const n={...i,hidden:e};s.push(n);const r=this.getChildren(t);r.forEach((t=>{babelHelpers.classPrivateFieldLooseBase(this,$)[$](t.id,e,s)}))}function V(t,e,s,i){if(i.has(t)){return}i.add(t);e.forEach((n=>{if(n.parentId===t&&!s.has(n.id)){s.add(n.id);babelHelpers.classPrivateFieldLooseBase(this,x)[x](n.id,e,s,i)}}))}function D(t){if(!t||t.parentId===0){return t||null}const e=babelHelpers.classPrivateFieldLooseBase(this,R)[R]().find((e=>e.id===t.parentId));if(!e){return null}return babelHelpers.classPrivateFieldLooseBase(this,N)[N](e)}function G(){var t,e,s;return(t=(e=babelHelpers.classPrivateFieldLooseBase(this,O)[O])==null?void 0:(s=e.computed)==null?void 0:s.checkLists())!=null?t:[]}const z=Object.freeze({id:y.TaskField.CheckList,title:T.Loc.getMessage("TASKS_V2_CHECK_LIST_TITLE")});const W={name:"TaskCheckListList",components:{BIcon:L.BIcon},props:{taskId:{type:[Number,String],required:true},isEmpty:{type:Boolean,default:false}},emits:["open","addFastCheckList"],setup(){return{Animated:L.Animated,Outline:L.Outline,checkListMeta:z}},data(){return{isLoading:null}},computed:{...u.mapGetters({deletingCheckListIds:`${y.Model.Interface}/deletingCheckListIds`,disableCheckListAnimations:`${y.Model.Interface}/disableCheckListAnimations`}),task(){return this.$store.getters[`${y.Model.Tasks}/getById`](this.taskId)},isEdit(){return T.Type.isNumber(this.taskId)&&this.taskId>0},checkLists(){return this.$store.getters[`${y.Model.CheckList}/getByIds`](this.task.checklist)},isFilledEmpty(){return this.checkListLength===0&&this.wasFilled},checkListLength(){const t=Object.values(this.deletingCheckListIds);const e=new Set;t.forEach((t=>{e.add(t);this.checkListManager.getAllChildren(t).forEach((t=>{e.add(t.id)}))}));return this.checkLists.filter((({id:t})=>!e.has(t))).length},containsChecklist(){return this.task.containsChecklist},wasFilled(){return this.$store.getters[`${y.Model.Tasks}/wasFieldFilled`](this.taskId,z.id)},loading(){return this.isLoading===true&&this.isEdit},canCheckListAdd(){if(!this.isEdit){return true}return this.task.rights.checklistAdd===true}},async created(){this.checkListManager=new U({computed:{checkLists:()=>this.checkLists}});if(this.containsChecklist&&this.checkLists.length===0){this.isLoading=true;await this.loadData();this.isLoading=false}},methods:{async loadData(){await m.checkListService.load(this.taskId)}},template:`\n\t\t<div\n\t\t\t:data-task-field-id="checkListMeta.id"\n\t\t\tclass="tasks-check-list-list"\n\t\t\t:class="{ '--default': loading || isFilledEmpty }"\n\t\t>\n\t\t\t<div\n\t\t\t\tclass="tasks-check-list-list-content"\n\t\t\t\t:class="{ '--default': loading || isFilledEmpty }"\n\t\t\t>\n\t\t\t\t<Transition name="check-list-fade" mode="in-out" :css="!disableCheckListAnimations">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="loading"\n\t\t\t\t\t\tkey="loading"\n\t\t\t\t\t\tclass="tasks-check-list-list-transition-content"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="tasks-check-list-list-content-row">\n\t\t\t\t\t\t\t<BIcon :name="Animated.LOADER_WAIT"/>\n\t\t\t\t\t\t\t<div class="tasks-check-list-list-content-text">\n\t\t\t\t\t\t\t\t{{ loc('TASKS_V2_CHECK_LIST_LOADING') }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</Transition>\n\t\t\t\t<Transition name="check-list-fade" mode="in-out" :css="!disableCheckListAnimations">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="!loading && isFilledEmpty"\n\t\t\t\t\t\tkey="empty"\n\t\t\t\t\t\tclass="tasks-check-list-list-transition-content"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="tasks-check-list-list-content-row --stub" @click="$emit('addFastCheckList')">\n\t\t\t\t\t\t\t<BIcon :name="Outline.CHECK_LIST"/>\n\t\t\t\t\t\t\t<div class="tasks-check-list-list-content-text">\n\t\t\t\t\t\t\t\t{{ loc('TASKS_V2_CHECK_LIST_CHIP_TITLE') }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<BIcon class="tasks-check-list-list-content-row-plus" :name="Outline.PLUS_L"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</Transition>\n\t\t\t\t<div\n\t\t\t\t\tv-if="!loading && !isFilledEmpty"\n\t\t\t\t\tkey="content"\n\t\t\t\t\tclass="tasks-check-list-list-transition-content"\n\t\t\t\t>\n\t\t\t\t\t<slot></slot>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="canCheckListAdd"\n\t\t\t\t\t\tclass="tasks-check-list-list-content-row --footer"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass="tasks-check-list-list-content-btn"\n\t\t\t\t\t\t\t:class="{ '--empty': isEmpty }"\n\t\t\t\t\t\t\t@click="$emit('addFastCheckList')"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<BIcon :name="Outline.PLUS_L"/>\n\t\t\t\t\t\t\t<div class="tasks-check-list-list-content-btn-text">\n\t\t\t\t\t\t\t\t{{ loc('TASKS_V2_CHECK_LIST_ADD_LABEL') }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};var X=babelHelpers.classPrivateFieldLooseKey("activeHighlights");var j=babelHelpers.classPrivateFieldLooseKey("startAnimation");var q=babelHelpers.classPrivateFieldLooseKey("cleanup");var Y=babelHelpers.classPrivateFieldLooseKey("nextTick");class J{constructor(){Object.defineProperty(this,Y,{value:tt});Object.defineProperty(this,q,{value:Z});Object.defineProperty(this,j,{value:Q});Object.defineProperty(this,X,{writable:true,value:new WeakMap})}async highlight(t){await babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]();babelHelpers.classPrivateFieldLooseBase(this,q)[q](t);babelHelpers.classPrivateFieldLooseBase(this,X)[X].set(t,{animationStart:null,timeoutId:null,handler:null});babelHelpers.classPrivateFieldLooseBase(this,j)[j](t);const e=()=>babelHelpers.classPrivateFieldLooseBase(this,q)[q](t);T.Event.bind(window,"click",e);T.Event.bind(window,"keydown",e);const s=babelHelpers.classPrivateFieldLooseBase(this,X)[X].get(t);s.handler=e;s.timeoutId=setTimeout((()=>babelHelpers.classPrivateFieldLooseBase(this,q)[q](t)),J.ANIMATION_DURATION)}}function Q(t){T.Dom.addClass(t,[J.HIGHLIGHT_CLASS,J.ANIMATE_CLASS]);const e=babelHelpers.classPrivateFieldLooseBase(this,X)[X].get(t);if(e){e.animationStart=Date.now()}}function Z(t){const e=babelHelpers.classPrivateFieldLooseBase(this,X)[X].get(t);if(!e){return}T.Dom.removeClass(t,[J.HIGHLIGHT_CLASS,J.ANIMATE_CLASS]);if(e.timeoutId){clearTimeout(e.timeoutId)}if(e.handler){T.Event.unbind(window,"click",e.handler);T.Event.unbind(window,"keydown",e.handler)}babelHelpers.classPrivateFieldLooseBase(this,X)[X].delete(t)}function tt(){return new Promise((t=>setTimeout(t,0)))}J.HIGHLIGHT_CLASS="element-highlight";J.ANIMATE_CLASS="--animate";J.ANIMATION_DURATION=1500;const et={props:{taskId:{type:[Number,String],required:true},id:{type:[Number,String],required:true},isPreview:{type:Boolean,default:false}},emits:["update","addItem","removeItem","focus","blur","emptyBlur","show","hide"],data(){return{isHovered:false,scrollContainer:null}},computed:{...u.mapGetters({currentUserId:`${y.Model.Interface}/currentUserId`}),isEdit(){return T.Type.isNumber(this.taskId)&&this.taskId>0},task(){return this.$store.getters[`${y.Model.Tasks}/getById`](this.taskId)},checkLists(){return this.$store.getters[`${y.Model.CheckList}/getByIds`](this.task.checklist)},item(){return this.$store.getters[`${y.Model.CheckList}/getById`](this.id)},canSave(){if(!this.isEdit){return true}return this.task.rights.checklistSave===true},canAdd(){if(!this.isEdit){return true}return this.task.rights.checklistAdd===true},canEdit(){var t;if(!this.isEdit){return true}return this.canSave&&(this.task.rights.checklistEdit===true||((t=this.item.creator)==null?void 0:t.id)===this.currentUserId)},canCheckListToggle(){if(!this.isEdit){return true}return this.task.rights.checklistToggle===true},canModify(){if(this.canEdit===true){return true}return this.item.actions.modify===true},canRemove(){if(this.canEdit===true){return true}return this.item.actions.remove===true},canToggle(){if(this.canCheckListToggle===true){return true}return this.item.actions.toggle===true},hasAttachments(){return this.hasUsers},hasUsers(){return this.hasAccomplices||this.hasAuditors},hasAccomplices(){var t;return((t=this.accomplices)==null?void 0:t.length)>0},hasAuditors(){var t;return((t=this.auditors)==null?void 0:t.length)>0},accomplices(){return this.item.accomplices},auditors(){return this.item.auditors},files(){return this.item.attachments},textColor(){return this.completed?"var(--ui-color-base-4)":"var(--ui-color-base-1)"},groupMode(){var t;return((t=this.item.groupMode)==null?void 0:t.active)===true},groupModeSelected(){var t;return((t=this.item.groupMode)==null?void 0:t.selected)===true},completed(){var t;return(t=this.item.localCompleteState)!=null?t:this.item.isComplete}},methods:{...u.mapActions(y.Model.Interface,["addCheckListCompletionCallback"]),handleFocus(){this.$emit("focus",this.id)},handleBlur(){this.$emit("blur",this.id)},handleEmptyBlur(){this.$emit("emptyBlur",this.id)},updateCheckList(t,e){this.$emit("update",this.id);return this.$store.dispatch(`${y.Model.CheckList}/update`,{id:t,fields:e})},upsertCheckLists(t){this.$emit("update",this.id);return this.$store.dispatch(`${y.Model.CheckList}/upsertMany`,t)},updateTitle(t=""){this.$store.dispatch(`${y.Model.CheckList}/update`,{id:this.id,fields:{title:t}});this.$emit("update",this.id)},addItem(t){this.$emit("addItem",{id:this.id,sort:T.Type.isNumber(t)?t:null})},removeItem(){this.$emit("removeItem",this.id)},async complete(t){if(this.canToggle===false){return}await this.updateCheckList(this.id,{localCompleteState:t});const e=new Map;this.checkListManager.syncParentCompletionState(this.id,(async(t,s)=>{e.set(t,s);await this.updateCheckList(t,{localCompleteState:s.isComplete})}));this.$emit("update",this.id);const s=async()=>{await this.updateCheckList(this.id,{isComplete:t});e.forEach((async(t,e)=>{await this.updateCheckList(e,t);this.saveCompleteState(e,t.isComplete)}))};this.addCheckListCompletionCallback({id:this.id,callback:s});this.saveCompleteState(this.id,t)},saveCompleteState(t,e){if(!this.isPreview||!this.isEdit){return}if(e){void m.checkListService.complete(this.taskId,t)}else{void m.checkListService.renew(this.taskId,t)}},focusToItem(){var t;const e=this.$refs.item;const s=(t=this.$parent.$el)==null?void 0:t.closest("[data-list]");const i=T.Dom.getPosition(e);const n=T.Dom.getPosition(s);const r=i.top-n.top+s.scrollTop;s.scrollTo({top:r-200,behavior:"smooth"})}}};const st={name:"CheckListParentItem",components:{BIcon:L.BIcon,BMenu:c.BMenu,GrowingTextArea:f.GrowingTextArea,UserAvatarList:v.UserAvatarList,UserCheckbox:d.UserCheckbox,ProgressBar:h.ProgressBar},directives:{hint:C.hint},mixins:[et],inject:["setItemsRef"],props:{positionIndex:{type:Number,required:true}},emits:["startGroupMode","openCheckList"],setup(){return{Actions:M.Actions,Outline:M.Outline}},data(){return{isSticky:false,isMenuShown:false,menuRemoveSectionCode:"removeSection"}},computed:{menuOptions(){return{id:`check-list-parent-item-action-menu-${T.Text.getRandom()}`,bindElement:this.$refs.more.$el,minWidth:250,offsetLeft:-100,sections:[{code:this.menuRemoveSectionCode}],items:this.menuItems,targetContainer:document.body,closeByEsc:true}},menuItems(){const t={title:this.item.areCompletedCollapsed?this.loc("TASKS_V2_CHECK_LIST_ITEM_MENU_SHOW"):this.loc("TASKS_V2_CHECK_LIST_ITEM_MENU_HIDE"),icon:this.item.areCompletedCollapsed?M.Outline.OBSERVER:M.Outline.CROSSED_EYE,dataset:{id:`MenuProfileHide-${this.id}`},onClick:()=>{const t=!this.item.areCompletedCollapsed;void this.updateCheckList(this.id,{areCompletedCollapsed:t});this.toggleCompleted(this.id,t)}};const e={title:this.loc("TASKS_V2_CHECK_LIST_ITEM_MENU_GROUP"),icon:M.Outline.MULTICHOICE_ON,dataset:{id:`MenuProfileGroup-${this.id}`},onClick:()=>{if(this.isCollapsed(this.item)){this.toggleCollapse()}this.$emit("startGroupMode",this.id)}};const s={sectionCode:this.menuRemoveSectionCode,title:this.loc("TASKS_V2_CHECK_LIST_ITEM_MENU_EDIT"),icon:M.Outline.EDIT_L,dataset:{id:`MenuProfileEdit-${this.id}`},onClick:()=>{if(this.canEdit){this.$emit("openCheckList",this.id)}}};const i={sectionCode:this.menuRemoveSectionCode,design:"alert",title:this.loc("TASKS_V2_CHECK_LIST_ITEM_MENU_REMOVE"),icon:M.Outline.TRASHCAN,dataset:{id:`MenuProfileRemove-${this.id}`},onClick:this.removeItem.bind(this)};if(this.isPreview){return[t,this.canModify?s:null,this.canModify?i:null]}return[t,e,i]},itemIcon(){return this.completed?M.Outline.CHECK_L:M.Outline.CHECK_LIST},checkListStatus(){const t=this.loc("TASKS_V2_CHECK_LIST_STATUS_LABEL_NEW");return t.replace("#completed#",this.completedCount).replace("#total#",this.totalCount)},completedCount(){return this.checkLists.filter((t=>t.parentId===this.id&&(t.isComplete||t.localCompleteState))).length},totalCount(){return this.checkLists.filter((t=>t.parentId===this.id)).length},currentUserResponsible(){return this.currentUserId===this.task.responsibleId},currentUser(){return this.$store.getters[`${y.Model.Users}/getById`](this.currentUserId)},numberMyItems(){return this.checkListManager.findItemIdsWithUser(this.id,this.currentUserId).size},myFilterTooltip(){return()=>b.tooltip({text:this.myFilterActive?this.loc("TASKS_V2_CHECK_LIST_MY_FILTER_HINT_ALL"):this.loc("TASKS_V2_CHECK_LIST_MY_FILTER_HINT_MY"),popupOptions:{offsetLeft:this.$refs.myFilter.offsetWidth/2}})},myFilterActive(){return this.item.myFilterActive}},watch:{myFilterActive(t){this.handleMyFilter(t)}},created(){this.checkListManager=new U({computed:{checkLists:()=>this.checkLists}})},mounted(){var t;this.scrollContainer=(t=this.$parent.$el)==null?void 0:t.closest("[data-list]");if(this.setItemsRef){this.setItemsRef(this.id,this)}if(this.scrollContainer){T.Event.bind(this.scrollContainer,"scroll",this.handleScroll);void this.$nextTick(this.checkSticky);this.mutationObserver=new MutationObserver((()=>{this.checkSticky()}));this.mutationObserver.observe(this.scrollContainer,{childList:true,subtree:true})}},beforeUnmount(){if(this.scrollContainer){T.Event.unbind(this.scrollContainer,"scroll",this.handleScroll)}if(this.mutationObserver){this.mutationObserver.disconnect()}if(this.setItemsRef){this.setItemsRef(this.id,null)}},methods:{handleScroll(){this.checkSticky()},handleTextClick(){if(this.isPreview&&this.canModify){this.$emit("openCheckList",this.id)}},handleMyFilter(t){const e=this.checkListManager.findItemIdsWithUser(this.id,this.currentUserId);this.$store.dispatch(`${y.Model.CheckList}/update`,{id:this.id,fields:{myFilterActive:t}});if(t===true){const t=this.checkListManager.getAllChildren(this.id).filter((t=>!e.has(t.id))).map((t=>t.id));this.checkListManager.hideItems(t,(t=>this.upsertCheckLists(t)))}else{const t=this.checkListManager.getAllChildren(this.id).map((t=>t.id));this.checkListManager.showItems(t,(t=>this.upsertCheckLists(t)))}},checkSticky(){if(!this.scrollContainer||!this.$refs.item){return}const t=this.$refs.item.getBoundingClientRect();const e=this.scrollContainer.getBoundingClientRect();this.isSticky=t.top<=e.top+t.height/2},showMenu(){this.isMenuShown=true},toggleCollapse(){const t=!this.isCollapsed(this.item);if(this.isPreview&&this.isEdit){if(t===true){void m.checkListService.collapse(this.taskId,this.id)}else{void m.checkListService.expand(this.taskId,this.id)}}this.$store.dispatch(`${y.Model.CheckList}/update`,{id:this.id,fields:{localCollapsedState:t}})},isCollapsed(t){return this.checkListManager.isItemCollapsed(t,this.isPreview,this.positionIndex)},toggleCompleted(t,e){this.checkListManager.getAllCompletedChildren(t).forEach((t=>{if(e===false){this.checkListManager.showItems([t.id],(t=>this.upsertCheckLists(t)))}else{this.checkListManager.hideItems([t.id],(t=>this.upsertCheckLists(t)))}}))}},template:`\n\t\t<div\n\t\t\tref="item"\n\t\t\tclass="check-list-widget-parent-item"\n\t\t\t:class="{\n\t\t\t\t'--complete': completed,\n\t\t\t\t'--collapsed': isCollapsed(item),\n\t\t\t\t'--preview': isPreview,\n\t\t\t\t'--editable': canModify,\n\t\t\t}"\n\t\t\t:data-id="id"\n\t\t\t:data-parent="id"\n\t\t>\n\t\t\t<div class="check-list-widget-parent-item-label-container">\n\t\t\t\t<BIcon :name="itemIcon"/>\n\t\t\t</div>\n\t\t\t<div class="check-list-widget-parent-item-title-container">\n\t\t\t\t<GrowingTextArea\n\t\t\t\t\tref="growingTextArea"\n\t\t\t\t\tclass="check-list-widget-parent-item-title"\n\t\t\t\t\t:data-check-list-id="'check-list-parent-item-title-' + id"\n\t\t\t\t\t:modelValue="item.title"\n\t\t\t\t\t:placeholder="loc('TASKS_V2_CHECK_LIST_ITEM_PLACEHOLDER')"\n\t\t\t\t\t:readonly="groupMode || isPreview"\n\t\t\t\t\t:fontColor="textColor"\n\t\t\t\t\t:fontSize="17"\n\t\t\t\t\t:lineHeight="20"\n\t\t\t\t\t:fontWeight="500"\n\t\t\t\t\t@click="handleTextClick"\n\t\t\t\t\t@update:modelValue="updateTitle"\n\t\t\t\t\t@input="updateTitle"\n\t\t\t\t\t@focus="handleFocus"\n\t\t\t\t\t@emptyFocus="focusToItem"\n\t\t\t\t\t@blur="handleBlur"\n\t\t\t\t\t@emptyBlur="handleEmptyBlur"\n\t\t\t\t/>\n\t\t\t\t<template v-if="hasAttachments">\n\t\t\t\t\t<div class="check-list-widget-item-attach --parent">\n\t\t\t\t\t\t<div v-if="hasUsers" class="check-list-widget-item-attach-users">\n\t\t\t\t\t\t\t<div v-if="hasAccomplices" class="check-list-widget-item-attach-users-list">\n\t\t\t\t\t\t\t\t<BIcon :name="Outline.GROUP"/>\n\t\t\t\t\t\t\t\t<UserAvatarList :users="accomplices"/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div v-if="hasAuditors" class="check-list-widget-item-attach-users-list">\n\t\t\t\t\t\t\t\t<BIcon :name="Outline.OBSERVER"/>\n\t\t\t\t\t\t\t\t<UserAvatarList :users="auditors"/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<div class="check-list-widget-parent-item-title-status">\n\t\t\t\t\t<div class="check-list-widget-parent-item-title-status-label">\n\t\t\t\t\t\t{{ checkListStatus }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<ProgressBar\n\t\t\t\t\t\t:totalValue="totalCount"\n\t\t\t\t\t\t:completedValue="completedCount"\n\t\t\t\t\t\t:width="56"\n\t\t\t\t\t\t:height="5"\n\t\t\t\t\t\tcolor="var(--ui-color-accent-main-primary-alt)"\n\t\t\t\t\t\tbgColor="var(--ui-color-base-7)"\n\t\t\t\t\t\t:borderRadius="30"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="check-list-widget-parent-item-action">\n\t\t\t\t<div class="check-list-widget-parent-item-main-action">\n\t\t\t\t\t<div\n\t\t\t\t\t\tref="myFilter"\n\t\t\t\t\t\tclass="check-list-widget-parent-item-main-action-filter"\n\t\t\t\t\t\tv-hint="myFilterTooltip"\n\t\t\t\t\t>\n\t\t\t\t\t\t<UserCheckbox\n\t\t\t\t\t\t\tv-if="!currentUserResponsible && numberMyItems > 0"\n\t\t\t\t\t\t\t:init-user="currentUser"\n\t\t\t\t\t\t\t:number="numberMyItems"\n\t\t\t\t\t\t\tv-model:checked="item.myFilterActive"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="check-list-widget-parent-item-main-action-actions">\n\t\t\t\t\t\t<BIcon ref="more" :name="Outline.MORE_L" @click="showMenu" />\n\t\t\t\t\t\t<BIcon\n\t\t\t\t\t\t\t:name="isCollapsed(item) ? Actions.CHEVRON_DOWN : Actions.CHEVRON_UP"\n\t\t\t\t\t\t\t@click="toggleCollapse()"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-if="isSticky && !isPreview" class="check-list-widget-parent-item-empty"></div>\n\t\t\t</div>\n\t\t\t<BMenu v-if="isMenuShown" :options="menuOptions" @close="isMenuShown = false"/>\n\t\t</div>\n\t`};const it={name:"CheckListChildItem",components:{BIcon:L.BIcon,BLine:p.BLine,GrowingTextArea:f.GrowingTextArea,UserAvatarList:v.UserAvatarList,UserFieldWidgetComponent:I.UserFieldWidgetComponent},mixins:[et],inject:["setItemsRef"],props:{itemOffset:{type:String,default:"0"}},emits:["toggleGroupModeSelected"],setup(t){const e=B.fileService.get(t.id,B.EntityTypes.CheckListItem,{parentEntityId:t.taskId});return{Outline:M.Outline,fileService:e,uploaderAdapter:e.getAdapter()}},data(){return{uploadingFiles:this.fileService.getFiles(),filesLoading:false}},computed:{widgetOptions(){return{isEmbedded:true,withControlPanel:false,canCreateDocuments:false,tileWidgetOptions:{compact:true,hideDropArea:true,enableDropzone:false,readonly:this.isPreview,autoCollapse:false,removeFromServer:!this.isEdit}}},hasAttachments(){return this.hasUsers||this.hasFilesAttach},hasFilesAttach(){return this.hasFiles||this.fileService.isUploading()||this.fileService.hasUploadingError()},hasFiles(){return this.filesNumber>0},filesNumber(){if(!this.files){return 0}return this.files.length},hasTrashcanIcon(){return this.isHovered&&!this.item.panelIsShown&&!this.groupMode&&!this.isPreview},readOnly(){return this.isPreview}},created(){if(this.hasFilesAttach){void this.loadFiles()}this.checkListManager=new U({computed:{checkLists:()=>this.checkLists}})},mounted(){if(this.setItemsRef){this.setItemsRef(this.id,this)}},beforeUnmount(){if(this.setItemsRef){this.setItemsRef(this.id,null)}},methods:{toggleGroupModeSelected(){this.$store.dispatch(`${y.Model.CheckList}/update`,{id:this.id,fields:{groupMode:{active:true,selected:!this.groupModeSelected}}});this.$emit("toggleGroupModeSelected",this.id)},async loadFiles(){var t;this.filesLoading=true;const e=(t=this.files)==null?void 0:t.map((t=>{var e;return(e=t==null?void 0:t.id)!=null?e:t}));await this.fileService.list(e!=null?e:[]);this.filesLoading=false},handleEnter(){if(!this.item){return}this.addItem(this.item.sortIndex+1)},handleClick(t){const e=this.$refs["files-widget"];if(this.isClickInsideFilesWidget(e==null?void 0:e.$el,t.target)){return}if(this.groupMode){this.toggleGroupModeSelected()}if(this.isPreview){this.complete(!this.completed)}},isClickInsideFilesWidget(t,e){if(!t||!e){return false}const s=["ui-tile-uploader-items"];const i=t.contains(e);if(!i){return false}const n=s.some((t=>T.Dom.hasClass(e,t)));return!n}},template:`\n\t\t<div\n\t\t\tref="item"\n\t\t\tclass="check-list-widget-child-item"\n\t\t\t:class="{\n\t\t\t\t'--complete': completed,\n\t\t\t\t'--group-mode': groupMode,\n\t\t\t\t'--group-mode-selected': groupModeSelected,\n\t\t\t\t'--preview': isPreview,\n\t\t\t\t'--toggleable': canToggle,\n\t\t\t}"\n\t\t\t:data-id="id"\n\t\t\t:style="{ marginLeft: itemOffset }"\n\t\t\t@mouseover="isHovered = true"\n\t\t\t@mouseleave="isHovered = false"\n\t\t\t@click="handleClick"\n\t\t>\n\t\t\t<div class="check-list-widget-child-item-base">\n\t\t\t\t<label\n\t\t\t\t\tclass="check-list-widget-child-item-checkbox"\n\t\t\t\t\t:class="{'--important': !item.isImportant}"\n\t\t\t\t>\n\t\t\t\t\t<input\n\t\t\t\t\t\tref="checkbox"\n\t\t\t\t\t\ttype="checkbox"\n\t\t\t\t\t\t:checked="completed"\n\t\t\t\t\t\t:disabled="!canToggle || groupMode"\n\t\t\t\t\t\t@click.stop="complete(!completed)"\n\t\t\t\t\t>\n\t\t\t\t</label>\n\t\t\t\t<div\n\t\t\t\t\tv-if="item.isImportant"\n\t\t\t\t\tclass="check-list-widget-child-item-important"\n\t\t\t\t>\n\t\t\t\t\t<BIcon :name="Outline.FIRE_SOLID" :hoverable="false"/>\n\t\t\t\t</div>\n\t\t\t\t<GrowingTextArea\n\t\t\t\t\tref="growingTextArea"\n\t\t\t\t\tclass="check-list-widget-child-item-title"\n\t\t\t\t\t:data-check-list-id="'check-list-child-item-title-' + item.id"\n\t\t\t\t\t:modelValue="item.title"\n\t\t\t\t\t:placeholder="loc('TASKS_V2_CHECK_LIST_ITEM_PLACEHOLDER')"\n\t\t\t\t\t:readonly="groupMode || isPreview"\n\t\t\t\t\t:fontColor="textColor"\n\t\t\t\t\t:fontSize="15"\n\t\t\t\t\t:lineHeight="20"\n\t\t\t\t\t@update:modelValue="updateTitle"\n\t\t\t\t\t@input="updateTitle"\n\t\t\t\t\t@focus="handleFocus"\n\t\t\t\t\t@blur="handleBlur"\n\t\t\t\t\t@emptyBlur="handleEmptyBlur"\n\t\t\t\t\t@emptyFocus="focusToItem"\n\t\t\t\t\t@enterBlur="handleEnter"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tv-if="hasTrashcanIcon"\n\t\t\t\t\tclass="check-list-widget-child-item-action"\n\t\t\t\t\t@click="removeItem"\n\t\t\t\t>\n\t\t\t\t\t<BIcon :name="Outline.TRASHCAN"/>\n\t\t\t\t</div>\n\t\t\t\t<div v-else-if="groupMode" class="check-list-widget-child-item-action-checkbox">\n\t\t\t\t\t<input\n\t\t\t\t\t\tref="checkbox"\n\t\t\t\t\t\ttype="checkbox"\n\t\t\t\t\t\t:checked="groupModeSelected"\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t\t<div v-else class="check-list-widget-child-item-action-stub"></div>\n\t\t\t</div>\n\t\t\t<template v-if="hasAttachments">\n\t\t\t\t<div class="check-list-widget-item-attach">\n\t\t\t\t\t<div v-if="hasUsers" class="check-list-widget-item-attach-users">\n\t\t\t\t\t\t<div v-if="hasAccomplices" class="check-list-widget-item-attach-users-list">\n\t\t\t\t\t\t\t<BIcon :name="Outline.GROUP"/>\n\t\t\t\t\t\t\t<UserAvatarList :users="accomplices"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-if="hasAuditors" class="check-list-widget-item-attach-users-list">\n\t\t\t\t\t\t\t<BIcon :name="Outline.OBSERVER"/>\n\t\t\t\t\t\t\t<UserAvatarList :users="auditors"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if="hasFilesAttach" class="check-list-widget-item-attach-files">\n\t\t\t\t\t\t<div class="check-list-widget-item-attach-files-list">\n\t\t\t\t\t\t\t<template v-if="filesLoading">\n\t\t\t\t\t\t\t\t<div class="check-list-widget-item-attach-files-list-skeleton">\n\t\t\t\t\t\t\t\t\t<BLine\n\t\t\t\t\t\t\t\t\t\tv-for="index in filesNumber"\n\t\t\t\t\t\t\t\t\t\t:key="index"\n\t\t\t\t\t\t\t\t\t\t:width="114"\n\t\t\t\t\t\t\t\t\t\t:height="90"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t<UserFieldWidgetComponent\n\t\t\t\t\t\t\t\t\tref="files-widget"\n\t\t\t\t\t\t\t\t\t:uploaderAdapter="uploaderAdapter"\n\t\t\t\t\t\t\t\t\t:widgetOptions="widgetOptions"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\t`};const nt={name:"CheckListAddItem",components:{BIcon:L.BIcon},props:{isPreview:{type:Boolean,default:false}},emits:["addItem"],setup(){return{Outline:M.Outline}},template:`\n\t\t<div\n\t\t\tclass="check-list-widget-add-item"\n\t\t\t:class="{'--preview': isPreview}"\n\t\t\t@mousedown="$emit('addItem')"\n\t\t>\n\t\t\t<div class="check-list-widget-add-item-icon">\n\t\t\t\t<BIcon :name="Outline.PLUS_L"/>\n\t\t\t</div>\n\t\t\t<div class="check-list-widget-add-item-title">\n\t\t\t\t{{ loc('TASKS_V2_CHECK_LIST_ITEM_ADD_BTN') }}\n\t\t\t</div>\n\t\t</div>\n\t`};const rt={name:"CheckListGroupCompletedList",components:{BIcon:L.BIcon},props:{totalCompletedParents:{type:Number,required:true}},setup(){return{Actions:L.Actions,Outline:L.Outline}},computed:{completedParentsLabel(){return this.loc("TASKS_V2_CHECK_LIST_PREVIEW_COMPLETED",{"#number#":this.totalCompletedParents})}},template:`\n\t\t<div class="check-list-widget-group-completed-list">\n\t\t\t<div class="check-list-widget-group-completed-list-icon">\n\t\t\t\t<BIcon :name="Outline.CHECK_L"/>\n\t\t\t</div>\n\t\t\t<div class="check-list-widget-group-completed-list-title">\n\t\t\t\t{{ completedParentsLabel }}\n\t\t\t</div>\n\t\t\t<div class="check-list-widget-group-completed-list-action">\n\t\t\t\t<BIcon :name="Actions.CHEVRON_RIGHT" />\n\t\t\t</div>\n\t\t</div>\n\t`};const ot={name:"CheckListWidget",components:{CheckListParentItem:st,CheckListChildItem:it,CheckListAddItem:nt,CheckListGroupCompletedList:rt},props:{taskId:{type:[Number,String],required:true},checkListId:{type:[Number,String],default:0},parentId:{type:[Number,String],default:0},isPreview:{type:Boolean,default:false}},emits:["show","update","addItem","addItemFromBtn","removeItem","focus","blur","emptyBlur","startGroupMode","toggleGroupModeSelected","openCheckList"],data(){return{}},computed:{...u.mapGetters({currentUserId:`${y.Model.Interface}/currentUserId`,disableCheckListAnimations:`${y.Model.Interface}/disableCheckListAnimations`}),task(){return this.$store.getters[`${y.Model.Tasks}/getById`](this.taskId)},isEdit(){return T.Type.isNumber(this.taskId)&&this.taskId>0},checkLists(){return this.$store.getters[`${y.Model.CheckList}/getByIds`](this.task.checklist)},parentCheckLists(){return this.checkLists.filter((t=>{if(t.parentId!==0||t.hidden){return false}if(this.isEdit&&!this.isPreview&&!this.canEditCheckList(t)){return false}return!(this.isPreview&&t.isComplete)})).sort(((t,e)=>{if(t.isComplete===e.isComplete){return t.sortIndex-e.sortIndex}return t.isComplete?1:-1}))},totalCompletedParents(){return this.checkLists.filter((t=>t.parentId===0&&t.isComplete)).length},siblings(){return this.checkLists.filter((t=>t.parentId===this.parentId)).sort(((t,e)=>t.sortIndex-e.sortIndex))},canAddItem(){if(!this.isEdit){return true}return this.task.rights.checklistAdd===true}},created(){this.checkListManager=new U({computed:{checkLists:()=>this.checkLists}})},mounted(){if(this.checkListManager.getItem(this.checkListId)){var t;this.scrollContainer=(t=this.$root.$el)==null?void 0:t.querySelector(["[data-list]"]);const e=this.checkListManager.getChildWithEmptyTitle(this.checkListId);const s=!e;const i=s?this.checkListId:e.id;const n=s?0:140;const r=this.scrollContainer.querySelector([`[data-id="${i}"]`]);setTimeout((()=>{if(s){const t=this.scrollContainer.querySelector([`[data-parent-container="${this.checkListId}"]`]);if(t){void(new J).highlight(t)}}if(r){this.scrollContainer.scrollTop=r.offsetTop-n}}),0)}this.$emit("show")},methods:{getItemOffset(t){if(t.parentId===0){return"0"}const e=this.checkListManager.getItemLevel(t);if(e===1){return"0"}return`${(e-1)*12}px`},getChildren(t){return this.checkListManager.getAllChildren(t.id).filter((t=>!t.hidden))},isCollapsed(t,e){return this.checkListManager.isItemCollapsed(t,this.isPreview,e)},getFirstCompletedCheckList(){const t=this.checkLists.filter((t=>t.parentId===0&&t.isComplete===true)).sort(((t,e)=>t.sortIndex-e.sortIndex));return t[0]},showFirstCompletedCheckList(){const t=this.getFirstCompletedCheckList();this.$emit("openCheckList",t.id)},canEditCheckList(t){if(!t.creator){return true}return this.task.rights.checklistEdit===true||t.creator.id===this.currentUserId}},template:`\n\t\t<div class="check-list-widget-container">\n\t\t\t<TransitionGroup\n\t\t\t\t:css="!disableCheckListAnimations"\n\t\t\t\tname="check-list"\n\t\t\t\tmode="out-in"\n\t\t\t\ttag="ul"\n\t\t\t\tclass="check-list-widget --parent"\n\t\t\t\t:class="{'--preview': isPreview}"\n\t\t\t>\n\t\t\t\t<li\n\t\t\t\t\tv-for="(parentItem, parentItemIndex) in parentCheckLists"\n\t\t\t\t\t:key="parentItem.id"\n\t\t\t\t\tclass="check-list-widget-item --parent"\n\t\t\t\t\t:class="{\n\t\t\t\t\t\t'--preview': isPreview,\n\t\t\t\t\t\t'--collapsed': isCollapsed(parentItem, parentItemIndex),\n\t\t\t\t\t\t'--hidden': parentItem.hidden,\n\t\t\t\t\t}"\n\t\t\t\t\t:data-parent-container="parentItem.id"\n\t\t\t\t>\n\t\t\t\t\t<CheckListParentItem\n\t\t\t\t\t\t:id="parentItem.id"\n\t\t\t\t\t\t:taskId="taskId"\n\t\t\t\t\t\t:isPreview="isPreview"\n\t\t\t\t\t\t:positionIndex="parentItemIndex"\n\t\t\t\t\t\t@update="(id) => $emit('update', id)"\n\t\t\t\t\t\t@removeItem="(id) => $emit('removeItem', id)"\n\t\t\t\t\t\t@focus="(id) => $emit('focus', id)"\n\t\t\t\t\t\t@blur="(id) => $emit('blur', id)"\n\t\t\t\t\t\t@emptyBlur="(id) => $emit('emptyBlur', id)"\n\t\t\t\t\t\t@startGroupMode="(id) => $emit('startGroupMode', id)"\n\t\t\t\t\t\t@openCheckList="(id) => $emit('openCheckList', id)"\n\t\t\t\t\t/>\n\t\t\t\t\t<TransitionGroup\n\t\t\t\t\t\t:css="!disableCheckListAnimations"\n\t\t\t\t\t\tname="check-list"\n\t\t\t\t\t\tmode="out-in"\n\t\t\t\t\t\ttag="ul"\n\t\t\t\t\t\tclass="check-list-widget"\n\t\t\t\t\t>\n\t\t\t\t\t\t<li\n\t\t\t\t\t\t\tv-if="!isCollapsed(parentItem, parentItemIndex)"\n\t\t\t\t\t\t\tv-for="childItem in getChildren(parentItem)"\n\t\t\t\t\t\t\t:key="childItem.id"\n\t\t\t\t\t\t\tclass="check-list-widget-item"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<CheckListChildItem\n\t\t\t\t\t\t\t\t:id="childItem.id"\n\t\t\t\t\t\t\t\t:taskId="taskId"\n\t\t\t\t\t\t\t\t:itemOffset="getItemOffset(childItem)"\n\t\t\t\t\t\t\t\t:isPreview="isPreview"\n\t\t\t\t\t\t\t\t@update="(id) => $emit('update', id)"\n\t\t\t\t\t\t\t\t@addItem="(data) => $emit('addItem', data)"\n\t\t\t\t\t\t\t\t@removeItem="(id) => $emit('removeItem', id)"\n\t\t\t\t\t\t\t\t@focus="(id) => $emit('focus', id)"\n\t\t\t\t\t\t\t\t@blur="(id) => $emit('blur', id)"\n\t\t\t\t\t\t\t\t@emptyBlur="(id) => $emit('emptyBlur', id)"\n\t\t\t\t\t\t\t\t@toggleGroupModeSelected="(id) => $emit('toggleGroupModeSelected', id)"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li\n\t\t\t\t\t\t\tv-if="!isCollapsed(parentItem, parentItemIndex) && canAddItem"\n\t\t\t\t\t\t\tkey="add-item"\n\t\t\t\t\t\t\tclass="check-list-widget-item"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<CheckListAddItem\n\t\t\t\t\t\t\t\t:isPreview="isPreview"\n\t\t\t\t\t\t\t\t@addItem="$emit('addItemFromBtn', parentItem.id)"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t</TransitionGroup>\n\t\t\t\t</li>\n\t\t\t\t<li\n\t\t\t\t\tv-if="isPreview && totalCompletedParents > 0"\n\t\t\t\t\tkey="completed-list"\n\t\t\t\t\tclass="check-list-widget-item --completed-list"\n\t\t\t\t>\n\t\t\t\t\t<CheckListGroupCompletedList\n\t\t\t\t\t\t:totalCompletedParents="totalCompletedParents"\n\t\t\t\t\t\t@click="showFirstCompletedCheckList"\n\t\t\t\t\t/>\n\t\t\t\t</li>\n\t\t\t</TransitionGroup>\n\t\t</div>\n\t`};const at=Object.freeze({Important:"important",Attachments:"attachments",Movement:"movement",Accomplice:"accomplice",Auditor:"auditor",Forward:"forward",Delete:"delete",Cancel:"cancel"});const lt=Object.freeze({SetImportant:"setImportant",AttachFile:"attachFile",MoveRight:"moveRight",MoveLeft:"moveLeft",AssignAccomplice:"assignAccomplice",AssignAuditor:"assignAuditor",Forward:"forward",Delete:"delete",Cancel:"cancel"});const ct=Object.freeze({defaultSections:[{name:at.Important,items:[{icon:M.Outline.FIRE,activeIcon:M.Outline.FIRE_SOLID,action:lt.SetImportant,hint:"TASKS_V2_CHECK_LIST_ITEM_IMPORTANT_HINT",className:"--important",hoverable:false}]},{name:at.Attachments,items:[{icon:M.Outline.ATTACH,action:lt.AttachFile,hint:"TASKS_V2_CHECK_LIST_ITEM_ATTACH_HINT"}]},{name:at.Movement,items:[{icon:M.Outline.POINT_RIGHT,action:lt.MoveRight,hint:"TASKS_V2_CHECK_LIST_ITEM_MOVE_RIGHT_HINT"},{icon:M.Outline.POINT_LEFT,action:lt.MoveLeft,hint:"TASKS_V2_CHECK_LIST_ITEM_MOVE_LEFT_HINT"}]},{name:at.Accomplice,items:[{icon:M.Outline.PERSON,action:lt.AssignAccomplice,hint:"TASKS_V2_CHECK_LIST_ITEM_ACCOMPLICE_HINT"}]},{name:at.Auditor,items:[{icon:M.Outline.OBSERVER,action:lt.AssignAuditor,hint:"TASKS_V2_CHECK_LIST_ITEM_AUDITOR_HINT"}]},{name:at.Forward,items:[{icon:M.Outline.FORWARD,action:lt.Forward,hint:"TASKS_V2_CHECK_LIST_ITEM_FORWARD_HINT"}]},{name:at.Delete,items:[{icon:M.Outline.TRASHCAN,action:lt.Delete,hint:"TASKS_V2_CHECK_LIST_ITEM_REMOVE_HINT"}]},{name:at.Cancel,items:[{icon:M.Outline.CROSS_L,action:lt.Cancel,hint:"TASKS_V2_CHECK_LIST_ITEM_CANCEL_HINT"}]}]});const dt={name:"CheckListItemPanel",components:{BIcon:L.BIcon},directives:{hint:C.hint},props:{taskId:{type:[Number,String],required:true},currentItem:{type:Object,default:()=>null}},emits:["action"],data(){return{currentHintElement:null,currentHintText:""}},computed:{task(){return this.$store.getters[`${y.Model.Tasks}/getById`](this.taskId)},checkLists(){return this.$store.getters[`${y.Model.CheckList}/getByIds`](this.task.checklist)},sections(){return ct.defaultSections.filter((t=>this.visibleSections.includes(t.name))).map((t=>({...t,items:t.items.filter((t=>this.visibleActions.includes(t.action))).map((t=>{var e;return{...t,disabled:this.isItemDisabled(t),active:this.isItemActive(t),hoverable:(e=t.hoverable)!=null?e:true}}))}))).filter((t=>t.items.length>0))},tooltip(){return()=>{var t,e;return{text:this.currentHintText,timeout:500,popupOptions:{className:"tasks-hint",background:"var(--ui-color-bg-content-inapp)",darkMode:false,offsetLeft:-((t=(e=this.currentHintElement)==null?void 0:e.offsetWidth)!=null?t:0),padding:6,bindOptions:{forceBindPosition:true,forceTop:true,position:"top"},targetContainer:document.body}}}},visibleSections(){return ct.defaultSections.map((t=>t.name))},visibleActions(){if(!this.currentItem){return[]}let t=[lt.SetImportant,lt.MoveRight,lt.MoveLeft,lt.AssignAccomplice,lt.AssignAuditor,lt.Forward,lt.Delete];if(this.itemGroupModeSelected){t.push(lt.Cancel)}else{t.push(lt.AttachFile)}if(this.currentItem.parentId===0){t=[lt.AssignAccomplice,lt.AssignAuditor]}const e=g.Core.getParams().limits;const s=new Set([lt.AssignAccomplice,lt.AssignAuditor]);return t.filter((t=>{const i=s.has(t)&&!e.stakeholders;return!i}))},disabledActions(){if(!this.currentItem){return[]}const t=[];const e=this.checkListManager.getItemLevel(this.currentItem);const s=this.currentItem.actions.modify===true;const i=this.currentItem.actions.remove===true;const n={[lt.SetImportant]:()=>s===false,[lt.AttachFile]:()=>s===false,[lt.MoveLeft]:()=>e===1||s===false,[lt.MoveRight]:()=>e===5||this.currentItem.sortIndex===0||s===false,[lt.AssignAccomplice]:()=>s===false,[lt.AssignAuditor]:()=>s===false,[lt.Forward]:()=>s===false||this.currentItem.title==="",[lt.Delete]:()=>i===false};Object.entries(n).forEach((([e,s])=>{if(s()){t.push(e)}}));return t},activeActions(){if(!this.currentItem){return[]}const t=[];if(this.currentItem.isImportant){t.push(lt.SetImportant)}return t},itemGroupModeSelected(){var t;if(!this.currentItem){return false}return((t=this.currentItem.groupMode)==null?void 0:t.selected)===true}},created(){this.checkListManager=new U({computed:{checkLists:()=>this.checkLists}})},methods:{isItemDisabled(t){var e;return(e=t.disabled)!=null?e:this.disabledActions.includes(t.action)},isItemActive(t){var e;return(e=t.active)!=null?e:this.activeActions.includes(t.action)},getItemIcon(t){return t.active&&t.activeIcon?t.activeIcon:t.icon},handleItemClick(t,e){if(!e.disabled){this.$emit("action",{action:e.action,node:t.currentTarget})}},handleItemMouseEnter(t,e){this.currentHintElement=t.currentTarget;this.currentHintText=e.hint?this.loc(e.hint):null}},template:`\n\t\t<div v-if="sections.length > 0" class="check-list-widget-item-panel" @mousedown.prevent>\n\t\t\t<template v-for="section in sections" :key="section.name">\n\t\t\t\t<div class="check-list-widget-item-panel-section" :class="'--' + section.name">\n\t\t\t\t\t<template v-for="item in section.items" :key="item.action" >\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-hint="tooltip"\n\t\t\t\t\t\t\tclass="check-list-widget-item-panel-section-item"\n\t\t\t\t\t\t\t:class="{\n\t\t\t\t\t\t\t\t'--disabled': item.disabled,\n\t\t\t\t\t\t\t\t'--active': item.active,\n\t\t\t\t\t\t\t\t[item.className]: Boolean(item.className),\n\t\t\t\t\t\t\t}"\n\t\t\t\t\t\t\t@click="handleItemClick($event, item)"\n\t\t\t\t\t\t\t@mouseenter="handleItemMouseEnter($event, item)"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<BIcon :name="getItemIcon(item)" :hoverable="item.hoverable"/>\n\t\t\t\t\t\t\t<span v-if="item.label">{{ loc(item.label) }}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\t`};var ht=babelHelpers.classPrivateFieldLooseKey("interval");var ut=babelHelpers.classPrivateFieldLooseKey("timerValue");var mt=babelHelpers.classPrivateFieldLooseKey("counter");var pt=babelHelpers.classPrivateFieldLooseKey("content");var It=babelHelpers.classPrivateFieldLooseKey("balloonWithTimer");var ft=babelHelpers.classPrivateFieldLooseKey("startTimer");var vt=babelHelpers.classPrivateFieldLooseKey("handleCancelClick");var kt=babelHelpers.classPrivateFieldLooseKey("handleClosingBalloon");var Ct=babelHelpers.classPrivateFieldLooseKey("getBalloonContent");class Lt extends S.EventEmitter{constructor(t){super();Object.defineProperty(this,Ct,{value:wt});Object.defineProperty(this,kt,{value:St});Object.defineProperty(this,vt,{value:bt});Object.defineProperty(this,ft,{value:gt});Object.defineProperty(this,ht,{writable:true,value:null});Object.defineProperty(this,ut,{writable:true,value:5});Object.defineProperty(this,mt,{writable:true,value:5});Object.defineProperty(this,pt,{writable:true,value:""});Object.defineProperty(this,It,{writable:true,value:void 0});this.setEventNamespace("Tasks.V2.CheckList.CheckListNotifier");babelHelpers.classPrivateFieldLooseBase(this,pt)[pt]=t.content;babelHelpers.classPrivateFieldLooseBase(this,ut)[ut]=T.Type.isUndefined(t.timerValue)?babelHelpers.classPrivateFieldLooseBase(this,ut)[ut]:t.timerValue}showBalloonWithTimer(){babelHelpers.classPrivateFieldLooseBase(this,mt)[mt]=babelHelpers.classPrivateFieldLooseBase(this,ut)[ut];babelHelpers.classPrivateFieldLooseBase(this,It)[It]=w.UI.Notification.Center.notify({id:`check-list-balloon-${T.Text.getRandom()}`,content:babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct](),actions:[{title:T.Loc.getMessage("TASKS_V2_CHECK_LIST_BALLOON_CANCEL"),events:{mouseup:babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].bind(this)}}],events:{onClose:babelHelpers.classPrivateFieldLooseBase(this,kt)[kt].bind(this)}});babelHelpers.classPrivateFieldLooseBase(this,ft)[ft]()}stopTimer(){this.emit("complete",true);babelHelpers.classPrivateFieldLooseBase(this,It)[It].close()}}function gt(){babelHelpers.classPrivateFieldLooseBase(this,ht)[ht]=setInterval((()=>{babelHelpers.classPrivateFieldLooseBase(this,mt)[mt]--;babelHelpers.classPrivateFieldLooseBase(this,It)[It].update({content:babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct]()});if(babelHelpers.classPrivateFieldLooseBase(this,mt)[mt]<=0){this.emit("complete",true);babelHelpers.classPrivateFieldLooseBase(this,It)[It].close()}}),1e3)}function bt(){babelHelpers.classPrivateFieldLooseBase(this,It)[It].close()}function St(){clearInterval(babelHelpers.classPrivateFieldLooseBase(this,ht)[ht]);this.emit("complete",false)}function wt(){return babelHelpers.classPrivateFieldLooseBase(this,pt)[pt].replace("#countdown#",babelHelpers.classPrivateFieldLooseBase(this,mt)[mt])}const Tt=Object.freeze({Sheet:"sheet",Popup:"popup",Preview:"preview"});const Mt={name:"TaskCheckList",components:{CheckListWidget:ot,CheckListItemPanel:dt,CheckListStub:_,UiButton:o.Button,BIcon:L.BIcon,BMenu:c.BMenu},provide(){return{setItemsRef:this.setItemsRef,getItemsRef:this.getItemsRef}},props:{taskId:{type:[Number,String],required:true},isAutonomous:{type:Boolean,default:false},isPreview:{type:Boolean,default:false},isComponentShown:{type:Boolean,default:true},checkListId:{type:[Number,String],default:0},isShown:{type:Boolean,default:false},getBindElement:{type:Function,default:null},getTargetContainer:{type:Function,default:null}},emits:["show","close","resize","open"],setup(){return{resizeObserver:null,AirButtonStyle:o.AirButtonStyle,ButtonSize:o.ButtonSize,ButtonIcon:o.ButtonIcon,Outline:M.Outline}},data(){return{itemPanelIsShown:false,checkListWasUpdated:false,lastUpdatedCheckListId:0,itemId:null,itemPanelStyles:{top:"0",display:"flex"},isItemPanelFreeze:false,itemPanelTopOffset:this.isAutonomous?5:2,itemPanelTopLimit:this.isAutonomous?450:700,itemsRefs:{},isForwardMenuShown:false,forwardMenuSectionCode:"createSection",forwardBindElement:null,shownPopups:new Set,notifiers:new Map}},computed:{...u.mapGetters({deletingCheckListIds:`${y.Model.Interface}/deletingCheckListIds`,checkListCompletionCallback:`${y.Model.Interface}/checkListCompletionCallback`}),componentName(){return{[Tt.Sheet]:H,[Tt.Popup]:F,[Tt.Preview]:W}[this.context]},context(){return{[true]:Tt.Sheet,[this.isAutonomous]:Tt.Popup,[this.isPreview]:Tt.Preview}.true},contextClass(){return`--${this.context}`},componentShown(){if(this.isPreview){return this.isComponentShown}return true},isEdit(){return T.Type.isNumber(this.taskId)&&this.taskId>0},task(){return this.$store.getters[`${y.Model.Tasks}/getById`](this.taskId)},canSaveCheckList(){return this.task.rights.checklistSave===true},checkLists(){return this.$store.getters[`${y.Model.CheckList}/getByIds`](this.task.checklist)},parentCheckLists(){return this.checkLists.filter((t=>t.parentId===0))},hasFewParentCheckLists(){return this.parentCheckLists.length>1},currentItem(){return this.$store.getters[`${y.Model.CheckList}/getById`](this.itemId)},itemGroupModeSelected(){var t;if(!this.currentItem){return false}return((t=this.currentItem.groupMode)==null?void 0:t.selected)===true},forwardMenuOptions(){return{id:`check-list-item-forward-menu-${this.currentItem.id}`,bindElement:this.forwardBindElement,maxWidth:400,maxHeight:300,offsetLeft:-110,sections:[{code:this.forwardMenuSectionCode}],items:this.forwardMenuItems,targetContainer:document.body}},forwardMenuItems(){const t=this.parentCheckLists.filter((t=>t.id!==this.currentItem.parentId)).map((t=>({title:t.title,dataset:{id:`ForwardMenuCheckList-${t.id}`},onClick:()=>{this.hideItemPanel();if(this.itemGroupModeSelected){void this.forwardGroupItemsToChecklist(t.id)}else{this.forwardToChecklist(t.id)}}})));return[...t,{sectionCode:this.forwardMenuSectionCode,title:this.loc("TASKS_V2_CHECK_LIST_ITEM_FORWARD_MENU_CREATE"),dataset:{id:`ForwardMenuCreateNew-${this.currentItem.id}`},onClick:this.forwardToNewChecklist.bind(this)}]},stub(){return this.checkLists.length===0||this.emptyList===true},emptyList(){const t=this.parentCheckLists.filter((t=>!this.deletingCheckListIds[t.id]));return t.length===0}},watch:{async titleFieldOffsetHeight(){if(!this.$refs.popupComponent){return}await this.$nextTick();this.resize()},componentShown(t){if(!this.isPreview){return}this.executeCheckListCompletionCallbacks();void this.$nextTick((()=>{if(t){this.subscribeToEvents();if(this.checkListManager.getItem(this.checkListId)&&this.$refs.list){const t=this.$refs.list.querySelector([`[data-id="${this.checkListId}"]`]);t==null?void 0:t.scrollIntoView({block:"center",behavior:"instant"})}}else{this.unsubscribeFromEvents()}}))},checkListWasUpdated(t){if(!this.currentItem){return}if(t===true){const t=this.checkListManager.getRootParentByChildId(this.currentItem.id);this.lastUpdatedCheckListId=t?t.id:0}},checkListId(t){const e=T.Type.isString(t);if(e){this.checkListWasUpdated=true}}},created(){this.checkListManager=new U({computed:{checkLists:()=>this.checkLists}})},mounted(){if(this.isAutonomous||this.isPreview){this.subscribeToEvents()}},beforeUnmount(){if(this.isAutonomous||this.isPreview){this.unsubscribeFromEvents()}if(this.isPreview){this.executeCheckListCompletionCallbacks()}},methods:{...u.mapActions(y.Model.Interface,["addCheckListItemToDeleting","removeCheckListItemFromDeleting","executeCheckListCompletionCallbacks","clearCheckListCompletionCallbacks"]),subscribeToEvents(){T.Event.bind(this.$refs.list,"scroll",this.handleScroll);S.EventEmitter.subscribe("BX.Main.Popup:onInit",this.handleInitPopup);S.EventEmitter.subscribe("BX.Main.Popup:onShow",this.handleShowPopup);S.EventEmitter.subscribe("BX.Main.Popup:onClose",this.handleClosePopup)},unsubscribeFromEvents(){T.Event.unbind(this.$refs.list,"scroll",this.handleScroll);S.EventEmitter.unsubscribe("BX.Main.Popup:onInit",this.handleInitPopup);S.EventEmitter.unsubscribe("BX.Main.Popup:onShow",this.handleShowPopup);S.EventEmitter.unsubscribe("BX.Main.Popup:onClose",this.handleClosePopup)},handleUpdate(t){this.itemId=t;this.checkListWasUpdated=true},handleRemove(t){this.itemId=t;this.freeze();this.addItemToDelete(t);this.checkListManager.hideItems([t],(t=>this.upsertCheckLists(t)));const e=this.currentItem.parentId===0?"TASKS_V2_CHECK_LIST_ITEM_REMOVE_BALLOON_PARENT":"TASKS_V2_CHECK_LIST_ITEM_REMOVE_BALLOON_CHILD";const s=new Lt({content:this.loc(e)});s.subscribeOnce("complete",(e=>{const s=e.getData();if(s){this.removeItem(t)}else{this.checkListManager.showItems([t],(t=>this.upsertCheckLists(t)))}this.removeItemFromDelete(t);this.unfreeze();this.notifiers.delete(t)}));this.notifiers.set(t,s);s.showBalloonWithTimer();if(this.isCurrentItemEmpty()){s.stopTimer()}},handleScroll(){this.isForwardMenuShown=false;this.updatePanelPosition()},handleShow(t){this.$emit("show",t)},async handleClose(){this.cleanNotifiers();this.cancelGroupMode();this.cleanCollapsedState();this.executeCheckListCompletionCallbacks();if(this.checkListManager.hasEmptyItemWithFiles(this.hasItemFiles)||this.checkListManager.hasEmptyParentItem()){const t=this.checkListManager.getFirstEmptyItem();this.focusToItem(t.id,true);return}const t=()=>{var t;return(t=[...this.fileServiceInstances.values()].find((t=>t.isUploading())))==null?void 0:t.getEntityId()};const e=this.fileServiceInstances?t():null;if(e){this.focusToItem(e,true);return}this.cleanEmptyCurrentItem();const s=this.lastUpdatedCheckListId===0?this.checkListId:this.lastUpdatedCheckListId;this.saveCheckList();this.$emit("close",this.deletingCheckListIds[s]?0:s)},handleIsShown(t){if(t){this.subscribeToEvents()}else{this.unsubscribeFromEvents()}},handleInitPopup(t){const[e,s,i]=t.getCompatData();if(e==="b24-bottom-sheet"||e==="tasks-relation-error"){return}if(T.Type.isDomNode(s)){var n;const t=["popup-submenu-"];const r=t.some((t=>e.includes(t)));if((n=this.$refs.list)!=null&&n.contains(s)&&!r&&!this.isPreview){i.targetContainer=this.$refs.list}else{i.targetContainer=document.body}}},handleShowPopup(t){const[e]=t.getCompatData();this.shownPopups.add(e.getId());this.freeze()},handleClosePopup(t){const[e]=t.getCompatData();this.shownPopups.delete(e.getId());this.unfreeze()},async handleGroupRemove(t){this.itemId=t;this.freeze();this.addItemToDelete(t);this.hideItemPanel(t);const e=this.checkListManager.getAllSelectedItems();const s=this.checkListManager.findNearestItem(this.currentItem,false);if(s){await this.updateCheckList(s.id,{groupMode:{active:true,selected:true}});setTimeout((()=>{this.showItemPanel(s.id)}),0)}const i=e.map((t=>t.id));this.checkListManager.hideItems(i,(t=>this.upsertCheckLists(t)));const n=e.length>1?"TASKS_V2_CHECK_LIST_ITEM_REMOVE_BALLOON_CHILDREN":"TASKS_V2_CHECK_LIST_ITEM_REMOVE_BALLOON_CHILD";const r=new Lt({content:this.loc(n)});r.subscribeOnce("complete",(i=>{const n=i.getData();const r=[];e.forEach((t=>{if(n){this.removeItem(t.id)}else{r.push(t.id)}this.removeItemFromDelete(t.id)}));this.checkListManager.showItems(r,(t=>this.upsertCheckLists(t)));if(n){if(s&&!this.deletingCheckListIds[s.id]){this.showItemPanel(s.id)}else{this.cancelGroupMode()}}else{this.showItemPanel(this.currentItem.id)}this.unfreeze();this.notifiers.delete(t)}));this.notifiers.set(t,r);r.showBalloonWithTimer()},handleFocus(t){this.isItemPanelFreeze=false;this.showItemPanel(t)},handleBlur(t){this.itemId=t;if(this.isCurrentItemEmpty()&&this.hasItemFiles(this.currentItem)){return}if(this.isItemPanelFreeze===false){this.hideItemPanel(t)}},handleEmptyBlur(t){this.itemId=t;if(this.currentItem.parentId===0){this.setDefaultCheckListTitle(t);return}if(this.hasItemFiles(this.currentItem)){return}if(this.isItemPanelFreeze===false){this.removeItem(t)}},handleGroupMode(t){this.itemId=t;this.cancelGroupMode();const e=this.checkListManager.getFirstChild(t);if(!e){return}this.activateGroupMode(t);this.showItemPanel(e.id)},handleGroupModeSelect(t){this.itemId=t;if(this.itemGroupModeSelected){this.showItemPanel(t)}else{this.showItemPanelOnNearestSelectedItem(t)}},handlePanelAction({action:t,node:e}){var s;const i={[lt.SetImportant]:t=>this.setImportant(t),[lt.AttachFile]:t=>this.attachFile(t),[lt.MoveRight]:t=>this.moveGroupToRight(t),[lt.MoveLeft]:t=>this.moveGroupToLeft(t),[lt.AssignAccomplice]:t=>{if(!this.isItemPanelFreeze){this.showParticipantDialog(t,"accomplices")}},[lt.AssignAuditor]:t=>{if(!this.isItemPanelFreeze){this.showParticipantDialog(t,"auditors")}},[lt.Forward]:t=>this.forward(t),[lt.Delete]:t=>this.delete(t),[lt.Cancel]:t=>this.cancelGroupMode(t)};(s=i[t])==null?void 0:s.call(i,e)},handleOpenCheckList(t){this.cleanNotifiers();this.cleanCollapsedState();this.$emit("open",t)},updateCheckList(t,e){return this.$store.dispatch(`${y.Model.CheckList}/update`,{id:t,fields:e})},updateTask(t){return this.$store.dispatch(`${y.Model.Tasks}/update`,{id:this.taskId,fields:t})},upsertCheckLists(t){return this.$store.dispatch(`${y.Model.CheckList}/upsertMany`,t)},insertCheckList(t){return this.$store.dispatch(`${y.Model.CheckList}/insert`,t)},insertManyCheckLists(t){return this.$store.dispatch(`${y.Model.CheckList}/insertMany`,t)},deleteCheckList(t){return this.$store.dispatch(`${y.Model.CheckList}/delete`,t)},saveCheckList(){if(!this.isDemoCheckListModified()){this.removeChecklists();this.checkListWasUpdated=false}if(this.checkListWasUpdated&&this.isEdit&&this.canSaveCheckList){const t=new Set(Object.values(this.deletingCheckListIds));const e=this.checkListManager.expandIdsWithChildren(t);const s=this.checkLists.filter((t=>!e.has(t.id)));void m.checkListService.save(this.taskId,s)}this.checkListWasUpdated=false},isDemoCheckListModified(){if(this.getCheckListsNumber()>1){return true}const[t]=this.checkLists;if(!t){return false}const e=this.loc("TASKS_V2_CHECK_LIST_TITLE_NUMBER",{"#number#":1});return t.title!==e||this.checkListManager.getChildren(t.id).length>0||this.hasItemUsers(t)||this.hasItemFiles(t)},removeChecklists(){this.checkLists.filter((t=>t.parentId===0)).forEach((t=>{this.removeItem(t.id)}))},async addCheckList(t=false){const e=T.Text.getRandom();const s=T.Text.getRandom();const i=[this.getDataForNewCheckList(e)];if(!t){i.push({id:s,nodeId:s,parentId:e,sortIndex:0})}await this.insertManyCheckLists(i);void this.updateTask({checklist:[...this.task.checklist,e,s]});this.checkListWasUpdated=true;return e},async addFastCheckList(){const t=await this.addCheckList();this.handleOpenCheckList(t)},showForwardMenu(t){this.forwardBindElement=t;this.isForwardMenuShown=true},getCheckListsNumber(){return this.checkLists.filter((t=>t.parentId===0&&!this.deletingCheckListIds[t.id])).length},getDataForNewCheckList(t){return{id:t,nodeId:t,title:this.loc("TASKS_V2_CHECK_LIST_TITLE_NUMBER",{"#number#":this.getCountForNewCheckList()}),sortIndex:this.getSortForNewCheckList()}},getSortForNewCheckList(){return this.getCheckListsNumber()},getCountForNewCheckList(){return this.getCheckListsNumber()+1},setItemsRef(t,e){this.itemsRefs[t]=e},getItemsRef(t){return this.itemsRefs[t]},focusToItem(t,e=false){void this.$nextTick((()=>{var s;const i=this.getItemsRef(t);i==null?void 0:(s=i.$refs.growingTextArea)==null?void 0:s.focusTextarea();if(e){void(new J).highlight(i==null?void 0:i.$refs.item)}}))},addItem({id:t,sort:e}){if(this.hasActiveGroupMode()){return}this.itemId=t;const s=T.Text.getRandom();const i=this.currentItem.parentId;this.resortItemsAfterIndex(i,e);this.insertItem(i,s,e)},addItemFromBtn(t){if(this.isPreview){this.handleOpenCheckList(t)}if(this.hasActiveGroupMode()){return}const e=T.Text.getRandom();const s=this.checkListManager.getChildren(t).length;this.insertItem(t,e,s)},insertItem(t,e,s){void this.insertCheckList({id:e,nodeId:e,parentId:t,sortIndex:s});void this.updateTask({checklist:[...this.task.checklist,e]});this.syncParentCompletionState(e)},removeItem(t,e=true){if(!this.task){return}const s=this.checkListManager.getItem(t);if(!s){return}const i=this.checkListManager.getChildren(s.id);if(s!=null&&s.title||s.parentId===0){this.checkListWasUpdated=true}if(i.length>0){i.forEach((t=>{this.removeItem(t.id,false)}))}const n=this.task.checklist.filter((t=>t!==s.id));void this.updateTask({containsChecklist:n.length>0,checklist:n});void this.deleteCheckList(s.id);if(e){this.resortItemsOnLevel(s.parentId)}this.syncParentCompletionState(s.id,s.parentId);B.fileService.delete(s.id,B.EntityTypes.CheckListItem)},addItemToDelete(t){this.addCheckListItemToDeleting(t)},removeItemFromDelete(t){this.removeCheckListItemFromDeleting(t);if(this.checkListWasUpdated===true&&this.isEdit&&T.Type.isNumber(t)){void m.checkListService.delete(this.taskId,t)}},resortItemsAfterIndex(t,e){this.checkListManager.resortItemsAfterIndex(t,e,(t=>{void this.upsertCheckLists(t)}))},resortItemsOnLevel(t){this.checkListManager.resortItemsOnLevel(t,(t=>this.upsertCheckLists(t)))},syncParentCompletionState(t,e){this.checkListManager.syncParentCompletionState(t,((t,e)=>this.updateCheckList(t,e)),e)},showItemPanel(t){if(this.isPreview){return}this.itemId=t;this.itemPanelIsShown=true;void this.updateCheckList(t,{panelIsShown:true});void this.$nextTick((()=>this.updatePanelPosition()))},hideItemPanel(t){if(this.isPreview){return}this.itemPanelIsShown=false;if(this.hasActiveGroupMode()&&this.checkListManager.getAllSelectedItems().length===0){this.deactivateGroupMode()}const e=this.checkListManager.getItem(t);if(e){void this.updateCheckList(t,{panelIsShown:false})}this.isItemPanelFreeze=false},showItemPanelOnNearestSelectedItem(t){const e=this.checkListManager.findNearestItem(this.currentItem,true);if(e){this.showItemPanel(e.id)}else{this.hideItemPanel(t)}},updatePanelPosition(){if(this.itemPanelIsShown===false){return}const t=this.$refs.list.querySelector([`[data-id="${this.currentItem.id}"]`]);const e=T.Dom.getPosition(this.$refs.panel.$el);const s=T.Dom.getPosition(this.$refs.list);const i=T.Dom.getRelativePosition(t,this.$refs.list);const n=this.currentItem.parentId===0;const r=18;const o=e.width===0?304:e.width;const a=i.top-28;if(n){const t=s.width-o-r*2-80;const e=a>-30&&a<this.itemPanelTopLimit?"flex":"none";this.itemPanelStyles={top:`${a}px`,left:`${t}px`,display:e}}else{const t=s.width-o-r;const e=a>40&&a<this.itemPanelTopLimit?"flex":"none";this.itemPanelStyles={top:`${a}px`,left:`${t}px`,display:e}}},setImportant(){if(this.itemGroupModeSelected){const t=this.checkListManager.getAllSelectedItems().map((t=>({...t,isImportant:!t.isImportant})));void this.upsertCheckLists(t)}else{void this.updateCheckList(this.currentItem.id,{isImportant:!this.currentItem.isImportant})}this.checkListWasUpdated=true},attachFile(t){var e;(e=this.fileServiceInstances)!=null?e:this.fileServiceInstances=new Map;const s=this.getCurrentFileService();this.fileServiceInstances.set(this.currentItem.id,s);s.browse({bindElement:t,onShowCallback:()=>{this.isItemPanelFreeze=true},onHideCallback:()=>{this.isItemPanelFreeze=false}});s.subscribe("onFileComplete",(()=>{this.isItemPanelFreeze=s.isUploading();this.focusToItem(this.currentItem.id);this.checkListWasUpdated=true}))},getCurrentFileService(){if(!this.currentItem){return null}return B.fileService.get(this.currentItem.id,B.EntityTypes.CheckListItem,{parentEntityId:this.taskId})},hasItemFiles(t){if(!t){return false}const e=this.getCurrentFileService();const s=t.attachments;return s.length>0||(e==null?void 0:e.isUploading())||(e==null?void 0:e.hasUploadingError())},hasItemUsers(t){return t.accomplices.length>0||t.auditors.length>0},isCurrentItemEmpty(){if(!this.currentItem){return true}return this.currentItem.title===""},moveGroupToRight(){if(this.itemGroupModeSelected){this.checkListManager.getAllSelectedItems().sort(((t,e)=>t.sortIndex-e.sortIndex)).forEach((t=>{this.moveRight(t)}))}else{this.moveRight(this.currentItem)}},moveRight(t){this.checkListManager.moveRight(t,(e=>{var s;void this.upsertCheckLists(e);this.checkListWasUpdated=true;if(!((s=t.groupMode)!=null&&s.active)){this.focusToItem(t.id)}}))},moveGroupToLeft(){if(this.itemGroupModeSelected){this.checkListManager.getAllSelectedItems().sort(((t,e)=>e.sortIndex-t.sortIndex)).forEach((t=>{this.moveLeft(t)}))}else{this.moveLeft(this.currentItem)}},moveLeft(t){this.checkListManager.moveLeft(t,(e=>{var s;void this.upsertCheckLists(e);this.checkListWasUpdated=true;if(!((s=t.groupMode)!=null&&s.active)){this.focusToItem(t.id)}}))},async forward(t){if(this.hasFewParentCheckLists){this.showForwardMenu(t)}else{this.hideItemPanel();void this.forwardToNewChecklist()}this.checkListWasUpdated=true},async forwardToNewChecklist(){const t=await this.addCheckList(true);if(this.itemGroupModeSelected){void this.forwardGroupItemsToChecklist(t)}else{this.forwardToChecklist(t)}},forwardToChecklist(t){const e=this.checkListManager.getChildren(t).length;void this.updateCheckList(this.currentItem.id,{parentId:t,sortIndex:e});this.resortItemsOnLevel(t);this.resortItemsOnLevel(this.currentItem.parentId)},async forwardGroupItemsToChecklist(t){const e=this.checkListManager.getChildren(t).length;const s=new Set;const i=this.checkListManager.getAllSelectedItems();const n=this.checkListManager.findNearestItem(this.currentItem,false,i);if(n){this.showItemPanel(n.id)}else{this.cancelGroupMode()}const r=this.checkListManager.getAllSelectedItemsWithChildren();const o=new Set(i.map((t=>t.id)));const a=[];i.forEach((i=>{const n=!o.has(i.parentId);s.add(i.parentId);a.push({...i,parentId:n?t:i.parentId,groupMode:{active:false,selected:false},sortIndex:n?e:i.sortIndex})}));r.forEach((t=>{if(!o.has(t.id)){a.push({...t,groupMode:{active:false,selected:false}})}}));await this.upsertCheckLists(a);if(n){void this.updateCheckList(n.id,{groupMode:{active:true,selected:true}})}this.resortItemsOnLevel(t);s.forEach((t=>{this.resortItemsOnLevel(t)}))},delete(){if(this.itemGroupModeSelected){void this.handleGroupRemove(this.currentItem.id)}else{this.hideItemPanel();this.handleRemove(this.currentItem.id)}},cancelGroupMode(){this.deactivateGroupMode();this.hideItemPanel()},cleanCollapsedState(){const t=this.parentCheckLists.map((t=>({...t,localCollapsedState:null})));void this.upsertCheckLists(t)},cleanEmptyCurrentItem(){if(this.currentItem&&this.isCurrentItemEmpty()){this.removeItem(this.currentItem.id)}},showParticipantDialog(t,s){var i;this.isItemPanelFreeze=true;const o=this.currentItem[s].map((t=>["user",t.id]));(i=this.selector)!=null?i:this.selector=new r.EntitySelectorDialog({...n.participantMeta.dialogOptions(this.taskId,"check-list"),preselectedItems:o,popupOptions:{events:{onShow:t=>{const s=t.getTarget();const i=s.getPopupContainer().offsetWidth;const n=10;const r=n-i/2;const o=e.Popup.getOption("angleLeftOffset")-e.Popup.getOption("angleMinTop");s.setAngle({offset:i/2-o});s.setOffset({offsetLeft:r+e.Popup.getOption("angleLeftOffset")})},onClose:()=>{const t=this.selector.getSelectedItems().map((t=>({id:t.getId(),name:t.getTitle(),image:t.getAvatar(),type:t.getEntityType()})));this.saveParticipants(this.selector.params.itemId,this.selector.params.type,t)}}},events:{onHide:()=>{this.isItemPanelFreeze=false;if(!this.itemGroupModeSelected&&this.currentItem.id===this.selector.params.itemId){this.focusToItem(this.selector.params.itemId)}this.updatePanelPosition()}}});this.selector.selectItemsByIds(o);this.selector.params={itemId:this.currentItem.id,type:s};this.selector.showTo(t)},saveParticipants(t,e,s){if(this.itemGroupModeSelected){const t=this.checkListManager.getAllSelectedItems().map((t=>({...t,[e]:s})));void this.upsertCheckLists(t)}else{void this.updateCheckList(t,{[e]:s})}const i=s.map((t=>t.id));const n={[`${e}Ids`]:i};void this.updateTask(n);this.checkListWasUpdated=true},activateGroupMode(t){this.itemId=t;const e=this.checkListManager.getAllChildren(t).map(((t,e)=>({...t,groupMode:{active:true,selected:e===0}})));e.push({...this.currentItem,groupMode:{active:true,selected:false}});void this.upsertCheckLists(e)},deactivateGroupMode(){const t=this.checkListManager.getAllGroupModeItems().map((t=>({...t,groupMode:{active:false,selected:false}})));void this.upsertCheckLists(t)},hasActiveGroupMode(){return this.checkListManager.getAllGroupModeItems().length>0},freeze(){var t,e,s;(t=this.$refs.childComponent)==null?void 0:(e=t.$refs)==null?void 0:(s=e.childComponent)==null?void 0:s.freeze()},unfreeze(){if(this.shownPopups.size===0&&Object.keys(this.deletingCheckListIds).length===0){var t,e,s;(t=this.$refs.childComponent)==null?void 0:(e=t.$refs)==null?void 0:(s=e.childComponent)==null?void 0:s.unfreeze()}},setDefaultCheckListTitle(t){void this.updateCheckList(t,{title:this.loc("TASKS_V2_CHECK_LIST_TITLE_NUMBER",{"#number#":this.getCheckListsNumber()})})},cleanNotifiers(){this.notifiers.forEach((t=>t.stopTimer()));this.notifiers.clear()}},template:`\n\t\t<component\n\t\t\tv-if="componentShown"\n\t\t\tref="childComponent"\n\t\t\t:is="componentName"\n\t\t\t:taskId="taskId"\n\t\t\t:isShown="isShown"\n\t\t\t:getBindElement="getBindElement"\n\t\t\t:getTargetContainer="getTargetContainer"\n\t\t\t:isEmpty="emptyList"\n\t\t\t@show="handleShow"\n\t\t\t@close="handleClose"\n\t\t\t@isShown="handleIsShown"\n\t\t\t@addFastCheckList="addFastCheckList"\n\t\t\t@resize="$emit('resize')"\n\t\t>\n\t\t\t<template v-slot:default="{ handleShow, handleClose }">\n\t\t\t\t<div ref="wrapper" class="tasks-check-list-wrapper" :class="contextClass">\n\t\t\t\t\t<div v-if="!isPreview" class="tasks-check-list-close-icon" :class="contextClass">\n\t\t\t\t\t\t<BIcon :name="Outline.CROSS_L" @click="handleClose"/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div ref="list" data-list class="tasks-check-list-content" :class="contextClass">\n\t\t\t\t\t\t<CheckListWidget\n\t\t\t\t\t\t\tv-show="!stub"\n\t\t\t\t\t\t\t:taskId="taskId"\n\t\t\t\t\t\t\t:checkListId="checkListId"\n\t\t\t\t\t\t\t:isPreview="isPreview"\n\t\t\t\t\t\t\t@update="handleUpdate"\n\t\t\t\t\t\t\t@show="handleShow"\n\t\t\t\t\t\t\t@addItem="addItem"\n\t\t\t\t\t\t\t@addItemFromBtn="addItemFromBtn"\n\t\t\t\t\t\t\t@removeItem="handleRemove"\n\t\t\t\t\t\t\t@focus="handleFocus"\n\t\t\t\t\t\t\t@blur="handleBlur"\n\t\t\t\t\t\t\t@emptyBlur="handleEmptyBlur"\n\t\t\t\t\t\t\t@startGroupMode="handleGroupMode"\n\t\t\t\t\t\t\t@toggleGroupModeSelected="handleGroupModeSelect"\n\t\t\t\t\t\t\t@openCheckList="handleOpenCheckList"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<CheckListStub v-if="stub && !isPreview" @click="addCheckList" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-show="!stub && !isPreview" class="tasks-check-list-footer" :class="contextClass">\n\t\t\t\t\t\t<UiButton\n\t\t\t\t\t\t\t:text="loc('TASKS_V2_CHECK_LIST_NEW_BTN')"\n\t\t\t\t\t\t\t:size="ButtonSize.MEDIUM"\n\t\t\t\t\t\t\t:leftIcon="ButtonIcon.ADD"\n\t\t\t\t\t\t\t:style="AirButtonStyle.PLAIN_NO_ACCENT"\n\t\t\t\t\t\t\t@click="addCheckList"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<UiButton\n\t\t\t\t\t\t\t:text="loc('TASKS_V2_CHECK_LIST_READY_BTN')"\n\t\t\t\t\t\t\t:size="ButtonSize.MEDIUM"\n\t\t\t\t\t\t\t@click="handleClose"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<CheckListItemPanel\n\t\t\t\t\t\tv-if="itemPanelIsShown && !isPreview"\n\t\t\t\t\t\tref="panel"\n\t\t\t\t\t\t:taskId="taskId"\n\t\t\t\t\t\t:currentItem="currentItem"\n\t\t\t\t\t\t:style="itemPanelStyles"\n\t\t\t\t\t\t@action="handlePanelAction"\n\t\t\t\t\t/>\n\t\t\t\t\t<BMenu\n\t\t\t\t\t\tv-if="isForwardMenuShown"\n\t\t\t\t\t\t:options="forwardMenuOptions"\n\t\t\t\t\t\t@close="isForwardMenuShown = false"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</component>\n\t`};const Et={components:{Chip:A.Chip},props:{taskId:{type:[Number,String],required:true},isAutonomous:{type:Boolean,default:false}},emits:["showCheckList"],setup(){return{Outline:M.Outline,checkListMeta:z}},computed:{task(){return this.$store.getters[`${y.Model.Tasks}/getById`](this.taskId)},checkLists(){return this.$store.getters[`${y.Model.CheckList}/getByIds`](this.task.checklist)},isUploading(){var t;return(t=this.task.checklist)==null?void 0:t.some((t=>B.fileService.get(t,B.EntityTypes.CheckListItem,{parentEntityId:this.taskId}).isUploading()))},design(){return{[!this.isAutonomous&&!this.isSelected]:A.ChipDesign.ShadowNoAccent,[!this.isAutonomous&&this.isSelected]:A.ChipDesign.ShadowAccent,[this.isAutonomous&&!this.isSelected]:A.ChipDesign.OutlineNoAccent,[this.isAutonomous&&this.isSelected]:A.ChipDesign.OutlineAccent}.true},isSelected(){if(this.isAutonomous){return this.checkLists.length>0}return this.wasFilled||this.checkLists.length>0},wasFilled(){return this.$store.getters[`${y.Model.Tasks}/wasFieldFilled`](this.taskId,z.id)},checkListItemCount(){return this.checkLists.filter((t=>t.parentId!==0)).length},text(){if(this.isAutonomous&&this.checkListItemCount>0){const t=this.getCompletedCount();return this.loc("TASKS_V2_CHECK_LIST_COUNT_TITLE",{"#count#":t,"#total#":this.checkListItemCount})}return this.loc("TASKS_V2_CHECK_LIST_CHIP_TITLE")},icon(){if(this.isUploading&&!this.wasFilled){return M.Animated.LOADER_WAIT}return M.Outline.CHECK_LIST}},mounted(){this.$bitrix.eventEmitter.subscribe(y.EventName.CloseCheckList,this.handleFieldClose)},beforeUnmount(){this.$bitrix.eventEmitter.unsubscribe(y.EventName.CloseCheckList,this.handleFieldClose)},methods:{handleClick(){if(this.isAutonomous){void this.showCheckList()}else{if(this.isSelected){this.highlightField()}else{void this.showCheckList()}}},async showCheckList(){if(!this.isSelected){await this.buildEmptyCheckList()}this.$emit("showCheckList")},async buildEmptyCheckList(){const t=T.Text.getRandom();const e=T.Text.getRandom();await this.$store.dispatch(`${y.Model.CheckList}/insertMany`,[{id:t,nodeId:t,title:this.loc("TASKS_V2_CHECK_LIST_TITLE_NUMBER",{"#number#":1})},{id:e,nodeId:e,parentId:t}]);await this.$store.dispatch(`${y.Model.Tasks}/update`,{id:this.taskId,fields:{checklist:[t,e]}})},highlightField(){void P.fieldHighlighter.setContainer(this.$root.$el).highlight(z.id)},getCompletedCount(){return this.checkLists.filter((t=>t.isComplete&&t.parentId!==0)).length},handleFieldClose(){if(this.isAutonomous){this.$el.focus()}}},template:`\n\t\t<Chip\n\t\t\t:design="design"\n\t\t\t:icon="icon"\n\t\t\t:text="text"\n\t\t\t:data-task-id="taskId"\n\t\t\t:data-task-chip-id="checkListMeta.id"\n\t\t\t@click="handleClick"\n\t\t/>\n\t`};t.CheckList=Mt;t.CheckListChip=Et;t.CheckListList=W;t.checkListMeta=z})(this.BX.Tasks.V2.Component.Fields=this.BX.Tasks.V2.Component.Fields||{},BX.Main,BX.UI.EntitySelector,BX,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Lib,BX.Vue3.Components,BX.UI.Vue3.Components,BX.Tasks.V2.Component.Elements,BX.UI.Vue3.Components,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Component.Elements,BX.Vue3.Vuex,BX.Tasks.V2.Provider.Service,BX.UI.System.Skeleton.Vue,BX.Disk.Uploader,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Component.Elements,BX,BX.Vue3.Directives,BX.UI.IconSet,BX.Tasks.V2,BX.Tasks.V2.Component.Elements,BX.Event,BX,BX,BX.UI.IconSet,BX,BX.Tasks.V2.Lib,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Provider.Service,BX.Tasks.V2.Const);
//# sourceMappingURL=check-list.bundle.map.js