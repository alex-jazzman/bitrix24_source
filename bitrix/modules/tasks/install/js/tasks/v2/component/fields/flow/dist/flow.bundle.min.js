this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};this.BX.Tasks.V2=this.BX.Tasks.V2||{};this.BX.Tasks.V2.Component=this.BX.Tasks.V2.Component||{};(function(e,t,s,i,l,o,a,n,r,d,c,h,u,p,v,b,f,k,g,w){"use strict";const F=Object.freeze({id:f.TaskField.Flow,title:d.Loc.getMessage("TASKS_V2_FLOW_TITLE")});var I=babelHelpers.classPrivateFieldLooseKey("taskId");var B=babelHelpers.classPrivateFieldLooseKey("dialog");var m=babelHelpers.classPrivateFieldLooseKey("onUpdateOnce");var T=babelHelpers.classPrivateFieldLooseKey("createDialog");var S=babelHelpers.classPrivateFieldLooseKey("onItemChange");var P=babelHelpers.classPrivateFieldLooseKey("items");var C=babelHelpers.classPrivateFieldLooseKey("task");var L=babelHelpers.classPrivateFieldLooseKey("insertFlow");var y=babelHelpers.classPrivateFieldLooseKey("updateFlow");var O=babelHelpers.classPrivateFieldLooseKey("clearOnUpdateOnce");class H{constructor(){Object.defineProperty(this,y,{value:$});Object.defineProperty(this,L,{value:V});Object.defineProperty(this,C,{get:M,set:void 0});Object.defineProperty(this,P,{get:A,set:void 0});Object.defineProperty(this,S,{value:E});Object.defineProperty(this,T,{value:X});Object.defineProperty(this,I,{writable:true,value:void 0});Object.defineProperty(this,B,{writable:true,value:void 0});Object.defineProperty(this,m,{writable:true,value:null});Object.defineProperty(this,O,{writable:true,value:()=>{babelHelpers.classPrivateFieldLooseBase(this,m)[m]=null}})}setTaskId(e){babelHelpers.classPrivateFieldLooseBase(this,I)[I]=e;return this}showTo(e){var t,s;(s=(t=babelHelpers.classPrivateFieldLooseBase(this,B))[B])!=null?s:t[B]=babelHelpers.classPrivateFieldLooseBase(this,T)[T]();babelHelpers.classPrivateFieldLooseBase(this,B)[B].selectItemsByIds(babelHelpers.classPrivateFieldLooseBase(this,P)[P]);babelHelpers.classPrivateFieldLooseBase(this,B)[B].showTo(e)}onUpdateOnce(e){babelHelpers.classPrivateFieldLooseBase(this,m)[m]=e}}function X(){var e,t;const s=d.Runtime.debounce(babelHelpers.classPrivateFieldLooseBase(this,S)[S],10,this);const i=new u.EntitySelectorDialog({context:"tasks-card",width:380,height:370,multiple:false,hideOnDeselect:true,enableSearch:true,entities:[{id:f.EntitySelectorEntity.Flow,options:{onlyActive:true}}],preselectedItems:babelHelpers.classPrivateFieldLooseBase(this,P)[P],events:{"Item:onSelect":s,"Item:onDeselect":s,onHide:babelHelpers.classPrivateFieldLooseBase(this,O)[O],onDestroy:babelHelpers.classPrivateFieldLooseBase(this,O)[O]},recentTabOptions:{stub:c.EmptyStub,stubOptions:{showArrow:false}}});if((e=h.Core.getParams().rights)!=null&&(t=e.flow)!=null&&t.create){const e=d.Extension.getSettings("tasks.v2.component.fields.flow").get("isFeatureTriable");const t=new c.Footer(i,{isFeatureTriable:e});i.setFooter(t.render())}return i}async function E(){var e;const t=babelHelpers.classPrivateFieldLooseBase(this,B)[B].getSelectedItems()[0];const s=t==null?void 0:t.getCustomData().get("groupId");if(t){babelHelpers.classPrivateFieldLooseBase(this,L)[L]({id:t.getId(),name:t.getTitle()});const e=h.Core.getStore().getters[`${f.Model.Groups}/getById`](s);if(!e){await p.groupService.getGroup(s)}}babelHelpers.classPrivateFieldLooseBase(this,y)[y]((e=t==null?void 0:t.getId())!=null?e:0,s!=null?s:0)}function A(){return[[f.EntitySelectorEntity.Flow,babelHelpers.classPrivateFieldLooseBase(this,C)[C].flowId]]}function M(){return h.Core.getStore().getters[`${f.Model.Tasks}/getById`](babelHelpers.classPrivateFieldLooseBase(this,I)[I])}function V(e){void h.Core.getStore().dispatch(`${f.Model.Flows}/insert`,e)}function $(e,t){var s,i;const l=h.Core.getStore().getters[`${f.Model.Interface}/currentUserId`];void w.taskService.update(babelHelpers.classPrivateFieldLooseBase(this,I)[I],{creatorId:l,flowId:e,groupId:t,stageId:0});(s=(i=babelHelpers.classPrivateFieldLooseBase(this,m))[m])==null?void 0:s.call(i);babelHelpers.classPrivateFieldLooseBase(this,O)[O]()}const K=new H;const _={name:"TaskFlow",components:{BIcon:l.BIcon,BMenu:i.BMenu,HoverPill:o.HoverPill,FieldAdd:a.FieldAdd,Stage:n.Stage},props:{taskId:{type:[Number,String],required:true}},setup(){return{flowMeta:F,Outline:l.Outline}},data(){return{isMenuShown:false}},computed:{...s.mapGetters({currentUserId:`${f.Model.Interface}/currentUserId`}),task(){return this.$store.getters[`${f.Model.Tasks}/getById`](this.taskId)},flow(){return this.$store.getters[`${f.Model.Flows}/getById`](this.task.flowId)},isEdit(){return Number.isInteger(this.taskId)&&this.taskId>0},menuOptions(){return{id:"tasks-field-flow-menu",bindElement:this.$refs.container,offsetTop:8,items:[{title:this.loc("TASKS_V2_FLOW_ABOUT"),icon:l.Outline.BOTTLENECK,onClick:this.openFlow},{title:this.loc("TASKS_V2_FLOW_CHANGE"),icon:l.Outline.EDIT_L,onClick:this.showDialog},{design:i.MenuItemDesign.Alert,title:this.loc("TASKS_V2_FLOW_DETACH"),icon:l.Outline.CROSS_L,onClick:this.clearField}],targetContainer:document.body}},readonly(){return!this.task.rights.edit}},methods:{handleClick(){if(this.flow&&this.readonly){this.openFlow();return}if(this.isEdit&&this.flow){this.showMenu()}else{this.showDialog()}},showMenu(){this.isMenuShown=true},handleClear(){this.clearField()},openFlow(){const e=r.flowService.getUrl(this.flow.id,this.currentUserId);t.SidePanel.Instance.open(e)},clearField(){void w.taskService.update(this.taskId,{flowId:0,groupId:0,stageId:0})},showDialog(){K.setTaskId(this.taskId).showTo(this.$refs.container)}},template:`\n\t\t<div\n\t\t\t:data-task-id="taskId"\n\t\t\t:data-task-field-id="flowMeta.id"\n\t\t\t:data-task-field-value="task.flowId"\n\t\t>\n\t\t\t<HoverPill\n\t\t\t\tv-if="flow"\n\t\t\t\t:withClear="!readonly && !isEdit"\n\t\t\t\t@click="handleClick"\n\t\t\t\t@clear="handleClear"\n\t\t\t>\n\t\t\t\t<div class="tasks-field-flow">\n\t\t\t\t\t<BIcon :name="Outline.BOTTLENECK"/>\n\t\t\t\t\t<div class="tasks-field-flow-title">{{ flow.name }}</div>\n\t\t\t\t</div>\n\t\t\t</HoverPill>\n\t\t\t<FieldAdd v-else :icon="Outline.BOTTLENECK" @click="handleClick"/>\n\t\t\t<Stage v-if="isEdit && flow" :taskId="taskId"/>\n\t\t</div>\n\t\t<BMenu v-if="isMenuShown" :options="menuOptions" @close="isMenuShown = false"/>\n\t`};const D={components:{Chip:k.Chip},props:{taskId:{type:[Number,String],required:true},isAutonomous:{type:Boolean,default:false}},setup(){return{Outline:v.Outline,flowMeta:F}},computed:{task(){return this.$store.getters[`${f.Model.Tasks}/getById`](this.taskId)},flow(){return this.$store.getters[`${f.Model.Flows}/getById`](this.task.flowId)},design(){return{[!this.isAutonomous&&!this.isSelected]:k.ChipDesign.ShadowNoAccent,[!this.isAutonomous&&this.isSelected]:k.ChipDesign.ShadowAccent,[this.isAutonomous&&!this.isSelected]:k.ChipDesign.OutlineNoAccent,[this.isAutonomous&&this.isSelected]:k.ChipDesign.OutlineAccent}.true},isSelected(){if(this.isAutonomous){return this.task.flowId>0}return this.$store.getters[`${f.Model.Tasks}/wasFieldFilled`](this.taskId,F.id)},isFilled(){return this.isAutonomous&&this.task.flowId>0},text(){if(this.isFilled){return this.flow.name}return this.loc("TASKS_V2_FLOW_TITLE_CHIP")},readonly(){return!this.task.rights.edit}},methods:{handleClick(){if(!this.isAutonomous&&this.isSelected){this.highlightField();return}K.setTaskId(this.taskId).showTo(this.$el);if(!this.isAutonomous){K.onUpdateOnce(this.highlightField)}},highlightField(){void g.fieldHighlighter.setContainer(this.$root.$el).highlight(F.id)},handleClear(){void w.taskService.update(this.taskId,{flowId:0,groupId:0})}},template:`\n\t\t<Chip\n\t\t\tv-if="isSelected || !readonly"\n\t\t\t:design="design"\n\t\t\t:icon="Outline.BOTTLENECK"\n\t\t\t:text="text"\n\t\t\t:withClear="isFilled"\n\t\t\t:trimmable="isFilled"\n\t\t\t:data-task-id="taskId"\n\t\t\t:data-task-chip-id="flowMeta.id"\n\t\t\t:data-task-chip-value="task.flowId"\n\t\t\t@click="handleClick"\n\t\t\t@clear="handleClear"\n\t\t\t:title="flow?.name ?? ''"\n\t\t/>\n\t`};e.Flow=_;e.FlowChip=D;e.flowMeta=F})(this.BX.Tasks.V2.Component.Fields=this.BX.Tasks.V2.Component.Fields||{},BX.SidePanel,BX.Vue3.Vuex,BX.UI.Vue3.Components,BX.UI.IconSet,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Provider.Service,BX,BX.Tasks.Flow,BX.Tasks.V2,BX.Tasks.V2.Lib,BX.Tasks.V2.Provider.Service,BX.UI.IconSet,BX,BX.Tasks.V2.Const,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Lib,BX.Tasks.V2.Provider.Service);
//# sourceMappingURL=flow.bundle.map.js