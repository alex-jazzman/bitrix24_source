this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};this.BX.Tasks.V2=this.BX.Tasks.V2||{};this.BX.Tasks.V2.Component=this.BX.Tasks.V2.Component||{};(function(t,e,s,i,o,r,n,a,l,d,u,p,c,h,g,v,m,k,f,I,S,b,T,P,y,B){"use strict";const C=Object.freeze({id:S.TaskField.Group,title:m.Loc.getMessage("TASKS_V2_GROUP_TITLE"),getTitle:t=>{var e;const s=I.Core.getStore().getters[`${S.Model.Groups}/getById`](t);return(e={[S.GroupType.Collab]:m.Loc.getMessage("TASKS_V2_GROUP_TITLE_COLLAB"),[S.GroupType.Scrum]:m.Loc.getMessage("TASKS_V2_GROUP_TITLE_SCRUM")}[s==null?void 0:s.type])!=null?e:m.Loc.getMessage("TASKS_V2_GROUP_TITLE")}});let O=t=>t,_;const E={components:{BIcon:a.BIcon,Loader:n.Loader,BMenu:o.BMenu},directives:{hint:d.hint},props:{taskId:{type:[Number,String],required:true}},setup(){return{Outline:k.Outline}},data(){return{isMenuShown:false}},computed:{task(){return this.$store.getters[`${S.Model.Tasks}/getById`](this.taskId)},isEdit(){return Number.isInteger(this.taskId)&&this.taskId>0},group(){return this.$store.getters[`${S.Model.Groups}/getById`](this.task.groupId)},groupId(){return this.task.groupId},stage(){var t;return(t=this.$store.getters[`${S.Model.Stages}/getById`](this.task.stageId))!=null?t:null},menuOptions(){return()=>({id:"tasks-field-group-stage-menu",bindElement:this.$refs.stage,offsetTop:8,items:this.menuItems,maxHeight:window.innerHeight/2,targetContainer:document.body})},menuItems(){var t;const e=this.$store.getters[`${S.Model.Stages}/getByIds`]((t=this.group.stagesIds)!=null?t:[]);return e==null?void 0:e.map((t=>({title:t.title,svg:this.getStageSvg(new l.Color(t.color).limit(250).toRgb()),isSelected:t.id===this.stage.id,onClick:()=>this.setStage(t.id)})))},stageColor(){return`#${this.stage.color}`},backgroundColor(){return new l.Color(this.stage.color).setOpacity(.1).limit(250).toRgb()},isDarkColor(){return new l.Color(this.stage.color).isDark()},tooltip(){return()=>T.tooltip({text:this.loc("TASKS_V2_GROUP_STAGE_HINT"),popupOptions:{offsetLeft:this.$refs.stage.offsetWidth/2}})},readonly(){return!this.task.rights.edit}},watch:{groupId(){void this.loadStagesForCreation()}},created(){void this.loadStagesForCreation()},methods:{getStageSvg(t){return m.Tag.render(_||(_=O`
				<div class="ui-icon-set --${0}" style="--ui-icon-set__icon-color: ${0}"></div>
			`),k.CRM.STAGE,t)},async handleClick(){if(this.readonly){return}if(!this.group.stagesIds){await h.groupService.getStages(this.groupId)}this.isMenuShown=true},setStage(t){void B.taskService.update(this.taskId,{stageId:t})},async loadStagesForCreation(){if(this.isEdit||this.group.stagesIds){return}await h.groupService.getStages(this.groupId);if(!this.task.stageId){this.setStage(this.group.stagesIds[0])}}},template:`\n\t\t<div\n\t\t\tv-if="stage"\n\t\t\tv-hint="tooltip"\n\t\t\tclass="tasks-field-group-stage"\n\t\t\t:class="{ '--dark': isDarkColor, '--readonly': readonly }"\n\t\t\t:style="{\n\t\t\t\t'--stage-color': stageColor,\n\t\t\t\t'--stage-background': backgroundColor,\n\t\t\t}"\n\t\t\t:data-task-id="taskId"\n\t\t\t:data-task-field-id="'stageId'"\n\t\t\t:data-task-field-value="task.stageId"\n\t\t\t:data-task-stage-title="stage?.title"\n\t\t\tref="stage"\n\t\t\t@click="handleClick"\n\t\t>\n\t\t\t<div class="tasks-field-group-stage-text-container">\n\t\t\t\t<div class="tasks-field-group-stage-text">{{ stage.title }}</div>\n\t\t\t</div>\n\t\t\t<div class="tasks-field-group-stage-arrow"></div>\n\t\t\t<BIcon v-if="!readonly" :name="Outline.CHEVRON_DOWN_S"/>\n\t\t</div>\n\t\t<div v-else class="tasks-field-group-stage-loader">\n\t\t\t<Loader/>\n\t\t</div>\n\t\t<BMenu v-if="isMenuShown" :options="menuOptions()" @close="isMenuShown = false"/>\n\t`};const L={components:{BIcon:a.BIcon},directives:{hint:d.hint},props:{taskId:{type:[Number,String],required:true}},setup(){return{Outline:k.Outline}},computed:{task(){return this.$store.getters[`${S.Model.Tasks}/getById`](this.taskId)},epic(){return this.$store.getters[`${S.Model.Epics}/getById`](this.task.epicId)},preselectedEpic(){return this.epic?[["epic-selector",this.epic.id]]:[]},epicColor(){if(!this.epic){return""}return new l.Color(this.epic.color).toRgb()},backgroundColor(){if(!this.epic){return""}return new l.Color(this.epic.color).setOpacity(.3).limit(250).toRgb()},isDarkColor(){if(!this.epic){return false}return new l.Color(this.epic.color).isDark()},tooltip(){return()=>T.tooltip({text:this.loc("TASKS_V2_GROUP_EPIC_HINT"),popupOptions:{offsetLeft:this.$el.offsetWidth/2}})}},methods:{handleClick(){this.showDialog()},showDialog(){var t,e;(t=this.handleEpicSelectedDebounced)!=null?t:this.handleEpicSelectedDebounced=m.Runtime.debounce(this.handleEpicSelected,10,this);(e=this.dialog)!=null?e:this.dialog=new v.EntitySelectorDialog({multiple:false,dropdownMode:true,enableSearch:true,compactView:true,hideOnDeselect:true,entities:[{id:S.EntitySelectorEntity.Epic,options:{groupId:this.task.groupId},dynamicLoad:true,dynamicSearch:true}],preselectedItems:this.preselectedEpic,events:{"Item:onSelect":this.handleEpicSelectedDebounced,"Item:onDeselect":this.handleEpicSelectedDebounced}});this.dialog.selectItemsByIds(this.preselectedEpic);this.dialog.showTo(this.$el)},handleEpicSelected(){var t;const e=this.dialog.getSelectedItems()[0];if(e){void this.$store.dispatch(`${S.Model.Epics}/insert`,{id:e.getId(),title:e.getTitle(),color:e.getAvatarOption("bgColor")})}void B.taskService.update(this.taskId,{epicId:(t=e==null?void 0:e.getId())!=null?t:0})}},template:`\n\t\t<div\n\t\t\tv-hint="tooltip"\n\t\t\tclass="tasks-field-group-scrum-epic"\n\t\t\t:class="{ '--dark': isDarkColor, '--filled': epic }"\n\t\t\t:style="{\n\t\t\t\t'--epic-color': epicColor,\n\t\t\t\t'--epic-background': backgroundColor,\n\t\t\t}"\n\t\t\t@click="handleClick"\n\t\t>\n\t\t\t<span class="tasks-field-group-scrum-epic-title">\n\t\t\t\t{{ epic?.title || loc('TASKS_V2_GROUP_EPIC_EMPTY') }}\n\t\t\t</span>\n\t\t\t<BIcon :name="Outline.CHEVRON_DOWN_S"/>\n\t\t</div>\n\t`};const w={directives:{hint:d.hint},props:{taskId:{type:[Number,String],required:true}},data(){return{isFocused:false}},computed:{task(){return this.$store.getters[`${S.Model.Tasks}/getById`](this.taskId)},storyPoints(){var t;return(t=this.task.storyPoints)==null?void 0:t.trim()},tooltip(){return()=>T.tooltip({text:this.loc("TASKS_V2_GROUP_STORY_POINTS_HINT"),popupOptions:{offsetLeft:this.$refs.storyPoints.offsetWidth/2}})}},methods:{async handleClick(){this.isFocused=true;await this.$nextTick();this.$refs.input.focus()},handleBlur(){this.isFocused=false;void B.taskService.update(this.taskId,{storyPoints:this.$refs.input.value.trim()})}},template:`\n\t\t<input\n\t\t\tv-if="isFocused"\n\t\t\tclass="tasks-field-group-scrum-story-points-input"\n\t\t\t:value="storyPoints"\n\t\t\tref="input"\n\t\t\t@blur="handleBlur"\n\t\t/>\n\t\t<div\n\t\t\tv-else\n\t\t\tv-hint="tooltip"\n\t\t\tclass="tasks-field-group-scrum-story-points"\n\t\t\t:class="{ '--filled': storyPoints }"\n\t\t\tref="storyPoints"\n\t\t\t@click="handleClick"\n\t\t>\n\t\t\t{{ storyPoints || '-' }}\n\t\t</div>\n\t`};const F={components:{Epic:L,StoryPoints:w,Loader:n.Loader},props:{taskId:{type:[Number,String],required:true}},data(){return{hasScrumInfo:h.groupService.hasScrumInfo(this.taskId)}},async mounted(){await h.groupService.getScrumInfo(this.taskId);this.hasScrumInfo=h.groupService.hasScrumInfo(this.taskId)},template:`\n\t\t<div v-if="hasScrumInfo" class="tasks-field-group-scrum">\n\t\t\t<Epic :taskId="taskId"/>\n\t\t\t<StoryPoints :taskId="taskId"/>\n\t\t</div>\n\t\t<div v-else class="tasks-field-group-scrum-loader">\n\t\t\t<Loader/>\n\t\t</div>\n\t`};const H={components:{Popup:u.Popup,UiButton:p.Button},props:{taskId:{type:[Number,String],required:true},getBindElement:{type:Function,required:true}},emits:["close"],setup(){return{AirButtonStyle:p.AirButtonStyle,ButtonSize:p.ButtonSize}},data(){return{isPopupShown:false,groupInfo:{}}},computed:{task(){return this.$store.getters[`${S.Model.Tasks}/getById`](this.taskId)},group(){return this.$store.getters[`${S.Model.Groups}/getById`](this.task.groupId)},bindElement(){return this.getBindElement()},popupId(){return"tasks-field-group-popup"},popupOptions(){return{bindElement:this.bindElement,padding:24,minWidth:260,maxWidth:400,offsetTop:8,targetContainer:document.body}},groupOwnerUrl(){return g.userService.getUrl(this.groupInfo.ownerId)},groupMembersCountFormatted(){return m.Loc.getMessagePlural("TASKS_V2_GROUP_COUNT_MEMBERS",this.groupInfo.numberOfMembers,{"#COUNT#":this.groupInfo.numberOfMembers})},groupAboutFormatted(){var t,e;return(t={[S.GroupType.Collab]:this.loc("TASKS_V2_GROUP_ABOUT_COLLAB"),[S.GroupType.Scrum]:this.loc("TASKS_V2_GROUP_ABOUT_SCRUM")}[(e=this.group)==null?void 0:e.type])!=null?t:this.loc("TASKS_V2_GROUP_ABOUT")}},mounted(){m.Event.bind(this.bindElement,"click",this.handleClick);m.Event.bind(this.bindElement,"mouseenter",this.handleMouseEnter);m.Event.bind(this.bindElement,"mouseleave",this.handleMouseLeave)},methods:{openGroup(){void c.openGroup(this.group.id,this.group.type)},handleClick(){this.clearTimeouts()},handleMouseEnter(){if(!this.group){return}this.groupInfoPromise=h.groupService.getGroupInfo(this.group.id);this.clearTimeouts();this.showTimeout=setTimeout((()=>this.showPopup()),400)},handleMouseLeave(){m.Event.unbind(document,"mouseover",this.updateHoverElement);m.Event.bind(document,"mouseover",this.updateHoverElement);this.clearTimeouts();this.closeTimeout=setTimeout((()=>{var t;if(!((t=this.$refs.container)!=null&&t.contains(this.hoverElement))&&!this.bindElement.contains(this.hoverElement)){this.closePopup()}}),100)},updateHoverElement(t){this.hoverElement=t.target},async showPopup(){if(this.groupInfoPromise){this.groupInfo=await this.groupInfoPromise}if(!this.group){return}this.clearTimeouts();this.isPopupShown=true;await this.$nextTick();this.$refs.popup.adjustPosition()},closePopup(){this.clearTimeouts();this.isPopupShown=false;m.Event.unbind(this.$refs.container,"mouseleave",this.handleMouseLeave);m.Event.unbind(document,"mouseover",this.updateHoverElement)},clearTimeouts(){clearTimeout(this.closeTimeout);clearTimeout(this.showTimeout)}},template:`\n\t\t<Popup\n\t\t\tv-if="isPopupShown"\n\t\t\t:id="popupId"\n\t\t\t:options="popupOptions"\n\t\t\tref="popup"\n\t\t\t@close="closePopup"\n\t\t>\n\t\t\t<div class="tasks-field-group-popup" ref="container">\n\t\t\t\t<div class="tasks-field-group-popup-header">\n\t\t\t\t\t<img class="tasks-field-group-popup-image" :src="group?.image" :alt="group?.name">\n\t\t\t\t\t<div class="tasks-field-group-popup-title-container">\n\t\t\t\t\t\t<div class="tasks-field-group-popup-title" :title="group?.name">{{ group?.name }}</div>\n\t\t\t\t\t\t<div class="tasks-field-group-popup-subtitle">{{ groupMembersCountFormatted }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-field-group-popup-button">\n\t\t\t\t\t<UiButton\n\t\t\t\t\t\t:text="groupAboutFormatted"\n\t\t\t\t\t\t:style="AirButtonStyle.OUTLINE_ACCENT_2"\n\t\t\t\t\t\t:size="ButtonSize.SMALL"\n\t\t\t\t\t\t:wide="true"\n\t\t\t\t\t\t@click="openGroup"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-field-group-popup-info">\n\t\t\t\t\t<div class="tasks-field-group-popup-field">\n\t\t\t\t\t\t<div class="tasks-field-group-popup-field-title">{{ loc('TASKS_V2_GROUP_OWNER') }}</div>\n\t\t\t\t\t\t<div class="tasks-field-group-popup-field-value">\n\t\t\t\t\t\t\t<a :href="groupOwnerUrl">{{ groupInfo.ownerName }}</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-field-group-popup-field">\n\t\t\t\t\t\t<div class="tasks-field-group-popup-field-title">{{ loc('TASKS_V2_GROUP_DATE_CREATE') }}</div>\n\t\t\t\t\t\t<div class="tasks-field-group-popup-field-value">{{ groupInfo.dateCreate }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-field-group-popup-field">\n\t\t\t\t\t\t<div class="tasks-field-group-popup-field-title">{{ loc('TASKS_V2_GROUP_SUBJECT') }}</div>\n\t\t\t\t\t\t<div class="tasks-field-group-popup-field-value">{{ groupInfo.subjectTitle }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</Popup>\n\t`};var A=babelHelpers.classPrivateFieldLooseKey("taskId");var $=babelHelpers.classPrivateFieldLooseKey("dialog");var M=babelHelpers.classPrivateFieldLooseKey("onUpdateOnce");var G=babelHelpers.classPrivateFieldLooseKey("onUpdate");var U=babelHelpers.classPrivateFieldLooseKey("onHide");var V=babelHelpers.classPrivateFieldLooseKey("createDialog");var R=babelHelpers.classPrivateFieldLooseKey("handleHide");var D=babelHelpers.classPrivateFieldLooseKey("handleItemChange");var K=babelHelpers.classPrivateFieldLooseKey("insertSelectedGroup");var N=babelHelpers.classPrivateFieldLooseKey("items");var X=babelHelpers.classPrivateFieldLooseKey("task");var j=babelHelpers.classPrivateFieldLooseKey("insertGroup");var x=babelHelpers.classPrivateFieldLooseKey("updateGroup");var W=babelHelpers.classPrivateFieldLooseKey("clearOnUpdateOnce");class q{constructor(){Object.defineProperty(this,x,{value:tt});Object.defineProperty(this,j,{value:Z});Object.defineProperty(this,X,{get:Q,set:void 0});Object.defineProperty(this,N,{get:J,set:void 0});Object.defineProperty(this,D,{value:Y});Object.defineProperty(this,V,{value:z});Object.defineProperty(this,A,{writable:true,value:void 0});Object.defineProperty(this,$,{writable:true,value:void 0});Object.defineProperty(this,M,{writable:true,value:null});Object.defineProperty(this,G,{writable:true,value:null});Object.defineProperty(this,U,{writable:true,value:null});Object.defineProperty(this,R,{writable:true,value:()=>{var t,e;(t=(e=babelHelpers.classPrivateFieldLooseBase(this,U))[U])==null?void 0:t.call(e);babelHelpers.classPrivateFieldLooseBase(this,W)[W]()}});Object.defineProperty(this,K,{writable:true,value:async()=>{const t=babelHelpers.classPrivateFieldLooseBase(this,$)[$].getSelectedItems()[0];if(!t){return null}await babelHelpers.classPrivateFieldLooseBase(this,j)[j]({id:t.getId(),name:t.getTitle(),image:t.getAvatar(),type:t.getEntityType()});return t}});Object.defineProperty(this,W,{writable:true,value:()=>{babelHelpers.classPrivateFieldLooseBase(this,M)[M]=null}})}setTaskId(t){babelHelpers.classPrivateFieldLooseBase(this,A)[A]=t;return this}init(){var t,e;(e=(t=babelHelpers.classPrivateFieldLooseBase(this,$))[$])!=null?e:t[$]=babelHelpers.classPrivateFieldLooseBase(this,V)[V]()}showTo(t){this.init();babelHelpers.classPrivateFieldLooseBase(this,$)[$].selectItemsByIds(babelHelpers.classPrivateFieldLooseBase(this,N)[N]);babelHelpers.classPrivateFieldLooseBase(this,$)[$].showTo(t)}onUpdateOnce(t){babelHelpers.classPrivateFieldLooseBase(this,M)[M]=t}onUpdate(t){babelHelpers.classPrivateFieldLooseBase(this,G)[G]=t}onHide(t){babelHelpers.classPrivateFieldLooseBase(this,U)[U]=t}}function z(){const t=m.Runtime.debounce(babelHelpers.classPrivateFieldLooseBase(this,D)[D],10,this);return new v.EntitySelectorDialog({context:"tasks-card",multiple:false,hideOnDeselect:true,enableSearch:true,entities:[{id:S.EntitySelectorEntity.Project}],preselectedItems:babelHelpers.classPrivateFieldLooseBase(this,N)[N],events:{"Item:onSelect":t,"Item:onDeselect":t,onHide:babelHelpers.classPrivateFieldLooseBase(this,R)[R],onDestroy:babelHelpers.classPrivateFieldLooseBase(this,W)[W],onLoad:babelHelpers.classPrivateFieldLooseBase(this,K)[K]}})}async function Y(){const t=await babelHelpers.classPrivateFieldLooseBase(this,K)[K]();babelHelpers.classPrivateFieldLooseBase(this,x)[x](t==null?void 0:t.getId())}function J(){return[[S.EntitySelectorEntity.Project,babelHelpers.classPrivateFieldLooseBase(this,X)[X].groupId]]}function Q(){return I.Core.getStore().getters[`${S.Model.Tasks}/getById`](babelHelpers.classPrivateFieldLooseBase(this,A)[A])}function Z(t){return I.Core.getStore().dispatch(`${S.Model.Groups}/insert`,t)}function tt(t){var e,s,i,o;void B.taskService.update(babelHelpers.classPrivateFieldLooseBase(this,A)[A],{groupId:t,stageId:0});(e=(s=babelHelpers.classPrivateFieldLooseBase(this,G))[G])==null?void 0:e.call(s);(i=(o=babelHelpers.classPrivateFieldLooseBase(this,M))[M])==null?void 0:i.call(o);babelHelpers.classPrivateFieldLooseBase(this,W)[W]()}const et=new q;const st={components:{BIcon:a.BIcon,BMenu:o.BMenu,Stage:E,Scrum:F,Hint:T.Hint,HoverPill:e.HoverPill,FieldAdd:s.FieldAdd,GroupPopup:H},props:{taskId:{type:[Number,String],required:true}},setup(){return{groupMeta:C,Outline:k.Outline}},data(){return{isMenuShown:false,isHintShown:false}},computed:{task(){return this.$store.getters[`${S.Model.Tasks}/getById`](this.taskId)},isEdit(){return Number.isInteger(this.taskId)&&this.taskId>0},group(){return this.$store.getters[`${S.Model.Groups}/getById`](this.task.groupId)},isScrum(){var t;return((t=this.group)==null?void 0:t.type)===S.GroupType.Scrum},menuOptions(){return{id:"tasks-field-group-menu",bindElement:this.$refs.group,offsetTop:8,items:[{title:this.getAboutItemTitle(),icon:k.Outline.FOLDER,onClick:this.openGroup},{title:this.loc("TASKS_V2_GROUP_CHANGE"),icon:k.Outline.EDIT_L,onClick:this.showDialog},{design:o.MenuItemDesign.Alert,title:this.loc("TASKS_V2_GROUP_CLEAR"),icon:k.Outline.CROSS_L,onClick:this.clearField}],targetContainer:document.body}},groupName(){var t,e;return(t=(e=this.group)==null?void 0:e.name)!=null?t:this.loc("TASKS_V2_GROUP_HIDDEN")},groupImage(){var t;return encodeURI((t=this.group)==null?void 0:t.image)},hintText(){return this.loc("TASKS_V2_GROUP_CANT_CHANGE_FLOW")},isSecret(){return Boolean(this.task.groupId)&&!this.group},hasFlow(){return this.task.flowId>0},readonly(){return!this.task.rights.edit||this.hasFlow}},mounted(){i.heightTransition.animate(this.$refs.container)},updated(){i.heightTransition.animate(this.$refs.container)},methods:{getAboutItemTitle(){var t,e;return(t={[S.GroupType.Collab]:this.loc("TASKS_V2_GROUP_ABOUT_COLLAB"),[S.GroupType.Scrum]:this.loc("TASKS_V2_GROUP_ABOUT_SCRUM")}[(e=this.group)==null?void 0:e.type])!=null?t:this.loc("TASKS_V2_GROUP_ABOUT")},handleClick(){if(!this.isEdit&&this.hasFlow){this.isHintShown=true;return}if(this.readonly){if(!this.isSecret){void this.openGroup()}return}if(this.isEdit&&this.group){this.showMenu()}else{this.showDialog()}},showMenu(){this.isMenuShown=true},openGroup(){void c.openGroup(this.group.id,this.group.type)},showDialog(){et.setTaskId(this.taskId).showTo(this.$refs.group)},clearField(){void B.taskService.update(this.taskId,{groupId:0,stageId:0})}},template:`\n\t\t<div\n\t\t\t:data-task-id="taskId"\n\t\t\t:data-task-field-id="groupMeta.id"\n\t\t\t:data-task-field-value="task.groupId"\n\t\t\tref="container"\n\t\t>\n\t\t\t<div class="tasks-field-group-group" :class="{ '--secret': isSecret }" ref="group" @click="handleClick">\n\t\t\t\t<HoverPill\n\t\t\t\t\tv-if="task.groupId"\n\t\t\t\t\t:withClear="!readonly && !isEdit && (task.flowId ?? 0) <= 0"\n\t\t\t\t\t@clear="clearField"\n\t\t\t\t>\n\t\t\t\t\t<img v-if="groupImage" class="tasks-field-group-image" :src="groupImage" :alt="groupName"/>\n\t\t\t\t\t<BIcon v-else class="tasks-field-group-icon" :name="Outline.FOLDER"/>\n\t\t\t\t\t<div class="tasks-field-group-title">{{ groupName }}</div>\n\t\t\t\t</HoverPill>\n\t\t\t\t<FieldAdd v-else :icon="Outline.FOLDER_PLUS"/>\n\t\t\t</div>\n\t\t\t<Stage v-if="isEdit && group && !task.flowId" :taskId="taskId"/>\n\t\t\t<Scrum v-if="isScrum && !task.flowId" :taskId="taskId"/>\n\t\t</div>\n\t\t<Hint\n\t\t\tv-if="isHintShown"\n\t\t\t:bindElement="$refs.container"\n\t\t\t@close="isHintShown = false"\n\t\t>\n\t\t\t{{ hintText }}\n\t\t</Hint>\n\t\t<BMenu v-if="isMenuShown" :options="menuOptions" @close="isMenuShown = false"/>\n\t\t<GroupPopup :taskId="taskId" :getBindElement="() => $refs.group"/>\n\t`};const it={components:{Chip:b.Chip,Hint:T.Hint,GroupPopup:H},inject:["analytics","cardType"],props:{taskId:{type:[Number,String],required:true},isAutonomous:{type:Boolean,default:false}},setup(){return{groupMeta:C}},data(){return{doShowHint:false}},computed:{task(){return this.$store.getters[`${S.Model.Tasks}/getById`](this.taskId)},group(){return this.$store.getters[`${S.Model.Groups}/getById`](this.task.groupId)},design(){return{[!this.isAutonomous&&!this.isSelected]:b.ChipDesign.ShadowNoAccent,[!this.isAutonomous&&this.isSelected]:b.ChipDesign.ShadowAccent,[this.isAutonomous&&!this.isSelected]:b.ChipDesign.OutlineNoAccent,[this.isAutonomous&&this.isSelected]:b.ChipDesign.OutlineAccent}.true},isSelected(){if(this.isAutonomous){return this.task.groupId>0}return this.$store.getters[`${S.Model.Tasks}/wasFieldFilled`](this.taskId,C.id)},isFilled(){return Boolean(this.isAutonomous&&this.group)},isFlowFilled(){return this.task.flowId>0},text(){if(this.isFilled){var t,e;return(t=(e=this.group)==null?void 0:e.name)!=null?t:this.loc("TASKS_V2_GROUP_HIDDEN")}return this.loc("TASKS_V2_GROUP_TITLE_CHIP")},icon(){if(this.isFilled){return null}return k.Outline.FOLDER},image(){var t,e;if(!this.isFilled){return null}return{src:encodeURI((t=this.group)==null?void 0:t.image),alt:(e=this.group)==null?void 0:e.name}},canChange(){var t;return((t=this.task.flowId)!=null?t:0)<=0},hintText(){return this.loc("TASKS_V2_GROUP_CANT_CHANGE_FLOW")},readonly(){return!this.task.rights.edit},isLocked(){return!I.Core.getParams().limits.project}},created(){et.setTaskId(this.taskId).init()},methods:{handleClick(){if(this.isLocked){void m.Runtime.loadExtension("tasks.limit").then((t=>{const{Limit:e}=t;e.showInstance({featureId:I.Core.getParams().limits.projectFeatureId})}));return}if(!this.isAutonomous&&this.isSelected){this.highlightField();return}if(this.isFlowFilled){this.doShowHint=true;return}et.setTaskId(this.taskId).showTo(this.$refs.chip.$el);if(!this.isAutonomous){et.onUpdateOnce(this.highlightField)}et.onHide(this.handleFieldClose);et.onUpdate(this.handleUpdate)},highlightField(){void P.fieldHighlighter.setContainer(this.$root.$el).highlight(C.id)},handleClear(){void B.taskService.update(this.taskId,{groupId:0,stageId:0})},handleFieldClose(){if(this.isAutonomous){var t;(t=this.$refs.chip)==null?void 0:t.$el.focus()}},handleUpdate(){y.analytics.sendAddProject(this.analytics,{cardType:this.cardType,viewersCount:this.task.auditorsIds.length,coexecutorsCount:this.task.accomplicesIds.length})}},template:`\n\t\t<Chip\n\t\t\tv-if="isSelected || !readonly"\n\t\t\t:design="design"\n\t\t\t:icon="icon"\n\t\t\t:image="image"\n\t\t\t:text="text"\n\t\t\t:withClear="isFilled && !isFlowFilled"\n\t\t\t:lock="isLocked"\n\t\t\t:trimmable="isFilled"\n\t\t\t:data-task-id="taskId"\n\t\t\t:data-task-chip-id="groupMeta.id"\n\t\t\t:data-task-chip-value="task.groupId"\n\t\t\tref="chip"\n\t\t\t@click="handleClick"\n\t\t\t@clear="handleClear"\n\t\t/>\n\t\t<Hint\n\t\t\tv-if="doShowHint"\n\t\t\t:bindElement="$refs.chip.$el"\n\t\t\t@close="doShowHint = false"\n\t\t>\n\t\t\t{{ hintText }}\n\t\t</Hint>\n\t\t<GroupPopup v-if="isAutonomous" :taskId="taskId" :getBindElement="() => $refs.chip.$el"/>\n\t`};t.Group=st;t.Stage=E;t.GroupChip=it;t.groupMeta=C})(this.BX.Tasks.V2.Component.Fields=this.BX.Tasks.V2.Component.Fields||{},BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Lib,BX.UI.Vue3.Components,BX,BX.Tasks.V2.Component.Elements,BX.UI.IconSet,BX.Tasks.V2.Lib,BX.Vue3.Directives,BX.UI.Vue3.Components,BX.Vue3.Components,BX.Tasks.V2.Lib,BX.Tasks.V2.Provider.Service,BX.Tasks.V2.Provider.Service,BX.Tasks.V2.Lib,BX,BX.UI.IconSet,BX,BX.Tasks.V2,BX.Tasks.V2.Const,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Lib,BX.Tasks.V2.Lib,BX.Tasks.V2.Provider.Service);
//# sourceMappingURL=group.bundle.map.js