{"version":3,"file":"relation-tasks.bundle.js","sources":["../src/relation-tasks.js","../src/relation-tasks-chip.js"],"sourcesContent":["import { EventEmitter } from 'main.core.events';\nimport { hint, type HintParams } from 'ui.vue3.directives.hint';\nimport { TextMd } from 'ui.system.typography.vue';\nimport { BIcon, Outline } from 'ui.icon-set.api.vue';\nimport 'ui.icon-set.actions';\n\nimport { EventName, Model } from 'tasks.v2.const';\nimport { TaskList } from 'tasks.v2.component.task-list';\nimport { tooltip } from 'tasks.v2.component.elements.hint';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nimport { RelationMeta } from './types';\nimport './relation-tasks.css';\n\n// @vue/component\nexport const RelationTasks = {\n\tname: 'TaskRelationTasks',\n\tcomponents: {\n\t\tBIcon,\n\t\tTaskList,\n\t\tTextMd,\n\t},\n\tdirectives: { hint },\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\t/** @type RelationMeta */\n\t\tmeta: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tsetup(): { meta: RelationMeta }\n\t{\n\t\treturn {\n\t\t\tOutline,\n\t\t};\n\t},\n\tcomputed: {\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.taskId);\n\t\t},\n\t\tisEdit(): boolean\n\t\t{\n\t\t\treturn Number.isInteger(this.taskId) && this.taskId > 0;\n\t\t},\n\t\tids(): number[]\n\t\t{\n\t\t\treturn [...this.task[this.meta.idsField]].sort((a, b) => b - a);\n\t\t},\n\t\ttext(): string\n\t\t{\n\t\t\tif (this.ids.length > 0)\n\t\t\t{\n\t\t\t\treturn this.loc(this.meta.countLoc, {\n\t\t\t\t\t'#COUNT#': this.ids.length,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn this.meta.title;\n\t\t},\n\t\tcontext(): string\n\t\t{\n\t\t\treturn this.meta.id;\n\t\t},\n\t\treadonly(): boolean\n\t\t{\n\t\t\treturn !this.task.rights.edit;\n\t\t},\n\t\ttooltip(): Function\n\t\t{\n\t\t\treturn (): HintParams => tooltip({\n\t\t\t\ttext: this.meta.hint,\n\t\t\t\tpopupOptions: {\n\t\t\t\t\toffsetLeft: this.$refs.add.$el.offsetWidth / 2,\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t},\n\twatch: {\n\t\tids(newIds: number[], oldIds: number[]): void\n\t\t{\n\t\t\tif ([...newIds || []].sort().join(',') === [...oldIds || []].sort().join(','))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.meta.service.hasUnloadedIds(this.taskId))\n\t\t\t{\n\t\t\t\tvoid this.meta.service.list(this.taskId);\n\t\t\t}\n\t\t},\n\t},\n\tcreated(): void\n\t{\n\t\tif (!this.meta.service.areIdsLoaded(this.taskId) || this.meta.service.hasUnloadedIds(this.taskId))\n\t\t{\n\t\t\tvoid this.meta.service.list(this.taskId, true);\n\t\t}\n\t},\n\tmethods: {\n\t\thandleTitleClick(): void\n\t\t{\n\t\t\tif (this.isEdit && (this.readonly || this.task[this.meta.containsField]))\n\t\t\t{\n\t\t\t\tthis.openGrid();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.showDialog();\n\t\t},\n\t\topenGrid(): void\n\t\t{\n\t\t\tEventEmitter.emit(EventName.OpenGrid, {\n\t\t\t\ttaskId: this.taskId,\n\t\t\t\ttype: this.meta.id,\n\t\t\t});\n\t\t},\n\t\tshowDialog(): void\n\t\t{\n\t\t\tthis.meta.dialog.setTaskId(this.taskId).showTo(this.$refs.add.$el);\n\t\t},\n\t\tasync handleRemove(id: number): void\n\t\t{\n\t\t\tawait this.meta.service.delete(this.taskId, [id]);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"tasks-field-relation-tasks\"\n\t\t\t:data-task-id=\"taskId\"\n\t\t\t:data-task-field-id=\"meta.id\"\n\t\t>\n\t\t\t<div class=\"tasks-field-relation-tasks-title\">\n\t\t\t\t<div\n\t\t\t\t\tclass=\"tasks-field-relation-tasks-main\"\n\t\t\t\t\tdata-task-relation-open\n\t\t\t\t\t@click=\"handleTitleClick\"\n\t\t\t\t>\n\t\t\t\t\t<BIcon :name=\"meta.icon\"/>\n\t\t\t\t\t<TextMd :accent=\"true\">{{ text }}</TextMd>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"!readonly\"\n\t\t\t\t\tv-hint=\"tooltip\"\n\t\t\t\t\tclass=\"tasks-field-relation-tasks-add-container\"\n\t\t\t\t>\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\tclass=\"tasks-field-relation-tasks-icon\"\n\t\t\t\t\t\t:name=\"Outline.PLUS_L\"\n\t\t\t\t\t\t:hoverable=\"true\"\n\t\t\t\t\t\t:data-task-relation-add=\"meta.id\"\n\t\t\t\t\t\tref=\"add\"\n\t\t\t\t\t\t@click=\"showDialog\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<TaskList\n\t\t\t\tv-if=\"task[meta.containsField]\"\n\t\t\t\t:taskIds=\"ids\"\n\t\t\t\t:context=\"context\"\n\t\t\t\t:readonly=\"readonly\"\n\t\t\t\t@openMore=\"openGrid\"\n\t\t\t\t@removeTask=\"handleRemove\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { Model } from 'tasks.v2.const';\nimport { Chip, ChipDesign } from 'tasks.v2.component.elements.chip';\nimport { fieldHighlighter } from 'tasks.v2.lib.field-highlighter';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\n// @vue/component\nexport const RelationTasksChip = {\n\tcomponents: {\n\t\tChip,\n\t},\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\t/** @type RelationMeta */\n\t\tmeta: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tdisabled: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tcomputed: {\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.taskId);\n\t\t},\n\t\tcount(): number\n\t\t{\n\t\t\treturn this.task[this.meta.idsField].length;\n\t\t},\n\t\tdesign(): string\n\t\t{\n\t\t\tif (this.disabled)\n\t\t\t{\n\t\t\t\treturn ChipDesign.ShadowDisabled;\n\t\t\t}\n\n\t\t\treturn this.isSelected ? ChipDesign.ShadowAccent : ChipDesign.ShadowNoAccent;\n\t\t},\n\t\tisSelected(): boolean\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/wasFieldFilled`](this.taskId, this.meta.id);\n\t\t},\n\t\treadonly(): boolean\n\t\t{\n\t\t\treturn !this.task.rights.edit;\n\t\t},\n\t},\n\tmethods: {\n\t\thandleClick(): void\n\t\t{\n\t\t\tif (this.disabled)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.isSelected)\n\t\t\t{\n\t\t\t\tthis.highlightField();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.meta.dialog.setTaskId(this.taskId).onUpdateOnce(this.highlightField).showTo(this.$el);\n\t\t},\n\t\thighlightField(): void\n\t\t{\n\t\t\tvoid fieldHighlighter.setContainer(this.$root.$el).highlight(this.meta.id);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Chip\n\t\t\tv-if=\"isSelected || !readonly\"\n\t\t\t:design=\"design\"\n\t\t\t:text=\"meta.chipTitle\"\n\t\t\t:icon=\"meta.icon\"\n\t\t\t:data-task-id=\"taskId\"\n\t\t\t:data-task-chip-id=\"meta.id\"\n\t\t\tref=\"chip\"\n\t\t\t@click=\"handleClick\"\n\t\t/>\n\t`,\n};\n"],"names":["RelationTasks","name","components","BIcon","TaskList","TextMd","directives","hint","props","taskId","type","Number","String","required","meta","Object","setup","Outline","computed","task","$store","getters","Model","Tasks","isEdit","isInteger","ids","idsField","sort","a","b","text","length","loc","countLoc","title","context","id","readonly","rights","edit","tooltip","popupOptions","offsetLeft","$refs","add","$el","offsetWidth","watch","newIds","oldIds","join","service","hasUnloadedIds","list","created","areIdsLoaded","methods","handleTitleClick","containsField","openGrid","showDialog","EventEmitter","emit","EventName","OpenGrid","dialog","setTaskId","showTo","handleRemove","delete","template","RelationTasksChip","Chip","disabled","Boolean","default","count","design","ChipDesign","ShadowDisabled","isSelected","ShadowAccent","ShadowNoAccent","handleClick","highlightField","onUpdateOnce","fieldHighlighter","setContainer","$root","highlight"],"mappings":"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"}