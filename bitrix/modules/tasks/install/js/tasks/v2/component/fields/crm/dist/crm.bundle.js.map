{"version":3,"file":"crm.bundle.js","sources":["../src/crm-item.js","../src/crm-meta.js","../src/crm-dialog.js","../src/crm.js","../src/crm-chip.js"],"sourcesContent":["import { RichLoc } from 'ui.vue3.components.rich-loc';\nimport { TextMd } from 'ui.system.typography.vue';\nimport { BMenu, type MenuItemOptions, type MenuOptions } from 'ui.system.menu.vue';\nimport { Outline } from 'ui.icon-set.api.core';\nimport 'ui.icon-set.outline';\n\nimport { HoverPill } from 'tasks.v2.component.elements.hover-pill';\nimport { hrefClick } from 'tasks.v2.lib.href-click';\nimport type { CrmItemModel } from 'tasks.v2.model.crm-items';\n\nimport './crm.css';\n\n// @vue/component\nexport const CrmItem = {\n\tcomponents: {\n\t\tHoverPill,\n\t\tTextMd,\n\t\tRichLoc,\n\t\tBMenu,\n\t},\n\tprops: {\n\t\t/**\n\t\t * @type CrmItemModel\n\t\t */\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tisEdit: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\treadonly: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['edit', 'clear'],\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tisMenuShown: false,\n\t\t};\n\t},\n\tcomputed: {\n\n\t\tmenuOptions(): MenuOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tid: `tasks-crm-menu-${this.item.id}`,\n\t\t\t\tbindElement: this.$refs.pill.$el,\n\t\t\t\toffsetTop: 8,\n\t\t\t\titems: this.menuItems,\n\t\t\t\ttargetContainer: document.body,\n\t\t\t};\n\t\t},\n\t\tmenuItems(): MenuItemOptions[]\n\t\t{\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\ttitle: this.loc('TASKS_V2_CRM_OPEN'),\n\t\t\t\t\ticon: Outline.GO_TO_L,\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\tid: 'tasks-crm-menu-open',\n\t\t\t\t\t},\n\t\t\t\t\tonClick: () => hrefClick(this.item.link),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttitle: this.loc('TASKS_V2_CRM_EDIT'),\n\t\t\t\t\ticon: Outline.EDIT_L,\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\tid: 'tasks-crm-menu-edit',\n\t\t\t\t\t},\n\t\t\t\t\tonClick: () => this.$emit('edit'),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttitle: this.loc('TASKS_V2_CRM_UNLINK'),\n\t\t\t\t\ticon: Outline.CROSS_L,\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\tid: 'tasks-crm-menu-unlink',\n\t\t\t\t\t},\n\t\t\t\t\tonClick: this.clear,\n\t\t\t\t},\n\t\t\t];\n\t\t},\n\t},\n\tmethods: {\n\t\tprepareTitle(item: CrmItemModel): string\n\t\t{\n\t\t\treturn this.loc('TASKS_V2_CRM_ENTITY_TITLE', {\n\t\t\t\t'#TYPE_NAME#': item.typeName,\n\t\t\t\t'#TITLE#': item.title,\n\t\t\t});\n\t\t},\n\t\thandleClick(): void\n\t\t{\n\t\t\tif (!this.isEdit)\n\t\t\t{\n\t\t\t\threfClick(this.item.link);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.readonly)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isMenuShown = true;\n\t\t},\n\t\tclear(): void\n\t\t{\n\t\t\tthis.$emit('clear', this.item.id);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"tasks-field-crm-item-container\">\n\t\t\t<HoverPill\n\t\t\t\tclass=\"tasks-field-crm-item\"\n\t\t\t\t:withClear=\"!readonly && !isEdit\"\n\t\t\t\t:readonly=\"readonly\"\n\t\t\t\tref=\"pill\"\n\t\t\t\t@click.stop=\"handleClick\"\n\t\t\t\t@clear=\"clear\"\n\t\t\t>\n\t\t\t\t<TextMd class=\"tasks-field-crm-item-text\">\n\t\t\t\t\t<RichLoc tag=\"span\" :text=\"prepareTitle(item)\" placeholder=\"[a]\">\n\t\t\t\t\t\t<template #a=\"{ text }\">\n\t\t\t\t\t\t\t<a @click.prevent>{{ text }}</a>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</RichLoc>\n\t\t\t\t</TextMd>\n\t\t\t</HoverPill>\n\t\t</div>\n\t\t<BMenu v-if=\"isMenuShown\" :options=\"menuOptions\" @close=\"isMenuShown = false\"/>\n\t`,\n};\n","import { Loc } from 'main.core';\nimport { TaskField } from 'tasks.v2.const';\n\nexport const crmMeta = Object.freeze({\n\tid: TaskField.Crm,\n\ttitle: Loc.getMessage('TASKS_V2_CRM_TITLE'),\n});\n","import { Extension } from 'main.core';\nimport type { Store } from 'ui.vue3.vuex';\nimport type { Item } from 'ui.entity-selector';\n\nimport { Core } from 'tasks.v2.core';\nimport { EntitySelectorEntity, Model } from 'tasks.v2.const';\nimport { CrmMappers } from 'tasks.v2.provider.service.crm-service';\nimport { taskService } from 'tasks.v2.provider.service.task-service';\nimport { EntitySelectorDialog, type ItemId } from 'tasks.v2.lib.entity-selector-dialog';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\nimport type { CrmItemModel } from 'tasks.v2.model.crm-items';\n\nconst crmIntegration = Extension.getSettings('tasks.v2.component.fields.crm').crmIntegration;\nconst dynamicTypeIds = Object.entries(crmIntegration)\n\t.filter(([entityId, enabled]) => enabled === 'Y' && entityId.startsWith('DYNAMIC_'))\n\t.map(([entityId]) => Number(entityId.slice(8)))\n;\n\nclass CrmDialog\n{\n\t#taskId: number | string;\n\t#dialog: EntitySelectorDialog;\n\t#onUpdateOnce: Function | null = null;\n\t#onCloseOnce: Function | null = null;\n\n\tsetTaskId(taskId: number | string): CrmDialog\n\t{\n\t\tthis.#taskId = taskId;\n\n\t\treturn this;\n\t}\n\n\tshowTo(targetNode: HTMLElement): void\n\t{\n\t\tthis.#dialog ??= this.#createDialog();\n\t\tthis.#dialog.selectItemsByIds(this.#items);\n\t\tthis.#dialog.showTo(targetNode);\n\t}\n\n\tonUpdateOnce(callback: Function): void\n\t{\n\t\tthis.#onUpdateOnce = callback;\n\t}\n\n\tonCloseOnce(callback: Function): CrmDialog\n\t{\n\t\tthis.#onCloseOnce = callback;\n\n\t\treturn this;\n\t}\n\n\t#createDialog(): EntitySelectorDialog\n\t{\n\t\tlet changed = false;\n\t\tconst handleChanged = (): void => {\n\t\t\tchanged = true;\n\t\t};\n\n\t\tconst handleClose = async (): Promise<void> => {\n\t\t\tif (changed)\n\t\t\t{\n\t\t\t\tvoid this.#handleItemChange();\n\n\t\t\t\tchanged = false;\n\t\t\t}\n\n\t\t\tthis.#onCloseOnce?.();\n\t\t\tthis.#onCloseOnce = null;\n\t\t};\n\n\t\treturn new EntitySelectorDialog({\n\t\t\tcontext: 'tasks-card',\n\t\t\tmultiple: true,\n\t\t\tenableSearch: true,\n\t\t\tentities: [\n\t\t\t\tEntitySelectorEntity.Deal,\n\t\t\t\tEntitySelectorEntity.Contact,\n\t\t\t\tEntitySelectorEntity.Company,\n\t\t\t\tEntitySelectorEntity.Lead,\n\t\t\t\tEntitySelectorEntity.SmartInvoice,\n\t\t\t\tEntitySelectorEntity.DynamicMultiple,\n\t\t\t].map((entityId: string) => ({\n\t\t\t\tid: entityId,\n\t\t\t\tdynamicLoad: true,\n\t\t\t\tdynamicSearch: true,\n\t\t\t\toptions: {\n\t\t\t\t\tdynamicTypeIds,\n\t\t\t\t\tshowTab: true,\n\t\t\t\t},\n\t\t\t})),\n\t\t\tpreselectedItems: this.#items,\n\t\t\tevents: {\n\t\t\t\t'Item:onSelect': handleChanged,\n\t\t\t\t'Item:onDeselect': handleChanged,\n\t\t\t\tonHide: this.#clearOnUpdateOnce,\n\t\t\t\tonDestroy: this.#clearOnUpdateOnce,\n\t\t\t\tonLoad: this.#insertSelectedCrmItems,\n\t\t\t},\n\t\t\tpopupOptions: {\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: handleClose,\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\tasync #handleItemChange(): Promise<void>\n\t{\n\t\tconst crmItems = await this.#insertSelectedCrmItems();\n\n\t\tthis.#updateTask(crmItems.map(({ id }) => id));\n\t}\n\n\t#insertSelectedCrmItems = async (): Promise<CrmItemModel[]> => {\n\t\tconst crmItems = this.#dialog.getSelectedItems().map((item: Item) => this.#mapItemToModel(item));\n\n\t\tawait this.#insertCrmItems(crmItems);\n\n\t\treturn crmItems;\n\t};\n\n\t#updateTask(crmItemIds: string[]): void\n\t{\n\t\tvoid taskService.update(\n\t\t\tthis.#taskId,\n\t\t\t{ crmItemIds },\n\t\t);\n\n\t\tthis.#onUpdateOnce?.();\n\t\tthis.#clearOnUpdateOnce();\n\t}\n\n\t#mapItemToModel(item: Item): CrmItemModel\n\t{\n\t\tconst entityInfo = item.getCustomData().get('entityInfo');\n\n\t\treturn {\n\t\t\tid: CrmMappers.mapId(entityInfo.type, item.getId()),\n\t\t\tentityId: item.getId(),\n\t\t\ttype: item.getEntityId(),\n\t\t\ttypeName: entityInfo.typeNameTitle,\n\t\t\ttitle: item.getTitle(),\n\t\t\tlink: entityInfo.url,\n\t\t};\n\t}\n\n\t#clearOnUpdateOnce = (): void => {\n\t\tthis.#onUpdateOnce = null;\n\t};\n\n\tget #items(): ItemId[]\n\t{\n\t\treturn this.#task.crmItemIds?.map((id) => CrmMappers.splitId(id)) ?? [];\n\t}\n\n\tget #task(): TaskModel\n\t{\n\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.#taskId);\n\t}\n\n\tasync #insertCrmItems(crmItems: CrmItemModel[]): Promise<void>\n\t{\n\t\tawait this.$store.dispatch(`${Model.CrmItems}/upsertMany`, crmItems);\n\t}\n\n\tget $store(): Store\n\t{\n\t\treturn Core.getStore();\n\t}\n}\n\nexport const crmDialog = new CrmDialog();\n","import { TextSm } from 'ui.system.typography.vue';\nimport { BLine } from 'ui.system.skeleton.vue';\nimport { Outline } from 'ui.icon-set.api.vue';\nimport 'ui.icon-set.outline';\n\nimport { Model } from 'tasks.v2.const';\nimport { AddBackground } from 'tasks.v2.component.elements.add-background';\nimport { FieldAdd } from 'tasks.v2.component.elements.field-add';\nimport { crmService } from 'tasks.v2.provider.service.crm-service';\nimport { taskService } from 'tasks.v2.provider.service.task-service';\nimport type { CrmItemModel } from 'tasks.v2.model.crm-items';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nimport { CrmItem } from './crm-item';\nimport { crmMeta } from './crm-meta';\nimport { crmDialog } from './crm-dialog';\nimport './crm.css';\n\nconst maxCount = 7;\n\n// @vue/component\nexport const Crm = {\n\tcomponents: {\n\t\tAddBackground,\n\t\tTextSm,\n\t\tBLine,\n\t\tFieldAdd,\n\t\tCrmItem,\n\t},\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t},\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tOutline,\n\t\t\tcrmMeta,\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tisDialogShown: false,\n\t\t\tisExpanded: false,\n\t\t};\n\t},\n\tcomputed: {\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.taskId);\n\t\t},\n\t\tisEdit(): boolean\n\t\t{\n\t\t\treturn Number.isInteger(this.taskId) && this.taskId > 0;\n\t\t},\n\t\tcrmItems(): CrmItemModel[]\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.CrmItems}/getByIds`](this.task.crmItemIds);\n\t\t},\n\t\tvisibleItems(): CrmItemModel[]\n\t\t{\n\t\t\treturn this.crmItems.slice(0, maxCount);\n\t\t},\n\t\tcollapsedItems(): CrmItemModel[]\n\t\t{\n\t\t\treturn this.crmItems.slice(maxCount);\n\t\t},\n\t\tisLoading(): boolean\n\t\t{\n\t\t\treturn this.task.crmItemIds?.length && !this.crmItems?.length;\n\t\t},\n\t\treadonly(): boolean\n\t\t{\n\t\t\treturn !this.task.rights.edit;\n\t\t},\n\t\texpandButtonText(): string\n\t\t{\n\t\t\tif (this.isExpanded)\n\t\t\t{\n\t\t\t\treturn this.loc('TASKS_V2_CRM_COLLAPSE');\n\t\t\t}\n\n\t\t\treturn this.loc('TASKS_V2_CRM_AND_COUNT', {\n\t\t\t\t'#COUNT#': this.collapsedItems.length,\n\t\t\t});\n\t\t},\n\t},\n\tmounted(): void\n\t{\n\t\tvoid crmService.list(this.taskId, this.task.crmItemIds);\n\t},\n\tmethods: {\n\t\thandleClick(): void\n\t\t{\n\t\t\tif (this.readonly)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.showDialog();\n\t\t},\n\t\tshowDialog(): void\n\t\t{\n\t\t\tcrmDialog.setTaskId(this.taskId).onCloseOnce(this.handleClose).showTo(this.$refs.anchor);\n\n\t\t\tthis.isDialogShown = true;\n\t\t},\n\t\thandleClose(): void\n\t\t{\n\t\t\tthis.isDialogShown = false;\n\t\t},\n\t\thandleClear(crmItemId: string): void\n\t\t{\n\t\t\tconst crmItemIds = this.task.crmItemIds.filter((id) => id !== crmItemId);\n\n\t\t\tvoid taskService.update(\n\t\t\t\tthis.taskId,\n\t\t\t\t{ crmItemIds },\n\t\t\t);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<AddBackground v-if=\"!readonly\" :isActive=\"isDialogShown\" @click=\"handleClick\"/>\n\t\t<div\n\t\t\tclass=\"tasks-field-crm\"\n\t\t\t:data-task-id=\"taskId\"\n\t\t\t:data-task-field-id=\"crmMeta.id\"\n\t\t\t:data-task-crm-item-ids=\"task.crmItemIds?.join(',')\"\n\t\t>\n\t\t\t<FieldAdd v-if=\"!task.crmItemIds?.length\" :icon=\"Outline.CRM\"/>\n\t\t\t<div v-if=\"isLoading\" class=\"tasks-field-crm-skeleton\">\n\t\t\t\t<template v-for=\"crmItemId in task.crmItemIds\" :key=\"crmItemId\">\n\t\t\t\t\t<BLine :height=\"20\"/>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t\t<template v-for=\"item in visibleItems\" :key=\"item.id\">\n\t\t\t\t<CrmItem\n\t\t\t\t\t:item=\"item\"\n\t\t\t\t\t:isEdit=\"isEdit\"\n\t\t\t\t\t:readonly=\"readonly\"\n\t\t\t\t\t@edit=\"showDialog\"\n\t\t\t\t\t@clear=\"handleClear(item.id)\"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<template v-if=\"isExpanded\" v-for=\"item in collapsedItems\" :key=\"item.id\">\n\t\t\t\t<CrmItem\n\t\t\t\t\t:item=\"item\"\n\t\t\t\t\t:isEdit=\"isEdit\"\n\t\t\t\t\t:readonly=\"readonly\"\n\t\t\t\t\t@edit=\"showDialog\"\n\t\t\t\t\t@clear=\"handleClear(item.id)\"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<TextSm\n\t\t\t\tv-if=\"collapsedItems.length > 0\"\n\t\t\t\tclass=\"tasks-field-crm-expand\"\n\t\t\t\t@click.capture.stop=\"isExpanded = !isExpanded\"\n\t\t\t>\n\t\t\t\t{{ expandButtonText }}\n\t\t\t</TextSm>\n\t\t</div>\n\t\t<div class=\"tasks-field-crm-anchor\" ref=\"anchor\"></div>\n\t`,\n};\n","import { Chip, ChipDesign } from 'ui.system.chip.vue';\nimport { Outline } from 'ui.icon-set.api.core';\nimport 'ui.icon-set.outline';\n\nimport { Model } from 'tasks.v2.const';\nimport { fieldHighlighter } from 'tasks.v2.lib.field-highlighter';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nimport { crmMeta } from './crm-meta';\nimport { crmDialog } from './crm-dialog';\nimport './crm.css';\n\n// @vue/component\nexport const CrmChip = {\n\tcomponents: {\n\t\tChip,\n\t},\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t},\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tOutline,\n\t\t\tcrmMeta,\n\t\t};\n\t},\n\tcomputed: {\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.taskId);\n\t\t},\n\t\tdesign(): string\n\t\t{\n\t\t\treturn this.isSelected ? ChipDesign.ShadowAccent : ChipDesign.ShadowNoAccent;\n\t\t},\n\t\tisSelected(): boolean\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/wasFieldFilled`](this.taskId, crmMeta.id);\n\t\t},\n\t\treadonly(): boolean\n\t\t{\n\t\t\treturn !this.task.rights.edit;\n\t\t},\n\t},\n\tmethods: {\n\t\thandleClick(): void\n\t\t{\n\t\t\tif (this.isSelected)\n\t\t\t{\n\t\t\t\tthis.highlightField();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcrmDialog.setTaskId(this.taskId).showTo(this.$el);\n\t\t\tcrmDialog.onUpdateOnce(this.highlightField);\n\t\t},\n\t\thighlightField(): void\n\t\t{\n\t\t\tvoid fieldHighlighter.setContainer(this.$root.$el).highlight(crmMeta.id);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Chip\n\t\t\tv-if=\"isSelected || !readonly\"\n\t\t\t:design=\"design\"\n\t\t\t:icon=\"Outline.CRM\"\n\t\t\t:text=\"loc('TASKS_V2_CRM_TITLE_CHIP')\"\n\t\t\t:data-task-id=\"taskId\"\n\t\t\t:data-task-chip-id=\"crmMeta.id\"\n\t\t\t:data-task-crm-item-ids=\"task.crmItemIds?.join(',')\"\n\t\t\t@click=\"handleClick\"\n\t\t/>\n\t`,\n};\n"],"names":["CrmItem","components","HoverPill","TextMd","RichLoc","BMenu","props","item","type","Object","required","isEdit","Boolean","readonly","emits","data","isMenuShown","computed","menuOptions","id","bindElement","$refs","pill","$el","offsetTop","items","menuItems","targetContainer","document","body","title","loc","icon","Outline","GO_TO_L","dataset","onClick","hrefClick","link","EDIT_L","$emit","CROSS_L","clear","methods","prepareTitle","typeName","handleClick","template","crmMeta","freeze","TaskField","Crm","Loc","getMessage","crmIntegration","Extension","getSettings","dynamicTypeIds","entries","filter","entityId","enabled","startsWith","map","Number","slice","CrmDialog","crmItems","getSelectedItems","setTaskId","taskId","showTo","targetNode","selectItemsByIds","onUpdateOnce","callback","onCloseOnce","$store","Core","getStore","changed","handleChanged","handleClose","EntitySelectorDialog","context","multiple","enableSearch","entities","EntitySelectorEntity","Deal","Contact","Company","Lead","SmartInvoice","DynamicMultiple","dynamicLoad","dynamicSearch","options","showTab","preselectedItems","events","onHide","onDestroy","onLoad","popupOptions","onClose","crmItemIds","taskService","update","entityInfo","getCustomData","get","CrmMappers","mapId","getId","getEntityId","typeNameTitle","getTitle","url","splitId","getters","Model","Tasks","dispatch","CrmItems","crmDialog","maxCount","AddBackground","TextSm","BLine","FieldAdd","String","setup","isDialogShown","isExpanded","task","isInteger","visibleItems","collapsedItems","isLoading","length","rights","edit","expandButtonText","mounted","crmService","list","showDialog","anchor","handleClear","crmItemId","CrmChip","Chip","design","isSelected","ChipDesign","ShadowAccent","ShadowNoAccent","highlightField","fieldHighlighter","setContainer","$root","highlight"],"mappings":"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"}