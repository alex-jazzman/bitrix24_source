this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};this.BX.Tasks.V2=this.BX.Tasks.V2||{};this.BX.Tasks.V2.Component=this.BX.Tasks.V2.Component||{};(function(e,t,s,a,i,l,r,o,n,d,c,h,p,u){"use strict";const g=Object.freeze({id:h.TaskField.Tags,title:i.Loc.getMessage("TASKS_V2_TAGS_TITLE")});const b={};var v=babelHelpers.classPrivateFieldLooseKey("taskId");var k=babelHelpers.classPrivateFieldLooseKey("onCloseOnce");var I=babelHelpers.classPrivateFieldLooseKey("onUpdateOnce");var B=babelHelpers.classPrivateFieldLooseKey("getItems");var T=babelHelpers.classPrivateFieldLooseKey("getDialog");var m=babelHelpers.classPrivateFieldLooseKey("updateTask");var F=babelHelpers.classPrivateFieldLooseKey("getTask");var f=babelHelpers.classPrivateFieldLooseKey("currentUserId");class y{constructor(){Object.defineProperty(this,f,{get:H,set:void 0});Object.defineProperty(this,F,{value:C});Object.defineProperty(this,m,{value:S});Object.defineProperty(this,T,{value:L});Object.defineProperty(this,B,{value:P});Object.defineProperty(this,v,{writable:true,value:void 0});Object.defineProperty(this,k,{writable:true,value:null});Object.defineProperty(this,I,{writable:true,value:null})}setTaskId(e){babelHelpers.classPrivateFieldLooseBase(this,v)[v]=e;return this}onCloseOnce(e){babelHelpers.classPrivateFieldLooseBase(this,k)[k]=e;return this}onUpdateOnce(e){babelHelpers.classPrivateFieldLooseBase(this,I)[I]=e}showTo(e){const t=babelHelpers.classPrivateFieldLooseBase(this,T)[T](babelHelpers.classPrivateFieldLooseBase(this,v)[v]);if(t.isLoaded()&&!t.isOpen()){t.selectItemsByIds(babelHelpers.classPrivateFieldLooseBase(this,B)[B](babelHelpers.classPrivateFieldLooseBase(this,v)[v]))}t.showTo(e)}updateItems(){const e=babelHelpers.classPrivateFieldLooseBase(this,T)[T](babelHelpers.classPrivateFieldLooseBase(this,v)[v]);if(e.isLoaded()&&e.isOpen()){e.selectItemsByIds(babelHelpers.classPrivateFieldLooseBase(this,B)[B](babelHelpers.classPrivateFieldLooseBase(this,v)[v]))}}get $store(){return o.Core.getStore()}}function P(e){const t=new Set(babelHelpers.classPrivateFieldLooseBase(this,F)[F](e).tags);return babelHelpers.classPrivateFieldLooseBase(this,T)[T](e).getItems().filter((e=>t.has(e.getTitle()))).map((e=>[h.EntitySelectorEntity.Tag,e.getId()]))}function L(e){var t;const s=babelHelpers.classPrivateFieldLooseBase(this,f)[f];const a=(t=babelHelpers.classPrivateFieldLooseBase(this,F)[F](e).groupId)!=null?t:0;const i=`${e}-${a}`;if(b[i]){return b[i]}let o=false;const n=()=>{o=true};const d=()=>{var t,s;if(o){void babelHelpers.classPrivateFieldLooseBase(this,m)[m](e);o=false}(t=(s=babelHelpers.classPrivateFieldLooseBase(this,k))[k])==null?void 0:t.call(s);babelHelpers.classPrivateFieldLooseBase(this,k)[k]=null};b[i]=new r.EntitySelectorDialog({multiple:true,enableSearch:true,dropdownMode:true,compactView:true,entities:[{id:h.EntitySelectorEntity.Tag,options:{taskId:e,groupId:a}}],searchOptions:{allowCreateItem:true},footer:l.Footer,footerOptions:{userId:s,groupId:a},clearUnavailableItems:true,events:{"Item:onSelect":n,"Item:onDeselect":n,"Search:onItemCreateAsync":t=>{const s=t.getData().searchQuery.getQuery();if(babelHelpers.classPrivateFieldLooseBase(this,F)[F](e).tags.includes(s)){return}b[i].addItem({id:s,entityId:h.EntitySelectorEntity.Tag,title:s,tabs:"all",selected:true});o=true}},popupOptions:{events:{onClose:d}}});return b[i]}async function S(e){var t,s;const a=babelHelpers.classPrivateFieldLooseBase(this,T)[T](e).getSelectedItems().map((e=>e.getTitle()));void n.taskService.update(e,{tags:a});(t=(s=babelHelpers.classPrivateFieldLooseBase(this,I))[I])==null?void 0:t.call(s,a);babelHelpers.classPrivateFieldLooseBase(this,I)[I]=null}function C(e){return this.$store.getters[`${h.Model.Tasks}/getById`](e)}function H(){return this.$store.getters[`${h.Model.Interface}/currentUserId`]}const O=new y;const X={components:{BIcon:t.BIcon,AddBackground:s.AddBackground,FieldAdd:a.FieldAdd},props:{taskId:{type:[Number,String],required:true}},setup(){return{Outline:d.Outline,tagsMeta:g}},data(){return{isDialogShown:false,tagsIndexes:{}}},computed:{task(){return this.$store.getters[`${h.Model.Tasks}/getById`](this.taskId)},tags(){return[...this.task.tags].sort(((e,t)=>this.tagsIndexes[e]-this.tagsIndexes[t]))},isFilled(){return this.tags.length>0},readonly(){return!this.task.rights.edit}},watch:{tags(){O.setTaskId(this.taskId).updateItems()}},created(){this.rememberTagsIndexes(this.tags)},methods:{handleClick(){if(this.readonly){return}O.setTaskId(this.taskId).onCloseOnce(this.handleClose).showTo(this.$refs.anchor);O.onUpdateOnce(this.rememberTagsIndexes);this.isDialogShown=true},handleClose(){this.isDialogShown=false},handleCrossClick(e){const t=this.tags.filter((t=>t!==e));void n.taskService.update(this.taskId,{tags:t})},rememberTagsIndexes(e){this.tagsIndexes=e.reduce(((e,t,s)=>{e[t]=s;return e}),{})}},template:`\n\t\t<div\n\t\t\tclass="tasks-field-tags"\n\t\t\t:class="{ '--empty': !isFilled }"\n\t\t\t:data-task-id="taskId"\n\t\t\t:data-task-field-id="tagsMeta.id"\n\t\t\t:data-task-field-value="task.tags.join(',')"\n\t\t\t@click="handleClick"\n\t\t>\n\t\t\t<AddBackground v-if="!readonly && isFilled" :isActive="isDialogShown"/>\n\t\t\t<template v-for="tag in tags" :key="tag">\n\t\t\t\t<div class="tasks-field-tag">\n\t\t\t\t\t<span>{{ tag }}</span>\n\t\t\t\t\t<div v-if="!readonly" class="tasks-field-tag-cross" @click.capture.stop="handleCrossClick(tag)">\n\t\t\t\t\t\t<BIcon :name="Outline.CROSS_L" :hoverable="true"/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<FieldAdd v-if="!isFilled" :icon="Outline.TAG"/>\n\t\t\t<div class="tasks-field-tags-anchor" ref="anchor"></div>\n\t\t</div>\n\t`};const w={components:{Chip:p.Chip},props:{taskId:{type:[Number,String],required:true}},setup(){return{Outline:d.Outline,tagsMeta:g}},computed:{task(){return this.$store.getters[`${h.Model.Tasks}/getById`](this.taskId)},design(){return this.isSelected?p.ChipDesign.ShadowAccent:p.ChipDesign.ShadowNoAccent},isSelected(){return this.$store.getters[`${h.Model.Tasks}/wasFieldFilled`](this.taskId,g.id)},readonly(){return!this.task.rights.edit}},methods:{handleClick(){if(this.isSelected){this.highlightField();return}O.setTaskId(this.taskId).showTo(this.$el);O.onUpdateOnce(this.highlightField)},highlightField(){void u.fieldHighlighter.setContainer(this.$root.$el).highlight(g.id)}},template:`\n\t\t<Chip\n\t\t\tv-if="isSelected || !readonly"\n\t\t\t:design="design"\n\t\t\t:icon="Outline.TAG"\n\t\t\t:text="loc('TASKS_V2_TAGS_TITLE_CHIP')"\n\t\t\t:data-task-id="taskId"\n\t\t\t:data-task-chip-id="tagsMeta.id"\n\t\t\t:data-task-chip-value="task.tags.join(',')"\n\t\t\t@click="handleClick"\n\t\t/>\n\t`};e.Tags=X;e.TagsChip=w;e.tagsMeta=g})(this.BX.Tasks.V2.Component.Fields=this.BX.Tasks.V2.Component.Fields||{},BX.UI.IconSet,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Component.Elements,BX,BX.Tasks.EntitySelector,BX.Tasks.V2.Lib,BX.Tasks.V2,BX.Tasks.V2.Provider.Service,BX.UI.IconSet,BX,BX.Tasks.V2.Const,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Lib);
//# sourceMappingURL=tags.bundle.map.js