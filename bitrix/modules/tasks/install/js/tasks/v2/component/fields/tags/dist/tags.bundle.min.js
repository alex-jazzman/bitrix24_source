this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};this.BX.Tasks.V2=this.BX.Tasks.V2||{};this.BX.Tasks.V2.Component=this.BX.Tasks.V2.Component||{};(function(e,t,s,a,i,l,r,o,n,d,c,h,p){"use strict";const u=Object.freeze({id:"tags",title:a.Loc.getMessage("TASKS_V2_TAGS_TITLE")});const g={};var b=babelHelpers.classPrivateFieldLooseKey("taskId");var v=babelHelpers.classPrivateFieldLooseKey("onCloseOnce");var k=babelHelpers.classPrivateFieldLooseKey("onUpdateOnce");var B=babelHelpers.classPrivateFieldLooseKey("getItems");var I=babelHelpers.classPrivateFieldLooseKey("getDialog");var f=babelHelpers.classPrivateFieldLooseKey("updateTask");var T=babelHelpers.classPrivateFieldLooseKey("clearOnUpdateOnce");var y=babelHelpers.classPrivateFieldLooseKey("getTask");var F=babelHelpers.classPrivateFieldLooseKey("currentUserId");class m{constructor(){Object.defineProperty(this,F,{get:C,set:void 0});Object.defineProperty(this,y,{value:H});Object.defineProperty(this,f,{value:S});Object.defineProperty(this,I,{value:L});Object.defineProperty(this,B,{value:P});Object.defineProperty(this,b,{writable:true,value:void 0});Object.defineProperty(this,v,{writable:true,value:null});Object.defineProperty(this,k,{writable:true,value:null});Object.defineProperty(this,T,{writable:true,value:()=>{babelHelpers.classPrivateFieldLooseBase(this,k)[k]=null}})}setTaskId(e){babelHelpers.classPrivateFieldLooseBase(this,b)[b]=e;return this}onCloseOnce(e){babelHelpers.classPrivateFieldLooseBase(this,v)[v]=e;return this}onUpdateOnce(e){babelHelpers.classPrivateFieldLooseBase(this,k)[k]=e}showTo(e){const t=babelHelpers.classPrivateFieldLooseBase(this,I)[I](babelHelpers.classPrivateFieldLooseBase(this,b)[b]);if(t.isLoaded()&&!t.isOpen()){t.selectItemsByIds(babelHelpers.classPrivateFieldLooseBase(this,B)[B](babelHelpers.classPrivateFieldLooseBase(this,b)[b]))}t.showTo(e)}updateItems(){const e=babelHelpers.classPrivateFieldLooseBase(this,I)[I](babelHelpers.classPrivateFieldLooseBase(this,b)[b]);if(e.isLoaded()&&e.isOpen()){e.selectItemsByIds(babelHelpers.classPrivateFieldLooseBase(this,B)[B](babelHelpers.classPrivateFieldLooseBase(this,b)[b]))}}get $store(){return r.Core.getStore()}}function P(e){const t=new Set(babelHelpers.classPrivateFieldLooseBase(this,y)[y](e).tags);return babelHelpers.classPrivateFieldLooseBase(this,I)[I](e).getItems().filter((e=>t.has(e.getTitle()))).map((e=>[c.EntitySelectorEntity.Tag,e.getId()]))}function L(e){var t;const s=babelHelpers.classPrivateFieldLooseBase(this,F)[F];const a=(t=babelHelpers.classPrivateFieldLooseBase(this,y)[y](e).groupId)!=null?t:0;const r=`${e}-${a}`;if(g[r]){return g[r]}let o=false;const n=()=>{o=true};const d=()=>{var t,s;if(o){void babelHelpers.classPrivateFieldLooseBase(this,f)[f](e);o=false}(t=(s=babelHelpers.classPrivateFieldLooseBase(this,v))[v])==null?void 0:t.call(s);babelHelpers.classPrivateFieldLooseBase(this,v)[v]=null};g[r]=new l.EntitySelectorDialog({multiple:true,enableSearch:true,dropdownMode:true,compactView:true,entities:[{id:c.EntitySelectorEntity.Tag,options:{taskId:e,groupId:a}}],searchOptions:{allowCreateItem:true},footer:i.Footer,footerOptions:{userId:s,groupId:a},clearUnavailableItems:true,events:{"Item:onSelect":n,"Item:onDeselect":n,"Search:onItemCreateAsync":t=>{const s=t.getData().searchQuery.getQuery();if(babelHelpers.classPrivateFieldLooseBase(this,y)[y](e).tags.includes(s)){return}g[r].addItem({id:s,entityId:c.EntitySelectorEntity.Tag,title:s,tabs:"all",selected:true});o=true}},popupOptions:{events:{onClose:d}}});return g[r]}async function S(e){var t,s;const a=babelHelpers.classPrivateFieldLooseBase(this,I)[I](e).getSelectedItems().map((e=>e.getTitle()));void o.taskService.update(e,{tags:a});(t=(s=babelHelpers.classPrivateFieldLooseBase(this,k))[k])==null?void 0:t.call(s);babelHelpers.classPrivateFieldLooseBase(this,T)[T]()}function H(e){return this.$store.getters[`${c.Model.Tasks}/getById`](e)}function C(){return this.$store.getters[`${c.Model.Interface}/currentUserId`]}const O=new m;const w={components:{BIcon:t.BIcon,AddBackground:s.AddBackground},props:{taskId:{type:[Number,String],required:true}},setup(){return{Outline:n.Outline,tagsMeta:u}},data(){return{isDialogShown:false}},computed:{task(){return this.$store.getters[`${c.Model.Tasks}/getById`](this.taskId)},tags(){return this.task.tags},isFilled(){return this.tags.length>0},readonly(){return!this.task.rights.edit}},watch:{tags(){O.setTaskId(this.taskId).updateItems()}},methods:{handleClick(){if(this.readonly){return}O.setTaskId(this.taskId).onCloseOnce(this.handleClose).showTo(this.$refs.anchor);this.isDialogShown=true},handleClose(){this.isDialogShown=false},handleCrossClick(e){const t=this.tags.filter((t=>t!==e));void o.taskService.update(this.taskId,{tags:t})}},template:`\n\t\t<div\n\t\t\tclass="tasks-field-tags"\n\t\t\t:class="{ '--empty': !isFilled }"\n\t\t\t:data-task-id="taskId"\n\t\t\t:data-task-field-id="tagsMeta.id"\n\t\t\t:data-task-field-value="task.tags.join(',')"\n\t\t\t@click="handleClick"\n\t\t>\n\t\t\t<AddBackground v-if="!readonly && isFilled" :isActive="isDialogShown"/>\n\t\t\t<template v-for="tag in tags" :key="tag">\n\t\t\t\t<div class="tasks-field-tag">\n\t\t\t\t\t<span>{{ tag }}</span>\n\t\t\t\t\t<div v-if="!readonly" class="tasks-field-tag-cross" @click.capture.stop="handleCrossClick(tag)">\n\t\t\t\t\t\t<BIcon :name="Outline.CROSS_L" :hoverable="true"/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<template v-if="!isFilled">\n\t\t\t\t<BIcon class="tasks-field-tags-add-icon" :name="Outline.TAG"/>\n\t\t\t\t<div class="tasks-field-tags-add-text">{{ loc('TASKS_V2_TAGS_ADD') }}</div>\n\t\t\t</template>\n\t\t\t<div class="tasks-field-tags-anchor" ref="anchor"></div>\n\t\t</div>\n\t`};const X={components:{Chip:h.Chip},props:{taskId:{type:[Number,String],required:true}},setup(){return{Outline:n.Outline,tagsMeta:u}},computed:{task(){return this.$store.getters[`${c.Model.Tasks}/getById`](this.taskId)},design(){return this.isSelected?h.ChipDesign.ShadowAccent:h.ChipDesign.ShadowNoAccent},isSelected(){return this.$store.getters[`${c.Model.Tasks}/wasFieldFilled`](this.taskId,u.id)},readonly(){return!this.task.rights.edit}},methods:{handleClick(){if(this.isSelected){this.highlightField();return}O.setTaskId(this.taskId).showTo(this.$el);if(!this.isAutonomous){O.onUpdateOnce(this.highlightField)}},highlightField(){void p.fieldHighlighter.setContainer(this.$root.$el).highlight(u.id)}},template:`\n\t\t<Chip\n\t\t\tv-if="isSelected || !readonly"\n\t\t\t:design="design"\n\t\t\t:icon="Outline.TAG"\n\t\t\t:text="loc('TASKS_V2_TAGS_TITLE_CHIP')"\n\t\t\t:data-task-id="taskId"\n\t\t\t:data-task-chip-id="tagsMeta.id"\n\t\t\t:data-task-chip-value="task.tags.join(',')"\n\t\t\t@click="handleClick"\n\t\t/>\n\t`};e.Tags=w;e.TagsChip=X;e.tagsMeta=u})(this.BX.Tasks.V2.Component.Fields=this.BX.Tasks.V2.Component.Fields||{},BX.UI.IconSet,BX.Tasks.V2.Component.Elements,BX,BX.Tasks.EntitySelector,BX.Tasks.V2.Lib,BX.Tasks.V2,BX.Tasks.V2.Provider.Service,BX.UI.IconSet,BX,BX.Tasks.V2.Const,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Lib);
//# sourceMappingURL=tags.bundle.map.js