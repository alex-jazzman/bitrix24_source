{"version":3,"file":"growing-text-area.bundle.js","sources":["../src/growing-text-area.js"],"sourcesContent":["import { Dom } from 'main.core';\nimport { hint, type HintParams } from 'ui.vue3.directives.hint';\n\nimport './growing-text-area.css';\n\n// @vue/component\nexport const GrowingTextArea = {\n\tname: 'GrowingTextArea',\n\tdirectives: { hint },\n\tprops: {\n\t\tmodelValue: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tplaceholder: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tfontColor: {\n\t\t\ttype: String,\n\t\t\tdefault: 'var(--ui-color-base-1)',\n\t\t},\n\t\tfontSize: {\n\t\t\ttype: Number,\n\t\t\tdefault: 21,\n\t\t},\n\t\tfontWeight: {\n\t\t\ttype: [Number, String],\n\t\t\tdefault: 'inherit',\n\t\t},\n\t\tlineHeight: {\n\t\t\ttype: Number,\n\t\t\tdefault: 29,\n\t\t},\n\t\treadonly: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: [\n\t\t'update:modelValue',\n\t\t'input',\n\t\t'focus',\n\t\t'blur',\n\t\t'emptyFocus',\n\t\t'emptyBlur',\n\t\t'enterBlur',\n\t],\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tfocus: false,\n\t\t\tisOverflowing: false,\n\t\t};\n\t},\n\tcomputed: {\n\t\tisEmpty(): boolean\n\t\t{\n\t\t\treturn this.modelValue.trim() === '';\n\t\t},\n\t\tisDisplay(): boolean\n\t\t{\n\t\t\treturn this.isOverflowing && !this.isEmpty && !this.focus;\n\t\t},\n\t\ttooltip(): Function\n\t\t{\n\t\t\treturn (): HintParams => ({\n\t\t\t\ttext: this.modelValue,\n\t\t\t\tpopupOptions: {\n\t\t\t\t\tclassName: 'b24-growing-text-area-popup',\n\t\t\t\t\tbindElement: this.$el,\n\t\t\t\t\toffsetLeft: 40,\n\t\t\t\t\tmaxWidth: 440,\n\t\t\t\t\tangle: {\n\t\t\t\t\t\toffset: 40,\n\t\t\t\t\t},\n\t\t\t\t\tdarkMode: false,\n\t\t\t\t\ttargetContainer: document.body,\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t},\n\tmounted(): void\n\t{\n\t\trequestAnimationFrame(() => {\n\t\t\tif (this.isEmpty)\n\t\t\t{\n\t\t\t\tthis.focusToEnd();\n\t\t\t}\n\n\t\t\tvoid this.adjustTextareaHeight();\n\t\t});\n\t},\n\tmethods: {\n\t\tasync adjustTextareaHeight(): Promise<void>\n\t\t{\n\t\t\tconst textarea = this.$refs.textarea;\n\t\t\tif (!textarea)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tDom.style(textarea, 'height', 'auto');\n\n\t\t\tconst maxHeight = this.lineHeight * 3;\n\t\t\tconst height = Math.min(textarea.scrollHeight, maxHeight);\n\n\t\t\tthis.isOverflowing = textarea.scrollHeight > maxHeight;\n\n\t\t\tDom.style(textarea, 'height', `${height}px`);\n\t\t\tDom.style(textarea, 'maxHeight', `${maxHeight}px`);\n\t\t},\n\t\tfocusToEnd(): void\n\t\t{\n\t\t\tif (this.readonly)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst textarea = this.$refs.textarea;\n\t\t\ttextarea.focus({ preventScroll: true });\n\t\t\ttextarea.setSelectionRange(textarea.value.length, textarea.value.length);\n\t\t\tthis.scrollToBeginning();\n\t\t\tthis.scrollToEnd();\n\t\t},\n\t\tfocusTextarea(): void\n\t\t{\n\t\t\tif (this.readonly)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.focus = true;\n\n\t\t\tvoid this.$nextTick(() => {\n\t\t\t\tthis.$refs.textarea.focus();\n\t\t\t});\n\t\t},\n\t\tscrollToBeginning(): void\n\t\t{\n\t\t\tif (!this.$refs.textarea)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$refs.textarea.scrollTop = 0;\n\t\t},\n\t\tscrollToEnd(): void\n\t\t{\n\t\t\tconst textarea = this.$refs.textarea;\n\t\t\ttextarea.scrollTo({\n\t\t\t\ttop: textarea.scrollHeight,\n\t\t\t\tbehavior: 'smooth',\n\t\t\t});\n\t\t},\n\t\thandleInput(event): void\n\t\t{\n\t\t\tthis.$emit('input', event.target.value);\n\n\t\t\tvoid this.adjustTextareaHeight();\n\t\t},\n\t\thandleKeyDown(event: KeyboardEvent): void\n\t\t{\n\t\t\tif (event.key === 'Enter' && (event.ctrlKey || event.metaKey))\n\t\t\t{\n\t\t\t\tevent.stopPropagation();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (event.key === 'Enter')\n\t\t\t{\n\t\t\t\tthis.$emit('enterBlur', this.modelValue === '');\n\n\t\t\t\tevent.target.blur();\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\n\t\t\tif (event.key === 'Escape')\n\t\t\t{\n\t\t\t\tevent.target.blur();\n\t\t\t\tevent.stopPropagation();\n\t\t\t}\n\t\t},\n\t\tasync handleFocus(event: FocusEvent): Promise<void>\n\t\t{\n\t\t\tthis.focus = true;\n\n\t\t\tawait this.adjustTextareaHeight();\n\t\t\tthis.focusToEnd();\n\n\t\t\tif (this.modelValue === '')\n\t\t\t{\n\t\t\t\tthis.$emit('emptyFocus');\n\t\t\t}\n\n\t\t\tthis.$emit('focus', event);\n\t\t},\n\t\tasync handleBlur(event: FocusEvent): Promise<void>\n\t\t{\n\t\t\tthis.focus = false;\n\t\t\tif (!this.$refs.textarea)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.isOverflowing)\n\t\t\t{\n\t\t\t\tawait this.adjustTextareaHeight();\n\t\t\t\tthis.scrollToBeginning();\n\t\t\t}\n\n\t\t\tconst value = this.$refs.textarea.value.trim();\n\t\t\tif (value !== this.modelValue)\n\t\t\t{\n\t\t\t\tthis.$emit('update:modelValue', value);\n\t\t\t}\n\n\t\t\tthis.$refs.textarea.value = value;\n\n\t\t\tif (value === '')\n\t\t\t{\n\t\t\t\tthis.$emit('emptyBlur');\n\t\t\t}\n\n\t\t\tthis.$emit('blur', event);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"b24-growing-text-area\" :class=\"{ '--readonly': readonly }\">\n\t\t\t<div\n\t\t\t\tv-if=\"isDisplay\"\n\t\t\t\tv-hint=\"tooltip\"\n\t\t\t\tclass=\"b24-growing-text-area-display\"\n\t\t\t\t:style=\"{\n\t\t\t\t\tlineHeight: lineHeight + 'px',\n\t\t\t\t\tcolor: fontColor,\n\t\t\t\t\tfontSize: fontSize + 'px',\n\t\t\t\t\tfontWeight: fontWeight,\n\t\t\t\t}\"\n\t\t\t\t@click=\"focusTextarea\"\n\t\t\t>\n\t\t\t\t{{ modelValue }}\n\t\t\t</div>\n\t\t\t<textarea\n\t\t\t\tv-else\n\t\t\t\tclass=\"b24-growing-text-area-edit\"\n\t\t\t\trows=\"1\"\n\t\t\t\t:value=\"modelValue\"\n\t\t\t\t:placeholder=\"placeholder\"\n\t\t\t\t:style=\"{\n\t\t\t\t\tlineHeight: lineHeight + 'px',\n\t\t\t\t\tcolor: fontColor,\n\t\t\t\t\tfontSize: fontSize + 'px',\n\t\t\t\t\tfontWeight: fontWeight,\n\t\t\t\t}\"\n\t\t\t\t:readonly=\"readonly\"\n\t\t\t\tref=\"textarea\"\n\t\t\t\t@input=\"handleInput\"\n\t\t\t\t@keydown=\"handleKeyDown\"\n\t\t\t\t@focus=\"handleFocus\"\n\t\t\t\t@blur=\"handleBlur\"\n\t\t\t></textarea>\n\t\t</div>\n\t`,\n};\n"],"names":["GrowingTextArea","name","directives","hint","props","modelValue","type","String","default","placeholder","fontColor","fontSize","Number","fontWeight","lineHeight","readonly","Boolean","emits","data","focus","isOverflowing","computed","isEmpty","trim","isDisplay","tooltip","text","popupOptions","className","bindElement","$el","offsetLeft","maxWidth","angle","offset","darkMode","targetContainer","document","body","mounted","requestAnimationFrame","focusToEnd","adjustTextareaHeight","methods","textarea","$refs","Dom","style","maxHeight","height","Math","min","scrollHeight","preventScroll","setSelectionRange","value","length","scrollToBeginning","scrollToEnd","focusTextarea","$nextTick","scrollTop","scrollTo","top","behavior","handleInput","event","$emit","target","handleKeyDown","key","ctrlKey","metaKey","stopPropagation","blur","preventDefault","handleFocus","handleBlur","template"],"mappings":"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"}