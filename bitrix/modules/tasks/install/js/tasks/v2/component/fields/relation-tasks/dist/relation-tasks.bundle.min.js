this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};this.BX.Tasks.V2=this.BX.Tasks.V2||{};this.BX.Tasks.V2.Component=this.BX.Tasks.V2.Component||{};(function(t,e,s,i,a,n,d,o,h,r,l){"use strict";const k={name:"TaskRelationTasks",components:{BIcon:a.BIcon,TaskList:d.TaskList,TextMd:i.TextMd},directives:{hint:s.hint},props:{taskId:{type:[Number,String],required:true},meta:{type:Object,required:true}},setup(){return{Outline:a.Outline}},computed:{task(){return this.$store.getters[`${h.Model.Tasks}/getById`](this.taskId)},isEdit(){return Number.isInteger(this.taskId)&&this.taskId>0},ids(){return[...this.task[this.meta.idsField]].sort(((t,e)=>e-t))},text(){if(this.ids.length>0){return this.loc(this.meta.countLoc,{"#COUNT#":this.ids.length})}return this.meta.title},context(){return this.meta.id},readonly(){return!this.task.rights.edit},tooltip(){return()=>o.tooltip({text:this.meta.hint,popupOptions:{offsetLeft:this.$refs.add.$el.offsetWidth/2}})}},watch:{ids(t,e){if([...t||[]].sort().join(",")===[...e||[]].sort().join(",")){return}if(this.meta.service.hasUnloadedIds(this.taskId)){void this.meta.service.list(this.taskId)}}},created(){if(!this.meta.service.areIdsLoaded(this.taskId)||this.meta.service.hasUnloadedIds(this.taskId)){void this.meta.service.list(this.taskId,true)}},methods:{handleTitleClick(){if(this.isEdit&&(this.readonly||this.task[this.meta.containsField])){this.openGrid();return}this.showDialog()},openGrid(){e.EventEmitter.emit(h.EventName.OpenGrid,{taskId:this.taskId,type:this.meta.id})},showDialog(){this.meta.dialog.setTaskId(this.taskId).showTo(this.$refs.add.$el)},async handleRemove(t){await this.meta.service.delete(this.taskId,[t])}},template:`\n\t\t<div\n\t\t\tclass="tasks-field-relation-tasks"\n\t\t\t:data-task-id="taskId"\n\t\t\t:data-task-field-id="meta.id"\n\t\t>\n\t\t\t<div class="tasks-field-relation-tasks-title">\n\t\t\t\t<div\n\t\t\t\t\tclass="tasks-field-relation-tasks-main"\n\t\t\t\t\tdata-task-relation-open\n\t\t\t\t\t@click="handleTitleClick"\n\t\t\t\t>\n\t\t\t\t\t<BIcon :name="meta.icon"/>\n\t\t\t\t\t<TextMd :accent="true">{{ text }}</TextMd>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tv-if="!readonly"\n\t\t\t\t\tv-hint="tooltip"\n\t\t\t\t\tclass="tasks-field-relation-tasks-add-container"\n\t\t\t\t>\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\tclass="tasks-field-relation-tasks-icon"\n\t\t\t\t\t\t:name="Outline.PLUS_L"\n\t\t\t\t\t\t:hoverable="true"\n\t\t\t\t\t\t:data-task-relation-add="meta.id"\n\t\t\t\t\t\tref="add"\n\t\t\t\t\t\t@click="showDialog"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<TaskList\n\t\t\t\tv-if="task[meta.containsField]"\n\t\t\t\t:taskIds="ids"\n\t\t\t\t:context="context"\n\t\t\t\t:readonly="readonly"\n\t\t\t\t@openMore="openGrid"\n\t\t\t\t@removeTask="handleRemove"\n\t\t\t/>\n\t\t</div>\n\t`};const c={components:{Chip:r.Chip},props:{taskId:{type:[Number,String],required:true},meta:{type:Object,required:true},disabled:{type:Boolean,default:false}},computed:{task(){return this.$store.getters[`${h.Model.Tasks}/getById`](this.taskId)},count(){return this.task[this.meta.idsField].length},design(){if(this.disabled){return r.ChipDesign.ShadowDisabled}return this.isSelected?r.ChipDesign.ShadowAccent:r.ChipDesign.ShadowNoAccent},isSelected(){return this.$store.getters[`${h.Model.Tasks}/wasFieldFilled`](this.taskId,this.meta.id)},readonly(){return!this.task.rights.edit}},methods:{handleClick(){if(this.disabled){return}if(this.isSelected){this.highlightField();return}this.meta.dialog.setTaskId(this.taskId).onUpdateOnce(this.highlightField).showTo(this.$el)},highlightField(){void l.fieldHighlighter.setContainer(this.$root.$el).highlight(this.meta.id)}},template:`\n\t\t<Chip\n\t\t\tv-if="isSelected || !readonly"\n\t\t\t:design="design"\n\t\t\t:text="meta.chipTitle"\n\t\t\t:icon="meta.icon"\n\t\t\t:data-task-id="taskId"\n\t\t\t:data-task-chip-id="meta.id"\n\t\t\tref="chip"\n\t\t\t@click="handleClick"\n\t\t/>\n\t`};t.RelationTasks=k;t.RelationTasksChip=c})(this.BX.Tasks.V2.Component.Fields=this.BX.Tasks.V2.Component.Fields||{},BX.Event,BX.Vue3.Directives,BX.UI.System.Typography.Vue,BX.UI.IconSet,BX,BX.Tasks.V2.Component,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Const,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Lib);
//# sourceMappingURL=relation-tasks.bundle.map.js