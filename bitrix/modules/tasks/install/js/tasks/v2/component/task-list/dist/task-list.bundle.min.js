this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};this.BX.Tasks.V2=this.BX.Tasks.V2||{};(function(t,e,s,n,i,a,l,d,r,o,k,h,c,u){"use strict";const p={components:{BIcon:l.BIcon,Responsible:h.Responsible,DeadlinePopup:c.DeadlinePopup,HoverPill:r.HoverPill,TextMd:a.TextMd,TextSm:a.TextSm},props:{context:{type:String,required:true},taskId:{type:[Number,String],required:true},readonly:{type:Boolean,required:true},last:{type:Boolean,default:false}},emits:["remove"],setup(){return{responsibleMeta:h.responsibleMeta,Outline:l.Outline}},data(){return{isDeadlinePopupShown:false,selectingDeadlineTs:null,nowTs:Date.now()}},computed:{task(){return this.$store.getters[`${d.Model.Tasks}/getById`](this.taskId)},responsible(){return this.$store.getters[`${d.Model.Users}/getById`](this.task.responsibleId)},dialogOptions(){return h.responsibleMeta.dialogOptions(this.context)},preselected(){return[["user",this.task.responsibleId||this.currentUserId]]},dataset(){return{"data-task-id":this.taskId,"data-task-field-id":h.responsibleMeta.id,"data-task-field-value":this.task.responsibleId}},deadlineTs(){var t;return(t=this.selectingDeadlineTs)!=null?t:this.task.deadlineTs},expiredDuration(){if(!this.deadlineTs){return 0}return this.nowTs-this.deadlineTs},isExpired(){return this.expiredDuration>0&&!this.isFlowFilledOnAdd},deadlineFormatted(){if(this.isFlowFilledOnAdd){return this.loc("TASKS_V2_DEADLINE_AUTO")}if(!this.deadlineTs){return this.loc("TASKS_V2_DEADLINE_EMPTY")}if(this.isExpired){return this.loc("TASKS_V2_TASK_LIST_DEADLINE_EXPIRED",{"#DURATION#":new i.DurationFormat(this.expiredDuration).formatClosest()})}return o.calendar.formatDateTime(this.deadlineTs)},isEdit(){return Number.isInteger(this.taskId)&&this.taskId>0},isFlowFilledOnAdd(){return this.task.flowId>0&&!this.isEdit},deadlineReadonly(){return this.readonly||!this.task.rights.deadline||this.isFlowFilledOnAdd},detachReadonly(){const t=this.task.rights.detachParent||this.task.rights.detachRelated;return this.readonly||!t}},mounted(){this.nowTsInterval=setInterval((()=>{this.nowTs=Date.now()}),1e3)},beforeUnmount(){clearInterval(this.nowTsInterval)},methods:{handleEditDeadline(){if(this.deadlineReadonly){return}this.isDeadlinePopupShown=true},handleClearDeadline(){if(this.deadlineReadonly){return}void k.taskService.update(this.taskId,{deadlineTs:0})},handleDeadlineUpdate(t){this.selectingDeadlineTs=t},handleDeadlinePopupClose(){this.isDeadlinePopupShown=false;this.selectingDeadlineTs=null},handleTaskOpen(){n.EventEmitter.emit(d.EventName.OpenFullCard,{taskId:this.taskId,widthOffset:48})},handleRemove(){if(this.readonly){return}this.$emit("remove")}},template:`\n\t\t<div class="tasks-task-line-container" :class="{ '--last': last }">\n\t\t\t<div class="tasks-task-line-wrapper">\n\t\t\t\t<div class="tasks-task-line-title-container" @click="handleTaskOpen">\n\t\t\t\t\t<TextMd class="tasks-task-line-title">\n\t\t\t\t\t\t{{ task.title }}\n\t\t\t\t\t</TextMd>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-task-line-fields-container">\n\t\t\t\t\t<Responsible\n\t\t\t\t\t\t:context="context"\n\t\t\t\t\t\t:taskId="taskId"\n\t\t\t\t\t\t:selectorWithActionMenu="true"\n\t\t\t\t\t\t:avatarOnly="true"\n\t\t\t\t\t/>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="tasks-task-line-deadline"\n\t\t\t\t\t\t:class="{ '--expired': isExpired }"\n\t\t\t\t\t\tref="deadline"\n\t\t\t\t\t>\n\t\t\t\t\t\t<HoverPill\n\t\t\t\t\t\t\t:withClear="Boolean(deadlineTs) && !deadlineReadonly"\n\t\t\t\t\t\t\t:readonly="deadlineReadonly"\n\t\t\t\t\t\t\t@click="handleEditDeadline"\n\t\t\t\t\t\t\t@clear="handleClearDeadline"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<TextSm class="tasks-task-line-deadline-text" :accent="isExpired">\n\t\t\t\t\t\t\t\t{{ deadlineFormatted }}\n\t\t\t\t\t\t\t</TextSm>\n\t\t\t\t\t\t</HoverPill>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tclass="tasks-task-line-cross"\n\t\t\t\t\t:class="{ '--readonly': detachReadonly }"\n\t\t\t\t\t@click="handleRemove"\n\t\t\t\t>\n\t\t\t\t\t<BIcon :name="Outline.CROSS_L" :hoverable="true"/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<DeadlinePopup\n\t\t\tv-if="isDeadlinePopupShown"\n\t\t\t:taskId="taskId"\n\t\t\t:bindElement="$refs.deadline"\n\t\t\t@update="handleDeadlineUpdate"\n\t\t\t@close="handleDeadlinePopupClose"\n\t\t/>\n\t`};const T={components:{BLine:u.BLine},props:{last:{type:Boolean,default:false}},template:`\n\t\t<div class="tasks-task-line-container" :class="{ '--last': last }">\n\t\t\t<div class="tasks-task-line-wrapper">\n\t\t\t\t<div class="tasks-task-line-title-container">\n\t\t\t\t\t<BLine :width="200" :height="10"/>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-task-line-fields-container">\n\t\t\t\t\t<div class="tasks-task-line-skeleton-avatar">\n\t\t\t\t\t\t<BLine circle :width="25" :height="25" :radius="25"/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-task-line-deadline">\n\t\t\t\t\t\t<BLine :width="80" :height="10"/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-task-line-cross"/>\n\t\t\t</div>\n\t\t</div>\n\t`};const v=d.Limit.RelationList;const m={components:{BIcon:l.BIcon,TaskLine:p,TaskLineSkeleton:T},props:{taskIds:{type:Array,required:true},context:{type:String,required:true},readonly:{type:Boolean,required:true}},emits:["openMore","removeTask"],setup(){return{Outline:l.Outline}},computed:{limitedTasks(){return this.taskIds.slice(0,v)},shouldShowMore(){return this.taskIds.length>v},moreText(){const t=this.taskIds.length-v;return e.Loc.getMessagePlural("TASKS_V2_TASK_LIST_MORE",t,{"#COUNT#":t})}},methods:{isLast(t){return t===Math.min(this.taskIds.length,v)-1},isTaskLoaded(t){return Boolean(this.$store.getters[`${d.Model.Tasks}/getById`](t))}},template:`\n\t\t<div class="tasks-task-list">\n\t\t\t<TaskLineSkeleton v-if="taskIds.length === 0" :last="true"/>\n\t\t\t<template v-for="(taskId, index) in limitedTasks" :key="taskId">\n\t\t\t\t<TaskLine\n\t\t\t\t\tv-if="isTaskLoaded(taskId)"\n\t\t\t\t\t:taskId="taskId"\n\t\t\t\t\t:context="context"\n\t\t\t\t\t:readonly="readonly"\n\t\t\t\t\t:last="isLast(index)"\n\t\t\t\t\t@remove="$emit('removeTask', taskId)"\n\t\t\t\t/>\n\t\t\t\t<TaskLineSkeleton\n\t\t\t\t\tv-else\n\t\t\t\t\t:last="isLast(index)"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<div\n\t\t\t\tv-if="shouldShowMore"\n\t\t\t\tclass="tasks-task-list-more"\n\t\t\t\t@click="$emit('openMore')"\n\t\t\t>\n\t\t\t\t<div class="tasks-task-list-more-text">\n\t\t\t\t\t{{ moreText }}\n\t\t\t\t</div>\n\t\t\t\t<BIcon\n\t\t\t\t\tclass="tasks-task-list-icon"\n\t\t\t\t\t:name="Outline.CHEVRON_RIGHT_L"\n\t\t\t\t\t:hoverable="true"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`};t.TaskList=m})(this.BX.Tasks.V2.Component=this.BX.Tasks.V2.Component||{},BX,BX,BX.Event,BX.Main,BX.UI.System.Typography.Vue,BX.UI.IconSet,BX.Tasks.V2.Const,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Lib,BX.Tasks.V2.Provider.Service,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.UI.System.Skeleton.Vue);
//# sourceMappingURL=task-list.bundle.map.js