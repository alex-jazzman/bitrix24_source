this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};this.BX.Tasks.V2=this.BX.Tasks.V2||{};(function(t,e,s,i,a,n,o,r,l,d,c,h,u,p,k,S,T,m,I,C,_,v,f,A,g,b,F,L,B,E,O,D,w,P,R,U,y,M,K,N,V,X,$,H,x,G){"use strict";let j=t=>t,z;const W="MENU_SECTION_PERSONAL";const q="MENU_SECTION_TASKS";const Y="MENU_SECTION_COPY";const Z="MENU_SECTION_LINKS";const J={name:"TaskFullCardBurgerMenu",components:{BIcon:K.BIcon,BMenu:M.BMenu},props:{taskId:{type:[Number,String],required:true}},setup(){return{Outline:K.Outline,userRights:w.Core.getParams().rights}},data(){return{isMenuShown:false}},computed:{...y.mapGetters({currentUserId:`${X.Model.Interface}/currentUserId`}),task(){return this.$store.getters[`${X.Model.Tasks}/getById`](this.taskId)},menuOptions(){return()=>({id:"tasks-full-card-header-burger-menu",bindElement:this.$refs.button.$el,sections:[{code:W},{code:q},{code:Y},{code:Z}],items:this.menuItems})},menuItems(){const t=[];if(this.task.rights.favorite){t.push(this.getToggleFavoriteItem())}if(this.task.rights.watch){t.push(this.getBecomeAuditorItem())}if(this.task.rights.mute){t.push(this.getToggleMuteItem())}if(this.userRights.tasks.create){t.push(this.getCreateNewTaskItem())}if(this.task.rights.createSubtask){t.push(this.getCreateSubtaskItem())}if(this.task.rights.copy){t.push(this.getCreateDuplicateTaskItem())}if(this.userRights.tasks.createFromTemplate){t.push(this.getCreateNewTaskWithTemplateItem())}if(this.task.rights.saveAsTemplate){t.push(this.getCreateTemplateFromTaskItem())}t.push(this.getCopyTaskIdItem(),this.getGoToBitrixMarketItem());if(this.userRights.tasks.robot){t.push(this.getGoToRobotsItem())}return t}},methods:{getNotificationLayoutWithTitle({title:t,text:e}){return U.Tag.render(z||(z=j`
				<div>
					<p style="margin: 0">${0}</p>
					<p style="margin: 5px 0 0 0; font-size: 12px">${0}</p>
				</div>
			`),t,e)},handleClickOpener(){this.isMenuShown=true},getToggleFavoriteItem(){const t=!this.task.inFavorite.includes(this.currentUserId);return{sectionCode:W,title:t?this.loc("TASKS_V2_TASK_FULL_CARD_FAVOR_ACTION"):this.loc("TASKS_V2_TASK_FULL_CARD_UNFAVOR_ACTION"),icon:t?K.Outline.FAVORITE:K.Outline.NON_FAVORITE,onClick:async()=>{if(t){const t=await x.taskService.addFavorite(this.task,this.currentUserId);BX.UI.Notification.Center.notify({content:t?this.loc("TASKS_V2_TASK_FULL_CARD_FAVOR_NOTIF_SUCC"):this.loc("TASKS_V2_TASK_FULL_CARD_FAVOR_NOTIF_FAIL")})}else{const t=await x.taskService.removeFavorite(this.task,this.currentUserId);BX.UI.Notification.Center.notify({content:t?this.loc("TASKS_V2_TASK_FULL_CARD_UNFAVOR_NOTIF_SUCC"):this.loc("TASKS_V2_TASK_FULL_CARD_UNFAVOR_NOTIF_FAIL")})}}}},getBecomeAuditorItem(){const t=this.task.auditorsIds;const e=!t.includes(this.currentUserId);return{sectionCode:W,title:e?this.loc("TASKS_V2_TASK_FULL_CARD_BECOME_AUDITOR_ACTION"):this.loc("TASKS_V2_TASK_FULL_CARD_STOP_BEING_AUDITOR_ACTION"),icon:e?K.Outline.OBSERVER:K.Outline.CROSSED_EYE,onClick:async()=>{if(e){const e=await x.taskService.setAuditors(this.task.id,[...t,this.currentUserId]);BX.UI.Notification.Center.notify({content:e?this.loc("TASKS_V2_TASK_FULL_CARD_BECOME_AUDITOR_NOTIF_SUCC"):this.loc("TASKS_V2_TASK_FULL_CARD_BECOME_AUDITOR_NOTIF_FAIL")})}else{const e=await x.taskService.setAuditors(this.task.id,t.filter((t=>t!==this.currentUserId)));BX.UI.Notification.Center.notify({content:e?this.loc("TASKS_V2_TASK_FULL_CARD_STOP_BEING_AUDITOR_NOTIF_SUCC"):this.loc("TASKS_V2_TASK_FULL_CARD_STOP_BEING_AUDITOR_NOTIF_FAIL")})}}}},getToggleMuteItem(){const t=!this.task.inMute.includes(this.currentUserId);return{sectionCode:W,title:t?this.loc("TASKS_V2_TASK_FULL_CARD_MUTE_ACTION"):this.loc("TASKS_V2_TASK_FULL_CARD_UNMUTE_ACTION"),icon:t?K.Outline.SOUND_OFF:K.Outline.SOUND_ON,onClick:async()=>{if(t){const t=await x.taskService.muteTask(this.task,this.currentUserId);BX.UI.Notification.Center.notify({content:t?this.getNotificationLayoutWithTitle({title:this.loc("TASKS_V2_TASK_FULL_CARD_MUTE_NOTIF_SUCC_TITLE"),text:this.loc("TASKS_V2_TASK_FULL_CARD_MUTE_NOTIF_SUCC_DESCR")}):this.loc("TASKS_V2_TASK_FULL_CARD_MUTE_NOTIF_FAIL")})}else{const t=await x.taskService.unmuteTask(this.task,this.currentUserId);BX.UI.Notification.Center.notify({content:t?this.getNotificationLayoutWithTitle({title:this.loc("TASKS_V2_TASK_FULL_CARD_UNMUTE_NOTIF_SUCC_TITLE"),text:this.loc("TASKS_V2_TASK_FULL_CARD_UNMUTE_NOTIF_SUCC_DESCR")}):this.loc("TASKS_V2_TASK_FULL_CARD_UNMUTE_NOTIF_FAIL")})}}}},getCreateNewTaskItem(){return{sectionCode:q,title:this.loc("TASKS_V2_TASK_FULL_CARD_CREATE_STANDALONE_TASK"),icon:K.Outline.TASK,onClick:async()=>{F.TaskCard.showCompactCard({})}}},getCreateSubtaskItem(){return{sectionCode:q,title:this.loc("TASKS_V2_TASK_FULL_CARD_CREATE_SUBTASK"),icon:K.Outline.RELATED_TASKS,onClick:async()=>{F.TaskCard.showCompactCard({parentId:this.taskId})}}},getCreateDuplicateTaskItem(){return{sectionCode:q,title:this.loc("TASKS_V2_TASK_FULL_CARD_CREATE_DUPLICATE_TASK"),icon:K.Outline.DUPLICATE,onClick:async()=>{F.TaskCard.showCompactCard({})}}},getCreateNewTaskWithTemplateItem(){return{sectionCode:q,title:this.loc("TASKS_V2_TASK_FULL_CARD_CREATE_STANDALONE_TASK_WITH_TEMPLATE"),icon:K.Outline.CHEVRON_RIGHT_L,onClick:async()=>{F.TaskCard.showCompactCard({})}}},getCreateTemplateFromTaskItem(){return{sectionCode:q,title:this.loc("TASKS_V2_TASK_FULL_CARD_CREATE_TEMPLATE_FROM_TASK"),icon:K.Outline.TEMPLATE_TASK,onClick:async()=>{F.TaskCard.showCompactCard({})}}},getCopyTaskIdItem(){return{sectionCode:Y,title:this.loc("TASKS_V2_TASK_FULL_CARD_COPY_TASK_ID_ACTION"),icon:K.Outline.COPY,onClick:async()=>{const t=BX.clipboard.copy(this.taskId);if(t){BX.UI.Notification.Center.notify({content:this.loc("TASKS_V2_TASK_FULL_CARD_COPY_TASK_ID_NOTIF")})}}}},getGoToBitrixMarketItem(){return{sectionCode:Z,uiButtonOptions:{icon:K.Outline.MARKET,text:this.loc("TASKS_V2_TASK_FULL_CARD_GO_TO_BITRIX_MARKET"),size:R.ButtonSize.SMALL,useAirDesign:true,style:R.AirButtonStyle.OUTLINE,wide:true,disabled:false,onclick:async()=>{BX.rest.Marketplace.open({PLACEMENT:"TASK_LIST_CONTEXT_MENU"})}}}},getGoToRobotsItem(){return{sectionCode:Z,uiButtonOptions:{icon:K.Outline.ROBOT,text:this.loc("TASKS_V2_TASK_FULL_CARD_GO_TO_ROBOTS"),size:R.ButtonSize.SMALL,useAirDesign:true,style:R.AirButtonStyle.OUTLINE,wide:true,disabled:false,onclick:()=>{BX.SidePanel.Instance.open(`/bitrix/components/bitrix/tasks.automation/slider.php?site_id=${U.Loc.getMessage("SITE_ID")}&project_id=${this.task.groupId}&task_id=${this.taskId}`,{cacheable:false,customLeftBoundary:0,loader:"bizproc:automation-loader"})}}}}},template:`\n\t\t<div\n\t\t\tv-if="menuItems"\n\t\t\tclass="tasks-full-card-header-burger-container"\n\t\t\t@click="handleClickOpener"\n\t\t>\n\t\t\t<BIcon\n\t\t\t\tclass="tasks-full-card-header-burger"\n\t\t\t\tref="button"\n\t\t\t\t:name="Outline.MORE_L"\n\t\t\t/>\n\t\t</div>\n\t\t<BMenu v-if="isMenuShown" :options="menuOptions()" @close="isMenuShown = false"/>\n\t`};const Q={name:"TaskFullCardHeader",components:{TitleField:A.Title,Importance:g.Importance,BurgerMenu:J},props:{taskId:{type:[Number,String],required:true}},computed:{isEdit(){return U.Type.isNumber(this.taskId)&&this.taskId>0}},template:`\n\t\t<div class="tasks-full-card-header">\n\t\t\t<TitleField :taskId />\n\t\t\t<Importance :taskId />\n\t\t\t<BurgerMenu v-if="isEdit" :taskId/>\n\t\t</div>\n\t`};const tt={name:"TaskFullCardChat",props:{taskId:{type:[Number,String],required:true}},computed:{task(){return this.$store.getters[`${X.Model.Tasks}/getById`](this.taskId)},isEdit(){return Number.isInteger(this.taskId)&&this.taskId>0}},watch:{taskId(){void this.openChat()}},mounted(){void this.openChat()},methods:{async openChat(){var t,e;(t=this.app)==null?void 0:t.bitrixVue.unmount();(e=this.app)!=null?e:this.app=await B.Messenger.initApplication("task");if(this.isEdit){void this.app.mount({rootContainer:this.$el,chatId:this.task.chatId,taskId:this.taskId,type:w.Core.getParams().chatType})}else{await this.app.mountPlaceholder({rootContainer:this.$el,taskId:`'${this.taskId}'`});L.EventEmitter.emit("tasks:card:onMembersCountChange",{taskId:this.taskId,userCounter:1})}}},template:`\n\t\t<div class="tasks-full-card-chat"></div>\n\t`};const et={components:{Chip:O.Chip},props:{taskId:{type:[Number,String],required:true},chips:{type:Array,required:true}},setup(){return{Outline:K.Outline,ChipDesign:O.ChipDesign}},data(){return{chipsCollapsed:true}},mounted(){D.heightTransition.animate(this.$el)},updated(){D.heightTransition.animate(this.$el)},template:`\n\t\t<div class="tasks-full-card-chips">\n\t\t\t<template v-for="(chip, index) of chips" :key="index">\n\t\t\t\t<component\n\t\t\t\t\tv-if="!chip.collapsed || !chipsCollapsed"\n\t\t\t\t\t:is="chip.component ?? chip"\n\t\t\t\t\tv-bind="{ taskId }"\n\t\t\t\t\tv-on="chip.events ?? {}"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<Chip\n\t\t\t\t:design="ChipDesign.ShadowNoAccent"\n\t\t\t\t:icon="chipsCollapsed ? Outline.APPS : Outline.CHEVRON_TOP_L"\n\t\t\t\t:text="chipsCollapsed ? loc('TASKS_V2_TASK_FULL_CARD_MORE') : ''"\n\t\t\t\t@click="chipsCollapsed = !chipsCollapsed"\n\t\t\t/>\n\t\t</div>\n\t`};const st={components:{UiButton:R.Button,AddTaskButton:P.AddTaskButton},props:{taskId:{type:[Number,String],required:true}},emits:["addTask"],setup(){return{AirButtonStyle:R.AirButtonStyle,ButtonSize:R.ButtonSize}},computed:{isTemplateEnabled(){return w.Core.getParams().features.isTemplateEnabled}},methods:{close(){U.Event.EventEmitter.emit(X.EventName.CloseFullCard,{taskId:this.taskId})}},template:`\n\t\t<div class="tasks-full-card-footer-create">\n\t\t\t<div class="tasks-full-card-footer-main-buttons">\n\t\t\t\t<AddTaskButton :taskId="taskId" @addTask="$emit('addTask')"/>\n\t\t\t\t<UiButton\n\t\t\t\t\t:text="loc('TASKS_V2_TASK_FULL_CARD_CANCEL')"\n\t\t\t\t\t:size="ButtonSize.LARGE"\n\t\t\t\t\t:style="AirButtonStyle.PLAIN"\n\t\t\t\t\tdata-task-cancel-button\n\t\t\t\t\t@click="close"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<UiButton\n\t\t\t\tv-if="isTemplateEnabled"\n\t\t\t\tclass="tasks-full-card-footer-template-button"\n\t\t\t\t:text="loc('TASKS_V2_TASK_FULL_CARD_TEMPLATES')"\n\t\t\t\t:size="ButtonSize.SMALL"\n\t\t\t\t:style="AirButtonStyle.PLAIN_NO_ACCENT"\n\t\t\t\t:dropdown="true"\n\t\t\t/>\n\t\t</div>\n\t`};const it={name:"TaskFullCardMoreActionsStatus",components:{BIcon:K.BIcon,BMenu:M.BMenu},props:{taskId:{type:[Number,String],required:true}},setup(){return{Outline:N.Outline}},data(){return{isMenuShown:false}},computed:{...y.mapGetters({currentUserId:`${X.Model.Interface}/currentUserId`}),task(){return this.$store.getters[`${X.Model.Tasks}/getById`](this.taskId)},preselected(){return[["user",this.task.responsibleId||this.currentUserId]]},isCreator(){return this.currentUserId===this.task.creatorId},isResponsible(){return this.currentUserId===this.task.responsibleId},menuOptions(){return()=>({id:"tasks-full-card-footer-more-menu",bindElement:this.$refs.button.$el,items:this.menuItems})},menuItems(){const t={[X.TaskStatus.Pending]:{[this.isResponsible]:[this.getCompleteItem(),this.getDefferItem(),this.getDelegateItem()],[this.isCreator]:[this.getDefferItem(),this.getDelegateItem(),this.getDeleteItem()],[this.isResponsible&&this.isCreator]:[this.getCompleteItem(),this.getDefferItem(),this.getDelegateItem(),this.getDeleteItem()]},[X.TaskStatus.InProgress]:{[this.isResponsible]:[this.getPauseItem(),this.getDefferItem(),this.getDelegateItem()],[this.isCreator]:[this.getDefferItem(),this.getDelegateItem(),this.getDeleteItem()],[this.isResponsible&&this.isCreator]:[this.getPauseItem(),this.getDefferItem(),this.getDelegateItem(),this.getDeleteItem()]},[X.TaskStatus.Deferred]:{[this.isResponsible]:[this.getCompleteItem(),this.getDelegateItem()],[this.isCreator]:[this.getCompleteItem(),this.getDelegateItem(),this.getDeleteItem()]},[X.TaskStatus.SupposedlyCompleted]:{[this.isResponsible]:[this.getFixItem(),this.getDelegateItem()],[this.isCreator]:[this.getDisapproveItem(),this.getDelegateItem(),this.getDeleteItem()],[this.isResponsible&&this.isCreator]:[this.getCompleteItem(),this.getDelegateItem(),this.getDeleteItem()]},[X.TaskStatus.Completed]:{[this.isCreator]:[this.getRenewItem(),this.getDeleteItem()]}};return t[this.task.status].true}},methods:{handleClick(){this.isMenuShown=true},getDefferItem(){if(!this.task.rights.defer){return null}return{title:this.loc("TASKS_V2_TASK_FULL_CARD_DEFER"),icon:N.Outline.PAUSE_L,onClick:()=>G.statusService.defer(this.taskId)}},getPauseItem(){if(!this.task.rights.pause){return null}return{title:this.loc("TASKS_V2_TASK_FULL_CARD_PAUSE"),icon:N.Outline.STOP_L,onClick:()=>G.statusService.pause(this.taskId)}},getRenewItem(){if(!this.task.rights.renew){return null}return{title:this.loc("TASKS_V2_TASK_FULL_CARD_RENEW"),icon:N.Outline.UNDO,onClick:()=>G.statusService.renew(this.taskId)}},getFixItem(){if(!this.task.rights.renew){return null}return{title:this.loc("TASKS_V2_TASK_FULL_CARD_FIX"),icon:N.Outline.UNDO,onClick:()=>G.statusService.renew(this.taskId)}},getDisapproveItem(){if(!this.task.rights.disapprove){return null}return{title:this.loc("TASKS_V2_TASK_FULL_CARD_DISAPPROVE"),icon:N.Outline.UNDO,onClick:()=>G.statusService.disapprove(this.taskId)}},getCompleteItem(){if(!this.task.rights.complete){return null}return{title:this.loc("TASKS_V2_TASK_FULL_CARD_COMPLETE"),icon:N.Outline.SENDED,onClick:()=>G.statusService.complete(this.taskId)}},getDelegateItem(){if(!this.task.rights.delegate){return null}return{title:this.loc("TASKS_V2_TASK_FULL_CARD_DELEGATE"),icon:N.Outline.DELEGATE,onClick:()=>{var t;const e=U.Runtime.debounce(this.handleDelegateSelect,10,this);(t=this.dialog)!=null?t:this.dialog=new H.EntitySelectorDialog({...$.responsibleMeta.dialogOptions(this.$options.name),preselectedItems:this.preselected,events:{"Item:onSelect":e,"Item:onDeselect":e}});this.dialog.selectItemsByIds(this.preselected);this.dialog.showTo(this.$refs.button.$el)}}},handleDelegateSelect(){var t,e;const s=(t=(e=this.dialog.getSelectedItems()[0])==null?void 0:e.getId())!=null?t:0;void x.taskService.update(this.taskId,{responsibleId:s})},getDeleteItem(){if(!this.task.rights.remove){return null}return{design:M.MenuItemDesign.Alert,title:this.loc("TASKS_V2_TASK_FULL_CARD_DELETE"),icon:N.Outline.TRASHCAN,onClick:()=>{void x.taskService.delete(this.taskId);U.Event.EventEmitter.emit(X.EventName.CloseFullCard,{taskId:this.taskId})}}}},template:`\n\t\t<BIcon\n\t\t\tv-if="menuItems"\n\t\t\tclass="tasks-full-card-footer-more"\n\t\t\t:name="Outline.MORE_L"\n\t\t\tdata-task-more-button\n\t\t\tref="button"\n\t\t\t@click="handleClick"\n\t\t/>\n\t\t<BMenu v-if="isMenuShown" :options="menuOptions()" @close="isMenuShown = false"/>\n\t`};const at={components:{UiButton:R.Button,BIcon:K.BIcon,More:it},props:{taskId:{type:[Number,String],required:true}},setup(){return{AirButtonStyle:R.AirButtonStyle,ButtonSize:R.ButtonSize,ButtonIcon:R.ButtonIcon,Outline:N.Outline,TaskStatus:X.TaskStatus}},computed:{...y.mapGetters({currentUserId:`${X.Model.Interface}/currentUserId`}),task(){return this.$store.getters[`${X.Model.Tasks}/getById`](this.taskId)},isCreator(){return this.currentUserId===this.task.creatorId},isResponsible(){return this.currentUserId===this.task.responsibleId},statusButton(){const t={[X.TaskStatus.Pending]:{[this.isCreator]:this.getCompleteButton(),[this.isResponsible]:this.getStartButton()},[X.TaskStatus.InProgress]:{[this.isResponsible]:this.getCompleteButton(),[this.isCreator]:this.getCompleteButton()},[X.TaskStatus.Deferred]:{[this.isResponsible]:this.getRenewButton(),[this.isCreator]:this.getRenewButton()},[X.TaskStatus.SupposedlyCompleted]:{[this.isResponsible]:this.getReviewButton(),[this.isCreator]:this.getApproveButton()},[X.TaskStatus.Completed]:{[this.isResponsible&&!this.isCreator]:this.getRenewButton(R.AirButtonStyle.PLAIN)}};return t[this.task.status].true}},methods:{getStartButton(){if(!this.task.rights.start){return null}return{text:this.loc("TASKS_V2_TASK_FULL_CARD_START"),onClick:()=>G.statusService.start(this.taskId)}},getCompleteButton(){if(!this.task.rights.complete){return null}return{text:this.loc("TASKS_V2_TASK_FULL_CARD_COMPLETE"),onClick:()=>G.statusService.complete(this.taskId)}},getRenewButton(t){if(!this.task.rights.renew){return null}return{text:this.loc("TASKS_V2_TASK_FULL_CARD_RENEW"),style:t,onClick:()=>G.statusService.renew(this.taskId)}},getReviewButton(){return{text:this.loc("TASKS_V2_TASK_FULL_CARD_ON_REVIEW"),disabled:true}},getApproveButton(){if(!this.task.rights.approve){return null}return{text:this.loc("TASKS_V2_TASK_FULL_CARD_APPROVE"),onClick:()=>G.statusService.complete(this.taskId)}}},template:`\n\t\t<div class="tasks-full-card-footer-edit">\n\t\t\t<UiButton\n\t\t\t\tv-if="statusButton"\n\t\t\t\t:text="statusButton.text"\n\t\t\t\t:size="ButtonSize.LARGE"\n\t\t\t\t:style="statusButton.style ?? AirButtonStyle.FILLED"\n\t\t\t\t:disabled="statusButton.disabled ?? false"\n\t\t\t\tdata-task-status-button\n\t\t\t\t@click="statusButton.onClick"\n\t\t\t/>\n\t\t\t<More :taskId="taskId"/>\n\t\t\t<div class="tasks-full-card-footer-actions">\n\t\t\t\t<div class="tasks-full-card-footer-reaction">\n\t\t\t\t\t<BIcon :name="Outline.LIKE"/>\n\t\t\t\t\t<div class="tasks-full-card-footer-reaction-text">\u041d\u0440\u0430\u0432\u0438\u0442\u0441\u044f</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-full-card-footer-views">\n\t\t\t\t\t<BIcon :name="Outline.OBSERVER"/>\n\t\t\t\t\t<div class="tasks-full-card-footer-views-text">1</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const nt={name:"TaskFullCard",components:{TaskHeader:Q,DescriptionField:n.DescriptionField,DescriptionSheet:n.DescriptionSheet,Files:d.Files,FilesSheet:d.FilesSheet,CheckList:c.CheckList,DatePlan:m.DatePlan,DatePlanSheet:m.DatePlanSheet,SubTasks:I.SubTasks,ParentTask:C.ParentTask,RelatedTasks:_.RelatedTasks,FieldList:i.FieldList,Chat:tt,FooterCreate:st,FooterEdit:at,DropZone:a.DropZone,Chips:et},provide(){return{analytics:this.analytics,cardType:X.CardType.Full}},props:{id:{type:[Number,String],default:()=>U.Text.getRandom()},analytics:{type:Object,default:()=>({})}},setup(){return{filesMeta:d.filesMeta,datePlanMeta:m.datePlanMeta,checkListMeta:c.checkListMeta,subTasksMeta:I.subTasksMeta,parentTaskMeta:C.parentTaskMeta,relatedTasksMeta:_.relatedTasksMeta,resizeObserver:null}},data(){return{taskId:this.id,isFilesSheetShown:false,isDescriptionSheetShown:false,isCheckListSheetShown:false,isDatePlanSheetShown:false,checkListId:0,files:v.fileService.get(this.id).getFiles()}},computed:{...y.mapGetters({currentUserId:`${X.Model.Interface}/currentUserId`}),task(){return this.$store.getters[`${X.Model.Tasks}/getById`](this.taskId)},checkLists(){var t;return(t=this.task)!=null&&t.checklist?this.$store.getters[`${X.Model.CheckList}/getByIds`](this.task.checklist):[]},isEdit(){return Number.isInteger(this.taskId)&&this.taskId>0},isPartiallyLoaded(){return this.$store.getters[`${X.Model.Tasks}/isPartiallyLoaded`](this.taskId)},fields(){const t=[{title:o.creatorMeta.title,component:o.Creator,props:{context:this.$options.name,selectorWithActionMenu:this.isEdit}},{title:$.responsibleMeta.title,component:$.Responsible,props:{context:this.$options.name,selectorWithActionMenu:this.isEdit}},{title:r.deadlineMeta.title,component:r.Deadline},{title:l.statusMeta.title,component:l.Status,withSeparator:true},{chip:d.FilesChip},{chip:{component:c.CheckListChip,events:{showCheckList:this.openCheckList}}},{title:h.groupMeta.getTitle(this.task.groupId),component:h.Group,chip:h.GroupChip,isEnabled:w.Core.getParams().features.isProjectsEnabled},{title:p.accomplicesMeta.title,component:p.Accomplices,chip:p.AccomplicesChip},{title:k.auditorsMeta.title,component:k.Auditors,chip:k.AuditorsChip,withSeparator:this.wasFilled(p.accomplicesMeta.id)},{title:u.flowMeta.title,component:u.Flow,chip:u.FlowChip,withSeparator:true,isEnabled:w.Core.getParams().features.isFlowEnabled},{title:S.tagsMeta.title,component:S.Tags,chip:S.TagsChip},{title:T.crmMeta.title,component:T.Crm,chip:{component:T.CrmChip,collapsed:true},withSeparator:this.wasFilled(h.groupMeta.id)||this.wasFilled(u.flowMeta.id)},{chip:{component:C.ParentTaskChip,collapsed:true}},{chip:{component:I.SubTasksChip,collapsed:true}},{chip:{component:_.RelatedTasksChip,collapsed:true}},{chip:{component:m.DatePlanChip,collapsed:true,events:{open:this.openDatePlan}}}];t.forEach((t=>{var e;(e=t.props)!=null?e:t.props={};t.props.taskId=this.taskId}));return t},primaryFields(){const t=new Set([o.Creator,$.Responsible,r.Deadline,...this.isEdit?[l.Status]:[]]);return this.fields.filter((({component:e})=>t.has(e)))},projectFields(){const t=new Set;if(this.wasFilled(h.groupMeta.id)){t.add(h.Group)}if(this.wasFilled(u.flowMeta.id)){t.add(u.Flow)}if(this.wasFilled(T.crmMeta.id)){t.add(T.Crm)}return this.fields.filter((({component:e})=>t.has(e)))},participantsFields(){const t=new Set;if(this.wasFilled(p.accomplicesMeta.id)){t.add(p.Accomplices)}if(this.wasFilled(k.auditorsMeta.id)){t.add(k.Auditors)}return this.fields.filter((({component:e})=>t.has(e)))},tagsFields(){if(!this.wasFilled(S.tagsMeta.id)){return[]}return this.fields.filter((({component:t})=>t===S.Tags))},chips(){return this.fields.filter((({chip:t,isEnabled:e})=>t&&e!==false)).map((({chip:t})=>t))},isBottomSheetShown(){return this.isDescriptionSheetShown||this.isFilesSheetShown||this.isCheckListSheetShown||this.isDatePlanSheetShown}},watch:{async task(){if(this.task){await this.$nextTick();this.tryStartObserver()}}},async created(){var t;if(!this.isEdit&&!this.task){void this.$store.dispatch(`${X.Model.Tasks}/insert`,{id:this.taskId,creatorId:this.currentUserId})}await this.$store.dispatch(`${X.Model.Tasks}/clearFieldsFilled`,this.taskId);if(this.isEdit&&(!this.task||this.isPartiallyLoaded)){await x.taskService.getById(this.taskId)}await v.fileService.get(this.taskId).list(this.task.fileIds);n.descriptionTextEditor.get(this.taskId,{content:(t=this.task)==null?void 0:t.description})},mounted(){var t;this.tryStartObserver();(t=this.$refs.skeleton)==null?void 0:t.append(F.FullSkeleton())},beforeUnmount(){var t;(t=this.resizeObserver)==null?void 0:t.disconnect()},unmounted(){if(!this.isEdit){void this.$store.dispatch(`${X.Model.Tasks}/delete`,this.taskId);v.fileService.delete(this.taskId);n.descriptionTextEditor.delete(this.taskId)}},methods:{wasFilled(t){return this.$store.getters[`${X.Model.Tasks}/wasFieldFilled`](this.taskId,t)},tryStartObserver(){if(this.$refs.title&&!this.resizeObserver){this.resizeObserver=this.getObserver();this.resizeObserver.observe(this.$refs.title)}},getObserver(){return new ResizeObserver((t=>{for(const e of t){if(e.target===this.$refs.title){void this.$store.dispatch(`${X.Model.Interface}/updateTitleFieldOffsetHeight`,e.contentRect.height)}}}))},async addTask(){var t,e;await((t=this.$refs)==null?void 0:(e=t.description)==null?void 0:e.save());const s=this.checkLists;const[i]=await x.taskService.add(this.task);this.taskId=i;if(s.length>0){await f.checkListService.save(this.taskId,s)}v.fileService.replace(this.id,this.taskId);n.descriptionTextEditor.replace(this.id,this.taskId)},openEditor(){this.isDescriptionSheetShown=true;this.handleShowBottomSheet()},closeEditor(t){t.close();this.isDescriptionSheetShown=false;this.handleCloseBottomSheet()},openFiles(){this.isFilesSheetShown=true;this.handleShowBottomSheet()},closeFiles(){this.isFilesSheetShown=false;this.handleCloseBottomSheet()},openCheckList(t){this.checkListId=t;this.isCheckListSheetShown=true;this.handleShowBottomSheet()},closeCheckList(t){this.checkListId=t;this.isCheckListSheetShown=false;this.handleCloseBottomSheet()},openDatePlan(){this.isDatePlanSheetShown=true;this.handleShowBottomSheet()},closeDatePlan(){this.isDatePlanSheetShown=false;this.handleCloseBottomSheet()},handleShowBottomSheet(){U.Dom.addClass(this.$refs.scrollContent,"--disable-scroll")},handleCloseBottomSheet(){U.Dom.removeClass(this.$refs.scrollContent,"--disable-scroll")},close(){L.EventEmitter.emit(X.EventName.CloseFullCard,{taskId:this.taskId})}},template:`\n\t\t<div class="tasks-full-card" :class="{ '--blur': isDescriptionSheetShown }" :data-task-id="taskId" data-task-full>\n\t\t\t<template v-if="task && !isPartiallyLoaded">\n\t\t\t\t<div class="tasks-full-card-main" :class="{ '--overlay': isBottomSheetShown }" ref="main">\n\t\t\t\t\t<div class="tasks-full-card-content" :data-task-card-scroll="taskId" ref="scrollContent">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tref="title">\n\t\t\t\t\t\t\t<TaskHeader :taskId/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<FilesSheet\n\t\t\t\t\t\t\t:taskId="taskId"\n\t\t\t\t\t\t\t:isShown="isFilesSheetShown"\n\t\t\t\t\t\t\t:getBindElement="() => $refs.title"\n\t\t\t\t\t\t\t:getTargetContainer="() => $refs.main"\n\t\t\t\t\t\t\t@close="closeFiles"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<CheckList\n\t\t\t\t\t\t\t:taskId="taskId"\n\t\t\t\t\t\t\t:checkListId="checkListId"\n\t\t\t\t\t\t\t:isShown="isCheckListSheetShown"\n\t\t\t\t\t\t\t:getBindElement="() => $refs.title"\n\t\t\t\t\t\t\t:getTargetContainer="() => $refs.main"\n\t\t\t\t\t\t\t@close="closeCheckList"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<DatePlanSheet\n\t\t\t\t\t\t\t:taskId="taskId"\n\t\t\t\t\t\t\t:isShown="isDatePlanSheetShown"\n\t\t\t\t\t\t\t:getBindElement="() => $refs.title"\n\t\t\t\t\t\t\t:getTargetContainer="() => $refs.main"\n\t\t\t\t\t\t\t@close="closeDatePlan"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<DescriptionField\n\t\t\t\t\t\t\t:taskId="taskId"\n\t\t\t\t\t\t\tv-slot="slot"\n\t\t\t\t\t\t\tref="description"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<DescriptionSheet\n\t\t\t\t\t\t\t\t:taskId="taskId"\n\t\t\t\t\t\t\t\t:isShown="slot.isShown"\n\t\t\t\t\t\t\t\t:doOpenInEditMode="slot.doOpenInEditMode"\n\t\t\t\t\t\t\t\t:getBindElement="() => $refs.title"\n\t\t\t\t\t\t\t\t:getTargetContainer="() => $refs.main"\n\t\t\t\t\t\t\t\t@show="openEditor"\n\t\t\t\t\t\t\t\t@close="closeEditor(slot)"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</DescriptionField>\n\t\t\t\t\t\t<div class="tasks-full-card-fields">\n\t\t\t\t\t\t\t<div class="tasks-full-card-field-container" data-field-container>\n\t\t\t\t\t\t\t\t<FieldList :fields="primaryFields"/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="tasks-full-card-chips-fields">\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tv-if="files.length > 0 || wasFilled(filesMeta.id)"\n\t\t\t\t\t\t\t\t\tclass="tasks-full-card-field-container --small-vertical-padding"\n\t\t\t\t\t\t\t\t\tdata-field-container\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Files :taskId="taskId" @open="openFiles"/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tv-if="wasFilled(checkListMeta.id)"\n\t\t\t\t\t\t\t\t\tclass="tasks-full-card-field-container --custom"\n\t\t\t\t\t\t\t\t\tdata-field-container\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<CheckList\n\t\t\t\t\t\t\t\t\t\t:taskId="taskId"\n\t\t\t\t\t\t\t\t\t\t:isPreview="true"\n\t\t\t\t\t\t\t\t\t\t:isComponentShown="!isCheckListSheetShown"\n\t\t\t\t\t\t\t\t\t\t:checkListId="checkListId"\n\t\t\t\t\t\t\t\t\t\t@open="openCheckList"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tv-if="projectFields.length > 0"\n\t\t\t\t\t\t\t\t\tclass="tasks-full-card-field-container"\n\t\t\t\t\t\t\t\t\tdata-field-container\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<FieldList :fields="projectFields"/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tv-if="participantsFields.length > 0"\n\t\t\t\t\t\t\t\t\tclass="tasks-full-card-field-container"\n\t\t\t\t\t\t\t\t\tdata-field-container\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<FieldList\n\t\t\t\t\t\t\t\t\t\t:fields="participantsFields"\n\t\t\t\t\t\t\t\t\t\t:useSeparator="participantsFields.length > 1"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tv-if="tagsFields.length > 0"\n\t\t\t\t\t\t\t\t\tclass="tasks-full-card-field-container"\n\t\t\t\t\t\t\t\t\tdata-field-container\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<FieldList :fields="tagsFields"/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tv-if="wasFilled(datePlanMeta.id)"\n\t\t\t\t\t\t\t\t\tclass="tasks-full-card-field-container"\n\t\t\t\t\t\t\t\t\tdata-field-container\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<DatePlan :taskId="taskId" @open="openDatePlan"/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tv-if="wasFilled(parentTaskMeta.id)"\n\t\t\t\t\t\t\t\t\tclass="tasks-full-card-field-container --custom"\n\t\t\t\t\t\t\t\t\tdata-field-container\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<ParentTask :taskId="taskId"/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tv-if="wasFilled(subTasksMeta.id)"\n\t\t\t\t\t\t\t\t\tclass="tasks-full-card-field-container --custom"\n\t\t\t\t\t\t\t\t\tdata-field-container\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<SubTasks :taskId="taskId"/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tv-if="wasFilled(relatedTasksMeta.id)"\n\t\t\t\t\t\t\t\t\tclass="tasks-full-card-field-container --custom"\n\t\t\t\t\t\t\t\t\tdata-field-container\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<RelatedTasks :taskId="taskId"/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<Chips :taskId="taskId" :chips="chips"/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<DropZone\n\t\t\t\t\t\t\tv-if="!isBottomSheetShown"\n\t\t\t\t\t\t\t:taskId="taskId"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-full-card-footer">\n\t\t\t\t\t\t<FooterEdit v-if="isEdit" :taskId="taskId"/>\n\t\t\t\t\t\t<FooterCreate v-else :taskId="taskId" @addTask="addTask"/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<Chat :taskId="taskId"/>\n\t\t\t</template>\n\t\t\t<template v-else>\n\t\t\t\t<div ref="skeleton" style="width: 100%;"></div>\n\t\t\t</template>\n\t\t</div>\n\t`};var ot=babelHelpers.classPrivateFieldLooseKey("params");var rt=babelHelpers.classPrivateFieldLooseKey("slider");var lt=babelHelpers.classPrivateFieldLooseKey("application");var dt=babelHelpers.classPrivateFieldLooseKey("handlers");var ct=babelHelpers.classPrivateFieldLooseKey("needToReloadGrid");var ht=babelHelpers.classPrivateFieldLooseKey("mountApplication");var ut=babelHelpers.classPrivateFieldLooseKey("unmountApplication");var pt=babelHelpers.classPrivateFieldLooseKey("subscribe");var kt=babelHelpers.classPrivateFieldLooseKey("unsubscribe");var St=babelHelpers.classPrivateFieldLooseKey("handleTaskUpdate");var Tt=babelHelpers.classPrivateFieldLooseKey("onClose");var mt=babelHelpers.classPrivateFieldLooseKey("openFullCard");var It=babelHelpers.classPrivateFieldLooseKey("openCompactCard");var Ct=babelHelpers.classPrivateFieldLooseKey("openGrid");var _t=babelHelpers.classPrivateFieldLooseKey("handlePopupShow");class vt{constructor(t={}){Object.defineProperty(this,kt,{value:bt});Object.defineProperty(this,pt,{value:gt});Object.defineProperty(this,ut,{value:At});Object.defineProperty(this,ht,{value:ft});Object.defineProperty(this,ot,{writable:true,value:void 0});Object.defineProperty(this,rt,{writable:true,value:void 0});Object.defineProperty(this,lt,{writable:true,value:void 0});Object.defineProperty(this,dt,{writable:true,value:void 0});Object.defineProperty(this,ct,{writable:true,value:false});Object.defineProperty(this,St,{writable:true,value:t=>{if(t.getData().id===babelHelpers.classPrivateFieldLooseBase(this,ot)[ot].taskId){const e=new Set(["deadlineTs","responsibleId"]);const s=Object.keys(t.getData());if(s.some((t=>e.has(t)))){babelHelpers.classPrivateFieldLooseBase(this,ct)[ct]=true}}}});Object.defineProperty(this,Tt,{writable:true,value:t=>{if(t.getData().taskId===babelHelpers.classPrivateFieldLooseBase(this,ot)[ot].taskId){babelHelpers.classPrivateFieldLooseBase(this,rt)[rt].close()}}});Object.defineProperty(this,mt,{writable:true,value:async t=>{const{TaskCard:e}=await U.Runtime.loadExtension("tasks.v2.application.task-card");const s=t.getData();e.showFullCard(s)}});Object.defineProperty(this,It,{writable:true,value:async t=>{const{TaskCard:e}=await U.Runtime.loadExtension("tasks.v2.application.task-card");const s=t.getData();e.showCompactCard(s)}});Object.defineProperty(this,Ct,{writable:true,value:t=>{const{taskId:e,type:s}=t.getData();const i=w.Core.getParams().currentUserId;BX.SidePanel.Instance.open(`/company/personal/user/${i}/tasks/?relationToId=${e}&relationType=${s}`)}});Object.defineProperty(this,_t,{writable:true,value:t=>{const e=t.getCompatData()[0];if(e.getTargetContainer()!==document.body){return}const s=()=>e.adjustPosition();const i=()=>{e.unsubscribe("onClose",i);e.unsubscribe("onDestroy",i);U.Event.unbind(document,"scroll",s,true)};e.subscribe("onClose",i);e.subscribe("onDestroy",i);U.Event.bind(document,"scroll",s,true)}});babelHelpers.classPrivateFieldLooseBase(this,ot)[ot]=t;babelHelpers.classPrivateFieldLooseBase(this,ot)[ot].taskId=babelHelpers.classPrivateFieldLooseBase(this,ot)[ot].taskId||U.Text.getRandom()}async mountCard(t){if(!t.isOpen()){return}babelHelpers.classPrivateFieldLooseBase(this,rt)[rt]=t;babelHelpers.classPrivateFieldLooseBase(this,pt)[pt]();babelHelpers.classPrivateFieldLooseBase(this,lt)[lt]=await babelHelpers.classPrivateFieldLooseBase(this,ht)[ht](t.getContentContainer())}unmountCard(){babelHelpers.classPrivateFieldLooseBase(this,ut)[ut]();babelHelpers.classPrivateFieldLooseBase(this,kt)[kt]();if(babelHelpers.classPrivateFieldLooseBase(this,ct)[ct]&&BX.Tasks.Util){const t=babelHelpers.classPrivateFieldLooseBase(this,ot)[ot].taskId;BX.Tasks.Util.fireGlobalTaskEvent("UPDATE",{ID:t},{STAY_AT_PAGE:true},{id:t})}}}async function ft(t){await w.Core.init();const i=e.BitrixVue.createApp(nt,{...babelHelpers.classPrivateFieldLooseBase(this,ot)[ot],id:babelHelpers.classPrivateFieldLooseBase(this,ot)[ot].taskId});i.mixin(s.locMixin);i.use(w.Core.getStore());i.mount(t);return i}function At(){var t;(t=babelHelpers.classPrivateFieldLooseBase(this,lt)[lt])==null?void 0:t.unmount()}function gt(){babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]={[X.EventName.TaskUpdate]:babelHelpers.classPrivateFieldLooseBase(this,St)[St],[X.EventName.CloseFullCard]:babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt],[X.EventName.OpenFullCard]:babelHelpers.classPrivateFieldLooseBase(this,mt)[mt],[X.EventName.OpenCompactCard]:babelHelpers.classPrivateFieldLooseBase(this,It)[It],[X.EventName.OpenGrid]:babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct],"BX.Main.Popup:onShow":babelHelpers.classPrivateFieldLooseBase(this,_t)[_t]};Object.entries(babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]).forEach((([t,e])=>L.EventEmitter.subscribe(t,e)))}function bt(){Object.entries(babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]).forEach((([t,e])=>L.EventEmitter.unsubscribe(t,e)))}t.TaskFullCard=vt})(this.BX.Tasks.V2.Application=this.BX.Tasks.V2.Application||{},BX.Vue3,BX.Vue3.Mixins,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Component,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Provider.Service,BX.Tasks.V2.Provider.Service,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX,BX.Tasks.V2.Application,BX.Event,BX.Messenger.v2.Lib,BX.Messenger.v2.Application,BX.UI.System.Chip.Vue,BX.Tasks.V2.Lib,BX.Tasks.V2,BX.Tasks.V2.Component,BX.Vue3.Components,BX,BX.Vue3.Vuex,BX.UI.Vue3.Components,BX.UI.IconSet,BX.UI.IconSet,BX,BX.Tasks.V2.Const,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Lib,BX.Tasks.V2.Provider.Service,BX.Tasks.V2.Provider.Service);
//# sourceMappingURL=task-full-card.bundle.map.js