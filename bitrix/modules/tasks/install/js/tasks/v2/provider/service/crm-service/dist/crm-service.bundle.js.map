{"version":3,"file":"crm-service.bundle.js","sources":["../src/mappers.js","../src/crm-service.js","../src/index.js"],"sourcesContent":["import { EntitySelectorEntity } from 'tasks.v2.const';\nimport type { CrmItemModel } from 'tasks.v2.model.crm-items';\nimport type { CrmItemDto } from './types';\n\nconst entityPrefixMap = {\n\t[EntitySelectorEntity.Deal]: 'D',\n\t[EntitySelectorEntity.Contact]: 'C',\n\t[EntitySelectorEntity.Company]: 'CO',\n\t[EntitySelectorEntity.Lead]: 'L',\n\t[EntitySelectorEntity.SmartInvoice]: 'SI',\n};\n\nconst prefixEntityMap = Object.fromEntries(Object.entries(entityPrefixMap).map((it) => it.reverse()));\n\nexport function mapDtoToModel(crmItemDto: CrmItemDto): CrmItemModel\n{\n\treturn {\n\t\tid: crmItemDto.id,\n\t\tentityId: crmItemDto.entityId,\n\t\ttype: crmItemDto.type,\n\t\ttypeName: crmItemDto.typeName,\n\t\ttitle: crmItemDto.title,\n\t\tlink: crmItemDto.link,\n\t};\n}\n\nexport function mapId(entityId: string, id: number): string\n{\n\tif (!entityPrefixMap[entityId])\n\t{\n\t\tconst [typeId, itemId] = id.split(':');\n\n\t\treturn `T${Number(typeId).toString(16)}_${itemId}`;\n\t}\n\n\treturn `${entityPrefixMap[entityId]}_${id}`;\n}\n\nexport function splitId(id: string): string\n{\n\tconst [prefix, entityId] = id.split('_');\n\tif (!prefixEntityMap[prefix])\n\t{\n\t\treturn [EntitySelectorEntity.DynamicMultiple, `${parseInt(prefix.slice(1), 16)}:${entityId}`];\n\t}\n\n\treturn [prefixEntityMap[prefix], Number(entityId)];\n}\n","import type { Store } from 'ui.vue3.vuex';\n\nimport { Model } from 'tasks.v2.const';\nimport { Core } from 'tasks.v2.core';\nimport { apiClient } from 'tasks.v2.lib.api-client';\nimport type { CrmItemModel } from 'tasks.v2.model.crm-items';\n\nimport { mapDtoToModel } from './mappers';\nimport type { CrmItemDto } from './types';\n\nexport const crmService = new class\n{\n\tasync list(id: number, crmItemIds: string[]): Promise<void>\n\t{\n\t\tconst data = await apiClient.post('Task.CRM.Item.list', { task: { id, crmItemIds } });\n\n\t\tconst crmItems = data.map((dto: CrmItemDto): CrmItemModel => mapDtoToModel(dto));\n\n\t\tawait this.$store.dispatch(`${Model.CrmItems}/upsertMany`, crmItems);\n\t}\n\n\tget $store(): Store\n\t{\n\t\treturn Core.getStore();\n\t}\n}();\n","import { mapId, splitId } from './mappers';\n\nexport { crmService } from './crm-service';\nexport const CrmMappers = { mapId, splitId };\nexport type { CrmItemDto } from './types';\n"],"names":["entityPrefixMap","EntitySelectorEntity","Deal","Contact","Company","Lead","SmartInvoice","prefixEntityMap","Object","fromEntries","entries","map","it","reverse","mapDtoToModel","crmItemDto","id","entityId","type","typeName","title","link","mapId","typeId","itemId","split","Number","toString","splitId","prefix","DynamicMultiple","parseInt","slice","crmService","list","crmItemIds","data","apiClient","post","task","crmItems","dto","$store","dispatch","Model","CrmItems","Core","getStore","CrmMappers"],"mappings":";;;;;;;;CAIA,MAAMA,eAAe,GAAG;GACvB,CAACC,mCAAoB,CAACC,IAAI,GAAG,GAAG;GAChC,CAACD,mCAAoB,CAACE,OAAO,GAAG,GAAG;GACnC,CAACF,mCAAoB,CAACG,OAAO,GAAG,IAAI;GACpC,CAACH,mCAAoB,CAACI,IAAI,GAAG,GAAG;GAChC,CAACJ,mCAAoB,CAACK,YAAY,GAAG;CACtC,CAAC;CAED,MAAMC,eAAe,GAAGC,MAAM,CAACC,WAAW,CAACD,MAAM,CAACE,OAAO,CAACV,eAAe,CAAC,CAACW,GAAG,CAAEC,EAAE,IAAKA,EAAE,CAACC,OAAO,EAAE,CAAC,CAAC;AAErG,CAAO,SAASC,aAAa,CAACC,UAAsB,EACpD;GACC,OAAO;KACNC,EAAE,EAAED,UAAU,CAACC,EAAE;KACjBC,QAAQ,EAAEF,UAAU,CAACE,QAAQ;KAC7BC,IAAI,EAAEH,UAAU,CAACG,IAAI;KACrBC,QAAQ,EAAEJ,UAAU,CAACI,QAAQ;KAC7BC,KAAK,EAAEL,UAAU,CAACK,KAAK;KACvBC,IAAI,EAAEN,UAAU,CAACM;IACjB;CACF;AAEA,CAAO,SAASC,KAAK,CAACL,QAAgB,EAAED,EAAU,EAClD;GACC,IAAI,CAAChB,eAAe,CAACiB,QAAQ,CAAC,EAC9B;KACC,MAAM,CAACM,MAAM,EAAEC,MAAM,CAAC,GAAGR,EAAE,CAACS,KAAK,CAAC,GAAG,CAAC;KAEtC,OAAQ,IAAGC,MAAM,CAACH,MAAM,CAAC,CAACI,QAAQ,CAAC,EAAE,CAAE,IAAGH,MAAO,EAAC;;GAGnD,OAAQ,GAAExB,eAAe,CAACiB,QAAQ,CAAE,IAAGD,EAAG,EAAC;CAC5C;AAEA,CAAO,SAASY,OAAO,CAACZ,EAAU,EAClC;GACC,MAAM,CAACa,MAAM,EAAEZ,QAAQ,CAAC,GAAGD,EAAE,CAACS,KAAK,CAAC,GAAG,CAAC;GACxC,IAAI,CAAClB,eAAe,CAACsB,MAAM,CAAC,EAC5B;KACC,OAAO,CAAC5B,mCAAoB,CAAC6B,eAAe,EAAG,GAAEC,QAAQ,CAACF,MAAM,CAACG,KAAK,CAAC,CAAC,CAAC,EAAE,EAAE,CAAE,IAAGf,QAAS,EAAC,CAAC;;GAG9F,OAAO,CAACV,eAAe,CAACsB,MAAM,CAAC,EAAEH,MAAM,CAACT,QAAQ,CAAC,CAAC;CACnD;;OCrCagB,UAAU,GAAG,IAAI,MAC9B;GACC,MAAMC,IAAI,CAAClB,EAAU,EAAEmB,UAAoB,EAC3C;KACC,MAAMC,IAAI,GAAG,MAAMC,gCAAS,CAACC,IAAI,CAAC,oBAAoB,EAAE;OAAEC,IAAI,EAAE;SAAEvB,EAAE;SAAEmB;;MAAc,CAAC;KAErF,MAAMK,QAAQ,GAAGJ,IAAI,CAACzB,GAAG,CAAE8B,GAAe,IAAmB3B,aAAa,CAAC2B,GAAG,CAAC,CAAC;KAEhF,MAAM,IAAI,CAACC,MAAM,CAACC,QAAQ,CAAE,GAAEC,oBAAK,CAACC,QAAS,aAAY,EAAEL,QAAQ,CAAC;;GAGrE,IAAIE,MAAM,GACV;KACC,OAAOI,kBAAI,CAACC,QAAQ,EAAE;;CAExB,CAAC,EAAE;;OCtBUC,UAAU,GAAG;GAAE1B,KAAK;GAAEM;CAAQ,CAAC;;;;;;;;;"}