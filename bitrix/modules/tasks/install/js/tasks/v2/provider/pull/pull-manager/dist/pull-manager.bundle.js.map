{"version":3,"file":"pull-manager.bundle.js","sources":["../src/handler/base-pull-handler.js","../src/task-pull-handler/mappers.js","../src/task-pull-handler/task-pull-handler.js","../src/pull-manager.js"],"sourcesContent":["export class BasePullHandler\n{\n\tconstructor()\n\t{\n\t\tif (new.target === BasePullHandler)\n\t\t{\n\t\t\tthrow new TypeError('BasePullHandler: An abstract class cannot be instantiated');\n\t\t}\n\t}\n\n\tgetMap(): { [command: string]: Function }\n\t{\n\t\treturn {};\n\t}\n\n\tgetDelayedMap(): { [command: string]: Function }\n\t{\n\t\treturn {};\n\t}\n}\n","import { Type } from 'main.core';\nimport { TaskStatus } from 'tasks.v2.const';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\nimport type { PushData } from './types';\n\nexport function mapPushToModel({ AFTER: after, TASK_ID: id }: PushData): TaskModel\n{\n\tconst task: TaskModel = {\n\t\tid,\n\t\ttitle: prepareValue(after.TITLE),\n\t\tisImportant: prepareValue(after.PRIORITY, after.PRIORITY === 2),\n\t\tcreatorId: prepareValue(after.CREATED_BY),\n\t\tresponsibleId: prepareValue(after.RESPONSIBLE_ID),\n\t\tdeadlineTs: prepareValue(after.DEADLINE, after.DEADLINE * 1000),\n\t\tchecklist: undefined,\n\t\tgroupId: prepareValue(after.GROUP_ID),\n\t\tstageId: prepareValue(after.STAGE, after.STAGE_INFO?.id ?? 0),\n\t\tflowId: prepareValue(after.FLOW_ID),\n\t\tstatus: prepareValue(after.STATUS, mapStatus(after.STATUS)),\n\t\tstatusChangedTs: prepareValue(after.STATUS, Date.now()),\n\t\taccomplicesIds: prepareValue(after.ACCOMPLICES, mapUserIds(after.ACCOMPLICES)),\n\t\tauditorsIds: prepareValue(after.AUDITORS, mapUserIds(after.AUDITORS)),\n\t\tparentId: prepareValue(after.PARENT_ID, Number(after.PARENT_ID) || 0),\n\t\ttags: prepareValue(after.TAGS, after.TAGS ? after.TAGS.split(',') : []),\n\t};\n\n\treturn Object.fromEntries(Object.entries(task).filter(([, value]) => !Type.isUndefined(value)));\n}\n\nfunction mapStatus(status: number): string\n{\n\treturn {\n\t\t2: TaskStatus.Pending,\n\t\t3: TaskStatus.InProgress,\n\t\t4: TaskStatus.SupposedlyCompleted,\n\t\t5: TaskStatus.Completed,\n\t\t6: TaskStatus.Deferred,\n\t}[status] ?? TaskStatus.Pending;\n}\n\nfunction mapUserIds(users: string): number[]\n{\n\tif (!users)\n\t{\n\t\treturn [];\n\t}\n\n\treturn users.split(',').map((id: string) => Number(id));\n}\n\nfunction prepareValue(value: any, mappedValue: ?any = value): any | undefined\n{\n\treturn Type.isUndefined(value) ? undefined : mappedValue;\n}\n","import { Loc, Text } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport type { Store } from 'ui.vue3.vuex';\n\nimport { EventName, Model } from 'tasks.v2.const';\nimport { Core } from 'tasks.v2.core';\nimport { taskService } from 'tasks.v2.provider.service.task-service';\nimport { subTasksService } from 'tasks.v2.provider.service.relation-service';\nimport { GroupMappers, groupService, type StageDto } from 'tasks.v2.provider.service.group-service';\nimport { flowService } from 'tasks.v2.provider.service.flow-service';\nimport { userService } from 'tasks.v2.provider.service.user-service';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\nimport type { StageModel } from 'tasks.v2.model.stages';\n\nimport { BasePullHandler } from '../handler/base-pull-handler';\nimport { mapPushToModel } from './mappers';\nimport type { PushData } from './types';\n\nexport class TaskPullHandler extends BasePullHandler\n{\n\tgetMap(): { [command: string]: Function }\n\t{\n\t\treturn {\n\t\t\ttask_add: this.#handleTaskAdded,\n\t\t\ttask_update: this.#handleTaskUpdated,\n\t\t\ttask_view: this.#handleTaskViewed,\n\t\t\ttask_remove: this.#handleTaskDeleted,\n\t\t\tdefault_deadline_changed: this.#handleDefaultDeadlineChanged,\n\t\t};\n\t}\n\n\tgetDelayedMap(): { [command: string]: Function }\n\t{\n\t\treturn {\n\t\t\ttask_update: this.#handleTaskUpdatedDelayed,\n\t\t};\n\t}\n\n\t#handleTaskAdded = (data): void => {\n\t\tconst features = Core.getParams().features;\n\n\t\t// show task created balloon if miniform feature is enabled\n\t\tconst showTaskAddedBalloon = (data.AFTER.USER_ID === this.#currentUserId)\n\t\t\t&& (features.isMiniformEnabled && !features.isV2Enabled)\n\t\t;\n\n\t\tif (showTaskAddedBalloon)\n\t\t{\n\t\t\tconst url = data.AFTER.URL ?? '';\n\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tid: Text.getRandom(),\n\t\t\t\tcontent: Loc.getMessage('TASKS_V2_NOTIFY_TASK_CREATED'),\n\t\t\t\tactions: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttitle: Loc.getMessage('TASKS_V2_NOTIFY_TASK_DO_VIEW'),\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tclick: (event, balloon) => {\n\t\t\t\t\t\t\t\tballoon.close();\n\t\t\t\t\t\t\t\tBX.SidePanel.Instance.open(url);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t}\n\t};\n\n\t#handleTaskUpdated = (data: PushData): void => {\n\t\tthis.#upsertStage(data.AFTER.STAGE_INFO);\n\n\t\tconst task = mapPushToModel(data);\n\n\t\tif (data.BEFORE.PARENT_ID)\n\t\t{\n\t\t\tsubTasksService.deleteStore(data.BEFORE.PARENT_ID, [task.id]);\n\t\t}\n\n\t\tif (task.parentId)\n\t\t{\n\t\t\tsubTasksService.addStore(task.parentId, [task.id]);\n\t\t}\n\t};\n\n\t#handleTaskUpdatedDelayed = async (data: PushData): Promise<void> => {\n\t\tconst task = mapPushToModel(data);\n\n\t\tif (this.#needToLoadTask(data))\n\t\t{\n\t\t\tvoid this.#loadTask(task);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tawait Promise.all([\n\t\t\t\tthis.#loadGroup(task),\n\t\t\t\tthis.#loadFlow(task),\n\t\t\t\tthis.#loadUsers(task),\n\t\t\t\tthis.#loadRights(task),\n\t\t\t]);\n\n\t\t\tconst { id, ...fields } = task;\n\n\t\t\tvoid this.$store.dispatch(`${Model.Tasks}/update`, { id, fields });\n\t\t}\n\t};\n\n\t#handleTaskViewed = (data): void => {};\n\n\t#handleTaskDeleted = (data: PushData): void => {\n\t\tsubTasksService.deleteStore(data.BEFORE.PARENT_ID, [data.TASK_ID]);\n\t\tEventEmitter.emit(EventName.CloseFullCard, { taskId: data.TASK_ID });\n\t\tvoid this.$store.dispatch(`${Model.Tasks}/delete`, data.TASK_ID);\n\t};\n\n\t#handleDefaultDeadlineChanged = (data): void => {\n\t\tvoid this.$store.dispatch(`${Model.Interface}/updateDefaultDeadline`, {\n\t\t\tdefaultDeadlineDate: data.defaultDeadlineDate,\n\t\t\tdefaultDeadlineInSeconds: data.deadline,\n\t\t});\n\t};\n\n\t#upsertStage(stageDto: StageDto): void\n\t{\n\t\tif (stageDto)\n\t\t{\n\t\t\tconst stage: StageModel = GroupMappers.mapStageDtoToModel(stageDto);\n\n\t\t\tvoid this.$store.dispatch(`${Model.Stages}/upsert`, stage);\n\t\t}\n\t}\n\n\t#loadTask(task: TaskModel): void\n\t{\n\t\tvoid taskService.getById(task.id);\n\t}\n\n\t#needToLoadTask(data: PushData): boolean\n\t{\n\t\tconst notPushableFields = new Set(['DESCRIPTION', 'UF_TASK_WEBDAV_FILES']);\n\n\t\treturn Object.keys(data.AFTER).some((field: string) => notPushableFields.has(field));\n\t}\n\n\tasync #loadGroup(task: TaskModel): Promise<void>\n\t{\n\t\tif (this.#needToLoadGroup(task))\n\t\t{\n\t\t\tawait groupService.getGroup(task.groupId);\n\t\t}\n\t}\n\n\t#needToLoadGroup(task: TaskModel): boolean\n\t{\n\t\tif (this.#needToLoadFlow(task))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn task.groupId && !this.$store.getters[`${Model.Groups}/getById`](task.groupId);\n\t}\n\n\tasync #loadFlow(task: TaskModel): Promise<void>\n\t{\n\t\tif (this.#needToLoadFlow(task))\n\t\t{\n\t\t\tawait flowService.getFlow(task.flowId);\n\t\t}\n\t}\n\n\t#needToLoadFlow(task: TaskModel): boolean\n\t{\n\t\treturn Boolean(task.flowId) && !this.$store.getters[`${Model.Flows}/getById`](task.flowId);\n\t}\n\n\tasync #loadUsers(task: TaskModel): Promise<void>\n\t{\n\t\tif (this.#needToLoadUsers(task))\n\t\t{\n\t\t\tawait userService.list(this.#getUsersIds(task));\n\t\t}\n\t}\n\n\t#needToLoadUsers(task: TaskModel): boolean\n\t{\n\t\treturn !userService.hasUsers(this.#getUsersIds(task));\n\t}\n\n\t#getUsersIds(task: TaskModel): number[]\n\t{\n\t\treturn [\n\t\t\ttask.creatorId,\n\t\t\ttask.responsibleId,\n\t\t\t...(task.accomplicesIds ?? []),\n\t\t\t...(task.auditorsIds ?? []),\n\t\t].filter((id: ?number) => id);\n\t}\n\n\tasync #loadRights(task: TaskModel): Promise<void>\n\t{\n\t\tawait taskService.getRights(task.id);\n\t}\n\n\tget #currentUserId(): number\n\t{\n\t\treturn this.$store.getters[`${Model.Interface}/currentUserId`];\n\t}\n\n\tget $store(): Store\n\t{\n\t\treturn Core.getStore();\n\t}\n}\n","import { Text } from 'main.core';\nimport type { BaseEvent } from 'main.core.events';\n\nimport { QueueManager } from 'pull.queuemanager';\nimport type { ActionItem } from 'pull.queuemanager';\n\nimport { Module } from 'tasks.v2.const';\nimport { TaskPullHandler } from './task-pull-handler/task-pull-handler';\nimport type { BasePullHandler } from './handler/base-pull-handler';\n\ntype Params = {\n\tcurrentUserId: number,\n};\n\nexport class PullManager\n{\n\t#params: Params;\n\t#loadItemsDelay: number = 500;\n\n\t#handlers: Set<BasePullHandler>;\n\n\tconstructor(params: Params)\n\t{\n\t\tthis.#params = params;\n\n\t\tthis.#handlers = new Set([\n\t\t\tnew TaskPullHandler(),\n\t\t]);\n\t}\n\n\tinitQueueManager(): QueueManager\n\t{\n\t\treturn new QueueManager({\n\t\t\tmoduleId: Module.Tasks,\n\t\t\tuserId: this.#params.currentUserId,\n\t\t\tconfig: {\n\t\t\t\tloadItemsDelay: this.#loadItemsDelay,\n\t\t\t},\n\t\t\tadditionalData: {},\n\t\t\tevents: {\n\t\t\t\tonBeforePull: (baseEvent: BaseEvent) => {\n\t\t\t\t\tthis.#onBeforePull(baseEvent);\n\t\t\t\t},\n\t\t\t\tonPull: (baseEvent: BaseEvent) => {\n\t\t\t\t\tthis.#onPull(baseEvent);\n\t\t\t\t},\n\t\t\t},\n\t\t\tcallbacks: {\n\t\t\t\tonBeforeQueueExecute: (items: Array<ActionItem>) => {\n\t\t\t\t\treturn this.#onBeforeQueueExecute(items);\n\t\t\t\t},\n\t\t\t\tonQueueExecute: (items: Array<ActionItem>) => {\n\t\t\t\t\treturn this.#onQueueExecute(items);\n\t\t\t\t},\n\t\t\t\tonReload: () => {\n\t\t\t\t\tthis.#onReload();\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\t#onBeforePull(baseEvent: BaseEvent): void\n\t{\n\t\tconst { pullData: { command, params } } = baseEvent.data;\n\n\t\tfor (const handler of this.#handlers)\n\t\t{\n\t\t\thandler.getMap()[command]?.(params);\n\t\t}\n\t}\n\n\t#onPull(baseEvent: BaseEvent): void\n\t{\n\t\tconst { pullData: { command, params }, promises } = baseEvent.data;\n\n\t\tfor (const handler of this.#handlers)\n\t\t{\n\t\t\tif (handler.getDelayedMap()[command])\n\t\t\t{\n\t\t\t\tpromises.push(\n\t\t\t\t\tPromise.resolve({\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tid: params.entityId ?? Text.getRandom(),\n\t\t\t\t\t\t\tcommand,\n\t\t\t\t\t\t\tparams,\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\t#onBeforeQueueExecute(items: Array<ActionItem>): Promise\n\t{\n\t\treturn Promise.resolve();\n\t}\n\n\tasync #onQueueExecute(items: Array<ActionItem>): Promise\n\t{\n\t\tawait this.#executeQueue(items);\n\t}\n\n\t#onReload(event) {}\n\n\t#executeQueue(items: Array<ActionItem>): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\titems.forEach((item: ActionItem) => {\n\t\t\t\tconst { data: { command, params } } = item;\n\n\t\t\t\tfor (const handler of this.#handlers)\n\t\t\t\t{\n\t\t\t\t\thandler.getDelayedMap()[command]?.(params);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tresolve();\n\t\t});\n\t}\n}\n"],"names":["BasePullHandler","constructor","new","target","TypeError","getMap","getDelayedMap","mapPushToModel","AFTER","after","TASK_ID","id","task","title","prepareValue","TITLE","isImportant","PRIORITY","creatorId","CREATED_BY","responsibleId","RESPONSIBLE_ID","deadlineTs","DEADLINE","checklist","undefined","groupId","GROUP_ID","stageId","STAGE","STAGE_INFO","flowId","FLOW_ID","status","STATUS","mapStatus","statusChangedTs","Date","now","accomplicesIds","ACCOMPLICES","mapUserIds","auditorsIds","AUDITORS","parentId","PARENT_ID","Number","tags","TAGS","split","Object","fromEntries","entries","filter","value","Type","isUndefined","TaskStatus","Pending","InProgress","SupposedlyCompleted","Completed","Deferred","users","map","mappedValue","TaskPullHandler","data","features","Core","getParams","showTaskAddedBalloon","USER_ID","isMiniformEnabled","isV2Enabled","url","URL","BX","UI","Notification","Center","notify","Text","getRandom","content","Loc","getMessage","actions","events","click","event","balloon","close","SidePanel","Instance","open","BEFORE","subTasksService","deleteStore","addStore","Promise","all","fields","$store","dispatch","Model","Tasks","EventEmitter","emit","EventName","CloseFullCard","taskId","Interface","defaultDeadlineDate","defaultDeadlineInSeconds","deadline","task_add","task_update","task_view","task_remove","default_deadline_changed","getStore","stageDto","stage","GroupMappers","mapStageDtoToModel","Stages","taskService","getById","notPushableFields","Set","keys","some","field","has","groupService","getGroup","getters","Groups","flowService","getFlow","Boolean","Flows","userService","list","hasUsers","getRights","PullManager","params","initQueueManager","QueueManager","moduleId","Module","userId","currentUserId","config","loadItemsDelay","additionalData","onBeforePull","baseEvent","onPull","callbacks","onBeforeQueueExecute","items","onQueueExecute","onReload","pullData","command","handler","promises","push","resolve","entityId","forEach","item"],"mappings":"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"}