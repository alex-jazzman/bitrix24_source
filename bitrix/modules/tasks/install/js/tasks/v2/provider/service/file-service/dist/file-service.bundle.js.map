{"version":3,"file":"file-service.bundle.js","sources":["../src/mappers.js","../src/util.js","../src/file-service.js"],"sourcesContent":["import type { UploaderFileInfo } from 'ui.uploader.core';\nimport type { FileDto } from './types';\n\nexport function mapDtoToModel(fileDto: FileDto): UploaderFileInfo\n{\n\treturn {\n\t\tserverFileId: fileDto.id,\n\t\tserverId: fileDto.serverId,\n\t\ttype: fileDto.type,\n\t\tname: fileDto.name,\n\t\tsize: fileDto.size,\n\t\twidth: fileDto.width,\n\t\theight: fileDto.height,\n\t\tisImage: fileDto.isImage,\n\t\tisVideo: fileDto.isVideo,\n\t\ttreatImageAsFile: fileDto.treatImageAsFile,\n\t\tdownloadUrl: fileDto.downloadUrl,\n\t\tserverPreviewUrl: fileDto.serverPreviewUrl,\n\t\tserverPreviewWidth: fileDto.serverPreviewWidth,\n\t\tserverPreviewHeight: fileDto.serverPreviewHeight,\n\t\tcustomData: fileDto.customData,\n\t\tviewerAttrs: fileDto.viewerAttrs,\n\t};\n}\n","import { Type } from 'main.core';\n\nexport const processCheckListFileIds = (fileIds) => {\n\tif (!Array.isArray(fileIds))\n\t{\n\t\treturn [];\n\t}\n\n\treturn fileIds.reduce((result, item) => {\n\t\tif (Type.isObjectLike(item) && 'id' in item && 'fileId' in item)\n\t\t{\n\t\t\tresult.push({\n\t\t\t\tid: item.id,\n\t\t\t\tfileId: item.fileId,\n\t\t\t});\n\t\t}\n\t\telse if (Type.isString(item) && item.startsWith('n'))\n\t\t{\n\t\t\tresult.push({\n\t\t\t\tid: item,\n\t\t\t\tfileId: item,\n\t\t\t});\n\t\t}\n\n\t\treturn result;\n\t}, []);\n};\n","import { Runtime, Type, Loc, Text } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport type { BaseEvent } from 'main.core.events';\n\nimport { FileStatus } from 'ui.uploader.core';\nimport { VueUploaderAdapter } from 'ui.uploader.vue';\nimport type { UploaderFileInfo } from 'ui.uploader.core';\nimport type { Store } from 'ui.vue3.vuex';\nimport { VueRefValue } from 'ui.vue3';\nimport { UI } from 'ui.notification';\n\nimport { UserFieldMenu, openDiskFileDialog } from 'disk.uploader.user-field-widget';\nimport { Model } from 'tasks.v2.const';\nimport { Core } from 'tasks.v2.core';\nimport { apiClient } from 'tasks.v2.lib.api-client';\n\nimport { mapDtoToModel } from './mappers';\nimport { processCheckListFileIds } from './util';\nimport type { FileId, FileDto } from './types';\n\nexport type BrowseParams = {\n\tbindElement: HTMLElement,\n\tonShowCallback?: Function,\n\tonHideCallback?: Function,\n\tcompact: boolean,\n};\n\nexport const EntityTypes = Object.freeze({\n\tTask: 'task',\n\tCheckListItem: 'checkListItem',\n});\n\nexport type EntityType = $Values<typeof EntityTypes>;\n\ntype Options = {\n\tparentEntityId?: number | string,\n}\n\nexport class FileService extends EventEmitter\n{\n\t#entityId: number | string;\n\t#entityType: EntityType;\n\t#options: Options;\n\t#menu: UserFieldMenu;\n\t#loadedIds: Set<FileId> = new Set();\n\t#objectsIds: { [id: FileId]: number } = {};\n\t#promises: Promise[] = [];\n\t#adapter: VueUploaderAdapter;\n\t#fileBrowserClosed: boolean = false;\n\t#filesToAttach: UploaderFileInfo[] = [];\n\t#filesToDetach: UploaderFileInfo[] = [];\n\t#isDetachedErrorMode: boolean = false;\n\t#saveAttachedFilesDebounced: Function;\n\t#saveDetachedFilesDebounced: Function;\n\n\tconstructor(\n\t\tentityId: number | string,\n\t\tentityType: EntityType = EntityTypes.Task,\n\t\toptions: Options = {},\n\t)\n\t{\n\t\tsuper();\n\n\t\tthis.setEventNamespace('Tasks.V2.Provider.Service.FileService');\n\t\tthis.setEntityId(entityId, entityType);\n\t\tthis.initAdapter(entityId, entityType);\n\n\t\tthis.#options = options;\n\n\t\tthis.#saveAttachedFilesDebounced = Runtime.debounce(this.#saveAttachedFiles, 3000, this);\n\t\tthis.#saveDetachedFilesDebounced = Runtime.debounce(this.#saveDetachedFiles, 3000, this);\n\t}\n\n\tinitAdapter(entityId: number | string, entityType: EntityType): void\n\t{\n\t\tthis.#adapter = new VueUploaderAdapter({\n\t\t\tid: getServiceKey(entityId, entityType),\n\t\t\tcontroller: 'disk.uf.integration.diskUploaderController',\n\t\t\timagePreviewHeight: 1200,\n\t\t\timagePreviewWidth: 1200,\n\t\t\timagePreviewQuality: 0.85,\n\t\t\tignoreUnknownImageTypes: true,\n\t\t\ttreatOversizeImageAsFile: true,\n\t\t\tmultiple: true,\n\t\t\tmaxFileSize: null,\n\t\t});\n\n\t\tthis.#adapter.subscribeFromOptions({\n\t\t\t'Item:onAdd': (event: BaseEvent) => {\n\t\t\t\tconst { item: file } = event.getData();\n\n\t\t\t\tthis.#addLoadedIds([file.serverFileId]);\n\n\t\t\t\tthis.emit('onFileAdd');\n\t\t\t},\n\t\t\t'Item:onComplete': (event: BaseEvent) => {\n\t\t\t\tconst { item: file } = event.getData();\n\n\t\t\t\tthis.#addLoadedObjectsIds([file]);\n\n\t\t\t\tconst fileIds = new Set(this.#entityFileIds);\n\t\t\t\tif (!this.#getIdsByObjectId(file.customData.objectId).some((id: FileId) => fileIds.has(id)))\n\t\t\t\t{\n\t\t\t\t\tthis.#attachFiles([...fileIds, file.serverFileId], file);\n\t\t\t\t}\n\n\t\t\t\tthis.emit('onFileComplete', file);\n\t\t\t},\n\t\t\t'Item:onRemove': (event: BaseEvent) => {\n\t\t\t\tconst { item: file } = event.getData();\n\n\t\t\t\tconst idsToRemove = new Set(this.#getIdsByObjectId(file.customData.objectId));\n\t\t\t\tthis.#removeLoadedObjectsIds(idsToRemove);\n\n\t\t\t\tthis.#detachFiles(this.#getEntityFileIds(idsToRemove), file);\n\n\t\t\t\tthis.emit('onFileRemove', { file });\n\t\t\t},\n\t\t});\n\t}\n\n\tsetEntityId(entityId: number | string, entityType: EntityType = EntityTypes.Task): void\n\t{\n\t\tthis.#entityId = entityId;\n\t\tthis.#entityType = entityType;\n\t}\n\n\tgetEntityId(): string\n\t{\n\t\treturn this.#entityId;\n\t}\n\n\tgetAdapter(): VueUploaderAdapter\n\t{\n\t\treturn this.#adapter;\n\t}\n\n\tgetFiles(): VueRefValue<UploaderFileInfo>\n\t{\n\t\treturn this.#adapter.getReactiveItems();\n\t}\n\n\tisUploading(): boolean\n\t{\n\t\treturn this.#adapter.getItems().some(({ status }) => [\n\t\t\tFileStatus.UPLOADING,\n\t\t\tFileStatus.LOADING,\n\t\t].includes(status));\n\t}\n\n\thasUploadingError(): boolean\n\t{\n\t\treturn this.#adapter.getItems().some(({ status }) => [\n\t\t\tFileStatus.UPLOAD_FAILED,\n\t\t\tFileStatus.LOAD_FAILED,\n\t\t].includes(status));\n\t}\n\n\tbrowse(params: BrowseParams): void\n\t{\n\t\tthis.#menu = new UserFieldMenu({\n\t\t\tdialogId: 'task-card',\n\t\t\tuploader: this.#adapter.getUploader(),\n\t\t\tcompact: params.compact || false,\n\t\t\tmenuOptions: {\n\t\t\t\tminWidth: 220,\n\t\t\t\tanimation: 'fading',\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tbindOptions: {\n\t\t\t\t\tforceBindPosition: true,\n\t\t\t\t\tforceTop: true,\n\t\t\t\t\tposition: 'top',\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose: () => {\n\t\t\t\t\t\tparams.onHideCallback?.();\n\t\t\t\t\t},\n\t\t\t\t\tonPopupShow: () => {\n\t\t\t\t\t\tparams.onShowCallback?.();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tthis.#menu.show(params.bindElement);\n\t}\n\n\t#browseElement: HTMLElement;\n\n\tbrowseFiles(): void\n\t{\n\t\tif (!this.#browseElement)\n\t\t{\n\t\t\tthis.#browseElement = document.createElement('div');\n\t\t\tthis.#adapter.getUploader().assignBrowse(this.#browseElement);\n\t\t}\n\n\t\tthis.#browseElement.click();\n\t}\n\n\tbrowseMyDrive(): void\n\t{\n\t\topenDiskFileDialog({\n\t\t\tdialogId: 'task-card',\n\t\t\tuploader: this.#adapter.getUploader(),\n\t\t});\n\t}\n\n\tsetFileBrowserClosed(value: boolean): void\n\t{\n\t\tthis.#fileBrowserClosed = value;\n\t\tthis.emit('onFileBrowserClosed');\n\t}\n\n\tisFileBrowserClosed(): boolean\n\t{\n\t\treturn this.#fileBrowserClosed;\n\t}\n\n\tresetFileBrowserClosedState(): void\n\t{\n\t\tthis.#fileBrowserClosed = false;\n\t}\n\n\tdestroy(): void\n\t{\n\t\tthis.#adapter.unsubscribeAll('Item:onAdd');\n\t\tthis.#adapter.unsubscribeAll('Item:onComplete');\n\t\tthis.#adapter.unsubscribeAll('Item:onRemove');\n\t\tthis.#adapter.getUploader().destroy();\n\t}\n\n\tasync sync(ids: FileId[] | null): Promise<void>\n\t{\n\t\tif (!Type.isArrayFilled(ids))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (ids.every((id: FileId) => this.#loadedIds.has(id)))\n\t\t{\n\t\t\tthis.#adapter.getItems().forEach((file) => {\n\t\t\t\tconst uploaderIds = [file.serverFileId];\n\t\t\t\tif (this.#isNewFile(file.serverFileId))\n\t\t\t\t{\n\t\t\t\t\tconst objectId = Number(file.serverFileId.slice(1));\n\n\t\t\t\t\tuploaderIds.push(...this.#getIdsByObjectId(objectId));\n\t\t\t\t}\n\n\t\t\t\tif (uploaderIds.some((id: FileId) => ids.includes(id)))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.#adapter.getUploader().removeFile(file.id);\n\t\t\t});\n\t\t}\n\n\t\tawait this.list(ids);\n\t}\n\n\tasync list(ids: FileId[]): Promise<UploaderFileInfo[]>\n\t{\n\t\tconst unloadedIds = ids.filter((id) => !this.#isNewFile(id) && !this.#loadedIds.has(id));\n\t\tif (unloadedIds.length === 0)\n\t\t{\n\t\t\tawait Promise.all(this.#promises);\n\n\t\t\treturn this.#adapter.getItems();\n\t\t}\n\n\t\tconst promise = new Resolvable();\n\t\tthis.#promises.push(promise);\n\t\tthis.#addLoadedIds(unloadedIds);\n\n\t\ttry\n\t\t{\n\t\t\tlet data = [];\n\n\t\t\tif (this.#entityType === EntityTypes.Task)\n\t\t\t{\n\t\t\t\tdata = await apiClient.post('File.list', {\n\t\t\t\t\ttaskId: this.#entityId,\n\t\t\t\t\tids: unloadedIds,\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (this.#entityType === EntityTypes.CheckListItem)\n\t\t\t{\n\t\t\t\tdata = await apiClient.post('Task.CheckList.File.list', {\n\t\t\t\t\ttaskId: this.#options.parentEntityId,\n\t\t\t\t\tids: unloadedIds,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst files = data.map((fileDto: FileDto) => mapDtoToModel(fileDto));\n\n\t\t\tconst objectsIds = new Set(Object.values(this.#objectsIds));\n\t\t\tconst newFiles = files.filter(({ customData }) => !objectsIds.has(customData.objectId));\n\t\t\tthis.#adapter.getUploader().addFiles(newFiles);\n\t\t\tthis.#addLoadedObjectsIds(files);\n\n\t\t\tpromise.resolve();\n\n\t\t\tawait Promise.all(this.#promises);\n\n\t\t\treturn this.#adapter.getItems();\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error('FileService: list error', error);\n\n\t\t\treturn [];\n\t\t}\n\t}\n\n\t#addLoadedIds(ids: FileId[]): void\n\t{\n\t\tids.forEach((id: FileId): void => this.#loadedIds.add(id));\n\t}\n\n\t#addLoadedObjectsIds(files: UploaderFileInfo[]): void\n\t{\n\t\tfiles.forEach((file: UploaderFileInfo) => {\n\t\t\tthis.#objectsIds[file.serverFileId] = file.customData.objectId;\n\t\t});\n\t}\n\n\t#removeLoadedObjectsIds(ids: FileId[]): void\n\t{\n\t\tids.forEach((id: FileId) => {\n\t\t\tdelete this.#objectsIds[id];\n\t\t});\n\t}\n\n\t#getIdsByObjectId(objectIdToFind: number): FileId[]\n\t{\n\t\treturn Object.entries(this.#objectsIds)\n\t\t\t.filter(([, objectId]): boolean => objectId === objectIdToFind)\n\t\t\t.map(([id]): FileId => (this.#isNewFile(id) ? id : Number(id)))\n\t\t;\n\t}\n\n\t#attachFiles(fileIds: FileId[], attachedFile: UploaderFileInfo): void\n\t{\n\t\tif (this.#entityType === EntityTypes.Task)\n\t\t{\n\t\t\tconst id = this.#entityId;\n\n\t\t\tvoid this.$store.dispatch(`${Model.Tasks}/update`, {\n\t\t\t\tid,\n\t\t\t\tfields: { fileIds },\n\t\t\t});\n\n\t\t\tif (this.#isDetachedErrorMode)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.#isRealId(id) && this.#isNewFile(attachedFile.serverFileId))\n\t\t\t{\n\t\t\t\tthis.#filesToAttach.push(attachedFile);\n\t\t\t\tthis.#saveAttachedFilesDebounced();\n\t\t\t}\n\t\t}\n\t\telse if (this.#entityType === EntityTypes.CheckListItem)\n\t\t{\n\t\t\tthis.#processCheckListFileIds(fileIds);\n\t\t}\n\t}\n\n\t#detachFiles(fileIds: FileId[], detachedFile: UploaderFileInfo): void\n\t{\n\t\tif (this.#entityType === EntityTypes.Task)\n\t\t{\n\t\t\tconst id = this.#entityId;\n\n\t\t\tvoid this.$store.dispatch(`${Model.Tasks}/update`, {\n\t\t\t\tid,\n\t\t\t\tfields: { fileIds },\n\t\t\t});\n\n\t\t\tif (this.#isRealId(id))\n\t\t\t{\n\t\t\t\tconst detachedId = detachedFile.serverFileId;\n\t\t\t\tconst attachedIndex = this.#filesToAttach.findIndex((file) => file.serverFileId === detachedId);\n\t\t\t\tif (attachedIndex === -1)\n\t\t\t\t{\n\t\t\t\t\tthis.#filesToDetach.push(detachedFile);\n\t\t\t\t\tthis.#saveDetachedFilesDebounced();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.#filesToAttach.splice(attachedIndex, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if (this.#entityType === EntityTypes.CheckListItem)\n\t\t{\n\t\t\tthis.#processCheckListFileIds(fileIds);\n\t\t}\n\t}\n\n\t#getEntityFileIds(excludedIds: Set<FileId> = new Set()): []\n\t{\n\t\tif (this.#entityType === EntityTypes.Task)\n\t\t{\n\t\t\treturn this.#entityFileIds.filter((id: FileId) => !excludedIds.has(id));\n\t\t}\n\n\t\tif (this.#entityType === EntityTypes.CheckListItem)\n\t\t{\n\t\t\treturn this.#entityFileIds.filter((attach) => !excludedIds.has(attach.id));\n\t\t}\n\n\t\treturn [];\n\t}\n\n\t#processCheckListFileIds(fileIds: FileId[]): void\n\t{\n\t\tconst attachments = processCheckListFileIds(fileIds);\n\n\t\tvoid this.$store.dispatch(`${Model.CheckList}/update`, {\n\t\t\tid: this.#entityId,\n\t\t\tfields: { attachments },\n\t\t});\n\t}\n\n\t#isRealId(id: number): boolean\n\t{\n\t\treturn Number.isInteger(id) && id > 0;\n\t}\n\n\t#isNewFile(id: number | string): boolean\n\t{\n\t\treturn String(id).startsWith('n');\n\t}\n\n\tasync #saveAttachedFiles(): void\n\t{\n\t\tif (Type.isArrayFilled(this.#filesToAttach))\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst ids = this.#filesToAttach.map((file) => file.serverFileId);\n\t\t\t\tthis.#filesToAttach = [];\n\n\t\t\t\tvoid apiClient.post('File.attach', { task: { id: this.#entityId }, ids });\n\t\t\t}\n\t\t\tcatch (error)\n\t\t\t{\n\t\t\t\tconsole.error('FileService: saveAttachedFiles error', error);\n\n\t\t\t\tthis.notifyError(Loc.getMessage('TASKS_V2_NOTIFY_FILE_ATTACH_ERROR'));\n\t\t\t}\n\t\t}\n\t}\n\n\tasync #saveDetachedFiles(): void\n\t{\n\t\tif (Type.isArrayFilled(this.#filesToDetach))\n\t\t{\n\t\t\tconst filesBeforeDetach = this.#filesToDetach;\n\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst ids = this.#filesToDetach.map((file) => file.serverFileId);\n\t\t\t\tthis.#filesToDetach = [];\n\n\t\t\t\tawait apiClient.post('File.detach', { task: { id: this.#entityId }, ids });\n\t\t\t}\n\t\t\tcatch (error)\n\t\t\t{\n\t\t\t\tconsole.error('FileService: saveDetachedFiles error', error);\n\n\t\t\t\tthis.#isDetachedErrorMode = true;\n\n\t\t\t\tthis.#adapter.getUploader().addFiles(filesBeforeDetach);\n\n\t\t\t\tthis.#isDetachedErrorMode = false;\n\n\t\t\t\tthis.notifyError(Loc.getMessage('TASKS_V2_NOTIFY_FILE_DETACH_ERROR'));\n\t\t\t}\n\t\t}\n\t}\n\n\tnotifyError(content: string): void\n\t{\n\t\tUI.Notification.Center.notify({\n\t\t\tcontent,\n\t\t\tid: `file-service-error-${Text.getRandom()}`,\n\t\t});\n\t}\n\n\tget #entityFileIds(): []\n\t{\n\t\tif (this.#entityType === EntityTypes.Task)\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Tasks}/getById`](this.#entityId).fileIds;\n\t\t}\n\n\t\treturn this.$store.getters[`${Model.CheckList}/getById`](this.#entityId).attachments;\n\t}\n\n\tget $store(): Store\n\t{\n\t\treturn Core.getStore();\n\t}\n}\n\nconst services: { [key: string]: FileService } = {};\n\nfunction getServiceKey(entityId: number, entityType: EntityType): string\n{\n\treturn `${entityType}:${entityId}`;\n}\n\nexport const fileService = {\n\tget(\n\t\tentityId: number,\n\t\tentityType: EntityType = EntityTypes.Task,\n\t\toptions: Options = {},\n\t): FileService\n\t{\n\t\tconst key = getServiceKey(entityId, entityType);\n\t\tservices[key] ??= new FileService(entityId, entityType, options);\n\n\t\treturn services[key];\n\t},\n\treplace(tempId: number, entityId: number, entityType: EntityType = EntityTypes.Task): void\n\t{\n\t\tconst oldKey = getServiceKey(tempId, entityType);\n\t\tconst newKey = getServiceKey(entityId, entityType);\n\n\t\tservices[newKey] = services[oldKey];\n\t\tservices[newKey].setEntityId(entityId, entityType);\n\n\t\tdelete services[oldKey];\n\t},\n\tdelete(entityId: number, entityType: EntityType = EntityTypes.Task): void\n\t{\n\t\tconst key = getServiceKey(entityId, entityType);\n\n\t\tservices[key]?.destroy();\n\n\t\tdelete services[key];\n\t},\n};\n\nfunction Resolvable(): Promise\n{\n\tconst promise = new Promise((resolve) => {\n\t\tthis.resolve = resolve;\n\t});\n\n\tpromise.resolve = this.resolve;\n\n\treturn promise;\n}\n"],"names":["mapDtoToModel","fileDto","serverFileId","id","serverId","type","name","size","width","height","isImage","isVideo","treatImageAsFile","downloadUrl","serverPreviewUrl","serverPreviewWidth","serverPreviewHeight","customData","viewerAttrs","processCheckListFileIds","fileIds","Array","isArray","reduce","result","item","Type","isObjectLike","push","fileId","isString","startsWith","EntityTypes","Object","freeze","Task","CheckListItem","FileService","EventEmitter","constructor","entityId","entityType","options","Set","setEventNamespace","setEntityId","initAdapter","Runtime","debounce","VueUploaderAdapter","getServiceKey","controller","imagePreviewHeight","imagePreviewWidth","imagePreviewQuality","ignoreUnknownImageTypes","treatOversizeImageAsFile","multiple","maxFileSize","subscribeFromOptions","event","file","getData","emit","objectId","some","has","idsToRemove","getEntityId","getAdapter","getFiles","getReactiveItems","isUploading","getItems","status","FileStatus","UPLOADING","LOADING","includes","hasUploadingError","UPLOAD_FAILED","LOAD_FAILED","browse","params","UserFieldMenu","dialogId","uploader","getUploader","compact","menuOptions","minWidth","animation","closeByEsc","bindOptions","forceBindPosition","forceTop","position","events","onPopupClose","onHideCallback","onPopupShow","onShowCallback","show","bindElement","browseFiles","document","createElement","assignBrowse","click","browseMyDrive","openDiskFileDialog","setFileBrowserClosed","value","isFileBrowserClosed","resetFileBrowserClosedState","destroy","unsubscribeAll","sync","ids","isArrayFilled","every","forEach","uploaderIds","Number","slice","removeFile","list","unloadedIds","filter","length","Promise","all","promise","Resolvable","data","apiClient","post","taskId","parentEntityId","files","map","objectsIds","values","newFiles","addFiles","resolve","error","console","notifyError","content","UI","Notification","Center","notify","Text","getRandom","$store","Core","getStore","add","objectIdToFind","entries","attachedFile","dispatch","Model","Tasks","fields","detachedFile","detachedId","attachedIndex","findIndex","splice","excludedIds","attach","attachments","CheckList","isInteger","String","task","Loc","getMessage","filesBeforeDetach","getters","services","fileService","get","key","replace","tempId","oldKey","newKey","delete"],"mappings":"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"}