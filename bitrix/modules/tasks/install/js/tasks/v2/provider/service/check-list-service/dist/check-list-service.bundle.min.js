this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};this.BX.Tasks.V2=this.BX.Tasks.V2||{};this.BX.Tasks.V2.Provider=this.BX.Tasks.V2.Provider||{};(function(e,t,s,a,i,o,l){"use strict";function d(e){const t=new Map;e.forEach((e=>{t.set(e.id,e.nodeId)}));return e.map((e=>{const s=e.parentId?t.get(e.parentId):0;return{...e,parentNodeId:s}}))}function n(e){var t,a;return{id:e.id,nodeId:e.nodeId,title:e.title,creator:e.creator?s.UserMappers.mapDtoToModel(e.creator):null,toggledBy:e.toggledBy?s.UserMappers.mapDtoToModel(e.toggledBy):null,toggledDate:e.toggledDate,accomplices:(t=e.accomplices)==null?void 0:t.map((e=>s.UserMappers.mapDtoToModel(e))),auditors:(a=e.auditors)==null?void 0:a.map((e=>s.UserMappers.mapDtoToModel(e))),attachments:e.attachments,isComplete:e.isComplete,isImportant:e.isImportant,parentId:e.parentId,parentNodeId:e.parentNodeId,sortIndex:e.sortIndex,actions:e.actions,panelIsShown:e.panelIsShown,myFilterActive:e.myFilterActive,collapsed:e.collapsed,expanded:e.expanded,localCompleteState:e.localCompleteState,localCollapsedState:e.localCollapsedState,areCompletedCollapsed:e.areCompletedCollapsed,hidden:e.hidden,groupMode:e.groupMode}}function r(e){return Object.fromEntries(e.map((e=>{var s,a,i,o,l;const d=(s=e.accomplices)==null?void 0:s.map((e=>({ID:e.id,TYPE:"A",NAME:e.name,IMAGE:e.image,IS_COLLABER:e.type===t.UserTypes.Collaber?1:""})));const n=(a=e.auditors)==null?void 0:a.map((e=>({ID:e.id,TYPE:"U",NAME:e.name,IMAGE:e.image,IS_COLLABER:e.type===t.UserTypes.Collaber?1:""})));const r=Object.fromEntries((i=e.attachments)==null?void 0:i.map((e=>[e,e])));const p=[...d,...n].reduce(((e,t)=>{e[t.ID]=t;return e}),{});const h=c(e);const m=Object.fromEntries(Object.entries({NODE_ID:e.nodeId,TITLE:h,CREATED_BY:(o=e.creator)==null?void 0:o.id,TOGGLED_BY:(l=e.toggledBy)==null?void 0:l.id,TOGGLED_DATE:e.toggledDate,MEMBERS:p,NEW_FILE_IDS:r,ATTACHMENTS:r,IS_COMPLETE:e.isComplete,IS_IMPORTANT:e.isImportant,PARENT_ID:e.parentId,SORT_INDEX:e.sortIndex,ACTIONS:{MODIFY:e.actions.modify,REMOVE:e.actions.remove,TOGGLE:e.actions.toggle}}).filter((([,e])=>e!==null&&e!==undefined)));return[e.nodeId,m]})))}function c(e){var t,s;const a=[...((t=e.accomplices)!=null?t:[]).map((e=>e.name)),...((s=e.auditors)!=null?s:[]).map((e=>e.name))].join(" ");if(a){return`${e.title} ${a}`}return e.title}var p=babelHelpers.classPrivateFieldLooseKey("getPromises");class h{constructor(){Object.defineProperty(this,p,{writable:true,value:{}})}async load(e){var t,s;(s=(t=babelHelpers.classPrivateFieldLooseBase(this,p)[p])[e])!=null?s:t[e]=new Promise((async(t,s)=>{try{const s=await(new l.ApiClient).post("CheckList.get",{task:{id:e}});const a=s.map((e=>n(e)));await Promise.all([this.$store.dispatch(`${i.Model.CheckList}/upsertMany`,a),this.$store.dispatch(`${i.Model.Tasks}/update`,{id:e,fields:{containsChecklist:a.length>0,checklist:a.map((({id:e})=>e))}})]);t()}catch(e){s(e)}}));return babelHelpers.classPrivateFieldLooseBase(this,p)[p][e]}async save(e,t){return new Promise((async(s,a)=>{try{const a=await(new l.ApiClient).post("CheckList.save",{task:{id:e,checklist:d(t)}});await Promise.all([this.$store.dispatch(`${i.Model.Interface}/setDisableCheckListAnimations`,true),this.$store.dispatch(`${i.Model.CheckList}/upsertMany`,a),this.$store.dispatch(`${i.Model.Tasks}/update`,{id:e,fields:{containsChecklist:a.length>0,checklist:a.map((e=>e.id))}})]);void this.$store.dispatch(`${i.Model.Interface}/setDisableCheckListAnimations`,false);s()}catch(e){a(e)}}))}async collapse(e,t){await(new l.ApiClient).post("CheckList.collapse",{taskId:e,checkListId:t});void this.$store.dispatch(`${i.Model.CheckList}/update`,{id:t,fields:{collapsed:true,expanded:false}})}async expand(e,t){await(new l.ApiClient).post("CheckList.expand",{taskId:e,checkListId:t});void this.$store.dispatch(`${i.Model.CheckList}/update`,{id:t,fields:{collapsed:false,expanded:true}})}async complete(e,t){await new l.ApiClient("tasks.task.","data").post("checklist.complete",{taskId:e,checkListItemId:t})}async renew(e,t){await new l.ApiClient("tasks.task.","data").post("checklist.renew",{taskId:e,checkListItemId:t})}async delete(e,t){await new l.ApiClient("tasks.task.","data").post("checklist.delete",{taskId:e,checkListItemId:t})}get $store(){return o.Core.getStore()}}const m=new h;const I={mapModelToSliderData:r};e.CheckListMappers=I;e.checkListService=m})(this.BX.Tasks.V2.Provider.Service=this.BX.Tasks.V2.Provider.Service||{},BX.Tasks.V2.Model,BX.Tasks.V2.Provider.Service,BX.Vue3.Vuex,BX.Tasks.V2.Const,BX.Tasks.V2,BX.Tasks.V2.Lib);
//# sourceMappingURL=check-list-service.bundle.map.js