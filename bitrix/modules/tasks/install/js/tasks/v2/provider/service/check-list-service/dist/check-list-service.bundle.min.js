this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};this.BX.Tasks.V2=this.BX.Tasks.V2||{};this.BX.Tasks.V2.Provider=this.BX.Tasks.V2.Provider||{};(function(e,s,t,a,i,l,o,r){"use strict";function d(e){const s=new Map;e.forEach((e=>{s.set(e.id,e.nodeId)}));return e.map((e=>{const t=h(e);const a=e.parentId?s.get(e.parentId):0;return{...e,title:t,parentNodeId:a}}))}function c(e){var s,a;return{id:e.id,nodeId:e.nodeId,title:e.title,creator:e.creator?t.UserMappers.mapDtoToModel(e.creator):null,toggledBy:e.toggledBy?t.UserMappers.mapDtoToModel(e.toggledBy):null,toggledDate:e.toggledDate,accomplices:(s=e.accomplices)==null?void 0:s.map((e=>t.UserMappers.mapDtoToModel(e))),auditors:(a=e.auditors)==null?void 0:a.map((e=>t.UserMappers.mapDtoToModel(e))),attachments:e.attachments,isComplete:e.isComplete,isImportant:e.isImportant,parentId:e.parentId,parentNodeId:e.parentNodeId,sortIndex:e.sortIndex,actions:e.actions,panelIsShown:e.panelIsShown,myFilterActive:e.myFilterActive,collapsed:e.collapsed,expanded:e.expanded,localCompleteState:e.localCompleteState,localCollapsedState:e.localCollapsedState,areCompletedCollapsed:e.areCompletedCollapsed,hidden:e.hidden,groupMode:e.groupMode}}function n(e){return Object.fromEntries(e.map((e=>{var t,a,i,l,o;const r=(t=e.accomplices)==null?void 0:t.map((e=>({ID:e.id,TYPE:"A",NAME:e.name,IMAGE:e.image,IS_COLLABER:e.type===s.UserTypes.Collaber?1:""})));const d=(a=e.auditors)==null?void 0:a.map((e=>({ID:e.id,TYPE:"U",NAME:e.name,IMAGE:e.image,IS_COLLABER:e.type===s.UserTypes.Collaber?1:""})));const c=Object.fromEntries((i=e.attachments)==null?void 0:i.map((e=>[e,e])));const n=[...r,...d].reduce(((e,s)=>{e[s.ID]=s;return e}),{});const p=h(e);const u=Object.fromEntries(Object.entries({NODE_ID:e.nodeId,TITLE:p,CREATED_BY:(l=e.creator)==null?void 0:l.id,TOGGLED_BY:(o=e.toggledBy)==null?void 0:o.id,TOGGLED_DATE:e.toggledDate,MEMBERS:n,NEW_FILE_IDS:c,ATTACHMENTS:c,IS_COMPLETE:e.isComplete,IS_IMPORTANT:e.isImportant,PARENT_ID:e.parentId,SORT_INDEX:e.sortIndex,ACTIONS:{MODIFY:e.actions.modify,REMOVE:e.actions.remove,TOGGLE:e.actions.toggle}}).filter((([,e])=>e!==null&&e!==undefined)));return[e.nodeId,u]})))}function p(e,s){return e.flatMap((e=>(e[s]||[]).map((e=>e.id)))).filter(((e,s,t)=>t.indexOf(e)===s))}function h(e){var s,t;const a=[...((s=e.accomplices)!=null?s:[]).map((e=>e.name)),...((t=e.auditors)!=null?t:[]).map((e=>e.name))].join(" ");if(a){return`${e.title} ${a}`}return e.title}var u=babelHelpers.classPrivateFieldLooseKey("getPromises");var v=babelHelpers.classPrivateFieldLooseKey("updateFields");var b=babelHelpers.classPrivateFieldLooseKey("updatePromises");var m=babelHelpers.classPrivateFieldLooseKey("updateServerCheckListDebounced");var L=babelHelpers.classPrivateFieldLooseKey("updateCheckListDebounced");var k=babelHelpers.classPrivateFieldLooseKey("updateCheckList");class C{constructor(){Object.defineProperty(this,k,{value:B});Object.defineProperty(this,L,{value:I});Object.defineProperty(this,u,{writable:true,value:{}});Object.defineProperty(this,v,{writable:true,value:{}});Object.defineProperty(this,b,{writable:true,value:{}});Object.defineProperty(this,m,{writable:true,value:{}})}async load(e){var s,t;(t=(s=babelHelpers.classPrivateFieldLooseBase(this,u)[u])[e])!=null?t:s[e]=new Promise((async(s,t)=>{try{const t=await(new r.ApiClient).post("CheckList.get",{task:{id:e}});const a=t.map((e=>c(e)));await Promise.all([this.$store.dispatch(`${l.Model.CheckList}/upsertMany`,a),this.$store.dispatch(`${l.Model.Tasks}/update`,{id:e,fields:{containsChecklist:a.length>0,checklist:a.map((({id:e})=>e))}})]);s()}catch(e){t(e)}}));return babelHelpers.classPrivateFieldLooseBase(this,u)[u][e]}async save(e,s){return new Promise((async(t,a)=>{try{const a=await(new r.ApiClient).post("CheckList.save",{task:{id:e,checklist:d(s)}});const i=a.map((e=>c(e)));await Promise.all([this.$store.dispatch(`${l.Model.Interface}/setDisableCheckListAnimations`,true),this.$store.dispatch(`${l.Model.CheckList}/upsertMany`,i),this.$store.dispatch(`${l.Model.Tasks}/update`,{id:e,fields:{containsChecklist:i.length>0,checklist:i.map((e=>e.id))}})]);void this.$store.dispatch(`${l.Model.Interface}/setDisableCheckListAnimations`,false);t()}catch(e){a(e)}}))}async collapse(e,s){await(new r.ApiClient).post("CheckList.collapse",{taskId:e,checkListId:s});void this.$store.dispatch(`${l.Model.CheckList}/update`,{id:s,fields:{collapsed:true,expanded:false}})}async expand(e,s){await(new r.ApiClient).post("CheckList.expand",{taskId:e,checkListId:s});void this.$store.dispatch(`${l.Model.CheckList}/update`,{id:s,fields:{collapsed:false,expanded:true}})}async complete(e,s){await babelHelpers.classPrivateFieldLooseBase(this,L)[L](e,s,{isComplete:true})}async renew(e,s){await babelHelpers.classPrivateFieldLooseBase(this,L)[L](e,s,{isComplete:false})}async delete(e,s){const t=await this.$store.getters[`${l.Model.Tasks}/getById`](e);const a=await(t==null?void 0:t.checklist)?this.$store.getters[`${l.Model.CheckList}/getByIds`](t.checklist):[];await this.save(e,a)}get $store(){return o.Core.getStore()}}async function I(e,s,t){var i,l,o,r,d,c,n,p,h,u;(l=(i=babelHelpers.classPrivateFieldLooseBase(this,v)[v])[e])!=null?l:i[e]={};babelHelpers.classPrivateFieldLooseBase(this,v)[v][e][s]={...babelHelpers.classPrivateFieldLooseBase(this,v)[v][e][s],...t};(r=(o=babelHelpers.classPrivateFieldLooseBase(this,b)[b])[e])!=null?r:o[e]={};(c=(d=babelHelpers.classPrivateFieldLooseBase(this,b)[b][e])[s])!=null?c:d[s]=new y;(p=(n=babelHelpers.classPrivateFieldLooseBase(this,m)[m])[e])!=null?p:n[e]={};(u=(h=babelHelpers.classPrivateFieldLooseBase(this,m)[m][e])[s])!=null?u:h[s]=a.Runtime.debounce(babelHelpers.classPrivateFieldLooseBase(this,k)[k],300,this);babelHelpers.classPrivateFieldLooseBase(this,m)[m][e][s](e,s);await babelHelpers.classPrivateFieldLooseBase(this,b)[b][e][s]}async function B(e,s){const t=babelHelpers.classPrivateFieldLooseBase(this,v)[v][e][s];delete babelHelpers.classPrivateFieldLooseBase(this,v)[v][e][s];const a=babelHelpers.classPrivateFieldLooseBase(this,b)[b][e][s];delete babelHelpers.classPrivateFieldLooseBase(this,b)[b][e][s];try{await this.$store.dispatch(`${l.Model.CheckList}/update`,{id:s,fields:t});const i=await this.$store.getters[`${l.Model.Tasks}/getById`](e);const o=await(i==null?void 0:i.checklist)?this.$store.getters[`${l.Model.CheckList}/getByIds`](i.checklist):[];await(new r.ApiClient).post("CheckList.save",{task:{id:e,checklist:d(o)}});a.resolve()}catch(e){console.error("CheckListService: update error",e);a.resolve()}}const P=new C;function y(){let e;const s=new Promise((s=>{e=s}));s.resolve=e;return s}const T={mapModelToSliderData:n,getUserIdsFromChecklists:p};e.CheckListMappers=T;e.checkListService=P})(this.BX.Tasks.V2.Provider.Service=this.BX.Tasks.V2.Provider.Service||{},BX.Tasks.V2.Model,BX.Tasks.V2.Provider.Service,BX,BX.Vue3.Vuex,BX.Tasks.V2.Const,BX.Tasks.V2,BX.Tasks.V2.Lib);
//# sourceMappingURL=check-list-service.bundle.map.js