{"version":3,"file":"check-list-service.bundle.js","sources":["../src/mappers.js","../src/check-list-service.js","../src/index.js"],"sourcesContent":["import { UserTypes } from 'tasks.v2.model.users';\nimport { UserMappers } from 'tasks.v2.provider.service.user-service';\nimport type { CheckListModel } from 'tasks.v2.model.check-list';\n\nimport type { CheckListSliderData, CheckListDto } from './types';\n\nexport function prepareCheckLists(checklist: CheckListModel[]): CheckListModel[]\n{\n\tconst parentNodeIdMap = new Map();\n\tchecklist.forEach((item: CheckListModel) => {\n\t\tparentNodeIdMap.set(item.id, item.nodeId);\n\t});\n\n\treturn checklist.map((item: CheckListModel) => {\n\t\tconst title = prepareTitle(item);\n\t\tconst parentNodeId = item.parentId ? parentNodeIdMap.get(item.parentId) : 0;\n\n\t\treturn { ...item, title, parentNodeId };\n\t});\n}\n\nexport function mapDtoToModel(checkList: CheckListModel): CheckListDto\n{\n\treturn {\n\t\tid: checkList.id,\n\t\tnodeId: checkList.nodeId,\n\t\ttitle: checkList.title,\n\t\tcreator: checkList.creator ? UserMappers.mapDtoToModel(checkList.creator) : null,\n\t\ttoggledBy: checkList.toggledBy ? UserMappers.mapDtoToModel(checkList.toggledBy) : null,\n\t\ttoggledDate: checkList.toggledDate,\n\t\taccomplices: checkList.accomplices?.map((it) => UserMappers.mapDtoToModel(it)),\n\t\tauditors: checkList.auditors?.map((it) => UserMappers.mapDtoToModel(it)),\n\t\tattachments: checkList.attachments,\n\t\tisComplete: checkList.isComplete,\n\t\tisImportant: checkList.isImportant,\n\t\tparentId: checkList.parentId,\n\t\tparentNodeId: checkList.parentNodeId,\n\t\tsortIndex: checkList.sortIndex,\n\t\tactions: checkList.actions,\n\t\tpanelIsShown: checkList.panelIsShown,\n\t\tmyFilterActive: checkList.myFilterActive,\n\t\tcollapsed: checkList.collapsed,\n\t\texpanded: checkList.expanded,\n\t\tlocalCompleteState: checkList.localCompleteState,\n\t\tlocalCollapsedState: checkList.localCollapsedState,\n\t\tareCompletedCollapsed: checkList.areCompletedCollapsed,\n\t\thidden: checkList.hidden,\n\t\tgroupMode: checkList.groupMode,\n\t};\n}\n\nexport function mapModelToSliderData(checkLists: CheckListModel[]): CheckListSliderData[]\n{\n\treturn Object.fromEntries(\n\t\tcheckLists.map((item) => {\n\t\t\tconst accomplices = item.accomplices?.map((accomplice) => ({\n\t\t\t\tID: accomplice.id,\n\t\t\t\tTYPE: 'A',\n\t\t\t\tNAME: accomplice.name,\n\t\t\t\tIMAGE: accomplice.image,\n\t\t\t\tIS_COLLABER: accomplice.type === UserTypes.Collaber ? 1 : '',\n\t\t\t}));\n\n\t\t\tconst auditors = item.auditors?.map((auditor) => ({\n\t\t\t\tID: auditor.id,\n\t\t\t\tTYPE: 'U',\n\t\t\t\tNAME: auditor.name,\n\t\t\t\tIMAGE: auditor.image,\n\t\t\t\tIS_COLLABER: auditor.type === UserTypes.Collaber ? 1 : '',\n\t\t\t}));\n\n\t\t\tconst attachments = Object.fromEntries(item.attachments?.map((key) => [key, key]));\n\t\t\tconst members = [...accomplices, ...auditors].reduce((acc, curr) => {\n\t\t\t\tacc[curr.ID] = curr;\n\n\t\t\t\treturn acc;\n\t\t\t}, {});\n\n\t\t\tconst title = prepareTitle(item);\n\n\t\t\tconst node = Object.fromEntries(\n\t\t\t\tObject.entries({\n\t\t\t\t\tNODE_ID: item.nodeId,\n\t\t\t\t\tTITLE: title,\n\t\t\t\t\tCREATED_BY: item.creator?.id,\n\t\t\t\t\tTOGGLED_BY: item.toggledBy?.id,\n\t\t\t\t\tTOGGLED_DATE: item.toggledDate,\n\t\t\t\t\tMEMBERS: members,\n\t\t\t\t\tNEW_FILE_IDS: attachments,\n\t\t\t\t\tATTACHMENTS: attachments,\n\t\t\t\t\tIS_COMPLETE: item.isComplete,\n\t\t\t\t\tIS_IMPORTANT: item.isImportant,\n\t\t\t\t\tPARENT_ID: item.parentId,\n\t\t\t\t\tSORT_INDEX: item.sortIndex,\n\t\t\t\t\tACTIONS: {\n\t\t\t\t\t\tMODIFY: item.actions.modify,\n\t\t\t\t\t\tREMOVE: item.actions.remove,\n\t\t\t\t\t\tTOGGLE: item.actions.toggle,\n\t\t\t\t\t},\n\t\t\t\t}).filter(([, value]) => value !== null && value !== undefined),\n\t\t\t);\n\n\t\t\treturn [item.nodeId, node];\n\t\t}),\n\t);\n}\n\nexport function getUserIdsFromChecklists(\n\tcheckLists: CheckListModel[],\n\tuserType: 'accomplices' | 'auditors',\n): number[]\n{\n\treturn checkLists\n\t\t.flatMap((item: CheckListModel) => (item[userType] || []).map((user: User) => user.id))\n\t\t.filter((id, idx, arr) => arr.indexOf(id) === idx);\n}\n\nexport function prepareTitle(item: CheckListModel): string\n{\n\tconst names = [\n\t\t...(item.accomplices ?? []).map((member) => member.name),\n\t\t...(item.auditors ?? []).map((member) => member.name),\n\t].join(' ');\n\n\tif (names)\n\t{\n\t\treturn `${item.title} ${names}`;\n\t}\n\n\treturn item.title;\n}\n","import { Runtime } from 'main.core';\nimport { Store } from 'ui.vue3.vuex';\nimport { Model } from 'tasks.v2.const';\nimport { Core } from 'tasks.v2.core';\nimport { ApiClient } from 'tasks.v2.lib.api-client';\nimport type { CheckListModel } from 'tasks.v2.model.check-list';\n\nimport { mapDtoToModel, prepareCheckLists } from './mappers';\n\nclass CheckListService\n{\n\t#getPromises = {};\n\t#updateFields: { [taskId: number]: { [checkListId: number]: Partial<CheckListModel> } } = {};\n\t#updatePromises: { [taskId: number]: { [checkListId: number]: Resolvable } } = {};\n\t#updateServerCheckListDebounced: { [taskId: number]: { [checkListId: number]: Function } } = {};\n\n\tasync load(taskId: number): Promise<void>\n\t{\n\t\t// eslint-disable-next-line no-async-promise-executor\n\t\tthis.#getPromises[taskId] ??= new Promise(async (resolve, reject) => {\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst data = await (new ApiClient()).post('CheckList.get', {\n\t\t\t\t\ttask: { id: taskId },\n\t\t\t\t});\n\n\t\t\t\tconst checkLists = data.map((it) => mapDtoToModel(it));\n\n\t\t\t\tawait Promise.all([\n\t\t\t\t\tthis.$store.dispatch(`${Model.CheckList}/upsertMany`, checkLists),\n\t\t\t\t\tthis.$store.dispatch(`${Model.Tasks}/update`, {\n\t\t\t\t\t\tid: taskId,\n\t\t\t\t\t\tfields: {\n\t\t\t\t\t\t\tcontainsChecklist: checkLists.length > 0,\n\t\t\t\t\t\t\tchecklist: checkLists.map(({ id }) => id),\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t]);\n\n\t\t\t\tresolve();\n\t\t\t}\n\t\t\tcatch (error)\n\t\t\t{\n\t\t\t\treject(error);\n\t\t\t}\n\t\t});\n\n\t\treturn this.#getPromises[taskId];\n\t}\n\n\tasync save(taskId: number, checklists: CheckListModel[]): Promise<void>\n\t{\n\t\t// eslint-disable-next-line no-async-promise-executor\n\t\treturn new Promise(async (resolve, reject) => {\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst savedList = await (new ApiClient()).post('CheckList.save', {\n\t\t\t\t\ttask: {\n\t\t\t\t\t\tid: taskId,\n\t\t\t\t\t\tchecklist: prepareCheckLists(checklists),\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tconst checkLists = savedList.map((it) => mapDtoToModel(it));\n\n\t\t\t\tawait Promise.all([\n\t\t\t\t\tthis.$store.dispatch(`${Model.Interface}/setDisableCheckListAnimations`, true),\n\t\t\t\t\tthis.$store.dispatch(`${Model.CheckList}/upsertMany`, checkLists),\n\t\t\t\t\tthis.$store.dispatch(`${Model.Tasks}/update`, {\n\t\t\t\t\t\tid: taskId,\n\t\t\t\t\t\tfields: {\n\t\t\t\t\t\t\tcontainsChecklist: checkLists.length > 0,\n\t\t\t\t\t\t\tchecklist: checkLists.map((item) => item.id),\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t]);\n\n\t\t\t\tvoid this.$store.dispatch(`${Model.Interface}/setDisableCheckListAnimations`, false);\n\n\t\t\t\tresolve();\n\t\t\t}\n\t\t\tcatch (error)\n\t\t\t{\n\t\t\t\treject(error);\n\t\t\t}\n\t\t});\n\t}\n\n\tasync collapse(taskId: number, checkListId: number): Promise<void>\n\t{\n\t\tawait (new ApiClient()).post('CheckList.collapse', {\n\t\t\ttaskId,\n\t\t\tcheckListId,\n\t\t});\n\n\t\tvoid this.$store.dispatch(`${Model.CheckList}/update`, {\n\t\t\tid: checkListId,\n\t\t\tfields: {\n\t\t\t\tcollapsed: true,\n\t\t\t\texpanded: false,\n\t\t\t},\n\t\t});\n\t}\n\n\tasync expand(taskId: number, checkListId: number): Promise<void>\n\t{\n\t\tawait (new ApiClient()).post('CheckList.expand', {\n\t\t\ttaskId,\n\t\t\tcheckListId,\n\t\t});\n\n\t\tvoid this.$store.dispatch(`${Model.CheckList}/update`, {\n\t\t\tid: checkListId,\n\t\t\tfields: {\n\t\t\t\tcollapsed: false,\n\t\t\t\texpanded: true,\n\t\t\t},\n\t\t});\n\t}\n\n\tasync complete(taskId: number, checkListId: number): Promise<void>\n\t{\n\t\tawait this.#updateCheckListDebounced(taskId, checkListId, { isComplete: true });\n\t}\n\n\tasync renew(taskId: number, checkListId: number): Promise<void>\n\t{\n\t\tawait this.#updateCheckListDebounced(taskId, checkListId, { isComplete: false });\n\t}\n\n\tasync #updateCheckListDebounced(taskId: number, checkListId: number, fields: Partial<CheckListModel>): Promise<void>\n\t{\n\t\tthis.#updateFields[taskId] ??= {};\n\t\tthis.#updateFields[taskId][checkListId] = { ...this.#updateFields[taskId][checkListId], ...fields };\n\n\t\tthis.#updatePromises[taskId] ??= {};\n\t\tthis.#updatePromises[taskId][checkListId] ??= new Resolvable();\n\n\t\tthis.#updateServerCheckListDebounced[taskId] ??= {};\n\t\tthis.#updateServerCheckListDebounced[taskId][checkListId] ??= Runtime.debounce(this.#updateCheckList, 300, this);\n\n\t\tthis.#updateServerCheckListDebounced[taskId][checkListId](taskId, checkListId);\n\t\tawait this.#updatePromises[taskId][checkListId];\n\t}\n\n\tasync #updateCheckList(taskId: number, checkListId: number): Promise<void>\n\t{\n\t\tconst fields = this.#updateFields[taskId][checkListId];\n\t\tdelete this.#updateFields[taskId][checkListId];\n\n\t\tconst promise = this.#updatePromises[taskId][checkListId];\n\t\tdelete this.#updatePromises[taskId][checkListId];\n\n\t\ttry\n\t\t{\n\t\t\t// Update store immediately for optimistic UI\n\t\t\tawait this.$store.dispatch(`${Model.CheckList}/update`, {\n\t\t\t\tid: checkListId,\n\t\t\t\tfields,\n\t\t\t});\n\n\t\t\t// Get updated checklists and save to server\n\t\t\tconst task = await this.$store.getters[`${Model.Tasks}/getById`](taskId);\n\t\t\tconst checklists = (await task?.checklist)\n\t\t\t\t? this.$store.getters[`${Model.CheckList}/getByIds`](task.checklist)\n\t\t\t\t: [];\n\n\t\t\tawait new ApiClient().post('CheckList.save', {\n\t\t\t\ttask: {\n\t\t\t\t\tid: taskId,\n\t\t\t\t\tchecklist: prepareCheckLists(checklists),\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tpromise.resolve();\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error('CheckListService: update error', error);\n\t\t\tpromise.resolve();\n\t\t}\n\t}\n\n\tasync delete(taskId: number, checkListId: number): Promise<void>\n\t{\n\t\tconst task = await this.$store.getters[`${Model.Tasks}/getById`](taskId);\n\t\tconst checklists = (await task?.checklist)\n\t\t\t? this.$store.getters[`${Model.CheckList}/getByIds`](task.checklist)\n\t\t\t: [];\n\t\tawait this.save(taskId, checklists);\n\t}\n\n\tget $store(): Store\n\t{\n\t\treturn Core.getStore();\n\t}\n}\n\nexport const checkListService = new CheckListService();\n\nfunction Resolvable(): Promise\n{\n\tlet resolve;\n\tconst promise = new Promise((res) => {\n\t\tresolve = res;\n\t});\n\n\tpromise.resolve = resolve;\n\n\treturn promise;\n}\n","import { getUserIdsFromChecklists, mapModelToSliderData } from './mappers';\n\nexport { checkListService } from './check-list-service';\n\nexport const CheckListMappers = { mapModelToSliderData, getUserIdsFromChecklists };\n"],"names":["prepareCheckLists","checklist","parentNodeIdMap","Map","forEach","item","set","id","nodeId","map","title","prepareTitle","parentNodeId","parentId","get","mapDtoToModel","checkList","creator","UserMappers","toggledBy","toggledDate","accomplices","it","auditors","attachments","isComplete","isImportant","sortIndex","actions","panelIsShown","myFilterActive","collapsed","expanded","localCompleteState","localCollapsedState","areCompletedCollapsed","hidden","groupMode","mapModelToSliderData","checkLists","Object","fromEntries","accomplice","ID","TYPE","NAME","name","IMAGE","image","IS_COLLABER","type","UserTypes","Collaber","auditor","key","members","reduce","acc","curr","node","entries","NODE_ID","TITLE","CREATED_BY","TOGGLED_BY","TOGGLED_DATE","MEMBERS","NEW_FILE_IDS","ATTACHMENTS","IS_COMPLETE","IS_IMPORTANT","PARENT_ID","SORT_INDEX","ACTIONS","MODIFY","modify","REMOVE","remove","TOGGLE","toggle","filter","value","undefined","getUserIdsFromChecklists","userType","flatMap","user","idx","arr","indexOf","names","member","join","CheckListService","load","taskId","Promise","resolve","reject","data","ApiClient","post","task","all","$store","dispatch","Model","CheckList","Tasks","fields","containsChecklist","length","error","save","checklists","savedList","Interface","collapse","checkListId","expand","complete","renew","delete","getters","Core","getStore","Resolvable","Runtime","debounce","promise","console","checkListService","res","CheckListMappers"],"mappings":"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"}