{"version":3,"file":"status-service.bundle.js","sources":["../src/status-service.js"],"sourcesContent":["import type { Store } from 'ui.vue3.vuex';\n\nimport { Core } from 'tasks.v2.core';\nimport { Model, TaskStatus } from 'tasks.v2.const';\nimport { apiClient } from 'tasks.v2.lib.api-client';\nimport { taskService } from 'tasks.v2.provider.service.task-service';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nexport const statusService = new class\n{\n\tasync start(id: number): Promise<void>\n\t{\n\t\tawait this.#updateStatus(id, 'Task.Status.start', TaskStatus.InProgress);\n\t}\n\n\tasync disapprove(id: number): Promise<void>\n\t{\n\t\tawait this.#updateStatus(id, 'Task.Status.disapprove', TaskStatus.Pending);\n\t}\n\n\tasync defer(id: number): Promise<void>\n\t{\n\t\tawait this.#updateStatus(id, 'Task.Status.defer', TaskStatus.Deferred);\n\t}\n\n\tasync approve(id: number): Promise<void>\n\t{\n\t\tawait this.#updateStatus(id, 'Task.Status.approve', TaskStatus.Completed);\n\t}\n\n\tasync pause(id: number): Promise<void>\n\t{\n\t\tawait this.#updateStatus(id, 'Task.Status.pause', TaskStatus.Pending);\n\t}\n\n\tasync complete(id: number): Promise<void>\n\t{\n\t\tconst status = this.#getStoreTask(id).needsControl ? TaskStatus.SupposedlyCompleted : TaskStatus.Completed;\n\n\t\tawait this.#updateStatus(id, 'Task.Status.complete', status);\n\t}\n\n\tasync renew(id: number): Promise<void>\n\t{\n\t\tawait this.#updateStatus(id, 'Task.Status.renew', TaskStatus.Pending);\n\t}\n\n\tasync #updateStatus(id: number, action: string, status: string): Promise<void>\n\t{\n\t\tconst taskBeforeUpdate = this.#getStoreTask(id);\n\n\t\tawait this.#updateStoreTask(id, { status });\n\n\t\tif (!taskService.isRealId(id))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tconst data = await apiClient.post(action, { task: { id } });\n\n\t\t\tawait taskService.extractTask(data);\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tawait this.#updateStoreTask(id, taskBeforeUpdate);\n\n\t\t\tconsole.error(`StatusService: ${action} error`, error);\n\t\t}\n\t}\n\n\tasync #updateStoreTask(id: number, fields: TaskModel): Promise<void>\n\t{\n\t\tawait this.$store.dispatch(`${Model.Tasks}/update`, { id, fields });\n\t}\n\n\t#getStoreTask(id: number): TaskModel\n\t{\n\t\treturn { ...this.$store.getters[`${Model.Tasks}/getById`](id) };\n\t}\n\n\tget $store(): Store\n\t{\n\t\treturn Core.getStore();\n\t}\n}();\n"],"names":["statusService","start","id","TaskStatus","InProgress","disapprove","Pending","defer","Deferred","approve","Completed","pause","complete","status","needsControl","SupposedlyCompleted","renew","$store","Core","getStore","action","taskBeforeUpdate","taskService","isRealId","data","apiClient","post","task","extractTask","error","console","fields","dispatch","Model","Tasks","getters"],"mappings":";;;;;;;;;AAEA,OAMaA,aAAa,GAAG,0QAAI,MACjC;GAAA;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;;GACC,MAAMC,KAAK,CAACC,EAAU,EACtB;KACC,8CAAM,IAAI,gCAAeA,EAAE,EAAE,mBAAmB,EAAEC,yBAAU,CAACC,UAAU,CAAC;;GAGzE,MAAMC,UAAU,CAACH,EAAU,EAC3B;KACC,8CAAM,IAAI,gCAAeA,EAAE,EAAE,wBAAwB,EAAEC,yBAAU,CAACG,OAAO,CAAC;;GAG3E,MAAMC,KAAK,CAACL,EAAU,EACtB;KACC,8CAAM,IAAI,gCAAeA,EAAE,EAAE,mBAAmB,EAAEC,yBAAU,CAACK,QAAQ,CAAC;;GAGvE,MAAMC,OAAO,CAACP,EAAU,EACxB;KACC,8CAAM,IAAI,gCAAeA,EAAE,EAAE,qBAAqB,EAAEC,yBAAU,CAACO,SAAS,CAAC;;GAG1E,MAAMC,KAAK,CAACT,EAAU,EACtB;KACC,8CAAM,IAAI,gCAAeA,EAAE,EAAE,mBAAmB,EAAEC,yBAAU,CAACG,OAAO,CAAC;;GAGtE,MAAMM,QAAQ,CAACV,EAAU,EACzB;KACC,MAAMW,MAAM,GAAG,4CAAI,gCAAeX,EAAE,EAAEY,YAAY,GAAGX,yBAAU,CAACY,mBAAmB,GAAGZ,yBAAU,CAACO,SAAS;KAE1G,8CAAM,IAAI,gCAAeR,EAAE,EAAE,sBAAsB,EAAEW,MAAM,CAAC;;GAG7D,MAAMG,KAAK,CAACd,EAAU,EACtB;KACC,8CAAM,IAAI,gCAAeA,EAAE,EAAE,mBAAmB,EAAEC,yBAAU,CAACG,OAAO,CAAC;;GAsCtE,IAAIW,MAAM,GACV;KACC,OAAOC,kBAAI,CAACC,QAAQ,EAAE;;CAExB,CAAC,GAAE;CAAC,8BAvCiBjB,EAAU,EAAEkB,MAAc,EAAEP,MAAc,EAC9D;GACC,MAAMQ,gBAAgB,2CAAG,IAAI,gCAAenB,EAAE,CAAC;GAE/C,8CAAM,IAAI,sCAAkBA,EAAE,EAAE;KAAEW;IAAQ,CAAC;GAE3C,IAAI,CAACS,iDAAW,CAACC,QAAQ,CAACrB,EAAE,CAAC,EAC7B;KACC;;GAGD,IACA;KACC,MAAMsB,IAAI,GAAG,MAAMC,gCAAS,CAACC,IAAI,CAACN,MAAM,EAAE;OAAEO,IAAI,EAAE;SAAEzB;;MAAM,CAAC;KAE3D,MAAMoB,iDAAW,CAACM,WAAW,CAACJ,IAAI,CAAC;IACnC,CACD,OAAOK,KAAK,EACZ;KACC,8CAAM,IAAI,sCAAkB3B,EAAE,EAAEmB,gBAAgB,CAAC;KAEjDS,OAAO,CAACD,KAAK,CAAE,kBAAiBT,MAAO,QAAO,EAAES,KAAK,CAAC;;CAExD;CAAC,iCAEsB3B,EAAU,EAAE6B,MAAiB,EACpD;GACC,MAAM,IAAI,CAACd,MAAM,CAACe,QAAQ,CAAE,GAAEC,oBAAK,CAACC,KAAM,SAAQ,EAAE;KAAEhC,EAAE;KAAE6B;IAAQ,CAAC;CACpE;CAAC,wBAEa7B,EAAU,EACxB;GACC,OAAO;KAAE,GAAG,IAAI,CAACe,MAAM,CAACkB,OAAO,CAAE,GAAEF,oBAAK,CAACC,KAAM,UAAS,CAAC,CAAChC,EAAE;IAAG;CAChE;;;;;;;;"}