{"version":3,"file":"tasks.bundle.js","sources":["../src/tasks.js"],"sourcesContent":["/* eslint-disable no-param-reassign */\nimport { BuilderEntityModel, Store } from 'ui.vue3.vuex';\nimport type { ActionTree, GetterTree, MutationTree } from 'ui.vue3.vuex';\n\nimport { Model } from 'tasks.v2.const';\n\nimport type { TaskModel, TasksModelState } from './types';\n\nconst aliasFields = {\n\tdatePlan: new Set(['startPlanTs', 'endPlanTs', 'matchesSubTasksTime']),\n};\n\nexport class Tasks extends BuilderEntityModel<TasksModelState, TaskModel>\n{\n\tgetName(): string\n\t{\n\t\treturn Model.Tasks;\n\t}\n\n\tgetElementState(): TaskModel\n\t{\n\t\treturn {\n\t\t\tid: 0,\n\t\t\ttitle: '',\n\t\t\tisImportant: false,\n\t\t\tdescription: '',\n\t\t\tcreatorId: 0,\n\t\t\tcreatedTs: Date.now(),\n\t\t\tresponsibleId: 0,\n\t\t\tdeadlineTs: 0,\n\t\t\tfileIds: [],\n\t\t\tchecklist: [],\n\t\t\tcontainsChecklist: false,\n\t\t\tstoryPoints: '',\n\t\t\tepicId: 0,\n\t\t\taccomplicesIds: [],\n\t\t\tauditorsIds: [],\n\t\t\ttags: [],\n\t\t\tstatus: 'pending',\n\t\t\tstatusChangedTs: Date.now(),\n\t\t\tneedsControl: false,\n\t\t\tfilledFields: {},\n\t\t\trights: {\n\t\t\t\tedit: true,\n\t\t\t\tdeadline: true,\n\t\t\t\tdatePlan: true,\n\t\t\t\tdelegate: true,\n\t\t\t},\n\t\t};\n\t}\n\n\tgetGetters(): GetterTree<TasksModelState>\n\t{\n\t\treturn {\n\t\t\t/** @function tasks/wasFieldFilled */\n\t\t\twasFieldFilled: (state: TasksModelState) => (id: number | string, fieldName: string): boolean => {\n\t\t\t\treturn state.collection[id].filledFields?.[fieldName] ?? false;\n\t\t\t},\n\t\t};\n\t}\n\n\tgetActions(): ActionTree<TasksModelState>\n\t{\n\t\treturn {\n\t\t\t/** @function tasks/setFieldFilled */\n\t\t\tsetFieldFilled: (store: Store, { id, fieldName }: { id: number, fieldName: string }): void => {\n\t\t\t\tstore.commit('setFieldFilled', { id, fieldName });\n\t\t\t},\n\t\t\t/** @function tasks/clearFieldsFilled */\n\t\t\tclearFieldsFilled: (store: Store, id: number | string): void => {\n\t\t\t\tstore.commit('clearFieldsFilled', id);\n\t\t\t},\n\t\t};\n\t}\n\n\tgetMutations(): MutationTree<TasksModelState>\n\t{\n\t\treturn {\n\t\t\tupsert: (state: TasksModelState, task: ?TaskModel): void => {\n\t\t\t\tBuilderEntityModel.defaultModel.getMutations(this).upsert(state, task);\n\n\t\t\t\tthis.#setFieldsFilled(state, task);\n\t\t\t},\n\t\t\tupdate: (state: TasksModelState, { id, fields }: { id: number | string, fields: TaskModel }): void => {\n\t\t\t\tBuilderEntityModel.defaultModel.getMutations(this).update(state, { id, fields });\n\n\t\t\t\tthis.#setFieldsFilled(state, { id, ...fields });\n\t\t\t},\n\t\t\tsetFieldFilled: (state: TasksModelState, { id, fieldName }: { id: number, fieldName: string }): void => {\n\t\t\t\t(state.collection[id].filledFields ??= {})[fieldName] = true;\n\t\t\t},\n\t\t\tclearFieldsFilled: (state: TasksModelState, id: number | string): void => {\n\t\t\t\tif (!state.collection[id])\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tstate.collection[id].filledFields = {};\n\n\t\t\t\tthis.#setFieldsFilled(state, { id, ...state.collection[id] });\n\t\t\t},\n\t\t};\n\t}\n\n\t#setFieldsFilled(state: TasksModelState, fields: TaskModel): void\n\t{\n\t\tconst task = state.collection[fields.id];\n\t\tconst canEdit = task?.rights?.edit;\n\n\t\ttask.filledFields ??= {};\n\t\tObject.entries(fields).forEach(([fieldName: string, value: any]) => {\n\t\t\tconst isFilled = Boolean(value) && (!Array.isArray(value) || value.length > 0);\n\t\t\tif (isFilled)\n\t\t\t{\n\t\t\t\ttask.filledFields[this.#getAliasField(fieldName) ?? fieldName] = true;\n\t\t\t}\n\n\t\t\tif (!isFilled && !canEdit)\n\t\t\t{\n\t\t\t\ttask.filledFields[fieldName] = false;\n\t\t\t}\n\t\t});\n\t}\n\n\t#getAliasField(fieldName: string): string\n\t{\n\t\treturn Object.entries(aliasFields).find(([, alias]) => alias.has(fieldName))?.[0];\n\t}\n}\n"],"names":["aliasFields","datePlan","Set","Tasks","BuilderEntityModel","getName","Model","getElementState","id","title","isImportant","description","creatorId","createdTs","Date","now","responsibleId","deadlineTs","fileIds","checklist","containsChecklist","storyPoints","epicId","accomplicesIds","auditorsIds","tags","status","statusChangedTs","needsControl","filledFields","rights","edit","deadline","delegate","getGetters","wasFieldFilled","state","fieldName","collection","getActions","setFieldFilled","store","commit","clearFieldsFilled","getMutations","upsert","task","defaultModel","update","fields","canEdit","Object","entries","forEach","value","isFilled","Boolean","Array","isArray","length","find","alias","has"],"mappings":";;;;;;;CAAA;AACA,CAOA,MAAMA,WAAW,GAAG;GACnBC,QAAQ,EAAE,IAAIC,GAAG,CAAC,CAAC,aAAa,EAAE,WAAW,EAAE,qBAAqB,CAAC;CACtE,CAAC;CAAC;CAAA;AAEF,CAAO,MAAMC,KAAK,SAASC,+BAAkB,CAC7C;GAAA;KAAA;KAAA;OAAA;;KAAA;OAAA;;;GACCC,OAAO,GACP;KACC,OAAOC,oBAAK,CAACH,KAAK;;GAGnBI,eAAe,GACf;KACC,OAAO;OACNC,EAAE,EAAE,CAAC;OACLC,KAAK,EAAE,EAAE;OACTC,WAAW,EAAE,KAAK;OAClBC,WAAW,EAAE,EAAE;OACfC,SAAS,EAAE,CAAC;OACZC,SAAS,EAAEC,IAAI,CAACC,GAAG,EAAE;OACrBC,aAAa,EAAE,CAAC;OAChBC,UAAU,EAAE,CAAC;OACbC,OAAO,EAAE,EAAE;OACXC,SAAS,EAAE,EAAE;OACbC,iBAAiB,EAAE,KAAK;OACxBC,WAAW,EAAE,EAAE;OACfC,MAAM,EAAE,CAAC;OACTC,cAAc,EAAE,EAAE;OAClBC,WAAW,EAAE,EAAE;OACfC,IAAI,EAAE,EAAE;OACRC,MAAM,EAAE,SAAS;OACjBC,eAAe,EAAEb,IAAI,CAACC,GAAG,EAAE;OAC3Ba,YAAY,EAAE,KAAK;OACnBC,YAAY,EAAE,EAAE;OAChBC,MAAM,EAAE;SACPC,IAAI,EAAE,IAAI;SACVC,QAAQ,EAAE,IAAI;SACd/B,QAAQ,EAAE,IAAI;SACdgC,QAAQ,EAAE;;MAEX;;GAGFC,UAAU,GACV;KACC,OAAO;;OAENC,cAAc,EAAGC,KAAsB,IAAK,CAAC5B,EAAmB,EAAE6B,SAAiB,KAAc;SAAA;SAChG,0DAAOD,KAAK,CAACE,UAAU,CAAC9B,EAAE,CAAC,CAACqB,YAAY,qBAAjC,uBAAoCQ,SAAS,CAAC,oCAAI,KAAK;;MAE/D;;GAGFE,UAAU,GACV;KACC,OAAO;;OAENC,cAAc,EAAE,CAACC,KAAY,EAAE;SAAEjC,EAAE;SAAE6B;QAA8C,KAAW;SAC7FI,KAAK,CAACC,MAAM,CAAC,gBAAgB,EAAE;WAAElC,EAAE;WAAE6B;UAAW,CAAC;QACjD;;OAEDM,iBAAiB,EAAE,CAACF,KAAY,EAAEjC,EAAmB,KAAW;SAC/DiC,KAAK,CAACC,MAAM,CAAC,mBAAmB,EAAElC,EAAE,CAAC;;MAEtC;;GAGFoC,YAAY,GACZ;KACC,OAAO;OACNC,MAAM,EAAE,CAACT,KAAsB,EAAEU,IAAgB,KAAW;SAC3D1C,+BAAkB,CAAC2C,YAAY,CAACH,YAAY,CAAC,IAAI,CAAC,CAACC,MAAM,CAACT,KAAK,EAAEU,IAAI,CAAC;SAEtE,4CAAI,sCAAkBV,KAAK,EAAEU,IAAI;QACjC;OACDE,MAAM,EAAE,CAACZ,KAAsB,EAAE;SAAE5B,EAAE;SAAEyC;QAAoD,KAAW;SACrG7C,+BAAkB,CAAC2C,YAAY,CAACH,YAAY,CAAC,IAAI,CAAC,CAACI,MAAM,CAACZ,KAAK,EAAE;WAAE5B,EAAE;WAAEyC;UAAQ,CAAC;SAEhF,4CAAI,sCAAkBb,KAAK,EAAE;WAAE5B,EAAE;WAAE,GAAGyC;UAAQ;QAC9C;OACDT,cAAc,EAAE,CAACJ,KAAsB,EAAE;SAAE5B,EAAE;SAAE6B;QAA8C,KAAW;SAAA;SACvG,2BAAC,wBAAAD,KAAK,CAACE,UAAU,CAAC9B,EAAE,CAAC,EAACqB,YAAY,qCAAjC,qBAAqBA,YAAY,GAAK,EAAE,EAAEQ,SAAS,CAAC,GAAG,IAAI;QAC5D;OACDM,iBAAiB,EAAE,CAACP,KAAsB,EAAE5B,EAAmB,KAAW;SACzE,IAAI,CAAC4B,KAAK,CAACE,UAAU,CAAC9B,EAAE,CAAC,EACzB;WACC;;SAGD4B,KAAK,CAACE,UAAU,CAAC9B,EAAE,CAAC,CAACqB,YAAY,GAAG,EAAE;SAEtC,4CAAI,sCAAkBO,KAAK,EAAE;WAAE5B,EAAE;WAAE,GAAG4B,KAAK,CAACE,UAAU,CAAC9B,EAAE;UAAG;;MAE7D;;CA2BH;CAAC,2BAxBiB4B,KAAsB,EAAEa,MAAiB,EAC1D;GAAA;GACC,MAAMH,IAAI,GAAGV,KAAK,CAACE,UAAU,CAACW,MAAM,CAACzC,EAAE,CAAC;GACxC,MAAM0C,OAAO,GAAGJ,IAAI,oCAAJA,IAAI,CAAEhB,MAAM,qBAAZ,aAAcC,IAAI;GAElC,sBAAAe,IAAI,CAACjB,YAAY,iCAAjBiB,IAAI,CAACjB,YAAY,GAAK,EAAE;GACxBsB,MAAM,CAACC,OAAO,CAACH,MAAM,CAAC,CAACI,OAAO,CAAC,CAAC,CAAChB,SAAiB,EAAEiB,KAAU,CAAC,KAAK;KACnE,MAAMC,QAAQ,GAAGC,OAAO,CAACF,KAAK,CAAC,KAAK,CAACG,KAAK,CAACC,OAAO,CAACJ,KAAK,CAAC,IAAIA,KAAK,CAACK,MAAM,GAAG,CAAC,CAAC;KAC9E,IAAIJ,QAAQ,EACZ;OAAA;OACCT,IAAI,CAACjB,YAAY,kEAAC,IAAI,kCAAgBQ,SAAS,qCAAKA,SAAS,CAAC,GAAG,IAAI;;KAGtE,IAAI,CAACkB,QAAQ,IAAI,CAACL,OAAO,EACzB;OACCJ,IAAI,CAACjB,YAAY,CAACQ,SAAS,CAAC,GAAG,KAAK;;IAErC,CAAC;CACH;CAAC,yBAEcA,SAAiB,EAChC;GAAA;GACC,+BAAOc,MAAM,CAACC,OAAO,CAACpD,WAAW,CAAC,CAAC4D,IAAI,CAAC,CAAC,GAAGC,KAAK,CAAC,KAAKA,KAAK,CAACC,GAAG,CAACzB,SAAS,CAAC,CAAC,qBAArE,qBAAwE,CAAC,CAAC;CAClF;;;;;;;;"}