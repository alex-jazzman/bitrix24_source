this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};(function(e,s,t,a,i,l){"use strict";let r=e=>e,o;var n=babelHelpers.classPrivateFieldLooseKey("item");var d=babelHelpers.classPrivateFieldLooseKey("hintManager");var c=babelHelpers.classPrivateFieldLooseKey("getHtml");var b=babelHelpers.classPrivateFieldLooseKey("onSubMenuShow");var u=babelHelpers.classPrivateFieldLooseKey("bringHintToFront");class p{constructor(){Object.defineProperty(this,u,{value:h});Object.defineProperty(this,b,{value:v});Object.defineProperty(this,c,{value:_});this.ACCEPTED_ITEM_CLASS="menu-popup-item-accept";this.DISABLED_ITEM_CLASS="menu-popup-item-disabled";Object.defineProperty(this,n,{writable:true,value:void 0});Object.defineProperty(this,d,{writable:true,value:void 0})}getItem(){if(!t.Type.isUndefined(babelHelpers.classPrivateFieldLooseBase(this,n)[n])){return babelHelpers.classPrivateFieldLooseBase(this,n)[n]}if(t.Type.isUndefined(this.MENU_ID)||t.Type.isUndefined(this.HINT_ID)||t.Type.isUndefined(this.TITLE)){return null}babelHelpers.classPrivateFieldLooseBase(this,n)[n]={dataset:{id:this.MENU_ID},id:this.MENU_ID,html:babelHelpers.classPrivateFieldLooseBase(this,c)[c](),className:`menu-popup-item-none menu-popup-${this.TITLE}-deadline`,events:{onSubMenuShow:babelHelpers.classPrivateFieldLooseBase(this,b)[b].bind(this)},items:this.getSubItems()};return babelHelpers.classPrivateFieldLooseBase(this,n)[n]}onPromiseError(e){const a=e.errors;if(t.Type.isUndefined(a)){console.error(e);return}s.MessageBox.alert(t.Loc.getMessage("TASKS_DEADLINE_MENU_ERROR_DESCRIPTION"),t.Loc.getMessage("TASKS_DEADLINE_MENU_ERROR_TITLE"))}getSubItems(){return[]}refreshIcons(e,s){}}function _(){const e=t.Tag.render(o||(o=r`
			<div class="tasks-deadline-menu_${0}-deadline-item__text">
				${0}
			</div>
		`),this.TITLE,t.Loc.getMessage(`TASKS_DEADLINE_MENU_${this.TITLE.toUpperCase()}_ITEM_TITLE`));babelHelpers.classPrivateFieldLooseBase(this,d)[d]=BX.UI.Hint.createInstance({id:this.HINT_ID});const s=babelHelpers.classPrivateFieldLooseBase(this,d)[d].createNode(t.Loc.getMessage(`TASKS_DEADLINE_MENU_${this.TITLE.toUpperCase()}_ITEM_HINT`));t.Dom.append(s,e);return e}function v(e){const s=e.getTarget();const t=s.getSubMenu();const a=t.getMenuItems();this.refreshIcons(a,t);babelHelpers.classPrivateFieldLooseBase(this,u)[u](t)}function h(e){const s=e.getPopupWindow().getZIndexComponent();const t=babelHelpers.classPrivateFieldLooseBase(this,d)[d].popup;if(!t){return}const a=t.getZIndexComponent();a.setSort(s.getSort()+1);const i=a.getStack();i.sort()}var E=babelHelpers.classPrivateFieldLooseKey("PULL_EVENT");var L=babelHelpers.classPrivateFieldLooseKey("SECONDS_IN_DAY");var I=babelHelpers.classPrivateFieldLooseKey("SECONDS_IN_WEEK");var P=babelHelpers.classPrivateFieldLooseKey("SUBITEMS_CLASS_NAME");var T=babelHelpers.classPrivateFieldLooseKey("subMenu");var f=babelHelpers.classPrivateFieldLooseKey("subItems");var m=babelHelpers.classPrivateFieldLooseKey("defaultDeadline");var F=babelHelpers.classPrivateFieldLooseKey("isDeadlineNotificationAvailable");var M=babelHelpers.classPrivateFieldLooseKey("onMenuItemClick");var N=babelHelpers.classPrivateFieldLooseKey("subscribeToPull");var y=babelHelpers.classPrivateFieldLooseKey("onDefaultDeadlineChanged");class D extends p{constructor(e=true){super();Object.defineProperty(this,y,{value:g});Object.defineProperty(this,N,{value:S});Object.defineProperty(this,M,{value:H});this.MENU_ID="default-deadline-menu";this.HINT_ID="default-deadline-hint";this.TITLE="default";Object.defineProperty(this,E,{writable:true,value:"default_deadline_changed"});Object.defineProperty(this,L,{writable:true,value:86400});Object.defineProperty(this,I,{writable:true,value:7*babelHelpers.classPrivateFieldLooseBase(this,L)[L]});Object.defineProperty(this,P,{writable:true,value:"menu-popup-default-deadline-item"});Object.defineProperty(this,T,{writable:true,value:void 0});Object.defineProperty(this,f,{writable:true,value:void 0});Object.defineProperty(this,m,{writable:true,value:void 0});Object.defineProperty(this,F,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,F)[F]=e;babelHelpers.classPrivateFieldLooseBase(this,N)[N]()}getSubItems(){const e=babelHelpers.classPrivateFieldLooseBase(this,M)[M].bind(this);const s=[new i.MenuItem({dataset:{id:`${this.MENU_ID}-day`,analytics:"one_day_button"},text:t.Loc.getMessage("TASKS_DEADLINE_MENU_DEFAULT_ITEM_1_DAY"),value:babelHelpers.classPrivateFieldLooseBase(this,L)[L],isExactTime:false,className:babelHelpers.classPrivateFieldLooseBase(this,P)[P],onclick:e}),new i.MenuItem({dataset:{id:`${this.MENU_ID}-three-days`,analytics:"three_days_button"},text:t.Loc.getMessage("TASKS_DEADLINE_MENU_DEFAULT_ITEM_3_DAYS"),value:3*babelHelpers.classPrivateFieldLooseBase(this,L)[L],isExactTime:false,className:babelHelpers.classPrivateFieldLooseBase(this,P)[P],onclick:e}),new i.MenuItem({dataset:{id:`${this.MENU_ID}-week`,analytics:"one_week_button"},text:t.Loc.getMessage("TASKS_DEADLINE_MENU_DEFAULT_ITEM_1_WEEK"),value:babelHelpers.classPrivateFieldLooseBase(this,I)[I],isExactTime:false,className:babelHelpers.classPrivateFieldLooseBase(this,P)[P],onclick:e}),new i.MenuItem({dataset:{id:`${this.MENU_ID}-two-weeks`,analytics:"two_weeks_button"},text:t.Loc.getMessage("TASKS_DEADLINE_MENU_DEFAULT_ITEM_2_WEEKS"),value:2*babelHelpers.classPrivateFieldLooseBase(this,I)[I],isExactTime:false,className:babelHelpers.classPrivateFieldLooseBase(this,P)[P],onclick:e}),new i.MenuItem({dataset:{id:`${this.MENU_ID}-empty`,analytics:"no_deadline"},text:t.Loc.getMessage("TASKS_DEADLINE_MENU_DEFAULT_ITEM_EMPTY"),value:0,isExactTime:false,className:babelHelpers.classPrivateFieldLooseBase(this,P)[P],onclick:e})];if(babelHelpers.classPrivateFieldLooseBase(this,F)[F]){s.push(new i.MenuItem({dataset:{id:`${this.MENU_ID}-custom`},text:t.Loc.getMessage("TASKS_DEADLINE_MENU_DEFAULT_ITEM_CUSTOM"),className:babelHelpers.classPrivateFieldLooseBase(this,P)[P]}))}return s}refreshIcons(e,s){const a=t.Type.isArrayFilled(e)||!t.Type.isUndefined(babelHelpers.classPrivateFieldLooseBase(this,f)[f]);const l=!t.Type.isUndefined(s)||!t.Type.isUndefined(babelHelpers.classPrivateFieldLooseBase(this,T)[T]);if(!a||!l){return}if(t.Type.isArrayFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,f)[f]=e}if(!t.Type.isUndefined(s)){babelHelpers.classPrivateFieldLooseBase(this,T)[T]=s}let r=false;let o=null;babelHelpers.classPrivateFieldLooseBase(this,f)[f].forEach((e=>{const s=e.getLayout().item;if(!t.Type.isElementNode(s)){return}const a=e.value;if(t.Type.isUndefined(a)){o=e}else if(a===this.defaultDeadline){t.Dom.addClass(s,this.ACCEPTED_ITEM_CLASS);r=true;return}t.Dom.removeClass(s,this.ACCEPTED_ITEM_CLASS)}));if(!t.Type.isNull(o)){const e=r?this.DISABLED_ITEM_CLASS:this.ACCEPTED_ITEM_CLASS;t.Dom.addClass(o.getLayout().item,e);return}if(r){return}o=new i.MenuItem({dataset:{id:`${this.MENU_ID}-custom`},text:t.Loc.getMessage("TASKS_DEADLINE_MENU_DEFAULT_ITEM_CUSTOM"),className:`${babelHelpers.classPrivateFieldLooseBase(this,P)[P]} ${this.ACCEPTED_ITEM_CLASS}`});babelHelpers.classPrivateFieldLooseBase(this,T)[T].addMenuItem(o)}get defaultDeadline(){if(!t.Type.isUndefined(babelHelpers.classPrivateFieldLooseBase(this,m)[m])){return babelHelpers.classPrivateFieldLooseBase(this,m)[m]}const e=t.Extension.getSettings("tasks.deadline.menu");babelHelpers.classPrivateFieldLooseBase(this,m)[m]=Number(e.get("defaultDeadline"));return babelHelpers.classPrivateFieldLooseBase(this,m)[m]}}function H(e,s){var a;const i=s.value;if(!t.Type.isNumber(i)){return}if(i===babelHelpers.classPrivateFieldLooseBase(this,m)[m]){return}babelHelpers.classPrivateFieldLooseBase(this,m)[m]=i;const l=s.getMenuWindow();const r=l.getMenuItems();this.refreshIcons(r,l);t.ajax.runAction("tasks.deadline.Deadline.setDefault",{data:{deadlineData:{default:i,isExactTime:s.isExactTime?"Y":"N"}},analytics:{tool:"tasks",category:"task_operations",event:"click_settings",type:"task",c_section:"tasks",c_sub_section:"default_deadline_selected",c_element:(a=s.dataset)==null?void 0:a.analytics}}).catch((e=>this.onPromiseError(e)))}function S(){l.PULL.subscribe({moduleId:"tasks",command:babelHelpers.classPrivateFieldLooseBase(this,E)[E],callback:babelHelpers.classPrivateFieldLooseBase(this,y)[y].bind(this)})}function g(e){const s=e.deadline;if(!t.Type.isNumber(s)||babelHelpers.classPrivateFieldLooseBase(this,m)[m]===s){return}babelHelpers.classPrivateFieldLooseBase(this,m)[m]=s}var A=babelHelpers.classPrivateFieldLooseKey("PULL_EVENT");var B=babelHelpers.classPrivateFieldLooseKey("SUBITEMS_CLASS_NAME");var U=babelHelpers.classPrivateFieldLooseKey("subItems");var k=babelHelpers.classPrivateFieldLooseKey("skipPeriod");var K=babelHelpers.classPrivateFieldLooseKey("onMenuItemClick");var C=babelHelpers.classPrivateFieldLooseKey("subscribeToPull");var O=babelHelpers.classPrivateFieldLooseKey("onNotificationPeriodChanged");class w extends p{constructor(){super();Object.defineProperty(this,O,{value:$});Object.defineProperty(this,C,{value:j});Object.defineProperty(this,K,{value:x});this.MENU_ID="skip-deadline-notification-menu";this.HINT_ID="skip-deadline-notification-hint";this.TITLE="notification";Object.defineProperty(this,A,{writable:true,value:"skip_deadline_notification_period_changed"});Object.defineProperty(this,B,{writable:true,value:"menu-popup-skip-deadline-item"});Object.defineProperty(this,U,{writable:true,value:void 0});Object.defineProperty(this,k,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,C)[C]()}getSubItems(){const e=babelHelpers.classPrivateFieldLooseBase(this,K)[K].bind(this);return[new i.MenuItem({text:t.Loc.getMessage("TASKS_DEADLINE_MENU_NOTIFICATION_ITEM_DELIMITER"),delimiter:true,className:babelHelpers.classPrivateFieldLooseBase(this,B)[B]}),new i.MenuItem({dataset:{id:`${this.MENU_ID}-always`,analytics:"daily_remind"},text:t.Loc.getMessage("TASKS_DEADLINE_MENU_NOTIFICATION_ITEM_DONT_SKIP"),value:"",className:babelHelpers.classPrivateFieldLooseBase(this,B)[B],onclick:e}),new i.MenuItem({dataset:{id:`${this.MENU_ID}-day`,analytics:"no_remind_today"},text:t.Loc.getMessage("TASKS_DEADLINE_MENU_NOTIFICATION_ITEM_SKIP_FOR_DAY"),value:"day",className:babelHelpers.classPrivateFieldLooseBase(this,B)[B],onclick:e}),new i.MenuItem({dataset:{id:`${this.MENU_ID}-week`,analytics:"no_remind_current_week"},text:t.Loc.getMessage("TASKS_DEADLINE_MENU_NOTIFICATION_ITEM_SKIP_FOR_WEEK"),value:"week",className:babelHelpers.classPrivateFieldLooseBase(this,B)[B],onclick:e}),new i.MenuItem({dataset:{id:`${this.MENU_ID}-month`,analytics:"no_remind_current_month"},text:t.Loc.getMessage("TASKS_DEADLINE_MENU_NOTIFICATION_ITEM_SKIP_FOR_MONTH"),value:"month",className:babelHelpers.classPrivateFieldLooseBase(this,B)[B],onclick:e}),new i.MenuItem({dataset:{id:`${this.MENU_ID}-forever`,analytics:"never_remind"},text:t.Loc.getMessage("TASKS_DEADLINE_MENU_NOTIFICATION_ITEM_SKIP_FOREVER"),value:"forever",className:babelHelpers.classPrivateFieldLooseBase(this,B)[B],onclick:e})]}refreshIcons(e,s){const a=t.Type.isArrayFilled(e)||!t.Type.isUndefined(babelHelpers.classPrivateFieldLooseBase(this,U)[U]);if(!a){return}if(t.Type.isArrayFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,U)[U]=e}babelHelpers.classPrivateFieldLooseBase(this,U)[U].forEach((e=>{const s=e.getLayout().item;if(!t.Type.isElementNode(s)){return}const a=e.value;if(a===this.skipPeriod){t.Dom.addClass(s,this.ACCEPTED_ITEM_CLASS);return}t.Dom.removeClass(s,this.ACCEPTED_ITEM_CLASS)}))}get skipPeriod(){if(!t.Type.isUndefined(babelHelpers.classPrivateFieldLooseBase(this,k)[k])){return babelHelpers.classPrivateFieldLooseBase(this,k)[k]}const e=t.Extension.getSettings("tasks.deadline.menu");babelHelpers.classPrivateFieldLooseBase(this,k)[k]=String(e.get("skipDeadlineNotificationPeriod"));return babelHelpers.classPrivateFieldLooseBase(this,k)[k]}}function x(e,s){var a;const i=s.value;if(!t.Type.isString(i)){return}if(i===babelHelpers.classPrivateFieldLooseBase(this,k)[k]){return}babelHelpers.classPrivateFieldLooseBase(this,k)[k]=i;const l=s.getMenuWindow();const r=l.getMenuItems();this.refreshIcons(r,l);t.ajax.runAction("tasks.deadline.Notification.skip",{data:{notificationData:{skipPeriod:i}},analytics:{tool:"tasks",category:"task_operations",event:"click_settings",type:"task",c_section:"tasks",c_sub_section:"deadline_management",c_element:(a=s.dataset)==null?void 0:a.analytics}}).catch((e=>this.onPromiseError(e)))}function j(){l.PULL.subscribe({moduleId:"tasks",command:babelHelpers.classPrivateFieldLooseBase(this,A)[A],callback:babelHelpers.classPrivateFieldLooseBase(this,O)[O].bind(this)})}function $(e){const s=e.period;if(!t.Type.isString(s)||babelHelpers.classPrivateFieldLooseBase(this,k)[k]===s){return}babelHelpers.classPrivateFieldLooseBase(this,k)[k]=s}var R=babelHelpers.classPrivateFieldLooseKey("isDeadlineNotificationAvailable");class X{constructor(){Object.defineProperty(this,R,{writable:true,value:void 0})}get menuItems(){const e=new D(this.isDeadlineNotificationAvailable);const s=[e.getItem()];if(this.isDeadlineNotificationAvailable){const e=new w;s.push(e.getItem())}return s}get isDeadlineNotificationAvailable(){if(!t.Type.isUndefined(babelHelpers.classPrivateFieldLooseBase(this,R)[R])){return babelHelpers.classPrivateFieldLooseBase(this,R)[R]}const e=t.Extension.getSettings("tasks.deadline.menu");babelHelpers.classPrivateFieldLooseBase(this,R)[R]=Boolean(e.get("isDeadlineNotificationAvailable"));return babelHelpers.classPrivateFieldLooseBase(this,R)[R]}}e.Menu=X})(this.BX.Tasks.Deadline=this.BX.Tasks.Deadline||{},BX.UI.Dialogs,BX,BX.Event,BX.Main,BX);
//# sourceMappingURL=menu.bundle.map.js