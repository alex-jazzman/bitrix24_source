if(typeof BX.FilterEntitySelector==="undefined"){BX.FilterEntitySelector=function(){this._id="";this._settings={};this._fieldId="";this._control=null;this._selector=null;this._inputKeyPressHandler=BX.delegate(this.keypress,this)};BX.FilterEntitySelector.prototype={initialize:function(e,t){this._id=e;this._settings=t?t:{};this._fieldId=this.getSetting("fieldId","");BX.addCustomEvent(window,"BX.Main.Filter:customEntityFocus",BX.delegate(this.onCustomEntitySelectorOpen,this));BX.addCustomEvent(window,"BX.Main.Filter:customEntityBlur",BX.delegate(this.onCustomEntitySelectorClose,this))},getId:function(){return this._id},getSetting:function(e,t){return this._settings.hasOwnProperty(e)?this._settings[e]:t},keypress:function(e){},open:function(e,t){this._selector=new BX.Tasks.Integration.Socialnetwork.NetworkSelector({scope:e,id:this.getId()+"-selector",mode:this.getSetting("mode"),query:false,useSearch:true,useAdd:false,parent:this,popupOffsetTop:5,popupOffsetLeft:40});this._selector.bindEvent("item-selected",BX.delegate((function(e){this._control.setData(BX.util.htmlspecialcharsback(e.nameFormatted),e.id);if(!this.getSetting("multi")){this._selector.close()}}),this));this._selector.open()},close:function(){if(this._selector){this._selector.close()}},onCustomEntitySelectorOpen:function(e){this._control=e;if(this._fieldId!==e.getId()){this._selector=null;this.close()}else{this._selector=e;this.open(e.field)}},onCustomEntitySelectorClose:function(e){if(this._fieldId!==e.getId()){this.close()}}};BX.FilterEntitySelector.closeAll=function(){for(var e in this.items){if(this.items.hasOwnProperty(e)){this.items[e].close()}}};BX.FilterEntitySelector.items={};BX.FilterEntitySelector.create=function(e,t){var s=new BX.FilterEntitySelector(e,t);s.initialize(e,t);this.items[s.getId()]=s;return s}}if(typeof BX.TasksGroupsSelectorInit==="undefined"){BX.TasksGroupsSelectorInit=function(e){var t=null,s=e.selectorId,i=e.buttonAddId,a=e.pathTaskAdd.indexOf("?")===-1?e.pathTaskAdd+"?GROUP_ID=":e.pathTaskAdd+"&GROUP_ID=",l=e.messages,o=e.groups,r=e.currentGroup,n=e.groupLimit,c=e.offsetLeft;var d=function(e){if(BX(i)){BX(i).setAttribute("href",a+e)}};r.id=parseInt(r.id);r.text=BX.util.htmlspecialchars(r.text);d(r.id);BX.bind(BX(s),"click",(function(){if(t===null){var e=[];var i=function(e,a){BX.onCustomEvent(window,"BX.Kanban.ChangeGroup",[a.id,r.id]);BX.onCustomEvent(window,"BX.Tasks.ChangeGroup",[a.id,r.id]);if(a.id!==r.id){var l=t.getMenuItems();t.addMenuItem({id:r.id,text:r.text,onclick:BX.delegate(i,this)},l.length>0?l[0]["id"]:null);if(a.id!=="wo"){if(t.getMenuItem(a.id)){t.removeMenuItem(a.id)}else if(l.length>=n){t.removeMenuItem(l[l.length-3].id)}}}t.close();r={id:a.id,text:a.text};d(a.id);if(BX(s+"_text")){BX(s+"_text").innerHTML=a.text}BX.onCustomEvent(this,"onTasksGroupSelectorChange",[r])};for(var a=0,p=o.length;a<p;a++){e.push({id:parseInt(o[a]["id"]),text:BX.util.htmlspecialchars(o[a]["text"]),class:"menu-popup-item-none",onclick:BX.delegate(i,this)})}if(o.length>0){e.push({delimiter:true});e.push({id:"new",text:l.TASKS_BTN_GROUP_SELECT,onclick:function(e,s){t.getPopupWindow().setAutoHide(false);var a=new BX.Tasks.Integration.Socialnetwork.NetworkSelector({scope:s.getContainer(),id:"group-selector",mode:"group",query:false,useSearch:true,useAdd:false,parent:this,popupOffsetTop:5,popupOffsetLeft:40});a.bindEvent("item-selected",(function(e){i(null,{id:e.id,text:e.nameFormatted.length>50?e.nameFormatted.substring(0,50)+"...":e.nameFormatted});a.close()}));a.bindEvent("close",(function(e){t.getPopupWindow().setAutoHide(true)}));a.open()}})}if(!c){c=0}t=BX.PopupMenu.create(s,BX(s),e,{autoHide:true,closeByEsc:true,offsetLeft:c})}t.popupWindow.show()}))}}if(typeof BX.Tasks.SortManager==="undefined"){BX.Tasks.SortManager={setSort:function(e,t,s){t=t||"asc";if(BX.Main.gridManager!=undefined){var i=BX.Main.gridManager.getById(s).instance;i.sortByColumn({sort_by:e,sort_order:t});if(e==="SORTING"){i.getRows().enableDragAndDrop()}else{i.getRows().disableDragAndDrop()}}else{BX.ajax.post(BX.util.add_url_param("/bitrix/components/bitrix/main.ui.grid/settings.ajax.php",{GRID_ID:s,action:"setSort"}),{by:e,order:t},(function(e){try{e=JSON.parse(e);if(!e.error){window.location.reload()}}catch(e){}}))}}}}if(typeof BX.Tasks.SprintSelector==="undefined"){BX.Tasks.SprintSelector=function(e,t){if(!BX(e)){return}const s=BX.UI.ButtonManager.createFromNode(BX(e));BX.bind(BX(e),"click",(function(){var i=new BX.UI.EntitySelector.Dialog({targetNode:BX(e),width:400,height:300,multiple:false,dropdownMode:true,enableSearch:true,compactView:true,showAvatars:false,cacheable:false,preselectedItems:[["sprint-selector",t.sprintId]],entities:[{id:"sprint-selector",options:{groupId:t.groupId,onlyCompleted:true},dynamicLoad:true,dynamicSearch:true}],events:{"Item:onSelect":function(i){var a=i.getData().item;t.sprintId=a.id;BX.onCustomEvent(BX(e),"onTasksGroupSelectorChange",[{id:t.groupId,sprintId:a.id,name:a.customData.get("name")}]);s.setText(a.customData.get("label"))}}});i.show()}))}}if(typeof BX.Tasks.ProjectSelector==="undefined"){BX.Tasks.ProjectSelector={reloadProject:function(e){var t=document.location.href;t=BX.util.add_url_param(t,{group_id:e});document.location.href=t}}}this.BX=this.BX||{};(function(e,t,s,i,a,l){"use strict";var o=babelHelpers.classPrivateFieldLooseKey("filterId");var r=babelHelpers.classPrivateFieldLooseKey("filter");var n=babelHelpers.classPrivateFieldLooseKey("init");var c=babelHelpers.classPrivateFieldLooseKey("setFilter");var d=babelHelpers.classPrivateFieldLooseKey("setGuide");var p=babelHelpers.classPrivateFieldLooseKey("markViewed");var u=babelHelpers.classPrivateFieldLooseKey("log");class b{constructor(e){Object.defineProperty(this,u,{value:P});Object.defineProperty(this,p,{value:B});Object.defineProperty(this,d,{value:f});Object.defineProperty(this,c,{value:v});Object.defineProperty(this,n,{value:h});Object.defineProperty(this,o,{writable:true,value:void 0});Object.defineProperty(this,r,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,o)[o]=e.filterId;babelHelpers.classPrivateFieldLooseBase(this,n)[n]()}payAttention(){setTimeout((()=>{this.guide.showNextStep();babelHelpers.classPrivateFieldLooseBase(this,p)[p]()}),b.DELAY)}}function h(){babelHelpers.classPrivateFieldLooseBase(babelHelpers.classPrivateFieldLooseBase(this,c)[c](),d)[d]()}function v(){babelHelpers.classPrivateFieldLooseBase(this,r)[r]=BX.Main.filterManager.getById(babelHelpers.classPrivateFieldLooseBase(this,o)[o]);return this}function f(){this.guide=new t.Guide({simpleMode:true,onEvents:true,steps:[{target:babelHelpers.classPrivateFieldLooseBase(this,r)[r].getPopupBindElement(),title:s.Loc.getMessage("TASKS_INTERFACE_FILTER_PRESETS_MOVED_TITLE"),text:s.Loc.getMessage("TASKS_INTERFACE_FILTER_PRESETS_MOVED_TEXT"),position:"bottom",condition:{top:true,bottom:false,color:"primary"}}]});this.guide.getPopup().setWidth(420);return this}function B(){s.ajax.runComponentAction("bitrix:tasks.interface.filter","markPresetAhaMomentViewed",{mode:"class",data:{}}).catch((e=>{babelHelpers.classPrivateFieldLooseBase(this,u)[u](e)}))}function P(e){console.log(e)}b.DELAY=1e3;const y="view_all";var F=babelHelpers.classPrivateFieldLooseKey("selectedRoleId");var m=babelHelpers.classPrivateFieldLooseKey("roles");var g=babelHelpers.classPrivateFieldLooseKey("analytics");var L=babelHelpers.classPrivateFieldLooseKey("button");var H=babelHelpers.classPrivateFieldLooseKey("menu");var X=babelHelpers.classPrivateFieldLooseKey("initButton");var I=babelHelpers.classPrivateFieldLooseKey("bindEvents");var E=babelHelpers.classPrivateFieldLooseKey("handleFilterBeforeApply");var S=babelHelpers.classPrivateFieldLooseKey("update");var w=babelHelpers.classPrivateFieldLooseKey("menuItems");var T=babelHelpers.classPrivateFieldLooseKey("roleName");var _=babelHelpers.classPrivateFieldLooseKey("sendAnalyticsClick");var k=babelHelpers.classPrivateFieldLooseKey("sendAnalyticsApply");var O=babelHelpers.classPrivateFieldLooseKey("getAnalyticsSender");class A{constructor(e){Object.defineProperty(this,O,{value:G});Object.defineProperty(this,k,{value:D});Object.defineProperty(this,_,{value:R});Object.defineProperty(this,T,{get:x,set:void 0});Object.defineProperty(this,w,{get:K,set:void 0});Object.defineProperty(this,S,{value:C});Object.defineProperty(this,I,{value:M});Object.defineProperty(this,X,{value:j});Object.defineProperty(this,F,{writable:true,value:void 0});Object.defineProperty(this,m,{writable:true,value:void 0});Object.defineProperty(this,g,{writable:true,value:void 0});Object.defineProperty(this,L,{writable:true,value:void 0});Object.defineProperty(this,H,{writable:true,value:void 0});Object.defineProperty(this,E,{writable:true,value:e=>{const t=babelHelpers.classPrivateFieldLooseBase(this,F)[F];babelHelpers.classPrivateFieldLooseBase(this,F)[F]=e.getData()[2].getFilterFieldsValues().ROLEID||y;babelHelpers.classPrivateFieldLooseBase(this,S)[S]();if(t!==babelHelpers.classPrivateFieldLooseBase(this,F)[F]){void babelHelpers.classPrivateFieldLooseBase(this,k)[k](babelHelpers.classPrivateFieldLooseBase(this,F)[F])}}});if(!e.button){return}babelHelpers.classPrivateFieldLooseBase(this,F)[F]=e.selectedRoleId||y;babelHelpers.classPrivateFieldLooseBase(this,m)[m]={[y]:{title:s.Loc.getMessage("TASKS_ALL_ROLES")},...Object.fromEntries(Object.entries(e.items).map((([e,t])=>[e,{title:t.TEXT}])))};babelHelpers.classPrivateFieldLooseBase(this,g)[g]=e.analytics;babelHelpers.classPrivateFieldLooseBase(this,X)[X](e.button);babelHelpers.classPrivateFieldLooseBase(this,I)[I]()}}function j(e){babelHelpers.classPrivateFieldLooseBase(this,H)[H]=new l.Menu({items:babelHelpers.classPrivateFieldLooseBase(this,w)[w],offsetTop:6});babelHelpers.classPrivateFieldLooseBase(this,L)[L]=a.ButtonManager.createFromNode(e);babelHelpers.classPrivateFieldLooseBase(this,L)[L].bindEvent("click",(()=>{babelHelpers.classPrivateFieldLooseBase(this,H)[H].show(babelHelpers.classPrivateFieldLooseBase(this,L)[L].getContainer());void babelHelpers.classPrivateFieldLooseBase(this,_)[_]()}))}function M(){i.EventEmitter.subscribe("BX.Main.Filter:beforeApply",babelHelpers.classPrivateFieldLooseBase(this,E)[E])}function C(){babelHelpers.classPrivateFieldLooseBase(this,L)[L].setText(babelHelpers.classPrivateFieldLooseBase(this,T)[T]);babelHelpers.classPrivateFieldLooseBase(this,H)[H].updateItems(babelHelpers.classPrivateFieldLooseBase(this,w)[w])}function K(){return Object.entries(babelHelpers.classPrivateFieldLooseBase(this,m)[m]).map((([e,t])=>({title:t.title,isSelected:e===babelHelpers.classPrivateFieldLooseBase(this,F)[F],onClick:()=>i.EventEmitter.emit("Tasks.TopMenu:onItem",new i.BaseEvent({data:[e],compatData:[e]}))})))}function x(){return babelHelpers.classPrivateFieldLooseBase(this,m)[m][babelHelpers.classPrivateFieldLooseBase(this,F)[F]].title}async function R(){const e=await babelHelpers.classPrivateFieldLooseBase(this,O)[O]();e.sendRoleClick(babelHelpers.classPrivateFieldLooseBase(this,g)[g])}async function D(e){const t=await babelHelpers.classPrivateFieldLooseBase(this,O)[O]();t.sendRoleClickType(babelHelpers.classPrivateFieldLooseBase(this,g)[g],{role:e,isFilterEnabled:e!==y})}async function G(){return(await s.Runtime.loadExtension("tasks.v2.lib.analytics")).analytics}var N=babelHelpers.classPrivateFieldLooseKey("params");var U=babelHelpers.classPrivateFieldLooseKey("initAddButton");var V=babelHelpers.classPrivateFieldLooseKey("initRoles");var W=babelHelpers.classPrivateFieldLooseKey("showPresetTourGuide");class q{constructor(e){Object.defineProperty(this,W,{value:J});Object.defineProperty(this,V,{value:Y});Object.defineProperty(this,U,{value:z});Object.defineProperty(this,N,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,N)[N]=e;babelHelpers.classPrivateFieldLooseBase(this,U)[U]();babelHelpers.classPrivateFieldLooseBase(this,V)[V]();babelHelpers.classPrivateFieldLooseBase(this,W)[W]()}}function z(){if(!babelHelpers.classPrivateFieldLooseBase(this,N)[N].isV2Form||!babelHelpers.classPrivateFieldLooseBase(this,N)[N].createNode){return}const e=a.ButtonManager.createFromNode(babelHelpers.classPrivateFieldLooseBase(this,N)[N].createNode);e.getMainButton().bindEvent("click",(()=>BX.Tasks.V2.Application.TaskCard.showCompactCard({groupId:babelHelpers.classPrivateFieldLooseBase(this,N)[N].groupId,analytics:babelHelpers.classPrivateFieldLooseBase(this,N)[N].analytics})))}function Y(){new A(babelHelpers.classPrivateFieldLooseBase(this,N)[N].roles)}function J(){if(!babelHelpers.classPrivateFieldLooseBase(this,N)[N].showPresetTourGuide){return}BX.Tasks.Preset.Aha=new BX.Tasks.Preset({filterId:babelHelpers.classPrivateFieldLooseBase(this,N)[N].filterId});BX.Tasks.Preset.Aha.payAttention()}e.Preset=b;e.TasksInterfaceFilter=q})(this.BX.Tasks=this.BX.Tasks||{},BX.UI.Tour,BX,BX.Event,BX.UI,BX.UI.System);
//# sourceMappingURL=script.map.js