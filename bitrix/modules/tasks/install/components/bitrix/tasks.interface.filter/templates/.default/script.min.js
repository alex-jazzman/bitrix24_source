if(typeof BX.FilterEntitySelector==="undefined"){BX.FilterEntitySelector=function(){this._id="";this._settings={};this._fieldId="";this._control=null;this._selector=null;this._inputKeyPressHandler=BX.delegate(this.keypress,this)};BX.FilterEntitySelector.prototype={initialize:function(e,t){this._id=e;this._settings=t?t:{};this._fieldId=this.getSetting("fieldId","");BX.addCustomEvent(window,"BX.Main.Filter:customEntityFocus",BX.delegate(this.onCustomEntitySelectorOpen,this));BX.addCustomEvent(window,"BX.Main.Filter:customEntityBlur",BX.delegate(this.onCustomEntitySelectorClose,this))},getId:function(){return this._id},getSetting:function(e,t){return this._settings.hasOwnProperty(e)?this._settings[e]:t},keypress:function(e){},open:function(e,t){this._selector=new BX.Tasks.Integration.Socialnetwork.NetworkSelector({scope:e,id:this.getId()+"-selector",mode:this.getSetting("mode"),query:false,useSearch:true,useAdd:false,parent:this,popupOffsetTop:5,popupOffsetLeft:40});this._selector.bindEvent("item-selected",BX.delegate((function(e){this._control.setData(BX.util.htmlspecialcharsback(e.nameFormatted),e.id);if(!this.getSetting("multi")){this._selector.close()}}),this));this._selector.open()},close:function(){if(this._selector){this._selector.close()}},onCustomEntitySelectorOpen:function(e){this._control=e;if(this._fieldId!==e.getId()){this._selector=null;this.close()}else{this._selector=e;this.open(e.field)}},onCustomEntitySelectorClose:function(e){if(this._fieldId!==e.getId()){this.close()}}};BX.FilterEntitySelector.closeAll=function(){for(var e in this.items){if(this.items.hasOwnProperty(e)){this.items[e].close()}}};BX.FilterEntitySelector.items={};BX.FilterEntitySelector.create=function(e,t){var s=new BX.FilterEntitySelector(e,t);s.initialize(e,t);this.items[s.getId()]=s;return s}}if(typeof BX.TasksGroupsSelectorInit==="undefined"){BX.TasksGroupsSelectorInit=function(e){var t=null,s=e.selectorId,i=e.buttonAddId,a=e.pathTaskAdd.indexOf("?")===-1?e.pathTaskAdd+"?GROUP_ID=":e.pathTaskAdd+"&GROUP_ID=",l=e.messages,r=e.groups,o=e.currentGroup,n=e.groupLimit,c=e.offsetLeft;var d=function(e){if(BX(i)){BX(i).setAttribute("href",a+e)}};o.id=parseInt(o.id);o.text=BX.util.htmlspecialchars(o.text);d(o.id);BX.bind(BX(s),"click",(function(){if(t===null){var e=[];var i=function(e,a){BX.onCustomEvent(window,"BX.Kanban.ChangeGroup",[a.id,o.id]);BX.onCustomEvent(window,"BX.Tasks.ChangeGroup",[a.id,o.id]);if(a.id!==o.id){var l=t.getMenuItems();t.addMenuItem({id:o.id,text:o.text,onclick:BX.delegate(i,this)},l.length>0?l[0]["id"]:null);if(a.id!=="wo"){if(t.getMenuItem(a.id)){t.removeMenuItem(a.id)}else if(l.length>=n){t.removeMenuItem(l[l.length-3].id)}}}t.close();o={id:a.id,text:a.text};d(a.id);if(BX(s+"_text")){BX(s+"_text").innerHTML=a.text}BX.onCustomEvent(this,"onTasksGroupSelectorChange",[o])};for(var a=0,b=r.length;a<b;a++){e.push({id:parseInt(r[a]["id"]),text:BX.util.htmlspecialchars(r[a]["text"]),class:"menu-popup-item-none",onclick:BX.delegate(i,this)})}if(r.length>0){e.push({delimiter:true});e.push({id:"new",text:l.TASKS_BTN_GROUP_SELECT,onclick:function(e,s){t.getPopupWindow().setAutoHide(false);var a=new BX.Tasks.Integration.Socialnetwork.NetworkSelector({scope:s.getContainer(),id:"group-selector",mode:"group",query:false,useSearch:true,useAdd:false,parent:this,popupOffsetTop:5,popupOffsetLeft:40});a.bindEvent("item-selected",(function(e){i(null,{id:e.id,text:e.nameFormatted.length>50?e.nameFormatted.substring(0,50)+"...":e.nameFormatted});a.close()}));a.bindEvent("close",(function(e){t.getPopupWindow().setAutoHide(true)}));a.open()}})}if(!c){c=0}t=BX.PopupMenu.create(s,BX(s),e,{autoHide:true,closeByEsc:true,offsetLeft:c})}t.popupWindow.show()}))}}if(typeof BX.Tasks.SortManager==="undefined"){BX.Tasks.SortManager={setSort:function(e,t,s){t=t||"asc";if(BX.Main.gridManager!=undefined){var i=BX.Main.gridManager.getById(s).instance;i.sortByColumn({sort_by:e,sort_order:t});if(e==="SORTING"){i.getRows().enableDragAndDrop()}else{i.getRows().disableDragAndDrop()}}else{BX.ajax.post(BX.util.add_url_param("/bitrix/components/bitrix/main.ui.grid/settings.ajax.php",{GRID_ID:s,action:"setSort"}),{by:e,order:t},(function(e){try{e=JSON.parse(e);if(!e.error){window.location.reload()}}catch(e){}}))}}}}if(typeof BX.Tasks.SprintSelector==="undefined"){BX.Tasks.SprintSelector=function(e,t){if(!BX(e)){return}const s=BX.UI.ButtonManager.createFromNode(BX(e));BX.bind(BX(e),"click",(function(){var i=new BX.UI.EntitySelector.Dialog({targetNode:BX(e),width:400,height:300,multiple:false,dropdownMode:true,enableSearch:true,compactView:true,showAvatars:false,cacheable:false,preselectedItems:[["sprint-selector",t.sprintId]],entities:[{id:"sprint-selector",options:{groupId:t.groupId,onlyCompleted:true},dynamicLoad:true,dynamicSearch:true}],events:{"Item:onSelect":function(i){var a=i.getData().item;t.sprintId=a.id;BX.onCustomEvent(BX(e),"onTasksGroupSelectorChange",[{id:t.groupId,sprintId:a.id,name:a.customData.get("name")}]);s.setText(a.customData.get("label"))}}});i.show()}))}}if(typeof BX.Tasks.ProjectSelector==="undefined"){BX.Tasks.ProjectSelector={reloadProject:function(e){var t=document.location.href;t=BX.util.add_url_param(t,{group_id:e});document.location.href=t}}}this.BX=this.BX||{};(function(e,t,s,i,a,l,r){"use strict";var o=babelHelpers.classPrivateFieldLooseKey("filterId");var n=babelHelpers.classPrivateFieldLooseKey("filter");var c=babelHelpers.classPrivateFieldLooseKey("init");var d=babelHelpers.classPrivateFieldLooseKey("setFilter");var b=babelHelpers.classPrivateFieldLooseKey("setGuide");var u=babelHelpers.classPrivateFieldLooseKey("markViewed");var p=babelHelpers.classPrivateFieldLooseKey("log");class h{constructor(e){Object.defineProperty(this,p,{value:F});Object.defineProperty(this,u,{value:P});Object.defineProperty(this,b,{value:B});Object.defineProperty(this,d,{value:f});Object.defineProperty(this,c,{value:v});Object.defineProperty(this,o,{writable:true,value:void 0});Object.defineProperty(this,n,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,o)[o]=e.filterId;babelHelpers.classPrivateFieldLooseBase(this,c)[c]()}payAttention(){setTimeout((()=>{this.guide.showNextStep();babelHelpers.classPrivateFieldLooseBase(this,u)[u]()}),h.DELAY)}}function v(){babelHelpers.classPrivateFieldLooseBase(babelHelpers.classPrivateFieldLooseBase(this,d)[d](),b)[b]()}function f(){babelHelpers.classPrivateFieldLooseBase(this,n)[n]=BX.Main.filterManager.getById(babelHelpers.classPrivateFieldLooseBase(this,o)[o]);return this}function B(){this.guide=new t.Guide({simpleMode:true,onEvents:true,steps:[{target:babelHelpers.classPrivateFieldLooseBase(this,n)[n].getPopupBindElement(),title:s.Loc.getMessage("TASKS_INTERFACE_FILTER_PRESETS_MOVED_TITLE"),text:s.Loc.getMessage("TASKS_INTERFACE_FILTER_PRESETS_MOVED_TEXT"),position:"bottom",condition:{top:true,bottom:false,color:"primary"}}]});this.guide.getPopup().setWidth(420);return this}function P(){s.ajax.runComponentAction("bitrix:tasks.interface.filter","markPresetAhaMomentViewed",{mode:"class",data:{}}).catch((e=>{babelHelpers.classPrivateFieldLooseBase(this,p)[p](e)}))}function F(e){console.log(e)}h.DELAY=1e3;const y="view_all";var L=babelHelpers.classPrivateFieldLooseKey("selectedRoleId");var m=babelHelpers.classPrivateFieldLooseKey("roles");var g=babelHelpers.classPrivateFieldLooseKey("analytics");var H=babelHelpers.classPrivateFieldLooseKey("button");var X=babelHelpers.classPrivateFieldLooseKey("menu");var I=babelHelpers.classPrivateFieldLooseKey("initButton");var E=babelHelpers.classPrivateFieldLooseKey("bindEvents");var w=babelHelpers.classPrivateFieldLooseKey("handleFilterBeforeApply");var S=babelHelpers.classPrivateFieldLooseKey("handlePull");var T=babelHelpers.classPrivateFieldLooseKey("update");var _=babelHelpers.classPrivateFieldLooseKey("menuItems");var O=babelHelpers.classPrivateFieldLooseKey("roleName");var k=babelHelpers.classPrivateFieldLooseKey("roleCounter");var j=babelHelpers.classPrivateFieldLooseKey("sendAnalyticsClick");var A=babelHelpers.classPrivateFieldLooseKey("sendAnalyticsApply");var C=babelHelpers.classPrivateFieldLooseKey("getAnalyticsSender");class K{constructor(e){Object.defineProperty(this,C,{value:W});Object.defineProperty(this,A,{value:V});Object.defineProperty(this,j,{value:U});Object.defineProperty(this,k,{get:G,set:void 0});Object.defineProperty(this,O,{get:N,set:void 0});Object.defineProperty(this,_,{get:D,set:void 0});Object.defineProperty(this,T,{value:R});Object.defineProperty(this,E,{value:x});Object.defineProperty(this,I,{value:M});Object.defineProperty(this,L,{writable:true,value:void 0});Object.defineProperty(this,m,{writable:true,value:void 0});Object.defineProperty(this,g,{writable:true,value:void 0});Object.defineProperty(this,H,{writable:true,value:void 0});Object.defineProperty(this,X,{writable:true,value:void 0});Object.defineProperty(this,w,{writable:true,value:e=>{const t=babelHelpers.classPrivateFieldLooseBase(this,L)[L];babelHelpers.classPrivateFieldLooseBase(this,L)[L]=e.getData()[2].getFilterFieldsValues().ROLEID||y;babelHelpers.classPrivateFieldLooseBase(this,T)[T]();if(t!==babelHelpers.classPrivateFieldLooseBase(this,L)[L]){void babelHelpers.classPrivateFieldLooseBase(this,A)[A](babelHelpers.classPrivateFieldLooseBase(this,L)[L])}}});Object.defineProperty(this,S,{writable:true,value:e=>{Object.entries(e[0]).forEach((([e,{total:t}])=>{babelHelpers.classPrivateFieldLooseBase(this,m)[m][e].counter=t}));babelHelpers.classPrivateFieldLooseBase(this,T)[T]()}});if(!e.button){return}babelHelpers.classPrivateFieldLooseBase(this,L)[L]=e.selectedRoleId||y;babelHelpers.classPrivateFieldLooseBase(this,m)[m]={[y]:{title:s.Loc.getMessage("TASKS_ALL_ROLES"),counter:e.totalCounter},...Object.fromEntries(Object.entries(e.items).map((([e,t])=>[e,{title:t.TEXT,counter:Number(t.COUNTER)}])))};babelHelpers.classPrivateFieldLooseBase(this,g)[g]=e.analytics;babelHelpers.classPrivateFieldLooseBase(this,I)[I](e.button);babelHelpers.classPrivateFieldLooseBase(this,E)[E]()}}function M(e){babelHelpers.classPrivateFieldLooseBase(this,X)[X]=new l.Menu({items:babelHelpers.classPrivateFieldLooseBase(this,_)[_],offsetTop:6});babelHelpers.classPrivateFieldLooseBase(this,H)[H]=a.ButtonManager.createFromNode(e);babelHelpers.classPrivateFieldLooseBase(this,H)[H].bindEvent("click",(()=>{babelHelpers.classPrivateFieldLooseBase(this,X)[X].show(babelHelpers.classPrivateFieldLooseBase(this,H)[H].getContainer());void babelHelpers.classPrivateFieldLooseBase(this,j)[j]()}))}function x(){i.EventEmitter.subscribe("BX.Main.Filter:beforeApply",babelHelpers.classPrivateFieldLooseBase(this,w)[w]);r.PULL.subscribe({moduleId:"tasks",command:"user_counter",callback:babelHelpers.classPrivateFieldLooseBase(this,S)[S]})}function R(){babelHelpers.classPrivateFieldLooseBase(this,H)[H].setText(babelHelpers.classPrivateFieldLooseBase(this,O)[O]);babelHelpers.classPrivateFieldLooseBase(this,H)[H].setRightCounter(babelHelpers.classPrivateFieldLooseBase(this,k)[k]?{value:babelHelpers.classPrivateFieldLooseBase(this,k)[k]}:null);babelHelpers.classPrivateFieldLooseBase(this,X)[X].updateItems(babelHelpers.classPrivateFieldLooseBase(this,_)[_])}function D(){const e=Object.values(babelHelpers.classPrivateFieldLooseBase(this,m)[m]).some((({counter:e})=>e>0));return Object.entries(babelHelpers.classPrivateFieldLooseBase(this,m)[m]).map((([t,s])=>({title:s.title,isSelected:t===babelHelpers.classPrivateFieldLooseBase(this,L)[L],onClick:()=>i.EventEmitter.emit("Tasks.TopMenu:onItem",new i.BaseEvent({data:[t],compatData:[t]})),...e?{counter:{value:s.counter}}:{}})))}function N(){return babelHelpers.classPrivateFieldLooseBase(this,m)[m][babelHelpers.classPrivateFieldLooseBase(this,L)[L]].title}function G(){return babelHelpers.classPrivateFieldLooseBase(this,m)[m][y].counter}async function U(){const e=await babelHelpers.classPrivateFieldLooseBase(this,C)[C]();e.sendRoleClick(babelHelpers.classPrivateFieldLooseBase(this,g)[g])}async function V(e){const t=await babelHelpers.classPrivateFieldLooseBase(this,C)[C]();t.sendRoleClickType(babelHelpers.classPrivateFieldLooseBase(this,g)[g],{role:e,isFilterEnabled:e!==y})}async function W(){return(await s.Runtime.loadExtension("tasks.v2.lib.analytics")).analytics}var q=babelHelpers.classPrivateFieldLooseKey("params");var z=babelHelpers.classPrivateFieldLooseKey("initAddButton");var Y=babelHelpers.classPrivateFieldLooseKey("initRoles");var J=babelHelpers.classPrivateFieldLooseKey("showPresetTourGuide");class Q{constructor(e){Object.defineProperty(this,J,{value:ee});Object.defineProperty(this,Y,{value:$});Object.defineProperty(this,z,{value:Z});Object.defineProperty(this,q,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,q)[q]=e;babelHelpers.classPrivateFieldLooseBase(this,z)[z]();babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]();babelHelpers.classPrivateFieldLooseBase(this,J)[J]()}}function Z(){if(!babelHelpers.classPrivateFieldLooseBase(this,q)[q].isV2Form||!babelHelpers.classPrivateFieldLooseBase(this,q)[q].createNode){return}const e=a.ButtonManager.createFromNode(babelHelpers.classPrivateFieldLooseBase(this,q)[q].createNode);e.getMainButton().bindEvent("click",(()=>BX.Tasks.V2.Application.TaskCard.showCompactCard({groupId:babelHelpers.classPrivateFieldLooseBase(this,q)[q].groupId,analytics:babelHelpers.classPrivateFieldLooseBase(this,q)[q].analytics})))}function $(){new K(babelHelpers.classPrivateFieldLooseBase(this,q)[q].roles)}function ee(){if(!babelHelpers.classPrivateFieldLooseBase(this,q)[q].showPresetTourGuide){return}BX.Tasks.Preset.Aha=new BX.Tasks.Preset({filterId:babelHelpers.classPrivateFieldLooseBase(this,q)[q].filterId});BX.Tasks.Preset.Aha.payAttention()}e.Preset=h;e.TasksInterfaceFilter=Q})(this.BX.Tasks=this.BX.Tasks||{},BX.UI.Tour,BX,BX.Event,BX.UI,BX.UI.System,BX);
//# sourceMappingURL=script.map.js