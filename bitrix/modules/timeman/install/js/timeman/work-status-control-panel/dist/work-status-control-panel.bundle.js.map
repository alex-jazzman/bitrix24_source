{"version":3,"file":"work-status-control-panel.bundle.js","sources":["../src/component/app.js","../src/work-status-control-panel.js"],"sourcesContent":["import { Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { BIcon, Outline } from 'ui.icon-set.api.vue';\nimport { Button as UiButton, AirButtonStyle, ButtonSize } from 'ui.vue3.components.button';\n\nimport './app.css';\n\n\n// @vue/component\nexport const App = {\n\tname: 'WorkStatusControlPanel',\n\tcomponents: {\n\t\tUiButton,\n\t\tBIcon,\n\t},\n\tprovide(): Object\n\t{\n\t\treturn {};\n\t},\n\tprops: {},\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tOutline,\n\t\t\tLoc,\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tdataId: '',\n\t\t\tworkStatus: '',\n\t\t\treportReq: '',\n\t\t\tcanOpen: '',\n\t\t\tcanOpenAndRelaunch: '',\n\t\t\tcanEdit: '',\n\t\t\ttimerWorkingDayValue: 0,\n\t\t\ttimerPauseValue: 0,\n\t\t};\n\t},\n\tcomputed: {\n\n\t\ttitleText(): string\n\t\t{\n\t\t\tif (this.workStatus === 'PAUSED')\n\t\t\t{\n\t\t\t\treturn Loc.getMessage('TIMEMAN_WORK_STATUS_CONTROL_PANEL_STATUS_PAUSED');\n\t\t\t}\n\n\t\t\tif (this.workStatus === 'CLOSED')\n\t\t\t{\n\t\t\t\treturn this.canOpen === 'OPEN'\n\t\t\t\t\t? Loc.getMessage('TIMEMAN_WORK_STATUS_CONTROL_PANEL_STATUS_NOT_STARTED')\n\t\t\t\t\t: Loc.getMessage('TIMEMAN_WORK_STATUS_CONTROL_PANEL_STATUS_CLOSED');\n\t\t\t}\n\n\t\t\tif (this.workStatus === 'EXPIRED')\n\t\t\t{\n\t\t\t\treturn Loc.getMessage('TIMEMAN_WORK_STATUS_CONTROL_PANEL_STATUS_NOT_CLOSED');\n\t\t\t}\n\n\t\t\treturn Loc.getMessage('TIMEMAN_WORK_STATUS_CONTROL_PANEL_STATUS_STARTED');\n\t\t},\n\n\t\tisEditingAvailable(): boolean\n\t\t{\n\t\t\treturn (this.dataId && this.canEdit === 'Y' && !(this.workStatus === 'EXPIRED' && this.reportReq !== 'A'));\n\t\t},\n\n\t\tstyleForTimerProps(): string\n\t\t{\n\t\t\tif (this.workStatus === 'PAUSED')\n\t\t\t{\n\t\t\t\treturn {\n\t\t\t\t\ticon: null,\n\t\t\t\t\tstatus: 'paused',\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (this.workStatus === 'EXPIRED')\n\t\t\t{\n\t\t\t\treturn {\n\t\t\t\t\ticon: Outline.ALERT,\n\t\t\t\t\tstatus: 'expired',\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn null;\n\t\t},\n\n\n\t\t// control buttons\n\n\t\tbuttonStartProps(): any\n\t\t{\n\t\t\treturn {\n\t\t\t\ttext: Loc.getMessage('TIMEMAN_WORK_STATUS_CONTROL_PANEL_ACTION_START'),\n\t\t\t\ticon: Outline.PLAY_L,\n\t\t\t\tsize: ButtonSize.LARGE,\n\t\t\t\tonClick: async (): void => {\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\twindow.BXTIMEMAN.WND.ACTIONS.OPEN(event);\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\n\t\tbuttonPauseProps(): any\n\t\t{\n\t\t\treturn {\n\t\t\t\ttext: Loc.getMessage('TIMEMAN_WORK_STATUS_CONTROL_PANEL_ACTION_PAUSE'),\n\t\t\t\ticon: Outline.PAUSE_L,\n\t\t\t\tsize: ButtonSize.LARGE,\n\t\t\t\tstyle: AirButtonStyle.OUTLINE_ACCENT_2,\n\t\t\t\tonClick: async (): void => {\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\twindow.BXTIMEMAN.WND.ACTIONS.PAUSE(event);\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\n\t\tbuttonContinueProps(): any\n\t\t{\n\t\t\treturn {\n\t\t\t\ttext: Loc.getMessage('TIMEMAN_WORK_STATUS_CONTROL_PANEL_ACTION_CONTINUE'),\n\t\t\t\ticon: Outline.PLAY_L,\n\t\t\t\tsize: ButtonSize.LARGE,\n\t\t\t\tonClick: async (): void => {\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\twindow.BXTIMEMAN.WND.ACTIONS.REOPEN(event);\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\n\t\tbuttonStopProps(): any\n\t\t{\n\t\t\treturn {\n\t\t\t\ttext: Loc.getMessage('TIMEMAN_WORK_STATUS_CONTROL_PANEL_ACTION_STOP'),\n\t\t\t\ticon: Outline.CROSS_L,\n\t\t\t\tsize: ButtonSize.LARGE,\n\t\t\t\tstyle: AirButtonStyle.OUTLINE,\n\t\t\t\tonClick: async (): void => {\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\twindow.BXTIMEMAN.WND.ACTIONS.CLOSE(event);\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\n\t\tbuttonRestartProps(): any\n\t\t{\n\t\t\treturn {\n\t\t\t\ttext: Loc.getMessage('TIMEMAN_WORK_STATUS_CONTROL_PANEL_ACTION_RESTART'),\n\t\t\t\ticon: Outline.REFRESH,\n\t\t\t\tsize: ButtonSize.LARGE,\n\t\t\t\tstyle: AirButtonStyle.OUTLINE_ACCENT_2,\n\t\t\t\tonClick: async (): void => {\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\twindow.BXTIMEMAN.WND.ACTIONS.REOPEN(event);\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\n\t\tbuttonFinishExpiredProps(): any\n\t\t{\n\t\t\treturn {\n\t\t\t\ttext: Loc.getMessage('TIMEMAN_WORK_STATUS_CONTROL_PANEL_ACTION_FINISH_EXPIRED'),\n\t\t\t\ticon: Outline.ALERT_ACCENT,\n\t\t\t\tsize: ButtonSize.LARGE,\n\t\t\t\tstyle: AirButtonStyle.TINTED_ALERT,\n\t\t\t\tonClick: async (): void => {\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\twindow.BXTIMEMAN.WND.ACTIONS.CLOSE(event);\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\n\t\t// control buttons end\n\n\t\tactions(): any[]\n\t\t{\n\t\t\tconst actionItems = [];\n\n\t\t\tif (this.workStatus === 'OPENED')\n\t\t\t{\n\t\t\t\tactionItems.push(this.buttonPauseProps);\n\t\t\t\tactionItems.push(this.buttonStopProps);\n\t\t\t}\n\n\t\t\tif (this.workStatus === 'PAUSED')\n\t\t\t{\n\t\t\t\tactionItems.push(this.buttonContinueProps);\n\t\t\t\tactionItems.push(this.buttonStopProps);\n\t\t\t}\n\n\t\t\tif (this.workStatus === 'CLOSED')\n\t\t\t{\n\t\t\t\tif (this.canOpen === 'OPEN')\n\t\t\t\t{\n\t\t\t\t\tactionItems.push(this.buttonStartProps);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tactionItems.push(this.buttonRestartProps);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.workStatus === 'EXPIRED')\n\t\t\t{\n\t\t\t\tactionItems.push(this.buttonFinishExpiredProps);\n\t\t\t}\n\n\t\t\treturn actionItems;\n\t\t},\n\t},\n\twatch: {},\n\tmounted(): void\n\t{\n\t\tthis.updateDayState();\n\t\tthis.updateWorkingDayTimer();\n\t\tsetInterval(() => {\n\t\t\tthis.updateWorkingDayTimer();\n\t\t}, 1000);\n\n\t\tEventEmitter.subscribe('onTimeManDataRecieved', this.handleTimemanDataRecieved);\n\t\tEventEmitter.subscribe('onPlannerDataRecieved', this.handleTimemanDataRecieved);\n\t\tEventEmitter.subscribe('onTimeManNeedRebuild', this.handleTimemanDataRecieved);\n\t\tEventEmitter.subscribe('onTopPanelCollapse', this.handleTimemanDataRecieved);\n\t\tEventEmitter.subscribe('onTimeManWindowBuild', this.handleTimemanDataRecieved);\n\t\tEventEmitter.subscribe('onTimemanInit', this.handleTimemanDataRecieved);\n\t},\n\tbeforeUnmount(): void\n\t{},\n\tunmounted(): void\n\t{},\n\tmethods: {\n\t\tconvertMillisecondsToHrMinSec(time: number): any\n\t\t{\n\t\t\tconst timeFullSeconds = Math.ceil(time / 1000);\n\t\t\tconst hours = Math.floor(timeFullSeconds / 3600);\n\t\t\tconst minutes = Math.floor(timeFullSeconds / 60) - (hours * 60);\n\t\t\tconst seconds = timeFullSeconds - (minutes * 60) - (hours * 3600);\n\n\t\t\treturn {\n\t\t\t\thours,\n\t\t\t\tminutes,\n\t\t\t\tseconds,\n\t\t\t};\n\t\t},\n\n\t\ttimeNumToDoubleDigitString(num): string\n\t\t{\n\t\t\treturn num > 9 ? String(num) : ('00' + num).slice(-2);\n\t\t},\n\n\t\tupdateWorkingDayTimer()\n\t\t{\n\t\t\tconst dateNow = Math.floor(Date.now() / 1000) * 1000;\n\t\t\tconst timerInfo = { ...window.BXTIMEMAN.DATA.INFO };\n\t\t\tconst dateStart = parseInt(timerInfo.DATE_START) * 1000;\n\t\t\tconst dateWorkingDayStopped = parseInt(timerInfo.DATE_FINISH) * 1000;\n\t\t\tconst timeTimeLeaks = parseInt(timerInfo.TIME_LEAKS) * 1000;\n\t\t\tconst delta = dateNow - dateStart;\n\t\t\tconst deltaPast = dateWorkingDayStopped - dateStart;\n\t\t\tconst deltaPause = dateNow - dateWorkingDayStopped;\n\n\t\t\tif (this.workStatus === 'CLOSED')\n\t\t\t{\n\t\t\t\tif (this.canOpen === 'OPEN')\n\t\t\t\t{\n\t\t\t\t\tthis.timerWorkingDayValue = 0;\n\t\t\t\t\tthis.timerPauseValue = 0;\n\t\t\t\t}\n\t\t\t\telse if (this.canOpen === 'REOPEN')\n\t\t\t\t{\n\t\t\t\t\tthis.timerWorkingDayValue = deltaPast - timeTimeLeaks;\n\t\t\t\t\tthis.timerPauseValue = timeTimeLeaks;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (this.workStatus === 'OPENED')\n\t\t\t{\n\t\t\t\tthis.timerWorkingDayValue = delta - timeTimeLeaks;\n\t\t\t\tthis.timerPauseValue = timeTimeLeaks;\n\t\t\t}\n\t\t\telse if (this.workStatus === 'PAUSED')\n\t\t\t{\n\t\t\t\tthis.timerWorkingDayValue = deltaPast - timeTimeLeaks;\n\t\t\t\tthis.timerPauseValue = deltaPause + timeTimeLeaks;\n\t\t\t}\n\t\t\telse if (this.workStatus === 'EXPIRED')\n\t\t\t{\n\t\t\t\tthis.timerWorkingDayValue = delta - timeTimeLeaks;\n\t\t\t\tthis.timerPauseValue = timeTimeLeaks;\n\t\t\t}\n\t\t},\n\n\t\tgetDataId(): any\n\t\t{\n\t\t\treturn window.BXTIMEMAN.DATA.ID || '';\n\t\t},\n\n\t\tgetWorkStatus(): any\n\t\t{\n\t\t\treturn window.BXTIMEMAN.DATA.STATE || '';\n\t\t},\n\n\t\tgetReportReq(): any\n\t\t{\n\t\t\treturn window.BXTIMEMAN.DATA.REPORT_REQ || '';\n\t\t},\n\n\t\tgetCanOpen(): any\n\t\t{\n\t\t\treturn window.BXTIMEMAN.DATA.CAN_OPEN || '';\n\t\t},\n\n\t\tgetCanOpenAndRelaunch(): any\n\t\t{\n\t\t\treturn window.BXTIMEMAN.DATA.CAN_OPEN_AND_RELAUNCH || '';\n\t\t},\n\n\t\tgetCanEdit(): any\n\t\t{\n\t\t\treturn window.BXTIMEMAN.DATA.CAN_EDIT || '';\n\t\t},\n\n\t\tupdateDayState(): any\n\t\t{\n\t\t\tthis.dataId = this.getDataId();\n\t\t\tthis.workStatus = this.getWorkStatus();\n\t\t\tthis.reportReq = this.getReportReq();\n\t\t\tthis.canOpen = this.getCanOpen();\n\t\t\tthis.canOpenAndRelaunch = this.getCanOpenAndRelaunch();\n\t\t\tthis.canEdit = this.getCanEdit();\n\t\t},\n\n\t\t// handlers\n\n\t\thandleTimemanDataRecieved(): any\n\t\t{\n\t\t\tthis.updateDayState();\n\t\t},\n\n\t\thandleClickTimerEditorOpener(): any\n\t\t{\n\t\t\twindow.BXTIMEMAN.WND.ShowEditVue(event.target);\n\t\t},\n\n\t\thandleClickTimemanOpener(): void\n\t\t{\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\n\t\t\twindow.BXTIMEMAN.setBindOptions({\n\t\t\t\tnode: event.target,\n\t\t\t\tmode: 'popup',\n\t\t\t\tpopupOptions: {\n\t\t\t\t\tautoHide: true,\n\t\t\t\t\tangle: false,\n\t\t\t\t\toffsetTop: -40,\n\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\tbindOptions: {\n\t\t\t\t\t\tforceBindPosition: true,\n\t\t\t\t\t\tforceTop: true,\n\t\t\t\t\t\tforceLeft: false,\n\t\t\t\t\t},\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonClose: () => {},\n\t\t\t\t\t\tonDestroy: () => {},\n\t\t\t\t\t},\n\t\t\t\t\tfixed: true,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\twindow.BXTIMEMAN.OpenVue();\n\t\t},\n\n\t\t// handlers end\n\n\t},\n\ttemplate: `\n\t\t<div class=\"tm-control-panel\">\n\t\t\t<div class=\"tm-control-panel__info\">\n\t\t\t\t<div\n\t\t\t\t\t:class=\"[\n\t\t\t\t\t\t'tm-control-panel__timer',\n\t\t\t\t\t\t'tm-timer',\n\t\t\t\t\t\tthis.styleForTimerProps?.status ? ('tm-timer_' + this.styleForTimerProps.status) : null,\n\t\t\t\t\t]\"\n\t\t\t\t>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"this.styleForTimerProps?.icon\"\n\t\t\t\t\t\tclass=\"tm-timer__visual\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<BIcon\n\t\t\t\t\t\t\tclass=\"tm-timer__visual-img\"\n\t\t\t\t\t\t\t:name=\"this.styleForTimerProps.icon\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<p class=\"tm-timer__title\">{{ this.titleText }}</p>\n\t\t\t\t\t<p class=\"tm-timer__value\">\n\t\t\t\t\t\t<span class=\"tm-timer__value-number tm-timer__value-number_hours\">{{\n\t\t\t\t\t\t\t\ttimeNumToDoubleDigitString(convertMillisecondsToHrMinSec(this.timerWorkingDayValue).hours)\n\t\t\t\t\t\t\t}}</span>\n\t\t\t\t\t\t<span class=\"tm-timer__value-number tm-timer__value-number_minutes\">{{\n\t\t\t\t\t\t\t\ttimeNumToDoubleDigitString(convertMillisecondsToHrMinSec(this.timerWorkingDayValue).minutes)\n\t\t\t\t\t\t\t}}</span>\n\t\t\t\t\t\t<span class=\"tm-timer__value-number tm-timer__value-number_seconds\">{{\n\t\t\t\t\t\t\t\ttimeNumToDoubleDigitString(convertMillisecondsToHrMinSec(this.timerWorkingDayValue).seconds)\n\t\t\t\t\t\t\t}}</span>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tv-if=\"isEditingAvailable\"\n\t\t\t\t\t\t\tclass=\"tm-timer__editor-opener\"\n\t\t\t\t\t\t\t@click=\"handleClickTimerEditorOpener\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<BIcon\n\t\t\t\t\t\t\t\tclass=\"tm-timer__editor-opener-img\"\n\t\t\t\t\t\t\t\t:size=\"16\"\n\t\t\t\t\t\t\t\t:name=\"Outline.EDIT_L\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tm-control-panel__widget-opener-container\">\n\t\t\t\t\t<!-- span instead of button is used to collapse element width when text is wrapped on multiple lines -->\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass=\"tm-control-panel__widget-opener\"\n\t\t\t\t\t\t@click=\"this.handleClickTimemanOpener\"\n\t\t\t\t\t>{{ Loc.getMessage('TIMEMAN_WORK_STATUS_CONTROL_PANEL_ACTION_OPEN_PLAN') }}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if=\"Boolean(this.timerPauseValue)\"\n\t\t\t\tclass=\"tm-control-panel__info tm-control-panel__info_pause\"\n\t\t\t>\n\t\t\t\t<div\n\t\t\t\t\t:class=\"[\n\t\t\t\t\t\t'tm-control-panel__timer',\n\t\t\t\t\t\t'tm-control-panel__timer_pause',\n\t\t\t\t\t\t'tm-timer',\n\t\t\t\t\t\tthis.styleForTimerProps?.status ? ('tm-timer_' + this.styleForTimerProps.status) : null,\n\t\t\t\t\t]\"\n\t\t\t\t>\n\t\t\t\t\t<p class=\"tm-timer__title\">{{ Loc.getMessage('TIMEMAN_WORK_STATUS_CONTROL_PANEL_NOTE_PAUSE_LENGTH') }}</p>\n\t\t\t\t\t<p class=\"tm-timer__value\">\n\t\t\t\t\t\t<span class=\"tm-timer__value-number tm-timer__value-number_hours\">{{\n\t\t\t\t\t\t\t\ttimeNumToDoubleDigitString(convertMillisecondsToHrMinSec(this.timerPauseValue).hours)\n\t\t\t\t\t\t\t}}</span>\n\t\t\t\t\t\t<span class=\"tm-timer__value-number tm-timer__value-number_minutes\">{{\n\t\t\t\t\t\t\t\ttimeNumToDoubleDigitString(convertMillisecondsToHrMinSec(this.timerPauseValue).minutes)\n\t\t\t\t\t\t\t}}</span>\n\t\t\t\t\t\t<span class=\"tm-timer__value-number tm-timer__value-number_seconds\">{{\n\t\t\t\t\t\t\t\ttimeNumToDoubleDigitString(convertMillisecondsToHrMinSec(this.timerPauseValue).seconds)\n\t\t\t\t\t\t\t}}</span>\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<ul class=\"tm-control-panel__actions-list\">\n\t\t\t\t<li\n\t\t\t\t\tv-for=\"action in this.actions\"\n\t\t\t\t\t:key=\"action.text\"\n\t\t\t\t\tclass=\"tm-control-panel__actions-item\"\n\t\t\t\t>\n\t\t\t\t\t<UiButton\n\t\t\t\t\t\tclass=\"tm-control-panel__action\"\n\t\t\t\t\t\t:wide=\"true\"\n\t\t\t\t\t\t:size=\"action.size\"\n\t\t\t\t\t\t:left-icon=\"action.icon\"\n\t\t\t\t\t\t:text=\"action.text\"\n\t\t\t\t\t\t:disabled=\"action.isDisabled\"\n\t\t\t\t\t\t:loading=\"action.isLoading\"\n\t\t\t\t\t\t:style=\"action.style || null\"\n\t\t\t\t\t\t@click=\"action.onClick\"\n\t\t\t\t\t/>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>\n\t`,\n};\n","import { Tag, Extension } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { BitrixVue } from 'ui.vue3';\n\nimport 'timeman';\nimport 'CJSTask';\nimport 'planner';\nimport 'tasks_planner_handler';\nimport 'calendar_planner_handler';\nimport 'ajax';\nimport 'timer';\nimport 'popup';\nimport 'ls';\n\nimport { App } from './component/app';\n\nimport './work-status-control-panel.css';\n\ntype Data = {\n\tworkReport: Object,\n\tinfo: Object & {\n\t\tSTATE: string,\n\t\tCAN_OPEN?: string,\n\t\tINFO: Object & {\n\t\t\tDATE_START: number,\n\t\t\tTIME_LEAKS: number,\n\t\t},\n\t},\n\tsiteId: string,\n};\n\nexport class WorkStatusControlPanel\n{\n\t#data: Data = {};\n\t#timemanInstantContainerNode: HTMLElement;\n\n\tconstructor()\n\t{\n\t\tconst settings = Extension.getSettings('timeman.work-status-control-panel');\n\n\t\tthis.#data.workReport = settings.get('workReport');\n\t\tthis.#data.info = settings.get('info');\n\t\tthis.#data.siteId = settings.get('siteId');\n\n\t\tthis.#timemanInstantContainerNode = Tag.render`\n\t\t\t<div class=\"timeman-instant-container\"></div>\n\t\t`;\n\n\t\tEventEmitter.subscribe('onTimemanInit', this.#init.bind(this));\n\t\tEventEmitter.subscribe('onTimeManDataRecieved', this.#updateState.bind(this));\n\n\t\twindow.BX.timeman('bx_tm', this.#data.info, this.#data.siteId);\n\t}\n\n\t#mountApplication(container: HTMLElement): void\n\t{\n\t\tconst application = BitrixVue.createApp(App, {});\n\t\tapplication.mount(container);\n\t}\n\n\t#init(): void\n\t{\n\t\twindow.BXTIMEMAN.initFormWeekly(this.#data.workReport);\n\t}\n\n\t#updateState(baseEvent: BaseEvent): void\n\t{\n\t\tconst [data] = baseEvent.getCompatData();\n\n\t\tthis.#data.info = data;\n\t}\n\n\trenderWorkStatusControlPanel(): HTMLElement\n\t{\n\t\tevent.stopPropagation();\n\n\t\tthis.#mountApplication(this.#timemanInstantContainerNode);\n\n\t\treturn Tag.render`\n\t\t\t${this.#timemanInstantContainerNode}\n\t\t`;\n\t}\n}\n"],"names":["App","name","components","UiButton","BIcon","provide","props","setup","Outline","Loc","data","dataId","workStatus","reportReq","canOpen","canOpenAndRelaunch","canEdit","timerWorkingDayValue","timerPauseValue","computed","titleText","getMessage","isEditingAvailable","styleForTimerProps","icon","status","ALERT","buttonStartProps","text","PLAY_L","size","ButtonSize","LARGE","onClick","event","preventDefault","stopPropagation","window","BXTIMEMAN","WND","ACTIONS","OPEN","buttonPauseProps","PAUSE_L","style","AirButtonStyle","OUTLINE_ACCENT_2","PAUSE","buttonContinueProps","REOPEN","buttonStopProps","CROSS_L","OUTLINE","CLOSE","buttonRestartProps","REFRESH","buttonFinishExpiredProps","ALERT_ACCENT","TINTED_ALERT","actions","actionItems","push","watch","mounted","updateDayState","updateWorkingDayTimer","setInterval","EventEmitter","subscribe","handleTimemanDataRecieved","beforeUnmount","unmounted","methods","convertMillisecondsToHrMinSec","time","timeFullSeconds","Math","ceil","hours","floor","minutes","seconds","timeNumToDoubleDigitString","num","String","slice","dateNow","Date","now","timerInfo","DATA","INFO","dateStart","parseInt","DATE_START","dateWorkingDayStopped","DATE_FINISH","timeTimeLeaks","TIME_LEAKS","delta","deltaPast","deltaPause","getDataId","ID","getWorkStatus","STATE","getReportReq","REPORT_REQ","getCanOpen","CAN_OPEN","getCanOpenAndRelaunch","CAN_OPEN_AND_RELAUNCH","getCanEdit","CAN_EDIT","handleClickTimerEditorOpener","ShowEditVue","target","handleClickTimemanOpener","setBindOptions","node","mode","popupOptions","autoHide","angle","offsetTop","closeByEsc","bindOptions","forceBindPosition","forceTop","forceLeft","events","onClose","onDestroy","fixed","OpenVue","template","WorkStatusControlPanel","constructor","settings","Extension","getSettings","workReport","get","info","siteId","Tag","render","bind","BX","timeman","renderWorkStatusControlPanel","container","application","BitrixVue","createApp","mount","initFormWeekly","baseEvent","getCompatData"],"mappings":"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"}