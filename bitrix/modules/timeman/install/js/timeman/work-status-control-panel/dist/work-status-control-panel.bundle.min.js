this.BX=this.BX||{};(function(t,e,n,i,s,a,o,r,l,u,c,m,p,T,_){"use strict";const d={name:"WorkStatusControlPanel",components:{UiButton:_.Button,BIcon:T.BIcon},provide(){return{}},props:{},setup(){return{Outline:T.Outline,Loc:m.Loc}},data(){return{dataId:"",workStatus:"",reportReq:"",canOpen:"",canOpenAndRelaunch:"",canEdit:"",timerWorkingDayValue:0,timerPauseValue:0}},computed:{titleText(){if(this.workStatus==="PAUSED"){return m.Loc.getMessage("TIMEMAN_WORK_STATUS_CONTROL_PANEL_STATUS_PAUSED")}if(this.workStatus==="CLOSED"){return this.canOpen==="OPEN"?m.Loc.getMessage("TIMEMAN_WORK_STATUS_CONTROL_PANEL_STATUS_NOT_STARTED"):m.Loc.getMessage("TIMEMAN_WORK_STATUS_CONTROL_PANEL_STATUS_CLOSED")}if(this.workStatus==="EXPIRED"){return m.Loc.getMessage("TIMEMAN_WORK_STATUS_CONTROL_PANEL_STATUS_NOT_CLOSED")}return m.Loc.getMessage("TIMEMAN_WORK_STATUS_CONTROL_PANEL_STATUS_STARTED")},isEditingAvailable(){return this.dataId&&this.canEdit==="Y"&&!(this.workStatus==="EXPIRED"&&this.reportReq!=="A")},styleForTimerProps(){if(this.workStatus==="PAUSED"){return{icon:null,status:"paused"}}if(this.workStatus==="EXPIRED"){return{icon:T.Outline.ALERT,status:"expired"}}return null},buttonStartProps(){return{text:m.Loc.getMessage("TIMEMAN_WORK_STATUS_CONTROL_PANEL_ACTION_START"),icon:T.Outline.PLAY_L,size:_.ButtonSize.LARGE,onClick:async()=>{event.preventDefault();event.stopPropagation();window.BXTIMEMAN.WND.ACTIONS.OPEN(event)}}},buttonPauseProps(){return{text:m.Loc.getMessage("TIMEMAN_WORK_STATUS_CONTROL_PANEL_ACTION_PAUSE"),icon:T.Outline.PAUSE_L,size:_.ButtonSize.LARGE,style:_.AirButtonStyle.OUTLINE_ACCENT_2,onClick:async()=>{event.preventDefault();event.stopPropagation();window.BXTIMEMAN.WND.ACTIONS.PAUSE(event)}}},buttonContinueProps(){return{text:m.Loc.getMessage("TIMEMAN_WORK_STATUS_CONTROL_PANEL_ACTION_CONTINUE"),icon:T.Outline.PLAY_L,size:_.ButtonSize.LARGE,onClick:async()=>{event.preventDefault();event.stopPropagation();window.BXTIMEMAN.WND.ACTIONS.REOPEN(event)}}},buttonStopProps(){return{text:m.Loc.getMessage("TIMEMAN_WORK_STATUS_CONTROL_PANEL_ACTION_STOP"),icon:T.Outline.CROSS_L,size:_.ButtonSize.LARGE,style:_.AirButtonStyle.OUTLINE,onClick:async()=>{event.preventDefault();event.stopPropagation();window.BXTIMEMAN.WND.ACTIONS.CLOSE(event)}}},buttonRestartProps(){return{text:m.Loc.getMessage("TIMEMAN_WORK_STATUS_CONTROL_PANEL_ACTION_RESTART"),icon:T.Outline.REFRESH,size:_.ButtonSize.LARGE,style:_.AirButtonStyle.OUTLINE_ACCENT_2,onClick:async()=>{event.preventDefault();event.stopPropagation();window.BXTIMEMAN.WND.ACTIONS.REOPEN(event)}}},buttonFinishExpiredProps(){return{text:m.Loc.getMessage("TIMEMAN_WORK_STATUS_CONTROL_PANEL_ACTION_FINISH_EXPIRED"),icon:T.Outline.ALERT_ACCENT,size:_.ButtonSize.LARGE,style:_.AirButtonStyle.TINTED_ALERT,onClick:async()=>{event.preventDefault();event.stopPropagation();window.BXTIMEMAN.WND.ACTIONS.CLOSE(event)}}},actions(){const t=[];if(this.workStatus==="OPENED"){t.push(this.buttonPauseProps);t.push(this.buttonStopProps)}if(this.workStatus==="PAUSED"){t.push(this.buttonContinueProps);t.push(this.buttonStopProps)}if(this.workStatus==="CLOSED"){if(this.canOpen==="OPEN"){t.push(this.buttonStartProps)}else{t.push(this.buttonRestartProps)}}if(this.workStatus==="EXPIRED"){t.push(this.buttonFinishExpiredProps)}return t}},watch:{},mounted(){this.updateDayState();this.updateWorkingDayTimer();setInterval((()=>{this.updateWorkingDayTimer()}),1e3);p.EventEmitter.subscribe("onTimeManDataRecieved",this.handleTimemanDataRecieved);p.EventEmitter.subscribe("onPlannerDataRecieved",this.handleTimemanDataRecieved);p.EventEmitter.subscribe("onTimeManNeedRebuild",this.handleTimemanDataRecieved);p.EventEmitter.subscribe("onTopPanelCollapse",this.handleTimemanDataRecieved);p.EventEmitter.subscribe("onTimeManWindowBuild",this.handleTimemanDataRecieved);p.EventEmitter.subscribe("onTimemanInit",this.handleTimemanDataRecieved)},beforeUnmount(){},unmounted(){},methods:{convertMillisecondsToHrMinSec(t){const e=Math.ceil(t/1e3);const n=Math.floor(e/3600);const i=Math.floor(e/60)-n*60;const s=e-i*60-n*3600;return{hours:n,minutes:i,seconds:s}},timeNumToDoubleDigitString(t){return t>9?String(t):("00"+t).slice(-2)},updateWorkingDayTimer(){const t=Math.floor(Date.now()/1e3)*1e3;const e={...window.BXTIMEMAN.DATA.INFO};const n=parseInt(e.DATE_START)*1e3;const i=parseInt(e.DATE_FINISH)*1e3;const s=parseInt(e.TIME_LEAKS)*1e3;const a=t-n;const o=i-n;const r=t-i;if(this.workStatus==="CLOSED"){if(this.canOpen==="OPEN"){this.timerWorkingDayValue=0;this.timerPauseValue=0}else if(this.canOpen==="REOPEN"){this.timerWorkingDayValue=o-s;this.timerPauseValue=s}}else if(this.workStatus==="OPENED"){this.timerWorkingDayValue=a-s;this.timerPauseValue=s}else if(this.workStatus==="PAUSED"){this.timerWorkingDayValue=o-s;this.timerPauseValue=r+s}else if(this.workStatus==="EXPIRED"){this.timerWorkingDayValue=a-s;this.timerPauseValue=s}},getDataId(){return window.BXTIMEMAN.DATA.ID||""},getWorkStatus(){return window.BXTIMEMAN.DATA.STATE||""},getReportReq(){return window.BXTIMEMAN.DATA.REPORT_REQ||""},getCanOpen(){return window.BXTIMEMAN.DATA.CAN_OPEN||""},getCanOpenAndRelaunch(){return window.BXTIMEMAN.DATA.CAN_OPEN_AND_RELAUNCH||""},getCanEdit(){return window.BXTIMEMAN.DATA.CAN_EDIT||""},updateDayState(){this.dataId=this.getDataId();this.workStatus=this.getWorkStatus();this.reportReq=this.getReportReq();this.canOpen=this.getCanOpen();this.canOpenAndRelaunch=this.getCanOpenAndRelaunch();this.canEdit=this.getCanEdit()},handleTimemanDataRecieved(){this.updateDayState()},handleClickTimerEditorOpener(){window.BXTIMEMAN.WND.ShowEditVue(event.target)},handleClickTimemanOpener(){event.preventDefault();event.stopPropagation();window.BXTIMEMAN.setBindOptions({node:event.target,mode:"popup",popupOptions:{autoHide:true,angle:false,offsetTop:-40,closeByEsc:true,bindOptions:{forceBindPosition:true,forceTop:true,forceLeft:false},events:{onClose:()=>{},onDestroy:()=>{}},fixed:true}});window.BXTIMEMAN.OpenVue()}},template:`\n\t\t<div class="tm-control-panel">\n\t\t\t<div class="tm-control-panel__info">\n\t\t\t\t<div\n\t\t\t\t\t:class="[\n\t\t\t\t\t\t'tm-control-panel__timer',\n\t\t\t\t\t\t'tm-timer',\n\t\t\t\t\t\tthis.styleForTimerProps?.status ? ('tm-timer_' + this.styleForTimerProps.status) : null,\n\t\t\t\t\t]"\n\t\t\t\t>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="this.styleForTimerProps?.icon"\n\t\t\t\t\t\tclass="tm-timer__visual"\n\t\t\t\t\t>\n\t\t\t\t\t\t<BIcon\n\t\t\t\t\t\t\tclass="tm-timer__visual-img"\n\t\t\t\t\t\t\t:name="this.styleForTimerProps.icon"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<p class="tm-timer__title">{{ this.titleText }}</p>\n\t\t\t\t\t<p class="tm-timer__value">\n\t\t\t\t\t\t<span class="tm-timer__value-number tm-timer__value-number_hours">{{\n\t\t\t\t\t\t\t\ttimeNumToDoubleDigitString(convertMillisecondsToHrMinSec(this.timerWorkingDayValue).hours)\n\t\t\t\t\t\t\t}}</span>\n\t\t\t\t\t\t<span class="tm-timer__value-number tm-timer__value-number_minutes">{{\n\t\t\t\t\t\t\t\ttimeNumToDoubleDigitString(convertMillisecondsToHrMinSec(this.timerWorkingDayValue).minutes)\n\t\t\t\t\t\t\t}}</span>\n\t\t\t\t\t\t<span class="tm-timer__value-number tm-timer__value-number_seconds">{{\n\t\t\t\t\t\t\t\ttimeNumToDoubleDigitString(convertMillisecondsToHrMinSec(this.timerWorkingDayValue).seconds)\n\t\t\t\t\t\t\t}}</span>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tv-if="isEditingAvailable"\n\t\t\t\t\t\t\tclass="tm-timer__editor-opener"\n\t\t\t\t\t\t\t@click="handleClickTimerEditorOpener"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<BIcon\n\t\t\t\t\t\t\t\tclass="tm-timer__editor-opener-img"\n\t\t\t\t\t\t\t\t:size="16"\n\t\t\t\t\t\t\t\t:name="Outline.EDIT_L"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t\t<div class="tm-control-panel__widget-opener-container">\n\t\t\t\t\t\x3c!-- span instead of button is used to collapse element width when text is wrapped on multiple lines --\x3e\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass="tm-control-panel__widget-opener"\n\t\t\t\t\t\t@click="this.handleClickTimemanOpener"\n\t\t\t\t\t>{{ Loc.getMessage('TIMEMAN_WORK_STATUS_CONTROL_PANEL_ACTION_OPEN_PLAN') }}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if="Boolean(this.timerPauseValue)"\n\t\t\t\tclass="tm-control-panel__info tm-control-panel__info_pause"\n\t\t\t>\n\t\t\t\t<div\n\t\t\t\t\t:class="[\n\t\t\t\t\t\t'tm-control-panel__timer',\n\t\t\t\t\t\t'tm-control-panel__timer_pause',\n\t\t\t\t\t\t'tm-timer',\n\t\t\t\t\t\tthis.styleForTimerProps?.status ? ('tm-timer_' + this.styleForTimerProps.status) : null,\n\t\t\t\t\t]"\n\t\t\t\t>\n\t\t\t\t\t<p class="tm-timer__title">{{ Loc.getMessage('TIMEMAN_WORK_STATUS_CONTROL_PANEL_NOTE_PAUSE_LENGTH') }}</p>\n\t\t\t\t\t<p class="tm-timer__value">\n\t\t\t\t\t\t<span class="tm-timer__value-number tm-timer__value-number_hours">{{\n\t\t\t\t\t\t\t\ttimeNumToDoubleDigitString(convertMillisecondsToHrMinSec(this.timerPauseValue).hours)\n\t\t\t\t\t\t\t}}</span>\n\t\t\t\t\t\t<span class="tm-timer__value-number tm-timer__value-number_minutes">{{\n\t\t\t\t\t\t\t\ttimeNumToDoubleDigitString(convertMillisecondsToHrMinSec(this.timerPauseValue).minutes)\n\t\t\t\t\t\t\t}}</span>\n\t\t\t\t\t\t<span class="tm-timer__value-number tm-timer__value-number_seconds">{{\n\t\t\t\t\t\t\t\ttimeNumToDoubleDigitString(convertMillisecondsToHrMinSec(this.timerPauseValue).seconds)\n\t\t\t\t\t\t\t}}</span>\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<ul class="tm-control-panel__actions-list">\n\t\t\t\t<li\n\t\t\t\t\tv-for="action in this.actions"\n\t\t\t\t\t:key="action.text"\n\t\t\t\t\tclass="tm-control-panel__actions-item"\n\t\t\t\t>\n\t\t\t\t\t<UiButton\n\t\t\t\t\t\tclass="tm-control-panel__action"\n\t\t\t\t\t\t:wide="true"\n\t\t\t\t\t\t:size="action.size"\n\t\t\t\t\t\t:left-icon="action.icon"\n\t\t\t\t\t\t:text="action.text"\n\t\t\t\t\t\t:disabled="action.isDisabled"\n\t\t\t\t\t\t:loading="action.isLoading"\n\t\t\t\t\t\t:style="action.style || null"\n\t\t\t\t\t\t@click="action.onClick"\n\t\t\t\t\t/>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>\n\t`};let E=t=>t,A,h;var S=babelHelpers.classPrivateFieldLooseKey("data");var v=babelHelpers.classPrivateFieldLooseKey("timemanInstantContainerNode");var N=babelHelpers.classPrivateFieldLooseKey("mountApplication");var O=babelHelpers.classPrivateFieldLooseKey("init");var P=babelHelpers.classPrivateFieldLooseKey("updateState");class b{constructor(){Object.defineProperty(this,P,{value:g});Object.defineProperty(this,O,{value:D});Object.defineProperty(this,N,{value:M});Object.defineProperty(this,S,{writable:true,value:{}});Object.defineProperty(this,v,{writable:true,value:void 0});const t=m.Extension.getSettings("timeman.work-status-control-panel");babelHelpers.classPrivateFieldLooseBase(this,S)[S].workReport=t.get("workReport");babelHelpers.classPrivateFieldLooseBase(this,S)[S].info=t.get("info");babelHelpers.classPrivateFieldLooseBase(this,S)[S].siteId=t.get("siteId");babelHelpers.classPrivateFieldLooseBase(this,v)[v]=m.Tag.render(A||(A=E`
			<div class="timeman-instant-container"></div>
		`));p.EventEmitter.subscribe("onTimemanInit",babelHelpers.classPrivateFieldLooseBase(this,O)[O].bind(this));p.EventEmitter.subscribe("onTimeManDataRecieved",babelHelpers.classPrivateFieldLooseBase(this,P)[P].bind(this));window.BX.timeman("bx_tm",babelHelpers.classPrivateFieldLooseBase(this,S)[S].info,babelHelpers.classPrivateFieldLooseBase(this,S)[S].siteId)}renderWorkStatusControlPanel(){event.stopPropagation();babelHelpers.classPrivateFieldLooseBase(this,N)[N](babelHelpers.classPrivateFieldLooseBase(this,v)[v]);return m.Tag.render(h||(h=E`
			${0}
		`),babelHelpers.classPrivateFieldLooseBase(this,v)[v])}}function M(t){const n=e.BitrixVue.createApp(d,{});n.mount(t)}function D(){window.BXTIMEMAN.initFormWeekly(babelHelpers.classPrivateFieldLooseBase(this,S)[S].workReport)}function g(t){const[e]=t.getCompatData();babelHelpers.classPrivateFieldLooseBase(this,S)[S].info=e}t.WorkStatusControlPanel=b})(this.BX.Timeman=this.BX.Timeman||{},BX.Vue3,BX,BX,BX,BX,BX,BX,BX,BX,BX,BX,BX.Event,BX.UI.IconSet,BX.Vue3.Components);
//# sourceMappingURL=work-status-control-panel.bundle.map.js