this.BX=this.BX||{};this.BX.Sign=this.BX.Sign||{};(function(e,s,t,l,i,a,o,r,n,c,d,b,p,v,u,h,P,g,L,F,_,B,y,f){"use strict";let H=e=>e,m;class E extends y.EventEmitter{constructor(e){super();this.data={};this.events={onChange:"onChange",onColorStyleChange:"onColorStyleChange"};this.setEventNamespace("BX.Sign.V2.Editor.Blocks.Dummy");this.block=e}isSingleton(){return false}isStyleAllowed(){return true}setData(e){this.data=e?e:{}}setText(e){this.setData({text:e})}getInitDimension(){return{width:250,height:28}}getData(){return this.data}getActionButton(){return null}getBlockCaption(){return null}getViewContent(){return _.Tag.render(m||(m=H`
			<div>
				${0}
			</div>
		`),_.Text.encode(this.data.text||"").toString().replaceAll("[br]","<br>"))}onStartChangePosition(){}onPlaced(){}onSave(){}onRemove(){}onClickOut(){this.block.forceSave()}onChange(){this.emit(this.events.onChange)}getStyles(){return{}}changeStyleColor(e){}}E.defaultTextBlockPaddingStyles={padding:"5px 8px"};let S=e=>e,C;var T=babelHelpers.classPrivateFieldLooseKey("calendar");var O=babelHelpers.classPrivateFieldLooseKey("calendarOpened");var I=babelHelpers.classPrivateFieldLooseKey("date");var R=babelHelpers.classPrivateFieldLooseKey("closeCalendar");class M extends E{constructor(...e){super(...e);Object.defineProperty(this,R,{value:D});Object.defineProperty(this,T,{writable:true,value:void 0});Object.defineProperty(this,O,{writable:true,value:false});Object.defineProperty(this,I,{writable:true,value:void 0})}getInitDimension(){return{width:105,height:28}}setData(e){this.data=e?e:{};babelHelpers.classPrivateFieldLooseBase(this,I)[I]=this.data.text}onActionClick(){babelHelpers.classPrivateFieldLooseBase(this,T)[T]=BX.calendar({node:this.block.getLayout(),field:this.getViewContent(),value:babelHelpers.classPrivateFieldLooseBase(this,I)[I],bTime:false,callback_after:e=>{this.setText(BX.date.format(BX.date.convertBitrixFormat(BX.message("FORMAT_DATE")),e,null));this.block.renderView()}});babelHelpers.classPrivateFieldLooseBase(this,O)[O]=true;const e=document.querySelector(".sign-editor__content");const{popup:s}=babelHelpers.classPrivateFieldLooseBase(this,T)[T];s.targetContainer=e;if(s.popupContainer.parentElement!==e){_.Dom.append(s.popupContainer,e);s.adjustPosition()}}getActionButton(){return _.Tag.render(C||(C=S`
			<div class="sign-document__block-style-btn --funnel">
				<button onclick="${0}" data-role="action">
					${0}
				</button>
			</div>
		`),this.onActionClick.bind(this),_.Loc.getMessage("SIGN_JS_DOCUMENT_DATE_ACTION_BUTTON"))}onStartChangePosition(){babelHelpers.classPrivateFieldLooseBase(this,R)[R]()}onSave(){babelHelpers.classPrivateFieldLooseBase(this,R)[R]()}onRemove(){babelHelpers.classPrivateFieldLooseBase(this,R)[R]()}onClickOut(){if(!babelHelpers.classPrivateFieldLooseBase(this,O)[O]){this.block.forceSave()}babelHelpers.classPrivateFieldLooseBase(this,O)[O]=false}getStyles(){return{...super.getStyles(),...M.defaultTextBlockPaddingStyles}}}function D(){if(babelHelpers.classPrivateFieldLooseBase(this,T)[T]){babelHelpers.classPrivateFieldLooseBase(this,T)[T].Close();babelHelpers.classPrivateFieldLooseBase(this,O)[O]=false}}let N=e=>e,k;var w=babelHelpers.classPrivateFieldLooseKey("cache");var K=babelHelpers.classPrivateFieldLooseKey("onActionClick");var A=babelHelpers.classPrivateFieldLooseKey("getFieldsNameBlackList");var j=babelHelpers.classPrivateFieldLooseKey("getCreateFieldTypeNamesBlackList");var x=babelHelpers.classPrivateFieldLooseKey("filterRequisiteCreateFields");var G=babelHelpers.classPrivateFieldLooseKey("getFieldsetViewer");var $=babelHelpers.classPrivateFieldLooseKey("onFieldsetViewerFieldsetLoadError");class U extends E{constructor(...e){super(...e);Object.defineProperty(this,$,{value:J});Object.defineProperty(this,G,{value:q});Object.defineProperty(this,x,{value:X});Object.defineProperty(this,j,{value:V});Object.defineProperty(this,A,{value:Y});Object.defineProperty(this,K,{value:z});Object.defineProperty(this,w,{writable:true,value:new _.Cache.MemoryCache})}isSingleton(){return true}getInitDimension(){return{width:250,height:220}}getActionButton(){return _.Tag.render(k||(k=N`
			<div class="sign-document__block-style-btn --funnel">
				<button onclick="${0}" data-role="action" data-id="action-${0}">
					${0}
				</button>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,K)[K].bind(this),this.block.getCode(),_.Loc.getMessage("SIGN_JS_DOCUMENT_REQUISITES_ACTION_BUTTON"))}getStyles(){return{...super.getStyles(),...U.defaultTextBlockPaddingStyles}}}function z(e){e.stopPropagation();babelHelpers.classPrivateFieldLooseBase(this,G)[G]().show()}function Y(){return["ADDRESS","REG_ADDRESS"]}function V(){return new Set(["file","employee","boolean","money"])}function X(e){return e.filter((e=>!babelHelpers.classPrivateFieldLooseBase(this,j)[j]().has(e.name)))}function q(){return babelHelpers.classPrivateFieldLooseBase(this,w)[w].remember("fieldSetViewer",(()=>{var e;const s=this.block.blocksManager;const t=s.getMemberByPart(this.block.getMemberPart());const{entityTypeId:l,presetId:i,entityId:a}=t;const o=(e=t.cid)!=null?e:a;const r=new u.FieldsetViewer({entityTypeId:l,entityId:o,documentUid:s.getDocumentUid(),events:{onClose:()=>{this.block.assign();babelHelpers.classPrivateFieldLooseBase(this,w)[w].delete("fieldSetViewer")}},fieldListEditorOptions:{fieldsPanelOptions:{filter:{"+categories":["COMPANY"],"+fields":["list","string","date","typed_string","text","datetime","enumeration","address","url","double","integer"],"-fields":[({entity_field_name:e})=>babelHelpers.classPrivateFieldLooseBase(this,A)[A]().includes(e)]},fieldsFactory:{filter:babelHelpers.classPrivateFieldLooseBase(this,x)[x].bind(this)},presetId:i,controllerOptions:{hideVirtual:1,hideRequisites:0,hideSmartDocument:1,presetId:i}}},popupOptions:{overlay:true,cacheable:false}}).setEndpoint("sign.api_v1.Integration.Crm.FieldSet.load");r.subscribe("onFieldSetLoadError",babelHelpers.classPrivateFieldLooseBase(this,$)[$].bind(this));return r}))}function J(e){babelHelpers.classPrivateFieldLooseBase(this,G)[G]().hide();const s=e.getData().requestErrors.some((e=>e.code==="ACCESS_DENIED"));if(s){b.UI.Notification.Center.notify({content:_.Text.encode(_.Loc.getMessage("SIGN_EDITOR_ERROR_REQUISITE_BLOCK_REQUISITE_ACCESS_DENIED")),autoHideDelay:3e3,width:480})}}let Q=e=>e,W,Z,ee,se,te,le,ie,ae,oe;const re=_.Reflection.getClass("BX.ColorPicker");class ne{static setRect(e,s){Object.keys(s).map((e=>{s[e]=parseInt(s[e])+"px"}));_.Dom.style(e,s)}static getBlockLayout(e){return _.Tag.render(W||(W=Q`
			<div class="sign-document__block-wrapper">
				<div class="sign-document__block-panel--wrapper" data-role="sign-block__actions">
				</div>
				<div class="sign-document__block-content">
				</div>
				<div class="sign-document__block-actions">
					<div class="sign-document__block-actions--wrapper">
						<button class="sign-document__block-actions-btn --remove sign-block-action-remove" data-role="removeAction" onclick="${0}"></button>
						<button class="sign-document__block-actions-btn --save sign-block-action-save" data-role="saveAction" onclick="${0}"></button>
					</div>
				</div>
			</div>
		`),e.onRemove,e.onSave)}static getMemberSelector(e,s,t){const l={};let i=_.Loc.getMessage("SIGN_JS_DOCUMENT_MEMBER_NAME_NOT_SET");e.map((e=>{e.name=e.name||_.Loc.getMessage("SIGN_JS_DOCUMENT_MEMBER_NAME_NOT_SET");l[e.part]=e.name;if(e.part===s){i=e.name}}));const a=e.length>1?_.Tag.render(Z||(Z=Q`<span>${0}</span>`),_.Text.encode(i)):_.Tag.render(ee||(ee=Q`<i>${0}</i>`),_.Text.encode(i));if(e.length>1){g.UI.bindSimpleMenu({bindElement:a,items:l,actionHandler:e=>{a.innerHTML=l[e];t(parseInt(e))}})}return _.Tag.render(se||(se=Q`
			<div class="sign-document-block-member-wrapper">
				${0}
			</div>
		`),a)}static getResizeArea(){return _.Tag.render(te||(te=Q`
			<div class="sign-document__resize-area">
				<div class="sign-area-resizable-controls">
					<span class="sign-document__move-control"></span>
					<div class="sign-document__resize-control --middle-top"></div>
					<div class="sign-document__resize-control --right-top"></div>
					<div class="sign-document__resize-control --middle-right"></div>
					<div class="sign-document__resize-control --right-bottom"></div>
					<div class="sign-document__resize-control --middle-bottom"></div>
					<div class="sign-document__resize-control --left-bottom"></div>
					<div class="sign-document__resize-control --middle-left"></div>
				</div>
			</div>
		`))}static getStylePanel(e,s){var t;const l={'"Times New Roman", Times':"<span style=\"font-family: 'Times New Roman', Times\">Times New Roman</span>",'"Courier New"':"<span style=\"font-family: 'Courier New'\">Courier New</span>","Arial, Helvetica":'<span style="font-family: Arial, Helvetica">Arial / Helvetica</span>','"Arial Black", Gadget':"<span style=\"font-family: 'Arial Black', Gadget\">Arial Black</span>","Tahoma, Geneva":'<span style="font-family: Tahoma, Geneva">Tahoma / Geneva</span>',Verdana:'<span style="font-family: Verdana">Verdana</span>',"Georgia, serif":'<span style="font-family: Georgia, serif">Georgia</span>',monospace:'<span style="font-family: monospace">monospace</span>'};const i=_.Tag.render(le||(le=Q`<div class="sign-document__block-style-btn --btn-font-family">${0}</div>`),l[s["font-family"]]||"Font");g.UI.bindSimpleMenu({bindElement:i,items:l,actionHandler:s=>{i.innerHTML=l[s];e("family",s)}});let a=parseInt(s["font-size"]);let o=14;if(a){o=a}const r=_.Tag.render(ie||(ie=Q`<div class="sign-document__block-style-btn --btn-fontsize">${0}</div>`),o+"px"||"<i></i>");g.UI.bindSimpleMenu({bindElement:r,items:["6px","7px","8px","9px","10px","11px","12px","13px","14px","15px","16px","18px","20px","22px","24px","26px","28px","36px","48px","72px"],actionHandler:s=>{r.innerHTML=parseInt(s)+"px";e("size",s)},currentValue:o});const{layout:n}=ne.getColorSelectorBtn((t=s.color)!=null?t:"#000",(s=>e("color",s)));return _.Tag.render(ae||(ae=Q`
			<div class="sign-document__block-style--panel">
<!--				<div class="sign-document__block-style&#45;&#45;move-control"></div>-->
				${0}
				${0}
				${0}
				<div class="sign-document__block-style--separator"></div>
				<div class="sign-document__block-style-btn --btn-bold" data-action="bold"><i></i></div>
				<div class="sign-document__block-style-btn --btn-italic" data-action="italic"><i></i></div>
				<div class="sign-document__block-style-btn --btn-underline" data-action="underline"><i></i></div>
				<div class="sign-document__block-style-btn --btn-strike" data-action="through"><i></i></div>
				<div class="sign-document__block-style-btn --btn-align-left" data-action="left"><i></i></div>
				<div class="sign-document__block-style-btn --btn-align-center" data-action="center"><i></i></div>
				<div class="sign-document__block-style-btn --btn-align-right" data-action="right"><i></i></div>
				<div class="sign-document__block-style-btn --btn-align-justify" data-action="justify"><i></i></div>
			</div>
		`),i,r,n)}static getColorSelectorBtn(e,s,t={}){const l=_.Tag.render(oe||(oe=Q`<div class="sign-document__block-style-btn --btn-color">
				<span class="sign-document__block-style-btn--color-block"></span> 
				<span>${0}</span>
			</div>`),_.Loc.getMessage("SIGN_JS_DOCUMENT_STYLE_COLOR"));ne.updateColorSelectorBtnColor(l,e);const i={...t,bindElement:l,onColorSelected:e=>{s(e);ne.updateColorSelectorBtnColor(l,e)}};const a=new re(i);_.Event.bind(l,"click",(()=>{a.open()}));return{layout:l,colorPicker:a}}static updateColorSelectorBtnColor(e,s){const t=e.querySelector(".sign-document__block-style-btn--color-block");if(_.Type.isNil(t)){return}_.Dom.style(t,"background-color",s)}}let ce=e=>e,de,be,pe;var ve=babelHelpers.classPrivateFieldLooseKey("cache");var ue=babelHelpers.classPrivateFieldLooseKey("defaultSignatureColor");var he=babelHelpers.classPrivateFieldLooseKey("availableSignatureColors");var Pe=babelHelpers.classPrivateFieldLooseKey("selectedSignatureColor");var ge=babelHelpers.classPrivateFieldLooseKey("getSignatureColor");var Le=babelHelpers.classPrivateFieldLooseKey("closeColorPickerPopup");var Fe=babelHelpers.classPrivateFieldLooseKey("getColorSelectorBtn");class _e extends E{constructor(...e){super(...e);Object.defineProperty(this,Fe,{value:fe});Object.defineProperty(this,Le,{value:ye});Object.defineProperty(this,ge,{value:Be});Object.defineProperty(this,ve,{writable:true,value:new _.Cache.MemoryCache});Object.defineProperty(this,ue,{writable:true,value:"#0047ab"});Object.defineProperty(this,he,{writable:true,value:["#000",babelHelpers.classPrivateFieldLooseBase(this,ue)[ue],"#8b00ff"]});Object.defineProperty(this,Pe,{writable:true,value:null})}isSingleton(){return true}isStyleAllowed(){return false}getInitDimension(){return{width:200,height:70}}getViewContent(){const{width:e,height:s}=this.block.getPosition();let t=null;if(this.dataSrc){t=this.dataSrc}else if(this.data.base64){t="data:image;base64,"+this.data.base64}if(t){return _.Tag.render(de||(de=ce`
				<img src="${0}" alt="">
			`),t)}else{return _.Tag.render(be||(be=ce`
				<div class="sign-document__block-content_member-nodata">
					${0}
				</div>
			`),_.Text.encode(this.data.text||this.getPlaceholderLabel()))}}getPlaceholderLabel(){return _.Loc.getMessage("SIGN_JS_DOCUMENT_MEMBER_NO_DATA_MY_SIGN")}onClickOut(){super.onClickOut();babelHelpers.classPrivateFieldLooseBase(this,Le)[Le]()}onRemove(){super.onRemove();babelHelpers.classPrivateFieldLooseBase(this,Le)[Le]()}onSave(){super.onSave();babelHelpers.classPrivateFieldLooseBase(this,Le)[Le]()}getStyles(){return{backgroundPosition:"center !important",color:babelHelpers.classPrivateFieldLooseBase(this,ge)[ge]()}}changeStyleColor(e,s=true){super.changeStyleColor(e);babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]=e;const{layout:t,colorPicker:l}=babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe]();ne.updateColorSelectorBtnColor(t,e);l.setSelectedColor(e);if(s){this.emit(this.events.onColorStyleChange)}}getBlockCaption(){const{layout:e}=babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe]();return _.Tag.render(pe||(pe=ce`
			<div style="display: flex; flex-direction: row;">
			${0}
			<div class="sign-document__block-style--separator"></div>
			<div class="sign-document-block-member-wrapper">
				<i>${0}</i>
			</div>
			</div>
		`),e,_.Loc.getMessage("SIGN_JS_DOCUMENT_SIGN_ACTION_BUTTON"))}}function Be(){var e;return(e=babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe])!=null?e:babelHelpers.classPrivateFieldLooseBase(this,ue)[ue]}function ye(){const{colorPicker:e}=babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe]();e.close()}function fe(){return babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].remember("colorSelectorBtn",(()=>{var e,s;return ne.getColorSelectorBtn((e=babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe])!=null?e:babelHelpers.classPrivateFieldLooseBase(this,ue)[ue],(e=>this.changeStyleColor(e)),{colors:[babelHelpers.classPrivateFieldLooseBase(this,he)[he]],allowCustomColor:false,selectedColor:(s=babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe])!=null?s:babelHelpers.classPrivateFieldLooseBase(this,ue)[ue],colorPreview:false})}))}let He=e=>e,me,Ee,Se;var Ce=babelHelpers.classPrivateFieldLooseKey("uploader");var Te=babelHelpers.classPrivateFieldLooseKey("api");var Oe=babelHelpers.classPrivateFieldLooseKey("onActionClick");var Ie=babelHelpers.classPrivateFieldLooseKey("saveStamp");class Re extends E{constructor(e){super(e);Object.defineProperty(this,Ie,{value:De});Object.defineProperty(this,Oe,{value:Me});Object.defineProperty(this,Ce,{writable:true,value:void 0});Object.defineProperty(this,Te,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce]=new p.Uploader({controller:{upload:"sign.upload.stampUploadController"},contact:{id:0,label:"Admin"}});babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce].subscribe("onSaveAsync",(async e=>{var s;Re.currentBlock.await(true);const t=e.getData();if(!(t!=null&&(s=t.file)!=null&&s.serverId)){return}this.dataSrc=t.file.serverPreviewUrl;babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie](Re.currentBlock,t.file.serverId)}));babelHelpers.classPrivateFieldLooseBase(this,Te)[Te]=new f.Api}isSingleton(){return true}isStyleAllowed(){return false}getInitDimension(){return{width:151,height:151}}getActionButton(){var e;const s=(e=this.data.__view)!=null&&e.base64?_.Loc.getMessage("SIGN_EDITOR_BLOCK_CHANGE_STAMP"):_.Loc.getMessage("SIGN_EDITOR_BLOCK_LOAD_STAMP");return _.Tag.render(me||(me=He`
			<div class="sign-document__block-style-btn --funnel">
				<button onclick="${0}" data-role="action">
					${0}
				</button>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe].bind(this),s)}getViewContent(){var e;let s=null;if((e=this.data.__view)!=null&&e.base64){s="data:image;base64,"+this.data.__view.base64}if(s){return _.Tag.render(Ee||(Ee=He`
				<div class="sign-document__block-content_stamp" style="background-image: url(${0})"></div>
			`),s)}else{return _.Tag.render(Se||(Se=He`
				<div class="sign-document__block-content_member-nodata --stamp"></div>
			`))}}}function Me(e){Re.currentBlock=this.block;babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce].show()}async function De(e,s){const t=e.getMemberPart();const l=e.blocksManager.getMemberByPart(t);await babelHelpers.classPrivateFieldLooseBase(this,Te)[Te].saveStamp(l.uid,s);e.assign();const i=Re.currentBlock.getLayout();const a=i.querySelector('button[data-role="action"]');a.textContent=_.Loc.getMessage("SIGN_EDITOR_BLOCK_CHANGE_STAMP")}let Ne=e=>e,ke,we;var Ke=babelHelpers.classPrivateFieldLooseKey("onActionClick");class Ae extends E{constructor(...e){super(...e);Object.defineProperty(this,Ke,{value:je})}isSingleton(){return true}getInitDimension(){return{width:100,height:28}}getActionButton(){return _.Tag.render(ke||(ke=Ne`
			<div class="sign-document__block-style-btn --funnel">
				<button onclick="${0}" data-role="action">
					${0}
				</button>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke].bind(this),_.Loc.getMessage("SIGN_JS_DOCUMENT_NUMBER_ACTION_EDIT"))}getViewContent(){return _.Tag.render(we||(we=Ne`
			<div class="sign-document__block-number">
				${0}
			</div>
		`),_.Text.encode(this.data.text||"").toString())}getStyles(){return{...super.getStyles(),...Ae.defaultTextBlockPaddingStyles}}}function je(e){e.stopPropagation();if(!Ae.sliderOnMessageBind){Ae.sliderOnMessageBind=true;BX.addCustomEvent(window,"SidePanel.Slider:onMessage",(async e=>{var s;const t=((s=e.slider)==null?void 0:s.url)==="editor";if(t&&e.getEventId()==="numerator-saved-event"){var l,i,a,o;const s=e.getData();const t=(l=e==null?void 0:(i=e.sender)==null?void 0:(a=i.options)==null?void 0:(o=a.data)==null?void 0:o.block)!=null?l:this.block;if(s.type==="CRM_SMART_DOCUMENT"){t.await(true);const e=new f.Api;const s=t.blocksManager.getDocumentUid();await e.refreshEntityNumber(s);t.assign()}}}))}const{crmNumeratorUrl:s}=this.data.__view;BX.SidePanel.Instance.open(s,{width:480,cacheable:false,data:{block:this.block}})}Ae.sliderOnMessageBind=false;let xe=e=>e,Ge,$e,Ue;var ze=babelHelpers.classPrivateFieldLooseKey("cache");var Ye=babelHelpers.classPrivateFieldLooseKey("field");var Ve=babelHelpers.classPrivateFieldLooseKey("actionButton");var Xe=babelHelpers.classPrivateFieldLooseKey("onActionClick");var qe=babelHelpers.classPrivateFieldLooseKey("setActionButtonLabel");var Je=babelHelpers.classPrivateFieldLooseKey("getCrmFieldSelectorPanel");var Qe=babelHelpers.classPrivateFieldLooseKey("onCrmFieldSelectorSliderCloseComplete");var We=babelHelpers.classPrivateFieldLooseKey("emitOnFieldSelectEvent");var Ze=babelHelpers.classPrivateFieldLooseKey("getCrmFieldsNameBlackList");var es=babelHelpers.classPrivateFieldLooseKey("getCreateFieldTypeNamesBlackList");var ss=babelHelpers.classPrivateFieldLooseKey("filterRequisiteCreateFields");class ts extends E{constructor(...e){super(...e);Object.defineProperty(this,ss,{value:ds});Object.defineProperty(this,es,{value:cs});Object.defineProperty(this,Ze,{value:ns});Object.defineProperty(this,We,{value:rs});Object.defineProperty(this,Qe,{value:os});Object.defineProperty(this,Je,{value:as});Object.defineProperty(this,qe,{value:is});Object.defineProperty(this,Xe,{value:ls});Object.defineProperty(this,ze,{writable:true,value:new _.Cache.MemoryCache});Object.defineProperty(this,Ye,{writable:true,value:void 0});Object.defineProperty(this,Ve,{writable:true,value:void 0})}setData(e){var s;this.data=e?e:{};babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]=(s=this.data.field)!=null?s:""}onPlaced(){babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe]()}getActionButton(){if(_.Type.isUndefined(v.Selector)){return null}babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve]=_.Tag.render(Ge||(Ge=xe`
			<div class="sign-document__block-style-btn --funnel">
				<button onclick="${0}" data-role="action">
				</button>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].bind(this));babelHelpers.classPrivateFieldLooseBase(this,qe)[qe]();return babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve]}getViewContent(){babelHelpers.classPrivateFieldLooseBase(this,qe)[qe]();const{width:e,height:s}=this.block.getPosition();if(this.data.src){return _.Tag.render($e||($e=xe`
				<div style="width: ${0}px; height: ${0}px; background: url(${0}) no-repeat top; background-size: cover;">
				</div>
			`),e-14,s-14,this.data.src)}const t=this.data.text?"":"sign-document__block-content_member-nodata";return _.Tag.render(Ue||(Ue=xe`
			<div class="${0}">
				${0}
			</div>
		`),t,_.Text.encode(this.data.text||_.Loc.getMessage("SIGN_JS_DOCUMENT_MEMBER_NO_DATA")))}getStyles(){return{...super.getStyles(),...ts.defaultTextBlockPaddingStyles}}}function ls(){babelHelpers.classPrivateFieldLooseBase(this,Je)[Je]().show().then((e=>{const s=[...e];if(e.length===0&&_.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye])){s.push(babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye])}babelHelpers.classPrivateFieldLooseBase(this,We)[We](s);if(e.length===0){return}_.Dom.removeClass(this.block.getLayout(),"--invalid");babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]=e[0];this.setData({field:babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]});setTimeout((()=>{this.block.assign()}),0)}))}function is(){var e,s,t,l,i;if(!babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve]){return}const a=babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve].querySelector("button");const o=_.Loc.getMessage("SIGN_JS_DOCUMENT_REFERENCE_ACTION_BUTTON");if(!babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]){a.textContent=o;return}const r=(e=babelHelpers.classPrivateFieldLooseBase(this,ze)[ze].get("fieldSelector"))!=null?e:babelHelpers.classPrivateFieldLooseBase(this,Je)[Je]();const n=r.getFieldsList();const c=[...(s=n==null?void 0:(t=n.CONTACT)==null?void 0:t.FIELDS)!=null?s:[],...(l=n==null?void 0:(i=n.SMART_DOCUMENT)==null?void 0:i.FIELDS)!=null?l:[]];const d=c.find((e=>e.name===babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]));const b=d?d.caption:o;a.textContent=b}function as(){const e=this.block.blocksManager;const s=e.getMemberByPart(this.block.getMemberPart());const{presetId:t}=s;return babelHelpers.classPrivateFieldLooseBase(this,ze)[ze].remember("fieldSelector",(()=>{const e=new v.Selector({multiple:false,controllerOptions:{hideVirtual:1,hideRequisites:0,hideSmartDocument:1,presetId:t},presetId:t,filter:{"+categories":["CONTACT","SMART_DOCUMENT"],"+fields":["list","string","date","typed_string","text","datetime","enumeration","address","url","double","integer"],"-fields":[({entity_field_name:e})=>babelHelpers.classPrivateFieldLooseBase(this,Ze)[Ze]().has(e)]},fieldsFactory:{filter:babelHelpers.classPrivateFieldLooseBase(this,ss)[ss].bind(this)}});e.subscribe("onSliderCloseComplete",babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].bind(this));return e}))}function os(){setTimeout((()=>{if(_.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye])){return}babelHelpers.classPrivateFieldLooseBase(this,We)[We]([])}))}function rs(e){const s={selectedFieldNames:e};const t=new y.BaseEvent({data:s});this.emit("onFieldSelect",t)}function ns(){return new Set(["ADDRESS","REG_ADDRESS"])}function cs(){return new Set(["file","employee","boolean","money"])}function ds(e){return e.filter((e=>!babelHelpers.classPrivateFieldLooseBase(this,es)[es]().has(e.name)))}let bs=e=>e,ps,vs,us;var hs=babelHelpers.classPrivateFieldLooseKey("field");var Ps=babelHelpers.classPrivateFieldLooseKey("actionButton");var gs=babelHelpers.classPrivateFieldLooseKey("cache");var Ls=babelHelpers.classPrivateFieldLooseKey("onActionClick");var Fs=babelHelpers.classPrivateFieldLooseKey("setActionButtonLabel");var _s=babelHelpers.classPrivateFieldLooseKey("getCrmFieldSelectorPanel");var Bs=babelHelpers.classPrivateFieldLooseKey("onCrmFieldSelectorSliderCloseComplete");var ys=babelHelpers.classPrivateFieldLooseKey("getFieldNegativeFilter");var fs=babelHelpers.classPrivateFieldLooseKey("getFieldsNameBlackList");var Hs=babelHelpers.classPrivateFieldLooseKey("emitOnFieldSelectEvent");var ms=babelHelpers.classPrivateFieldLooseKey("getCrmFieldsNameBlackList");var Es=babelHelpers.classPrivateFieldLooseKey("getCreateFieldTypeNamesBlackList");var Ss=babelHelpers.classPrivateFieldLooseKey("filterRequisiteCreateFields");class Cs extends E{constructor(...e){super(...e);Object.defineProperty(this,Ss,{value:Ks});Object.defineProperty(this,Es,{value:ws});Object.defineProperty(this,ms,{value:ks});Object.defineProperty(this,Hs,{value:Ns});Object.defineProperty(this,fs,{value:Ds});Object.defineProperty(this,ys,{value:Ms});Object.defineProperty(this,Bs,{value:Rs});Object.defineProperty(this,_s,{value:Is});Object.defineProperty(this,Fs,{value:Os});Object.defineProperty(this,Ls,{value:Ts});Object.defineProperty(this,hs,{writable:true,value:void 0});Object.defineProperty(this,Ps,{writable:true,value:void 0});Object.defineProperty(this,gs,{writable:true,value:new _.Cache.MemoryCache})}setData(e){var s;this.data=e?e:{};babelHelpers.classPrivateFieldLooseBase(this,hs)[hs]=(s=this.data.field)!=null?s:""}onPlaced(){babelHelpers.classPrivateFieldLooseBase(this,Ls)[Ls]()}getActionButton(){if(_.Type.isUndefined(v.Selector)){return null}babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps]=_.Tag.render(ps||(ps=bs`
			<div class="sign-document__block-style-btn --funnel">
				<button onclick="${0}" data-role="action">
				</button>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,Ls)[Ls].bind(this));babelHelpers.classPrivateFieldLooseBase(this,Fs)[Fs]();return babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps]}getViewContent(){babelHelpers.classPrivateFieldLooseBase(this,Fs)[Fs]();const{width:e,height:s}=this.block.getPosition();if(this.data.src){return _.Tag.render(vs||(vs=bs`
				<div style="width: ${0}px; height: ${0}px; background: url(${0}) no-repeat top; background-size: cover;">
				</div>
			`),e-14,s-14,this.data.src)}const t=!this.data.text?"sign-document__block-content_member-nodata":"";return _.Tag.render(us||(us=bs`
				<div class="${0}">
					${0}
				</div>
			`),t,_.Text.encode(this.data.text||_.Loc.getMessage("SIGN_JS_DOCUMENT_MEMBER_NO_DATA_MY_BLOCKS")))}getStyles(){return{...super.getStyles(),...Cs.defaultTextBlockPaddingStyles}}}function Ts(){babelHelpers.classPrivateFieldLooseBase(this,_s)[_s]().show().then((e=>{const s=[...e];if(e.length===0&&_.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,hs)[hs])){s.push(babelHelpers.classPrivateFieldLooseBase(this,hs)[hs])}babelHelpers.classPrivateFieldLooseBase(this,Hs)[Hs](s);if(e.length===0){return}_.Dom.removeClass(this.block.getLayout(),"--invalid");babelHelpers.classPrivateFieldLooseBase(this,hs)[hs]=e[0];this.setData({field:babelHelpers.classPrivateFieldLooseBase(this,hs)[hs]});setTimeout((()=>{this.block.assign()}),0)}))}function Os(){var e,s,t,l;if(!babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps]){return}const i=babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].querySelector("button");const a=_.Loc.getMessage("SIGN_JS_DOCUMENT_REFERENCE_ACTION_BUTTON");if(!babelHelpers.classPrivateFieldLooseBase(this,hs)[hs]){i.textContent=a;return}const o=babelHelpers.classPrivateFieldLooseBase(this,_s)[_s]();const r=o.getFieldsList();const n=[...(e=r==null?void 0:(s=r.COMPANY)==null?void 0:s.FIELDS)!=null?e:[],...(t=r==null?void 0:(l=r.SMART_DOCUMENT)==null?void 0:l.FIELDS)!=null?t:[]];const c=n.find((e=>e.name===babelHelpers.classPrivateFieldLooseBase(this,hs)[hs]));const d=c?c.caption:a;i.textContent=d}function Is(){const e=this.block.blocksManager;const s=e.getMemberByPart(this.block.getMemberPart());const{presetId:t}=s;return babelHelpers.classPrivateFieldLooseBase(this,gs)[gs].remember("fieldSelector",(()=>{const e=new v.Selector({multiple:false,controllerOptions:{hideVirtual:1,hideRequisites:0,hideSmartDocument:1,presetId:t},presetId:t,filter:{"+categories":["COMPANY","SMART_DOCUMENT"],"+fields":["list","string","date","typed_string","text","datetime","enumeration","address","url","double","integer"],"-fields":[babelHelpers.classPrivateFieldLooseBase(this,ys)[ys](),({entity_field_name:e})=>babelHelpers.classPrivateFieldLooseBase(this,ms)[ms]().has(e)]},fieldsFactory:{filter:babelHelpers.classPrivateFieldLooseBase(this,Ss)[Ss].bind(this)}});e.subscribe("onSliderCloseComplete",babelHelpers.classPrivateFieldLooseBase(this,Bs)[Bs].bind(this));return e}))}function Rs(){setTimeout((()=>{if(_.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,hs)[hs])){return}babelHelpers.classPrivateFieldLooseBase(this,Hs)[Hs]([])}))}function Ms(){const e=babelHelpers.classPrivateFieldLooseBase(this,fs)[fs]();return s=>e.includes(s.name)}function Ds(){return["COMPANY_LINK","COMPANY_REG_ADDRESS","COMPANY_ORIGIN_VERSION"]}function Ns(e){const s={selectedFieldNames:e};const t=new y.BaseEvent({data:s});this.emit("onFieldSelect",t)}function ks(){return new Set(["ADDRESS","REG_ADDRESS"])}function ws(){return new Set(["file","employee","boolean","money"])}function Ks(e){return e.filter((e=>!babelHelpers.classPrivateFieldLooseBase(this,Es)[Es]().has(e.name)))}let As=e=>e,js,xs;var Gs=babelHelpers.classPrivateFieldLooseKey("onActionClick");var $s=babelHelpers.classPrivateFieldLooseKey("getCrmFieldsNameBlackList");var Us=babelHelpers.classPrivateFieldLooseKey("getCreateFieldTypeNamesBlackList");var zs=babelHelpers.classPrivateFieldLooseKey("filterRequisiteCreateFields");class Ys extends E{constructor(...e){super(...e);Object.defineProperty(this,zs,{value:Js});Object.defineProperty(this,Us,{value:qs});Object.defineProperty(this,$s,{value:Xs});Object.defineProperty(this,Gs,{value:Vs})}isSingleton(){return true}getInitDimension(){return{width:250,height:220}}getActionButton(){return _.Tag.render(js||(js=As`
			<div class="sign-document__block-style-btn --funnel">
				<button onclick="${0}" data-role="action" data-id="action-${0}">
					${0}
				</button>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,Gs)[Gs].bind(this),this.block.getCode(),_.Loc.getMessage("SIGN_JS_DOCUMENT_REQUISITES_ACTION_BUTTON"))}getViewContent(){const e=this.data.text||_.Loc.getMessage("SIGN_JS_DOCUMENT_MEMBER_NO_DATA_REQUISITES");const s=this.data.text?"":' class="sign-document__block-content_member-nodata"';return _.Tag.render(xs||(xs=As`
			<div${0}>
				${0}
			</div>
		`),s,_.Text.encode(e).toString().replaceAll("[br]","<br>"))}getStyles(){return{...super.getStyles(),...Ys.defaultTextBlockPaddingStyles}}}function Vs(e){const s=this.block.blocksManager;const t=s.getMemberByPart(this.block.getMemberPart());e.stopPropagation();if(!t){return}const{cid:l,entityTypeId:i,presetId:a}=t;new u.FieldsetViewer({entityTypeId:i,entityId:l,documentUid:s.getDocumentUid(),events:{onClose:()=>{this.block.assign()}},fieldListEditorOptions:{fieldsPanelOptions:{filter:{"+categories":["CONTACT"],"+fields":["list","string","date","typed_string","text","datetime","enumeration","address","url","double","integer"],"-fields":[({entity_field_name:e})=>babelHelpers.classPrivateFieldLooseBase(this,$s)[$s]().has(e)]},fieldsFactory:{filter:babelHelpers.classPrivateFieldLooseBase(this,zs)[zs].bind(this)},presetId:a,controllerOptions:{hideVirtual:1,hideRequisites:0,hideSmartDocument:1,presetId:a}}},popupOptions:{overlay:true,cacheable:false}}).setEndpoint("sign.api_v1.Integration.Crm.FieldSet.load").show()}function Xs(){return new Set(["ADDRESS","REG_ADDRESS"])}function qs(){return new Set(["file","employee","boolean","money"])}function Js(e){return e.filter((e=>!babelHelpers.classPrivateFieldLooseBase(this,Us)[Us]().has(e.name)))}let Qs=e=>e,Ws,Zs;class et extends E{isStyleAllowed(){return false}getInitDimension(){return{width:151,height:151}}getPlaceholderLabel(){return _.Loc.getMessage("SIGN_JS_DOCUMENT_MEMBER_NO_DATA_STAMP")}getViewContent(){const{width:e,height:s}=this.block.getPosition();if(this.data.base64){return _.Tag.render(Ws||(Ws=Qs`
				<div class="sign-document__block-content_stamp" style="background-image: url(${0})"></div>
			`),src)}else{return _.Tag.render(Zs||(Zs=Qs`
				<div class="sign-document__block-content_member-nodata">
					
				</div>
			`))}}}let st=e=>e,tt,lt;var it=babelHelpers.classPrivateFieldLooseKey("cache");var at=babelHelpers.classPrivateFieldLooseKey("defaultSignatureColor");var ot=babelHelpers.classPrivateFieldLooseKey("availableSignatureColors");var rt=babelHelpers.classPrivateFieldLooseKey("selectedSignatureColor");var nt=babelHelpers.classPrivateFieldLooseKey("getColorSelectorBtn");var ct=babelHelpers.classPrivateFieldLooseKey("getSignatureColor");var dt=babelHelpers.classPrivateFieldLooseKey("closeColorPickerPopup");class bt extends et{constructor(...e){super(...e);Object.defineProperty(this,dt,{value:ut});Object.defineProperty(this,ct,{value:vt});Object.defineProperty(this,nt,{value:pt});Object.defineProperty(this,it,{writable:true,value:new _.Cache.MemoryCache});Object.defineProperty(this,at,{writable:true,value:"#0047ab"});Object.defineProperty(this,ot,{writable:true,value:["#000",babelHelpers.classPrivateFieldLooseBase(this,at)[at],"#8b00ff"]});Object.defineProperty(this,rt,{writable:true,value:null})}getPlaceholderLabel(){return _.Loc.getMessage("SIGN_JS_DOCUMENT_MEMBER_NO_DATA_SIGN")}getInitDimension(){return{width:200,height:70}}getBlockCaption(){const{layout:e}=babelHelpers.classPrivateFieldLooseBase(this,nt)[nt]();return _.Tag.render(tt||(tt=st`
			<div style="display: flex; flex-direction: row;">
			${0}
			<div class="sign-document__block-style--separator"></div>
			</div>
		`),e)}getViewContent(){return _.Tag.render(lt||(lt=st`
			<div class="sign-document__block-content_member-nodata">
				${0}
			</div>
		`),_.Text.encode(this.getPlaceholderLabel()))}getStyles(){return{backgroundPosition:"center !important",color:babelHelpers.classPrivateFieldLooseBase(this,ct)[ct]()}}updateColor(e){super.updateColor(e);const{layout:s,colorPicker:t}=babelHelpers.classPrivateFieldLooseBase(this,nt)[nt]();babelHelpers.classPrivateFieldLooseBase(this,rt)[rt]=e;ne.updateColorSelectorBtnColor(s,e);t.setSelectedColor(e)}changeStyleColor(e,s=true){super.changeStyleColor(e);babelHelpers.classPrivateFieldLooseBase(this,rt)[rt]=e;const{layout:t,colorPicker:l}=babelHelpers.classPrivateFieldLooseBase(this,nt)[nt]();ne.updateColorSelectorBtnColor(t,e);l.setSelectedColor(e);if(s){this.emit(this.events.onColorStyleChange)}}onSave(){super.onSave();babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]()}onRemove(){super.onRemove();babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]()}onClickOut(){super.onClickOut();babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]()}}function pt(){return babelHelpers.classPrivateFieldLooseBase(this,it)[it].remember("colorSelectorBtn",(()=>{var e,s;return ne.getColorSelectorBtn((e=babelHelpers.classPrivateFieldLooseBase(this,rt)[rt])!=null?e:babelHelpers.classPrivateFieldLooseBase(this,at)[at],(e=>this.changeStyleColor(e)),{colors:[babelHelpers.classPrivateFieldLooseBase(this,ot)[ot]],allowCustomColor:false,selectedColor:(s=babelHelpers.classPrivateFieldLooseBase(this,rt)[rt])!=null?s:babelHelpers.classPrivateFieldLooseBase(this,at)[at],colorPreview:false})}))}function vt(){var e;return(e=babelHelpers.classPrivateFieldLooseBase(this,rt)[rt])!=null?e:babelHelpers.classPrivateFieldLooseBase(this,at)[at]}function ut(){const{colorPicker:e}=babelHelpers.classPrivateFieldLooseBase(this,nt)[nt]();e.close()}let ht=e=>e,Pt;var gt=babelHelpers.classPrivateFieldLooseKey("textContainer");var Lt=babelHelpers.classPrivateFieldLooseKey("onKeyUp");var Ft=babelHelpers.classPrivateFieldLooseKey("onPaste");class _t extends E{constructor(e){super(e);Object.defineProperty(this,Ft,{value:yt});Object.defineProperty(this,Lt,{value:Bt});Object.defineProperty(this,gt,{writable:true,value:void 0});this.setEventNamespace("BX.Sign.V2.Blocks.Text")}onActionClick(){babelHelpers.classPrivateFieldLooseBase(this,gt)[gt].contentEditable=true;babelHelpers.classPrivateFieldLooseBase(this,gt)[gt].focus()}getText(){return this.data.text}getContainer(){return babelHelpers.classPrivateFieldLooseBase(this,gt)[gt]}getViewContent(){const e=this.data.text===_.Loc.getMessage("SIGN_JS_DOCUMENT_TEXT_PLACEHOLDER")?"":this.data.text;babelHelpers.classPrivateFieldLooseBase(this,gt)[gt]=_.Tag.render(Pt||(Pt=ht`
			<div class="sign-document-block-text" placeholder="${0}">
				${0}
			</div>
		`),_.Loc.getMessage("SIGN_JS_DOCUMENT_TEXT_PLACEHOLDER"),_.Text.encode(e).replaceAll("[br]","<br>"));_.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,gt)[gt],"keyup",babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt].bind(this));_.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,gt)[gt],"paste",(e=>setTimeout(babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft].bind(this,e))));return babelHelpers.classPrivateFieldLooseBase(this,gt)[gt]}getStyles(){return{...super.getStyles(),..._t.defaultTextBlockPaddingStyles}}}function Bt(e){this.setText(babelHelpers.classPrivateFieldLooseBase(this,gt)[gt].innerText.replaceAll("\n","[br]"));this.onChange()}function yt(e){babelHelpers.classPrivateFieldLooseBase(this,gt)[gt].innerHTML=babelHelpers.classPrivateFieldLooseBase(this,gt)[gt].innerText.replaceAll("\n","<br>");const s=document.createRange();s.selectNodeContents(babelHelpers.classPrivateFieldLooseBase(this,gt)[gt]);s.collapse(false);const t=document.getSelection();t.removeAllRanges();t.addRange(s);this.setText(babelHelpers.classPrivateFieldLooseBase(this,gt)[gt].innerHTML.replaceAll("<br>","[br]"));this.onChange()}let ft=e=>e,Ht,mt,Et;var St=babelHelpers.classPrivateFieldLooseKey("cache");var Ct=babelHelpers.classPrivateFieldLooseKey("field");var Tt=babelHelpers.classPrivateFieldLooseKey("actionButton");var Ot=babelHelpers.classPrivateFieldLooseKey("content");var It=babelHelpers.classPrivateFieldLooseKey("loadFieldsPromise");var Rt=babelHelpers.classPrivateFieldLooseKey("setContentText");var Mt=babelHelpers.classPrivateFieldLooseKey("loadFieldAndCategoryCaption");var Dt=babelHelpers.classPrivateFieldLooseKey("setActionButtonLabel");var Nt=babelHelpers.classPrivateFieldLooseKey("getFieldSelectorPanel");var kt=babelHelpers.classPrivateFieldLooseKey("getFieldsNameBlackList");var wt=babelHelpers.classPrivateFieldLooseKey("onActionClick");var Kt=babelHelpers.classPrivateFieldLooseKey("emitOnFieldSelectEvent");var At=babelHelpers.classPrivateFieldLooseKey("onFieldSelectorCloseComplete");var jt=babelHelpers.classPrivateFieldLooseKey("updateFieldsList");var xt=babelHelpers.classPrivateFieldLooseKey("getSelectorFieldTypes");var Gt=babelHelpers.classPrivateFieldLooseKey("getSelectorFieldsFactory");class $t extends E{constructor(...e){super(...e);Object.defineProperty(this,Gt,{value:el});Object.defineProperty(this,xt,{value:Zt});Object.defineProperty(this,At,{value:Qt});Object.defineProperty(this,Kt,{value:Jt});Object.defineProperty(this,wt,{value:qt});Object.defineProperty(this,kt,{value:Xt});Object.defineProperty(this,Nt,{value:Vt});Object.defineProperty(this,Dt,{value:Yt});Object.defineProperty(this,Mt,{value:zt});Object.defineProperty(this,Rt,{value:Ut});Object.defineProperty(this,St,{writable:true,value:new _.Cache.MemoryCache});Object.defineProperty(this,Ct,{writable:true,value:void 0});Object.defineProperty(this,Tt,{writable:true,value:void 0});Object.defineProperty(this,Ot,{writable:true,value:void 0})}setData(e){var s;this.data=e?e:{};babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct]=(s=this.data.field)!=null?s:""}getViewContent(){var e;babelHelpers.classPrivateFieldLooseBase(this,Dt)[Dt]();if(_.Type.isStringFilled((e=this.data)==null?void 0:e.text)){babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot]=_.Tag.render(Ht||(Ht=ft`
				<div class="sign-document__block-b2e-reference">
					${0}
				</div>
			`),_.Text.encode(this.data.text||"").toString())}else{babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot]=_.Tag.render(mt||(mt=ft`
				<div class="sign-document__block-content_member-nodata">
					${0}
				</div>
			`),_.Loc.getMessage("SIGN_EDITOR_BLOCKS_EMPLOYEE_B2E"))}if(_.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct])){babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt]().then((({categoryCaption:e,fieldCaption:s})=>{var t;babelHelpers.classPrivateFieldLooseBase(this,Dt)[Dt](s);if(!_.Type.isStringFilled((t=this.data)==null?void 0:t.text)){babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt](_.Type.isStringFilled(e)&&_.Type.isStringFilled(s)?_.Loc.getMessage("SIGN_EDITOR_BLOCK_B2E_REFERENCE_NO_DATA_CONTENT_TEMPLATE",{"#CATEGORY#":e,"#FIELD#":s}):_.Loc.getMessage("SIGN_EDITOR_BLOCKS_EMPLOYEE_B2E"));const t=this.block.getLayout();const l=t.querySelector(".--b2ereference");this.block.resizeText({element:l,step:.5})}})).catch((e=>{console.error(e)}))}return babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot]}onPlaced(){babelHelpers.classPrivateFieldLooseBase(this,wt)[wt]()}getActionButton(){babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt]=_.Tag.render(Et||(Et=ft`
			<div class="sign-document__block-style-btn --funnel">
				<button onclick="${0}" data-role="action" data-id="action-${0}">
				</button>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,wt)[wt].bind(this),this.block.getCode());babelHelpers.classPrivateFieldLooseBase(this,Dt)[Dt]();return babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt]}getStyles(){return{...super.getStyles(),...$t.defaultTextBlockPaddingStyles}}}function Ut(e){const s=_.Type.isStringFilled(e)?e:_.Loc.getMessage("SIGN_EDITOR_BLOCK_B2E_REFERENCE_MSG_VER_1");babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].textContent=s;babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].title=s}function zt(){if(!_.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct])){return Promise.resolve({categoryCaption:"",fieldCaption:_.Loc.getMessage("SIGN_EDITOR_BLOCK_B2E_REFERENCE_MSG_VER_1")})}const e=_.Loc.getMessage("SIGN_EDITOR_BLOCK_B2E_REFERENCE_MSG_VER_1");if(babelHelpers.classPrivateFieldLooseBase($t,It)[It]===null){babelHelpers.classPrivateFieldLooseBase($t,It)[It]=P.FieldSelector.loadFieldList({})}return babelHelpers.classPrivateFieldLooseBase($t,It)[It].then((s=>{var t,l;const i=[...(t=s==null?void 0:(l=s.PROFILE)==null?void 0:l.FIELDS)!=null?t:[]];const a=i.find((e=>e.name===babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct]));return{categoryCaption:_.Loc.getMessage("SIGN_EDITOR_BLOCKS_EMPLOYEE_B2E"),fieldCaption:a?a.caption:e}}))}function Yt(e){if(!babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt]){return}const s=babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt].querySelector("button");s.textContent=_.Type.isStringFilled(e)?e:_.Loc.getMessage("SIGN_EDITOR_BLOCK_B2E_REFERENCE_MSG_VER_1")}function Vt(){const e=this.block.blocksManager;return babelHelpers.classPrivateFieldLooseBase(this,St)[St].remember("fieldSelector",(()=>{const s=new P.FieldSelector({multiple:false,controllerOptions:{hideVirtual:1,hideRequisites:1,hideSmartB2eDocument:1},languages:e.getLanguages(),filter:{"+categories":["PROFILE"],"+fields":babelHelpers.classPrivateFieldLooseBase(this,xt)[xt](),"-fields":[({entity_field_name:e})=>babelHelpers.classPrivateFieldLooseBase(this,kt)[kt]().has(e)]},title:_.Loc.getMessage("SIGN_EDITOR_BLOCK_B2E_REFERENCE_MSG_VER_1"),categoryCaptions:{PROFILE:_.Loc.getMessage("SIGN_EDITOR_BLOCKS_EMPLOYEE_B2E")},fieldsFactory:babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt]()});s.subscribe("onSliderCloseComplete",(e=>babelHelpers.classPrivateFieldLooseBase(this,At)[At](e)));return s}))}function Xt(){return new Set(["ADDRESS","REG_ADDRESS"])}function qt(){const e=babelHelpers.classPrivateFieldLooseBase(this,Nt)[Nt]();e.show().then((s=>{babelHelpers.classPrivateFieldLooseBase($t,jt)[jt](e.getFieldsList(false));const t=[...s];if(s.length===0&&_.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct])){t.push(babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct])}babelHelpers.classPrivateFieldLooseBase(this,Kt)[Kt](t);if(s.length===0){return}_.Dom.removeClass(this.block.getLayout(),"--invalid");babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct]=s[0];this.setData({field:babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct]});setTimeout((()=>{this.block.assign()}),0)}))}function Jt(e){const s={selectedFieldNames:e};const t=new y.BaseEvent({data:s});this.emit("onFieldSelect",t)}function Qt(e){setTimeout((()=>{if(_.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct])){return}babelHelpers.classPrivateFieldLooseBase(this,Kt)[Kt]([])}))}function Wt(e){babelHelpers.classPrivateFieldLooseBase($t,It)[It]=Promise.resolve(e)}function Zt(){const e=["list","string","date","typed_string","text","datetime","enumeration","url","double","integer","snils"];if(!this.block.blocksManager.isTemplateMode){e.push("address")}return e}function el(){if(this.block.blocksManager.isTemplateMode){return{filter:e=>e.filter((e=>_.Type.isObject(e)&&_.Type.isStringFilled(e.name)&&["list","string","date","enumeration"].includes(e.name)))}}return null}Object.defineProperty($t,jt,{value:Wt});Object.defineProperty($t,It,{writable:true,value:null});let sl=e=>e,tl,ll,il;var al=babelHelpers.classPrivateFieldLooseKey("cache");var ol=babelHelpers.classPrivateFieldLooseKey("field");var rl=babelHelpers.classPrivateFieldLooseKey("actionButton");var nl=babelHelpers.classPrivateFieldLooseKey("content");var cl=babelHelpers.classPrivateFieldLooseKey("loadFieldsPromise");var dl=babelHelpers.classPrivateFieldLooseKey("setActionButtonLabel");var bl=babelHelpers.classPrivateFieldLooseKey("getFieldSelectorPanel");var pl=babelHelpers.classPrivateFieldLooseKey("getFieldsNameBlackList");var vl=babelHelpers.classPrivateFieldLooseKey("getCrmFieldsNameBlackList");var ul=babelHelpers.classPrivateFieldLooseKey("getFieldNegativeFilter");var hl=babelHelpers.classPrivateFieldLooseKey("onActionClick");var Pl=babelHelpers.classPrivateFieldLooseKey("emitOnFieldSelectEvent");var gl=babelHelpers.classPrivateFieldLooseKey("onFieldSelectorCloseComplete");var Ll=babelHelpers.classPrivateFieldLooseKey("loadFieldAndCategoryCaption");var Fl=babelHelpers.classPrivateFieldLooseKey("setContentText");var _l=babelHelpers.classPrivateFieldLooseKey("updateFieldsList");class Bl extends E{constructor(...e){super(...e);Object.defineProperty(this,Fl,{value:Il});Object.defineProperty(this,Ll,{value:Ol});Object.defineProperty(this,gl,{value:Tl});Object.defineProperty(this,Pl,{value:Cl});Object.defineProperty(this,hl,{value:Sl});Object.defineProperty(this,ul,{value:El});Object.defineProperty(this,vl,{value:ml});Object.defineProperty(this,pl,{value:Hl});Object.defineProperty(this,bl,{value:fl});Object.defineProperty(this,dl,{value:yl});Object.defineProperty(this,al,{writable:true,value:new _.Cache.MemoryCache});Object.defineProperty(this,ol,{writable:true,value:void 0});Object.defineProperty(this,rl,{writable:true,value:void 0});Object.defineProperty(this,nl,{writable:true,value:void 0})}setData(e){var s;this.data=e?e:{};babelHelpers.classPrivateFieldLooseBase(this,ol)[ol]=(s=this.data.field)!=null?s:""}getViewContent(){var e;babelHelpers.classPrivateFieldLooseBase(this,dl)[dl]();if(_.Type.isStringFilled((e=this.data)==null?void 0:e.text)){babelHelpers.classPrivateFieldLooseBase(this,nl)[nl]=_.Tag.render(tl||(tl=sl`
				<div class="sign-document__block-b2e-reference">
					${0}
				</div>
			`),_.Text.encode(this.data.text||"").toString())}else{babelHelpers.classPrivateFieldLooseBase(this,nl)[nl]=_.Tag.render(ll||(ll=sl`
				<div class="sign-document__block-content_member-nodata">
					${0}
				</div>
			`),_.Loc.getMessage("SIGN_EDITOR_BLOCK_MY_B2E_REFERENCE_MSG_VER_1"))}if(_.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,ol)[ol])){babelHelpers.classPrivateFieldLooseBase(this,Ll)[Ll]().then((({categoryCaption:e,fieldCaption:s})=>{var t;babelHelpers.classPrivateFieldLooseBase(this,dl)[dl](s);if(!_.Type.isStringFilled((t=this.data)==null?void 0:t.text)){babelHelpers.classPrivateFieldLooseBase(this,Fl)[Fl](_.Type.isStringFilled(e)&&_.Type.isStringFilled(s)?_.Loc.getMessage("SIGN_EDITOR_BLOCK_B2E_REFERENCE_NO_DATA_CONTENT_TEMPLATE",{"#CATEGORY#":e,"#FIELD#":s}):_.Loc.getMessage("SIGN_EDITOR_BLOCK_MY_B2E_REFERENCE_MSG_VER_1"));const t=this.block.getLayout();const l=t.querySelector(".--myb2ereference");this.block.resizeText({element:l,step:.5})}})).catch((e=>{console.error(e)}))}return babelHelpers.classPrivateFieldLooseBase(this,nl)[nl]}onPlaced(){babelHelpers.classPrivateFieldLooseBase(this,hl)[hl]()}getActionButton(){babelHelpers.classPrivateFieldLooseBase(this,rl)[rl]=_.Tag.render(il||(il=sl`
			<div class="sign-document__block-style-btn --funnel">
				<button onclick="${0}" data-role="action" data-id="action-${0}">
				</button>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,hl)[hl].bind(this),this.block.getCode());babelHelpers.classPrivateFieldLooseBase(this,dl)[dl]();return babelHelpers.classPrivateFieldLooseBase(this,rl)[rl]}getStyles(){return{...super.getStyles(),...Bl.defaultTextBlockPaddingStyles}}}function yl(e){if(!babelHelpers.classPrivateFieldLooseBase(this,rl)[rl]){return}const s=babelHelpers.classPrivateFieldLooseBase(this,rl)[rl].querySelector("button");s.textContent=_.Type.isStringFilled(e)?e:_.Loc.getMessage("SIGN_EDITOR_BLOCK_MY_B2E_REFERENCE_MSG_VER_1")}function fl(){const e=this.block.blocksManager;const s=e.getMemberByPart(this.block.getMemberPart());const{presetId:t}=s;return babelHelpers.classPrivateFieldLooseBase(this,al)[al].remember("fieldSelector",(()=>{const s=["COMPANY","PROFILE"];if(!e.isTemplateMode){s.push("SMART_B2E_DOC")}const l=new P.FieldSelector({multiple:false,controllerOptions:{hideVirtual:1,hideRequisites:0,hideSmartB2eDocument:1,presetId:t},languages:e.getLanguages(),presetId:t,filter:{"+categories":s,"+fields":["list","string","date","typed_string","text","enumeration","address","url","double","integer","snils"],"-fields":[babelHelpers.classPrivateFieldLooseBase(this,ul)[ul](),({entity_field_name:e})=>babelHelpers.classPrivateFieldLooseBase(this,vl)[vl]().has(e)]},categoryCaptions:{PROFILE:_.Loc.getMessage("SIGN_EDITOR_BLOCKS_REPRESENTATIVE_B2E")}});l.subscribe("onSliderCloseComplete",(e=>babelHelpers.classPrivateFieldLooseBase(this,gl)[gl](e)));return l}))}function Hl(){return["SMART_B2E_DOC_XML_ID","SMART_B2E_DOC_STAGE_ID","COMPANY_LINK","COMPANY_REG_ADDRESS","COMPANY_ORIGIN_VERSION"]}function ml(){return new Set(["ADDRESS","REG_ADDRESS"])}function El(){const e=babelHelpers.classPrivateFieldLooseBase(this,pl)[pl]();return s=>e.includes(s.name)}function Sl(){const e=babelHelpers.classPrivateFieldLooseBase(this,bl)[bl]();e.show().then((s=>{babelHelpers.classPrivateFieldLooseBase(Bl,_l)[_l](e.getFieldsList(false));const t=[...s];if(s.length===0&&_.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,ol)[ol])){t.push(babelHelpers.classPrivateFieldLooseBase(this,ol)[ol])}babelHelpers.classPrivateFieldLooseBase(this,Pl)[Pl](t);if(s.length===0){return}_.Dom.removeClass(this.block.getLayout(),"--invalid");babelHelpers.classPrivateFieldLooseBase(this,ol)[ol]=s[0];this.setData({field:babelHelpers.classPrivateFieldLooseBase(this,ol)[ol]});setTimeout((()=>{this.block.assign()}),0)}))}function Cl(e){const s={selectedFieldNames:e};const t=new y.BaseEvent({data:s});this.emit("onFieldSelect",t)}function Tl(e){setTimeout((()=>{if(_.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,ol)[ol])){return}babelHelpers.classPrivateFieldLooseBase(this,Pl)[Pl]([])}))}function Ol(){if(!_.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,ol)[ol])){return Promise.resolve({categoryCaption:"",fieldCaption:_.Loc.getMessage("SIGN_EDITOR_BLOCK_MY_B2E_REFERENCE_MSG_VER_1")})}const e=_.Loc.getMessage("SIGN_EDITOR_BLOCK_MY_B2E_REFERENCE_MSG_VER_1");if(babelHelpers.classPrivateFieldLooseBase(Bl,cl)[cl]===null){const e=this.block.blocksManager;const s=e.getMemberByPart(this.block.getMemberPart());const{presetId:t}=s;babelHelpers.classPrivateFieldLooseBase(Bl,cl)[cl]=P.FieldSelector.loadFieldList({hideVirtual:1,hideRequisites:1,hideSmartB2eDocument:1,presetId:t})}return babelHelpers.classPrivateFieldLooseBase(Bl,cl)[cl].then((s=>{var t,l,i,a,o,r;const n={profile:s==null?void 0:s.PROFILE,document:s==null?void 0:s.SMART_B2E_DOC,company:s==null?void 0:s.COMPANY};Object.entries(n).forEach((([e,s])=>{var t;if(s===undefined){return}s.FIELDS=((t=s==null?void 0:s.FIELDS)!=null?t:[]).map((s=>({...s,category:e})))}));const c=[...(t=s==null?void 0:(l=s.PROFILE)==null?void 0:l.FIELDS)!=null?t:[],...(i=s==null?void 0:(a=s.SMART_B2E_DOC)==null?void 0:a.FIELDS)!=null?i:[],...(o=s==null?void 0:(r=s.COMPANY)==null?void 0:r.FIELDS)!=null?o:[]];const d=c.find((e=>e.name===babelHelpers.classPrivateFieldLooseBase(this,ol)[ol]));let b="";if(_.Type.isObject(d)){if((d==null?void 0:d.category)==="profile"){b=_.Loc.getMessage("SIGN_EDITOR_BLOCKS_REPRESENTATIVE_B2E")}else{var p,v;b=(p=(v=n[d==null?void 0:d.category])==null?void 0:v.CAPTION)!=null?p:""}}return{categoryCaption:b,fieldCaption:d?d.caption:e}}))}function Il(e){const s=_.Type.isStringFilled(e)?e:_.Loc.getMessage("SIGN_EDITOR_BLOCK_MY_B2E_REFERENCE_MSG_VER_1");babelHelpers.classPrivateFieldLooseBase(this,nl)[nl].textContent=s;babelHelpers.classPrivateFieldLooseBase(this,nl)[nl].title=s}function Rl(e){babelHelpers.classPrivateFieldLooseBase(Bl,cl)[cl]=Promise.resolve(e)}Object.defineProperty(Bl,_l,{value:Rl});Object.defineProperty(Bl,cl,{writable:true,value:null});let Ml=e=>e,Dl,Nl,kl;var wl=babelHelpers.classPrivateFieldLooseKey("cache");var Kl=babelHelpers.classPrivateFieldLooseKey("field");var Al=babelHelpers.classPrivateFieldLooseKey("actionButton");var jl=babelHelpers.classPrivateFieldLooseKey("content");var xl=babelHelpers.classPrivateFieldLooseKey("loadFieldsPromise");var Gl=babelHelpers.classPrivateFieldLooseKey("setContentText");var $l=babelHelpers.classPrivateFieldLooseKey("loadFieldAndCategoryCaption");var Ul=babelHelpers.classPrivateFieldLooseKey("setActionButtonLabel");var zl=babelHelpers.classPrivateFieldLooseKey("getFieldSelectorPanel");var Yl=babelHelpers.classPrivateFieldLooseKey("getFieldsNameBlackList");var Vl=babelHelpers.classPrivateFieldLooseKey("onActionClick");var Xl=babelHelpers.classPrivateFieldLooseKey("emitOnFieldSelectEvent");var ql=babelHelpers.classPrivateFieldLooseKey("onFieldSelectorCloseComplete");var Jl=babelHelpers.classPrivateFieldLooseKey("updateFieldsList");class Ql extends E{constructor(...e){super(...e);Object.defineProperty(this,ql,{value:ai});Object.defineProperty(this,Xl,{value:ii});Object.defineProperty(this,Vl,{value:li});Object.defineProperty(this,Yl,{value:ti});Object.defineProperty(this,zl,{value:si});Object.defineProperty(this,Ul,{value:ei});Object.defineProperty(this,$l,{value:Zl});Object.defineProperty(this,Gl,{value:Wl});Object.defineProperty(this,wl,{writable:true,value:new _.Cache.MemoryCache});Object.defineProperty(this,Kl,{writable:true,value:void 0});Object.defineProperty(this,Al,{writable:true,value:void 0});Object.defineProperty(this,jl,{writable:true,value:void 0})}setData(e){var s;this.data=e||{};babelHelpers.classPrivateFieldLooseBase(this,Kl)[Kl]=(s=this.data.field)!=null?s:""}getViewContent(){var e;babelHelpers.classPrivateFieldLooseBase(this,Ul)[Ul]();if(_.Type.isStringFilled((e=this.data)==null?void 0:e.text)){babelHelpers.classPrivateFieldLooseBase(this,jl)[jl]=_.Tag.render(Dl||(Dl=Ml`
				<div class="sign-document__block-b2e-reference">
					${0}
				</div>
			`),_.Text.encode(this.data.text||"").toString())}else{babelHelpers.classPrivateFieldLooseBase(this,jl)[jl]=_.Tag.render(Nl||(Nl=Ml`
				<div class="sign-document__block-content_member-nodata">
					${0}
				</div>
			`),_.Loc.getMessage("SIGN_EDITOR_BLOCKS_EMPLOYEE_B2E"))}if(_.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,Kl)[Kl])){babelHelpers.classPrivateFieldLooseBase(this,$l)[$l]().then((({categoryCaption:e,fieldCaption:s})=>{var t;babelHelpers.classPrivateFieldLooseBase(this,Ul)[Ul](s);if(!_.Type.isStringFilled((t=this.data)==null?void 0:t.text)){babelHelpers.classPrivateFieldLooseBase(this,Gl)[Gl](_.Type.isStringFilled(e)&&_.Type.isStringFilled(s)?_.Loc.getMessage("SIGN_EDITOR_BLOCK_B2E_EMPLOYEE_DYNAMIC_NO_DATA_CONTENT_TEMPLATE",{"#CATEGORY#":e,"#FIELD#":s}):_.Loc.getMessage("SIGN_EDITOR_BLOCKS_EMPLOYEE_B2E"));const t=this.block.getLayout();const l=t.querySelector(".--employeedynamic");this.block.resizeText({element:l,step:.5})}})).catch((e=>{console.error(e)}))}return babelHelpers.classPrivateFieldLooseBase(this,jl)[jl]}onPlaced(){babelHelpers.classPrivateFieldLooseBase(this,Vl)[Vl]()}getActionButton(){babelHelpers.classPrivateFieldLooseBase(this,Al)[Al]=_.Tag.render(kl||(kl=Ml`
			<div class="sign-document__block-style-btn --funnel">
				<button onclick="${0}" data-role="action" data-id="action-${0}">
				</button>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,Vl)[Vl].bind(this),this.block.getCode());babelHelpers.classPrivateFieldLooseBase(this,Ul)[Ul]();return babelHelpers.classPrivateFieldLooseBase(this,Al)[Al]}getStyles(){return{...super.getStyles(),...Ql.defaultTextBlockPaddingStyles}}}function Wl(e){const s=_.Type.isStringFilled(e)?e:_.Loc.getMessage("SIGN_EDITOR_BLOCK_B2E_EMPLOYEE_DYNAMIC");babelHelpers.classPrivateFieldLooseBase(this,jl)[jl].textContent=s;babelHelpers.classPrivateFieldLooseBase(this,jl)[jl].title=s}function Zl(){if(!_.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,Kl)[Kl])){return Promise.resolve({categoryCaption:"",fieldCaption:_.Loc.getMessage("SIGN_EDITOR_BLOCKS_EMPLOYEE_B2E")})}const e=_.Loc.getMessage("SIGN_EDITOR_BLOCKS_EMPLOYEE_B2E");if(babelHelpers.classPrivateFieldLooseBase(Ql,xl)[xl]===null){babelHelpers.classPrivateFieldLooseBase(Ql,xl)[xl]=P.FieldSelector.loadFieldList({})}return babelHelpers.classPrivateFieldLooseBase(Ql,xl)[xl].then((s=>{var t,l;const i=[...(t=s==null?void 0:(l=s.DYNAMIC_MEMBER)==null?void 0:l.FIELDS)!=null?t:[]];const a=i.find((e=>e.name===babelHelpers.classPrivateFieldLooseBase(this,Kl)[Kl]));return{categoryCaption:_.Loc.getMessage("SIGN_EDITOR_BLOCKS_EMPLOYEE_B2E"),fieldCaption:a?a.caption:e}}))}function ei(e){if(!babelHelpers.classPrivateFieldLooseBase(this,Al)[Al]){return}const s=babelHelpers.classPrivateFieldLooseBase(this,Al)[Al].querySelector("button");s.textContent=_.Type.isStringFilled(e)?e:_.Loc.getMessage("SIGN_EDITOR_BLOCK_B2E_EMPLOYEE_DYNAMIC")}function si(){const e=this.block.blocksManager;return babelHelpers.classPrivateFieldLooseBase(this,wl)[wl].remember("fieldSelector",(()=>{const s=new P.FieldSelector({multiple:false,controllerOptions:{hideVirtual:1,hideRequisites:1,hideSmartB2eDocument:1},languages:e.getLanguages(),filter:{"+categories":["DYNAMIC_MEMBER"],"+fields":["list","string","date","typed_string","text","datetime","enumeration","url","double","integer","snils"],"-fields":[({entity_field_name:e})=>babelHelpers.classPrivateFieldLooseBase(this,Yl)[Yl]().has(e)],allowEmptyFieldList:true},title:_.Loc.getMessage("SIGN_EDITOR_BLOCK_B2E_EMPLOYEE_DYNAMIC"),categoryCaptions:{DYNAMIC_MEMBER:_.Loc.getMessage("SIGN_EDITOR_BLOCKS_EMPLOYEE_B2E")},fieldsFactory:{filter:e=>e.filter((e=>_.Type.isObject(e)&&_.Type.isStringFilled(e.name)&&["list","string","date","enumeration"].includes(e.name)))}});s.subscribe("onSliderCloseComplete",(e=>babelHelpers.classPrivateFieldLooseBase(this,ql)[ql](e)));return s}))}function ti(){return new Set(["ADDRESS","REG_ADDRESS"])}function li(){const e=babelHelpers.classPrivateFieldLooseBase(this,zl)[zl]();e.show().then((s=>{babelHelpers.classPrivateFieldLooseBase(Ql,Jl)[Jl](e.getFieldsList(false));const t=[...s];if(s.length===0&&_.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,Kl)[Kl])){t.push(babelHelpers.classPrivateFieldLooseBase(this,Kl)[Kl])}babelHelpers.classPrivateFieldLooseBase(this,Xl)[Xl](t);if(s.length===0){return}_.Dom.removeClass(this.block.getLayout(),"--invalid");babelHelpers.classPrivateFieldLooseBase(this,Kl)[Kl]=s[0];this.setData({field:babelHelpers.classPrivateFieldLooseBase(this,Kl)[Kl]});setTimeout((()=>{this.block.assign()}),0)}))}function ii(e){const s={selectedFieldNames:e};const t=new y.BaseEvent({data:s});this.emit("onFieldSelect",t)}function ai(e){setTimeout((()=>{if(_.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,Kl)[Kl])){return}babelHelpers.classPrivateFieldLooseBase(this,Xl)[Xl]([])}))}function oi(e){babelHelpers.classPrivateFieldLooseBase(Ql,xl)[xl]=Promise.resolve(e)}Object.defineProperty(Ql,Jl,{value:oi});Object.defineProperty(Ql,xl,{writable:true,value:null});let ri=e=>e,ni,ci,di;var bi=babelHelpers.classPrivateFieldLooseKey("cache");var pi=babelHelpers.classPrivateFieldLooseKey("field");var vi=babelHelpers.classPrivateFieldLooseKey("actionButton");var ui=babelHelpers.classPrivateFieldLooseKey("content");var hi=babelHelpers.classPrivateFieldLooseKey("loadFieldsPromise");var Pi=babelHelpers.classPrivateFieldLooseKey("lastLoadFieldsDocumentUid");var gi=babelHelpers.classPrivateFieldLooseKey("setContentText");var Li=babelHelpers.classPrivateFieldLooseKey("loadFieldAndCategoryCaption");var Fi=babelHelpers.classPrivateFieldLooseKey("setActionButtonLabel");var _i=babelHelpers.classPrivateFieldLooseKey("getFieldSelectorPanel");var Bi=babelHelpers.classPrivateFieldLooseKey("getFieldsNameBlackList");var yi=babelHelpers.classPrivateFieldLooseKey("onActionClick");var fi=babelHelpers.classPrivateFieldLooseKey("emitOnFieldSelectEvent");var Hi=babelHelpers.classPrivateFieldLooseKey("onFieldSelectorCloseComplete");var mi=babelHelpers.classPrivateFieldLooseKey("extractPartyFromSelectedField");var Ei=babelHelpers.classPrivateFieldLooseKey("updateFieldsList");var Si=babelHelpers.classPrivateFieldLooseKey("getCustomBackendSettings");class Ci extends E{constructor(...e){super(...e);Object.defineProperty(this,Si,{value:Ai});Object.defineProperty(this,mi,{value:wi});Object.defineProperty(this,Hi,{value:ki});Object.defineProperty(this,fi,{value:Ni});Object.defineProperty(this,yi,{value:Di});Object.defineProperty(this,Bi,{value:Mi});Object.defineProperty(this,_i,{value:Ri});Object.defineProperty(this,Fi,{value:Ii});Object.defineProperty(this,Li,{value:Oi});Object.defineProperty(this,gi,{value:Ti});Object.defineProperty(this,bi,{writable:true,value:new _.Cache.MemoryCache});Object.defineProperty(this,pi,{writable:true,value:void 0});Object.defineProperty(this,vi,{writable:true,value:void 0});Object.defineProperty(this,ui,{writable:true,value:void 0})}setData(e){var s;this.data=e?e:{};babelHelpers.classPrivateFieldLooseBase(this,pi)[pi]=(s=this.data.field)!=null?s:"";const t=babelHelpers.classPrivateFieldLooseBase(this,mi)[mi](babelHelpers.classPrivateFieldLooseBase(this,pi)[pi]);if(t>0){this.block.setMemberParty(t)}}getViewContent(){var e;babelHelpers.classPrivateFieldLooseBase(this,Fi)[Fi]();if(_.Type.isStringFilled((e=this.data)==null?void 0:e.text)){babelHelpers.classPrivateFieldLooseBase(this,ui)[ui]=_.Tag.render(ni||(ni=ri`
				<div class="sign-document__block-b2e-hcmlinkreference">
					${0}
				</div>
			`),_.Text.encode(this.data.text||"").toString())}else{babelHelpers.classPrivateFieldLooseBase(this,ui)[ui]=_.Tag.render(ci||(ci=ri`
				<div class="sign-document__block-content_member-nodata">
					${0}
				</div>
			`),_.Loc.getMessage("SIGN_EDITOR_BLOCK_B2E_HCMLINK_TITLE"))}if(_.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,pi)[pi])){babelHelpers.classPrivateFieldLooseBase(this,Li)[Li]().then((({categoryCaption:e,fieldCaption:s})=>{var t;babelHelpers.classPrivateFieldLooseBase(this,Fi)[Fi](s);if(!_.Type.isStringFilled((t=this.data)==null?void 0:t.text)){babelHelpers.classPrivateFieldLooseBase(this,gi)[gi](_.Type.isStringFilled(e)&&_.Type.isStringFilled(s)?_.Loc.getMessage("SIGN_EDITOR_BLOCK_B2E_REFERENCE_NO_DATA_CONTENT_TEMPLATE",{"#CATEGORY#":e,"#FIELD#":s}):_.Loc.getMessage("SIGN_EDITOR_BLOCK_B2E_HCMLINK_TITLE"));const t=this.block.getLayout();const l=t.querySelector(".--hcmlinkreference");this.block.resizeText({element:l,step:.5})}})).catch((e=>{console.error(e)}))}return babelHelpers.classPrivateFieldLooseBase(this,ui)[ui]}onPlaced(){babelHelpers.classPrivateFieldLooseBase(this,yi)[yi]()}getActionButton(){babelHelpers.classPrivateFieldLooseBase(this,vi)[vi]=_.Tag.render(di||(di=ri`
			<div class="sign-document__block-style-btn --funnel">
				<button onclick="${0}" data-role="action" data-id="action-${0}">
				</button>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,yi)[yi].bind(this),this.block.getCode());babelHelpers.classPrivateFieldLooseBase(this,Fi)[Fi]();return babelHelpers.classPrivateFieldLooseBase(this,vi)[vi]}getStyles(){return{...super.getStyles(),...this.defaultTextBlockPaddingStyles}}}function Ti(e){const s=_.Type.isStringFilled(e)?e:_.Loc.getMessage("SIGN_EDITOR_BLOCK_B2E_HCMLINK_TITLE");babelHelpers.classPrivateFieldLooseBase(this,ui)[ui].textContent=s;babelHelpers.classPrivateFieldLooseBase(this,ui)[ui].title=s}function Oi(){if(!_.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,pi)[pi])){return Promise.resolve({categoryCaption:"",fieldCaption:_.Loc.getMessage("SIGN_EDITOR_BLOCK_B2E_HCMLINK_TITLE")})}const e=_.Loc.getMessage("SIGN_EDITOR_BLOCK_B2E_HCMLINK_TITLE");const s=this.block.blocksManager.getDocumentUid();if(babelHelpers.classPrivateFieldLooseBase(Ci,hi)[hi]===null||s!==babelHelpers.classPrivateFieldLooseBase(Ci,Pi)[Pi]){babelHelpers.classPrivateFieldLooseBase(Ci,Pi)[Pi]=s;babelHelpers.classPrivateFieldLooseBase(Ci,hi)[hi]=P.FieldSelector.loadFieldList({},babelHelpers.classPrivateFieldLooseBase(this,Si)[Si]())}return babelHelpers.classPrivateFieldLooseBase(Ci,hi)[hi].then((s=>{var t,l,i,a,o,r;const n={representative:s==null?void 0:s.REPRESENTATIVE,employee:s==null?void 0:s.EMPLOYEE,company:s==null?void 0:s.COMPANY};Object.entries(n).forEach((([e,s])=>{var t;if(s===undefined){return}s.FIELDS=((t=s==null?void 0:s.FIELDS)!=null?t:[]).map((s=>({...s,category:e})))}));const c=[...(t=s==null?void 0:(l=s.REPRESENTATIVE)==null?void 0:l.FIELDS)!=null?t:[],...(i=s==null?void 0:(a=s.EMPLOYEE)==null?void 0:a.FIELDS)!=null?i:[],...(o=s==null?void 0:(r=s.COMPANY)==null?void 0:r.FIELDS)!=null?o:[]];const d=c.find((e=>e.name===babelHelpers.classPrivateFieldLooseBase(this,pi)[pi]));let b="";if(_.Type.isObject(d)){if((d==null?void 0:d.category)==="representative"){b=_.Loc.getMessage("SIGN_EDITOR_BLOCKS_REPRESENTATIVE_B2E")}else if((d==null?void 0:d.category)==="employee"){b=_.Loc.getMessage("SIGN_EDITOR_BLOCKS_EMPLOYEE_B2E")}else if((d==null?void 0:d.category)==="company"){b=_.Loc.getMessage("SIGN_EDITOR_BLOCKS_COMPANY")}else{var p,v;b=(p=(v=n[d==null?void 0:d.category])==null?void 0:v.CAPTION)!=null?p:""}}return{categoryCaption:b,fieldCaption:d?d.caption:e}}))}function Ii(e){if(!babelHelpers.classPrivateFieldLooseBase(this,vi)[vi]){return}const s=babelHelpers.classPrivateFieldLooseBase(this,vi)[vi].querySelector("button");s.textContent=_.Type.isStringFilled(e)?e:_.Loc.getMessage("SIGN_EDITOR_BLOCK_B2E_HCMLINK_TITLE")}function Ri(){const e=this.block.blocksManager;const s=babelHelpers.classPrivateFieldLooseBase(this,bi)[bi].remember("fieldSelector",(()=>{const s=new P.FieldSelector({multiple:false,languages:e.getLanguages(),filter:{"+categories":["REPRESENTATIVE","EMPLOYEE"],"+fields":[],"-fields":[({entity_field_name:e})=>babelHelpers.classPrivateFieldLooseBase(this,Bi)[Bi]().has(e)]},title:_.Loc.getMessage("SIGN_EDITOR_BLOCK_B2E_HCMLINK_TITLE"),categoryCaptions:{REPRESENTATIVE:_.Loc.getMessage("SIGN_EDITOR_BLOCKS_REPRESENTATIVE_B2E"),EMPLOYEE:_.Loc.getMessage("SIGN_EDITOR_BLOCKS_EMPLOYEE_B2E"),COMPANY:_.Loc.getMessage("SIGN_EDITOR_BLOCKS_COMPANY")},alwaysHideCreateFieldButton:true});s.subscribe("onSliderCloseComplete",(e=>babelHelpers.classPrivateFieldLooseBase(this,Hi)[Hi](e)));return s}));s.setCustomBackendSettings(babelHelpers.classPrivateFieldLooseBase(this,Si)[Si]());return s}function Mi(){return new Set([])}function Di(){const e=babelHelpers.classPrivateFieldLooseBase(this,_i)[_i]();e.show().then((s=>{let t=e.getFieldsList(false);babelHelpers.classPrivateFieldLooseBase(Ci,Ei)[Ei](t);const l=[...s];if(s.length===0&&_.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,pi)[pi])){l.push(babelHelpers.classPrivateFieldLooseBase(this,pi)[pi])}babelHelpers.classPrivateFieldLooseBase(this,fi)[fi](l);if(s.length===0){return}_.Dom.removeClass(this.block.getLayout(),"--invalid");babelHelpers.classPrivateFieldLooseBase(this,pi)[pi]=s[0];this.setData({field:babelHelpers.classPrivateFieldLooseBase(this,pi)[pi]});setTimeout((()=>{this.block.assign()}),0)}))}function Ni(e){const s={selectedFieldNames:e};const t=new y.BaseEvent({data:s});this.emit("onFieldSelect",t)}function ki(e){setTimeout((()=>{if(_.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,pi)[pi])){return}babelHelpers.classPrivateFieldLooseBase(this,fi)[fi]([])}))}function wi(e){if(!_.Type.isStringFilled(e)){return null}const s=e.split("_");return s[3]?Number(s[3]):null}function Ki(e){babelHelpers.classPrivateFieldLooseBase(Ci,hi)[hi]=Promise.resolve(e)}function Ai(){return{uri:"sign.api_v1.integration.humanresources.hcmLink.loadFields",requestOptions:{documentUid:this.block.blocksManager.getDocumentUid()}}}Object.defineProperty(Ci,Ei,{value:Ki});Object.defineProperty(Ci,hi,{writable:true,value:null});Object.defineProperty(Ci,Pi,{writable:true,value:null});let ji=e=>e,xi,Gi;var $i=babelHelpers.classPrivateFieldLooseKey("content");class Ui extends E{constructor(...e){super(...e);Object.defineProperty(this,$i,{writable:true,value:void 0})}getViewContent(){var e;if(_.Type.isStringFilled((e=this.data)==null?void 0:e.text)){const e=_.Text.encode(this.data.text||"");babelHelpers.classPrivateFieldLooseBase(this,$i)[$i]=_.Tag.render(xi||(xi=ji`
				<div class="sign-document__block-b2e-document-date">
					${0}
				</div>
			`),e)}else{const e=_.Loc.getMessage("SIGN_EDITOR_BLOCK_B2E_DOCUMENT_PLACEHOLDER",{"#PLACEHOLDER#":_.Loc.getMessage("SIGN_EDITOR_BLOCK_B2E_DOCUMENT_DATE_TITLE")});babelHelpers.classPrivateFieldLooseBase(this,$i)[$i]=_.Tag.render(Gi||(Gi=ji`
				<div class="sign-document__block-content_member-nodata">
					${0}
				</div>
			`),e)}return babelHelpers.classPrivateFieldLooseBase(this,$i)[$i]}}let zi=e=>e,Yi,Vi;var Xi=babelHelpers.classPrivateFieldLooseKey("content");class qi extends E{constructor(...e){super(...e);Object.defineProperty(this,Xi,{writable:true,value:void 0})}getViewContent(){var e;if(_.Type.isStringFilled((e=this.data)==null?void 0:e.text)){babelHelpers.classPrivateFieldLooseBase(this,Xi)[Xi]=_.Tag.render(Yi||(Yi=zi`
				<div class="sign-document__block-b2e-external-id">
					${0}
				</div>
			`),_.Text.encode(this.data.text||""))}else{const e=_.Loc.getMessage("SIGN_EDITOR_BLOCK_B2E_DOCUMENT_PLACEHOLDER",{"#PLACEHOLDER#":_.Loc.getMessage("SIGN_EDITOR_BLOCK_B2E_EXTERNAL_ID_TITLE")});babelHelpers.classPrivateFieldLooseBase(this,Xi)[Xi]=_.Tag.render(Vi||(Vi=zi`
				<div class="sign-document__block-content_member-nodata">
					${0}
				</div>
			`),e)}return babelHelpers.classPrivateFieldLooseBase(this,Xi)[Xi]}}let Ji=e=>e,Qi,Wi,Zi,ea,sa,ta,la,ia,aa;const oa=_.Reflection.getClass("BX.ColorPicker");class ra{static setRect(e,s){Object.keys(s).map((e=>{s[e]=`${Math.round(s[e])}px`}));_.Dom.style(e,s)}static getBlockLayout(e){return _.Tag.render(Qi||(Qi=Ji`
			<div class="sign-document__block-wrapper">
				<div class="sign-document__block-panel--wrapper" data-role="sign-block__actions">
				</div>
				<div class="sign-document__block-content">
				</div>
				<div class="sign-document__block-actions">
					<div class="sign-document__block-actions--wrapper">
						<button class="sign-document__block-actions-btn --remove sign-block-action-remove" data-role="removeAction" onclick="${0}"></button>
						<button class="sign-document__block-actions-btn --save sign-block-action-save" data-role="saveAction" onclick="${0}"></button>
					</div>
				</div>
			</div>
		`),e.onRemove,e.onSave)}static getMemberSelector(e,s,t){const l={};let i=_.Loc.getMessage("SIGN_JS_DOCUMENT_MEMBER_NAME_NOT_SET");e.map((e=>{e.name=e.name||_.Loc.getMessage("SIGN_JS_DOCUMENT_MEMBER_NAME_NOT_SET");l[e.part]=e.name;if(e.part===s){i=e.name}}));const a=e.length>1?_.Tag.render(Wi||(Wi=Ji`<span>${0}</span>`),_.Text.encode(i)):_.Tag.render(Zi||(Zi=Ji`<i>${0}</i>`),_.Text.encode(i));if(e.length>1){g.UI.bindSimpleMenu({bindElement:a,items:l,actionHandler:e=>{a.innerHTML=l[e];t(parseInt(e))}})}return _.Tag.render(ea||(ea=Ji`
			<div class="sign-document-block-member-wrapper">
				${0}
			</div>
		`),a)}static getResizeArea(){return _.Tag.render(sa||(sa=Ji`
			<div class="sign-document__resize-area">
				<div class="sign-area-resizable-controls">
					<span class="sign-document__move-control"></span>
					<div class="sign-document__resize-control --middle-top"></div>
					<div class="sign-document__resize-control --right-top"></div>
					<div class="sign-document__resize-control --middle-right"></div>
					<div class="sign-document__resize-control --right-bottom"></div>
					<div class="sign-document__resize-control --middle-bottom"></div>
					<div class="sign-document__resize-control --left-bottom"></div>
					<div class="sign-document__resize-control --middle-left"></div>
				</div>
			</div>
		`))}static getStylePanel(e,s){var t;const l={'"Times New Roman", Times':"<span style=\"font-family: 'Times New Roman', Times\">Times New Roman</span>",'"Courier New"':"<span style=\"font-family: 'Courier New'\">Courier New</span>","Arial, Helvetica":'<span style="font-family: Arial, Helvetica">Arial / Helvetica</span>','"Arial Black", Gadget':"<span style=\"font-family: 'Arial Black', Gadget\">Arial Black</span>","Tahoma, Geneva":'<span style="font-family: Tahoma, Geneva">Tahoma / Geneva</span>',Verdana:'<span style="font-family: Verdana">Verdana</span>',"Georgia, serif":'<span style="font-family: Georgia, serif">Georgia</span>',monospace:'<span style="font-family: monospace">monospace</span>'};const i=_.Tag.render(ta||(ta=Ji`<div class="sign-document__block-style-btn --btn-font-family">${0}</div>`),l[s["fontFamily"]]||"Font");g.UI.bindSimpleMenu({bindElement:i,items:l,actionHandler:s=>{i.innerHTML=l[s];e("family",s)}});let a=parseInt(s["fontSize"]);let o=14;if(a){o=a}const r=_.Tag.render(la||(la=Ji`<div class="sign-document__block-style-btn --btn-fontsize">${0}</div>`),o+"px"||"<i></i>");g.UI.bindSimpleMenu({bindElement:r,items:["6px","7px","8px","9px","10px","11px","12px","13px","14px","15px","16px","18px","20px","22px","24px","26px","28px","36px","48px","72px"],actionHandler:s=>{r.innerHTML=parseInt(s)+"px";e("size",s)},currentValue:o});const{layout:n}=ra.getColorSelectorBtn((t=s.color)!=null?t:"#000",(s=>e("color",s)));return _.Tag.render(ia||(ia=Ji`
			<div class="sign-document__block-style--panel">
<!--				<div class="sign-document__block-style&#45;&#45;move-control"></div>-->
				${0}
				${0}
				${0}
				<div class="sign-document__block-style--separator"></div>
				<div class="sign-document__block-style-btn --btn-bold" data-action="bold"><i></i></div>
				<div class="sign-document__block-style-btn --btn-italic" data-action="italic"><i></i></div>
				<div class="sign-document__block-style-btn --btn-underline" data-action="underline"><i></i></div>
				<div class="sign-document__block-style-btn --btn-strike" data-action="through"><i></i></div>
				<div class="sign-document__block-style-btn --btn-align-left" data-action="left"><i></i></div>
				<div class="sign-document__block-style-btn --btn-align-center" data-action="center"><i></i></div>
				<div class="sign-document__block-style-btn --btn-align-right" data-action="right"><i></i></div>
				<div class="sign-document__block-style-btn --btn-align-justify" data-action="justify"><i></i></div>
			</div>
		`),i,r,n)}static getColorSelectorBtn(e,s,t={}){const l=_.Tag.render(aa||(aa=Ji`<div class="sign-document__block-style-btn --btn-color">
				<span class="sign-document__block-style-btn--color-block"></span> 
				<span>${0}</span>
			</div>`),_.Loc.getMessage("SIGN_JS_DOCUMENT_STYLE_COLOR"));ra.updateColorSelectorBtnColor(l,e);const i={...t,bindElement:l,onColorSelected:e=>{s(e);ra.updateColorSelectorBtnColor(l,e)}};const a=new oa(i);_.Event.bind(l,"click",(()=>{a.open()}));return{layout:l,colorPicker:a}}static updateColorSelectorBtnColor(e,s){const t=e.querySelector(".sign-document__block-style-btn--color-block");if(_.Type.isNil(t)){return}_.Dom.style(t,"background-color",s)}}var na=babelHelpers.classPrivateFieldLooseKey("block");var ca=babelHelpers.classPrivateFieldLooseKey("buttons");var da=babelHelpers.classPrivateFieldLooseKey("style");var ba=babelHelpers.classPrivateFieldLooseKey("onPressButton");var pa=babelHelpers.classPrivateFieldLooseKey("applyData");class va{constructor(e){Object.defineProperty(this,pa,{value:ha});Object.defineProperty(this,ba,{value:ua});Object.defineProperty(this,na,{writable:true,value:void 0});Object.defineProperty(this,ca,{writable:true,value:{family:{property:"fontFamily",value:null},size:{property:"fontSize",value:14},color:{property:"color",value:null},bold:{button:null,property:"fontWeight",value:"bold",state:false},italic:{button:null,property:"fontStyle",value:"italic",state:false},underline:{button:null,property:"textDecoration",value:"underline",state:false},through:{button:null,property:"textDecoration",value:"line-through",state:false},left:{button:null,property:"textAlign",value:"left",state:false,group:"align"},center:{button:null,property:"textAlign",value:"center",state:false,group:"align"},right:{button:null,property:"textAlign",value:"right",state:false,group:"align"},justify:{button:null,property:"textAlign",value:"justify",state:false,group:"align"}}});Object.defineProperty(this,da,{writable:true,value:{buttonPressed:"sign-document__block-style--button-pressed"}});babelHelpers.classPrivateFieldLooseBase(this,na)[na]=e.block;if(e.data){babelHelpers.classPrivateFieldLooseBase(this,pa)[pa](e.data)}}applyStyles(e){e.removeAttribute("style");_.Dom.style(e,this.collectStyles())}updateFontSize(e){if(e){babelHelpers.classPrivateFieldLooseBase(this,ca)[ca].size["property"]="fontSize";babelHelpers.classPrivateFieldLooseBase(this,ca)[ca].size["value"]=e}}collectStyles(){const e={};[...Object.keys(babelHelpers.classPrivateFieldLooseBase(this,ca)[ca])].map((s=>{if(babelHelpers.classPrivateFieldLooseBase(this,ca)[ca][s]["state"]||typeof babelHelpers.classPrivateFieldLooseBase(this,ca)[ca][s]["state"]==="undefined"){const t=babelHelpers.classPrivateFieldLooseBase(this,ca)[ca][s]["property"];const l=babelHelpers.classPrivateFieldLooseBase(this,ca)[ca][s]["value"];if(l===null){return}if(babelHelpers.classPrivateFieldLooseBase(this,ca)[ca][s]["group"]){e[t]=l}else{e[t]=(e[t]?e[t]+" ":"")+l}}}));return e}getLayout(){const e=ra.getStylePanel(((e,s)=>{babelHelpers.classPrivateFieldLooseBase(this,ca)[ca][e]["value"]=s;babelHelpers.classPrivateFieldLooseBase(this,na)[na].renderStyle()}),this.collectStyles());[...e.querySelectorAll("[data-action]")].map((e=>{const s=e.getAttribute("data-action");if(babelHelpers.classPrivateFieldLooseBase(this,ca)[ca][s]){_.Event.bind(e,"click",(()=>babelHelpers.classPrivateFieldLooseBase(this,ba)[ba](s)));babelHelpers.classPrivateFieldLooseBase(this,ca)[ca][s]["button"]=e;if(babelHelpers.classPrivateFieldLooseBase(this,ca)[ca][s]["state"]){_.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,ca)[ca][s]["button"],babelHelpers.classPrivateFieldLooseBase(this,da)[da].buttonPressed)}}}));return e}updateColor(e){babelHelpers.classPrivateFieldLooseBase(this,ca)[ca].color.value=e}}function ua(e){babelHelpers.classPrivateFieldLooseBase(this,ca)[ca][e]["state"]=!babelHelpers.classPrivateFieldLooseBase(this,ca)[ca][e]["state"];if(babelHelpers.classPrivateFieldLooseBase(this,ca)[ca][e]["state"]){_.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,ca)[ca][e]["button"],babelHelpers.classPrivateFieldLooseBase(this,da)[da].buttonPressed);if(babelHelpers.classPrivateFieldLooseBase(this,ca)[ca][e]["group"]){const s=babelHelpers.classPrivateFieldLooseBase(this,ca)[ca][e]["group"];[...Object.keys(babelHelpers.classPrivateFieldLooseBase(this,ca)[ca])].map((t=>{if(t!==e&&babelHelpers.classPrivateFieldLooseBase(this,ca)[ca][t]["group"]===s){babelHelpers.classPrivateFieldLooseBase(this,ca)[ca][t]["state"]=false;_.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,ca)[ca][t]["button"],babelHelpers.classPrivateFieldLooseBase(this,da)[da].buttonPressed)}}))}}else{_.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,ca)[ca][e]["button"],babelHelpers.classPrivateFieldLooseBase(this,da)[da].buttonPressed)}babelHelpers.classPrivateFieldLooseBase(this,na)[na].renderStyle()}function ha(e){[...Object.keys(babelHelpers.classPrivateFieldLooseBase(this,ca)[ca])].map((s=>{const t=babelHelpers.classPrivateFieldLooseBase(this,ca)[ca][s]["property"];if(e[t]){if(typeof babelHelpers.classPrivateFieldLooseBase(this,ca)[ca][s]["state"]!=="undefined"){if(e[t].indexOf(babelHelpers.classPrivateFieldLooseBase(this,ca)[ca][s]["value"])!==-1){babelHelpers.classPrivateFieldLooseBase(this,ca)[ca][s]["state"]=true}}else{babelHelpers.classPrivateFieldLooseBase(this,ca)[ca][s]["value"]=e[t]}}}))}const Pa=new Set(["requisites","myrequisites","reference","myreference","text"]);var ga=babelHelpers.classPrivateFieldLooseKey("id");var La=babelHelpers.classPrivateFieldLooseKey("code");var Fa=babelHelpers.classPrivateFieldLooseKey("layout");var _a=babelHelpers.classPrivateFieldLooseKey("stylePanel");var Ba=babelHelpers.classPrivateFieldLooseKey("content");var ya=babelHelpers.classPrivateFieldLooseKey("memberPart");var fa=babelHelpers.classPrivateFieldLooseKey("panelCreated");var Ha=babelHelpers.classPrivateFieldLooseKey("allowMembers");var ma=babelHelpers.classPrivateFieldLooseKey("onClickCallback");var Ea=babelHelpers.classPrivateFieldLooseKey("onRemoveCallback");var Sa=babelHelpers.classPrivateFieldLooseKey("contentProviders");var Ca=babelHelpers.classPrivateFieldLooseKey("currentFontSize");var Ta=babelHelpers.classPrivateFieldLooseKey("style");var Oa=babelHelpers.classPrivateFieldLooseKey("firstRenderReady");var Ia=babelHelpers.classPrivateFieldLooseKey("api");var Ra=babelHelpers.classPrivateFieldLooseKey("onClick");var Ma=babelHelpers.classPrivateFieldLooseKey("createLayout");var Da=babelHelpers.classPrivateFieldLooseKey("onRemoveBtnClick");var Na=babelHelpers.classPrivateFieldLooseKey("onContentChange");var ka=babelHelpers.classPrivateFieldLooseKey("onContentColorStyleChange");var wa=babelHelpers.classPrivateFieldLooseKey("onFieldSelect");class Ka extends y.EventEmitter{constructor(e){var s,t;super();Object.defineProperty(this,wa,{value:Ua});Object.defineProperty(this,ka,{value:$a});Object.defineProperty(this,Na,{value:Ga});Object.defineProperty(this,Da,{value:xa});Object.defineProperty(this,Ma,{value:ja});Object.defineProperty(this,Ra,{value:Aa});this.events={onColorStyleChange:"onColorStyleChange"};Object.defineProperty(this,ga,{writable:true,value:void 0});Object.defineProperty(this,La,{writable:true,value:void 0});Object.defineProperty(this,Fa,{writable:true,value:void 0});Object.defineProperty(this,_a,{writable:true,value:void 0});Object.defineProperty(this,Ba,{writable:true,value:null});Object.defineProperty(this,ya,{writable:true,value:2});Object.defineProperty(this,fa,{writable:true,value:false});Object.defineProperty(this,Ha,{writable:true,value:false});Object.defineProperty(this,ma,{writable:true,value:void 0});Object.defineProperty(this,Ea,{writable:true,value:void 0});Object.defineProperty(this,Sa,{writable:true,value:{date:M,myrequisites:U,mysign:_e,mystamp:Re,number:Ae,reference:ts,myreference:Cs,requisites:Ys,sign:bt,stamp:et,text:_t,b2ereference:$t,myb2ereference:Bl,employeedynamic:Ql,hcmlinkreference:Ci,b2edocumentdate:Ui,b2eexternalid:qi}});Object.defineProperty(this,Ca,{writable:true,value:void 0});Object.defineProperty(this,Ta,{writable:true,value:{blockContent:".sign-document__block-content",blockPanel:".sign-document__block-panel--wrapper",blockLoading:"sign-document-block-loading",blockEditing:"sign-document__block-wrapper-editing",pageWithNotAllowed:"sign-editor__content-document--active-move"}});Object.defineProperty(this,Oa,{writable:true,value:void 0});Object.defineProperty(this,Ia,{writable:true,value:void 0});this.setEventNamespace("BX.Sign.V2.Editor.Block");this.blocksManager=e.blocksManager;babelHelpers.classPrivateFieldLooseBase(this,ga)[ga]=e.id||null;babelHelpers.classPrivateFieldLooseBase(this,La)[La]=e.code;babelHelpers.classPrivateFieldLooseBase(this,ya)[ya]=e.party;babelHelpers.classPrivateFieldLooseBase(this,ma)[ma]=e.onClick;babelHelpers.classPrivateFieldLooseBase(this,Ea)[Ea]=e.onRemove;babelHelpers.classPrivateFieldLooseBase(this,Oa)[Oa]=null;babelHelpers.classPrivateFieldLooseBase(this,_a)[_a]=new va({block:this,data:e.style});if(!babelHelpers.classPrivateFieldLooseBase(this,Sa)[Sa][babelHelpers.classPrivateFieldLooseBase(this,La)[La]]){throw new Error(`Content provider for '${babelHelpers.classPrivateFieldLooseBase(this,La)[La]}' not found.`)}babelHelpers.classPrivateFieldLooseBase(this,Ba)[Ba]=new(babelHelpers.classPrivateFieldLooseBase(this,Sa)[Sa][babelHelpers.classPrivateFieldLooseBase(this,La)[La]])(this);if(["sign","mysign"].includes(babelHelpers.classPrivateFieldLooseBase(this,La)[La])&&_.Type.isString((s=e.style)==null?void 0:s.color)){babelHelpers.classPrivateFieldLooseBase(this,Ba)[Ba].changeStyleColor(e.style.color,false)}babelHelpers.classPrivateFieldLooseBase(this,Ma)[Ma]();_.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,Fa)[Fa],"click",babelHelpers.classPrivateFieldLooseBase(this,Ra)[Ra].bind(this));if(e.party>1&&!["b2ereference","employeedynamic","hcmlinkreference","b2eexternalid","b2edocumentdate"].includes(babelHelpers.classPrivateFieldLooseBase(this,La)[La].toLowerCase())){babelHelpers.classPrivateFieldLooseBase(this,Ha)[Ha]=true}this.renderStyle();this.setPosition((t=e.position)!=null?t:babelHelpers.classPrivateFieldLooseBase(this,Ba)[Ba].getInitDimension());if(e.data){setTimeout((()=>{this.setData(e.data)}),0)}babelHelpers.classPrivateFieldLooseBase(this,Ia)[Ia]=new f.Api}getLayout(){return babelHelpers.classPrivateFieldLooseBase(this,Fa)[Fa]}setData(e){babelHelpers.classPrivateFieldLooseBase(this,Ba)[Ba].setData(e);this.renderView()}setPosition(e){ra.setRect(babelHelpers.classPrivateFieldLooseBase(this,Fa)[Fa],e)}getData(){return babelHelpers.classPrivateFieldLooseBase(this,Ba)[Ba].getData()}getPosition(){let{top:e,left:s,width:t,height:l}=babelHelpers.classPrivateFieldLooseBase(this,Fa)[Fa].getBoundingClientRect();const i=babelHelpers.classPrivateFieldLooseBase(this,Fa)[Fa];e=Math.round(e);s=Math.round(s);t=Math.round(t);l=Math.round(l);const a=this.blocksManager.getLayout().getBoundingClientRect();e-=Math.round(a.top);s-=Math.round(a.left);return{top:e,left:s,width:t,height:l}}getStyle(){return{...babelHelpers.classPrivateFieldLooseBase(this,Ba)[Ba].getStyles(),...babelHelpers.classPrivateFieldLooseBase(this,_a)[_a].collectStyles()}}getId(){var e;return(e=babelHelpers.classPrivateFieldLooseBase(this,ga)[ga])!=null?e:null}getCode(){return babelHelpers.classPrivateFieldLooseBase(this,La)[La]}showNotAllowedArea(){const{page:e}=this.blocksManager.transferPositionToPage(this.getPosition());const s=document.querySelector(`.sign-editor__content-document--page[data-page="${e}"]`);_.Dom.addClass(s,babelHelpers.classPrivateFieldLooseBase(this,Ta)[Ta].pageWithNotAllowed)}hideNotAllowedArea(){const{page:e}=this.blocksManager.transferPositionToPage(this.getPosition());const s=document.querySelector(`.sign-editor__content-document--page[data-page="${e}"]`);_.Dom.removeClass(s,babelHelpers.classPrivateFieldLooseBase(this,Ta)[Ta].pageWithNotAllowed)}getMemberPart(){return babelHelpers.classPrivateFieldLooseBase(this,ya)[ya]}fireAction(){if(babelHelpers.classPrivateFieldLooseBase(this,Ba)[Ba]["onActionClick"]){if(babelHelpers.classPrivateFieldLooseBase(this,La)[La]==="text"){_.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,Fa)[Fa],babelHelpers.classPrivateFieldLooseBase(this,Ta)[Ta].blockEditing)}babelHelpers.classPrivateFieldLooseBase(this,Ba)[Ba]["onActionClick"]()}}onMemberSelect(e){babelHelpers.classPrivateFieldLooseBase(this,ya)[ya]=e;this.assign()}await(e){const s=[];if(!babelHelpers.classPrivateFieldLooseBase(this,Ba)[Ba].isSingleton()){s.push(this.getLayout())}else{const e=this.getCode();this.blocksManager.getBlocks().map((t=>{if(t.getCode()===e){s.push(t.getLayout())}}))}s.map(((t,l)=>{if(e){if(s.length===l+1){_.Dom.addClass(t,babelHelpers.classPrivateFieldLooseBase(this,Ta)[Ta].blockLoading)}}else{_.Dom.removeClass(t,babelHelpers.classPrivateFieldLooseBase(this,Ta)[Ta].blockLoading)}}))}assign(){const e=this.getLayout();const s=[];const t=[];this.await(true);if(!babelHelpers.classPrivateFieldLooseBase(this,Ba)[Ba].isSingleton()){s.push({code:babelHelpers.classPrivateFieldLooseBase(this,La)[La],part:babelHelpers.classPrivateFieldLooseBase(this,ya)[ya],data:this.getData()});t.push(this)}else{this.blocksManager.getBlocks().map((e=>{if(e.getCode()===this.getCode()&&e.getMemberPart()===this.getMemberPart()){s.push({code:e.getCode(),part:e.getMemberPart(),data:e.getData()});t.push(e)}}))}babelHelpers.classPrivateFieldLooseBase(this,Ia)[Ia].loadBlocksData(this.blocksManager.getDocumentUid(),s).then((e=>{if(_.Type.isArray(e)){e.forEach(((e,s)=>{t[s].setData(e.data)}))}this.await(false);this.blocksManager.showResizeArea(this)})).catch((s=>{_.Dom.remove(e)}))}renderView(){const e=babelHelpers.classPrivateFieldLooseBase(this,Fa)[Fa].querySelector(babelHelpers.classPrivateFieldLooseBase(this,Ta)[Ta].blockContent);_.Dom.clean(e);switch(babelHelpers.classPrivateFieldLooseBase(this,La)[La].toLowerCase()){case"stamp":case"mystamp":case"sign":case"mysign":_.Dom.addClass(e,"--image")}const s=babelHelpers.classPrivateFieldLooseBase(this,Ba)[Ba].getViewContent();_.Dom.append(s,e);_.Dom.addClass(s,"--"+babelHelpers.classPrivateFieldLooseBase(this,La)[La].toLowerCase());if(["requisites","myrequisites","date","number","stamp","mystamp","sign","mysign","reference","myreference","text","b2ereference","myb2ereference","employeedynamic","hcmlinkreference","b2eexternalid","b2edocumentdate"].includes(babelHelpers.classPrivateFieldLooseBase(this,La)[La].toLowerCase())){s.style.setProperty("display","block");s.style.setProperty("overflow","hidden");if(!this.observerReady){if(this.getStyle().fontSize){this.maxTextSize=parseFloat(this.getStyle().fontSize)}else{this.maxTextSize=14}this.isOverflownY=({clientHeight:e,scrollHeight:s})=>s>e;y.EventEmitter.subscribe(s.parentNode.parentNode,"BX.Sign:setFontSize",(e=>{if(e.data.fontSize){this.maxTextSize=e.data.fontSize;this.resizeText({element:e.target.querySelector(".sign-document__block-content > div"),step:.5})}}));this.resizeText=({element:e,minSize:s=1,step:t=1,unit:l="px"})=>{if(this.intervalTextResize){clearTimeout(this.intervalTextResize)}let i=s;let a=false;const o=e.parentNode;while(!a&&i<=this.maxTextSize){e.style.fontSize=`${i}${l}`;a=this.isOverflownY(o);i+=t}babelHelpers.classPrivateFieldLooseBase(this,Ca)[Ca]=`${i-t}${l}`;e.style.fontSize=babelHelpers.classPrivateFieldLooseBase(this,Ca)[Ca];this.intervalTextResize=setTimeout((()=>{e.parentNode.style.setProperty("font-size",e.style.fontSize);e.style.removeProperty("font-size",e.style.fontSize);if(Pa.has(babelHelpers.classPrivateFieldLooseBase(this,La)[La].toLowerCase())){babelHelpers.classPrivateFieldLooseBase(this,_a)[_a].updateFontSize(babelHelpers.classPrivateFieldLooseBase(this,Ca)[Ca])}}),1e3)};if(babelHelpers.classPrivateFieldLooseBase(this,La)[La].toLowerCase()==="requisites"||babelHelpers.classPrivateFieldLooseBase(this,La)[La].toLowerCase()==="myrequisites"||babelHelpers.classPrivateFieldLooseBase(this,La)[La].toLowerCase()==="reference"||babelHelpers.classPrivateFieldLooseBase(this,La)[La].toLowerCase()==="myreference"||babelHelpers.classPrivateFieldLooseBase(this,La)[La].toLowerCase()==="text"){this.resizeText({element:s,step:.5})}babelHelpers.classPrivateFieldLooseBase(this,Ba)[Ba].subscribe(babelHelpers.classPrivateFieldLooseBase(this,Ba)[Ba].events.onChange,babelHelpers.classPrivateFieldLooseBase(this,Na)[Na].bind(this));babelHelpers.classPrivateFieldLooseBase(this,Ba)[Ba].subscribe(babelHelpers.classPrivateFieldLooseBase(this,Ba)[Ba].events.onColorStyleChange,babelHelpers.classPrivateFieldLooseBase(this,ka)[ka].bind(this));babelHelpers.classPrivateFieldLooseBase(this,Ba)[Ba].subscribe("onFieldSelect",babelHelpers.classPrivateFieldLooseBase(this,wa)[wa].bind(this));this.observerReady=true}if(babelHelpers.classPrivateFieldLooseBase(this,Oa)[Oa]){this.resizeText({element:s,step:.5})}}babelHelpers.classPrivateFieldLooseBase(this,Oa)[Oa]=true;if(babelHelpers.classPrivateFieldLooseBase(this,fa)[fa]){return}const t=babelHelpers.classPrivateFieldLooseBase(this,Fa)[Fa].querySelector(babelHelpers.classPrivateFieldLooseBase(this,Ta)[Ta].blockPanel);_.Dom.clean(t);if(babelHelpers.classPrivateFieldLooseBase(this,Ba)[Ba].isStyleAllowed()){_.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,_a)[_a].getLayout(),t)}_.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,Ba)[Ba].getActionButton(),t);_.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,Ba)[Ba].getBlockCaption(),t);if(babelHelpers.classPrivateFieldLooseBase(this,Ha)[Ha]){if(["hcmlinkreference","b2ereference","b2edocumentdate","b2eexternalid"].includes(babelHelpers.classPrivateFieldLooseBase(this,La)[La].toLowerCase())){return}const e=this.blocksManager.getMembers();const s=e.filter((e=>e.part>1));_.Dom.append(ra.getMemberSelector(s,babelHelpers.classPrivateFieldLooseBase(this,ya)[ya],this.onMemberSelect.bind(this)),t)}babelHelpers.classPrivateFieldLooseBase(this,fa)[fa]=true}getCurrentFontSize(){return babelHelpers.classPrivateFieldLooseBase(this,Ca)[Ca]}onStartChangePosition(){babelHelpers.classPrivateFieldLooseBase(this,Ba)[Ba].onStartChangePosition()}onPlaced(){babelHelpers.classPrivateFieldLooseBase(this,Ba)[Ba].onPlaced()}updateColor(e,s=true){babelHelpers.classPrivateFieldLooseBase(this,Ba)[Ba].changeStyleColor(e,s);babelHelpers.classPrivateFieldLooseBase(this,_a)[_a].updateColor(e)}onSave(){babelHelpers.classPrivateFieldLooseBase(this,Ba)[Ba].onSave()}onRemove(){babelHelpers.classPrivateFieldLooseBase(this,Ba)[Ba].onRemove()}onClickOut(){babelHelpers.classPrivateFieldLooseBase(this,Ba)[Ba].onClickOut()}renderStyle(){babelHelpers.classPrivateFieldLooseBase(this,_a)[_a].applyStyles(babelHelpers.classPrivateFieldLooseBase(this,Fa)[Fa].querySelector(babelHelpers.classPrivateFieldLooseBase(this,Ta)[Ta].blockContent))}adjustActionsPanel(){const e=this.getLayout();const s=this.blocksManager.getLayout().parentElement;const t=s.getBoundingClientRect();const l=e.querySelector('[data-role="sign-block__actions"]');if(l){const e=l.getBoundingClientRect();const s=parseFloat(getComputedStyle(l).marginLeft);if(t.x>=e.x){l.style.marginLeft=t.x-e.x+s+"px"}else{l.style.marginLeft=0}}}forceSave(){babelHelpers.classPrivateFieldLooseBase(this,Fa)[Fa].querySelector('[data-role="saveAction"]').click()}remove(){if(babelHelpers.classPrivateFieldLooseBase(this,Ea)[Ea]){babelHelpers.classPrivateFieldLooseBase(this,Ea)[Ea](this)}babelHelpers.classPrivateFieldLooseBase(this,Fa)[Fa].hidden=true;this.onRemove()}isRemoved(){return babelHelpers.classPrivateFieldLooseBase(this,Fa)[Fa].hidden===true}setMemberParty(e){babelHelpers.classPrivateFieldLooseBase(this,ya)[ya]=e}}function Aa(){if(babelHelpers.classPrivateFieldLooseBase(this,ma)[ma]){babelHelpers.classPrivateFieldLooseBase(this,ma)[ma](this)}}function ja(){babelHelpers.classPrivateFieldLooseBase(this,Fa)[Fa]=ra.getBlockLayout({onSave:e=>{this.renderView();this.blocksManager.unMuteResizeArea();this.blocksManager.hideResizeArea();this.blocksManager.setSavingMark(false);this.onSave();_.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,Fa)[Fa],babelHelpers.classPrivateFieldLooseBase(this,Ta)[Ta].blockEditing);e.stopPropagation()},onRemove:babelHelpers.classPrivateFieldLooseBase(this,Da)[Da].bind(this)});const e=document.body.querySelector(".sign-editor__content");const s=this.blocksManager.getLayout();const t=s.getBoundingClientRect();const l=babelHelpers.classPrivateFieldLooseBase(this,Ba)[Ba].getInitDimension();const i={top:Math.min(e.scrollTop+e.offsetHeight/2,t.height-l.height),left:t.width/2-100};if(this.blocksManager.inDeadZone(i.top,i.top+l.height)){i.top+=l.height+this.blocksManager.getPagesGap()}this.setPosition(i)}function xa(e){this.remove();e.stopPropagation()}function Ga(){const e=babelHelpers.classPrivateFieldLooseBase(this,Ba)[Ba];if(!(e instanceof _t)){return}this.resizeText({element:e.getContainer(),step:.5})}function $a(e){var s,t,l,i;this.emit(this.events.onColorStyleChange,{color:(s=(t=babelHelpers.classPrivateFieldLooseBase(this,Ba)[Ba].getStyles())==null?void 0:t.color)!=null?s:null});const a=(l=(i=babelHelpers.classPrivateFieldLooseBase(this,Ba)[Ba].getStyles())==null?void 0:i.color)!=null?l:null;if(_.Type.isString(a)){babelHelpers.classPrivateFieldLooseBase(this,_a)[_a].updateColor(a)}}function Ua(e){this.emit("onFieldSelect",e)}var za=babelHelpers.classPrivateFieldLooseKey("wrapperLayout");var Ya=babelHelpers.classPrivateFieldLooseKey("layout");var Va=babelHelpers.classPrivateFieldLooseKey("fullEditorContent");var Xa=babelHelpers.classPrivateFieldLooseKey("linkedElement");var qa=babelHelpers.classPrivateFieldLooseKey("linkedBlock");var Ja=babelHelpers.classPrivateFieldLooseKey("style");var Qa=babelHelpers.classPrivateFieldLooseKey("onClick");var Wa=babelHelpers.classPrivateFieldLooseKey("initResize");var Za=babelHelpers.classPrivateFieldLooseKey("initMove");class eo{constructor(e){Object.defineProperty(this,Za,{value:lo});Object.defineProperty(this,Wa,{value:to});Object.defineProperty(this,Qa,{value:so});Object.defineProperty(this,za,{writable:true,value:void 0});Object.defineProperty(this,Ya,{writable:true,value:void 0});Object.defineProperty(this,Va,{writable:true,value:void 0});Object.defineProperty(this,Xa,{writable:true,value:void 0});Object.defineProperty(this,qa,{writable:true,value:void 0});Object.defineProperty(this,Ja,{writable:true,value:{resizeContainer:".sign-area-resizable-controls > div",moveContainer:".sign-document__resize-area",blockEditing:"sign-document__block-wrapper-editing"}});if(!_.Type.isDomNode(e.wrapperLayout)){throw new Error("Option wrapperLayout is undefined or not valid DOM Element.")}babelHelpers.classPrivateFieldLooseBase(this,Ya)[Ya]=ra.getResizeArea();babelHelpers.classPrivateFieldLooseBase(this,za)[za]=e.wrapperLayout;_.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,Ya)[Ya],"click",babelHelpers.classPrivateFieldLooseBase(this,Qa)[Qa].bind(this));babelHelpers.classPrivateFieldLooseBase(this,Wa)[Wa]();babelHelpers.classPrivateFieldLooseBase(this,Za)[Za]()}getLayout(){return babelHelpers.classPrivateFieldLooseBase(this,Ya)[Ya]}show(e){if(babelHelpers.classPrivateFieldLooseBase(this,qa)[qa]===e){return}const s=e.getLayout().getBoundingClientRect();babelHelpers.classPrivateFieldLooseBase(this,Ya)[Ya].style.display="block";if(babelHelpers.classPrivateFieldLooseBase(this,Xa)[Xa]){babelHelpers.classPrivateFieldLooseBase(this,Xa)[Xa].removeAttribute("data-active")}babelHelpers.classPrivateFieldLooseBase(this,qa)[qa]=e;babelHelpers.classPrivateFieldLooseBase(this,Xa)[Xa]=e.getLayout();babelHelpers.classPrivateFieldLooseBase(this,Xa)[Xa].setAttribute("data-active",1);const t=babelHelpers.classPrivateFieldLooseBase(this,za)[za].getBoundingClientRect();ra.setRect(babelHelpers.classPrivateFieldLooseBase(this,Ya)[Ya],{top:s.top-t.top,left:s.left-t.left,width:s.width+eo.borderDelta,height:s.height+eo.borderDelta})}setFullEditorContent(e){babelHelpers.classPrivateFieldLooseBase(this,Va)[Va]=e}hide(){babelHelpers.classPrivateFieldLooseBase(this,qa)[qa]=null;babelHelpers.classPrivateFieldLooseBase(this,Ya)[Ya].style.display="none";if(babelHelpers.classPrivateFieldLooseBase(this,Xa)[Xa]){babelHelpers.classPrivateFieldLooseBase(this,Xa)[Xa].removeAttribute("data-active")}}getLinkedBlock(){return babelHelpers.classPrivateFieldLooseBase(this,qa)[qa]}}function so(e){if(this.moving||this.resizing){return}if(babelHelpers.classPrivateFieldLooseBase(this,qa)[qa]){babelHelpers.classPrivateFieldLooseBase(this,qa)[qa].fireAction()}}function to(){let e=null;const s=new B.Draggable({container:babelHelpers.classPrivateFieldLooseBase(this,za)[za],draggable:babelHelpers.classPrivateFieldLooseBase(this,Ja)[Ja].resizeContainer,type:BX.UI.DragAndDrop.Draggable.HEADLESS});this.textResize={wrapper:null,content:null};s.subscribe("start",(t=>{if(babelHelpers.classPrivateFieldLooseBase(this,Ya)[Ya].getAttribute("data-disable")){return}if(!this.textResize.wrapper||!this.textResize.content){this.textResize={wrapper:babelHelpers.classPrivateFieldLooseBase(this,qa)[qa].getLayout(),content:babelHelpers.classPrivateFieldLooseBase(this,qa)[qa].getLayout().querySelector(".sign-document__block-content")}}y.EventEmitter.emit("BX.Sign:resizeStart",s);e=babelHelpers.classPrivateFieldLooseBase(this,Ya)[Ya].getBoundingClientRect();babelHelpers.classPrivateFieldLooseBase(this,qa)[qa].onStartChangePosition();this.positionLast=null;_.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,qa)[qa].getLayout(),babelHelpers.classPrivateFieldLooseBase(this,Ja)[Ja].blockEditing)})).subscribe("end",(e=>{setTimeout((()=>{this.resizing=false}),0)})).subscribe("move",(s=>{if(babelHelpers.classPrivateFieldLooseBase(this,Ya)[Ya].getAttribute("data-disable")){return}this.resizing=true;let t=null;let l=null;let i=false;let{width:a,height:o}=e;const r=s.getData();const n=babelHelpers.classPrivateFieldLooseBase(this,Ya)[Ya].getBoundingClientRect();const c=babelHelpers.classPrivateFieldLooseBase(this,za)[za].getBoundingClientRect();if(_.Dom.hasClass(r.draggable,"sign-document__resize-control --left-top")){t=Math.max(0,e.left+r.offsetX-c.left);l=Math.max(0,e.top+r.offsetY-c.top);a=e.width-r.offsetX;o=e.height-r.offsetY}if(_.Dom.hasClass(r.draggable,"sign-document__resize-control --middle-top")){l=Math.max(0,e.top+r.offsetY-c.top);o=e.height-r.offsetY}if(_.Dom.hasClass(r.draggable,"sign-document__resize-control --right-top")){l=Math.max(0,e.top+r.offsetY-c.top);a=e.width+r.offsetX;o=e.height-r.offsetY}if(_.Dom.hasClass(r.draggable,"sign-document__resize-control --middle-right")){a=e.width+r.offsetX}if(_.Dom.hasClass(r.draggable,"sign-document__resize-control --right-bottom")){a=e.width+r.offsetX;o=e.height+r.offsetY;i=true}if(_.Dom.hasClass(r.draggable,"sign-document__resize-control --middle-bottom")){o=e.height+r.offsetY;i=true}if(_.Dom.hasClass(r.draggable,"sign-document__resize-control --left-bottom")){t=e.left+r.offsetX-c.left;a=e.width-r.offsetX;o=e.height+r.offsetY;i=true}if(_.Dom.hasClass(r.draggable,"sign-document__resize-control --middle-left")){t=e.left+r.offsetX-c.left;a=e.width-r.offsetX}if(a<60||o<20){return}const d={width:a,height:o};if(d["width"]+n.left-c.left>c.width){a=d["width"]=c.width+c.left-n.left}if(d["height"]+n.top-c.top>c.height){o=d["height"]=c.height+c.top-n.top}if(t){if(t<0){t=0}d["left"]=t}if(l){d["top"]=l}let b=e.top;let p=true;if(d.top){b=d.top;p=false}if(babelHelpers.classPrivateFieldLooseBase(this,qa)[qa].blocksManager.inDeadZone(b,b+d.height,p)){if(!i){babelHelpers.classPrivateFieldLooseBase(this,qa)[qa].showNotAllowedArea()}return}const v=Object.assign({},{...d,width:a-eo.borderDelta,height:o-eo.borderDelta});ra.setRect(babelHelpers.classPrivateFieldLooseBase(this,Ya)[Ya],d);ra.setRect(babelHelpers.classPrivateFieldLooseBase(this,Xa)[Xa],v);babelHelpers.classPrivateFieldLooseBase(this,qa)[qa].renderView();babelHelpers.classPrivateFieldLooseBase(this,qa)[qa].blocksManager.setSavingMark(false);babelHelpers.classPrivateFieldLooseBase(this,qa)[qa].adjustActionsPanel()}))}function lo(){const e=babelHelpers.classPrivateFieldLooseBase(this,za)[za];let s;const t=new B.Draggable({container:e,draggable:babelHelpers.classPrivateFieldLooseBase(this,Ja)[Ja].moveContainer,type:B.Draggable.HEADLESS});t.subscribe("start",(e=>{if(babelHelpers.classPrivateFieldLooseBase(this,Ya)[Ya].getAttribute("data-disable")){return}y.EventEmitter.emit("BX.Sign:moveStart",t);if(this.resizing){return}const{source:s}=e.getData();this.position=_.Dom.getPosition(s);babelHelpers.classPrivateFieldLooseBase(this,qa)[qa].onStartChangePosition();this.positionLast=null;_.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,qa)[qa].getLayout(),babelHelpers.classPrivateFieldLooseBase(this,Ja)[Ja].blockEditing)})).subscribe("end",(e=>{setTimeout((()=>{this.moving=false}),0);if(!babelHelpers.classPrivateFieldLooseBase(this,qa)[qa]){return}if(this.resizing){return}s=null;const t=e.getData();let l=null;if(this.positionLast){l=babelHelpers.classPrivateFieldLooseBase(this,qa)[qa].blocksManager.inDeadZone(this.positionLast.top,this.positionLast.top+this.positionLast.height)}babelHelpers.classPrivateFieldLooseBase(this,qa)[qa].hideNotAllowedArea();if(l){ra.setRect(t.source,{top:this.positionLast.top+l});ra.setRect(babelHelpers.classPrivateFieldLooseBase(this,Xa)[Xa],{top:this.positionLast.top+l})}})).subscribe("move",(e=>{if(babelHelpers.classPrivateFieldLooseBase(this,Ya)[Ya].getAttribute("data-disable")){return}if(this.resizing){return}this.moving=true;const t=e.getData();const{source:l,offsetY:i,offsetX:a}=t;const o=t.source.getBoundingClientRect();const r=babelHelpers.classPrivateFieldLooseBase(this,za)[za].getBoundingClientRect();if(this.position){const e={top:i-r.top+this.position.y,left:a-r.left+this.position.x,width:s?s:this.position.width,height:this.position.height};if(e.left<0){e.left=0}if(e.top<0){e.top=0}if(e.top+o.height>r.height){e.top=r.height-o.height}if(e.left+o.width>r.width){babelHelpers.classPrivateFieldLooseBase(this,qa)[qa].renderView();if(r.width-e.left>50){s=e.width=r.width-e.left}else{e.left=r.width-o.width}}this.positionLast=Object.assign({},e);let t=null;if(this.positionLast){t=babelHelpers.classPrivateFieldLooseBase(this,qa)[qa].blocksManager.inDeadZone(this.positionLast.top,this.positionLast.top+this.positionLast.height)}if(t>0){babelHelpers.classPrivateFieldLooseBase(this,qa)[qa].showNotAllowedArea()}else{babelHelpers.classPrivateFieldLooseBase(this,qa)[qa].hideNotAllowedArea()}const n=Object.assign({},{...e,width:e.width-eo.borderDelta,height:e.height-eo.borderDelta});ra.setRect(l,e);ra.setRect(babelHelpers.classPrivateFieldLooseBase(this,Xa)[Xa],n);babelHelpers.classPrivateFieldLooseBase(this,qa)[qa].blocksManager.setSavingMark(false);babelHelpers.classPrivateFieldLooseBase(this,qa)[qa].adjustActionsPanel()}}))}eo.borderDelta=2;const io=0;const ao=20;var oo=babelHelpers.classPrivateFieldLooseKey("documentId");var ro=babelHelpers.classPrivateFieldLooseKey("documentUid");var no=babelHelpers.classPrivateFieldLooseKey("companyId");var co=babelHelpers.classPrivateFieldLooseKey("initiatorName");var bo=babelHelpers.classPrivateFieldLooseKey("entityId");var po=babelHelpers.classPrivateFieldLooseKey("blankId");var vo=babelHelpers.classPrivateFieldLooseKey("pagesMinHeight");var uo=babelHelpers.classPrivateFieldLooseKey("disableEdit");var ho=babelHelpers.classPrivateFieldLooseKey("closeDemoContent");var Po=babelHelpers.classPrivateFieldLooseKey("members");var go=babelHelpers.classPrivateFieldLooseKey("documentLayout");var Lo=babelHelpers.classPrivateFieldLooseKey("languages");var Fo=babelHelpers.classPrivateFieldLooseKey("blocks");var _o=babelHelpers.classPrivateFieldLooseKey("eventListeners");var Bo=babelHelpers.classPrivateFieldLooseKey("pagesRects");var yo=babelHelpers.classPrivateFieldLooseKey("seams");var fo=babelHelpers.classPrivateFieldLooseKey("config");var Ho=babelHelpers.classPrivateFieldLooseKey("helpBtnElementId");var mo=babelHelpers.classPrivateFieldLooseKey("helpBtnHelperArticleCode");var Eo=babelHelpers.classPrivateFieldLooseKey("api");var So=babelHelpers.classPrivateFieldLooseKey("lastContainerSize");var Co=babelHelpers.classPrivateFieldLooseKey("cache");var To=babelHelpers.classPrivateFieldLooseKey("pixelToPercent");var Oo=babelHelpers.classPrivateFieldLooseKey("percentToPixel");var Io=babelHelpers.classPrivateFieldLooseKey("addBlock");var Ro=babelHelpers.classPrivateFieldLooseKey("subscribeOnBlockEvents");var Mo=babelHelpers.classPrivateFieldLooseKey("onRepositoryItemClick");var Do=babelHelpers.classPrivateFieldLooseKey("startDisabledEditDocumentTour");var No=babelHelpers.classPrivateFieldLooseKey("startEditDocumentTour");var ko=babelHelpers.classPrivateFieldLooseKey("highlightInvalidBlocks");var wo=babelHelpers.classPrivateFieldLooseKey("onBlockColorStyleChange");var Ko=babelHelpers.classPrivateFieldLooseKey("onReferenceBlockFieldSelect");var Ao=babelHelpers.classPrivateFieldLooseKey("onB2eReferenceBlockFieldSelect");var jo=babelHelpers.classPrivateFieldLooseKey("onBlockDeleteBecauseFieldNotSelected");var xo=babelHelpers.classPrivateFieldLooseKey("onB2eReferenceBlockDeleteBecauseFieldNotSelected");var Go=babelHelpers.classPrivateFieldLooseKey("unsubscribeFromBlocksEvents");class $o{constructor(e){Object.defineProperty(this,Go,{value:lr});Object.defineProperty(this,xo,{value:tr});Object.defineProperty(this,jo,{value:sr});Object.defineProperty(this,Ao,{value:er});Object.defineProperty(this,Ko,{value:Zo});Object.defineProperty(this,wo,{value:Wo});Object.defineProperty(this,ko,{value:Qo});Object.defineProperty(this,No,{value:Jo});Object.defineProperty(this,Do,{value:qo});Object.defineProperty(this,Mo,{value:Xo});Object.defineProperty(this,Ro,{value:Vo});Object.defineProperty(this,Io,{value:Yo});Object.defineProperty(this,Oo,{value:zo});Object.defineProperty(this,To,{value:Uo});Object.defineProperty(this,oo,{writable:true,value:void 0});Object.defineProperty(this,ro,{writable:true,value:void 0});Object.defineProperty(this,no,{writable:true,value:void 0});Object.defineProperty(this,co,{writable:true,value:void 0});Object.defineProperty(this,bo,{writable:true,value:void 0});Object.defineProperty(this,po,{writable:true,value:void 0});Object.defineProperty(this,vo,{writable:true,value:0});Object.defineProperty(this,uo,{writable:true,value:void 0});Object.defineProperty(this,ho,{writable:true,value:false});Object.defineProperty(this,Po,{writable:true,value:void 0});Object.defineProperty(this,go,{writable:true,value:void 0});Object.defineProperty(this,Lo,{writable:true,value:{}});Object.defineProperty(this,Fo,{writable:true,value:[]});Object.defineProperty(this,_o,{writable:true,value:{blockColorChange:new Map,blockReferenceFieldSelect:new Map,blockB2eReferenceFieldSelect:new Map}});Object.defineProperty(this,Bo,{writable:true,value:[]});Object.defineProperty(this,yo,{writable:true,value:[]});Object.defineProperty(this,fo,{writable:true,value:void 0});Object.defineProperty(this,Ho,{writable:true,value:"sign-editor-help-btn"});Object.defineProperty(this,mo,{writable:true,value:"16571388"});Object.defineProperty(this,Eo,{writable:true,value:void 0});Object.defineProperty(this,So,{writable:true,value:void 0});Object.defineProperty(this,Co,{writable:true,value:new _.Cache.MemoryCache});this.isTemplateMode=false;this.documentInitiatedByType=null;const{documentLayout:s,disableEdit:t,isTemplateMode:l,documentInitiatedByType:i}=e;this.isTemplateMode=Boolean(l);this.documentInitiatedByType=i;babelHelpers.classPrivateFieldLooseBase(this,go)[go]=s;babelHelpers.classPrivateFieldLooseBase(this,uo)[uo]=t;if(!babelHelpers.classPrivateFieldLooseBase(this,uo)[uo]){this.resizeArea=new eo({wrapperLayout:babelHelpers.classPrivateFieldLooseBase(this,go)[go]});_.Dom.append(this.resizeArea.getLayout(),babelHelpers.classPrivateFieldLooseBase(this,go)[go])}_.Event.bind(s,"click",(({target:e})=>{const s=e.closest(".sign-document__block-wrapper")||e.closest(".sign-document__resize-area");if(s){return}const t=this.resizeArea.getLinkedBlock();t==null?void 0:t.onClickOut()}));babelHelpers.classPrivateFieldLooseBase(this,Lo)[Lo]=e.languages;babelHelpers.classPrivateFieldLooseBase(this,Eo)[Eo]=new f.Api;babelHelpers.classPrivateFieldLooseBase(this,So)[So]={width:0,height:0}}initPagesRect(){let e=0;const s=[...babelHelpers.classPrivateFieldLooseBase(this,go)[go].querySelectorAll(".sign-editor__document_page img")];babelHelpers.classPrivateFieldLooseBase(this,Bo)[Bo]=[];babelHelpers.classPrivateFieldLooseBase(this,yo)[yo]=[];const t=document.querySelector(".sign-editor__content");s.forEach((s=>{const l=s.getBoundingClientRect();const i={};for(let e in l){if(_.Type.isNumber(l[e])){i[e]=Math.round(l[e])}else{i[e]=l[e]}}const a=e===0?0:i.top-ao+t.scrollTop;const o=i.top+io+t.scrollTop;babelHelpers.classPrivateFieldLooseBase(this,yo)[yo].push([a,o]);if(e===0){e=i.top}else{e+=ao;i.top=e}babelHelpers.classPrivateFieldLooseBase(this,Bo)[Bo].push(i);if(!babelHelpers.classPrivateFieldLooseBase(this,vo)[vo]||l.height<babelHelpers.classPrivateFieldLooseBase(this,vo)[vo]){babelHelpers.classPrivateFieldLooseBase(this,vo)[vo]=l.height}}));babelHelpers.classPrivateFieldLooseBase(this,go)[go].style.width=`${babelHelpers.classPrivateFieldLooseBase(this,go)[go].offsetWidth}px`}transferPositionToPage(e){e.page=1;for(let s=0,t=babelHelpers.classPrivateFieldLooseBase(this,Bo)[Bo].length;s<t;s++){const t=babelHelpers.classPrivateFieldLooseBase(this,Bo)[Bo][s].height;if(s!==0){e.top-=ao}e.top-=t;if(e.top<0){e.top+=t;break}else{e.page++}}return e}getMinPageHeight(){return babelHelpers.classPrivateFieldLooseBase(this,vo)[vo]-io}getDocumentId(){return babelHelpers.classPrivateFieldLooseBase(this,oo)[oo]}setDocumentId(e){babelHelpers.classPrivateFieldLooseBase(this,oo)[oo]=e;return this}getDocumentUid(){return babelHelpers.classPrivateFieldLooseBase(this,ro)[ro]}setEditorContent(e){this.resizeArea.setFullEditorContent(e)}setDocumentUid(e){babelHelpers.classPrivateFieldLooseBase(this,ro)[ro]=e;return this}getEntityId(){return babelHelpers.classPrivateFieldLooseBase(this,bo)[bo]}getLayout(){return babelHelpers.classPrivateFieldLooseBase(this,go)[go]}getSeams(){return babelHelpers.classPrivateFieldLooseBase(this,yo)[yo]}getPagesGap(){return ao+io}addMembers(e){babelHelpers.classPrivateFieldLooseBase(this,Po)[Po]=e}getMembers(){return babelHelpers.classPrivateFieldLooseBase(this,Po)[Po]}getMemberByPart(e){let s=null;babelHelpers.classPrivateFieldLooseBase(this,Po)[Po].map((t=>{if(t.part===e){s=t}}));return s}getCompanyId(){return babelHelpers.classPrivateFieldLooseBase(this,no)[no]}getInitiatorName(){return babelHelpers.classPrivateFieldLooseBase(this,co)[co]}getConfig(){return babelHelpers.classPrivateFieldLooseBase(this,fo)[fo]}hideResizeArea(){this.resizeArea.hide()}showResizeArea(e){this.resizeArea.show(e)}muteResizeArea(){this.resizeArea.getLayout().setAttribute("data-disable",1)}unMuteResizeArea(){this.resizeArea.getLayout().removeAttribute("data-disable")}initBlocks(e){babelHelpers.classPrivateFieldLooseBase(this,Go)[Go]();babelHelpers.classPrivateFieldLooseBase(this,Fo)[Fo]=[];this.hideResizeArea();e.map((e=>babelHelpers.classPrivateFieldLooseBase(this,Io)[Io](e,true)))}initRepository(e){[...e].forEach((e=>{const s=e.getAttribute("data-code");const t=e.getAttribute("data-part");_.Event.bind(e,"click",(e=>{babelHelpers.classPrivateFieldLooseBase(this,Mo)[Mo](s,t);e.preventDefault()}))}))}getBlocks(){return babelHelpers.classPrivateFieldLooseBase(this,Fo)[Fo]}getLanguages(){return babelHelpers.classPrivateFieldLooseBase(this,Lo)[Lo]}save(){const e=[];const s=document.querySelector(".sign-editor__document").offsetWidth;babelHelpers.classPrivateFieldLooseBase(this,Fo)[Fo].map((t=>{if(t.isRemoved()){return}const l=t.getLayout();const i=l.getBoundingClientRect();const a=[...babelHelpers.classPrivateFieldLooseBase(this,go)[go].querySelectorAll(".sign-editor__document_page img")];const o=a.map((e=>{const{top:s,left:t,width:l,height:i}=e.getBoundingClientRect();return{top:s,left:t,width:l,height:i}}));const r=o.find((e=>{if(Math.round(i.top)<Math.round(e.top)){return true}return false}));const n=r?o.indexOf(r):o.length;const c=o[n-1];let d={top:i.top-c.top,left:i.left-c.left,width:i.width,height:i.height,page:n};d=babelHelpers.classPrivateFieldLooseBase(this,To)[To](d,c);d.realDocumentWidthPx=s?s:null;const b=t.getCode();let p="text";switch(b){case"stamp":case"mystamp":case"sign":case"mysign":p="image";break;default:p="text"}e.push({id:t.getId(),code:t.getCode(),data:t.getData(),party:t.getMemberPart(),style:t.getStyle(),position:d,type:p})}));if(babelHelpers.classPrivateFieldLooseBase(this,ho)[ho]);this.hideResizeArea();return babelHelpers.classPrivateFieldLooseBase(this,Eo)[Eo].saveBlank(this.getDocumentUid(),e.length>0?e:[]).then((s=>{var t;if(!("errors"in s)){return e}if(((t=s.errors[0].customData)==null?void 0:t.field)==="requisites"){var i;const e=new l.Popup({id:"sign_document_error_popup",titleBar:_.Loc.getMessage("SIGN_JS_DOCUMENT_REQUISITES_RESTORE_TITLE"),content:BX.util.htmlspecialchars((i=s.errors[0])==null?void 0:i.message),buttons:[new o.Button({text:_.Loc.getMessage("SIGN_JS_DOCUMENT_REQUISITES_RESTORE"),color:o.ButtonColor.SUCCESS,onclick:({button:t})=>{var l,i;const a=t;_.Dom.addClass(a,"ui-btn-wait");c.Backend.controller({command:"document.restoreRequisiteFields",postData:{documentId:babelHelpers.classPrivateFieldLooseBase(this,oo)[oo],presetId:(l=s.errors[0])==null?void 0:l.customData.presetId,code:(i=s.errors[0])==null?void 0:i.customData.code}}).then((()=>{_.Dom.removeClass(a,"ui-btn-wait");babelHelpers.classPrivateFieldLooseBase(this,Fo)[Fo].map((e=>{var t;if(e.isRemoved()){return}if(e.getCode()===((t=s.errors[0])==null?void 0:t.customData.code)){e.assign()}}));e.destroy()})).catch((()=>{e.destroy()}))}}),new o.Button({text:_.Loc.getMessage("SIGN_JS_DOCUMENT_REQUISITES_RESTORE_BY_HANDS"),color:o.ButtonColor.INFO,onclick:()=>{babelHelpers.classPrivateFieldLooseBase(this,Fo)[Fo].map((e=>{var t;if(e.isRemoved()){return}if(e.getCode()===((t=s.errors[0])==null?void 0:t.customData.code)){const s=document.querySelector(`button[data-id="action-${e.getCode()}]`);if(s){s.click()}}}));e.destroy()}})]});e.show();return null}const a=s.errors[0];if(a.code==="REFERENCE_ERROR_FIELD_NOT_SELECTED"){babelHelpers.classPrivateFieldLooseBase(this,ko)[ko]();const e=new l.Popup({id:"sign_document_error_popup",titleBar:_.Loc.getMessage("SIGN_EDITOR_ERROR_SAVE_REFERENCE_BACK_TITLE"),content:BX.util.htmlspecialchars(a.message),buttons:[new o.Button({text:_.Loc.getMessage("SIGN_EDITOR_ERROR_SAVE_REFERENCE_BACK"),color:o.ButtonColor.PRIMARY,onclick:()=>{e.destroy()}})]});y.EventEmitter.subscribeOnce("SidePanel.Slider:onCloseComplete",(()=>{e.destroy()}));e.show();return null}console.error(a.message);return e}))}onSave(e){_.Event.bind(e.saveButton,"click",(s=>{if(babelHelpers.classPrivateFieldLooseBase(this,uo)[uo]){if(e.afterSaveCallback){e.afterSaveCallback()}return}this.save().then((s=>{if(s===true){this.setSavingMark(true);if(e.afterSaveCallback){e.afterSaveCallback()}}if(s!==true){if(e.saveErrorCallback){e.saveErrorCallback()}}}))}))}onCloseSlider(){BX.addCustomEvent("SidePanel.Slider:onClose",(e=>{if(e.slider.url.indexOf("/sign/edit/")===0){if(!this.everythingIsSaved()){e.denyAction();r.MessageBox.confirm(_.Loc.getMessage("SIGN_JS_DOCUMENT_SAVE_ALERT_MESSAGE"),_.Loc.getMessage("SIGN_JS_DOCUMENT_SAVE_ALERT_TITLE"),(s=>{this.setSavingMark(true);s.close();e.slider.close()}),_.Loc.getMessage("SIGN_JS_DOCUMENT_SAVE_ALERT_APPLY"),(e=>{e.close()}))}}}))}setSavingMark(e){this.setParam("bxSignEditorAllSaved",e)}everythingIsSaved(){return this.getParam("bxSignEditorAllSaved")===true}setParam(e,s){const t=BX.SidePanel.Instance.getSliderByWindow(window);if(t){t.getData().set(e,s)}}getParam(e){const s=BX.SidePanel.Instance.getSliderByWindow(window);if(s){return s.getData().get(e)}return undefined}inDeadZone(e,s,t){const l=this.getSeams();const i=document.querySelector(".sign-editor__content");e+=i.scrollTop;s+=i.scrollTop;if(l.length>0&&t!==true){const t=babelHelpers.classPrivateFieldLooseBase(this,go)[go].getBoundingClientRect();e+=t.top;s+=t.top}for(let t=0,i=l.length;t<i;t++){const i=l[t];if(e<=i[0]&&s>=i[0]&&s<=i[1]){return i[0]-s}if(e<=i[0]&&s>=i[1]){return i[0]-s}if(e>=i[0]&&s<=i[1]){return i[0]-s}if(e>=i[0]&&e<=i[1]&&s>=i[1]){return i[1]-e}}return 0}}function Uo(e,s){e.widthPx=e.width;e.heightPx=e.height;e.left=e.left*100/s.width;e.top=e.top*100/s.height;e.width=e.width/s.width*100;e.height=e.height/s.height*100;return e}function zo(e){if(!e.page||typeof babelHelpers.classPrivateFieldLooseBase(this,Bo)[Bo][e.page-1]==="undefined"){return e}const s=babelHelpers.classPrivateFieldLooseBase(this,Bo)[Bo][e.page-1];const t={};if(typeof e.left==="number"){t.left=e.left*s.width/100}if(typeof e.top==="number"){let l=e.top*s.height/100;let i=0;while(i<e.page-1){l+=babelHelpers.classPrivateFieldLooseBase(this,Bo)[Bo][i].height+ao;i++}t.top=l}if(typeof e.width==="number"){t.width=e.width*s.width/100}if(typeof e.height==="number"){t.height=e.height*s.height/100}return t}function Yo(e,s){const t=e.position?babelHelpers.classPrivateFieldLooseBase(this,Oo)[Oo](e.position):null;const l=new Ka({id:e.id,code:e.code,party:e.party,blocksManager:this,data:e.data,position:t,style:e.style,onClick:e=>{if(babelHelpers.classPrivateFieldLooseBase(this,uo)[uo]){return}this.resizeArea.show(e);this.unMuteResizeArea();e.adjustActionsPanel()},onRemove:e=>{this.resizeArea.hide()}});const i=l.getLayout();babelHelpers.classPrivateFieldLooseBase(this,Ro)[Ro](l);if(["sign","mysign"].includes(l.getCode())){var a;const e=babelHelpers.classPrivateFieldLooseBase(this,Fo)[Fo].find((e=>e.getCode()===l.getCode()));const s=e==null?void 0:e.getStyle==null?void 0:(a=e.getStyle())==null?void 0:a.color;if(!_.Type.isNil(s)){l.updateColor(s,false)}}babelHelpers.classPrivateFieldLooseBase(this,Fo)[Fo].push(l);_.Dom.append(i,babelHelpers.classPrivateFieldLooseBase(this,go)[go]);return l}function Vo(e){const s=e.getCode();if(["sign","mysign"].includes(s)){const s=s=>babelHelpers.classPrivateFieldLooseBase(this,wo)[wo](e,s);babelHelpers.classPrivateFieldLooseBase(this,_o)[_o].blockColorChange.set(e,{subscription:s,eventName:e.events.onColorStyleChange});e.subscribe(e.events.onColorStyleChange,s)}else if(["myreference","reference"].includes(s)){const s=s=>babelHelpers.classPrivateFieldLooseBase(this,Ko)[Ko](e,s);babelHelpers.classPrivateFieldLooseBase(this,_o)[_o].blockReferenceFieldSelect.set(e,{subscription:s,eventName:"onFieldSelect"});e.subscribe("onFieldSelect",s)}else if(["b2ereference","myb2ereference","employeedynamic","hcmlinkreference"].includes(s)){const s=s=>babelHelpers.classPrivateFieldLooseBase(this,Ao)[Ao](e,s);babelHelpers.classPrivateFieldLooseBase(this,_o)[_o].blockB2eReferenceFieldSelect.set(e,{subscription:s,eventName:"onFieldSelect"});e.subscribe("onFieldSelect",s)}}function Xo(e,s){s=parseInt(s);this.setSavingMark(false);const t=babelHelpers.classPrivateFieldLooseBase(this,Io)[Io]({code:e,party:s});t.assign();t.onPlaced()}function qo(){const e=new i.Guide({steps:[{target:document.getElementById("sign-editor-btn-edit"),title:_.Loc.getMessage("SIGN_JS_DOCUMENT_TOUR_BTN_EDIT_TITLE"),text:_.Loc.getMessage("SIGN_JS_DOCUMENT_TOUR_BTN_EDIT_TEXT")}],id:"sign-tour-guide-onboarding-master-document-edit-disabled",autoSave:true,simpleMode:true});e.startOnce()}function Jo(){const e=new BX.SpotLight({targetElement:document.getElementById(babelHelpers.classPrivateFieldLooseBase(this,Ho)[Ho]),targetVertex:"middle-center",autoSave:true,id:"sign-spotlight-onboarding-master-document-edit"});const s=new i.Guide({steps:[{target:document.getElementById("sign-editor-bar-content"),title:_.Loc.getMessage("SIGN_JS_DOCUMENT_TOUR_BTN_BLOCKS_TITLE"),text:_.Loc.getMessage("SIGN_JS_DOCUMENT_TOUR_BTN_BLOCKS_TEXT"),position:"left"},{target:document.getElementById(babelHelpers.classPrivateFieldLooseBase(this,Ho)[Ho]),title:_.Loc.getMessage("SIGN_JS_DOCUMENT_TOUR_BTN_HELP_TITLE"),text:_.Loc.getMessage("SIGN_JS_DOCUMENT_TOUR_BTN_HELP_TEXT"),rounded:true,article:babelHelpers.classPrivateFieldLooseBase(this,mo)[mo],events:{onShow:()=>e.show(),onClose:()=>e.close()}}],id:"sign-tour-guide-onboarding-master-document-edit",autoSave:true,simpleMode:true});s.startOnce()}function Qo(){babelHelpers.classPrivateFieldLooseBase(this,Fo)[Fo].forEach((e=>{if(e.isRemoved()){return}const s=e.getCode();const t=s==="reference"||s==="myreference";if(t&&_.Type.isArray(e.getData())){_.Dom.addClass(e.getLayout(),"--invalid")}}))}function Wo(e,s){var t;if(!["sign","mysign"].includes(e.getCode())){return}const l=(t=s.getData().color)!=null?t:null;if(_.Type.isNull(l)){return}babelHelpers.classPrivateFieldLooseBase(this,Fo)[Fo].filter((s=>e.getCode()===s.getCode())).forEach((s=>{if(e===s){return}s.updateColor(l,false)}))}function Zo(e,s){if(s.getData().selectedFieldNames.length===0){const s=150;setTimeout((()=>babelHelpers.classPrivateFieldLooseBase(this,jo)[jo](e)),s)}}function er(e,s){if(s.getData().selectedFieldNames.length===0){const s=150;setTimeout((()=>babelHelpers.classPrivateFieldLooseBase(this,xo)[xo](e)),s)}}function sr(e){e.remove();babelHelpers.classPrivateFieldLooseBase(this,Co)[Co].remember("notify",(()=>b.UI.Notification.Center.notify({content:_.Text.encode(_.Loc.getMessage("SIGN_EDITOR_ERROR_REFERENCE_BLOCK_FIELD_NOT_SELECTED_HINT_TEXT")),autoHideDelay:3e3,width:480})))}function tr(e){e.remove();babelHelpers.classPrivateFieldLooseBase(this,Co)[Co].remember("notifyB2e",(()=>b.UI.Notification.Center.notify({content:_.Text.encode(_.Loc.getMessage("SIGN_EDITOR_ERROR_B2E_REFERENCE_BLOCK_FIELD_NOT_SELECTED_HINT_TEXT")),autoHideDelay:3e3,width:480})))}function lr(){const e=Object.values(babelHelpers.classPrivateFieldLooseBase(this,_o)[_o]).flatMap((e=>[...e.entries()]));for(const[s,{subscription:t,eventName:l}]of e){s.unsubscribe(l,t)}Object.values(babelHelpers.classPrivateFieldLooseBase(this,_o)[_o]).forEach((e=>e.clear()))}let ir=e=>e,ar,or,rr,nr,cr,dr,br,pr,vr,ur,hr;const Pr=["ui-btn","ui-btn-sm","ui-btn-round","ui-btn-light-border"];const gr=Object.freeze({General:0,FirstParty:1,SecondParty:2,HcmLinkIntegration:3});var Lr=babelHelpers.classPrivateFieldLooseKey("sidePanel");var Fr=babelHelpers.classPrivateFieldLooseKey("closeSidePanel");var _r=babelHelpers.classPrivateFieldLooseKey("resolvePages");var Br=babelHelpers.classPrivateFieldLooseKey("dom");var yr=babelHelpers.classPrivateFieldLooseKey("documentLayout");var fr=babelHelpers.classPrivateFieldLooseKey("blocksManager");var Hr=babelHelpers.classPrivateFieldLooseKey("wizardType");var mr=babelHelpers.classPrivateFieldLooseKey("documentData");var Er=babelHelpers.classPrivateFieldLooseKey("urls");var Sr=babelHelpers.classPrivateFieldLooseKey("totalPages");var Cr=babelHelpers.classPrivateFieldLooseKey("api");var Tr=babelHelpers.classPrivateFieldLooseKey("sectionElementByType");var Or=babelHelpers.classPrivateFieldLooseKey("disabledSections");var Ir=babelHelpers.classPrivateFieldLooseKey("needSaveBlocksOnSidePanelClose");var Rr=babelHelpers.classPrivateFieldLooseKey("needToLockSidePanelClose");var Mr=babelHelpers.classPrivateFieldLooseKey("needSkipEditorStep");var Dr=babelHelpers.classPrivateFieldLooseKey("analytics");var Nr=babelHelpers.classPrivateFieldLooseKey("isTemplateMode");var kr=babelHelpers.classPrivateFieldLooseKey("disableB2eDocumentSection");var wr=babelHelpers.classPrivateFieldLooseKey("onSliderOpenCompleteHandler");var Kr=babelHelpers.classPrivateFieldLooseKey("isB2e");var Ar=babelHelpers.classPrivateFieldLooseKey("getArticleCode");var jr=babelHelpers.classPrivateFieldLooseKey("covertRoleToBlockParty");var xr=babelHelpers.classPrivateFieldLooseKey("handleSliderOnOpenComplete");var Gr=babelHelpers.classPrivateFieldLooseKey("render");var $r=babelHelpers.classPrivateFieldLooseKey("createHeader");var Ur=babelHelpers.classPrivateFieldLooseKey("onSaveBtnClick");var zr=babelHelpers.classPrivateFieldLooseKey("onEditBtnClick");var Yr=babelHelpers.classPrivateFieldLooseKey("createContent");var Vr=babelHelpers.classPrivateFieldLooseKey("createSections");var Xr=babelHelpers.classPrivateFieldLooseKey("toggleEditMode");var qr=babelHelpers.classPrivateFieldLooseKey("getSectionsData");var Jr=babelHelpers.classPrivateFieldLooseKey("isDocumentInitiatedByEmployee");var Qr=babelHelpers.classPrivateFieldLooseKey("onSidePanelCloseStart");var Wr=babelHelpers.classPrivateFieldLooseKey("isDynamicEmployeeFieldAvailable");var Zr=babelHelpers.classPrivateFieldLooseKey("isBlockCanBeInitialized");var en=babelHelpers.classPrivateFieldLooseKey("renderEyeIcon");var sn=babelHelpers.classPrivateFieldLooseKey("toggleEditStepVisibility");class tn extends y.EventEmitter{constructor(e,s){var t;super();Object.defineProperty(this,sn,{value:Bn});Object.defineProperty(this,en,{value:_n});Object.defineProperty(this,Zr,{value:Fn});Object.defineProperty(this,Wr,{value:Ln});Object.defineProperty(this,Qr,{value:gn});Object.defineProperty(this,Jr,{value:Pn});Object.defineProperty(this,qr,{value:hn});Object.defineProperty(this,Xr,{value:un});Object.defineProperty(this,Vr,{value:vn});Object.defineProperty(this,Yr,{value:pn});Object.defineProperty(this,zr,{value:bn});Object.defineProperty(this,Ur,{value:dn});Object.defineProperty(this,$r,{value:cn});Object.defineProperty(this,Gr,{value:nn});Object.defineProperty(this,xr,{value:rn});Object.defineProperty(this,jr,{value:on});Object.defineProperty(this,Ar,{value:an});Object.defineProperty(this,Kr,{value:ln});Object.defineProperty(this,Lr,{writable:true,value:void 0});Object.defineProperty(this,Fr,{writable:true,value:void 0});Object.defineProperty(this,_r,{writable:true,value:void 0});Object.defineProperty(this,Br,{writable:true,value:void 0});Object.defineProperty(this,yr,{writable:true,value:void 0});Object.defineProperty(this,fr,{writable:true,value:void 0});Object.defineProperty(this,Hr,{writable:true,value:void 0});Object.defineProperty(this,mr,{writable:true,value:void 0});Object.defineProperty(this,Er,{writable:true,value:void 0});Object.defineProperty(this,Sr,{writable:true,value:void 0});Object.defineProperty(this,Cr,{writable:true,value:new f.Api});Object.defineProperty(this,Tr,{writable:true,value:new Map});Object.defineProperty(this,Or,{writable:true,value:new Set});Object.defineProperty(this,Ir,{writable:true,value:true});Object.defineProperty(this,Rr,{writable:true,value:true});Object.defineProperty(this,Mr,{writable:true,value:false});Object.defineProperty(this,Dr,{writable:true,value:null});Object.defineProperty(this,Nr,{writable:true,value:void 0});Object.defineProperty(this,kr,{writable:true,value:true});Object.defineProperty(this,wr,{writable:true,value:babelHelpers.classPrivateFieldLooseBase(this,xr)[xr].bind(this)});this.setEventNamespace("BX.Sign.V2.Editor");const{Instance:l}=_.Reflection.getClass("BX.SidePanel");babelHelpers.classPrivateFieldLooseBase(this,Lr)[Lr]=l;babelHelpers.classPrivateFieldLooseBase(this,Br)[Br]=_.Tag.render(ar||(ar=ir`<div class="sign-wizard__scope sign-editor"></div>`));babelHelpers.classPrivateFieldLooseBase(this,yr)[yr]=_.Tag.render(or||(or=ir`
			<div class="sign-editor__document"></div>
		`));babelHelpers.classPrivateFieldLooseBase(this,fr)[fr]=new $o({documentLayout:babelHelpers.classPrivateFieldLooseBase(this,yr)[yr],disableEdit:false,languages:s.languages,isTemplateMode:Boolean(s.isTemplateMode),documentInitiatedByType:(t=s.documentInitiatedByType)!=null?t:h.DocumentInitiated.company});babelHelpers.classPrivateFieldLooseBase(this,Nr)[Nr]=Boolean(s.isTemplateMode);babelHelpers.classPrivateFieldLooseBase(this,Hr)[Hr]=e;babelHelpers.classPrivateFieldLooseBase(this,Er)[Er]=[];babelHelpers.classPrivateFieldLooseBase(this,Sr)[Sr]=0;babelHelpers.classPrivateFieldLooseBase(this,Mr)[Mr]=s.needSkipEditorStep}setUrls(e,s){if(e.length===0){babelHelpers.classPrivateFieldLooseBase(this,Er)[Er]=[];babelHelpers.classPrivateFieldLooseBase(this,Sr)[Sr]=0;return}babelHelpers.classPrivateFieldLooseBase(this,Er)[Er]=[...babelHelpers.classPrivateFieldLooseBase(this,Er)[Er],...e];babelHelpers.classPrivateFieldLooseBase(this,Sr)[Sr]=s;if(babelHelpers.classPrivateFieldLooseBase(this,Er)[Er].length===s){var t,l;(t=(l=babelHelpers.classPrivateFieldLooseBase(this,_r))[_r])==null?void 0:t.call(l)}}set documentData(e){babelHelpers.classPrivateFieldLooseBase(this,mr)[mr]=e;const{uid:s="",isTemplate:t}=e;if(t){babelHelpers.classPrivateFieldLooseBase(this,Xr)[Xr](false)}else{babelHelpers.classPrivateFieldLooseBase(this,Xr)[Xr](true)}babelHelpers.classPrivateFieldLooseBase(this,fr)[fr].setDocumentUid(s)}setSenderType(e){babelHelpers.classPrivateFieldLooseBase(this,fr)[fr].documentInitiatedByType=e}set entityData(e){const s=new Set([h.MemberRole.editor,h.MemberRole.reviewer]);const t=Object.values(e).filter((e=>!s.has(e.role))).map((e=>{const{id:s,title:t,part:l,presetId:i,entityTypeId:a,uid:o,entityId:r,role:n}=e;return{cid:s,name:t,part:babelHelpers.classPrivateFieldLooseBase(this,jr)[jr](l,n),presetId:i,entityTypeId:a,uid:o,entityId:r}}));babelHelpers.classPrivateFieldLooseBase(this,fr)[fr].addMembers(t)}async renderDocument(){_.Dom.clean(babelHelpers.classPrivateFieldLooseBase(this,yr)[yr]);const{promises:e,fragment:s}=babelHelpers.classPrivateFieldLooseBase(this,Er)[Er].reduce(((e,s)=>{const{fragment:t,promises:l}=e;const i=new Promise((e=>{const l=_.Tag.render(rr||(rr=ir`
					<div class="sign-editor__document_page">
						<img src="${0}" onload="${0}"  alt=""/>
					</div>
				`),s,e);_.Dom.append(l,t)}));l.push(i);return e}),{fragment:new DocumentFragment,promises:[]});_.Dom.append(s,babelHelpers.classPrivateFieldLooseBase(this,yr)[yr]);const{resizeArea:t}=babelHelpers.classPrivateFieldLooseBase(this,fr)[fr];_.Dom.append(t.getLayout(),babelHelpers.classPrivateFieldLooseBase(this,yr)[yr]);await Promise.all(e);y.EventEmitter.unsubscribe("SidePanel.Slider:onOpenComplete",babelHelpers.classPrivateFieldLooseBase(this,wr)[wr]);y.EventEmitter.subscribeOnce("SidePanel.Slider:onOpenComplete",babelHelpers.classPrivateFieldLooseBase(this,wr)[wr])}show(){return new Promise((e=>{babelHelpers.classPrivateFieldLooseBase(this,Fr)[Fr]=e;babelHelpers.classPrivateFieldLooseBase(this,Lr)[Lr].open("editor",{cacheable:false,contentCallback:()=>{babelHelpers.classPrivateFieldLooseBase(this,Gr)[Gr]();return babelHelpers.classPrivateFieldLooseBase(this,Br)[Br]},events:{onClose:e=>babelHelpers.classPrivateFieldLooseBase(this,Qr)[Qr](e),onCloseComplete:()=>babelHelpers.classPrivateFieldLooseBase(this,Fr)[Fr]()}})}))}waitForPagesUrls(){return new Promise((e=>{if(babelHelpers.classPrivateFieldLooseBase(this,Er)[Er].length===babelHelpers.classPrivateFieldLooseBase(this,Sr)[Sr]){e();return}babelHelpers.classPrivateFieldLooseBase(this,_r)[_r]=e}))}setSectionVisibilityByType(e,s){const t=babelHelpers.classPrivateFieldLooseBase(this,Tr)[Tr].get(e);if(t){t.style.display=s===true?"block":"none"}if(s){babelHelpers.classPrivateFieldLooseBase(this,Or)[Or].delete(e)}else{babelHelpers.classPrivateFieldLooseBase(this,Or)[Or].add(e)}}setIsB2eDocumentSectionDisabled(e){babelHelpers.classPrivateFieldLooseBase(this,kr)[kr]=e}setAnalytics(e){babelHelpers.classPrivateFieldLooseBase(this,Dr)[Dr]=e}}function ln(){return babelHelpers.classPrivateFieldLooseBase(this,Hr)[Hr]==="b2e"}function an(){return babelHelpers.classPrivateFieldLooseBase(this,Kr)[Kr]()?"":"16571388"}function on(e,s){switch(s){case h.MemberRole.assignee:return 1;case h.MemberRole.signer:return 2;default:return e}}function rn(){babelHelpers.classPrivateFieldLooseBase(this,fr)[fr].initPagesRect();babelHelpers.classPrivateFieldLooseBase(this,fr)[fr].initBlocks(babelHelpers.classPrivateFieldLooseBase(this,mr)[mr].blocks.filter((e=>babelHelpers.classPrivateFieldLooseBase(this,Zr)[Zr](e))))}function nn(){_.Dom.clean(babelHelpers.classPrivateFieldLooseBase(this,Br)[Br]);_.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,$r)[$r](),babelHelpers.classPrivateFieldLooseBase(this,Br)[Br]);_.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,Yr)[Yr](),babelHelpers.classPrivateFieldLooseBase(this,Br)[Br])}function cn(){const e=["sign-editor__header_edit-btn",...Pr].join(" ");const s=["ui-btn-success",...Pr.slice(0,-1)].join(" ");const l=_.Loc.getMessage("SIGN_EDITOR_EDIT");const i=_.Loc.getMessage("SIGN_EDITOR_SAVE");let a="";if(babelHelpers.classPrivateFieldLooseBase(this,Ar)[Ar]()){a=_.Tag.render(nr||(nr=ir`
				<span
								onclick="${0}"
								class="sign-editor__header_help"
								></span>
			`),(()=>{const e=_.Reflection.getClass("BX.Helper");e.show(`redirect=detail&code=${babelHelpers.classPrivateFieldLooseBase(this,Ar)[Ar]()}`)}))}const o=_.Tag.render(cr||(cr=ir`
			<p class="sign-editor__header_title">
				<span>${0}</span>
				<span
					data-hint="${0}"
				></span>
			</p>
		`),_.Loc.getMessage("SIGN_EDITOR_EDITING"),_.Loc.getMessage("SIGN_EDITOR_EDITING_HINT_MSGVER_1"));t.Hint.create(o);const r=babelHelpers.classPrivateFieldLooseBase(this,Mr)[Mr]?"hide":"show";const n=babelHelpers.classPrivateFieldLooseBase(this,en)[en](r);return _.Tag.render(dr||(dr=ir`
			<div class="sign-editor__header">
				${0}
				<div class="sign-editor__header_right">
					${0}
					${0}
					<span
						class="${0}"
						title="${0}"
						onclick="${0}"
					>
						${0}
					</span>
					<span
						class="${0}"
						title="${0}"
						onclick="${0}"
					>
						${0}
					</span>
				</div>
			</div>
		`),o,a,babelHelpers.classPrivateFieldLooseBase(this,Nr)[Nr]||!babelHelpers.classPrivateFieldLooseBase(this,Kr)[Kr]()?"":n,e,l,(()=>babelHelpers.classPrivateFieldLooseBase(this,zr)[zr]()),l,s,i,(e=>babelHelpers.classPrivateFieldLooseBase(this,Ur)[Ur](e)),i)}async function dn({target:e}){_.Dom.addClass(e,"ui-btn-wait");const t=await babelHelpers.classPrivateFieldLooseBase(this,fr)[fr].save();const l=babelHelpers.classPrivateFieldLooseBase(this,fr)[fr].getDocumentUid();_.Dom.removeClass(e,"ui-btn-wait");if(!t){return}y.EventEmitter.subscribeOnce("SidePanel.Slider:onCloseComplete",(()=>{this.emit("save",{uid:l,blocks:t});if(babelHelpers.classPrivateFieldLooseBase(this,Dr)[Dr]instanceof s.Analytics&&babelHelpers.classPrivateFieldLooseBase(this,Nr)[Nr]){babelHelpers.classPrivateFieldLooseBase(this,Dr)[Dr].send({event:"proceed_step_document_editor",status:"success"})}}));babelHelpers.classPrivateFieldLooseBase(this,Ir)[Ir]=false;babelHelpers.classPrivateFieldLooseBase(this,Lr)[Lr].close();babelHelpers.classPrivateFieldLooseBase(this,Ir)[Ir]=true;babelHelpers.classPrivateFieldLooseBase(this,Xr)[Xr](false)}function bn(){babelHelpers.classPrivateFieldLooseBase(this,Xr)[Xr](true);if(babelHelpers.classPrivateFieldLooseBase(this,Dr)[Dr]instanceof s.Analytics&&babelHelpers.classPrivateFieldLooseBase(this,Nr)[Nr]){babelHelpers.classPrivateFieldLooseBase(this,Dr)[Dr].send({event:"open_document_editor",status:"success"})}}function pn(){const e=babelHelpers.classPrivateFieldLooseBase(this,Vr)[Vr]();const s=_.Tag.render(br||(br=ir`
			<div class="sign-editor__content">
				<div class="sign-editor__document-container">
					${0}
				</div>
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,yr)[yr],e);t.Hint.create(e,{bindOptions:{position:"top"},angle:{position:"bottom"},targetContainer:s});babelHelpers.classPrivateFieldLooseBase(this,fr)[fr].setEditorContent(s);return s}function vn(){const e=babelHelpers.classPrivateFieldLooseBase(this,qr)[qr]().filter((({singleBlockSection:e})=>e!==true));const s=e.map((e=>{const s=Object.entries(e.blocks);const t=s.map((([s,t])=>{const{title:l,hint:i}=t;return _.Tag.render(pr||(pr=ir`
					<div
						class="sign-editor__section_block"
						data-code="${0}"
						data-part="${0}"
					>
						<div class="sign-editor__section_block-subject">
							<span>${0}</span>
							<span data-hint="${0}"></span>
						</div>
						<span class="sign-editor__section_add-block-btn">
							${0}
						</span>
					</div>
				`),s,e.part,_.Loc.getMessage(l),_.Text.encode(_.Loc.getMessage(i)),_.Loc.getMessage("SIGN_EDITOR_BLOCK_ADD_TO_DOCUMENT"))}));babelHelpers.classPrivateFieldLooseBase(this,fr)[fr].initRepository(t);const l=_.Tag.render(vr||(vr=ir`
				<div class="sign-editor__section">
					<p class="sign-editor__section_title"
						style="display: ${0}"
					>
						${0}
					</p>
					${0}
				</div>
			`),e.title?"block":"none",e.title?_.Loc.getMessage(e.title):"",t);babelHelpers.classPrivateFieldLooseBase(this,Tr)[Tr].set(e.part,l);if(babelHelpers.classPrivateFieldLooseBase(this,Or)[Or].has(e.part)){l.style.display="none"}return l}));return _.Tag.render(ur||(ur=ir`
			<div class="sign-editor__sections">
				${0}
			</div>
		`),s)}function un(e){if(e){_.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,Br)[Br],"--editable");return}_.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,Br)[Br],"--editable")}function hn(){const e={};const s={};const t={text:{title:"SIGN_EDITOR_BLOCK_TEXT",hint:"SIGN_EDITOR_BLOCK_TEXT_HINT"}};if(!babelHelpers.classPrivateFieldLooseBase(this,Kr)[Kr]()){t.date={title:"SIGN_EDITOR_BLOCK_DATE",hint:"SIGN_EDITOR_BLOCK_DATE_HINT"}}t.number={title:"SIGN_EDITOR_BLOCK_NUMBER",hint:"SIGN_EDITOR_BLOCK_NUMBER_HINT"};let l={firstParty:"SIGN_EDITOR_BLOCKS_FIRST_PARTY",partner:"SIGN_EDITOR_BLOCKS_PARTNER"};if(babelHelpers.classPrivateFieldLooseBase(this,Hr)[Hr]==="b2e"){let i="SIGN_EDITOR_BLOCK_B2E_REFERENCE_HINT";let a="SIGN_EDITOR_BLOCK_B2E_EMPLOYEE_DYNAMIC_HINT";let o="SIGN_EDITOR_BLOCK_MY_B2E_REFERENCE_HINT";if(babelHelpers.classPrivateFieldLooseBase(this,fr)[fr].isTemplateMode){i=babelHelpers.classPrivateFieldLooseBase(this,Jr)[Jr]()?"SIGN_EDITOR_BLOCK_B2E_REFERENCE_HINT_TEMPLATE_EMPLOYEE":"SIGN_EDITOR_BLOCK_B2E_REFERENCE_HINT_TEMPLATE_COMPANY";a=babelHelpers.classPrivateFieldLooseBase(this,Jr)[Jr]()?"SIGN_EDITOR_BLOCK_B2E_EMPLOYEE_DYNAMIC_HINT_TEMPLATE_EMPLOYEE":"SIGN_EDITOR_BLOCK_B2E_EMPLOYEE_DYNAMIC_HINT_TEMPLATE_COMPANY";o=babelHelpers.classPrivateFieldLooseBase(this,Jr)[Jr]()?"SIGN_EDITOR_BLOCK_MY_B2E_REFERENCE_HINT_TEMPLATE_EMPLOYEE":"SIGN_EDITOR_BLOCK_MY_B2E_REFERENCE_HINT_TEMPLATE_COMPANY"}Object.assign(e,{myb2ereference:{title:"SIGN_EDITOR_BLOCK_MY_B2E_REFERENCE_MSG_VER_1",hint:o},myrequisites:{title:"SIGN_EDITOR_BLOCK_REQUISITES_MSG_VER_1",hint:"SIGN_EDITOR_BLOCK_FIRST_PARTY_REQUISITES_HINT"}});Object.assign(s,{b2ereference:{title:"SIGN_EDITOR_BLOCK_B2E_REFERENCE_MSG_VER_1",hint:i}});const r={b2eexternalid:{title:"SIGN_EDITOR_BLOCK_B2E_EXTERNAL_ID_TITLE",hint:"SIGN_EDITOR_BLOCK_B2E_EXTERNAL_ID_HINT"},b2edocumentdate:{title:"SIGN_EDITOR_BLOCK_B2E_DOCUMENT_DATE_TITLE",hint:"SIGN_EDITOR_BLOCK_B2E_DOCUMENT_DATE_HINT"}};if(babelHelpers.classPrivateFieldLooseBase(this,Wr)[Wr]()){Object.assign(s,{employeedynamic:{title:"SIGN_EDITOR_BLOCK_B2E_EMPLOYEE_DYNAMIC",hint:a}})}l={firstParty:"SIGN_EDITOR_BLOCKS_FIRST_PARTY_B2E",partner:"SIGN_EDITOR_BLOCKS_EMPLOYEE_B2E",document:"SIGN_EDITOR_BLOCK_B2E_DOCUMENT_SECTION"};const n=[{title:l.firstParty,blocks:e,part:1},{title:l.partner,blocks:s,part:2}];if(!babelHelpers.classPrivateFieldLooseBase(this,kr)[kr]){n.push({title:l.document,blocks:r,part:2})}n.push({title:"SIGN_EDITOR_BLOCKS_GENERAL",blocks:t,part:0},{title:null,blocks:{hcmlinkreference:{title:"SIGN_EDITOR_BLOCK_B2E_HCMLINK_TITLE",hint:"SIGN_EDITOR_BLOCK_B2E_HCMLINK_HINT"}},part:3});return n}else{Object.assign(e,{myreference:{title:"SIGN_EDITOR_BLOCK_CRM",hint:"SIGN_EDITOR_BLOCK_CRM_HINT"},myrequisites:{title:"SIGN_EDITOR_BLOCK_REQUISITES_MSG_VER_1",hint:"SIGN_EDITOR_BLOCK_FIRST_PARTY_REQUISITES_HINT"},mysign:{title:"SIGN_EDITOR_BLOCK_SIGNATURE",hint:"SIGN_EDITOR_BLOCK_FIRST_PARTY_SIGNATURE_HINT"},mystamp:{title:"SIGN_EDITOR_BLOCK_STAMP_MSGVER_1",hint:"SIGN_EDITOR_BLOCK_FIRST_PARTY_STAMP_HINT"}});Object.assign(s,{reference:{...e.myreference},requisites:{...e.myrequisites,hint:"SIGN_EDITOR_BLOCK_PARTNER_REQUISITES_HINT"},sign:{...e.mysign,hint:"SIGN_EDITOR_BLOCK_PARTNER_SIGNATURE_HINT"},stamp:{...e.mystamp,hint:"SIGN_EDITOR_BLOCK_PARTNER_STAMP_HINT"}});return[{title:l.firstParty,blocks:e,part:1},{title:l.partner,blocks:s,part:2},{title:"SIGN_EDITOR_BLOCKS_GENERAL",blocks:t,part:0}]}}function Pn(){return babelHelpers.classPrivateFieldLooseBase(this,fr)[fr].documentInitiatedByType===h.DocumentInitiated.employee}async function gn(e){if(!babelHelpers.classPrivateFieldLooseBase(this,Ir)[Ir]){return}if(!babelHelpers.classPrivateFieldLooseBase(this,Rr)[Rr]){return}e.denyAction();try{const e=await babelHelpers.classPrivateFieldLooseBase(this,fr)[fr].save();if(!e){return}const s=babelHelpers.classPrivateFieldLooseBase(this,fr)[fr].getDocumentUid();babelHelpers.classPrivateFieldLooseBase(this,Rr)[Rr]=false;babelHelpers.classPrivateFieldLooseBase(this,Lr)[Lr].close();babelHelpers.classPrivateFieldLooseBase(this,Rr)[Rr]=true;this.emit("save",{uid:s,blocks:e});babelHelpers.classPrivateFieldLooseBase(this,Dr)[Dr].send({event:"proceed_step_document_editor",status:"success"})}catch{if(babelHelpers.classPrivateFieldLooseBase(this,Dr)[Dr]instanceof s.Analytics&&babelHelpers.classPrivateFieldLooseBase(this,Nr)[Nr]){babelHelpers.classPrivateFieldLooseBase(this,Dr)[Dr].send({event:"proceed_step_document_editor",status:"error"})}}}function Ln(){return babelHelpers.classPrivateFieldLooseBase(this,Kr)[Kr]()&&babelHelpers.classPrivateFieldLooseBase(this,fr)[fr].isTemplateMode}function Fn(e){if(babelHelpers.classPrivateFieldLooseBase(this,Or)[Or].has(e.party)){return false}return!babelHelpers.classPrivateFieldLooseBase(this,fr)[fr].isTemplateMode||!String(e.data.field).startsWith("SMART_B2E_DOC")}function _n(e){const s=babelHelpers.classPrivateFieldLooseBase(this,Mr)[Mr]?"SIGN_EDITOR_SHOW_IN_MASTER":"SIGN_EDITOR_HIDE_IN_MASTER";return _.Tag.render(hr||(hr=ir`
			<span
				class="sign-editor__header_eye-icon ${0}"
				title="${0}"
				onclick="${0}"
			>
			</span>
			<span class="sign-editor__header_vertical-line"></span>
		`),e,_.Loc.getMessage(s),babelHelpers.classPrivateFieldLooseBase(this,sn)[sn].bind(this))}async function Bn(e){const s=e.currentTarget;const t=_.Dom.hasClass(s,"show");_.Dom.toggleClass(s,["show","hide"]);const l=t?_.Loc.getMessage("SIGN_EDITOR_SHOW_IN_MASTER"):_.Loc.getMessage("SIGN_EDITOR_HIDE_IN_MASTER");_.Dom.attr(s,{title:l});try{await babelHelpers.classPrivateFieldLooseBase(this,Cr)[Cr].changeEditorStepVisibility(t)}catch(e){console.error(e)}}e.SectionType=gr;e.Editor=tn})(this.BX.Sign.V2=this.BX.Sign.V2||{},BX.Sign.V2,BX.Sign.V2,BX.Main,BX.Sign.Tour,BX,BX.UI,BX.UI.Dialogs,BX.UI,BX.Sign,BX,BX,BX.UI.Stamp,BX.Crm.Form.Fields,BX.Crm.Requisite,BX.Sign,BX.Sign.B2e,BX.Sign,BX,BX.Sign,BX,BX.UI.DragAndDrop,BX.Event,BX.Sign.V2);
//# sourceMappingURL=editor.bundle.map.js