{"version":3,"file":"company-selector.bundle.js","sources":["../src/functions.js","../src/provider-selector.js","../src/index.js"],"sourcesContent":["import { Type } from 'main.core';\n\nexport function hide(element: any): void\n{\n\tif (Type.isElementNode(element))\n\t{\n\t\tBX.hide(element);\n\t}\n}\n\nexport function show(element: any): void\n{\n\tif (Type.isElementNode(element))\n\t{\n\t\tBX.show(element);\n\t}\n}\n","import { Dom, Event, Loc, Runtime, Tag, Text as TextFormat, Type, Uri } from 'main.core';\nimport { MemoryCache } from 'main.core.cache';\nimport { type BaseEvent, EventEmitter } from 'main.core.events';\nimport { DateTimeFormat } from 'main.date';\nimport { Menu } from 'main.popup';\nimport { Guide } from 'sign.tour';\nimport { DocumentInitiated, type DocumentInitiatedType, type ProviderCodeType } from 'sign.type';\nimport type { Company, Provider } from 'sign.v2.api';\nimport { Helpdesk, Link } from 'sign.v2.helper';\nimport { Alert } from 'ui.alerts';\nimport { Dialog } from 'ui.entity-selector';\nimport { Label, LabelColor } from 'ui.label';\nimport { hide, show } from './functions';\nimport type { CompanyData } from './index';\nimport { HelpdeskCodes, ProviderCode } from './index';\nimport { Api } from 'sign.v2.api';\n\nexport type ProviderSelectedEvent = BaseEvent<{ provider: Provider }>;\n\nexport type Options = {\n\tregion: string;\n\tdocumentInitiatedType: DocumentInitiatedType;\n};\n\nexport const allowedSignatureProviders: Array<ProviderCodeType> = [\n\t'goskey',\n\t'external',\n\t'ses-ru',\n\t'ses-com',\n\t'ses-ru-express',\n];\n\nconst sesComLearnMoreLink = new Uri('https://www.bitrix24.com/terms/esignature-for-hr-rules.php');\n\nexport class ProviderSelector extends EventEmitter\n{\n\tevents = {\n\t\tonProviderSelect: 'providerSelected',\n\t\tonProviderDeselect: 'providerDeselected',\n\t\tonProviderDisconnect: 'onProviderDisconnect',\n\t\tproviderConnectionSlider: {\n\t\t\tonClose: 'onClose',\n\t\t},\n\t};\n\n\t#layoutCache: MemoryCache<HTMLElement> = new MemoryCache();\n\t#providerMenu: Dialog | null = null;\n\t#options: Options;\n\t#showTaxId: boolean = true;\n\t#providerExpiresDaysToShowInfo: Number = 45;\n\t#company: CompanyData | null = null;\n\t#companyList: Array<Company> = [];\n\t#registerIframe: HTMLIFrameElement | null;\n\t#iframeConnectInterval: number | null = null;\n\t#isSubscribedIframeCloseEvent = false;\n\t#isSubscribedIframeConnectedEvent = false;\n\t#api = new Api();\n\n\tconstructor(options: Options)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Sign.V2.B2e.CompanySelector:ProviderSelector');\n\t\tthis.#options = options;\n\t}\n\n\tgetLayout(): HTMLElement\n\t{\n\t\treturn this.#layoutCache.remember('layout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-document-b2e-company__provider\">\n\t\t\t\t\t<div class=\"sign-document-b2e-company__provider_content\">\n\t\t\t\t\t\t${this.#connectedProviderLayout}\n\t\t\t\t\t\t${this.#providerDisconnectedLayout}\n\t\t\t\t\t\t${this.#providerUnsetLayout}\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.#providerInfoLayout}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tsetShowTaxId(value: boolean): ProviderSelector\n\t{\n\t\tthis.#showTaxId = value;\n\n\t\treturn this;\n\t}\n\n\tget #providerConnectedSelectDropdownBtnLayout(): HTMLElement\n\t{\n\t\treturn this.#layoutCache.remember('providerConnectedSelectDropdownBtnLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<span\n\t\t\t\t\tclass=\"sign-document-b2e-company-info-dropdown-btn sign-document-b2e-company__provider_dropdown-btn\"\n\t\t\t\t\tonclick=\"${() => this.#providerMenu.show()}\"\n\t\t\t\t></span>\n\t\t\t`;\n\t\t});\n\t}\n\n\tget #providerConnectedNameLabelLayout(): HTMLElement\n\t{\n\t\treturn this.#layoutCache.remember('providerConnectedNameLabel', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-document-b2e-company__provider_name_label\"></div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tget #providerConnectedNameLayout(): HTMLElement\n\t{\n\t\treturn this.#layoutCache.remember('providerConnectedName', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<span class=\"sign-document-b2e-company__provider_name\"></span>\n\t\t\t`;\n\t\t});\n\t}\n\n\tget #providerConnectedDescriptionLayout(): HTMLElement\n\t{\n\t\treturn this.#layoutCache.remember('providerConnectedDescription', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<span class=\"sign-document-b2e-company__provider_descr\"></span>\n\t\t\t`;\n\t\t});\n\t}\n\n\tget #providerDisconnectedBtnLayout(): HTMLElement\n\t{\n\t\treturn this.#layoutCache.remember('providerDisconnectedBtn', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<button\n\t\t\t\t\tclass=\"ui-btn ui-btn-success ui-btn-xs ui-btn-round\"\n\t\t\t\t\tonclick=\"${() => this.#openProvidersConnectionSlider()}\"\n\t\t\t\t>\n\t\t\t\t\t${Loc.getMessage('SIGN_B2E_PROVIDER_CONNECT')}\n\t\t\t\t</button>\n\t\t\t`;\n\t\t});\n\t}\n\n\tget #providerInfoLayout(): HTMLElement\n\t{\n\t\treturn this.#layoutCache.remember('providerInfo', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-document-b2e-company__provider_info\"></div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tget #providerUnsetLayout(): HTMLElement\n\t{\n\t\treturn this.#layoutCache.remember('providerUInset', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-document-b2e-company-select --provider\">\n\t\t\t\t\t<span class=\"sign-document-b2e-company-select-text\">\n\t\t\t\t\t\t${Loc.getMessage('SIGN_B2E_COMPANY_NOT_SET_PROVIDER_STATUS')}\n\t\t\t\t\t</span>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"ui-btn ui-btn-success ui-btn-xs ui-btn-round\"\n\t\t\t\t\t\tonclick=\"${() => this.#getProviderMenu().show()}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t${Loc.getMessage('SIGN_B2E_COMPANIES_SELECT_BUTTON')}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tget #providerDisconnectedLayout(): HTMLElement\n\t{\n\t\treturn this.#layoutCache.remember('providerDisconnected', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-document-b2e-company-select --provider\">\n\t\t\t\t\t<span class=\"sign-document-b2e-company-select-text\">\n\t\t\t\t\t\t${Loc.getMessage('SIGN_B2E_COMPANY_NOT_CONNECTED_PROVIDER_STATUS')}\n\t\t\t\t\t</span>\n\t\t\t\t\t${this.#providerDisconnectedBtnLayout}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tget #connectedProviderLayout(): HTMLElement\n\t{\n\t\treturn this.#layoutCache.remember('connectedProvider', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-document-b2e-company__provider_selected\">\n\t\t\t\t\t<div class=\"sign-document-b2e-company__provider_selected__external-image-container\">\n\t\t\t\t\t\t<img class=\"sign-document-b2e-company__provider_selected__external-img\"\n\t\t\t\t\t\t\treferrerpolicy=\"no-referrer\"\n\t\t\t\t\t\t alt=\"provider image\">\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div class=\"sign-document-b2e-company__provider_name_container\">\n\t\t\t\t\t\t\t${this.#providerConnectedNameLayout}\n\t\t\t\t\t\t\t${this.#providerConnectedNameLabelLayout}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t${(this.#providerConnectedDescriptionLayout)}\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.#providerConnectedSelectDropdownBtnLayout}\n\t\t\t\t\t${this.#providerConnectDropdownBtnLayout}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tget #providerConnectDropdownBtnLayout(): HTMLElement\n\t{\n\t\treturn this.#layoutCache.remember('providerConnectDropdownBtnLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<span\n\t\t\t\t\tclass=\"sign-document-b2e-company-info-edit\"\n\t\t\t\t\tonclick=\"${() => this.#showConnectMenu()}\"\n\t\t\t\t></span>\n\t\t\t`;\n\t\t});\n\t}\n\n\t#getProviderMenu(): Dialog\n\t{\n\t\tif (this.#providerMenu)\n\t\t{\n\t\t\treturn this.#providerMenu;\n\t\t}\n\n\t\tthis.#providerMenu = new Dialog({\n\t\t\twidth: 425,\n\t\t\theight: 363,\n\t\t\ttargetNode: this.getLayout(),\n\t\t\titems: [],\n\t\t\tshowAvatars: true,\n\t\t\tdropdownMode: true,\n\t\t\tmultiple: false,\n\t\t\tautoHide: true,\n\t\t\ttabs: [\n\t\t\t\t{ id: 'b2e-providers', title: Loc.getMessage('SIGN_B2E_PROVIDERS_TAB') },\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\t'Item:OnSelect': ({ data }) => {\n\t\t\t\t\tthis.#onProviderSelect(data.item.id);\n\t\t\t\t},\n\t\t\t\t'Item:OnDeselect': () => this.#onProviderDeselect(),\n\t\t\t},\n\t\t\tfooter: this.#getProviderAddButton(),\n\t\t});\n\n\t\treturn this.#providerMenu;\n\t}\n\n\t#getProviderAddButton(): ?HTMLElement\n\t{\n\t\tconst company = this.#getCompanyById(this.#company?.id);\n\t\tif (company?.registerUrl)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<span\n\t\t\t\t\tclass=\"ui-selector-footer-link ui-selector-footer-link-add\"\n\t\t\t\t\tonclick=\"${() => {\n\t\t\t\tthis.#providerMenu.hide();\n\t\t\t\tthis.#openProvidersConnectionSlider();\n\t\t\t}}\"\n\t\t\t\t>\n\t\t\t\t\t${Loc.getMessage('SIGN_B2E_PROVIDER_CONNECT_SELECTOR')}\n\t\t\t\t</span>\n\t\t\t`;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t#onProviderSelect(id: string): void\n\t{\n\t\tconst company = this.#getCompanyById(this.#company.id ?? 0);\n\t\tconst provider = company.providers.find(({ uid }) => uid === id);\n\t\thide(this.#providerUnsetLayout);\n\t\tshow(this.#connectedProviderLayout);\n\t\tshow(this.#providerInfoLayout);\n\t\tthis.#chooseProvider(provider, company.rqInn);\n\t\tthis.#providerMenu.hide();\n\n\t\tthis.emit(this.events.onProviderSelect, { provider });\n\t}\n\n\t#chooseProvider(provider: Provider, rqInn: number): void\n\t{\n\t\tif (!allowedSignatureProviders.includes(provider.code))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst { providerName, description } = this.#getConnectedName(provider, rqInn);\n\t\tthis.#providerConnectedNameLayout.textContent = providerName;\n\t\tthis.#providerConnectedDescriptionLayout.textContent = description;\n\n\t\tthis.#renderProviderInfo(provider);\n\t\tthis.#resetProviderClasses();\n\t\tDom.addClass(this.#connectedProviderLayout, `--with-icon --${provider.code}`);\n\t\tif (provider.code === ProviderCode.external)\n\t\t{\n\t\t\tthis.#setProviderImage(provider);\n\t\t}\n\n\t\tDom.clean(this.#providerConnectedNameLabelLayout);\n\t\tif (this.#isProviderExpired(provider))\n\t\t{\n\t\t\tDom.addClass(this.#connectedProviderLayout, '--expired');\n\t\t\tconst expiredLabel = this.#makeGoskeyApikeyExpiredLabel();\n\t\t\tDom.append(expiredLabel.render(), this.#providerConnectedNameLabelLayout);\n\t\t}\n\t\tDom.style(\n\t\t\tthis.#providerConnectDropdownBtnLayout,\n\t\t\t'display',\n\t\t\tprovider.autoRegister ? 'none' : 'flex',\n\t\t);\n\t\tthis.#company.provider = provider;\n\t}\n\n\t#setProviderImage(provider: Provider): void\n\t{\n\t\tif (!Type.isStringFilled(provider.iconUrl))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst imgClassName = 'sign-document-b2e-company__provider_selected__external-img';\n\t\tconst img = this.getLayout()?.getElementsByClassName(imgClassName)[0] ?? null;\n\t\tif (!img)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\timg.src = provider.iconUrl;\n\t}\n\n\t#makeGoskeyApikeyExpiredLabel(): Label\n\t{\n\t\treturn new Label({\n\t\t\ttext: Loc.getMessage('SIGN_B2E_GOSKEY_APIKEY_EXPIRED'),\n\t\t\tcolor: LabelColor.WARNING,\n\t\t\tfill: true,\n\t\t\tcustomClass: 'sign-document-b2e-company__provider_label',\n\t\t});\n\t}\n\n\t#showConnectMenu(): void\n\t{\n\t\tconst menu = new Menu({\n\t\t\tbindElement: this.#providerConnectDropdownBtnLayout,\n\t\t\tcacheable: false,\n\t\t});\n\t\tmenu.addMenuItem({\n\t\t\ttext: Loc.getMessage('SIGN_B2E_PROVIDER_DISCONNECT'),\n\t\t\tonclick: () => {\n\t\t\t\tvoid this.#disconnectCurrentProvider();\n\t\t\t\tmenu.close();\n\t\t\t},\n\t\t});\n\t\tmenu.show();\n\t}\n\n\t#tryStartProviderTour(): void\n\t{\n\t\tconst guide = new Guide({\n\t\t\tid: 'sign-b2e-provider-tour',\n\t\t\tonEvents: true,\n\t\t\tautoSave: true,\n\t\t\tsteps: [\n\t\t\t\t{\n\t\t\t\t\ttarget: this.#providerConnectedSelectDropdownBtnLayout,\n\t\t\t\t\ttitle: `\n\t\t\t\t\t\t<p class=\"sign-document-b2e-company__provider_tour-step-head\">\n\t\t\t\t\t\t\t${Loc.getMessage('SIGN_B2E_TOUR_HEAD')}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t`,\n\t\t\t\t\ttext: `\n\t\t\t\t\t\t<p class=\"sign-document-b2e-company__provider_tour-step-text\">\n\t\t\t\t\t\t\t${Loc.getMessage('SIGN_B2E_TOUR_TEXT')}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<span class=\"sign-document-b2e-company__provider_tour-step-icon\"></span>\n\t\t\t\t\t`,\n\t\t\t\t\tcondition: {\n\t\t\t\t\t\ttop: true,\n\t\t\t\t\t\tbottom: false,\n\t\t\t\t\t\tcolor: 'primary',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t\tpopupOptions: {\n\t\t\t\twidth: 380,\n\t\t\t\tautoHide: true,\n\t\t\t\tclassName: 'sign-document-b2e-company__provider_popup-tour',\n\t\t\t\tcenterAngle: true,\n\t\t\t},\n\t\t});\n\t\tvoid guide.startOnce();\n\t}\n\n\tsetProvider(rqInn: ?string, company: Company): void\n\t{\n\t\tthis.#resetProviderState();\n\t\tif (company?.providers?.length > 0)\n\t\t{\n\t\t\thide(this.#providerDisconnectedLayout);\n\t\t\tthis.#updateProviderMenu(company);\n\n\t\t\treturn;\n\t\t}\n\n\t\thide(this.#connectedProviderLayout);\n\t\thide(this.#providerUnsetLayout);\n\t\thide(this.#providerInfoLayout);\n\t\tif (!rqInn)\n\t\t{\n\t\t\thide(this.#providerDisconnectedBtnLayout);\n\t\t}\n\t}\n\n\t#updateProviderMenu(company: Company): void\n\t{\n\t\tthis.#resetProvider();\n\t\tconst menu = this.#getProviderMenu();\n\n\t\tcompany.providers.forEach((provider: Provider) => {\n\t\t\tconst { providerName, description } = this.#getConnectedName(provider, company.rqInn);\n\n\t\t\tmenu.addItem({\n\t\t\t\tid: provider.uid,\n\t\t\t\ttitle: providerName,\n\t\t\t\tsubtitle: description,\n\t\t\t\tavatar: this.#getEntityAvatar(provider),\n\t\t\t\tentityId: 'b2e-provider',\n\t\t\t\ttabs: 'b2e-providers',\n\t\t\t\tbadges: this.#getEntityBadges(provider),\n\t\t\t});\n\t\t});\n\t\tconst [firstItem] = menu.getItems();\n\t\tfirstItem.select();\n\n\t\tconst nothingToSelect = !company?.registerUrl && company?.providers?.length < 2;\n\t\tDom.style(\n\t\t\tthis.#providerConnectedSelectDropdownBtnLayout,\n\t\t\t'display',\n\t\t\tnothingToSelect ? 'none' : 'block',\n\t\t);\n\n\t\tif (this.#options.region === 'ru' && this.#options.documentInitiatedType !== DocumentInitiated.employee)\n\t\t{\n\t\t\tthis.#tryStartProviderTour();\n\t\t}\n\t}\n\n\t#getProviderConnectedDescription(provider: Provider, rqInn: number): string\n\t{\n\t\tif (provider.autoRegister)\n\t\t{\n\t\t\treturn this.#showTaxId\n\t\t\t\t? Loc.getMessage('SIGN_B2E_SELECT_PROVIDER_WITHOUT_DATE', {\n\t\t\t\t\t'#RQINN#': rqInn,\n\t\t\t\t})\n\t\t\t\t: Loc.getMessage('SIGN_B2E_SELECT_PROVIDER_WITHOUT_INN_DATE');\n\t\t}\n\n\t\tconst formattedDate = DateTimeFormat.format(\n\t\t\tDateTimeFormat.getFormat('FORMAT_DATE'),\n\t\t\tprovider.timestamp,\n\t\t);\n\n\t\treturn this.#showTaxId\n\t\t\t? Loc.getMessage('SIGN_B2E_SELECT_PROVIDER', {\n\t\t\t\t'#RQINN#': rqInn,\n\t\t\t\t'#DATE#': formattedDate,\n\t\t\t})\n\t\t\t: Loc.getMessage('SIGN_B2E_SELECT_PROVIDER_WITHOUT_INN', { '#DATE#': formattedDate });\n\t}\n\n\t#getConnectedName(provider: Provider, rqInn: number): string\n\t{\n\t\tconst providerName = provider.code === 'external'\n\t\t\t? provider.name\n\t\t\t: this.#getProviderNameByCode(provider.code)\n\t\t;\n\t\tconst description = this.#getProviderConnectedDescription(provider, rqInn);\n\n\t\treturn { providerName, description };\n\t}\n\n\t#getProviderNameByCode(code: ProviderCodeType): string\n\t{\n\t\tswitch (code)\n\t\t{\n\t\t\tcase 'goskey':\n\t\t\t\treturn Loc.getMessage('SIGN_B2E_PROVIDER_GOSKEY_NAME');\n\t\t\tcase 'ses-ru':\n\t\t\t\treturn Loc.getMessage('SIGN_B2E_PROVIDER_SES_NAME');\n\t\t\tcase 'ses-com':\n\t\t\t\treturn Loc.getMessage('SIGN_B2E_PROVIDER_SES_COM_NAME');\n\t\t\tcase 'ses-ru-express':\n\t\t\t\treturn Loc.getMessage('SIGN_B2E_PROVIDER_SES_RU_EXPRESS_NAME');\n\t\t\tdefault:\n\t\t\t\treturn '';\n\t\t}\n\t}\n\n\tsetProviderById(id: string): void\n\t{\n\t\tconst providerMenu = this.#getProviderMenu();\n\t\tconst providers = providerMenu.getItems();\n\t\tconst currentProvider = providers.find((provider) => provider.id === id);\n\t\tcurrentProvider?.select();\n\t}\n\n\t#resetProviderClasses()\n\t{\n\t\tconst providerClasses = allowedSignatureProviders.map((provider) => `--${provider}`);\n\t\tproviderClasses.push('--expired');\n\t\tDom.removeClass(this.#connectedProviderLayout, providerClasses);\n\t}\n\n\t#resetProvider()\n\t{\n\t\tthis.#providerMenu = null;\n\t\tthis.#resetProviderClasses();\n\t}\n\n\t#onProviderDeselect(): void\n\t{\n\t\tDom.style(this.#providerUnsetLayout, 'display', 'flex');\n\t\thide(this.#connectedProviderLayout);\n\t\tthis.#renderProviderInfo();\n\t\tthis.#providerMenu.hide();\n\t\tthis.#company.provider = null;\n\t\tthis.emit(this.events.onProviderDeselect);\n\t}\n\n\t#renderProviderInfo(provider: Provider | null = null): void\n\t{\n\t\tconst code = provider?.code ?? '';\n\t\tDom.clean(this.#providerInfoLayout);\n\t\tif (!provider)\n\t\t{\n\t\t\tconst firstParagraph = Tag.render`\n\t\t\t\t<p>\n\t\t\t\t\t${Loc.getMessage('SIGN_B2E_COMPANIES_UNSET_PROVIDER_PARAGRAPH_1')}\n\t\t\t\t</p>\n\t\t\t`;\n\t\t\tconst secondParagraph = Tag.render`\n\t\t\t\t<p>\n\t\t\t\t\t${Loc.getMessage('SIGN_B2E_COMPANIES_UNSET_PROVIDER_PARAGRAPH_2')}\n\t\t\t\t</p>\n\t\t\t`;\n\t\t\tconst thirdParagraph = Tag.render`\n\t\t\t\t<p>\n\t\t\t\t\t${Helpdesk.replaceLink(\n\t\t\t\tLoc.getMessage('SIGN_B2E_COMPANIES_UNSET_PROVIDER_MORE'),\n\t\t\t\tHelpdeskCodes.HowToChooseProvider,\n\t\t\t)}\n\t\t\t\t</p>\n\t\t\t`;\n\t\t\tDom.append(firstParagraph, this.#providerInfoLayout);\n\t\t\tDom.append(secondParagraph, this.#providerInfoLayout);\n\t\t\tDom.append(thirdParagraph, this.#providerInfoLayout);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (code === ProviderCode.external)\n\t\t{\n\t\t\tconst element = Tag.render`\n\t\t\t\t<p> ${TextFormat.encode(provider.description)} </p>\n\t\t\t`;\n\n\t\t\tDom.append(element, this.#providerInfoLayout);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (code === ProviderCode.sesCom)\n\t\t{\n\t\t\tlet providerInfo = Loc.getMessage('SIGN_B2E_COMPANY_SES_COM_INFO') ?? '';\n\t\t\tproviderInfo = Helpdesk.replaceLink(\n\t\t\t\tproviderInfo,\n\t\t\t\tHelpdeskCodes.SesComDetails,\n\t\t\t);\n\t\t\tproviderInfo = Link.replaceInLoc(\n\t\t\t\tproviderInfo,\n\t\t\t\tsesComLearnMoreLink,\n\t\t\t);\n\n\t\t\tconst text = Tag.render`<span>${providerInfo}</span>`;\n\t\t\tDom.style(text.firstElementChild, { display: 'none' });\n\t\t\tDom.append(text, this.#providerInfoLayout);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst providerCodeToProviderInfoTextMap: { [key: ProviderCodeType]: ?string } = {\n\t\t\tgoskey: Loc.getMessage('SIGN_B2E_COMPANY_GOSKEY_INFO'),\n\t\t\t'ses-ru': Loc.getMessage('SIGN_B2E_COMPANY_SES_RU_INFO'),\n\t\t\t'ses-ru-express': Loc.getMessage('SIGN_B2E_COMPANY_SES_RU_EXPRESS_INFO'),\n\t\t};\n\t\tconst providerCodeToHelpdeskCodeMap: { [key: ProviderCodeType]: string } = {\n\t\t\tgoskey: HelpdeskCodes.GoskeyDetails,\n\t\t\t'ses-ru': HelpdeskCodes.SesRuDetails,\n\t\t\t'ses-ru-express': HelpdeskCodes.SesRuExpressDetails,\n\t\t};\n\n\t\tconst text = Tag.render`<span>${Helpdesk.replaceLink(\n\t\t\tproviderCodeToProviderInfoTextMap[code] ?? '',\n\t\t\tproviderCodeToHelpdeskCodeMap[code] ?? '',\n\t\t)}</span>`;\n\t\tDom.append(text, this.#providerInfoLayout);\n\n\t\tif (this.#isProviderExpiresSoon(provider) || this.#isProviderExpired(provider))\n\t\t{\n\t\t\tDom.append(this.#getProviderAlert(provider).render(), this.#providerInfoLayout);\n\t\t}\n\t}\n\n\t#getProviderAlert(provider: Provider): Alert\n\t{\n\t\treturn new Alert({\n\t\t\ttext: this.#getProviderAlertMessage(provider),\n\t\t\tcustomClass: 'sign-document-b2e-company__provider_alert',\n\t\t});\n\t}\n\n\t#getProviderAlertMessage(provider: Provider): string\n\t{\n\t\tif (this.#isProviderExpired(provider))\n\t\t{\n\t\t\treturn Helpdesk.replaceLink(\n\t\t\t\tLoc.getMessage('SIGN_B2E_GOSKEY_APIKEY_EXPIRED_MORE_MSGVER_1'),\n\t\t\t\tHelpdeskCodes.GoskeyApiKey,\n\t\t\t);\n\t\t}\n\n\t\tconst daysLeft = this.#getProviderDaysLeft(provider.expires);\n\t\tconst alertText = Loc.getMessagePlural('SIGN_B2E_GOSKEY_APIKEY_EXPIRES_MSGVER_1', daysLeft, {\n\t\t\t'#DAYS#': daysLeft,\n\t\t});\n\n\t\treturn Helpdesk.replaceLink(alertText, HelpdeskCodes.GoskeyApiKey);\n\t}\n\n\t#resetProviderState(): void\n\t{\n\t\tshow(this.getLayout());\n\t\tshow(this.#providerInfoLayout);\n\t\tshow(this.#providerDisconnectedLayout);\n\t\tDom.style(this.#connectedProviderLayout, 'display', 'flex');\n\t\tDom.style(this.#providerDisconnectedLayout, 'display', 'flex');\n\t}\n\n\t#isProviderExpiresSoon(provider: Provider): boolean\n\t{\n\t\tif (!provider.expires)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tconst daysLeft = this.#getProviderDaysLeft(provider.expires);\n\n\t\treturn daysLeft <= this.#providerExpiresDaysToShowInfo && daysLeft >= 1;\n\t}\n\n\t#isProviderExpired(provider: Provider): boolean\n\t{\n\t\treturn provider.expires && this.#getProviderDaysLeft(provider.expires) < 1;\n\t}\n\n\t#getProviderDaysLeft(expires: Number): Number\n\t{\n\t\tconst now = Date.now() / 1000;\n\n\t\treturn Math.floor((expires - now) / 86400);\n\t}\n\n\t#getCompanyById(id: number): Company | undefined\n\t{\n\t\treturn this.#companyList.find((company) => id === company.id);\n\t}\n\n\tsetCompanyList(companies: Array<Company>): void\n\t{\n\t\tthis.#companyList = Runtime.clone(companies);\n\t}\n\n\tasync #disconnectCurrentProvider(): Promise<void>\n\t{\n\t\tif (!this.#company.provider)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst company = this.#getCompanyById(this.#company.id ?? 0);\n\t\tif (!company)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst id = this.#company.provider.uid;\n\t\tif (!id || this.#company.provider.autoRegister)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.emit(this.events.onProviderDisconnect, { provider: this.#company.provider });\n\t}\n\n\tsetCompany(company: CompanyData): void\n\t{\n\t\tthis.#company = Runtime.clone(company);\n\t}\n\n\t#openProvidersConnectionSlider(): void\n\t{\n\t\tconst company = this.#getCompanyById(this.#company?.id);\n\t\tif (company && company.registerUrl)\n\t\t{\n\t\t\tconst url = new URL(company.registerUrl);\n\t\t\tconst allowedOrigin = url.origin;\n\t\t\tBX.SidePanel.Instance.open('sign:stub', {\n\t\t\t\twidth: 1100,\n\t\t\t\tcacheable: false,\n\t\t\t\tallowCrossDomain: true,\n\t\t\t\tallowChangeHistory: false,\n\t\t\t\tcontentCallback: () => {\n\t\t\t\t\tconst frameStyles = 'position: absolute; left: 0; top: 0; padding: 0;'\n\t\t\t\t\t\t+ ' border: none; margin: 0; width: 100%; height: 100%;';\n\t\t\t\t\tthis.#registerIframe = Tag.render`<iframe src=\"${company.registerUrl}\" style=\"${frameStyles}\"></iframe>`;\n\n\t\t\t\t\treturn this.#registerIframe;\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: () => this.emit(this.events.providerConnectionSlider.onClose),\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tthis.#initIframeConnect(allowedOrigin);\n\t\t\tthis.#subscribeIframeConnectedEvent(allowedOrigin);\n\t\t\tthis.#subscribeIframeCloseEvent(allowedOrigin);\n\t\t}\n\t}\n\n\t#subscribeIframeConnectedEvent(allowedOrigin: string): void\n\t{\n\t\tif (this.#isSubscribedIframeConnectedEvent)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tEvent.bind(window, 'message', (event: MessageEvent<any>) => {\n\t\t\tif (event.origin === allowedOrigin && event.data === 'Event:b2e-crossorigin:connected')\n\t\t\t{\n\t\t\t\tclearInterval(this.#iframeConnectInterval);\n\t\t\t\tconst company = this.#getCompanyById(this.#company.id ?? 0);\n\t\t\t\tif (company)\n\t\t\t\t{\n\t\t\t\t\tthis.#registerIframe.contentWindow.postMessage({ companyName: company.title }, allowedOrigin);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.#isSubscribedIframeConnectedEvent = true;\n\t}\n\n\t#subscribeIframeCloseEvent(allowedOrigin: string): void\n\t{\n\t\tif (this.#isSubscribedIframeCloseEvent)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tEvent.bind(window, 'message', (event: MessageEvent) => {\n\t\t\tif (event.origin === allowedOrigin && event.data === 'Event:b2e-crossorigin:close-iframe')\n\t\t\t{\n\t\t\t\tBX.SidePanel.Instance.close();\n\t\t\t}\n\t\t});\n\n\t\tthis.#isSubscribedIframeCloseEvent = true;\n\t}\n\n\t#initIframeConnect(allowedOrigin: string): void\n\t{\n\t\tthis.#iframeConnectInterval = setInterval(() => {\n\t\t\tif (this.#registerIframe && this.#registerIframe.contentWindow)\n\t\t\t{\n\t\t\t\tthis.#registerIframe.contentWindow.postMessage('Event:b2e-crossorigin:initConnection', allowedOrigin);\n\t\t\t}\n\t\t}, 500);\n\t}\n\n\t#getEntityAvatar(provider: Provider): string\n\t{\n\t\tif (provider.code === ProviderCode.goskey)\n\t\t{\n\t\t\treturn this.#isProviderExpired(provider)\n\t\t\t\t? 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzYiIGhlaWdodD0iMzYiIHZpZXdCb3g9IjAgMCAzNiAzNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjM2IiBoZWlnaHQ9IjM2IiByeD0iMTgiIGZpbGw9IiNCREMxQzYiLz4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xNi4zMzA1IDE0Ljg5OTlMMTkuNzU3MiAxMS40NzMxQzIwLjM4ODEgMTAuODQyMyAyMS40MTA5IDEwLjg0MjMgMjIuMDQxNyAxMS40NzMxTDI0LjcwNyAxNC4xMzg0QzI1LjMzNzggMTQuNzY5MiAyNS4zMzc4IDE1Ljc5MiAyNC43MDcgMTYuNDIyOUwyMS4yODAyIDE5Ljg0OTZDMjAuODU5NyAyMC4yNzAyIDIwLjE3OTEgMjAuMjcxNSAxOS43NTg1IDE5Ljg1MDlMMTYuMzI5OCAxNi40MjIyQzE1LjkwOTMgMTYuMDAxNiAxNS45MDk5IDE1LjMyMDQgMTYuMzMwNSAxNC44OTk5Wk0yMS42NjEgMTUuNjYxNEMyMS4zNDU2IDE1Ljk3NjggMjAuODM0MiAxNS45NzY4IDIwLjUxODcgMTUuNjYxNEMyMC4yMDMzIDE1LjM0NiAyMC4yMDMzIDE0LjgzNDYgMjAuNTE4NyAxNC41MTkxQzIwLjgzNDIgMTQuMjAzNyAyMS4zNDU2IDE0LjIwMzcgMjEuNjYxIDE0LjUxOTFDMjEuOTc2NCAxNC44MzQ2IDIxLjk3NjQgMTUuMzQ2IDIxLjY2MSAxNS42NjE0WiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTE3LjA5MiAxNy45NDU5TDE4LjQyNDYgMTkuMjc4NUMxOC42MzQ5IDE5LjQ4ODggMTguNjM0OSAxOS44Mjk3IDE4LjQyNDYgMjAuMDRMMTcuMDU5MyAyMS40MDUzQzE2Ljk1ODQgMjEuNTA2MyAxNi44MjE0IDIxLjU2MyAxNi42Nzg2IDIxLjU2M0gxNS4zNzg2VjIyLjg2M0MxNS4zNzg2IDIzLjAwNTggMTUuMzIxOSAyMy4xNDI3IDE1LjIyMDkgMjMuMjQzN0wxNS4xNTU2IDIzLjMwOUMxNS4wNTQ2IDIzLjQxIDE0LjkxNzYgMjMuNDY2OCAxNC43NzQ4IDIzLjQ2NjhIMTMuNDc0OVYyNC43NjY3QzEzLjQ3NDkgMjQuOTA5NSAxMy40MTgxIDI1LjA0NjUgMTMuMzE3MiAyNS4xNDc1TDEyLjg3MTEgMjUuNTkzNUMxMi43NzAxIDI1LjY5NDUgMTIuNjMzMSAyNS43NTEzIDEyLjQ5MDMgMjUuNzUxM0gxMS4zMjVDMTEuMjM4OCAyNS43NTEzIDExLjE1NjEgMjUuNzE3IDExLjA5NTIgMjUuNjU2MUMxMS4wMzQyIDI1LjU5NTEgMTEgMjUuNTEyNSAxMSAyNS40MjYzVjIzLjY1NzFMMTUuMTg4MiAxOS40Njg5QzE0Ljk3OCAxOS4yNTg2IDE0Ljk3OCAxOC45MTc3IDE1LjE4ODIgMTguNzA3NEwxNS45NDk3IDE3Ljk0NTlDMTYuMjY1MiAxNy42MzA1IDE2Ljc3NjYgMTcuNjMwNSAxNy4wOTIgMTcuOTQ1OVoiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNNS42MTUyNiAxNy4wNTY0VjE5LjMwMDJDNS42MTUyNiAyMC43MzA5IDUuNjE2ODIgMjEuNjk0NiA1LjY4NTA2IDIyLjQ1MjJDNS43NTAzMSAyMy4xNzY1IDUuODY4ODYgMjMuNTk0MiA2LjA0MzgxIDIzLjkzNDVDNi4yMTg3NyAyNC4yNzQ5IDYuNDg4MzggMjQuNjEyMyA3LjAzNjA3IDI1LjA4MDRDNy42MDg4NiAyNS41NyA4LjM4NjI5IDI2LjEyMTcgOS41NDE2OCAyNi45Mzg3TDExLjA0NTkgMjguMDAyNEwxMy41Nzc5IDI5LjQyMjRDMTQuODc2MiAzMC4xNTA1IDE1Ljc1MjYgMzAuNjQwMSAxNi40NzUgMzAuOTU4NUMxNy4xNjYgMzEuMjYzIDE3LjYwNCAzMS4zNTc5IDE3Ljk5OTkgMzEuMzU3OUMxOC4zOTU3IDMxLjM1NzkgMTguODMzNyAzMS4yNjMgMTkuNTI0NyAzMC45NTg1QzIwLjI0NzIgMzAuNjQwMSAyMS4xMjM1IDMwLjE1MDUgMjIuNDIxOSAyOS40MjI0TDI0Ljk1MzkgMjguMDAyNEwyNi40NTgxIDI2LjkzODdDMjcuNjEzNSAyNi4xMjE3IDI4LjM5MDkgMjUuNTcgMjguOTYzNyAyNS4wODA0QzI5LjUxMTQgMjQuNjEyMyAyOS43ODEgMjQuMjc0OSAyOS45NTU5IDIzLjkzNDVDMzAuMTMwOSAyMy41OTQyIDMwLjI0OTQgMjMuMTc2NSAzMC4zMTQ3IDIyLjQ1MjJDMzAuMzgyOSAyMS42OTQ2IDMwLjM4NDUgMjAuNzMwOSAzMC4zODQ1IDE5LjMwMDJWMTcuMDU2NEMzMC4zODQ1IDE1LjYyNTcgMzAuMzgyOSAxNC42NjE5IDMwLjMxNDcgMTMuOTA0NEMzMC4yNDk0IDEzLjE4IDMwLjEzMDkgMTIuNzYyMyAyOS45NTU5IDEyLjQyMkMyOS43ODEgMTIuMDgxNiAyOS41MTE0IDExLjc0NDIgMjguOTYzNyAxMS4yNzYxQzI4LjM5MDkgMTAuNzg2NSAyNy42MTM1IDEwLjIzNDkgMjYuNDU4MSA5LjQxNzgzTDI0LjkxOTggOC4zMzAwNEwyMi44MjczIDcuMDA5OEMyMS40MTc3IDYuMTIwNDIgMjAuNDYzNCA1LjUyMDc0IDE5LjY3MzQgNS4xMzA3QzE4LjkxNzMgNC43NTczMyAxOC40MzY4IDQuNjQyMDYgMTcuOTk5OSA0LjY0MjA2QzE3LjU2MyA0LjY0MjA2IDE3LjA4MjUgNC43NTczMyAxNi4zMjYzIDUuMTMwN0MxNS41MzYzIDUuNTIwNzQgMTQuNTgyMSA2LjEyMDQyIDEzLjE3MjUgNy4wMDk4TDExLjA4IDguMzMwMDNMOS41NDE2NyA5LjQxNzgzQzguMzg2MjkgMTAuMjM0OSA3LjYwODg2IDEwLjc4NjUgNy4wMzYwNyAxMS4yNzYxQzYuNDg4MzggMTEuNzQ0MiA2LjIxODc3IDEyLjA4MTYgNi4wNDM4MSAxMi40MjJDNS44Njg4NiAxMi43NjIzIDUuNzUwMzEgMTMuMTggNS42ODUwNiAxMy45MDQ0QzUuNjE2ODIgMTQuNjYxOSA1LjYxNTI2IDE1LjYyNTcgNS42MTUyNiAxNy4wNTY0Wk0xMC4xOTIyIDYuOTU3NTNMMTIuMzIwNiA1LjYxNDY0QzE1LjA4MzMgMy44NzE1NSAxNi40NjQ2IDMgMTcuOTk5OSAzQzE5LjUzNTEgMyAyMC45MTY1IDMuODcxNTUgMjMuNjc5MiA1LjYxNDY0TDI1LjgwNzYgNi45NTc1M0wyNy4zODA2IDguMDY5ODZDMjkuNjQzOCA5LjY3MDI5IDMwLjc3NTQgMTAuNDcwNSAzMS4zODc3IDExLjY2MTVDMzEuOTk5OSAxMi44NTI1IDMxLjk5OTkgMTQuMjUzOCAzMS45OTk5IDE3LjA1NjRWMTkuMzAwMkMzMS45OTk5IDIyLjEwMjcgMzEuOTk5OSAyMy41MDQgMzEuMzg3NyAyNC42OTVDMzAuNzc1NCAyNS44ODYgMjkuNjQzOCAyNi42ODYyIDI3LjM4MDYgMjguMjg2N0wyNS44MDc2IDI5LjM5OUwyMy4yMDIzIDMwLjg2MDFDMjAuNjU4NiAzMi4yODY3IDE5LjM4NjggMzMgMTcuOTk5OSAzM0MxNi42MTMgMzMgMTUuMzQxMiAzMi4yODY3IDEyLjc5NzUgMzAuODYwMUwxMC4xOTIyIDI5LjM5OUw4LjYxOTE3IDI4LjI4NjZDNi4zNTU5MyAyNi42ODYyIDUuMjI0MzEgMjUuODg2IDQuNjEyMDkgMjQuNjk1QzMuOTk5ODggMjMuNTA0IDMuOTk5ODggMjIuMTAyNyAzLjk5OTg4IDE5LjMwMDJWMTcuMDU2NEMzLjk5OTg4IDE0LjI1MzggMy45OTk4OCAxMi44NTI1IDQuNjEyMDkgMTEuNjYxNUM1LjIyNDMxIDEwLjQ3MDUgNi4zNTU5NCA5LjY3MDI5IDguNjE5MTggOC4wNjk4NkwxMC4xOTIyIDYuOTU3NTNaIiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4K'\n\t\t\t\t: 'data:image/png;base64,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';\n\t\t}\n\n\t\tif (\n\t\t\tprovider.code === ProviderCode.external\n\t\t\t&& Type.isStringFilled(provider.iconUrl)\n\t\t)\n\t\t{\n\t\t\treturn provider.iconUrl;\n\t\t}\n\n\t\treturn 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAANQSURBVHgBxZi/b9NAFMffnZOaFgopEkggEK5AohKgJKgLIETzD6B2YmAo3boBAyv9sXaAbh2QCgMzVQbWpELQBYErFpCQcAUqPyogoqipm9jHe5fYikMs2/n5lZxcchffJ+/dvXfPDCJqZK2o9VnWOFOUJAgxhlcCGEvITiEK2DaAgyHK9iovlVb0zJAR4fbAwg688PLvLc6VSQkRTbot7MV3Vw48DjM4EOj8i+0xRVGWsalBazIQbC4IzBcolfudsFV1BgfcgTZKADzkpjmHrixAWCCE0YSqPqMmdEYGM81Mo/XFfGBy0LqLmoJidTAJhHnbBRhHehXKdR+v7aU100UYUqo6pyvXQnJbM74MPRCzrIx+dTBPbddCCDMDPZKohJUKB72QdaANrpo+GYfnF/fBcTV0vHWkVRkqQJyx29CiCGb6REzCPDqnRoaSWYDeaZujF1uKNw6MI4IZPcij3QRTUvqNOMXteHwcWlA9DGnpcwmyWxZElbVbnOAsxq9Bk/KDWfpShmbEGEtysIUGTajdMFLoNo7ZToOI6ghMRQnuHq56D1MFiqCbx2KdhJHi8tgZQrSVc78s+LAjOgaDKsTQZQQU6DayzughBe6+N+HBiAq5n+V2w5AMLkCshhlJMGcHGMyfjsON9V14/ceG+TN9nohMwdCJ1o6uH1HkFUbIshHDba9j7pgMGpz9XpLuIhCa0IHJDHFY2CjDIM55T4tXII7GYMEoyc8OXHarCMFieZbCskYI8QlCiqzgwNCayhz2/vvtsoDBGPN8Jtc+/RrsXgyMw/KXybViLkx5Q+6if79pCrj/cU9ai1xEoYAmJqvUujL7A0G+WbIvhPT1ywNpCZTC1C9CHs5oHW3ugWcSmnzbgrATNxQT9pSOJZJr2+SrHXKbBr2RgdYZpoYbGPEYOQU9Elpnzmm7QHSmFVjyQpeFMIt6TTXrSR18rzSL0UCH7smAgf2ztV94gKg+YoxPyIFdgMFtntHTrOALJKEu9cuBHYbSJQzOVd/RMNtLKNNMd2JN0Zph/f0NYWR/0A2qMaodFa1BO9kpCP0UulapgFG5FLlCyaNVnujtemD1HxjmPsBHeoJTcYDncToCex/p0ZVHa6yDoqz4ucZP/wB0m3kbYruWeAAAAABJRU5ErkJggg==';\n\t}\n\n\t#getEntityBadges(provider: Provider): Array<Object>\n\t{\n\t\tif (provider.code === ProviderCode.goskey && this.#isProviderExpired(provider))\n\t\t{\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\ttitle: Loc.getMessage('SIGN_B2E_GOSKEY_APIKEY_EXPIRED'),\n\t\t\t\t\ttextColor: 'var(--ui-color-palette-white-base)',\n\t\t\t\t\tbgColor: 'var(--ui-color-palette-orange-60)',\n\t\t\t\t},\n\t\t\t];\n\t\t}\n\n\t\treturn [];\n\t}\n\n\tvalidate(): boolean\n\t{\n\t\treturn Type.isObject(this.#company.provider)\n\t\t\t&& Type.isStringFilled(this.#company.provider.uid)\n\t\t\t&& !this.#isProviderExpired(this.#company.provider);\n\t}\n\n\tasync registerVirtualProviderIfNeed(): Promise<void>\n\t{\n\t\tif (!this.#company.provider.virtual)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst selectedItem = this.#getCompanyById(this.#company.id);\n\t\tconst { id } = await this.#api.registerB2eCompany(\n\t\t\tthis.#company.provider.code,\n\t\t\tselectedItem.rqInn,\n\t\t\tthis.#company.id,\n\t\t\tthis.#company.provider.externalProviderId,\n\t\t);\n\t\tthis.#company.provider.uid = id;\n\t\tthis.#company.provider.virtual = false;\n\t}\n\n\tgetCurrentProvider(): ?Provider\n\t{\n\t\treturn this.#company?.provider;\n\t}\n}\n","import { Dom, Loc, Tag, Text as TextFormat, Type } from 'main.core';\nimport { MemoryCache } from 'main.core.cache';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Loader } from 'main.loader';\nimport { Menu } from 'main.popup';\nimport type { DocumentInitiatedType, ProviderCodeType } from 'sign.type';\nimport { DocumentInitiated } from 'sign.type';\nimport type { B2eCompanyList, Company, Provider } from 'sign.v2.api';\nimport { Api } from 'sign.v2.api';\nimport { HcmLinkCompanySelector } from 'sign.v2.b2e.hcm-link-company-selector';\nimport { type Scheme, SchemeType } from 'sign.v2.b2e.scheme-selector';\nimport { CompanyEditor, CompanyEditorMode, DocumentEntityTypeId, EditorTypeGuid } from 'sign.v2.company-editor';\nimport { Alert, AlertColor, AlertSize } from 'ui.alerts';\nimport { Dialog } from 'ui.entity-selector';\nimport { hide, show } from './functions';\nimport type { ProviderSelectedEvent } from './provider-selector';\nimport { allowedSignatureProviders, ProviderSelector } from './provider-selector';\n\nimport './style.css';\n\nexport type CompanySelectedEvent = BaseEvent<{companyId: number, provider: Provider }>;\nexport type { ProviderCodeType, ProviderSelectedEvent };\nexport const ProviderCode: Readonly<Record<string, ProviderCodeType>> = Object.freeze({\n\tgoskey: 'goskey',\n\tsesCom: 'ses-com',\n\tsesRuExpress: 'ses-ru-express',\n\tsesRu: 'ses-ru',\n\texternal: 'external',\n});\n\nexport type CompanyData = {\n\tid: ?number,\n\tprovider: ?Provider\n};\n\nexport type CompanySelectorOptions = {\n\tcompanyId: ?number,\n\tentityId: number;\n\tregion: string;\n\tdocumentInitiatedType?: DocumentInitiatedType;\n\tloadCompanyPromise?: Promise<B2eCompanyList>;\n\tcanCreateCompany?: boolean;\n\tcanEditCompany?: boolean;\n\tisCompaniesDeselectable?: boolean,\n\tneedOpenCrmSaveAndEditCompanySliders?: boolean,\n};\n\nexport const HelpdeskCodes: $ReadOnly<{ [key: string]: string }> = Object.freeze({\n\tHowToChooseProvider: '19740650',\n\tGoskeyDetails: '19740688',\n\tSesRuDetails: '19740668',\n\tSesComDetails: '19740668',\n\tSesRuExpressDetails: '26311976',\n\tTaxcomDetails: '19740696',\n\tGoskeyApiKey: '19740816',\n});\n\nexport class CompanySelector extends EventEmitter\n{\n\tevents = {\n\t\tonCompaniesLoad: 'onCompaniesLoad',\n\t\tonSelect: 'onSelect',\n\t\tonProviderSelect: 'onProviderSelect',\n\t};\n\n\t#api: Api;\n\t#layoutCache: MemoryCache<HTMLElement> = new MemoryCache();\n\t#companyList: Array<Company> = [];\n\n\t#reloadDelayForHide: Number = 1000;\n\n\t#company: CompanyData = {\n\t\tid: null,\n\t\tprovider: {\n\t\t\tcode: null,\n\t\t\tuid: null,\n\t\t\ttimestamp: null,\n\t\t},\n\t};\n\n\t#loader: Loader = null;\n\t#dialog: Dialog = null;\n\t#showTaxId: boolean = true;\n\t#options: CompanySelectorOptions;\n\t#loadPromise: Promise<void>;\n\t#providerSelector: ProviderSelector;\n\n\tconstructor(options: CompanySelectorOptions = {})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Sign.V2.B2e.CompanySelector');\n\t\tthis.#options = options;\n\t\tthis.#api = new Api();\n\t\tthis.#providerSelector = new ProviderSelector({\n\t\t\tregion: options.region,\n\t\t\tdocumentInitiatedType: options.documentInitiatedType ?? DocumentInitiated.company,\n\t\t});\n\n\t\tthis.#setEmptyState();\n\t\tthis.#loadPromise = this.#load();\n\t\tthis.#subscribeOnEvents();\n\t}\n\n\t#subscribeOnEvents(): void\n\t{\n\t\tconst providerSelectorEvents = this.#providerSelector.events;\n\t\tthis.#providerSelector.subscribe(\n\t\t\tproviderSelectorEvents.onProviderSelect,\n\t\t\t(event: ProviderSelectedEvent) => {\n\t\t\t\tthis.#onProviderSelect(event.getData().provider.id);\n\t\t\t\tthis.emit(this.events.onProviderSelect, {\n\t\t\t\t\tprovider: this.getSelectedCompanyProvider(event),\n\t\t\t\t});\n\t\t\t},\n\t\t);\n\t\tthis.#providerSelector.subscribe(\n\t\t\tproviderSelectorEvents.onProviderDeselect,\n\t\t\t() => this.#onProviderDeselect(),\n\t\t);\n\t\tthis.#providerSelector.subscribe(\n\t\t\tproviderSelectorEvents.providerConnectionSlider.onClose,\n\t\t\t() => this.#load(),\n\t\t);\n\t\tthis.#providerSelector.subscribe(\n\t\t\tproviderSelectorEvents.onProviderDisconnect,\n\t\t\tthis.#onProviderDisconnect.bind(this),\n\t\t);\n\t}\n\n\t#showLoader(): void\n\t{\n\t\thide(this.#getInfoLayout());\n\t\thide(this.#getSelectorLayout());\n\t\tthis.#getLoader().show(this.getLayout());\n\t}\n\n\t#hideLoader(): void\n\t{\n\t\tshow(this.#getSelectorLayout());\n\t\tthis.#getLoader().hide();\n\t}\n\n\tasync load(companyUid: string, companyEntityId: number | null): Promise<void>\n\t{\n\t\tawait this.#loadPromise;\n\t\tconst company = this.#companyList.find(({ id, providers }) => {\n\t\t\tif (!Type.isNull(companyEntityId) && companyEntityId > 0)\n\t\t\t{\n\t\t\t\treturn companyEntityId === id;\n\t\t\t}\n\n\t\t\treturn providers.some(({ uid }) => {\n\t\t\t\treturn uid === companyUid;\n\t\t\t});\n\t\t});\n\t\tif (Type.isUndefined(company))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.#company.id = company.id;\n\t\tthis.#updateDialogItems();\n\t\tthis.#selectProvider(companyUid);\n\t}\n\n\tasync loadFirstCompany(): void\n\t{\n\t\tawait this.#loadPromise;\n\n\t\tif (this.#companyList.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst company = this.#companyList[0];\n\t\tthis.#company.id = company.id;\n\t\tthis.#updateDialogItems();\n\t\tif (company.providers.length > 0)\n\t\t{\n\t\t\tthis.#selectProvider(company.providers[0].uid);\n\t\t}\n\t}\n\n\tsetOptions(options: Partial<CompanySelectorOptions>): void\n\t{\n\t\tthis.#options = { ...this.#options, ...options };\n\t}\n\n\tgetProviderLayout(): HTMLElement\n\t{\n\t\treturn this.#providerSelector.getLayout();\n\t}\n\n\tgetLayout(): HTMLDivElement\n\t{\n\t\treturn this.#layoutCache.remember('layout', () => {\n\t\t\tconst requireCrmPermissionLayout = this.#options.needOpenCrmSaveAndEditCompanySliders\n\t\t\t\t? this.#getCompanySaveAndEditRequireCrmPermissionLayout()\n\t\t\t\t: ''\n\t\t\t;\n\t\t\tif (!this.#showTaxId)\n\t\t\t{\n\t\t\t\thide(this.#getInfoRqInnLayout());\n\t\t\t}\n\n\t\t\treturn Tag.render`\n\t\t\t\t<div>\n\t\t\t\t\t<div class=\"sign-document-b2e-company\">\n\t\t\t\t\t\t${(this.#getSelectorLayout())}\n\t\t\t\t\t\t${(this.#getInfoLayout())}\n\t\t\t\t\t</div>\n\t\t\t\t\t${requireCrmPermissionLayout}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\t#getInfoLayout(): HTMLElement\n\t{\n\t\treturn this.#layoutCache.remember('infoLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-document-b2e-company-info\">\n\t\t\t\t\t<div class=\"sign-document-b2e-company-info-img\"></div>\n\t\t\t\t\t${this.#getInfoTitleLayout()}\n\t\t\t\t\t${this.#getInfoEditBtn()}\n\t\t\t\t\t${this.#getInfoRqBtnLayout()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\t#getInfoRqBtnLayout(): HTMLElement | null\n\t{\n\t\tif (!(this.#options.canEditCompany ?? true))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn this.#layoutCache.remember('infoRqBtnLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<button class=\"ui-btn ui-btn-xs ui-btn-round ui-btn-success\" onclick=\"${() => this.#editCompany()}\">\n\t\t\t\t\t${Loc.getMessage('SIGN_B2E_COMPANIES_CHANGE_INN_1')}\n\t\t\t\t</button>\n\t\t\t`;\n\t\t});\n\t}\n\n\t#getInfoEditBtn(): HTMLElement | null\n\t{\n\t\tif (!(this.#options.canEditCompany ?? true))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn this.#layoutCache.remember('infoEditBtn', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-document-b2e-company-info-edit\" onclick=\"${() => this.#showEditMenu()}\"></div>\n\t\t\t`;\n\t\t});\n\t}\n\n\t#getInfoTitleLayout(): HTMLElement\n\t{\n\t\treturn this.#layoutCache.remember('infoTitleLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-document-b2e-company-info-title\">\n\t\t\t\t\t<div class=\"sign-document-b2e-company-info-header\">\n\t\t\t\t\t\t${this.#getInfoHeaderTitleNameLayout()}\n\t\t\t\t\t\t${this.#getCompanyInfoLabelLayout()}\n\t\t\t\t\t\t<div class=\"sign-document-b2e-company-info-dropdown-btn\"\n\t\t\t\t\t\t\tonclick=\"${() => this.#onInfoDropDownBtnClick()}\">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.#getInfoRqInnLayout()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\t#getInfoHeaderTitleNameLayout(): HTMLElement\n\t{\n\t\treturn this.#layoutCache.remember('infoHeaderTitleNameLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-document-b2e-company-info-name\"></div>\n\t\t\t`;\n\t\t});\n\t}\n\n\t#getInfoRqInnLayout(): HTMLElement\n\t{\n\t\treturn this.#layoutCache.remember('infoRqInnLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-document-b2e-company-info-rq-inn\"></div>\n\t\t\t`;\n\t\t});\n\t}\n\n\t#getSelectorBtnLayout(): HTMLElement\n\t{\n\t\treturn this.#layoutCache.remember('selectorBtnLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<button class=\"ui-btn ui-btn-success ui-btn-xs ui-btn-round\" onclick=\"${() => this.#onSelectorBtnClick()}\">\n\t\t\t\t\t${Loc.getMessage('SIGN_B2E_COMPANIES_SELECT_BUTTON')}\n\t\t\t\t</button>\n\t\t\t`;\n\t\t});\n\t}\n\n\t#onSelectorBtnClick(): void\n\t{\n\t\tthis.#getDialog().setTargetNode(this.getLayout());\n\t\tthis.#getDialog().show();\n\t}\n\n\t#getSelectorLayout(): HTMLElement\n\t{\n\t\treturn this.#layoutCache.remember('selectorLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-document-b2e-company-select\">\n\t\t\t\t\t<span class=\"sign-document-b2e-company-select-text\">\n\t\t\t\t\t\t${Loc.getMessage('SIGN_B2E_COMPANIES_NOT_CHANGED')}\n\t\t\t\t\t</span>\n\t\t\t\t\t${(this.#getSelectorBtnLayout())}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\t#setEmptyState(): void\n\t{\n\t\thide(this.#getInfoLayout());\n\t\thide(this.getProviderLayout());\n\t\tDom.style(this.#getSelectorLayout(), 'display', 'flex');\n\t}\n\n\t#setInfoState(): void\n\t{\n\t\tDom.style(this.#getInfoLayout(), 'display', 'flex');\n\t\thide(this.#getSelectorLayout());\n\t}\n\n\tasync #load(): Promise<void>\n\t{\n\t\tthis.#showLoader();\n\t\tconst loadCompanyPromise = this.#options.loadCompanyPromise\n\t\t\t?? this.#api.loadB2eCompanyList(this.#options.documentInitiatedType ?? DocumentInitiated.company)\n\t\t;\n\n\t\tlet data = null;\n\t\ttry\n\t\t{\n\t\t\tdata = await loadCompanyPromise;\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tthis.#hideLoader();\n\t\t\tconsole.error(error);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#hideLoader();\n\t\tif (Type.isObject(data.companies) && Type.isArray(data.companies))\n\t\t{\n\t\t\tthis.#companyList = data.companies;\n\t\t\tthis.#providerSelector.setCompanyList(this.#companyList);\n\t\t\tthis.#showTaxId = Boolean(data?.showTaxId);\n\t\t\tthis.#providerSelector.setShowTaxId(this.#showTaxId);\n\t\t\tthis.#updateDialogItems();\n\t\t\tthis.emit(this.events.onCompaniesLoad, { companies: this.#companyList });\n\t\t}\n\t}\n\n\t#getLoader(): Loader\n\t{\n\t\tif (this.#loader)\n\t\t{\n\t\t\treturn this.#loader;\n\t\t}\n\n\t\tthis.#loader = new BX.Loader({\n\t\t\ttarget: this.getLayout(),\n\t\t\tmode: 'inline',\n\t\t\tsize: 40,\n\t\t});\n\n\t\treturn this.#loader;\n\t}\n\n\t#getDialog(): Dialog\n\t{\n\t\tif (this.#dialog)\n\t\t{\n\t\t\treturn this.#dialog;\n\t\t}\n\n\t\tlet footer = null;\n\t\tif (this.#options.canCreateCompany ?? true)\n\t\t{\n\t\t\tfooter = Tag.render`\n\t\t\t\t<span\n\t\t\t\t\tclass=\"ui-selector-footer-link ui-selector-footer-link-add\"\n\t\t\t\t\tonclick=\"${() => this.#createCompany()}\"\n\t\t\t\t>\n\t\t\t\t\t${Loc.getMessage('SIGN_B2E_ADD_COMPANY')}\n\t\t\t\t</span>\n\t\t\t`;\n\t\t}\n\t\tthis.#dialog = new Dialog({\n\t\t\ttargetNode: this.getLayout(),\n\t\t\twidth: 425,\n\t\t\theight: 363,\n\t\t\titems: this.#companyList.map((company) => {\n\t\t\t\treturn {\n\t\t\t\t\tid: company.id,\n\t\t\t\t\tentityId: 'b2e-company',\n\t\t\t\t\ttitle: company.title,\n\t\t\t\t\ttabs: 'b2e-companies',\n\t\t\t\t\tdeselectable: this.#options.isCompaniesDeselectable ?? true,\n\t\t\t\t};\n\t\t\t}),\n\t\t\ttabs: [\n\t\t\t\t{ id: 'b2e-companies', title: Loc.getMessage('SIGN_B2E_COMPANIES_TAB') },\n\t\t\t],\n\t\t\tshowAvatars: false,\n\t\t\tdropdownMode: true,\n\t\t\tmultiple: false,\n\t\t\tenableSearch: true,\n\t\t\tevents: {\n\t\t\t\t'Item:OnSelect': (event) => {\n\t\t\t\t\tthis.#onCompanySelectedHandler(event);\n\t\t\t\t\tthis.#dialog.hide();\n\t\t\t\t},\n\t\t\t\t'Item:OnDeselect': (event) => {\n\t\t\t\t\tthis.#onCompanyDeselectedHandler(event);\n\t\t\t\t\tthis.#dialog.hide();\n\t\t\t\t},\n\t\t\t},\n\t\t\tfooter,\n\t\t});\n\n\t\treturn this.#dialog;\n\t}\n\n\t#selectProvider(id: string): void\n\t{\n\t\tthis.#providerSelector.setProviderById(id);\n\t}\n\n\t#onProviderDeselect(): void\n\t{\n\t\tthis.#company.provider = null;\n\t}\n\n\tasync #onProviderDisconnect(event: BaseEvent<{ provider: Provider }>): void\n\t{\n\t\tconst provider = event.getData().provider;\n\t\tconst id = provider.uid;\n\n\t\tif (!id || provider.autoRegister)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#showLoader();\n\t\tconst company = this.#getCompanyById(this.#company.id ?? 0);\n\t\ttry\n\t\t{\n\t\t\tawait this.#api.deleteB2eCompany(id);\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tconsole.error(e);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst newCompanyProviders = company.providers.filter(({ uid }: Provider) => uid !== id);\n\t\tthis.#company.providers = newCompanyProviders;\n\t\tthis.#getCompanyById(this.#company.id).providers = newCompanyProviders;\n\n\t\tthis.#providerSelector.setCompanyList(this.#companyList);\n\n\t\tthis.#hideLoader();\n\t\tthis.selectCompany(company.id);\n\t}\n\n\t#onProviderSelect(id: string): void\n\t{\n\t\tconst company = this.#getCompanyById(this.#company.id ?? 0);\n\t\tthis.#company.provider = company.providers.find((provider) => provider.uid === id);\n\t}\n\n\tgetSelectedCompanyProvider(): Provider | null\n\t{\n\t\treturn this.#getCurrentProvider() ?? null;\n\t}\n\n\t#onCompanySelectedHandler(event): void\n\t{\n\t\tif (!event.data || event.data.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst selectedItem = event.data.item;\n\t\tif (selectedItem?.id <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.selectCompany(selectedItem?.id);\n\t}\n\n\tselectCompany(id: number): void\n\t{\n\t\tconst company = this.#getCompanyById(id);\n\t\tif (Type.isUndefined(company))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#company.id = company.id;\n\t\tthis.#company.provider = null;\n\t\tif (company?.providers?.length > 0)\n\t\t{\n\t\t\tconst filteredProviders = company.providers\n\t\t\t\t?.filter((provider) => allowedSignatureProviders.includes(provider.code))\n\t\t\t\t?? []\n\t\t\t;\n\t\t\tif (filteredProviders.length > 0)\n\t\t\t{\n\t\t\t\tthis.#company.provider = filteredProviders[0];\n\t\t\t}\n\t\t}\n\t\tthis.#providerSelector.setCompany(this.#company);\n\n\t\tthis.#refreshView();\n\t\tthis.#getDialog().getItems()\n\t\t\t.find((item) => item.id === this.#company.id)\n\t\t\t?.select()\n\t\t;\n\n\t\tthis.emit(this.events.onSelect, { companyId: this.#company.id });\n\n\t\tconst event: CompanySelectedEvent = new BaseEvent({\n\t\t\tdata: {\n\t\t\t\tcompanyId: this.#company.id,\n\t\t\t\tprovider: this.getSelectedCompanyProvider(),\n\t\t\t},\n\t\t});\n\t\tthis.emit(this.events.onSelect, event);\n\t}\n\n\t#refreshView(): void\n\t{\n\t\tconst selectedItem = this.#getCompanyById(this.#company?.id);\n\t\tif (!selectedItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#getInfoHeaderTitleNameLayout().innerText = selectedItem.title;\n\t\tshow(this.#getInfoEditBtn());\n\t\tshow(this.#getInfoRqBtnLayout());\n\n\t\tif (Type.isStringFilled(selectedItem.rqInn))\n\t\t{\n\t\t\tthis.#getInfoRqInnLayout().innerText = Loc.getMessage(\n\t\t\t\t'SIGN_B2E_COMPANIES_INN',\n\t\t\t\t{ '%innValue%': TextFormat.encode(selectedItem.rqInn) },\n\t\t\t);\n\t\t\tDom.style(this.#getInfoRqInnLayout(), 'display', this.#showTaxId ? '' : 'none');\n\t\t\tDom.hide(this.#getCompanyInfoLabelLayout());\n\n\t\t\thide(this.#getInfoRqBtnLayout());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#getInfoRqInnLayout().textContent = '';\n\t\t\tDom.show(this.#getCompanyInfoLabelLayout());\n\t\t\thide(this.#getInfoEditBtn());\n\t\t}\n\n\t\tthis.#providerSelector.setProvider(selectedItem.rqInn, this.#getCompanyById(this.#company.id ?? 0));\n\t\tthis.#setInfoState();\n\t}\n\n\t#updateDialogItems(): void\n\t{\n\t\tthis.#dialog = null;\n\t\tthis.#dialog = this.#getDialog();\n\t\tconst item = this.#dialog.getItems().find(({ id }) => id === this.#company.id);\n\t\titem?.select();\n\t}\n\n\t#getCompanyById(id: number): Company | undefined\n\t{\n\t\treturn this.#companyList.find((company) => id === company.id);\n\t}\n\n\t#onCompanyDeselectedHandler(event): void\n\t{\n\t\tthis.#company.id = null;\n\t\tthis.#company.provider = {\n\t\t\tkey: null,\n\t\t\tuid: null,\n\t\t};\n\n\t\tthis.#setEmptyState();\n\t}\n\n\t#showEditMenu()\n\t{\n\t\tconst menu = new Menu({\n\t\t\tbindElement: this.#getInfoEditBtn(),\n\t\t\tcacheable: false,\n\t\t});\n\t\tmenu.addMenuItem({\n\t\t\ttext: Loc.getMessage('SIGN_B2E_COMPANIES_EDIT'),\n\t\t\tonclick: () => {\n\t\t\t\tthis.#editCompany();\n\t\t\t\tmenu.close();\n\t\t\t},\n\t\t});\n\t\tmenu.show();\n\t}\n\n\t#createCompany(): void\n\t{\n\t\tif (this.#options.needOpenCrmSaveAndEditCompanySliders)\n\t\t{\n\t\t\tconst companiesIdsBeforeSliderClose: Set<number> = new Set(this.#companyList.map((company) => company.id));\n\n\t\t\tBX.SidePanel.Instance.open(\n\t\t\t\t'/crm/company/details/0/?mycompany=y',\n\t\t\t\t{\n\t\t\t\t\tcacheable: false,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonClose: async () => {\n\t\t\t\t\t\t\tthis.#dialog.hide();\n\t\t\t\t\t\t\tawait this.#load();\n\t\t\t\t\t\t\tconst newCompany = this.#companyList\n\t\t\t\t\t\t\t\t.find(({ id }) => !companiesIdsBeforeSliderClose.has(id))\n\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\tif (!Type.isUndefined(newCompany))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.selectCompany(newCompany.id);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t);\n\n\t\t\treturn;\n\t\t}\n\t\tCompanyEditor.openSlider({\n\t\t\tmode: CompanyEditorMode.Create,\n\t\t\tdocumentEntityId: this.#options.entityId,\n\t\t\tlayoutTitle: Loc.getMessage('SIGN_B2E_COMPANY_CREATE'),\n\t\t\tentityTypeId: DocumentEntityTypeId.B2e,\n\t\t\tguid: EditorTypeGuid.B2e,\n\t\t\tevents: {\n\t\t\t\tonCompanySavedHandler: (companyId: number): void => {\n\t\t\t\t\tthis.#company.id = companyId;\n\t\t\t\t},\n\t\t\t},\n\t\t}, {\n\t\t\tonCloseHandler: () => {\n\t\t\t\tthis.#load();\n\t\t\t\tthis.#dialog.hide();\n\t\t\t},\n\t\t});\n\t}\n\n\t#editCompany(): void\n\t{\n\t\tif (!Type.isInteger(this.#company.id))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#options.needOpenCrmSaveAndEditCompanySliders)\n\t\t{\n\t\t\tBX.SidePanel.Instance.open(\n\t\t\t\t`/crm/company/details/${this.#company.id}/`,\n\t\t\t\t{\n\t\t\t\t\tcacheable: false,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonClose: () => this.#load(),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t);\n\n\t\t\treturn;\n\t\t}\n\n\t\tCompanyEditor.openSlider({\n\t\t\tmode: CompanyEditorMode.Edit,\n\t\t\tdocumentEntityId: this.#options.entityId,\n\t\t\tcompanyId: this.#company.id,\n\t\t\tlayoutTitle: Loc.getMessage('SIGN_B2E_COMPANY_EDIT'),\n\t\t\tentityTypeId: DocumentEntityTypeId.B2e,\n\t\t\tguid: EditorTypeGuid.B2e,\n\t\t}, {\n\t\t\tonCloseHandler: () => this.#load(),\n\t\t});\n\t}\n\n\tgetCompanyId(): ?number\n\t{\n\t\treturn this.#company?.id;\n\t}\n\n\tvalidate(): boolean\n\t{\n\t\tDom.removeClass(this.getLayout(), '--invalid');\n\t\tDom.removeClass(this.getProviderLayout().firstElementChild, '--invalid');\n\n\t\tconst isProviderValid = this.#providerSelector.validate();\n\t\tconst company = this.#getCompanyById(this.#company.id ?? 0);\n\t\tconst isCompanyValid = Type.isObject(company) && company.id > 0 && company.rqInn > 0;\n\t\tconst isValid = isCompanyValid && isProviderValid;\n\n\t\tif (!isCompanyValid)\n\t\t{\n\t\t\tDom.addClass(this.getLayout(), '--invalid');\n\t\t}\n\t\telse if (!isProviderValid)\n\t\t{\n\t\t\tDom.addClass(this.getProviderLayout().firstElementChild, '--invalid');\n\t\t}\n\n\t\treturn isValid;\n\t}\n\n\tasync save(documentId: string): Promise<any>\n\t{\n\t\tawait this.#providerSelector.registerVirtualProviderIfNeed();\n\t\tconst provider = this.#getCurrentProvider();\n\n\t\tif (Type.isNull(provider))\n\t\t{\n\t\t\treturn Promise.reject();\n\t\t}\n\n\t\tif (Type.isNull(this.#company.id))\n\t\t{\n\t\t\treturn Promise.reject();\n\t\t}\n\n\t\treturn Promise.all([\n\t\t\tthis.#api.modifyB2eCompany(documentId, provider.uid, this.#company.id),\n\t\t\tthis.#api.modifyB2eDocumentScheme(documentId, this.#getDefaultSchemeByProviderCode(provider.code)),\n\t\t]);\n\t}\n\n\t/**\n\t * This method is required for backward compatibility.\n\t * It should be removed once the SES RU provider supports the default scheme.\n\t *\n\t * @param {ProviderCodeType} provider - The provider code.\n\t * @returns {Scheme} - The signing scheme for the given provider.\n\t */\n\t#getDefaultSchemeByProviderCode(provider: ProviderCodeType): Scheme\n\t{\n\t\treturn provider === ProviderCode.sesRu && this.#options.documentInitiatedType === DocumentInitiated.company\n\t\t\t? SchemeType.Order\n\t\t\t: SchemeType.Default;\n\t}\n\n\tsetInitiatedByType(initiatedByType: DocumentInitiatedType): void\n\t{\n\t\tthis.setOptions({ documentInitiatedType: initiatedByType });\n\t}\n\n\t#getCompanyInfoLabelLayout(): HTMLElement\n\t{\n\t\treturn this.#layoutCache.remember('companyInfoLabel', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"ui-label ui-label-orange ui-label-fill sign-document-b2e-company-info-label\">\n\t\t\t\t\t<div class=\"ui-label-inner\">${Loc.getMessage('SIGN_V2_B2E_COMPANY_SELECTOR_COMPANY_RQ_WARNING_LABEL')}</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\t#getCompanySaveAndEditRequireCrmPermissionLayout(): HTMLElement\n\t{\n\t\treturn this.#layoutCache.remember('companySaveAndEditRequireCrmPermissionLayout', () => {\n\t\t\tconst alert = new Alert({\n\t\t\t\ttext: Loc.getMessage('SIGN_V2_B2E_COMPANY_SELECTOR_SAVE_AND_EDIT_REQUIRE_CRM_PERMISSION'),\n\t\t\t\tcolor: AlertColor.WARNING,\n\t\t\t\tsize: AlertSize.XS,\n\t\t\t\tcustomClass: 'sign-document-b2e-company__alert',\n\t\t\t});\n\n\t\t\treturn alert.render();\n\t\t});\n\t}\n\n\t#onInfoDropDownBtnClick(): void\n\t{\n\t\tthis.#getDialog().setTargetNode(this.getLayout());\n\t\tthis.#getDialog().show();\n\t}\n\n\tasync reloadCompanyProviders(selectFirst: boolean = true): Promise<void>\n\t{\n\t\tawait this.#load();\n\t\tif (selectFirst)\n\t\t{\n\t\t\tawait this.loadFirstCompany();\n\t\t}\n\t}\n\n\t#getCurrentProvider(): ?Provider\n\t{\n\t\treturn this.#providerSelector.getCurrentProvider();\n\t}\n}\n"],"names":["hide","element","Type","isElementNode","BX","show","allowedSignatureProviders","sesComLearnMoreLink","Uri","ProviderSelector","EventEmitter","constructor","options","events","onProviderSelect","onProviderDeselect","onProviderDisconnect","providerConnectionSlider","onClose","MemoryCache","Api","setEventNamespace","getLayout","remember","Tag","render","setShowTaxId","value","setProvider","rqInn","company","providers","length","setProviderById","id","providerMenu","getItems","currentProvider","find","provider","select","setCompanyList","companies","Runtime","clone","setCompany","validate","isObject","isStringFilled","uid","registerVirtualProviderIfNeed","virtual","selectedItem","registerB2eCompany","code","externalProviderId","getCurrentProvider","Loc","getMessage","Dialog","width","height","targetNode","items","showAvatars","dropdownMode","multiple","autoHide","tabs","title","data","item","footer","registerUrl","emit","includes","providerName","description","textContent","Dom","addClass","ProviderCode","external","clean","expiredLabel","append","style","autoRegister","iconUrl","imgClassName","img","getElementsByClassName","src","Label","text","color","LabelColor","WARNING","fill","customClass","menu","Menu","bindElement","cacheable","addMenuItem","onclick","close","guide","Guide","onEvents","autoSave","steps","target","condition","top","bottom","popupOptions","className","centerAngle","startOnce","forEach","addItem","subtitle","avatar","entityId","badges","firstItem","nothingToSelect","region","documentInitiatedType","DocumentInitiated","employee","formattedDate","DateTimeFormat","format","getFormat","timestamp","name","providerClasses","map","push","removeClass","firstParagraph","secondParagraph","thirdParagraph","Helpdesk","replaceLink","HelpdeskCodes","HowToChooseProvider","TextFormat","encode","sesCom","providerInfo","SesComDetails","Link","replaceInLoc","firstElementChild","display","providerCodeToProviderInfoTextMap","goskey","providerCodeToHelpdeskCodeMap","GoskeyDetails","SesRuDetails","SesRuExpressDetails","Alert","GoskeyApiKey","daysLeft","expires","alertText","getMessagePlural","now","Date","Math","floor","url","URL","allowedOrigin","origin","SidePanel","Instance","open","allowCrossDomain","allowChangeHistory","contentCallback","frameStyles","Event","bind","window","event","clearInterval","contentWindow","postMessage","companyName","setInterval","textColor","bgColor","Object","freeze","sesRuExpress","sesRu","TaxcomDetails","CompanySelector","onCompaniesLoad","onSelect","load","companyUid","companyEntityId","isNull","some","isUndefined","loadFirstCompany","setOptions","getProviderLayout","requireCrmPermissionLayout","needOpenCrmSaveAndEditCompanySliders","getSelectedCompanyProvider","selectCompany","filteredProviders","filter","companyId","BaseEvent","getCompanyId","isProviderValid","isCompanyValid","isValid","save","documentId","Promise","reject","all","modifyB2eCompany","modifyB2eDocumentScheme","setInitiatedByType","initiatedByType","reloadCompanyProviders","selectFirst","providerSelectorEvents","subscribe","getData","canEditCompany","setTargetNode","loadCompanyPromise","loadB2eCompanyList","error","console","isArray","Boolean","showTaxId","Loader","mode","size","canCreateCompany","deselectable","isCompaniesDeselectable","enableSearch","deleteB2eCompany","e","newCompanyProviders","innerText","key","companiesIdsBeforeSliderClose","Set","newCompany","has","CompanyEditor","openSlider","CompanyEditorMode","Create","documentEntityId","layoutTitle","entityTypeId","DocumentEntityTypeId","B2e","guid","EditorTypeGuid","onCompanySavedHandler","onCloseHandler","isInteger","Edit","SchemeType","Order","Default","alert","AlertColor","AlertSize","XS"],"mappings":"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"}