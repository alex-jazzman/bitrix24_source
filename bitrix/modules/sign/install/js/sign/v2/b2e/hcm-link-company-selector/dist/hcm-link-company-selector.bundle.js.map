{"version":3,"file":"hcm-link-company-selector.bundle.js","sources":["../src/index.js"],"sourcesContent":["import { Loc, Tag, Type, Dom } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Dialog } from 'ui.entity-selector';\nimport { Api } from 'sign.v2.api';\nimport { Loader } from 'main.loader';\nimport { CompanyConnectPage } from 'humanresources.hcmlink.company-connect-page';\n\nimport './style.css';\n\nexport class HcmLinkCompanySelector extends EventEmitter\n{\n\t#isAvailable: boolean = false;\n\t#companyId: number | null = null;\n\t#selectedId: number | null = null;\n\t#lastSavedId: ?number = undefined;\n\n\t#dialog: Dialog | null = null;\n\t#loader: Loader | null = null;\n\tisLayoutExisted: boolean = false;\n\n\t#api: Api;\n\n\t#ui = {\n\t\tcontainer: HTMLDivElement = null,\n\t\tactive: HTMLButtonElement = null,\n\t\tinactive: HTMLButtonElement = null,\n\t\tunselect: HTMLButtonElement = null,\n\t\tdropdownButton: HTMLSpanElement = null,\n\t\tloaderContainer: HTMLElement = null,\n\t\tinfo: {\n\t\t\ttitle: HTMLSpanElement = null,\n\t\t\tsubtitle: HTMLDivElement = null,\n\t\t},\n\t};\n\n\t#integrationList: Array<{ id: number, title: string, subtitle: string, availableSettings: Object }> = [];\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.#api = new Api();\n\n\t\tthis.setEventNamespace('sign.v2.b2e.hcm-link-company-selector');\n\t}\n\n\tsetAvailability(value: boolean): void\n\t{\n\t\tthis.#isAvailable = value;\n\t}\n\n\tsetCompanyId(id: number | null): void\n\t{\n\t\tif (!this.#isAvailable && !this.isLayoutExisted)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#companyId === id && this.isLayoutExisted)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#companyId = id;\n\t\tthis.#selectedId = null;\n\n\t\tthis.#dialog = null;\n\n\t\tif (!this.#companyId)\n\t\t{\n\t\t\tthis.hide();\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#showLoader();\n\t\tthis.#api.checkCompanyHrIntegration(this.#companyId)\n\t\t\t.then((data) => {\n\t\t\t\tthis.#getLoader().destroy();\n\n\t\t\t\tif (data.length <= 0)\n\t\t\t\t{\n\t\t\t\t\tthis.#ui.inactive.style.display = 'flex';\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.#integrationList = data;\n\n\t\t\t\tif (this.#lastSavedId === null)\n\t\t\t\t{\n\t\t\t\t\tthis.#lastSavedId = undefined;\n\t\t\t\t\tthis.#ui.unselect.style.display = 'flex';\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlet itemToSelect = data[0];\n\t\t\t\tif (this.#lastSavedId)\n\t\t\t\t{\n\t\t\t\t\titemToSelect = this.#integrationList.find(\n\t\t\t\t\t\t(item) => item.id === this.#lastSavedId,\n\t\t\t\t\t) ?? data[0];\n\t\t\t\t}\n\n\t\t\t\tthis.#select(itemToSelect);\n\t\t\t\tthis.#ui.active.style.display = 'flex';\n\t\t\t})\n\t\t;\n\t}\n\n\tsetLastSavedId(integrationId: number | null): void\n\t{\n\t\tthis.#lastSavedId = integrationId;\n\t}\n\n\tgetSelectedId(): number | null\n\t{\n\t\treturn this.#selectedId;\n\t}\n\n\thide(): void\n\t{\n\t\tif (!this.#isAvailable || !this.#ui.container)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tBX.hide(this.#ui.container);\n\t\tthis.#dialog?.hide();\n\t}\n\n\tshow(): void\n\t{\n\t\tif (!this.#isAvailable && !this.isLayoutExisted)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.style(this.#ui.container, { display: 'flex' });\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tif (this.#ui.container)\n\t\t{\n\t\t\treturn this.#ui.container;\n\t\t}\n\n\t\tthis.#ui.info.title = Tag.render`\n\t\t\t<span class=\"sign-document-b2e-company__hcmlink-select-text\"></span>\n\t\t`;\n\n\t\tthis.#ui.info.subtitle = Tag.render`\n\t\t\t<div class=\"sign-document-b2e-company__hcmlink-select-subtitle\"></div>\n\t\t`;\n\n\t\tthis.#ui.active = Tag.render`\n\t\t\t<div class=\"sign-document-b2e-company__hcmlink-select --active\" data-companies=\"[]\">\n\t\t\t\t<div class=\"sign-document-b2e-company__hcmlink-name-container\">\n\t\t\t\t\t<div class=\"sign-document-b2e-company__hcmlink-select-header\">\n\t\t\t\t\t\t${this.#ui.info.title}\n\t\t\t\t\t\t<span class=\"sign-document-b2e-company-info-dropdown-btn\"\n\t\t\t\t\t\t\tonclick=\"${() => {\n\t\t\tthis.#showDialog();\n\t\t}}\"></span>\n\t\t\t\t\t\t${this.#ui.dropdownButton}\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.#ui.info.subtitle}\t\n\t\t\t\t</div>\t\t\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#ui.unselect = Tag.render`\n\t\t\t<div class=\"sign-document-b2e-company__hcmlink-select --inactive\">\n\t\t\t\t<div class=\"sign-document-b2e-company__hcmlink-name-container\">\n\t\t\t\t\t<span class=\"sign-document-b2e-company__hcmlink-select-text\">\n\t\t\t\t\t\t${Loc.getMessage('SIGN_B2E_INTEGRATION_INTEGRATION_UNSELECTED')}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<button class=\"ui-btn ui-btn-xs ui-btn-round ui-btn-light-border\"\n\t\t\t\t\tonclick=\"${() => this.#showDialog()}\">\n\t\t\t\t\t${Loc.getMessage('SIGN_B2E_COMPANIES_SELECT_BUTTON')}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#ui.inactive = Tag.render`\n\t\t\t<div class=\"sign-document-b2e-company__hcmlink-select --inactive\">\n\t\t\t\t<div class=\"sign-document-b2e-company__hcmlink-name-container\">\n\t\t\t\t\t<span class=\"sign-document-b2e-company__hcmlink-select-text\">\n\t\t\t\t\t\t${Loc.getMessage('SIGN_B2E_COMPANY_INTEGRATION_TITLE')}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<button class=\"ui-btn ui-btn-xs ui-btn-round ui-btn-light-border\"\n\t\t\t\t\tonclick=\"${() => this.#showIntegrationMarketSlider()}\">\n\t\t\t\t\t${Loc.getMessage('SIGN_B2E_COMPANY_INTEGRATION_BUTTON_CONNECT')}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\t\tthis.#ui.loaderContainer = Tag.render`\n\t\t\t<div class=\"sign-document-b2e-company__hcmlink-loader\"><div>\n\t\t`;\n\n\t\tthis.#ui.icon = Tag.render`<div class=\"sign-document-b2e-company__hcmlink-info-img\"></div>`;\n\t\tthis.#ui.container = Tag.render`\n\t\t\t<div class=\"sign-document-b2e-company__hcmlink\">\n\t\t\t\t${this.#ui.icon}\n\t\t\t\t${this.#ui.loaderContainer}\n\t\t\t\t${this.#ui.active}\n\t\t\t\t${this.#ui.inactive}\n\t\t\t\t${this.#ui.unselect}\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.hide();\n\n\t\treturn this.#ui.container;\n\t}\n\n\t#select(item: { id: number } | null): void\n\t{\n\t\tthis.#selectedId = item?.id ?? null;\n\t\tBX.hide(this.#ui.unselect);\n\t\tBX.hide(this.#ui.inactive);\n\t\tthis.#ui.active.style.display = 'flex';\n\t\tthis.#setIntegrationTitle(this.#selectedId);\n\t\tDom.addClass(this.#ui.icon, '--active');\n\n\t\tthis.emit('selected', {\n\t\t\tid: this.#selectedId,\n\t\t\tavailableSettings: this.#getCompanyById(this.#selectedId)?.availableSettings ?? {},\n\t\t});\n\t}\n\n\t#deselect(item: { id: number } | null): void\n\t{\n\t\tDom.removeClass(this.#ui.icon, '--active');\n\t\tthis.#selectedId = null;\n\t\tBX.hide(this.#ui.active);\n\t\tBX.hide(this.#ui.inactive);\n\t\tthis.#ui.unselect.style.display = 'flex';\n\n\t\tthis.emit('selected', {\n\t\t\tid: this.#selectedId,\n\t\t\tavailableSettings:  {},\n\t\t});\n\t}\n\n\t#getCompanyById(id: number): { id: number, title: string, subtitle: string, availableSettings: Object }\n\t{\n\t\treturn this.#integrationList.find((company) => company.id === id);\n\t}\n\n\t#showDialog(): void\n\t{\n\t\tthis.#getDialog()?.show();\n\t}\n\n\t#getDialog(): Dialog\n\t{\n\t\tif (this.#dialog)\n\t\t{\n\t\t\treturn this.#dialog;\n\t\t}\n\n\t\tconst items = this.#integrationList.map((integration) => {\n\t\t\treturn {\n\t\t\t\tid: integration.id,\n\t\t\t\tentityId: 'hrm-integration',\n\t\t\t\ttitle: integration.title,\n\t\t\t\tsubtitle: integration.subtitle,\n\t\t\t\ttabs: 'hrm-integrations',\n\t\t\t};\n\t\t});\n\n\t\tthis.#dialog = new Dialog({\n\t\t\ttargetNode: this.#ui.container,\n\t\t\twidth: 425,\n\t\t\theight: 363,\n\t\t\titems,\n\t\t\ttabs: [\n\t\t\t\t{ id: 'hrm-integrations', title: Loc.getMessage('SIGN_B2E_INTEGRATION_TAB') },\n\t\t\t],\n\t\t\tshowAvatars: false,\n\t\t\tdropdownMode: true,\n\t\t\tmultiple: false,\n\t\t\tenableSearch: true,\n\t\t\tevents: {\n\t\t\t\t'Item:OnSelect': (event) => {\n\t\t\t\t\tthis.#select(event.data.item);\n\t\t\t\t},\n\t\t\t\t'Item:OnDeselect': (event) => {\n\t\t\t\t\tthis.#deselect(event.data.item);\n\t\t\t\t},\n\t\t\t},\n\t\t\thideOnSelect: true,\n\t\t\thideOnDeselect: true,\n\t\t});\n\n\t\tif (this.#selectedId)\n\t\t{\n\t\t\tconst item = this.#dialog.getItems().find((item) => item.id === this.#selectedId);\n\t\t\titem?.select();\n\t\t}\n\n\t\treturn this.#dialog;\n\t}\n\n\t#getLoader(): Loader\n\t{\n\t\tif (this.#loader)\n\t\t{\n\t\t\treturn this.#loader;\n\t\t}\n\n\t\tthis.#loader = new BX.Loader({\n\t\t\ttarget: this.#ui.container,\n\t\t\tmode: 'inline',\n\t\t\tsize: 40,\n\t\t});\n\n\t\treturn this.#loader;\n\t}\n\n\t#showLoader(): void\n\t{\n\t\tBX.hide(this.#ui.active);\n\t\tBX.hide(this.#ui.inactive);\n\t\tBX.hide(this.#ui.unselect);\n\t\tthis.#getLoader().show(this.#ui.loaderContainer);\n\t\tthis.#ui.container.style.display = 'flex';\n\t\tDom.removeClass(this.#ui.icon, '--active');\n\t}\n\n\t// refactor later\n\t#showIntegrationMarketSlider(): void\n\t{\n\t\tCompanyConnectPage.openSlider({}, {\n\t\t\tonCloseHandler: () => this.setCompanyId(this.#companyId),\n\t\t});\n\t}\n\n\t#setIntegrationTitle(itemId: number | null): void\n\t{\n\t\tif (Type.isNumber(itemId))\n\t\t{\n\t\t\tconst item = this.#integrationList.find((integration) => integration.id === itemId);\n\t\t\tif (\n\t\t\t\titem\n\t\t\t\t&& Type.isDomNode(this.#ui.info.title)\n\t\t\t\t&& Type.isDomNode(this.#ui.info.subtitle)\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.#ui.info.title.innerHTML = item?.title ?? '';\n\t\t\t\tthis.#ui.info.subtitle.innerHTML = item?.subtitle?.toUpperCase() ?? '';\n\t\t\t}\n\t\t}\n\t}\n}\n"],"names":["HcmLinkCompanySelector","EventEmitter","constructor","super","Object","value","writable","undefined","this","isLayoutExisted","container","HTMLDivElement","active","HTMLButtonElement","inactive","unselect","dropdownButton","HTMLSpanElement","loaderContainer","HTMLElement","info","title","subtitle","babelHelpers","Api","setEventNamespace","setAvailability","setCompanyId","id","checkCompanyHrIntegration","then","data","destroy","length","style","display","itemToSelect","find","item","hide","setLastSavedId","integrationId","getSelectedId","BX","_babelHelpers$classPr2","show","Dom","render","Tag","Loc","getMessage","icon","addClass","emit","availableSettings","_babelHelpers$classPr4","removeClass","company","_babelHelpers$classPr5","items","map","integration","entityId","tabs","Dialog","targetNode","width","height","showAvatars","dropdownMode","multiple","enableSearch","events","Item:OnSelect","event","Item:OnDeselect","hideOnSelect","hideOnDeselect","getItems","select","Loader","target","mode","size","CompanyConnectPage","openSlider","onCloseHandler","itemId","Type","isNumber","isDomNode","innerHTML","_item$subtitle","toUpperCase"],"mappings":"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"}