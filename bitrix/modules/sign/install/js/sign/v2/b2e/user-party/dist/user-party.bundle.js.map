{"version":3,"file":"user-party.bundle.js","sources":["../src/index.js"],"sourcesContent":["import { Dom, Loc, Tag, Text as TextFormat, Event } from 'main.core';\nimport type { Loader } from 'main.loader';\nimport { Helpdesk } from 'sign.v2.helper';\nimport { Dialog, TagSelector, TagItem } from 'ui.entity-selector';\nimport type { UserPartyOptions } from './type';\nimport type { CardItem } from './types/card-item';\nimport { UserPartyCounters } from 'sign.v2.b2e.user-party-counters';\nimport { UserPartyPopup } from 'sign.v2.b2e.user-party-popup';\nimport { Api, CountMember } from 'sign.v2.api';\nimport { FeatureStorage } from 'sign.feature-storage';\nimport { MemberRole, type MemberRoleType, EntityType } from 'sign.type';\nimport { UserPartyRefused } from 'sign.v2.b2e.user-party-refused';\nimport 'ui.icon-set.main';\n\nimport './style.css';\n\nexport type UserPartyConfig = {\n\tregion: string,\n\tb2eSignersLimitCount: number,\n}\n\nexport type { CardItem };\n\nconst Mode = Object.freeze({\n\tview: 'view',\n\tedit: 'edit',\n});\n\nconst avatarLinks = {\n\tuser: '/bitrix/js/sign/v2/b2e/user-party/images/user.svg',\n\tdepartment: '/bitrix/js/sign/v2/b2e/user-party/images/department.svg',\n\tdocument: '/bitrix/js/sign/v2/b2e/user-party/images/sign-document.svg',\n\tsignersList: '/bitrix/js/sign/v2/b2e/user-party/images/signers-list.svg',\n};\n\nconst HelpdeskCodes = Object.freeze({\n\tSignEdmWithEmployees: '19740792',\n});\n\nexport class UserParty\n{\n\t#api: Api;\n\n\t#ui = {\n\t\tcontainer: HTMLDivElement = null,\n\t\titemContainer: HTMLDivElement = null,\n\t\theader: HTMLSpanElement = null,\n\t\tdescription: HTMLParagraphElement = null,\n\t\tuserPartyCounterContainer: HTMLDivElement = null,\n\t\tshowMoreSignersContainer: HTMLDivElement = null,\n\t};\n\n\t#items: Map<String, CardItem> = new Map();\n\t#preselectedUserData: Array<Object> = [];\n\t#userCount: Number = 0;\n\n\t#viewMode = Mode.edit;\n\n\t#tagSelector: ?TagSelector = null;\n\t#loader: ?Loader = null;\n\t#userPartyCounters: UserPartyCounters = null;\n\n\t#documentUid: string = null;\n\n\t#userPartyPopup: UserPartyPopup = null;\n\n\t#counterDelayTimeout: ?number = null;\n\t#role: MemberRoleType = MemberRole.signer;\n\n\t#userPartyRefused: UserPartyRefused;\n\n\tconstructor(options: UserPartyOptions)\n\t{\n\t\tthis.#api = new Api();\n\t\tthis.#viewMode = options.mode;\n\t\tthis.#role = options.role ?? MemberRole.signer;\n\t\tthis.#init(options);\n\t}\n\n\t#init(options: UserPartyOptions): void\n\t{\n\t\tif (this.#viewMode === Mode.view)\n\t\t{\n\t\t\tthis.#ui.container = this.getLayout(options.region);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst { b2eSignersLimitCount, region } = options;\n\t\tthis.#userPartyCounters = new UserPartyCounters({\n\t\t\tuserCountersLimit: b2eSignersLimitCount,\n\t\t});\n\n\t\tthis.#userPartyRefused = new UserPartyRefused();\n\t\tthis.#userPartyRefused.subscribe('onChange', (event) => {\n\t\t\tthis.#updateEditModeCounter();\n\t\t});\n\n\t\tthis.#ui.container = this.getLayout(region);\n\n\t\tconst tabs = [];\n\t\tconst entities = [\n\t\t\t{\n\t\t\t\tid: 'user',\n\t\t\t\toptions: { intranetUsersOnly: true },\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'structure-node',\n\t\t\t\toptions: {\n\t\t\t\t\tselectMode: 'usersAndDepartments',\n\t\t\t\t\tfillRecentTab: true,\n\t\t\t\t\tallowFlatDepartments: true,\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'signers-list',\n\t\t\t},\n\t\t];\n\n\t\tif (FeatureStorage.isDocumentsInSignersSelectorEnabled())\n\t\t{\n\t\t\tentities.push({ id: 'sign-document' });\n\t\t}\n\n\t\tthis.#tagSelector = new TagSelector({\n\t\t\tevents: {\n\t\t\t\tonTagRemove: (event) => {\n\t\t\t\t\tconst { tag } = event.getData();\n\t\t\t\t\tthis.#removeItem(tag);\n\t\t\t\t},\n\t\t\t\tonTagAdd: (event) => {\n\t\t\t\t\tconst { tag } = event.getData();\n\t\t\t\t\tthis.#addItem(tag);\n\t\t\t\t},\n\t\t\t},\n\t\t\tdialogOptions: {\n\t\t\t\twidth: 425,\n\t\t\t\theight: 363,\n\t\t\t\tmultiple: true,\n\t\t\t\ttargetNode: this.#ui.itemContainer,\n\t\t\t\tcontext: 'sign_b2e_user_party',\n\t\t\t\ttabs,\n\t\t\t\tentities,\n\t\t\t\tdropdownMode: false,\n\t\t\t\thideOnDeselect: false,\n\t\t\t},\n\t\t});\n\t\tthis.#tagSelector.renderTo(this.#ui.itemContainer);\n\t}\n\n\tgetLayout(region: string): HTMLElement\n\t{\n\t\tif (this.#ui.container)\n\t\t{\n\t\t\treturn this.#ui.container;\n\t\t}\n\n\t\tthis.#ui.itemContainer = Tag.render`\n\t\t\t<div class=\"sign-document-b2e-user-party__item-list\"></div>\n\t\t`;\n\t\tif (this.#viewMode !== Mode.edit)\n\t\t{\n\t\t\tDom.addClass(this.#ui.itemContainer, '--view');\n\n\t\t\tconst link = Tag.render`\n\t\t\t\t<a href=\"#\">${Loc.getMessage('SIGN_USER_PARTY_VIEW_SHOW_MORE', {\n\t\t\t\t\t'#EMPLOYEE_COUNT#': '<span class=\"--count-placeholder\">â€¦</span>',\n\t\t\t\t})}</a>\n\t\t\t`;\n\n\t\t\tthis.#userPartyPopup = this.#createUserPartyPopup(link);\n\n\t\t\tEvent.bind(link, 'click', (event) => {\n\t\t\t\tthis.#userPartyPopup.setDocumentUid(this.#documentUid).show();\n\t\t\t\tevent.preventDefault();\n\t\t\t});\n\n\t\t\tthis.#ui.showMoreSignersContainer = Tag.render`\n\t\t\t\t<div class=\"sign-document-b2e-user-party__item-show_more\">\n\t\t\t\t\t${link}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\tDom.hide(this.#ui.showMoreSignersContainer);\n\t\t\tDom.append(this.#ui.showMoreSignersContainer, this.#ui.itemContainer);\n\n\t\t\treturn this.#ui.itemContainer;\n\t\t}\n\n\t\tthis.#ui.description = this.#renderDescription(region);\n\n\t\treturn Tag.render`\n\t\t\t<div>\n\t\t\t\t<div class=\"sign-b2e-settings__header-wrapper\">\n\t\t\t\t\t<h1 class=\"sign-b2e-settings__header\">${Loc.getMessage('SIGN_USER_PARTY_HEADER')}</h1>\n\t\t\t\t\t${this.userPartyCounters.getLayout()}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"sign-b2e-settings__item\">\n\t\t\t\t\t${this.#renderTitle()}\n\t\t\t\t\t${this.#ui.itemContainer}\n\t\t\t\t\t${this.#ui.description}\n\t\t\t\t\t${this.userPartyRefused.render() ?? ''}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#renderTitle(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<p class=\"sign-b2e-settings__item_title\">\n\t\t\t\t${Loc.getMessage('SIGN_USER_PARTY_ITEM_TITLE')}\n\t\t\t</p>\n\t\t`;\n\t}\n\n\t#renderDescription(region: string): HTMLElement\n\t{\n\t\tconst descriptionMessage = region === 'ru'\n\t\t\t? Helpdesk.replaceLink(Loc.getMessage('SIGN_USER_PARTY_DESCRIPTION'), HelpdeskCodes.SignEdmWithEmployees)\n\t\t\t: Loc.getMessage('SIGN_USER_PARTY_DESCRIPTION_WITHOUT_LINK')\n\t\t;\n\n\t\treturn Tag.render`\n\t\t\t<p class=\"sign-document-b2e-user-party__description\">\n\t\t\t\t${descriptionMessage}\n\t\t\t</p>\n\t\t`;\n\t}\n\n\t#createUserPartyPopup(bindElement: HTMLElement): UserPartyPopup\n\t{\n\t\tconst isDepartmentsVisible = this.#role === MemberRole.signer;\n\n\t\treturn new UserPartyPopup({\n\t\t\tbindElement,\n\t\t\tisDepartmentsVisible,\n\t\t\trole: this.#role,\n\t\t});\n\t}\n\n\tasync load(ids: number[]): Promise<void>\n\t{\n\t\tconst { dialog } = this.#tagSelector;\n\t\tdialog.preselectedItems = ids.map((userId) => ['user', userId]);\n\t\tconst promise = new Promise((resolve) => {\n\t\t\tdialog.subscribeOnce('onLoad', resolve);\n\t\t});\n\t\tdialog.load();\n\t\tawait promise;\n\t}\n\n\tasync setUserIds(usersData: [Object]): void\n\t{\n\t\tthis.#clean();\n\n\t\tconst maxShownItems = this.#getViewModeItemsCount();\n\n\t\tthis.#userCount = usersData.length;\n\t\tthis.#preselectedUserData = usersData\n\t\t\t.sort((a, b) => (a.entityType === 'structure-node' ? -1 : 1))\n\t\t\t.slice(0, maxShownItems)\n\t\t;\n\n\t\tconst membersResponse = await this.#api.getMembersForDocument(\n\t\t\tthis.#documentUid,\n\t\t\t1,\n\t\t\tmaxShownItems,\n\t\t\tthis.#role,\n\t\t);\n\n\t\t// filter out refused signers\n\t\tif (this.#role === MemberRole.signer)\n\t\t{\n\t\t\tconst knownUsers = new Set(membersResponse.members.map((member) => member.userId));\n\t\t\tthis.#preselectedUserData = this.#preselectedUserData.filter((item) => {\n\t\t\t\treturn item.entityType === EntityType.USER\n\t\t\t\t\t? knownUsers.has(item.entityId)\n\t\t\t\t\t: true\n\t\t\t\t;\n\t\t\t});\n\t\t}\n\n\t\t// add signers from lists, departments, etc.\n\t\tif (this.#preselectedUserData.length < maxShownItems)\n\t\t{\n\t\t\tconst preselectedIds = new Set(\n\t\t\t\tusersData\n\t\t\t\t\t.filter((item) => item.entityType === EntityType.USER)\n\t\t\t\t\t.map((item) => item.entityId),\n\t\t\t);\n\t\t\tconst addMembers = membersResponse.members\n\t\t\t\t.filter((member) => !preselectedIds.has(member.userId))\n\t\t\t\t.slice(0, maxShownItems - this.#preselectedUserData.length)\n\t\t\t;\n\t\t\tthis.#preselectedUserData = [...this.#preselectedUserData, ...addMembers.map((member) => {\n\t\t\t\treturn { entityType: 'user', entityId: member.userId };\n\t\t\t})];\n\t\t}\n\n\t\t// workaround because prepend is used in the interface instead of append\n\t\tthis.#preselectedUserData.reverse();\n\n\t\tawait this.#loadPreselectedUsersData();\n\t\tthis.#displayShowMoreBtn();\n\t}\n\n\tasync #displayShowMoreBtn(): void\n\t{\n\t\tlet isShowMoreBtn = false;\n\t\tlet showMoreCount = 0;\n\t\tconst shownUsers = this.#preselectedUserData\n\t\t\t.reduce((count, item) => (item.entityType === 'user' ? count + 1 : count), 0)\n\t\t;\n\n\t\tif (this.#role === MemberRole.signer)\n\t\t{\n\t\t\tconst signersCountResponse = await this.#api.getUniqUserCountForDocument(\n\t\t\t\tthis.#documentUid,\n\t\t\t\tfalse,\n\t\t\t);\n\t\t\tshowMoreCount = signersCountResponse.count - shownUsers;\n\t\t\tisShowMoreBtn = showMoreCount > 0;\n\t\t}\n\t\telse if (this.#userCount > this.#getViewModeItemsCount())\n\t\t{\n\t\t\tisShowMoreBtn = true;\n\t\t\tshowMoreCount = this.#userCount - this.#getViewModeItemsCount();\n\t\t}\n\n\t\tif (isShowMoreBtn)\n\t\t{\n\t\t\tthis.#ui.showMoreSignersContainer.querySelector('.--count-placeholder').textContent = showMoreCount;\n\t\t\tDom.show(this.#ui.showMoreSignersContainer);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#ui.showMoreSignersContainer.querySelector('.--count-placeholder').textContent = 0;\n\t\t\tDom.hide(this.#ui.showMoreSignersContainer);\n\t\t}\n\t}\n\n\tasync #loadPreselectedUsersData(): Promise<void>\n\t{\n\t\tthis.#showLoader();\n\n\t\tawait new Promise((resolve) => {\n\t\t\tconst dialog = new Dialog({\n\t\t\t\tentities: [\n\t\t\t\t\t{ id: 'user' },\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\tonLoad: () => {\n\t\t\t\t\t\tdialog.getSelectedItems().forEach((item) => {\n\t\t\t\t\t\t\tthis.#addItem(item);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tpreselectedItems: this.#preselectedUserData.map((entity) => {\n\t\t\t\t\treturn [entity.entityType, entity.entityId];\n\t\t\t\t}),\n\t\t\t});\n\t\t\tdialog.load();\n\t\t});\n\n\t\tthis.#hideLoader();\n\t}\n\n\t#showLoader(): void\n\t{\n\t\tthis.#ui.itemContainer.style.display = 'none';\n\t\tthis.#getLoader().show();\n\t}\n\n\t#hideLoader(): void\n\t{\n\t\tthis.#ui.itemContainer.style.display = 'flex';\n\t\tthis.#getLoader().hide();\n\t}\n\n\t#getLoader(): Loader\n\t{\n\t\tif (this.#loader)\n\t\t{\n\t\t\treturn this.#loader;\n\t\t}\n\n\t\tthis.#loader = new BX.Loader({\n\t\t\ttarget: this.#ui.container,\n\t\t\tmode: 'inline',\n\t\t\tsize: 40,\n\t\t});\n\n\t\treturn this.#loader;\n\t}\n\n\t#removeItem(tag: TagItem): void\n\t{\n\t\tconst itemKey = this.#makeItemMapKeyByTag(tag);\n\t\tconst item = this.#items.get(itemKey);\n\t\tif (item?.container)\n\t\t{\n\t\t\tDom.remove(item.container);\n\t\t}\n\n\t\tthis.#items.delete(itemKey);\n\n\t\tthis.#updateEditModeCounter();\n\t}\n\n\t#addItem(tag: TagItem): void\n\t{\n\t\tconst item = {\n\t\t\tid: tag.id,\n\t\t\ttitle: tag?.title.text,\n\t\t\tname: tag.customData?.get('name'),\n\t\t\tlastName: tag.customData?.get('lastName'),\n\t\t\tavatar: tag?.avatar,\n\t\t\tentityId: tag.id,\n\t\t\tentityType: tag?.entityId,\n\t\t};\n\n\t\tconst container = this.#viewMode === Mode.view\n\t\t\t? this.#createItemLayout(item)\n\t\t\t: null\n\t\t;\n\t\tif (container)\n\t\t{\n\t\t\tDom.prepend(container, this.#ui.itemContainer);\n\t\t}\n\n\t\titem.container = container;\n\t\tthis.#items.set(this.#makeItemMapKeyByTag(tag), item);\n\n\t\tthis.#updateEditModeCounter();\n\t}\n\n\t#updateEditModeCounter(): void\n\t{\n\t\tif (this.#viewMode === Mode.edit)\n\t\t{\n\t\t\tthis.#updateCounterWithDelay(this.#tagSelector.getTags().map((member) => {\n\t\t\t\treturn {\n\t\t\t\t\tentityId: member.id,\n\t\t\t\t\tentityType: member.entityId,\n\t\t\t\t};\n\t\t\t}));\n\t\t}\n\t}\n\n\t#updateCounterWithDelay(selectedMembers: CountMember[]): void\n\t{\n\t\tclearTimeout(this.#counterDelayTimeout);\n\n\t\tthis.#counterDelayTimeout = setTimeout(async () => {\n\t\t\tconst response = await this.#api.getUniqUserCountForMembers(\n\t\t\t\tselectedMembers,\n\t\t\t\tthis.isRejectExcludedEnabled(),\n\t\t\t);\n\t\t\tthis.#userPartyCounters?.update(response.count);\n\t\t}, 100);\n\t}\n\n\tvalidate(): boolean\n\t{\n\t\tthis.closeCounterGuide();\n\t\tconst isValid = this.#items.size > 0 && this.#userPartyCounters.getCount() > 0;\n\t\tconst tagSelectorContainer = this.#tagSelector.getOuterContainer();\n\t\tif (isValid)\n\t\t{\n\t\t\tDom.removeClass(tagSelectorContainer, '--invalid');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(tagSelectorContainer, '--invalid');\n\t\t}\n\n\t\treturn isValid;\n\t}\n\n\tisRejectExcludedEnabled(): boolean\n\t{\n\t\treturn this.#userPartyRefused.shouldRemoveRefused();\n\t}\n\n\tgetEntities(): Array<CardItem>\n\t{\n\t\treturn [...this.#items.values()];\n\t}\n\n\tresetUserPartyPopup(): void\n\t{\n\t\tthis.#userPartyPopup.resetData();\n\t}\n\n\tsetDocumentUid(uid: string): void\n\t{\n\t\tthis.#documentUid = uid;\n\t}\n\n\tgetPreselectedUserData(): Object[]\n\t{\n\t\treturn this.#preselectedUserData;\n\t}\n\n\t#createItemLayout(item: CardItem): HTMLElement\n\t{\n\t\tswitch (item.entityType)\n\t\t{\n\t\t\tcase 'structure-node':\n\t\t\t\treturn this.#createDepartmentItemLayout(item);\n\t\t\tcase 'sign-document':\n\t\t\t\treturn this.#createDocumentItemLayout(item);\n\t\t\tcase 'signers-list':\n\t\t\t\treturn this.#createSignersListItemLayout(item);\n\t\t\tdefault:\n\t\t\t\treturn this.#createUserItemLayout(item);\n\t\t}\n\t}\n\n\t#createDepartmentItemLayout(item: CardItem): HTMLElement\n\t{\n\t\tconst title = TextFormat.encode(item.title);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document-b2e-user-party__item-list_item --department\">\n\t\t\t\t<div>\n\t\t\t\t\t<img\n\t\t\t\t\t\tclass=\"sign-document-b2e-user-party__item-list_item-avatar\"\n\t\t\t\t\t\ttitle=\"${title}\" src='${avatarLinks.department}' alt=\"avatar\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div title=\"${title}\" class=\"sign-document-b2e-user-party__item-list_item-text\">\n\t\t\t\t\t${title}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#createDocumentItemLayout(item: CardItem): HTMLElement\n\t{\n\t\tconst title = TextFormat.encode(item.title);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document-b2e-user-party__item-list_item --document\">\n\t\t\t\t<div>\n\t\t\t\t\t<img\n\t\t\t\t\t\tclass=\"sign-document-b2e-user-party__item-list_item-avatar\"\n\t\t\t\t\t\ttitle=\"${title}\" src='${avatarLinks.document}' alt=\"avatar\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div title=\"${title}\" class=\"sign-document-b2e-user-party__item-list_item-text\">\n\t\t\t\t\t${title}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#createSignersListItemLayout(item: CardItem): HTMLElement\n\t{\n\t\tconst title = TextFormat.encode(item.title);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document-b2e-user-party__item-list_item --signers-list\">\n\t\t\t\t<div>\n\t\t\t\t\t<img\n\t\t\t\t\t\tclass=\"sign-document-b2e-user-party__item-list_item-avatar\"\n\t\t\t\t\t\ttitle=\"${title}\" src='${avatarLinks.signersList}' alt=\"avatar\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div title=\"${title}\" class=\"sign-document-b2e-user-party__item-list_item-text\">\n\t\t\t\t\t${title}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#createUserItemLayout(item: CardItem): HTMLElement\n\t{\n\t\tconst title = TextFormat.encode(item.title);\n\t\tconst itemAvatar = item.avatar || avatarLinks.user;\n\t\tconst profileLink = `/company/personal/user/${item.entityId}/`;\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document-b2e-user-party__item-list_item --user\">\n\t\t\t\t<a href=\"${TextFormat.encode(profileLink)}\">\n\t\t\t\t\t<img\n\t\t\t\t\t\tclass=\"sign-document-b2e-user-party__item-list_item-avatar\"\n\t\t\t\t\t\ttitle=\"${title}\" src='${TextFormat.encode(itemAvatar)}' alt=\"avatar\"\n\t\t\t\t\t/>\n\t\t\t\t</a>\n\t\t\t\t<div title=\"${title}\" class=\"sign-document-b2e-user-party__item-list_item-text\">\n\t\t\t\t\t${title}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#clean(): void\n\t{\n\t\tthis.closeCounterGuide();\n\t\t[...this.#items.values()].forEach((item) => Dom.remove(item.container));\n\t\tthis.#items.clear();\n\t\tthis.#userPartyCounters?.update(this.#items.size);\n\t}\n\n\t#getViewModeItemsCount(): number\n\t{\n\t\treturn 7; // for fixed slider width\n\t}\n\n\tgetUniqueUsersCount(): number\n\t{\n\t\treturn this.#userPartyCounters?.getCount() ?? 0;\n\t}\n\n\tcloseCounterGuide(): void\n\t{\n\t\tthis.#userPartyCounters?.closeGuide();\n\t}\n\n\t#makeItemMapKeyByTag(tag: { id: number | string, entityId: string }): string\n\t{\n\t\tconst { id, entityId } = tag;\n\n\t\treturn `${entityId}_${id}`;\n\t}\n\n\t/**\n\t * @protected\n\t */\n\tget userPartyCounters(): UserPartyCounters\n\t{\n\t\treturn this.#userPartyCounters;\n\t}\n\n\t/**\n\t * @protected\n\t */\n\tget userPartyRefused(): UserPartyRefused\n\t{\n\t\treturn this.#userPartyRefused;\n\t}\n\n\t/**\n\t * @protected\n\t */\n\tget ui(): HTMLDivElement\n\t{\n\t\treturn this.#ui;\n\t}\n}\n"],"names":["Mode","Object","freeze","view","edit","avatarLinks","user","department","document","signersList","HelpdeskCodes","SignEdmWithEmployees","UserParty","constructor","options","container","HTMLDivElement","itemContainer","header","HTMLSpanElement","description","HTMLParagraphElement","userPartyCounterContainer","showMoreSignersContainer","Map","MemberRole","signer","Api","mode","role","getLayout","region","Tag","render","Dom","addClass","link","Loc","getMessage","Event","bind","event","setDocumentUid","show","preventDefault","hide","append","userPartyCounters","userPartyRefused","load","ids","dialog","preselectedItems","map","userId","promise","Promise","resolve","subscribeOnce","setUserIds","usersData","maxShownItems","length","sort","a","b","entityType","slice","membersResponse","getMembersForDocument","knownUsers","Set","members","member","filter","item","EntityType","USER","has","entityId","preselectedIds","addMembers","reverse","validate","closeCounterGuide","isValid","size","getCount","tagSelectorContainer","getOuterContainer","removeClass","isRejectExcludedEnabled","shouldRemoveRefused","getEntities","values","resetUserPartyPopup","resetData","uid","getPreselectedUserData","getUniqueUsersCount","closeGuide","ui","b2eSignersLimitCount","UserPartyCounters","userCountersLimit","UserPartyRefused","subscribe","tabs","entities","id","intranetUsersOnly","selectMode","fillRecentTab","allowFlatDepartments","FeatureStorage","isDocumentsInSignersSelectorEnabled","push","TagSelector","events","onTagRemove","tag","getData","onTagAdd","dialogOptions","width","height","multiple","targetNode","context","dropdownMode","hideOnDeselect","renderTo","descriptionMessage","Helpdesk","replaceLink","bindElement","isDepartmentsVisible","UserPartyPopup","isShowMoreBtn","showMoreCount","shownUsers","reduce","count","signersCountResponse","getUniqUserCountForDocument","querySelector","textContent","Dialog","onLoad","getSelectedItems","forEach","entity","style","display","BX","Loader","target","itemKey","get","remove","delete","title","text","name","customData","lastName","avatar","prepend","set","getTags","selectedMembers","clearTimeout","setTimeout","response","getUniqUserCountForMembers","update","TextFormat","encode","itemAvatar","profileLink","clear"],"mappings":"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"}