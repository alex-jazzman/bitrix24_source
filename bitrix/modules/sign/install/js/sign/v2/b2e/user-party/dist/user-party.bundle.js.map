{"version":3,"file":"user-party.bundle.js","sources":["../src/index.js"],"sourcesContent":["import { Dom, Loc, Tag, Text as TextFormat, Event, Extension } from 'main.core';\nimport type { Loader } from 'main.loader';\nimport { Helpdesk } from 'sign.v2.helper';\nimport { Dialog, TagSelector, TagItem } from 'ui.entity-selector';\nimport type { UserPartyOptions } from './type';\nimport type { CardItem } from './types/card-item';\nimport { UserPartyCounters } from 'sign.v2.b2e.user-party-counters';\nimport { UserPartyPopup } from 'sign.v2.b2e.user-party-popup';\nimport { Api, CountMember } from 'sign.v2.api';\nimport { FeatureStorage } from 'sign.feature-storage';\nimport { MemberRole, type MemberRoleType, EntityType } from 'sign.type';\nimport 'ui.icon-set.main';\n\nimport './style.css';\n\nexport type UserPartyConfig = {\n\tregion: string,\n\tb2eSignersLimitCount: number,\n}\n\nexport type { CardItem };\n\nconst Mode = Object.freeze({\n\tview: 'view',\n\tedit: 'edit',\n});\n\nconst defaultAvatarLink = '/bitrix/js/sign/v2/b2e/user-party/images/user.svg';\nconst departmentAvatarLink = '/bitrix/js/sign/v2/b2e/user-party/images/department.svg';\n\nconst HelpdeskCodes = Object.freeze({\n\tSignEdmWithEmployees: '19740792',\n});\n\nexport class UserParty\n{\n\t#api: Api;\n\n\t#ui = {\n\t\tcontainer: HTMLDivElement = null,\n\t\titemContainer: HTMLDivElement = null,\n\t\theader: HTMLSpanElement = null,\n\t\tdescription: HTMLParagraphElement = null,\n\t\tuserPartyCounterContainer: HTMLDivElement = null,\n\t\tshowMoreSignersContainer: HTMLDivElement = null,\n\t};\n\n\t#items: Map<String, CardItem> = new Map();\n\t#preselectedUserData: Array<Object> = [];\n\t#userCount: Number = 0;\n\n\t#viewMode = Mode.edit;\n\n\t#tagSelector: ?TagSelector = null;\n\t#loader: ?Loader = null;\n\t#userPartyCounters: UserPartyCounters = null;\n\n\t#documentUid: string = null;\n\n\t#userPartyPopup: UserPartyPopup = null;\n\n\t#counterDelayTimeout: ?number = null;\n\t#role: MemberRoleType = MemberRole.signer;\n\n\tconstructor(options: UserPartyOptions)\n\t{\n\t\tthis.#api = new Api();\n\t\tthis.#viewMode = options.mode;\n\t\tthis.#role = options.role ?? MemberRole.signer;\n\t\tthis.#init(options);\n\t}\n\n\t#init(options: UserPartyOptions): void\n\t{\n\t\tif (this.#viewMode === Mode.view)\n\t\t{\n\t\t\tthis.#ui.container = this.getLayout(options.region);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst { b2eSignersLimitCount, region } = options;\n\t\tthis.#userPartyCounters = new UserPartyCounters({\n\t\t\tuserCountersLimit: b2eSignersLimitCount,\n\t\t});\n\t\tthis.#ui.container = this.getLayout(region);\n\n\t\tconst tabs = [];\n\t\tconst entities = [\n\t\t\t{\n\t\t\t\tid: 'user',\n\t\t\t\toptions: { intranetUsersOnly: true },\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'structure-node',\n\t\t\t\toptions: {\n\t\t\t\t\tselectMode: 'usersAndDepartments',\n\t\t\t\t\tfillRecentTab: true,\n\t\t\t\t\tallowFlatDepartments: true,\n\t\t\t\t},\n\t\t\t},\n\t\t];\n\n\t\tif (FeatureStorage.isDocumentsInSignersSelectorEnabled())\n\t\t{\n\t\t\ttabs.push({ id: 'sign-document', title: Loc.getMessage('SIGN_USER_PARTY_TAB_DOCUMENTS') });\n\t\t\tentities.push({ id: 'sign-document' });\n\t\t}\n\n\t\tthis.#tagSelector = new TagSelector({\n\t\t\tevents: {\n\t\t\t\tonTagRemove: (event) => {\n\t\t\t\t\tconst { tag } = event.getData();\n\t\t\t\t\tthis.#removeItem(tag);\n\t\t\t\t},\n\t\t\t\tonTagAdd: (event) => {\n\t\t\t\t\tconst { tag } = event.getData();\n\t\t\t\t\tthis.#addItem(tag);\n\t\t\t\t},\n\t\t\t},\n\t\t\tdialogOptions: {\n\t\t\t\twidth: 425,\n\t\t\t\theight: 363,\n\t\t\t\tmultiple: true,\n\t\t\t\ttargetNode: this.#ui.itemContainer,\n\t\t\t\tcontext: 'sign_b2e_user_party',\n\t\t\t\ttabs,\n\t\t\t\tentities,\n\t\t\t\tdropdownMode: false,\n\t\t\t\thideOnDeselect: false,\n\t\t\t},\n\t\t});\n\t\tthis.#tagSelector.renderTo(this.#ui.itemContainer);\n\t}\n\n\tgetLayout(region: string): HTMLElement\n\t{\n\t\tif (this.#ui.container)\n\t\t{\n\t\t\treturn this.#ui.container;\n\t\t}\n\n\t\tthis.#ui.itemContainer = Tag.render`\n\t\t\t<div class=\"sign-document-b2e-user-party__item-list\"></div>\n\t\t`;\n\t\tif (this.#viewMode !== Mode.edit)\n\t\t{\n\t\t\tDom.addClass(this.#ui.itemContainer, '--view');\n\n\t\t\tconst link = Tag.render`\n\t\t\t\t<a href=\"#\">${Loc.getMessage('SIGN_USER_PARTY_VIEW_SHOW_MORE', {\n\t\t\t\t\t'#EMPLOYEE_COUNT#': '<span class=\"--count-placeholder\">â€¦</span>',\n\t\t\t\t})}</a>\n\t\t\t`;\n\n\t\t\tthis.#userPartyPopup = this.#createUserPartyPopup(link);\n\n\t\t\tEvent.bind(link, 'click', (event) => {\n\t\t\t\tthis.#userPartyPopup.setDocumentUid(this.#documentUid).show();\n\t\t\t\tevent.preventDefault();\n\t\t\t});\n\n\t\t\tthis.#ui.showMoreSignersContainer = Tag.render`\n\t\t\t\t<div class=\"sign-document-b2e-user-party__item-show_more\">\n\t\t\t\t\t${link}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\tDom.hide(this.#ui.showMoreSignersContainer);\n\t\t\tDom.append(this.#ui.showMoreSignersContainer, this.#ui.itemContainer);\n\n\t\t\treturn this.#ui.itemContainer;\n\t\t}\n\n\t\tconst descriptionMessage = region === 'ru'\n\t\t\t? Helpdesk.replaceLink(Loc.getMessage('SIGN_USER_PARTY_DESCRIPTION'), HelpdeskCodes.SignEdmWithEmployees)\n\t\t\t: Loc.getMessage('SIGN_USER_PARTY_DESCRIPTION_WITHOUT_LINK')\n\t\t;\n\t\tthis.#ui.description = Tag.render`\n\t\t\t<p class=\"sign-document-b2e-user-party__description\">\n\t\t\t\t${descriptionMessage}\n\t\t\t</p>\n\t\t`;\n\n\t\treturn Tag.render`\n\t\t\t<div>\n\t\t\t\t<div class=\"sign-b2e-settings__header-wrapper\">\n\t\t\t\t\t<h1 class=\"sign-b2e-settings__header\">${Loc.getMessage('SIGN_USER_PARTY_HEADER')}</h1>\n\t\t\t\t\t${this.#userPartyCounters.getLayout()}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"sign-b2e-settings__item\">\n\t\t\t\t\t<p class=\"sign-b2e-settings__item_title\">\n\t\t\t\t\t\t${Loc.getMessage('SIGN_USER_PARTY_ITEM_TITLE')}\n\t\t\t\t\t</p>\n\t\t\t\t\t${this.#ui.itemContainer}\n\t\t\t\t\t${this.#ui.description}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#createUserPartyPopup(bindElement: HTMLElement): UserPartyPopup\n\t{\n\t\tconst isDepartmentsVisible = this.#role === MemberRole.signer;\n\n\t\treturn new UserPartyPopup({\n\t\t\tbindElement,\n\t\t\tisDepartmentsVisible,\n\t\t\trole: this.#role,\n\t\t});\n\t}\n\n\tasync load(ids: number[]): Promise<void>\n\t{\n\t\tconst { dialog } = this.#tagSelector;\n\t\tdialog.preselectedItems = ids.map((userId) => ['user', userId]);\n\t\tconst promise = new Promise((resolve) => {\n\t\t\tdialog.subscribeOnce('onLoad', resolve);\n\t\t});\n\t\tdialog.load();\n\t\tawait promise;\n\t}\n\n\tasync setUserIds(usersData: [Object]): void\n\t{\n\t\tthis.#clean();\n\n\t\tconst maxShownItems = this.#getViewModeItemsCount();\n\n\t\tthis.#userCount = usersData.length;\n\t\tthis.#preselectedUserData = usersData\n\t\t\t.sort((a, b) => (a.entityType === 'structure-node' ? -1 : 1))\n\t\t\t.slice(0, maxShownItems)\n\t\t;\n\n\t\tif (this.#preselectedUserData.length < maxShownItems)\n\t\t{\n\t\t\tconst membersResponse = await this.#api.getMembersForDocument(\n\t\t\t\tthis.#documentUid,\n\t\t\t\t1,\n\t\t\t\tmaxShownItems,\n\t\t\t\tthis.#role,\n\t\t\t);\n\t\t\tconst preselectedIds = new Set(\n\t\t\t\tusersData\n\t\t\t\t\t.filter((item) => item.entityType === EntityType.USER)\n\t\t\t\t\t.map((item) => item.entityId),\n\t\t\t);\n\t\t\tconst addMembers = membersResponse.members\n\t\t\t\t.filter((member) => !preselectedIds.has(member.userId))\n\t\t\t\t.slice(0, maxShownItems - this.#preselectedUserData.length)\n\t\t\t;\n\t\t\tthis.#preselectedUserData = [...this.#preselectedUserData, ...addMembers.map((member) => {\n\t\t\t\treturn { entityType: 'user', entityId: member.userId };\n\t\t\t})];\n\t\t}\n\n\t\t// workaround because prepend is used in the interface instead of append\n\t\tthis.#preselectedUserData.reverse();\n\n\t\tawait this.#loadPreselectedUsersData();\n\t\tthis.#displayShowMoreBtn();\n\t}\n\n\tasync #displayShowMoreBtn(): void\n\t{\n\t\tlet isShowMoreBtn = false;\n\t\tlet showMoreCount = 0;\n\t\tconst shownUsers = this.#preselectedUserData\n\t\t\t.reduce((count, item) => (item.entityType === 'user' ? count + 1 : count), 0)\n\t\t;\n\n\t\tif (this.#role === MemberRole.signer)\n\t\t{\n\t\t\tconst signersCountResponse = await this.#api.getUniqUserCountForDocument(this.#documentUid);\n\t\t\tshowMoreCount = signersCountResponse.count - shownUsers;\n\t\t\tisShowMoreBtn = showMoreCount > 0;\n\t\t}\n\t\telse if (this.#userCount > this.#getViewModeItemsCount())\n\t\t{\n\t\t\tisShowMoreBtn = true;\n\t\t\tshowMoreCount = this.#userCount - this.#getViewModeItemsCount();\n\t\t}\n\n\t\tif (isShowMoreBtn)\n\t\t{\n\t\t\tthis.#ui.showMoreSignersContainer.querySelector('.--count-placeholder').textContent = showMoreCount;\n\t\t\tDom.show(this.#ui.showMoreSignersContainer);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#ui.showMoreSignersContainer.querySelector('.--count-placeholder').textContent = 0;\n\t\t\tDom.hide(this.#ui.showMoreSignersContainer);\n\t\t}\n\t}\n\n\tasync #loadPreselectedUsersData(): Promise<void>\n\t{\n\t\tthis.#showLoader();\n\n\t\tawait new Promise((resolve) => {\n\t\t\tconst dialog = new Dialog({\n\t\t\t\tentities: [\n\t\t\t\t\t{ id: 'user' },\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\tonLoad: () => {\n\t\t\t\t\t\tdialog.getSelectedItems().forEach((item) => {\n\t\t\t\t\t\t\tthis.#addItem(item);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tpreselectedItems: this.#preselectedUserData.map((entity) => {\n\t\t\t\t\treturn [entity.entityType, entity.entityId];\n\t\t\t\t}),\n\t\t\t});\n\t\t\tdialog.load();\n\t\t});\n\n\t\tthis.#hideLoader();\n\t}\n\n\t#showLoader(): void\n\t{\n\t\tthis.#ui.itemContainer.style.display = 'none';\n\t\tthis.#getLoader().show();\n\t}\n\n\t#hideLoader(): void\n\t{\n\t\tthis.#ui.itemContainer.style.display = 'flex';\n\t\tthis.#getLoader().hide();\n\t}\n\n\t#getLoader(): Loader\n\t{\n\t\tif (this.#loader)\n\t\t{\n\t\t\treturn this.#loader;\n\t\t}\n\n\t\tthis.#loader = new BX.Loader({\n\t\t\ttarget: this.#ui.container,\n\t\t\tmode: 'inline',\n\t\t\tsize: 40,\n\t\t});\n\n\t\treturn this.#loader;\n\t}\n\n\t#removeItem(tag: TagItem): void\n\t{\n\t\tconst itemKey = this.#makeItemMapKeyByTag(tag);\n\t\tconst item = this.#items.get(itemKey);\n\t\tif (item?.container)\n\t\t{\n\t\t\tDom.remove(item.container);\n\t\t}\n\n\t\tthis.#items.delete(itemKey);\n\n\t\tthis.#updateEditModeCounter();\n\t}\n\n\t#addItem(tag: TagItem): void\n\t{\n\t\tconst item = {\n\t\t\tid: tag.id,\n\t\t\ttitle: tag?.title.text,\n\t\t\tname: tag.customData?.get('name'),\n\t\t\tlastName: tag.customData?.get('lastName'),\n\t\t\tavatar: tag?.avatar,\n\t\t\tentityId: tag.id,\n\t\t\tentityType: tag?.entityId,\n\t\t};\n\n\t\tconst container = this.#viewMode === Mode.view\n\t\t\t? this.#createItemLayout(item)\n\t\t\t: null\n\t\t;\n\t\tif (container)\n\t\t{\n\t\t\tDom.prepend(container, this.#ui.itemContainer);\n\t\t}\n\n\t\titem.container = container;\n\t\tthis.#items.set(this.#makeItemMapKeyByTag(tag), item);\n\n\t\tthis.#updateEditModeCounter();\n\t}\n\n\t#updateEditModeCounter(): void\n\t{\n\t\tif (this.#viewMode === Mode.edit)\n\t\t{\n\t\t\tthis.#updateCounterWithDelay(this.#tagSelector.getTags().map((member) => {\n\t\t\t\treturn {\n\t\t\t\t\tentityId: member.id,\n\t\t\t\t\tentityType: member.entityId,\n\t\t\t\t};\n\t\t\t}));\n\t\t}\n\t}\n\n\t#updateCounterWithDelay(selectedMembers: CountMember[]): void\n\t{\n\t\tclearTimeout(this.#counterDelayTimeout);\n\n\t\tthis.#counterDelayTimeout = setTimeout(async () => {\n\t\t\tconst response = await this.#api.getUniqUserCountForMembers(selectedMembers);\n\t\t\tthis.#userPartyCounters?.update(response.count);\n\t\t}, 100);\n\t}\n\n\tvalidate(): boolean\n\t{\n\t\tthis.closeCounterGuide();\n\t\tconst isValid = this.#items.size > 0 && this.#userPartyCounters.getCount() > 0;\n\t\tconst tagSelectorContainer = this.#tagSelector.getOuterContainer();\n\t\tif (isValid)\n\t\t{\n\t\t\tDom.removeClass(tagSelectorContainer, '--invalid');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(tagSelectorContainer, '--invalid');\n\t\t}\n\n\t\treturn isValid;\n\t}\n\n\tgetEntities(): Array<CardItem>\n\t{\n\t\treturn [...this.#items.values()];\n\t}\n\n\tresetUserPartyPopup(): void\n\t{\n\t\tthis.#userPartyPopup.resetData();\n\t}\n\n\tsetDocumentUid(uid: string): void\n\t{\n\t\tthis.#documentUid = uid;\n\t}\n\n\tgetPreselectedUserData(): Object[]\n\t{\n\t\treturn this.#preselectedUserData;\n\t}\n\n\t#createItemLayout(item: CardItem): HTMLElement\n\t{\n\t\tswitch (item.entityType)\n\t\t{\n\t\t\tcase 'structure-node':\n\t\t\t\treturn this.#createDepartmentItemLayout(item);\n\t\t\tcase 'sign-document':\n\t\t\t\treturn this.#createDocumentItemLayout(item);\n\t\t\tdefault:\n\t\t\t\treturn this.#createUserItemLayout(item);\n\t\t}\n\t}\n\n\t#createDepartmentItemLayout(item: CardItem): HTMLElement\n\t{\n\t\tconst title = TextFormat.encode(item.title);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document-b2e-user-party__item-list_item --department\">\n\t\t\t\t<div>\n\t\t\t\t\t<img\n\t\t\t\t\t\tclass=\"sign-document-b2e-user-party__item-list_item-avatar\"\n\t\t\t\t\t\ttitle=\"${title}\" src='${departmentAvatarLink}' alt=\"avatar\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div title=\"${title}\" class=\"sign-document-b2e-user-party__item-list_item-text\">\n\t\t\t\t\t${title}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#createDocumentItemLayout(item: CardItem): HTMLElement\n\t{\n\t\tconst title = TextFormat.encode(item.title);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document-b2e-user-party__item-list_item --document\">\n\t\t\t\t<div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"sign-document-b2e-user-party__item-list_item-avatar ui-icon-set --document-sign\"\n\t\t\t\t\t\ttitle=\"${title}\" alt=\"avatar\"\n\t\t\t\t\t></div>\n\t\t\t\t</div>\n\t\t\t\t<div title=\"${title}\" class=\"sign-document-b2e-user-party__item-list_item-text\">\n\t\t\t\t\t${title}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#createUserItemLayout(item: CardItem): HTMLElement\n\t{\n\t\tconst title = TextFormat.encode(item.title);\n\t\tconst itemAvatar = item.avatar || defaultAvatarLink;\n\t\tconst profileLink = `/company/personal/user/${TextFormat.encode(item.entityId)}/`;\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document-b2e-user-party__item-list_item --user\">\n\t\t\t\t<a href=\"${profileLink}\">\n\t\t\t\t\t<img\n\t\t\t\t\t\tclass=\"sign-document-b2e-user-party__item-list_item-avatar\"\n\t\t\t\t\t\ttitle=\"${title}\" src='${TextFormat.encode(itemAvatar)}' alt=\"avatar\"\n\t\t\t\t\t/>\n\t\t\t\t</a>\n\t\t\t\t<div title=\"${title}\" class=\"sign-document-b2e-user-party__item-list_item-text\">\n\t\t\t\t\t${title}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#clean(): void\n\t{\n\t\tthis.closeCounterGuide();\n\t\t[...this.#items.values()].forEach((item) => Dom.remove(item.container));\n\t\tthis.#items.clear();\n\t\tthis.#userPartyCounters?.update(this.#items.size);\n\t}\n\n\t#getViewModeItemsCount(): number\n\t{\n\t\treturn 7; // for fixed slider width\n\t}\n\n\tgetUniqueUsersCount(): number\n\t{\n\t\treturn this.#userPartyCounters?.getCount() ?? 0;\n\t}\n\n\tcloseCounterGuide(): void\n\t{\n\t\tthis.#userPartyCounters?.closeGuide();\n\t}\n\n\t#makeItemMapKeyByTag(tag: { id: number | string, entityId: string }): string\n\t{\n\t\tconst { id, entityId } = tag;\n\n\t\treturn `${entityId}_${id}`;\n\t}\n}\n"],"names":["Mode","Object","freeze","view","edit","defaultAvatarLink","departmentAvatarLink","HelpdeskCodes","SignEdmWithEmployees","UserParty","constructor","options","container","HTMLDivElement","itemContainer","header","HTMLSpanElement","description","HTMLParagraphElement","userPartyCounterContainer","showMoreSignersContainer","Map","MemberRole","signer","Api","mode","role","getLayout","region","Tag","render","Dom","addClass","link","Loc","getMessage","Event","bind","event","setDocumentUid","show","preventDefault","hide","append","descriptionMessage","Helpdesk","replaceLink","load","ids","dialog","preselectedItems","map","userId","promise","Promise","resolve","subscribeOnce","setUserIds","usersData","maxShownItems","length","sort","a","b","entityType","slice","membersResponse","getMembersForDocument","preselectedIds","Set","filter","item","EntityType","USER","entityId","addMembers","members","member","has","reverse","validate","closeCounterGuide","isValid","size","getCount","tagSelectorContainer","getOuterContainer","removeClass","getEntities","values","resetUserPartyPopup","resetData","uid","getPreselectedUserData","getUniqueUsersCount","closeGuide","b2eSignersLimitCount","UserPartyCounters","userCountersLimit","tabs","entities","id","intranetUsersOnly","selectMode","fillRecentTab","allowFlatDepartments","FeatureStorage","isDocumentsInSignersSelectorEnabled","push","title","TagSelector","events","onTagRemove","tag","getData","onTagAdd","dialogOptions","width","height","multiple","targetNode","context","dropdownMode","hideOnDeselect","renderTo","bindElement","isDepartmentsVisible","UserPartyPopup","isShowMoreBtn","showMoreCount","shownUsers","reduce","count","signersCountResponse","getUniqUserCountForDocument","querySelector","textContent","Dialog","onLoad","getSelectedItems","forEach","entity","style","display","BX","Loader","target","itemKey","get","remove","delete","text","name","customData","lastName","avatar","prepend","set","getTags","selectedMembers","clearTimeout","setTimeout","response","getUniqUserCountForMembers","update","TextFormat","encode","itemAvatar","profileLink","clear"],"mappings":";;;;;;;;;;;;;;;;AAAA,CAsBA,MAAMA,IAAI,GAAGC,MAAM,CAACC,MAAM,CAAC;GAC1BC,IAAI,EAAE,MAAM;GACZC,IAAI,EAAE;CACP,CAAC,CAAC;CAEF,MAAMC,iBAAiB,GAAG,mDAAmD;CAC7E,MAAMC,oBAAoB,GAAG,yDAAyD;CAEtF,MAAMC,aAAa,GAAGN,MAAM,CAACC,MAAM,CAAC;GACnCM,oBAAoB,EAAE;CACvB,CAAC,CAAC;CAAC;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAEH,CAAO,MAAMC,SAAS,CACtB;GA6BCC,WAAW,CAACC,QAAyB,EACrC;KAAA;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA,OA3BM;SACLC,SAAS,EAAEC,cAAc,GAAG,IAAI;SAChCC,aAAa,EAAED,cAAc,GAAG,IAAI;SACpCE,MAAM,EAAEC,eAAe,GAAG,IAAI;SAC9BC,WAAW,EAAEC,oBAAoB,GAAG,IAAI;SACxCC,yBAAyB,EAAEN,cAAc,GAAG,IAAI;SAChDO,wBAAwB,EAAEP,cAAc,GAAG;;;KAC3C;OAAA;OAAA,OAE+B,IAAIQ,GAAG;;KAAE;OAAA;OAAA,OACH;;KAAE;OAAA;OAAA,OACnB;;KAAC;OAAA;OAAA,OAEVrB,IAAI,CAACI;;KAAI;OAAA;OAAA,OAEQ;;KAAI;OAAA;OAAA,OACd;;KAAI;OAAA;OAAA,OACiB;;KAAI;OAAA;OAAA,OAErB;;KAAI;OAAA;OAAA,OAEO;;KAAI;OAAA;OAAA,OAEN;;KAAI;OAAA;OAAA,OACZkB,oBAAU,CAACC;;KAIlC,4CAAI,gBAAQ,IAAIC,eAAG,EAAE;KACrB,4CAAI,0BAAab,QAAO,CAACc,IAAI;KAC7B,4CAAI,mCAASd,QAAO,CAACe,IAAI,4BAAIJ,oBAAU,CAACC,MAAM;KAC9C,4CAAI,gBAAOZ,QAAO;;GAkEnBgB,SAAS,CAACC,MAAc,EACxB;KACC,IAAI,4CAAI,YAAKhB,SAAS,EACtB;OACC,OAAO,4CAAI,YAAKA,SAAS;;KAG1B,4CAAI,YAAKE,aAAa,GAAGe,aAAG,CAACC,MAAM,cAAC;;GAEpC,EAAC;KACD,IAAI,4CAAI,4BAAe9B,IAAI,CAACI,IAAI,EAChC;OACC2B,aAAG,CAACC,QAAQ,CAAC,4CAAI,YAAKlB,aAAa,EAAE,QAAQ,CAAC;OAE9C,MAAMmB,IAAI,GAAGJ,aAAG,CAACC,MAAM,gBAAC;kBACX,CAET;IACJ,GAHeI,aAAG,CAACC,UAAU,CAAC,gCAAgC,EAAE;SAC9D,kBAAkB,EAAE;QACpB,CAAC,CACF;OAED,4CAAI,8EAAmB,IAAI,gDAAuBF,IAAI,CAAC;OAEvDG,eAAK,CAACC,IAAI,CAACJ,IAAI,EAAE,OAAO,EAAGK,KAAK,IAAK;SACpC,4CAAI,oCAAiBC,cAAc,yCAAC,IAAI,8BAAc,CAACC,IAAI,EAAE;SAC7DF,KAAK,CAACG,cAAc,EAAE;QACtB,CAAC;OAEF,4CAAI,YAAKrB,wBAAwB,GAAGS,aAAG,CAACC,MAAM,gBAAC;;OAE7C,CAAO;;IAET,GAFIG,IAAI,CAEP;OACDF,aAAG,CAACW,IAAI,CAAC,4CAAI,YAAKtB,wBAAwB,CAAC;OAC3CW,aAAG,CAACY,MAAM,CAAC,4CAAI,YAAKvB,wBAAwB,EAAE,4CAAI,YAAKN,aAAa,CAAC;OAErE,OAAO,4CAAI,YAAKA,aAAa;;KAG9B,MAAM8B,kBAAkB,GAAGhB,MAAM,KAAK,IAAI,GACvCiB,uBAAQ,CAACC,WAAW,CAACZ,aAAG,CAACC,UAAU,CAAC,6BAA6B,CAAC,EAAE5B,aAAa,CAACC,oBAAoB,CAAC,GACvG0B,aAAG,CAACC,UAAU,CAAC,0CAA0C,CAAC;KAE7D,4CAAI,YAAKlB,WAAW,GAAGY,aAAG,CAACC,MAAM,gBAAC;;MAEhC,CAAqB;;GAEvB,GAFIc,kBAAkB,CAErB;KAED,OAAOf,aAAG,CAACC,MAAM,gBAAC;;;6CAGuB,CAA2C;OACjF,CAAsC;;;;QAIrC,CAA+C;;OAEhD,CAAyB;OACzB,CAAuB;;;GAG1B,GAX2CI,aAAG,CAACC,UAAU,CAAC,wBAAwB,CAAC,EAC9E,4CAAI,0CAAoBR,SAAS,EAAE,EAIlCO,aAAG,CAACC,UAAU,CAAC,4BAA4B,CAAC,EAE7C,4CAAI,YAAKrB,aAAa,EACtB,4CAAI,YAAKG,WAAW;;GAiB1B,MAAM8B,IAAI,CAACC,GAAa,EACxB;KACC,MAAM;OAAEC;MAAQ,2CAAG,IAAI,6BAAa;KACpCA,MAAM,CAACC,gBAAgB,GAAGF,GAAG,CAACG,GAAG,CAAEC,MAAM,IAAK,CAAC,MAAM,EAAEA,MAAM,CAAC,CAAC;KAC/D,MAAMC,OAAO,GAAG,IAAIC,OAAO,CAAEC,OAAO,IAAK;OACxCN,MAAM,CAACO,aAAa,CAAC,QAAQ,EAAED,OAAO,CAAC;MACvC,CAAC;KACFN,MAAM,CAACF,IAAI,EAAE;KACb,MAAMM,OAAO;;GAGd,MAAMI,UAAU,CAACC,SAAmB,EACpC;KACC,4CAAI;KAEJ,MAAMC,aAAa,2CAAG,IAAI,mDAAyB;KAEnD,4CAAI,4BAAcD,SAAS,CAACE,MAAM;KAClC,4CAAI,gDAAwBF,SAAS,CACnCG,IAAI,CAAC,CAACC,CAAC,EAAEC,CAAC,KAAMD,CAAC,CAACE,UAAU,KAAK,gBAAgB,GAAG,CAAC,CAAC,GAAG,CAAE,CAAC,CAC5DC,KAAK,CAAC,CAAC,EAAEN,aAAa,CAAC;KAGzB,IAAI,4CAAI,8CAAsBC,MAAM,GAAGD,aAAa,EACpD;OACC,MAAMO,eAAe,GAAG,MAAM,4CAAI,cAAMC,qBAAqB,yCAC5D,IAAI,+BACJ,CAAC,EACDR,aAAa,0CACb,IAAI,gBACJ;OACD,MAAMS,cAAc,GAAG,IAAIC,GAAG,CAC7BX,SAAS,CACPY,MAAM,CAAEC,IAAI,IAAKA,IAAI,CAACP,UAAU,KAAKQ,oBAAU,CAACC,IAAI,CAAC,CACrDtB,GAAG,CAAEoB,IAAI,IAAKA,IAAI,CAACG,QAAQ,CAAC,CAC9B;OACD,MAAMC,UAAU,GAAGT,eAAe,CAACU,OAAO,CACxCN,MAAM,CAAEO,MAAM,IAAK,CAACT,cAAc,CAACU,GAAG,CAACD,MAAM,CAACzB,MAAM,CAAC,CAAC,CACtDa,KAAK,CAAC,CAAC,EAAEN,aAAa,GAAG,4CAAI,8CAAsBC,MAAM,CAAC;OAE5D,4CAAI,gDAAwB,CAAC,2CAAG,IAAI,6CAAqB,EAAE,GAAGe,UAAU,CAACxB,GAAG,CAAE0B,MAAM,IAAK;SACxF,OAAO;WAAEb,UAAU,EAAE,MAAM;WAAEU,QAAQ,EAAEG,MAAM,CAACzB;UAAQ;QACtD,CAAC,CAAC;;;;KAIJ,4CAAI,8CAAsB2B,OAAO,EAAE;KAEnC,8CAAM,IAAI,yDAA4B;KACtC,4CAAI;;GA0JLC,QAAQ,GACR;KACC,IAAI,CAACC,iBAAiB,EAAE;KACxB,MAAMC,OAAO,GAAG,4CAAI,kBAAQC,IAAI,GAAG,CAAC,IAAI,4CAAI,0CAAoBC,QAAQ,EAAE,GAAG,CAAC;KAC9E,MAAMC,oBAAoB,GAAG,4CAAI,8BAAcC,iBAAiB,EAAE;KAClE,IAAIJ,OAAO,EACX;OACCnD,aAAG,CAACwD,WAAW,CAACF,oBAAoB,EAAE,WAAW,CAAC;MAClD,MAED;OACCtD,aAAG,CAACC,QAAQ,CAACqD,oBAAoB,EAAE,WAAW,CAAC;;KAGhD,OAAOH,OAAO;;GAGfM,WAAW,GACX;KACC,OAAO,CAAC,GAAG,4CAAI,kBAAQC,MAAM,EAAE,CAAC;;GAGjCC,mBAAmB,GACnB;KACC,4CAAI,oCAAiBC,SAAS,EAAE;;GAGjCpD,cAAc,CAACqD,GAAW,EAC1B;KACC,4CAAI,gCAAgBA,GAAG;;GAGxBC,sBAAsB,GACtB;KACC,+CAAO,IAAI;;GAwFZC,mBAAmB,GACnB;KAAA;KACC,kGAAO,IAAI,8DAAJ,uBAAyBV,QAAQ,EAAE,oCAAI,CAAC;;GAGhDH,iBAAiB,GACjB;KAAA;KACC,sEAAI,8DAAJ,uBAAyBc,UAAU,EAAE;;CASvC;CAAC,gBAheMpF,OAAyB,EAC/B;GACC,IAAI,4CAAI,4BAAeX,IAAI,CAACG,IAAI,EAChC;KACC,4CAAI,YAAKS,SAAS,GAAG,IAAI,CAACe,SAAS,CAAChB,OAAO,CAACiB,MAAM,CAAC;KAEnD;;GAGD,MAAM;KAAEoE,oBAAoB;KAAEpE;IAAQ,GAAGjB,OAAO;GAChD,4CAAI,4CAAsB,IAAIsF,+CAAiB,CAAC;KAC/CC,iBAAiB,EAAEF;IACnB,CAAC;GACF,4CAAI,YAAKpF,SAAS,GAAG,IAAI,CAACe,SAAS,CAACC,MAAM,CAAC;GAE3C,MAAMuE,IAAI,GAAG,EAAE;GACf,MAAMC,QAAQ,GAAG,CAChB;KACCC,EAAE,EAAE,MAAM;KACV1F,OAAO,EAAE;OAAE2F,iBAAiB,EAAE;;IAC9B,EACD;KACCD,EAAE,EAAE,gBAAgB;KACpB1F,OAAO,EAAE;OACR4F,UAAU,EAAE,qBAAqB;OACjCC,aAAa,EAAE,IAAI;OACnBC,oBAAoB,EAAE;;IAEvB,CACD;GAED,IAAIC,kCAAc,CAACC,mCAAmC,EAAE,EACxD;KACCR,IAAI,CAACS,IAAI,CAAC;OAAEP,EAAE,EAAE,eAAe;OAAEQ,KAAK,EAAE3E,aAAG,CAACC,UAAU,CAAC,+BAA+B;MAAG,CAAC;KAC1FiE,QAAQ,CAACQ,IAAI,CAAC;OAAEP,EAAE,EAAE;MAAiB,CAAC;;GAGvC,4CAAI,gCAAgB,IAAIS,6BAAW,CAAC;KACnCC,MAAM,EAAE;OACPC,WAAW,EAAG1E,KAAK,IAAK;SACvB,MAAM;WAAE2E;UAAK,GAAG3E,KAAK,CAAC4E,OAAO,EAAE;SAC/B,4CAAI,4BAAaD,GAAG;QACpB;OACDE,QAAQ,EAAG7E,KAAK,IAAK;SACpB,MAAM;WAAE2E;UAAK,GAAG3E,KAAK,CAAC4E,OAAO,EAAE;SAC/B,4CAAI,sBAAUD,GAAG;;MAElB;KACDG,aAAa,EAAE;OACdC,KAAK,EAAE,GAAG;OACVC,MAAM,EAAE,GAAG;OACXC,QAAQ,EAAE,IAAI;OACdC,UAAU,EAAE,4CAAI,YAAK1G,aAAa;OAClC2G,OAAO,EAAE,qBAAqB;OAC9BtB,IAAI;OACJC,QAAQ;OACRsB,YAAY,EAAE,KAAK;OACnBC,cAAc,EAAE;;IAEjB,CAAC;GACF,4CAAI,8BAAcC,QAAQ,CAAC,4CAAI,YAAK9G,aAAa,CAAC;CACnD;CAAC,gCAmEqB+G,WAAwB,EAC9C;GACC,MAAMC,oBAAoB,GAAG,4CAAI,oBAAWxG,oBAAU,CAACC,MAAM;GAE7D,OAAO,IAAIwG,yCAAc,CAAC;KACzBF,WAAW;KACXC,oBAAoB;KACpBpG,IAAI,0CAAE,IAAI;IACV,CAAC;CACH;CAAC,sCAuDD;GACC,IAAIsG,aAAa,GAAG,KAAK;GACzB,IAAIC,aAAa,GAAG,CAAC;GACrB,MAAMC,UAAU,GAAG,4CAAI,8CACrBC,MAAM,CAAC,CAACC,KAAK,EAAE7D,IAAI,KAAMA,IAAI,CAACP,UAAU,KAAK,MAAM,GAAGoE,KAAK,GAAG,CAAC,GAAGA,KAAM,EAAE,CAAC,CAAC;GAG9E,IAAI,4CAAI,oBAAW9G,oBAAU,CAACC,MAAM,EACpC;KACC,MAAM8G,oBAAoB,GAAG,MAAM,4CAAI,cAAMC,2BAA2B,yCAAC,IAAI,8BAAc;KAC3FL,aAAa,GAAGI,oBAAoB,CAACD,KAAK,GAAGF,UAAU;KACvDF,aAAa,GAAGC,aAAa,GAAG,CAAC;IACjC,MACI,IAAI,4CAAI,oEAAc,IAAI,mDAAyB,EACxD;KACCD,aAAa,GAAG,IAAI;KACpBC,aAAa,GAAG,4CAAI,oEAAc,IAAI,mDAAyB;;GAGhE,IAAID,aAAa,EACjB;KACC,4CAAI,YAAK5G,wBAAwB,CAACmH,aAAa,CAAC,sBAAsB,CAAC,CAACC,WAAW,GAAGP,aAAa;KACnGlG,aAAG,CAACS,IAAI,CAAC,4CAAI,YAAKpB,wBAAwB,CAAC;IAC3C,MAED;KACC,4CAAI,YAAKA,wBAAwB,CAACmH,aAAa,CAAC,sBAAsB,CAAC,CAACC,WAAW,GAAG,CAAC;KACvFzG,aAAG,CAACW,IAAI,CAAC,4CAAI,YAAKtB,wBAAwB,CAAC;;CAE7C;CAAC,4CAGD;GACC,4CAAI;GAEJ,MAAM,IAAIkC,OAAO,CAAEC,OAAO,IAAK;KAC9B,MAAMN,MAAM,GAAG,IAAIwF,wBAAM,CAAC;OACzBrC,QAAQ,EAAE,CACT;SAAEC,EAAE,EAAE;QAAQ,CACd;OACDU,MAAM,EAAE;SACP2B,MAAM,EAAE,MAAM;WACbzF,MAAM,CAAC0F,gBAAgB,EAAE,CAACC,OAAO,CAAErE,IAAI,IAAK;aAC3C,4CAAI,sBAAUA,IAAI;YAClB,CAAC;WACFhB,OAAO,EAAE;;QAEV;OACDL,gBAAgB,EAAE,4CAAI,8CAAsBC,GAAG,CAAE0F,MAAM,IAAK;SAC3D,OAAO,CAACA,MAAM,CAAC7E,UAAU,EAAE6E,MAAM,CAACnE,QAAQ,CAAC;QAC3C;MACD,CAAC;KACFzB,MAAM,CAACF,IAAI,EAAE;IACb,CAAC;GAEF,4CAAI;CACL;CAAC,wBAGD;GACC,4CAAI,YAAKjC,aAAa,CAACgI,KAAK,CAACC,OAAO,GAAG,MAAM;GAC7C,4CAAI,4BAAcvG,IAAI,EAAE;CACzB;CAAC,wBAGD;GACC,4CAAI,YAAK1B,aAAa,CAACgI,KAAK,CAACC,OAAO,GAAG,MAAM;GAC7C,4CAAI,4BAAcrG,IAAI,EAAE;CACzB;CAAC,uBAGD;GACC,4CAAI,IAAI,qBACR;KACC,+CAAO,IAAI;;GAGZ,4CAAI,sBAAW,IAAIsG,EAAE,CAACC,MAAM,CAAC;KAC5BC,MAAM,EAAE,4CAAI,YAAKtI,SAAS;KAC1Ba,IAAI,EAAE,QAAQ;KACd0D,IAAI,EAAE;IACN,CAAC;GAEF,+CAAO,IAAI;CACZ;CAAC,sBAEW8B,GAAY,EACxB;GACC,MAAMkC,OAAO,2CAAG,IAAI,8CAAsBlC,GAAG,CAAC;GAC9C,MAAM1C,IAAI,GAAG,4CAAI,kBAAQ6E,GAAG,CAACD,OAAO,CAAC;GACrC,IAAI5E,IAAI,YAAJA,IAAI,CAAE3D,SAAS,EACnB;KACCmB,aAAG,CAACsH,MAAM,CAAC9E,IAAI,CAAC3D,SAAS,CAAC;;GAG3B,4CAAI,kBAAQ0I,MAAM,CAACH,OAAO,CAAC;GAE3B,4CAAI;CACL;CAAC,mBAEQlC,GAAY,EACrB;GAAA;GACC,MAAM1C,IAAI,GAAG;KACZ8B,EAAE,EAAEY,GAAG,CAACZ,EAAE;KACVQ,KAAK,EAAEI,GAAG,oBAAHA,GAAG,CAAEJ,KAAK,CAAC0C,IAAI;KACtBC,IAAI,qBAAEvC,GAAG,CAACwC,UAAU,qBAAd,gBAAgBL,GAAG,CAAC,MAAM,CAAC;KACjCM,QAAQ,sBAAEzC,GAAG,CAACwC,UAAU,qBAAd,iBAAgBL,GAAG,CAAC,UAAU,CAAC;KACzCO,MAAM,EAAE1C,GAAG,oBAAHA,GAAG,CAAE0C,MAAM;KACnBjF,QAAQ,EAAEuC,GAAG,CAACZ,EAAE;KAChBrC,UAAU,EAAEiD,GAAG,oBAAHA,GAAG,CAAEvC;IACjB;GAED,MAAM9D,SAAS,GAAG,4CAAI,4BAAeZ,IAAI,CAACG,IAAI,2CAC3C,IAAI,wCAAmBoE,IAAI,IAC3B,IAAI;GAEP,IAAI3D,SAAS,EACb;KACCmB,aAAG,CAAC6H,OAAO,CAAChJ,SAAS,EAAE,4CAAI,YAAKE,aAAa,CAAC;;GAG/CyD,IAAI,CAAC3D,SAAS,GAAGA,SAAS;GAC1B,4CAAI,kBAAQiJ,GAAG,yCAAC,IAAI,8CAAsB5C,GAAG,GAAG1C,IAAI,CAAC;GAErD,4CAAI;CACL;CAAC,mCAGD;GACC,IAAI,4CAAI,4BAAevE,IAAI,CAACI,IAAI,EAChC;KACC,4CAAI,oDAAyB,4CAAI,8BAAc0J,OAAO,EAAE,CAAC3G,GAAG,CAAE0B,MAAM,IAAK;OACxE,OAAO;SACNH,QAAQ,EAAEG,MAAM,CAACwB,EAAE;SACnBrC,UAAU,EAAEa,MAAM,CAACH;QACnB;MACD,CAAC;;CAEJ;CAAC,kCAEuBqF,eAA8B,EACtD;GACCC,YAAY,yCAAC,IAAI,8CAAsB;GAEvC,4CAAI,gDAAwBC,UAAU,CAAC,YAAY;KAAA;KAClD,MAAMC,QAAQ,GAAG,MAAM,4CAAI,cAAMC,0BAA0B,CAACJ,eAAe,CAAC;KAC5E,sEAAI,8DAAJ,uBAAyBK,MAAM,CAACF,QAAQ,CAAC9B,KAAK,CAAC;IAC/C,EAAE,GAAG,CAAC;CACR;CAAC,4BAuCiB7D,IAAc,EAChC;GACC,QAAQA,IAAI,CAACP,UAAU;KAEtB,KAAK,gBAAgB;OACpB,+CAAO,IAAI,4DAA6BO,IAAI;KAC7C,KAAK,eAAe;OACnB,+CAAO,IAAI,wDAA2BA,IAAI;KAC3C;OACC,+CAAO,IAAI,gDAAuBA,IAAI;;CAEzC;CAAC,sCAE2BA,IAAc,EAC1C;GACC,MAAMsC,KAAK,GAAGwD,cAAU,CAACC,MAAM,CAAC/F,IAAI,CAACsC,KAAK,CAAC;GAE3C,OAAOhF,aAAG,CAACC,MAAM,gBAAC;;;;;eAKP,CAAQ,UAAO,CAAuB;;;kBAGnC,CAAQ;OACnB,CAAQ;;;GAGX,GAPa+E,KAAK,EAAUvG,oBAAoB,EAGhCuG,KAAK,EAChBA,KAAK;CAIX;CAAC,oCAEyBtC,IAAc,EACxC;GACC,MAAMsC,KAAK,GAAGwD,cAAU,CAACC,MAAM,CAAC/F,IAAI,CAACsC,KAAK,CAAC;GAE3C,OAAOhF,aAAG,CAACC,MAAM,gBAAC;;;;;eAKP,CAAQ;;;kBAGL,CAAQ;OACnB,CAAQ;;;GAGX,GAPa+E,KAAK,EAGFA,KAAK,EAChBA,KAAK;CAIX;CAAC,gCAEqBtC,IAAc,EACpC;GACC,MAAMsC,KAAK,GAAGwD,cAAU,CAACC,MAAM,CAAC/F,IAAI,CAACsC,KAAK,CAAC;GAC3C,MAAM0D,UAAU,GAAGhG,IAAI,CAACoF,MAAM,IAAItJ,iBAAiB;GACnD,MAAMmK,WAAW,GAAI,0BAAyBH,cAAU,CAACC,MAAM,CAAC/F,IAAI,CAACG,QAAQ,CAAE,GAAE;GAEjF,OAAO7C,aAAG,CAACC,MAAM,gBAAC;;eAEP,CAAc;;;eAGd,CAAQ,UAAO,CAAgC;;;kBAG5C,CAAQ;OACnB,CAAQ;;;GAGX,GAVa0I,WAAW,EAGX3D,KAAK,EAAUwD,cAAU,CAACC,MAAM,CAACC,UAAU,CAAC,EAGzC1D,KAAK,EAChBA,KAAK;CAIX;CAAC,mBAGD;GAAA;GACC,IAAI,CAAC5B,iBAAiB,EAAE;GACxB,CAAC,GAAG,4CAAI,kBAAQQ,MAAM,EAAE,CAAC,CAACmD,OAAO,CAAErE,IAAI,IAAKxC,aAAG,CAACsH,MAAM,CAAC9E,IAAI,CAAC3D,SAAS,CAAC,CAAC;GACvE,4CAAI,kBAAQ6J,KAAK,EAAE;GACnB,sEAAI,8DAAJ,uBAAyBL,MAAM,CAAC,4CAAI,kBAAQjF,IAAI,CAAC;CAClD;CAAC,mCAGD;GACC,OAAO,CAAC,CAAC;CACV;CAAC,+BAYoB8B,GAA8C,EACnE;GACC,MAAM;KAAEZ,EAAE;KAAE3B;IAAU,GAAGuC,GAAG;GAE5B,OAAQ,GAAEvC,QAAS,IAAG2B,EAAG,EAAC;CAC3B;;;;;;;;"}