{"version":3,"file":"user-selector.bundle.js","sources":["../src/index.js"],"sourcesContent":["import { EventEmitter } from 'main.core.events';\nimport { Dialog } from 'ui.entity-selector';\nimport type { UserSelectorOptions } from './type';\nimport { EntityType } from 'sign.type';\n\nexport const UserSelectorEvent = Object.freeze({\n\tonShow: 'onShow',\n\tonHide: 'onHide',\n\tonItemSelect: 'onItemSelect',\n\tonItemDeselect: 'onItemDeselect',\n});\n\nexport class UserSelector extends EventEmitter\n{\n\t#container: HTMLElement = null;\n\t#dialog: Dialog = null;\n\t#isRoleEnabled: boolean = false;\n\t#cacheable: boolean = true;\n\t#excludedEntityList: Array = [];\n\t#options: UserSelectorOptions;\n\t#preselectedEntityList: Array<Object> = [];\n\n\tconstructor(options: UserSelectorOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Sign.V2.B2e.UserSelector');\n\t\tthis.#options = options;\n\t\tthis.#isRoleEnabled = options.roleEnabled ?? false;\n\t\tthis.#excludedEntityList = options.excludedEntityList ?? [];\n\t\tthis.#cacheable = options.cacheable ?? true;\n\t\tthis.#dialog = this.#createDialog();\n\t}\n\n\t#createDialog(): Dialog\n\t{\n\t\tconst preselectedEntityList = this.#preselectedEntityList.length > 0\n\t\t\t? this.#preselectedEntityList.map((entity: Object) => [entity.type, entity.id])\n\t\t\t: this.#options.preselectedIds?.map((id) => [EntityType.USER, id]);\n\n\t\treturn new Dialog({\n\t\t\tcacheable: this.#cacheable,\n\t\t\twidth: 425,\n\t\t\theight: 363,\n\t\t\tmultiple: this.#options.multiple ?? true,\n\t\t\ttargetNode: this.#container,\n\t\t\tcontext: this.#options.context ?? 'sign_b2e_user_selector',\n\t\t\tentities: this.#getEntities(),\n\t\t\tdropdownMode: false,\n\t\t\tenableSearch: true,\n\t\t\tpreselectedItems: preselectedEntityList,\n\t\t\thideOnDeselect: true,\n\t\t\tevents: {\n\t\t\t\tonHide: (event) => this.emit(UserSelectorEvent.onHide, {\n\t\t\t\t\titems: this.#dialog.getSelectedItems(),\n\t\t\t\t}),\n\t\t\t\t'Item:onSelect': (event) => this.emit(UserSelectorEvent.onItemSelect, {\n\t\t\t\t\titems: this.#dialog.getSelectedItems(),\n\t\t\t\t}),\n\t\t\t\t'Item:onDeselect': (event) => this.emit(UserSelectorEvent.onItemSelect, {\n\t\t\t\t\titems: this.#dialog.getSelectedItems(),\n\t\t\t\t}),\n\t\t\t},\n\t\t});\n\t}\n\n\tsetExcludedEntityList(excludedEntityList: Array): void\n\t{\n\t\tthis.#excludedEntityList = excludedEntityList;\n\t}\n\n\tsetPreselectedEntityList(preselectedEntityList: Array<Object>): void\n\t{\n\t\tthis.#preselectedEntityList = preselectedEntityList;\n\t}\n\n\t#getEntities(): Array<Object>\n\t{\n\t\tconst entities = [\n\t\t\t{\n\t\t\t\tid: EntityType.USER,\n\t\t\t\toptions: {\n\t\t\t\t\tintranetUsersOnly: true,\n\t\t\t\t\t'!userId': this.#getExcludedIdListByEntityType(EntityType.USER),\n\t\t\t\t},\n\t\t\t\tdynamicLoad: true,\n\t\t\t},\n\t\t];\n\n\t\tif (this.#isRoleEnabled)\n\t\t{\n\t\t\tentities.push(\n\t\t\t\t{\n\t\t\t\t\tid: EntityType.STRUCTURE_NODE_ROLE,\n\t\t\t\t\toptions: {\n\t\t\t\t\t\texcludedRoleIdList: this.#getExcludedIdListByEntityType(EntityType.STRUCTURE_NODE_ROLE),\n\t\t\t\t\t},\n\t\t\t\t\tdynamicLoad: true,\n\t\t\t\t\tdynamicSearch: true,\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\n\t\treturn entities;\n\t}\n\n\t#getExcludedIdListByEntityType(entityType: string): number[]\n\t{\n\t\tconst excludedEntityList = this.#excludedEntityList.filter(\n\t\t\t(entity: Object): boolean => entity.entityType === entityType,\n\t\t);\n\n\t\treturn excludedEntityList.map((entity: Object): number => entity.entityId);\n\t}\n\n\ttoggle(): void\n\t{\n\t\tthis.getDialog().show();\n\t}\n\n\tgetDialog(): Dialog\n\t{\n\t\tif (this.#cacheable === false)\n\t\t{\n\t\t\tthis.#dialog = this.#createDialog();\n\t\t}\n\n\t\treturn this.#dialog;\n\t}\n}\n"],"names":["UserSelectorEvent","Object","freeze","onShow","onHide","onItemSelect","onItemDeselect","UserSelector","EventEmitter","constructor","options","setEventNamespace","roleEnabled","excludedEntityList","cacheable","setExcludedEntityList","setPreselectedEntityList","preselectedEntityList","toggle","getDialog","show","length","map","entity","type","id","preselectedIds","EntityType","USER","Dialog","width","height","multiple","targetNode","context","entities","dropdownMode","enableSearch","preselectedItems","hideOnDeselect","events","event","emit","items","getSelectedItems","intranetUsersOnly","dynamicLoad","push","STRUCTURE_NODE_ROLE","excludedRoleIdList","dynamicSearch","entityType","filter","entityId"],"mappings":"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"}