{"version":3,"file":"document-setup.bundle.js","sources":["../src/images/components/reupload-files-popup/icon.svg","../src/components/template/new-blank-for-template-popup-manager.js","../src/index.js"],"sourcesContent":["export default \"/bitrix/js/sign/v2/b2e/document-setup/dist/images/components/reupload-files-popup/icon.svg\"","import { Tag, Loc } from 'main.core';\nimport { MemoryCache } from 'main.core.cache';\nimport { EventEmitter } from 'main.core.events';\nimport { Popup } from 'main.popup';\nimport { Button } from 'ui.buttons';\n\nimport reuploadIcon from '../../images/components/reupload-files-popup/icon.svg';\n\ntype PopupTypesValue = 'upload' | 'select';\nconst popupTypes: Readonly<Record<string, PopupTypesValue>> = Object.freeze({\n\tupload: 'upload', select: 'select',\n});\n\nexport class NewBlankForTemplatePopupManager extends EventEmitter\n{\n\tstatic #instances: WeakMap<Object, NewBlankForTemplatePopupManager> = new WeakMap();\n\n\tevents = {\n\t\tuploadPopup: {\n\t\t\tonConfirm: 'onUploadFilePopupConfirm',\n\t\t\tonCancel: 'onUploadFilePopupCancel',\n\t\t},\n\t\tselectBlankPopup: {\n\t\t\tonConfirm: 'onSelectBlankPopupConfirm',\n\t\t\tonCancel: 'onSelectBlankPopupCancel',\n\t\t},\n\t};\n\n\t#isUploadPopupCompleted: boolean = false;\n\t#isSelectBlankPopupCompleted: boolean = false;\n\t#cache: MemoryCache<any> = new MemoryCache();\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Sign.B2e.DocumentSetup.ReuploadFilesPopup');\n\t}\n\n\tstatic getOrCreateForObject(object: Object): NewBlankForTemplatePopupManager\n\t{\n\t\tif (!NewBlankForTemplatePopupManager.#instances.has(object))\n\t\t{\n\t\t\tNewBlankForTemplatePopupManager.#instances.set(object, new NewBlankForTemplatePopupManager());\n\t\t}\n\n\t\treturn NewBlankForTemplatePopupManager.#instances.get(object);\n\t}\n\n\tshowSelectBlankPopup(): void\n\t{\n\t\tthis.#getSelectBlankPopup().show();\n\t}\n\n\tshowUploadPopup(): void\n\t{\n\t\tthis.#getUploadPopup().show();\n\t}\n\n\tisUploadPopupCompletedOnce(): boolean\n\t{\n\t\treturn this.#isUploadPopupCompleted;\n\t}\n\n\tisSelectBlankPopupCompletedOnce(): boolean\n\t{\n\t\treturn this.#isSelectBlankPopupCompleted;\n\t}\n\n\t#createPopupContent(popupType: PopupTypesValue): HTMLElement\n\t{\n\t\tconst message = popupType === 'upload'\n\t\t\t? Loc.getMessage('SIGN_V2_B2E_DOCUMENT_SETUP_COMPONENTS_POPUP_UPLOAD_DESCRIPTION')\n\t\t\t: Loc.getMessage('SIGN_V2_B2E_DOCUMENT_SETUP_COMPONENTS_POPUP_SELECT_DESCRIPTION');\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-b2e-document-setup__reupload__wrapper\">\n\t\t\t\t<div class=\"sign-b2e-document-setup__reupload__icon-container\">\n\t\t\t\t\t<img class=\"sign-b2e-document-setup__reupload__icon\" src=\"${reuploadIcon}\" alt=\"Icon\"/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"sign-b2e-document-setup__reupload__text\">\n\t\t\t\t\t<div class=\"sign-b2e-document-setup__reupload__title\">\n\t\t\t\t\t\t${Loc.getMessage('SIGN_V2_B2E_DOCUMENT_SETUP_COMPONENTS_POPUP_TITLE')}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"sign-b2e-document-setup__reupload__description\">\n\t\t\t\t\t\t${message}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#createSelectPopupButtons(): [Button, Button]\n\t{\n\t\tconst confirmButton = new Button({\n\t\t\ttext: Loc.getMessage('SIGN_V2_B2E_DOCUMENT_SETUP_COMPONENTS_POPUP_SELECT_CONFIRM'),\n\t\t\tcolor: Button.Color.PRIMARY,\n\t\t\tround: true,\n\t\t\tevents: {\n\t\t\t\tclick: () => {\n\t\t\t\t\tthis.#getSelectBlankPopup().close();\n\t\t\t\t\tthis.#isSelectBlankPopupCompleted = true;\n\t\t\t\t\tthis.emit(this.events.selectBlankPopup.onConfirm);\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tconst cancelButton = new Button({\n\t\t\ttext: Loc.getMessage('SIGN_V2_B2E_DOCUMENT_SETUP_COMPONENTS_POPUP_CANCEL'),\n\t\t\tcolor: Button.Color.LIGHT_BORDER,\n\t\t\tround: true,\n\t\t\tevents: {\n\t\t\t\tclick: () => {\n\t\t\t\t\tthis.#getSelectBlankPopup().close();\n\t\t\t\t\tthis.emit(this.events.selectBlankPopup.onCancel);\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\treturn [confirmButton, cancelButton];\n\t}\n\n\t#getSelectBlankPopup(): Popup\n\t{\n\t\treturn this.#cache.remember('selectBlankPopup', () => new Popup({\n\t\t\tdisableScroll: true,\n\t\t\tclassName: 'sign-b2e-document-setup__reupload__popup',\n\t\t\tcontent: this.#createPopupContent(popupTypes.select),\n\t\t\twidth: 386,\n\t\t\toverlay: true,\n\t\t\tcloseByEsc: false,\n\t\t\tbuttons: this.#createSelectPopupButtons(),\n\t\t}));\n\t}\n\n\t#createUploadPopupButtons(): [Button, Button]\n\t{\n\t\tconst confirmButton = new Button({\n\t\t\ttext: Loc.getMessage('SIGN_V2_B2E_DOCUMENT_SETUP_COMPONENTS_POPUP_UPLOAD_CONFIRM'),\n\t\t\tcolor: Button.Color.PRIMARY,\n\t\t\tround: true,\n\t\t\tcloseByEsc: false,\n\t\t\tevents: {\n\t\t\t\tclick: () => {\n\t\t\t\t\tthis.#getUploadPopup().close();\n\t\t\t\t\tthis.#isUploadPopupCompleted = true;\n\t\t\t\t\tthis.emit(this.events.uploadPopup.onConfirm);\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tconst cancelButton = new Button({\n\t\t\ttext: Loc.getMessage('SIGN_V2_B2E_DOCUMENT_SETUP_COMPONENTS_POPUP_CANCEL'),\n\t\t\tcolor: Button.Color.LIGHT_BORDER,\n\t\t\tround: true,\n\t\t\tevents: {\n\t\t\t\tclick: () => {\n\t\t\t\t\tthis.#getUploadPopup().close();\n\t\t\t\t\tthis.emit(this.events.uploadPopup.onCancel);\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\treturn [confirmButton, cancelButton];\n\t}\n\n\t#getUploadPopup(): Popup\n\t{\n\t\treturn this.#cache.remember('uploadPopup', () => new Popup({\n\t\t\tdisableScroll: true,\n\t\t\tclassName: 'sign-b2e-document-setup__reupload__popup',\n\t\t\tcontent: this.#createPopupContent(popupTypes.upload),\n\t\t\twidth: 386,\n\t\t\toverlay: true,\n\t\t\tbuttons: this.#createUploadPopupButtons(),\n\t\t}));\n\t}\n}\n","import { Dom, Event, Extension, Loc, Tag, Type } from 'main.core';\nimport { MemoryCache } from 'main.core.cache';\nimport { BaseEvent } from 'main.core.events';\nimport { Popup } from 'main.popup';\nimport { FeatureStorage } from 'sign.feature-storage';\nimport { DocumentInitiated, type DocumentInitiatedType } from 'sign.type';\nimport { Api } from 'sign.v2.api';\nimport { DocumentCounters } from 'sign.v2.b2e.document-counters';\nimport { SignDropdown } from 'sign.v2.b2e.sign-dropdown';\nimport { type BlankSelectorConfig, type ToggleEvent } from 'sign.v2.blank-selector';\nimport { type DocumentDetails, DocumentSetup as BaseDocumentSetup } from 'sign.v2.document-setup';\nimport { Helpdesk, Hint } from 'sign.v2.helper';\nimport { NewBlankForTemplatePopupManager } from './components/template/new-blank-for-template-popup-manager';\nimport 'sign.v2.ui.notice';\nimport './style.css';\n\nconst HelpdeskCodes = Object.freeze({\n\tHowToWorkWithTemplates: '23174934',\n});\n\nexport class DocumentSetup extends BaseDocumentSetup\n{\n\t#cache: MemoryCache<any> = new MemoryCache();\n\t#api: Api;\n\t#region: string;\n\t#senderDocumentTypes: DocumentInitiatedType[];\n\t#documentSenderTypeDropdown: HTMLElement;\n\t#documentTitleInput: HTMLInputElement;\n\theaderLayout: HTMLElement;\n\tdocumentCounters: DocumentCounters | null = null;\n\t#b2eDocumentLimitCount: number;\n\teditMode: boolean;\n\t#currentEditedId: number;\n\t#currentEditButton: HTMLElement;\n\t#currentEditBlock: HTMLElement;\n\t#isOpenedFromRobot: boolean = false;\n\t#isOpenedFromTemplateFolder: boolean = false;\n\t#isOpenedAsFolder: boolean = false;\n\tdocumentSectionLayout: HTMLElement;\n\tdocumentSectionInnerLayout: HTMLElement;\n\t#initiatedByType: DocumentInitiatedType;\n\n\tconstructor(blankSelectorConfig: BlankSelectorConfig)\n\t{\n\t\tsuper(blankSelectorConfig);\n\t\tconst {\n\t\t\tregion,\n\t\t\tb2eDocumentLimitCount,\n\t\t\tisOpenedFromRobot,\n\t\t\tisOpenedFromTemplateFolder,\n\t\t\tisOpenedAsFolder,\n\t\t\tinitiatedByType,\n\t\t} = blankSelectorConfig;\n\t\tthis.#api = new Api();\n\t\tthis.#region = region;\n\t\tthis.#b2eDocumentLimitCount = b2eDocumentLimitCount;\n\t\tthis.editMode = false;\n\t\tthis.onClickShowHintPopup = this.showHintPopup.bind(this);\n\t\tthis.#isOpenedFromRobot = isOpenedFromRobot;\n\t\tthis.#isOpenedFromTemplateFolder = isOpenedFromTemplateFolder;\n\t\tthis.#isOpenedAsFolder = isOpenedAsFolder;\n\t\tthis.#senderDocumentTypes = this.#getSenderDocumentTypes();\n\n\t\tthis.#documentTitleInput = Tag.render`\n\t\t\t<input\n\t\t\t\ttype=\"text\"\n\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\tmaxlength=\"255\"\n\t\t\t\toninput=\"${({ target }) => this.setDocumentTitle(target.value)}\"\n\t\t\t/>\n\t\t`;\n\t\tthis.#initiatedByType = initiatedByType;\n\n\t\tthis.#disableDocumentInputs();\n\t\tthis.disableAddButton();\n\n\t\tthis.#init();\n\t}\n\n\t#init(): void\n\t{\n\t\tthis.#initDocumentSenderType();\n\t\tconst title = this.isTemplateMode()\n\t\t\t? Loc.getMessage('SIGN_DOCUMENT_SETUP_TITLE_TEMPLATE_HEAD_LABEL')\n\t\t\t: Loc.getMessage('SIGN_DOCUMENT_SETUP_TITLE_HEAD_LABEL');\n\n\t\tconst titleLayout = Tag.render`\n\t\t\t<div class=\"sign-b2e-settings__item\">\n\t\t\t\t<p class=\"sign-b2e-settings__item_title\">\n\t\t\t\t\t${title}\n\t\t\t\t</p>\n\t\t\t\t${this.#getDocumentTitleLayout()}\n\t\t\t</div>\n\t\t`;\n\n\t\tDom.append(this.#getDocumentSenderTypeLayout(), this.layout);\n\t\tDom.append(titleLayout, this.layout);\n\n\t\tif (!this.isTemplateMode() && FeatureStorage.isGroupSendingEnabled())\n\t\t{\n\t\t\tthis.documentCounters = new DocumentCounters({\n\t\t\t\tdocumentCountersLimit: this.#b2eDocumentLimitCount,\n\t\t\t});\n\t\t\tDom.append(this.documentCounters.getLayout(), this.layout);\n\n\t\t\tconst addDocumentLayout = this.#getAddDocumentLayout();\n\t\t\tDom.append(addDocumentLayout, this.layout);\n\t\t}\n\t\tHint.create(this.layout);\n\n\t\tthis.#subscribeOnEvents();\n\t}\n\n\t#getSenderDocumentTypes(): DocumentInitiatedType[]\n\t{\n\t\tif (this.#isOpenedFromTemplateFolder || this.#isOpenedAsFolder)\n\t\t{\n\t\t\treturn [DocumentInitiated.company];\n\t\t}\n\n\t\treturn Object.values(DocumentInitiated);\n\t}\n\n\t#subscribeOnEvents(): void\n\t{\n\t\tconst blankSelector = this.blankSelector;\n\t\tblankSelector.subscribe(blankSelector.events.toggleSelection, this.#onBlankSelectorToggleSelection.bind(this));\n\t\tblankSelector.subscribe(blankSelector.events.addFile, this.#onBlankSelectorAddFile.bind(this));\n\t\tblankSelector.subscribe(\n\t\t\tblankSelector.events.beforeAddFileSuccessfully,\n\t\t\tthis.#onBlankSelectorBeforeAddFileSuccessfully.bind(this),\n\t\t);\n\t\tif (!this.isTemplateMode() && FeatureStorage.isGroupSendingEnabled())\n\t\t{\n\t\t\tthis.documentCounters.subscribe('limitNotExceeded', () => {\n\t\t\t\tthis.enableAddButton();\n\t\t\t\tthis.#setAddDocumentNoticeText();\n\t\t\t\tthis.emit('documentsLimitNotExceeded');\n\t\t\t});\n\t\t\tthis.documentCounters.subscribe('limitExceeded', () => {\n\t\t\t\tthis.disableAddButton();\n\t\t\t\tthis.#setDocumentLimitNoticeText();\n\t\t\t\tthis.emit('documentsLimitExceeded');\n\t\t\t});\n\t\t}\n\t}\n\n\t#onBlankSelectorAddFile(event: BaseEvent<{ title: string }>)\n\t{\n\t\tconst data = event.getData();\n\t\tthis.isFileAdded = true;\n\t\tthis.enableDocumentInputs();\n\t\tthis.enableAddButton();\n\t\tif (!this.isTemplateMode() || !this.isEditActionMode())\n\t\t{\n\t\t\tthis.setDocumentTitle(data.title);\n\t\t}\n\t\tconst popupManager = NewBlankForTemplatePopupManager.getOrCreateForObject(this);\n\t\t// Document title will update after popup confirmation\n\t\tif (popupManager.isUploadPopupCompletedOnce())\n\t\t{\n\t\t\tthis.setDocumentTitle(data.title);\n\t\t}\n\t}\n\n\t#onBlankSelectorToggleSelection(event: ToggleEvent): void\n\t{\n\t\tif (this.blankIsNotSelected && this.editMode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst data = event.getData();\n\n\t\tconst handleEvent = () => {\n\t\t\tthis.setDocumentTitle(data.title);\n\n\t\t\tif (data.selected)\n\t\t\t{\n\t\t\t\tthis.enableDocumentInputs();\n\t\t\t\tthis.enableAddButton();\n\t\t\t}\n\t\t};\n\n\t\tif (!this.isEditActionMode() || !this.isTemplateMode())\n\t\t{\n\t\t\thandleEvent();\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst popupManager = NewBlankForTemplatePopupManager.getOrCreateForObject(this);\n\t\tif (popupManager.isSelectBlankPopupCompletedOnce())\n\t\t{\n\t\t\thandleEvent();\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst extra = data.extra;\n\t\tif (!data.selected || extra?.isInitial || extra?.skipSelectPopupShow)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst previousSelectedBlankId = data.previousSelectedBlankId;\n\n\t\tpopupManager.showSelectBlankPopup();\n\t\tpopupManager.subscribeOnce(popupManager.events.selectBlankPopup.onConfirm, handleEvent);\n\t\tpopupManager.subscribeOnce(\n\t\t\tpopupManager.events.selectBlankPopup.onCancel,\n\t\t\t() => {\n\t\t\t\tpopupManager.unsubscribe(\n\t\t\t\t\tpopupManager.events.selectBlankPopup.onConfirm,\n\t\t\t\t\thandleEvent,\n\t\t\t\t);\n\t\t\t\tif (Type.isNumber(previousSelectedBlankId) && previousSelectedBlankId > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.blankSelector.selectBlank(previousSelectedBlankId, { skipSelectPopupShow: true });\n\t\t\t\t}\n\t\t\t},\n\t\t);\n\t}\n\n\t#onBlankSelectorBeforeAddFileSuccessfully(event: BaseEvent): void\n\t{\n\t\tif (!this.isTemplateMode() || !this.isEditActionMode())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst newBlankPopupManager = NewBlankForTemplatePopupManager.getOrCreateForObject(this);\n\t\tconst lastSelectedBlank = this.blankSelector.selectedBlankId;\n\n\t\tif (newBlankPopupManager.isUploadPopupCompletedOnce())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tnewBlankPopupManager.showUploadPopup();\n\t\tconst onCancelListener = () => {\n\t\t\tthis.blankSelector.clearFiles();\n\t\t\tthis.blankSelector.selectBlank(lastSelectedBlank, { skipSelectPopupShow: true });\n\t\t};\n\n\t\tconst onConfirmListener = () => {\n\t\t\tthis.blankSelector.getBlank();\n\t\t\tconst title = this.blankSelector.getUploadedFileName(0);\n\t\t\tif (Type.isStringFilled(title))\n\t\t\t{\n\t\t\t\tthis.setDocumentTitle(title);\n\t\t\t}\n\t\t};\n\n\t\tconst unsubscribeAnotherListenerDecorator = (\n\t\t\tlistener: (event?: BaseEvent) => any,\n\t\t\tunsubscribedListener: (event?: BaseEvent) => any,\n\t\t) => {\n\t\t\treturn (event: BaseEvent) => {\n\t\t\t\tlistener(event);\n\t\t\t\tnewBlankPopupManager.unsubscribe(\n\t\t\t\t\tnewBlankPopupManager.events.uploadPopup.onCancel,\n\t\t\t\t\tunsubscribedListener,\n\t\t\t\t);\n\t\t\t\tnewBlankPopupManager.unsubscribe(\n\t\t\t\t\tnewBlankPopupManager.events.uploadPopup.onConfirm,\n\t\t\t\t\tunsubscribedListener,\n\t\t\t\t);\n\t\t\t};\n\t\t};\n\t\tnewBlankPopupManager.subscribeOnce(\n\t\t\tnewBlankPopupManager.events.uploadPopup.onCancel,\n\t\t\tunsubscribeAnotherListenerDecorator(onCancelListener, onConfirmListener),\n\t\t);\n\t\tnewBlankPopupManager.subscribeOnce(\n\t\t\tnewBlankPopupManager.events.uploadPopup.onConfirm,\n\t\t\tunsubscribeAnotherListenerDecorator(onConfirmListener, onCancelListener),\n\t\t);\n\t}\n\n\tisRuRegion(): boolean\n\t{\n\t\treturn this.#region === 'ru';\n\t}\n\n\t#initDocumentSenderType(): void\n\t{\n\t\tif (!this.isTemplateMode() || !this.isSenderTypeAvailable())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#documentSenderTypeDropdown = new SignDropdown({\n\t\t\ttabs: [{ id: 'b2e-document-sender-types', title: ' ' }],\n\t\t\tentities: [\n\t\t\t\t{ id: 'b2e-document-sender-type', searchFields: [{ name: 'caption', system: true }] },\n\t\t\t],\n\t\t\tclassName: 'sign-b2e-document-setup__sender-type-selector',\n\t\t\twithCaption: true,\n\t\t\tisEnableSearch: false,\n\t\t\theight: 110,\n\t\t\twidth: 350,\n\t\t});\n\t\tthis.#senderDocumentTypes.forEach((item) => {\n\t\t\tif (Type.isStringFilled(item))\n\t\t\t{\n\t\t\t\tconst langPhraseCode = `SIGN_DOCUMENT_SETUP_SENDER_TYPE_${item.toUpperCase()}`;\n\t\t\t\tthis.#documentSenderTypeDropdown.addItem({\n\t\t\t\t\tid: item,\n\t\t\t\t\ttitle: Loc.getMessage(langPhraseCode),\n\t\t\t\t\tentityId: 'b2e-document-sender-type',\n\t\t\t\t\ttabs: 'b2e-document-sender-types',\n\t\t\t\t\tdeselectable: false,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tconst selectedKey = this.#isOpenedFromRobot ? 1 : 0;\n\t\tconst selectedItem = this.#senderDocumentTypes[selectedKey] ?? null;\n\t\tif (selectedItem)\n\t\t{\n\t\t\tthis.#documentSenderTypeDropdown.selectItem(selectedItem);\n\t\t}\n\t}\n\n\t#getDocumentSenderTypeLayout(): HTMLElement | null\n\t{\n\t\tif (this.#shouldHideSenderTypeLayout())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-b2e-settings__item\">\n\t\t\t\t<p class=\"sign-b2e-settings__item_title\">\n\t\t\t\t\t<span>${Loc.getMessage('SIGN_DOCUMENT_SETUP_SENDER_TYPE_TITLE')}</span>\n\t\t\t\t</p>\n\t\t\t\t${this.#documentSenderTypeDropdown.getLayout()}\n\t\t\t\t${this.#getHelpLink()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#shouldHideSenderTypeLayout(): boolean\n\t{\n\t\treturn (\n\t\t\t!this.isTemplateMode()\n\t\t\t|| !this.isSenderTypeAvailable()\n\t\t\t|| this.#isOpenedFromRobot\n\t\t\t|| this.#isOpenedFromTemplateFolder\n\t\t\t|| this.#isOpenedAsFolder\n\t\t);\n\t}\n\n\t#getHelpLink(): HTMLElement\n\t{\n\t\treturn Helpdesk.replaceLink(\n\t\t\tLoc.getMessage('SIGN_DOCUMENT_SETUP_SENDER_TYPE_HELP_LINK'),\n\t\t\tHelpdeskCodes.HowToWorkWithTemplates,\n\t\t\t'detail',\n\t\t\t['ui-link'],\n\t\t);\n\t}\n\n\t#getDocumentTitleLayout(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div>\n\t\t\t\t<div class=\"sign-b2e-document-setup__title-item --full\">\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox\">\n\t\t\t\t\t\t${this.#documentTitleInput}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t${this.#getDocumentHintLayout()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getAddDocumentLayout(): HTMLElement\n\t{\n\t\treturn this.#cache.remember('addDocumentLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-b2e-settings__item --add\">\n\t\t\t\t\t<div class=\"sign-b2e-settings__item_title\">\n\t\t\t\t\t\t<span>${Loc.getMessage('SIGN_DOCUMENT_SETUP_ADD_DOCUMENT')}</span>\n\t\t\t\t\t\t${this.documentCounters.getLayout()}\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.getAddDocumentButton()}\n\t\t\t\t\t${this.getAddDocumentNotice()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetAddDocumentButton(): HTMLElement\n\t{\n\t\treturn this.#cache.remember('addDocumentButton', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<button type=\"button\" class=\"sign-b2e-document-setup__add-button\" onclick=\"${this.#onClickAddDocument.bind(this)}\">\n\t\t\t\t\t${this.#getAddDocumentButtonText()}\n\t\t\t\t</button>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetAddDocumentNotice(): HTMLElement\n\t{\n\t\treturn this.#cache.remember('addDocumentNotice', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<p class=\"sign-wizard__notice\">${Loc.getMessage('SIGN_DOCUMENT_SETUP_ADD_DOCUMENT_NOTICE')}</p>\n\t\t\t`;\n\t\t});\n\t}\n\n\t#getAddDocumentButtonText(): HTMLElement\n\t{\n\t\treturn this.#cache.remember('addDocumentButtonText', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<span class=\"sign-b2e-document-setup__add-button_text\">${Loc.getMessage('SIGN_DOCUMENT_SETUP_ADD_ANOTHER_DOCUMENT')}</span>\n\t\t\t`;\n\t\t});\n\t}\n\n\tswitchAddDocumentButtonLoadingState(loading: boolean): void\n\t{\n\t\tif (loading)\n\t\t{\n\t\t\tDom.addClass(this.getAddDocumentButton(), 'ui-btn-wait');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.removeClass(this.getAddDocumentButton(), 'ui-btn-wait');\n\t\t}\n\t}\n\n\tdisableAddButton(): void\n\t{\n\t\tDom.addClass(this.getAddDocumentButton(), '--disabled');\n\t}\n\n\tenableAddButton(): void\n\t{\n\t\tDom.removeClass(this.getAddDocumentButton(), '--disabled');\n\t}\n\n\t#setDocumentLimitNoticeText(): void\n\t{\n\t\tDom.addClass(this.getAddDocumentNotice(), '--warning');\n\t\tthis.getAddDocumentNotice().textContent = Loc.getMessage(\n\t\t\t'SIGN_DOCUMENT_SETUP_DOCUMENT_GROUP_LIMIT_NOTICE',\n\t\t\t{ '%limit%': this.#b2eDocumentLimitCount },\n\t\t);\n\t}\n\n\t#setAddDocumentNoticeText(): void\n\t{\n\t\tDom.removeClass(this.getAddDocumentNotice(), '--warning');\n\t\tthis.getAddDocumentNotice().textContent = Loc.getMessage('SIGN_DOCUMENT_SETUP_ADD_DOCUMENT_NOTICE');\n\t}\n\n\ttoggleDeleteBtnLoadingState(deleteButton: HTMLElement): void\n\t{\n\t\tDom.toggleClass(deleteButton, 'ui-btn-wait');\n\t}\n\n\t#onClickAddDocument(): void\n\t{\n\t\tthis.emit('addDocument');\n\t}\n\n\trenderDocumentBlock(documentData: Object): void\n\t{\n\t\tif (!documentData)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.append(this.#createDocumentBlock(documentData), this.headerLayout);\n\t}\n\n\t#createDocumentBlock(documentData: Object): HTMLElement\n\t{\n\t\tconst deleteButton = Tag.render`\n\t\t\t<button class=\"sign-b2e-document-setup__document-block_delete\" type=\"button\"></button>\n\t\t`;\n\t\tconst editButton = Tag.render`\n\t\t\t<button class=\"ui-btn ui-btn-round ui-btn-sm ui-btn-light-border\" type=\"button\">\n\t\t\t\t${Loc.getMessage('SIGN_DOCUMENT_SETUP_DOCUMENT_EDIT_BUTTON')}\n\t\t\t</button>\n\t\t`;\n\n\t\tEvent.bind(deleteButton, 'click', (event) => {\n\t\t\tthis.#onClickDeleteDocument(documentData, event);\n\t\t});\n\t\tEvent.bind(editButton, 'click', (event) => {\n\t\t\tthis.#onClickEditDocument(documentData, event);\n\t\t});\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-b2e-document-setup__document-block\" data-id=\"document-id-${documentData.id}\">\n\t\t\t\t<div class=\"sign-b2e-document-setup__document-block_inner\">\n\t\t\t\t\t<div class=\"sign-b2e-document-setup__document-block_title\">${documentData.title}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"sign-b2e-document-setup__document-block_btn\">\n\t\t\t\t\t${editButton}\n\t\t\t\t\t${deleteButton}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"sign-b2e-document-setup__document-block_hint\">\n\t\t\t\t\t${Loc.getMessage('SIGN_DOCUMENT_SETUP_ADD_DOCUMENT_HINT')}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tupdateDocumentBlock(id: number): void\n\t{\n\t\tconst editedBlock = this.layout.querySelector(`[data-id=\"document-id-${id}\"]`);\n\t\tconst titleNode = editedBlock.querySelector('.sign-b2e-document-setup__document-block_title');\n\t\ttitleNode.textContent = this.#documentTitleInput.title;\n\t}\n\n\treplaceDocumentBlock(oldDocument, newDocument): void\n\t{\n\t\tconst editedBlock = this.layout.querySelector(`[data-id=\"document-id-${oldDocument.id}\"]`);\n\t\tDom.replace(editedBlock, this.#createDocumentBlock(newDocument));\n\t}\n\n\t#getDocumentHintLayout(): HTMLElement | null\n\t{\n\t\tif (this.isTemplateMode())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn this.#cache.remember('documentHintLayout', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<p class=\"sign-b2e-document-setup__title-text\">\n\t\t\t\t\t${Loc.getMessage('SIGN_DOCUMENT_SETUP_TITLE_HINT')}\n\t\t\t\t</p>\n\t\t\t`;\n\t\t});\n\t}\n\n\t#onClickDeleteDocument(documentData: DocumentDetails, event: PointerEvent): void\n\t{\n\t\tthis.setupData = null;\n\t\tconst { id, uid, blankId } = documentData;\n\t\tconst deleteButton = event.target;\n\t\tthis.toggleDeleteBtnLoadingState(deleteButton);\n\t\tthis.emit('deleteDocument', { id, uid, blankId, deleteButton });\n\t}\n\n\t#onClickEditDocument(documentData: DocumentDetails, event: PointerEvent): void\n\t{\n\t\tconst { id, uid } = documentData;\n\t\tthis.toggleEditMode(id, event.target);\n\t\tthis.emit('editDocument', { uid });\n\t}\n\n\ttoggleEditMode(id: number, editButton: HTMLElement): void\n\t{\n\t\tif (this.#currentEditedId !== id)\n\t\t{\n\t\t\tthis.resetEditMode();\n\t\t}\n\n\t\tconst documentBlock = editButton.closest(`[data-id=\"document-id-${id}\"]`);\n\t\tDom.toggleClass(documentBlock, '--edit');\n\n\t\tif (this.editMode)\n\t\t{\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\teditButton.textContent = Loc.getMessage('SIGN_DOCUMENT_SETUP_DOCUMENT_EDIT_BUTTON');\n\t\t\tthis.#disableDocumentInputs();\n\t\t\tthis.disableAddButton();\n\t\t\tthis.editMode = false;\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\teditButton.textContent = Loc.getMessage('SIGN_DOCUMENT_SETUP_DOCUMENT_CANCEL_BUTTON');\n\t\t\tthis.editMode = true;\n\t\t\tthis.enableDocumentInputs();\n\t\t\tthis.enableAddButton();\n\t\t\tthis.#currentEditedId = id;\n\t\t\tthis.#currentEditButton = editButton;\n\t\t\tthis.#currentEditBlock = documentBlock;\n\t\t}\n\t}\n\n\tresetEditMode(): void\n\t{\n\t\tif (!this.#currentEditedId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#currentEditButton.textContent = Loc.getMessage('SIGN_DOCUMENT_SETUP_DOCUMENT_EDIT_BUTTON');\n\t\tDom.removeClass(this.#currentEditBlock, '--edit');\n\t\tthis.editMode = false;\n\n\t\tthis.#currentEditButton = null;\n\t\tthis.#currentEditBlock = null;\n\t\tthis.#currentEditedId = null;\n\t}\n\n\tgetHeaderLayout(): HTMLElement\n\t{\n\t\tconst headerText = this.isTemplateMode()\n\t\t\t? Loc.getMessage('SIGN_DOCUMENT_SETUP_TEMPLATE_HEADER')\n\t\t\t: Loc.getMessage('SIGN_DOCUMENT_SETUP_HEADER')\n\t\t;\n\n\t\tthis.headerLayout = Tag.render`\n\t\t\t<h1 class=\"sign-b2e-settings__header\">${headerText}</h1>\n\t\t`;\n\n\t\treturn this.headerLayout;\n\t}\n\n\t#sendDocumentSenderType(uid: string): Promise<void>\n\t{\n\t\tif (!this.isTemplateMode() || !this.isSenderTypeAvailable())\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst senderType = this.#getDocumentSenderType();\n\t\tthis.setupData.initiatedByType = senderType;\n\n\t\treturn this.#api.changeSenderDocumentType(uid, senderType);\n\t}\n\n\t#getDocumentSenderType(): ?DocumentInitiatedType\n\t{\n\t\tif (!this.isTemplateMode())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tif (!this.isSenderTypeAvailable())\n\t\t{\n\t\t\treturn this.#initiatedByType;\n\t\t}\n\n\t\treturn this.#documentSenderTypeDropdown.getSelectedId();\n\t}\n\n\tsetDocumentTitle(title: string = ''): void\n\t{\n\t\tthis.#documentTitleInput.value = title;\n\t\tthis.#documentTitleInput.title = title;\n\t}\n\n\tsetDocumentSenderType(initiatedByType: string): void\n\t{\n\t\tif (!this.isTemplateMode() || !this.isSenderTypeAvailable())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst senderType = this.#senderDocumentTypes.includes(initiatedByType) ? initiatedByType : 'employee';\n\t\tthis.#documentSenderTypeDropdown.selectItem(senderType);\n\t}\n\n\tinitLayout(): void\n\t{\n\t\tthis.layout = Tag.render`\n\t\t\t<div class=\"sign-document-setup\">\n\t\t\t\t${this.getHeaderLayout()}\n\t\t\t\t${this.getDocumentSectionLayout()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetDocumentSectionLayout(): HTMLElement\n\t{\n\t\tif (!this.documentSectionLayout)\n\t\t{\n\t\t\tthis.documentSectionLayout = Tag.render`\n\t\t\t\t<div class=\"sign-b2e-settings__item\">\n\t\t\t\t\t${this.getDocumentSectionInnerLayout()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\tthis.createHintPopup();\n\t\t}\n\n\t\treturn this.documentSectionLayout;\n\t}\n\n\tgetDocumentSectionInnerLayout(): HTMLElement\n\t{\n\t\tconst itemTitleText = this.isTemplateMode()\n\t\t\t? Loc.getMessage('SIGN_DOCUMENT_SETUP_ADD_TEMPLATE_TITLE')\n\t\t\t: Loc.getMessage('SIGN_DOCUMENT_SETUP_ADD_TITLE')\n\t\t;\n\n\t\tthis.documentSectionInnerLayout = Tag.render`\n\t\t\t<div class=\"sign-b2e-settings__item-inner\">\n\t\t\t\t<p class=\"sign-b2e-settings__item_title\">\n\t\t\t\t\t${itemTitleText}\n\t\t\t\t</p>\n\t\t\t\t${this.blankSelector.getLayout()}\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.documentSectionInnerLayout;\n\t}\n\n\tcreateHintPopup(): void\n\t{\n\t\tthis.hintPopup = new Popup({\n\t\t\tcontent: Loc.getMessage('SIGN_DOCUMENT_SETUP_DOCUMENT_LIMIT_POPUP'),\n\t\t\tautoHide: true,\n\t\t\tdarkMode: true,\n\t\t});\n\t}\n\n\tsetAvailabilityDocumentSection(isAvailable: boolean): void\n\t{\n\t\tif (isAvailable)\n\t\t{\n\t\t\tDom.removeClass(this.documentSectionInnerLayout, '--disabled');\n\t\t\tEvent.unbind(this.documentSectionLayout, 'click', this.onClickShowHintPopup);\n\t\t\tthis.hintPopup.close();\n\n\t\t\treturn;\n\t\t}\n\n\t\tDom.addClass(this.documentSectionInnerLayout, '--disabled');\n\t\tEvent.bind(this.documentSectionLayout, 'click', this.onClickShowHintPopup);\n\t}\n\n\tshowHintPopup(event): void\n\t{\n\t\tthis.hintPopup.setBindElement(event);\n\t\tthis.hintPopup.show();\n\t}\n\n\tasync setup(uid: ?string): Promise<void>\n\t{\n\t\ttry\n\t\t{\n\t\t\tconst copyBlocksFromPreviousBlank = this.isEditActionMode()\n\t\t\t\t&& this.isTemplateMode()\n\t\t\t\t&& this.blankSelector.isFilesReadyForUpload();\n\n\t\t\tawait super.setup(\n\t\t\t\tuid,\n\t\t\t\tthis.isTemplateMode(),\n\t\t\t\tcopyBlocksFromPreviousBlank,\n\t\t\t\tthis.#getDocumentSenderType(),\n\t\t\t);\n\t\t\tif (!this.setupData || this.blankIsNotSelected)\n\t\t\t{\n\t\t\t\tthis.ready = true;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (uid)\n\t\t\t{\n\t\t\t\tconst { title, initiatedByType } = this.setupData;\n\t\t\t\tthis.setDocumentTitle(title);\n\t\t\t\tthis.setDocumentSenderType(initiatedByType);\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.ready = false;\n\n\t\t\tthis.setupData = await this.updateDocumentData(this.setupData);\n\t\t}\n\t\tcatch\n\t\t{\n\t\t\tconst { blankId } = this.setupData;\n\t\t\tthis.handleError(blankId);\n\t\t}\n\n\t\tthis.ready = true;\n\t}\n\n\tasync updateDocumentData(documentData: DocumentDetails): Promise<DocumentDetails | undefined>\n\t{\n\t\tif (!documentData)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tawait Promise.all([\n\t\t\tthis.#sendDocumentSenderType(documentData.uid),\n\t\t]);\n\n\t\tconst { value: title } = this.#documentTitleInput;\n\t\tconst { templateUid } = this.setupData;\n\t\tconst modifyDocumentTitleResponse = await this.#api.modifyTitle(documentData.uid, title);\n\t\tconst { blankTitle } = modifyDocumentTitleResponse;\n\t\tif (blankTitle)\n\t\t{\n\t\t\tconst { blankId } = documentData;\n\t\t\tthis.blankSelector.modifyBlankTitle(blankId, blankTitle);\n\t\t}\n\n\t\treturn { ...documentData, title, templateUid };\n\t}\n\n\t#validateInput(input: HTMLElement): boolean\n\t{\n\t\tif (!input)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tconst { parentNode, value } = input;\n\t\tif (value.trim() !== '')\n\t\t{\n\t\t\tDom.removeClass(parentNode, 'ui-ctl-warning');\n\n\t\t\treturn true;\n\t\t}\n\n\t\tDom.addClass(parentNode, 'ui-ctl-warning');\n\t\tinput.focus();\n\n\t\treturn false;\n\t}\n\n\tvalidate(): boolean\n\t{\n\t\treturn this.#validateInput(this.#documentTitleInput);\n\t}\n\n\tisSenderTypeAvailable(): boolean\n\t{\n\t\tconst settings = Extension.getSettings('sign.v2.b2e.document-setup');\n\n\t\treturn settings.get('isSenderTypeAvailable');\n\t}\n\n\tresetDocument(): void\n\t{\n\t\tthis.blankSelector.resetSelectedBlank();\n\t\tthis.setDocumentTitle('');\n\n\t\tthis.isFileAdded = false;\n\t\tthis.#disableDocumentInputs();\n\t\tthis.disableAddButton();\n\t}\n\n\tenableDocumentInputs(): void\n\t{\n\t\tthis.#documentTitleInput.disabled = false;\n\t\tthis.blankIsNotSelected = false;\n\t}\n\n\t#disableDocumentInputs(): void\n\t{\n\t\tthis.#documentTitleInput.disabled = true;\n\t\tthis.blankIsNotSelected = true;\n\t}\n}\n"],"names":["popupTypes","Object","freeze","upload","select","NewBlankForTemplatePopupManager","EventEmitter","constructor","events","uploadPopup","onConfirm","onCancel","selectBlankPopup","MemoryCache","setEventNamespace","getOrCreateForObject","object","has","set","get","showSelectBlankPopup","show","showUploadPopup","isUploadPopupCompletedOnce","isSelectBlankPopupCompletedOnce","popupType","message","Loc","getMessage","Tag","render","reuploadIcon","confirmButton","Button","text","color","Color","PRIMARY","round","click","close","emit","cancelButton","LIGHT_BORDER","remember","Popup","disableScroll","className","content","width","overlay","closeByEsc","buttons","WeakMap","HelpdeskCodes","HowToWorkWithTemplates","DocumentSetup","BaseDocumentSetup","blankSelectorConfig","documentCounters","region","b2eDocumentLimitCount","isOpenedFromRobot","isOpenedFromTemplateFolder","isOpenedAsFolder","initiatedByType","Api","editMode","onClickShowHintPopup","showHintPopup","bind","target","setDocumentTitle","value","disableAddButton","isRuRegion","getAddDocumentButton","getAddDocumentNotice","switchAddDocumentButtonLoadingState","loading","Dom","addClass","removeClass","enableAddButton","toggleDeleteBtnLoadingState","deleteButton","toggleClass","renderDocumentBlock","documentData","append","headerLayout","updateDocumentBlock","id","editedBlock","layout","querySelector","titleNode","textContent","title","replaceDocumentBlock","oldDocument","newDocument","replace","toggleEditMode","editButton","resetEditMode","documentBlock","closest","enableDocumentInputs","getHeaderLayout","headerText","isTemplateMode","setDocumentSenderType","isSenderTypeAvailable","senderType","includes","selectItem","initLayout","getDocumentSectionLayout","documentSectionLayout","getDocumentSectionInnerLayout","createHintPopup","itemTitleText","documentSectionInnerLayout","blankSelector","getLayout","hintPopup","autoHide","darkMode","setAvailabilityDocumentSection","isAvailable","Event","unbind","event","setBindElement","setup","uid","copyBlocksFromPreviousBlank","isEditActionMode","isFilesReadyForUpload","setupData","blankIsNotSelected","ready","updateDocumentData","blankId","handleError","Promise","all","templateUid","modifyDocumentTitleResponse","modifyTitle","blankTitle","modifyBlankTitle","validate","settings","Extension","getSettings","resetDocument","resetSelectedBlank","isFileAdded","disabled","titleLayout","FeatureStorage","isGroupSendingEnabled","DocumentCounters","documentCountersLimit","addDocumentLayout","Hint","create","DocumentInitiated","company","values","subscribe","toggleSelection","addFile","beforeAddFileSuccessfully","data","getData","popupManager","handleEvent","selected","extra","isInitial","skipSelectPopupShow","previousSelectedBlankId","subscribeOnce","unsubscribe","Type","isNumber","selectBlank","newBlankPopupManager","lastSelectedBlank","selectedBlankId","onCancelListener","clearFiles","onConfirmListener","getBlank","getUploadedFileName","isStringFilled","unsubscribeAnotherListenerDecorator","listener","unsubscribedListener","SignDropdown","tabs","entities","searchFields","name","system","withCaption","isEnableSearch","height","forEach","item","langPhraseCode","toUpperCase","addItem","entityId","deselectable","selectedKey","selectedItem","Helpdesk","replaceLink","resolve","changeSenderDocumentType","getSelectedId","input","parentNode","trim","focus"],"mappings":"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"}