this.BX=this.BX||{};this.BX.Sign=this.BX.Sign||{};this.BX.Sign.V2=this.BX.Sign.V2||{};(function(e,s,t,a,i,l,r,o,n){"use strict";let b=e=>e,c,d,v,p,u,h,P,L;const H=Object.freeze({view:"view",edit:"edit"});const F="/bitrix/js/sign/v2/b2e/user-party/images/user.svg";const y="/bitrix/js/sign/v2/b2e/user-party/images/department.svg";const m=Object.freeze({SignEdmWithEmployees:"19740792"});var B=babelHelpers.classPrivateFieldLooseKey("api");var g=babelHelpers.classPrivateFieldLooseKey("ui");var f=babelHelpers.classPrivateFieldLooseKey("items");var _=babelHelpers.classPrivateFieldLooseKey("preselectedUserData");var w=babelHelpers.classPrivateFieldLooseKey("userCount");var T=babelHelpers.classPrivateFieldLooseKey("viewMode");var S=babelHelpers.classPrivateFieldLooseKey("tagSelector");var C=babelHelpers.classPrivateFieldLooseKey("loader");var O=babelHelpers.classPrivateFieldLooseKey("userPartyCounters");var D=babelHelpers.classPrivateFieldLooseKey("documentUid");var I=babelHelpers.classPrivateFieldLooseKey("userPartyPopup");var E=babelHelpers.classPrivateFieldLooseKey("counterDelayTimeout");var M=babelHelpers.classPrivateFieldLooseKey("role");var j=babelHelpers.classPrivateFieldLooseKey("init");var K=babelHelpers.classPrivateFieldLooseKey("createUserPartyPopup");var U=babelHelpers.classPrivateFieldLooseKey("displayShowMoreBtn");var R=babelHelpers.classPrivateFieldLooseKey("loadPreselectedUsersData");var $=babelHelpers.classPrivateFieldLooseKey("showLoader");var X=babelHelpers.classPrivateFieldLooseKey("hideLoader");var x=babelHelpers.classPrivateFieldLooseKey("getLoader");var N=babelHelpers.classPrivateFieldLooseKey("removeItem");var A=babelHelpers.classPrivateFieldLooseKey("addItem");var V=babelHelpers.classPrivateFieldLooseKey("updateEditModeCounter");var G=babelHelpers.classPrivateFieldLooseKey("updateCounterWithDelay");var Y=babelHelpers.classPrivateFieldLooseKey("createItemLayout");var W=babelHelpers.classPrivateFieldLooseKey("createDepartmentItemLayout");var q=babelHelpers.classPrivateFieldLooseKey("createDocumentItemLayout");var z=babelHelpers.classPrivateFieldLooseKey("createUserItemLayout");var k=babelHelpers.classPrivateFieldLooseKey("clean");var J=babelHelpers.classPrivateFieldLooseKey("getViewModeItemsCount");var Q=babelHelpers.classPrivateFieldLooseKey("makeItemMapKeyByTag");class Z{constructor(e){var s;Object.defineProperty(this,Q,{value:Le});Object.defineProperty(this,J,{value:Pe});Object.defineProperty(this,k,{value:he});Object.defineProperty(this,z,{value:ue});Object.defineProperty(this,q,{value:pe});Object.defineProperty(this,W,{value:ve});Object.defineProperty(this,Y,{value:de});Object.defineProperty(this,G,{value:ce});Object.defineProperty(this,V,{value:be});Object.defineProperty(this,A,{value:ne});Object.defineProperty(this,N,{value:oe});Object.defineProperty(this,x,{value:re});Object.defineProperty(this,X,{value:le});Object.defineProperty(this,$,{value:ie});Object.defineProperty(this,R,{value:ae});Object.defineProperty(this,U,{value:te});Object.defineProperty(this,K,{value:se});Object.defineProperty(this,j,{value:ee});Object.defineProperty(this,B,{writable:true,value:void 0});Object.defineProperty(this,g,{writable:true,value:{container:HTMLDivElement=null,itemContainer:HTMLDivElement=null,header:HTMLSpanElement=null,description:HTMLParagraphElement=null,userPartyCounterContainer:HTMLDivElement=null,showMoreSignersContainer:HTMLDivElement=null}});Object.defineProperty(this,f,{writable:true,value:new Map});Object.defineProperty(this,_,{writable:true,value:[]});Object.defineProperty(this,w,{writable:true,value:0});Object.defineProperty(this,T,{writable:true,value:H.edit});Object.defineProperty(this,S,{writable:true,value:null});Object.defineProperty(this,C,{writable:true,value:null});Object.defineProperty(this,O,{writable:true,value:null});Object.defineProperty(this,D,{writable:true,value:null});Object.defineProperty(this,I,{writable:true,value:null});Object.defineProperty(this,E,{writable:true,value:null});Object.defineProperty(this,M,{writable:true,value:n.MemberRole.signer});babelHelpers.classPrivateFieldLooseBase(this,B)[B]=new r.Api;babelHelpers.classPrivateFieldLooseBase(this,T)[T]=e.mode;babelHelpers.classPrivateFieldLooseBase(this,M)[M]=(s=e.role)!=null?s:n.MemberRole.signer;babelHelpers.classPrivateFieldLooseBase(this,j)[j](e)}getLayout(e){if(babelHelpers.classPrivateFieldLooseBase(this,g)[g].container){return babelHelpers.classPrivateFieldLooseBase(this,g)[g].container}babelHelpers.classPrivateFieldLooseBase(this,g)[g].itemContainer=s.Tag.render(c||(c=b`
			<div class="sign-document-b2e-user-party__item-list"></div>
		`));if(babelHelpers.classPrivateFieldLooseBase(this,T)[T]!==H.edit){s.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,g)[g].itemContainer,"--view");const e=s.Tag.render(d||(d=b`
				<a href="#">${0}</a>
			`),s.Loc.getMessage("SIGN_USER_PARTY_VIEW_SHOW_MORE",{"#EMPLOYEE_COUNT#":'<span class="--count-placeholder">\u2026</span>'}));babelHelpers.classPrivateFieldLooseBase(this,I)[I]=babelHelpers.classPrivateFieldLooseBase(this,K)[K](e);s.Event.bind(e,"click",(e=>{babelHelpers.classPrivateFieldLooseBase(this,I)[I].setDocumentUid(babelHelpers.classPrivateFieldLooseBase(this,D)[D]).show();e.preventDefault()}));babelHelpers.classPrivateFieldLooseBase(this,g)[g].showMoreSignersContainer=s.Tag.render(v||(v=b`
				<div class="sign-document-b2e-user-party__item-show_more">
					${0}
				</div>
			`),e);s.Dom.hide(babelHelpers.classPrivateFieldLooseBase(this,g)[g].showMoreSignersContainer);s.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,g)[g].showMoreSignersContainer,babelHelpers.classPrivateFieldLooseBase(this,g)[g].itemContainer);return babelHelpers.classPrivateFieldLooseBase(this,g)[g].itemContainer}const a=e==="ru"?t.Helpdesk.replaceLink(s.Loc.getMessage("SIGN_USER_PARTY_DESCRIPTION"),m.SignEdmWithEmployees):s.Loc.getMessage("SIGN_USER_PARTY_DESCRIPTION_WITHOUT_LINK");babelHelpers.classPrivateFieldLooseBase(this,g)[g].description=s.Tag.render(p||(p=b`
			<p class="sign-document-b2e-user-party__description">
				${0}
			</p>
		`),a);return s.Tag.render(u||(u=b`
			<div>
				<div class="sign-b2e-settings__header-wrapper">
					<h1 class="sign-b2e-settings__header">${0}</h1>
					${0}
				</div>
				<div class="sign-b2e-settings__item">
					<p class="sign-b2e-settings__item_title">
						${0}
					</p>
					${0}
					${0}
				</div>
			</div>
		`),s.Loc.getMessage("SIGN_USER_PARTY_HEADER"),babelHelpers.classPrivateFieldLooseBase(this,O)[O].getLayout(),s.Loc.getMessage("SIGN_USER_PARTY_ITEM_TITLE"),babelHelpers.classPrivateFieldLooseBase(this,g)[g].itemContainer,babelHelpers.classPrivateFieldLooseBase(this,g)[g].description)}async load(e){const{dialog:s}=babelHelpers.classPrivateFieldLooseBase(this,S)[S];s.preselectedItems=e.map((e=>["user",e]));const t=new Promise((e=>{s.subscribeOnce("onLoad",e)}));s.load();await t}async setUserIds(e){babelHelpers.classPrivateFieldLooseBase(this,k)[k]();const s=babelHelpers.classPrivateFieldLooseBase(this,J)[J]();babelHelpers.classPrivateFieldLooseBase(this,w)[w]=e.length;babelHelpers.classPrivateFieldLooseBase(this,_)[_]=e.sort(((e,s)=>e.entityType==="structure-node"?-1:1)).slice(0,s);if(babelHelpers.classPrivateFieldLooseBase(this,_)[_].length<s){const t=await babelHelpers.classPrivateFieldLooseBase(this,B)[B].getMembersForDocument(babelHelpers.classPrivateFieldLooseBase(this,D)[D],1,s,babelHelpers.classPrivateFieldLooseBase(this,M)[M]);const a=new Set(e.filter((e=>e.entityType===n.EntityType.USER)).map((e=>e.entityId)));const i=t.members.filter((e=>!a.has(e.userId))).slice(0,s-babelHelpers.classPrivateFieldLooseBase(this,_)[_].length);babelHelpers.classPrivateFieldLooseBase(this,_)[_]=[...babelHelpers.classPrivateFieldLooseBase(this,_)[_],...i.map((e=>({entityType:"user",entityId:e.userId})))]}babelHelpers.classPrivateFieldLooseBase(this,_)[_].reverse();await babelHelpers.classPrivateFieldLooseBase(this,R)[R]();babelHelpers.classPrivateFieldLooseBase(this,U)[U]()}validate(){this.closeCounterGuide();const e=babelHelpers.classPrivateFieldLooseBase(this,f)[f].size>0&&babelHelpers.classPrivateFieldLooseBase(this,O)[O].getCount()>0;const t=babelHelpers.classPrivateFieldLooseBase(this,S)[S].getOuterContainer();if(e){s.Dom.removeClass(t,"--invalid")}else{s.Dom.addClass(t,"--invalid")}return e}getEntities(){return[...babelHelpers.classPrivateFieldLooseBase(this,f)[f].values()]}resetUserPartyPopup(){babelHelpers.classPrivateFieldLooseBase(this,I)[I].resetData()}setDocumentUid(e){babelHelpers.classPrivateFieldLooseBase(this,D)[D]=e}getPreselectedUserData(){return babelHelpers.classPrivateFieldLooseBase(this,_)[_]}getUniqueUsersCount(){var e,s;return(e=(s=babelHelpers.classPrivateFieldLooseBase(this,O)[O])==null?void 0:s.getCount())!=null?e:0}closeCounterGuide(){var e;(e=babelHelpers.classPrivateFieldLooseBase(this,O)[O])==null?void 0:e.closeGuide()}}function ee(e){if(babelHelpers.classPrivateFieldLooseBase(this,T)[T]===H.view){babelHelpers.classPrivateFieldLooseBase(this,g)[g].container=this.getLayout(e.region);return}const{b2eSignersLimitCount:t,region:l}=e;babelHelpers.classPrivateFieldLooseBase(this,O)[O]=new i.UserPartyCounters({userCountersLimit:t});babelHelpers.classPrivateFieldLooseBase(this,g)[g].container=this.getLayout(l);const r=[];const n=[{id:"user",options:{intranetUsersOnly:true}},{id:"structure-node",options:{selectMode:"usersAndDepartments",fillRecentTab:true,allowFlatDepartments:true}}];if(o.FeatureStorage.isDocumentsInSignersSelectorEnabled()){r.push({id:"sign-document",title:s.Loc.getMessage("SIGN_USER_PARTY_TAB_DOCUMENTS")});n.push({id:"sign-document"})}babelHelpers.classPrivateFieldLooseBase(this,S)[S]=new a.TagSelector({events:{onTagRemove:e=>{const{tag:s}=e.getData();babelHelpers.classPrivateFieldLooseBase(this,N)[N](s)},onTagAdd:e=>{const{tag:s}=e.getData();babelHelpers.classPrivateFieldLooseBase(this,A)[A](s)}},dialogOptions:{width:425,height:363,multiple:true,targetNode:babelHelpers.classPrivateFieldLooseBase(this,g)[g].itemContainer,context:"sign_b2e_user_party",tabs:r,entities:n,dropdownMode:false,hideOnDeselect:false}});babelHelpers.classPrivateFieldLooseBase(this,S)[S].renderTo(babelHelpers.classPrivateFieldLooseBase(this,g)[g].itemContainer)}function se(e){const s=babelHelpers.classPrivateFieldLooseBase(this,M)[M]===n.MemberRole.signer;return new l.UserPartyPopup({bindElement:e,isDepartmentsVisible:s,role:babelHelpers.classPrivateFieldLooseBase(this,M)[M]})}async function te(){let e=false;let t=0;const a=babelHelpers.classPrivateFieldLooseBase(this,_)[_].reduce(((e,s)=>s.entityType==="user"?e+1:e),0);if(babelHelpers.classPrivateFieldLooseBase(this,M)[M]===n.MemberRole.signer){const s=await babelHelpers.classPrivateFieldLooseBase(this,B)[B].getUniqUserCountForDocument(babelHelpers.classPrivateFieldLooseBase(this,D)[D]);t=s.count-a;e=t>0}else if(babelHelpers.classPrivateFieldLooseBase(this,w)[w]>babelHelpers.classPrivateFieldLooseBase(this,J)[J]()){e=true;t=babelHelpers.classPrivateFieldLooseBase(this,w)[w]-babelHelpers.classPrivateFieldLooseBase(this,J)[J]()}if(e){babelHelpers.classPrivateFieldLooseBase(this,g)[g].showMoreSignersContainer.querySelector(".--count-placeholder").textContent=t;s.Dom.show(babelHelpers.classPrivateFieldLooseBase(this,g)[g].showMoreSignersContainer)}else{babelHelpers.classPrivateFieldLooseBase(this,g)[g].showMoreSignersContainer.querySelector(".--count-placeholder").textContent=0;s.Dom.hide(babelHelpers.classPrivateFieldLooseBase(this,g)[g].showMoreSignersContainer)}}async function ae(){babelHelpers.classPrivateFieldLooseBase(this,$)[$]();await new Promise((e=>{const s=new a.Dialog({entities:[{id:"user"}],events:{onLoad:()=>{s.getSelectedItems().forEach((e=>{babelHelpers.classPrivateFieldLooseBase(this,A)[A](e)}));e()}},preselectedItems:babelHelpers.classPrivateFieldLooseBase(this,_)[_].map((e=>[e.entityType,e.entityId]))});s.load()}));babelHelpers.classPrivateFieldLooseBase(this,X)[X]()}function ie(){babelHelpers.classPrivateFieldLooseBase(this,g)[g].itemContainer.style.display="none";babelHelpers.classPrivateFieldLooseBase(this,x)[x]().show()}function le(){babelHelpers.classPrivateFieldLooseBase(this,g)[g].itemContainer.style.display="flex";babelHelpers.classPrivateFieldLooseBase(this,x)[x]().hide()}function re(){if(babelHelpers.classPrivateFieldLooseBase(this,C)[C]){return babelHelpers.classPrivateFieldLooseBase(this,C)[C]}babelHelpers.classPrivateFieldLooseBase(this,C)[C]=new BX.Loader({target:babelHelpers.classPrivateFieldLooseBase(this,g)[g].container,mode:"inline",size:40});return babelHelpers.classPrivateFieldLooseBase(this,C)[C]}function oe(e){const t=babelHelpers.classPrivateFieldLooseBase(this,Q)[Q](e);const a=babelHelpers.classPrivateFieldLooseBase(this,f)[f].get(t);if(a!=null&&a.container){s.Dom.remove(a.container)}babelHelpers.classPrivateFieldLooseBase(this,f)[f].delete(t);babelHelpers.classPrivateFieldLooseBase(this,V)[V]()}function ne(e){var t,a;const i={id:e.id,title:e==null?void 0:e.title.text,name:(t=e.customData)==null?void 0:t.get("name"),lastName:(a=e.customData)==null?void 0:a.get("lastName"),avatar:e==null?void 0:e.avatar,entityId:e.id,entityType:e==null?void 0:e.entityId};const l=babelHelpers.classPrivateFieldLooseBase(this,T)[T]===H.view?babelHelpers.classPrivateFieldLooseBase(this,Y)[Y](i):null;if(l){s.Dom.prepend(l,babelHelpers.classPrivateFieldLooseBase(this,g)[g].itemContainer)}i.container=l;babelHelpers.classPrivateFieldLooseBase(this,f)[f].set(babelHelpers.classPrivateFieldLooseBase(this,Q)[Q](e),i);babelHelpers.classPrivateFieldLooseBase(this,V)[V]()}function be(){if(babelHelpers.classPrivateFieldLooseBase(this,T)[T]===H.edit){babelHelpers.classPrivateFieldLooseBase(this,G)[G](babelHelpers.classPrivateFieldLooseBase(this,S)[S].getTags().map((e=>({entityId:e.id,entityType:e.entityId}))))}}function ce(e){clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,E)[E]);babelHelpers.classPrivateFieldLooseBase(this,E)[E]=setTimeout((async()=>{var s;const t=await babelHelpers.classPrivateFieldLooseBase(this,B)[B].getUniqUserCountForMembers(e);(s=babelHelpers.classPrivateFieldLooseBase(this,O)[O])==null?void 0:s.update(t.count)}),100)}function de(e){switch(e.entityType){case"structure-node":return babelHelpers.classPrivateFieldLooseBase(this,W)[W](e);case"sign-document":return babelHelpers.classPrivateFieldLooseBase(this,q)[q](e);default:return babelHelpers.classPrivateFieldLooseBase(this,z)[z](e)}}function ve(e){const t=s.Text.encode(e.title);return s.Tag.render(h||(h=b`
			<div class="sign-document-b2e-user-party__item-list_item --department">
				<div>
					<img
						class="sign-document-b2e-user-party__item-list_item-avatar"
						title="${0}" src='${0}' alt="avatar"
					/>
				</div>
				<div title="${0}" class="sign-document-b2e-user-party__item-list_item-text">
					${0}
				</div>
			</div>
		`),t,y,t,t)}function pe(e){const t=s.Text.encode(e.title);return s.Tag.render(P||(P=b`
			<div class="sign-document-b2e-user-party__item-list_item --document">
				<div>
					<div
						class="sign-document-b2e-user-party__item-list_item-avatar ui-icon-set --document-sign"
						title="${0}" alt="avatar"
					></div>
				</div>
				<div title="${0}" class="sign-document-b2e-user-party__item-list_item-text">
					${0}
				</div>
			</div>
		`),t,t,t)}function ue(e){const t=s.Text.encode(e.title);const a=e.avatar||F;const i=`/company/personal/user/${s.Text.encode(e.entityId)}/`;return s.Tag.render(L||(L=b`
			<div class="sign-document-b2e-user-party__item-list_item --user">
				<a href="${0}">
					<img
						class="sign-document-b2e-user-party__item-list_item-avatar"
						title="${0}" src='${0}' alt="avatar"
					/>
				</a>
				<div title="${0}" class="sign-document-b2e-user-party__item-list_item-text">
					${0}
				</div>
			</div>
		`),i,t,s.Text.encode(a),t,t)}function he(){var e;this.closeCounterGuide();[...babelHelpers.classPrivateFieldLooseBase(this,f)[f].values()].forEach((e=>s.Dom.remove(e.container)));babelHelpers.classPrivateFieldLooseBase(this,f)[f].clear();(e=babelHelpers.classPrivateFieldLooseBase(this,O)[O])==null?void 0:e.update(babelHelpers.classPrivateFieldLooseBase(this,f)[f].size)}function Pe(){return 7}function Le(e){const{id:s,entityId:t}=e;return`${t}_${s}`}e.UserParty=Z})(this.BX.Sign.V2.B2e=this.BX.Sign.V2.B2e||{},BX,BX.Sign.V2,BX.UI.EntitySelector,BX.Sign.V2.B2e,BX.Sign.V2.B2e,BX.Sign.V2,BX.Sign,BX.Sign);
//# sourceMappingURL=user-party.bundle.map.js