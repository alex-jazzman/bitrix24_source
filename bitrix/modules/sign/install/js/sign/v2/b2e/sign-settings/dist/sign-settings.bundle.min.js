this.BX=this.BX||{};this.BX.Sign=this.BX.Sign||{};this.BX.Sign.V2=this.BX.Sign.V2||{};(function(e,t,s,i,a,o,l,r,n,c,d,u,p,b,h,m){"use strict";let v=e=>e,y,P,S,f,L;const F=new Set(["jpg","jpeg","png","pdf","doc","docx","rtf","odt"]);var B=babelHelpers.classPrivateFieldLooseKey("companyParty");var g=babelHelpers.classPrivateFieldLooseKey("regionalSettings");var H=babelHelpers.classPrivateFieldLooseKey("userParty");var D=babelHelpers.classPrivateFieldLooseKey("api");var I=babelHelpers.classPrivateFieldLooseKey("maxDocumentCount");var T=babelHelpers.classPrivateFieldLooseKey("cache");var _=babelHelpers.classPrivateFieldLooseKey("saveButton");var E=babelHelpers.classPrivateFieldLooseKey("isMultiDocumentSaveProcessGone");var O=babelHelpers.classPrivateFieldLooseKey("needSkipEditorStep");var w=babelHelpers.classPrivateFieldLooseKey("prepareConfig");var G=babelHelpers.classPrivateFieldLooseKey("editDocumentData");var M=babelHelpers.classPrivateFieldLooseKey("handleEditedDocument");var C=babelHelpers.classPrivateFieldLooseKey("removeDocumentElement");var A=babelHelpers.classPrivateFieldLooseKey("attachGroupToDocument");var j=babelHelpers.classPrivateFieldLooseKey("saveUpdatedDocumentData");var k=babelHelpers.classPrivateFieldLooseKey("deleteDocument");var N=babelHelpers.classPrivateFieldLooseKey("setupParties");var K=babelHelpers.classPrivateFieldLooseKey("isTemplateModeForCompany");var U=babelHelpers.classPrivateFieldLooseKey("syncMembersWithDepartments");var R=babelHelpers.classPrivateFieldLooseKey("sleep");var V=babelHelpers.classPrivateFieldLooseKey("documentUid");var x=babelHelpers.classPrivateFieldLooseKey("isDocumentInitiatedByEmployee");var X=babelHelpers.classPrivateFieldLooseKey("getAssignee");var z=babelHelpers.classPrivateFieldLooseKey("getSigner");var $=babelHelpers.classPrivateFieldLooseKey("makeSetupMembers");var W=babelHelpers.classPrivateFieldLooseKey("parseMembers");var Y=babelHelpers.classPrivateFieldLooseKey("getMemberEntityTypeByRole");var Z=babelHelpers.classPrivateFieldLooseKey("getSetupStep");var q=babelHelpers.classPrivateFieldLooseKey("getCompanyStep");var J=babelHelpers.classPrivateFieldLooseKey("getRegionalSettingsStep");var Q=babelHelpers.classPrivateFieldLooseKey("getEmployeeStep");var ee=babelHelpers.classPrivateFieldLooseKey("executeDocumentSendActions");var te=babelHelpers.classPrivateFieldLooseKey("executeEditorActions");var se=babelHelpers.classPrivateFieldLooseKey("getSendStep");var ie=babelHelpers.classPrivateFieldLooseKey("isRegionalSettingsStepEnabled");var ae=babelHelpers.classPrivateFieldLooseKey("setSecondPartySectionVisibility");var oe=babelHelpers.classPrivateFieldLooseKey("setHcmLinkIntegrationSectionVisibility");var le=babelHelpers.classPrivateFieldLooseKey("isInitiatedByEmployee");var re=babelHelpers.classPrivateFieldLooseKey("decorateStepsBeforeCompletionWithAnalytics");var ne=babelHelpers.classPrivateFieldLooseKey("sendAnalyticsOnSetupStep");var ce=babelHelpers.classPrivateFieldLooseKey("sendAnalyticsOnSetupError");var de=babelHelpers.classPrivateFieldLooseKey("sendAnalyticsOnCompanyStepSuccess");var ue=babelHelpers.classPrivateFieldLooseKey("sendAnalyticsOnCompanyStepError");var pe=babelHelpers.classPrivateFieldLooseKey("sendAnalyticsOnSendStepSuccess");var be=babelHelpers.classPrivateFieldLooseKey("sendAnalyticsOnSendStepError");var he=babelHelpers.classPrivateFieldLooseKey("sendAnalyticsOnStart");var me=babelHelpers.classPrivateFieldLooseKey("processSetupData");var ve=babelHelpers.classPrivateFieldLooseKey("addDocumentInGroup");var ye=babelHelpers.classPrivateFieldLooseKey("scrollToTop");var Pe=babelHelpers.classPrivateFieldLooseKey("scrollToDown");var Se=babelHelpers.classPrivateFieldLooseKey("resetDocument");var fe=babelHelpers.classPrivateFieldLooseKey("disableDocumentSectionIfLimitReached");var Le=babelHelpers.classPrivateFieldLooseKey("onBeforePreviewBtnClick");var Fe=babelHelpers.classPrivateFieldLooseKey("getMultiDocumentAddSidePanelContent");var Be=babelHelpers.classPrivateFieldLooseKey("getUploader");var ge=babelHelpers.classPrivateFieldLooseKey("resetAfterPreviewSidePanel");var He=babelHelpers.classPrivateFieldLooseKey("getUploadFileButton");var De=babelHelpers.classPrivateFieldLooseKey("getUploadFileFromDirButton");var Ie=babelHelpers.classPrivateFieldLooseKey("onInputFileChange");var Te=babelHelpers.classPrivateFieldLooseKey("onFileAdd");var _e=babelHelpers.classPrivateFieldLooseKey("onBeforePreviewSaveBtnClick");var Ee=babelHelpers.classPrivateFieldLooseKey("onUploadComplete");var Oe=babelHelpers.classPrivateFieldLooseKey("onBeforeFilesAdd");var we=babelHelpers.classPrivateFieldLooseKey("isIntegrationEnabled");class Ge extends b.SignSettings{constructor(e,t){super(e,t,{next:{className:"ui-btn-success"},complete:{className:"ui-btn-success"},swapButtons:true});Object.defineProperty(this,we,{value:Mt});Object.defineProperty(this,Oe,{value:Gt});Object.defineProperty(this,Ee,{value:wt});Object.defineProperty(this,_e,{value:Ot});Object.defineProperty(this,Te,{value:Et});Object.defineProperty(this,Ie,{value:_t});Object.defineProperty(this,De,{value:Tt});Object.defineProperty(this,He,{value:It});Object.defineProperty(this,ge,{value:Dt});Object.defineProperty(this,Be,{value:Ht});Object.defineProperty(this,Fe,{value:gt});Object.defineProperty(this,Le,{value:Bt});Object.defineProperty(this,fe,{value:Ft});Object.defineProperty(this,Se,{value:Lt});Object.defineProperty(this,Pe,{value:ft});Object.defineProperty(this,ye,{value:St});Object.defineProperty(this,ve,{value:Pt});Object.defineProperty(this,me,{value:yt});Object.defineProperty(this,he,{value:vt});Object.defineProperty(this,be,{value:mt});Object.defineProperty(this,pe,{value:ht});Object.defineProperty(this,ue,{value:bt});Object.defineProperty(this,de,{value:pt});Object.defineProperty(this,ce,{value:ut});Object.defineProperty(this,ne,{value:dt});Object.defineProperty(this,re,{value:ct});Object.defineProperty(this,le,{value:nt});Object.defineProperty(this,oe,{value:rt});Object.defineProperty(this,ae,{value:lt});Object.defineProperty(this,ie,{value:ot});Object.defineProperty(this,se,{value:at});Object.defineProperty(this,te,{value:it});Object.defineProperty(this,ee,{value:st});Object.defineProperty(this,Q,{value:tt});Object.defineProperty(this,J,{value:et});Object.defineProperty(this,q,{value:Qe});Object.defineProperty(this,Z,{value:Je});Object.defineProperty(this,Y,{value:qe});Object.defineProperty(this,W,{value:Ze});Object.defineProperty(this,$,{value:Ye});Object.defineProperty(this,z,{value:We});Object.defineProperty(this,X,{value:$e});Object.defineProperty(this,x,{get:ze,set:void 0});Object.defineProperty(this,V,{get:Xe,set:void 0});Object.defineProperty(this,R,{value:xe});Object.defineProperty(this,U,{value:Ve});Object.defineProperty(this,K,{value:Re});Object.defineProperty(this,N,{value:Ue});Object.defineProperty(this,k,{value:Ke});Object.defineProperty(this,j,{value:Ne});Object.defineProperty(this,A,{value:ke});Object.defineProperty(this,C,{value:je});Object.defineProperty(this,M,{value:Ae});Object.defineProperty(this,G,{value:Ce});Object.defineProperty(this,w,{value:Me});Object.defineProperty(this,B,{writable:true,value:void 0});Object.defineProperty(this,g,{writable:true,value:void 0});Object.defineProperty(this,H,{writable:true,value:void 0});Object.defineProperty(this,D,{writable:true,value:void 0});Object.defineProperty(this,I,{writable:true,value:void 0});Object.defineProperty(this,T,{writable:true,value:new s.MemoryCache});Object.defineProperty(this,_,{writable:true,value:void 0});Object.defineProperty(this,E,{writable:true,value:false});Object.defineProperty(this,O,{writable:true,value:void 0});const{b2eFeatureConfig:i,blankSelectorConfig:p,documentSendConfig:b,userPartyConfig:h}=babelHelpers.classPrivateFieldLooseBase(this,w)[w](t);this.documentSetup=new r.DocumentSetup(p);this.documentSend=new l.DocumentSend(b);babelHelpers.classPrivateFieldLooseBase(this,B)[B]=new n.Parties({...p,documentInitiatedType:t.initiatedByType,documentMode:t.documentMode},i.hcmLinkAvailable);babelHelpers.classPrivateFieldLooseBase(this,g)[g]=new c.RegionalSettings({templateMode:this.isTemplateMode(),regionDocumentTypes:p.regionDocumentTypes});babelHelpers.classPrivateFieldLooseBase(this,g)[g].isIntegrationVisible=!(this.isTemplateMode()&&t.initiatedByType===a.DocumentInitiated.employee);babelHelpers.classPrivateFieldLooseBase(this,D)[D]=new o.Api;babelHelpers.classPrivateFieldLooseBase(this,I)[I]=t.b2eDocumentLimitCount;babelHelpers.classPrivateFieldLooseBase(this,H)[H]=new d.UserParty({mode:"edit",...h});this.subscribeOnEvents();babelHelpers.classPrivateFieldLooseBase(this,O)[O]=b.needSkipEditorStep;this.editor.setIsB2eDocumentSectionDisabled(!this.documentSetup.isRuRegion());this.editor.setSectionVisibilityByType(u.SectionType.HcmLinkIntegration,false);babelHelpers.classPrivateFieldLooseBase(this,B)[B].subscribe("onCompanySelect",(e=>{var t,s;this.documentSend.setProvider(e.data.provider);babelHelpers.classPrivateFieldLooseBase(this,g)[g].isIntegrationEnabled=babelHelpers.classPrivateFieldLooseBase(this,we)[we]((t=e.data)==null?void 0:(s=t.provider)==null?void 0:s.code)}));babelHelpers.classPrivateFieldLooseBase(this,B)[B].subscribe("onProviderSelect",(e=>{var t,s;this.documentSend.setProvider(e.data.provider);babelHelpers.classPrivateFieldLooseBase(this,g)[g].isIntegrationEnabled=babelHelpers.classPrivateFieldLooseBase(this,we)[we]((t=e.data)==null?void 0:(s=t.provider)==null?void 0:s.code)}))}subscribeOnEvents(){super.subscribeOnEvents();this.documentSend.subscribe("changeTitle",(({data:e})=>{this.documentSetup.setDocumentTitle(e.title)}));this.documentSend.subscribe("disableBack",(()=>{this.wizard.toggleBtnActiveState("back",true)}));this.documentSend.subscribe("enableBack",(()=>{this.wizard.toggleBtnActiveState("back",false)}));this.documentSetup.subscribe("addDocument",(()=>{this.setDocumentsGroup()}));this.documentSetup.subscribe("deleteDocument",(({data:e})=>{babelHelpers.classPrivateFieldLooseBase(this,k)[k](e)}));this.documentSetup.subscribe("editDocument",(({data:e})=>{babelHelpers.classPrivateFieldLooseBase(this,G)[G](e.uid)}));this.documentSend.subscribe("enableComplete",(()=>{this.wizard.toggleBtnActiveState("complete",false)}));this.documentSend.subscribe("disableComplete",(()=>{this.wizard.toggleBtnActiveState("complete",true)}));this.documentSetup.subscribe("documentsLimitExceeded",(()=>{this.documentSetup.setAvailabilityDocumentSection(false)}));this.documentSetup.subscribe("documentsLimitNotExceeded",(()=>{this.documentSetup.setAvailabilityDocumentSection(true)}));this.documentSend.subscribe(this.documentSend.events.onTemplateComplete,(e=>{if(this.isTemplateMode()&&!this.isEditMode()){const t=e.getData().templateId;this.getAnalytics().send({event:"turn_on_off_template",type:"auto",c_element:"on",p5:`templateId_${t}`});this.getAnalytics().send({event:"click_save_template",c_element:"create_button",p5:`templateId_${t}`,status:"success"})}}))}async setDocumentsGroup(){if(this.documentSetup.blankIsNotSelected||!this.documentSetup.validate()){return}this.documentSetup.switchAddDocumentButtonLoadingState(true);try{const e=await this.setupDocument();this.documentsGroup.set(e.uid,e);this.addInDocumentsGroupUids(e.uid);this.documentSetup.blankSelector.disableSelectedBlank(e.blankId);await babelHelpers.classPrivateFieldLooseBase(this,A)[A](e);this.documentSetup.switchAddDocumentButtonLoadingState(false);if(this.editedDocument){await babelHelpers.classPrivateFieldLooseBase(this,M)[M](e)}else{this.documentSetup.renderDocumentBlock(e)}}catch{this.documentSetup.switchAddDocumentButtonLoadingState(false)}babelHelpers.classPrivateFieldLooseBase(this,ye)[ye]();this.documentSetup.documentCounters.update(this.documentsGroup.size);babelHelpers.classPrivateFieldLooseBase(this,Se)[Se]();this.wizard.toggleBtnActiveState("next",false)}addInDocumentsGroupUids(e){if(!this.documentsGroupUids.includes(e)){this.documentsGroupUids.push(e)}}replaceInDocumentsGroupUids(e,t){const s=this.documentsGroupUids.indexOf(e);if(s!==-1){this.documentsGroupUids.splice(s,1,t)}}deleteFromDocumentsGroupUids(e){const t=this.documentsGroupUids.indexOf(e);if(t===-1){return}this.documentsGroupUids.splice(t,1)}async applyDocumentData(e){const t=await this.setupDocument(e,true);if(!t){return false}if(t.groupId){const e=await babelHelpers.classPrivateFieldLooseBase(this,D)[D].getDocumentListInGroup(t.groupId);for(const t of e){this.addInDocumentsGroupUids(t.uid);const e=await babelHelpers.classPrivateFieldLooseBase(this,D)[D].loadBlocksByDocument(t.uid);const s={...t,blocks:e};this.documentsGroup.set(t.uid,s);this.documentSetup.renderDocumentBlock(s);this.documentSetup.blankSelector.disableSelectedBlank(s.blankId)}this.groupId=t.groupId;this.documentSetup.documentCounters.update(this.documentsGroup.size);babelHelpers.classPrivateFieldLooseBase(this,Se)[Se]()}else{this.documentsGroup.set(t.uid,t);this.addInDocumentsGroupUids(t.uid)}const s=this.getFirstDocumentDataFromGroup();const{entityId:i,representativeId:o,companyUid:l,companyEntityId:r,hcmLinkCompanyId:n}=s;this.documentSend.documentData=this.documentsGroup;babelHelpers.classPrivateFieldLooseBase(this,fe)[fe]();if(this.isSingleDocument()){this.editor.documentData=s}const c=await babelHelpers.classPrivateFieldLooseBase(this,D)[D].loadMembers(e);if(o){const e=babelHelpers.classPrivateFieldLooseBase(this,Y)[Y](c,a.MemberRole.assignee);babelHelpers.classPrivateFieldLooseBase(this,B)[B].loadRepresentative(o,e)}const d=babelHelpers.classPrivateFieldLooseBase(this,W)[W](c);const{signers:u=[],reviewers:p=[],editors:b=[],assignees:h=[]}=d;babelHelpers.classPrivateFieldLooseBase(this,B)[B].setEntityId(i);if(l){var m;babelHelpers.classPrivateFieldLooseBase(this,g)[g].setLastSavedHcmLinkCompanyId(n);babelHelpers.classPrivateFieldLooseBase(this,B)[B].loadCompany(l,(m=r!=null?r:h[0])!=null?m:null)}if(u.length>0){babelHelpers.classPrivateFieldLooseBase(this,H)[H].load(u)}babelHelpers.classPrivateFieldLooseBase(this,B)[B].loadValidator(c);return true}async applyTemplateData(e){super.applyTemplateData(e);this.documentSetup.setupData.templateUid=e;this.documentSend.setExistingTemplate();return true}getStepsMetadata(e,t,s){babelHelpers.classPrivateFieldLooseBase(this,he)[he](t);const i={setup:babelHelpers.classPrivateFieldLooseBase(this,Z)[Z](e,t),company:babelHelpers.classPrivateFieldLooseBase(this,q)[q](e)};if(babelHelpers.classPrivateFieldLooseBase(this,ie)[ie]()){i.regionalSettings=babelHelpers.classPrivateFieldLooseBase(this,J)[J](e,t)}if(this.isDocumentMode()){i.employees=babelHelpers.classPrivateFieldLooseBase(this,Q)[Q](e)}i.send=babelHelpers.classPrivateFieldLooseBase(this,se)[se](e);babelHelpers.classPrivateFieldLooseBase(this,re)[re](i,t);return i}async init(e,s){await super.init(e,s);if(this.isEditMode()&&!t.Type.isNull(this.getAfterPreviewLayout())){BX.hide(this.getAfterPreviewLayout())}if(this.isEditMode()){this.documentSetup.setDocumentTitle(this.documentSetup.setupData.title);this.documentSetup.enableDocumentInputs()}}onComplete(e=true){if(this.isTemplateMode()){return}super.onComplete(e)}isTemplateCreateMode(){return b.isTemplateMode(this.documentMode)&&!this.isEditMode()}getAfterPreviewLayout(){if(!this.isDocumentMode()||!i.FeatureStorage.isMultiDocumentLoadingEnabled()){return null}return babelHelpers.classPrivateFieldLooseBase(this,T)[T].remember("beforePreviewLayout",(()=>t.Tag.render(y||(y=v`
			<button class="ui-btn ui-btn-light-border ui-btn-md" style="margin-top: 20px;" onclick="${0}">
				${0}
			</button>
		`),(()=>babelHelpers.classPrivateFieldLooseBase(this,Le)[Le]()),t.Loc.getMessage("SIGN_SETTINGS_B2E_BEFORE_PREVIEW"))))}}function Me(e){const{config:t,documentMode:s,fromRobot:i,fromTemplateFolder:a,b2eDocumentLimitCount:o}=e;const{blankSelectorConfig:l,documentSendConfig:r}=t;l.documentMode=s;l.isOpenedFromRobot=i;l.b2eDocumentLimitCount=o;l.isOpenedFromTemplateFolder=a;r.documentMode=s;r.isOpenedFromRobot=i;return t}async function Ce(e){if(this.editedDocument){await babelHelpers.classPrivateFieldLooseBase(this,j)[j](this.editedDocument.uid)}if(!this.documentSetup.editMode){babelHelpers.classPrivateFieldLooseBase(this,fe)[fe]();babelHelpers.classPrivateFieldLooseBase(this,Se)[Se]();return}this.editedDocument=this.documentsGroup.get(e);this.documentSetup.setAvailabilityDocumentSection(true);this.documentSetup.setDocumentTitle(this.editedDocument.title);babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]()}async function Ae(e){if(this.documentSetup.blankIsNotSelected||!this.documentSetup.isFileAdded){this.documentSetup.resetEditMode();await babelHelpers.classPrivateFieldLooseBase(this,j)[j](this.editedDocument.uid);return}this.deleteFromDocumentsGroupUids(e.uid);this.replaceInDocumentsGroupUids(this.editedDocument.uid,e.uid);this.documentSetup.replaceDocumentBlock(this.editedDocument,e);await babelHelpers.classPrivateFieldLooseBase(this,k)[k](this.editedDocument);await babelHelpers.classPrivateFieldLooseBase(this,A)[A](e);this.editor.setUrls([])}function je(e){const t=this.documentSetup.layout.querySelector(`[data-id="document-id-${e}"]`);t==null?void 0:t.remove()}async function ke(e){if(!this.groupId){const{groupId:e}=await babelHelpers.classPrivateFieldLooseBase(this,D)[D].createDocumentsGroup();this.groupId=e}try{const t=this.documentsGroup.get(e.uid);if(t&&!t.groupId){await babelHelpers.classPrivateFieldLooseBase(this,D)[D].attachGroupToDocument(e.uid,this.groupId);t.groupId=this.groupId}}catch(e){console.error(e)}}async function Ne(e){const t=await this.documentSetup.updateDocumentData(this.editedDocument);this.documentSetup.updateDocumentBlock(this.editedDocument.id);if(e){this.documentsGroup.set(this.editedDocument.uid,t);this.addInDocumentsGroupUids(this.editedDocument.uid);this.documentSend.setDocumentsBlock(this.documentsGroup);babelHelpers.classPrivateFieldLooseBase(this,g)[g].documentsGroup=this.documentsGroup}}async function Ke(e){const{id:t,uid:s,blankId:i,deleteButton:a}=e;this.documentSetup.ready=false;try{await babelHelpers.classPrivateFieldLooseBase(this,D)[D].removeDocument(s);this.documentSetup.ready=true;if(this.isFirstDocumentSelected(s)){this.resetPreview();this.hasPreviewUrls=false}babelHelpers.classPrivateFieldLooseBase(this,C)[C](t);this.documentSend.deleteDocument(s);this.documentsGroup.delete(s);this.deleteFromDocumentsGroupUids(s);this.documentSetup.blankSelector.enableSelectedBlank(i);this.documentSetup.deleteDocumentFromList(i);this.documentSetup.documentCounters.update(this.documentsGroup.size);this.documentSetup.resetEditMode();if(this.documentsGroup.size===0){this.wizard.toggleBtnActiveState("next",true)}else{this.documentSetup.setupData=this.getFirstDocumentDataFromGroup()}babelHelpers.classPrivateFieldLooseBase(this,Se)[Se]()}catch{this.documentSetup.toggleDeleteBtnLoadingState(a);this.documentSetup.ready=true}}async function Ue(){const{representative:e}=babelHelpers.classPrivateFieldLooseBase(this,B)[B].getParties();const{members:s,signerParty:i}=babelHelpers.classPrivateFieldLooseBase(this,$)[$]();const a=[...this.documentsGroup.keys()];for(const t of a){await babelHelpers.classPrivateFieldLooseBase(this,D)[D].setupB2eParties(t,e.entityId,s)}const o=babelHelpers.classPrivateFieldLooseBase(this,V)[V];const l=await babelHelpers.classPrivateFieldLooseBase(this,D)[D].loadMembers(o);if(!t.Type.isArrayFilled(l)){throw new Error("Members are empty")}const r=a.map((e=>babelHelpers.classPrivateFieldLooseBase(this,U)[U](e,i)));await Promise.all(r);return l.map((e=>{var t,s,i;return{presetId:e==null?void 0:e.presetId,part:e==null?void 0:e.party,uid:e==null?void 0:e.uid,entityTypeId:(t=e==null?void 0:e.entityTypeId)!=null?t:null,entityId:(s=e==null?void 0:e.entityId)!=null?s:null,role:(i=e==null?void 0:e.role)!=null?i:null}}))}function Re(){const e=this.documentSetup.setupData.initiatedByType===a.DocumentInitiated.company;return b.isTemplateMode(this.documentMode)&&e}async function Ve(e,t){let s=false;while(!s){const i=await babelHelpers.classPrivateFieldLooseBase(this,D)[D].syncB2eMembersWithDepartments(e,t);s=i.syncFinished;await babelHelpers.classPrivateFieldLooseBase(this,R)[R](1e3)}}function xe(e){return new Promise((t=>{setTimeout(t,e)}))}function Xe(){return this.documentSetup.setupData.uid}function ze(){return this.documentSetup.setupData.initiatedByType===a.DocumentInitiated.employee}function $e(e,t){const{representative:s}=babelHelpers.classPrivateFieldLooseBase(this,B)[B].getParties();let i=a.EntityType.COMPANY;if(s.entityType!==a.EntityType.USER){i=s.entityType}return{entityType:i,entityId:t,party:e,role:a.MemberRole.assignee}}function We(e,t){return{entityType:t.entityType,entityId:t.entityId,party:e,role:a.MemberRole.signer}}function Ye(){const{company:e,validation:t}=babelHelpers.classPrivateFieldLooseBase(this,B)[B].getParties();const s=babelHelpers.classPrivateFieldLooseBase(this,H)[H].getEntities();let i=babelHelpers.classPrivateFieldLooseBase(this,x)[x]?2:1;const a=t.map((e=>{const t={...e,party:i};i++;return t}));a.push(babelHelpers.classPrivateFieldLooseBase(this,X)[X](i,e.entityId));let o=i;if(this.isDocumentMode()){o=babelHelpers.classPrivateFieldLooseBase(this,x)[x]?1:i+1;const e=s.map((e=>babelHelpers.classPrivateFieldLooseBase(this,z)[z](o,e)));a.push(...e)}return{members:a,signerParty:o}}function Ze(e){return e.reduce(((e,t)=>{var s;const{entityType:i,entityId:o}=t;if(i!==a.EntityType.USER&&i!==a.EntityType.STRUCTURE_NODE_ROLE){return e}const l=`${t.role}s`;return{...e,[l]:[...(s=e[l])!=null?s:[],o]}}),{})}function qe(e,t){const s=e.find((e=>e.role===t));return(s==null?void 0:s.entityType)===a.EntityType.STRUCTURE_NODE_ROLE?a.EntityType.STRUCTURE_NODE_ROLE:a.EntityType.USER}function Je(e,s){return{get content(){const s=e.documentSetup.layout;p.SignSettingsItemCounter.numerate(s);if(!t.Type.isNull(e.getAfterPreviewLayout())){BX.show(e.getAfterPreviewLayout())}return s},title:t.Loc.getMessage("SIGN_SETTINGS_B2B_LOAD_DOCUMENT"),beforeCompletion:async()=>{const e=this.documentSetup.blankSelector.selectedBlankId!==0;if(e||this.documentSetup.isFileAdded){const e=this.documentSetup.validate();if(!e){return false}}const s=await this.setupDocument();if(!s){return false}await babelHelpers.classPrivateFieldLooseBase(this,ve)[ve](s);if(this.editedDocument){await babelHelpers.classPrivateFieldLooseBase(this,M)[M](s)}babelHelpers.classPrivateFieldLooseBase(this,Se)[Se]();babelHelpers.classPrivateFieldLooseBase(this,me)[me]();babelHelpers.classPrivateFieldLooseBase(this,fe)[fe]();if(!t.Type.isNull(this.getAfterPreviewLayout())){BX.hide(this.getAfterPreviewLayout())}return true}}}function Qe(e){const s=this.isTemplateMode()?"SIGN_SETTINGS_B2E_ROUTES":"SIGN_SETTINGS_B2E_COMPANY";return{get content(){const t=babelHelpers.classPrivateFieldLooseBase(e,B)[B].getLayout();const s=babelHelpers.classPrivateFieldLooseBase(e,K)[K]();if(e.isTemplateMode()){babelHelpers.classPrivateFieldLooseBase(e,B)[B].setEditorAvailability(s)}p.SignSettingsItemCounter.numerate(t);if(!e.isEditMode()){if(!babelHelpers.classPrivateFieldLooseBase(e,B)[B].isRepresentativeSelected()){babelHelpers.classPrivateFieldLooseBase(e,B)[B].loadFirstRepresentative()}if(!babelHelpers.classPrivateFieldLooseBase(e,B)[B].isProviderSelected()){babelHelpers.classPrivateFieldLooseBase(e,B)[B].loadFirstCompany()}}return t},title:t.Loc.getMessage(s),beforeCompletion:async()=>{const{initiatedByType:e}=this.documentSetup.setupData;try{for(const[e]of this.documentsGroup){await babelHelpers.classPrivateFieldLooseBase(this,B)[B].save(e)}babelHelpers.classPrivateFieldLooseBase(this,g)[g].companyId=babelHelpers.classPrivateFieldLooseBase(this,B)[B].getSelectedCompanyId();babelHelpers.classPrivateFieldLooseBase(this,g)[g].documentsGroup=this.documentsGroup;this.editor.setSenderType(e);babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]();if(this.isTemplateMode()){babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]();babelHelpers.classPrivateFieldLooseBase(this,g)[g].isIntegrationVisible=!babelHelpers.classPrivateFieldLooseBase(this,le)[le]()}}catch(e){console.warn(e);return false}return true}}}function et(e,s){return{get content(){return babelHelpers.classPrivateFieldLooseBase(e,g)[g].getLayout()},title:t.Loc.getMessage("SIGN_SETTINGS_B2E_REGIONAL_SETTINGS_SHORT"),beforeCompletion:async()=>{try{await babelHelpers.classPrivateFieldLooseBase(this,g)[g].save()}catch{return false}this.documentSetup.setupData.hcmLinkCompanyId=babelHelpers.classPrivateFieldLooseBase(this,g)[g].getSelectedHcmLinkCompanyId();this.documentSend.hcmLinkEnabled=this.documentSetup.setupData.hcmLinkCompanyId>0;await babelHelpers.classPrivateFieldLooseBase(this,oe)[oe]();if(this.isTemplateMode()){const{uid:e}=this.documentSetup.setupData;const t=!this.documentSetup.isRuRegion()||babelHelpers.classPrivateFieldLooseBase(this,le)[le]();this.editor.setIsB2eDocumentSectionDisabled(t);this.editor.entityData=await babelHelpers.classPrivateFieldLooseBase(this,N)[N]();const{isTemplate:s,entityId:i}=this.documentSetup.setupData;const a=await this.documentSetup.loadBlocks(e);const o={isTemplate:s,uid:e,blocks:a,entityId:i};babelHelpers.classPrivateFieldLooseBase(this,te)[te](o)}return true}}}function tt(e){return{get content(){const t=babelHelpers.classPrivateFieldLooseBase(e,H)[H].getLayout();p.SignSettingsItemCounter.numerate(t);return t},title:t.Loc.getMessage("SIGN_SETTINGS_B2E_EMPLOYEES"),beforeCompletion:async()=>{try{const e=babelHelpers.classPrivateFieldLooseBase(this,H)[H].validate();if(!e){return e}this.editor.entityData=await babelHelpers.classPrivateFieldLooseBase(this,N)[N]();const{uid:t,isTemplate:s,entityId:i}=this.documentSetup.setupData;const a=await this.documentSetup.loadBlocks(t);babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]();const o={isTemplate:s,uid:t,blocks:a,entityId:i};await babelHelpers.classPrivateFieldLooseBase(this,te)[te](o);return true}catch(e){console.error(e);return false}}}}async function st(){const e=babelHelpers.classPrivateFieldLooseBase(this,B)[B].getParties();Object.assign(e,{employees:babelHelpers.classPrivateFieldLooseBase(this,H)[H].getEntities().map((e=>({entityType:e.entityType,entityId:e.entityId})))});this.documentSend.documentData=this.documentsGroup;this.documentSend.resetUserPartyPopup();this.documentSend.setPartiesData(e)}async function it(e){if(this.isTemplateCreateMode()){this.editor.setAnalytics(this.getAnalytics())}this.wizard.toggleBtnLoadingState("next",false);if(this.isSingleDocument()){this.editor.documentData=e;await this.editor.renderDocument();if(!babelHelpers.classPrivateFieldLooseBase(this,O)[O]||this.isTemplateMode()){await this.editor.show()}}}function at(e){const s=this.isTemplateMode()?"SIGN_SETTINGS_SEND_DOCUMENT_CREATE":"SIGN_SETTINGS_SEND_DOCUMENT";return{get content(){const t=e.documentSend.getLayout();p.SignSettingsItemCounter.numerate(t);if(!e.documentSend.isDateTimeLimitSelectorValid()){e.wizard.toggleBtnActiveState("complete",true)}return t},title:t.Loc.getMessage(s),beforeCompletion:async()=>this.documentSend.sendForSign()}}function ot(){return this.documentSetup.isRuRegion()}function lt(){const e=babelHelpers.classPrivateFieldLooseBase(this,B)[B].getSelectedProvider();const t=e.code!==a.ProviderCode.sesRu;const s=t||b.isTemplateMode(this.documentMode)&&babelHelpers.classPrivateFieldLooseBase(this,le)[le]();this.editor.setSectionVisibilityByType(u.SectionType.SecondParty,s)}async function rt(){const e=this.documentSetup.setupData.initiatedByType===a.DocumentInitiated.company;if(babelHelpers.classPrivateFieldLooseBase(this,le)[le]()&&this.documentSetup.isRuRegion()){await babelHelpers.classPrivateFieldLooseBase(this,D)[D].changeIntegrationId(this.documentSetup.setupData.uid,null)}const t=this.documentSetup.setupData.hcmLinkCompanyId>0&&e;this.editor.setSectionVisibilityByType(u.SectionType.HcmLinkIntegration,t)}function nt(){return this.documentSetup.setupData.initiatedByType===a.DocumentInitiated.employee}function ct(e,s){const i=this.getAnalytics();if(t.Type.isPlainObject(e.setup)){e.setup.beforeCompletion=b.decorateResultBeforeCompletion(e.setup.beforeCompletion,(()=>babelHelpers.classPrivateFieldLooseBase(this,ne)[ne](i,s)),(()=>babelHelpers.classPrivateFieldLooseBase(this,ce)[ce](i)))}if(t.Type.isPlainObject(e.company)){e.company.beforeCompletion=b.decorateResultBeforeCompletion(e.company.beforeCompletion,(()=>babelHelpers.classPrivateFieldLooseBase(this,de)[de](i)),(()=>babelHelpers.classPrivateFieldLooseBase(this,ue)[ue](i)))}if(t.Type.isPlainObject(e.send)){e.send.beforeCompletion=b.decorateResultBeforeCompletion(e.send.beforeCompletion,(()=>babelHelpers.classPrivateFieldLooseBase(this,pe)[pe](i,this.documentSetup.setupData.uid)),(()=>babelHelpers.classPrivateFieldLooseBase(this,be)[be](i,this.documentSetup.setupData.uid)))}}function dt(e,t){if(this.isTemplateCreateMode()){e.send({event:"proceed_step_document",c_element:"create_button",status:"success"});e.send({event:"turn_on_off_template",type:"auto",c_element:"off",p5:`templateId_${this.documentSetup.setupData.templateId}`})}}function ut(e){if(this.isTemplateCreateMode()){e.send({event:"proceed_step_document",status:"error",c_element:"create_button"})}}function pt(e){if(this.isTemplateCreateMode()){e.send({event:"proceed_step_route",status:"success",c_element:"create_button"})}}function bt(e){if(this.isTemplateCreateMode()){e.send({event:"proceed_step_route",status:"error",c_element:"create_button"})}}async function ht(e,t){if(this.isDocumentMode()){e.sendWithProviderTypeAndDocId({event:"sent_document_to_sign",c_element:"create_button",status:"success"},t)}}async function mt(e,t){if(this.isTemplateCreateMode()){this.getAnalytics().send({event:"click_save_template",status:"error",c_element:"create_button"})}if(this.isDocumentMode()){e.sendWithProviderTypeAndDocId({event:"sent_document_to_sign",c_element:"create_button",status:"error"},t)}}function vt(e){const s=this.getAnalytics();if(this.isTemplateCreateMode()){s.send({event:"open_wizard",c_element:"create_button"})}else if(this.isDocumentMode()){const i={event:"click_create_document",c_element:"create_button"};if(this.isEditMode()&&t.Type.isStringFilled(e)){s.sendWithDocId(i,e)}else{s.send(i)}}}async function yt(){const e=this.getFirstDocumentDataFromGroup();babelHelpers.classPrivateFieldLooseBase(this,B)[B].setInitiatedByType(e.initiatedByType);babelHelpers.classPrivateFieldLooseBase(this,B)[B].setEntityId(e.entityId);if(this.isTemplateMode()){babelHelpers.classPrivateFieldLooseBase(this,B)[B].reloadCompanyProviders()}this.editedDocument=null;if(this.hasPreviewUrls){this.wizard.toggleBtnActiveState("next",false)}}async function Pt(e){if(this.documentSetup.blankIsNotSelected){return}if(this.isTemplateMode()||!i.FeatureStorage.isGroupSendingEnabled()){this.setSingleDocument(e);return}this.documentsGroup.set(e.uid,e);this.addInDocumentsGroupUids(e.uid);this.documentSetup.blankSelector.disableSelectedBlank(e.blankId);if(!e.groupId&&!this.editedDocument){await babelHelpers.classPrivateFieldLooseBase(this,A)[A](e)}if(!this.isTemplateMode()){this.documentSetup.documentCounters.update(this.documentsGroup.size)}if(!this.editedDocument){this.documentSetup.renderDocumentBlock(e)}}function St(){window.scrollTo({top:0,behavior:"smooth"})}function ft(){window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})}function Lt(){if(this.isTemplateMode()||!i.FeatureStorage.isGroupSendingEnabled()){return}this.documentSetup.resetDocument();this.editedDocument=null}function Ft(){if(this.documentsGroup.size>=babelHelpers.classPrivateFieldLooseBase(this,I)[I]){this.documentSetup.setAvailabilityDocumentSection(false)}}function Bt(){const e=this;BX.SidePanel.Instance.open("sign-settings:afterPreviewSidePanel",{cacheable:false,width:750,contentCallback:()=>{babelHelpers.classPrivateFieldLooseBase(e,ge)[ge]();return h.Layout.createContent({extensions:["ui.forms"],title:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043f\u0430\u043f\u043a\u0443 \u0441 \u0444\u0430\u0439\u043b\u0430\u043c\u0438",content(){babelHelpers.classPrivateFieldLooseBase(e,Be)[Be]();return babelHelpers.classPrivateFieldLooseBase(e,Fe)[Fe]()},buttons({cancelButton:t,SaveButton:s}){babelHelpers.classPrivateFieldLooseBase(e,_)[_]=new s({onclick:()=>babelHelpers.classPrivateFieldLooseBase(e,_e)[_e]()});return[babelHelpers.classPrivateFieldLooseBase(e,_)[_]]}})},events:{onClose:e=>{if(babelHelpers.classPrivateFieldLooseBase(this,E)[E]){e.denyAction()}babelHelpers.classPrivateFieldLooseBase(this,ge)[ge]()}}})}function gt(){return babelHelpers.classPrivateFieldLooseBase(this,T)[T].remember("multiDocumentAddSidePanelContent",(()=>t.Tag.render(P||(P=v`
			<div id="multiple-document-add-container" style="display: flex; flex-direction: column;">
				<div style="flex-direction: row;">
					${0}
					${0}
				</div>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,De)[De]().root,babelHelpers.classPrivateFieldLooseBase(this,He)[He]())))}function Ht(){return babelHelpers.classPrivateFieldLooseBase(this,T)[T].remember("uploader",(()=>new m.Uploader({id:"sign-settings-uploader",controller:"sign.upload.blankUploadController",acceptedFileTypes:[...F.values()].map((e=>`.${e}`)),multiple:true,autoUpload:false,maxFileSize:52428800,imageMaxFileSize:10485760,maxTotalFileSize:52428800,events:{[m.UploaderEvent.BEFORE_FILES_ADD]:e=>babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe](e),[m.UploaderEvent.FILE_ADD]:e=>babelHelpers.classPrivateFieldLooseBase(this,Te)[Te](e.getData().file),[m.UploaderEvent.UPLOAD_COMPLETE]:e=>babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee](e)}})))}function Dt(){babelHelpers.classPrivateFieldLooseBase(this,T)[T].delete("uploader");babelHelpers.classPrivateFieldLooseBase(this,T)[T].delete("uploadButton");babelHelpers.classPrivateFieldLooseBase(this,T)[T].delete("uploadFromDirButton");babelHelpers.classPrivateFieldLooseBase(this,T)[T].delete("multiDocumentAddSidePanelContent")}function It(){return babelHelpers.classPrivateFieldLooseBase(this,T)[T].remember("uploadButton",(()=>{const e=t.Tag.render(S||(S=v`
				<div>
					<button class="ui-btn ui-btn-light-border" style="margin-top: 15px;" onclick="${0}">${0}</button>
					<input ref="fileInput" hidden type="file" multiple ref="fileInput" onchange="${0}"
						accept="${0}"
					>
				</div>
			`),(()=>e.fileInput.click()),t.Loc.getMessage("SIGN_V2_B2E_SIGN_SETTINGS_ADD_FILE"),(e=>{babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie](e);e.target.value=""}),[...F.values()].map((e=>`.${e}`)).join(", "));return e.root}))}function Tt(){return babelHelpers.classPrivateFieldLooseBase(this,T)[T].remember("uploadFromDirButton",(()=>{const e=t.Tag.render(f||(f=v`
				<div>
					<button class="ui-btn ui-btn-primary" style="margin-top: 15px;" onclick="${0}">${0}</button>
					<input hidden type="file" webkitdirectory multiple ref="fileInput" onchange="${0}">
				</div>
			`),(()=>e.fileInput.click()),t.Loc.getMessage("SIGN_V2_B2E_SIGN_SETTINGS_LOAD_FROM_DIRS"),(e=>{babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie](e);e.target.value=""}));return e}))}function _t(e){const t=e.target;const s=t.files;const i=[...s].filter((e=>F.has(e.name.split(".").at(-1))));babelHelpers.classPrivateFieldLooseBase(this,Be)[Be]().addFiles(i)}function Et(e){t.Dom.insertAfter(t.Tag.render(L||(L=v`<p style="color: #666">${0}</p>`),t.Loc.getMessage("SIGN_V2_B2E_SIGN_SETTINGS_LOADED_FILE_NAME",{"#FILENAME#":t.Text.encode(e.getName())})),babelHelpers.classPrivateFieldLooseBase(this,He)[He]())}function Ot(){if(babelHelpers.classPrivateFieldLooseBase(this,Be)[Be]().getFiles().length===0){alert(t.Loc.getMessage("SIGN_V2_B2E_SIGN_SETTINGS_NO_FILES_SELECTED"));return}t.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe](),{opacity:.6,"pointer-events":"none"});babelHelpers.classPrivateFieldLooseBase(this,E)[E]=true;babelHelpers.classPrivateFieldLooseBase(this,Be)[Be]().start();babelHelpers.classPrivateFieldLooseBase(this,_)[_].setClocking(true)}async function wt(e){const s=babelHelpers.classPrivateFieldLooseBase(this,Be)[Be]();for(const e of s.getFiles()){try{const t=await this.documentSetup.blankSelector.createBlankFromOuterUploaderFiles([e]);this.documentSetup.blankSelector.selectBlank(t);await this.setDocumentsGroup()}catch(t){console.error(`Error while add file with name ${e.getName()}`,t)}}t.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe](),{opacity:1,"pointer-events":"auto"});babelHelpers.classPrivateFieldLooseBase(this,E)[E]=false;babelHelpers.classPrivateFieldLooseBase(this,_)[_].setClocking(false);BX.SidePanel.Instance.close()}function Gt(e){const s={maxFileSize:52428800,imageMaxFileSize:10485760,maxTotalFileSize:52428800};const i=e.getData();const a=i.files;const o=babelHelpers.classPrivateFieldLooseBase(this,Be)[Be]();const l=[...a,...o.getFiles()];if(l.length+this.documentsGroup.size>babelHelpers.classPrivateFieldLooseBase(this,I)[I]){alert(t.Loc.getMessage("SIGN_V2_B2E_SIGN_SETTINGS_MAX_DOCUMENTS_COUNT_EXCEEDED"));e.preventDefault();return}for(const i of a){if(i.getSize()>s.maxFileSize){alert(t.Loc.getMessage("SIGN_V2_B2E_SIGN_SETTINGS_INVALID_FILE_SIZE"));e.preventDefault();return}if(i.isImage()&&i.getSize()>s.imageMaxFileSize){alert(t.Loc.getMessage("SIGN_V2_B2E_SIGN_SETTINGS_INVALID_IMAGE_FILE_SIZE"));e.preventDefault();return}}const r=l.reduce(((e,t)=>e+t.getSize()),0);if(r>s.maxTotalFileSize){alert(t.Loc.getMessage("SIGN_V2_B2E_SIGN_SETTINGS_MAX_TOTAL_FILE_SIZE_EXCEEDED"));e.preventDefault()}}function Mt(e){return e&&e!==a.ProviderCode.sesRu}e.B2ESignSettings=Ge})(this.BX.Sign.V2.B2e=this.BX.Sign.V2.B2e||{},BX,BX.Cache,BX.Sign,BX.Sign,BX.Sign.V2,BX.Sign.V2.B2e,BX.Sign.V2.B2e,BX.Sign.V2.B2e,BX.Sign.V2.B2e,BX.Sign.V2.B2e,BX.Sign.V2,BX.Sign.V2,BX.Sign.V2,BX.UI.SidePanel,BX.UI.Uploader);
//# sourceMappingURL=sign-settings.bundle.map.js