this.BX=this.BX||{};this.BX.Sign=this.BX.Sign||{};this.BX.Sign.V2=this.BX.Sign.V2||{};(function(e,s,t,i,a,r){"use strict";const l={name:"UserPartyApp",props:{userParty:{type:Object,required:true},region:{type:String,required:true}},mounted(){const e=this.userParty.getLayout(this.region);this.$refs.userPartyContainer.appendChild(e)},template:`\n\t\t<div ref="userPartyContainer" class="sign-b2e-user-party-container"></div>\n\t`};let o=e=>e,n;var c=babelHelpers.classPrivateFieldLooseKey("app");var b=babelHelpers.classPrivateFieldLooseKey("vueApp");var d=babelHelpers.classPrivateFieldLooseKey("container");var u=babelHelpers.classPrivateFieldLooseKey("userParty");var p=babelHelpers.classPrivateFieldLooseKey("store");var v=babelHelpers.classPrivateFieldLooseKey("api");var P=babelHelpers.classPrivateFieldLooseKey("createApp");var h=babelHelpers.classPrivateFieldLooseKey("updatePartiesCountInStore");var B=babelHelpers.classPrivateFieldLooseKey("waitForDepartmentSync");var y=babelHelpers.classPrivateFieldLooseKey("syncMembersWithDepartments");var F=babelHelpers.classPrivateFieldLooseKey("sleep");var L=babelHelpers.classPrivateFieldLooseKey("getB2eSignersCountLimit");var m=babelHelpers.classPrivateFieldLooseKey("getRegion");class H{constructor(e){Object.defineProperty(this,m,{value:O});Object.defineProperty(this,L,{value:j});Object.defineProperty(this,F,{value:X});Object.defineProperty(this,y,{value:w});Object.defineProperty(this,B,{value:S});Object.defineProperty(this,h,{value:f});Object.defineProperty(this,P,{value:g});Object.defineProperty(this,c,{writable:true,value:void 0});Object.defineProperty(this,b,{writable:true,value:void 0});Object.defineProperty(this,d,{writable:true,value:void 0});Object.defineProperty(this,u,{writable:true,value:void 0});Object.defineProperty(this,p,{writable:true,value:void 0});Object.defineProperty(this,v,{writable:true,value:void 0});const s=babelHelpers.classPrivateFieldLooseBase(this,L)[L]();const i=babelHelpers.classPrivateFieldLooseBase(this,m)[m]();babelHelpers.classPrivateFieldLooseBase(this,p)[p]=e;babelHelpers.classPrivateFieldLooseBase(this,u)[u]=new a.UserParty({mode:"edit",b2eSignersLimitCount:s,region:i});babelHelpers.classPrivateFieldLooseBase(this,v)[v]=new t.Api}async syncMembers(){const e=r.useDocumentTemplateFillingStore();const s=e.createdDocuments;const t=s.map((e=>e.document.id));const{shouldCheckDepartmentsSync:i,documents:a}=await babelHelpers.classPrivateFieldLooseBase(this,v)[v].template.setupSigners(t,babelHelpers.classPrivateFieldLooseBase(this,u)[u].getEntities());babelHelpers.classPrivateFieldLooseBase(this,h)[h](a);if(i){await babelHelpers.classPrivateFieldLooseBase(this,B)[B]()}}getLayout(){if(babelHelpers.classPrivateFieldLooseBase(this,d)[d]){return babelHelpers.classPrivateFieldLooseBase(this,d)[d]}babelHelpers.classPrivateFieldLooseBase(this,d)[d]=BX.Tag.render(n||(n=o`<div></div>`));babelHelpers.classPrivateFieldLooseBase(this,P)[P](babelHelpers.classPrivateFieldLooseBase(this,d)[d]);return babelHelpers.classPrivateFieldLooseBase(this,d)[d]}validate(){if(!babelHelpers.classPrivateFieldLooseBase(this,u)[u].validate()){return false}const e=babelHelpers.classPrivateFieldLooseBase(this,L)[L]();if(e>0&&babelHelpers.classPrivateFieldLooseBase(this,u)[u].getUniqueUsersCount()>e){top.BX.UI.InfoHelper.show("limit_office_e_signature");return false}return true}unmount(){var e;this.closeCounterGuide();(e=babelHelpers.classPrivateFieldLooseBase(this,c)[c])==null?void 0:e.unmount()}closeCounterGuide(){babelHelpers.classPrivateFieldLooseBase(this,u)[u].closeCounterGuide()}}function g(e){babelHelpers.classPrivateFieldLooseBase(this,c)[c]=i.BitrixVue.createApp(l,{userParty:babelHelpers.classPrivateFieldLooseBase(this,u)[u],region:babelHelpers.classPrivateFieldLooseBase(this,m)[m]()});babelHelpers.classPrivateFieldLooseBase(this,c)[c].use(babelHelpers.classPrivateFieldLooseBase(this,p)[p]);babelHelpers.classPrivateFieldLooseBase(this,b)[b]=babelHelpers.classPrivateFieldLooseBase(this,c)[c].mount(e)}function f(e){r.useDocumentTemplateFillingStore().createdDocuments.forEach((s=>{const t=s.document;const i=t.id;const a=e.find((e=>e.id===i));if(!a){throw new Error("Created document not found in update parties documents")}t.parties=a.parties}))}async function S(){const e=r.useDocumentTemplateFillingStore().createdDocuments;const s=e.map((e=>babelHelpers.classPrivateFieldLooseBase(this,y)[y](e.document.uid,e.document.parties)));await Promise.all(s)}async function w(e,s){let t=false;while(!t){const i=await babelHelpers.classPrivateFieldLooseBase(this,v)[v].syncB2eMembersWithDepartments(e,s);t=i.syncFinished;await babelHelpers.classPrivateFieldLooseBase(this,F)[F](1e3)}}function X(e){return new Promise((s=>{setTimeout(s,e)}))}function j(){return s.Extension.getSettings("sign.v2.b2e.document-template-user-party").get("signersLimitCount")}function O(){return s.Extension.getSettings("sign.v2.b2e.document-template-user-party").get("region")}e.DocumentTemplateUserParty=H})(this.BX.Sign.V2.B2e=this.BX.Sign.V2.B2e||{},BX,BX.Sign.V2,BX.Vue3,BX.Sign.V2.B2e,BX.Sign.V2.B2e);
//# sourceMappingURL=document-template-user-party.bundle.map.js