{"version":3,"file":"sign-settings.bundle.js","sources":["../src/index.js"],"sourcesContent":["import { Dom, Loc, Tag, Text, Type } from 'main.core';\nimport { MemoryCache } from 'main.core.cache';\nimport { type BaseEvent } from 'main.core.events';\nimport { FeatureStorage } from 'sign.feature-storage';\nimport { DocumentInitiated, type DocumentInitiatedType, MemberRole, ProviderCode, ProviderCodeType } from 'sign.type';\nimport { Api, type SetupMember } from 'sign.v2.api';\nimport type { ProviderSelectedEvent, CompanySelectedEvent } from 'sign.v2.b2e.company-selector';\nimport { DocumentSend } from 'sign.v2.b2e.document-send';\nimport { DocumentSetup } from 'sign.v2.b2e.document-setup';\nimport { Parties as CompanyParty } from 'sign.v2.b2e.parties';\nimport { RegionalSettings } from 'sign.v2.b2e.regional-settings';\nimport { type CardItem, UserParty } from 'sign.v2.b2e.user-party';\nimport { type DocumentDetails } from 'sign.v2.document-setup';\nimport { SectionType } from 'sign.v2.editor';\nimport { SignSettingsItemCounter } from 'sign.v2.helper';\nimport {\n\tdecorateResultBeforeCompletion,\n\tisTemplateMode,\n\ttype SignOptions,\n\ttype SignOptionsConfig,\n\tSignSettings,\n} from 'sign.v2.sign-settings';\nimport { type SaveButton } from 'ui.buttons';\nimport { Layout } from 'ui.sidepanel.layout';\nimport { Uploader, UploaderEvent, UploaderFile } from 'ui.uploader.core';\nimport type { Metadata } from 'ui.wizard';\nimport { B2EFeatureConfig } from './type';\nimport { EntityType } from 'sign.type';\nimport { SignDropdown } from 'sign.v2.b2e.sign-dropdown';\n\nimport './style.css';\n\nexport type { B2EFeatureConfig };\n\ntype SetupMembersResponse = {\n\tmembers: Array<SetupMember>,\n\tcurrentParty: number,\n};\n\ntype PartiesDetails = {\n\tentityId: number,\n\tentityTypeId: number,\n\tpart: number,\n\tpresetId: number,\n\trole: string,\n\tuid: string\n}\n\nconst acceptedUploaderFileTypes: Set<string> = new Set([\n\t'jpg',\n\t'jpeg',\n\t'png',\n\t'pdf',\n\t'doc',\n\t'docx',\n\t'rtf',\n\t'odt',\n]);\n\nexport class B2ESignSettings extends SignSettings\n{\n\t#companyParty: CompanyParty;\n\t#regionalSettings: RegionalSettings;\n\t#userParty: UserParty;\n\t#api: Api;\n\tdocumentSetup: DocumentSetup;\n\teditedDocument: DocumentDetails | null;\n\t#maxDocumentCount: boolean;\n\t#cache: MemoryCache<any> = new MemoryCache();\n\t#saveButton: SaveButton;\n\t#isMultiDocumentSaveProcessGone: boolean = false;\n\t#needSkipEditorStep: boolean;\n\t#previewDocumentDropdown: HTMLElement | null = null;\n\n\tconstructor(containerId: string, signOptions: SignOptions)\n\t{\n\t\tsuper(containerId, signOptions, {\n\t\t\tnext: {\n\t\t\t\tclassName: 'ui-btn-success',\n\t\t\t},\n\t\t\tcomplete: { className: 'ui-btn-success' },\n\t\t\tswapButtons: true,\n\t\t});\n\t\tconst {\n\t\t\tb2eFeatureConfig,\n\t\t\tblankSelectorConfig,\n\t\t\tdocumentSendConfig,\n\t\t\tuserPartyConfig,\n\t\t} = this.#prepareConfig(signOptions);\n\n\t\tthis.documentSetup = new DocumentSetup(blankSelectorConfig);\n\t\tthis.documentSend = new DocumentSend(documentSendConfig);\n\t\tthis.#companyParty = new CompanyParty({\n\t\t\t...blankSelectorConfig,\n\t\t\tdocumentInitiatedType: signOptions.initiatedByType,\n\t\t\tdocumentMode: signOptions.documentMode,\n\t\t}, b2eFeatureConfig.hcmLinkAvailable);\n\t\tthis.#regionalSettings = new RegionalSettings({\n\t\t\ttemplateMode: this.isTemplateMode(),\n\t\t\tregionDocumentTypes: blankSelectorConfig.regionDocumentTypes,\n\t\t});\n\n\t\tthis.#regionalSettings.isIntegrationVisible = !(this.isTemplateMode()\n\t\t\t&& signOptions.initiatedByType === DocumentInitiated.employee);\n\n\t\tthis.#api = new Api();\n\t\tthis.#maxDocumentCount = signOptions.b2eDocumentLimitCount;\n\t\tthis.#userParty = new UserParty({ mode: 'edit', ...userPartyConfig });\n\t\tthis.subscribeOnEvents();\n\t\tthis.#needSkipEditorStep = documentSendConfig.needSkipEditorStep;\n\n\t\tthis.editor.setIsB2eDocumentSectionDisabled(!this.documentSetup.isRuRegion());\n\t\tthis.editor.setSectionVisibilityByType(SectionType.HcmLinkIntegration, false);\n\n\t\tthis.#companyParty.subscribe('onCompanySelect', (event: CompanySelectedEvent) => {\n\t\t\tthis.documentSend.setProvider(event.data.provider);\n\t\t\tthis.#regionalSettings.isIntegrationEnabled = this.#isIntegrationEnabled(event.data?.provider?.code);\n\t\t});\n\t\tthis.#companyParty.subscribe('onProviderSelect', (event: ProviderSelectedEvent) => {\n\t\t\tthis.documentSend.setProvider(event.data.provider);\n\t\t\tthis.#regionalSettings.isIntegrationEnabled = this.#isIntegrationEnabled(event.data?.provider?.code);\n\t\t});\n\t\tthis.#createPreviewDocumentDropdown();\n\t}\n\n\t#prepareConfig(signOptions: SignOptions): SignOptionsConfig\n\t{\n\t\tconst {\n\t\t\tconfig,\n\t\t\tdocumentMode,\n\t\t\tfromRobot,\n\t\t\tfromTemplateFolder,\n\t\t\tb2eDocumentLimitCount,\n\t\t\ttemplateFolderId,\n\t\t\tisOpenedAsFolder,\n\t\t\tinitiatedByType,\n\t\t} = signOptions;\n\n\t\tconst { blankSelectorConfig, documentSendConfig } = config;\n\t\tblankSelectorConfig.documentMode = documentMode;\n\t\tblankSelectorConfig.isOpenedFromRobot = fromRobot;\n\t\tblankSelectorConfig.b2eDocumentLimitCount = b2eDocumentLimitCount;\n\t\tblankSelectorConfig.isOpenedFromTemplateFolder = fromTemplateFolder;\n\t\tblankSelectorConfig.templateFolderId = templateFolderId;\n\t\tblankSelectorConfig.isOpenedAsFolder = isOpenedAsFolder;\n\t\tblankSelectorConfig.initiatedByType = initiatedByType;\n\t\tdocumentSendConfig.documentMode = documentMode;\n\t\tdocumentSendConfig.isOpenedFromRobot = fromRobot;\n\t\tdocumentSendConfig.templateFolderId = templateFolderId;\n\n\t\treturn config;\n\t}\n\n\tsubscribeOnEvents(): void\n\t{\n\t\tsuper.subscribeOnEvents();\n\t\tthis.documentSend.subscribe('changeTitle', ({ data }) => {\n\t\t\tconst title = data?.title;\n\t\t\tif (!title)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst uid = data?.uid;\n\t\t\tif (!uid)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst encodedTitle = Text.encode(title);\n\n\t\t\tthis.documentSetup.setDocumentTitle(encodedTitle);\n\t\t\tif (!this.isGroupDocuments())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.documentsGroup.has(uid) === false)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst documentDetails = this.documentsGroup.get(uid);\n\t\t\tdocumentDetails.title = encodedTitle;\n\t\t\tthis.documentsGroup.set(uid, documentDetails);\n\n\t\t\tthis.documentSetup.updateDocumentBlock(documentDetails.id);\n\t\t\tthis.addInDocumentsGroupUids(documentDetails.uid);\n\t\t\tthis.#regionalSettings.documentsGroup = this.documentsGroup;\n\t\t\tconst selectedItemUid = this.#previewDocumentDropdown.getSelectedId();\n\t\t\tthis.#setPreviewDocumentDropdownItems();\n\t\t\tif (!selectedItemUid)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#previewDocumentDropdown.setItemSelected(selectedItemUid);\n\t\t});\n\t\tthis.documentSend.subscribe('disableBack', () => {\n\t\t\tthis.wizard.toggleBtnActiveState('back', true);\n\t\t});\n\t\tthis.documentSend.subscribe('enableBack', () => {\n\t\t\tthis.wizard.toggleBtnActiveState('back', false);\n\t\t});\n\t\tthis.documentSetup.subscribe('addDocument', () => {\n\t\t\tthis.setDocumentsGroup();\n\t\t});\n\t\tthis.documentSetup.subscribe('deleteDocument', ({ data }) => {\n\t\t\tthis.#deleteDocument(data);\n\t\t});\n\t\tthis.documentSetup.subscribe('editDocument', ({ data }) => {\n\t\t\tthis.#editDocumentData(data.uid);\n\t\t});\n\t\tthis.documentSend.subscribe('enableComplete', () => {\n\t\t\tthis.wizard.toggleBtnActiveState('complete', false);\n\t\t});\n\t\tthis.documentSend.subscribe('disableComplete', () => {\n\t\t\tthis.wizard.toggleBtnActiveState('complete', true);\n\t\t});\n\t\tthis.documentSetup.subscribe('documentsLimitExceeded', () => {\n\t\t\tthis.documentSetup.setAvailabilityDocumentSection(false);\n\t\t});\n\t\tthis.documentSetup.subscribe('documentsLimitNotExceeded', () => {\n\t\t\tthis.documentSetup.setAvailabilityDocumentSection(true);\n\t\t});\n\t\tthis.documentSend.subscribe(\n\t\t\tthis.documentSend.events.onTemplateComplete,\n\t\t\t(event: BaseEvent<{ templateId: number }>) => {\n\t\t\t\tif (this.isTemplateMode() && !this.isEditMode())\n\t\t\t\t{\n\t\t\t\t\tconst templateId = event.getData().templateId;\n\t\t\t\t\tthis.getAnalytics().send({\n\t\t\t\t\t\tevent: 'turn_on_off_template',\n\t\t\t\t\t\ttype: 'auto',\n\t\t\t\t\t\tc_element: 'on',\n\t\t\t\t\t\tp5: `templateId_${templateId}`,\n\t\t\t\t\t});\n\t\t\t\t\tthis.getAnalytics().send({\n\t\t\t\t\t\tevent: 'click_save_template',\n\t\t\t\t\t\tc_element: 'create_button',\n\t\t\t\t\t\tp5: `templateId_${templateId}`,\n\t\t\t\t\t\tstatus: 'success',\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t);\n\t\tthis.editor.subscribe('save', ({ data }) => {\n\t\t\tconst uid = data.uid;\n\n\t\t\tif (this.documentsGroup.has(uid) === false)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#previewDocumentDropdown.selectItem(uid);\n\t\t});\n\t}\n\n\tasync #editDocumentData(uid: string): Promise<void>\n\t{\n\t\tif (this.documentsGroup.has(uid) === false)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.documentSetup.editMode)\n\t\t{\n\t\t\tthis.#disableDocumentSectionIfLimitReached();\n\t\t\tthis.#resetDocument();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.editedDocument && this.isGroupDocuments())\n\t\t{\n\t\t\tthis.#setPreviewDocumentDropdownItems();\n\t\t}\n\n\t\tthis.editedDocument = this.documentsGroup.get(uid);\n\t\tthis.documentSetup.setAvailabilityDocumentSection(true);\n\t\tthis.#scrollToDown();\n\t\tthis.documentSetup.setDocumentTitle(this.editedDocument.title);\n\n\t\tif (this.isGroupDocuments() === false)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.renderPages(this.editedDocument, true, false);\n\t\tthis.#previewDocumentDropdown.setItemSelected(uid);\n\t}\n\n\tgetLayoutTemplate(header: HTMLElement, wizard: HTMLElement, preview: HTMLElement): HTMLElement\n\t{\n\t\tconst previewDocumentDropdown = this.#previewDocumentDropdown.getLayout();\n\t\tthis.#togglePreviewDocumentDropdown();\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-settings__scope sign-settings --b2e\">\n\t\t\t\t<div class=\"sign-settings__sidebar\">\n\t\t\t\t\t${header}\n\t\t\t\t\t${wizard}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"sing-settings-preview-block\">\n\t\t\t\t\t${previewDocumentDropdown}\n\t\t\t\t\t${preview}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#createPreviewDocumentDropdown(): void\n\t{\n\t\tthis.#previewDocumentDropdown = new SignDropdown({\n\t\t\ttabs: [{ id: 'sign-preview-document-dropdown', title: ' ' }],\n\t\t\tentities: [],\n\t\t\tclassName: 'sign-preview-document-dropdown',\n\t\t\twithCaption: true,\n\t\t\tisEnableSearch: false,\n\t\t\twidth: 444,\n\t\t});\n\n\t\tthis.#togglePreviewDocumentDropdown();\n\n\t\tthis.#previewDocumentDropdown.subscribe(\n\t\t\t'onSelect',\n\t\t\t(item: BaseEvent) => {\n\t\t\t\tconst uidFromEvent = item.data?.item?.id;\n\n\t\t\t\tif (uidFromEvent === null)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.documentsGroup.has(uidFromEvent) === false)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst documentDetails = this.documentsGroup.get(uidFromEvent);\n\t\t\t\tthis.documentSetup.resetEditMode();\n\t\t\t\tthis.#resetDocument();\n\t\t\t\tthis.documentSetup.setDocumentTitle(documentDetails.title);\n\n\t\t\t\tthis.renderPages(documentDetails, true, false);\n\t\t\t},\n\t\t);\n\t}\n\n\t#setPreviewDocumentDropdownItems(): void\n\t{\n\t\tconst selectedUid = this.documentSetup?.setupData?.uid;\n\n\t\tif (selectedUid === null)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#previewDocumentDropdown.removeItems();\n\t\tthis.documentsGroupUids.forEach((uid) => {\n\t\t\tif (this.documentsGroup.has(uid) === false)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst documentDetails = this.documentsGroup.get(uid);\n\t\t\tthis.#previewDocumentDropdown.addItem({\n\t\t\t\tid: documentDetails.uid,\n\t\t\t\ttitle: documentDetails.title,\n\t\t\t\tentityId: 'b2e-document-detail',\n\t\t\t\ttabs: 'sign-preview-document-dropdown',\n\t\t\t\tdeselectable: false,\n\t\t\t});\n\t\t});\n\n\t\tthis.#previewDocumentDropdown.setItemSelected(selectedUid);\n\t}\n\n\tasync setDocumentsGroup(): Promise<void>\n\t{\n\t\tif (this.documentSetup.blankIsNotSelected || !this.documentSetup.validate())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.documentSetup.switchAddDocumentButtonLoadingState(true);\n\t\ttry\n\t\t{\n\t\t\tconst documentData = await this.setupDocument();\n\t\t\tthis.documentsGroup.set(documentData.uid, documentData);\n\t\t\tthis.addInDocumentsGroupUids(documentData.uid);\n\n\t\t\tthis.documentSetup.blankSelector.disableSelectedBlank(documentData.blankId);\n\n\t\t\tawait this.#attachGroupToDocument(documentData);\n\t\t\tthis.documentSetup.switchAddDocumentButtonLoadingState(false);\n\n\t\t\tif (this.editedDocument)\n\t\t\t{\n\t\t\t\tlet uid = documentData.uid;\n\t\t\t\tif (\n\t\t\t\t\t(this.documentSetup.blankIsNotSelected || documentData.blankId === this.editedDocument.blankId)\n\t\t\t\t\t&& !this.documentSetup.isFileAdded\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tuid = this.editedDocument.uid;\n\t\t\t\t}\n\t\t\t\tawait this.#handleEditedDocument(documentData).then(() => {\n\t\t\t\t\tthis.#previewDocumentDropdown.selectItem(uid);\n\t\t\t\t}).catch(() => {});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.documentSetup.renderDocumentBlock(documentData);\n\t\t\t\tif (this.isGroupDocuments())\n\t\t\t\t{\n\t\t\t\t\tthis.#setPreviewDocumentDropdownItems();\n\t\t\t\t}\n\n\t\t\t\tthis.#togglePreviewDocumentDropdown();\n\t\t\t}\n\t\t}\n\t\tcatch\n\t\t{\n\t\t\tthis.documentSetup.switchAddDocumentButtonLoadingState(false);\n\t\t}\n\n\t\tthis.#scrollToTop();\n\t\tthis.documentSetup.documentCounters.update(this.documentsGroup.size);\n\t\tthis.#resetDocument();\n\t\tthis.wizard.toggleBtnActiveState('next', false);\n\t}\n\n\taddInDocumentsGroupUids(uid: string): void\n\t{\n\t\tif (!this.documentsGroupUids.includes(uid))\n\t\t{\n\t\t\tthis.documentsGroupUids.push(uid);\n\t\t}\n\t}\n\n\tasync #handleEditedDocument(documentData): Promise<void>\n\t{\n\t\tif (\n\t\t\t(this.documentSetup.blankIsNotSelected || documentData.blankId === this.editedDocument.blankId)\n\t\t\t&& !this.documentSetup.isFileAdded\n\t\t)\n\t\t{\n\t\t\tthis.documentSetup.resetEditMode();\n\t\t\tawait this.#saveUpdatedDocumentData(this.editedDocument.uid);\n\t\t\tif (this.isGroupDocuments())\n\t\t\t{\n\t\t\t\tawait this.#setPreviewDocumentDropdownItems();\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.deleteFromDocumentsGroupUids(documentData.uid);\n\t\tthis.replaceInDocumentsGroupUids(this.editedDocument.uid, documentData.uid);\n\t\tthis.documentSetup.replaceDocumentBlock(this.editedDocument, documentData);\n\t\tawait this.#deleteDocument(this.editedDocument);\n\t\tawait this.#attachGroupToDocument(documentData);\n\n\t\tthis.editor.setUrls([]);\n\t}\n\n\treplaceInDocumentsGroupUids(oldUid: string, newUid: string): void\n\t{\n\t\tconst index = this.documentsGroupUids.indexOf(oldUid);\n\t\tif (index !== -1)\n\t\t{\n\t\t\tthis.documentsGroupUids.splice(index, 1, newUid);\n\t\t}\n\t}\n\n\tdeleteFromDocumentsGroupUids(uid: string)\n\t{\n\t\tconst index = this.documentsGroupUids.indexOf(uid);\n\n\t\tif (index === -1)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.documentsGroupUids.splice(index, 1);\n\t}\n\n\t#removeDocumentElement(documentId): void\n\t{\n\t\tconst deletedElement = this.documentSetup.layout.querySelector(`[data-id=\"document-id-${documentId}\"]`);\n\t\tdeletedElement?.remove();\n\t}\n\n\tasync #attachGroupToDocument(documentData): Promise<void>\n\t{\n\t\tif (!this.groupId)\n\t\t{\n\t\t\tconst { groupId } = await this.#api.createDocumentsGroup();\n\t\t\tthis.groupId = groupId;\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tconst targetDocument = this.documentsGroup.get(documentData.uid);\n\n\t\t\tif (targetDocument && !targetDocument.groupId)\n\t\t\t{\n\t\t\t\tawait this.#api.attachGroupToDocument(documentData.uid, this.groupId);\n\t\t\t\ttargetDocument.groupId = this.groupId;\n\t\t\t}\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error(error);\n\t\t}\n\t}\n\n\tasync #saveUpdatedDocumentData(uid: string): Promise<void>\n\t{\n\t\tconst updatedDocumentData = await this.documentSetup.updateDocumentData(this.editedDocument);\n\t\tthis.documentSetup.updateDocumentBlock(this.editedDocument.id);\n\n\t\tif (uid)\n\t\t{\n\t\t\tthis.documentsGroup.set(this.editedDocument.uid, updatedDocumentData);\n\t\t\tthis.addInDocumentsGroupUids(this.editedDocument.uid);\n\t\t\tthis.documentSend.setDocumentsBlock(this.documentsGroup);\n\t\t\tthis.#regionalSettings.documentsGroup = this.documentsGroup;\n\t\t}\n\t}\n\n\t#togglePreviewDocumentDropdown(): void\n\t{\n\t\tif (this.isGroupDocuments())\n\t\t{\n\t\t\tthis.#previewDocumentDropdown.show();\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#previewDocumentDropdown.hide();\n\t}\n\n\tasync #deleteDocument(data: { blankId: number, deletedButton: HTMLElement, id: number, uid: string }): Promise<void>\n\t{\n\t\tconst { id, uid, blankId, deleteButton } = data;\n\t\tthis.documentSetup.ready = false;\n\n\t\tif (this.documentsGroup.has(uid) === false)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tawait this.#api.removeDocument(uid);\n\t\t\tthis.documentSetup.ready = true;\n\n\t\t\tif (this.isFirstDocumentSelected(uid))\n\t\t\t{\n\t\t\t\tthis.resetPreview();\n\t\t\t\tthis.hasPreviewUrls = false;\n\t\t\t}\n\t\t\tthis.#removeDocumentElement(id);\n\t\t\tthis.documentSend.deleteDocument(uid);\n\t\t\tthis.documentsGroup.delete(uid);\n\t\t\tthis.deleteFromDocumentsGroupUids(uid);\n\t\t\tthis.documentSetup.blankSelector.enableSelectedBlank(blankId);\n\t\t\tthis.documentSetup.deleteDocumentFromList(blankId);\n\t\t\tthis.documentSetup.documentCounters?.update(this.documentsGroup.size);\n\t\t\tthis.documentSetup.resetEditMode();\n\n\t\t\tif (this.documentsGroup.size === 0)\n\t\t\t{\n\t\t\t\tthis.wizard.toggleBtnActiveState('next', true);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.documentSetup.setupData = this.getFirstDocumentDataFromGroup();\n\t\t\t}\n\n\t\t\tif (this.documentsGroup.size === 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst lastDocumentDetails = [...this.documentsGroup.values()].pop();\n\t\t\tawait this.renderPages(lastDocumentDetails, false, false);\n\n\t\t\tif (this.isGroupDocuments())\n\t\t\t{\n\t\t\t\tthis.#setPreviewDocumentDropdownItems();\n\t\t\t}\n\n\t\t\tthis.#togglePreviewDocumentDropdown();\n\n\t\t\tthis.#resetDocument();\n\t\t}\n\t\tcatch\n\t\t{\n\t\t\tthis.documentSetup.toggleDeleteBtnLoadingState(deleteButton);\n\t\t\tthis.documentSetup.ready = true;\n\t\t}\n\t}\n\n\tasync #setupParties(): Promise<Array<PartiesDetails>>\n\t{\n\t\tconst { representative } = this.#companyParty.getParties();\n\t\tconst { members, signerParty } = this.#makeSetupMembers();\n\n\t\tconst documentUids = [...this.documentsGroup.keys()];\n\t\tfor (const documentUid of documentUids)\n\t\t{\n\t\t\t// eslint-disable-next-line no-await-in-loop\n\t\t\tawait this.#api.setupB2eParties(documentUid, representative.entityId, members);\n\t\t}\n\t\tconst uid = this.#documentUid;\n\t\tconst membersData = await this.#api.loadMembers(uid);\n\t\tif (!Type.isArrayFilled(membersData))\n\t\t{\n\t\t\tthrow new Error('Members are empty');\n\t\t}\n\n\t\tconst syncMemberPromises = documentUids.map((uid) => this.#syncMembersWithDepartments(uid, signerParty));\n\t\tawait Promise.all(syncMemberPromises);\n\n\t\treturn membersData.map((memberData) => {\n\t\t\treturn {\n\t\t\t\tpresetId: memberData?.presetId,\n\t\t\t\tpart: memberData?.party,\n\t\t\t\tuid: memberData?.uid,\n\t\t\t\tentityTypeId: memberData?.entityTypeId ?? null,\n\t\t\t\tentityId: memberData?.entityId ?? null,\n\t\t\t\trole: memberData?.role ?? null,\n\t\t\t};\n\t\t});\n\t}\n\n\t#isTemplateModeForCompany(): boolean\n\t{\n\t\tconst isInitiatedByCompany = this.documentSetup.setupData.initiatedByType === DocumentInitiated.company;\n\n\t\treturn isTemplateMode(this.documentMode) && isInitiatedByCompany;\n\t}\n\n\tasync #syncMembersWithDepartments(uid: string, signerParty: number): Promise<void>\n\t{\n\t\tlet syncFinished = false;\n\t\twhile (!syncFinished)\n\t\t{\n\t\t\t// eslint-disable-next-line no-await-in-loop\n\t\t\tconst response = await this.#api.syncB2eMembersWithDepartments(uid, signerParty);\n\t\t\tsyncFinished = response.syncFinished;\n\t\t\t// eslint-disable-next-line no-await-in-loop\n\t\t\tawait this.#sleep(1000);\n\t\t}\n\t}\n\n\t#sleep(ms: Number): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tsetTimeout(resolve, ms);\n\t\t});\n\t}\n\n\tget #documentUid(): string\n\t{\n\t\treturn this.documentSetup.setupData.uid;\n\t}\n\n\tget #isDocumentInitiatedByEmployee(): DocumentInitiatedType\n\t{\n\t\treturn this.documentSetup.setupData.initiatedByType === DocumentInitiated.employee;\n\t}\n\n\t#getAssignee(currentParty: number, companyId: number): SetupMember\n\t{\n\t\tconst { representative } = this.#companyParty.getParties();\n\n\t\tlet type = EntityType.COMPANY;\n\t\tif (representative.entityType !== EntityType.USER)\n\t\t{\n\t\t\ttype = representative.entityType;\n\t\t}\n\n\t\treturn {\n\t\t\tentityType: type,\n\t\t\tentityId: companyId,\n\t\t\tparty: currentParty,\n\t\t\trole: MemberRole.assignee,\n\t\t};\n\t}\n\n\t#getSigner(currentParty: number, entity: CardItem): SetupMember\n\t{\n\t\treturn {\n\t\t\tentityType: entity.entityType,\n\t\t\tentityId: entity.entityId,\n\t\t\tparty: currentParty,\n\t\t\trole: MemberRole.signer,\n\t\t};\n\t}\n\n\t#makeSetupMembers(): SetupMembersResponse\n\t{\n\t\tconst { company, validation } = this.#companyParty.getParties();\n\n\t\tconst userPartyEntities = this.#userParty.getEntities();\n\n\t\tlet currentParty = this.#isDocumentInitiatedByEmployee ? 2 : 1;\n\n\t\tconst members = validation.map((item): SetupMember => {\n\t\t\tconst result = { ...item, party: currentParty };\n\t\t\tcurrentParty++;\n\n\t\t\treturn result;\n\t\t});\n\n\t\tmembers.push(this.#getAssignee(currentParty, company.entityId));\n\n\t\tlet signerParty = currentParty;\n\t\tif (this.isDocumentMode())\n\t\t{\n\t\t\tsignerParty = this.#isDocumentInitiatedByEmployee ? 1 : currentParty + 1;\n\t\t\tconst signers = userPartyEntities.map((entity) => this.#getSigner(signerParty, entity));\n\t\t\tmembers.push(...signers);\n\t\t}\n\n\t\treturn { members, signerParty };\n\t}\n\n\t#parseMembers(loadedMembers: SetupMember[]): { [$Keys<typeof MemberRole>]: number[]; }\n\t{\n\t\treturn loadedMembers.reduce((acc, member) => {\n\t\t\tconst { entityType, entityId } = member;\n\t\t\tif (entityType !== EntityType.USER && entityType !== EntityType.STRUCTURE_NODE_ROLE)\n\t\t\t{\n\t\t\t\treturn acc;\n\t\t\t}\n\n\t\t\tconst role = `${member.role}s`;\n\n\t\t\treturn {\n\t\t\t\t...acc,\n\t\t\t\t[role]: [\n\t\t\t\t\t...acc[role] ?? [],\n\t\t\t\t\tentityId,\n\t\t\t\t],\n\t\t\t};\n\t\t}, {});\n\t}\n\n\tasync applyDocumentData(uid: string): Promise<boolean>\n\t{\n\t\tconst setupData = await this.setupDocument(uid, true);\n\t\tif (!setupData)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (setupData.groupId)\n\t\t{\n\t\t\tconst documentsGroupData = await this.#api.getDocumentListInGroup(setupData.groupId);\n\t\t\tfor (const item of documentsGroupData)\n\t\t\t{\n\t\t\t\tthis.addInDocumentsGroupUids(item.uid);\n\n\t\t\t\tconst blocks = await this.#api.loadBlocksByDocument(item.uid);\n\t\t\t\tconst updatedItem = { ...item, blocks };\n\t\t\t\tthis.documentsGroup.set(item.uid, updatedItem);\n\t\t\t\tthis.documentSetup.renderDocumentBlock(updatedItem);\n\t\t\t\tthis.documentSetup.blankSelector.disableSelectedBlank(updatedItem.blankId);\n\t\t\t}\n\t\t\tthis.groupId = setupData.groupId;\n\t\t\tthis.documentSetup.documentCounters?.update(this.documentsGroup.size);\n\t\t\tthis.#resetDocument();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.documentsGroup.set(setupData.uid, setupData);\n\t\t\tthis.addInDocumentsGroupUids(setupData.uid);\n\t\t}\n\n\t\tconst firstDocument = this.getFirstDocumentDataFromGroup();\n\t\tconst { entityId, representativeId, companyUid, companyEntityId, hcmLinkCompanyId } = firstDocument;\n\t\tthis.documentSend.documentData = this.documentsGroup;\n\n\t\tthis.#disableDocumentSectionIfLimitReached();\n\n\t\tif (this.isSingleDocument())\n\t\t{\n\t\t\tthis.editor.documentData = firstDocument;\n\t\t}\n\n\t\tconst members = await this.#api.loadMembers(uid);\n\n\t\tif (representativeId)\n\t\t{\n\t\t\tconst memberEntityType = this.#getMemberEntityTypeByRole(members, MemberRole.assignee);\n\t\t\tthis.#companyParty.loadRepresentative(representativeId, memberEntityType);\n\t\t}\n\n\t\tconst parsedMembers = this.#parseMembers(members);\n\t\tconst { signers = [], assignees = [] } = parsedMembers;\n\n\t\tthis.#companyParty.setEntityId(entityId);\n\t\tif (companyUid)\n\t\t{\n\t\t\tthis.#regionalSettings.setLastSavedHcmLinkCompanyId(hcmLinkCompanyId);\n\t\t\tthis.#companyParty.loadCompany(\n\t\t\t\tcompanyUid,\n\t\t\t\t// workaround (assignee member) for old drafts/templates\n\t\t\t\tcompanyEntityId ?? assignees[0] ?? null,\n\t\t\t);\n\t\t}\n\n\t\tif (signers.length > 0)\n\t\t{\n\t\t\tthis.#userParty.load(signers);\n\t\t}\n\n\t\tthis.#companyParty.loadValidator(members);\n\n\t\treturn true;\n\t}\n\n\t#getMemberEntityTypeByRole(members: SetupMember[], role: MemberRole): string\n\t{\n\t\tconst member: SetupMember = members.find(\n\t\t\t(setupMemberItem: SetupMember) => setupMemberItem.role === role,\n\t\t);\n\n\t\treturn member?.entityType === EntityType.STRUCTURE_NODE_ROLE ? EntityType.STRUCTURE_NODE_ROLE : EntityType.USER;\n\t}\n\n\tasync applyTemplateData(templateUid: string): Promise<boolean>\n\t{\n\t\tsuper.applyTemplateData(templateUid);\n\n\t\tthis.documentSetup.setupData.templateUid = templateUid;\n\t\tthis.documentSend.setExistingTemplate();\n\n\t\treturn true;\n\t}\n\n\t#getSetupStep(signSettings: B2ESignSettings, documentUid?: string): $Values<Metadata>\n\t{\n\t\treturn {\n\t\t\tget content(): HTMLElement\n\t\t\t{\n\t\t\t\tconst layout = signSettings.documentSetup.layout;\n\t\t\t\tSignSettingsItemCounter.numerate(layout);\n\n\t\t\t\tif (!Type.isNull(signSettings.getAfterPreviewLayout()))\n\t\t\t\t{\n\t\t\t\t\tBX.show(signSettings.getAfterPreviewLayout());\n\t\t\t\t}\n\n\t\t\t\treturn layout;\n\t\t\t},\n\t\t\ttitle: Loc.getMessage('SIGN_SETTINGS_B2B_LOAD_DOCUMENT'),\n\t\t\tbeforeCompletion: async () => {\n\t\t\t\tconst blankIsSelected = this.documentSetup.blankSelector.selectedBlankId !== 0;\n\t\t\t\tif (blankIsSelected || this.documentSetup.isFileAdded)\n\t\t\t\t{\n\t\t\t\t\tconst isValid = this.documentSetup.validate();\n\t\t\t\t\tif (!isValid)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst setupData = await this.setupDocument();\n\t\t\t\tif (!setupData)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tawait this.#addDocumentInGroup(setupData).then(() => {\n\t\t\t\t\tif (this.isGroupDocuments())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#setPreviewDocumentDropdownItems();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.#togglePreviewDocumentDropdown();\n\t\t\t\t}).catch(() => {});\n\t\t\t\tif (this.editedDocument)\n\t\t\t\t{\n\t\t\t\t\tlet uid = setupData.uid;\n\t\t\t\t\tif (\n\t\t\t\t\t\t(this.documentSetup.blankIsNotSelected || setupData.blankId === this.editedDocument.blankId)\n\t\t\t\t\t\t&& !this.documentSetup.isFileAdded\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tuid = this.editedDocument.uid;\n\t\t\t\t\t}\n\n\t\t\t\t\tawait this.#handleEditedDocument(setupData).then(() => {\n\t\t\t\t\t\tthis.#previewDocumentDropdown.selectItem(uid);\n\t\t\t\t\t}).catch(() => {});\n\t\t\t\t}\n\n\t\t\t\tthis.#resetDocument();\n\t\t\t\tthis.#processSetupData();\n\t\t\t\tthis.#disableDocumentSectionIfLimitReached();\n\n\t\t\t\tif (!Type.isNull(this.getAfterPreviewLayout()))\n\t\t\t\t{\n\t\t\t\t\tBX.hide(this.getAfterPreviewLayout());\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t},\n\t\t};\n\t}\n\n\t#getCompanyStep(signSettings: B2ESignSettings): $Values<Metadata>\n\t{\n\t\tconst titleLocCode = this.isTemplateMode()\n\t\t\t? 'SIGN_SETTINGS_B2E_ROUTES'\n\t\t\t: 'SIGN_SETTINGS_B2E_COMPANY'\n\t\t;\n\n\t\treturn {\n\t\t\tget content(): HTMLElement\n\t\t\t{\n\t\t\t\tconst layout = signSettings.#companyParty.getLayout();\n\t\t\t\tconst isTemplateModeForCompany = signSettings.#isTemplateModeForCompany();\n\n\t\t\t\tif (signSettings.isTemplateMode())\n\t\t\t\t{\n\t\t\t\t\tsignSettings.#companyParty.setEditorAvailability(isTemplateModeForCompany);\n\t\t\t\t}\n\t\t\t\tSignSettingsItemCounter.numerate(layout);\n\n\t\t\t\tif (!signSettings.isEditMode())\n\t\t\t\t{\n\t\t\t\t\tif (!signSettings.#companyParty.isRepresentativeSelected())\n\t\t\t\t\t{\n\t\t\t\t\t\tsignSettings.#companyParty.loadFirstRepresentative();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!signSettings.#companyParty.isProviderSelected())\n\t\t\t\t\t{\n\t\t\t\t\t\tsignSettings.#companyParty.loadFirstCompany();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn layout;\n\t\t\t},\n\t\t\ttitle: Loc.getMessage(titleLocCode),\n\t\t\tbeforeCompletion: async () => {\n\t\t\t\tconst { initiatedByType } = this.documentSetup.setupData;\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tfor (const [uid] of this.documentsGroup)\n\t\t\t\t\t{\n\t\t\t\t\t\t// eslint-disable-next-line no-await-in-loop\n\t\t\t\t\t\tawait this.#companyParty.save(uid);\n\t\t\t\t\t}\n\t\t\t\t\tthis.#regionalSettings.companyId = this.#companyParty.getSelectedCompanyId();\n\t\t\t\t\tthis.#regionalSettings.documentsGroup = this.documentsGroup;\n\n\t\t\t\t\tthis.editor.setSenderType(initiatedByType);\n\n\t\t\t\t\tthis.#setSecondPartySectionVisibility();\n\n\t\t\t\t\tif (this.isTemplateMode())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#executeDocumentSendActions();\n\t\t\t\t\t\tthis.#regionalSettings.isIntegrationVisible = !this.#isInitiatedByEmployee();\n\n\t\t\t\t\t\tif (!this.#isRegionalSettingsStepEnabled())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tawait this.#executeTemplateSetupPartyActions();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcatch (e)\n\t\t\t\t{\n\t\t\t\t\tconsole.warn(e);\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t},\n\t\t};\n\t}\n\n\t#getRegionalSettingsStep(signSettings: B2ESignSettings, documentUid: string): $Values<Metadata>\n\t{\n\t\treturn {\n\t\t\tget content(): HTMLElement\n\t\t\t{\n\t\t\t\treturn signSettings.#regionalSettings.getLayout();\n\t\t\t},\n\t\t\ttitle: Loc.getMessage('SIGN_SETTINGS_B2E_REGIONAL_SETTINGS_SHORT'),\n\t\t\tbeforeCompletion: async () => {\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tawait this.#regionalSettings.save();\n\t\t\t\t}\n\t\t\t\tcatch\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tthis.documentSetup.setupData.hcmLinkCompanyId = this.#regionalSettings.getSelectedHcmLinkCompanyId();\n\t\t\t\tthis.documentSend.hcmLinkEnabled = this.documentSetup.setupData.hcmLinkCompanyId > 0;\n\n\t\t\t\tawait this.#setHcmLinkIntegrationSectionVisibility();\n\n\t\t\t\tif (this.isTemplateMode())\n\t\t\t\t{\n\t\t\t\t\tawait this.#executeTemplateSetupPartyActions();\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t},\n\t\t};\n\t}\n\n\t#getEmployeeStep(signSettings: B2ESignSettings): $Values<Metadata>\n\t{\n\t\treturn {\n\t\t\tget content(): HTMLElement\n\t\t\t{\n\t\t\t\tconst layout = signSettings.#userParty.getLayout();\n\t\t\t\tSignSettingsItemCounter.numerate(layout);\n\n\t\t\t\treturn layout;\n\t\t\t},\n\t\t\ttitle: Loc.getMessage('SIGN_SETTINGS_B2E_EMPLOYEES'),\n\t\t\tbeforeCompletion: async () => {\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tconst isValid = this.#userParty.validate();\n\t\t\t\t\tif (!isValid)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn isValid;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.editor.entityData = await this.#setupParties();\n\n\t\t\t\t\tconst { uid, isTemplate, entityId } = this.documentSetup.setupData;\n\t\t\t\t\tconst blocks = await this.documentSetup.loadBlocks(uid);\n\n\t\t\t\t\tthis.#executeDocumentSendActions();\n\n\t\t\t\t\tconst editorData = { isTemplate, uid, blocks, entityId };\n\t\t\t\t\tawait this.#executeEditorActions(editorData);\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\tcatch (e)\n\t\t\t\t{\n\t\t\t\t\tconsole.error(e);\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\t}\n\n\tasync #executeDocumentSendActions(): Promise<void>\n\t{\n\t\tconst partiesData = this.#companyParty.getParties();\n\t\tObject.assign(partiesData, {\n\t\t\temployees: this.#userParty.getEntities().map((entity) => {\n\t\t\t\treturn {\n\t\t\t\t\tentityType: entity.entityType,\n\t\t\t\t\tentityId: entity.entityId,\n\t\t\t\t};\n\t\t\t}),\n\t\t});\n\t\tthis.documentSend.documentData = this.documentsGroup;\n\t\tthis.documentSend.resetUserPartyPopup();\n\t\tthis.documentSend.setPartiesData(partiesData);\n\t}\n\n\tasync #executeEditorActions(editorData: {\n\t\tisTemplate: boolean,\n\t\tuid: string,\n\t\tblocks: Array,\n\t\tentityId: number\n\t}): Promise<void>\n\t{\n\t\tif (this.isTemplateCreateMode())\n\t\t{\n\t\t\tthis.editor.setAnalytics(this.getAnalytics());\n\t\t}\n\t\tthis.wizard.toggleBtnLoadingState('next', false);\n\t\tif (this.isSingleDocument())\n\t\t{\n\t\t\tthis.editor.documentData = editorData;\n\t\t\tawait this.editor.renderDocument();\n\t\t\tif (!this.#needSkipEditorStep || this.isTemplateMode())\n\t\t\t{\n\t\t\t\tawait this.editor.show();\n\t\t\t}\n\t\t}\n\t}\n\n\t#getSendStep(signSettings: B2ESignSettings): Metadata[string]\n\t{\n\t\tconst titleLocCode = this.isTemplateMode()\n\t\t\t? 'SIGN_SETTINGS_SEND_DOCUMENT_CREATE'\n\t\t\t: 'SIGN_SETTINGS_SEND_DOCUMENT'\n\t\t;\n\n\t\treturn {\n\t\t\tget content(): HTMLElement\n\t\t\t{\n\t\t\t\tconst layout = signSettings.documentSend.getLayout();\n\t\t\t\tSignSettingsItemCounter.numerate(layout);\n\n\t\t\t\tif (!signSettings.documentSend.isDateTimeLimitSelectorValid())\n\t\t\t\t{\n\t\t\t\t\tsignSettings.wizard.toggleBtnActiveState('complete', true);\n\t\t\t\t}\n\n\t\t\t\treturn layout;\n\t\t\t},\n\t\t\ttitle: Loc.getMessage(titleLocCode),\n\t\t\tbeforeCompletion: async () => {\n\t\t\t\treturn this.documentSend.sendForSign();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetStepsMetadata(signSettings: this, documentUid: ?string, templateUid?: string): Metadata\n\t{\n\t\tthis.#sendAnalyticsOnStart(documentUid);\n\t\tconst steps = {\n\t\t\tsetup: this.#getSetupStep(signSettings, documentUid),\n\t\t\tcompany: this.#getCompanyStep(signSettings),\n\t\t};\n\n\t\tif (this.#isRegionalSettingsStepEnabled())\n\t\t{\n\t\t\tsteps.regionalSettings = this.#getRegionalSettingsStep(signSettings, documentUid);\n\t\t}\n\n\t\tif (this.isDocumentMode())\n\t\t{\n\t\t\tsteps.employees = this.#getEmployeeStep(signSettings);\n\t\t}\n\n\t\tsteps.send = this.#getSendStep(signSettings);\n\n\t\tthis.#decorateStepsBeforeCompletionWithAnalytics(steps, documentUid);\n\n\t\treturn steps;\n\t}\n\n\t#isRegionalSettingsStepEnabled(): boolean\n\t{\n\t\treturn this.documentSetup.isRuRegion();\n\t}\n\n\tasync init(uid: ?string, templateUid: string)\n\t{\n\t\tawait super.init(uid, templateUid);\n\t\tthis.#setPreviewDocumentDropdownItems();\n\n\t\tif (this.isEditMode() && !Type.isNull(this.getAfterPreviewLayout()))\n\t\t{\n\t\t\tBX.hide(this.getAfterPreviewLayout());\n\t\t}\n\n\t\tif (this.isEditMode())\n\t\t{\n\t\t\tthis.documentSetup.setDocumentTitle(this.documentSetup.setupData.title);\n\t\t\tthis.documentSetup.enableDocumentInputs();\n\t\t}\n\t}\n\n\tonComplete(showNotification: boolean = true): void\n\t{\n\t\tif (this.isTemplateMode())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tsuper.onComplete(showNotification);\n\t}\n\n\tisTemplateCreateMode(): boolean\n\t{\n\t\treturn isTemplateMode(this.documentMode) && !this.isEditMode();\n\t}\n\n\t#setSecondPartySectionVisibility(): void\n\t{\n\t\tconst selectedProvider = this.#companyParty.getSelectedProvider();\n\t\tconst isNotSesRuProvider = selectedProvider.code !== ProviderCode.sesRu;\n\n\t\tconst isSecondPartySectionVisible = isNotSesRuProvider\n\t\t\t|| (isTemplateMode(this.documentMode) && this.#isInitiatedByEmployee())\n\t\t;\n\n\t\tthis.editor.setSectionVisibilityByType(\n\t\t\tSectionType.SecondParty,\n\t\t\tisSecondPartySectionVisible,\n\t\t);\n\t}\n\n\tasync #setHcmLinkIntegrationSectionVisibility(): Promise<void>\n\t{\n\t\tconst isInitiatedByCompany = this.documentSetup.setupData.initiatedByType === DocumentInitiated.company;\n\n\t\tif (this.#isInitiatedByEmployee() && this.documentSetup.isRuRegion())\n\t\t{\n\t\t\tawait this.#api.changeIntegrationId(this.documentSetup.setupData.uid, null);\n\t\t}\n\n\t\tconst isHcmLinkIntegrationSectionVisible = this.documentSetup.setupData.hcmLinkCompanyId > 0\n\t\t\t&& isInitiatedByCompany\n\t\t;\n\n\t\tthis.editor.setSectionVisibilityByType(\n\t\t\tSectionType.HcmLinkIntegration,\n\t\t\tisHcmLinkIntegrationSectionVisible,\n\t\t);\n\t}\n\n\t#isInitiatedByEmployee(): boolean\n\t{\n\t\treturn this.documentSetup.setupData.initiatedByType === DocumentInitiated.employee;\n\t}\n\n\t#decorateStepsBeforeCompletionWithAnalytics(steps: Metadata, documentUid?: string): void\n\t{\n\t\tconst analytics = this.getAnalytics();\n\n\t\tif (Type.isPlainObject(steps.setup))\n\t\t{\n\t\t\tsteps.setup.beforeCompletion = decorateResultBeforeCompletion(\n\t\t\t\tsteps.setup.beforeCompletion,\n\t\t\t\t() => this.#sendAnalyticsOnSetupStep(analytics, documentUid),\n\t\t\t\t() => this.#sendAnalyticsOnSetupError(analytics),\n\t\t\t);\n\t\t}\n\n\t\tif (Type.isPlainObject(steps.company))\n\t\t{\n\t\t\tsteps.company.beforeCompletion = decorateResultBeforeCompletion(\n\t\t\t\tsteps.company.beforeCompletion,\n\t\t\t\t() => this.#sendAnalyticsOnCompanyStepSuccess(analytics),\n\t\t\t\t() => this.#sendAnalyticsOnCompanyStepError(analytics),\n\t\t\t);\n\t\t}\n\n\t\tif (Type.isPlainObject(steps.send))\n\t\t{\n\t\t\tsteps.send.beforeCompletion = decorateResultBeforeCompletion(\n\t\t\t\tsteps.send.beforeCompletion,\n\t\t\t\t() => this.#sendAnalyticsOnSendStepSuccess(analytics, this.documentSetup.setupData.uid),\n\t\t\t\t() => this.#sendAnalyticsOnSendStepError(analytics, this.documentSetup.setupData.uid),\n\t\t\t);\n\t\t}\n\t}\n\n\t#sendAnalyticsOnSetupStep(analytics: Analytics, documentUid?: string): void\n\t{\n\t\tif (this.isTemplateCreateMode())\n\t\t{\n\t\t\tanalytics.send({ event: 'proceed_step_document', c_element: 'create_button', status: 'success' });\n\t\t\tanalytics.send({\n\t\t\t\tevent: 'turn_on_off_template',\n\t\t\t\ttype: 'auto',\n\t\t\t\tc_element: 'off',\n\t\t\t\tp5: `templateId_${this.documentSetup.setupData.templateId}`,\n\t\t\t});\n\t\t}\n\t}\n\n\t#sendAnalyticsOnSetupError(analytics: Analytics): void\n\t{\n\t\tif (this.isTemplateCreateMode())\n\t\t{\n\t\t\tanalytics.send({ event: 'proceed_step_document', status: 'error', c_element: 'create_button' });\n\t\t}\n\t}\n\n\t#sendAnalyticsOnCompanyStepSuccess(analytics: Analytics): void\n\t{\n\t\tif (this.isTemplateCreateMode())\n\t\t{\n\t\t\tanalytics.send({ event: 'proceed_step_route', status: 'success', c_element: 'create_button' });\n\t\t}\n\t}\n\n\t#sendAnalyticsOnCompanyStepError(analytics: Analytics): void\n\t{\n\t\tif (this.isTemplateCreateMode())\n\t\t{\n\t\t\tanalytics.send({ event: 'proceed_step_route', status: 'error', c_element: 'create_button' });\n\t\t}\n\t}\n\n\tasync #sendAnalyticsOnSendStepSuccess(analytics: Analytics, documentUid: string): void\n\t{\n\t\tif (this.isDocumentMode())\n\t\t{\n\t\t\tanalytics.sendWithProviderTypeAndDocId({\n\t\t\t\tevent: 'sent_document_to_sign',\n\t\t\t\tc_element: 'create_button',\n\t\t\t\tstatus: 'success',\n\t\t\t}, documentUid);\n\t\t}\n\t}\n\n\tasync #sendAnalyticsOnSendStepError(analytics: Analytics, documentUid: string): void\n\t{\n\t\tif (this.isTemplateCreateMode())\n\t\t{\n\t\t\tthis.getAnalytics().send({\n\t\t\t\tevent: 'click_save_template',\n\t\t\t\tstatus: 'error',\n\t\t\t\tc_element: 'create_button',\n\t\t\t});\n\t\t}\n\n\t\tif (this.isDocumentMode())\n\t\t{\n\t\t\tanalytics.sendWithProviderTypeAndDocId({\n\t\t\t\tevent: 'sent_document_to_sign',\n\t\t\t\tc_element: 'create_button',\n\t\t\t\tstatus: 'error',\n\t\t\t}, documentUid);\n\t\t}\n\t}\n\n\t#sendAnalyticsOnStart(documentUid?: string): void\n\t{\n\t\tconst analytics = this.getAnalytics();\n\t\tif (this.isTemplateCreateMode())\n\t\t{\n\t\t\tanalytics.send({ event: 'open_wizard', c_element: 'create_button' });\n\t\t}\n\t\telse if (this.isDocumentMode())\n\t\t{\n\t\t\tconst context = { event: 'click_create_document', c_element: 'create_button' };\n\t\t\tif (this.isEditMode() && Type.isStringFilled(documentUid))\n\t\t\t{\n\t\t\t\tanalytics.sendWithDocId(context, documentUid);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tanalytics.send(context);\n\t\t\t}\n\t\t}\n\t}\n\n\tasync #processSetupData(): Promise<void>\n\t{\n\t\tconst setupData = this.getDocumentSetupData();\n\t\tthis.#companyParty.setInitiatedByType(setupData.initiatedByType);\n\t\tthis.#companyParty.setEntityId(setupData.entityId);\n\t\tif (this.isTemplateMode())\n\t\t{\n\t\t\tthis.#companyParty.reloadCompanyProviders();\n\t\t}\n\t\tthis.editedDocument = null;\n\n\t\tif (this.hasPreviewUrls)\n\t\t{\n\t\t\tthis.wizard.toggleBtnActiveState('next', false);\n\t\t}\n\t}\n\n\tasync #addDocumentInGroup(setupData: DocumentDetails): Promise<void>\n\t{\n\t\tif (this.documentSetup.blankIsNotSelected)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.documentsGroup.has(setupData.uid))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isTemplateMode() || !FeatureStorage.isGroupSendingEnabled())\n\t\t{\n\t\t\tthis.setSingleDocument(setupData);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.documentsGroup.set(setupData.uid, setupData);\n\t\tthis.addInDocumentsGroupUids(setupData.uid);\n\t\tthis.documentSetup.blankSelector.disableSelectedBlank(setupData.blankId);\n\n\t\tif (!setupData.groupId && !this.editedDocument)\n\t\t{\n\t\t\tawait this.#attachGroupToDocument(setupData);\n\t\t}\n\n\t\tif (!this.isTemplateMode())\n\t\t{\n\t\t\tthis.documentSetup.documentCounters.update(this.documentsGroup.size);\n\t\t}\n\n\t\tif (!this.editedDocument)\n\t\t{\n\t\t\tthis.documentSetup.renderDocumentBlock(setupData);\n\t\t}\n\t}\n\n\t#scrollToTop(): void\n\t{\n\t\twindow.scrollTo({\n\t\t\ttop: 0,\n\t\t\tbehavior: 'smooth',\n\t\t});\n\t}\n\n\t#scrollToDown(): void\n\t{\n\t\twindow.scrollTo({\n\t\t\ttop: document.body.scrollHeight,\n\t\t\tbehavior: 'smooth',\n\t\t});\n\t}\n\n\t#resetDocument(): void\n\t{\n\t\tif (this.isTemplateMode() || !FeatureStorage.isGroupSendingEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.documentSetup.resetDocument();\n\n\t\tthis.editedDocument = null;\n\t}\n\n\t#disableDocumentSectionIfLimitReached(): void\n\t{\n\t\tif (this.documentsGroup.size >= this.#maxDocumentCount)\n\t\t{\n\t\t\tthis.documentSetup.setAvailabilityDocumentSection(false);\n\t\t}\n\t}\n\n\tgetAfterPreviewLayout(): HTMLElement | null\n\t{\n\t\tif (!this.isDocumentMode() || !FeatureStorage.isMultiDocumentLoadingEnabled())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn this.#cache.remember('beforePreviewLayout', () => Tag.render`\n\t\t\t<button class=\"ui-btn ui-btn-light-border ui-btn-md\" style=\"margin-top: 20px;\" onclick=\"${() => this.#onBeforePreviewBtnClick()}\">\n\t\t\t\t${Loc.getMessage('SIGN_SETTINGS_B2E_BEFORE_PREVIEW')}\n\t\t\t</button>\n\t\t`);\n\t}\n\n\t#onBeforePreviewBtnClick(): void\n\t{\n\t\t// eslint-disable-next-line unicorn/no-this-assignment\n\t\tconst self = this;\n\t\tBX.SidePanel.Instance.open('sign-settings:afterPreviewSidePanel', {\n\t\t\tcacheable: false,\n\t\t\twidth: 750,\n\t\t\tcontentCallback: () => {\n\t\t\t\tself.#resetAfterPreviewSidePanel();\n\n\t\t\t\treturn Layout.createContent({\n\t\t\t\t\textensions: ['ui.forms'],\n\t\t\t\t\ttitle: 'Добавить папку с файлами',\n\t\t\t\t\tcontent(): void\n\t\t\t\t\t{\n\t\t\t\t\t\tself.#getUploader();\n\n\t\t\t\t\t\treturn self.#getMultiDocumentAddSidePanelContent();\n\t\t\t\t\t},\n\t\t\t\t\tbuttons({ cancelButton, SaveButton })\n\t\t\t\t\t{\n\t\t\t\t\t\tself.#saveButton = new SaveButton({\n\t\t\t\t\t\t\tonclick: () => self.#onBeforePreviewSaveBtnClick(),\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\tself.#saveButton,\n\t\t\t\t\t\t];\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tonClose: (event) => {\n\t\t\t\t\tif (this.#isMultiDocumentSaveProcessGone)\n\t\t\t\t\t{\n\t\t\t\t\t\tevent.denyAction();\n\t\t\t\t\t}\n\t\t\t\t\tthis.#resetAfterPreviewSidePanel();\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\t#getMultiDocumentAddSidePanelContent(): HTMLElement\n\t{\n\t\treturn this.#cache.remember('multiDocumentAddSidePanelContent', () => Tag.render`\n\t\t\t<div id=\"multiple-document-add-container\" style=\"display: flex; flex-direction: column;\">\n\t\t\t\t<div style=\"flex-direction: row;\">\n\t\t\t\t\t${this.#getUploadFileFromDirButton().root}\n\t\t\t\t\t${this.#getUploadFileButton()}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`);\n\t}\n\n\t#getUploader(): Uploader\n\t{\n\t\treturn this.#cache.remember('uploader', () => {\n\t\t\treturn new Uploader({\n\t\t\t\tid: 'sign-settings-uploader',\n\t\t\t\tcontroller: 'sign.upload.blankUploadController',\n\t\t\t\tacceptedFileTypes: [...acceptedUploaderFileTypes.values()].map((a) => `.${a}`),\n\t\t\t\tmultiple: true,\n\t\t\t\tautoUpload: false,\n\t\t\t\tmaxFileSize: 52_428_800,\n\t\t\t\timageMaxFileSize: 10_485_760,\n\t\t\t\tmaxTotalFileSize: 52_428_800,\n\t\t\t\tevents: {\n\t\t\t\t\t[UploaderEvent.BEFORE_FILES_ADD]: (event) => this.#onBeforeFilesAdd(event),\n\t\t\t\t\t[UploaderEvent.FILE_ADD]: (event) => this.#onFileAdd(event.getData().file),\n\t\t\t\t\t[UploaderEvent.UPLOAD_COMPLETE]: (event) => this.#onUploadComplete(event),\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\t#resetAfterPreviewSidePanel(): void\n\t{\n\t\tthis.#cache.delete('uploader');\n\t\tthis.#cache.delete('uploadButton');\n\t\tthis.#cache.delete('uploadFromDirButton');\n\t\tthis.#cache.delete('multiDocumentAddSidePanelContent');\n\t}\n\n\t#getUploadFileButton(): HTMLElement\n\t{\n\t\treturn this.#cache.remember('uploadButton', () => {\n\t\t\tconst layout = Tag.render`\n\t\t\t\t<div>\n\t\t\t\t\t<button class=\"ui-btn ui-btn-light-border\" style=\"margin-top: 15px;\" onclick=\"${() => layout.fileInput.click()}\">${Loc.getMessage('SIGN_V2_B2E_SIGN_SETTINGS_ADD_FILE')}</button>\n\t\t\t\t\t<input ref=\"fileInput\" hidden type=\"file\" multiple ref=\"fileInput\" onchange=\"${(event) => {\n\t\t\t\t\t\t\tthis.#onInputFileChange(event);\n\t\t\t\t\t\t\tevent.target.value = '';\n\t\t\t\t\t\t}}\"\n\t\t\t\t\t\taccept=\"${[...acceptedUploaderFileTypes.values()].map((n) => `.${n}`).join(', ')}\"\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\treturn layout.root;\n\t\t});\n\t}\n\n\t#getUploadFileFromDirButton(): { root: HTMLElement, fileInput: HTMLInputElement }\n\t{\n\t\treturn this.#cache.remember('uploadFromDirButton', () => {\n\t\t\tconst layout = Tag.render`\n\t\t\t\t<div>\n\t\t\t\t\t<button class=\"ui-btn ui-btn-primary\" style=\"margin-top: 15px;\" onclick=\"${() => layout.fileInput.click()}\">${Loc.getMessage('SIGN_V2_B2E_SIGN_SETTINGS_LOAD_FROM_DIRS')}</button>\n\t\t\t\t\t<input hidden type=\"file\" webkitdirectory multiple ref=\"fileInput\" onchange=\"${(event) => {\n\t\t\t\t\t\tthis.#onInputFileChange(event);\n\t\t\t\t\t\tevent.target.value = '';\n\t\t\t\t\t}}\">\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\treturn layout;\n\t\t});\n\t}\n\n\t#onInputFileChange(event: Event): void\n\t{\n\t\tconst target: HTMLInputElement = event.target;\n\t\tconst files = target.files;\n\t\tconst validatedFiles = [...files].filter((f: File) => acceptedUploaderFileTypes.has(\n\t\t\tf.name.split('.').at(-1),\n\t\t));\n\t\tthis.#getUploader().addFiles(validatedFiles);\n\t}\n\n\t#onFileAdd(file: UploaderFile): void\n\t{\n\t\tDom.insertAfter(\n\t\t\tTag.render`<p style=\"color: #666\">${Loc.getMessage('SIGN_V2_B2E_SIGN_SETTINGS_LOADED_FILE_NAME', { '#FILENAME#': Text.encode(file.getName()) })}</p>`,\n\t\t\tthis.#getUploadFileButton(),\n\t\t);\n\t}\n\n\t#onBeforePreviewSaveBtnClick(): void\n\t{\n\t\tif (this.#getUploader().getFiles().length === 0)\n\t\t{\n\t\t\talert(Loc.getMessage('SIGN_V2_B2E_SIGN_SETTINGS_NO_FILES_SELECTED'));\n\n\t\t\treturn;\n\t\t}\n\n\t\tDom.style(this.#getMultiDocumentAddSidePanelContent(), { opacity: 0.6, 'pointer-events': 'none' });\n\t\tthis.#isMultiDocumentSaveProcessGone = true;\n\t\tthis.#getUploader().start();\n\t\tthis.#saveButton.setClocking(true);\n\t}\n\n\tasync #onUploadComplete(event: BaseEvent): void\n\t{\n\t\tconst uploader = this.#getUploader();\n\t\tfor (const file of uploader.getFiles())\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst blankId = await this.documentSetup.blankSelector.createBlankFromOuterUploaderFiles([file]);\n\t\t\t\tthis.documentSetup.blankSelector.selectBlank(blankId);\n\t\t\t\tawait this.setDocumentsGroup();\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tconsole.error(`Error while add file with name ${file.getName()}`, e);\n\t\t\t}\n\t\t}\n\n\t\tDom.style(this.#getMultiDocumentAddSidePanelContent(), { opacity: 1, 'pointer-events': 'auto' });\n\t\tthis.#isMultiDocumentSaveProcessGone = false;\n\t\tthis.#saveButton.setClocking(false);\n\t\tBX.SidePanel.Instance.close();\n\t}\n\n\t#onBeforeFilesAdd(event: BaseEvent<{ files: Array<UploaderFile> }>): void\n\t{\n\t\tconst uploaderConfig = {\n\t\t\tmaxFileSize: 52_428_800,\n\t\t\timageMaxFileSize: 10_485_760,\n\t\t\tmaxTotalFileSize: 52_428_800,\n\t\t};\n\t\tconst data = event.getData();\n\t\tconst files: UploaderFile[] = data.files;\n\t\tconst uploader = this.#getUploader();\n\t\tconst allFilesWithNew: UploaderFile[] = [...files, ...uploader.getFiles()];\n\n\t\tif ((allFilesWithNew.length + this.documentsGroup.size) > this.#maxDocumentCount)\n\t\t{\n\t\t\talert(Loc.getMessage('SIGN_V2_B2E_SIGN_SETTINGS_MAX_DOCUMENTS_COUNT_EXCEEDED_NOTICE'));\n\t\t\tevent.preventDefault();\n\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const file of files)\n\t\t{\n\t\t\tif (file.getSize() > uploaderConfig.maxFileSize)\n\t\t\t{\n\t\t\t\talert(Loc.getMessage('SIGN_V2_B2E_SIGN_SETTINGS_INVALID_FILE_SIZE'));\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (file.isImage() && file.getSize() > uploaderConfig.imageMaxFileSize)\n\t\t\t{\n\t\t\t\talert(Loc.getMessage('SIGN_V2_B2E_SIGN_SETTINGS_INVALID_IMAGE_FILE_SIZE'));\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tconst totalFileSize = allFilesWithNew.reduce((acc, file) => acc + file.getSize(), 0);\n\t\tif (totalFileSize > uploaderConfig.maxTotalFileSize)\n\t\t{\n\t\t\talert(Loc.getMessage('SIGN_V2_B2E_SIGN_SETTINGS_MAX_TOTAL_FILE_SIZE_EXCEEDED'));\n\t\t\tevent.preventDefault();\n\t\t}\n\t}\n\n\t#isIntegrationEnabled(code: ProviderCodeType): boolean\n\t{\n\t\treturn code && code !== ProviderCode.sesRu;\n\t}\n\n\tasync #executeTemplateSetupPartyActions(): Promise<void>\n\t{\n\t\tconst { uid } = this.documentSetup.setupData;\n\t\tconst isB2eDocumentSectionDisabled = !this.documentSetup.isRuRegion() || this.#isInitiatedByEmployee();\n\t\tthis.editor.setIsB2eDocumentSectionDisabled(isB2eDocumentSectionDisabled);\n\t\tthis.editor.entityData = await this.#setupParties();\n\t\tconst { isTemplate, entityId } = this.documentSetup.setupData;\n\t\tconst blocks = await this.documentSetup.loadBlocks(uid);\n\n\t\tconst editorData = { isTemplate, uid, blocks, entityId };\n\t\tthis.#executeEditorActions(editorData);\n\t}\n}\n"],"names":["acceptedUploaderFileTypes","Set","B2ESignSettings","SignSettings","constructor","containerId","signOptions","next","className","complete","swapButtons","MemoryCache","b2eFeatureConfig","blankSelectorConfig","documentSendConfig","userPartyConfig","documentSetup","DocumentSetup","documentSend","DocumentSend","CompanyParty","documentInitiatedType","initiatedByType","documentMode","hcmLinkAvailable","RegionalSettings","templateMode","isTemplateMode","regionDocumentTypes","isIntegrationVisible","DocumentInitiated","employee","Api","b2eDocumentLimitCount","UserParty","mode","subscribeOnEvents","needSkipEditorStep","editor","setIsB2eDocumentSectionDisabled","isRuRegion","setSectionVisibilityByType","SectionType","HcmLinkIntegration","subscribe","event","setProvider","data","provider","isIntegrationEnabled","code","title","uid","encodedTitle","Text","encode","setDocumentTitle","isGroupDocuments","documentsGroup","has","documentDetails","get","set","updateDocumentBlock","id","addInDocumentsGroupUids","selectedItemUid","getSelectedId","setItemSelected","wizard","toggleBtnActiveState","setDocumentsGroup","setAvailabilityDocumentSection","events","onTemplateComplete","isEditMode","templateId","getData","getAnalytics","send","type","c_element","p5","status","selectItem","getLayoutTemplate","header","preview","previewDocumentDropdown","getLayout","Tag","render","blankIsNotSelected","validate","switchAddDocumentButtonLoadingState","documentData","setupDocument","blankSelector","disableSelectedBlank","blankId","editedDocument","isFileAdded","then","catch","renderDocumentBlock","documentCounters","update","size","documentsGroupUids","includes","push","replaceInDocumentsGroupUids","oldUid","newUid","index","indexOf","splice","deleteFromDocumentsGroupUids","applyDocumentData","setupData","groupId","documentsGroupData","getDocumentListInGroup","item","blocks","loadBlocksByDocument","updatedItem","firstDocument","getFirstDocumentDataFromGroup","entityId","representativeId","companyUid","companyEntityId","hcmLinkCompanyId","isSingleDocument","members","loadMembers","memberEntityType","MemberRole","assignee","loadRepresentative","parsedMembers","signers","assignees","setEntityId","setLastSavedHcmLinkCompanyId","loadCompany","length","load","loadValidator","applyTemplateData","templateUid","setExistingTemplate","getStepsMetadata","signSettings","documentUid","steps","setup","company","regionalSettings","isDocumentMode","employees","init","Type","isNull","getAfterPreviewLayout","BX","hide","enableDocumentInputs","onComplete","showNotification","isTemplateCreateMode","FeatureStorage","isMultiDocumentLoadingEnabled","remember","Loc","getMessage","config","fromRobot","fromTemplateFolder","templateFolderId","isOpenedAsFolder","isOpenedFromRobot","isOpenedFromTemplateFolder","editMode","renderPages","SignDropdown","tabs","entities","withCaption","isEnableSearch","width","uidFromEvent","resetEditMode","selectedUid","removeItems","forEach","addItem","deselectable","replaceDocumentBlock","setUrls","documentId","deletedElement","layout","querySelector","remove","createDocumentsGroup","targetDocument","attachGroupToDocument","error","console","updatedDocumentData","updateDocumentData","setDocumentsBlock","show","deleteButton","ready","removeDocument","isFirstDocumentSelected","resetPreview","hasPreviewUrls","deleteDocument","delete","enableSelectedBlank","deleteDocumentFromList","lastDocumentDetails","values","pop","toggleDeleteBtnLoadingState","representative","getParties","signerParty","documentUids","keys","setupB2eParties","membersData","isArrayFilled","Error","syncMemberPromises","map","Promise","all","memberData","presetId","part","party","entityTypeId","role","isInitiatedByCompany","syncFinished","response","syncB2eMembersWithDepartments","ms","resolve","setTimeout","currentParty","companyId","EntityType","COMPANY","entityType","USER","entity","signer","validation","userPartyEntities","getEntities","result","loadedMembers","reduce","acc","member","STRUCTURE_NODE_ROLE","find","setupMemberItem","content","SignSettingsItemCounter","numerate","beforeCompletion","blankIsSelected","selectedBlankId","isValid","titleLocCode","isTemplateModeForCompany","setEditorAvailability","isRepresentativeSelected","loadFirstRepresentative","isProviderSelected","loadFirstCompany","save","getSelectedCompanyId","setSenderType","e","warn","getSelectedHcmLinkCompanyId","hcmLinkEnabled","entityData","isTemplate","loadBlocks","editorData","partiesData","Object","assign","resetUserPartyPopup","setPartiesData","setAnalytics","toggleBtnLoadingState","renderDocument","isDateTimeLimitSelectorValid","sendForSign","selectedProvider","getSelectedProvider","isNotSesRuProvider","ProviderCode","sesRu","isSecondPartySectionVisible","SecondParty","changeIntegrationId","isHcmLinkIntegrationSectionVisible","analytics","isPlainObject","decorateResultBeforeCompletion","sendWithProviderTypeAndDocId","context","isStringFilled","sendWithDocId","getDocumentSetupData","setInitiatedByType","reloadCompanyProviders","isGroupSendingEnabled","setSingleDocument","window","scrollTo","top","behavior","document","body","scrollHeight","resetDocument","self","SidePanel","Instance","open","cacheable","contentCallback","Layout","createContent","extensions","buttons","cancelButton","SaveButton","onclick","onClose","denyAction","root","Uploader","controller","acceptedFileTypes","a","multiple","autoUpload","maxFileSize","imageMaxFileSize","maxTotalFileSize","UploaderEvent","BEFORE_FILES_ADD","FILE_ADD","file","UPLOAD_COMPLETE","fileInput","click","target","value","n","join","files","validatedFiles","filter","f","name","split","at","addFiles","Dom","insertAfter","getName","getFiles","alert","style","opacity","start","setClocking","uploader","createBlankFromOuterUploaderFiles","selectBlank","close","uploaderConfig","allFilesWithNew","preventDefault","getSize","isImage","totalFileSize","isB2eDocumentSectionDisabled"],"mappings":"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"}