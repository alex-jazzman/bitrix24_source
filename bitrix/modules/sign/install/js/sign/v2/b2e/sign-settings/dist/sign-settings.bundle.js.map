{"version":3,"file":"sign-settings.bundle.js","sources":["../src/index.js"],"sourcesContent":["import { Dom, Loc, Tag, Text, Type } from 'main.core';\nimport { MemoryCache } from 'main.core.cache';\nimport { type BaseEvent } from 'main.core.events';\nimport { FeatureStorage } from 'sign.feature-storage';\nimport { DocumentInitiated, type DocumentInitiatedType, MemberRole, ProviderCode, ProviderCodeType } from 'sign.type';\nimport { Api, type SetupMember } from 'sign.v2.api';\nimport type { ProviderSelectedEvent, CompanySelectedEvent } from 'sign.v2.b2e.company-selector';\nimport { DocumentSend } from 'sign.v2.b2e.document-send';\nimport { DocumentSetup } from 'sign.v2.b2e.document-setup';\nimport { Parties as CompanyParty } from 'sign.v2.b2e.parties';\nimport { RegionalSettings } from 'sign.v2.b2e.regional-settings';\nimport { type CardItem, UserParty } from 'sign.v2.b2e.user-party';\nimport { type DocumentDetails } from 'sign.v2.document-setup';\nimport { SectionType } from 'sign.v2.editor';\nimport { SignSettingsItemCounter } from 'sign.v2.helper';\nimport {\n\tdecorateResultBeforeCompletion,\n\tisTemplateMode,\n\ttype SignOptions,\n\ttype SignOptionsConfig,\n\tSignSettings,\n} from 'sign.v2.sign-settings';\nimport { type SaveButton } from 'ui.buttons';\nimport { Layout } from 'ui.sidepanel.layout';\nimport { Uploader, UploaderEvent, UploaderFile } from 'ui.uploader.core';\nimport type { Metadata } from 'ui.wizard';\nimport { B2EFeatureConfig } from './type';\nimport { EntityType } from 'sign.type';\n\nimport './style.css';\n\nexport type { B2EFeatureConfig };\n\ntype SetupMembersResponse = {\n\tmembers: Array<SetupMember>,\n\tcurrentParty: number,\n};\n\ntype PartiesDetails = {\n\tentityId: number,\n\tentityTypeId: number,\n\tpart: number,\n\tpresetId: number,\n\trole: string,\n\tuid: string\n}\n\nconst acceptedUploaderFileTypes: Set<string> = new Set([\n\t'jpg',\n\t'jpeg',\n\t'png',\n\t'pdf',\n\t'doc',\n\t'docx',\n\t'rtf',\n\t'odt',\n]);\n\nexport class B2ESignSettings extends SignSettings\n{\n\t#companyParty: CompanyParty;\n\t#regionalSettings: RegionalSettings;\n\t#userParty: UserParty;\n\t#api: Api;\n\tdocumentSetup: DocumentSetup;\n\teditedDocument: DocumentDetails | null;\n\t#maxDocumentCount: boolean;\n\t#cache: MemoryCache<any> = new MemoryCache();\n\t#saveButton: SaveButton;\n\t#isMultiDocumentSaveProcessGone: boolean = false;\n\t#needSkipEditorStep: boolean;\n\n\tconstructor(containerId: string, signOptions: SignOptions)\n\t{\n\t\tsuper(containerId, signOptions, {\n\t\t\tnext: {\n\t\t\t\tclassName: 'ui-btn-success',\n\t\t\t},\n\t\t\tcomplete: { className: 'ui-btn-success' },\n\t\t\tswapButtons: true,\n\t\t});\n\t\tconst {\n\t\t\tb2eFeatureConfig,\n\t\t\tblankSelectorConfig,\n\t\t\tdocumentSendConfig,\n\t\t\tuserPartyConfig,\n\t\t} = this.#prepareConfig(signOptions);\n\n\t\tthis.documentSetup = new DocumentSetup(blankSelectorConfig);\n\t\tthis.documentSend = new DocumentSend(documentSendConfig);\n\t\tthis.#companyParty = new CompanyParty({\n\t\t\t...blankSelectorConfig,\n\t\t\tdocumentInitiatedType: signOptions.initiatedByType,\n\t\t\tdocumentMode: signOptions.documentMode,\n\t\t}, b2eFeatureConfig.hcmLinkAvailable);\n\t\tthis.#regionalSettings = new RegionalSettings({\n\t\t\ttemplateMode: this.isTemplateMode(),\n\t\t\tregionDocumentTypes: blankSelectorConfig.regionDocumentTypes,\n\t\t});\n\n\t\tthis.#regionalSettings.isIntegrationVisible = !(this.isTemplateMode()\n\t\t\t&& signOptions.initiatedByType === DocumentInitiated.employee);\n\n\t\tthis.#api = new Api();\n\t\tthis.#maxDocumentCount = signOptions.b2eDocumentLimitCount;\n\t\tthis.#userParty = new UserParty({ mode: 'edit', ...userPartyConfig });\n\t\tthis.subscribeOnEvents();\n\t\tthis.#needSkipEditorStep = documentSendConfig.needSkipEditorStep;\n\n\t\tthis.editor.setIsB2eDocumentSectionDisabled(!this.documentSetup.isRuRegion());\n\t\tthis.editor.setSectionVisibilityByType(SectionType.HcmLinkIntegration, false);\n\n\t\tthis.#companyParty.subscribe('onCompanySelect', (event: CompanySelectedEvent) => {\n\t\t\tthis.documentSend.setProvider(event.data.provider);\n\t\t\tthis.#regionalSettings.isIntegrationEnabled = this.#isIntegrationEnabled(event.data?.provider?.code);\n\t\t});\n\t\tthis.#companyParty.subscribe('onProviderSelect', (event: ProviderSelectedEvent) => {\n\t\t\tthis.documentSend.setProvider(event.data.provider);\n\t\t\tthis.#regionalSettings.isIntegrationEnabled = this.#isIntegrationEnabled(event.data?.provider?.code);\n\t\t});\n\t}\n\n\t#prepareConfig(signOptions: SignOptions): SignOptionsConfig\n\t{\n\t\tconst { config, documentMode, fromRobot, fromTemplateFolder, b2eDocumentLimitCount } = signOptions;\n\n\t\tconst { blankSelectorConfig, documentSendConfig } = config;\n\t\tblankSelectorConfig.documentMode = documentMode;\n\t\tblankSelectorConfig.isOpenedFromRobot = fromRobot;\n\t\tblankSelectorConfig.b2eDocumentLimitCount = b2eDocumentLimitCount;\n\t\tblankSelectorConfig.isOpenedFromTemplateFolder = fromTemplateFolder;\n\t\tdocumentSendConfig.documentMode = documentMode;\n\t\tdocumentSendConfig.isOpenedFromRobot = fromRobot;\n\n\t\treturn config;\n\t}\n\n\tsubscribeOnEvents(): void\n\t{\n\t\tsuper.subscribeOnEvents();\n\t\tthis.documentSend.subscribe('changeTitle', ({ data }) => {\n\t\t\tthis.documentSetup.setDocumentTitle(data.title);\n\t\t});\n\t\tthis.documentSend.subscribe('disableBack', () => {\n\t\t\tthis.wizard.toggleBtnActiveState('back', true);\n\t\t});\n\t\tthis.documentSend.subscribe('enableBack', () => {\n\t\t\tthis.wizard.toggleBtnActiveState('back', false);\n\t\t});\n\t\tthis.documentSetup.subscribe('addDocument', () => {\n\t\t\tthis.setDocumentsGroup();\n\t\t});\n\t\tthis.documentSetup.subscribe('deleteDocument', ({ data }) => {\n\t\t\tthis.#deleteDocument(data);\n\t\t});\n\t\tthis.documentSetup.subscribe('editDocument', ({ data }) => {\n\t\t\tthis.#editDocumentData(data.uid);\n\t\t});\n\t\tthis.documentSend.subscribe('enableComplete', () => {\n\t\t\tthis.wizard.toggleBtnActiveState('complete', false);\n\t\t});\n\t\tthis.documentSend.subscribe('disableComplete', () => {\n\t\t\tthis.wizard.toggleBtnActiveState('complete', true);\n\t\t});\n\t\tthis.documentSetup.subscribe('documentsLimitExceeded', () => {\n\t\t\tthis.documentSetup.setAvailabilityDocumentSection(false);\n\t\t});\n\t\tthis.documentSetup.subscribe('documentsLimitNotExceeded', () => {\n\t\t\tthis.documentSetup.setAvailabilityDocumentSection(true);\n\t\t});\n\t\tthis.documentSend.subscribe(\n\t\t\tthis.documentSend.events.onTemplateComplete,\n\t\t\t(event: BaseEvent<{ templateId: number }>) => {\n\t\t\t\tif (this.isTemplateMode() && !this.isEditMode())\n\t\t\t\t{\n\t\t\t\t\tconst templateId = event.getData().templateId;\n\t\t\t\t\tthis.getAnalytics().send({\n\t\t\t\t\t\tevent: 'turn_on_off_template',\n\t\t\t\t\t\ttype: 'auto',\n\t\t\t\t\t\tc_element: 'on',\n\t\t\t\t\t\tp5: `templateId_${templateId}`,\n\t\t\t\t\t});\n\t\t\t\t\tthis.getAnalytics().send({\n\t\t\t\t\t\tevent: 'click_save_template',\n\t\t\t\t\t\tc_element: 'create_button',\n\t\t\t\t\t\tp5: `templateId_${templateId}`,\n\t\t\t\t\t\tstatus: 'success',\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t);\n\t}\n\n\tasync #editDocumentData(uid: string): Promise<void>\n\t{\n\t\tif (this.editedDocument)\n\t\t{\n\t\t\tawait this.#saveUpdatedDocumentData(this.editedDocument.uid);\n\t\t}\n\n\t\tif (!this.documentSetup.editMode)\n\t\t{\n\t\t\tthis.#disableDocumentSectionIfLimitReached();\n\t\t\tthis.#resetDocument();\n\n\t\t\treturn;\n\t\t}\n\t\tthis.editedDocument = this.documentsGroup.get(uid);\n\t\tthis.documentSetup.setAvailabilityDocumentSection(true);\n\t\tthis.documentSetup.setDocumentTitle(this.editedDocument.title);\n\t\tthis.#scrollToDown();\n\t}\n\n\tasync setDocumentsGroup(): Promise<void>\n\t{\n\t\tif (this.documentSetup.blankIsNotSelected || !this.documentSetup.validate())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.documentSetup.switchAddDocumentButtonLoadingState(true);\n\t\ttry\n\t\t{\n\t\t\tconst documentData = await this.setupDocument();\n\t\t\tthis.documentsGroup.set(documentData.uid, documentData);\n\t\t\tthis.addInDocumentsGroupUids(documentData.uid);\n\n\t\t\tthis.documentSetup.blankSelector.disableSelectedBlank(documentData.blankId);\n\n\t\t\tawait this.#attachGroupToDocument(documentData);\n\t\t\tthis.documentSetup.switchAddDocumentButtonLoadingState(false);\n\n\t\t\tif (this.editedDocument)\n\t\t\t{\n\t\t\t\tawait this.#handleEditedDocument(documentData);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.documentSetup.renderDocumentBlock(documentData);\n\t\t\t}\n\t\t}\n\t\tcatch\n\t\t{\n\t\t\tthis.documentSetup.switchAddDocumentButtonLoadingState(false);\n\t\t}\n\n\t\tthis.#scrollToTop();\n\t\tthis.documentSetup.documentCounters.update(this.documentsGroup.size);\n\t\tthis.#resetDocument();\n\t\tthis.wizard.toggleBtnActiveState('next', false);\n\t}\n\n\taddInDocumentsGroupUids(uid: string): void\n\t{\n\t\tif (!this.documentsGroupUids.includes(uid))\n\t\t{\n\t\t\tthis.documentsGroupUids.push(uid);\n\t\t}\n\t}\n\n\tasync #handleEditedDocument(documentData): Promise<void>\n\t{\n\t\tif (this.documentSetup.blankIsNotSelected || !this.documentSetup.isFileAdded)\n\t\t{\n\t\t\tthis.documentSetup.resetEditMode();\n\t\t\tawait this.#saveUpdatedDocumentData(this.editedDocument.uid);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.deleteFromDocumentsGroupUids(documentData.uid);\n\t\tthis.replaceInDocumentsGroupUids(this.editedDocument.uid, documentData.uid);\n\t\tthis.documentSetup.replaceDocumentBlock(this.editedDocument, documentData);\n\t\tawait this.#deleteDocument(this.editedDocument);\n\t\tawait this.#attachGroupToDocument(documentData);\n\n\t\tthis.editor.setUrls([]);\n\t}\n\n\treplaceInDocumentsGroupUids(oldUid: string, newUid: string): void\n\t{\n\t\tconst index = this.documentsGroupUids.indexOf(oldUid);\n\t\tif (index !== -1)\n\t\t{\n\t\t\tthis.documentsGroupUids.splice(index, 1, newUid);\n\t\t}\n\t}\n\n\tdeleteFromDocumentsGroupUids(uid: string)\n\t{\n\t\tconst index = this.documentsGroupUids.indexOf(uid);\n\n\t\tif (index === -1)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.documentsGroupUids.splice(index, 1);\n\t}\n\n\t#removeDocumentElement(documentId): void\n\t{\n\t\tconst deletedElement = this.documentSetup.layout.querySelector(`[data-id=\"document-id-${documentId}\"]`);\n\t\tdeletedElement?.remove();\n\t}\n\n\tasync #attachGroupToDocument(documentData): Promise<void>\n\t{\n\t\tif (!this.groupId)\n\t\t{\n\t\t\tconst { groupId } = await this.#api.createDocumentsGroup();\n\t\t\tthis.groupId = groupId;\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tconst targetDocument = this.documentsGroup.get(documentData.uid);\n\n\t\t\tif (targetDocument && !targetDocument.groupId)\n\t\t\t{\n\t\t\t\tawait this.#api.attachGroupToDocument(documentData.uid, this.groupId);\n\t\t\t\ttargetDocument.groupId = this.groupId;\n\t\t\t}\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error(error);\n\t\t}\n\t}\n\n\tasync #saveUpdatedDocumentData(uid: string): Promise<void>\n\t{\n\t\tconst updatedDocumentData = await this.documentSetup.updateDocumentData(this.editedDocument);\n\t\tthis.documentSetup.updateDocumentBlock(this.editedDocument.id);\n\n\t\tif (uid)\n\t\t{\n\t\t\tthis.documentsGroup.set(this.editedDocument.uid, updatedDocumentData);\n\t\t\tthis.addInDocumentsGroupUids(this.editedDocument.uid);\n\t\t\tthis.documentSend.setDocumentsBlock(this.documentsGroup);\n\t\t\tthis.#regionalSettings.documentsGroup = this.documentsGroup;\n\t\t}\n\t}\n\n\tasync #deleteDocument(data: { blankId: number, deletedButton: HTMLElement, id: number, uid: string }): string\n\t{\n\t\tconst { id, uid, blankId, deleteButton } = data;\n\t\tthis.documentSetup.ready = false;\n\n\t\ttry\n\t\t{\n\t\t\tawait this.#api.removeDocument(uid);\n\t\t\tthis.documentSetup.ready = true;\n\n\t\t\tif (this.isFirstDocumentSelected(uid))\n\t\t\t{\n\t\t\t\tthis.resetPreview();\n\t\t\t\tthis.hasPreviewUrls = false;\n\t\t\t}\n\t\t\tthis.#removeDocumentElement(id);\n\t\t\tthis.documentSend.deleteDocument(uid);\n\t\t\tthis.documentsGroup.delete(uid);\n\t\t\tthis.deleteFromDocumentsGroupUids(uid);\n\t\t\tthis.documentSetup.blankSelector.enableSelectedBlank(blankId);\n\t\t\tthis.documentSetup.deleteDocumentFromList(blankId);\n\t\t\tthis.documentSetup.documentCounters.update(this.documentsGroup.size);\n\t\t\tthis.documentSetup.resetEditMode();\n\n\t\t\tif (this.documentsGroup.size === 0)\n\t\t\t{\n\t\t\t\tthis.wizard.toggleBtnActiveState('next', true);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.documentSetup.setupData = this.getFirstDocumentDataFromGroup();\n\t\t\t}\n\t\t\tthis.#resetDocument();\n\t\t}\n\t\tcatch\n\t\t{\n\t\t\tthis.documentSetup.toggleDeleteBtnLoadingState(deleteButton);\n\t\t\tthis.documentSetup.ready = true;\n\t\t}\n\t}\n\n\tasync #setupParties(): Promise<Array<PartiesDetails>>\n\t{\n\t\tconst { representative } = this.#companyParty.getParties();\n\t\tconst { members, signerParty } = this.#makeSetupMembers();\n\n\t\tconst documentUids = [...this.documentsGroup.keys()];\n\t\tfor (const documentUid of documentUids)\n\t\t{\n\t\t\t// eslint-disable-next-line no-await-in-loop\n\t\t\tawait this.#api.setupB2eParties(documentUid, representative.entityId, members);\n\t\t}\n\t\tconst uid = this.#documentUid;\n\t\tconst membersData = await this.#api.loadMembers(uid);\n\t\tif (!Type.isArrayFilled(membersData))\n\t\t{\n\t\t\tthrow new Error('Members are empty');\n\t\t}\n\n\t\tconst syncMemberPromises = documentUids.map((uid) => this.#syncMembersWithDepartments(uid, signerParty));\n\t\tawait Promise.all(syncMemberPromises);\n\n\t\treturn membersData.map((memberData) => {\n\t\t\treturn {\n\t\t\t\tpresetId: memberData?.presetId,\n\t\t\t\tpart: memberData?.party,\n\t\t\t\tuid: memberData?.uid,\n\t\t\t\tentityTypeId: memberData?.entityTypeId ?? null,\n\t\t\t\tentityId: memberData?.entityId ?? null,\n\t\t\t\trole: memberData?.role ?? null,\n\t\t\t};\n\t\t});\n\t}\n\n\t#isTemplateModeForCompany(): boolean\n\t{\n\t\tconst isInitiatedByCompany = this.documentSetup.setupData.initiatedByType === DocumentInitiated.company;\n\n\t\treturn isTemplateMode(this.documentMode) && isInitiatedByCompany;\n\t}\n\n\tasync #syncMembersWithDepartments(uid: string, signerParty: number): Promise<void>\n\t{\n\t\tlet syncFinished = false;\n\t\twhile (!syncFinished)\n\t\t{\n\t\t\t// eslint-disable-next-line no-await-in-loop\n\t\t\tconst response = await this.#api.syncB2eMembersWithDepartments(uid, signerParty);\n\t\t\tsyncFinished = response.syncFinished;\n\t\t\t// eslint-disable-next-line no-await-in-loop\n\t\t\tawait this.#sleep(1000);\n\t\t}\n\t}\n\n\t#sleep(ms: Number): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tsetTimeout(resolve, ms);\n\t\t});\n\t}\n\n\tget #documentUid(): string\n\t{\n\t\treturn this.documentSetup.setupData.uid;\n\t}\n\n\tget #isDocumentInitiatedByEmployee(): DocumentInitiatedType\n\t{\n\t\treturn this.documentSetup.setupData.initiatedByType === DocumentInitiated.employee;\n\t}\n\n\t#getAssignee(currentParty: number, companyId: number): SetupMember\n\t{\n\t\tconst { representative } = this.#companyParty.getParties();\n\n\t\tlet type = EntityType.COMPANY;\n\t\tif (representative.entityType !== EntityType.USER)\n\t\t{\n\t\t\ttype = representative.entityType;\n\t\t}\n\n\t\treturn {\n\t\t\tentityType: type,\n\t\t\tentityId: companyId,\n\t\t\tparty: currentParty,\n\t\t\trole: MemberRole.assignee,\n\t\t};\n\t}\n\n\t#getSigner(currentParty: number, entity: CardItem): SetupMember\n\t{\n\t\treturn {\n\t\t\tentityType: entity.entityType,\n\t\t\tentityId: entity.entityId,\n\t\t\tparty: currentParty,\n\t\t\trole: MemberRole.signer,\n\t\t};\n\t}\n\n\t#makeSetupMembers(): SetupMembersResponse\n\t{\n\t\tconst { company, validation } = this.#companyParty.getParties();\n\n\t\tconst userPartyEntities = this.#userParty.getEntities();\n\n\t\tlet currentParty = this.#isDocumentInitiatedByEmployee ? 2 : 1;\n\n\t\tconst members = validation.map((item): SetupMember => {\n\t\t\tconst result = { ...item, party: currentParty };\n\t\t\tcurrentParty++;\n\n\t\t\treturn result;\n\t\t});\n\n\t\tmembers.push(this.#getAssignee(currentParty, company.entityId));\n\n\t\tlet signerParty = currentParty;\n\t\tif (this.isDocumentMode())\n\t\t{\n\t\t\tsignerParty = this.#isDocumentInitiatedByEmployee ? 1 : currentParty + 1;\n\t\t\tconst signers = userPartyEntities.map((entity) => this.#getSigner(signerParty, entity));\n\t\t\tmembers.push(...signers);\n\t\t}\n\n\t\treturn { members, signerParty };\n\t}\n\n\t#parseMembers(loadedMembers: SetupMember[]): { [$Keys<typeof MemberRole>]: number[]; }\n\t{\n\t\treturn loadedMembers.reduce((acc, member) => {\n\t\t\tconst { entityType, entityId } = member;\n\t\t\tif (entityType !== EntityType.USER && entityType !== EntityType.STRUCTURE_NODE_ROLE)\n\t\t\t{\n\t\t\t\treturn acc;\n\t\t\t}\n\n\t\t\tconst role = `${member.role}s`;\n\n\t\t\treturn {\n\t\t\t\t...acc,\n\t\t\t\t[role]: [\n\t\t\t\t\t...acc[role] ?? [],\n\t\t\t\t\tentityId,\n\t\t\t\t],\n\t\t\t};\n\t\t}, {});\n\t}\n\n\tasync applyDocumentData(uid: string): Promise<boolean>\n\t{\n\t\tconst setupData = await this.setupDocument(uid, true);\n\t\tif (!setupData)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (setupData.groupId)\n\t\t{\n\t\t\tconst documentsGroupData = await this.#api.getDocumentListInGroup(setupData.groupId);\n\t\t\tfor (const item of documentsGroupData)\n\t\t\t{\n\t\t\t\tthis.addInDocumentsGroupUids(item.uid);\n\n\t\t\t\tconst blocks = await this.#api.loadBlocksByDocument(item.uid);\n\t\t\t\tconst updatedItem = { ...item, blocks };\n\t\t\t\tthis.documentsGroup.set(item.uid, updatedItem);\n\t\t\t\tthis.documentSetup.renderDocumentBlock(updatedItem);\n\t\t\t\tthis.documentSetup.blankSelector.disableSelectedBlank(updatedItem.blankId);\n\t\t\t}\n\t\t\tthis.groupId = setupData.groupId;\n\t\t\tthis.documentSetup.documentCounters.update(this.documentsGroup.size);\n\t\t\tthis.#resetDocument();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.documentsGroup.set(setupData.uid, setupData);\n\t\t\tthis.addInDocumentsGroupUids(setupData.uid);\n\t\t}\n\n\t\tconst firstDocument = this.getFirstDocumentDataFromGroup();\n\t\tconst { entityId, representativeId, companyUid, companyEntityId, hcmLinkCompanyId } = firstDocument;\n\t\tthis.documentSend.documentData = this.documentsGroup;\n\n\t\tthis.#disableDocumentSectionIfLimitReached();\n\n\t\tif (this.isSingleDocument())\n\t\t{\n\t\t\tthis.editor.documentData = firstDocument;\n\t\t}\n\n\t\tconst members = await this.#api.loadMembers(uid);\n\n\t\tif (representativeId)\n\t\t{\n\t\t\tconst memberEntityType = this.#getMemberEntityTypeByRole(members, MemberRole.assignee);\n\t\t\tthis.#companyParty.loadRepresentative(representativeId, memberEntityType);\n\t\t}\n\n\t\tconst parsedMembers = this.#parseMembers(members);\n\t\tconst { signers = [], reviewers = [], editors = [], assignees = [] } = parsedMembers;\n\n\t\tthis.#companyParty.setEntityId(entityId);\n\t\tif (companyUid)\n\t\t{\n\t\t\tthis.#regionalSettings.setLastSavedHcmLinkCompanyId(hcmLinkCompanyId);\n\t\t\tthis.#companyParty.loadCompany(\n\t\t\t\tcompanyUid,\n\t\t\t\t// workaround (assignee member) for old drafts/templates\n\t\t\t\tcompanyEntityId ?? assignees[0] ?? null,\n\t\t\t);\n\t\t}\n\n\t\tif (signers.length > 0)\n\t\t{\n\t\t\tthis.#userParty.load(signers);\n\t\t}\n\n\t\tthis.#companyParty.loadValidator(members);\n\n\t\treturn true;\n\t}\n\n\t#getMemberEntityTypeByRole(members: SetupMember[], role: MemberRole): string\n\t{\n\t\tconst member: SetupMember = members.find(\n\t\t\t(setupMemberItem: SetupMember) => setupMemberItem.role === role,\n\t\t);\n\n\t\treturn member?.entityType === EntityType.STRUCTURE_NODE_ROLE ? EntityType.STRUCTURE_NODE_ROLE : EntityType.USER;\n\t}\n\n\tasync applyTemplateData(templateUid: string): Promise<boolean>\n\t{\n\t\tsuper.applyTemplateData(templateUid);\n\n\t\tthis.documentSetup.setupData.templateUid = templateUid;\n\t\tthis.documentSend.setExistingTemplate();\n\n\t\treturn true;\n\t}\n\n\t#getSetupStep(signSettings: B2ESignSettings, documentUid?: string): $Values<Metadata>\n\t{\n\t\treturn {\n\t\t\tget content(): HTMLElement\n\t\t\t{\n\t\t\t\tconst layout = signSettings.documentSetup.layout;\n\t\t\t\tSignSettingsItemCounter.numerate(layout);\n\n\t\t\t\tif (!Type.isNull(signSettings.getAfterPreviewLayout()))\n\t\t\t\t{\n\t\t\t\t\tBX.show(signSettings.getAfterPreviewLayout());\n\t\t\t\t}\n\n\t\t\t\treturn layout;\n\t\t\t},\n\t\t\ttitle: Loc.getMessage('SIGN_SETTINGS_B2B_LOAD_DOCUMENT'),\n\t\t\tbeforeCompletion: async () => {\n\t\t\t\tconst blankIsSelected = this.documentSetup.blankSelector.selectedBlankId !== 0;\n\t\t\t\tif (blankIsSelected || this.documentSetup.isFileAdded)\n\t\t\t\t{\n\t\t\t\t\tconst isValid = this.documentSetup.validate();\n\t\t\t\t\tif (!isValid)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst setupData = await this.setupDocument();\n\t\t\t\tif (!setupData)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tawait this.#addDocumentInGroup(setupData);\n\t\t\t\tif (this.editedDocument)\n\t\t\t\t{\n\t\t\t\t\tawait this.#handleEditedDocument(setupData);\n\t\t\t\t}\n\n\t\t\t\tthis.#resetDocument();\n\t\t\t\tthis.#processSetupData();\n\t\t\t\tthis.#disableDocumentSectionIfLimitReached();\n\n\t\t\t\tif (!Type.isNull(this.getAfterPreviewLayout()))\n\t\t\t\t{\n\t\t\t\t\tBX.hide(this.getAfterPreviewLayout());\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t},\n\t\t};\n\t}\n\n\t#getCompanyStep(signSettings: B2ESignSettings): $Values<Metadata>\n\t{\n\t\tconst titleLocCode = this.isTemplateMode()\n\t\t\t? 'SIGN_SETTINGS_B2E_ROUTES'\n\t\t\t: 'SIGN_SETTINGS_B2E_COMPANY'\n\t\t;\n\n\t\treturn {\n\t\t\tget content(): HTMLElement\n\t\t\t{\n\t\t\t\tconst layout = signSettings.#companyParty.getLayout();\n\t\t\t\tconst isTemplateModeForCompany = signSettings.#isTemplateModeForCompany();\n\n\t\t\t\tif (signSettings.isTemplateMode())\n\t\t\t\t{\n\t\t\t\t\tsignSettings.#companyParty.setEditorAvailability(isTemplateModeForCompany);\n\t\t\t\t}\n\t\t\t\tSignSettingsItemCounter.numerate(layout);\n\n\t\t\t\tif (!signSettings.isEditMode())\n\t\t\t\t{\n\t\t\t\t\tif (!signSettings.#companyParty.isRepresentativeSelected())\n\t\t\t\t\t{\n\t\t\t\t\t\tsignSettings.#companyParty.loadFirstRepresentative();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!signSettings.#companyParty.isProviderSelected())\n\t\t\t\t\t{\n\t\t\t\t\t\tsignSettings.#companyParty.loadFirstCompany();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn layout;\n\t\t\t},\n\t\t\ttitle: Loc.getMessage(titleLocCode),\n\t\t\tbeforeCompletion: async () => {\n\t\t\t\tconst { initiatedByType } = this.documentSetup.setupData;\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tfor (const [uid] of this.documentsGroup)\n\t\t\t\t\t{\n\t\t\t\t\t\t// eslint-disable-next-line no-await-in-loop\n\t\t\t\t\t\tawait this.#companyParty.save(uid);\n\t\t\t\t\t}\n\t\t\t\t\tthis.#regionalSettings.companyId = this.#companyParty.getSelectedCompanyId();\n\t\t\t\t\tthis.#regionalSettings.documentsGroup = this.documentsGroup;\n\n\t\t\t\t\tthis.editor.setSenderType(initiatedByType);\n\n\t\t\t\t\tthis.#setSecondPartySectionVisibility();\n\n\t\t\t\t\tif (this.isTemplateMode())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#executeDocumentSendActions();\n\t\t\t\t\t\tthis.#regionalSettings.isIntegrationVisible = !this.#isInitiatedByEmployee();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcatch (e)\n\t\t\t\t{\n\t\t\t\t\tconsole.warn(e);\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t},\n\t\t};\n\t}\n\n\t#getRegionalSettingsStep(signSettings: B2ESignSettings, documentUid: string): $Values<Metadata>\n\t{\n\t\treturn {\n\t\t\tget content(): HTMLElement\n\t\t\t{\n\t\t\t\treturn signSettings.#regionalSettings.getLayout();\n\t\t\t},\n\t\t\ttitle: Loc.getMessage('SIGN_SETTINGS_B2E_REGIONAL_SETTINGS_SHORT'),\n\t\t\tbeforeCompletion: async () => {\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tawait this.#regionalSettings.save();\n\t\t\t\t}\n\t\t\t\tcatch\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tthis.documentSetup.setupData.hcmLinkCompanyId = this.#regionalSettings.getSelectedHcmLinkCompanyId();\n\t\t\t\tthis.documentSend.hcmLinkEnabled = this.documentSetup.setupData.hcmLinkCompanyId > 0;\n\n\t\t\t\tawait this.#setHcmLinkIntegrationSectionVisibility();\n\n\t\t\t\tif (this.isTemplateMode())\n\t\t\t\t{\n\t\t\t\t\tconst { uid } = this.documentSetup.setupData;\n\t\t\t\t\tconst isB2eDocumentSectionDisabled = !this.documentSetup.isRuRegion() || this.#isInitiatedByEmployee();\n\t\t\t\t\tthis.editor.setIsB2eDocumentSectionDisabled(isB2eDocumentSectionDisabled);\n\t\t\t\t\tthis.editor.entityData = await this.#setupParties();\n\t\t\t\t\tconst { isTemplate, entityId } = this.documentSetup.setupData;\n\t\t\t\t\tconst blocks = await this.documentSetup.loadBlocks(uid);\n\n\t\t\t\t\tconst editorData = { isTemplate, uid, blocks, entityId };\n\t\t\t\t\tthis.#executeEditorActions(editorData);\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t},\n\t\t};\n\t}\n\n\t#getEmployeeStep(signSettings: B2ESignSettings): $Values<Metadata>\n\t{\n\t\treturn {\n\t\t\tget content(): HTMLElement\n\t\t\t{\n\t\t\t\tconst layout = signSettings.#userParty.getLayout();\n\t\t\t\tSignSettingsItemCounter.numerate(layout);\n\n\t\t\t\treturn layout;\n\t\t\t},\n\t\t\ttitle: Loc.getMessage('SIGN_SETTINGS_B2E_EMPLOYEES'),\n\t\t\tbeforeCompletion: async () => {\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tconst isValid = this.#userParty.validate();\n\t\t\t\t\tif (!isValid)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn isValid;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.editor.entityData = await this.#setupParties();\n\n\t\t\t\t\tconst { uid, isTemplate, entityId } = this.documentSetup.setupData;\n\t\t\t\t\tconst blocks = await this.documentSetup.loadBlocks(uid);\n\n\t\t\t\t\tthis.#executeDocumentSendActions();\n\n\t\t\t\t\tconst editorData = { isTemplate, uid, blocks, entityId };\n\t\t\t\t\tawait this.#executeEditorActions(editorData);\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\tcatch (e)\n\t\t\t\t{\n\t\t\t\t\tconsole.error(e);\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\t}\n\n\tasync #executeDocumentSendActions(): Promise<void>\n\t{\n\t\tconst partiesData = this.#companyParty.getParties();\n\t\tObject.assign(partiesData, {\n\t\t\temployees: this.#userParty.getEntities().map((entity) => {\n\t\t\t\treturn {\n\t\t\t\t\tentityType: entity.entityType,\n\t\t\t\t\tentityId: entity.entityId,\n\t\t\t\t};\n\t\t\t}),\n\t\t});\n\t\tthis.documentSend.documentData = this.documentsGroup;\n\t\tthis.documentSend.resetUserPartyPopup();\n\t\tthis.documentSend.setPartiesData(partiesData);\n\t}\n\n\tasync #executeEditorActions(editorData: {\n\t\tisTemplate: boolean,\n\t\tuid: string,\n\t\tblocks: Array,\n\t\tentityId: number\n\t}): Promise<void>\n\t{\n\t\tif (this.isTemplateCreateMode())\n\t\t{\n\t\t\tthis.editor.setAnalytics(this.getAnalytics());\n\t\t}\n\t\tthis.wizard.toggleBtnLoadingState('next', false);\n\t\tif (this.isSingleDocument())\n\t\t{\n\t\t\tthis.editor.documentData = editorData;\n\t\t\tawait this.editor.renderDocument();\n\t\t\tif (!this.#needSkipEditorStep || this.isTemplateMode())\n\t\t\t{\n\t\t\t\tawait this.editor.show();\n\t\t\t}\n\t\t}\n\t}\n\n\t#getSendStep(signSettings: B2ESignSettings): Metadata[string]\n\t{\n\t\tconst titleLocCode = this.isTemplateMode()\n\t\t\t? 'SIGN_SETTINGS_SEND_DOCUMENT_CREATE'\n\t\t\t: 'SIGN_SETTINGS_SEND_DOCUMENT'\n\t\t;\n\n\t\treturn {\n\t\t\tget content(): HTMLElement\n\t\t\t{\n\t\t\t\tconst layout = signSettings.documentSend.getLayout();\n\t\t\t\tSignSettingsItemCounter.numerate(layout);\n\n\t\t\t\tif (!signSettings.documentSend.isDateTimeLimitSelectorValid())\n\t\t\t\t{\n\t\t\t\t\tsignSettings.wizard.toggleBtnActiveState('complete', true);\n\t\t\t\t}\n\n\t\t\t\treturn layout;\n\t\t\t},\n\t\t\ttitle: Loc.getMessage(titleLocCode),\n\t\t\tbeforeCompletion: async () => {\n\t\t\t\treturn this.documentSend.sendForSign();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetStepsMetadata(signSettings: this, documentUid: ?string, templateUid?: string): Metadata\n\t{\n\t\tthis.#sendAnalyticsOnStart(documentUid);\n\t\tconst steps = {\n\t\t\tsetup: this.#getSetupStep(signSettings, documentUid),\n\t\t\tcompany: this.#getCompanyStep(signSettings),\n\t\t};\n\n\t\tif (this.#isRegionalSettingsStepEnabled())\n\t\t{\n\t\t\tsteps.regionalSettings = this.#getRegionalSettingsStep(signSettings, documentUid);\n\t\t}\n\n\t\tif (this.isDocumentMode())\n\t\t{\n\t\t\tsteps.employees = this.#getEmployeeStep(signSettings);\n\t\t}\n\n\t\tsteps.send = this.#getSendStep(signSettings);\n\n\t\tthis.#decorateStepsBeforeCompletionWithAnalytics(steps, documentUid);\n\n\t\treturn steps;\n\t}\n\n\t#isRegionalSettingsStepEnabled(): boolean\n\t{\n\t\treturn this.documentSetup.isRuRegion();\n\t}\n\n\tasync init(uid: ?string, templateUid: string)\n\t{\n\t\tawait super.init(uid, templateUid);\n\n\t\tif (this.isEditMode() && !Type.isNull(this.getAfterPreviewLayout()))\n\t\t{\n\t\t\tBX.hide(this.getAfterPreviewLayout());\n\t\t}\n\n\t\tif (this.isEditMode())\n\t\t{\n\t\t\tthis.documentSetup.setDocumentTitle(this.documentSetup.setupData.title);\n\t\t\tthis.documentSetup.enableDocumentInputs();\n\t\t}\n\t}\n\n\tonComplete(showNotification: boolean = true): void\n\t{\n\t\tif (this.isTemplateMode())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tsuper.onComplete(showNotification);\n\t}\n\n\tisTemplateCreateMode(): boolean\n\t{\n\t\treturn isTemplateMode(this.documentMode) && !this.isEditMode();\n\t}\n\n\t#setSecondPartySectionVisibility(): void\n\t{\n\t\tconst selectedProvider = this.#companyParty.getSelectedProvider();\n\t\tconst isNotSesRuProvider = selectedProvider.code !== ProviderCode.sesRu;\n\n\t\tconst isSecondPartySectionVisible = isNotSesRuProvider\n\t\t\t|| (isTemplateMode(this.documentMode) && this.#isInitiatedByEmployee())\n\t\t;\n\n\t\tthis.editor.setSectionVisibilityByType(\n\t\t\tSectionType.SecondParty,\n\t\t\tisSecondPartySectionVisible,\n\t\t);\n\t}\n\n\tasync #setHcmLinkIntegrationSectionVisibility(): Promise<void>\n\t{\n\t\tconst isInitiatedByCompany = this.documentSetup.setupData.initiatedByType === DocumentInitiated.company;\n\n\t\tif (this.#isInitiatedByEmployee() && this.documentSetup.isRuRegion())\n\t\t{\n\t\t\tawait this.#api.changeIntegrationId(this.documentSetup.setupData.uid, null);\n\t\t}\n\n\t\tconst isHcmLinkIntegrationSectionVisible = this.documentSetup.setupData.hcmLinkCompanyId > 0\n\t\t\t&& isInitiatedByCompany\n\t\t;\n\n\t\tthis.editor.setSectionVisibilityByType(\n\t\t\tSectionType.HcmLinkIntegration,\n\t\t\tisHcmLinkIntegrationSectionVisible,\n\t\t);\n\t}\n\n\t#isInitiatedByEmployee(): boolean\n\t{\n\t\treturn this.documentSetup.setupData.initiatedByType === DocumentInitiated.employee;\n\t}\n\n\t#decorateStepsBeforeCompletionWithAnalytics(steps: Metadata, documentUid?: string): void\n\t{\n\t\tconst analytics = this.getAnalytics();\n\n\t\tif (Type.isPlainObject(steps.setup))\n\t\t{\n\t\t\tsteps.setup.beforeCompletion = decorateResultBeforeCompletion(\n\t\t\t\tsteps.setup.beforeCompletion,\n\t\t\t\t() => this.#sendAnalyticsOnSetupStep(analytics, documentUid),\n\t\t\t\t() => this.#sendAnalyticsOnSetupError(analytics),\n\t\t\t);\n\t\t}\n\n\t\tif (Type.isPlainObject(steps.company))\n\t\t{\n\t\t\tsteps.company.beforeCompletion = decorateResultBeforeCompletion(\n\t\t\t\tsteps.company.beforeCompletion,\n\t\t\t\t() => this.#sendAnalyticsOnCompanyStepSuccess(analytics),\n\t\t\t\t() => this.#sendAnalyticsOnCompanyStepError(analytics),\n\t\t\t);\n\t\t}\n\n\t\tif (Type.isPlainObject(steps.send))\n\t\t{\n\t\t\tsteps.send.beforeCompletion = decorateResultBeforeCompletion(\n\t\t\t\tsteps.send.beforeCompletion,\n\t\t\t\t() => this.#sendAnalyticsOnSendStepSuccess(analytics, this.documentSetup.setupData.uid),\n\t\t\t\t() => this.#sendAnalyticsOnSendStepError(analytics, this.documentSetup.setupData.uid),\n\t\t\t);\n\t\t}\n\t}\n\n\t#sendAnalyticsOnSetupStep(analytics: Analytics, documentUid?: string): void\n\t{\n\t\tif (this.isTemplateCreateMode())\n\t\t{\n\t\t\tanalytics.send({ event: 'proceed_step_document', c_element: 'create_button', status: 'success' });\n\t\t\tanalytics.send({\n\t\t\t\tevent: 'turn_on_off_template',\n\t\t\t\ttype: 'auto',\n\t\t\t\tc_element: 'off',\n\t\t\t\tp5: `templateId_${this.documentSetup.setupData.templateId}`,\n\t\t\t});\n\t\t}\n\t}\n\n\t#sendAnalyticsOnSetupError(analytics: Analytics): void\n\t{\n\t\tif (this.isTemplateCreateMode())\n\t\t{\n\t\t\tanalytics.send({ event: 'proceed_step_document', status: 'error', c_element: 'create_button' });\n\t\t}\n\t}\n\n\t#sendAnalyticsOnCompanyStepSuccess(analytics: Analytics): void\n\t{\n\t\tif (this.isTemplateCreateMode())\n\t\t{\n\t\t\tanalytics.send({ event: 'proceed_step_route', status: 'success', c_element: 'create_button' });\n\t\t}\n\t}\n\n\t#sendAnalyticsOnCompanyStepError(analytics: Analytics): void\n\t{\n\t\tif (this.isTemplateCreateMode())\n\t\t{\n\t\t\tanalytics.send({ event: 'proceed_step_route', status: 'error', c_element: 'create_button' });\n\t\t}\n\t}\n\n\tasync #sendAnalyticsOnSendStepSuccess(analytics: Analytics, documentUid: string): void\n\t{\n\t\tif (this.isDocumentMode())\n\t\t{\n\t\t\tanalytics.sendWithProviderTypeAndDocId({\n\t\t\t\tevent: 'sent_document_to_sign',\n\t\t\t\tc_element: 'create_button',\n\t\t\t\tstatus: 'success',\n\t\t\t}, documentUid);\n\t\t}\n\t}\n\n\tasync #sendAnalyticsOnSendStepError(analytics: Analytics, documentUid: string): void\n\t{\n\t\tif (this.isTemplateCreateMode())\n\t\t{\n\t\t\tthis.getAnalytics().send({\n\t\t\t\tevent: 'click_save_template',\n\t\t\t\tstatus: 'error',\n\t\t\t\tc_element: 'create_button',\n\t\t\t});\n\t\t}\n\n\t\tif (this.isDocumentMode())\n\t\t{\n\t\t\tanalytics.sendWithProviderTypeAndDocId({\n\t\t\t\tevent: 'sent_document_to_sign',\n\t\t\t\tc_element: 'create_button',\n\t\t\t\tstatus: 'error',\n\t\t\t}, documentUid);\n\t\t}\n\t}\n\n\t#sendAnalyticsOnStart(documentUid?: string): void\n\t{\n\t\tconst analytics = this.getAnalytics();\n\t\tif (this.isTemplateCreateMode())\n\t\t{\n\t\t\tanalytics.send({ event: 'open_wizard', c_element: 'create_button' });\n\t\t}\n\t\telse if (this.isDocumentMode())\n\t\t{\n\t\t\tconst context = { event: 'click_create_document', c_element: 'create_button' };\n\t\t\tif (this.isEditMode() && Type.isStringFilled(documentUid))\n\t\t\t{\n\t\t\t\tanalytics.sendWithDocId(context, documentUid);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tanalytics.send(context);\n\t\t\t}\n\t\t}\n\t}\n\n\tasync #processSetupData(): Promise<void>\n\t{\n\t\tconst firstDocumentData = this.getFirstDocumentDataFromGroup();\n\t\tthis.#companyParty.setInitiatedByType(firstDocumentData.initiatedByType);\n\t\tthis.#companyParty.setEntityId(firstDocumentData.entityId);\n\t\tif (this.isTemplateMode())\n\t\t{\n\t\t\tthis.#companyParty.reloadCompanyProviders();\n\t\t}\n\t\tthis.editedDocument = null;\n\n\t\tif (this.hasPreviewUrls)\n\t\t{\n\t\t\tthis.wizard.toggleBtnActiveState('next', false);\n\t\t}\n\t}\n\n\tasync #addDocumentInGroup(setupData: DocumentDetails): Promise<void>\n\t{\n\t\tif (this.documentSetup.blankIsNotSelected)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isTemplateMode() || !FeatureStorage.isGroupSendingEnabled())\n\t\t{\n\t\t\tthis.setSingleDocument(setupData);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.documentsGroup.set(setupData.uid, setupData);\n\t\tthis.addInDocumentsGroupUids(setupData.uid);\n\t\tthis.documentSetup.blankSelector.disableSelectedBlank(setupData.blankId);\n\n\t\tif (!setupData.groupId && !this.editedDocument)\n\t\t{\n\t\t\tawait this.#attachGroupToDocument(setupData);\n\t\t}\n\n\t\tif (!this.isTemplateMode())\n\t\t{\n\t\t\tthis.documentSetup.documentCounters.update(this.documentsGroup.size);\n\t\t}\n\n\t\tif (!this.editedDocument)\n\t\t{\n\t\t\tthis.documentSetup.renderDocumentBlock(setupData);\n\t\t}\n\t}\n\n\t#scrollToTop(): void\n\t{\n\t\twindow.scrollTo({\n\t\t\ttop: 0,\n\t\t\tbehavior: 'smooth',\n\t\t});\n\t}\n\n\t#scrollToDown(): void\n\t{\n\t\twindow.scrollTo({\n\t\t\ttop: document.body.scrollHeight,\n\t\t\tbehavior: 'smooth',\n\t\t});\n\t}\n\n\t#resetDocument(): void\n\t{\n\t\tif (this.isTemplateMode() || !FeatureStorage.isGroupSendingEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.documentSetup.resetDocument();\n\n\t\tthis.editedDocument = null;\n\t}\n\n\t#disableDocumentSectionIfLimitReached(): void\n\t{\n\t\tif (this.documentsGroup.size >= this.#maxDocumentCount)\n\t\t{\n\t\t\tthis.documentSetup.setAvailabilityDocumentSection(false);\n\t\t}\n\t}\n\n\tgetAfterPreviewLayout(): HTMLElement | null\n\t{\n\t\tif (!this.isDocumentMode() || !FeatureStorage.isMultiDocumentLoadingEnabled())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn this.#cache.remember('beforePreviewLayout', () => Tag.render`\n\t\t\t<button class=\"ui-btn ui-btn-light-border ui-btn-md\" style=\"margin-top: 20px;\" onclick=\"${() => this.#onBeforePreviewBtnClick()}\">\n\t\t\t\t${Loc.getMessage('SIGN_SETTINGS_B2E_BEFORE_PREVIEW')}\n\t\t\t</button>\n\t\t`);\n\t}\n\n\t#onBeforePreviewBtnClick(): void\n\t{\n\t\t// eslint-disable-next-line unicorn/no-this-assignment\n\t\tconst self = this;\n\t\tBX.SidePanel.Instance.open('sign-settings:afterPreviewSidePanel', {\n\t\t\tcacheable: false,\n\t\t\twidth: 750,\n\t\t\tcontentCallback: () => {\n\t\t\t\tself.#resetAfterPreviewSidePanel();\n\n\t\t\t\treturn Layout.createContent({\n\t\t\t\t\textensions: ['ui.forms'],\n\t\t\t\t\ttitle: 'Добавить папку с файлами',\n\t\t\t\t\tcontent(): void\n\t\t\t\t\t{\n\t\t\t\t\t\tself.#getUploader();\n\n\t\t\t\t\t\treturn self.#getMultiDocumentAddSidePanelContent();\n\t\t\t\t\t},\n\t\t\t\t\tbuttons({ cancelButton, SaveButton })\n\t\t\t\t\t{\n\t\t\t\t\t\tself.#saveButton = new SaveButton({\n\t\t\t\t\t\t\tonclick: () => self.#onBeforePreviewSaveBtnClick(),\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\tself.#saveButton,\n\t\t\t\t\t\t];\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tonClose: (event) => {\n\t\t\t\t\tif (this.#isMultiDocumentSaveProcessGone)\n\t\t\t\t\t{\n\t\t\t\t\t\tevent.denyAction();\n\t\t\t\t\t}\n\t\t\t\t\tthis.#resetAfterPreviewSidePanel();\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\t#getMultiDocumentAddSidePanelContent(): HTMLElement\n\t{\n\t\treturn this.#cache.remember('multiDocumentAddSidePanelContent', () => Tag.render`\n\t\t\t<div id=\"multiple-document-add-container\" style=\"display: flex; flex-direction: column;\">\n\t\t\t\t<div style=\"flex-direction: row;\">\n\t\t\t\t\t${this.#getUploadFileFromDirButton().root}\n\t\t\t\t\t${this.#getUploadFileButton()}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`);\n\t}\n\n\t#getUploader(): Uploader\n\t{\n\t\treturn this.#cache.remember('uploader', () => {\n\t\t\treturn new Uploader({\n\t\t\t\tid: 'sign-settings-uploader',\n\t\t\t\tcontroller: 'sign.upload.blankUploadController',\n\t\t\t\tacceptedFileTypes: [...acceptedUploaderFileTypes.values()].map((a) => `.${a}`),\n\t\t\t\tmultiple: true,\n\t\t\t\tautoUpload: false,\n\t\t\t\tmaxFileSize: 52_428_800,\n\t\t\t\timageMaxFileSize: 10_485_760,\n\t\t\t\tmaxTotalFileSize: 52_428_800,\n\t\t\t\tevents: {\n\t\t\t\t\t[UploaderEvent.BEFORE_FILES_ADD]: (event) => this.#onBeforeFilesAdd(event),\n\t\t\t\t\t[UploaderEvent.FILE_ADD]: (event) => this.#onFileAdd(event.getData().file),\n\t\t\t\t\t[UploaderEvent.UPLOAD_COMPLETE]: (event) => this.#onUploadComplete(event),\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\t#resetAfterPreviewSidePanel(): void\n\t{\n\t\tthis.#cache.delete('uploader');\n\t\tthis.#cache.delete('uploadButton');\n\t\tthis.#cache.delete('uploadFromDirButton');\n\t\tthis.#cache.delete('multiDocumentAddSidePanelContent');\n\t}\n\n\t#getUploadFileButton(): HTMLElement\n\t{\n\t\treturn this.#cache.remember('uploadButton', () => {\n\t\t\tconst layout = Tag.render`\n\t\t\t\t<div>\n\t\t\t\t\t<button class=\"ui-btn ui-btn-light-border\" style=\"margin-top: 15px;\" onclick=\"${() => layout.fileInput.click()}\">${Loc.getMessage('SIGN_V2_B2E_SIGN_SETTINGS_ADD_FILE')}</button>\n\t\t\t\t\t<input ref=\"fileInput\" hidden type=\"file\" multiple ref=\"fileInput\" onchange=\"${(event) => {\n\t\t\t\t\t\t\tthis.#onInputFileChange(event);\n\t\t\t\t\t\t\tevent.target.value = '';\n\t\t\t\t\t\t}}\"\n\t\t\t\t\t\taccept=\"${[...acceptedUploaderFileTypes.values()].map((n) => `.${n}`).join(', ')}\"\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\treturn layout.root;\n\t\t});\n\t}\n\n\t#getUploadFileFromDirButton(): { root: HTMLElement, fileInput: HTMLInputElement }\n\t{\n\t\treturn this.#cache.remember('uploadFromDirButton', () => {\n\t\t\tconst layout = Tag.render`\n\t\t\t\t<div>\n\t\t\t\t\t<button class=\"ui-btn ui-btn-primary\" style=\"margin-top: 15px;\" onclick=\"${() => layout.fileInput.click()}\">${Loc.getMessage('SIGN_V2_B2E_SIGN_SETTINGS_LOAD_FROM_DIRS')}</button>\n\t\t\t\t\t<input hidden type=\"file\" webkitdirectory multiple ref=\"fileInput\" onchange=\"${(event) => {\n\t\t\t\t\t\tthis.#onInputFileChange(event);\n\t\t\t\t\t\tevent.target.value = '';\n\t\t\t\t\t}}\">\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\treturn layout;\n\t\t});\n\t}\n\n\t#onInputFileChange(event: Event): void\n\t{\n\t\tconst target: HTMLInputElement = event.target;\n\t\tconst files = target.files;\n\t\tconst validatedFiles = [...files].filter((f: File) => acceptedUploaderFileTypes.has(\n\t\t\tf.name.split('.').at(-1),\n\t\t));\n\t\tthis.#getUploader().addFiles(validatedFiles);\n\t}\n\n\t#onFileAdd(file: UploaderFile): void\n\t{\n\t\tDom.insertAfter(\n\t\t\tTag.render`<p style=\"color: #666\">${Loc.getMessage('SIGN_V2_B2E_SIGN_SETTINGS_LOADED_FILE_NAME', { '#FILENAME#': Text.encode(file.getName()) })}</p>`,\n\t\t\tthis.#getUploadFileButton(),\n\t\t);\n\t}\n\n\t#onBeforePreviewSaveBtnClick(): void\n\t{\n\t\tif (this.#getUploader().getFiles().length === 0)\n\t\t{\n\t\t\talert(Loc.getMessage('SIGN_V2_B2E_SIGN_SETTINGS_NO_FILES_SELECTED'));\n\n\t\t\treturn;\n\t\t}\n\n\t\tDom.style(this.#getMultiDocumentAddSidePanelContent(), { opacity: 0.6, 'pointer-events': 'none' });\n\t\tthis.#isMultiDocumentSaveProcessGone = true;\n\t\tthis.#getUploader().start();\n\t\tthis.#saveButton.setClocking(true);\n\t}\n\n\tasync #onUploadComplete(event: BaseEvent): void\n\t{\n\t\tconst uploader = this.#getUploader();\n\t\tfor (const file of uploader.getFiles())\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst blankId = await this.documentSetup.blankSelector.createBlankFromOuterUploaderFiles([file]);\n\t\t\t\tthis.documentSetup.blankSelector.selectBlank(blankId);\n\t\t\t\tawait this.setDocumentsGroup();\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tconsole.error(`Error while add file with name ${file.getName()}`, e);\n\t\t\t}\n\t\t}\n\n\t\tDom.style(this.#getMultiDocumentAddSidePanelContent(), { opacity: 1, 'pointer-events': 'auto' });\n\t\tthis.#isMultiDocumentSaveProcessGone = false;\n\t\tthis.#saveButton.setClocking(false);\n\t\tBX.SidePanel.Instance.close();\n\t}\n\n\t#onBeforeFilesAdd(event: BaseEvent<{ files: Array<UploaderFile> }>): void\n\t{\n\t\tconst uploaderConfig = {\n\t\t\tmaxFileSize: 52_428_800,\n\t\t\timageMaxFileSize: 10_485_760,\n\t\t\tmaxTotalFileSize: 52_428_800,\n\t\t};\n\t\tconst data = event.getData();\n\t\tconst files: UploaderFile[] = data.files;\n\t\tconst uploader = this.#getUploader();\n\t\tconst allFilesWithNew: UploaderFile[] = [...files, ...uploader.getFiles()];\n\n\t\tif ((allFilesWithNew.length + this.documentsGroup.size) > this.#maxDocumentCount)\n\t\t{\n\t\t\talert(Loc.getMessage('SIGN_V2_B2E_SIGN_SETTINGS_MAX_DOCUMENTS_COUNT_EXCEEDED'));\n\t\t\tevent.preventDefault();\n\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const file of files)\n\t\t{\n\t\t\tif (file.getSize() > uploaderConfig.maxFileSize)\n\t\t\t{\n\t\t\t\talert(Loc.getMessage('SIGN_V2_B2E_SIGN_SETTINGS_INVALID_FILE_SIZE'));\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (file.isImage() && file.getSize() > uploaderConfig.imageMaxFileSize)\n\t\t\t{\n\t\t\t\talert(Loc.getMessage('SIGN_V2_B2E_SIGN_SETTINGS_INVALID_IMAGE_FILE_SIZE'));\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tconst totalFileSize = allFilesWithNew.reduce((acc, file) => acc + file.getSize(), 0);\n\t\tif (totalFileSize > uploaderConfig.maxTotalFileSize)\n\t\t{\n\t\t\talert(Loc.getMessage('SIGN_V2_B2E_SIGN_SETTINGS_MAX_TOTAL_FILE_SIZE_EXCEEDED'));\n\t\t\tevent.preventDefault();\n\t\t}\n\t}\n\n\t#isIntegrationEnabled(code: ProviderCodeType): boolean\n\t{\n\t\treturn code && code !== ProviderCode.sesRu;\n\t}\n}\n"],"names":["acceptedUploaderFileTypes","Set","B2ESignSettings","SignSettings","constructor","containerId","signOptions","next","className","complete","swapButtons","MemoryCache","b2eFeatureConfig","blankSelectorConfig","documentSendConfig","userPartyConfig","documentSetup","DocumentSetup","documentSend","DocumentSend","CompanyParty","documentInitiatedType","initiatedByType","documentMode","hcmLinkAvailable","RegionalSettings","templateMode","isTemplateMode","regionDocumentTypes","isIntegrationVisible","DocumentInitiated","employee","Api","b2eDocumentLimitCount","UserParty","mode","subscribeOnEvents","needSkipEditorStep","editor","setIsB2eDocumentSectionDisabled","isRuRegion","setSectionVisibilityByType","SectionType","HcmLinkIntegration","subscribe","event","setProvider","data","provider","isIntegrationEnabled","code","setDocumentTitle","title","wizard","toggleBtnActiveState","setDocumentsGroup","uid","setAvailabilityDocumentSection","events","onTemplateComplete","isEditMode","templateId","getData","getAnalytics","send","type","c_element","p5","status","blankIsNotSelected","validate","switchAddDocumentButtonLoadingState","documentData","setupDocument","documentsGroup","set","addInDocumentsGroupUids","blankSelector","disableSelectedBlank","blankId","editedDocument","renderDocumentBlock","documentCounters","update","size","documentsGroupUids","includes","push","replaceInDocumentsGroupUids","oldUid","newUid","index","indexOf","splice","deleteFromDocumentsGroupUids","applyDocumentData","setupData","groupId","documentsGroupData","getDocumentListInGroup","item","blocks","loadBlocksByDocument","updatedItem","firstDocument","getFirstDocumentDataFromGroup","entityId","representativeId","companyUid","companyEntityId","hcmLinkCompanyId","isSingleDocument","members","loadMembers","memberEntityType","MemberRole","assignee","loadRepresentative","parsedMembers","signers","reviewers","editors","assignees","setEntityId","setLastSavedHcmLinkCompanyId","loadCompany","length","load","loadValidator","applyTemplateData","templateUid","setExistingTemplate","getStepsMetadata","signSettings","documentUid","steps","setup","company","regionalSettings","isDocumentMode","employees","init","Type","isNull","getAfterPreviewLayout","BX","hide","enableDocumentInputs","onComplete","showNotification","isTemplateCreateMode","FeatureStorage","isMultiDocumentLoadingEnabled","remember","Tag","render","Loc","getMessage","config","fromRobot","fromTemplateFolder","isOpenedFromRobot","isOpenedFromTemplateFolder","editMode","get","isFileAdded","resetEditMode","replaceDocumentBlock","setUrls","documentId","deletedElement","layout","querySelector","remove","createDocumentsGroup","targetDocument","attachGroupToDocument","error","console","updatedDocumentData","updateDocumentData","updateDocumentBlock","id","setDocumentsBlock","deleteButton","ready","removeDocument","isFirstDocumentSelected","resetPreview","hasPreviewUrls","deleteDocument","delete","enableSelectedBlank","deleteDocumentFromList","toggleDeleteBtnLoadingState","representative","getParties","signerParty","documentUids","keys","setupB2eParties","membersData","isArrayFilled","Error","syncMemberPromises","map","Promise","all","memberData","presetId","part","party","entityTypeId","role","isInitiatedByCompany","syncFinished","response","syncB2eMembersWithDepartments","ms","resolve","setTimeout","currentParty","companyId","EntityType","COMPANY","entityType","USER","entity","signer","validation","userPartyEntities","getEntities","result","loadedMembers","reduce","acc","member","STRUCTURE_NODE_ROLE","find","setupMemberItem","content","SignSettingsItemCounter","numerate","show","beforeCompletion","blankIsSelected","selectedBlankId","isValid","titleLocCode","getLayout","isTemplateModeForCompany","setEditorAvailability","isRepresentativeSelected","loadFirstRepresentative","isProviderSelected","loadFirstCompany","save","getSelectedCompanyId","setSenderType","e","warn","getSelectedHcmLinkCompanyId","hcmLinkEnabled","isB2eDocumentSectionDisabled","entityData","isTemplate","loadBlocks","editorData","partiesData","Object","assign","resetUserPartyPopup","setPartiesData","setAnalytics","toggleBtnLoadingState","renderDocument","isDateTimeLimitSelectorValid","sendForSign","selectedProvider","getSelectedProvider","isNotSesRuProvider","ProviderCode","sesRu","isSecondPartySectionVisible","SecondParty","changeIntegrationId","isHcmLinkIntegrationSectionVisible","analytics","isPlainObject","decorateResultBeforeCompletion","sendWithProviderTypeAndDocId","context","isStringFilled","sendWithDocId","firstDocumentData","setInitiatedByType","reloadCompanyProviders","isGroupSendingEnabled","setSingleDocument","window","scrollTo","top","behavior","document","body","scrollHeight","resetDocument","self","SidePanel","Instance","open","cacheable","width","contentCallback","Layout","createContent","extensions","buttons","cancelButton","SaveButton","onclick","onClose","denyAction","root","Uploader","controller","acceptedFileTypes","values","a","multiple","autoUpload","maxFileSize","imageMaxFileSize","maxTotalFileSize","UploaderEvent","BEFORE_FILES_ADD","FILE_ADD","file","UPLOAD_COMPLETE","fileInput","click","target","value","n","join","files","validatedFiles","filter","f","has","name","split","at","addFiles","Dom","insertAfter","Text","encode","getName","getFiles","alert","style","opacity","start","setClocking","uploader","createBlankFromOuterUploaderFiles","selectBlank","close","uploaderConfig","allFilesWithNew","preventDefault","getSize","isImage","totalFileSize"],"mappings":";;;;;;;;;;;;;AAAA,CA+CA,MAAMA,yBAAsC,GAAG,IAAIC,GAAG,CAAC,CACtD,KAAK,EACL,MAAM,EACN,KAAK,EACL,KAAK,EACL,KAAK,EACL,MAAM,EACN,KAAK,EACL,KAAK,CACL,CAAC;CAAC;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAEH,CAAO,MAAMC,eAAe,SAASC,iCAAY,CACjD;GAaCC,WAAW,CAACC,WAAmB,EAAEC,YAAwB,EACzD;KACC,KAAK,CAACD,WAAW,EAAEC,YAAW,EAAE;OAC/BC,IAAI,EAAE;SACLC,SAAS,EAAE;QACX;OACDC,QAAQ,EAAE;SAAED,SAAS,EAAE;QAAkB;OACzCE,WAAW,EAAE;MACb,CAAC;KAAC;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA,OAbuB,IAAIC,2BAAW;;KAAE;OAAA;OAAA;;KAAA;OAAA;OAAA,OAED;;KAAK;OAAA;OAAA;;KAY/C,MAAM;OACLC,gBAAgB;OAChBC,mBAAmB,EAAnBA,oBAAmB;OACnBC,kBAAkB,EAAlBA,mBAAkB;OAClBC;MACA,2CAAG,IAAI,kCAAgBT,YAAW,CAAC;KAEpC,IAAI,CAACU,aAAa,GAAG,IAAIC,uCAAa,CAACJ,oBAAmB,CAAC;KAC3D,IAAI,CAACK,YAAY,GAAG,IAAIC,qCAAY,CAACL,mBAAkB,CAAC;KACxD,4CAAI,kCAAiB,IAAIM,2BAAY,CAAC;OACrC,GAAGP,oBAAmB;OACtBQ,qBAAqB,EAAEf,YAAW,CAACgB,eAAe;OAClDC,YAAY,EAAEjB,YAAW,CAACiB;MAC1B,EAAEX,gBAAgB,CAACY,gBAAgB,CAAC;KACrC,4CAAI,0CAAqB,IAAIC,6CAAgB,CAAC;OAC7CC,YAAY,EAAE,IAAI,CAACC,cAAc,EAAE;OACnCC,mBAAmB,EAAEf,oBAAmB,CAACe;MACzC,CAAC;KAEF,4CAAI,wCAAmBC,oBAAoB,GAAG,EAAE,IAAI,CAACF,cAAc,EAAE,IACjErB,YAAW,CAACgB,eAAe,KAAKQ,2BAAiB,CAACC,QAAQ,CAAC;KAE/D,4CAAI,gBAAQ,IAAIC,eAAG,EAAE;KACrB,4CAAI,0CAAqB1B,YAAW,CAAC2B,qBAAqB;KAC1D,4CAAI,4BAAc,IAAIC,+BAAS,CAAC;OAAEC,IAAI,EAAE,MAAM;OAAE,GAAGpB;MAAiB,CAAC;KACrE,IAAI,CAACqB,iBAAiB,EAAE;KACxB,4CAAI,8CAAuBtB,mBAAkB,CAACuB,kBAAkB;KAEhE,IAAI,CAACC,MAAM,CAACC,+BAA+B,CAAC,CAAC,IAAI,CAACvB,aAAa,CAACwB,UAAU,EAAE,CAAC;KAC7E,IAAI,CAACF,MAAM,CAACG,0BAA0B,CAACC,0BAAW,CAACC,kBAAkB,EAAE,KAAK,CAAC;KAE7E,4CAAI,gCAAeC,SAAS,CAAC,iBAAiB,EAAGC,KAA2B,IAAK;OAAA;OAChF,IAAI,CAAC3B,YAAY,CAAC4B,WAAW,CAACD,KAAK,CAACE,IAAI,CAACC,QAAQ,CAAC;OAClD,4CAAI,wCAAmBC,oBAAoB,2CAAG,IAAI,+DAAuBJ,KAAK,CAACE,IAAI,6CAAV,YAAYC,QAAQ,qBAApB,qBAAsBE,IAAI,CAAC;MACpG,CAAC;KACF,4CAAI,gCAAeN,SAAS,CAAC,kBAAkB,EAAGC,KAA4B,IAAK;OAAA;OAClF,IAAI,CAAC3B,YAAY,CAAC4B,WAAW,CAACD,KAAK,CAACE,IAAI,CAACC,QAAQ,CAAC;OAClD,4CAAI,wCAAmBC,oBAAoB,2CAAG,IAAI,gEAAuBJ,KAAK,CAACE,IAAI,8CAAV,aAAYC,QAAQ,qBAApB,sBAAsBE,IAAI,CAAC;MACpG,CAAC;;GAkBHd,iBAAiB,GACjB;KACC,KAAK,CAACA,iBAAiB,EAAE;KACzB,IAAI,CAAClB,YAAY,CAAC0B,SAAS,CAAC,aAAa,EAAE,CAAC;OAAEG;MAAM,KAAK;OACxD,IAAI,CAAC/B,aAAa,CAACmC,gBAAgB,CAACJ,IAAI,CAACK,KAAK,CAAC;MAC/C,CAAC;KACF,IAAI,CAAClC,YAAY,CAAC0B,SAAS,CAAC,aAAa,EAAE,MAAM;OAChD,IAAI,CAACS,MAAM,CAACC,oBAAoB,CAAC,MAAM,EAAE,IAAI,CAAC;MAC9C,CAAC;KACF,IAAI,CAACpC,YAAY,CAAC0B,SAAS,CAAC,YAAY,EAAE,MAAM;OAC/C,IAAI,CAACS,MAAM,CAACC,oBAAoB,CAAC,MAAM,EAAE,KAAK,CAAC;MAC/C,CAAC;KACF,IAAI,CAACtC,aAAa,CAAC4B,SAAS,CAAC,aAAa,EAAE,MAAM;OACjD,IAAI,CAACW,iBAAiB,EAAE;MACxB,CAAC;KACF,IAAI,CAACvC,aAAa,CAAC4B,SAAS,CAAC,gBAAgB,EAAE,CAAC;OAAEG;MAAM,KAAK;OAC5D,4CAAI,oCAAiBA,IAAI;MACzB,CAAC;KACF,IAAI,CAAC/B,aAAa,CAAC4B,SAAS,CAAC,cAAc,EAAE,CAAC;OAAEG;MAAM,KAAK;OAC1D,4CAAI,wCAAmBA,IAAI,CAACS,GAAG;MAC/B,CAAC;KACF,IAAI,CAACtC,YAAY,CAAC0B,SAAS,CAAC,gBAAgB,EAAE,MAAM;OACnD,IAAI,CAACS,MAAM,CAACC,oBAAoB,CAAC,UAAU,EAAE,KAAK,CAAC;MACnD,CAAC;KACF,IAAI,CAACpC,YAAY,CAAC0B,SAAS,CAAC,iBAAiB,EAAE,MAAM;OACpD,IAAI,CAACS,MAAM,CAACC,oBAAoB,CAAC,UAAU,EAAE,IAAI,CAAC;MAClD,CAAC;KACF,IAAI,CAACtC,aAAa,CAAC4B,SAAS,CAAC,wBAAwB,EAAE,MAAM;OAC5D,IAAI,CAAC5B,aAAa,CAACyC,8BAA8B,CAAC,KAAK,CAAC;MACxD,CAAC;KACF,IAAI,CAACzC,aAAa,CAAC4B,SAAS,CAAC,2BAA2B,EAAE,MAAM;OAC/D,IAAI,CAAC5B,aAAa,CAACyC,8BAA8B,CAAC,IAAI,CAAC;MACvD,CAAC;KACF,IAAI,CAACvC,YAAY,CAAC0B,SAAS,CAC1B,IAAI,CAAC1B,YAAY,CAACwC,MAAM,CAACC,kBAAkB,EAC1Cd,KAAwC,IAAK;OAC7C,IAAI,IAAI,CAAClB,cAAc,EAAE,IAAI,CAAC,IAAI,CAACiC,UAAU,EAAE,EAC/C;SACC,MAAMC,UAAU,GAAGhB,KAAK,CAACiB,OAAO,EAAE,CAACD,UAAU;SAC7C,IAAI,CAACE,YAAY,EAAE,CAACC,IAAI,CAAC;WACxBnB,KAAK,EAAE,sBAAsB;WAC7BoB,IAAI,EAAE,MAAM;WACZC,SAAS,EAAE,IAAI;WACfC,EAAE,EAAG,cAAaN,UAAW;UAC7B,CAAC;SACF,IAAI,CAACE,YAAY,EAAE,CAACC,IAAI,CAAC;WACxBnB,KAAK,EAAE,qBAAqB;WAC5BqB,SAAS,EAAE,eAAe;WAC1BC,EAAE,EAAG,cAAaN,UAAW,EAAC;WAC9BO,MAAM,EAAE;UACR,CAAC;;MAEH,CACD;;GAuBF,MAAMb,iBAAiB,GACvB;KACC,IAAI,IAAI,CAACvC,aAAa,CAACqD,kBAAkB,IAAI,CAAC,IAAI,CAACrD,aAAa,CAACsD,QAAQ,EAAE,EAC3E;OACC;;KAGD,IAAI,CAACtD,aAAa,CAACuD,mCAAmC,CAAC,IAAI,CAAC;KAC5D,IACA;OACC,MAAMC,YAAY,GAAG,MAAM,IAAI,CAACC,aAAa,EAAE;OAC/C,IAAI,CAACC,cAAc,CAACC,GAAG,CAACH,YAAY,CAAChB,GAAG,EAAEgB,YAAY,CAAC;OACvD,IAAI,CAACI,uBAAuB,CAACJ,YAAY,CAAChB,GAAG,CAAC;OAE9C,IAAI,CAACxC,aAAa,CAAC6D,aAAa,CAACC,oBAAoB,CAACN,YAAY,CAACO,OAAO,CAAC;OAE3E,8CAAM,IAAI,kDAAwBP,YAAY,CAAC;OAC/C,IAAI,CAACxD,aAAa,CAACuD,mCAAmC,CAAC,KAAK,CAAC;OAE7D,IAAI,IAAI,CAACS,cAAc,EACvB;SACC,8CAAM,IAAI,gDAAuBR,YAAY,CAAC;QAC9C,MAED;SACC,IAAI,CAACxD,aAAa,CAACiE,mBAAmB,CAACT,YAAY,CAAC;;MAErD,CACD,MACA;OACC,IAAI,CAACxD,aAAa,CAACuD,mCAAmC,CAAC,KAAK,CAAC;;KAG9D,4CAAI;KACJ,IAAI,CAACvD,aAAa,CAACkE,gBAAgB,CAACC,MAAM,CAAC,IAAI,CAACT,cAAc,CAACU,IAAI,CAAC;KACpE,4CAAI;KACJ,IAAI,CAAC/B,MAAM,CAACC,oBAAoB,CAAC,MAAM,EAAE,KAAK,CAAC;;GAGhDsB,uBAAuB,CAACpB,GAAW,EACnC;KACC,IAAI,CAAC,IAAI,CAAC6B,kBAAkB,CAACC,QAAQ,CAAC9B,GAAG,CAAC,EAC1C;OACC,IAAI,CAAC6B,kBAAkB,CAACE,IAAI,CAAC/B,GAAG,CAAC;;;GAuBnCgC,2BAA2B,CAACC,MAAc,EAAEC,MAAc,EAC1D;KACC,MAAMC,KAAK,GAAG,IAAI,CAACN,kBAAkB,CAACO,OAAO,CAACH,MAAM,CAAC;KACrD,IAAIE,KAAK,KAAK,CAAC,CAAC,EAChB;OACC,IAAI,CAACN,kBAAkB,CAACQ,MAAM,CAACF,KAAK,EAAE,CAAC,EAAED,MAAM,CAAC;;;GAIlDI,4BAA4B,CAACtC,GAAW,EACxC;KACC,MAAMmC,KAAK,GAAG,IAAI,CAACN,kBAAkB,CAACO,OAAO,CAACpC,GAAG,CAAC;KAElD,IAAImC,KAAK,KAAK,CAAC,CAAC,EAChB;OACC;;KAED,IAAI,CAACN,kBAAkB,CAACQ,MAAM,CAACF,KAAK,EAAE,CAAC,CAAC;;GA2OzC,MAAMI,iBAAiB,CAACvC,GAAW,EACnC;KACC,MAAMwC,SAAS,GAAG,MAAM,IAAI,CAACvB,aAAa,CAACjB,GAAG,EAAE,IAAI,CAAC;KACrD,IAAI,CAACwC,SAAS,EACd;OACC,OAAO,KAAK;;KAGb,IAAIA,SAAS,CAACC,OAAO,EACrB;OACC,MAAMC,kBAAkB,GAAG,MAAM,4CAAI,cAAMC,sBAAsB,CAACH,SAAS,CAACC,OAAO,CAAC;OACpF,KAAK,MAAMG,IAAI,IAAIF,kBAAkB,EACrC;SACC,IAAI,CAACtB,uBAAuB,CAACwB,IAAI,CAAC5C,GAAG,CAAC;SAEtC,MAAM6C,MAAM,GAAG,MAAM,4CAAI,cAAMC,oBAAoB,CAACF,IAAI,CAAC5C,GAAG,CAAC;SAC7D,MAAM+C,WAAW,GAAG;WAAE,GAAGH,IAAI;WAAEC;UAAQ;SACvC,IAAI,CAAC3B,cAAc,CAACC,GAAG,CAACyB,IAAI,CAAC5C,GAAG,EAAE+C,WAAW,CAAC;SAC9C,IAAI,CAACvF,aAAa,CAACiE,mBAAmB,CAACsB,WAAW,CAAC;SACnD,IAAI,CAACvF,aAAa,CAAC6D,aAAa,CAACC,oBAAoB,CAACyB,WAAW,CAACxB,OAAO,CAAC;;OAE3E,IAAI,CAACkB,OAAO,GAAGD,SAAS,CAACC,OAAO;OAChC,IAAI,CAACjF,aAAa,CAACkE,gBAAgB,CAACC,MAAM,CAAC,IAAI,CAACT,cAAc,CAACU,IAAI,CAAC;OACpE,4CAAI;MACJ,MAED;OACC,IAAI,CAACV,cAAc,CAACC,GAAG,CAACqB,SAAS,CAACxC,GAAG,EAAEwC,SAAS,CAAC;OACjD,IAAI,CAACpB,uBAAuB,CAACoB,SAAS,CAACxC,GAAG,CAAC;;KAG5C,MAAMgD,aAAa,GAAG,IAAI,CAACC,6BAA6B,EAAE;KAC1D,MAAM;OAAEC,QAAQ;OAAEC,gBAAgB;OAAEC,UAAU;OAAEC,eAAe;OAAEC;MAAkB,GAAGN,aAAa;KACnG,IAAI,CAACtF,YAAY,CAACsD,YAAY,GAAG,IAAI,CAACE,cAAc;KAEpD,4CAAI;KAEJ,IAAI,IAAI,CAACqC,gBAAgB,EAAE,EAC3B;OACC,IAAI,CAACzE,MAAM,CAACkC,YAAY,GAAGgC,aAAa;;KAGzC,MAAMQ,OAAO,GAAG,MAAM,4CAAI,cAAMC,WAAW,CAACzD,GAAG,CAAC;KAEhD,IAAImD,gBAAgB,EACpB;OACC,MAAMO,gBAAgB,2CAAG,IAAI,0DAA4BF,OAAO,EAAEG,oBAAU,CAACC,QAAQ,CAAC;OACtF,4CAAI,gCAAeC,kBAAkB,CAACV,gBAAgB,EAAEO,gBAAgB,CAAC;;KAG1E,MAAMI,aAAa,2CAAG,IAAI,gCAAeN,OAAO,CAAC;KACjD,MAAM;OAAEO,OAAO,GAAG,EAAE;OAAEC,SAAS,GAAG,EAAE;OAAEC,OAAO,GAAG,EAAE;OAAEC,SAAS,GAAG;MAAI,GAAGJ,aAAa;KAEpF,4CAAI,gCAAeK,WAAW,CAACjB,QAAQ,CAAC;KACxC,IAAIE,UAAU,EACd;OAAA;OACC,4CAAI,wCAAmBgB,4BAA4B,CAACd,gBAAgB,CAAC;OACrE,4CAAI,gCAAee,WAAW,CAC7BjB,UAAU;OACV,QACAC,eAAe,WAAfA,eAAe,GAAIa,SAAS,CAAC,CAAC,CAAC,mBAAI,IAAI,CACvC;;KAGF,IAAIH,OAAO,CAACO,MAAM,GAAG,CAAC,EACtB;OACC,4CAAI,0BAAYC,IAAI,CAACR,OAAO,CAAC;;KAG9B,4CAAI,gCAAeS,aAAa,CAAChB,OAAO,CAAC;KAEzC,OAAO,IAAI;;GAYZ,MAAMiB,iBAAiB,CAACC,WAAmB,EAC3C;KACC,KAAK,CAACD,iBAAiB,CAACC,WAAW,CAAC;KAEpC,IAAI,CAAClH,aAAa,CAACgF,SAAS,CAACkC,WAAW,GAAGA,WAAW;KACtD,IAAI,CAAChH,YAAY,CAACiH,mBAAmB,EAAE;KAEvC,OAAO,IAAI;;GAkRZC,gBAAgB,CAACC,YAAkB,EAAEC,WAAoB,EAAEJ,WAAoB,EAC/E;KACC,4CAAI,gDAAuBI,WAAW;KACtC,MAAMC,KAAK,GAAG;OACbC,KAAK,0CAAE,IAAI,gCAAeH,YAAY,EAAEC,WAAW,CAAC;OACpDG,OAAO,0CAAE,IAAI,oCAAiBJ,YAAY;MAC1C;KAED,4CAAI,IAAI,qEACR;OACCE,KAAK,CAACG,gBAAgB,2CAAG,IAAI,sDAA0BL,YAAY,EAAEC,WAAW,CAAC;;KAGlF,IAAI,IAAI,CAACK,cAAc,EAAE,EACzB;OACCJ,KAAK,CAACK,SAAS,2CAAG,IAAI,sCAAkBP,YAAY,CAAC;;KAGtDE,KAAK,CAACvE,IAAI,2CAAG,IAAI,8BAAcqE,YAAY,CAAC;KAE5C,4CAAI,4FAA6CE,KAAK,EAAED,WAAW;KAEnE,OAAOC,KAAK;;GAQb,MAAMM,IAAI,CAACrF,GAAY,EAAE0E,WAAmB,EAC5C;KACC,MAAM,KAAK,CAACW,IAAI,CAACrF,GAAG,EAAE0E,WAAW,CAAC;KAElC,IAAI,IAAI,CAACtE,UAAU,EAAE,IAAI,CAACkF,cAAI,CAACC,MAAM,CAAC,IAAI,CAACC,qBAAqB,EAAE,CAAC,EACnE;OACCC,EAAE,CAACC,IAAI,CAAC,IAAI,CAACF,qBAAqB,EAAE,CAAC;;KAGtC,IAAI,IAAI,CAACpF,UAAU,EAAE,EACrB;OACC,IAAI,CAAC5C,aAAa,CAACmC,gBAAgB,CAAC,IAAI,CAACnC,aAAa,CAACgF,SAAS,CAAC5C,KAAK,CAAC;OACvE,IAAI,CAACpC,aAAa,CAACmI,oBAAoB,EAAE;;;GAI3CC,UAAU,CAACC,gBAAyB,GAAG,IAAI,EAC3C;KACC,IAAI,IAAI,CAAC1H,cAAc,EAAE,EACzB;OACC;;KAED,KAAK,CAACyH,UAAU,CAACC,gBAAgB,CAAC;;GAGnCC,oBAAoB,GACpB;KACC,OAAO3H,mCAAc,CAAC,IAAI,CAACJ,YAAY,CAAC,IAAI,CAAC,IAAI,CAACqC,UAAU,EAAE;;GA6P/DoF,qBAAqB,GACrB;KACC,IAAI,CAAC,IAAI,CAACL,cAAc,EAAE,IAAI,CAACY,kCAAc,CAACC,6BAA6B,EAAE,EAC7E;OACC,OAAO,IAAI;;KAGZ,OAAO,4CAAI,kBAAQC,QAAQ,CAAC,qBAAqB,EAAE,MAAMC,aAAG,CAACC,MAAM,cAAC;6FACqB,CAAwC;MAC/H,CAAqD;;GAEvD,GAH2F,8CAAM,IAAI,uDAA2B,EAC5HC,aAAG,CAACC,UAAU,CAAC,kCAAkC,CAAC,CAErD,CAAC;;CAsOJ;CAAC,yBA5yCevJ,WAAwB,EACvC;GACC,MAAM;KAAEwJ,MAAM;KAAEvI,YAAY;KAAEwI,SAAS;KAAEC,kBAAkB;KAAE/H;IAAuB,GAAG3B,WAAW;GAElG,MAAM;KAAEO,mBAAmB;KAAEC;IAAoB,GAAGgJ,MAAM;GAC1DjJ,mBAAmB,CAACU,YAAY,GAAGA,YAAY;GAC/CV,mBAAmB,CAACoJ,iBAAiB,GAAGF,SAAS;GACjDlJ,mBAAmB,CAACoB,qBAAqB,GAAGA,qBAAqB;GACjEpB,mBAAmB,CAACqJ,0BAA0B,GAAGF,kBAAkB;GACnElJ,kBAAkB,CAACS,YAAY,GAAGA,YAAY;GAC9CT,kBAAkB,CAACmJ,iBAAiB,GAAGF,SAAS;GAEhD,OAAOD,MAAM;CACd;CAAC,kCA0DuBtG,GAAW,EACnC;GACC,IAAI,IAAI,CAACwB,cAAc,EACvB;KACC,8CAAM,IAAI,sDAA0B,IAAI,CAACA,cAAc,CAACxB,GAAG,CAAC;;GAG7D,IAAI,CAAC,IAAI,CAACxC,aAAa,CAACmJ,QAAQ,EAChC;KACC,4CAAI;KACJ,4CAAI;KAEJ;;GAED,IAAI,CAACnF,cAAc,GAAG,IAAI,CAACN,cAAc,CAAC0F,GAAG,CAAC5G,GAAG,CAAC;GAClD,IAAI,CAACxC,aAAa,CAACyC,8BAA8B,CAAC,IAAI,CAAC;GACvD,IAAI,CAACzC,aAAa,CAACmC,gBAAgB,CAAC,IAAI,CAAC6B,cAAc,CAAC5B,KAAK,CAAC;GAC9D,4CAAI;CACL;CAAC,sCAiD2BoB,YAAY,EACxC;GACC,IAAI,IAAI,CAACxD,aAAa,CAACqD,kBAAkB,IAAI,CAAC,IAAI,CAACrD,aAAa,CAACqJ,WAAW,EAC5E;KACC,IAAI,CAACrJ,aAAa,CAACsJ,aAAa,EAAE;KAClC,8CAAM,IAAI,sDAA0B,IAAI,CAACtF,cAAc,CAACxB,GAAG,CAAC;KAE5D;;GAGD,IAAI,CAACsC,4BAA4B,CAACtB,YAAY,CAAChB,GAAG,CAAC;GACnD,IAAI,CAACgC,2BAA2B,CAAC,IAAI,CAACR,cAAc,CAACxB,GAAG,EAAEgB,YAAY,CAAChB,GAAG,CAAC;GAC3E,IAAI,CAACxC,aAAa,CAACuJ,oBAAoB,CAAC,IAAI,CAACvF,cAAc,EAAER,YAAY,CAAC;GAC1E,8CAAM,IAAI,oCAAiB,IAAI,CAACQ,cAAc,CAAC;GAC/C,8CAAM,IAAI,kDAAwBR,YAAY,CAAC;GAE/C,IAAI,CAAClC,MAAM,CAACkI,OAAO,CAAC,EAAE,CAAC;CACxB;CAAC,iCAsBsBC,UAAU,EACjC;GACC,MAAMC,cAAc,GAAG,IAAI,CAAC1J,aAAa,CAAC2J,MAAM,CAACC,aAAa,CAAE,yBAAwBH,UAAW,IAAG,CAAC;GACvGC,cAAc,oBAAdA,cAAc,CAAEG,MAAM,EAAE;CACzB;CAAC,uCAE4BrG,YAAY,EACzC;GACC,IAAI,CAAC,IAAI,CAACyB,OAAO,EACjB;KACC,MAAM;OAAEA;MAAS,GAAG,MAAM,4CAAI,cAAM6E,oBAAoB,EAAE;KAC1D,IAAI,CAAC7E,OAAO,GAAGA,OAAO;;GAGvB,IACA;KACC,MAAM8E,cAAc,GAAG,IAAI,CAACrG,cAAc,CAAC0F,GAAG,CAAC5F,YAAY,CAAChB,GAAG,CAAC;KAEhE,IAAIuH,cAAc,IAAI,CAACA,cAAc,CAAC9E,OAAO,EAC7C;OACC,MAAM,4CAAI,cAAM+E,qBAAqB,CAACxG,YAAY,CAAChB,GAAG,EAAE,IAAI,CAACyC,OAAO,CAAC;OACrE8E,cAAc,CAAC9E,OAAO,GAAG,IAAI,CAACA,OAAO;;IAEtC,CACD,OAAOgF,KAAK,EACZ;KACCC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;;CAEtB;CAAC,yCAE8BzH,GAAW,EAC1C;GACC,MAAM2H,mBAAmB,GAAG,MAAM,IAAI,CAACnK,aAAa,CAACoK,kBAAkB,CAAC,IAAI,CAACpG,cAAc,CAAC;GAC5F,IAAI,CAAChE,aAAa,CAACqK,mBAAmB,CAAC,IAAI,CAACrG,cAAc,CAACsG,EAAE,CAAC;GAE9D,IAAI9H,GAAG,EACP;KACC,IAAI,CAACkB,cAAc,CAACC,GAAG,CAAC,IAAI,CAACK,cAAc,CAACxB,GAAG,EAAE2H,mBAAmB,CAAC;KACrE,IAAI,CAACvG,uBAAuB,CAAC,IAAI,CAACI,cAAc,CAACxB,GAAG,CAAC;KACrD,IAAI,CAACtC,YAAY,CAACqK,iBAAiB,CAAC,IAAI,CAAC7G,cAAc,CAAC;KACxD,4CAAI,wCAAmBA,cAAc,GAAG,IAAI,CAACA,cAAc;;CAE7D;CAAC,gCAEqB3B,IAA8E,EACpG;GACC,MAAM;KAAEuI,EAAE;KAAE9H,GAAG;KAAEuB,OAAO;KAAEyG;IAAc,GAAGzI,IAAI;GAC/C,IAAI,CAAC/B,aAAa,CAACyK,KAAK,GAAG,KAAK;GAEhC,IACA;KACC,MAAM,4CAAI,cAAMC,cAAc,CAAClI,GAAG,CAAC;KACnC,IAAI,CAACxC,aAAa,CAACyK,KAAK,GAAG,IAAI;KAE/B,IAAI,IAAI,CAACE,uBAAuB,CAACnI,GAAG,CAAC,EACrC;OACC,IAAI,CAACoI,YAAY,EAAE;OACnB,IAAI,CAACC,cAAc,GAAG,KAAK;;KAE5B,4CAAI,kDAAwBP,EAAE;KAC9B,IAAI,CAACpK,YAAY,CAAC4K,cAAc,CAACtI,GAAG,CAAC;KACrC,IAAI,CAACkB,cAAc,CAACqH,MAAM,CAACvI,GAAG,CAAC;KAC/B,IAAI,CAACsC,4BAA4B,CAACtC,GAAG,CAAC;KACtC,IAAI,CAACxC,aAAa,CAAC6D,aAAa,CAACmH,mBAAmB,CAACjH,OAAO,CAAC;KAC7D,IAAI,CAAC/D,aAAa,CAACiL,sBAAsB,CAAClH,OAAO,CAAC;KAClD,IAAI,CAAC/D,aAAa,CAACkE,gBAAgB,CAACC,MAAM,CAAC,IAAI,CAACT,cAAc,CAACU,IAAI,CAAC;KACpE,IAAI,CAACpE,aAAa,CAACsJ,aAAa,EAAE;KAElC,IAAI,IAAI,CAAC5F,cAAc,CAACU,IAAI,KAAK,CAAC,EAClC;OACC,IAAI,CAAC/B,MAAM,CAACC,oBAAoB,CAAC,MAAM,EAAE,IAAI,CAAC;MAC9C,MAED;OACC,IAAI,CAACtC,aAAa,CAACgF,SAAS,GAAG,IAAI,CAACS,6BAA6B,EAAE;;KAEpE,4CAAI;IACJ,CACD,MACA;KACC,IAAI,CAACzF,aAAa,CAACkL,2BAA2B,CAACV,YAAY,CAAC;KAC5D,IAAI,CAACxK,aAAa,CAACyK,KAAK,GAAG,IAAI;;CAEjC;CAAC,gCAGD;GACC,MAAM;KAAEU;IAAgB,GAAG,4CAAI,gCAAeC,UAAU,EAAE;GAC1D,MAAM;KAAEpF,OAAO;KAAEqF;IAAa,2CAAG,IAAI,yCAAoB;GAEzD,MAAMC,YAAY,GAAG,CAAC,GAAG,IAAI,CAAC5H,cAAc,CAAC6H,IAAI,EAAE,CAAC;GACpD,KAAK,MAAMjE,WAAW,IAAIgE,YAAY,EACtC;;KAEC,MAAM,4CAAI,cAAME,eAAe,CAAClE,WAAW,EAAE6D,cAAc,CAACzF,QAAQ,EAAEM,OAAO,CAAC;;GAE/E,MAAMxD,GAAG,2CAAG,IAAI,6BAAa;GAC7B,MAAMiJ,WAAW,GAAG,MAAM,4CAAI,cAAMxF,WAAW,CAACzD,GAAG,CAAC;GACpD,IAAI,CAACsF,cAAI,CAAC4D,aAAa,CAACD,WAAW,CAAC,EACpC;KACC,MAAM,IAAIE,KAAK,CAAC,mBAAmB,CAAC;;GAGrC,MAAMC,kBAAkB,GAAGN,YAAY,CAACO,GAAG,CAAErJ,GAAG,4CAAK,IAAI,4DAA6BA,GAAG,EAAE6I,WAAW,CAAC,CAAC;GACxG,MAAMS,OAAO,CAACC,GAAG,CAACH,kBAAkB,CAAC;GAErC,OAAOH,WAAW,CAACI,GAAG,CAAEG,UAAU,IAAK;KAAA;KACtC,OAAO;OACNC,QAAQ,EAAED,UAAU,oBAAVA,UAAU,CAAEC,QAAQ;OAC9BC,IAAI,EAAEF,UAAU,oBAAVA,UAAU,CAAEG,KAAK;OACvB3J,GAAG,EAAEwJ,UAAU,oBAAVA,UAAU,CAAExJ,GAAG;OACpB4J,YAAY,2BAAEJ,UAAU,oBAAVA,UAAU,CAAEI,YAAY,oCAAI,IAAI;OAC9C1G,QAAQ,0BAAEsG,UAAU,oBAAVA,UAAU,CAAEtG,QAAQ,mCAAI,IAAI;OACtC2G,IAAI,sBAAEL,UAAU,oBAAVA,UAAU,CAAEK,IAAI,+BAAI;MAC1B;IACD,CAAC;CACH;CAAC,sCAGD;GACC,MAAMC,oBAAoB,GAAG,IAAI,CAACtM,aAAa,CAACgF,SAAS,CAAC1E,eAAe,KAAKQ,2BAAiB,CAAC2G,OAAO;GAEvG,OAAO9G,mCAAc,CAAC,IAAI,CAACJ,YAAY,CAAC,IAAI+L,oBAAoB;CACjE;CAAC,4CAEiC9J,GAAW,EAAE6I,WAAmB,EAClE;GACC,IAAIkB,YAAY,GAAG,KAAK;GACxB,OAAO,CAACA,YAAY,EACpB;;KAEC,MAAMC,QAAQ,GAAG,MAAM,4CAAI,cAAMC,6BAA6B,CAACjK,GAAG,EAAE6I,WAAW,CAAC;KAChFkB,YAAY,GAAGC,QAAQ,CAACD,YAAY;;KAEpC,8CAAM,IAAI,kBAAQ,IAAI,CAAC;;CAEzB;CAAC,iBAEMG,EAAU,EACjB;GACC,OAAO,IAAIZ,OAAO,CAAEa,OAAO,IAAK;KAC/BC,UAAU,CAACD,OAAO,EAAED,EAAE,CAAC;IACvB,CAAC;CACH;CAAC,4BAGD;GACC,OAAO,IAAI,CAAC1M,aAAa,CAACgF,SAAS,CAACxC,GAAG;CACxC;CAAC,8CAGD;GACC,OAAO,IAAI,CAACxC,aAAa,CAACgF,SAAS,CAAC1E,eAAe,KAAKQ,2BAAiB,CAACC,QAAQ;CACnF;CAAC,uBAEY8L,YAAoB,EAAEC,SAAiB,EACpD;GACC,MAAM;KAAE3B;IAAgB,GAAG,4CAAI,gCAAeC,UAAU,EAAE;GAE1D,IAAInI,IAAI,GAAG8J,oBAAU,CAACC,OAAO;GAC7B,IAAI7B,cAAc,CAAC8B,UAAU,KAAKF,oBAAU,CAACG,IAAI,EACjD;KACCjK,IAAI,GAAGkI,cAAc,CAAC8B,UAAU;;GAGjC,OAAO;KACNA,UAAU,EAAEhK,IAAI;KAChByC,QAAQ,EAAEoH,SAAS;KACnBX,KAAK,EAAEU,YAAY;KACnBR,IAAI,EAAElG,oBAAU,CAACC;IACjB;CACF;CAAC,qBAEUyG,YAAoB,EAAEM,MAAgB,EACjD;GACC,OAAO;KACNF,UAAU,EAAEE,MAAM,CAACF,UAAU;KAC7BvH,QAAQ,EAAEyH,MAAM,CAACzH,QAAQ;KACzByG,KAAK,EAAEU,YAAY;KACnBR,IAAI,EAAElG,oBAAU,CAACiH;IACjB;CACF;CAAC,8BAGD;GACC,MAAM;KAAE3F,OAAO;KAAE4F;IAAY,GAAG,4CAAI,gCAAejC,UAAU,EAAE;GAE/D,MAAMkC,iBAAiB,GAAG,4CAAI,0BAAYC,WAAW,EAAE;GAEvD,IAAIV,YAAY,GAAG,4CAAI,oEAAkC,CAAC,GAAG,CAAC;GAE9D,MAAM7G,OAAO,GAAGqH,UAAU,CAACxB,GAAG,CAAEzG,IAAI,IAAkB;KACrD,MAAMoI,MAAM,GAAG;OAAE,GAAGpI,IAAI;OAAE+G,KAAK,EAAEU;MAAc;KAC/CA,YAAY,EAAE;KAEd,OAAOW,MAAM;IACb,CAAC;GAEFxH,OAAO,CAACzB,IAAI,yCAAC,IAAI,8BAAcsI,YAAY,EAAEpF,OAAO,CAAC/B,QAAQ,EAAE;GAE/D,IAAI2F,WAAW,GAAGwB,YAAY;GAC9B,IAAI,IAAI,CAAClF,cAAc,EAAE,EACzB;KACC0D,WAAW,GAAG,4CAAI,oEAAkC,CAAC,GAAGwB,YAAY,GAAG,CAAC;KACxE,MAAMtG,OAAO,GAAG+G,iBAAiB,CAACzB,GAAG,CAAEsB,MAAM,4CAAK,IAAI,0BAAY9B,WAAW,EAAE8B,MAAM,CAAC,CAAC;KACvFnH,OAAO,CAACzB,IAAI,CAAC,GAAGgC,OAAO,CAAC;;GAGzB,OAAO;KAAEP,OAAO;KAAEqF;IAAa;CAChC;CAAC,wBAEaoC,aAA4B,EAC1C;GACC,OAAOA,aAAa,CAACC,MAAM,CAAC,CAACC,GAAG,EAAEC,MAAM,KAAK;KAAA;KAC5C,MAAM;OAAEX,UAAU;OAAEvH;MAAU,GAAGkI,MAAM;KACvC,IAAIX,UAAU,KAAKF,oBAAU,CAACG,IAAI,IAAID,UAAU,KAAKF,oBAAU,CAACc,mBAAmB,EACnF;OACC,OAAOF,GAAG;;KAGX,MAAMtB,IAAI,GAAI,GAAEuB,MAAM,CAACvB,IAAK,GAAE;KAE9B,OAAO;OACN,GAAGsB,GAAG;OACN,CAACtB,IAAI,GAAG,CACP,iBAAGsB,GAAG,CAACtB,IAAI,CAAC,wBAAI,EAAE,GAClB3G,QAAQ;MAET;IACD,EAAE,EAAE,CAAC;CACP;CAAC,qCA4E0BM,OAAsB,EAAEqG,IAAgB,EACnE;GACC,MAAMuB,MAAmB,GAAG5H,OAAO,CAAC8H,IAAI,CACtCC,eAA4B,IAAKA,eAAe,CAAC1B,IAAI,KAAKA,IAAI,CAC/D;GAED,OAAO,CAAAuB,MAAM,oBAANA,MAAM,CAAEX,UAAU,MAAKF,oBAAU,CAACc,mBAAmB,GAAGd,oBAAU,CAACc,mBAAmB,GAAGd,oBAAU,CAACG,IAAI;CAChH;CAAC,wBAYa7F,YAA6B,EAAEC,WAAoB,EACjE;GACC,OAAO;KACN,IAAI0G,OAAO,GACX;OACC,MAAMrE,MAAM,GAAGtC,YAAY,CAACrH,aAAa,CAAC2J,MAAM;OAChDsE,sCAAuB,CAACC,QAAQ,CAACvE,MAAM,CAAC;OAExC,IAAI,CAAC7B,cAAI,CAACC,MAAM,CAACV,YAAY,CAACW,qBAAqB,EAAE,CAAC,EACtD;SACCC,EAAE,CAACkG,IAAI,CAAC9G,YAAY,CAACW,qBAAqB,EAAE,CAAC;;OAG9C,OAAO2B,MAAM;MACb;KACDvH,KAAK,EAAEwG,aAAG,CAACC,UAAU,CAAC,iCAAiC,CAAC;KACxDuF,gBAAgB,EAAE,YAAY;OAC7B,MAAMC,eAAe,GAAG,IAAI,CAACrO,aAAa,CAAC6D,aAAa,CAACyK,eAAe,KAAK,CAAC;OAC9E,IAAID,eAAe,IAAI,IAAI,CAACrO,aAAa,CAACqJ,WAAW,EACrD;SACC,MAAMkF,OAAO,GAAG,IAAI,CAACvO,aAAa,CAACsD,QAAQ,EAAE;SAC7C,IAAI,CAACiL,OAAO,EACZ;WACC,OAAO,KAAK;;;OAId,MAAMvJ,SAAS,GAAG,MAAM,IAAI,CAACvB,aAAa,EAAE;OAC5C,IAAI,CAACuB,SAAS,EACd;SACC,OAAO,KAAK;;OAGb,8CAAM,IAAI,4CAAqBA,SAAS,CAAC;OACzC,IAAI,IAAI,CAAChB,cAAc,EACvB;SACC,8CAAM,IAAI,gDAAuBgB,SAAS,CAAC;;OAG5C,4CAAI;OACJ,4CAAI;OACJ,4CAAI;OAEJ,IAAI,CAAC8C,cAAI,CAACC,MAAM,CAAC,IAAI,CAACC,qBAAqB,EAAE,CAAC,EAC9C;SACCC,EAAE,CAACC,IAAI,CAAC,IAAI,CAACF,qBAAqB,EAAE,CAAC;;OAGtC,OAAO,IAAI;;IAEZ;CACF;CAAC,0BAEeX,YAA6B,EAC7C;GACC,MAAMmH,YAAY,GAAG,IAAI,CAAC7N,cAAc,EAAE,GACvC,0BAA0B,GAC1B,2BAA2B;GAG9B,OAAO;KACN,IAAIqN,OAAO,GACX;OACC,MAAMrE,MAAM,GAAG,wCAAAtC,YAAY,gCAAeoH,SAAS,EAAE;OACrD,MAAMC,wBAAwB,2CAAGrH,YAAY,yDAA4B;OAEzE,IAAIA,YAAY,CAAC1G,cAAc,EAAE,EACjC;SACC,wCAAA0G,YAAY,gCAAesH,qBAAqB,CAACD,wBAAwB,CAAC;;OAE3ET,sCAAuB,CAACC,QAAQ,CAACvE,MAAM,CAAC;OAExC,IAAI,CAACtC,YAAY,CAACzE,UAAU,EAAE,EAC9B;SACC,IAAI,CAAC,wCAAAyE,YAAY,gCAAeuH,wBAAwB,EAAE,EAC1D;WACC,wCAAAvH,YAAY,gCAAewH,uBAAuB,EAAE;;SAGrD,IAAI,CAAC,wCAAAxH,YAAY,gCAAeyH,kBAAkB,EAAE,EACpD;WACC,wCAAAzH,YAAY,gCAAe0H,gBAAgB,EAAE;;;OAI/C,OAAOpF,MAAM;MACb;KACDvH,KAAK,EAAEwG,aAAG,CAACC,UAAU,CAAC2F,YAAY,CAAC;KACnCJ,gBAAgB,EAAE,YAAY;OAC7B,MAAM;SAAE9N;QAAiB,GAAG,IAAI,CAACN,aAAa,CAACgF,SAAS;OACxD,IACA;SACC,KAAK,MAAM,CAACxC,GAAG,CAAC,IAAI,IAAI,CAACkB,cAAc,EACvC;;WAEC,MAAM,4CAAI,gCAAesL,IAAI,CAACxM,GAAG,CAAC;;SAEnC,4CAAI,wCAAmBsK,SAAS,GAAG,4CAAI,gCAAemC,oBAAoB,EAAE;SAC5E,4CAAI,wCAAmBvL,cAAc,GAAG,IAAI,CAACA,cAAc;SAE3D,IAAI,CAACpC,MAAM,CAAC4N,aAAa,CAAC5O,eAAe,CAAC;SAE1C,4CAAI;SAEJ,IAAI,IAAI,CAACK,cAAc,EAAE,EACzB;WACC,4CAAI;WACJ,4CAAI,wCAAmBE,oBAAoB,GAAG,yCAAC,IAAI,mDAAyB;;QAE7E,CACD,OAAOsO,CAAC,EACR;SACCjF,OAAO,CAACkF,IAAI,CAACD,CAAC,CAAC;SAEf,OAAO,KAAK;;OAGb,OAAO,IAAI;;IAEZ;CACF;CAAC,mCAEwB9H,YAA6B,EAAEC,WAAmB,EAC3E;GACC,OAAO;KACN,IAAI0G,OAAO,GACX;OACC,OAAO,wCAAA3G,YAAY,wCAAmBoH,SAAS,EAAE;MACjD;KACDrM,KAAK,EAAEwG,aAAG,CAACC,UAAU,CAAC,2CAA2C,CAAC;KAClEuF,gBAAgB,EAAE,YAAY;OAC7B,IACA;SACC,MAAM,4CAAI,wCAAmBY,IAAI,EAAE;QACnC,CACD,MACA;SACC,OAAO,KAAK;;OAGb,IAAI,CAAChP,aAAa,CAACgF,SAAS,CAACc,gBAAgB,GAAG,4CAAI,wCAAmBuJ,2BAA2B,EAAE;OACpG,IAAI,CAACnP,YAAY,CAACoP,cAAc,GAAG,IAAI,CAACtP,aAAa,CAACgF,SAAS,CAACc,gBAAgB,GAAG,CAAC;OAEpF,8CAAM,IAAI,qFAA0C;OAEpD,IAAI,IAAI,CAACnF,cAAc,EAAE,EACzB;SACC,MAAM;WAAE6B;UAAK,GAAG,IAAI,CAACxC,aAAa,CAACgF,SAAS;SAC5C,MAAMuK,4BAA4B,GAAG,CAAC,IAAI,CAACvP,aAAa,CAACwB,UAAU,EAAE,4CAAI,IAAI,mDAAyB;SACtG,IAAI,CAACF,MAAM,CAACC,+BAA+B,CAACgO,4BAA4B,CAAC;SACzE,IAAI,CAACjO,MAAM,CAACkO,UAAU,GAAG,8CAAM,IAAI,iCAAgB;SACnD,MAAM;WAAEC,UAAU;WAAE/J;UAAU,GAAG,IAAI,CAAC1F,aAAa,CAACgF,SAAS;SAC7D,MAAMK,MAAM,GAAG,MAAM,IAAI,CAACrF,aAAa,CAAC0P,UAAU,CAAClN,GAAG,CAAC;SAEvD,MAAMmN,UAAU,GAAG;WAAEF,UAAU;WAAEjN,GAAG;WAAE6C,MAAM;WAAEK;UAAU;SACxD,4CAAI,gDAAuBiK,UAAU;;OAGtC,OAAO,IAAI;;IAEZ;CACF;CAAC,2BAEgBtI,YAA6B,EAC9C;GACC,OAAO;KACN,IAAI2G,OAAO,GACX;OACC,MAAMrE,MAAM,GAAG,wCAAAtC,YAAY,0BAAYoH,SAAS,EAAE;OAClDR,sCAAuB,CAACC,QAAQ,CAACvE,MAAM,CAAC;OAExC,OAAOA,MAAM;MACb;KACDvH,KAAK,EAAEwG,aAAG,CAACC,UAAU,CAAC,6BAA6B,CAAC;KACpDuF,gBAAgB,EAAE,YAAY;OAC7B,IACA;SACC,MAAMG,OAAO,GAAG,4CAAI,0BAAYjL,QAAQ,EAAE;SAC1C,IAAI,CAACiL,OAAO,EACZ;WACC,OAAOA,OAAO;;SAGf,IAAI,CAACjN,MAAM,CAACkO,UAAU,GAAG,8CAAM,IAAI,iCAAgB;SAEnD,MAAM;WAAEhN,GAAG;WAAEiN,UAAU;WAAE/J;UAAU,GAAG,IAAI,CAAC1F,aAAa,CAACgF,SAAS;SAClE,MAAMK,MAAM,GAAG,MAAM,IAAI,CAACrF,aAAa,CAAC0P,UAAU,CAAClN,GAAG,CAAC;SAEvD,4CAAI;SAEJ,MAAMmN,UAAU,GAAG;WAAEF,UAAU;WAAEjN,GAAG;WAAE6C,MAAM;WAAEK;UAAU;SACxD,8CAAM,IAAI,gDAAuBiK,UAAU,CAAC;SAE5C,OAAO,IAAI;QACX,CACD,OAAOR,CAAC,EACR;SACCjF,OAAO,CAACD,KAAK,CAACkF,CAAC,CAAC;SAEhB,OAAO,KAAK;;;IAGd;CACF;CAAC,8CAGD;GACC,MAAMS,WAAW,GAAG,4CAAI,gCAAexE,UAAU,EAAE;GACnDyE,MAAM,CAACC,MAAM,CAACF,WAAW,EAAE;KAC1BhI,SAAS,EAAE,4CAAI,0BAAY2F,WAAW,EAAE,CAAC1B,GAAG,CAAEsB,MAAM,IAAK;OACxD,OAAO;SACNF,UAAU,EAAEE,MAAM,CAACF,UAAU;SAC7BvH,QAAQ,EAAEyH,MAAM,CAACzH;QACjB;MACD;IACD,CAAC;GACF,IAAI,CAACxF,YAAY,CAACsD,YAAY,GAAG,IAAI,CAACE,cAAc;GACpD,IAAI,CAACxD,YAAY,CAAC6P,mBAAmB,EAAE;GACvC,IAAI,CAAC7P,YAAY,CAAC8P,cAAc,CAACJ,WAAW,CAAC;CAC9C;CAAC,sCAE2BD,UAK3B,EACD;GACC,IAAI,IAAI,CAACrH,oBAAoB,EAAE,EAC/B;KACC,IAAI,CAAChH,MAAM,CAAC2O,YAAY,CAAC,IAAI,CAAClN,YAAY,EAAE,CAAC;;GAE9C,IAAI,CAACV,MAAM,CAAC6N,qBAAqB,CAAC,MAAM,EAAE,KAAK,CAAC;GAChD,IAAI,IAAI,CAACnK,gBAAgB,EAAE,EAC3B;KACC,IAAI,CAACzE,MAAM,CAACkC,YAAY,GAAGmM,UAAU;KACrC,MAAM,IAAI,CAACrO,MAAM,CAAC6O,cAAc,EAAE;KAClC,IAAI,yCAAC,IAAI,2CAAoB,IAAI,IAAI,CAACxP,cAAc,EAAE,EACtD;OACC,MAAM,IAAI,CAACW,MAAM,CAAC6M,IAAI,EAAE;;;CAG3B;CAAC,uBAEY9G,YAA6B,EAC1C;GACC,MAAMmH,YAAY,GAAG,IAAI,CAAC7N,cAAc,EAAE,GACvC,oCAAoC,GACpC,6BAA6B;GAGhC,OAAO;KACN,IAAIqN,OAAO,GACX;OACC,MAAMrE,MAAM,GAAGtC,YAAY,CAACnH,YAAY,CAACuO,SAAS,EAAE;OACpDR,sCAAuB,CAACC,QAAQ,CAACvE,MAAM,CAAC;OAExC,IAAI,CAACtC,YAAY,CAACnH,YAAY,CAACkQ,4BAA4B,EAAE,EAC7D;SACC/I,YAAY,CAAChF,MAAM,CAACC,oBAAoB,CAAC,UAAU,EAAE,IAAI,CAAC;;OAG3D,OAAOqH,MAAM;MACb;KACDvH,KAAK,EAAEwG,aAAG,CAACC,UAAU,CAAC2F,YAAY,CAAC;KACnCJ,gBAAgB,EAAE,YAAY;OAC7B,OAAO,IAAI,CAAClO,YAAY,CAACmQ,WAAW,EAAE;;IAEvC;CACF;CAAC,2CA4BD;GACC,OAAO,IAAI,CAACrQ,aAAa,CAACwB,UAAU,EAAE;CACvC;CAAC,6CAiCD;GACC,MAAM8O,gBAAgB,GAAG,4CAAI,gCAAeC,mBAAmB,EAAE;GACjE,MAAMC,kBAAkB,GAAGF,gBAAgB,CAACpO,IAAI,KAAKuO,sBAAY,CAACC,KAAK;GAEvE,MAAMC,2BAA2B,GAAGH,kBAAkB,IACjD7P,mCAAc,CAAC,IAAI,CAACJ,YAAY,CAAC,4CAAI,IAAI,mDAA0B;GAGxE,IAAI,CAACe,MAAM,CAACG,0BAA0B,CACrCC,0BAAW,CAACkP,WAAW,EACvBD,2BAA2B,CAC3B;CACF;CAAC,0DAGD;GACC,MAAMrE,oBAAoB,GAAG,IAAI,CAACtM,aAAa,CAACgF,SAAS,CAAC1E,eAAe,KAAKQ,2BAAiB,CAAC2G,OAAO;GAEvG,IAAI,4CAAI,uDAA6B,IAAI,CAACzH,aAAa,CAACwB,UAAU,EAAE,EACpE;KACC,MAAM,4CAAI,cAAMqP,mBAAmB,CAAC,IAAI,CAAC7Q,aAAa,CAACgF,SAAS,CAACxC,GAAG,EAAE,IAAI,CAAC;;GAG5E,MAAMsO,kCAAkC,GAAG,IAAI,CAAC9Q,aAAa,CAACgF,SAAS,CAACc,gBAAgB,GAAG,CAAC,IACxFwG,oBAAoB;GAGxB,IAAI,CAAChL,MAAM,CAACG,0BAA0B,CACrCC,0BAAW,CAACC,kBAAkB,EAC9BmP,kCAAkC,CAClC;CACF;CAAC,mCAGD;GACC,OAAO,IAAI,CAAC9Q,aAAa,CAACgF,SAAS,CAAC1E,eAAe,KAAKQ,2BAAiB,CAACC,QAAQ;CACnF;CAAC,sDAE2CwG,KAAe,EAAED,WAAoB,EACjF;GACC,MAAMyJ,SAAS,GAAG,IAAI,CAAChO,YAAY,EAAE;GAErC,IAAI+E,cAAI,CAACkJ,aAAa,CAACzJ,KAAK,CAACC,KAAK,CAAC,EACnC;KACCD,KAAK,CAACC,KAAK,CAAC4G,gBAAgB,GAAG6C,mDAA8B,CAC5D1J,KAAK,CAACC,KAAK,CAAC4G,gBAAgB,EAC5B,8CAAM,IAAI,wDAA2B2C,SAAS,EAAEzJ,WAAW,CAAC,EAC5D,8CAAM,IAAI,0DAA4ByJ,SAAS,CAAC,CAChD;;GAGF,IAAIjJ,cAAI,CAACkJ,aAAa,CAACzJ,KAAK,CAACE,OAAO,CAAC,EACrC;KACCF,KAAK,CAACE,OAAO,CAAC2G,gBAAgB,GAAG6C,mDAA8B,CAC9D1J,KAAK,CAACE,OAAO,CAAC2G,gBAAgB,EAC9B,8CAAM,IAAI,0EAAoC2C,SAAS,CAAC,EACxD,8CAAM,IAAI,sEAAkCA,SAAS,CAAC,CACtD;;GAGF,IAAIjJ,cAAI,CAACkJ,aAAa,CAACzJ,KAAK,CAACvE,IAAI,CAAC,EAClC;KACCuE,KAAK,CAACvE,IAAI,CAACoL,gBAAgB,GAAG6C,mDAA8B,CAC3D1J,KAAK,CAACvE,IAAI,CAACoL,gBAAgB,EAC3B,8CAAM,IAAI,oEAAiC2C,SAAS,EAAE,IAAI,CAAC/Q,aAAa,CAACgF,SAAS,CAACxC,GAAG,CAAC,EACvF,8CAAM,IAAI,gEAA+BuO,SAAS,EAAE,IAAI,CAAC/Q,aAAa,CAACgF,SAAS,CAACxC,GAAG,CAAC,CACrF;;CAEH;CAAC,oCAEyBuO,SAAoB,EAAEzJ,WAAoB,EACpE;GACC,IAAI,IAAI,CAACgB,oBAAoB,EAAE,EAC/B;KACCyI,SAAS,CAAC/N,IAAI,CAAC;OAAEnB,KAAK,EAAE,uBAAuB;OAAEqB,SAAS,EAAE,eAAe;OAAEE,MAAM,EAAE;MAAW,CAAC;KACjG2N,SAAS,CAAC/N,IAAI,CAAC;OACdnB,KAAK,EAAE,sBAAsB;OAC7BoB,IAAI,EAAE,MAAM;OACZC,SAAS,EAAE,KAAK;OAChBC,EAAE,EAAG,cAAa,IAAI,CAACnD,aAAa,CAACgF,SAAS,CAACnC,UAAW;MAC1D,CAAC;;CAEJ;CAAC,qCAE0BkO,SAAoB,EAC/C;GACC,IAAI,IAAI,CAACzI,oBAAoB,EAAE,EAC/B;KACCyI,SAAS,CAAC/N,IAAI,CAAC;OAAEnB,KAAK,EAAE,uBAAuB;OAAEuB,MAAM,EAAE,OAAO;OAAEF,SAAS,EAAE;MAAiB,CAAC;;CAEjG;CAAC,6CAEkC6N,SAAoB,EACvD;GACC,IAAI,IAAI,CAACzI,oBAAoB,EAAE,EAC/B;KACCyI,SAAS,CAAC/N,IAAI,CAAC;OAAEnB,KAAK,EAAE,oBAAoB;OAAEuB,MAAM,EAAE,SAAS;OAAEF,SAAS,EAAE;MAAiB,CAAC;;CAEhG;CAAC,2CAEgC6N,SAAoB,EACrD;GACC,IAAI,IAAI,CAACzI,oBAAoB,EAAE,EAC/B;KACCyI,SAAS,CAAC/N,IAAI,CAAC;OAAEnB,KAAK,EAAE,oBAAoB;OAAEuB,MAAM,EAAE,OAAO;OAAEF,SAAS,EAAE;MAAiB,CAAC;;CAE9F;CAAC,gDAEqC6N,SAAoB,EAAEzJ,WAAmB,EAC/E;GACC,IAAI,IAAI,CAACK,cAAc,EAAE,EACzB;KACCoJ,SAAS,CAACG,4BAA4B,CAAC;OACtCrP,KAAK,EAAE,uBAAuB;OAC9BqB,SAAS,EAAE,eAAe;OAC1BE,MAAM,EAAE;MACR,EAAEkE,WAAW,CAAC;;CAEjB;CAAC,8CAEmCyJ,SAAoB,EAAEzJ,WAAmB,EAC7E;GACC,IAAI,IAAI,CAACgB,oBAAoB,EAAE,EAC/B;KACC,IAAI,CAACvF,YAAY,EAAE,CAACC,IAAI,CAAC;OACxBnB,KAAK,EAAE,qBAAqB;OAC5BuB,MAAM,EAAE,OAAO;OACfF,SAAS,EAAE;MACX,CAAC;;GAGH,IAAI,IAAI,CAACyE,cAAc,EAAE,EACzB;KACCoJ,SAAS,CAACG,4BAA4B,CAAC;OACtCrP,KAAK,EAAE,uBAAuB;OAC9BqB,SAAS,EAAE,eAAe;OAC1BE,MAAM,EAAE;MACR,EAAEkE,WAAW,CAAC;;CAEjB;CAAC,gCAEqBA,WAAoB,EAC1C;GACC,MAAMyJ,SAAS,GAAG,IAAI,CAAChO,YAAY,EAAE;GACrC,IAAI,IAAI,CAACuF,oBAAoB,EAAE,EAC/B;KACCyI,SAAS,CAAC/N,IAAI,CAAC;OAAEnB,KAAK,EAAE,aAAa;OAAEqB,SAAS,EAAE;MAAiB,CAAC;IACpE,MACI,IAAI,IAAI,CAACyE,cAAc,EAAE,EAC9B;KACC,MAAMwJ,OAAO,GAAG;OAAEtP,KAAK,EAAE,uBAAuB;OAAEqB,SAAS,EAAE;MAAiB;KAC9E,IAAI,IAAI,CAACN,UAAU,EAAE,IAAIkF,cAAI,CAACsJ,cAAc,CAAC9J,WAAW,CAAC,EACzD;OACCyJ,SAAS,CAACM,aAAa,CAACF,OAAO,EAAE7J,WAAW,CAAC;MAC7C,MAED;OACCyJ,SAAS,CAAC/N,IAAI,CAACmO,OAAO,CAAC;;;CAG1B;CAAC,oCAGD;GACC,MAAMG,iBAAiB,GAAG,IAAI,CAAC7L,6BAA6B,EAAE;GAC9D,4CAAI,gCAAe8L,kBAAkB,CAACD,iBAAiB,CAAChR,eAAe,CAAC;GACxE,4CAAI,gCAAeqG,WAAW,CAAC2K,iBAAiB,CAAC5L,QAAQ,CAAC;GAC1D,IAAI,IAAI,CAAC/E,cAAc,EAAE,EACzB;KACC,4CAAI,gCAAe6Q,sBAAsB,EAAE;;GAE5C,IAAI,CAACxN,cAAc,GAAG,IAAI;GAE1B,IAAI,IAAI,CAAC6G,cAAc,EACvB;KACC,IAAI,CAACxI,MAAM,CAACC,oBAAoB,CAAC,MAAM,EAAE,KAAK,CAAC;;CAEjD;CAAC,oCAEyB0C,SAA0B,EACpD;GACC,IAAI,IAAI,CAAChF,aAAa,CAACqD,kBAAkB,EACzC;KACC;;GAGD,IAAI,IAAI,CAAC1C,cAAc,EAAE,IAAI,CAAC4H,kCAAc,CAACkJ,qBAAqB,EAAE,EACpE;KACC,IAAI,CAACC,iBAAiB,CAAC1M,SAAS,CAAC;KAEjC;;GAGD,IAAI,CAACtB,cAAc,CAACC,GAAG,CAACqB,SAAS,CAACxC,GAAG,EAAEwC,SAAS,CAAC;GACjD,IAAI,CAACpB,uBAAuB,CAACoB,SAAS,CAACxC,GAAG,CAAC;GAC3C,IAAI,CAACxC,aAAa,CAAC6D,aAAa,CAACC,oBAAoB,CAACkB,SAAS,CAACjB,OAAO,CAAC;GAExE,IAAI,CAACiB,SAAS,CAACC,OAAO,IAAI,CAAC,IAAI,CAACjB,cAAc,EAC9C;KACC,8CAAM,IAAI,kDAAwBgB,SAAS,CAAC;;GAG7C,IAAI,CAAC,IAAI,CAACrE,cAAc,EAAE,EAC1B;KACC,IAAI,CAACX,aAAa,CAACkE,gBAAgB,CAACC,MAAM,CAAC,IAAI,CAACT,cAAc,CAACU,IAAI,CAAC;;GAGrE,IAAI,CAAC,IAAI,CAACJ,cAAc,EACxB;KACC,IAAI,CAAChE,aAAa,CAACiE,mBAAmB,CAACe,SAAS,CAAC;;CAEnD;CAAC,yBAGD;GACC2M,MAAM,CAACC,QAAQ,CAAC;KACfC,GAAG,EAAE,CAAC;KACNC,QAAQ,EAAE;IACV,CAAC;CACH;CAAC,0BAGD;GACCH,MAAM,CAACC,QAAQ,CAAC;KACfC,GAAG,EAAEE,QAAQ,CAACC,IAAI,CAACC,YAAY;KAC/BH,QAAQ,EAAE;IACV,CAAC;CACH;CAAC,2BAGD;GACC,IAAI,IAAI,CAACnR,cAAc,EAAE,IAAI,CAAC4H,kCAAc,CAACkJ,qBAAqB,EAAE,EACpE;KACC;;GAGD,IAAI,CAACzR,aAAa,CAACkS,aAAa,EAAE;GAElC,IAAI,CAAClO,cAAc,GAAG,IAAI;CAC3B;CAAC,kDAGD;GACC,IAAI,IAAI,CAACN,cAAc,CAACU,IAAI,4CAAI,IAAI,uCAAkB,EACtD;KACC,IAAI,CAACpE,aAAa,CAACyC,8BAA8B,CAAC,KAAK,CAAC;;CAE1D;CAAC,qCAiBD;;GAEC,MAAM0P,IAAI,GAAG,IAAI;GACjBlK,EAAE,CAACmK,SAAS,CAACC,QAAQ,CAACC,IAAI,CAAC,qCAAqC,EAAE;KACjEC,SAAS,EAAE,KAAK;KAChBC,KAAK,EAAE,GAAG;KACVC,eAAe,EAAE,MAAM;OACtB,wCAAAN,IAAI;OAEJ,OAAOO,0BAAM,CAACC,aAAa,CAAC;SAC3BC,UAAU,EAAE,CAAC,UAAU,CAAC;SACxBxQ,KAAK,EAAE,0BAA0B;SACjC4L,OAAO,GACP;WACC,wCAAAmE,IAAI;WAEJ,+CAAOA,IAAI;UACX;SACDU,OAAO,CAAC;WAAEC,YAAY;WAAEC;UAAY,EACpC;WACC,wCAAAZ,IAAI,8BAAe,IAAIY,UAAU,CAAC;aACjCC,OAAO,EAAE,8CAAMb,IAAI;YACnB,CAAC;WAEF,OAAO,yCACNA,IAAI,4BACJ;;QAEF,CAAC;MACF;KACDzP,MAAM,EAAE;OACPuQ,OAAO,EAAGpR,KAAK,IAAK;SACnB,4CAAI,IAAI,qEACR;WACCA,KAAK,CAACqR,UAAU,EAAE;;SAEnB,4CAAI;;;IAGN,CAAC;CACH;CAAC,iDAGD;GACC,OAAO,4CAAI,kBAAQzK,QAAQ,CAAC,kCAAkC,EAAE,MAAMC,aAAG,CAACC,MAAM,gBAAC;;;OAG9E,CAA0C;OAC1C,CAA8B;;;GAGjC,GAJK,4CAAI,8DAA+BwK,IAAI,0CACvC,IAAI,gDAGR,CAAC;CACH;CAAC,yBAGD;GACC,OAAO,4CAAI,kBAAQ1K,QAAQ,CAAC,UAAU,EAAE,MAAM;KAC7C,OAAO,IAAI2K,yBAAQ,CAAC;OACnB9I,EAAE,EAAE,wBAAwB;OAC5B+I,UAAU,EAAE,mCAAmC;OAC/CC,iBAAiB,EAAE,CAAC,GAAGtU,yBAAyB,CAACuU,MAAM,EAAE,CAAC,CAAC1H,GAAG,CAAE2H,CAAC,IAAM,IAAGA,CAAE,EAAC,CAAC;OAC9EC,QAAQ,EAAE,IAAI;OACdC,UAAU,EAAE,KAAK;OACjBC,WAAW,EAAE,QAAU;OACvBC,gBAAgB,EAAE,QAAU;OAC5BC,gBAAgB,EAAE,QAAU;OAC5BnR,MAAM,EAAE;SACP,CAACoR,8BAAa,CAACC,gBAAgB,GAAIlS,KAAK,4CAAK,IAAI,wCAAmBA,KAAK,CAAC;SAC1E,CAACiS,8BAAa,CAACE,QAAQ,GAAInS,KAAK,4CAAK,IAAI,0BAAYA,KAAK,CAACiB,OAAO,EAAE,CAACmR,IAAI,CAAC;SAC1E,CAACH,8BAAa,CAACI,eAAe,GAAIrS,KAAK,4CAAK,IAAI,wCAAmBA,KAAK;;MAEzE,CAAC;IACF,CAAC;CACH;CAAC,wCAGD;GACC,4CAAI,kBAAQkJ,MAAM,CAAC,UAAU,CAAC;GAC9B,4CAAI,kBAAQA,MAAM,CAAC,cAAc,CAAC;GAClC,4CAAI,kBAAQA,MAAM,CAAC,qBAAqB,CAAC;GACzC,4CAAI,kBAAQA,MAAM,CAAC,kCAAkC,CAAC;CACvD;CAAC,iCAGD;GACC,OAAO,4CAAI,kBAAQtC,QAAQ,CAAC,cAAc,EAAE,MAAM;KACjD,MAAMkB,MAAM,GAAGjB,aAAG,CAACC,MAAM,gBAAC;;qFAEsD,CAAiC,KAAE,CAAuD;oFAC3F,CAG1E;gBACM,CAAyE;;;IAGpF,GARkF,MAAMgB,MAAM,CAACwK,SAAS,CAACC,KAAK,EAAE,EAAKxL,aAAG,CAACC,UAAU,CAAC,oCAAoC,CAAC,EACvFhH,KAAK,IAAK;OACxF,4CAAI,0CAAoBA,KAAK;OAC7BA,KAAK,CAACwS,MAAM,CAACC,KAAK,GAAG,EAAE;MACvB,EACS,CAAC,GAAGtV,yBAAyB,CAACuU,MAAM,EAAE,CAAC,CAAC1H,GAAG,CAAE0I,CAAC,IAAM,IAAGA,CAAE,EAAC,CAAC,CAACC,IAAI,CAAC,IAAI,CAAC,CAGlF;KAED,OAAO7K,MAAM,CAACwJ,IAAI;IAClB,CAAC;CACH;CAAC,wCAGD;GACC,OAAO,4CAAI,kBAAQ1K,QAAQ,CAAC,qBAAqB,EAAE,MAAM;KACxD,MAAMkB,MAAM,GAAGjB,aAAG,CAACC,MAAM,gBAAC;;gFAEiD,CAAiC,KAAE,CAA6D;oFAC5F,CAG3E;;IAEJ,GAN6E,MAAMgB,MAAM,CAACwK,SAAS,CAACC,KAAK,EAAE,EAAKxL,aAAG,CAACC,UAAU,CAAC,0CAA0C,CAAC,EACxFhH,KAAK,IAAK;OACzF,4CAAI,0CAAoBA,KAAK;OAC7BA,KAAK,CAACwS,MAAM,CAACC,KAAK,GAAG,EAAE;MACvB,CAEF;KAED,OAAO3K,MAAM;IACb,CAAC;CACH;CAAC,6BAEkB9H,KAAY,EAC/B;GACC,MAAMwS,MAAwB,GAAGxS,KAAK,CAACwS,MAAM;GAC7C,MAAMI,KAAK,GAAGJ,MAAM,CAACI,KAAK;GAC1B,MAAMC,cAAc,GAAG,CAAC,GAAGD,KAAK,CAAC,CAACE,MAAM,CAAEC,CAAO,IAAK5V,yBAAyB,CAAC6V,GAAG,CAClFD,CAAC,CAACE,IAAI,CAACC,KAAK,CAAC,GAAG,CAAC,CAACC,EAAE,CAAC,CAAC,CAAC,CAAC,CACxB,CAAC;GACF,4CAAI,gCAAgBC,QAAQ,CAACP,cAAc,CAAC;CAC7C;CAAC,qBAEUT,IAAkB,EAC7B;GACCiB,aAAG,CAACC,WAAW,CACdzM,aAAG,CAACC,MAAM,gBAAC,0BAAuB,CAA8G,MAAI,GAAhHC,aAAG,CAACC,UAAU,CAAC,4CAA4C,EAAE;KAAE,YAAY,EAAEuM,cAAI,CAACC,MAAM,CAACpB,IAAI,CAACqB,OAAO,EAAE;IAAG,CAAC,2CAC/I,IAAI,gDACJ;CACF;CAAC,yCAGD;GACC,IAAI,4CAAI,gCAAgBC,QAAQ,EAAE,CAACzO,MAAM,KAAK,CAAC,EAC/C;KACC0O,KAAK,CAAC5M,aAAG,CAACC,UAAU,CAAC,6CAA6C,CAAC,CAAC;KAEpE;;GAGDqM,aAAG,CAACO,KAAK,yCAAC,IAAI,iFAAyC;KAAEC,OAAO,EAAE,GAAG;KAAE,gBAAgB,EAAE;IAAQ,CAAC;GAClG,4CAAI,sEAAmC,IAAI;GAC3C,4CAAI,gCAAgBC,KAAK,EAAE;GAC3B,4CAAI,4BAAaC,WAAW,CAAC,IAAI,CAAC;CACnC;CAAC,kCAEuB/T,KAAgB,EACxC;GACC,MAAMgU,QAAQ,2CAAG,IAAI,+BAAe;GACpC,KAAK,MAAM5B,IAAI,IAAI4B,QAAQ,CAACN,QAAQ,EAAE,EACtC;KACC,IACA;OACC,MAAMxR,OAAO,GAAG,MAAM,IAAI,CAAC/D,aAAa,CAAC6D,aAAa,CAACiS,iCAAiC,CAAC,CAAC7B,IAAI,CAAC,CAAC;OAChG,IAAI,CAACjU,aAAa,CAAC6D,aAAa,CAACkS,WAAW,CAAChS,OAAO,CAAC;OACrD,MAAM,IAAI,CAACxB,iBAAiB,EAAE;MAC9B,CACD,OAAO4M,CAAC,EACR;OACCjF,OAAO,CAACD,KAAK,CAAE,kCAAiCgK,IAAI,CAACqB,OAAO,EAAG,EAAC,EAAEnG,CAAC,CAAC;;;GAItE+F,aAAG,CAACO,KAAK,yCAAC,IAAI,iFAAyC;KAAEC,OAAO,EAAE,CAAC;KAAE,gBAAgB,EAAE;IAAQ,CAAC;GAChG,4CAAI,sEAAmC,KAAK;GAC5C,4CAAI,4BAAaE,WAAW,CAAC,KAAK,CAAC;GACnC3N,EAAE,CAACmK,SAAS,CAACC,QAAQ,CAAC2D,KAAK,EAAE;CAC9B;CAAC,4BAEiBnU,KAAgD,EAClE;GACC,MAAMoU,cAAc,GAAG;KACtBtC,WAAW,EAAE,QAAU;KACvBC,gBAAgB,EAAE,QAAU;KAC5BC,gBAAgB,EAAE;IAClB;GACD,MAAM9R,IAAI,GAAGF,KAAK,CAACiB,OAAO,EAAE;GAC5B,MAAM2R,KAAqB,GAAG1S,IAAI,CAAC0S,KAAK;GACxC,MAAMoB,QAAQ,2CAAG,IAAI,+BAAe;GACpC,MAAMK,eAA+B,GAAG,CAAC,GAAGzB,KAAK,EAAE,GAAGoB,QAAQ,CAACN,QAAQ,EAAE,CAAC;GAE1E,IAAKW,eAAe,CAACpP,MAAM,GAAG,IAAI,CAACpD,cAAc,CAACU,IAAI,2CAAI,IAAI,uCAAkB,EAChF;KACCoR,KAAK,CAAC5M,aAAG,CAACC,UAAU,CAAC,wDAAwD,CAAC,CAAC;KAC/EhH,KAAK,CAACsU,cAAc,EAAE;KAEtB;;GAGD,KAAK,MAAMlC,IAAI,IAAIQ,KAAK,EACxB;KACC,IAAIR,IAAI,CAACmC,OAAO,EAAE,GAAGH,cAAc,CAACtC,WAAW,EAC/C;OACC6B,KAAK,CAAC5M,aAAG,CAACC,UAAU,CAAC,6CAA6C,CAAC,CAAC;OACpEhH,KAAK,CAACsU,cAAc,EAAE;OAEtB;;KAGD,IAAIlC,IAAI,CAACoC,OAAO,EAAE,IAAIpC,IAAI,CAACmC,OAAO,EAAE,GAAGH,cAAc,CAACrC,gBAAgB,EACtE;OACC4B,KAAK,CAAC5M,aAAG,CAACC,UAAU,CAAC,mDAAmD,CAAC,CAAC;OAC1EhH,KAAK,CAACsU,cAAc,EAAE;OAEtB;;;GAIF,MAAMG,aAAa,GAAGJ,eAAe,CAACxI,MAAM,CAAC,CAACC,GAAG,EAAEsG,IAAI,KAAKtG,GAAG,GAAGsG,IAAI,CAACmC,OAAO,EAAE,EAAE,CAAC,CAAC;GACpF,IAAIE,aAAa,GAAGL,cAAc,CAACpC,gBAAgB,EACnD;KACC2B,KAAK,CAAC5M,aAAG,CAACC,UAAU,CAAC,wDAAwD,CAAC,CAAC;KAC/EhH,KAAK,CAACsU,cAAc,EAAE;;CAExB;CAAC,gCAEqBjU,IAAsB,EAC5C;GACC,OAAOA,IAAI,IAAIA,IAAI,KAAKuO,sBAAY,CAACC,KAAK;CAC3C;;;;;;;;"}