{"version":3,"file":"datetime-limit-selector.bundle.js","sources":["../src/datetime-limit-selector.js"],"sourcesContent":["import { Loc, Tag, Dom, Event } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Timezone, DateTimeFormat } from 'main.date';\nimport { Api } from 'sign.v2.api';\nimport './style.css';\nimport 'ui.design-tokens';\n\nexport class DatetimeLimitSelector extends EventEmitter\n{\n\t#api: Api;\n\t#documentUids: Array<string>;\n\t#documentDateField: HTMLElement;\n\t#selectedDate: Date | null = null;\n\n\tconstructor(date: Date = new Date())\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Sign.V2.DatetimeLimitSelector');\n\n\t\tthis.#documentUids = [];\n\t\tthis.#api = new Api();\n\n\t\tthis.#documentDateField = this.#getDateField();\n\t\tthis.setDate(date);\n\t}\n\n\tgetLayout(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-datetime-limit-selector\">\n\t\t\t\t<span class=\"sign-datetime-limit-selector__label\">\n\t\t\t\t\t${Loc.getMessage('SIGN_BLANK_DATETIME_SELECTOR_LABEL')}\n\t\t\t\t</span>\n\t\t\t\t${this.#documentDateField}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getDateField(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div\n\t\t\t\tclass=\"sign-datetime-limit-selector_field\"\n\t\t\t\tonclick=\"${() => {\n\t\t\t\t\tBX.calendar({\n\t\t\t\t\t\tnode: this.#documentDateField,\n\t\t\t\t\t\tfield: this.#documentDateField,\n\t\t\t\t\t\tcurrentTime: this.#selectedDate.getTime() / 1000,\n\t\t\t\t\t\tvalue: DateTimeFormat.format(DateTimeFormat.getFormat('FORMAT_DATETIME'), this.#selectedDate.getTime() / 1000),\n\t\t\t\t\t\tbTime: true,\n\t\t\t\t\t\tbHideTime: false,\n\t\t\t\t\t\tcallback: (date) => {\n\t\t\t\t\t\t\tthis.emit('beforeDateModify');\n\n\t\t\t\t\t\t\tthis.#saveSelectedDate(date).then(\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tDom.removeClass(this.#documentDateField, '--invalid');\n\n\t\t\t\t\t\t\t\t\tthis.emit('afterDateModify', new Event.BaseEvent({\n\t\t\t\t\t\t\t\t\t\tdata: { isValid: true },\n\t\t\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tDom.addClass(this.#documentDateField, '--invalid');\n\n\t\t\t\t\t\t\t\t\tthis.emit('afterDateModify', new Event.BaseEvent({\n\t\t\t\t\t\t\t\t\t\tdata: { isValid: false },\n\t\t\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback_after: (date) => {\n\t\t\t\t\t\t\tthis.setDate(date);\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}}\"\n\t\t\t>\n\t\t\t\t<span class=\"sign-datetime-limit-selector_field-text\"></span>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#saveSelectedDate(datetime: Date): Promise<any[]>\n\t{\n\t\tconst timestamp = Timezone.UserTime.toUTCTimestamp(datetime);\n\n\t\treturn Promise.all(this.#documentUids.map((uid) => this.#api.modifyDateSignUntil(uid, timestamp)));\n\t}\n\n\tsetDocumentUids(uids: Array<string>)\n\t{\n\t\tthis.#documentUids = uids;\n\t}\n\n\tgetSelectedDate(): Date | null\n\t{\n\t\treturn this.#selectedDate;\n\t}\n\n\tsetDate(date: Date): void\n\t{\n\t\tthis.#selectedDate = date;\n\n\t\tconst dateFormatted = DateTimeFormat.format(DateTimeFormat.getFormat('MEDIUM_DATE_FORMAT'), date);\n\t\tconst timeFormatted = DateTimeFormat.format(DateTimeFormat.getFormat('SHORT_TIME_FORMAT'), date);\n\t\tconst formattedDate = Loc.getMessage('SIGN_BLANK_DATETIME_SELECTOR_DATE', {\n\t\t\t'#MEDIUM_DATE#': dateFormatted,\n\t\t\t'#SHORT_TIME#': timeFormatted,\n\t\t});\n\n\t\tconst dateTextNode = this.#documentDateField.firstElementChild;\n\t\tdateTextNode.textContent = formattedDate;\n\t}\n\n\tisValid(): boolean\n\t{\n\t\treturn !Dom.hasClass(this.#documentDateField, '--invalid');\n\t}\n}\n"],"names":["DatetimeLimitSelector","EventEmitter","constructor","date","Date","setEventNamespace","Api","setDate","getLayout","Tag","render","Loc","getMessage","setDocumentUids","uids","getSelectedDate","dateFormatted","DateTimeFormat","format","getFormat","timeFormatted","formattedDate","dateTextNode","firstElementChild","textContent","isValid","Dom","hasClass","BX","calendar","node","field","currentTime","getTime","value","bTime","bHideTime","callback","emit","then","removeClass","Event","BaseEvent","data","addClass","callback_after","datetime","timestamp","Timezone","UserTime","toUTCTimestamp","Promise","all","map","uid","modifyDateSignUntil"],"mappings":"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"}