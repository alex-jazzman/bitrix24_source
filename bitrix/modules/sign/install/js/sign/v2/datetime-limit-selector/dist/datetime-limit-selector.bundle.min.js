this.BX=this.BX||{};this.BX.Sign=this.BX.Sign||{};(function(e,s,t,a,i,l){"use strict";let r=e=>e,o,n;var c=babelHelpers.classPrivateFieldLooseKey("api");var d=babelHelpers.classPrivateFieldLooseKey("documentUids");var b=babelHelpers.classPrivateFieldLooseKey("documentDateField");var v=babelHelpers.classPrivateFieldLooseKey("selectedDate");var m=babelHelpers.classPrivateFieldLooseKey("signingMinMinutes");var h=babelHelpers.classPrivateFieldLooseKey("signingMaxMonth");var p=babelHelpers.classPrivateFieldLooseKey("getDateField");var P=babelHelpers.classPrivateFieldLooseKey("isDatePassMinValidation");var F=babelHelpers.classPrivateFieldLooseKey("isDatePassMaxValidation");class g extends a.EventEmitter{constructor(){super();Object.defineProperty(this,F,{value:T});Object.defineProperty(this,P,{value:u});Object.defineProperty(this,p,{value:L});Object.defineProperty(this,c,{writable:true,value:void 0});Object.defineProperty(this,d,{writable:true,value:void 0});Object.defineProperty(this,b,{writable:true,value:void 0});Object.defineProperty(this,v,{writable:true,value:null});Object.defineProperty(this,m,{writable:true,value:void 0});Object.defineProperty(this,h,{writable:true,value:void 0});this.setEventNamespace("BX.Sign.V2.DatetimeLimitSelector");babelHelpers.classPrivateFieldLooseBase(this,d)[d]=[];babelHelpers.classPrivateFieldLooseBase(this,c)[c]=new l.Api;babelHelpers.classPrivateFieldLooseBase(this,b)[b]=babelHelpers.classPrivateFieldLooseBase(this,p)[p]();const e=s.Extension.getSettings("sign.v2.datetime-limit-selector");const t=e.get("defaultSignUntilDate",null);this.setDate(t?new Date(t):new Date);babelHelpers.classPrivateFieldLooseBase(this,m)[m]=e.get("signingMinMinutes",5);babelHelpers.classPrivateFieldLooseBase(this,h)[h]=e.get("signingMaxMonth",3)}getLayout(){return s.Tag.render(o||(o=r`
			<div class="sign-datetime-limit-selector">
				<span class="sign-datetime-limit-selector__label">
					${0}
				</span>
				${0}
			</div>
		`),s.Loc.getMessage("SIGN_BLANK_DATETIME_SELECTOR_LABEL"),babelHelpers.classPrivateFieldLooseBase(this,b)[b])}getSelectedDate(){return babelHelpers.classPrivateFieldLooseBase(this,v)[v]}setDate(e){babelHelpers.classPrivateFieldLooseBase(this,v)[v]=e;const t=i.DateTimeFormat.format(i.DateTimeFormat.getFormat("MEDIUM_DATE_FORMAT"),e);const a=i.DateTimeFormat.format(i.DateTimeFormat.getFormat("SHORT_TIME_FORMAT"),e);const l=s.Loc.getMessage("SIGN_BLANK_DATETIME_SELECTOR_DATE",{"#MEDIUM_DATE#":t,"#SHORT_TIME#":a});const r=babelHelpers.classPrivateFieldLooseBase(this,b)[b].firstElementChild;r.textContent=l}isValid(){return!s.Dom.hasClass(babelHelpers.classPrivateFieldLooseBase(this,b)[b],"--invalid")}setValidClass(){s.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,b)[b],"--invalid")}setInvalidClass(){s.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,b)[b],"--invalid")}async saveSelectedDateForUids(){const e=i.Timezone.UserTime.toUTCTimestamp(babelHelpers.classPrivateFieldLooseBase(this,v)[v]);try{await Promise.all(babelHelpers.classPrivateFieldLooseBase(this,d)[d].map((s=>babelHelpers.classPrivateFieldLooseBase(this,c)[c].modifyDateSignUntil(s,e))));this.setValidClass()}catch(e){this.setInvalidClass();throw e}}setDocumentUids(e){babelHelpers.classPrivateFieldLooseBase(this,d)[d]=e}}function L(){return s.Tag.render(n||(n=r`
			<div
				class="sign-datetime-limit-selector_field"
				onclick="${0}"
			>
				<span class="sign-datetime-limit-selector_field-text"></span>
			</div>
		`),(()=>{BX.calendar({node:babelHelpers.classPrivateFieldLooseBase(this,b)[b],field:babelHelpers.classPrivateFieldLooseBase(this,b)[b],currentTime:babelHelpers.classPrivateFieldLooseBase(this,v)[v].getTime()/1e3,value:i.DateTimeFormat.format(i.DateTimeFormat.getFormat("FORMAT_DATETIME"),babelHelpers.classPrivateFieldLooseBase(this,v)[v].getTime()/1e3),bTime:true,bHideTime:false,callback:e=>{this.emit("beforeDateModify");if(!babelHelpers.classPrivateFieldLooseBase(this,P)[P](e)){const e=s.Loc.getMessagePlural("PERIOD_TOO_SHORT",babelHelpers.classPrivateFieldLooseBase(this,m)[m],{"#MIN_PERIOD#":babelHelpers.classPrivateFieldLooseBase(this,m)[m]});t.UI.Notification.Center.notify({content:s.Text.encode(e),autoHideDelay:4e3});return false}if(!babelHelpers.classPrivateFieldLooseBase(this,F)[F](e)){const e=s.Loc.getMessagePlural("PERIOD_TOO_LONG",babelHelpers.classPrivateFieldLooseBase(this,h)[h],{"#MONTH#":babelHelpers.classPrivateFieldLooseBase(this,h)[h]});t.UI.Notification.Center.notify({content:s.Text.encode(e),autoHideDelay:4e3});return false}this.emit("afterDateModify");return true},callback_after:e=>{this.setDate(e)}})}))}function u(e){const s=i.Timezone.UserTime.getDate();s.setMinutes(s.getMinutes()+babelHelpers.classPrivateFieldLooseBase(this,m)[m]);return e.getTime()>s.getTime()}function T(e){const s=i.Timezone.UserTime.getDate();s.setMonth(s.getMonth()+babelHelpers.classPrivateFieldLooseBase(this,h)[h]);return e.getTime()<s.getTime()}e.DatetimeLimitSelector=g})(this.BX.Sign.V2=this.BX.Sign.V2||{},BX,BX,BX.Event,BX.Main,BX.Sign.V2);
//# sourceMappingURL=datetime-limit-selector.bundle.map.js