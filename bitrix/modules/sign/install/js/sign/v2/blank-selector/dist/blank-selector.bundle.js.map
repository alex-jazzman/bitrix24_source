{"version":3,"file":"blank-selector.bundle.js","sources":["../src/list-item.js","../src/blank.js","../src/blank-field.js","../src/index.js"],"sourcesContent":["import { Tag, Dom } from 'main.core';\n\nexport class ListItem<T>\n{\n\t#layout: HTMLElement;\n\t#props: T;\n\t#titleNode: HTMLElement;\n\t#descriptionNode: HTMLElement;\n\n\tconstructor(props: T)\n\t{\n\t\tthis.#titleNode = Tag.render`\n\t\t\t<span class=\"sign-blank-selector__list_item-title\"></span>\n\t\t`;\n\t\tthis.#descriptionNode = Tag.render`\n\t\t\t<span class=\"sign-blank-selector__list_item-info\"></span>\n\t\t`;\n\t\tthis.setProps(props);\n\t\tthis.#layout = this.#createListItem();\n\t}\n\n\t#createListItem(): HTMLElement\n\t{\n\t\tconst { title, description, modifier } = this.getProps();\n\t\tthis.setTitle(title);\n\t\tthis.setDescription(description);\n\n\t\treturn Dom.create('div', {\n\t\t\tattrs: {\n\t\t\t\tclassName: `sign-blank-selector__list_item --${modifier}`,\n\t\t\t},\n\t\t\tchildren: [this.#titleNode, this.#descriptionNode],\n\t\t});\n\t}\n\n\tgetLayout(): HTMLElement\n\t{\n\t\treturn this.#layout;\n\t}\n\n\tsetTitle(title: string = ''): void\n\t{\n\t\tthis.#titleNode.textContent = title;\n\t\tthis.#titleNode.title = title;\n\t\tthis.setProps({\n\t\t\t...this.getProps(),\n\t\t\ttitle,\n\t\t});\n\t}\n\n\tsetDescription(description: string = ''): void\n\t{\n\t\tthis.#descriptionNode.textContent = description;\n\t\tthis.#descriptionNode.title = description;\n\t\tthis.setProps({\n\t\t\t...this.getProps(),\n\t\t\tdescription,\n\t\t});\n\t}\n\n\tgetProps(): T\n\t{\n\t\treturn this.#props;\n\t}\n\n\tsetProps(props: T): void\n\t{\n\t\tthis.#props = props;\n\t}\n}\n","import { Tag, Dom } from 'main.core';\nimport { Loader } from 'main.loader';\nimport { ListItem } from './list-item';\nimport 'ui.icons';\n\nexport class Blank<T> extends ListItem<T>\n{\n\t#placeholder: HTMLElement;\n\t#preview: HTMLElement;\n\t#loader: Loader;\n\n\tconstructor(props: T)\n\t{\n\t\tsuper({ ...props, modifier: 'blank' });\n\t\tthis.#placeholder = Tag.render`<div class=\"sign-blank-selector__list_item-status\"></div>`;\n\t\tthis.#preview = Tag.render`\n\t\t\t<div class=\"sign-blank-selector__list_item-preview\" hidden>\n\t\t\t\t<img\n\t\t\t\t\tonload=\"${() => {\n\t\t\t\t\t\tthis.#preview.hidden = false;\n\t\t\t\t\t\tthis.#placeholder.hidden = true;\n\t\t\t\t\t}}\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t`;\n\t\tthis.#loader = new Loader({ size: 30, target: this.#placeholder });\n\t\tconst layout = this.getLayout();\n\t\tDom.prepend(this.#placeholder, layout);\n\t\tDom.prepend(this.#preview, layout);\n\t}\n\n\tsetAvatarWithDescription(description: string, userAvatarUrl: string | null): void\n\t{\n\t\tthis.setDescription(description);\n\t\tthis.setProps({\n\t\t\t...this.getProps(),\n\t\t\tuserAvatarUrl,\n\t\t});\n\t\tconst avatarIcon = userAvatarUrl\n\t\t\t? Tag.render`\n\t\t\t\t<img class=\"sign-blank-selector__list_item-info-avatar\" src=\"${userAvatarUrl}\" />\n\t\t\t`\n\t\t\t: Tag.render`\n\t\t\t\t<span class=\"sign-blank-selector__list_item-info-avatar ui-icon ui-icon-common-user\">\n\t\t\t\t\t<i></i>\n\t\t\t\t</span>\n\t\t\t`;\n\t\tconst { lastElementChild: descriptionNode } = this.getLayout();\n\t\tDom.prepend(avatarIcon, descriptionNode);\n\t}\n\n\tselect(): void\n\t{\n\t\tDom.addClass(this.getLayout(), '--active');\n\t}\n\n\tdeselect(): void\n\t{\n\t\tDom.removeClass(this.getLayout(), '--active');\n\t\tthis.getLayout().blur();\n\t}\n\n\tremove(): void\n\t{\n\t\tDom.remove(this.getLayout());\n\t}\n\n\tsetId(id: number): void\n\t{\n\t\tthis.getLayout().dataset.id = id;\n\t}\n\n\tsetReady(isReady: boolean): void\n\t{\n\t\tif (!isReady)\n\t\t{\n\t\t\tthis.#loader.show();\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst layout = this.getLayout();\n\t\tlayout.tabIndex = '0';\n\t\tthis.#loader.hide();\n\t\tDom.addClass(layout, '--loaded');\n\t}\n\n\tsetPreview(previewUrl: string): void\n\t{\n\t\tif (previewUrl)\n\t\t{\n\t\t\tthis.#preview.firstElementChild.src = previewUrl;\n\t\t}\n\t}\n}\n","import { Cache, Tag, Dom, Type, Loc, Text } from 'main.core';\nimport { type BaseCache } from 'main.core.cache';\nimport { EventEmitter, BaseEvent } from 'main.core.events';\nimport { Api } from 'sign.v2.api';\nimport { TagSelector } from 'ui.entity-selector';\nimport type { BlankSelectorConfig } from './index';\nimport { BlankSelector } from './index';\n\nexport type BlankFieldOptions = {\n\tselectorOptions?: BlankSelectorConfig,\n\tdata?: {\n\t\tblankId: number | string | null,\n\t},\n\tevents?: {\n\t\t[key: string]: (event: BaseEvent) => void,\n\t},\n};\n\n/**\n * @namespace BX.Sign.V2\n */\nexport class BlankField extends EventEmitter\n{\n\t#cache: BaseCache = new Cache.MemoryCache();\n\n\tconstructor(options: BlankFieldOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Sign.BlankSelector.BlankField');\n\t\tthis.subscribeFromOptions(options?.events);\n\t\tthis.#setOptions(options);\n\n\t\tconst blankId = options?.data?.blankId;\n\t\tif (Type.isStringFilled(blankId) || Type.isNumber(blankId))\n\t\t{\n\t\t\tthis.#getApi()\n\t\t\t\t.getBlankById(options.data.blankId)\n\t\t\t\t.then(({ id, title }) => {\n\t\t\t\t\tthis.#getTagSelector().addTag({\n\t\t\t\t\t\tid,\n\t\t\t\t\t\ttitle,\n\t\t\t\t\t\tentityId: 'blank',\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t;\n\t\t}\n\t}\n\n\t#setOptions(options: BlankFieldOptions)\n\t{\n\t\tthis.#cache.set('options', options);\n\t}\n\n\t#getOptions(): BlankFieldOptions\n\t{\n\t\treturn this.#cache.get('options', {});\n\t}\n\n\t#getApi(): Api\n\t{\n\t\treturn this.#cache.remember('api', () => new Api());\n\t}\n\n\t#getBlankSelector(): BlankSelector\n\t{\n\t\treturn this.#cache.remember('blankSelector', () => {\n\t\t\treturn new BlankSelector({\n\t\t\t\t...(this.#getOptions().selectorOptions),\n\t\t\t\tevents: {\n\t\t\t\t\ttoggleSelection: (event: BaseEvent) => {\n\t\t\t\t\t\tconst { id, title, selected } = event.getData();\n\t\t\t\t\t\tconst tagSelector = this.#getTagSelector();\n\t\t\t\t\t\tif (selected)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttagSelector.addTag({\n\t\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\t\ttitle,\n\t\t\t\t\t\t\t\tentityId: 'blank',\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\ttagSelector.showAddButton();\n\t\t\t\t\t\t\tthis.emit('onSelect', event);\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (tagSelector.getTags().length === 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttagSelector.showAddButton();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.emit('onCancel');\n\t\t\t\t\t},\n\t\t\t\t\tonSliderClose: () => {\n\t\t\t\t\t\tconst tagSelector = this.#getTagSelector();\n\t\t\t\t\t\tif (tagSelector.getTags().length === 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttagSelector.showAddButton();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.#resetBlankSelector();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\t#getTagSelector(): TagSelector\n\t{\n\t\treturn this.#cache.remember('tagSelector', () => {\n\t\t\treturn new TagSelector({\n\t\t\t\tid: Text.getRandom(),\n\t\t\t\tmultiple: false,\n\t\t\t\tshowTextBox: false,\n\t\t\t\taddButtonCaption: Loc.getMessage('SIGN_BLANK_SELECTOR_FIELD_ADD_BUTTON_LABEL'),\n\t\t\t\ttagMaxWidth: 500,\n\t\t\t\tevents: {\n\t\t\t\t\tonAddButtonClick: () => {\n\t\t\t\t\t\tthis.#getBlankSelector().openInSlider();\n\t\t\t\t\t\tthis.#getTagSelector().hideTextBox();\n\t\t\t\t\t},\n\t\t\t\t\tonAfterTagRemove: () => {\n\t\t\t\t\t\tthis.#getTagSelector().hideTextBox();\n\t\t\t\t\t\tthis.#getTagSelector().showAddButton();\n\t\t\t\t\t\tthis.emit('onRemove');\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tgetLayout(): HTMLDivElement\n\t{\n\t\treturn this.#cache.remember('layout', () => {\n\t\t\tconst layout = Tag.render`\n\t\t\t\t<div class=\"sign-blank-selector-field\">\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tthis.#getTagSelector().renderTo(layout);\n\n\t\t\treturn layout;\n\t\t});\n\t}\n\n\trenderTo(targetContainer: HTMLElement)\n\t{\n\t\tif (Type.isDomNode(targetContainer))\n\t\t{\n\t\t\tDom.append(this.getLayout(), targetContainer);\n\t\t}\n\t}\n\n\t#resetBlankSelector(): void\n\t{\n\t\tthis.#cache.delete('blankSelector');\n\t}\n}\n","import { Tag, Loc, Dom, Event, Type, Reflection, Cache } from 'main.core';\nimport { DateTimeFormat } from 'main.date';\nimport { Loader } from 'main.loader';\nimport { Popup } from 'main.popup';\nimport { EventEmitter, BaseEvent } from 'main.core.events';\nimport { isTemplateMode } from 'sign.v2.sign-settings';\nimport { Layout } from 'ui.sidepanel.layout';\nimport { TileWidget } from 'ui.uploader.tile-widget';\nimport { UploaderEvent, FileStatus, type UploaderFile } from 'ui.uploader.core';\nimport { Api } from 'sign.v2.api';\nimport { ListItem } from './list-item';\nimport { Blank } from './blank';\nimport { BlankField } from './blank-field';\nimport type { BlankSelectorConfig, BlankData, ListItemProps, BlankProps, ToggleEvent } from './types/type';\nimport { UI } from 'ui.notification';\nimport './style.css';\n\ntype RemoveOptions = {\n\tremoveFromServer: boolean;\n};\n\nconst uploaderOptions = {\n\tcontroller: 'sign.upload.blankUploadController',\n\tacceptedFileTypes: [\n\t\t'.jpg', '.jpeg',\n\t\t'.png', '.pdf',\n\t\t'.doc', '.docx',\n\t\t'.rtf', '.odt',\n\t],\n\tmultiple: true,\n\tautoUpload: false,\n\tmaxFileSize: 50 * 1024 * 1024,\n\tmaxFileCount: 100,\n\timageMaxFileSize: 10 * 1024 * 1024,\n\tmaxTotalFileSize: 50 * 1024 * 1024,\n};\nconst errorPopupOptions = {\n\tid: 'qwerty',\n\tpadding: 20,\n\toffsetLeft: 40,\n\toffsetTop: -12,\n\tangle: true,\n\tdarkMode: true,\n\twidth: 300,\n\tautoHide: true,\n\tcacheable: false,\n\tbindOptions: {\n\t\tposition: 'bottom',\n\t},\n};\n\nexport { BlankField, ListItem };\nexport type { BlankSelectorConfig, ToggleEvent };\n\nexport class BlankSelector extends EventEmitter\n{\n\tevents = Object.freeze({\n\t\tbeforeAddFileSuccessfully: 'beforeAddFileSuccessfully',\n\t\ttoggleSelection: 'toggleSelection',\n\t\taddFile: 'addFile',\n\t});\n\n\t#cache = new Cache.MemoryCache();\n\tselectedBlankId: number;\n\t#blanks: Map<string, Blank<BlankProps>>;\n\t#tileWidget: TileWidget;\n\t#tileWidgetContainer: HTMLElement;\n\t#uploadButtonsContainer: HTMLElement;\n\t#relatedTarget: ?HTMLElement;\n\t#blanksContainer: HTMLElement;\n\t#page: number;\n\t#loadMoreButton: HTMLElement;\n\t#api: Api;\n\t#config: BlankSelectorConfig;\n\n\tconstructor(config: BlankSelectorConfig)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Sign.V2.BlankSelector');\n\t\tthis.subscribeFromOptions(config?.events ?? {});\n\t\tthis.#config = config;\n\t\tthis.selectedBlankId = 0;\n\t\tthis.#blanks = new Map();\n\t\tthis.#page = 0;\n\t\tconst uploadButtons = this.#createUploadButtons();\n\t\tconst dragArea = Tag.render`\n\t\t\t<label class=\"sign-blank-selector__list_drag-area-label\">\n\t\t\t\t${Loc.getMessage('SIGN_BLANK_SELECTOR_DRAG_AREA')}\n\t\t\t</label>\n\t\t`;\n\t\tconst widgetOptions = {\n\t\t\tslots: {\n\t\t\t\tafterDropArea: {\n\t\t\t\t\tcomputed: {\n\t\t\t\t\t\ttitle: () => Loc.getMessage('SIGN_BLANK_SELECTOR_CLEAR_ALL'),\n\t\t\t\t\t},\n\t\t\t\t\tmethods: {\n\t\t\t\t\t\tclear: () => {\n\t\t\t\t\t\t\tthis.clearFiles({ removeFromServer: false });\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\ttemplate: `\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tclass=\"sign-blank-selector__tile-widget_clear-btn\"\n\t\t\t\t\t\t\t:title=\"title\"\n\t\t\t\t\t\t\t@click=\"clear()\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t`,\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t\tthis.#uploadButtonsContainer = Tag.render`\n\t\t\t<div class=\"sign-blank-selector__list --with-buttons\">\n\t\t\t\t${uploadButtons}\n\t\t\t\t${dragArea}\n\t\t\t</div>\n\t\t`;\n\t\tthis.#tileWidget = new TileWidget({\n\t\t\t...uploaderOptions,\n\t\t\t...config.uploaderOptions,\n\t\t\tdropElement: this.#uploadButtonsContainer,\n\t\t\tbrowseElement: [...uploadButtons, dragArea],\n\t\t\tevents: {\n\t\t\t\t[UploaderEvent.BEFORE_FILES_ADD]: (event) => this.#onFileBeforeAdd(event),\n\t\t\t\t[UploaderEvent.FILE_ADD]: (event) => this.#onFileAdd(event),\n\t\t\t\t[UploaderEvent.FILE_REMOVE]: (event) => this.#onFileRemove(event),\n\t\t\t\t[UploaderEvent.UPLOAD_START]: (event) => this.#onUploadStart(event),\n\t\t\t},\n\t\t}, widgetOptions);\n\t\tthis.#relatedTarget = null;\n\t\tEvent.bind(document, 'mousedown', (event) => {\n\t\t\tthis.#relatedTarget = event.target;\n\t\t});\n\t\tthis.#blanksContainer = Tag.render`\n\t\t\t<div\n\t\t\t\tclass=\"sign-blank-selector__list\"\n\t\t\t\tonfocusin=\"${({ target }) => {\n\t\t\t\t\tthis.selectBlank(Number(target.dataset.id));\n\t\t\t\t}}\"\n\t\t\t\tonclick=\"${({ target, ctrlKey, metaKey }) => {\n\t\t\t\t\tif (ctrlKey || metaKey)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.resetSelectedBlank(Number(target.dataset.id), this.#relatedTarget);\n\t\t\t\t\t}\n\t\t\t\t}}\"\n\t\t\t></div>\n\t\t`;\n\t\tthis.#tileWidgetContainer = Tag.render`\n\t\t\t<div class=\"sign-blank-selector__tile-widget\"></div>\n\t\t`;\n\t\tthis.#loadMoreButton = Tag.render`\n\t\t\t<div class=\"sign-blank-selector__load-more --hidden\">\n\t\t\t\t<span onclick=\"${() => this.#loadBlanks(this.#page + 1)}\">\n\t\t\t\t\t${Loc.getMessage('SIGN_BLANK_SELECTOR_LOAD_MORE')}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t`;\n\t\tthis.#api = new Api();\n\t}\n\n\t#checkForFilesValid(addedFiles: UploaderFile[]): boolean\n\t{\n\t\tconst isImage = (file) => file.getType().includes('image/');\n\t\tconst allAddedImages = addedFiles.every((file) => isImage(file));\n\t\tconst validExtension = addedFiles.every((file) => {\n\t\t\t// TODO merge with this.#config.uploaderOptions.acceptedFileTypes\n\t\t\treturn uploaderOptions.acceptedFileTypes.includes(\n\t\t\t\t`.${file.getExtension()}`,\n\t\t\t);\n\t\t});\n\t\tif (!validExtension || (addedFiles.length > 1 && !allAddedImages))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst uploader = this.#tileWidget.getUploader();\n\t\tconst files = uploader.getFiles();\n\t\tconst filesLength = files.length;\n\t\tconst imagesLimit = this.#getImagesLimit();\n\t\tif (filesLength === 0 && addedFiles.length === 1)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tconst allExistImages = files.every((file) => isImage(file));\n\n\t\treturn allAddedImages\n\t\t\t&& allExistImages\n\t\t\t&& imagesLimit - filesLength >= addedFiles.length;\n\t}\n\n\t#onFileBeforeAdd(uploaderEvent: BaseEvent<{ files: UploaderFile[] }>): void\n\t{\n\t\tconst { files: addedFiles } = uploaderEvent.getData();\n\t\tconst valid = this.#checkForFilesValid(addedFiles);\n\t\tif (valid)\n\t\t{\n\t\t\tconst selfEvent = new BaseEvent({ data: { files: addedFiles } });\n\t\t\tthis.emit(this.events.beforeAddFileSuccessfully, selfEvent);\n\t\t\tif (selfEvent.isDefaultPrevented())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tlet bindElement = this.#uploadButtonsContainer.firstElementChild;\n\t\tif (Dom.hasClass(this.#uploadButtonsContainer, '--hidden'))\n\t\t{\n\t\t\tconst {\n\t\t\t\t$refs: { container },\n\t\t\t} = this.#tileWidget.getRootComponent();\n\t\t\tbindElement = container.firstElementChild;\n\t\t}\n\n\t\tconst errorPopup = new Popup({\n\t\t\t...errorPopupOptions,\n\t\t\tbindElement,\n\t\t\tcontent: Loc.getMessage(\n\t\t\t\t'SIGN_BLANK_SELECTOR_UPLOAD_HINT',\n\t\t\t\t{ '%imageCountLimit%': this.#getImagesLimit() },\n\t\t\t),\n\t\t});\n\t\terrorPopup.show();\n\t\tuploaderEvent.preventDefault();\n\t}\n\n\t#getImagesLimit(): number\n\t{\n\t\treturn Type.isInteger(parseInt(this.#config?.uploaderOptions?.maxFileCount, 10))\n\t\t\t? this.#config?.uploaderOptions?.maxFileCount\n\t\t\t: uploaderOptions.maxFileCount\n\t\t;\n\t}\n\n\t#onFileAdd(event: BaseEvent)\n\t{\n\t\tconst title = event.data.file.getName();\n\t\tthis.#toggleTileVisibility(true);\n\t\tthis.resetSelectedBlank();\n\t\tthis.emit(this.events.addFile, { title: this.#normalizeTitle(title) });\n\t}\n\n\tgetUploadedFileName(fileIndex: number): string | null\n\t{\n\t\tconst uploader = this.#tileWidget.getUploader();\n\t\tconst files = uploader.getFiles();\n\t\tif (files.length === 0)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\tconst file = files.at(fileIndex);\n\t\tif (!file)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn this.#normalizeTitle(file.getName());\n\t}\n\n\t#onFileRemove(event: BaseEvent)\n\t{\n\t\tthis.emit('removeFile');\n\t\tconst uploader = this.#tileWidget.getUploader();\n\t\tconst files = uploader.getFiles();\n\t\tif (files.length === 0)\n\t\t{\n\t\t\tthis.#toggleTileVisibility(false);\n\t\t\tthis.emit('clearFiles');\n\t\t}\n\t}\n\n\t#onUploadStart()\n\t{\n\t\tconst uploader = this.#tileWidget.getUploader();\n\t\tconst [firstFile] = uploader.getFiles();\n\t\tconst title = firstFile.getName();\n\t\tconst fileId = firstFile.getId();\n\t\tconst uploadingBlank: Blank<BlankProps> = new Blank({ title });\n\t\tuploadingBlank.setReady(false);\n\t\tDom.prepend(uploadingBlank.getLayout(), this.#blanksContainer);\n\t\tfirstFile.setCustomData(fileId, uploadingBlank);\n\t}\n\n\t#toggleTileVisibility(shouldShow: boolean)\n\t{\n\t\tconst hiddenClass = '--hidden';\n\t\tif (shouldShow)\n\t\t{\n\t\t\tDom.removeClass(this.#tileWidgetContainer, hiddenClass);\n\t\t\tDom.addClass(this.#uploadButtonsContainer, hiddenClass);\n\n\t\t\treturn;\n\t\t}\n\n\t\tDom.addClass(this.#tileWidgetContainer, hiddenClass);\n\t\tDom.removeClass(this.#uploadButtonsContainer, hiddenClass);\n\t\tthis.clearFiles({ removeFromServer: false });\n\t}\n\n\t#createUploadButtons(): Array<HTMLElement>\n\t{\n\t\tconst buttons = {\n\t\t\timg: {\n\t\t\t\ttitle: Loc.getMessage('SIGN_BLANK_SELECTOR_CREATE_NEW_PIC'),\n\t\t\t\tdescription: 'jpeg, png',\n\t\t\t},\n\t\t\tpdf: {\n\t\t\t\ttitle: Loc.getMessage('SIGN_BLANK_SELECTOR_NEW_PDF'),\n\t\t\t\tdescription: 'Adobe Acrobat',\n\t\t\t},\n\t\t\tdoc: {\n\t\t\t\ttitle: Loc.getMessage('SIGN_BLANK_SELECTOR_NEW_DOC'),\n\t\t\t\tdescription: 'doc, docx',\n\t\t\t},\n\t\t};\n\t\tconst entries = Object.entries(buttons);\n\n\t\treturn entries.map(([key, { title, description }]) => {\n\t\t\tconst listItem: ListItem<ListItemProps> = new ListItem({\n\t\t\t\ttitle,\n\t\t\t\tdescription,\n\t\t\t\tmodifier: key,\n\t\t\t});\n\n\t\t\treturn listItem.getLayout();\n\t\t});\n\t}\n\n\tasync #resumeUploading()\n\t{\n\t\tconst uploader = this.#tileWidget.getUploader();\n\t\tconst pendingFiles = uploader.getFiles();\n\t\tuploader.setMaxParallelUploads(pendingFiles.length);\n\t\tconst uploadPromise = new Promise((resolve) => {\n\t\t\tuploader.subscribeOnce('onUploadComplete', resolve);\n\t\t});\n\t\tuploader.start();\n\t\tawait uploadPromise;\n\t}\n\n\tasync createBlankFromOuterUploaderFiles(files: Array<UploaderFile>): Promise<number>\n\t{\n\t\tif (files.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.#isAllFileUploadsComplete(files))\n\t\t{\n\t\t\tconst errorMessage = Loc.getMessage('SIGN_BLANK_SELECTOR_UPLOADER_ERROR_INCOMPLETE');\n\t\t\tUI.Notification.Center.notify({ content: errorMessage });\n\t\t\tthrow new Error(errorMessage);\n\t\t}\n\n\t\tconst firstFile = files.at(0);\n\t\tconst blank = new Blank({ title: firstFile.getName() });\n\t\tblank.setReady(false);\n\t\tDom.prepend(blank.getLayout(), this.#blanksContainer);\n\t\ttry\n\t\t{\n\t\t\tconst filesIds = files.map((file) => file.getServerFileId());\n\t\t\tconst blankData = await this.#api.createBlank(\n\t\t\t\tfilesIds,\n\t\t\t\tthis.#config.type ?? null,\n\t\t\t\tisTemplateMode(this.#config.documentMode),\n\t\t\t);\n\t\t\tthis.#setupBlank({\n\t\t\t\t...blankData,\n\t\t\t\tuserName: Loc.getMessage('SIGN_BLANK_SELECTOR_CREATED_MYSELF'),\n\t\t\t}, blank);\n\n\t\t\treturn blankData.id;\n\t\t}\n\t\tcatch (ex)\n\t\t{\n\t\t\tblank?.remove?.();\n\t\t\tconsole.log(ex);\n\t\t\tthrow ex;\n\t\t}\n\t}\n\n\tasync createBlank(): ?Promise<number>\n\t{\n\t\tconst uploader = this.#tileWidget.getUploader();\n\t\tconst files = uploader.getFiles();\n\n\t\tif (files.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst [firstFile] = files;\n\t\tawait this.#resumeUploading();\n\t\tconst blank = firstFile.getCustomData(firstFile.getId());\n\n\t\tif (!this.#isAllFileUploadsComplete(files))\n\t\t{\n\t\t\tconst errorMessage = Loc.getMessage('SIGN_BLANK_SELECTOR_UPLOADER_ERROR_INCOMPLETE');\n\t\t\tUI.Notification.Center.notify({ content: errorMessage });\n\t\t\tthrow new Error(errorMessage);\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tconst filesIds = files.map((file): string => file.getServerFileId());\n\t\t\tconst blankData = await this.#api.createBlank(\n\t\t\t\tfilesIds,\n\t\t\t\tthis.#config.type ?? null,\n\t\t\t\tisTemplateMode(this.#config.documentMode),\n\t\t\t);\n\t\t\tthis.#setupBlank({\n\t\t\t\t...blankData,\n\t\t\t\tuserName: Loc.getMessage('SIGN_BLANK_SELECTOR_CREATED_MYSELF'),\n\t\t\t}, blank);\n\n\t\t\treturn blankData.id;\n\t\t}\n\t\tcatch (ex)\n\t\t{\n\t\t\tblank.remove();\n\t\t\tthrow ex;\n\t\t}\n\t}\n\n\tasync #loadBlanks(page: number)\n\t{\n\t\tconst loader = new Loader({\n\t\t\ttarget: this.#blanksContainer,\n\t\t\tsize: 80,\n\t\t\tmode: 'custom',\n\t\t});\n\t\tloader.show();\n\t\ttry\n\t\t{\n\t\t\tconst blanksOnPage = 3;\n\t\t\tconst data = await this.#api.loadBlanks(page, this.#config.type ?? null, blanksOnPage);\n\t\t\tif (data.length < blanksOnPage)\n\t\t\t{\n\t\t\t\tDom.addClass(this.#loadMoreButton, '--hidden');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.removeClass(this.#loadMoreButton, '--hidden');\n\t\t\t}\n\n\t\t\tif (data.length > 0)\n\t\t\t{\n\t\t\t\tdata.forEach((blankData: BlankData) => {\n\t\t\t\t\tif (this.hasBlank(blankData.id))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst { title } = blankData;\n\t\t\t\t\tconst blank: Blank<BlankProps> = new Blank({ title });\n\t\t\t\t\tthis.#addBlank(blankData, blank);\n\t\t\t\t});\n\t\t\t\tthis.#page = page;\n\t\t\t}\n\t\t}\n\t\tcatch\n\t\t{\n\t\t\tDom.removeClass(this.#loadMoreButton, '--hidden');\n\t\t}\n\n\t\tloader.destroy();\n\t}\n\n\t#setupBlank(blankData: BlankData, blank: Blank): void\n\t{\n\t\tconst {\n\t\t\tid: blankId,\n\t\t\tpreviewUrl,\n\t\t\tuserAvatarUrl,\n\t\t\tuserName,\n\t\t\tdateCreate,\n\t\t} = blankData;\n\t\tconst creationDate = dateCreate ? new Date(dateCreate) : new Date();\n\t\tconst descriptionText = `${userName}, ${DateTimeFormat.format('j M. Y', creationDate)}`;\n\t\tblank.setId(blankId);\n\t\tblank.setReady(true);\n\t\tblank.setPreview(previewUrl);\n\t\tblank.setAvatarWithDescription(descriptionText, userAvatarUrl);\n\t\tthis.#blanks.set(blankId, blank);\n\t}\n\n\t#normalizeTitle(title: string): string\n\t{\n\t\tconst acceptedType = uploaderOptions.acceptedFileTypes.find((fileType) => {\n\t\t\treturn title.endsWith(fileType);\n\t\t});\n\t\tif (!acceptedType)\n\t\t{\n\t\t\treturn title;\n\t\t}\n\n\t\tconst dotExtensionIndex = title.lastIndexOf(acceptedType);\n\n\t\treturn title.slice(0, dotExtensionIndex);\n\t}\n\n\t#addBlank(blankData: BlankData, blank: Blank): void\n\t{\n\t\tthis.#setupBlank(blankData, blank);\n\t\tDom.append(blank.getLayout(), this.#blanksContainer);\n\t}\n\n\tresetSelectedBlank()\n\t{\n\t\tconst previousSelectedBlankId = this.selectedBlankId;\n\t\tconst blank = this.getBlank(this.selectedBlankId);\n\n\t\tblank?.deselect();\n\t\tthis.selectedBlankId = 0;\n\t\tif (blank)\n\t\t{\n\t\t\tthis.emit(this.events.toggleSelection, { selected: false, previousSelectedBlankId });\n\t\t}\n\t\tthis.#enableSaveButtonIntoSlider();\n\t}\n\n\tasync modifyBlankTitle(blankId: number, blankTitle: string): void\n\t{\n\t\tlet blank = this.#blanks.get(blankId);\n\t\tif (!blank)\n\t\t{\n\t\t\tawait this.loadBlankById(blankId);\n\t\t\tblank = this.#blanks.get(blankId);\n\t\t}\n\t\tblank.setTitle(blankTitle);\n\t}\n\n\thasBlank(blankId: number): boolean\n\t{\n\t\treturn this.#blanks.has(blankId);\n\t}\n\n\tgetBlank(blankId: number): Blank\n\t{\n\t\treturn this.#blanks.get(blankId);\n\t}\n\n\tasync loadBlankById(blankId: number): Promise<void>\n\t{\n\t\tconst blankData = await this.#api.getBlankById(blankId);\n\t\tif (!this.hasBlank(blankId))\n\t\t{\n\t\t\tconst blank: Blank<BlankProps> = new Blank({ title: blankData.title });\n\t\t\tthis.#addBlank(blankData, blank);\n\t\t}\n\t}\n\n\tasync selectBlank(blankId: number, eventExtraOptions: Object = {}): Promise<void>\n\t{\n\t\tconst previousSelectedBlankId = this.selectedBlankId;\n\t\tif (blankId !== this.selectedBlankId)\n\t\t{\n\t\t\tthis.resetSelectedBlank();\n\t\t}\n\n\t\tthis.selectedBlankId = blankId;\n\t\tthis.#toggleTileVisibility(false);\n\t\tlet blank = this.getBlank(blankId);\n\n\t\tif (!blank)\n\t\t{\n\t\t\tawait this.loadBlankById(blankId);\n\t\t\tblank = this.getBlank(blankId);\n\t\t}\n\t\tconst { title } = blank.getProps();\n\t\tblank.select();\n\n\t\tthis.emit(\n\t\t\tthis.events.toggleSelection,\n\t\t\t{\n\t\t\t\tid: blankId,\n\t\t\t\tselected: true,\n\t\t\t\ttitle: this.#normalizeTitle(title),\n\t\t\t\textra: eventExtraOptions,\n\t\t\t\tpreviousSelectedBlankId,\n\t\t\t},\n\t\t);\n\t}\n\n\tdeleteBlank(blankId: number)\n\t{\n\t\tconst lastBlank = this.#blanks.get(blankId);\n\t\tif (lastBlank)\n\t\t{\n\t\t\tthis.#blanks.delete(blankId);\n\t\t\tlastBlank.remove();\n\t\t}\n\t}\n\n\tclearFiles(options: RemoveOptions)\n\t{\n\t\tconst uploader = this.#tileWidget.getUploader();\n\t\tuploader.removeFiles(options);\n\t}\n\n\tisFilesReadyForUpload(): boolean\n\t{\n\t\tif (this.#tileWidget.getUploader().getFiles().length === 0)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.#tileWidget.getUploader().getFiles()\n\t\t\t.every((file: UploaderFile) => file.getErrors().length <= 0)\n\t\t;\n\t}\n\n\tgetLayout(): HTMLElement\n\t{\n\t\tthis.#tileWidget.renderTo(this.#tileWidgetContainer);\n\t\tthis.#toggleTileVisibility(false);\n\t\tconst canUploadNewBlank = this.#config.canUploadNewBlank ?? true;\n\t\tconst selectorContainer = Tag.render`\n\t\t\t<div class=\"sign-blank-selector\">\n\t\t\t\t${this.#tileWidgetContainer}\n\t\t\t\t${canUploadNewBlank ? this.#uploadButtonsContainer : ''}\n\t\t\t\t<p class=\"sign-blank-selector__templates_title\">\n\t\t\t\t\t${Loc.getMessage('SIGN_BLANK_SELECTOR_RECENT_TEMPLATES_TITLE')}\n\t\t\t\t</p>\n\t\t\t\t${this.#blanksContainer}\n\t\t\t\t${this.#loadMoreButton}\n\t\t\t</div>\n\t\t`;\n\t\tif (this.#page === 0)\n\t\t{\n\t\t\tthis.#loadBlanks(1);\n\t\t}\n\n\t\treturn selectorContainer;\n\t}\n\n\topenInSlider()\n\t{\n\t\tconst SidePanel: BX.SidePanel = Reflection.getClass('BX.SidePanel');\n\t\tif (!Type.isNil(SidePanel))\n\t\t{\n\t\t\tSidePanel.Instance.open('v2-blank-selector', {\n\t\t\t\twidth: 628,\n\t\t\t\tcacheable: false,\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: () => {\n\t\t\t\t\t\tthis.emit('onSliderClose');\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tcontentCallback: () => {\n\t\t\t\t\treturn Layout.createContent({\n\t\t\t\t\t\textensions: ['sign.v2.blank-selector'],\n\t\t\t\t\t\ttitle: Loc.getMessage('SIGN_BLANK_SELECTOR_SLIDER_TITLE'),\n\t\t\t\t\t\tcontent: () => this.getLayout(),\n\t\t\t\t\t\tbuttons: ({ cancelButton, SaveButton }) => {\n\t\t\t\t\t\t\tthis.#setSaveButtonIntoSlider(\n\t\t\t\t\t\t\t\tnew SaveButton({\n\t\t\t\t\t\t\t\t\ttext: Loc.getMessage('SIGN_BLANK_SELECTOR_SLIDER_SELECT_BLANK_BUTTON_LABEL'),\n\t\t\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\t\t\tSidePanel.Instance.close();\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tthis.#disableSaveButtonIntoSlider();\n\n\t\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\t\tthis.#getSaveButtonIntoSlider(),\n\t\t\t\t\t\t\t\tcancelButton,\n\t\t\t\t\t\t\t];\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n\n\t#setSaveButtonIntoSlider(button)\n\t{\n\t\tthis.#cache.set('saveButton', button);\n\t}\n\n\t#disableSaveButtonIntoSlider()\n\t{\n\t\tconst saveButton = this.#getSaveButtonIntoSlider();\n\t\tsaveButton?.setDisabled(true);\n\t}\n\n\t#enableSaveButtonIntoSlider()\n\t{\n\t\tconst saveButton = this.#getSaveButtonIntoSlider();\n\t\tsaveButton?.setDisabled(false);\n\t}\n\n\t#getSaveButtonIntoSlider(): any\n\t{\n\t\treturn this.#cache.get('saveButton');\n\t}\n\n\tdisableSelectedBlank(blankId: number): void\n\t{\n\t\tconst blank = this.#blanks.get(blankId);\n\n\t\tif (blank)\n\t\t{\n\t\t\tDom.addClass(blank.getLayout(), '--disabled');\n\t\t}\n\t}\n\n\tenableSelectedBlank(blankId: number): void\n\t{\n\t\tconst blank = this.#blanks.get(blankId);\n\n\t\tif (blank)\n\t\t{\n\t\t\tDom.removeClass(blank.getLayout(), '--disabled');\n\t\t}\n\t}\n\n\t#isAllFileUploadsComplete(files: Array<UploaderFile>): boolean\n\t{\n\t\tconst notUploadedFiles = files.filter((file) => {\n\t\t\treturn file.getStatus() !== FileStatus.COMPLETE || Type.isNull(file.getServerFileId());\n\t\t});\n\n\t\treturn notUploadedFiles.length === 0;\n\t}\n}\n"],"names":["ListItem","constructor","props","Tag","render","setProps","getLayout","setTitle","title","textContent","getProps","setDescription","description","modifier","Dom","create","attrs","className","children","Blank","hidden","Loader","size","target","layout","prepend","setAvatarWithDescription","userAvatarUrl","avatarIcon","lastElementChild","descriptionNode","select","addClass","deselect","removeClass","blur","remove","setId","id","dataset","setReady","isReady","show","tabIndex","hide","setPreview","previewUrl","firstElementChild","src","BlankField","EventEmitter","options","Cache","MemoryCache","setEventNamespace","subscribeFromOptions","events","blankId","data","Type","isStringFilled","isNumber","getBlankById","then","addTag","entityId","remember","renderTo","targetContainer","isDomNode","append","set","get","Api","BlankSelector","selectorOptions","toggleSelection","event","selected","getData","tagSelector","showAddButton","emit","getTags","length","onSliderClose","TagSelector","Text","getRandom","multiple","showTextBox","addButtonCaption","Loc","getMessage","tagMaxWidth","onAddButtonClick","openInSlider","hideTextBox","onAfterTagRemove","delete","uploaderOptions","controller","acceptedFileTypes","autoUpload","maxFileSize","maxFileCount","imageMaxFileSize","maxTotalFileSize","errorPopupOptions","padding","offsetLeft","offsetTop","angle","darkMode","width","autoHide","cacheable","bindOptions","position","config","Object","freeze","beforeAddFileSuccessfully","addFile","selectedBlankId","Map","uploadButtons","dragArea","widgetOptions","slots","afterDropArea","computed","methods","clear","clearFiles","removeFromServer","template","TileWidget","dropElement","browseElement","UploaderEvent","BEFORE_FILES_ADD","FILE_ADD","FILE_REMOVE","UPLOAD_START","Event","bind","document","selectBlank","Number","ctrlKey","metaKey","resetSelectedBlank","getUploadedFileName","fileIndex","uploader","getUploader","files","getFiles","file","at","getName","createBlankFromOuterUploaderFiles","errorMessage","UI","Notification","Center","notify","content","Error","firstFile","blank","filesIds","map","getServerFileId","blankData","createBlank","type","isTemplateMode","documentMode","userName","ex","console","log","getCustomData","getId","previousSelectedBlankId","getBlank","modifyBlankTitle","blankTitle","loadBlankById","hasBlank","has","eventExtraOptions","extra","deleteBlank","lastBlank","removeFiles","isFilesReadyForUpload","every","getErrors","canUploadNewBlank","selectorContainer","SidePanel","Reflection","getClass","isNil","Instance","open","onClose","contentCallback","Layout","createContent","extensions","buttons","cancelButton","SaveButton","text","onclick","close","disableSelectedBlank","enableSelectedBlank","addedFiles","isImage","getType","includes","allAddedImages","validExtension","getExtension","filesLength","imagesLimit","allExistImages","uploaderEvent","valid","selfEvent","BaseEvent","isDefaultPrevented","bindElement","hasClass","$refs","container","getRootComponent","errorPopup","Popup","preventDefault","isInteger","parseInt","fileId","uploadingBlank","setCustomData","shouldShow","hiddenClass","img","pdf","doc","entries","key","listItem","pendingFiles","setMaxParallelUploads","uploadPromise","Promise","resolve","subscribeOnce","start","page","loader","mode","blanksOnPage","loadBlanks","forEach","destroy","dateCreate","creationDate","Date","descriptionText","DateTimeFormat","format","acceptedType","find","fileType","endsWith","dotExtensionIndex","lastIndexOf","slice","button","saveButton","setDisabled","notUploadedFiles","filter","getStatus","FileStatus","COMPLETE","isNull"],"mappings":"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"}