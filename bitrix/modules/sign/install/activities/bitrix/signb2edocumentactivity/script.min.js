this.BX=this.BX||{};(function(e,s,t,l,a){"use strict";let i=e=>e,r;const o=s.Reflection.namespace("BX.Sign");const c={HEAD:"1",DEPUTY_HEAD:"3"};const b="#id_responsible";const n="#id_representative";const d="#id_reviewer";const v="#id_editor";var p=babelHelpers.classPrivateFieldLooseKey("buttonNode");var u=babelHelpers.classPrivateFieldLooseKey("select");var P=babelHelpers.classPrivateFieldLooseKey("documentType");var h=babelHelpers.classPrivateFieldLooseKey("formName");var L=babelHelpers.classPrivateFieldLooseKey("api");var f=babelHelpers.classPrivateFieldLooseKey("templateId");var F=babelHelpers.classPrivateFieldLooseKey("previousData");var H=babelHelpers.classPrivateFieldLooseKey("openSlider");var B=babelHelpers.classPrivateFieldLooseKey("onSliderClose");var y=babelHelpers.classPrivateFieldLooseKey("setTemplateList");var m=babelHelpers.classPrivateFieldLooseKey("setSelectorValues");var g=babelHelpers.classPrivateFieldLooseKey("getUserSelectorsMap");var S=babelHelpers.classPrivateFieldLooseKey("getDialog");var O=babelHelpers.classPrivateFieldLooseKey("getUserSelector");var j=babelHelpers.classPrivateFieldLooseKey("updateTemplateListSelect");var E=babelHelpers.classPrivateFieldLooseKey("updateTagSelectors");var K=babelHelpers.classPrivateFieldLooseKey("selectMembers");var T=babelHelpers.classPrivateFieldLooseKey("loadTemplatesList");class w extends t.EventEmitter{constructor(e){super();Object.defineProperty(this,T,{value:x});Object.defineProperty(this,K,{value:U});Object.defineProperty(this,E,{value:R});Object.defineProperty(this,j,{value:M});Object.defineProperty(this,O,{value:V});Object.defineProperty(this,S,{value:_});Object.defineProperty(this,g,{value:N});Object.defineProperty(this,m,{value:A});Object.defineProperty(this,y,{value:X});Object.defineProperty(this,B,{value:I});Object.defineProperty(this,H,{value:D});Object.defineProperty(this,p,{writable:true,value:null});Object.defineProperty(this,u,{writable:true,value:null});Object.defineProperty(this,P,{writable:true,value:[]});Object.defineProperty(this,h,{writable:true,value:void 0});Object.defineProperty(this,L,{writable:true,value:void 0});Object.defineProperty(this,f,{writable:true,value:void 0});Object.defineProperty(this,F,{writable:true,value:{}});this.setEventNamespace("BX.Sign.SignB2EDocumentActivity");babelHelpers.classPrivateFieldLooseBase(this,p)[p]=e.buttonNode;babelHelpers.classPrivateFieldLooseBase(this,P)[P]=e.documentType;babelHelpers.classPrivateFieldLooseBase(this,u)[u]=e.select;babelHelpers.classPrivateFieldLooseBase(this,L)[L]=new l.Api;babelHelpers.classPrivateFieldLooseBase(this,f)[f]=e.templateId;if(!s.Type.isStringFilled(e.formName)){throw new Error("formName must be filled string")}babelHelpers.classPrivateFieldLooseBase(this,h)[h]=e.formName}init(){babelHelpers.classPrivateFieldLooseBase(this,y)[y]();if(!babelHelpers.classPrivateFieldLooseBase(this,p)[p]){return}s.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,p)[p],"click",babelHelpers.classPrivateFieldLooseBase(this,H)[H].bind(this))}}function D(){BX.SidePanel.Instance.open("/sign/b2e/doc/0/?mode=template&IFRAME=Y&IFRAME_TYPE=SIDE_SLIDER&FROM_ROBOT=1",{width:1250,cacheable:false,events:{onClose:e=>{babelHelpers.classPrivateFieldLooseBase(this,B)[B](e)}}})}async function I(e){const s=e.getSlider();if(s){babelHelpers.classPrivateFieldLooseBase(this,y)[y](true,true)}}function X(e=false,t=false){babelHelpers.classPrivateFieldLooseBase(this,T)[T]().then((({data:l})=>{if(s.Type.isPlainObject(l)){babelHelpers.classPrivateFieldLooseBase(this,j)[j](l,t);Object.entries(babelHelpers.classPrivateFieldLooseBase(this,g)[g]()).forEach((([e,s])=>{const t=babelHelpers.classPrivateFieldLooseBase(this,S)[S](s);if(t===null){return}t.subscribe("onLoad",(()=>{var t;const a=babelHelpers.classPrivateFieldLooseBase(this,f)[f]===""?0:babelHelpers.classPrivateFieldLooseBase(this,f)[f];const i=(t=Object.values(l)[a])==null?void 0:t[`${e}SelectorValue`];if(i){babelHelpers.classPrivateFieldLooseBase(this,m)[m]([i],s)}}));t.load()}));if(e===true){babelHelpers.classPrivateFieldLooseBase(this,E)[E](l)}babelHelpers.classPrivateFieldLooseBase(this,u)[u].onchange=()=>{babelHelpers.classPrivateFieldLooseBase(this,E)[E](l)}}})).catch((e=>console.error(e.errors)))}function A(e,t){const l=babelHelpers.classPrivateFieldLooseBase(this,S)[S](t);if(l===null){return}l.getSelectedItems().forEach((e=>{e.deselect()}));e.forEach((e=>{let t=null;const a=c[e];if(a!==undefined){t=l.getItem([a,e])}else if(s.Type.isInteger(Number(e))){t=l.getItem(["user",e])}if(t){t.select()}}))}function N(){return{responsible:b,assignee:n,reviewer:d,editor:v}}function _(e){const s=babelHelpers.classPrivateFieldLooseBase(this,O)[O](e);if(!s){return null}return s.tagSelector.getDialog()}function V(e){return BX.Bizproc.UserSelector.getByNode(document.querySelector(e))}function M(e,t){if(babelHelpers.classPrivateFieldLooseBase(this,F)[F]&&t){const s=Object.keys(babelHelpers.classPrivateFieldLooseBase(this,F)[F])[0];const t=Object.keys(e)[0];if(s!==t){babelHelpers.classPrivateFieldLooseBase(this,f)[f]=t}}if(babelHelpers.classPrivateFieldLooseBase(this,u)[u]){babelHelpers.classPrivateFieldLooseBase(this,u)[u].innerHTML=""}Object.entries(e).forEach((([e,{title:t}])=>{const l=babelHelpers.classPrivateFieldLooseBase(this,f)[f]===e?"selected":"";const a=s.Text.encode(e);const o=s.Text.encode(t);const c=s.Tag.render(r||(r=i`<option value="${0}" ${0}>${0}</option>`),a,l,o);s.Dom.append(c,babelHelpers.classPrivateFieldLooseBase(this,u)[u])}));babelHelpers.classPrivateFieldLooseBase(this,F)[F]={...e}}function R(e){const s=babelHelpers.classPrivateFieldLooseBase(this,u)[u].value;if(!(s in e)){return}const t=e[s];if(t){babelHelpers.classPrivateFieldLooseBase(this,K)[K](t)}}function U(e){if(e){babelHelpers.classPrivateFieldLooseBase(this,m)[m]([e.responsibleSelectorValue],b);babelHelpers.classPrivateFieldLooseBase(this,m)[m]([e.assigneeSelectorValue],n);babelHelpers.classPrivateFieldLooseBase(this,m)[m](e.reviewerSelectorValue,d);babelHelpers.classPrivateFieldLooseBase(this,m)[m]([e.editorSelectorValue],v)}}function x(){return s.ajax.runAction("bizproc.activity.request",{data:{activity:"SignB2EDocumentActivity",documentType:babelHelpers.classPrivateFieldLooseBase(this,P)[P],params:{form_name:babelHelpers.classPrivateFieldLooseBase(this,h)[h]}}})}o.SignB2EDocumentActivity=w;e.SignB2EDocumentActivity=w})(this.BX.Sign=this.BX.Sign||{},BX,BX.Event,BX.Sign.V2,BX.UI.FormElements);
//# sourceMappingURL=script.map.js