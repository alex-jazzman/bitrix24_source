this.BX=this.BX||{};(function(t,e,s,a,i,r,n,l,o,c,d,u,m,p,v,h,g){"use strict";const _={props:{text:String,maxTextLength:Number,minTextLength:{type:Number,required:false,default:5},placeholder:String},emits:["update:text"],computed:{textLength(){var t;return((t=this.text)==null?void 0:t.length)||0}},methods:{handleInput(t){this.$emit("update:text",t.target.value)}},mounted(){requestAnimationFrame((()=>{this.$refs.textField.focus()}))},template:`\n\t\t<div class="ai__role-master_editor ui-ctl-textarea">\n\t\t\t<textarea\n\t\t\t\tref="textField"\n\t\t\t\t:value="text"\n\t\t\t\t:maxlength="maxTextLength"\n\t\t\t\t:minlength="minTextLength"\n\t\t\t\t:placeholder="placeholder"\n\t\t\t\t@input="handleInput"\n\t\t\t\tclass="ai__role-master_editor-text-field ui-ctl-element"\n\t\t\t></textarea>\n\t\t\t<div class="ai__role-master_editor-character-counter">\n\t\t\t\t{{ textLength }}/{{ maxTextLength }}\n\t\t\t</div>\n\t\t</div>\n\t`};const S={props:{current:Number},computed:{total(){return 2}},methods:{getProgressStepClassname(t){return{"ai__role-master_progress-step":true,"--active":t}}},template:`\n\t\t<div class="ai__role-master_progress">\n\t\t\t<span\n\t\t\t\tv-for="index in total"\n\t\t\t\t:class="getProgressStepClassname(index <= current)"\n\t\t\t>\n\t\t\t</span>\n\t\t</div>\n\t`};const E={props:{text:String},computed:{alertHtmlString(){const t=new s.Alert({inline:true,text:this.text,color:s.Alert.Color.WARNING,animated:false,icon:s.Alert.Icon.INFO,size:s.Alert.Size.XS,closeBtn:false});t.show();return t.render().outerHTML}},template:`\n\t\t<div v-html="alertHtmlString"></div>\n\t`};const I={name:"RoleMasterStep",components:{RoleMasterProgress:S,RoleMasterWarning:E,Hint:e.Hint},props:{title:String,titleHint:String,stepNumber:Number,warningText:String},template:`\n\t\t<div class="ai__role-master_step">\n\t\t\t<div class="ai__role-master_step-header">\n\t\t\t\t<div class="ai__role-master_step-title-with-hint">\n\t\t\t\t\t<h4 class="ai__role-master_step-title">{{ title }}</h4>\n\t\t\t\t\t<span v-if="titleHint" class="ai__role-master_step-title-hint">\n\t\t\t\t\t\t<Hint :text="titleHint"></Hint>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="ai__role-master_step-progress">\n\t\t\t\t\t<RoleMasterProgress\n\t\t\t\t\t\t:current="stepNumber"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div v-if="warningText" class="ai__role-master_step-warning">\n\t\t\t\t\t<RoleMasterWarning :text="warningText" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="ai__role-master_step-content">\n\t\t\t\t<slot></slot>\n\t\t\t</div>\n\t\t</div>\n\t`};const b={props:{roleText:String,stepNumber:Number,maxTextLength:Number,minTextLength:Number,warningText:String},components:{RoleMasterStep:I,RoleMasterEditor:_},methods:{handleRoleTextUpdate(t){this.$emit("update:role-text",t)}},template:`\n\t\t<RoleMasterStep\n\t\t\t:title="$Bitrix.Loc.getMessage('ROLE_MASTER_ROLE_TEXT_STEP_TITLE')"\n\t\t\t:title-hint="$Bitrix.Loc.getMessage('ROLE_MASTER_ROLE_TEXT_STEP_TITLE_HINT')"\n\t\t\t:warningText="warningText"\n\t\t\t:step-number="stepNumber"\n\t\t>\n\t\t\t<slot>\n\t\t\t\t<RoleMasterEditor\n\t\t\t\t\t:text="roleText"\n\t\t\t\t\t@update:text="handleRoleTextUpdate"\n\t\t\t\t\t:max-text-length="maxTextLength"\n\t\t\t\t\t:min-text-length="minTextLength"\n\t\t\t\t\t:placeholder="$Bitrix.Loc.getMessage('ROLE_MASTER_ROLE_TEXT_FIELD_PLACEHOLDER')"\n\t\t\t\t></RoleMasterEditor>\n\t\t\t</slot>\n\t\t</RoleMasterStep>\n\t`};const f={props:{text:String,state:{type:String,required:false,default:null},color:{type:String,required:false,default:d.Button.Color.AI}},computed:{buttonOuterHtmlString(){const t=new d.Button({text:this.text,state:this.state,color:this.color,round:true});return t.render().outerHTML},ButtonState(){return d.ButtonState}},methods:{handleClick(t){if(this.state===d.ButtonState.DISABLED){t.preventDefault();t.stopImmediatePropagation();return false}return true}},template:'<div @click="handleClick" v-html="buttonOuterHtmlString"></div>'};const A={name:"RoleMasterAvatarUploader",components:{BIcon:u.BIcon},props:{avatarUrl:""},emits:["uploadAvatarFile","removeAvatarFile","selectAvatar","generateAvatar"],data(){return{uploader:null,isDraggingFile:false}},computed:{avatarUploaderStyle(){return{backgroundImage:this.avatarUrl?`url(${this.avatarUrl})`:null}},IconSet(){return u.Set}},methods:{handleDragElementEnterDocument(){this.isDraggingFile=true},handleDragElementLeaveDocument(t){if(t.relatedTarget===null){this.isDraggingFile=false}},handleDropFile(){this.isDraggingFile=false},handleDragOverFile(t){t.preventDefault()},showNotification(t){const e=String(Math.random()*1e3);r.UI.Notification.Center.notify({id:e,content:t})},removeUploadedFile(){const t=this.uploader.getFiles();if(t.length>0){v.toRaw(this.uploader).removeFiles();this.$emit("removeAvatarFile")}this.$refs.uploaderContainer.click()}},mounted(){this.uploader=new i.Uploader({dropElement:this.$refs.dropArea,browseElement:this.$refs.uploaderContainer,assignServerFile:false,allowReplaceSingle:true,assignAsFile:true,acceptOnlyImages:true,acceptedFileTypes:["image/jpeg","image/png"],maxFileSize:1048076,multiple:false,events:{[i.UploaderEvent.FILE_LOAD_COMPLETE]:t=>{this.uploadedFile=t.getData().file;this.$emit("uploadAvatarFile",t.getData().file);this.$refs.uploaderContainer.blur()},[i.UploaderEvent.FILE_ERROR]:t=>{const e=t.getData().error;this.showNotification(e.getMessage());this.$refs.uploaderContainer.blur()},[i.UploaderEvent.FILE_REMOVE]:()=>{this.$emit("removeAvatarFile");this.$refs.uploaderContainer.blur()}}});h.bind(document,"dragenter",this.handleDragElementEnterDocument);h.bind(document,"dragleave",this.handleDragElementLeaveDocument);h.bind(document,"drop",this.handleDropFile);h.bind(document,"dragover",this.handleDragOverFile)},unmounted(){h.unbind(document,"dragenter",this.handleDragElementEnterDocument);h.unbind(document,"dragleave",this.handleDragElementLeaveDocument);h.unbind(document,"drop",this.handleDropFile);h.unbind(document,"dragover",this.handleDragOverFile)},template:`\n\t\t<div\n\t\t\tclass="ai__role-master_avatar-uploader-wrapper"\n\t\t\t:style="avatarUploaderStyle"\n\t\t>\n\t\t\t<div\n\t\t\t\tv-show="!avatarUrl"\n\t\t\t\tref="uploaderContainer"\n\t\t\t\tclass="ai__role-master_avatar-uploader"\n\t\t\t\t:tabindex="0"\n\t\t\t\t@keyup.enter="$event.target.click()"\n\t\t\t>\n\t\t\t\t<div class="ai__role-master_avatar-uploader-icon">\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\tv-if="!avatarUrl"\n\t\t\t\t\t\t:size="28"\n\t\t\t\t\t\t:name="IconSet.CAMERA"\n\t\t\t\t\t></BIcon>\n\t\t\t\t</div>\n\t\t\t\t<div class="ai__role-master_avatar-uploader-hover">\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\tv-if="isDraggingFile === false"\n\t\t\t\t\t\t:size="24"\n\t\t\t\t\t\t:name="IconSet.EDIT_PENCIL"\n\t\t\t\t\t></BIcon>\n\t\t\t\t</div>\n\t\t\t\t<teleport to=".ai__role-master-app-container main">\n\t\t\t\t\t<transition name="ai-role-master-drop-area-fade">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tref="dropArea"\n\t\t\t\t\t\t\tv-show="isDraggingFile"\n\t\t\t\t\t\t\tclass="ai__role-master_avatar-uploader-drop-area"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class="ai__role-master_avatar-uploader-drop-area-icon">\n\t\t\t\t\t\t\t\t<BIcon\n\t\t\t\t\t\t\t\t\t:size="64"\n\t\t\t\t\t\t\t\t\t:name="IconSet.FILE_UPLOAD"\n\t\t\t\t\t\t\t\t></BIcon>\n\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<span class="ai__role-master_avatar-uploader-drop-area-text">\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('ROLE_MASTER_FILE_DROPAREA_TEXT') }}\n\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</transition>\n\t\t\t\t</teleport>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tclass="ai__role-master_avatar-uploader"\n\t\t\t\tv-if="isDraggingFile === false && avatarUrl"\n\t\t\t\t@click="removeUploadedFile"\n\t\t\t>\n\t\t\t\t<div class="ai__role-master_avatar-uploader-hover">\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\t:size="24"\n\t\t\t\t\t\t:name="IconSet.EDIT_PENCIL"\n\t\t\t\t\t></BIcon>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const R={beforeMount(t,e){let s=null;let a=false;const i=()=>{var t;(t=s)==null?void 0:t.destroy();s=null;a=false};h.Event.bind(t,"mouseenter",(()=>{if(s===null){s=L(t,e.value);s.show();h.Event.bind(s.getPopupContainer(),"mouseenter",(()=>{a=true}))}}));h.Event.bind(t,"mouseleave",(()=>{var e;const r=(e=s)==null?void 0:e.getPopupContainer();setTimeout((()=>{if(a){h.bind(r,"mouseleave",(e=>{if(t.contains(e.relatedTarget)===false){i()}}))}else{i()}}),100)}))}};function L(t,e){const s=h.Dom.getPosition(t);return new g.Popup({bindElement:{top:s.top+10,left:s.left+s.width/2},className:"ai__role-master_hint-popup",darkMode:true,content:e,maxWidth:266,maxHeight:300,animation:"fading-slide",angle:true,bindOptions:{position:"top"}})}const x={directives:{clickableHint:R},events:["update:selected-items"],props:{selectedItems:{type:Array,required:false,default:()=>[]},maxCirclesInInput:{type:Number,required:false,default:8},undeselectedItems:{type:Array,required:false,default:()=>[]}},data(){return{etcItemHint:null,cursorOnEtcItem:false,selectedItemsWithData:[],dataIsLoaded:false}},computed:{preselectedItems(){return this.typedSelectedItems.map((t=>t))},typedSelectedItems(){return this.selectedItems},etcItemHintContent(){const t=this.selectedItemsWithData.slice(this.maxCirclesInInput).map((t=>this.getEncodedString(t.title)));const e=t.join("<br>");return`<div>${e}</div>`},etcSelectedItemsCount(){return this.selectedItems.slice(this.maxCirclesInInput).length},etcSelectedItemsCircleNumber(){return this.etcSelectedItemsCount<100?this.etcSelectedItemsCount:99}},methods:{updateSelectedItemsWithData(){const t=this.getUserSelectorDialog().getSelectedItems();if(t.length===this.selectedItemsWithData.length){return}this.selectedItemsWithData=t.map((t=>this.getSelectedItemsWithDataFromDialogItem(t)))},getSelectedItemsWithDataFromDialogItem(t){return{id:t.id,avatar:t.avatar,entityId:t.entityId,title:t.title.text}},getUserSelectorDialog(){const t=l.Dialog.getById("ai-role-master-user-selector");if(t){t.setTargetNode(this.$refs.userSelector);return t}return new l.Dialog({id:"ai-role-master-user-selector",targetNode:this.$refs.userSelector,width:400,height:300,dropdownMode:false,showAvatars:true,compactView:true,multiple:true,preload:true,enableSearch:true,entities:[{id:"user",options:{inviteEmployeeLink:false}},{id:"department",options:{selectMode:"usersAndDepartments"}},{id:"meta-user",options:{"all-users":true}},{id:"project"}],preselectedItems:this.preselectedItems,undeselectedItems:this.undeselectedItems,events:{"Item:onSelect":t=>{this.selectItem(t.getData().item)},"Item:onDeselect":t=>{this.deselectItem(t.getData().item)},onLoad:()=>{this.dataIsLoaded=true;this.updateSelectedItemsWithData()},onHide:()=>{this.$refs.addBtn.focus()}}})},showUserSelector(){const t=this.getUserSelectorDialog();t.show()},selectItem(t){this.$emit("update:selected-items",this.getDialogSelectedItems())},deselectItem(t){this.$emit("update:selected-items",this.getDialogSelectedItems())},getDialogSelectedItems(){return this.getUserSelectorDialog().getSelectedItems().map((t=>[t.entityId,t.getId()]))},getSelectedItemStyle(t,e){const s=`url('${this.getAvatarFromItem(t)}')`;return{backgroundImage:s,left:`${e>0?24*e:0}px`}},getAvatarFromItem(t){if(t.avatar){return t.avatar}if(t.entityId==="user"){return"/bitrix/js/socialnetwork/entity-selector/src/images/default-user.svg"}if(t.entityId==="meta-user"){return"/bitrix/js/socialnetwork/entity-selector/src/images/meta-user-all.svg"}return""},getDepartmentFirstLetter(t){return t.split(" ")[0][0].toUpperCase()},showEtcItemsHint(){this.cursorOnEtcItem=true;if(this.etcItemHint){return}this.etcItemHint=new g.Popup({bindElement:this.$refs.etcItem,darkMode:true,content:this.etcItemHintContent,autoHide:true,maxHeight:300,bindOptions:{position:"top"},animation:"fading-slide",angle:true});this.etcItemHint.setOffset({offsetTop:-10,offsetLeft:16});this.etcItemHint.show()},closeEtcItemsHint(){this.cursorOnEtcItem=false;setTimeout((()=>{const t=document.querySelectorAll(":hover");const e=t[t.length-1];const s=this.etcItemHint.getPopupContainer();const a=s.contains(e);if(a===false){this.destroyEtcItemsHint();return}h.bind(s,"mouseleave",(()=>{setTimeout((()=>{if(this.cursorOnEtcItem===false){this.destroyEtcItemsHint()}}),100)}))}),100)},destroyEtcItemsHint(){var t;(t=this.etcItemHint)==null?void 0:t.destroy();this.etcItemHint=null},getEncodedString(t){return h.Text.encode(t)}},watch:{"selectedItems.length":function(){this.updateSelectedItemsWithData()}},mounted(){this.updateSelectedItemsWithData()},unmounted(){this.getUserSelectorDialog().destroy()},template:`\n\t\t<div class="ai__role-master_user-selector">\n\t\t\t<div class="ui-ctl ui-ctl-textbox ui-ctl-w100">\n\t\t\t\t<div\n\t\t\t\t\ttype="text"\n\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t>\n\t\t\t\t\t<div ref="userSelector" class="ai__role-master_user-selector_inner">\n\t\t\t\t\t\t<ul class="ai__role-master-user-selector_users">\n\t\t\t\t\t\t\t<li\n\t\t\t\t\t\t\t\tv-for="(item, index) in selectedItemsWithData.slice(0, maxCirclesInInput)"\n\t\t\t\t\t\t\t\t:style="getSelectedItemStyle(item, index)"\n\t\t\t\t\t\t\t\tv-clickable-hint="getEncodedString(item.title)"\n\t\t\t\t\t\t\t\tclass="ai__role-master-user-selector_user"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span v-if="item.entityId === 'department'">\n\t\t\t\t\t\t\t\t\t{{ getDepartmentFirstLetter(item.title) }}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li\n\t\t\t\t\t\t\t\tv-if="etcSelectedItemsCount > 0"\n\t\t\t\t\t\t\t\tref="etcItem"\n\t\t\t\t\t\t\t\tclass="ai__role-master-user-selector_etc-item"\n\t\t\t\t\t\t\t\t@mouseenter="showEtcItemsHint"\n\t\t\t\t\t\t\t\t@mouseleave="closeEtcItemsHint"\n\t\t\t\t\t\t\t\t:style="{left: 24 * this.maxCirclesInInput - 8 + 'px'}"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span class="ai__role-master-user-selector_etc-item-plus">+</span>\n\t\t\t\t\t\t\t\t<span>{{ etcSelectedItemsCircleNumber }}</span>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t<button ref="addBtn" @click="showUserSelector" class="ai__role-master-user-selector_add">\n\t\t\t\t\t\t\t<span class="ai__role-master-user-selector_add-text">\n\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('ROLE_MASTER_USER_SELECTOR_ADD_BTN') }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if="getUserSelectorDialog().getItems().length === 99999" class="ai__role-master_user-selector-loader">\n\t\t\t\t<div class="ui-ctl ui-ctl-textbox ui-ctl-w100">\n\t\t\t\t\t<div\n\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="ai__role-master_user-selector_inner">\n\t\t\t\t\t\t\t<ul class="ai__role-master-user-selector_users">\n\t\t\t\t\t\t\t\t<li\n\t\t\t\t\t\t\t\t\tv-for="(item, index) in selectedItems.slice(0, maxCirclesInInput)"\n\t\t\t\t\t\t\t\t\t:style="getSelectedItemStyle(item, index)"\n\t\t\t\t\t\t\t\t\tclass="ai__role-master-user-selector_user"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span v-if="item.entityId === 'department'">\n\t\t\t\t\t\t\t\t\t{{ getDepartmentFirstLetter(item.title) }}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t<li\n\t\t\t\t\t\t\t\t\tv-if="etcSelectedItemsCount > 0"\n\t\t\t\t\t\t\t\t\tclass="ai__role-master-user-selector_etc-item"\n\t\t\t\t\t\t\t\t\t:style="{left: 24 * this.maxCirclesInInput - 8 + 'px'}"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<span class="ai__role-master-user-selector_etc-item-plus">+</span>\n\t\t\t\t\t\t\t\t\t<span>{{ etcSelectedItemsCircleNumber }}</span>\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const T={components:{RoleMasterStep:I,RoleMasterUserSelector:x,RoleMasterAvatarUploader:A,RoleMasterEditor:_},emits:["uploadAvatarFile","removeAvatarFile","update:name","update:description","update:items-with-access"],props:{stepNumber:Number,avatar:String,name:String,description:String,itemsWithAccess:{type:Array,required:false,default:()=>[]},undeselectedItemsWithAccess:{type:Array,required:false,default:()=>[]}},methods:{handleAvatarFileUpload(t){this.$emit("uploadAvatarFile",t)},handleAvatarFileRemove(){this.$emit("removeAvatarFile")},handleAvatarFileLoad(t){this.$emit("loadAvatarFile",t)}},mounted(){requestAnimationFrame((()=>{this.$refs.roleNameInput.focus()}))},template:`\n\t\t<RoleMasterStep\n\t\t\t:title="$Bitrix.Loc.getMessage('ROLE_MASTER_ROLE_MAIN_STEP_TITLE')"\n\t\t\t:step-number="stepNumber"\n\t\t>\n\t\t\t<slot>\n\t\t\t\t<div class="ai__role-master_main-step">\n\t\t\t\t\t<div class="ui-form">\n\t\t\t\t\t\t<div class="ui-form-row-inline">\n\t\t\t\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t\t\t\t<div class="ui-form-label">\n\t\t\t\t\t\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('ROLE_MASTER_ROLE_AVATAR_AND_NAME_FIELD') }}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t\t\t\t\t<div class="ui-ctl">\n\t\t\t\t\t\t\t\t\t\t<RoleMasterAvatarUploader\n\t\t\t\t\t\t\t\t\t\t\t:avatar-url="avatar"\n\t\t\t\t\t\t\t\t\t\t\t@upload-avatar-file="handleAvatarFileUpload"\n\t\t\t\t\t\t\t\t\t\t\t@remove-avatar-file="handleAvatarFileRemove"\n\t\t\t\t\t\t\t\t\t\t\t@load-avatar-file="handleAvatarFileLoad"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="ui-ctl ui-ctl-textbox ui-ctl-w100">\n\t\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\t\tref="roleNameInput"\n\t\t\t\t\t\t\t\t\t\t\t:value="name"\n\t\t\t\t\t\t\t\t\t\t\t@input="$emit('update:name', $event.target.value)"\n\t\t\t\t\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\t\t\t\t\t:minlength="1"\n\t\t\t\t\t\t\t\t\t\t\t:maxlength="70"\n\t\t\t\t\t\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t\t\t\t\t\t:placeholder="$Bitrix.Loc.getMessage('ROLE_MASTER_ROLE_AVATAR_AND_NAME_FIELD_PLACEHOLDER')"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="ui-form-row">\n\t\t\t\t\t\t\t<div class="ui-form-label">\n\t\t\t\t\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('ROLE_MASTER_ROLE_USERS_WITH_ACCESS_FIELD') }}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t\t\t\t<div class="ui-ctl ui-ctl-textbox ui-ctl-w100">\n\t\t\t\t\t\t\t\t\t<RoleMasterUserSelector\n\t\t\t\t\t\t\t\t\t\t:selected-items="itemsWithAccess"\n\t\t\t\t\t\t\t\t\t\t:undeselected-items="undeselectedItemsWithAccess"\n\t\t\t\t\t\t\t\t\t\t@update:selected-items="items => $emit('update:items-with-access', items)"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="ui-form-row --with-textarea">\n\t\t\t\t\t\t\t<div class="ui-form-label">\n\t\t\t\t\t\t\t\t<div class="ui-ctl-label-text">\n\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('ROLE_MASTER_ROLE_DESCRIPTION_FIELD') }}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t\t\t\t<div class="ui-ctl ui-ctl-textarea ui-ctl-w100 ui-ctl-no-resize">\n\t\t\t\t\t\t\t\t\t<RoleMasterEditor\n\t\t\t\t\t\t\t\t\t\t:min-text-length="0"\n\t\t\t\t\t\t\t\t\t\t:max-text-length="150"\n\t\t\t\t\t\t\t\t\t\t:text="description"\n\t\t\t\t\t\t\t\t\t\t:placeholder="$Bitrix.Loc.getMessage('ROLE_MASTER_ROLE_DESCRIPTION_FIELD_PLACEHOLDER')"\n\t\t\t\t\t\t\t\t\t\t@update:text="$emit('update:description', $event)"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</slot>\n\t\t</RoleMasterStep>\n\t`};const B={props:{status:String},emits:["repeat-request","back-to-editor","close-master"],components:{BIcon:u.BIcon,RoleMasterBtn:f},computed:{savingStatus(){return F},IconSet(){return u.Set},ButtonColor(){return d.ButtonColor}},methods:{showLoader(){var t;const e=new o.Loader({size:80,color:(t=getComputedStyle(document.body).getPropertyValue("--ui-color-copilot-primary"))!=null?t:"#8e52ec",strokeWidth:4});e.show(this.$refs.loaderContainer)}},mounted(){if(this.status===F.SAVING){this.showLoader()}},updated(){if(this.status===F.SAVING){this.showLoader()}},template:`\n\t\t<div class="ai__role-master_saving-status">\n\t\t\t<div v-if="status === savingStatus.SAVING" class="ai__role-master_saving-loading">\n\t\t\t\t<div ref="loaderContainer" class="ai__role-master_saving-loader"></div>\n\t\t\t\t<div class="ai__role-master_saving-loading-text">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('ROLE_MASTER_LOADER_TEXT') }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-else-if="status === savingStatus.SAVING_SUCCESS" class="ai__role-master_saving-success">\n\t\t\t\t<div class="ai__role-master_saving-success-top">\n\t\t\t\t\t<div class="ai__role-master_saving-success-icon">\n\t\t\t\t\t\t<BIcon\n\t\t\t\t\t\t\t:name="IconSet.CHECK"\n\t\t\t\t\t\t\t:size="58"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="ai__role-master_saving-success-text">\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('ROLE_MASTER_SAVING_DONE') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="ai__role-master_saving-success-bottom">\n\t\t\t\t\t<RoleMasterBtn\n\t\t\t\t\t\t@click="$emit('close-master')"\n\t\t\t\t\t\t:text="$Bitrix.Loc.getMessage('ROLE_MASTER_CLOSE_BTN')"\n\t\t\t\t\t\t:color="ButtonColor.LIGHT_BORDER"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-else-if="status === savingStatus.SAVING_ERROR" class="ai__role-master_saving-error">\n\t\t\t\t<div class="ai__role-master_saving-error-center">\n\t\t\t\t\t<div class="ai__role-master_saving-error-icon">\n\t\t\t\t\t\t<BIcon\n\t\t\t\t\t\t\t:name="IconSet.NOTE_CIRCLE"\n\t\t\t\t\t\t\t:size="66"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="ai__role-master_saving-error-status-text">\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('ROLE_MASTER_SAVE_PROMPT_ON_ERROR_SHORT_TEXT') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<RoleMasterBtn\n\t\t\t\t\t\t@click="$emit('repeat-request')"\n\t\t\t\t\t\t:text="$Bitrix.Loc.getMessage('ROLE_MASTER_REPEAT_REQUEST_BTN')"\n\t\t\t\t\t\t:color="ButtonColor.LIGHT_BORDER"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class="ai__role-master_saving-error-bottom">\n\t\t\t\t\t<p class="ai__role-master_saving-error-description-text">\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('ROLE_MASTER_SAVE_PROMPT_ON_ERROR_TEXT') }}\n\t\t\t\t\t</p>\n\t\t\t\t\t<button\n\t\t\t\t\t\t@click="$emit('back-to-editor')"\n\t\t\t\t\t\tclass="ai__role-master_back-to-editor-btn"\n\t\t\t\t\t>\n\t\t\t\t\t\t<BIcon\n\t\t\t\t\t\t\t:size="16"\n\t\t\t\t\t\t\t:name="IconSet.CHEVRON_LEFT"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<span class="ai__role-master_back-to-editor-btn-text">\n\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('ROLE_MASTER_BACK_TO_EDITOR_BTN') }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const M=h.Extension.getSettings("ai.role-master").get("currentUserId");const F=Object.freeze({NONE:"none",SAVING:"saving",SAVING_ERROR:"saving-error",SAVING_SUCCESS:"saving-success"});const O={name:"RoleMaster",components:{RoleMasterTextStep:b,RoleMasterMainStep:T,RoleMasterSavingStatus:B,RoleMasterBtn:f,RoleMasterWarning:E,BIcon:u.BIcon},props:{id:{type:String,required:false,default:""},authorId:String,text:String,name:String,avatar:String,description:String,avatarUrl:String,itemsWithAccess:{type:Array,required:false,default:()=>[]}},data(){return{currentStepNumber:1,roleText:this.text,roleName:this.name,roleAvatar:this.avatar,roleAvatarUrl:this.avatarUrl,roleDescription:this.description,roleItemsWithAccess:this.itemsWithAccess.length>0?this.itemsWithAccess:[["user",M]],uploadedAvatarFile:null,roleSavingStatus:F.NONE}},computed:{isEditRoleMode(){return this.id},maxTextLength(){return 2e3},minTextLength(){return 1},isEditMode(){return false},uploadedAvatarFilePreview(){var t,e;return(t=(e=this.uploadedAvatarFile)==null?void 0:e.getPreviewUrl())!=null?t:null},RoleSavingStatus(){return F},ButtonState(){return d.ButtonState},isRoleTextValid(){return this.roleText.length>=this.minTextLength&&this.roleText.length<=this.maxTextLength},isRoleNameValid(){return this.roleName.length>0&&this.roleName.length<=70},isRoleDescriptionValid(){return this.roleDescription.length>0&&this.roleDescription.length<=150},isRoleDataValid(){return this.isRoleTextValid&&this.isRoleNameValid&&this.isRoleDescriptionValid&&this.roleItemsWithAccess.length>0},nextStepBtnState(){return this.isRoleTextValid?"":this.ButtonState.DISABLED},saveBtnState(){if(this.isRoleDataValid===false){return d.ButtonState.DISABLED}if(this.roleSavingStatus===F.SAVING){return d.ButtonState.CLOCKING}return""},backIconProps(){return{size:16,icon:m.Actions.CHEVRON_LEFT}},warningText(){return this.isEditRoleMode&&this.itemsWithAccess.length>1?this.$Bitrix.Loc.getMessage("ROLE_MASTER_EDIT_WARNING_TEXT"):""},undeselectedItemsWithAccess(){if(this.isEditRoleMode){return[["user",this.authorId]]}return[["user",M]]}},methods:{async saveRole(){const t=this.isEditRoleMode?"change":"create";let e=false;try{setTimeout((()=>{if(e===false){this.roleSavingStatus=F.SAVING}}),100);const s=await this.getAvatarFile();const a={roleText:this.roleText,roleTitle:this.roleName,roleAvatar:s,roleDescription:this.roleDescription,accessCodes:this.roleItemsWithAccess};if(t==="change"){a.roleCode=this.id}await h.ajax.runAction(`ai.shareRole.${t}`,{data:h.Http.Data.convertObjectToFormData(a)});this.roleSavingStatus=F.SAVING_SUCCESS;n.EventEmitter.emit("AI.RoleMasterApp:Save-success",a)}catch(t){console.error(t);this.roleSavingStatus=F.SAVING_ERROR;n.EventEmitter.emit("AI.RoleMasterApp:Save-failed")}finally{e=true}},async getAvatarFile(){if(!this.uploadedAvatarFile){return null}return this.uploadedAvatarFile.getBinary()},handleAvatarFileUpload(t){this.uploadedAvatarFile=t},handleAvatarFileRemove(){this.uploadedAvatarFile=null;this.roleAvatar=null},handleAvatarFileLoad(t){this.uploadedAvatarFile=v.toRaw(t)},closeMaster(){n.EventEmitter.emit("AI.RoleMasterApp:Close")},backToEditor(){this.roleSavingStatus=F.NONE},openHelpdeskSlider(){const t="23184474";const e=h.Reflection.getClass("top.BX.Helper");if(e){e.show(`redirect=detail&code=${t}`)}}},template:`\n\t\t<div>\n\t\t\t<header></header>\n\t\t\t<main>\n\t\t\t\t<RoleMasterTextStep\n\t\t\t\t\tv-if="currentStepNumber === 1"\n\t\t\t\t\t:step-number="1"\n\t\t\t\t\t:role-text="roleText"\n\t\t\t\t\t:warning-text="warningText"\n\t\t\t\t\t@update:role-text="roleText = $event"\n\t\t\t\t\t:max-text-length="maxTextLength"\n\t\t\t\t\t:min-text-length="minTextLength"\n\t\t\t\t/>\n\t\t\t\t<RoleMasterMainStep\n\t\t\t\t\tv-if="currentStepNumber === 2"\n\t\t\t\t\t:step-number="2"\n\t\t\t\t\t:name="roleName"\n\t\t\t\t\t:description="roleDescription"\n\t\t\t\t\t:avatar="uploadedAvatarFilePreview || roleAvatarUrl"\n\t\t\t\t\t:items-with-access="roleItemsWithAccess"\n\t\t\t\t\t:undeselected-items-with-access="undeselectedItemsWithAccess"\n\t\t\t\t\t@upload-avatar-file="handleAvatarFileUpload"\n\t\t\t\t\t@remove-avatar-file="handleAvatarFileRemove"\n\t\t\t\t\t@load-avatar-file="handleAvatarFileLoad"\n\t\t\t\t\t@update:name="roleName = $event"\n\t\t\t\t\t@update:description="roleDescription = $event"\n\t\t\t\t\t@update:avatar="roleAvatar = $event"\n\t\t\t\t\t@update:items-with-access="roleItemsWithAccess = $event"\n\t\t\t\t/>\n\t\t\t</main>\n\t\t\t<footer class="ai__role-master-app_footer">\n\t\t\t\t<a\n\t\t\t\t\tv-if="currentStepNumber === 1"\n\t\t\t\t\t@click="openHelpdeskSlider"\n\t\t\t\t\tclass="ai__role-master_about-link"\n\t\t\t\t\thref="#"\n\t\t\t\t>\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('ROLE_MASTER_ABOUT_ROLE_MASTER_LINK') }}\n\t\t\t\t</a>\n\t\t\t\t<button\n\t\t\t\t\tv-if="currentStepNumber > 1"\n\t\t\t\t\t@click="currentStepNumber -= 1"\n\t\t\t\t\tclass="ai__role-master_back-btn"\n\t\t\t\t>\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\t:size="backIconProps.size"\n\t\t\t\t\t\t:name="backIconProps.icon"\n\t\t\t\t\t/>\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('ROLE_MASTER_PREV_BUTTON') }}\n\t\t\t\t</button>\n\t\t\t\t<RoleMasterBtn\n\t\t\t\t\tv-if="currentStepNumber < 2"\n\t\t\t\t\t@click="currentStepNumber += 1"\n\t\t\t\t\t:state="nextStepBtnState"\n\t\t\t\t\t:text="$Bitrix.Loc.getMessage('ROLE_MASTER_NEXT_BUTTON')"\n\t\t\t\t/>\n\t\t\t\t<RoleMasterBtn\n\t\t\t\t\tv-else\n\t\t\t\t\t@click="saveRole"\n\t\t\t\t\t:state="saveBtnState"\n\t\t\t\t\t:text="$Bitrix.Loc.getMessage('ROLE_MASTER_SAVE_BUTTON')"\n\t\t\t\t/>\n\t\t\t</footer>\n\n\t\t\t<div v-if="roleSavingStatus !== RoleSavingStatus.NONE" class="ai__role-master_saving-status-container">\n\t\t\t\t<RoleMasterSavingStatus\n\t\t\t\t\t:status="roleSavingStatus"\n\t\t\t\t\t@close-master="closeMaster"\n\t\t\t\t\t@back-to-editor="backToEditor"\n\t\t\t\t\t@repeat-request="saveRole"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`};let D=t=>t,P;const y={CLOSE:"close",SAVE_SUCCESS:"save-success"};var N=babelHelpers.classPrivateFieldLooseKey("roleMasterOptions");var C=babelHelpers.classPrivateFieldLooseKey("app");class H extends n.EventEmitter{constructor(t){super(t);Object.defineProperty(this,N,{writable:true,value:void 0});Object.defineProperty(this,C,{writable:true,value:void 0});this.setEventNamespace("AI.RoleMaster");babelHelpers.classPrivateFieldLooseBase(this,N)[N]=t}render(){var t,e,s,a,i,r,l,o,c,d;n.EventEmitter.subscribe("AI.RoleMasterApp:Close",(()=>{this.emit(y.CLOSE)}));n.EventEmitter.subscribe("AI.RoleMasterApp:Save-success",(t=>{this.emit(y.SAVE_SUCCESS,t.getData())}));const u=h.Tag.render(P||(P=D`<div class="ai__role-master-app-container"></div>`));babelHelpers.classPrivateFieldLooseBase(this,C)[C]=v.BitrixVue.createApp(O,{id:(t=babelHelpers.classPrivateFieldLooseBase(this,N)[N].id)!=null?t:"",authorId:(e=babelHelpers.classPrivateFieldLooseBase(this,N)[N].authorId)!=null?e:"",name:(s=babelHelpers.classPrivateFieldLooseBase(this,N)[N].name)!=null?s:"",text:(a=babelHelpers.classPrivateFieldLooseBase(this,N)[N].text)!=null?a:"",description:(i=(r=babelHelpers.classPrivateFieldLooseBase(this,N)[N])==null?void 0:r.description)!=null?i:"",avatarUrl:(l=(o=babelHelpers.classPrivateFieldLooseBase(this,N)[N])==null?void 0:o.avatarUrl)!=null?l:"",itemsWithAccess:(c=(d=babelHelpers.classPrivateFieldLooseBase(this,N)[N])==null?void 0:d.itemsWithAccess)!=null?c:[]});babelHelpers.classPrivateFieldLooseBase(this,C)[C].mount(u);return u}destroy(){var t;(t=babelHelpers.classPrivateFieldLooseBase(this,C)[C])==null?void 0:t.unmount()}static validateOptions(t){if(!t){return}if(t&&h.Type.isObject(t)===false){throw new Error("AI.RoleMaster: options must be the object")}if(t.id&&h.Type.isStringFilled(t.id)===false){throw new Error("AI.RoleMaster: id option must be the filled string")}if(t.text&&h.Type.isStringFilled(t.text)===false){throw new Error("AI.RoleMaster: roleText option must be the filled string")}if(t.avatarUrl&&h.Type.isStringFilled(t.avatarUrl)===false){throw new Error("AI.RoleMaster: avatar option must be the url string")}if(t.description&&h.Type.isStringFilled(t.description)===false){throw new Error("AI.RoleMaster: description option must be the filled string")}if(t.name&&h.Type.isStringFilled(t.name)===false){throw new Error("AI.RoleMaster: name option must be the filled string")}if(t.itemsWithAccess&&h.Type.isArrayFilled(t.itemsWithAccess)===false){throw new Error("AI.RoleMaster: users option must be the array.")}}}let w=t=>t,U;const $=Object.freeze({OPEN:"open",CANCEL:"cancel",SAVE_SUCCESS:"role-save-success",SAVE_FAILED:"role-save-success"});var V=babelHelpers.classPrivateFieldLooseKey("roleMasterOptions");var k=babelHelpers.classPrivateFieldLooseKey("popup");var W=babelHelpers.classPrivateFieldLooseKey("roleMaster");var X=babelHelpers.classPrivateFieldLooseKey("cancelledRoleSavingHandler");var j=babelHelpers.classPrivateFieldLooseKey("initPopup");var G=babelHelpers.classPrivateFieldLooseKey("cancelRoleSavingAnalyticEvent");var z=babelHelpers.classPrivateFieldLooseKey("renderPopupContent");var q=babelHelpers.classPrivateFieldLooseKey("validateOptions");class K extends h.Event.EventEmitter{constructor(t={}){super(t);Object.defineProperty(this,q,{value:Z});Object.defineProperty(this,z,{value:Y});Object.defineProperty(this,G,{value:J});Object.defineProperty(this,j,{value:Q});Object.defineProperty(this,V,{writable:true,value:void 0});Object.defineProperty(this,k,{writable:true,value:null});Object.defineProperty(this,W,{writable:true,value:void 0});Object.defineProperty(this,X,{writable:true,value:void 0});this.setEventNamespace("AI.RoleMaster");babelHelpers.classPrivateFieldLooseBase(this,q)[q](t);babelHelpers.classPrivateFieldLooseBase(this,V)[V]=t.roleMaster||{}}async sendAnalytics(t){try{const{sendData:e}=await h.Runtime.loadExtension("ui.analytics");const s={event:t,status:"success",tool:"ai",category:"roles_saving"};e(s)}catch(t){console.error("AI: RolesDialog: Can't send analytics",t)}}show(){if(!babelHelpers.classPrivateFieldLooseBase(this,k)[k]){babelHelpers.classPrivateFieldLooseBase(this,k)[k]=babelHelpers.classPrivateFieldLooseBase(this,j)[j]()}this.sendAnalytics($.OPEN);babelHelpers.classPrivateFieldLooseBase(this,X)[X]=babelHelpers.classPrivateFieldLooseBase(this,G)[G].bind(this);h.bind(babelHelpers.classPrivateFieldLooseBase(this,k)[k].closeIcon,"click",babelHelpers.classPrivateFieldLooseBase(this,X)[X]);babelHelpers.classPrivateFieldLooseBase(this,k)[k].show()}hide(){var t;(t=babelHelpers.classPrivateFieldLooseBase(this,k)[k])==null?void 0:t.close()}}function Q(){return new g.Popup({id:"role-master-popup",width:360,minHeight:592,content:babelHelpers.classPrivateFieldLooseBase(this,z)[z](),cacheable:false,closeIcon:true,overlay:true,padding:17,borderRadius:"12px",events:{onPopupClose:()=>{babelHelpers.classPrivateFieldLooseBase(this,k)[k]=null;babelHelpers.classPrivateFieldLooseBase(this,W)[W].unsubscribeAll(y.CLOSE);babelHelpers.classPrivateFieldLooseBase(this,W)[W].unsubscribeAll(y.SAVE_SUCCESS);babelHelpers.classPrivateFieldLooseBase(this,W)[W].destroy()}}})}function J(){this.sendAnalytics($.CANCEL)}function Y(){babelHelpers.classPrivateFieldLooseBase(this,W)[W]=new H({...babelHelpers.classPrivateFieldLooseBase(this,V)[V]});babelHelpers.classPrivateFieldLooseBase(this,W)[W].subscribeOnce(y.CLOSE,(()=>{babelHelpers.classPrivateFieldLooseBase(this,k)[k].close()}));babelHelpers.classPrivateFieldLooseBase(this,W)[W].subscribeOnce(y.SAVE_SUCCESS,(t=>{this.emit($.SAVE_SUCCESS,t.getData())}));const t=babelHelpers.classPrivateFieldLooseBase(this,V)[V].id===undefined?h.Loc.getMessage("ROLE_MASTER_POPUP_TITLE"):h.Loc.getMessage("ROLE_MASTER_POPUP_TITLE_EDIT_MODE");return h.Tag.render(U||(U=w`
			<div class="ai__role-master-popup-content">
				<header class="ai__role-master-popup-content-header">
					${0}
				</header>
				<div class="ai__role-master-popup-content-main">
					${0}
				</div>
			</div>
		`),t,babelHelpers.classPrivateFieldLooseBase(this,W)[W].render())}function Z(t){H.validateOptions(t.roleMaster)}t.RoleMaster=H;t.RoleMasterPopup=K;t.RoleMasterPopupEvents=$})(this.BX.AI=this.BX.AI||{},BX.Vue3.Components,BX.UI,BX.UI,BX.UI.Uploader,BX,BX.Event,BX.UI.EntitySelector,BX,BX,BX.UI,BX.UI.IconSet,BX.UI.IconSet,BX,BX.Vue3,BX,BX.Main);
//# sourceMappingURL=role-master.bundle.map.js