{"version":3,"file":"copilot-chat.bundle.js","sources":["../src/components/copilot-chat-status.js","../src/helpers/new-messages-visibility-observer.js","../src/components/copilot-chat-avatar.js","../src/components/copilot-chat-header-menu.js","../src/components/copilot-chat-header.js","../src/components/copilot-chat-voice-input-btn.js","../src/components/copilot-chat-input.js","../src/helpers/is-message-from-copilot.js","../src/components/copilot-chat-message.js","../src/components/copilot-chat-welcome-message.js","../src/components/copilot-chat-messages-date-group.js","../src/components/copilot-chat-new-messages-label.js","../src/components/copilot-chat-messages-author-group.js","../src/types.js","../src/components/directives/copilot-chat-new-message-visibility-observer.js","../src/components/copilot-chat-message-button.js","../src/components/message/copilot-chat-message-menu.js","../src/components/message/copilot-chat-message-default.js","../src/components/message/copilot-chat-message-welcome.js","../src/components/message/copilot-chat-message-site-with-ai.js","../src/components/message/copilot-chat-message-welcome-flows.js","../src/components/message/index.js","../src/components/copilot-chat-messages.js","../src/components/copilot-chat-history-loader.js","../src/components/copilot-chat-warning-message.js","../src/components/copilot-chat-loading-bar.js","../src/components/copilot-chat-load-history-error.js","../src/components/copilot-chat.js","../src/copilot-chat.js"],"sourcesContent":["import { BIcon, Set } from 'ui.icon-set.api.vue';\n\nimport '../css/copilot-chat-status.css';\n\nexport const Status = Object.freeze({\n\tCOPILOT_WRITING: 'copilot-writing',\n\tNONE: 'none',\n});\n\nexport const CopilotChatStatus = {\n\tcomponents: {\n\t\tBIcon,\n\t},\n\tprops: {\n\t\tstatus: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: Status.NONE,\n\t\t},\n\t},\n\tcomputed: {\n\t\tStatus(): Status {\n\t\t\treturn Status;\n\t\t},\n\t\twritingStatusIcon(): {name: string, size: number} {\n\t\t\treturn {\n\t\t\t\tname: Set.PENCIL_60,\n\t\t\t\tsize: 14,\n\t\t\t\tcolor: '#fff',\n\t\t\t};\n\t\t},\n\t\tcontainerClassname(): string[] {\n\t\t\treturn [\n\t\t\t\t'ai__copilot-chat_status',\n\t\t\t\t`--${this.status}`,\n\t\t\t];\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"ai__copilot-chat_status-wrapper\">\n\t\t\t<div class=\"ai__copilot-chat_status\">\n\t\t\t\t<template v-if=\"status === Status.COPILOT_WRITING\">\n\t\t\t\t\t<span class=\"ai__copilot-chat_status-icon --typing\">\n\t\t\t\t\t\t<BIcon\n\t\t\t\t\t\t\tv-bind=\"writingStatusIcon\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span>{{ $Bitrix.Loc.getMessage('AI_COPILOT_CHAT_STATUS_COPILOT_WRITING') }}</span>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Dom } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\n\nexport const NewMessagesVisibilityObserverEvents = Object.freeze({\n\tVIEW_NEW_MESSAGE: 'viewNewMessage',\n});\n\nexport class NewMessagesVisibilityObserver extends EventEmitter\n{\n\t#observer: IntersectionObserver | null = null;\n\t#root: HTMLElement = null;\n\t#observableElements: HTMLElement[] = [];\n\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.setEventNamespace('AI.CopilotChat.InterSectionManager');\n\t}\n\n\tinit(): void\n\t{\n\t\t// eslint-disable-next-line @bitrix24/bitrix24-rules/no-io-without-polyfill\n\t\tthis.#observer = new IntersectionObserver((entries: IntersectionObserverEntry[]) => {\n\t\t\tentries.forEach((entry) => {\n\t\t\t\tconst isMessageVisible = entry.isIntersecting && entry.intersectionRatio > 0.5;\n\n\t\t\t\tif (isMessageVisible)\n\t\t\t\t{\n\t\t\t\t\tconst messageElement = entry.target;\n\n\t\t\t\t\tthis.emit(NewMessagesVisibilityObserverEvents.VIEW_NEW_MESSAGE, new BaseEvent({\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tid: Dom.attr(messageElement, 'data-id'),\n\t\t\t\t\t\t},\n\t\t\t\t\t}));\n\n\t\t\t\t\tthis.#observer.unobserve(messageElement);\n\t\t\t\t}\n\t\t\t});\n\t\t}, {\n\t\t\troot: this.#root,\n\t\t\tthreshold: this.#getThreshold(),\n\t\t});\n\n\t\tthis.#observableElements.forEach((element) => {\n\t\t\tthis.#observer.observe(element);\n\t\t});\n\t}\n\n\t#getThreshold(): number[]\n\t{\n\t\tconst arrayWithZeros = Array.from({ length: 101 }).fill(0);\n\n\t\treturn arrayWithZeros.map((zero, index) => index * 0.01);\n\t}\n\n\tobserve(element: HTMLElement): void\n\t{\n\t\tif (!this.#root || !this.#observer)\n\t\t{\n\t\t\tthis.#observableElements.push(element);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#observer.observe(element);\n\t\t}\n\t}\n\n\tunobserve(element: HTMLElement): void\n\t{\n\t\tthis.#observer.unobserve(element);\n\t}\n\n\tsetRoot(root: HTMLElement): void\n\n\t{\n\t\tthis.#root = root;\n\t}\n}\n","import '../css/copilot-chat-avatar.css';\n\nexport const CopilotChatAvatar = {\n\tprops: {\n\t\tsrc: String,\n\t\talt: String,\n\t},\n\ttemplate: `\n\t\t<img\n\t\t\tclass=\"ai__copilot-chat-avatar\"\n\t\t\t:alt=\"alt\"\n\t\t\t:src=\"src\"\n\t\t/>\n\t`,\n};\n","import { Menu, type MenuItemOptions } from 'main.popup';\nimport { BIcon, Set } from 'ui.icon-set.api.vue';\n\nimport '../css/copilot-chat-header-menu.css';\n\nexport const CopilotChatHeaderMenu = {\n\tcomponents: {\n\t\tBIcon,\n\t},\n\tprops: {\n\t\tmenuItems: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t\tdefault: () => ([]),\n\t\t},\n\t},\n\tcomputed: {\n\t\titems(): MenuItemOptions[] {\n\t\t\treturn this.menuItems;\n\t\t},\n\t\tmenuIconProps(): { name: string, size: number } {\n\t\t\treturn {\n\t\t\t\tname: Set.MORE,\n\t\t\t\tsize: 24,\n\t\t\t};\n\t\t},\n\t},\n\tbeforeMount() {\n\t\tthis.menu = new Menu({\n\t\t\titems: this.items,\n\t\t});\n\t},\n\tmounted() {\n\t\tthis.menu.getPopupWindow().setBindElement(this.$refs.menuButton);\n\t},\n\tbeforeUnmount() {\n\t\tthis.menu.destroy();\n\t},\n\tmethods: {\n\t\ttoggleMenu(): void {\n\t\t\tif (this.isMenuOpen())\n\t\t\t{\n\t\t\t\tthis.hideMenu();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showMenu();\n\t\t\t}\n\t\t},\n\t\tshowMenu(): void {\n\t\t\tthis.menu.show();\n\t\t},\n\t\thideMenu(): void {\n\t\t\tthis.menu.close();\n\t\t},\n\t\tisMenuOpen(): boolean {\n\t\t\treturn this.menu.getPopupWindow().isShown();\n\t\t},\n\t},\n\ttemplate: `\n\t\t<button\n\t\t\tref=\"menuButton\"\n\t\t\t@click=\"toggleMenu\"\n\t\t\tclass=\"ai__copilot-chat-header-menu\"\n\t\t>\n\t\t\t<span class=\"ai__copilot-chat-header-menu_icon\">\n\t\t\t\t<b-icon\n\t\t\t\t\tv-bind=\"menuIconProps\"\n\t\t\t\t></b-icon>\n\t\t\t</span>\n\t\t</button>\n\t`,\n};\n","import type { MenuItemOptions } from 'main.popup';\nimport { CopilotChatAvatar } from './copilot-chat-avatar';\nimport { CopilotChatHeaderMenu } from './copilot-chat-header-menu';\nimport { BIcon, Set } from 'ui.icon-set.api.vue';\nimport 'ui.icon-set.actions';\n\nimport '../css/copilot-chat-header.css';\n\nexport const CopilotChatHeader = {\n\tcomponents: {\n\t\tCopilotChatAvatar,\n\t\tCopilotChatHeaderMenu,\n\t\tBIcon,\n\t},\n\temits: ['clickOnCloseIcon'],\n\tprops: {\n\t\ttitle: String,\n\t\tsubtitle: String,\n\t\tavatar: String,\n\t\tuseCloseIcon: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t\tdefault: false,\n\t\t},\n\t\tmenu: Object,\n\t},\n\tcomputed: {\n\t\tcloseIconProps(): { name: string, size: number } {\n\t\t\treturn {\n\t\t\t\tname: Set.CROSS_40,\n\t\t\t\tsize: 24,\n\t\t\t};\n\t\t},\n\t\tisMenuExists(): boolean {\n\t\t\treturn this.menu && this.menu.items && this.menu.items.length > 0;\n\t\t},\n\t\tmenuItems(): MenuItemOptions {\n\t\t\treturn this.menu?.items ?? [];\n\t\t},\n\t},\n\tmethods: {\n\t\thandleClickOnCloseIcon(): void {\n\t\t\tthis.$emit('clickOnCloseIcon');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"ai__copilot-chat-header\">\n\t\t\t<button\n\t\t\t\tv-if=\"useCloseIcon\"\n\t\t\t\t@click=\"handleClickOnCloseIcon\"\n\t\t\t\tclass=\"ai__copilot-chat-header_close-icon\"\n\t\t\t>\n\t\t\t\t<b-icon\n\t\t\t\t\tv-bind=\"closeIconProps\"\n\t\t\t\t />\n\t\t\t</button>\n\t\t\t<div class=\"ai__copilot-chat-header_avatar\">\n\t\t\t\t<CopilotChatAvatar\n\t\t\t\t\t:src=\"avatar\"\n\t\t\t\t\t:alt=\"title\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class=\"ai__copilot-chat-header_info\">\n\t\t\t\t<h4 class=\"ai__copilot-chat-header_title\">\n\t\t\t\t\t{{ title }}\n\t\t\t\t</h4>\n\t\t\t\t<div class=\"ai__copilot-chat-header_subtitle\">\n\t\t\t\t\t{{ subtitle }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if=\"isMenuExists\"\n\t\t\t\tclass=\"ai__copilot-chat-header_menu\"\n\t\t\t>\n\t\t\t\t<copilot-chat-header-menu :menu-items=\"menuItems\"></copilot-chat-header-menu>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import type { SpeechConverterErrorEventData, SpeechConverterResultEventData } from 'ai.speech-converter';\nimport { SpeechConverter, speechConverterEvents } from 'ai.speech-converter';\nimport { BaseEvent } from 'main.core.events';\nimport { Set as IconSet } from 'ui.icon-set.api.core';\nimport { BIcon } from 'ui.icon-set.api.vue';\nimport { toRaw } from 'ui.vue3';\n\nimport 'ui.icon-set.main';\n\nexport const CopilotChatVoiceInputBtn = {\n\tcomponents: {\n\t\tBIcon,\n\t},\n\temits: ['input', 'start', 'stop'],\n\tdata(): { converter: ?SpeechConverter } {\n\t\treturn {\n\t\t\tconverter: null,\n\t\t\tisVoiceRecording: false,\n\t\t};\n\t},\n\tcomputed: {\n\t\tIconSet(): IconSet {\n\t\t\treturn IconSet;\n\t\t},\n\t\tisVoiceInputDisabled(): boolean {\n\t\t\treturn SpeechConverter.isBrowserSupport() === false;\n\t\t},\n\t},\n\tmethods: {\n\t\thandleClickOnStartVoiceInputBtn(): void {\n\t\t\tif (this.isVoiceRecording)\n\t\t\t{\n\t\t\t\tthis.stopVoiceInput();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.startVoiceInput();\n\t\t\t}\n\t\t},\n\t\tstartVoiceInput() {\n\t\t\tconst converter: SpeechConverter = toRaw(this.converter);\n\t\t\tconverter.start();\n\t\t},\n\t\tstopVoiceInput(): void {\n\t\t\tconst converter: SpeechConverter = toRaw(this.converter);\n\t\t\tconverter.stop();\n\t\t},\n\t\thandleSpeechConverterStartEvent(): void {\n\t\t\tthis.$emit('start');\n\t\t\tthis.isVoiceRecording = true;\n\t\t},\n\t\thandleSpeechConverterStopEvent(): void {\n\t\t\tthis.isVoiceRecording = false;\n\t\t\tthis.$emit('stop');\n\t\t},\n\t\thandleSpeechConverterResultEvent(e: BaseEvent<SpeechConverterResultEventData>): void {\n\t\t\tthis.$emit('input', e.getData().text);\n\t\t},\n\t\thandleSpeechConverterErrorEvent(e: BaseEvent<SpeechConverterErrorEventData>) {\n\t\t\tconsole.error(e);\n\t\t\tthis.isVoiceRecording = false;\n\t\t},\n\t},\n\tmounted() {\n\t\tif (this.isVoiceInputDisabled === false)\n\t\t{\n\t\t\tthis.converter = new SpeechConverter({});\n\n\t\t\tconst converter: SpeechConverter = toRaw(this.converter);\n\n\t\t\tconverter.subscribe(speechConverterEvents.start, this.handleSpeechConverterStartEvent);\n\t\t\tconverter.subscribe(speechConverterEvents.stop, this.handleSpeechConverterStopEvent);\n\t\t\tconverter.subscribe(speechConverterEvents.result, this.handleSpeechConverterResultEvent.bind(this));\n\t\t\tconverter.subscribe(speechConverterEvents.error, this.handleSpeechConverterErrorEvent);\n\t\t}\n\t},\n\tunmounted() {\n\t\tif (this.isVoiceInputDisabled === false)\n\t\t{\n\t\t\tconst converter: SpeechConverter = toRaw(this.converter);\n\n\t\t\tconverter.unsubscribe(speechConverterEvents.start, this.handleSpeechConverterStartEvent);\n\t\t\tconverter.unsubscribe(speechConverterEvents.stop, this.handleSpeechConverterStopEvent);\n\t\t\tconverter.unsubscribe(speechConverterEvents.result, this.handleSpeechConverterResultEvent.bind(this));\n\t\t\tconverter.unsubscribe(speechConverterEvents.error, this.handleSpeechConverterErrorEvent);\n\t\t}\n\t},\n\ttemplate: `\n\t\t<button\n\t\t\t:disabled=\"isVoiceInputDisabled\"\n\t\t\t@click=\"handleClickOnStartVoiceInputBtn\"\n\t\t\tclass=\"ai__copilot-chat-input_voice-input\"\n\t\t>\n\t\t\t<span\n\t\t\t\tv-if=\"isVoiceRecording === false\"\n\t\t\t\tclass=\"ai__copilot-chat-input_voice-input-no-record-icon-wrapper\"\n\t\t\t>\n\t\t\t\t<BIcon\n\t\t\t\t\t:size=\"24\"\n\t\t\t\t\t:name=\"IconSet.MICROPHONE_ON\"\n\t\t\t\t/>\n\t\t\t</span>\n\t\t\t<span\n\t\t\t\tv-else\n\t\t\t\tclass=\"ai__copilot-chat-input_voice-input-record-icon-wrapper\"\n\t\t\t>\n\t\t\t\t<span class=\"ai__copilot-chat-input_voice-input-record-icon\"></span>\n\t\t\t</span>\n\t\t</button>\n\t`,\n};\n","import { Loc, Dom } from 'main.core';\nimport { CopilotChatVoiceInputBtn } from './copilot-chat-voice-input-btn';\nimport 'ui.icon-set.main';\n\nimport '../css/copilot-chat-input.css';\n\nexport const CopilotChatInput = {\n\tcomponents: {\n\t\tCopilotChatVoiceInputBtn,\n\t},\n\temits: ['submit'],\n\tprops: {\n\t\tdisabled: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t\tdefault: false,\n\t\t},\n\t\tplaceholder: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: Loc.getMessage('AI_COPILOT_CHAT_INPUT_PLACEHOLDER'),\n\t\t},\n\t},\n\tdata(): {\n\t\tuserMessage: string,\n\t\tuserMessageBeforeVoiceInput: string,\n\t\tisRecording: boolean,\n\t\t} {\n\t\treturn {\n\t\t\tuserMessage: '',\n\t\t\tuserMessageBeforeVoiceInput: this.userMessage,\n\t\t\tisRecording: false,\n\t\t};\n\t},\n\tcomputed: {\n\t\tisSubmitButtonDisabled(): boolean {\n\t\t\treturn !this.userMessage || this.userMessage.trim().length === 0 || this.isRecording;\n\t\t},\n\t\tcontainerClassname(): string {\n\t\t\treturn {\n\t\t\t\t'ai__copilot-chat-input': true,\n\t\t\t\t'--disabled': this.disabled,\n\t\t\t};\n\t\t},\n\t},\n\tmounted() {\n\t\tsetTimeout(() => {\n\t\t\tthis.$refs.textarea.focus();\n\t\t}, 500);\n\t},\n\tmethods: {\n\t\thandleSubmitButton(e: PointerEvent): void {\n\t\t\te.target.blur();\n\n\t\t\tthis.submitMessage();\n\t\t},\n\t\thandleEnterKeyDown(e: KeyboardEvent): boolean {\n\t\t\tif (e.shiftKey || e.ctrlKey)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\te.preventDefault();\n\n\t\t\tif (this.userMessage?.trim())\n\t\t\t{\n\t\t\t\tthis.submitMessage();\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\t\tsubmitMessage(): void {\n\t\t\tthis.$emit('submit', this.userMessage.trim());\n\n\t\t\tthis.userMessage = '';\n\t\t},\n\t\thandleInput(e: InputEvent): void {\n\t\t\tthis.userMessage = e.target.value;\n\t\t},\n\t\thandleVoiceInputText(text: string): void {\n\t\t\tthis.userMessage = this.userMessageBeforeVoiceInput + text;\n\n\t\t\tthis.updateTextareaHeight();\n\t\t},\n\t\thandleStartVoiceInput(): void {\n\t\t\tthis.isRecording = true;\n\t\t\tif (this.userMessage && this.userMessage.at(-1) !== ' ')\n\t\t\t{\n\t\t\t\tthis.userMessage += ' ';\n\t\t\t}\n\n\t\t\tthis.userMessageBeforeVoiceInput = this.userMessage;\n\t\t},\n\t\thandleStopVoiceInput(): void {\n\t\t\tthis.isRecording = false;\n\t\t\tthis.$refs.textarea.focus();\n\t\t},\n\t\tupdateTextareaHeight(): void {\n\t\t\tconst textarea: HTMLElement = this.$refs.textarea;\n\t\t\tDom.style(textarea, 'height', 'auto');\n\n\t\t\tDom.style(textarea, 'height', `${textarea.scrollHeight}px`);\n\t\t},\n\t},\n\twatch: {\n\t\tuserMessage(): void {\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tthis.updateTextareaHeight();\n\t\t\t});\n\t\t},\n\t\tdisabled(isDisabled): void {\n\t\t\tif (isDisabled === false)\n\t\t\t{\n\t\t\t\tthis.$refs.textarea.focus();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.$refs.textarea.blur();\n\t\t\t}\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div :class=\"containerClassname\">\n\t\t\t<div class=\"ai__copilot-chat-input_textarea-wrapper\">\n\t\t\t\t<textarea\n\t\t\t\t\ttype=\"text\" class=\"ai__copilot-chat-input_textarea\"\n\t\t\t\t\tref=\"textarea\"\n\t\t\t\t\t:placeholder=\"placeholder\"\n\t\t\t\t\trows=\"1\"\n\t\t\t\t\t@input=\"handleInput\"\n\t\t\t\t\t@keydown.enter=\"handleEnterKeyDown\"\n\t\t\t\t\t:value=\"userMessage\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class=\"ai__copilot-chat-input_actions\">\n\t\t\t\t<CopilotChatVoiceInputBtn\n\t\t\t\t\t@start=\"handleStartVoiceInput\"\n\t\t\t\t\t@input=\"handleVoiceInputText\"\n\t\t\t\t\t@stop=\"handleStopVoiceInput\"\n\t\t\t\t/>\n\t\t\t\t<button @click=\"handleSubmitButton\" :disabled=\"isSubmitButtonDisabled\" class=\"ai__copilot-chat-input_submit\"></button>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","export const isMessageFromCopilot = (authorId: string): boolean => {\n\treturn authorId === 0;\n};\n","import '../css/copilot-chat-message.css';\n\nexport type CopilotChatMessageDataButton = {\n\ttext: string;\n\tisSelected: boolean;\n}\n\nexport const CopilotChatMessage = {\n\tprops: {\n\t\tavatar: String,\n\t\tavatarAlt: String,\n\t\tmessageTitle: String,\n\t\tmessageText: String,\n\t\ttime: String,\n\t\tbuttons: {\n\t\t\ttype: Array,\n\t\t\trequired: false,\n\t\t\tdefault: () => ([]),\n\t\t},\n\t\tcolorScheme: String,\n\t\tstatus: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t},\n\t},\n\tcomputed: {\n\t\tmessageButtons(): CopilotChatMessageDataButton[] {\n\t\t\treturn this.buttons;\n\t\t},\n\t\tformattedTime(): string {\n\t\t\tconst date = (new Date(this.time));\n\n\t\t\treturn `${date.getHours()}:${date.getMinutes()}`;\n\t\t},\n\t\tisUserMessage(): boolean {\n\t\t\treturn true; // replace with the actual code\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"ai__copilot-chat-message\"\n\t\t\t:class=\"'--color-schema-' + colorScheme\"\n\t\t>\n\t\t\t<div class=\"ai__copilot-chat-message_avatar-wrapper\">\n\t\t\t\t<img\n\t\t\t\t\tclass=\"ai__copilot-chat-message_avatar\"\n\t\t\t\t\t:src=\"avatar\"\n\t\t\t\t\t:alt=\"avatarAlt\"\n\t\t\t\t\t:title=\"avatarAlt\"\n\t\t\t\t>\n\t\t\t</div>\n\t\t\t<div class=\"ai__copilot-chat-message-content-wrapper\">\n\t\t\t\t<div class=\"ai__copilot-chat-message-content\">\n\t\t\t\t\t<div class=\"ai__copilot-chat-message-content-main\">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-if=\"messageTitle\"\n\t\t\t\t\t\t\tclass=\"ai__copilot-chat-message-title\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ messageTitle }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"ai__copilot-chat-message-text\">\n\t\t\t\t\t\t\t{{ messageText }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"ai__copilot-chat-message_time\">\n\t\t\t\t\t\t{{ formattedTime }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"status\"\n\t\t\t\t\t\tclass=\"ai__copilot-chat-message_status\"\n\t\t\t\t\t\t:class=\"'--' + status\"\n\t\t\t\t\t></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if=\"messageButtons.length > 0\" class=\"ai__copilot-chat-message_action-buttons\">\n\t\t\t\t<button\n\t\t\t\t\tv-for=\"button in messageButtons\"\n\t\t\t\t\tclass=\"ai__copilot-chat-message_action-button\"\n\t\t\t\t\t:class=\"{'--selected': button.isSelected}\"\n\t\t\t\t>\n\t\t\t\t\t{{ button.text }}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","export const CopilotChatWelcomeMessage = {\n\tprops: {\n\t\tavatar: String,\n\t\ttitle: String,\n\t\tcontent: String,\n\t},\n\ttemplate: `\n\t\t<div class=\"landing__copilot-landing-chat-welcome-message\">\n\t\t\t<div class=\"landing__copilot-landing-chat-welcome-message_avatar-wrapper\">\n\t\t\t\t<img\n\t\t\t\t\tclass=\"landing__copilot-landing-chat-welcome-message_avatar\"\n\t\t\t\t\tsrc=\"/dev/ai/copilot-chat/images/avatar-example-4x.png\"\n\t\t\t\t\talt=\"Copilot Designer\"\n\t\t\t\t>\n\t\t\t</div>\n\t\t\t<div class=\"landing__copilot-landing-chat-welcome-message_content\">\n\t\t\t\t<h6 class=\"landing__copilot-landing-chat-welcome-message_title\">{{ title }}</h6>\n\t\t\t\t<div v-html=\"content\"></div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { DateTimeFormat } from 'main.date';\n\nimport '../css/copilot-chat-messages-date-group.css';\n\nexport const CopilotChatMessagesDateGroup = {\n\tprops: {\n\t\tdate: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\tcomputed: {\n\t\tformattedDate(): string\n\t\t{\n\t\t\tconst format = [\n\t\t\t\t['today', 'today'],\n\t\t\t\t['yesterday', 'yesterday'],\n\t\t\t\t['m', 'l, d F'],\n\t\t\t\t['', 'l, d F Y'],\n\t\t\t];\n\n\t\t\treturn DateTimeFormat.format(format, new Date(this.date), new Date());\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"ai__copilot-chat-messages-date-group\">\n\t\t\t<div class=\"ai__copilot-chat-messages-date-group__date\">\n\t\t\t\t<div class=\"ai__copilot-chat-messages-date-group__date-label\">\n\t\t\t\t\t{{ formattedDate }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"ai__copilot-chat-messages-date-group__content\">\n\t\t\t\t<slot></slot>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import '../css/copilot-chat-new-messages-label.css';\n\nexport const containerClassname = 'ai__copilot-chat_new-messages-label';\n\nexport const CopilotChatNewMessagesLabel = {\n\ttemplate: `\n\t\t<div class=\"${containerClassname}\">\n\t\t\t{{ $Bitrix.Loc.getMessage('AI_COPILOT_CHAT_NEW_MESSAGES_LABEL') }}\n\t\t</div>\n\t`,\n};\n","import { CopilotChatNewMessagesLabel } from './copilot-chat-new-messages-label';\n\nimport '../css/copilot-chat-messages-author-group.css';\n\nexport const CopilotChatMessagesAuthorGroup = {\n\tcomponents: {\n\t\tCopilotChatNewMessagesLabel,\n\t},\n\tprops: {\n\t\tavatar: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t},\n\t\tshowNewMessagesLabel: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\ttemplate: `\n\t\t<CopilotChatNewMessagesLabel v-if=\"showNewMessagesLabel\" />\n\t\t<div class=\"ai__copilot-chat_messages-author-group\">\n\t\t\t<div class=\"ai__copilot-chat_messages-author-group__avatar\">\n\t\t\t\t<img v-if=\"avatar\" :src=\"avatar\" alt=\"#\">\n\t\t\t</div>\n\t\t\t<div class=\"ai__copilot-chat_messages-author-group__messages\">\n\t\t\t\t<slot></slot>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","export type CopilotChatMessage = {\n\tid?: number;\n\tcontent: string;\n\tauthorId: number;\n\tstatus?: 'sending' | 'delivered' | '';\n\tparams?: CopilotChatMessageParams;\n\tdateCreate?: string;\n\ttype?: 'Default' | 'GreetingFlows' | 'GreetingSiteWithAi' | 'System' | 'ButtonClicked';\n\tviewed: boolean;\n};\n\ntype CopilotChatMessageParams = {\n\tbuttons?: CopilotChatMessageButton[];\n\tbuttonId?: number;\n\tmessageId?: number;\n}\n\nexport type CopilotChatMessageButton = {\n\tid: number;\n\ttext: string;\n\tselected: boolean;\n\ttitle: string;\n}\n\nexport const CopilotChatMessageType = Object.freeze({\n\tDEFAULT: 'Default',\n\tBUTTON_CLICK_MESSAGE: 'ButtonClicked',\n\tWELCOME_FLOWS: 'WelcomeFlows',\n\tWELCOME_SITE_WITH_AI: 'GreetingSiteWithAi',\n\tSYSTEM: 'System',\n});\n","export const CopilotChatNewMessageVisibilityObserver = {\n\tmounted(element, binding) {\n\t\tconst isMessageViewed = binding.value;\n\n\t\tif (isMessageViewed === false)\n\t\t{\n\t\t\tbinding.instance.observer.observe(element);\n\t\t}\n\t},\n\tbeforeUnmount(element, binding) {\n\t\tbinding.instance.observer.unobserve(element);\n\t},\n};\n","import { BIcon } from 'ui.icon-set.api.vue';\n\nexport const CopilotChatMessageButton = {\n\tcomponents: {\n\t\tBIcon,\n\t},\n\tprops: {\n\t\ticon: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tclass: Array | Object | String,\n\t},\n\tcomputed: {\n\t\tmenuIconProps(): { name: string, size: number} {\n\t\t\treturn {\n\t\t\t\tname: this.icon,\n\t\t\t\tsize: 22,\n\t\t\t};\n\t\t},\n\t\tclassName(): Array | Object | string {\n\t\t\treturn this.class;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<button\n\t\t\tclass=\"ai__copilot-chat-message-menu\"\n\t\t\t:class=\"className\"\n\t\t>\n\t\t\t<BIcon v-bind=\"menuIconProps\"></BIcon>\n\t\t</button>\n\t`,\n};\n","import { bind, Dom } from 'main.core';\nimport { Menu, type MenuItemOptions } from 'main.popup';\nimport { BIcon, Set } from 'ui.icon-set.api.vue';\n\nimport { CopilotChatMessageButton } from '../copilot-chat-message-button';\nimport '../../css/copilot-chat-message-menu.css';\n\nexport type MenuItemOnClickCustomData = {\n\tmessage: MenuItemMessageData;\n};\n\nexport type MenuItemMessageData = {\n\tid: number;\n\tcontent: string;\n\tdateCreate: string;\n};\n\nexport const CopilotChatMessageMenu = {\n\tcomponents: {\n\t\tBIcon,\n\t\tCopilotChatMessageButton,\n\t},\n\tprops: {\n\t\tmenuItems: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t\tdefault: () => ([]),\n\t\t},\n\t\tmessage: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t\tdefault: () => ({}),\n\t\t},\n\t\ticon: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: Set.MORE,\n\t\t},\n\t},\n\tdata(): {isMenuOpen: boolean} {\n\t\treturn {\n\t\t\tisMenuOpen: false,\n\t\t};\n\t},\n\tcomputed: {\n\t\titems(): MenuItemOptions[] {\n\t\t\treturn this.menuItems.map((item: MenuItemOptions) => {\n\t\t\t\treturn {\n\t\t\t\t\t...item,\n\t\t\t\t\tonclick: (event: PointerEvent, menuItem: MenuItem) => {\n\t\t\t\t\t\tconst myCustomData: MenuItemOnClickCustomData = {\n\t\t\t\t\t\t\tmessage: {\n\t\t\t\t\t\t\t\tid: this.message.id,\n\t\t\t\t\t\t\t\tcontent: this.message.content,\n\t\t\t\t\t\t\t\tdateCreate: this.message.dateCreate,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tthis.hideMenu();\n\n\t\t\t\t\t\treturn item.onclick(event, menuItem, myCustomData);\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t});\n\t\t},\n\t\tmenuIconProps(): { name: string, size: number} {\n\t\t\treturn {\n\t\t\t\tname: this.icon,\n\t\t\t\tsize: 22,\n\t\t\t};\n\t\t},\n\t\tmenuButtonClassname(): Object {\n\t\t\treturn {\n\t\t\t\t'ai__copilot-chat-message-menu': true,\n\t\t\t\t'--open': this.isMenuOpen,\n\t\t\t};\n\t\t},\n\t},\n\tmethods: {\n\t\ttoggleMenu(): void {\n\t\t\tif (this.isMenuOpen)\n\t\t\t{\n\t\t\t\tthis.hideMenu();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showMenu();\n\t\t\t}\n\t\t},\n\t\tshowMenu(): void {\n\t\t\tif (!this.menu)\n\t\t\t{\n\t\t\t\tthis.initMenu();\n\t\t\t}\n\n\t\t\tthis.menu?.show();\n\t\t},\n\t\thideMenu(): void {\n\t\t\tthis.menu?.close();\n\t\t},\n\t\tinitMenu(): Menu {\n\t\t\tthis.menu = new Menu({\n\t\t\t\titems: this.items,\n\t\t\t\tangle: {\n\t\t\t\t\toffset: Dom.getPosition(this.$refs.menuButton.$el).width / 2 + 23,\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupShow: () => {\n\t\t\t\t\t\tthis.isMenuOpen = true;\n\t\t\t\t\t},\n\t\t\t\t\tonPopupClose: () => {\n\t\t\t\t\t\tthis.isMenuOpen = false;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tbindElement: this.$refs.menuButton.$el,\n\t\t\t});\n\n\t\t\tbind(document.body.querySelector('.ai__copilot-chat_main'), 'scroll', () => {\n\t\t\t\tthis.hideMenu();\n\t\t\t});\n\n\t\t\treturn this.menu;\n\t\t},\n\t},\n\tbeforeUnmount() {\n\t\tthis.menu?.destroy();\n\t},\n\ttemplate: `\n\t\t<CopilotChatMessageButton\n\t\t\tref=\"menuButton\"\n\t\t\t@click=\"toggleMenu\"\n\t\t\t:icon=\"menuIconProps.name\"\n\t\t\t:class=\"menuButtonClassname\"\n\t\t/>\n\t`,\n};\n","import { Dom } from 'main.core';\nimport { Set } from 'ui.icon-set.api.core';\nimport { type MenuItem } from 'main.popup';\nimport { isMessageFromCopilot } from '../../helpers/is-message-from-copilot';\nimport { CopilotChatMessageMenu } from './copilot-chat-message-menu';\nimport type { CopilotChatMessage, CopilotChatMessageButton } from '../../types';\nimport { HtmlFormatter } from 'ui.bbcode.formatter.html-formatter';\nimport { CopilotChatMessageStatus } from '../../copilot-chat';\n\nimport '../../css/copilot-chat-message.css';\n\nexport const CopilotChatMessageDefault = {\n\tcomponents: {\n\t\tCopilotChatMessageMenu,\n\t},\n\temits: ['buttonClick', 'remove', 'retry'],\n\tprops: {\n\t\tmessage: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tavatar: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t},\n\t\tuseAvatarTail: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t\tdefault: false,\n\t\t},\n\t\tmenuItems: {\n\t\t\ttype: Array,\n\t\t\trequired: false,\n\t\t\tdefault: () => ([]),\n\t\t},\n\t\tcolor: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: '',\n\t\t},\n\t\tdisableAllActions: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tcomputed: {\n\t\tmessageData(): CopilotChatMessage {\n\t\t\treturn this.message;\n\t\t},\n\t\tmessageContent(): string {\n\t\t\treturn this.messageData.content;\n\t\t},\n\t\tisMessageFromCopilot(): boolean {\n\t\t\treturn isMessageFromCopilot(this.messageData.authorId);\n\t\t},\n\t\tformattedMessageContent(): DocumentFragment {\n\t\t\tconst htmlFormatter = new HtmlFormatter({\n\t\t\t\tcontainerMode: 'collapsed',\n\t\t\t});\n\n\t\t\treturn htmlFormatter.format({\n\t\t\t\tsource: this.messageContent,\n\t\t\t});\n\t\t},\n\t\tformattedDeliveryTime(): string {\n\t\t\treturn this.formatTime(this.messageData.dateCreate);\n\t\t},\n\t\tmessageButtons(): CopilotChatMessageButton[] {\n\t\t\treturn this.messageData.params?.buttons ?? [];\n\t\t},\n\t\tisSomeButtonSelected(): boolean {\n\t\t\treturn this.messageButtons.some((button) => button.selected);\n\t\t},\n\t\tshowMenuButton(): boolean {\n\t\t\treturn this.menuItems?.length > 0;\n\t\t},\n\t\tisErrorMessage(): boolean {\n\t\t\treturn this.messageData.status === CopilotChatMessageStatus.ERROR;\n\t\t},\n\t\terrorMessageMenuItems(): MenuItem[] {\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\tid: 'retry',\n\t\t\t\t\ttext: this.$Bitrix.Loc.getMessage('AI_COPILOT_CHAT_RETRY_MESSAGE'),\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tthis.$emit('retry', this.messageData.id);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'remove',\n\t\t\t\t\ttext: this.$Bitrix.Loc.getMessage('AI_COPILOT_CHAT_REMOVE_MESSAGE'),\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tthis.$emit('remove', this.messageData.id);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t];\n\t\t},\n\t\tIcons() {\n\t\t\treturn Set;\n\t\t},\n\t},\n\tmethods: {\n\t\tformatTime(dateTime: string): string {\n\t\t\tif (!dateTime)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tconst date = new Date(dateTime);\n\n\t\t\tconst hours: string = date.getHours().toString().padStart(2, '0');\n\t\t\tconst minutes: string = date.getMinutes().toString().padStart(2, '0');\n\n\t\t\treturn `${hours}:${minutes}`;\n\t\t},\n\t},\n\tmounted() {\n\t\tif (this.isMessageFromCopilot)\n\t\t{\n\t\t\tDom.append(this.formattedMessageContent, this.$refs.content);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.$refs.content.innerText = this.messageContent;\n\t\t}\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\t:data-id=\"messageData.id\"\n\t\t\tclass=\"ai__copilot-chat-message\"\n\t\t\t:class=\"'--color-schema-' + color\"\n\t\t>\n\t\t\t<div\n\t\t\t\tclass=\"ai__copilot-chat-message-content-wrapper\"\n\t\t\t\t:class=\"{ '--with-tail': useAvatarTail }\"\n\t\t\t>\n\t\t\t\t<div class=\"ai__copilot-chat-message-content\">\n\t\t\t\t\t<div class=\"ai__copilot-chat-message-content-main\">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-if=\"title\"\n\t\t\t\t\t\t\tclass=\"ai__copilot-chat-message-title\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ title }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"ai__copilot-chat-message-text\" ref=\"content\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"ai__copilot-chat-message_status-info\">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-if=\"messageData.dateCreate\"\n\t\t\t\t\t\t\tclass=\"ai__copilot-chat-message_time\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ formattedDeliveryTime }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-if=\"messageData.status && isMessageFromCopilot === false\"\n\t\t\t\t\t\t\tclass=\"ai__copilot-chat-message_status\"\n\t\t\t\t\t\t\t:class=\"'--' + messageData.status\"\n\t\t\t\t\t\t></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-if=\"messageButtons.length > 0\" class=\"ai__copilot-chat-message_action-buttons\">\n\t\t\t\t\t<button\n\t\t\t\t\t\tv-for=\"button in messageButtons\"\n\t\t\t\t\t\tclass=\"ai__copilot-chat-message_action-button\"\n\t\t\t\t\t\t:class=\"{'--selected': button.selected}\"\n\t\t\t\t\t\t:disabled=\"isSomeButtonSelected || disableAllActions\"\n\t\t\t\t\t\t@click=\"$emit('buttonClick', button.id)\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ button.title }}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if=\"showMenuButton\"\n\t\t\t\tclass=\"ai__copilot-chat-message_menu\"\n\t\t\t>\n\t\t\t\t<CopilotChatMessageMenu\n\t\t\t\t\t:menu-items=\"menuItems\"\n\t\t\t\t\t:message=\"message\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-else-if=\"isErrorMessage\"\n\t\t\t\tclass=\"ai__copilot-chat-message_retry-button\"\n\t\t\t>\n\t\t\t\t<CopilotChatMessageMenu\n\t\t\t\t\t:menu-items=\"errorMessageMenuItems\"\n\t\t\t\t\t:message=\"message\"\n\t\t\t\t\t:icon=\"Icons.REDO_1\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import type { CopilotChatMessage } from '../../types';\n\nimport '../../css/copilot-chat-message-welcome.css';\nexport const CopilotChatMessageWelcome = {\n\tprops: {\n\t\tmessage: {\n\t\t\ttype: Object,\n\t\t\trequired: false,\n\t\t},\n\t\tavatar: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t},\n\t},\n\tcomputed: {\n\t\tmessageInfo(): CopilotChatMessage {\n\t\t\treturn this.message;\n\t\t},\n\t\ttitle(): string {\n\t\t\treturn this.messageInfo.params?.title ?? '';\n\t\t},\n\t\tsubtitle(): string {\n\t\t\treturn this.messageInfo.params?.subtitle ?? '';\n\t\t},\n\t\tcontent(): string {\n\t\t\treturn this.messageInfo.params?.content ?? '';\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"ai__copilot-chat-message-welcome\">\n\t\t\t<header class=\"ai__copilot-chat-message-welcome_header\">\n\t\t\t\t<div class=\"ai__copilot-chat-message-welcome_header-left\">\n\t\t\t\t\t<img\n\t\t\t\t\t\t:src=\"avatar\"\n\t\t\t\t\t\talt=\"#\"\n\t\t\t\t\t\tclass=\"ai__copilot-chat-message-welcome_avatar\"\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ai__copilot-chat-message-welcome_header-right\">\n\t\t\t\t\t<h5 class=\"ai__copilot-chat-message-welcome_title\">{{ title }}</h5>\n\t\t\t\t\t<p v-if=\"subtitle\" class=\"ai__copilot-chat-message-welcome_subtitle\">{{ subtitle }}</p>\n\t\t\t\t</div>\n\t\t\t</header>\n\t\t\t<main class=\"ai__copilot-chat-message-welcome_main\">\n\t\t\t\t<div class=\"ai__copilot-chat-message-welcome_content\">\n\t\t\t\t\t<slot name=\"content\">\n\t\t\t\t\t\t{{ content }}\n\t\t\t\t\t</slot>\n\t\t\t\t</div>\n\t\t\t</main>\n\t\t</div>\n\t`,\n};\n","import { bind, Dom, Reflection, Tag } from 'main.core';\nimport 'helper';\nimport { type CopilotChat } from 'ai.copilot-chat.ui';\nimport type { CopilotChatMessage } from '../../types';\nimport { CopilotChatMessageWelcome } from './copilot-chat-message-welcome';\n\nexport const CopilotChatMessageSiteWithAi = {\n\tcomponents: {\n\t\tCopilotChatMessageWelcome,\n\t},\n\tprops: {\n\t\tmessage: {\n\t\t\ttype: Object,\n\t\t\trequired: false,\n\t\t},\n\t\tavatar: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t},\n\t\tdisableAllActions: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tinject: ['instance'],\n\tcomputed: {\n\t\tchatInstance(): CopilotChat {\n\t\t\treturn this.instance;\n\t\t},\n\t\tmessageInfo(): CopilotChatMessage {\n\t\t\treturn {\n\t\t\t\t...this.message,\n\t\t\t\tparams: {\n\t\t\t\t\t...this.message.params,\n\t\t\t\t\ttitle: this.$Bitrix.Loc.getMessage('AI_COPILOT_CHAT_WELCOME_MESSAGE_SITE_WITH_AI_TITLE'),\n\t\t\t\t\tsubtitle: '',\n\t\t\t\t\tcontent: '',\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t},\n\tmethods: {\n\t\trenderContent(): void {\n\t\t\tconst buttons = this.messageInfo.params?.buttons ?? [];\n\n\t\t\tconst isMessageHaveCreateSiteButton = buttons.length > 0;\n\n\t\t\tconst paragraph2 = isMessageHaveCreateSiteButton\n\t\t\t\t? this.$Bitrix.Loc.getMessage('AI_COPILOT_CHAT_WELCOME_MESSAGE_SITE_WITH_AI_2', {\n\t\t\t\t\t'#LINK#': `<a href=\"#\" class=\"${this.disableAllActions ? 'disabled' : ''}\" ref=\"createSiteLink\">`,\n\t\t\t\t\t'#/LINK#': '</a>',\n\t\t\t\t}) : ''\n\t\t\t;\n\n\t\t\tconst content = Tag.render`\n\t\t\t\t<div ref=\"root\">\n\t\t\t\t\t<p>${this.$Bitrix.Loc.getMessage('AI_COPILOT_CHAT_WELCOME_MESSAGE_SITE_WITH_AI_1')}</p>\n\t\t\t\t\t<p>${paragraph2}</p>\n\t\t\t\t\t<a href=\"#\" ref=\"infoLink\">${this.$Bitrix.Loc.getMessage('AI_COPILOT_CHAT_WELCOME_LINK_SITE_WITH_AI')}</a>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tbind(content.infoLink, 'click', () => {\n\t\t\t\tconst Helper = Reflection.getClass('top.BX.Helper');\n\t\t\t\tif (Helper)\n\t\t\t\t{\n\t\t\t\t\tHelper.show('redirect=detail&code=24409174');\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (isMessageHaveCreateSiteButton)\n\t\t\t{\n\t\t\t\tbind(content.createSiteLink, 'click', () => {\n\t\t\t\t\tif (!this.messageInfo.params?.buttons || this.messageInfo.params.buttons.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.chatInstance.addUserMessage({\n\t\t\t\t\t\ttype: 'ButtonClicked',\n\t\t\t\t\t\tcontent: this.messageInfo.params?.buttons[0]?.text,\n\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\tmessageId: this.messageInfo.id,\n\t\t\t\t\t\t\tbuttonId: this.messageInfo.params?.buttons[0]?.id,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.$refs.content.innerHTML = '';\n\t\t\tDom.append(content.root, this.$refs.content);\n\t\t},\n\t},\n\twatch: {\n\t\tdisableAllActions() {\n\t\t\tthis.renderContent();\n\t\t},\n\t},\n\tmounted() {\n\t\tthis.renderContent();\n\t},\n\ttemplate: `\n\t\t<CopilotChatMessageWelcome\n\t\t\t:avatar=\"avatar\"\n\t\t\t:message=\"messageInfo\"\n\t\t>\n\t\t\t<template #content>\n\t\t\t\t<div ref=\"content\"></div>\n\t\t\t</template>\n\t\t</CopilotChatMessageWelcome>\n\t`,\n};\n","import type { CopilotChatMessage } from '../../types';\nimport { CopilotChatMessageWelcome } from './copilot-chat-message-welcome';\n\nexport const CopilotChatMessageWelcomeFlows = {\n\tcomponents: {\n\t\tCopilotChatMessageWelcome,\n\t},\n\tprops: {\n\t\tmessage: {\n\t\t\ttype: Object,\n\t\t\trequired: false,\n\t\t},\n\t\tavatar: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t},\n\t},\n\tcomputed: {\n\t\tmessageInfo(): CopilotChatMessage {\n\t\t\treturn this.message;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<CopilotChatMessageWelcome\n\t\t\t:avatar=\"avatar\"\n\t\t\t:message=\"messageInfo\"\n\t\t/>\n\t`,\n};\n","export * from './copilot-chat-message-default';\nexport * from './copilot-chat-message-site-with-ai';\nexport * from './copilot-chat-message-welcome';\nexport * from './copilot-chat-message-welcome-flows';\n\nexport const CopilotChatMessageColor = Object.freeze({\n\tUSER: 'user',\n\tCOPILOT: 'copilot',\n\tERROR: 'error',\n\tUSER_WITH_HIGHLIGHT_TEXT: 'userWithHighlightText',\n});\n","import { Dom } from 'main.core';\nimport { CopilotChatMessageStatus } from '../copilot-chat';\nimport { isMessageFromCopilot } from '../helpers/is-message-from-copilot';\nimport { CopilotChatMessage } from './copilot-chat-message';\nimport { CopilotChatWelcomeMessage } from './copilot-chat-welcome-message';\nimport { CopilotChatMessagesDateGroup } from './copilot-chat-messages-date-group';\nimport { CopilotChatMessagesAuthorGroup } from './copilot-chat-messages-author-group';\nimport { type CopilotChatMessage as CopilotChatMessageData, CopilotChatMessageType } from '../types';\nimport { CopilotChatNewMessageVisibilityObserver } from './directives/copilot-chat-new-message-visibility-observer';\nimport {\n\tCopilotChatMessageDefault,\n\tCopilotChatMessageWelcome,\n\tCopilotChatMessageSiteWithAi,\n\tCopilotChatMessageWelcomeFlows, CopilotChatMessageColor,\n} from './message';\n\nimport '../css/copilot-chat-messages.css';\n\nexport const CopilotChatMessages = {\n\tcomponents: {\n\t\tCopilotChatMessage,\n\t\tCopilotChatWelcomeMessage,\n\t\tCopilotChatMessageDefault,\n\t\tCopilotChatMessageWelcome,\n\t\tCopilotChatMessageSiteWithAi,\n\t\tCopilotChatMessageWelcomeFlows,\n\t\tCopilotChatMessagesDateGroup,\n\t\tCopilotChatMessagesAuthorGroup,\n\t},\n\temits: ['clickMessageButton', 'retry', 'remove'],\n\tprops: {\n\t\tmessages: {\n\t\t\ttype: Array,\n\t\t\trequired: false,\n\t\t\tdefault: () => ([]),\n\t\t},\n\t\tcopilotAvatar: String,\n\t\tuserAvatar: String,\n\t\tcopilotMessageTitle: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: '',\n\t\t},\n\t\tuserMessageMenuItems: {\n\t\t\ttype: Array,\n\t\t\trequired: false,\n\t\t\tdefault: () => ([]),\n\t\t},\n\t\tcopilotMessageMenuItems: {\n\t\t\ttype: Array,\n\t\t\trequired: false,\n\t\t\tdefault: () => ([]),\n\t\t},\n\t\twelcomeMessageHtmlElement: HTMLElement,\n\t},\n\tinject: ['observer'],\n\tdirectives: {\n\t\tCopilotChatNewMessageVisibilityObserver,\n\t},\n\tcomputed: {\n\t\tmessagesList(): CopilotChatMessageData[] {\n\t\t\treturn this.messages;\n\t\t},\n\t\tmessagesGroupedByDayAndAuthor(): Array {\n\t\t\tconst groupsOfMessages = this.groupMessagesByDay(this.messagesList);\n\n\t\t\tconst result = {};\n\n\t\t\tObject.entries(groupsOfMessages).forEach(([date: string, { messages, isNewMessagesStartHere }]) => {\n\t\t\t\tresult[date] = this.groupMessagesByAuthor(messages, isNewMessagesStartHere);\n\t\t\t});\n\n\t\t\treturn result;\n\t\t},\n\t\tsortedByDateMessagesGroups(): string[] {\n\t\t\treturn Object.keys(this.messagesGroupedByDayAndAuthor).sort();\n\t\t},\n\t},\n\tmethods: {\n\t\tgroupMessagesByDay(messages: CopilotChatMessageData[]): { [string]: CopilotChatMessageData[] } {\n\t\t\tlet isMessagesContainsUnread = false;\n\n\t\t\treturn messages.reduce((groupedMessages, message) => {\n\t\t\t\tconst messageDeliveryDate = new Date(message.dateCreate);\n\t\t\t\tconst messageIsoDate = this.formatISODate(messageDeliveryDate);\n\n\t\t\t\tif (groupedMessages[messageIsoDate] === undefined)\n\t\t\t\t{\n\t\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\t\tgroupedMessages[messageIsoDate] = {\n\t\t\t\t\t\tmessages: [],\n\t\t\t\t\t\tisNewMessagesStartHere: false,\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tif (message.viewed === false && isMessagesContainsUnread === false)\n\t\t\t\t{\n\t\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\t\tgroupedMessages[messageIsoDate].isNewMessagesStartHere = true;\n\t\t\t\t\tisMessagesContainsUnread = true;\n\t\t\t\t}\n\n\t\t\t\tgroupedMessages[messageIsoDate].messages.push(message);\n\n\t\t\t\treturn groupedMessages;\n\t\t\t}, {});\n\t\t},\n\t\tgroupMessagesByAuthor(messages: CopilotChatMessageData[], isNewMessagesStartHere: boolean): Array {\n\t\t\tlet currentAuthor: number | null = -Infinity;\n\n\t\t\tlet isNewMessagesLabelWasAdded = false;\n\n\t\t\treturn messages.reduce((messagesGroupedByAuthor: Array, message) => {\n\t\t\t\tif (message.viewed === false && isNewMessagesLabelWasAdded === false && isNewMessagesStartHere === true)\n\t\t\t\t{\n\t\t\t\t\tmessagesGroupedByAuthor.push([\n\t\t\t\t\t\tmessage.authorId,\n\t\t\t\t\t\t[],\n\t\t\t\t\t\ttrue,\n\t\t\t\t\t]);\n\n\t\t\t\t\tisNewMessagesLabelWasAdded = true;\n\t\t\t\t}\n\t\t\t\telse if (message.authorId !== currentAuthor)\n\t\t\t\t{\n\t\t\t\t\tmessagesGroupedByAuthor.push([\n\t\t\t\t\t\tmessage.authorId,\n\t\t\t\t\t\t[],\n\t\t\t\t\t]);\n\n\t\t\t\t\tcurrentAuthor = message.authorId;\n\t\t\t\t}\n\n\t\t\t\tmessagesGroupedByAuthor.at(-1)[1].push(message);\n\n\t\t\t\treturn messagesGroupedByAuthor;\n\t\t\t}, []);\n\t\t},\n\t\tgetMessageMenuItems(message: CopilotChatMessageData): Array {\n\t\t\tif (message.authorId === null || message.authorId === undefined)\n\t\t\t{\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\treturn isMessageFromCopilot(message.authorId) ? this.copilotMessageMenuItems : this.userMessageMenuItems;\n\t\t},\n\t\tformatISODate(date: Date): string {\n\t\t\tconst year = date.getFullYear();\n\t\t\tconst month = (date.getMonth() + 1).toString().padStart(2, '0');\n\t\t\tconst day = date.getDate().toString().padStart(2, '0');\n\n\t\t\treturn `${year}-${month}-${day}`;\n\t\t},\n\t\tgetMessageColor(message: CopilotChatMessageData): string {\n\t\t\tif (message.status === CopilotChatMessageStatus.ERROR)\n\t\t\t{\n\t\t\t\treturn CopilotChatMessageColor.ERROR;\n\t\t\t}\n\n\t\t\tif (message.type === CopilotChatMessageType.SYSTEM)\n\t\t\t{\n\t\t\t\treturn CopilotChatMessageColor.ERROR;\n\t\t\t}\n\n\t\t\tif (message.type === CopilotChatMessageType.BUTTON_CLICK_MESSAGE)\n\t\t\t{\n\t\t\t\treturn CopilotChatMessageColor.USER_WITH_HIGHLIGHT_TEXT;\n\t\t\t}\n\n\t\t\tif (isMessageFromCopilot(message.authorId))\n\t\t\t{\n\t\t\t\treturn CopilotChatMessageColor.COPILOT;\n\t\t\t}\n\n\t\t\treturn CopilotChatMessageColor.USER;\n\t\t},\n\t\tgetMessageComponent(message: CopilotChatMessageData): Object {\n\t\t\tswitch (message.type)\n\t\t\t{\n\t\t\t\tcase CopilotChatMessageType.DEFAULT: return CopilotChatMessageDefault;\n\t\t\t\tcase CopilotChatMessageType.SYSTEM: return CopilotChatMessageDefault;\n\t\t\t\tcase CopilotChatMessageType.WELCOME_FLOWS: return CopilotChatMessageWelcomeFlows;\n\t\t\t\tcase CopilotChatMessageType.WELCOME_SITE_WITH_AI: return CopilotChatMessageSiteWithAi;\n\t\t\t\tdefault: return CopilotChatMessageDefault;\n\t\t\t}\n\t\t},\n\t\tgetMessageTitle(authorId: string): ?string {\n\t\t\treturn this.isMessageFromCopilot(authorId)\n\t\t\t\t? this.copilotMessageTitle\n\t\t\t\t: ''\n\t\t\t;\n\t\t},\n\t\tgetMessageAvatarByAuthorId(authorId: number): ?string {\n\t\t\treturn this.isMessageFromCopilot(authorId)\n\t\t\t\t? this.copilotAvatar\n\t\t\t\t: this.userAvatar\n\t\t\t;\n\t\t},\n\t\tgetAuthorMessagesGroupAvatar(authorId: number, messages: CopilotChatMessageData[]): string\n\t\t{\n\t\t\tconst lastMessage = messages.at(-1);\n\t\t\tconst isLastMessageIsWelcome = lastMessage.type !== 'Default'\n\t\t\t\t&& lastMessage.type !== 'ButtonClicked'\n\t\t\t\t&& lastMessage.type !== 'System'\n\t\t\t;\n\n\t\t\tif (authorId === null || authorId === undefined || isLastMessageIsWelcome)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn this.getMessageAvatarByAuthorId(authorId);\n\t\t},\n\t\tisMessageFromCopilot(authorId: number): boolean {\n\t\t\treturn authorId < 1;\n\t\t},\n\t\tisMessageHaveButtons(message: CopilotChatMessageData): boolean {\n\t\t\treturn message?.params?.buttons?.length > 0;\n\t\t},\n\t\thandleMessageButtonClick(messageId: number, buttonId: number): void {\n\t\t\tthis.$emit('clickMessageButton', {\n\t\t\t\tmessageId,\n\t\t\t\tbuttonId,\n\t\t\t});\n\t\t},\n\t\tisLastMessage(message: CopilotChatMessageData): boolean {\n\t\t\treturn message.id === this.messages.at(-1).id;\n\t\t},\n\t\thandleMessageRetry(messageId: number): void {\n\t\t\tthis.$emit('retry', messageId);\n\t\t},\n\t\thandleMessageRemove(messageId: number): void {\n\t\t\tthis.$emit('remove', messageId);\n\t\t},\n\t},\n\tmounted() {\n\t\tDom.append(this.welcomeMessageHtmlElement, this.$refs.welcomeMessage);\n\t},\n\ttemplate: `\n\t\t<div class=\"ai__copilot-chat-messages-wrapper\">\n\t\t\t<CopilotChatMessagesDateGroup\n\t\t\tv-for=\"(date, dateGroupIndex) of sortedByDateMessagesGroups\"\n\t\t\t:date=\"date\"\n\t\t\t>\n\t\t\t\t<CopilotChatMessagesAuthorGroup\n\t\t\t\t\tv-for=\"([authorId, messagesFromCurrentAuthor, showNewMessagesLabel], authorGroupIndex) in messagesGroupedByDayAndAuthor[date]\"\n\t\t\t\t\t:avatar=\"getAuthorMessagesGroupAvatar(authorId, messagesFromCurrentAuthor)\"\n\t\t\t\t\t:show-new-messages-label=\"showNewMessagesLabel\"\n\t\t\t\t>\n\t\t\t\t\t<ul class=\"ai__copilot-chat-messages\">\n\t\t\t\t\t\t<li\n\t\t\t\t\t\t\tv-for=\"(message, index) of messagesFromCurrentAuthor\"\n\t\t\t\t\t\t\t:key=\"message.id\"\n\t\t\t\t\t\t\tclass=\"ai__copilot-chat-messages_message-wrapper\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<component :is=\"getMessageComponent(message)\" \n\t\t\t\t\t\t\t\t\tv-copilot-chat-new-message-visibility-observer=\"message.viewed\"\n\t\t\t\t\t\t\t\t\t@buttonClick=\"handleMessageButtonClick(message.id, $event)\"\n\t\t\t\t\t\t\t\t\t@retry=\"handleMessageRetry\" \n\t\t\t\t\t\t\t\t\t@remove=\"handleMessageRemove\"\n\t\t\t\t\t\t\t\t\t:message=\"message\"\n\t\t\t\t\t\t\t\t\t:title=\"getMessageTitle(message.authorId)\"\n\t\t\t\t\t\t\t\t\t:color=\"getMessageColor(message)\"\n\t\t\t\t\t\t\t\t\t:avatar=\"getMessageAvatarByAuthorId(message.authorId)\"\n\t\t\t\t\t\t\t\t\t:useAvatarTail=\"index === messagesFromCurrentAuthor.length - 1 && isMessageHaveButtons(message) === false\"\n\t\t\t\t\t\t\t\t\t:disable-all-actions=\"isLastMessage(message) === false\"\n\t\t\t\t\t\t\t\t\t:menu-items=\"getMessageMenuItems(message)\"\n\t\t\t\t\t\t\t></component>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t</ul>\n\t\t\t\t</CopilotChatMessagesAuthorGroup>\n\t\t\t</CopilotChatMessagesDateGroup>\n\t\t</div>\n\t`,\n};\n","import { Loc } from 'main.core';\nimport { Loader } from 'main.loader';\n\nimport '../css/copilot-chat-history-loader.css';\n\nexport const CopilotChatHistoryLoader = {\n\tprops: {\n\t\ttext: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: Loc.getMessage('AI_COPILOT_CHAT_MESSAGES_HISTORY_LOADER_TEXT'),\n\t\t},\n\t},\n\tbeforeMount() {\n\t\tconst color = getComputedStyle(document.body).getPropertyValue('--ui-color-base-02');\n\n\t\tthis.loader = new Loader({\n\t\t\tcolor,\n\t\t\tsize: 60,\n\t\t});\n\t},\n\tmounted() {\n\t\tthis.loader.show(this.$refs.loaderContainer);\n\t},\n\tunmounted() {\n\t\tthis.loader.hide();\n\t\tthis.loader = null;\n\t},\n\ttemplate: `\n\t\t<div class=\"ai__copilot-chat-history-loader\">\n\t\t\t<div ref=\"loaderContainer\" class=\"ai__copilot-chat-history-loader_animation-container\"></div>\n\t\t\t<div class=\"ai__copilot-chat_history-loader_text\">\n\t\t\t\t{{ text }}\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Reflection, Tag, Event, Dom } from 'main.core';\n\nexport const CopilotChatWarningMessage = {\n\tname: 'CopilotWarningMessage',\n\tmethods: {\n\t\tshowArticle(): void {\n\t\t\tconst Helper = Reflection.getClass('top.BX.Helper');\n\t\t\tconst articleCode: string = '20412666';\n\n\t\t\tHelper?.show(`redirect=detail&code=${articleCode}`);\n\t\t},\n\t},\n\tmounted() {\n\t\tconst warningMessage = Tag.render`<span>${this.$Bitrix.Loc.getMessage('AI_COPILOT_CHAT_ANSWER_WARNING_1', {\n\t\t\t'#LINK_START#': '<a ref=\"link\" href=\"#\">',\n\t\t\t'#LINK_END#': '</a>',\n\t\t})}</span>`;\n\n\t\tEvent.bind(warningMessage.link, 'click', this.showArticle);\n\n\t\tDom.append(warningMessage.root, this.$refs.container);\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tref=\"container\"\n\t\t\tclass=\"ai__copilot-chat-warning-message\"\n\t\t></div>\n\t`,\n};\n","import '../css/copilot-chat-loading-bar.css';\n\nimport type { JsonObject } from 'main.core';\n\nexport const CopilotChatLoadingBar = {\n\tname: 'LoadingBar',\n\tdata(): JsonObject\n\t{\n\t\treturn {};\n\t},\n\ttemplate: `\n\t\t<div class=\"ai__copilot-chat-loading-bar\"></div>\n\t`,\n};\n","import '../css/copilot-chat-load-history-error.css';\n\nexport const CopilotChatLoadHistoryError = {\n\tevents: ['retryButtonClick'],\n\tmethods: {\n\t\tloc(phraseCode: string): ?string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t\thandleClickOnRetryButton(event: MouseEvent): void\n\t\t{\n\t\t\tconst target = event.target;\n\n\t\t\ttarget.blur();\n\n\t\t\tthis.$emit('retryButtonClick');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"ai__copilot-chat-load-history-error\">\n\t\t\t<div class=\"ai__copilot-chat-load-history-error_icon-wrapper\">\n\t\t\t\t<div class=\"ai__copilot-chat-load-history-error_icon\"></div>\n\t\t\t</div>\n\t\t\t<div class=\"ai__copilot-chat-load-history-error_title\">\n\t\t\t\t{{ loc('AI_COPILOT_CHAT_LOAD_HISTORY_ERROR_TITLE') }}\n\t\t\t</div>\n\t\t\t<div class=\"ai__copilot-chat-load-history-error_text\">\n\t\t\t\t{{ loc('AI_COPILOT_CHAT_LOAD_HISTORY_ERROR_TEXT') }}\n\t\t\t</div>\n\t\t\t<button\n\t\t\t\tclass=\"ai__copilot-chat-load-history-error_button\"\n\t\t\t\t@click=\"handleClickOnRetryButton\"\n\t\t\t>\n\t\t\t\t{{ loc('AI_COPILOT_CHAT_LOAD_HISTORY_ERROR_RETRY') }}\n\t\t\t</button>\n\t\t</div>\n\t`,\n};\n","import { bind } from 'main.core';\nimport type { MenuItemOptions } from 'main.popup';\nimport { CopilotChatEvents } from '../copilot-chat';\n\nimport type { CopilotChatBotOptions, CopilotChat as CopilotChatInstance } from '../copilot-chat';\nimport { NewMessagesVisibilityObserver, NewMessagesVisibilityObserverEvents } from '../helpers/new-messages-visibility-observer';\nimport { CopilotChatHeader } from './copilot-chat-header';\nimport { CopilotChatInput } from './copilot-chat-input';\nimport type { CopilotChatMessage as CopilotChatMessageData } from '../types';\nimport { CopilotChatMessages } from './copilot-chat-messages';\nimport { CopilotChatHistoryLoader } from './copilot-chat-history-loader';\nimport { containerClassname as newMessagesLabelContainerClassname } from './copilot-chat-new-messages-label';\nimport { CopilotChatStatus } from './copilot-chat-status';\nimport { CopilotChatWarningMessage } from './copilot-chat-warning-message';\nimport { CopilotChatLoadingBar } from './copilot-chat-loading-bar';\nimport { CopilotChatLoadHistoryError } from './copilot-chat-load-history-error';\n\nimport '../css/copilot-chat.css';\nexport type CopilotChatHeaderProps = {\n\ttitle: string;\n\tsubtitle: string;\n\tavatar: string;\n\tuseCloseIcon?: boolean;\n\tmenu: ?CopilotChatMenuOptions;\n\textraParams?: Object;\n}\n\nexport type CopilotChatMenuOptions = {\n\titems: MenuItemOptions[];\n}\n\ntype CopilotChatData = {\n\tmessages: CopilotChatMessageData;\n}\n\nexport type CopilotChatSlots = {\n\tLOADER?: string;\n\tLOADER_ERROR?: string;\n};\n\nexport const CopilotChatSlot = {\n\tLOADER: 'loader',\n};\n\nexport const CopilotChat = {\n\tname: 'CopilotChat',\n\tcomponents: {\n\t\tCopilotChatHeader,\n\t\tCopilotChatMessages,\n\t\tCopilotChatInput,\n\t\tCopilotChatHistoryLoader,\n\t\tCopilotChatStatus,\n\t\tCopilotChatWarningMessage,\n\t\tCopilotChatLoadingBar,\n\t\tCopilotChatLoadHistoryError,\n\t},\n\tprops: {\n\t\theader: Object,\n\t\twelcomeMessageHtml: HTMLElement,\n\t\tbotOptions: Object,\n\t\tscrollToTheEndAfterFirstShow: Object,\n\t\tslots: Object,\n\t\tisShowWarningMessage: {\n\t\t\ttype: Object,\n\t\t\trequired: false,\n\t\t\tdefault: () => ({ value: false }),\n\t\t},\n\t\tmessages: Array,\n\t\tcopilotChatInstance: Object,\n\t\tuseInput: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t\tdefault: true,\n\t\t},\n\t\tdisableInput: Object,\n\t\tshowLoader: Object,\n\t\tisOldMessagesLoading: Object,\n\t\tshowCopilotWritingStatus: Object,\n\t\tstatus: Object,\n\t\tuseStatus: Object,\n\t\tcopilotMessageMenuItems: {\n\t\t\ttype: Array,\n\t\t\trequired: false,\n\t\t\tdefault: () => ([]),\n\t\t},\n\t\tuserAvatar: {\n\t\t\ttype: Object,\n\t\t\trequired: false,\n\t\t},\n\t\tuserMessageMenuItems: {\n\t\t\ttype: Array,\n\t\t\trequired: false,\n\t\t\tdefault: () => ([]),\n\t\t},\n\t\tinputPlaceholder: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: '',\n\t\t},\n\t\tloaderText: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t},\n\t\tisShowLoadHistoryError: {\n\t\t\ttype: Object,\n\t\t},\n\t},\n\tdata(): CopilotChatData {\n\t\treturn {\n\t\t\tisCopilotWriting: false,\n\t\t\tscrollPosition: 0,\n\t\t\tscrollHeight: 0,\n\t\t};\n\t},\n\tprovide(): { instance: CopilotChatInstance} {\n\t\treturn {\n\t\t\tinstance: this.copilotChatInstance,\n\t\t\tobserver: this.observer,\n\t\t};\n\t},\n\tcomputed: {\n\t\tuserPhoto(): string {\n\t\t\treturn this.userAvatar?.value || '/bitrix/js/ui/icons/b24/images/ui-user.svg?v2';\n\t\t},\n\t\tisInputDisabled(): boolean {\n\t\t\treturn this.disableInput.value === true;\n\t\t},\n\t\tisLoaderShown(): boolean {\n\t\t\treturn this.showLoader.value === true;\n\t\t},\n\t\tisLoadingOldMessages(): boolean {\n\t\t\treturn this.isOldMessagesLoading?.value === true;\n\t\t},\n\t\tisWarningMessageShown(): boolean {\n\t\t\treturn this.isShowWarningMessage?.value === true;\n\t\t},\n\t\tinstance(): CopilotChatInstance {\n\t\t\treturn this.copilotChatInstance;\n\t\t},\n\t\tSlot(): CopilotChatSlots {\n\t\t\treturn {\n\t\t\t\t...this.slots,\n\t\t\t};\n\t\t},\n\t\theaderProps(): CopilotChatHeaderProps {\n\t\t\treturn {\n\t\t\t\ttitle: this.header?.title,\n\t\t\t\tsubtitle: this.header?.subtitle,\n\t\t\t\tavatar: this.header?.avatar,\n\t\t\t\tuseCloseIcon: this.header?.useCloseIcon,\n\t\t\t\tmenu: this.header?.menu,\n\t\t\t};\n\t\t},\n\t\tbotData(): CopilotChatBotOptions {\n\t\t\treturn {\n\t\t\t\tmessageTitle: this.botOptions.messageTitle,\n\t\t\t\tavatar: this.botOptions.avatar,\n\t\t\t\tmessageMenuItems: this.botOptions?.messageMenuItems ?? [],\n\t\t\t};\n\t\t},\n\t\tmessagesList(): CopilotChatMessageData[] {\n\t\t\treturn this.messages;\n\t\t},\n\t\thaveNewMessages(): boolean {\n\t\t\treturn this.messagesList.some((message) => message.viewed === false);\n\t\t},\n\t\tcopilotChatStatus(): string {\n\t\t\treturn this.status.value;\n\t\t},\n\t\tisChatStatusUsed(): boolean {\n\t\t\treturn this.useStatus.value;\n\t\t},\n\t\tisScrollToTheEndAfterMounted(): boolean {\n\t\t\treturn this.scrollToTheEndAfterFirstShow.value;\n\t\t},\n\t},\n\tmethods: {\n\t\thideChat(): void {\n\t\t\tthis.copilotChatInstance.hide();\n\t\t},\n\t\tasync handleSubmitMessage(userMessage: string): void {\n\t\t\tconst newMessage: CopilotChatMessageData = {\n\t\t\t\tcontent: userMessage,\n\t\t\t};\n\n\t\t\tthis.instance.addUserMessage(newMessage);\n\t\t},\n\t\tscrollMessagesListAfterOpen(): void {\n\t\t\tif (this.haveNewMessages)\n\t\t\t{\n\t\t\t\tconst newMessagesLabel: HTMLElement = this.$refs.main.querySelector(`.${newMessagesLabelContainerClassname}`);\n\n\t\t\t\tnewMessagesLabel?.scrollIntoView();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.scrollMessagesListToTheEnd();\n\t\t\t}\n\t\t},\n\t\tscrollMessagesListToTheEnd(isSmooth: boolean = false): void {\n\t\t\tthis.$refs.main.scrollTo({\n\t\t\t\tleft: 0,\n\t\t\t\ttop: 9999,\n\t\t\t\tbehavior: isSmooth ? 'smooth' : 'auto',\n\t\t\t});\n\t\t},\n\t\thandleClickOnMessageButton(eventData): void {\n\t\t\tthis.instance.emitClickOnMessageButton({\n\t\t\t\tmessageId: eventData.messageId,\n\t\t\t\tbuttonId: eventData.buttonId,\n\t\t\t});\n\t\t},\n\t\thandleAddNewUserMessage(): void {\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tthis.scrollMessagesListToTheEnd(true);\n\t\t\t});\n\t\t},\n\t\trestoreScrollPosition(): void {\n\t\t\tthis.scrollPosition = this.$refs.main.scrollTop;\n\t\t\tthis.scrollHeight = this.$refs.main.scrollHeight;\n\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tthis.$refs.main.scrollTop = this.$refs.main.scrollHeight - this.scrollHeight + this.scrollPosition;\n\t\t\t});\n\t\t},\n\t\thandleRetryMessage(messageId: number): void {\n\t\t\tthis.instance.emit(CopilotChatEvents.RETRY_SEND_MESSAGE, {\n\t\t\t\tmessageId,\n\t\t\t});\n\t\t},\n\t\thandleRemoveMessage(messageId: number): void {\n\t\t\tthis.instance.emit(CopilotChatEvents.REMOVE_MESSAGE, {\n\t\t\t\tmessageId,\n\t\t\t});\n\t\t},\n\t\thandleRetryLoadHistoryButtonClick()\n\t\t{\n\t\t\tthis.instance.emitRetryLoadHistory();\n\t\t},\n\t},\n\tbeforeCreate() {\n\t\tthis.observer = new NewMessagesVisibilityObserver();\n\n\t\tthis.observer.subscribe(NewMessagesVisibilityObserverEvents.VIEW_NEW_MESSAGE, (event) => {\n\t\t\tthis.instance.setNewMessageIsViewed(event.getData().id);\n\t\t});\n\t},\n\tmounted() {\n\t\tthis.observer.setRoot(this.$refs.main);\n\t\tthis.observer.init();\n\n\t\tthis.instance.subscribe(CopilotChatEvents.ADD_USER_MESSAGE, this.handleAddNewUserMessage);\n\n\t\trequestAnimationFrame(() => {\n\t\t\tif (this.isScrollToTheEndAfterMounted)\n\t\t\t{\n\t\t\t\tthis.scrollMessagesListAfterOpen();\n\t\t\t}\n\t\t});\n\n\t\tbind(this.$refs.main, 'scroll', (event: Event) => {\n\t\t\tconst scrollElement: HTMLElement = event.target;\n\n\t\t\tif ((scrollElement.scrollTop / scrollElement.scrollHeight) < 0.05)\n\t\t\t{\n\t\t\t\tthis.instance.emit(CopilotChatEvents.MESSAGES_SCROLL_TOP);\n\t\t\t}\n\t\t});\n\t},\n\tbeforeUnmount() {\n\t\tthis.instance.unsubscribe(CopilotChatEvents.ADD_USER_MESSAGE, this.handleAddNewUserMessage);\n\t},\n\twatch: {\n\t\tisLoaderShown(newValue: boolean, oldValue: boolean) {\n\t\t\tif (newValue === false && oldValue === true)\n\t\t\t{\n\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\tthis.scrollMessagesListToTheEnd();\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\t'messagesList.length': function(newMessagesCount, oldMessagesCount) {\n\t\t\tif (newMessagesCount - oldMessagesCount === 1)\n\t\t\t{\n\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\tthis.scrollMessagesListToTheEnd(true);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (oldMessagesCount > 1 && newMessagesCount > 1)\n\t\t\t{\n\t\t\t\tthis.restoreScrollPosition();\n\t\t\t}\n\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tif (oldMessagesCount === 0 && newMessagesCount > 1 && this.isScrollToTheEndAfterMounted)\n\t\t\t\t{\n\t\t\t\t\tthis.scrollMessagesListToTheEnd();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"ai__copilot-chat\">\n\t\t\t<header class=\"ai__copilot-chat_header\">\n\t\t\t\t<CopilotChatHeader\n\t\t\t\t\t:title=\"headerProps.title\"\n\t\t\t\t\t:subtitle=\"headerProps.subtitle\"\n\t\t\t\t\t:avatar=\"headerProps.avatar\"\n\t\t\t\t\t:use-close-icon=\"headerProps.useCloseIcon\"\n\t\t\t\t\t:menu=\"headerProps.menu\"\n\t\t\t\t\t@clickOnCloseIcon=\"hideChat\"\n\t\t\t\t/>\n\t\t\t\t<div class=\"ai__copilot-chat_loading-bar\" v-if=\"isLoadingOldMessages\">\n\t\t\t\t\t<CopilotChatLoadingBar />\n\t\t\t\t</div>\n\t\t\t</header>\n\t\t\t<main ref=\"main\" class=\"ai__copilot-chat_main\">\n\t\t\t\t<TransitionGroup name=\"main\">\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"isLoaderShown\"\n\t\t\t\t\tclass=\"ai__copilot-chat_main-loader-container\"\n\t\t\t\t>\n\t\t\t\t\t<slot name=\"loader\">\n\t\t\t\t\t\t<CopilotChatHistoryLoader :text=\"loaderText\" />\n\t\t\t\t\t</slot>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tv-else-if=\"isShowLoadHistoryError.value\"\n\t\t\t\t\tclass=\"ai__copilot-chat_load-history-error\"\n\t\t\t\t>\n\t\t\t\t\t<slot name=\"loaderError\">\n\t\t\t\t\t\t<CopilotChatLoadHistoryError @retryButtonClick=\"handleRetryLoadHistoryButtonClick\" />\n\t\t\t\t\t</slot>\n\t\t\t\t</div>\n\t\t\t\t\t<CopilotChatMessages\n\t\t\t\t\t\tv-else\n\t\t\t\t\t\t@clickMessageButton=\"handleClickOnMessageButton\"\n\t\t\t\t\t\t@retry=\"handleRetryMessage\"\n\t\t\t\t\t\t@remove=\"handleRemoveMessage\"\n\t\t\t\t\t\t:user-avatar=\"userPhoto\"\n\t\t\t\t\t\t:copilot-avatar=\"botData.avatar\"\n\t\t\t\t\t\t:messages=\"messagesList\"\n\t\t\t\t\t\t:welcome-message-html-element=\"welcomeMessageHtml\"\n\t\t\t\t\t\t:copilot-message-title=\"botData.messageTitle\"\n\t\t\t\t\t\t:copilot-message-menu-items=\"botData.messageMenuItems\"\n\t\t\t\t\t\t:user-message-menu-items=\"userMessageMenuItems\"\n\t\t\t\t\t></CopilotChatMessages>\n\t\t\t\t</TransitionGroup>\n\t\t\t\t<CopilotChatStatus\n\t\t\t\t\tv-if=\"isLoaderShown === false && isChatStatusUsed\"\n\t\t\t\t\t:status=\"copilotChatStatus\"\n\t\t\t\t/>\n\t\t\t\t<div id=\"anchor\"></div>\n\t\t\t</main>\n\t\t\t<footer class=\"ai__copilot-chat_footer\">\n\t\t\t\t<CopilotChatInput\n\t\t\t\t\tv-if=\"useInput\"\n\t\t\t\t\t:disabled=\"isInputDisabled\"\n\t\t\t\t\t:placeholder=\"inputPlaceholder\"\n\t\t\t\t\t@submit=\"handleSubmitMessage\"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"isWarningMessageShown\"\n\t\t\t\t\tclass=\"ai__copilot-chat_warning-message\"\n\t\t\t\t>\n\t\t\t\t\t<CopilotChatWarningMessage />\n\t\t\t\t</div>\n\t\t\t</footer>\n\t\t</div>\n\t`,\n};\n","import { Tag, Type, Loc, bind, unbind } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Popup, type PopupOptions, type MenuItemOptions } from 'main.popup';\nimport { type VueRefValue, BitrixVue, ref } from 'ui.vue3';\nimport { Status as CopilotChatStatus } from './components/copilot-chat-status';\nimport { CopilotChat as CopilotChatComponent, type CopilotChatHeaderProps, type CopilotChatSlots } from './components/copilot-chat.js';\n\nimport './css/copilot-chat-popup.css';\nimport type { CopilotChatMessage, CopilotChatMessageButton } from './types';\n\nexport type CopilotChatBotOptions = {\n\tavatar: string;\n\tmessageTitle: string;\n\tmessageMenuItems: MenuItemOptions[],\n}\n\nexport const CopilotChatEvents = Object.freeze({\n\tADD_USER_MESSAGE: 'addUserMessage',\n\tADD_BOT_MESSAGE: 'addBotMessage',\n\tADD_OLD_MESSAGES: 'addBotMessage',\n\tADD_NEW_MESSAGES: 'addMessages',\n\tCLICK_ON_MESSAGE_BUTTON: 'clickOnMessageButton',\n\tVIEW_NEW_MESSAGE: 'viewMessage',\n\tSHOW_LOADER: 'showLoader',\n\tHIDE_LOADER: 'hideLoader',\n\tSHOW_COPILOT_WRITING_LOADER: 'showCopilotWritingLoader',\n\tHIDE_COPILOT_WRITING_LOADER: 'hideCopilotWritingLoader',\n\tDISABLE_INPUT_FIELD: 'disableInputField',\n\tENABLE_INPUT_FIELD: 'enableInputField',\n\tSET_MESSAGE_STATUS: 'setMessageStatus',\n\tSHOW_ERROR_SCREEN: 'showErrorScreen',\n\tHIDE_ERROR_SCREEN: 'hideErrorScreen',\n\tMESSAGES_SCROLL_TOP: 'messagesListScrollTop',\n\tRETRY_SEND_MESSAGE: 'retrySendMessage',\n\tREMOVE_MESSAGE: 'removeMessage',\n\tRETRY_LOAD_HISTORY: 'retryLoadHistory',\n});\n\nexport const CopilotChatMessageStatus = {\n\tDEPART: 'depart',\n\tSENT: 'sent',\n\tDELIVERED: 'delivered',\n\tERROR: 'error',\n};\n\nexport type CopilotChatOptions = {\n\theader: CopilotChatHeaderProps;\n\tbotOptions: CopilotChatBotOptions;\n\tslots: CopilotChatSlots;\n\tvueComponents: Object;\n\tpopupOptions: PopupOptions;\n\tuseChatStatus: boolean;\n\tcopilotMessageMenuItems: MenuItemOptions[];\n\tuserMessageMenuItems: MenuItemOptions[];\n\tscrollToTheEndAfterFirstShow: boolean;\n\tshowCopilotWarningMessage: boolean;\n\tuserAvatar: string;\n\tinputPlaceholder?: string;\n\tloaderText?: string;\n}\n\nexport class CopilotChat extends EventEmitter\n{\n\t#copilotChatOptions: CopilotChatOptions;\n\t#popupOptions: PopupOptions;\n\t#popup: Popup;\n\t#app;\n\t#messages: VueRefValue<CopilotChatMessage[]>;\n\t#isShowLoader: VueRefValue<boolean>;\n\t#isOldMessagesLoading: VueRefValue<boolean>;\n\t#isInputDisabled: VueRefValue<boolean>;\n\t#chatStatus: VueRefValue<string>;\n\t#useChatStatus: VueRefValue<boolean>;\n\t#copilotMessageMenuItems: VueRefValue<MenuItemOptions[]>;\n\t#userMessageMenuItems: VueRefValue<MenuItemOptions[]>;\n\t#scrollToTheEndAfterFirstShow: VueRefValue<boolean>;\n\t#showCopilotWarningMessage: VueRefValue<boolean>;\n\t#copilotChatBotOptions: VueRefValue<CopilotChatBotOptions>;\n\t#userAvatar: VueRefValue<string>;\n\t#inputPlaceholder: string;\n\t#loaderText: ?string;\n\t#isShowLoadHistoryError: VueRefValue<boolean>;\n\n\tconstructor(options: CopilotChatOptions = {})\n\t{\n\t\tsuper(options);\n\n\t\tthis.setEventNamespace('AI.CopilotChat');\n\t\tthis.#copilotChatOptions = options || {};\n\t\tthis.#copilotChatBotOptions = ref(options?.botOptions ?? {});\n\t\tthis.#popupOptions = options?.popupOptions || {};\n\n\t\tthis.#messages = ref([]);\n\t\tthis.#copilotMessageMenuItems = ref(\n\t\t\tType.isArray(options.botOptions.messageMenuItems) ? options.botOptions.messageMenuItems : [],\n\t\t);\n\t\tthis.#userMessageMenuItems = ref(Type.isArray(options.userMessageMenuItems) ? options.userMessageMenuItems : []);\n\t\tthis.#isShowLoader = ref(false);\n\t\tthis.#isInputDisabled = ref(false);\n\t\tthis.#chatStatus = ref(CopilotChatStatus.NONE);\n\t\tthis.#useChatStatus = ref(Type.isBoolean(options.useChatStatus) ? options.useChatStatus : true);\n\t\tthis.#scrollToTheEndAfterFirstShow = ref(\n\t\t\tType.isBoolean(options.scrollToTheEndAfterFirstShow)\n\t\t\t\t? options.scrollToTheEndAfterFirstShow\n\t\t\t\t: true,\n\t\t);\n\t\tthis.#isOldMessagesLoading = ref(false);\n\t\tthis.#showCopilotWarningMessage = ref(options.showCopilotWarningMessage === true);\n\t\tthis.#isShowLoadHistoryError = ref(false);\n\t\tthis.#userAvatar = ref(options.userAvatar ?? '');\n\t\tthis.#inputPlaceholder = options.inputPlaceholder ?? Loc.getMessage('AI_COPILOT_CHAT_INPUT_PLACEHOLDER');\n\t\tthis.#loaderText = options.loaderText;\n\t}\n\n\tstatic getDefaultMinWidth(): number\n\t{\n\t\treturn 375;\n\t}\n\n\tstatic getDefaultHeight(): number\n\t{\n\t\treturn 669;\n\t}\n\n\tstartLoadingOldMessages(): void\n\t{\n\t\tthis.#isOldMessagesLoading.value = true;\n\t}\n\n\tfinishLoadingOldMessages(): void\n\t{\n\t\tthis.#isOldMessagesLoading.value = false;\n\t}\n\n\tisOldMessagesLoading(): boolean\n\t{\n\t\treturn this.#isOldMessagesLoading.value;\n\t}\n\n\tisMessageInList(messageId: number): boolean\n\t{\n\t\treturn this.#messages.value.findLast((message) => {\n\t\t\treturn message.id === messageId;\n\t\t});\n\t}\n\n\tgetFirstMessageId(): ?number\n\t{\n\t\treturn this.#messages.value[0]?.id;\n\t}\n\n\tgetMessageById(messageId: number): ?CopilotChatMessage\n\t{\n\t\treturn this.#messages.value.find((message) => message.id === messageId);\n\t}\n\n\tremoveMessage(messageId: number): void\n\t{\n\t\tconst removedMessageIndex = this.#messages.value.findIndex((message) => message.id === messageId);\n\t\tthis.#messages.value.splice(removedMessageIndex, 1);\n\t}\n\n\tunshiftMessages(messages: CopilotChatMessage[]): void\n\t{\n\t\tconst messagesWithStatus = messages.map((message) => {\n\t\t\treturn {\n\t\t\t\t...message,\n\t\t\t\tstatus: CopilotChatMessageStatus.DELIVERED,\n\t\t\t};\n\t\t});\n\n\t\tthis.#messages.value.unshift(...messagesWithStatus);\n\t}\n\n\taddUserMessage(message: CopilotChatMessage, emitEvent: boolean = true): void\n\t{\n\t\tconst newUserMessage: CopilotChatMessage = {\n\t\t\ttype: 'Default',\n\t\t\t...message,\n\t\t\tauthorId: 1,\n\t\t\tstatus: CopilotChatMessageStatus.DEPART,\n\t\t};\n\n\t\tthis.#addNewMessage(newUserMessage, emitEvent);\n\t}\n\n\taddBotMessage(message: CopilotChatMessage, emitEvent: boolean = true): void\n\t{\n\t\tconst newUserMessage: CopilotChatMessage = {\n\t\t\ttype: 'Default',\n\t\t\t...message,\n\t\t\tauthorId: 0,\n\t\t\tstatus: null,\n\t\t};\n\n\t\tthis.#addNewMessage(newUserMessage, emitEvent);\n\t}\n\n\taddSystemMessage(message: CopilotChatMessage, emitEvent: boolean = true): void\n\t{\n\t\tconst newSystemMessage: CopilotChatMessage = {\n\t\t\t...message,\n\t\t\tauthorId: null,\n\t\t\tstatus: null,\n\t\t};\n\n\t\tthis.#addNewMessage(newSystemMessage, emitEvent);\n\t}\n\n\tenableInput(): void\n\t{\n\t\tthis.#isInputDisabled.value = false;\n\n\t\tthis.emit(CopilotChatEvents.ENABLE_INPUT_FIELD);\n\t}\n\n\tdisableInput(): void\n\t{\n\t\tthis.#isInputDisabled.value = true;\n\n\t\tthis.emit(CopilotChatEvents.DISABLE_INPUT_FIELD);\n\t}\n\n\tshowLoader(): void\n\t{\n\t\tthis.#isShowLoader.value = true;\n\n\t\tthis.emit(CopilotChatEvents.SHOW_LOADER);\n\t}\n\n\thideLoader(): void\n\t{\n\t\tthis.#isShowLoader.value = false;\n\n\t\tthis.emit(CopilotChatEvents.HIDE_LOADER);\n\t}\n\n\tsetMessageStatusDepart(messageId: string): void\n\t{\n\t\tthis.#setMessageStatus(messageId, CopilotChatMessageStatus.DEPART);\n\t}\n\n\tsetMessageStatusDelivered(messageId: string): void\n\t{\n\t\tthis.#setMessageStatus(messageId, CopilotChatMessageStatus.DELIVERED);\n\t}\n\n\tsetMessageStatusSent(messageId: string): void\n\t{\n\t\tthis.#setMessageStatus(messageId, CopilotChatMessageStatus.SENT);\n\t}\n\n\tsetMessageStatusError(messageId: string): void\n\t{\n\t\tthis.#setMessageStatus(messageId, CopilotChatMessageStatus.ERROR);\n\t}\n\n\tsetCopilotWritingStatus(value: boolean): void\n\t{\n\t\tif (value === true)\n\t\t{\n\t\t\tthis.#chatStatus.value = CopilotChatStatus.COPILOT_WRITING;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#chatStatus.value = CopilotChatStatus.NONE;\n\t\t}\n\t}\n\n\tsetNewMessageIsViewed(messageId: number): void\n\t{\n\t\tthis.emit(CopilotChatEvents.VIEW_NEW_MESSAGE, new BaseEvent({\n\t\t\tdata: {\n\t\t\t\tid: messageId,\n\t\t\t},\n\t\t}));\n\t}\n\n\tsetMessageId(messageId: number, newMessageId: number): void\n\t{\n\t\tconst message: ?CopilotChatMessage = this.#messages.value.find((currentMessage) => currentMessage.id === messageId);\n\n\t\tif (!message)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tmessage.id = newMessageId;\n\t}\n\n\tsetMessageDate(messageId: number, date: string): void\n\t{\n\t\tconst message: ?CopilotChatMessage = this.#messages.value.find((currentMessage) => currentMessage.id === messageId);\n\n\t\tif (!message)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tmessage.dateCreate = date;\n\t}\n\n\temitClickOnMessageButton(data: { buttonId: number, messageId: number }): void\n\t{\n\t\tconst { buttonId, messageId } = data;\n\n\t\tconst clickedMessageButton = this.#findMessageButton(messageId, buttonId);\n\n\t\tclickedMessageButton.isSelected = true;\n\n\t\tthis.emit(CopilotChatEvents.CLICK_ON_MESSAGE_BUTTON, {\n\t\t\tmessageId,\n\t\t\tbutton: { ...clickedMessageButton },\n\t\t});\n\t}\n\n\temitRetryLoadHistory(): void\n\t{\n\t\tthis.emit(CopilotChatEvents.RETRY_LOAD_HISTORY);\n\t}\n\n\t#findMessageButton(messageId: number, buttonId: number): ?CopilotChatMessageButton\n\t{\n\t\tconst searchedMessage = this.#messages.value.find((message) => message.id === messageId);\n\n\t\tif (Type.isArray(searchedMessage.params?.buttons) === false)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn searchedMessage.params.buttons.find((button) => button.id === buttonId) ?? null;\n\t}\n\n\t#setMessageStatus(messageId: number, status: string): void\n\t{\n\t\tconst message: ?CopilotChatMessage = this.#messages.value.find((currentMessage) => currentMessage.id === messageId);\n\n\t\tif (!message)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tmessage.status = status;\n\n\t\tthis.emit(CopilotChatEvents.SET_MESSAGE_STATUS, {\n\t\t\tmessageId,\n\t\t\tstatus,\n\t\t});\n\t}\n\n\t#addNewMessage(message: CopilotChatMessage, emitEvent: boolean = true): void\n\t{\n\t\tconst newMessageId = Math.round(-Math.random() * 1000);\n\n\t\tconst isCopilotChatShown = this.isShown();\n\n\t\tconst newMessage: CopilotChatMessage = {\n\t\t\tid: newMessageId,\n\t\t\tdateCreate: (new Date()).toISOString(),\n\t\t\tstatus: CopilotChatMessageStatus.DEPART,\n\t\t\tauthorId: 0,\n\t\t\t...message,\n\t\t\tviewed: message?.viewed ?? isCopilotChatShown,\n\t\t};\n\n\t\tthis.#messages.value.push(newMessage);\n\n\t\tif (emitEvent === false)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (newMessage.authorId === 0)\n\t\t{\n\t\t\tthis.emit(CopilotChatEvents.ADD_BOT_MESSAGE, {\n\t\t\t\tmessage: newMessage,\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.emit(CopilotChatEvents.ADD_USER_MESSAGE, {\n\t\t\t\tmessage: newMessage,\n\t\t\t});\n\t\t}\n\t}\n\n\tshow(): void\n\t{\n\t\tif (!this.#popup)\n\t\t{\n\t\t\tthis.#initPopup();\n\t\t}\n\n\t\tthis.#popup.show();\n\t}\n\n\thide(): void\n\t{\n\t\tthis.#popup?.close();\n\t}\n\n\tisShown(): boolean\n\t{\n\t\treturn Boolean(this.#popup?.isShown());\n\t}\n\n\tadjustPosition(): void\n\t{\n\t\tthis.#popup?.adjustPosition({\n\t\t\tforceBindPosition: true,\n\t\t});\n\t}\n\n\tsetUserAvatar(avatar: string): void\n\t{\n\t\tthis.#userAvatar.value = avatar;\n\t}\n\n\tshowLoadHistoryError(): void\n\t{\n\t\tthis.#isShowLoadHistoryError.value = true;\n\t}\n\n\thideLoadHistoryError(): void\n\t{\n\t\tthis.#isShowLoadHistoryError.value = false;\n\t}\n\n\t#initPopup(): Popup\n\t{\n\t\tconst adjustPopupPosition = this.adjustPosition.bind(this);\n\t\tbind(window, 'resize', adjustPopupPosition);\n\n\t\tthis.#popup = new Popup({\n\t\t\t...this.#popupOptions,\n\t\t\tcontent: this.#renderPopupContent(),\n\t\t\tminWidth: this.#popupOptions?.minWidth ?? CopilotChat.getDefaultMinWidth(),\n\t\t\theight: this.#popupOptions?.height ?? CopilotChat.getDefaultHeight(),\n\t\t\tcontentNoPaddings: true,\n\t\t\tpadding: 0,\n\t\t\tborderRadius: '16px',\n\t\t\tclassName: `ai__copilot-chat-popup ${this.#popupOptions.className ?? ''}`,\n\t\t\tcacheable: this.#popupOptions?.cacheable ?? false,\n\t\t\tevents: {\n\t\t\t\tonPopupAfterClose: () => {\n\t\t\t\t\tthis.#popup = null;\n\t\t\t\t\tthis.#app.unmount();\n\n\t\t\t\t\tif (Type.isFunction(this.#popupOptions?.events?.onPopupAfterClose))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#popupOptions?.events?.onPopupAfterClose();\n\t\t\t\t\t}\n\n\t\t\t\t\tunbind(window, 'resize', adjustPopupPosition);\n\t\t\t\t},\n\t\t\t\t...this.#popupOptions.events,\n\t\t\t},\n\t\t});\n\n\t\treturn this.#popup;\n\t}\n\n\t#renderPopupContent(): HTMLElement\n\t{\n\t\tconst appContainer = Tag.render`<div class=\"ai__copilot-chat-popup-content\"></div>`;\n\t\tthis.#app = BitrixVue.createApp({\n\t\t\tname: 'CopilotChatPopup',\n\t\t\tcomponents: {\n\t\t\t\tCopilotChat: CopilotChatComponent,\n\t\t\t\t...(this.#copilotChatOptions?.vueComponents),\n\t\t\t},\n\t\t\ttemplate: `\n\t\t\t\t<CopilotChat>\n\t\t\t\t\t<template v-slot:loader>\n\t\t\t\t\t\t${this.#copilotChatOptions.slots?.LOADER ?? ''}\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-slot:loaderError>\n\t\t\t\t\t\t${this.#copilotChatOptions.slots?.LOADER_ERROR ?? ''}\n\t\t\t\t\t</template>\n\t\t\t\t</CopilotChat>\n\t\t\t`,\n\t\t}, {\n\t\t\t...this.#copilotChatOptions,\n\t\t\tmessages: this.#messages.value,\n\t\t\tcopilotChatInstance: this,\n\t\t\tshowLoader: this.#isShowLoader,\n\t\t\tdisableInput: this.#isInputDisabled,\n\t\t\tstatus: this.#chatStatus,\n\t\t\tuseStatus: this.#useChatStatus,\n\t\t\tscrollToTheEndAfterFirstShow: this.#scrollToTheEndAfterFirstShow,\n\t\t\tcopilotMessageMenuItems: this.#copilotMessageMenuItems.value,\n\t\t\tuserMessageMenuItems: this.#userMessageMenuItems.value,\n\t\t\tisShowWarningMessage: this.#showCopilotWarningMessage,\n\t\t\tbotOptions: this.#copilotChatBotOptions.value,\n\t\t\tuserAvatar: this.#userAvatar,\n\t\t\tinputPlaceholder: this.#inputPlaceholder,\n\t\t\tloaderText: this.#loaderText,\n\t\t\tisOldMessagesLoading: this.#isOldMessagesLoading,\n\t\t\tisShowLoadHistoryError: this.#isShowLoadHistoryError,\n\t\t});\n\n\t\tthis.#app.mount(appContainer);\n\n\t\treturn appContainer;\n\t}\n}\n"],"names":["Status","Object","freeze","COPILOT_WRITING","NONE","CopilotChatStatus","components","BIcon","props","status","type","String","required","default","computed","writingStatusIcon","name","Set","PENCIL_60","size","color","containerClassname","template","NewMessagesVisibilityObserverEvents","VIEW_NEW_MESSAGE","NewMessagesVisibilityObserver","EventEmitter","constructor","options","setEventNamespace","init","IntersectionObserver","entries","forEach","entry","isMessageVisible","isIntersecting","intersectionRatio","messageElement","target","emit","BaseEvent","data","id","Dom","attr","unobserve","root","threshold","element","observe","push","setRoot","arrayWithZeros","Array","from","length","fill","map","zero","index","CopilotChatAvatar","src","alt","CopilotChatHeaderMenu","menuItems","items","menuIconProps","MORE","beforeMount","menu","Menu","mounted","getPopupWindow","setBindElement","$refs","menuButton","beforeUnmount","destroy","methods","toggleMenu","isMenuOpen","hideMenu","showMenu","show","close","isShown","CopilotChatHeader","emits","title","subtitle","avatar","useCloseIcon","Boolean","closeIconProps","CROSS_40","isMenuExists","handleClickOnCloseIcon","$emit","CopilotChatVoiceInputBtn","converter","isVoiceRecording","IconSet","isVoiceInputDisabled","SpeechConverter","isBrowserSupport","handleClickOnStartVoiceInputBtn","stopVoiceInput","startVoiceInput","toRaw","start","stop","handleSpeechConverterStartEvent","handleSpeechConverterStopEvent","handleSpeechConverterResultEvent","e","getData","text","handleSpeechConverterErrorEvent","console","error","subscribe","speechConverterEvents","result","bind","unmounted","unsubscribe","CopilotChatInput","disabled","placeholder","Loc","getMessage","userMessage","userMessageBeforeVoiceInput","isRecording","isSubmitButtonDisabled","trim","setTimeout","textarea","focus","handleSubmitButton","blur","submitMessage","handleEnterKeyDown","shiftKey","ctrlKey","preventDefault","handleInput","value","handleVoiceInputText","updateTextareaHeight","handleStartVoiceInput","at","handleStopVoiceInput","style","scrollHeight","watch","requestAnimationFrame","isDisabled","isMessageFromCopilot","authorId","CopilotChatMessage","avatarAlt","messageTitle","messageText","time","buttons","colorScheme","messageButtons","formattedTime","date","Date","getHours","getMinutes","isUserMessage","CopilotChatWelcomeMessage","content","CopilotChatMessagesDateGroup","formattedDate","format","DateTimeFormat","CopilotChatNewMessagesLabel","CopilotChatMessagesAuthorGroup","showNewMessagesLabel","CopilotChatMessageType","DEFAULT","BUTTON_CLICK_MESSAGE","WELCOME_FLOWS","WELCOME_SITE_WITH_AI","SYSTEM","CopilotChatNewMessageVisibilityObserver","binding","isMessageViewed","instance","observer","CopilotChatMessageButton","icon","class","className","CopilotChatMessageMenu","message","item","onclick","event","menuItem","myCustomData","dateCreate","menuButtonClassname","initMenu","angle","offset","getPosition","$el","width","events","onPopupShow","onPopupClose","bindElement","document","body","querySelector","CopilotChatMessageDefault","useAvatarTail","disableAllActions","messageData","messageContent","formattedMessageContent","htmlFormatter","HtmlFormatter","containerMode","source","formattedDeliveryTime","formatTime","params","isSomeButtonSelected","some","button","selected","showMenuButton","isErrorMessage","CopilotChatMessageStatus","ERROR","errorMessageMenuItems","$Bitrix","Icons","dateTime","hours","toString","padStart","minutes","append","innerText","CopilotChatMessageWelcome","messageInfo","CopilotChatMessageSiteWithAi","inject","chatInstance","renderContent","isMessageHaveCreateSiteButton","paragraph2","Tag","render","infoLink","Helper","Reflection","getClass","createSiteLink","addUserMessage","messageId","buttonId","innerHTML","CopilotChatMessageWelcomeFlows","CopilotChatMessageColor","USER","COPILOT","USER_WITH_HIGHLIGHT_TEXT","CopilotChatMessages","messages","copilotAvatar","userAvatar","copilotMessageTitle","userMessageMenuItems","copilotMessageMenuItems","welcomeMessageHtmlElement","HTMLElement","directives","messagesList","messagesGroupedByDayAndAuthor","groupsOfMessages","groupMessagesByDay","isNewMessagesStartHere","groupMessagesByAuthor","sortedByDateMessagesGroups","keys","sort","isMessagesContainsUnread","reduce","groupedMessages","messageDeliveryDate","messageIsoDate","formatISODate","undefined","viewed","currentAuthor","Infinity","isNewMessagesLabelWasAdded","messagesGroupedByAuthor","getMessageMenuItems","year","getFullYear","month","getMonth","day","getDate","getMessageColor","getMessageComponent","getMessageTitle","getMessageAvatarByAuthorId","getAuthorMessagesGroupAvatar","lastMessage","isLastMessageIsWelcome","isMessageHaveButtons","handleMessageButtonClick","isLastMessage","handleMessageRetry","handleMessageRemove","welcomeMessage","CopilotChatHistoryLoader","getComputedStyle","getPropertyValue","loader","Loader","loaderContainer","hide","CopilotChatWarningMessage","showArticle","articleCode","warningMessage","Event","link","container","CopilotChatLoadingBar","CopilotChatLoadHistoryError","loc","phraseCode","handleClickOnRetryButton","CopilotChat","header","welcomeMessageHtml","botOptions","scrollToTheEndAfterFirstShow","slots","isShowWarningMessage","copilotChatInstance","useInput","disableInput","showLoader","isOldMessagesLoading","showCopilotWritingStatus","useStatus","inputPlaceholder","loaderText","isShowLoadHistoryError","isCopilotWriting","scrollPosition","provide","userPhoto","isInputDisabled","isLoaderShown","isLoadingOldMessages","isWarningMessageShown","Slot","headerProps","botData","messageMenuItems","haveNewMessages","copilotChatStatus","isChatStatusUsed","isScrollToTheEndAfterMounted","hideChat","handleSubmitMessage","newMessage","scrollMessagesListAfterOpen","newMessagesLabel","main","newMessagesLabelContainerClassname","scrollIntoView","scrollMessagesListToTheEnd","isSmooth","scrollTo","left","top","behavior","handleClickOnMessageButton","eventData","emitClickOnMessageButton","handleAddNewUserMessage","restoreScrollPosition","scrollTop","handleRetryMessage","CopilotChatEvents","RETRY_SEND_MESSAGE","handleRemoveMessage","REMOVE_MESSAGE","handleRetryLoadHistoryButtonClick","emitRetryLoadHistory","beforeCreate","setNewMessageIsViewed","ADD_USER_MESSAGE","scrollElement","MESSAGES_SCROLL_TOP","newValue","oldValue","newMessagesCount","oldMessagesCount","ADD_BOT_MESSAGE","ADD_OLD_MESSAGES","ADD_NEW_MESSAGES","CLICK_ON_MESSAGE_BUTTON","SHOW_LOADER","HIDE_LOADER","SHOW_COPILOT_WRITING_LOADER","HIDE_COPILOT_WRITING_LOADER","DISABLE_INPUT_FIELD","ENABLE_INPUT_FIELD","SET_MESSAGE_STATUS","SHOW_ERROR_SCREEN","HIDE_ERROR_SCREEN","RETRY_LOAD_HISTORY","DEPART","SENT","DELIVERED","ref","popupOptions","Type","isArray","isBoolean","useChatStatus","showCopilotWarningMessage","getDefaultMinWidth","getDefaultHeight","startLoadingOldMessages","finishLoadingOldMessages","isMessageInList","findLast","getFirstMessageId","getMessageById","find","removeMessage","removedMessageIndex","findIndex","splice","unshiftMessages","messagesWithStatus","unshift","emitEvent","newUserMessage","addBotMessage","addSystemMessage","newSystemMessage","enableInput","hideLoader","setMessageStatusDepart","setMessageStatusDelivered","setMessageStatusSent","setMessageStatusError","setCopilotWritingStatus","setMessageId","newMessageId","currentMessage","setMessageDate","clickedMessageButton","isSelected","adjustPosition","forceBindPosition","setUserAvatar","showLoadHistoryError","hideLoadHistoryError","searchedMessage","Math","round","random","isCopilotChatShown","toISOString","adjustPopupPosition","window","Popup","minWidth","height","contentNoPaddings","padding","borderRadius","cacheable","onPopupAfterClose","unmount","isFunction","unbind","appContainer","BitrixVue","createApp","CopilotChatComponent","vueComponents","LOADER","LOADER_ERROR","mount"],"mappings":"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"}