this.BX=this.BX||{};this.BX.AI=this.BX.AI||{};this.BX.AI.CopilotChat=this.BX.AI.CopilotChat||{};(function(t,e,s,a,i,n,o,r,l,c,u,d,h){"use strict";const p=Object.freeze({COPILOT_WRITING:"copilot-writing",NONE:"none"});const v={components:{BIcon:c.BIcon},props:{status:{type:String,required:false,default:p.NONE}},computed:{Status(){return p},writingStatusIcon(){return{name:c.Set.PENCIL_60,size:14,color:"#fff"}},containerClassname(){return["ai__copilot-chat_status",`--${this.status}`]}},template:`\n\t\t<div class="ai__copilot-chat_status-wrapper">\n\t\t\t<div class="ai__copilot-chat_status">\n\t\t\t\t<template v-if="status === Status.COPILOT_WRITING">\n\t\t\t\t\t<span class="ai__copilot-chat_status-icon --typing">\n\t\t\t\t\t\t<BIcon\n\t\t\t\t\t\t\tv-bind="writingStatusIcon"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span>{{ $Bitrix.Loc.getMessage('AI_COPILOT_CHAT_STATUS_COPILOT_WRITING') }}</span>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t`};const m=Object.freeze({VIEW_NEW_MESSAGE:"viewNewMessage"});var g=babelHelpers.classPrivateFieldLooseKey("observer");var b=babelHelpers.classPrivateFieldLooseKey("root");var _=babelHelpers.classPrivateFieldLooseKey("observableElements");var f=babelHelpers.classPrivateFieldLooseKey("getThreshold");class M extends a.EventEmitter{constructor(t){super(t);Object.defineProperty(this,f,{value:C});Object.defineProperty(this,g,{writable:true,value:null});Object.defineProperty(this,b,{writable:true,value:null});Object.defineProperty(this,_,{writable:true,value:[]});this.setEventNamespace("AI.CopilotChat.InterSectionManager")}init(){babelHelpers.classPrivateFieldLooseBase(this,g)[g]=new IntersectionObserver((t=>{t.forEach((t=>{const e=t.isIntersecting&&t.intersectionRatio>.5;if(e){const e=t.target;this.emit(m.VIEW_NEW_MESSAGE,new a.BaseEvent({data:{id:h.Dom.attr(e,"data-id")}}));babelHelpers.classPrivateFieldLooseBase(this,g)[g].unobserve(e)}}))}),{root:babelHelpers.classPrivateFieldLooseBase(this,b)[b],threshold:babelHelpers.classPrivateFieldLooseBase(this,f)[f]()});babelHelpers.classPrivateFieldLooseBase(this,_)[_].forEach((t=>{babelHelpers.classPrivateFieldLooseBase(this,g)[g].observe(t)}))}observe(t){if(!babelHelpers.classPrivateFieldLooseBase(this,b)[b]||!babelHelpers.classPrivateFieldLooseBase(this,g)[g]){babelHelpers.classPrivateFieldLooseBase(this,_)[_].push(t)}else{babelHelpers.classPrivateFieldLooseBase(this,g)[g].observe(t)}}unobserve(t){babelHelpers.classPrivateFieldLooseBase(this,g)[g].unobserve(t)}setRoot(t){babelHelpers.classPrivateFieldLooseBase(this,b)[b]=t}}function C(){const t=Array.from({length:101}).fill(0);return t.map(((t,e)=>e*.01))}const I={props:{src:String,alt:String},template:`\n\t\t<img\n\t\t\tclass="ai__copilot-chat-avatar"\n\t\t\t:alt="alt"\n\t\t\t:src="src"\n\t\t/>\n\t`};const S={components:{BIcon:c.BIcon},props:{menuItems:{type:Array,required:true,default:()=>[]}},computed:{items(){return this.menuItems},menuIconProps(){return{name:c.Set.MORE,size:24}}},beforeMount(){this.menu=new l.Menu({items:this.items})},mounted(){this.menu.getPopupWindow().setBindElement(this.$refs.menuButton)},beforeUnmount(){this.menu.destroy()},methods:{toggleMenu(){if(this.isMenuOpen()){this.hideMenu()}else{this.showMenu()}},showMenu(){this.menu.show()},hideMenu(){this.menu.close()},isMenuOpen(){return this.menu.getPopupWindow().isShown()}},template:`\n\t\t<button\n\t\t\tref="menuButton"\n\t\t\t@click="toggleMenu"\n\t\t\tclass="ai__copilot-chat-header-menu"\n\t\t>\n\t\t\t<span class="ai__copilot-chat-header-menu_icon">\n\t\t\t\t<b-icon\n\t\t\t\t\tv-bind="menuIconProps"\n\t\t\t\t></b-icon>\n\t\t\t</span>\n\t\t</button>\n\t`};const E={components:{CopilotChatAvatar:I,CopilotChatHeaderMenu:S,BIcon:c.BIcon},emits:["clickOnCloseIcon"],props:{title:String,subtitle:String,avatar:String,useCloseIcon:{type:Boolean,required:false,default:false},menu:Object},computed:{closeIconProps(){return{name:c.Set.CROSS_40,size:24}},isMenuExists(){return this.menu&&this.menu.items&&this.menu.items.length>0},menuItems(){var t,e;return(t=(e=this.menu)==null?void 0:e.items)!=null?t:[]}},methods:{handleClickOnCloseIcon(){this.$emit("clickOnCloseIcon")}},template:`\n\t\t<div class="ai__copilot-chat-header">\n\t\t\t<button\n\t\t\t\tv-if="useCloseIcon"\n\t\t\t\t@click="handleClickOnCloseIcon"\n\t\t\t\tclass="ai__copilot-chat-header_close-icon"\n\t\t\t>\n\t\t\t\t<b-icon\n\t\t\t\t\tv-bind="closeIconProps"\n\t\t\t\t />\n\t\t\t</button>\n\t\t\t<div class="ai__copilot-chat-header_avatar">\n\t\t\t\t<CopilotChatAvatar\n\t\t\t\t\t:src="avatar"\n\t\t\t\t\t:alt="title"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class="ai__copilot-chat-header_info">\n\t\t\t\t<h4 class="ai__copilot-chat-header_title">\n\t\t\t\t\t{{ title }}\n\t\t\t\t</h4>\n\t\t\t\t<div class="ai__copilot-chat-header_subtitle">\n\t\t\t\t\t{{ subtitle }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if="isMenuExists"\n\t\t\t\tclass="ai__copilot-chat-header_menu"\n\t\t\t>\n\t\t\t\t<copilot-chat-header-menu :menu-items="menuItems"></copilot-chat-header-menu>\n\t\t\t</div>\n\t\t</div>\n\t`};const L={components:{BIcon:c.BIcon},emits:["input","start","stop"],data(){return{converter:null,isVoiceRecording:false}},computed:{IconSet(){return i.Set},isVoiceInputDisabled(){return s.SpeechConverter.isBrowserSupport()===false}},methods:{handleClickOnStartVoiceInputBtn(){if(this.isVoiceRecording){this.stopVoiceInput()}else{this.startVoiceInput()}},startVoiceInput(){const t=n.toRaw(this.converter);t.start()},stopVoiceInput(){const t=n.toRaw(this.converter);t.stop()},handleSpeechConverterStartEvent(){this.$emit("start");this.isVoiceRecording=true},handleSpeechConverterStopEvent(){this.isVoiceRecording=false;this.$emit("stop")},handleSpeechConverterResultEvent(t){this.$emit("input",t.getData().text)},handleSpeechConverterErrorEvent(t){console.error(t);this.isVoiceRecording=false}},mounted(){if(this.isVoiceInputDisabled===false){this.converter=new s.SpeechConverter({});const t=n.toRaw(this.converter);t.subscribe(s.speechConverterEvents.start,this.handleSpeechConverterStartEvent);t.subscribe(s.speechConverterEvents.stop,this.handleSpeechConverterStopEvent);t.subscribe(s.speechConverterEvents.result,this.handleSpeechConverterResultEvent.bind(this));t.subscribe(s.speechConverterEvents.error,this.handleSpeechConverterErrorEvent)}},unmounted(){const t=n.toRaw(this.converter);t.unsubscribe(s.speechConverterEvents.start,this.handleSpeechConverterStartEvent);t.unsubscribe(s.speechConverterEvents.stop,this.handleSpeechConverterStopEvent);t.unsubscribe(s.speechConverterEvents.result,this.handleSpeechConverterResultEvent.bind(this));t.unsubscribe(s.speechConverterEvents.error,this.handleSpeechConverterErrorEvent)},template:`\n\t\t<button\n\t\t\t:disabled="isVoiceInputDisabled"\n\t\t\t@click="handleClickOnStartVoiceInputBtn"\n\t\t\tclass="ai__copilot-chat-input_voice-input"\n\t\t>\n\t\t\t<span\n\t\t\t\tv-if="isVoiceRecording === false"\n\t\t\t\tclass="ai__copilot-chat-input_voice-input-no-record-icon-wrapper"\n\t\t\t>\n\t\t\t\t<BIcon\n\t\t\t\t\t:size="24"\n\t\t\t\t\t:name="IconSet.MICROPHONE_ON"\n\t\t\t\t/>\n\t\t\t</span>\n\t\t\t<span\n\t\t\t\tv-else\n\t\t\t\tclass="ai__copilot-chat-input_voice-input-record-icon-wrapper"\n\t\t\t>\n\t\t\t\t<span class="ai__copilot-chat-input_voice-input-record-icon"></span>\n\t\t\t</span>\n\t\t</button>\n\t`};const B={components:{CopilotChatVoiceInputBtn:L},emits:["submit"],props:{disabled:{type:Boolean,required:false,default:false},placeholder:{type:String,required:false,default:h.Loc.getMessage("AI_COPILOT_CHAT_INPUT_PLACEHOLDER")}},data(){return{userMessage:"",userMessageBeforeVoiceInput:this.userMessage,isRecording:false}},computed:{isSubmitButtonDisabled(){return!this.userMessage||this.userMessage.trim().length===0||this.isRecording},containerClassname(){return{"ai__copilot-chat-input":true,"--disabled":this.disabled}}},methods:{handleSubmitButton(t){t.target.blur();this.submitMessage()},handleEnterKeyDown(t){var e;if(t.shiftKey||t.ctrlKey){return true}t.preventDefault();if((e=this.userMessage)!=null&&e.trim()){this.submitMessage()}return false},submitMessage(){this.$emit("submit",this.userMessage.trim());this.userMessage=""},handleInput(t){this.userMessage=t.target.value},handleVoiceInputText(t){this.userMessage=this.userMessageBeforeVoiceInput+t;this.updateTextareaHeight()},handleStartVoiceInput(){this.isRecording=true;if(this.userMessage&&this.userMessage.at(-1)!==" "){this.userMessage+=" "}this.userMessageBeforeVoiceInput=this.userMessage},handleStopVoiceInput(){this.isRecording=false;this.$refs.textarea.focus()},updateTextareaHeight(){const t=this.$refs.textarea;h.Dom.style(t,"height","auto");h.Dom.style(t,"height",`${t.scrollHeight}px`)}},watch:{userMessage(){requestAnimationFrame((()=>{this.updateTextareaHeight()}))},disabled(t){if(t===false){this.$refs.textarea.focus()}else{this.$refs.textarea.blur()}}},template:`\n\t\t<div :class="containerClassname">\n\t\t\t<div class="ai__copilot-chat-input_textarea-wrapper">\n\t\t\t\t<textarea\n\t\t\t\t\ttype="text" class="ai__copilot-chat-input_textarea"\n\t\t\t\t\tref="textarea"\n\t\t\t\t\t:placeholder="placeholder"\n\t\t\t\t\trows="1"\n\t\t\t\t\t@input="handleInput"\n\t\t\t\t\t@keydown.enter="handleEnterKeyDown"\n\t\t\t\t\t:value="userMessage"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class="ai__copilot-chat-input_actions">\n\t\t\t\t<CopilotChatVoiceInputBtn\n\t\t\t\t\t@start="handleStartVoiceInput"\n\t\t\t\t\t@input="handleVoiceInputText"\n\t\t\t\t\t@stop="handleStopVoiceInput"\n\t\t\t\t/>\n\t\t\t\t<button @click="handleSubmitButton" :disabled="isSubmitButtonDisabled" class="ai__copilot-chat-input_submit"></button>\n\t\t\t</div>\n\t\t</div>\n\t`};const w=t=>t===0;const P={props:{avatar:String,avatarAlt:String,messageTitle:String,messageText:String,time:String,buttons:{type:Array,required:false,default:()=>[]},colorScheme:String,status:{type:String,required:false}},computed:{messageButtons(){return this.buttons},formattedTime(){const t=new Date(this.time);return`${t.getHours()}:${t.getMinutes()}`},isUserMessage(){return true}},template:`\n\t\t<div\n\t\t\tclass="ai__copilot-chat-message"\n\t\t\t:class="'--color-schema-' + colorScheme"\n\t\t>\n\t\t\t<div class="ai__copilot-chat-message_avatar-wrapper">\n\t\t\t\t<img\n\t\t\t\t\tclass="ai__copilot-chat-message_avatar"\n\t\t\t\t\t:src="avatar"\n\t\t\t\t\t:alt="avatarAlt"\n\t\t\t\t\t:title="avatarAlt"\n\t\t\t\t>\n\t\t\t</div>\n\t\t\t<div class="ai__copilot-chat-message-content-wrapper">\n\t\t\t\t<div class="ai__copilot-chat-message-content">\n\t\t\t\t\t<div class="ai__copilot-chat-message-content-main">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-if="messageTitle"\n\t\t\t\t\t\t\tclass="ai__copilot-chat-message-title"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ messageTitle }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="ai__copilot-chat-message-text">\n\t\t\t\t\t\t\t{{ messageText }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="ai__copilot-chat-message_time">\n\t\t\t\t\t\t{{ formattedTime }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="status"\n\t\t\t\t\t\tclass="ai__copilot-chat-message_status"\n\t\t\t\t\t\t:class="'--' + status"\n\t\t\t\t\t></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if="messageButtons.length > 0" class="ai__copilot-chat-message_action-buttons">\n\t\t\t\t<button\n\t\t\t\t\tv-for="button in messageButtons"\n\t\t\t\t\tclass="ai__copilot-chat-message_action-button"\n\t\t\t\t\t:class="{'--selected': button.isSelected}"\n\t\t\t\t>\n\t\t\t\t\t{{ button.text }}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t`};const A={props:{avatar:String,title:String,content:String},template:`\n\t\t<div class="landing__copilot-landing-chat-welcome-message">\n\t\t\t<div class="landing__copilot-landing-chat-welcome-message_avatar-wrapper">\n\t\t\t\t<img\n\t\t\t\t\tclass="landing__copilot-landing-chat-welcome-message_avatar"\n\t\t\t\t\tsrc="/dev/ai/copilot-chat/images/avatar-example-4x.png"\n\t\t\t\t\talt="Copilot Designer"\n\t\t\t\t>\n\t\t\t</div>\n\t\t\t<div class="landing__copilot-landing-chat-welcome-message_content">\n\t\t\t\t<h6 class="landing__copilot-landing-chat-welcome-message_title">{{ title }}</h6>\n\t\t\t\t<div v-html="content"></div>\n\t\t\t</div>\n\t\t</div>\n\t`};const O={props:{date:{type:String,required:false,default:""}},computed:{formattedDate(){const t=[["today","today"],["yesterday","yesterday"],["m","l, d F"],["","l, d F Y"]];return r.DateTimeFormat.format(t,new Date(this.date),new Date)}},template:`\n\t\t<div class="ai__copilot-chat-messages-date-group">\n\t\t\t<div class="ai__copilot-chat-messages-date-group__date">\n\t\t\t\t<div class="ai__copilot-chat-messages-date-group__date-label">\n\t\t\t\t\t{{ formattedDate }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="ai__copilot-chat-messages-date-group__content">\n\t\t\t\t<slot></slot>\n\t\t\t</div>\n\t\t</div>\n\t`};const y="ai__copilot-chat_new-messages-label";const H={template:`\n\t\t<div class="${y}">\n\t\t\t{{ $Bitrix.Loc.getMessage('AI_COPILOT_CHAT_NEW_MESSAGES_LABEL') }}\n\t\t</div>\n\t`};const T={components:{CopilotChatNewMessagesLabel:H},props:{avatar:{type:String,required:false},showNewMessagesLabel:{type:Boolean,required:false,default:false}},template:`\n\t\t<CopilotChatNewMessagesLabel v-if="showNewMessagesLabel" />\n\t\t<div class="ai__copilot-chat_messages-author-group">\n\t\t\t<div v-if="avatar" class="ai__copilot-chat_messages-author-group__avatar">\n\t\t\t\t<img :src="avatar" alt="#">\n\t\t\t</div>\n\t\t\t<div class="ai__copilot-chat_messages-author-group__messages">\n\t\t\t\t<slot></slot>\n\t\t\t</div>\n\t\t</div>\n\t`};const F=Object.freeze({DEFAULT:"default",BUTTON_CLICK_MESSAGE:"buttonClickMessage",WELCOME_FLOWS:"welcomeFlows",WELCOME_SITE_WITH_AI:"welcomeSiteWithAi",SYSTEM:"system"});const D={mounted(t,e){const s=e.value;if(s===false){e.instance.observer.observe(t)}},beforeUnmount(t,e){e.instance.observer.unobserve(t)}};const R={components:{BIcon:c.BIcon},props:{menuItems:{type:Array,required:true,default:()=>[]},message:{type:Object,required:true,default:()=>({})}},data(){return{isMenuOpen:false}},computed:{items(){return this.menuItems.map((t=>({...t,onclick:(e,s)=>{const a={message:{id:this.message.id,content:this.message.content,dateCreated:this.message.dateCreated}};this.hideMenu();return t.onclick(e,s,a)}})))},menuIconProps(){return{name:c.Set.MORE,size:22}},menuButtonClassname(){return{"ai__copilot-chat-message-menu":true,"--open":this.isMenuOpen}}},methods:{toggleMenu(){if(this.isMenuOpen){this.hideMenu()}else{this.showMenu()}},showMenu(){var t;if(!this.menu){this.initMenu()}(t=this.menu)==null?void 0:t.show()},hideMenu(){var t;(t=this.menu)==null?void 0:t.close()},initMenu(){this.menu=new l.Menu({items:this.items,angle:{offset:h.Dom.getPosition(this.$refs.menuButton).width/2+23},events:{onPopupShow:()=>{this.isMenuOpen=true},onPopupClose:()=>{this.isMenuOpen=false}},bindElement:this.$refs.menuButton});h.bind(document.body.querySelector(".ai__copilot-chat_main"),"scroll",(()=>{this.hideMenu()}));return this.menu}},beforeUnmount(){var t;(t=this.menu)==null?void 0:t.destroy()},template:`\n\t\t<button\n\t\t\tref="menuButton"\n\t\t\t@click="toggleMenu"\n\t\t\t:class="menuButtonClassname"\n\t\t>\n\t\t\t<BIcon v-bind="menuIconProps"></BIcon>\n\t\t</button>\n\t`};const N={components:{CopilotChatMessageMenu:R},emits:["buttonClick"],props:{message:{type:Object,required:true},avatar:{type:String,required:true},title:{type:String,required:false},useAvatarTail:{type:Boolean,required:false,default:false},menuItems:{type:Array,required:false,default:()=>[]},color:{type:String,required:false,default:""},disableAllActions:{type:Boolean,required:false,default:false}},computed:{messageData(){return this.message},messageContent(){return this.messageData.content},isMessageFromCopilot(){return w(this.messageData.authorId)},formattedMessageContent(){const t=new u.HtmlFormatter({containerMode:"collapsed"});return t.format({source:this.messageContent})},formattedDeliveryTime(){return this.formatTime(this.messageData.dateCreated)},messageButtons(){var t,e;return(t=(e=this.messageData.params)==null?void 0:e.buttons)!=null?t:[]},isSomeButtonSelected(){return this.messageButtons.some((t=>t.isSelected))},showMenuButton(){var t;return((t=this.menuItems)==null?void 0:t.length)>0}},methods:{formatTime(t){if(!t){return""}const e=new Date(t);const s=e.getHours().toString().padStart(2,"0");const a=e.getMinutes().toString().padStart(2,"0");return`${s}:${a}`}},mounted(){if(this.isMessageFromCopilot){h.Dom.append(this.formattedMessageContent,this.$refs.content)}else{this.$refs.content.innerText=this.messageContent}},template:`\n\t\t<div\n\t\t\t:data-id="messageData.id"\n\t\t\tclass="ai__copilot-chat-message"\n\t\t\t:class="'--color-schema-' + color"\n\t\t>\n\t\t\t<div\n\t\t\t\tclass="ai__copilot-chat-message-content-wrapper"\n\t\t\t\t:class="{ '--with-tail': useAvatarTail }"\n\t\t\t>\n\t\t\t\t<div class="ai__copilot-chat-message-content">\n\t\t\t\t\t<div class="ai__copilot-chat-message-content-main">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-if="title"\n\t\t\t\t\t\t\tclass="ai__copilot-chat-message-title"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ title }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="ai__copilot-chat-message-text" ref="content"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="ai__copilot-chat-message_status-info">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-if="messageData.dateCreated"\n\t\t\t\t\t\t\tclass="ai__copilot-chat-message_time"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ formattedDeliveryTime }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-if="messageData.status"\n\t\t\t\t\t\t\tclass="ai__copilot-chat-message_status"\n\t\t\t\t\t\t\t:class="'--' + messageData.status"\n\t\t\t\t\t\t></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-if="messageButtons.length > 0" class="ai__copilot-chat-message_action-buttons">\n\t\t\t\t\t<button\n\t\t\t\t\t\tv-for="button in messageButtons"\n\t\t\t\t\t\tclass="ai__copilot-chat-message_action-button"\n\t\t\t\t\t\t:class="{'--selected': button.isSelected}"\n\t\t\t\t\t\t:disabled="isSomeButtonSelected || disableAllActions"\n\t\t\t\t\t\t@click="$emit('buttonClick', button.id)"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ button.text }}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if="showMenuButton"\n\t\t\t\tclass="ai__copilot-chat-message_menu"\n\t\t\t>\n\t\t\t\t<CopilotChatMessageMenu\n\t\t\t\t\t:menu-items="menuItems"\n\t\t\t\t\t:message="message"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`};const W={props:{message:{type:Object,required:false},avatar:{type:String,required:false}},computed:{messageInfo(){return this.message},title(){var t,e;return(t=(e=this.messageInfo.params)==null?void 0:e.title)!=null?t:""},subtitle(){var t,e;return(t=(e=this.messageInfo.params)==null?void 0:e.subtitle)!=null?t:""},content(){var t,e;return(t=(e=this.messageInfo.params)==null?void 0:e.content)!=null?t:""}},template:`\n\t\t<div class="ai__copilot-chat-message-welcome">\n\t\t\t<header class="ai__copilot-chat-message-welcome_header">\n\t\t\t\t<div class="ai__copilot-chat-message-welcome_header-left">\n\t\t\t\t\t<img\n\t\t\t\t\t\t:src="avatar"\n\t\t\t\t\t\talt="#"\n\t\t\t\t\t\tclass="ai__copilot-chat-message-welcome_avatar"\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t\t<div class="ai__copilot-chat-message-welcome_header-right">\n\t\t\t\t\t<h5 class="ai__copilot-chat-message-welcome_title">{{ title }}</h5>\n\t\t\t\t\t<p v-if="subtitle" class="ai__copilot-chat-message-welcome_subtitle">{{ subtitle }}</p>\n\t\t\t\t</div>\n\t\t\t</header>\n\t\t\t<main class="ai__copilot-chat-message-welcome_main">\n\t\t\t\t<div class="ai__copilot-chat-message-welcome_content">\n\t\t\t\t\t<slot name="content">\n\t\t\t\t\t\t{{ content }}\n\t\t\t\t\t</slot>\n\t\t\t\t</div>\n\t\t\t</main>\n\t\t</div>\n\t`};let G=t=>t,$;const j={components:{CopilotChatMessageWelcome:W},props:{message:{type:Object,required:false},avatar:{type:String,required:false},disableAllActions:{type:Boolean,required:false,default:false}},computed:{messageInfo(){return{...this.message,params:{...this.message.params,title:"\u041f\u0440\u0438\u0432\u0435\u0442! \u042f \u2014 \u0412\u0435\u0431-\u0434\u0438\u0437\u0430\u0439\u043d\u0435\u0440",subtitle:"",content:""}}}},methods:{renderContent(){const t=this.$Bitrix.Loc.getMessage("AI_COPILOT_CHAT_WELCOME_MESSAGE_SITE_WITH_AI_2",{"#LINK#":`<a href="#" class="${this.disableAllActions?"disabled":""}" ref="createSiteLink">`,"#/LINK#":"</a>"});const e=h.Tag.render($||($=G`
				<div>
					<p>${0}</p>
					<p>${0}</p>
				</div>
			`),this.$Bitrix.Loc.getMessage("AI_COPILOT_CHAT_WELCOME_MESSAGE_SITE_WITH_AI_1"),t);h.bind(e.createSiteLink,"click",(()=>{}));this.$refs.content.innerHTML="";h.Dom.append(e.root,this.$refs.content)}},watch:{disableAllActions(){this.renderContent()}},mounted(){this.renderContent()},template:`\n\t\t<CopilotChatMessageWelcome\n\t\t\t:avatar="avatar"\n\t\t\t:message="messageInfo"\n\t\t>\n\t\t\t<template #content>\n\t\t\t\t<div ref="content"></div>\n\t\t\t</template>\n\t\t</CopilotChatMessageWelcome>\n\t`};const x={components:{CopilotChatMessageWelcome:W},props:{message:{type:Object,required:false},avatar:{type:String,required:false}},computed:{messageInfo(){return this.message}},template:`\n\t\t<CopilotChatMessageWelcome\n\t\t\t:avatar="avatar"\n\t\t\t:message="messageInfo"\n\t\t/>\n\t`};const q=Object.freeze({USER:"user",COPILOT:"copilot",ERROR:"error",USER_WITH_HIGHLIGHT_TEXT:"userWithHighlightText"});const U={components:{CopilotChatMessage:P,CopilotChatWelcomeMessage:A,CopilotChatMessageDefault:N,CopilotChatMessageWelcome:W,CopilotChatMessageSiteWithAi:j,CopilotChatMessageWelcomeFlows:x,CopilotChatMessagesDateGroup:O,CopilotChatMessagesAuthorGroup:T},emits:["clickMessageButton"],props:{messages:{type:Array,required:false,default:()=>[]},copilotAvatar:String,userAvatar:String,copilotMessageTitle:{type:String,required:false,default:""},userMessageMenuItems:{type:Array,required:false,default:()=>[]},copilotMessageMenuItems:{type:Array,required:false,default:()=>[]},welcomeMessageHtmlElement:HTMLElement},inject:["observer"],directives:{CopilotChatNewMessageVisibilityObserver:D},computed:{messagesList(){return this.messages},messagesGroupedByDayAndAuthor(){const t=this.groupMessagesByDay(this.messagesList);const e={};Object.entries(t).forEach((([t,{messages:s,isNewMessagesStartHere:a}])=>{e[t]=this.groupMessagesByAuthor(s,a)}));return e},sortedByDateMessagesGroups(){return Object.keys(this.messagesGroupedByDayAndAuthor).sort()}},methods:{groupMessagesByDay(t){let e=false;return t.reduce(((t,s)=>{const a=new Date(s.dateCreated);const i=this.formatISODate(a);if(t[i]===undefined){t[i]={messages:[],isNewMessagesStartHere:false}}if(s.viewed===false&&e===false){t[i].isNewMessagesStartHere=true;e=true}t[i].messages.push(s);return t}),{})},groupMessagesByAuthor(t,e){let s=-Infinity;let a=false;return t.reduce(((t,i)=>{if(i.viewed===false&&a===false&&e===true){t.push([i.authorId,[],true]);a=true}else if(i.authorId!==s){t.push([i.authorId,[]]);s=i.authorId}t.at(-1)[1].push(i);return t}),[])},getMessageMenuItems(t){if(t.authorId===null||t.authorId===undefined){return[]}return w(t.authorId)?this.copilotMessageMenuItems:this.userMessageMenuItems},formatISODate(t){const e=t.getFullYear();const s=(t.getMonth()+1).toString().padStart(2,"0");const a=t.getDate().toString().padStart(2,"0");return`${e}-${s}-${a}`},getMessageColor(t){if(t.type===F.BUTTON_CLICK_MESSAGE){return q.USER_WITH_HIGHLIGHT_TEXT}if(w(t.authorId)){return q.COPILOT}return q.USER},getMessageComponent(t){switch(t.type){case F.DEFAULT:return N;case F.WELCOME_FLOWS:return x;case F.WELCOME_SITE_WITH_AI:return j;default:return N}},getMessageTitle(t){return this.isMessageFromCopilot(t)?this.copilotMessageTitle:""},getMessageAvatarByAuthorId(t){return this.isMessageFromCopilot(t)?this.copilotAvatar:this.userAvatar},getAuthorMessagesGroupAvatar(t){if(t===null||t===undefined){return null}return this.getMessageAvatarByAuthorId(t)},isMessageFromCopilot(t){return t<1},isMessageHaveButtons(t){var e,s;return(t==null?void 0:(e=t.params)==null?void 0:(s=e.buttons)==null?void 0:s.length)>0},handleMessageButtonClick(t,e){this.$emit("clickMessageButton",{messageId:t,buttonId:e})},isLastMessage(t,e,s){return(t+1)*(e+1)+s===this.messages.length}},mounted(){h.Dom.append(this.welcomeMessageHtmlElement,this.$refs.welcomeMessage)},template:`\n\t\t<CopilotChatMessagesDateGroup\n\t\t\tv-for="(date, dateGroupIndex) of sortedByDateMessagesGroups"\n\t\t\t:date="date"\n\t\t>\n\t\t\t<CopilotChatMessagesAuthorGroup\n\t\t\t\tv-for="([authorId, messagesFromCurrentAuthor, showNewMessagesLabel], authorGroupIndex) in messagesGroupedByDayAndAuthor[date]"\n\t\t\t\t:avatar="getAuthorMessagesGroupAvatar(authorId)"\n\t\t\t\t:show-new-messages-label="showNewMessagesLabel"\n\t\t\t>\n\t\t\t\t<ul class="ai__copilot-chat-messages">\n\t\t\t\t\t<li\n\t\t\t\t\t\tv-for="(message, index) of messagesFromCurrentAuthor"\n\t\t\t\t\t\tclass="ai__copilot-chat-messages_message-wrapper"\n\t\t\t\t\t>\n\t\t\t\t\t\t<component :is="getMessageComponent(message)" \n\t\t\t\t\t\t\t\tv-copilot-chat-new-message-visibility-observer="message.viewed"\n\t\t\t\t\t\t\t\t@buttonClick="handleMessageButtonClick(message.id, $event)"\n\t\t\t\t\t\t\t\t:message="message"\n\t\t\t\t\t\t\t\t:title="getMessageTitle(message.authorId)"\n\t\t\t\t\t\t\t\t:color="getMessageColor(message)"\n\t\t\t\t\t\t\t\t:avatar="getMessageAvatarByAuthorId(message.authorId)"\n\t\t\t\t\t\t\t\t:useAvatarTail="index === messagesFromCurrentAuthor.length - 1 && isMessageHaveButtons(message) === false"\n\t\t\t\t\t\t\t\t:disable-all-actions="isLastMessage(dateGroupIndex, authorGroupIndex, index) === false"\n\t\t\t\t\t\t\t\t:menu-items="getMessageMenuItems(message)"\n\t\t\t\t\t\t></component>\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t</CopilotChatMessagesAuthorGroup>\n\t\n\t\t</CopilotChatMessagesDateGroup>\n\t`};const V={beforeMount(){const t=getComputedStyle(document.body).getPropertyValue("--ui-color-base-02");this.loader=new d.Loader({color:t,size:40})},mounted(){this.loader.show(this.$refs.loaderContainer)},unmounted(){this.loader.hide();this.loader=null},template:`\n\t\t<div class="ai__copilot-chat-history-loader">\n\t\t\t<div ref="loaderContainer" class="ai__copilot-chat-history-loader_animation-container"></div>\n\t\t\t<div class="ai__copilot-chat_history-loader_text">\n\t\t\t\t{{ $Bitrix.Loc.getMessage('AI_COPILOT_CHAT_MESSAGES_HISTORY_LOADER_TEXT') }}\n\t\t\t</div>\n\t\t</div>\n\t`};let k=t=>t,K;const X={name:"CopilotWarningMessage",methods:{showArticle(){const t=h.Reflection.getClass("top.BX.Helper");const e="20412666";t==null?void 0:t.show(`redirect=detail&code=${e}`)}},mounted(){const t=h.Tag.render(K||(K=k`<span>${0}</span>`),this.$Bitrix.Loc.getMessage("AI_COPILOT_CHAT_ANSWER_WARNING",{"#LINK_START#":'<a ref="link" href="#">',"#LINK_END#":"</a>"}));h.Event.bind(t.link,"click",this.showArticle);h.Dom.append(t.root,this.$refs.container)},template:`\n\t\t<div\n\t\t\tref="container"\n\t\t\tclass="ai__copilot-chat-warning-message"\n\t\t></div>\n\t`};const z={name:"CopilotChat",components:{CopilotChatHeader:E,CopilotChatMessages:U,CopilotChatInput:B,CopilotChatHistoryLoader:V,CopilotChatStatus:v,CopilotChatWarningMessage:X},props:{header:Object,welcomeMessageHtml:HTMLElement,botOptions:Object,scrollToTheEndAfterFirstShow:Object,slots:Object,isShowWarningMessage:{type:Object,required:false,default:()=>({value:false})},messages:Array,copilotChatInstance:Object,useInput:{type:Boolean,required:false,default:true},disableInput:Object,showLoader:Object,showCopilotWritingStatus:Object,status:Object,useStatus:Object,copilotMessageMenuItems:{type:Array,required:false,default:()=>[]},userMessageMenuItems:{type:Array,required:false,default:()=>[]}},data(){return{isCopilotWriting:false,isShowErrorScreen:false}},provide(){return{instance:this.copilotChatInstance,observer:this.observer}},computed:{isInputDisabled(){return this.disableInput.value===true},isLoaderShown(){return this.showLoader.value===true},isWarningMessageShown(){var t;return((t=this.isShowWarningMessage)==null?void 0:t.value)===true},instance(){return this.copilotChatInstance},Slot(){return{...this.slots}},headerProps(){var t,e,s,a,i;return{title:(t=this.header)==null?void 0:t.title,subtitle:(e=this.header)==null?void 0:e.subtitle,avatar:(s=this.header)==null?void 0:s.avatar,useCloseIcon:(a=this.header)==null?void 0:a.useCloseIcon,menu:(i=this.header)==null?void 0:i.menu}},botData(){var t,e;return{messageTitle:this.botOptions.messageTitle,avatar:this.botOptions.avatar,messageMenuItems:(t=(e=this.botOptions)==null?void 0:e.messageMenuItems)!=null?t:[]}},messagesList(){return this.messages},haveNewMessages(){return this.messagesList.some((t=>t.viewed===false))},copilotChatStatus(){return this.status.value},isChatStatusUsed(){return this.useStatus.value},isScrollToTheEndAfterMounted(){return this.scrollToTheEndAfterFirstShow.value}},methods:{hideChat(){this.copilotChatInstance.hide()},async handleSubmitMessage(t){const e={content:t};this.instance.addUserMessage(e)},scrollMessagesListAfterOpen(){if(this.haveNewMessages){const t=this.$refs.main.querySelector(`.${y}`);t==null?void 0:t.scrollIntoView()}else{this.scrollMessagesListToTheEnd()}},scrollMessagesListToTheEnd(t=false){this.$refs.main.scrollTo({left:0,top:9999,behavior:t?"smooth":"auto"})},handleClickOnMessageButton(t){this.instance.emitClickOnMessageButton({messageId:t.messageId,buttonId:t.buttonId})},handleAddNewUserMessage(){requestAnimationFrame((()=>{this.scrollMessagesListToTheEnd(true)}))}},beforeCreate(){this.observer=new M;this.observer.subscribe(m.VIEW_NEW_MESSAGE,(t=>{this.instance.setNewMessageIsViewed(t.getData().id)}))},mounted(){this.observer.setRoot(this.$refs.main);this.observer.init();this.instance.subscribe(Q.ADD_USER_MESSAGE,this.handleAddNewUserMessage);requestAnimationFrame((()=>{if(this.isScrollToTheEndAfterMounted){this.scrollMessagesListAfterOpen()}}))},beforeUnmount(){this.instance.unsubscribe(Q.ADD_USER_MESSAGE,this.handleAddNewUserMessage)},watch:{"messagesList.length":function(t,e){requestAnimationFrame((()=>{if(e===0&&t>1&&this.isScrollToTheEndAfterMounted){this.scrollMessagesListToTheEnd()}}))}},template:`\n\t\t<div class="ai__copilot-chat">\n\t\t\t<header class="ai__copilot-chat_header">\n\t\t\t\t<CopilotChatHeader\n\t\t\t\t\t:title="headerProps.title"\n\t\t\t\t\t:subtitle="headerProps.subtitle"\n\t\t\t\t\t:avatar="headerProps.avatar"\n\t\t\t\t\t:use-close-icon="headerProps.useCloseIcon"\n\t\t\t\t\t:menu="headerProps.menu"\n\t\t\t\t\t@clickOnCloseIcon="hideChat"\n\t\t\t\t/>\n\t\t\t</header>\n\t\t\t<main ref="main" class="ai__copilot-chat_main">\n\t\t\t\t<div\n\t\t\t\t\tv-if="isLoaderShown"\n\t\t\t\t\tclass="ai__copilot-chat_main-loader-container"\n\t\t\t\t>\n\t\t\t\t\t<slot name="loader">\n\t\t\t\t\t\t<CopilotChatHistoryLoader />\n\t\t\t\t\t</slot>\n\t\t\t\t</div>\n\t\t\t\t<div v-else-if="isShowErrorScreen">\n\t\t\t\t\t<slot name="loaderError">\n\t\t\t\t\t\tSorry, we can't load messages, try later\n\t\t\t\t\t</slot>\n\t\t\t\t</div>\n\t\t\t\t<CopilotChatMessages\n\t\t\t\t\tv-else\n\t\t\t\t\t@clickMessageButton="handleClickOnMessageButton"\n\t\t\t\t\tuser-avatar="/bitrix/js/ui/icons/b24/images/ui-user.svg?v2"\n\t\t\t\t\t:copilot-avatar="botData.avatar"\n\t\t\t\t\t:messages="messagesList"\n\t\t\t\t\t:welcome-message-html-element="welcomeMessageHtml"\n\t\t\t\t\t:copilot-message-title="botData.messageTitle"\n\t\t\t\t\t:copilot-message-menu-items="botData.messageMenuItems"\n\t\t\t\t\t:user-message-menu-items="userMessageMenuItems"\n\t\t\t\t></CopilotChatMessages>\n\t\t\t\t<CopilotChatStatus\n\t\t\t\t\tv-if="isLoaderShown === false && isChatStatusUsed"\n\t\t\t\t\t:status="copilotChatStatus"\n\t\t\t\t/>\n\t\t\t\t<div id="anchor"></div>\n\t\t\t</main>\n\t\t\t<footer class="ai__copilot-chat_footer">\n\t\t\t\t<CopilotChatInput\n\t\t\t\t\tv-if="useInput"\n\t\t\t\t\t:disabled="isInputDisabled"\n\t\t\t\t\t@submit="handleSubmitMessage"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tv-if="isWarningMessageShown"\n\t\t\t\t\tclass="ai__copilot-chat_warning-message"\n\t\t\t\t>\n\t\t\t\t\t<CopilotChatWarningMessage />\n\t\t\t\t</div>\n\t\t\t</footer>\n\t\t</div>\n\t`};let Y=t=>t,J;const Q=Object.freeze({ADD_USER_MESSAGE:"addUserMessage",ADD_BOT_MESSAGE:"addBotMessage",ADD_OLD_MESSAGES:"addBotMessage",ADD_NEW_MESSAGES:"addMessages",CLICK_ON_MESSAGE_BUTTON:"clickOnMessageButton",VIEW_NEW_MESSAGE:"viewMessage",SHOW_LOADER:"showLoader",HIDE_LOADER:"hideLoader",SHOW_COPILOT_WRITING_LOADER:"showCopilotWritingLoader",HIDE_COPILOT_WRITING_LOADER:"hideCopilotWritingLoader",DISABLE_INPUT_FIELD:"disableInputField",ENABLE_INPUT_FIELD:"enableInputField",SET_MESSAGE_STATUS:"setMessageStatus",SHOW_ERROR_SCREEN:"showErrorScreen",HIDE_ERROR_SCREEN:"hideErrorScreen"});const Z={DEPART:"depart",SENT:"sent",DELIVERED:"delivered",ERROR:"error"};var tt=babelHelpers.classPrivateFieldLooseKey("copilotChatOptions");var et=babelHelpers.classPrivateFieldLooseKey("popupOptions");var st=babelHelpers.classPrivateFieldLooseKey("popup");var at=babelHelpers.classPrivateFieldLooseKey("app");var it=babelHelpers.classPrivateFieldLooseKey("messages");var nt=babelHelpers.classPrivateFieldLooseKey("isShowLoader");var ot=babelHelpers.classPrivateFieldLooseKey("isInputDisabled");var rt=babelHelpers.classPrivateFieldLooseKey("chatStatus");var lt=babelHelpers.classPrivateFieldLooseKey("useChatStatus");var ct=babelHelpers.classPrivateFieldLooseKey("copilotMessageMenuItems");var ut=babelHelpers.classPrivateFieldLooseKey("userMessageMenuItems");var dt=babelHelpers.classPrivateFieldLooseKey("scrollToTheEndAfterFirstShow");var ht=babelHelpers.classPrivateFieldLooseKey("showCopilotWarningMessage");var pt=babelHelpers.classPrivateFieldLooseKey("copilotChatBotOptions");var vt=babelHelpers.classPrivateFieldLooseKey("findMessageButton");var mt=babelHelpers.classPrivateFieldLooseKey("setMessageStatus");var gt=babelHelpers.classPrivateFieldLooseKey("addNewMessage");var bt=babelHelpers.classPrivateFieldLooseKey("initPopup");var _t=babelHelpers.classPrivateFieldLooseKey("renderPopupContent");class ft extends a.EventEmitter{constructor(t={}){var e;super(t);Object.defineProperty(this,_t,{value:Et});Object.defineProperty(this,bt,{value:St});Object.defineProperty(this,gt,{value:It});Object.defineProperty(this,mt,{value:Ct});Object.defineProperty(this,vt,{value:Mt});Object.defineProperty(this,tt,{writable:true,value:void 0});Object.defineProperty(this,et,{writable:true,value:void 0});Object.defineProperty(this,st,{writable:true,value:void 0});Object.defineProperty(this,at,{writable:true,value:void 0});Object.defineProperty(this,it,{writable:true,value:void 0});Object.defineProperty(this,nt,{writable:true,value:void 0});Object.defineProperty(this,ot,{writable:true,value:void 0});Object.defineProperty(this,rt,{writable:true,value:void 0});Object.defineProperty(this,lt,{writable:true,value:void 0});Object.defineProperty(this,ct,{writable:true,value:void 0});Object.defineProperty(this,ut,{writable:true,value:void 0});Object.defineProperty(this,dt,{writable:true,value:void 0});Object.defineProperty(this,ht,{writable:true,value:void 0});Object.defineProperty(this,pt,{writable:true,value:void 0});this.setEventNamespace("AI.CopilotChat");babelHelpers.classPrivateFieldLooseBase(this,tt)[tt]=t||{};babelHelpers.classPrivateFieldLooseBase(this,pt)[pt]=n.ref((e=t==null?void 0:t.botOptions)!=null?e:{});babelHelpers.classPrivateFieldLooseBase(this,et)[et]=(t==null?void 0:t.popupOptions)||{};babelHelpers.classPrivateFieldLooseBase(this,it)[it]=n.ref([]);babelHelpers.classPrivateFieldLooseBase(this,ct)[ct]=n.ref(h.Type.isArray(t.botOptions.messageMenuItems)?t.botOptions.messageMenuItems:[]);babelHelpers.classPrivateFieldLooseBase(this,ut)[ut]=n.ref(h.Type.isArray(t.userMessageMenuItems)?t.userMessageMenuItems:[]);babelHelpers.classPrivateFieldLooseBase(this,nt)[nt]=n.ref(false);babelHelpers.classPrivateFieldLooseBase(this,ot)[ot]=n.ref(false);babelHelpers.classPrivateFieldLooseBase(this,rt)[rt]=n.ref(p.NONE);babelHelpers.classPrivateFieldLooseBase(this,lt)[lt]=n.ref(h.Type.isBoolean(t.useChatStatus)?t.useChatStatus:true);babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]=n.ref(h.Type.isBoolean(t.scrollToTheEndAfterFirstShow)?t.scrollToTheEndAfterFirstShow:true);babelHelpers.classPrivateFieldLooseBase(this,ht)[ht]=n.ref(t.showCopilotWarningMessage===true)}static getDefaultMinWidth(){return 375}static getDefaultHeight(){return 669}addUserMessage(t){const e={...t,authorId:1};babelHelpers.classPrivateFieldLooseBase(this,gt)[gt](e)}addBotMessage(t){const e={...t,authorId:0,status:null};babelHelpers.classPrivateFieldLooseBase(this,gt)[gt](e)}addSystemMessage(t){const e={...t,authorId:null,status:null};babelHelpers.classPrivateFieldLooseBase(this,gt)[gt](e)}enableInput(){babelHelpers.classPrivateFieldLooseBase(this,ot)[ot].value=false;this.emit(Q.ENABLE_INPUT_FIELD)}disableInput(){babelHelpers.classPrivateFieldLooseBase(this,ot)[ot].value=true;this.emit(Q.DISABLE_INPUT_FIELD)}showLoader(){babelHelpers.classPrivateFieldLooseBase(this,nt)[nt].value=true;this.emit(Q.SHOW_LOADER)}hideLoader(){babelHelpers.classPrivateFieldLooseBase(this,nt)[nt].value=false;this.emit(Q.HIDE_LOADER)}setMessageStatusDepart(t){babelHelpers.classPrivateFieldLooseBase(this,mt)[mt](t,Z.DEPART)}setMessageStatusDelivered(t){babelHelpers.classPrivateFieldLooseBase(this,mt)[mt](t,Z.DELIVERED)}setMessageStatusSent(t){babelHelpers.classPrivateFieldLooseBase(this,mt)[mt](t,Z.SENT)}setCopilotWritingStatus(t){if(t===true){babelHelpers.classPrivateFieldLooseBase(this,rt)[rt].value=p.COPILOT_WRITING}else{babelHelpers.classPrivateFieldLooseBase(this,rt)[rt].value=p.NONE}}setNewMessageIsViewed(t){this.emit(Q.VIEW_NEW_MESSAGE,new a.BaseEvent({data:{id:t}}))}emitClickOnMessageButton(t){const{buttonId:e,messageId:s}=t;const a=babelHelpers.classPrivateFieldLooseBase(this,vt)[vt](s,e);a.isSelected=true;this.emit(Q.CLICK_ON_MESSAGE_BUTTON,{messageId:s,button:{...a}})}show(){if(!babelHelpers.classPrivateFieldLooseBase(this,st)[st]){babelHelpers.classPrivateFieldLooseBase(this,bt)[bt]()}babelHelpers.classPrivateFieldLooseBase(this,st)[st].show()}hide(){var t;(t=babelHelpers.classPrivateFieldLooseBase(this,st)[st])==null?void 0:t.close()}isShown(){var t;return Boolean((t=babelHelpers.classPrivateFieldLooseBase(this,st)[st])==null?void 0:t.isShown())}}function Mt(t,e){var s,a;const i=babelHelpers.classPrivateFieldLooseBase(this,it)[it].value.find((e=>e.id===t));if(h.Type.isArray((s=i.params)==null?void 0:s.buttons)===false){return null}return(a=i.params.buttons.find((t=>t.id===e)))!=null?a:null}function Ct(t,e){const s=babelHelpers.classPrivateFieldLooseBase(this,it)[it].value.find((e=>e.id===t));if(!s){return}s.status=e;this.emit(Q.SET_MESSAGE_STATUS,{messageId:t,status:e})}function It(t){var e;const s=Math.round(-Math.random()*1e3);const a=this.isShown();const i={id:s,dateCreated:(new Date).toISOString(),status:Z.DEPART,authorId:0,...t,viewed:(e=t==null?void 0:t.viewed)!=null?e:a};babelHelpers.classPrivateFieldLooseBase(this,it)[it].value.push(i);if(i.authorId===0){this.emit(Q.ADD_BOT_MESSAGE,{message:i})}else{this.emit(Q.ADD_USER_MESSAGE,{message:i})}}function St(){var t,e,s,a,i,n,o;babelHelpers.classPrivateFieldLooseBase(this,st)[st]=new l.Popup({...babelHelpers.classPrivateFieldLooseBase(this,et)[et],content:babelHelpers.classPrivateFieldLooseBase(this,_t)[_t](),minWidth:(t=(e=babelHelpers.classPrivateFieldLooseBase(this,et)[et])==null?void 0:e.minWidth)!=null?t:ft.getDefaultMinWidth(),height:(s=(a=babelHelpers.classPrivateFieldLooseBase(this,et)[et])==null?void 0:a.height)!=null?s:ft.getDefaultHeight(),contentNoPaddings:true,padding:0,borderRadius:"16px",className:`ai__copilot-chat-popup ${(i=babelHelpers.classPrivateFieldLooseBase(this,et)[et].className)!=null?i:""}`,cacheable:(n=(o=babelHelpers.classPrivateFieldLooseBase(this,et)[et])==null?void 0:o.cacheable)!=null?n:false,events:{onPopupAfterClose:()=>{var t,e;babelHelpers.classPrivateFieldLooseBase(this,st)[st]=null;babelHelpers.classPrivateFieldLooseBase(this,at)[at].unmount();if(h.Type.isFunction((t=babelHelpers.classPrivateFieldLooseBase(this,et)[et])==null?void 0:(e=t.events)==null?void 0:e.onPopupAfterClose)){var s,a;(s=babelHelpers.classPrivateFieldLooseBase(this,et)[et])==null?void 0:(a=s.events)==null?void 0:a.onPopupAfterClose()}}}});return babelHelpers.classPrivateFieldLooseBase(this,st)[st]}function Et(){var t,e,s,a,i;const o=h.Tag.render(J||(J=Y`<div class="ai__copilot-chat-popup-content"></div>`));babelHelpers.classPrivateFieldLooseBase(this,at)[at]=n.BitrixVue.createApp({name:"CopilotChatPopup",components:{CopilotChat:z,...(t=babelHelpers.classPrivateFieldLooseBase(this,tt)[tt])==null?void 0:t.vueComponents},template:`\n\t\t\t\t<CopilotChat>\n\t\t\t\t\t<template v-slot:loader>\n\t\t\t\t\t\t${(e=(s=babelHelpers.classPrivateFieldLooseBase(this,tt)[tt].slots)==null?void 0:s.LOADER)!=null?e:""}\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-slot:loaderError>\n\t\t\t\t\t\t${(a=(i=babelHelpers.classPrivateFieldLooseBase(this,tt)[tt].slots)==null?void 0:i.LOADER_ERROR)!=null?a:""}\n\t\t\t\t\t</template>\n\t\t\t\t</CopilotChat>\n\t\t\t`},{...babelHelpers.classPrivateFieldLooseBase(this,tt)[tt],messages:babelHelpers.classPrivateFieldLooseBase(this,it)[it].value,copilotChatInstance:this,showLoader:babelHelpers.classPrivateFieldLooseBase(this,nt)[nt],disableInput:babelHelpers.classPrivateFieldLooseBase(this,ot)[ot],status:babelHelpers.classPrivateFieldLooseBase(this,rt)[rt],useStatus:babelHelpers.classPrivateFieldLooseBase(this,lt)[lt],scrollToTheEndAfterFirstShow:babelHelpers.classPrivateFieldLooseBase(this,dt)[dt],copilotMessageMenuItems:babelHelpers.classPrivateFieldLooseBase(this,ct)[ct].value,userMessageMenuItems:babelHelpers.classPrivateFieldLooseBase(this,ut)[ut].value,isShowWarningMessage:babelHelpers.classPrivateFieldLooseBase(this,ht)[ht],botOptions:babelHelpers.classPrivateFieldLooseBase(this,pt)[pt].value});babelHelpers.classPrivateFieldLooseBase(this,at)[at].mount(o);return o}t.CopilotChat=ft;t.CopilotChatEvents=Q;t.CopilotChatMessageType=F})(this.BX.AI.CopilotChat.UI=this.BX.AI.CopilotChat.UI||{},BX,BX.AI,BX.Event,BX.UI.IconSet,BX.Vue3,BX,BX.Main,BX.Main,BX.UI.IconSet,BX.UI.BBCode.Formatter,BX,BX);
//# sourceMappingURL=copilot-chat.bundle.map.js