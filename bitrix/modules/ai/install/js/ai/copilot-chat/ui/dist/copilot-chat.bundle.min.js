this.BX=this.BX||{};this.BX.AI=this.BX.AI||{};this.BX.AI.CopilotChat=this.BX.AI.CopilotChat||{};(function(t,e,s,a,i,o,n,r,l,c,u,d,h,p){"use strict";const v=Object.freeze({COPILOT_WRITING:"copilot-writing",NONE:"none"});const m={components:{BIcon:c.BIcon},props:{status:{type:String,required:false,default:v.NONE}},computed:{Status(){return v},writingStatusIcon(){return{name:c.Set.PENCIL_60,size:14,color:"#fff"}},containerClassname(){return["ai__copilot-chat_status",`--${this.status}`]}},template:`\n\t\t<div class="ai__copilot-chat_status-wrapper">\n\t\t\t<div class="ai__copilot-chat_status">\n\t\t\t\t<template v-if="status === Status.COPILOT_WRITING">\n\t\t\t\t\t<span class="ai__copilot-chat_status-icon --typing">\n\t\t\t\t\t\t<BIcon\n\t\t\t\t\t\t\tv-bind="writingStatusIcon"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span>{{ $Bitrix.Loc.getMessage('AI_COPILOT_CHAT_STATUS_COPILOT_WRITING') }}</span>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t`};const g=Object.freeze({VIEW_NEW_MESSAGE:"viewNewMessage"});var b=babelHelpers.classPrivateFieldLooseKey("observer");var _=babelHelpers.classPrivateFieldLooseKey("root");var f=babelHelpers.classPrivateFieldLooseKey("observableElements");var M=babelHelpers.classPrivateFieldLooseKey("getThreshold");class I extends a.EventEmitter{constructor(t){super(t);Object.defineProperty(this,M,{value:C});Object.defineProperty(this,b,{writable:true,value:null});Object.defineProperty(this,_,{writable:true,value:null});Object.defineProperty(this,f,{writable:true,value:[]});this.setEventNamespace("AI.CopilotChat.InterSectionManager")}init(){babelHelpers.classPrivateFieldLooseBase(this,b)[b]=new IntersectionObserver((t=>{t.forEach((t=>{const e=t.isIntersecting&&t.intersectionRatio>.5;if(e){const e=t.target;this.emit(g.VIEW_NEW_MESSAGE,new a.BaseEvent({data:{id:p.Dom.attr(e,"data-id")}}));babelHelpers.classPrivateFieldLooseBase(this,b)[b].unobserve(e)}}))}),{root:babelHelpers.classPrivateFieldLooseBase(this,_)[_],threshold:babelHelpers.classPrivateFieldLooseBase(this,M)[M]()});babelHelpers.classPrivateFieldLooseBase(this,f)[f].forEach((t=>{babelHelpers.classPrivateFieldLooseBase(this,b)[b].observe(t)}))}observe(t){if(!babelHelpers.classPrivateFieldLooseBase(this,_)[_]||!babelHelpers.classPrivateFieldLooseBase(this,b)[b]){babelHelpers.classPrivateFieldLooseBase(this,f)[f].push(t)}else{babelHelpers.classPrivateFieldLooseBase(this,b)[b].observe(t)}}unobserve(t){babelHelpers.classPrivateFieldLooseBase(this,b)[b].unobserve(t)}setRoot(t){babelHelpers.classPrivateFieldLooseBase(this,_)[_]=t}}function C(){const t=Array.from({length:101}).fill(0);return t.map(((t,e)=>e*.01))}const L={props:{src:String,alt:String},template:`\n\t\t<img\n\t\t\tclass="ai__copilot-chat-avatar"\n\t\t\t:alt="alt"\n\t\t\t:src="src"\n\t\t/>\n\t`};const S={components:{BIcon:c.BIcon},props:{menuItems:{type:Array,required:true,default:()=>[]}},computed:{items(){return this.menuItems},menuIconProps(){return{name:c.Set.MORE,size:24}}},beforeMount(){this.menu=new l.Menu({items:this.items})},mounted(){this.menu.getPopupWindow().setBindElement(this.$refs.menuButton)},beforeUnmount(){this.menu.destroy()},methods:{toggleMenu(){if(this.isMenuOpen()){this.hideMenu()}else{this.showMenu()}},showMenu(){this.menu.show()},hideMenu(){this.menu.close()},isMenuOpen(){return this.menu.getPopupWindow().isShown()}},template:`\n\t\t<button\n\t\t\tref="menuButton"\n\t\t\t@click="toggleMenu"\n\t\t\tclass="ai__copilot-chat-header-menu"\n\t\t>\n\t\t\t<span class="ai__copilot-chat-header-menu_icon">\n\t\t\t\t<b-icon\n\t\t\t\t\tv-bind="menuIconProps"\n\t\t\t\t></b-icon>\n\t\t\t</span>\n\t\t</button>\n\t`};const E={components:{CopilotChatAvatar:L,CopilotChatHeaderMenu:S,BIcon:c.BIcon},emits:["clickOnCloseIcon"],props:{title:String,subtitle:String,avatar:String,useCloseIcon:{type:Boolean,required:false,default:false},menu:Object},computed:{closeIconProps(){return{name:c.Set.CROSS_40,size:24}},isMenuExists(){return this.menu&&this.menu.items&&this.menu.items.length>0},menuItems(){var t,e;return(t=(e=this.menu)==null?void 0:e.items)!=null?t:[]}},methods:{handleClickOnCloseIcon(){this.$emit("clickOnCloseIcon")}},template:`\n\t\t<div class="ai__copilot-chat-header">\n\t\t\t<button\n\t\t\t\tv-if="useCloseIcon"\n\t\t\t\t@click="handleClickOnCloseIcon"\n\t\t\t\tclass="ai__copilot-chat-header_close-icon"\n\t\t\t>\n\t\t\t\t<b-icon\n\t\t\t\t\tv-bind="closeIconProps"\n\t\t\t\t />\n\t\t\t</button>\n\t\t\t<div class="ai__copilot-chat-header_avatar">\n\t\t\t\t<CopilotChatAvatar\n\t\t\t\t\t:src="avatar"\n\t\t\t\t\t:alt="title"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class="ai__copilot-chat-header_info">\n\t\t\t\t<h4 class="ai__copilot-chat-header_title">\n\t\t\t\t\t{{ title }}\n\t\t\t\t</h4>\n\t\t\t\t<div class="ai__copilot-chat-header_subtitle">\n\t\t\t\t\t{{ subtitle }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if="isMenuExists"\n\t\t\t\tclass="ai__copilot-chat-header_menu"\n\t\t\t>\n\t\t\t\t<copilot-chat-header-menu :menu-items="menuItems"></copilot-chat-header-menu>\n\t\t\t</div>\n\t\t</div>\n\t`};const B={components:{BIcon:c.BIcon},emits:["input","start","stop"],data(){return{converter:null,isVoiceRecording:false}},computed:{IconSet(){return r.Set},isVoiceInputDisabled(){return s.SpeechConverter.isBrowserSupport()===false}},methods:{handleClickOnStartVoiceInputBtn(){if(this.isVoiceRecording){this.stopVoiceInput()}else{this.startVoiceInput()}},startVoiceInput(){const t=i.toRaw(this.converter);t.start()},stopVoiceInput(){const t=i.toRaw(this.converter);t.stop()},handleSpeechConverterStartEvent(){this.$emit("start");this.isVoiceRecording=true},handleSpeechConverterStopEvent(){this.isVoiceRecording=false;this.$emit("stop")},handleSpeechConverterResultEvent(t){this.$emit("input",t.getData().text)},handleSpeechConverterErrorEvent(t){console.error(t);this.isVoiceRecording=false}},mounted(){if(this.isVoiceInputDisabled===false){this.converter=new s.SpeechConverter({});const t=i.toRaw(this.converter);t.subscribe(s.speechConverterEvents.start,this.handleSpeechConverterStartEvent);t.subscribe(s.speechConverterEvents.stop,this.handleSpeechConverterStopEvent);t.subscribe(s.speechConverterEvents.result,this.handleSpeechConverterResultEvent.bind(this));t.subscribe(s.speechConverterEvents.error,this.handleSpeechConverterErrorEvent)}},unmounted(){if(this.isVoiceInputDisabled===false){const t=i.toRaw(this.converter);t.unsubscribe(s.speechConverterEvents.start,this.handleSpeechConverterStartEvent);t.unsubscribe(s.speechConverterEvents.stop,this.handleSpeechConverterStopEvent);t.unsubscribe(s.speechConverterEvents.result,this.handleSpeechConverterResultEvent.bind(this));t.unsubscribe(s.speechConverterEvents.error,this.handleSpeechConverterErrorEvent)}},template:`\n\t\t<button\n\t\t\t:disabled="isVoiceInputDisabled"\n\t\t\t@click="handleClickOnStartVoiceInputBtn"\n\t\t\tclass="ai__copilot-chat-input_voice-input"\n\t\t>\n\t\t\t<span\n\t\t\t\tv-if="isVoiceRecording === false"\n\t\t\t\tclass="ai__copilot-chat-input_voice-input-no-record-icon-wrapper"\n\t\t\t>\n\t\t\t\t<BIcon\n\t\t\t\t\t:size="24"\n\t\t\t\t\t:name="IconSet.MICROPHONE_ON"\n\t\t\t\t/>\n\t\t\t</span>\n\t\t\t<span\n\t\t\t\tv-else\n\t\t\t\tclass="ai__copilot-chat-input_voice-input-record-icon-wrapper"\n\t\t\t>\n\t\t\t\t<span class="ai__copilot-chat-input_voice-input-record-icon"></span>\n\t\t\t</span>\n\t\t</button>\n\t`};const P={components:{CopilotChatVoiceInputBtn:B},emits:["submit"],props:{disabled:{type:Boolean,required:false,default:false},placeholder:{type:String,required:false,default:p.Loc.getMessage("AI_COPILOT_CHAT_INPUT_PLACEHOLDER")}},data(){return{userMessage:"",userMessageBeforeVoiceInput:this.userMessage,isRecording:false}},computed:{isSubmitButtonDisabled(){return!this.userMessage||this.userMessage.trim().length===0||this.isRecording},containerClassname(){return{"ai__copilot-chat-input":true,"--disabled":this.disabled}}},mounted(){setTimeout((()=>{this.$refs.textarea.focus()}),500)},methods:{handleSubmitButton(t){t.target.blur();this.submitMessage()},handleEnterKeyDown(t){var e;if(t.shiftKey||t.ctrlKey){return true}t.preventDefault();if((e=this.userMessage)!=null&&e.trim()){this.submitMessage()}return false},submitMessage(){this.$emit("submit",this.userMessage.trim());this.userMessage=""},handleInput(t){this.userMessage=t.target.value},handleVoiceInputText(t){this.userMessage=this.userMessageBeforeVoiceInput+t;this.updateTextareaHeight()},handleStartVoiceInput(){this.isRecording=true;if(this.userMessage&&this.userMessage.at(-1)!==" "){this.userMessage+=" "}this.userMessageBeforeVoiceInput=this.userMessage},handleStopVoiceInput(){this.isRecording=false;this.$refs.textarea.focus()},updateTextareaHeight(){const t=this.$refs.textarea;p.Dom.style(t,"height","auto");p.Dom.style(t,"height",`${t.scrollHeight}px`)}},watch:{userMessage(){requestAnimationFrame((()=>{this.updateTextareaHeight()}))},disabled(t){if(t===false){this.$refs.textarea.focus()}else{this.$refs.textarea.blur()}}},template:`\n\t\t<div :class="containerClassname">\n\t\t\t<div class="ai__copilot-chat-input_textarea-wrapper">\n\t\t\t\t<textarea\n\t\t\t\t\ttype="text" class="ai__copilot-chat-input_textarea"\n\t\t\t\t\tref="textarea"\n\t\t\t\t\t:placeholder="placeholder"\n\t\t\t\t\trows="1"\n\t\t\t\t\t@input="handleInput"\n\t\t\t\t\t@keydown.enter="handleEnterKeyDown"\n\t\t\t\t\t:value="userMessage"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class="ai__copilot-chat-input_actions">\n\t\t\t\t<CopilotChatVoiceInputBtn\n\t\t\t\t\t@start="handleStartVoiceInput"\n\t\t\t\t\t@input="handleVoiceInputText"\n\t\t\t\t\t@stop="handleStopVoiceInput"\n\t\t\t\t/>\n\t\t\t\t<button @click="handleSubmitButton" :disabled="isSubmitButtonDisabled" class="ai__copilot-chat-input_submit"></button>\n\t\t\t</div>\n\t\t</div>\n\t`};const y=t=>t===0;const O={props:{avatar:String,avatarAlt:String,messageTitle:String,messageText:String,time:String,buttons:{type:Array,required:false,default:()=>[]},colorScheme:String,status:{type:String,required:false}},computed:{messageButtons(){return this.buttons},formattedTime(){const t=new Date(this.time);return`${t.getHours()}:${t.getMinutes()}`},isUserMessage(){return true}},template:`\n\t\t<div\n\t\t\tclass="ai__copilot-chat-message"\n\t\t\t:class="'--color-schema-' + colorScheme"\n\t\t>\n\t\t\t<div class="ai__copilot-chat-message_avatar-wrapper">\n\t\t\t\t<img\n\t\t\t\t\tclass="ai__copilot-chat-message_avatar"\n\t\t\t\t\t:src="avatar"\n\t\t\t\t\t:alt="avatarAlt"\n\t\t\t\t\t:title="avatarAlt"\n\t\t\t\t>\n\t\t\t</div>\n\t\t\t<div class="ai__copilot-chat-message-content-wrapper">\n\t\t\t\t<div class="ai__copilot-chat-message-content">\n\t\t\t\t\t<div class="ai__copilot-chat-message-content-main">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-if="messageTitle"\n\t\t\t\t\t\t\tclass="ai__copilot-chat-message-title"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ messageTitle }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="ai__copilot-chat-message-text">\n\t\t\t\t\t\t\t{{ messageText }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="ai__copilot-chat-message_time">\n\t\t\t\t\t\t{{ formattedTime }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="status"\n\t\t\t\t\t\tclass="ai__copilot-chat-message_status"\n\t\t\t\t\t\t:class="'--' + status"\n\t\t\t\t\t></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if="messageButtons.length > 0" class="ai__copilot-chat-message_action-buttons">\n\t\t\t\t<button\n\t\t\t\t\tv-for="button in messageButtons"\n\t\t\t\t\tclass="ai__copilot-chat-message_action-button"\n\t\t\t\t\t:class="{'--selected': button.isSelected}"\n\t\t\t\t>\n\t\t\t\t\t{{ button.text }}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t`};const H={props:{avatar:String,title:String,content:String},template:`\n\t\t<div class="landing__copilot-landing-chat-welcome-message">\n\t\t\t<div class="landing__copilot-landing-chat-welcome-message_avatar-wrapper">\n\t\t\t\t<img\n\t\t\t\t\tclass="landing__copilot-landing-chat-welcome-message_avatar"\n\t\t\t\t\tsrc="/dev/ai/copilot-chat/images/avatar-example-4x.png"\n\t\t\t\t\talt="Copilot Designer"\n\t\t\t\t>\n\t\t\t</div>\n\t\t\t<div class="landing__copilot-landing-chat-welcome-message_content">\n\t\t\t\t<h6 class="landing__copilot-landing-chat-welcome-message_title">{{ title }}</h6>\n\t\t\t\t<div v-html="content"></div>\n\t\t\t</div>\n\t\t</div>\n\t`};const A={props:{date:{type:String,required:false,default:""}},computed:{formattedDate(){const t=[["today","today"],["yesterday","yesterday"],["m","l, d F"],["","l, d F Y"]];return n.DateTimeFormat.format(t,new Date(this.date),new Date)}},template:`\n\t\t<div class="ai__copilot-chat-messages-date-group">\n\t\t\t<div class="ai__copilot-chat-messages-date-group__date">\n\t\t\t\t<div class="ai__copilot-chat-messages-date-group__date-label">\n\t\t\t\t\t{{ formattedDate }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="ai__copilot-chat-messages-date-group__content">\n\t\t\t\t<slot></slot>\n\t\t\t</div>\n\t\t</div>\n\t`};const T="ai__copilot-chat_new-messages-label";const w={template:`\n\t\t<div class="${T}">\n\t\t\t{{ $Bitrix.Loc.getMessage('AI_COPILOT_CHAT_NEW_MESSAGES_LABEL') }}\n\t\t</div>\n\t`};const F={components:{CopilotChatNewMessagesLabel:w},props:{avatar:{type:String,required:false},showNewMessagesLabel:{type:Boolean,required:false,default:false}},template:`\n\t\t<CopilotChatNewMessagesLabel v-if="showNewMessagesLabel" />\n\t\t<div class="ai__copilot-chat_messages-author-group">\n\t\t\t<div class="ai__copilot-chat_messages-author-group__avatar">\n\t\t\t\t<img v-if="avatar" :src="avatar" alt="#">\n\t\t\t</div>\n\t\t\t<div class="ai__copilot-chat_messages-author-group__messages">\n\t\t\t\t<slot></slot>\n\t\t\t</div>\n\t\t</div>\n\t`};const R=Object.freeze({DEFAULT:"Default",BUTTON_CLICK_MESSAGE:"ButtonClicked",WELCOME_FLOWS:"WelcomeFlows",WELCOME_SITE_WITH_AI:"GreetingSiteWithAi",SYSTEM:"System"});const D={mounted(t,e){const s=e.value;if(s===false){e.instance.observer.observe(t)}},beforeUnmount(t,e){e.instance.observer.unobserve(t)}};const N={components:{BIcon:c.BIcon},props:{icon:{type:String,required:true},class:Array|Object|String},computed:{menuIconProps(){return{name:this.icon,size:22}},className(){return this.class}},template:`\n\t\t<button\n\t\t\tclass="ai__copilot-chat-message-menu"\n\t\t\t:class="className"\n\t\t>\n\t\t\t<BIcon v-bind="menuIconProps"></BIcon>\n\t\t</button>\n\t`};const W={components:{BIcon:c.BIcon,CopilotChatMessageButton:N},props:{menuItems:{type:Array,required:true,default:()=>[]},message:{type:Object,required:true,default:()=>({})},icon:{type:String,required:false,default:c.Set.MORE}},data(){return{isMenuOpen:false}},computed:{items(){return this.menuItems.map((t=>({...t,onclick:(e,s)=>{const a={message:{id:this.message.id,content:this.message.content,dateCreate:this.message.dateCreate}};this.hideMenu();return t.onclick(e,s,a)}})))},menuIconProps(){return{name:this.icon,size:22}},menuButtonClassname(){return{"ai__copilot-chat-message-menu":true,"--open":this.isMenuOpen}}},methods:{toggleMenu(){if(this.isMenuOpen){this.hideMenu()}else{this.showMenu()}},showMenu(){var t;if(!this.menu){this.initMenu()}(t=this.menu)==null?void 0:t.show()},hideMenu(){var t;(t=this.menu)==null?void 0:t.close()},initMenu(){this.menu=new l.Menu({items:this.items,angle:{offset:p.Dom.getPosition(this.$refs.menuButton.$el).width/2+23},events:{onPopupShow:()=>{this.isMenuOpen=true},onPopupClose:()=>{this.isMenuOpen=false}},bindElement:this.$refs.menuButton.$el});p.bind(document.body.querySelector(".ai__copilot-chat_main"),"scroll",(()=>{this.hideMenu()}));return this.menu}},beforeUnmount(){var t;(t=this.menu)==null?void 0:t.destroy()},template:`\n\t\t<CopilotChatMessageButton\n\t\t\tref="menuButton"\n\t\t\t@click="toggleMenu"\n\t\t\t:icon="menuIconProps.name"\n\t\t\t:class="menuButtonClassname"\n\t\t/>\n\t`};const $={components:{CopilotChatMessageMenu:W},emits:["buttonClick","remove","retry"],props:{message:{type:Object,required:true},avatar:{type:String,required:true},title:{type:String,required:false},useAvatarTail:{type:Boolean,required:false,default:false},menuItems:{type:Array,required:false,default:()=>[]},color:{type:String,required:false,default:""},disableAllActions:{type:Boolean,required:false,default:false}},computed:{messageData(){return this.message},messageContent(){return this.messageData.content},isMessageFromCopilot(){return y(this.messageData.authorId)},formattedMessageContent(){const t=new u.HtmlFormatter({containerMode:"collapsed"});return t.format({source:this.messageContent})},formattedDeliveryTime(){return this.formatTime(this.messageData.dateCreate)},messageButtons(){var t,e;return(t=(e=this.messageData.params)==null?void 0:e.buttons)!=null?t:[]},isSomeButtonSelected(){return this.messageButtons.some((t=>t.selected))},showMenuButton(){var t;return((t=this.menuItems)==null?void 0:t.length)>0},isErrorMessage(){return this.messageData.status===at.ERROR},errorMessageMenuItems(){return[{id:"retry",text:this.$Bitrix.Loc.getMessage("AI_COPILOT_CHAT_RETRY_MESSAGE"),onclick:()=>{this.$emit("retry",this.messageData.id)}},{id:"remove",text:this.$Bitrix.Loc.getMessage("AI_COPILOT_CHAT_REMOVE_MESSAGE"),onclick:()=>{this.$emit("remove",this.messageData.id)}}]},Icons(){return r.Set}},methods:{formatTime(t){if(!t){return""}const e=new Date(t);const s=e.getHours().toString().padStart(2,"0");const a=e.getMinutes().toString().padStart(2,"0");return`${s}:${a}`}},mounted(){if(this.isMessageFromCopilot){p.Dom.append(this.formattedMessageContent,this.$refs.content)}else{this.$refs.content.innerText=this.messageContent}},template:`\n\t\t<div\n\t\t\t:data-id="messageData.id"\n\t\t\tclass="ai__copilot-chat-message"\n\t\t\t:class="'--color-schema-' + color"\n\t\t>\n\t\t\t<div\n\t\t\t\tclass="ai__copilot-chat-message-content-wrapper"\n\t\t\t\t:class="{ '--with-tail': useAvatarTail }"\n\t\t\t>\n\t\t\t\t<div class="ai__copilot-chat-message-content">\n\t\t\t\t\t<div class="ai__copilot-chat-message-content-main">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-if="title"\n\t\t\t\t\t\t\tclass="ai__copilot-chat-message-title"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ title }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="ai__copilot-chat-message-text" ref="content"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="ai__copilot-chat-message_status-info">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-if="messageData.dateCreate"\n\t\t\t\t\t\t\tclass="ai__copilot-chat-message_time"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ formattedDeliveryTime }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-if="messageData.status && isMessageFromCopilot === false"\n\t\t\t\t\t\t\tclass="ai__copilot-chat-message_status"\n\t\t\t\t\t\t\t:class="'--' + messageData.status"\n\t\t\t\t\t\t></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-if="messageButtons.length > 0" class="ai__copilot-chat-message_action-buttons">\n\t\t\t\t\t<button\n\t\t\t\t\t\tv-for="button in messageButtons"\n\t\t\t\t\t\tclass="ai__copilot-chat-message_action-button"\n\t\t\t\t\t\t:class="{'--selected': button.selected}"\n\t\t\t\t\t\t:disabled="isSomeButtonSelected || disableAllActions"\n\t\t\t\t\t\t@click="$emit('buttonClick', button.id)"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ button.title }}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if="showMenuButton"\n\t\t\t\tclass="ai__copilot-chat-message_menu"\n\t\t\t>\n\t\t\t\t<CopilotChatMessageMenu\n\t\t\t\t\t:menu-items="menuItems"\n\t\t\t\t\t:message="message"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-else-if="isErrorMessage"\n\t\t\t\tclass="ai__copilot-chat-message_retry-button"\n\t\t\t>\n\t\t\t\t<CopilotChatMessageMenu\n\t\t\t\t\t:menu-items="errorMessageMenuItems"\n\t\t\t\t\t:message="message"\n\t\t\t\t\t:icon="Icons.REDO_1"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`};const j={props:{message:{type:Object,required:false},avatar:{type:String,required:false}},computed:{messageInfo(){return this.message},title(){var t,e;return(t=(e=this.messageInfo.params)==null?void 0:e.title)!=null?t:""},subtitle(){var t,e;return(t=(e=this.messageInfo.params)==null?void 0:e.subtitle)!=null?t:""},content(){var t,e;return(t=(e=this.messageInfo.params)==null?void 0:e.content)!=null?t:""}},template:`\n\t\t<div class="ai__copilot-chat-message-welcome">\n\t\t\t<header class="ai__copilot-chat-message-welcome_header">\n\t\t\t\t<div class="ai__copilot-chat-message-welcome_header-left">\n\t\t\t\t\t<img\n\t\t\t\t\t\t:src="avatar"\n\t\t\t\t\t\talt="#"\n\t\t\t\t\t\tclass="ai__copilot-chat-message-welcome_avatar"\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t\t<div class="ai__copilot-chat-message-welcome_header-right">\n\t\t\t\t\t<h5 class="ai__copilot-chat-message-welcome_title">{{ title }}</h5>\n\t\t\t\t\t<p v-if="subtitle" class="ai__copilot-chat-message-welcome_subtitle">{{ subtitle }}</p>\n\t\t\t\t</div>\n\t\t\t</header>\n\t\t\t<main class="ai__copilot-chat-message-welcome_main">\n\t\t\t\t<div class="ai__copilot-chat-message-welcome_content">\n\t\t\t\t\t<slot name="content">\n\t\t\t\t\t\t{{ content }}\n\t\t\t\t\t</slot>\n\t\t\t\t</div>\n\t\t\t</main>\n\t\t</div>\n\t`};let x=t=>t,G;const k={components:{CopilotChatMessageWelcome:j},props:{message:{type:Object,required:false},avatar:{type:String,required:false},disableAllActions:{type:Boolean,required:false,default:false}},inject:["instance"],computed:{chatInstance(){return this.instance},messageInfo(){return{...this.message,params:{...this.message.params,title:this.$Bitrix.Loc.getMessage("AI_COPILOT_CHAT_WELCOME_MESSAGE_SITE_WITH_AI_TITLE"),subtitle:"",content:""}}}},methods:{renderContent(){var t,e;const s=(t=(e=this.messageInfo.params)==null?void 0:e.buttons)!=null?t:[];const a=s.length>0;const i=a?this.$Bitrix.Loc.getMessage("AI_COPILOT_CHAT_WELCOME_MESSAGE_SITE_WITH_AI_2",{"#LINK#":`<a href="#" class="${this.disableAllActions?"disabled":""}" ref="createSiteLink">`,"#/LINK#":"</a>"}):"";const o=p.Tag.render(G||(G=x`
				<div ref="root">
					<p>${0}</p>
					<p>${0}</p>
					<a href="#" ref="infoLink">${0}</a>
				</div>
			`),this.$Bitrix.Loc.getMessage("AI_COPILOT_CHAT_WELCOME_MESSAGE_SITE_WITH_AI_1"),i,this.$Bitrix.Loc.getMessage("AI_COPILOT_CHAT_WELCOME_LINK_SITE_WITH_AI"));p.bind(o.infoLink,"click",(()=>{const t=p.Reflection.getClass("top.BX.Helper");if(t){t.show("redirect=detail&code=24409174")}}));if(a){p.bind(o.createSiteLink,"click",(()=>{var t,e,s,a,i;if(!((t=this.messageInfo.params)!=null&&t.buttons)||this.messageInfo.params.buttons.length===0){return}this.chatInstance.addUserMessage({type:"ButtonClicked",content:(e=this.messageInfo.params)==null?void 0:(s=e.buttons[0])==null?void 0:s.text,params:{messageId:this.messageInfo.id,buttonId:(a=this.messageInfo.params)==null?void 0:(i=a.buttons[0])==null?void 0:i.id}})}))}this.$refs.content.innerHTML="";p.Dom.append(o.root,this.$refs.content)}},watch:{disableAllActions(){this.renderContent()}},mounted(){this.renderContent()},template:`\n\t\t<CopilotChatMessageWelcome\n\t\t\t:avatar="avatar"\n\t\t\t:message="messageInfo"\n\t\t>\n\t\t\t<template #content>\n\t\t\t\t<div ref="content"></div>\n\t\t\t</template>\n\t\t</CopilotChatMessageWelcome>\n\t`};const q={components:{CopilotChatMessageWelcome:j},props:{message:{type:Object,required:false},avatar:{type:String,required:false}},computed:{messageInfo(){return this.message}},template:`\n\t\t<CopilotChatMessageWelcome\n\t\t\t:avatar="avatar"\n\t\t\t:message="messageInfo"\n\t\t/>\n\t`};const V=Object.freeze({USER:"user",COPILOT:"copilot",ERROR:"error",USER_WITH_HIGHLIGHT_TEXT:"userWithHighlightText"});const U={components:{CopilotChatMessage:O,CopilotChatWelcomeMessage:H,CopilotChatMessageDefault:$,CopilotChatMessageWelcome:j,CopilotChatMessageSiteWithAi:k,CopilotChatMessageWelcomeFlows:q,CopilotChatMessagesDateGroup:A,CopilotChatMessagesAuthorGroup:F},emits:["clickMessageButton","retry","remove"],props:{messages:{type:Array,required:false,default:()=>[]},copilotAvatar:String,userAvatar:String,copilotMessageTitle:{type:String,required:false,default:""},userMessageMenuItems:{type:Array,required:false,default:()=>[]},copilotMessageMenuItems:{type:Array,required:false,default:()=>[]},welcomeMessageHtmlElement:HTMLElement},inject:["observer"],directives:{CopilotChatNewMessageVisibilityObserver:D},computed:{messagesList(){return this.messages},messagesGroupedByDayAndAuthor(){const t=this.groupMessagesByDay(this.messagesList);const e={};Object.entries(t).forEach((([t,{messages:s,isNewMessagesStartHere:a}])=>{e[t]=this.groupMessagesByAuthor(s,a)}));return e},sortedByDateMessagesGroups(){return Object.keys(this.messagesGroupedByDayAndAuthor).sort()}},methods:{groupMessagesByDay(t){let e=false;return t.reduce(((t,s)=>{const a=new Date(s.dateCreate);const i=this.formatISODate(a);if(t[i]===undefined){t[i]={messages:[],isNewMessagesStartHere:false}}if(s.viewed===false&&e===false){t[i].isNewMessagesStartHere=true;e=true}t[i].messages.push(s);return t}),{})},groupMessagesByAuthor(t,e){let s=-Infinity;let a=false;return t.reduce(((t,i)=>{if(i.viewed===false&&a===false&&e===true){t.push([i.authorId,[],true]);a=true}else if(i.authorId!==s){t.push([i.authorId,[]]);s=i.authorId}t.at(-1)[1].push(i);return t}),[])},getMessageMenuItems(t){if(t.authorId===null||t.authorId===undefined){return[]}return y(t.authorId)?this.copilotMessageMenuItems:this.userMessageMenuItems},formatISODate(t){const e=t.getFullYear();const s=(t.getMonth()+1).toString().padStart(2,"0");const a=t.getDate().toString().padStart(2,"0");return`${e}-${s}-${a}`},getMessageColor(t){if(t.status===at.ERROR){return V.ERROR}if(t.type===R.SYSTEM){return V.ERROR}if(t.type===R.BUTTON_CLICK_MESSAGE){return V.USER_WITH_HIGHLIGHT_TEXT}if(y(t.authorId)){return V.COPILOT}return V.USER},getMessageComponent(t){switch(t.type){case R.DEFAULT:return $;case R.SYSTEM:return $;case R.WELCOME_FLOWS:return q;case R.WELCOME_SITE_WITH_AI:return k;default:return $}},getMessageTitle(t){return this.isMessageFromCopilot(t)?this.copilotMessageTitle:""},getMessageAvatarByAuthorId(t){return this.isMessageFromCopilot(t)?this.copilotAvatar:this.userAvatar},getAuthorMessagesGroupAvatar(t,e){const s=e.at(-1);const a=s.type!=="Default"&&s.type!=="ButtonClicked"&&s.type!=="System";if(t===null||t===undefined||a){return null}return this.getMessageAvatarByAuthorId(t)},isMessageFromCopilot(t){return t<1},isMessageHaveButtons(t){var e,s;return(t==null?void 0:(e=t.params)==null?void 0:(s=e.buttons)==null?void 0:s.length)>0},handleMessageButtonClick(t,e){this.$emit("clickMessageButton",{messageId:t,buttonId:e})},isLastMessage(t){return t.id===this.messages.at(-1).id},handleMessageRetry(t){this.$emit("retry",t)},handleMessageRemove(t){this.$emit("remove",t)}},mounted(){p.Dom.append(this.welcomeMessageHtmlElement,this.$refs.welcomeMessage)},template:`\n\t\t<div class="ai__copilot-chat-messages-wrapper">\n\t\t\t<CopilotChatMessagesDateGroup\n\t\t\tv-for="(date, dateGroupIndex) of sortedByDateMessagesGroups"\n\t\t\t:date="date"\n\t\t\t>\n\t\t\t\t<CopilotChatMessagesAuthorGroup\n\t\t\t\t\tv-for="([authorId, messagesFromCurrentAuthor, showNewMessagesLabel], authorGroupIndex) in messagesGroupedByDayAndAuthor[date]"\n\t\t\t\t\t:avatar="getAuthorMessagesGroupAvatar(authorId, messagesFromCurrentAuthor)"\n\t\t\t\t\t:show-new-messages-label="showNewMessagesLabel"\n\t\t\t\t>\n\t\t\t\t\t<ul class="ai__copilot-chat-messages">\n\t\t\t\t\t\t<li\n\t\t\t\t\t\t\tv-for="(message, index) of messagesFromCurrentAuthor"\n\t\t\t\t\t\t\t:key="message.id"\n\t\t\t\t\t\t\tclass="ai__copilot-chat-messages_message-wrapper"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<component :is="getMessageComponent(message)" \n\t\t\t\t\t\t\t\t\tv-copilot-chat-new-message-visibility-observer="message.viewed"\n\t\t\t\t\t\t\t\t\t@buttonClick="handleMessageButtonClick(message.id, $event)"\n\t\t\t\t\t\t\t\t\t@retry="handleMessageRetry" \n\t\t\t\t\t\t\t\t\t@remove="handleMessageRemove"\n\t\t\t\t\t\t\t\t\t:message="message"\n\t\t\t\t\t\t\t\t\t:title="getMessageTitle(message.authorId)"\n\t\t\t\t\t\t\t\t\t:color="getMessageColor(message)"\n\t\t\t\t\t\t\t\t\t:avatar="getMessageAvatarByAuthorId(message.authorId)"\n\t\t\t\t\t\t\t\t\t:useAvatarTail="index === messagesFromCurrentAuthor.length - 1 && isMessageHaveButtons(message) === false"\n\t\t\t\t\t\t\t\t\t:disable-all-actions="isLastMessage(message) === false"\n\t\t\t\t\t\t\t\t\t:menu-items="getMessageMenuItems(message)"\n\t\t\t\t\t\t\t></component>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t</ul>\n\t\t\t\t</CopilotChatMessagesAuthorGroup>\n\t\t\t</CopilotChatMessagesDateGroup>\n\t\t</div>\n\t`};const K={props:{text:{type:String,required:false,default:p.Loc.getMessage("AI_COPILOT_CHAT_MESSAGES_HISTORY_LOADER_TEXT")}},beforeMount(){const t=getComputedStyle(document.body).getPropertyValue("--ui-color-base-02");this.loader=new h.Loader({color:t,size:60})},mounted(){this.loader.show(this.$refs.loaderContainer)},unmounted(){this.loader.hide();this.loader=null},template:`\n\t\t<div class="ai__copilot-chat-history-loader">\n\t\t\t<div ref="loaderContainer" class="ai__copilot-chat-history-loader_animation-container"></div>\n\t\t\t<div class="ai__copilot-chat_history-loader_text">\n\t\t\t\t{{ text }}\n\t\t\t</div>\n\t\t</div>\n\t`};let X=t=>t,Y;const z={name:"CopilotWarningMessage",methods:{showArticle(){const t=p.Reflection.getClass("top.BX.Helper");const e="20412666";t==null?void 0:t.show(`redirect=detail&code=${e}`)}},mounted(){const t=p.Tag.render(Y||(Y=X`<span>${0}</span>`),this.$Bitrix.Loc.getMessage("AI_COPILOT_CHAT_ANSWER_WARNING",{"#LINK_START#":'<a ref="link" href="#">',"#LINK_END#":"</a>"}));p.Event.bind(t.link,"click",this.showArticle);p.Dom.append(t.root,this.$refs.container)},template:`\n\t\t<div\n\t\t\tref="container"\n\t\t\tclass="ai__copilot-chat-warning-message"\n\t\t></div>\n\t`};const J={name:"LoadingBar",data(){return{}},template:`\n\t\t<div class="ai__copilot-chat-loading-bar"></div>\n\t`};const Q={events:["retryButtonClick"],methods:{loc(t){return this.$Bitrix.Loc.getMessage(t)},handleClickOnRetryButton(t){const e=t.target;e.blur();this.$emit("retryButtonClick")}},template:`\n\t\t<div class="ai__copilot-chat-load-history-error">\n\t\t\t<div class="ai__copilot-chat-load-history-error_icon-wrapper">\n\t\t\t\t<div class="ai__copilot-chat-load-history-error_icon"></div>\n\t\t\t</div>\n\t\t\t<div class="ai__copilot-chat-load-history-error_title">\n\t\t\t\t{{ loc('AI_COPILOT_CHAT_LOAD_HISTORY_ERROR_TITLE') }}\n\t\t\t</div>\n\t\t\t<div class="ai__copilot-chat-load-history-error_text">\n\t\t\t\t{{ loc('AI_COPILOT_CHAT_LOAD_HISTORY_ERROR_TEXT') }}\n\t\t\t</div>\n\t\t\t<button\n\t\t\t\tclass="ai__copilot-chat-load-history-error_button"\n\t\t\t\t@click="handleClickOnRetryButton"\n\t\t\t>\n\t\t\t\t{{ loc('AI_COPILOT_CHAT_LOAD_HISTORY_ERROR_RETRY') }}\n\t\t\t</button>\n\t\t</div>\n\t`};const Z={name:"CopilotChat",components:{CopilotChatHeader:E,CopilotChatMessages:U,CopilotChatInput:P,CopilotChatHistoryLoader:K,CopilotChatStatus:m,CopilotChatWarningMessage:z,CopilotChatLoadingBar:J,CopilotChatLoadHistoryError:Q},props:{header:Object,welcomeMessageHtml:HTMLElement,botOptions:Object,scrollToTheEndAfterFirstShow:Object,slots:Object,isShowWarningMessage:{type:Object,required:false,default:()=>({value:false})},messages:Array,copilotChatInstance:Object,useInput:{type:Boolean,required:false,default:true},disableInput:Object,showLoader:Object,isOldMessagesLoading:Object,showCopilotWritingStatus:Object,status:Object,useStatus:Object,copilotMessageMenuItems:{type:Array,required:false,default:()=>[]},userAvatar:{type:Object,required:false},userMessageMenuItems:{type:Array,required:false,default:()=>[]},inputPlaceholder:{type:String,required:false,default:""},loaderText:{type:String,required:false},isShowLoadHistoryError:{type:Object}},data(){return{isCopilotWriting:false,scrollPosition:0,scrollHeight:0}},provide(){return{instance:this.copilotChatInstance,observer:this.observer}},computed:{userPhoto(){var t;return((t=this.userAvatar)==null?void 0:t.value)||"/bitrix/js/ui/icons/b24/images/ui-user.svg?v2"},isInputDisabled(){return this.disableInput.value===true},isLoaderShown(){return this.showLoader.value===true},isLoadingOldMessages(){var t;return((t=this.isOldMessagesLoading)==null?void 0:t.value)===true},isWarningMessageShown(){var t;return((t=this.isShowWarningMessage)==null?void 0:t.value)===true},instance(){return this.copilotChatInstance},Slot(){return{...this.slots}},headerProps(){var t,e,s,a,i;return{title:(t=this.header)==null?void 0:t.title,subtitle:(e=this.header)==null?void 0:e.subtitle,avatar:(s=this.header)==null?void 0:s.avatar,useCloseIcon:(a=this.header)==null?void 0:a.useCloseIcon,menu:(i=this.header)==null?void 0:i.menu}},botData(){var t,e;return{messageTitle:this.botOptions.messageTitle,avatar:this.botOptions.avatar,messageMenuItems:(t=(e=this.botOptions)==null?void 0:e.messageMenuItems)!=null?t:[]}},messagesList(){return this.messages},haveNewMessages(){return this.messagesList.some((t=>t.viewed===false))},copilotChatStatus(){return this.status.value},isChatStatusUsed(){return this.useStatus.value},isScrollToTheEndAfterMounted(){return this.scrollToTheEndAfterFirstShow.value}},methods:{hideChat(){this.copilotChatInstance.hide()},async handleSubmitMessage(t){const e={content:t};this.instance.addUserMessage(e)},scrollMessagesListAfterOpen(){if(this.haveNewMessages){const t=this.$refs.main.querySelector(`.${T}`);t==null?void 0:t.scrollIntoView()}else{this.scrollMessagesListToTheEnd()}},scrollMessagesListToTheEnd(t=false){this.$refs.main.scrollTo({left:0,top:9999,behavior:t?"smooth":"auto"})},handleClickOnMessageButton(t){this.instance.emitClickOnMessageButton({messageId:t.messageId,buttonId:t.buttonId})},handleAddNewUserMessage(){requestAnimationFrame((()=>{this.scrollMessagesListToTheEnd(true)}))},restoreScrollPosition(){this.scrollPosition=this.$refs.main.scrollTop;this.scrollHeight=this.$refs.main.scrollHeight;requestAnimationFrame((()=>{this.$refs.main.scrollTop=this.$refs.main.scrollHeight-this.scrollHeight+this.scrollPosition}))},handleRetryMessage(t){this.instance.emit(st.RETRY_SEND_MESSAGE,{messageId:t})},handleRemoveMessage(t){this.instance.emit(st.REMOVE_MESSAGE,{messageId:t})},handleRetryLoadHistoryButtonClick(){this.instance.emitRetryLoadHistory()}},beforeCreate(){this.observer=new I;this.observer.subscribe(g.VIEW_NEW_MESSAGE,(t=>{this.instance.setNewMessageIsViewed(t.getData().id)}))},mounted(){this.observer.setRoot(this.$refs.main);this.observer.init();this.instance.subscribe(st.ADD_USER_MESSAGE,this.handleAddNewUserMessage);requestAnimationFrame((()=>{if(this.isScrollToTheEndAfterMounted){this.scrollMessagesListAfterOpen()}}));p.bind(this.$refs.main,"scroll",(t=>{const e=t.target;if(e.scrollTop/e.scrollHeight<.05){this.instance.emit(st.MESSAGES_SCROLL_TOP)}}))},beforeUnmount(){this.instance.unsubscribe(st.ADD_USER_MESSAGE,this.handleAddNewUserMessage)},watch:{isLoaderShown(t,e){if(t===false&&e===true){requestAnimationFrame((()=>{this.scrollMessagesListToTheEnd()}))}},"messagesList.length":function(t,e){if(t-e===1){requestAnimationFrame((()=>{this.scrollMessagesListToTheEnd(true)}))}if(e>1&&t>1){this.restoreScrollPosition()}requestAnimationFrame((()=>{if(e===0&&t>1&&this.isScrollToTheEndAfterMounted){this.scrollMessagesListToTheEnd()}}))}},template:`\n\t\t<div class="ai__copilot-chat">\n\t\t\t<header class="ai__copilot-chat_header">\n\t\t\t\t<CopilotChatHeader\n\t\t\t\t\t:title="headerProps.title"\n\t\t\t\t\t:subtitle="headerProps.subtitle"\n\t\t\t\t\t:avatar="headerProps.avatar"\n\t\t\t\t\t:use-close-icon="headerProps.useCloseIcon"\n\t\t\t\t\t:menu="headerProps.menu"\n\t\t\t\t\t@clickOnCloseIcon="hideChat"\n\t\t\t\t/>\n\t\t\t\t<div class="ai__copilot-chat_loading-bar" v-if="isLoadingOldMessages">\n\t\t\t\t\t<CopilotChatLoadingBar />\n\t\t\t\t</div>\n\t\t\t</header>\n\t\t\t<main ref="main" class="ai__copilot-chat_main">\n\t\t\t\t<TransitionGroup name="main">\n\t\t\t\t<div\n\t\t\t\t\tv-if="isLoaderShown"\n\t\t\t\t\tclass="ai__copilot-chat_main-loader-container"\n\t\t\t\t>\n\t\t\t\t\t<slot name="loader">\n\t\t\t\t\t\t<CopilotChatHistoryLoader :text="loaderText" />\n\t\t\t\t\t</slot>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tv-else-if="isShowLoadHistoryError.value"\n\t\t\t\t\tclass="ai__copilot-chat_load-history-error"\n\t\t\t\t>\n\t\t\t\t\t<slot name="loaderError">\n\t\t\t\t\t\t<CopilotChatLoadHistoryError @retryButtonClick="handleRetryLoadHistoryButtonClick" />\n\t\t\t\t\t</slot>\n\t\t\t\t</div>\n\t\t\t\t\t<CopilotChatMessages\n\t\t\t\t\t\tv-else\n\t\t\t\t\t\t@clickMessageButton="handleClickOnMessageButton"\n\t\t\t\t\t\t@retry="handleRetryMessage"\n\t\t\t\t\t\t@remove="handleRemoveMessage"\n\t\t\t\t\t\t:user-avatar="userPhoto"\n\t\t\t\t\t\t:copilot-avatar="botData.avatar"\n\t\t\t\t\t\t:messages="messagesList"\n\t\t\t\t\t\t:welcome-message-html-element="welcomeMessageHtml"\n\t\t\t\t\t\t:copilot-message-title="botData.messageTitle"\n\t\t\t\t\t\t:copilot-message-menu-items="botData.messageMenuItems"\n\t\t\t\t\t\t:user-message-menu-items="userMessageMenuItems"\n\t\t\t\t\t></CopilotChatMessages>\n\t\t\t\t</TransitionGroup>\n\t\t\t\t<CopilotChatStatus\n\t\t\t\t\tv-if="isLoaderShown === false && isChatStatusUsed"\n\t\t\t\t\t:status="copilotChatStatus"\n\t\t\t\t/>\n\t\t\t\t<div id="anchor"></div>\n\t\t\t</main>\n\t\t\t<footer class="ai__copilot-chat_footer">\n\t\t\t\t<CopilotChatInput\n\t\t\t\t\tv-if="useInput"\n\t\t\t\t\t:disabled="isInputDisabled"\n\t\t\t\t\t:placeholder="inputPlaceholder"\n\t\t\t\t\t@submit="handleSubmitMessage"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tv-if="isWarningMessageShown"\n\t\t\t\t\tclass="ai__copilot-chat_warning-message"\n\t\t\t\t>\n\t\t\t\t\t<CopilotChatWarningMessage />\n\t\t\t\t</div>\n\t\t\t</footer>\n\t\t</div>\n\t`};let tt=t=>t,et;const st=Object.freeze({ADD_USER_MESSAGE:"addUserMessage",ADD_BOT_MESSAGE:"addBotMessage",ADD_OLD_MESSAGES:"addBotMessage",ADD_NEW_MESSAGES:"addMessages",CLICK_ON_MESSAGE_BUTTON:"clickOnMessageButton",VIEW_NEW_MESSAGE:"viewMessage",SHOW_LOADER:"showLoader",HIDE_LOADER:"hideLoader",SHOW_COPILOT_WRITING_LOADER:"showCopilotWritingLoader",HIDE_COPILOT_WRITING_LOADER:"hideCopilotWritingLoader",DISABLE_INPUT_FIELD:"disableInputField",ENABLE_INPUT_FIELD:"enableInputField",SET_MESSAGE_STATUS:"setMessageStatus",SHOW_ERROR_SCREEN:"showErrorScreen",HIDE_ERROR_SCREEN:"hideErrorScreen",MESSAGES_SCROLL_TOP:"messagesListScrollTop",RETRY_SEND_MESSAGE:"retrySendMessage",REMOVE_MESSAGE:"removeMessage",RETRY_LOAD_HISTORY:"retryLoadHistory"});const at={DEPART:"depart",SENT:"sent",DELIVERED:"delivered",ERROR:"error"};var it=babelHelpers.classPrivateFieldLooseKey("copilotChatOptions");var ot=babelHelpers.classPrivateFieldLooseKey("popupOptions");var nt=babelHelpers.classPrivateFieldLooseKey("popup");var rt=babelHelpers.classPrivateFieldLooseKey("app");var lt=babelHelpers.classPrivateFieldLooseKey("messages");var ct=babelHelpers.classPrivateFieldLooseKey("isShowLoader");var ut=babelHelpers.classPrivateFieldLooseKey("isOldMessagesLoading");var dt=babelHelpers.classPrivateFieldLooseKey("isInputDisabled");var ht=babelHelpers.classPrivateFieldLooseKey("chatStatus");var pt=babelHelpers.classPrivateFieldLooseKey("useChatStatus");var vt=babelHelpers.classPrivateFieldLooseKey("copilotMessageMenuItems");var mt=babelHelpers.classPrivateFieldLooseKey("userMessageMenuItems");var gt=babelHelpers.classPrivateFieldLooseKey("scrollToTheEndAfterFirstShow");var bt=babelHelpers.classPrivateFieldLooseKey("showCopilotWarningMessage");var _t=babelHelpers.classPrivateFieldLooseKey("copilotChatBotOptions");var ft=babelHelpers.classPrivateFieldLooseKey("userAvatar");var Mt=babelHelpers.classPrivateFieldLooseKey("inputPlaceholder");var It=babelHelpers.classPrivateFieldLooseKey("loaderText");var Ct=babelHelpers.classPrivateFieldLooseKey("isShowLoadHistoryError");var Lt=babelHelpers.classPrivateFieldLooseKey("findMessageButton");var St=babelHelpers.classPrivateFieldLooseKey("setMessageStatus");var Et=babelHelpers.classPrivateFieldLooseKey("addNewMessage");var Bt=babelHelpers.classPrivateFieldLooseKey("initPopup");var Pt=babelHelpers.classPrivateFieldLooseKey("renderPopupContent");class yt extends a.EventEmitter{constructor(t={}){var e,s,a;super(t);Object.defineProperty(this,Pt,{value:wt});Object.defineProperty(this,Bt,{value:Tt});Object.defineProperty(this,Et,{value:At});Object.defineProperty(this,St,{value:Ht});Object.defineProperty(this,Lt,{value:Ot});Object.defineProperty(this,it,{writable:true,value:void 0});Object.defineProperty(this,ot,{writable:true,value:void 0});Object.defineProperty(this,nt,{writable:true,value:void 0});Object.defineProperty(this,rt,{writable:true,value:void 0});Object.defineProperty(this,lt,{writable:true,value:void 0});Object.defineProperty(this,ct,{writable:true,value:void 0});Object.defineProperty(this,ut,{writable:true,value:void 0});Object.defineProperty(this,dt,{writable:true,value:void 0});Object.defineProperty(this,ht,{writable:true,value:void 0});Object.defineProperty(this,pt,{writable:true,value:void 0});Object.defineProperty(this,vt,{writable:true,value:void 0});Object.defineProperty(this,mt,{writable:true,value:void 0});Object.defineProperty(this,gt,{writable:true,value:void 0});Object.defineProperty(this,bt,{writable:true,value:void 0});Object.defineProperty(this,_t,{writable:true,value:void 0});Object.defineProperty(this,ft,{writable:true,value:void 0});Object.defineProperty(this,Mt,{writable:true,value:void 0});Object.defineProperty(this,It,{writable:true,value:void 0});Object.defineProperty(this,Ct,{writable:true,value:void 0});this.setEventNamespace("AI.CopilotChat");babelHelpers.classPrivateFieldLooseBase(this,it)[it]=t||{};babelHelpers.classPrivateFieldLooseBase(this,_t)[_t]=i.ref((e=t==null?void 0:t.botOptions)!=null?e:{});babelHelpers.classPrivateFieldLooseBase(this,ot)[ot]=(t==null?void 0:t.popupOptions)||{};babelHelpers.classPrivateFieldLooseBase(this,lt)[lt]=i.ref([]);babelHelpers.classPrivateFieldLooseBase(this,vt)[vt]=i.ref(p.Type.isArray(t.botOptions.messageMenuItems)?t.botOptions.messageMenuItems:[]);babelHelpers.classPrivateFieldLooseBase(this,mt)[mt]=i.ref(p.Type.isArray(t.userMessageMenuItems)?t.userMessageMenuItems:[]);babelHelpers.classPrivateFieldLooseBase(this,ct)[ct]=i.ref(false);babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]=i.ref(false);babelHelpers.classPrivateFieldLooseBase(this,ht)[ht]=i.ref(v.NONE);babelHelpers.classPrivateFieldLooseBase(this,pt)[pt]=i.ref(p.Type.isBoolean(t.useChatStatus)?t.useChatStatus:true);babelHelpers.classPrivateFieldLooseBase(this,gt)[gt]=i.ref(p.Type.isBoolean(t.scrollToTheEndAfterFirstShow)?t.scrollToTheEndAfterFirstShow:true);babelHelpers.classPrivateFieldLooseBase(this,ut)[ut]=i.ref(false);babelHelpers.classPrivateFieldLooseBase(this,bt)[bt]=i.ref(t.showCopilotWarningMessage===true);babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct]=i.ref(false);babelHelpers.classPrivateFieldLooseBase(this,ft)[ft]=i.ref((s=t.userAvatar)!=null?s:"");babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt]=(a=t.inputPlaceholder)!=null?a:p.Loc.getMessage("AI_COPILOT_CHAT_INPUT_PLACEHOLDER");babelHelpers.classPrivateFieldLooseBase(this,It)[It]=t.loaderText}static getDefaultMinWidth(){return 375}static getDefaultHeight(){return 669}startLoadingOldMessages(){babelHelpers.classPrivateFieldLooseBase(this,ut)[ut].value=true}finishLoadingOldMessages(){babelHelpers.classPrivateFieldLooseBase(this,ut)[ut].value=false}isOldMessagesLoading(){return babelHelpers.classPrivateFieldLooseBase(this,ut)[ut].value}isMessageInList(t){return babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].value.findLast((e=>e.id===t))}getFirstMessageId(){var t;return(t=babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].value[0])==null?void 0:t.id}getMessageById(t){return babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].value.find((e=>e.id===t))}removeMessage(t){const e=babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].value.findIndex((e=>e.id===t));babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].value.splice(e,1)}unshiftMessages(t){const e=t.map((t=>({...t,status:at.DELIVERED})));babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].value.unshift(...e)}addUserMessage(t,e=true){const s={type:"Default",...t,authorId:1,status:at.DEPART};babelHelpers.classPrivateFieldLooseBase(this,Et)[Et](s,e)}addBotMessage(t,e=true){const s={type:"Default",...t,authorId:0,status:null};babelHelpers.classPrivateFieldLooseBase(this,Et)[Et](s,e)}addSystemMessage(t,e=true){const s={...t,authorId:null,status:null};babelHelpers.classPrivateFieldLooseBase(this,Et)[Et](s,e)}enableInput(){babelHelpers.classPrivateFieldLooseBase(this,dt)[dt].value=false;this.emit(st.ENABLE_INPUT_FIELD)}disableInput(){babelHelpers.classPrivateFieldLooseBase(this,dt)[dt].value=true;this.emit(st.DISABLE_INPUT_FIELD)}showLoader(){babelHelpers.classPrivateFieldLooseBase(this,ct)[ct].value=true;this.emit(st.SHOW_LOADER)}hideLoader(){babelHelpers.classPrivateFieldLooseBase(this,ct)[ct].value=false;this.emit(st.HIDE_LOADER)}setMessageStatusDepart(t){babelHelpers.classPrivateFieldLooseBase(this,St)[St](t,at.DEPART)}setMessageStatusDelivered(t){babelHelpers.classPrivateFieldLooseBase(this,St)[St](t,at.DELIVERED)}setMessageStatusSent(t){babelHelpers.classPrivateFieldLooseBase(this,St)[St](t,at.SENT)}setMessageStatusError(t){babelHelpers.classPrivateFieldLooseBase(this,St)[St](t,at.ERROR)}setCopilotWritingStatus(t){if(t===true){babelHelpers.classPrivateFieldLooseBase(this,ht)[ht].value=v.COPILOT_WRITING}else{babelHelpers.classPrivateFieldLooseBase(this,ht)[ht].value=v.NONE}}setNewMessageIsViewed(t){this.emit(st.VIEW_NEW_MESSAGE,new a.BaseEvent({data:{id:t}}))}setMessageId(t,e){const s=babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].value.find((e=>e.id===t));if(!s){return}s.id=e}setMessageDate(t,e){const s=babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].value.find((e=>e.id===t));if(!s){return}s.dateCreate=e}emitClickOnMessageButton(t){const{buttonId:e,messageId:s}=t;const a=babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt](s,e);a.isSelected=true;this.emit(st.CLICK_ON_MESSAGE_BUTTON,{messageId:s,button:{...a}})}emitRetryLoadHistory(){this.emit(st.RETRY_LOAD_HISTORY)}show(){if(!babelHelpers.classPrivateFieldLooseBase(this,nt)[nt]){babelHelpers.classPrivateFieldLooseBase(this,Bt)[Bt]()}babelHelpers.classPrivateFieldLooseBase(this,nt)[nt].show()}hide(){var t;(t=babelHelpers.classPrivateFieldLooseBase(this,nt)[nt])==null?void 0:t.close()}isShown(){var t;return Boolean((t=babelHelpers.classPrivateFieldLooseBase(this,nt)[nt])==null?void 0:t.isShown())}adjustPosition(){var t;(t=babelHelpers.classPrivateFieldLooseBase(this,nt)[nt])==null?void 0:t.adjustPosition({forceBindPosition:true})}setUserAvatar(t){babelHelpers.classPrivateFieldLooseBase(this,ft)[ft].value=t}showLoadHistoryError(){babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct].value=true}hideLoadHistoryError(){babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct].value=false}}function Ot(t,e){var s,a;const i=babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].value.find((e=>e.id===t));if(p.Type.isArray((s=i.params)==null?void 0:s.buttons)===false){return null}return(a=i.params.buttons.find((t=>t.id===e)))!=null?a:null}function Ht(t,e){const s=babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].value.find((e=>e.id===t));if(!s){return}s.status=e;this.emit(st.SET_MESSAGE_STATUS,{messageId:t,status:e})}function At(t,e=true){var s;const a=Math.round(-Math.random()*1e3);const i=this.isShown();const o={id:a,dateCreate:(new Date).toISOString(),status:at.DEPART,authorId:0,...t,viewed:(s=t==null?void 0:t.viewed)!=null?s:i};babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].value.push(o);if(e===false){return}if(o.authorId===0){this.emit(st.ADD_BOT_MESSAGE,{message:o})}else{this.emit(st.ADD_USER_MESSAGE,{message:o})}}function Tt(){var t,e,s,a,i,o,n;const r=this.adjustPosition.bind(this);p.bind(window,"resize",r);babelHelpers.classPrivateFieldLooseBase(this,nt)[nt]=new l.Popup({...babelHelpers.classPrivateFieldLooseBase(this,ot)[ot],content:babelHelpers.classPrivateFieldLooseBase(this,Pt)[Pt](),minWidth:(t=(e=babelHelpers.classPrivateFieldLooseBase(this,ot)[ot])==null?void 0:e.minWidth)!=null?t:yt.getDefaultMinWidth(),height:(s=(a=babelHelpers.classPrivateFieldLooseBase(this,ot)[ot])==null?void 0:a.height)!=null?s:yt.getDefaultHeight(),contentNoPaddings:true,padding:0,borderRadius:"16px",className:`ai__copilot-chat-popup ${(i=babelHelpers.classPrivateFieldLooseBase(this,ot)[ot].className)!=null?i:""}`,cacheable:(o=(n=babelHelpers.classPrivateFieldLooseBase(this,ot)[ot])==null?void 0:n.cacheable)!=null?o:false,events:{onPopupAfterClose:()=>{var t,e;babelHelpers.classPrivateFieldLooseBase(this,nt)[nt]=null;babelHelpers.classPrivateFieldLooseBase(this,rt)[rt].unmount();if(p.Type.isFunction((t=babelHelpers.classPrivateFieldLooseBase(this,ot)[ot])==null?void 0:(e=t.events)==null?void 0:e.onPopupAfterClose)){var s,a;(s=babelHelpers.classPrivateFieldLooseBase(this,ot)[ot])==null?void 0:(a=s.events)==null?void 0:a.onPopupAfterClose()}p.unbind(window,"resize",r)},...babelHelpers.classPrivateFieldLooseBase(this,ot)[ot].events}});return babelHelpers.classPrivateFieldLooseBase(this,nt)[nt]}function wt(){var t,e,s,a,o;const n=p.Tag.render(et||(et=tt`<div class="ai__copilot-chat-popup-content"></div>`));babelHelpers.classPrivateFieldLooseBase(this,rt)[rt]=i.BitrixVue.createApp({name:"CopilotChatPopup",components:{CopilotChat:Z,...(t=babelHelpers.classPrivateFieldLooseBase(this,it)[it])==null?void 0:t.vueComponents},template:`\n\t\t\t\t<CopilotChat>\n\t\t\t\t\t<template v-slot:loader>\n\t\t\t\t\t\t${(e=(s=babelHelpers.classPrivateFieldLooseBase(this,it)[it].slots)==null?void 0:s.LOADER)!=null?e:""}\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-slot:loaderError>\n\t\t\t\t\t\t${(a=(o=babelHelpers.classPrivateFieldLooseBase(this,it)[it].slots)==null?void 0:o.LOADER_ERROR)!=null?a:""}\n\t\t\t\t\t</template>\n\t\t\t\t</CopilotChat>\n\t\t\t`},{...babelHelpers.classPrivateFieldLooseBase(this,it)[it],messages:babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].value,copilotChatInstance:this,showLoader:babelHelpers.classPrivateFieldLooseBase(this,ct)[ct],disableInput:babelHelpers.classPrivateFieldLooseBase(this,dt)[dt],status:babelHelpers.classPrivateFieldLooseBase(this,ht)[ht],useStatus:babelHelpers.classPrivateFieldLooseBase(this,pt)[pt],scrollToTheEndAfterFirstShow:babelHelpers.classPrivateFieldLooseBase(this,gt)[gt],copilotMessageMenuItems:babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].value,userMessageMenuItems:babelHelpers.classPrivateFieldLooseBase(this,mt)[mt].value,isShowWarningMessage:babelHelpers.classPrivateFieldLooseBase(this,bt)[bt],botOptions:babelHelpers.classPrivateFieldLooseBase(this,_t)[_t].value,userAvatar:babelHelpers.classPrivateFieldLooseBase(this,ft)[ft],inputPlaceholder:babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt],loaderText:babelHelpers.classPrivateFieldLooseBase(this,It)[It],isOldMessagesLoading:babelHelpers.classPrivateFieldLooseBase(this,ut)[ut],isShowLoadHistoryError:babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct]});babelHelpers.classPrivateFieldLooseBase(this,rt)[rt].mount(n);return n}t.CopilotChat=yt;t.CopilotChatEvents=st;t.CopilotChatMessageStatus=at;t.CopilotChatMessageType=R})(this.BX.AI.CopilotChat.UI=this.BX.AI.CopilotChat.UI||{},BX,BX.AI,BX.Event,BX.Vue3,BX,BX.Main,BX.UI.IconSet,BX.Main,BX.UI.IconSet,BX.UI.BBCode.Formatter,BX,BX,BX);
//# sourceMappingURL=copilot-chat.bundle.map.js