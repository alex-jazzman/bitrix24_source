BX.namespace("BX.Disk");BX.Disk.FolderListClass=function(){const FolderListClass=function(e){this.layout=e.layout||{};this.errors=e.errors||[];this.showSearchNotice=e.showSearchNotice;this.information=e.information||"";this.currentFolder=e.currentFolder||{};this.gridId=e.gridId;this.isTrashMode=e.isTrashMode;this.filterValueToSkipSearchUnderLinks=e.filterValueToSkipSearchUnderLinks||{};this.filterId=e.filterId;if(BX.Main.gridManager){this.commonGrid=new BX.Disk.Model.FolderList.CommonGrid({instance:BX.Main.gridManager.getById(this.gridId).instance})}else{this.commonGrid=new BX.Disk.Model.FolderList.CommonGrid({instance:BX.Main.tileGridManager.getById(this.gridId).instance})}this.filter=BX.Main.filterManager.getById(this.filterId);this.relativePath=e.relativePath;this.gridShowTreeButton=BX(e.gridShowTreeButton);this.rootObject=e.rootObject||{};this.storage=e.storage||{};this.storage.manage=this.storage.manage||{};this.enabledModZip=e.enabledModZip||false;this.enabledExternalLink=e.enabledExternalLink;this.enabledObjectLock=e.enabledObjectLock;this.getFilesCountAndSize=e.getFilesCountAndSize||{};this.cacheExternalLinks={};this.createBlankFileUrl=e.createBlankFileUrl;this.renameBlankFileUrl=e.renameBlankFileUrl;this.defaultService=e.defaultService;this.defaultServiceLabel=e.defaultServiceLabel;this.isUserCollaber=e.isUserCollaber;this.collaberTourOnAddButtonId=e.collaberTourOnAddButtonId;this.isCollaberTourOnAddButtonViewed=e.isCollaberTourOnAddButtonViewed;this.readonlyCollabFolderStateCookieName=e.readonlyCollabFolderStateCookieName;this.sortFields=e.sortFields;this.sort=e.sort;this.actionGroupButton=e.actionGroupButton||"move";this.isBitrix24=e.isBitrix24||false;this.destFormName=e.destFormName||"folder-list-destFormName";this.ajaxUrl="/bitrix/components/bitrix/disk.folder.list/ajax.php";this.baseGridPageUrl=document.location.toString();BX.Disk.Page.changeFolder({id:this.currentFolder.id,name:this.currentFolder.name});BX.Disk.Page.changeStorage(this.storage);this.setEvents();if(this.shouldUseHistory()){window.history.replaceState({disk:true,folder:{id:this.currentFolder.id}},null,this.baseGridPageUrl)}this.workWithLocationHash();this.processCommand();if(this.errors.length>0){this.showErrors()}if(this.information.length>0){this.showInformation()}if(!this.currentFolder.canAdd){this.setInactiveStateToCreateItemsButton()}if(this.needRunFilterUnderLinks()){this.rerunFilter()}};FolderListClass.prototype.rerunFilter=function(){const e=new BX.Promise;this.onFilterApply(this.filter.getParam("FILTER_ID"),{},this.filter,e);e.fulfill()};FolderListClass.prototype.showInformation=function(){BX.Disk.showModalWithStatusAction({status:"success",message:this.information})};FolderListClass.prototype.showErrors=function(){BX.Disk.showModalWithStatusAction({status:"error",errors:this.errors})};FolderListClass.prototype.onHashChange=function(){const e=document.location.hash.match(/hl-(\d+)/g);if(e){const t=(document.location.hash.match(/!([A-Za-z]+)/g)||[]).pop();for(const s in e){if(!e.hasOwnProperty(s)){continue}const i=e[s];const o=i.match(/hl-(\d+)/);if(o&&o[1]){if(this.commonGrid.getItemById(o[1])){this.commonGrid.scrollTo(o[1]);this.commonGrid.selectItemById(o[1]);this.runCommandOnObjectId(t,o[1])}else if(t&&window.BXIM&&BXIM.isOpenNotify()){document.location.reload();BXIM.closeMessenger()}}}if(window.BXIM&&BXIM.isOpenNotify()){BXIM.closeMessenger()}}};FolderListClass.prototype.processCommand=function(){if(BX.Disk.getUrlParameter("cmd")==="openSliderBp"&&this.storage.bpListLink){const e=new URL(window.location.href);const t=new URLSearchParams(e.search);t.delete("cmd");e.search=t.toString();window.history.replaceState(null,null,e.toString());this.openSlider(this.storage.bpListLink)}};FolderListClass.prototype.shouldUseHistory=function(){return top===window};FolderListClass.prototype.workWithLocationHash=function(){setTimeout(BX.delegate((function(){this.onHashChange()}),this),350)};FolderListClass.prototype.setEvents=function(){BX.bind(this.getFilesCountAndSize.button,"click",BX.proxy(this.onClickGetFilesCountAndSizeButtonButton,this));BX.bind(window,"hashchange",BX.proxy(this.onHashChange,this));BX.bindDelegate(this.commonGrid.getContainer(),"click",{className:"js-disk-grid-open-folder"},this.openGridFolder.bind(this));BX.bind(this.sort.layout.label,"click",this.showGridSortingMenu.bind(this));for(let e=0;e<this.layout.changeViewButtons.length;++e){BX.bind(BX(this.layout.changeViewButtons[e]),"click",this.changeView.bind(this))}BX.addCustomEvent("SidePanel.Slider:onMessage",this.onSliderMessage.bind(this));BX.addCustomEvent("Disk.OnlyOffice:onSaved",this.handleDocumentSaved.bind(this));BX.bind(window,"popstate",this.onPopState.bind(this));BX.addCustomEvent("onIframeElementLoadDataToView",BX.proxy(this.onIframeElementLoadDataToView,this));BX.addCustomEvent("onBeforeElementShow",BX.proxy(this.onBeforeElementShow,this));BX.addCustomEvent("onCreateExtendedFolder",BX.proxy(this.onCreateExtendedFolder,this));BX.addCustomEvent("Grid::beforeRequest",this.onBeforeGridRequest.bind(this));BX.addCustomEvent("BX.TileGrid.Grid:beforeReload",this.onBeforeGridRequest.bind(this));if(this.commonGrid.isGrid()){BX.addCustomEvent(this.commonGrid.getContainer(),"Grid::optionsChanged",this.onGridOptionsChanged.bind(this))}BX.addCustomEvent("Grid::updated",this.onGridUpdated.bind(this));BX.addCustomEvent("BX.Main.Filter:beforeApply",this.onBeforeFilterApply.bind(this));BX.addCustomEvent("BX.Main.Filter:apply",this.onFilterApply.bind(this));BX.addCustomEvent("onPopupFileUploadClose",this.onPopupFileUploadClose.bind(this));if(this.isTrashMode){BX.addCustomEvent("onStepperProgress",this.onStepperHasBeenFinished.bind(this));BX.addCustomEvent("onStepperHasBeenFinished",this.onStepperHasBeenFinished.bind(this))}BX.addCustomEvent("Disk.Page:onChangeFolder",this.onChangeFolder.bind(this));BX.addCustomEvent("Disk.TileItem.Item:onItemDblClick",this.onItemDblClick.bind(this));BX.addCustomEvent("Disk.TileItem.Item:onItemEnter",this.onItemDblClick.bind(this));BX.addCustomEvent("Disk.TileItem.Item:onTitleClick",this.handleTitleClickOnTileItem.bind(this));BX.addCustomEvent("Disk.Breadcrumbs:onClickBreadcrumb",this.handleClickOnBreadcrumb.bind(this));BX.addCustomEvent(this.commonGrid.instance,"TileGrid.Grid:onItemRemove",this.handleItemRemoveByTileGrid.bind(this));BX.addCustomEvent(this.commonGrid.instance,"TileGrid.Grid:onItemMove",this.onItemMove.bind(this));BX.addCustomEvent("Disk:onChangeDocumentService",this.onChangeDocumentService.bind(this))};FolderListClass.prototype.onBeforeFilterApply=function(e,t,s,i){if(e!==this.filterId){return}this.isFiltetedFolderList=true;i.then((()=>{if(s.getSearch().getSearchString()||s.getSearch().getSquares().length>0){this.blockSorting()}else{this.unblockSorting()}}))};FolderListClass.prototype.blockSorting=function(){if(this.commonGrid.isGrid()){this.commonGrid.instance.blockSorting()}this.sort.layout.label.style.pointerEvents="none"};FolderListClass.prototype.unblockSorting=function(){if(this.commonGrid.isGrid()){this.commonGrid.instance.unblockSorting()}this.sort.layout.label.style.pointerEvents=null};const _getSymlinksUnderObjectId=[];FolderListClass.prototype.getSymlinksUnderObjectId=function(e){const t=e.id;if(_getSymlinksUnderObjectId[t]!==undefined){const e=new BX.Promise;e.fulfill(_getSymlinksUnderObjectId[t]);return e}const s=new BX.Promise;BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","showSymlinks"),data:e,onsuccess(e){if(!e||!e.status||e.status!=="success"){return}_getSymlinksUnderObjectId[t]=e.items;s.fulfill(_getSymlinksUnderObjectId[t])}});return s};FolderListClass.prototype.needRunFilterUnderLinks=function(){if(!this.filter.getSearch().getSearchString()&&this.filter.getSearch().getSquares().length===0){return false}for(const e in this.filterValueToSkipSearchUnderLinks){if(!this.filterValueToSkipSearchUnderLinks.hasOwnProperty(e)){continue}const t=this.filterValueToSkipSearchUnderLinks[e];const s=this.filter.getFilterFieldsValues();if(s[e]==t){return false}}return true};FolderListClass.prototype.showPopupWindowInfo=function(e){this.popupWindowInfo=new BX.PopupWindow("disk-folder-list-popup-info",e,{className:"disk-folder-list-popup-info",autoHide:true,zIndex:200,closeByEsc:true,offsetTop:5,width:e.offsetWidth-20,content:`<span class="disk-folder-list-popup-info-content">${BX.message("DISK_FOLDER_LIST_SEARCH_INDEX_NOTICE_1")}</span>`});this.popupWindowInfo.show()};FolderListClass.prototype.onFilterApply=function(e,t,s,i,o){if(this.showSearchNotice&&s.getSearch().getSearchString()){setTimeout((()=>{this.showPopupWindowInfo(s.search.container)}),200)}if(e!==this.filterId){return}if(this.commonGrid.isTile()){i=i.then((()=>this.commonGrid.reload()))}if(!this.needRunFilterUnderLinks()){return}this.layout.fileListContainer.classList.add("disk-running-filter");this.runAfterFilterOpenFolder=this.resetFilter.bind(this);const n=BX.Disk.Page.getFolder();n.link=window.location.pathname.toString();const a=function(){const e=BX.Disk.Page.getFolder();return e&&e.id!=n.id};i.then((()=>{if(!this.commonGrid.countItems()){if(this.commonGrid.isTile()){this.commonGrid.instance.removeEmptyBlock();this.commonGrid.instance.setMinHeightContainer()}this.commonGrid.fade()}this.getSymlinksUnderObjectId(n).then((e=>{let t=new BX.Promise;const s=t;e.forEach((function(s,i){t=t.then((()=>{if(a()){return}const t=new BX.Promise;const o=this.commonGrid.instance;const n={viewGridStorageId:BX.Disk.Page.getStorage().id};if(e.length===i+1){this.removeSearchProcessInConnectedFolders()}else if(this.commonGrid.countItems()>0){this.showSearchProcessInConnectedFolders()}if(this.commonGrid.isGrid()){o.getData().request(s.link,"POST",n,null,(function(){if(a()){return}const e=BX.Grid.Utils.getByClass(this.getResponse(),o.settings.get("classBodyRow"));if(BX.type.isArray(e)&&e.length===1&&BX.hasClass(e[0],o.settings.get("classEmptyRows"))){}else if(BX.type.isArray(e)&&e.length===0||!BX.type.isArray(e)){}else{BX.remove(BX.Grid.Utils.getByClass(o.getContainer(),o.settings.get("classEmptyRows"),true));o.adjustEmptyTable(e);o.getUpdater().appendBodyRows(e);o.getRows().reset();o.bindOnRowEvents();o.updateCounterDisplayed();o.updateCounterSelected();o.tableUnfade()}t.fulfill()}))}else{const e=BX.ajax.promise({url:BX.util.add_url_param(s.link,{grid_id:this.commonGrid.getId(),internal:true}),method:"POST",dataType:"json",data:n});e.then((e=>{if(this.commonGrid.countItems()){this.commonGrid.unFade()}if(a()){return}e.data.tileGrid.items.forEach((function(e){this.commonGrid.instance.appendItem(e)}),this);t.fulfill()}))}return t}))}),this);t.then((()=>{this.layout.fileListContainer.classList.remove("disk-running-filter");this.commonGrid.unFade();if(!this.commonGrid.countItems()&&this.commonGrid.isTile()){this.commonGrid.instance.setMinHeightContainer();this.commonGrid.instance.appendEmptyBlock()}}));s.fulfill()}))}))};FolderListClass.prototype.resetFilter=function(){this.isFiltetedFolderList=false;this.filter.getApi().setFields({});this.filter.getSearch().clearForm();this.filter.getSearch().adjustPlaceholder()};FolderListClass.prototype.onChangeDocumentService=function(e){const t=e!=="l";this.commonGrid.getIds().forEach((e=>{const s=this.commonGrid.getActionById(e,"edit");if(!s){return}s.hide=t;const i=this.commonGrid.getActionsMenu(e);i.getMenuItem("edit").hide=t;if(t){BX.addClass(i.getMenuItem("edit").layout.item,"disk-popup-menu-hidden-item")}else{BX.removeClass(i.getMenuItem("edit").layout.item,"disk-popup-menu-hidden-item")}}))};FolderListClass.prototype.onItemMove=function(e,t){if(this.isTrashMode){}else{BX.ajax.runAction("disk.api.commonActions.move",{analyticsLabel:"folder.list.dd",data:{objectId:e.getId(),toFolderId:t.getId()}})}};FolderListClass.prototype.handleItemRemoveByTileGrid=function(e){if(!this.isTrashMode){BX.ajax.runAction("disk.api.commonActions.markDeleted",{analyticsLabel:"folder.list.dd",data:{objectId:e.getId()}})}};FolderListClass.prototype.onItemDblClick=function(e){if(e.isFolder){this.onOpenFolder({id:e.getId(),name:e.name,link:e.item.titleLink.href})}else{BX.fireEvent(e.item.titleLink,"click")}};FolderListClass.prototype.handleTitleClickOnTileItem=function(e,t){if(e.isFolder){this.openFolderByAnchor(e.item.titleLink,t)}};FolderListClass.prototype.handleClickOnBreadcrumb=function(e,t){this.openFolderByAnchor(e,t)};FolderListClass.prototype.onChangeFolder=function(e,t){if(BX.type.isFunction(this.runAfterFilterOpenFolder)){this.runAfterFilterOpenFolder();this.runAfterFilterOpenFolder=null;const e=history.state.folder;e.link=window.location.pathname.toString();BX.onCustomEvent("Disk.FolderListClass:openFolderAfterFilter",[e])}};FolderListClass.prototype.onGridUpdated=function(){};FolderListClass.prototype.onGridOptionsChanged=function(e){const t=e.getUserOptions().getCurrentOptions();this.sort.sortBy=t.last_sort_by;this.sort.direction=t.last_sort_order;const s=this.sortFields.find((function(e){return e.field===this.sort.sortBy}),this);if(s){BX.adjust(this.sort.layout.label,{text:s.label})}};FolderListClass.prototype.onBeforeGridRequest=function(e,t){if(this.gridId!==t.gridId){return}if(!t.url){t.url=this.baseGridPageUrl}if(t.data.controls){const e={};t.data.rows.forEach((t=>{e[t]={ID:t}}));t.data.rows=e}if(t.data.FIELDS||t.data.ID){if(t.data.FIELDS){t.data.rows=t.data.FIELDS}else if(t.data.ID){const e={};t.data.ID.forEach((t=>{e[t]={ID:t}}));t.data.rows=e}t.data.FIELDS=null;t.data.ID=null;t.data.controls=t.data.controls||{};if(this.commonGrid.isGrid()){t.data.controls=BX.mergeEx(t.data.controls,BX.clone(t.data))}}};FolderListClass.prototype.runCommandOnObjectId=function(command,objectId){if(!command){return}switch(command.toLowerCase()){case"!disconnect":case"!detach":var menuItem=this.commonGrid.getActionsMenu(objectId).getMenuItem(command.toLowerCase().slice(1));if(!menuItem||!menuItem.onclick){return}eval(menuItem.onclick);break;case"!share":var menuItem=this.commonGrid.getActionsMenu(objectId).getMenuItem("share-section");if(!menuItem||!menuItem.hasSubMenu()){return}menuItem.addSubMenu(menuItem._items);menuItem=menuItem.getSubMenu().getMenuItem(command.toLowerCase().slice(1));if(!menuItem||!menuItem.onclick){return}eval(menuItem.onclick);break;case"!show":var linkWithObject=BX(`disk_obj_${objectId}`);if(linkWithObject){BX.fireEvent(linkWithObject,"click")}break;default:break}};function getObjectDataId(e){const t=this.getRow(e);return{row:this.getRow(e),title:BX.findChild(t.node,{tagName:"a",className:"bx-disk-folder-title"},true),icon:BX.findChild(t.node,(e=>BX.type.isElementNode(e)&&(BX.hasClass(e,"bx-disk-file-icon")||BX.hasClass(e,"bx-disk-folder-icon"))),true)}}function getIconElementByObjectId(e){const t=this.getRow(e);return BX.findChild(t.node,(e=>BX.type.isElementNode(e)&&(BX.hasClass(e,"bx-disk-file-icon")||BX.hasClass(e,"bx-disk-folder-icon"))),true)}FolderListClass.prototype.scrollToObject=function(e){const t=this.getRow(e);this.scrollToRow(t)};FolderListClass.prototype.scrollToRow=function(e){const t=e.node;new BX.easing({duration:500,start:{scroll:window.pageYOffset||document.documentElement.scrollTop},finish:{scroll:BX.pos(t).top},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step(e){window.scrollTo(0,e.scroll)}}).animate()};FolderListClass.prototype.openMenuWithServices=function(e){const t=new BX.CViewer({});BX.PopupMenu.show("disk_open_menu_with_services",BX(e),[{text:BX.message("DISK_FOLDER_TOOLBAR_LABEL_LOCAL_BDISK_EDIT"),className:"bx-viewer-popup-item item-b24",href:"#",onclick:BX.delegate((function(e){if(BX.CViewer.isEnableLocalEditInDesktop()){this.setEditService("l");BX.adjust(BX("bx-disk-default-service-label"),{text:BX.message("DISK_FOLDER_TOOLBAR_LABEL_LOCAL_BDISK_EDIT")});BX.PopupMenu.destroy("disk_open_menu_with_services")}else{this.helpDiskDialog()}return BX.PreventDefault(e)}),t)},{text:t.getNameEditService("google"),className:"bx-viewer-popup-item item-gdocs",href:"#",onclick:BX.delegate((function(e){this.setEditService("google");BX.adjust(BX("bx-disk-default-service-label"),{text:this.getNameEditService("google")});BX.PopupMenu.destroy("disk_open_menu_with_services");return BX.PreventDefault(e)}),t)},{text:t.getNameEditService("office365"),className:"bx-viewer-popup-item item-office365",href:"#",onclick:BX.delegate((function(e){this.setEditService("office365");BX.adjust(BX("bx-disk-default-service-label"),{text:this.getNameEditService("office365")});BX.PopupMenu.destroy("disk_open_menu_with_services");return BX.PreventDefault(e)}),t)},{text:t.getNameEditService("skydrive"),className:"bx-viewer-popup-item item-office",href:"#",onclick:BX.delegate((function(e){this.setEditService("skydrive");BX.adjust(BX("bx-disk-default-service-label"),{text:this.getNameEditService("skydrive")});BX.PopupMenu.destroy("disk_open_menu_with_services");return BX.PreventDefault(e)}),t)}],{angle:{position:"top",offset:45},autoHide:true,overlay:{opacity:.01}})};FolderListClass.prototype.blockFeatures=function(){BX.PopupWindowManager.create("bx-disk-business-tools-info",null,{content:BX("bx-bitrix24-business-tools-info"),closeIcon:true,onPopupClose(){this.destroy()},autoHide:true,zIndex:11e3}).show()};FolderListClass.prototype.runCreatingFile=function(e,t,s=null,i=false){if(BX.message("disk_restriction")){this.blockFeatures();return}if(t==="l"&&BX.Disk.Document.Local.Instance.isEnabled()){BX.Disk.Document.Local.Instance.createFile({type:e,targetFolderId:BX.Disk.Page.getFolder().id}).then((e=>{this.commonGrid.reload(BX.Disk.getUrlToShowObjectInGrid(e.object.id));if(s){s(e)}}));return}const o=new BX.Disk.Document.CreateProcess({typeFile:e,targetFolderId:BX.Disk.Page.getFolder().id,serviceCode:t,byUnifiedLink:i,onAfterSave:function(e){if(e.status==="success"){this.commonGrid.reload(BX.Disk.getUrlToShowObjectInGrid(e.object.id));if(s){s(e)}}}.bind(this),onAfterCreateFile:e=>{if(e.status==="success"){this.commonGrid.reload()}}});o.start()};FolderListClass.prototype.changeView=function(e){const t=BX.getEventTarget(e);if(t&&this.commonGrid.isTile()){e.preventDefault();this.commonGrid.instance.changeTileSize(t.dataset.viewTileSize);for(let e=0;e<this.layout.changeViewButtons.length;++e){this.layout.changeViewButtons[e].classList.remove("disk-folder-list-view-item-active")}t.classList.toggle("disk-folder-list-view-item-active");if(this.shouldUseHistory()){window.history.replaceState(null,null,BX.util.remove_url_param(document.location.toString(),"viewSize"))}BX.ajax.runComponentAction("bitrix:disk.folder.list","saveViewOptions",{analyticsLabel:`tile.${t.dataset.viewTileSize}`,mode:"class",data:{storageId:BX.Disk.Page.getStorage().id,viewMode:"tile",viewSize:t.dataset.viewTileSize}})}};FolderListClass.prototype.createFolder=function(){const e=this;var t=BX.Disk.modalWindow({modalId:"bx-disk-create-folder",title:BX.message("DISK_FOLDER_TITLE_CREATE_FOLDER"),contentClassName:"",contentStyle:{paddingTop:"30px",paddingBottom:"70px"},events:{onAfterPopupShow(){BX.focus(BX("disk-new-create-filename"))},onPopupClose(){this.destroy()}},content:[BX.create("label",{props:{className:"bx-disk-popup-label",for:"disk-new-create-filename"},children:[BX.create("span",{props:{className:"req"},text:"*"}),BX.message("DISK_FOLDER_LABEL_NAME_CREATE_FOLDER")]}),BX.create("input",{props:{id:"disk-new-create-filename",className:"bx-disk-popup-input",type:"text",value:""},style:{fontSize:"16px",marginTop:"10px"}})],buttons:[new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_BTN_CREATE_FOLDER"),className:"ui-btn ui-btn-success",events:{click(){const s=BX("disk-new-create-filename");const i=s.value;if(!i||!i.replaceAll(/\s+/g,"")){BX.addClass(s,"disk-animated disk-animate-shake");s.addEventListener("animationend",(()=>{BX.removeClass(s,"disk-animated disk-animate-shake")}));BX.focus(s);return}this.addClassName("ui-btn-clock");const o=this;BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(e.ajaxUrl,"action","addFolder"),data:{targetFolderId:BX.Disk.Page.getFolder().id,name:i},onsuccess:function(e){if(!e){return}if(e.status&&e.status=="success"){t.close();this.commonGrid.reload(BX.Disk.getUrlToShowObjectInGrid(e.folder.id,{resetFilter:1}),{}).then((()=>{this.resetFilter();this.commonGrid.selectItemById(e.folder.id);if(this.commonGrid.isGrid()){const t=this.getRow(e.folder.id);this.scrollToRow(t)}}))}else{BX.Disk.showModalWithStatusAction(e);o.removeClassName("ui-btn-clock")}}.bind(e)})}}}),new BX.PopupWindowCustomButton({text:BX.message("DISK_JS_BTN_CLOSE"),className:"ui-btn ui-btn-link",events:{click(){BX.PopupWindowManager.getCurrentPopup().close()}}})]})};FolderListClass.prototype.onClickManageConnectButton=function(e,t){if(e.getIcon()===BX.UI.Button.Icon.DISK){BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","connectToUserStorage"),data:{objectId:this.storage.rootObject.id},onsuccess:BX.delegate((function(t){BX.Disk.showModalWithStatusAction(t);if(t.status!="success"){return}e.setIcon(BX.UI.Button.Icon.DONE);e.setText(BX.message("DISK_FOLDER_LIST_LABEL_ALREADY_CONNECT_DISK"));if(t.manage.link){this.storage.manage.link=BX.clone(t.manage.link,true)}}),this)})}else if(e.getIcon()===BX.UI.Button.Icon.DONE){this.openConfirmDetach({object:{id:this.storage.manage.link.object.id,name:this.storage.name,isFolder:true},onSuccess(t){if(t&&t.status=="success"){t.message=BX.message("DISK_FOLDER_LIST_LABEL_DISCONNECTED_DISK")}BX.Disk.showModalWithStatusAction(t);e.setIcon(BX.UI.Button.Icon.DISK);e.setText(BX.message("DISK_FOLDER_LIST_LABEL_CONNECT_DISK"))}})}};FolderListClass.prototype.showTree=function(e){const t=e.bindElement||null;const s=e.textElement||null;const i=e.valueElement||null;const o=e.onSelect||null;let n=null;let a=null;const r=new BX.Disk.Tree.Modal(this.rootObject,{enableKeyboardNavigation:false,events:{onSelectFolder(e,t){if(!e.getAttribute("data-can-add")){BX.removeClass(e,"selected");return}n=t;if(a){BX.removeClass(a,"selected")}a=e;if(n&&i){i.value=n}if(n&&BX.type.isFunction(o)){o(n)}},onUnSelectFolder(e){n=null;a=null;const t=BX("grid_group_action_target_object");t&&BX.remove(t)}},modalParameters:{bindElement:t,title:e.title,buttons:e.buttons}});r.show()};FolderListClass.prototype.onClickGetFilesCountAndSizeButtonButton=function(e){BX.Disk.ajax({url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","calculateFileSizeAndCount"),method:"POST",dataType:"json",data:{folderId:this.currentFolder.id},onsuccess:BX.delegate((function(e){if(!e||e.status!="success"){BX.Disk.showModalWithStatusAction(e);return}BX.adjust(this.getFilesCountAndSize.sizeContainer,{text:e.size});BX.adjust(this.getFilesCountAndSize.countContainer,{text:e.count})}),this)})};FolderListClass.prototype.handleDocumentSaved=function(e,t){const s=this.commonGrid.getItemById(e.id);if(!s||this.commonGrid.isTile()){return}this.commonGrid.instance.updateRow(e.id,null,null,(()=>{const t=this.commonGrid.instance.getRows().getById(e.id).getNode();if(!t){return}BX.addClass(t,"main-grid-row-checked");setInterval((()=>{BX.removeClass(t,"main-grid-row-checked")}),8e3)}))};FolderListClass.prototype.onSliderMessage=function(e){const t=e.getData();if(e.getEventId()==="Disk.File:onMarkDeleted"&&t.objectId){setTimeout((()=>{this.removeRow(t.objectId)}),500)}if(e.getEventId()==="Disk.File:onDelete"&&t.objectId){setTimeout((()=>{this.removeRow(t.objectId)}),500)}if(e.getEventId()==="Disk.File:onRestore"&&t.objectId){setTimeout((()=>{this.removeRow(t.objectId)}),500)}if(e.getEventId()==="Disk.File:onNewVersionUploaded"){this.commonGrid.reload(BX.Disk.getUrlToShowObjectInGrid(t.object.id))}if(e.getEventId()==="Disk.OnlyOffice:onSaved"){if(t.object){this.commonGrid.reload(BX.Disk.getUrlToShowObjectInGrid(t.object.id))}else{this.commonGrid.reload()}}if(e.getEventId()==="Disk.OnlyOffice:onClosed"&&t.object&&t.process==="create"){this.commonGrid.reload(BX.Disk.getUrlToShowObjectInGrid(t.object.id))}if(e.getEventId()==="Disk.File:onAddSharing"){this.showSharingIcon(t.objectId)}};FolderListClass.prototype.onPopState=function(e){const t=e.state;if(!t||!t.disk||!t.folder){window.location.reload();return}if(!t.folder.link){t.folder.link=window.location.pathname.toString()}BX.onCustomEvent("Disk.FolderListClass:onPopState",[t.folder]);this.openFolder(t.folder.id,t.folder)};FolderListClass.prototype.openGridFolder=function(e){if(e.shiftKey||e.ctrlKey){return}const t=e.target||e.srcElement;if(!t.dataset.objectId){return}const s=this.getRow(t.dataset.objectId);const i=BX.findChildByClassName(s.node,"js-disk-grid-folder");BX.fireEvent(i,"click")};FolderListClass.prototype.openFolderByAnchor=function(e,t){if(t.which!==1||t.ctrlKey||t.metaKey){return}if(this.onOpenFolderByAnchor(e)){t.preventDefault()}};FolderListClass.prototype.onOpenFolderByAnchor=function(e){const t={id:e.dataset.objectId,canAdd:e.dataset.canAdd,link:e.href,name:e.textContent.trim(),node:e};return this.onOpenFolder(t)};FolderListClass.prototype.onOpenFolder=function(e){if(!e.id){return false}BX.onCustomEvent("Disk.FolderListClass:onFolderBeforeOpen",[e]);const t={disk:true,folder:{id:e.id,name:e.name}};if(this.shouldUseHistory()){window.history.pushState(t,null,e.link)}BX.onCustomEvent("Window:onPushState",[t,null,e.link]);this.baseGridPageUrl=e.link;this.openFolder(e.id,e);return true};FolderListClass.prototype.openFolderByContextMenu=function(e,t,s,i){t.preventDefault();i.link=e.href;i.id=s;this.onOpenFolder(i)};FolderListClass.prototype.openFolder=function(e,t){this.commonGrid.reload(t.link,{resetFilter:1}).then((()=>{BX.onCustomEvent("Disk.FolderListClass:onFolderOpen",[t,this.isFiltetedFolderList]);this.removeSearchProcessInConnectedFolders();BX.Disk.Page.changeFolder({id:t.id,name:t.name});if(t.canAdd===undefined){BX.ajax.runAction("disk.api.folder.getAllowedOperationsRights",{analyticsLabel:"folder.list",data:{folderId:t.id}}).then((e=>{const s=e.data.operations;s.disk_add?this.setActiveStateToCreateItemsButton():this.setInactiveStateToCreateItemsButton();t.canAdd=Boolean(s.disk_add)}))}else{t.canAdd?this.setActiveStateToCreateItemsButton():this.setInactiveStateToCreateItemsButton()}window.scroll(0,0)}))};FolderListClass.prototype.onClickDeleteGroup=function(e){if(!this.commonGrid.instance.IsActionEnabled()){return false}const t=document.getElementById(`actallrows_${this.commonGrid.instance.table_id}`);this.openConfirmDeleteGroup({attemptDeleteAll:t&&t.checked});BX.PreventDefault(e);return false};FolderListClass.prototype.removeRow=function(e){this.commonGrid.removeItemById(e);BX.onCustomEvent("onRemoveRowFromDiskList",[e])};FolderListClass.prototype.getRow=function(e){return this.commonGrid.instance.getRows().getById(e)};FolderListClass.prototype.setInactiveStateToCreateItemsButton=function(){this.blockCreateItemsButton();if(this.isUserCollaber){this.addHintToCreateItemButtons()}};FolderListClass.prototype.setActiveStateToCreateItemsButton=function(){this.unblockCreateItemsButton();if(this.isUserCollaber){this.removeHintFromCreateItemButtons();this.showCollaberTourOnCreateItemsButton()}};FolderListClass.prototype.showCollaberTourOnCreateItemsButton=function(){if(!this.isCollaberTourOnAddButtonViewed){const e=new BX.UI.Tour.Guide({id:this.collaberTourOnAddButtonId,simpleMode:true,overlay:false,onEvents:true,autoSave:true,steps:[{target:this.layout.createItemsButton,title:BX.message("DISK_FOLDER_LIST_COLLABER_TOUR_ON_ADD_BUTTON_TITLE"),text:BX.message("DISK_FOLDER_LIST_COLLABER_TOUR_ON_ADD_BUTTON_TEXT"),position:"left",condition:{color:"white",bottom:false,top:false}}]});e.getPopup().setWidth(420);e.start();this.isCollaberTourOnAddButtonViewed=true}};FolderListClass.prototype.blockCreateItemsButton=function(){if(this.layout.createItemsButton){this.layout.createItemsButton.classList.add("ui-btn-disabled")}if(this.layout.emptyBlockUploadFileButtonId){BX.addClass(this.layout.emptyBlockUploadFileButtonId,"disk-folder-list-no-data-disabled")}if(this.layout.emptyBlockCreateFolderButtonId){BX.addClass(this.layout.emptyBlockCreateFolderButtonId,"disk-folder-list-no-data-disabled")}};FolderListClass.prototype.unblockCreateItemsButton=function(){if(this.layout.createItemsButton){this.layout.createItemsButton.classList.remove("ui-btn-disabled")}if(this.layout.emptyBlockUploadFileButtonId){BX.removeClass(this.layout.emptyBlockUploadFileButtonId,"disk-folder-list-no-data-disabled")}if(this.layout.emptyBlockCreateFolderButtonId){BX.removeClass(this.layout.emptyBlockCreateFolderButtonId,"disk-folder-list-no-data-disabled")}};FolderListClass.prototype.addHintToCreateItemButtons=function(){if(this.layout.createItemsButton){this.layout.createItemsButton.dataset.hint=this.getCollaberHintForCreateItemButtons();delete this.layout.createItemsButton.dataset.hintInit;BX.UI.Hint.initNode(this.layout.createItemsButton)}};FolderListClass.prototype.getCollaberHintForCreateItemButtons=function(){const e=BX.Http.Cookie.get(this.readonlyCollabFolderStateCookieName)==="1";if(e){return BX.message("DISK_FOLDER_LIST_COLLABER_HINT_FOR_READONLY_FOLDER_IN_COLLAB")}return BX.message("DISK_FOLDER_LIST_COLLABER_HINT")};FolderListClass.prototype.removeHintFromCreateItemButtons=function(){if(this.layout.createItemsButton){delete this.layout.createItemsButton.dataset.hint}};FolderListClass.prototype.renameInline=function(e){if(this.commonGrid.isTile()){const t=this.commonGrid.instance.getItem(e);if(t){t.onRename()}return}this.commonGrid.instance.getRows().unselectAll();const t=this.commonGrid.instance.getRows().getById(e);t.select();this.commonGrid.instance.editSelected();const s=BX.Grid.Utils.getByClass(t.getNode(),"main-grid-editor-container",true);const i=BX.findChild(s,{tag:"input"},true);if(i){BX.bind(i,"keydown",(e=>{if(e.key==="Enter"){e.stopPropagation();e.preventDefault();this.commonGrid.instance.editSelectedSave()}if(e.key==="Escape"){this.commonGrid.instance.editSelectedCancel()}}));BX.bind(i,"blur",(e=>{e.stopPropagation();e.preventDefault();this.commonGrid.instance.editSelectedSave()}));BX.focus(i)}};FolderListClass.prototype.processGridGroupActionRestore=function(){const e=this.commonGrid.getSelectedIds();if(e.length===0){return}const t=this;const s=BX.message("DISK_TRASHCAN_TRASH_RESTORE_DESCR_MULTIPLE");const i=[new BX.PopupWindowCustomButton({text:BX.message("DISK_TRASHCAN_ACT_RESTORE"),className:"ui-btn ui-btn-success",events:{click(s){this.addClassName("ui-btn-clock");BX.ajax.runAction("disk.api.commonActions.restoreCollection",{analyticsLabel:"folder.list",data:{objectCollection:e}}).then(function(e){if(e.status==="success"){if(e.data.restoredObjectIds.length>1){BX.Disk.showModalWithStatusAction({status:"success",message:BX.message("DISK_TRASHCAN_TRASH_RESTORE_SUCCESS")});this.commonGrid.reload()}else{const t=e.data.restoredObjectIds.pop();window.document.location=BX.Disk.getUrlToShowObjectInGrid(t)}}BX.PopupWindowManager.getCurrentPopup().close()}.bind(t))}}}),new BX.PopupWindowCustomButton({text:BX.message("DISK_JS_BTN_CANCEL"),className:"ui-btn ui-btn-link",events:{click(e){BX.PopupWindowManager.getCurrentPopup().destroy()}}})];BX.Disk.modalWindow({modalId:"bx-link-unlink-confirm",title:BX.message("DISK_TRASHCAN_TRASH_RESTORE_TITLE"),contentClassName:"tac",contentStyle:{paddingTop:"70px",paddingBottom:"70px"},content:s.replace("#NAME#",name),buttons:i})};FolderListClass.prototype.openConfirmRestore=function(e){const t=e.object.name;const s=e.object.id;const i=e.object.isFolder;let o="";if(i){o=BX.message("DISK_TRASHCAN_TRASH_RESTORE_FOLDER_CONFIRM")}else{o=BX.message("DISK_TRASHCAN_TRASH_RESTORE_FILE_CONFIRM")}const n=this;const a=[new BX.PopupWindowCustomButton({text:BX.message("DISK_TRASHCAN_ACT_RESTORE"),className:"ui-btn ui-btn-success",events:{click(e){this.addClassName("ui-btn-clock");BX.ajax.runAction("disk.api.commonActions.restore",{analyticsLabel:"folder.list",data:{objectId:s}}).then(function(e){BX.PopupWindowManager.getCurrentPopup().close();this.commonGrid.selectItemById(s);window.document.location=BX.Disk.getUrlToShowObjectInGrid(e.data.object.id)}.bind(n))}}}),new BX.PopupWindowCustomButton({text:BX.message("DISK_JS_BTN_CANCEL"),className:"ui-btn ui-btn-link",events:{click(e){BX.PopupWindowManager.getCurrentPopup().destroy()}}})];BX.Disk.modalWindow({modalId:"bx-link-unlink-confirm",title:BX.message("DISK_TRASHCAN_TRASH_RESTORE_TITLE"),contentClassName:"tac",contentStyle:{paddingTop:"70px",paddingBottom:"70px"},content:o.replace("#NAME#",t),buttons:a})};FolderListClass.prototype.copyLinkInternalLink=function(e,t){t.classList.add("menu-popup-item-accept","disk-folder-list-context-menu-item-accept-animate");t.style.minWidth=`${t.offsetWidth}px`;const s=t.querySelector(".menu-popup-item-text");if(s){s.textContent=BX.message("DISK_FOLDER_LIST_ACT_COPIED_INTERNAL_LINK")}BX.clipboard.copy(e)};FolderListClass.prototype.openConfirmDelete=function(e){const t=e.object.name;const s=e.object.id;const i=e.object.isFolder;const o=e.object.isDeleted;const n=e.canDelete;let a="";if(i){a=BX.message(n?"DISK_FOLDER_LIST_TRASH_DELETE_DESTROY_FOLDER_CONFIRM":"DISK_FOLDER_LIST_TRASH_DELETE_FOLDER_CONFIRM")}else{a=BX.message(n?"DISK_FOLDER_LIST_TRASH_DELETE_DESTROY_FILE_CONFIRM":"DISK_FOLDER_LIST_TRASH_DELETE_FILE_CONFIRM")}if(o){a=i?BX.message("DISK_FOLDER_LIST_TRASH_DELETE_DESTROY_DELETED_FOLDER_CONFIRM"):BX.message("DISK_FOLDER_LIST_TRASH_DELETE_DESTROY_DELETED_FILE_CONFIRM")}const r=this;const d=[];if(!o){d.push(new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_LIST_TRASH_DELETE_BUTTON"),className:"ui-btn ui-btn-success",events:{click(e){this.addClassName("ui-btn-clock");BX.ajax.runAction("disk.api.commonActions.markDeleted",{analyticsLabel:"folder.list",data:{objectId:s}}).then((e=>{BX.PopupWindowManager.getCurrentPopup().close();r.removeRow(s)}))}}}))}if(n){d.push(new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_LIST_TRASH_DESTROY_BUTTON"),className:"ui-btn ui-btn-light-border",events:{click(e){this.addClassName("ui-btn-clock");BX.ajax.runAction("disk.api.commonActions.delete",{analyticsLabel:"folder.list",data:{objectId:s}}).then((e=>{BX.PopupWindowManager.getCurrentPopup().close();r.removeRow(s)}))}}}))}d.push(new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_LIST_TRASH_CANCEL_DELETE_BUTTON"),className:"ui-btn ui-btn-link",events:{click(e){BX.PopupWindowManager.getCurrentPopup().destroy()}}}));BX.Disk.modalWindow({modalId:"bx-link-unlink-confirm",title:BX.message("DISK_FOLDER_LIST_TRASH_DELETE_TITLE"),contentClassName:"disk-popup-text-content",content:a.replace("#NAME#",t),buttons:d})};FolderListClass.prototype.onPopupFileUploadClose=function(e,t){this.commonGrid.reload(BX.Disk.getUrlToShowObjectInGrid(t,{resetFilter:1})).then((()=>{this.resetFilter();this.commonGrid.selectItemById(t);if(this.commonGrid.isGrid()){const e=this.getRow(t);this.scrollToRow(e)}}))};FolderListClass.prototype.onStepperHasBeenFinished=function(e){this.commonGrid.reload()};let alreadyRunEmptyTrash=false;FolderListClass.prototype.openConfirmEmptyTrash=function(){const e=this.storage.id;const t=[new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_LIST_TITLE_EMPTY_TRASH"),className:"ui-btn ui-btn-success",events:{click(t){this.addClassName("ui-btn-clock");if(alreadyRunEmptyTrash){BX.PopupWindowManager.getCurrentPopup().close();return}alreadyRunEmptyTrash=true;BX.ajax.runAction("disk.api.trashcan.empty",{analyticsLabel:"folder.list",data:{storageId:e}}).then((e=>{BX.ajax.runComponentAction("bitrix:disk.folder.list","getSteppers",{mode:"class"}).then((e=>{if(e.data.html){const t=BX("disk-folder-list-place-for-stepper");if(t){BX.html(t,e.data.html)}}}));BX.PopupWindowManager.getCurrentPopup().close()}),(e=>{BX.Disk.showModalWithStatusAction(e);BX.PopupWindowManager.getCurrentPopup().close()}))}}}),new BX.PopupWindowCustomButton({text:BX.message("DISK_JS_BTN_CANCEL"),className:"ui-btn ui-btn-link",events:{click(e){BX.PopupWindowManager.getCurrentPopup().destroy()}}})];BX.Disk.modalWindow({modalId:"bx-link-empty-trash-confirm",title:BX.message("DISK_FOLDER_LIST_TITLE_EMPTY_TRASH_TITLE"),contentClassName:"disk-popup-text-content",content:BX.message("DISK_FOLDER_LIST_TRASH_EMPTY_TRASH_DESCRIPTION"),buttons:t})};FolderListClass.prototype.openConfirmDetach=function(e){const t=e.object.name;const s=e.object.id;const i=e.object.isFolder;const o=e.onSuccess;let n="";if(i){n=BX.message("DISK_FOLDER_LIST_DETACH_FOLDER_CONFIRM")}else{n=BX.message("DISK_FOLDER_LIST_DETACH_FILE_CONFIRM")}const a=[new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_LIST_DETACH_BUTTON"),className:"ui-btn ui-btn-success",events:{click:BX.delegate((function(e){BX.PopupWindowManager.getCurrentPopup().destroy();BX.PreventDefault(e);BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","detach"),data:{objectId:s},onsuccess:BX.delegate((function(e){if(!e){return}if(e.status=="success"){if(BX.type.isFunction(o)){BX.delegate(o,this)(e)}else{this.removeRow(s)}return}BX.Disk.showModalWithStatusAction(e)}),this)});return false}),this)}}),new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_LIST_TRASH_CANCEL_DELETE_BUTTON"),className:"ui-btn ui-btn-link",events:{click(e){BX.PopupWindowManager.getCurrentPopup().destroy()}}})];BX.Disk.modalWindow({modalId:"bx-link-unlink-confirm",title:i?BX.message("DISK_FOLDER_LIST_DETACH_FOLDER_TITLE"):BX.message("DISK_FOLDER_LIST_DETACH_FILE_TITLE"),contentClassName:"tac",contentStyle:{paddingTop:"70px",paddingBottom:"70px"},content:n.replace("#NAME#",BX.util.htmlspecialchars(t)),buttons:a})};FolderListClass.prototype.openConfirmDeleteGroup=function(){const e=BX.message("DISK_FOLDER_LIST_TRASH_DELETE_GROUP_CONFIRM");const t=[new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_LIST_TRASH_DELETE_BUTTON"),className:"ui-btn ui-btn-success",events:{click:function(e){BX.PopupWindowManager.getCurrentPopup().destroy();const t={};t[this.commonGrid.getActionKey()]="delete";const s={rows:this.commonGrid.getSelectedIds(),controls:t};this.commonGrid.reload(null,s).then((()=>{BX.PopupWindowManager.getCurrentPopup().destroy()}))}.bind(this)}})];const s=false;if(s){t.push(new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_LIST_TRASH_DESTROY_BUTTON"),events:{click:function(e){BX.PopupWindowManager.getCurrentPopup().destroy();const t={};t[this.commonGrid.getActionKey()]="destroy";const s={rows:this.commonGrid.getSelectedIds(),controls:t};this.commonGrid.reload(null,s).then((()=>{BX.PopupWindowManager.getCurrentPopup().destroy()}))}.bind(this)}}))}t.push(new BX.PopupWindowCustomButton({className:"ui-btn ui-btn-link",text:BX.message("DISK_FOLDER_LIST_TRASH_CANCEL_DELETE_BUTTON"),events:{click(e){BX.PopupWindowManager.getCurrentPopup().destroy()}}}));BX.Disk.modalWindow({modalId:"bx-link-unlink-confirm",title:BX.message("DISK_FOLDER_LIST_TRASH_DELETE_TITLE"),contentClassName:"tac",contentStyle:{paddingTop:"70px",paddingBottom:"70px"},content:e,buttons:t})};FolderListClass.prototype.openConfirmDestroyGroup=function(){const e=BX.message("DISK_FOLDER_LIST_TRASH_DESTROY_GROUP_CONFIRM");const t=[new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_LIST_TRASH_DESTROY_BUTTON"),className:"ui-btn ui-btn-success",events:{click:function(e){BX.PopupWindowManager.getCurrentPopup().destroy();const t={};t[this.commonGrid.getActionKey()]="destroy";const s={rows:this.commonGrid.getSelectedIds(),controls:t};this.commonGrid.reload(null,s).then((()=>{BX.PopupWindowManager.getCurrentPopup().destroy()}))}.bind(this)}}),new BX.PopupWindowCustomButton({className:"ui-btn ui-btn-link",text:BX.message("DISK_JS_BTN_CANCEL"),events:{click(e){BX.PopupWindowManager.getCurrentPopup().destroy()}}})];BX.Disk.modalWindow({modalId:"bx-link-unlink-confirm",title:BX.message("DISK_FOLDER_LIST_TRASH_DELETE_TITLE"),contentClassName:"disk-popup-text-content",content:e,buttons:t})};FolderListClass.prototype.downloadGroup=function(){const e=this.commonGrid.getSelectedIds();if(e.length===0){return}BX.ajax.runAction("disk.api.commonActions.checkFileLimit",{data:{objectCollection:e}}).then((t=>{if(t.data.isFileLimitExceeded===false){BX.ajax.runAction("disk.api.commonActions.getArchiveLink",{analyticsLabel:"folder.list",data:{objectCollection:e}}).then((e=>{this.downloadFile(e.data.downloadArchiveUri)})).catch((e=>{BX.Disk.showModalWithStatusAction(e)}))}else{this.showErrorPopup()}})).catch((e=>{BX.Disk.showModalWithStatusAction(e)}))};FolderListClass.prototype.checkFileLimit=async function(e,t){BX.ajax.runAction("disk.api.folder.checkFileLimit",{data:{id:e}}).then((e=>{if(e.data.isFileLimitExceeded===false){this.downloadFile(t)}else{this.showErrorPopup()}})).catch((e=>{BX.Disk.showModalWithStatusAction(e)}))};FolderListClass.prototype.showErrorPopup=function(){BX.Runtime.loadExtension("ui.dialogs.messagebox").then((e=>{e.MessageBox.show({message:BX.Loc.getMessage("DISK_FOLDER_LIST_ACT_DOWNLOAD_ERROR"),buttons:e.MessageBoxButtons.OK,onOk(e){e.close()},useAirDesign:true})}))};FolderListClass.prototype.downloadFile=function(e){window.location.href=e};FolderListClass.prototype.openConfirmCopyGroup=function(){let e;const t=this;const s=[new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_LIST_TITLE_GRID_TOOLBAR_COPY_BUTTON"),className:"ui-btn ui-btn-success",events:{click(s){if(!e){return}this.addClassName("ui-btn-clock");const i={};i[t.commonGrid.getActionKey()]="copy";i.destinationFolderId=e;const o={rows:t.commonGrid.getSelectedIds(),controls:i};t.commonGrid.reload(null,o).then((()=>{BX.PopupWindowManager.getCurrentPopup().destroy()}))}}}),new BX.PopupWindowCustomButton({text:BX.message("DISK_JS_BTN_CANCEL"),className:"ui-btn ui-btn-link",events:{click(e){BX.PopupWindowManager.getCurrentPopup().destroy()}}})];this.showTree({title:BX.message("DISK_FOLDER_LIST_TITLE_MODAL_MANY_COPY_TO"),buttons:s,onSelect(t){e=t}})};FolderListClass.prototype.openConfirmMoveGroup=function(){let e;const t=this;const s=[new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_LIST_TITLE_GRID_TOOLBAR_MOVE_BUTTON"),className:"ui-btn ui-btn-success",events:{click(s){if(!e){return}this.addClassName("ui-btn-clock");const i={};i[t.commonGrid.getActionKey()]="move";i.destinationFolderId=e;const o={rows:t.commonGrid.getSelectedIds(),controls:i};t.commonGrid.reload(null,o).then((()=>{BX.PopupWindowManager.getCurrentPopup().destroy()}))}}}),new BX.PopupWindowCustomButton({text:BX.message("DISK_JS_BTN_CANCEL"),className:"ui-btn ui-btn-link",events:{click(e){BX.PopupWindowManager.getCurrentPopup().destroy()}}})];this.showTree({title:BX.message("DISK_FOLDER_LIST_TITLE_MODAL_MANY_MOVE_TO"),buttons:s,onSelect(t){e=t}})};FolderListClass.prototype.connectObjectToDisk=function(e){const t=e.object.name;const s=e.object.id;const i=e.object.isFolder;BX.Disk.ajaxPromise({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","connectToUserStorage"),data:{objectId:s}}).then((e=>{if(!e){return}if(e.status=="success"){this.commonGrid.getActionById(s,"connect").hide=true;const e=this.commonGrid.getActionsMenu(s);e.getMenuItem("connect").hide=true;BX.addClass(e.getMenuItem("connect").layout.item,"disk-popup-menu-hidden-item");BX.Disk.showModalWithStatusAction({status:"success",message:i?BX.message("DISK_FOLDER_LIST_SUCCESS_CONNECT_TO_DISK_FOLDER").replace("#NAME#",t):BX.message("DISK_FOLDER_LIST_SUCCESS_CONNECT_TO_DISK_FILE").replace("#NAME#",t)})}else{e.errors=e.errors||[{}];BX.Disk.showModalWithStatusAction({status:"error",message:e.errors.pop().message})}}))};FolderListClass.prototype.unlockFile=function(e){const t=e.object.name;const s=e.object.id;BX.Disk.ajaxPromise({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","unlock"),data:{objectId:s}}).then((e=>{if(!e){return}if(e.status=="success"){this.commonGrid.getActionById(s,"lock").hide=false;this.commonGrid.getActionById(s,"unlock").hide=true;const e=this.commonGrid.getActionsMenu(s);e.getMenuItem("lock").hide=false;e.getMenuItem("unlock").hide=true;BX.removeClass(e.getMenuItem("lock").layout.item,"disk-popup-menu-hidden-item");BX.addClass(e.getMenuItem("unlock").layout.item,"disk-popup-menu-hidden-item");this.hideLockIcon(s)}else{e.errors=e.errors||[{}];BX.Disk.showModalWithStatusAction({status:"error",message:e.errors.pop().message})}}))};FolderListClass.prototype.lockFile=function(e){const t=e.object.name;const s=e.object.id;BX.Disk.ajaxPromise({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","lock"),data:{objectId:s}}).then((e=>{if(!e){return}if(e.status=="success"){this.commonGrid.getActionById(s,"unlock").hide=false;this.commonGrid.getActionById(s,"lock").hide=true;const e=this.commonGrid.getActionsMenu(s);e.getMenuItem("unlock").hide=false;e.getMenuItem("lock").hide=true;BX.removeClass(e.getMenuItem("unlock").layout.item,"disk-popup-menu-hidden-item");BX.addClass(e.getMenuItem("lock").layout.item,"disk-popup-menu-hidden-item");this.showLockIcon(s)}else{e.errors=e.errors||[{}];BX.Disk.showModalWithStatusAction({status:"error",message:e.errors.pop().message})}}))};FolderListClass.prototype.showSharingIcon=function(e){if(this.commonGrid.isTile()){const t=this.commonGrid.instance.getItem(e);t&&t.markAsShared()}else{const t=this.getRow(e);const s=BX.findChildByClassName(t.node,"bx-disk-file-icon",true)||BX.findChildByClassName(t.node,"bx-disk-folder-icon",true);if(s){BX.addClass(s,"icon-shared shared icon-shared_1 icon-shared_2")}}};FolderListClass.prototype.hideSharingIcon=function(e){if(this.commonGrid.isTile()){const t=this.commonGrid.instance.getItem(e);t&&t.unmarkAsShared()}else{const t=this.getRow(e);const s=BX.findChildByClassName(t.node,"bx-disk-file-icon",true)||BX.findChildByClassName(t.node,"bx-disk-folder-icon",true);if(s){BX.removeClass(s,"icon-shared shared icon-shared_1 icon-shared_2")}}};FolderListClass.prototype.showLockIcon=function(e){if(this.commonGrid.isGrid()){const t=this.getRow(e);const s=BX.findChildByClassName(t.node,"js-lock-icon",true);if(s){BX.show(s,"block")}}else{const t=this.commonGrid.instance.getItem(e);t.lock()}};FolderListClass.prototype.hideLockIcon=function(e){if(this.commonGrid.isGrid()){const t=this.getRow(e);const s=BX.findChildByClassName(t.node,"js-lock-icon",true);if(s){BX.hide(s,"block")}}else{const t=this.commonGrid.instance.getItem(e);t.unlock()}};FolderListClass.prototype.sortByColumn=function(e,t){t=t||"desc";this.sort.sortBy=e;this.sort.direction=t.toLowerCase();this.commonGrid.sortByColumn({sort_by:this.sort.sortBy,sort_order:this.sort.direction})};FolderListClass.prototype.showGridSortingMenu=function(e){const t=BX.getEventTarget(e);const s=function(e){if(t){BX.adjust(t,{text:e.text})}};const i=function(e){e.layout.item.classList.toggle("menu-popup-item-accept");e.layout.item.classList.toggle("menu-popup-no-icon")};const o=[];this.sortFields.forEach((function(e){o.push({title:e.label,text:e.label,field:e.field,className:e.active?"menu-popup-item menu-popup-item-accept":"",onclick:function(e,t){this.sortFields.forEach((e=>e.active=false));const i=this.sortFields.find((e=>e.field===t.field));if(i){i.active=true}this.sortByColumn(t.field,this.sort.direction);s(t);t.menuWindow.close()}.bind(this)})}),this);o.push({delimiter:true},{title:BX.message("DISK_FOLDER_LIST_LABEL_SORT_INVERSE_DIRECTION"),text:BX.message("DISK_FOLDER_LIST_LABEL_SORT_INVERSE_DIRECTION"),className:this.sort.direction==="desc"?"menu-popup-item menu-popup-item-accept":"",onclick:function(e,t){this.inverseSortByColumn();i(t);t.menuWindow.close()}.bind(this)},{delimiter:true},{title:BX.message("DISK_FOLDER_LIST_LABEL_SORT_MIX_MODE"),text:BX.message("DISK_FOLDER_LIST_LABEL_SORT_MIX_MODE"),className:this.sort.mix?"menu-popup-item menu-popup-item-accept":"",onclick:function(e,t){this.toggleMixSort();i(t);t.menuWindow.close()}.bind(this)});const n=BX.PopupMenu.create("disk-folder-list-sorting-menu",this.sort.layout.label,o,{autoHide:true,className:"disk-folder-list-sorting-menu",offsetTop:0,offsetLeft:35,angle:{offset:45},events:{onPopupClose(){BX.PopupMenu.destroy("disk-folder-list-sorting-menu");this.destroy()}}});n.show()};FolderListClass.prototype.inverseSortByColumn=function(){const e=this.sort.direction==="desc"?"asc":"desc";this.sortByColumn(this.sort.sortBy,e)};FolderListClass.prototype.toggleMixSort=function(){if(this.sort.mix){this.disableMixSort()}else{this.enableMixSort()}};FolderListClass.prototype.enableMixSort=function(){this.sort.mix=true;this.commonGrid.reload("",{sortMode:"mix"})};FolderListClass.prototype.disableMixSort=function(){this.sort.mix=false;this.commonGrid.reload("",{sortMode:"ord"})};FolderListClass.prototype.openExternalLinkDetailSettingsWithEditing=function(e){BX.Disk.modalWindowActionLoader("disk.api.commonActions.generateExternalLink",{analyticsLabel:"folder.list",id:"bx-disk-external-link-loader",postData:{objectId:e},afterSuccessLoad(t){if(!t||t.status!="success"){BX.Disk.showModalWithStatusAction(t);return}const s=new BX.Disk.Model.ExternalLink.Input({state:t.data.externalLink,data:{objectId:e},models:{externalLinkSettings:new BX.Disk.Model.ExternalLink.Settings({state:t.data.externalLink}),externalLinkDescription:new BX.Disk.Model.ExternalLink.Description({state:t.data.externalLink})}});s.render();BX.Disk.modalWindow({modalId:"bx-disk-external-link",title:BX.message("DISK_FOLDER_LIST_TITLE_MODAL_GET_EXT_LINK"),contentClassName:"disk-popup-external-link-config",className:"disk-external-link-popup",contentStyle:{},events:{onPopupClose(){this.destroy()}},content:[s.getContainer()],buttons:[new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_LIST_BTN_SAVE"),className:"ui-btn ui-btn-success",events:{click(){s.externalLinkSettings.save();BX.PopupWindowManager.getCurrentPopup().close();setTimeout((()=>{BX.Disk.showModalWithStatusAction({status:"success"})}),300)}}}),new BX.PopupWindowCustomButton({className:"ui-btn ui-btn-link",text:BX.message("DISK_JS_BTN_CLOSE"),events:{click(){BX.PopupWindowManager.getCurrentPopup().close()}}})]})}})};FolderListClass.prototype.onBeforeElementShow=function(e,t,s){if(t.hasOwnProperty("image")||!BX.message("disk_restriction")){return}s.prevent=true;BX.PopupWindowManager.create("bx-disk-business-tools-info",null,{content:BX("bx-bitrix24-business-tools-info"),closeIcon:true,onPopupClose(){this.destroy()},autoHide:true,zIndex:11e3}).show()};FolderListClass.prototype.onIframeElementLoadDataToView=function(e,t){if(t&&t.status==="restriction"&&BX("bx-bitrix24-business-tools-info")){if(BX.CViewer&&BX.CViewer.objNowInShow){if(e.currentModalWindow){e.currentModalWindow.close()}BX.CViewer.objNowInShow.close()}BX.PopupWindowManager.create("bx-disk-business-tools-info",null,{content:BX("bx-bitrix24-business-tools-info"),closeIcon:true,onPopupClose(){this.destroy()},autoHide:true,zIndex:11e3}).show()}};FolderListClass.prototype.getExternalLink=function(e){const t=BX.delegate(getObjectDataId,this)(e);const s=BX.hasClass(t.icon,"bx-disk-folder-icon");let i=this.ajaxUrl;i=BX.Disk.addToLinkParam(i,"action","generateExternalLink");i=BX.Disk.addToLinkParam(i,"isFolder",s);BX.Disk.modalWindowLoader(i,{id:"bx-disk-external-link-loader",responseType:"json",postData:{objectId:e},afterSuccessLoad:BX.delegate((function(t){if(!t||t.status!="success"){BX.Disk.showModalWithStatusAction(t);return}this.cacheExternalLinks[e]=t.link;BX.Disk.modalWindow({modalId:"bx-disk-external-link",title:BX.message("DISK_FOLDER_LIST_TITLE_MODAL_GET_EXT_LINK"),contentClassName:"tac",contentStyle:{},events:{onAfterPopupShow(){const e=BX("disk-get-external-link");BX.focus(e);e.setSelectionRange(0,e.value.length)},onPopupClose(){this.destroy()}},content:[BX.create("label",{props:{className:"bx-disk-popup-label",for:"disk-get-external-link"}}),BX.create("input",{style:{marginTop:"10px"},props:{id:"disk-get-external-link",className:"bx-viewer-inp",type:"text",value:t.link}})],buttons:[new BX.PopupWindowCustomButton({text:BX.message("DISK_JS_BTN_CLOSE"),className:"ui-btn ui-btn-link",events:{click(){BX.PopupWindowManager.getCurrentPopup().close()}}})]})}),this)});return false};FolderListClass.prototype.getInternalLink=function(e){BX.Disk.modalWindow({modalId:"bx-disk-internal-link",title:BX.message("DISK_FOLDER_LIST_ACT_COPY_INTERNAL_LINK"),contentClassName:"tac",contentStyle:{},events:{onAfterPopupShow(){const e=BX("disk-get-internal-link");BX.focus(e);e.setSelectionRange(0,e.value.length)},onPopupClose(){this.destroy()}},content:[BX.create("label",{props:{className:"bx-disk-popup-label",for:"disk-get-internal-link"}}),BX.create("input",{style:{marginTop:"10px"},props:{id:"disk-get-internal-link",className:"bx-viewer-inp",type:"text",value:e}})],buttons:[new BX.PopupWindowCustomButton({text:BX.message("DISK_JS_BTN_CLOSE"),className:"ui-btn ui-btn-link",events:{click(){BX.PopupWindowManager.getCurrentPopup().close()}}})]})};FolderListClass.prototype.openCopyModalWindow=function(e,t){let s=null;let i=null;const o=new BX.Disk.Tree.Modal(this.rootObject,{events:{onSelectFolder(e,t){if(!e.getAttribute("data-can-add")){BX.removeClass(e,"selected");return}if(i){BX.removeClass(i,"selected")}s=t;i=e},onUnSelectFolder(){s=null;i=null}},modalParameters:{title:BX.message("DISK_FOLDER_LIST_TITLE_MODAL_TREE"),contentTitle:BX.message("DISK_FOLDER_LIST_TITLE_MODAL_COPY_TO").replace("#NAME#",t.name),buttons:[new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_LIST_TITLE_MODAL_COPY_TO_BUTTON"),className:"ui-btn ui-btn-success",events:{click:BX.delegate((function(e){if(!s){BX.PreventDefault(e);return false}BX.PopupWindowManager.getCurrentPopup().close();BX.PreventDefault(e);BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","copyTo"),data:{objectId:t.id,targetObjectId:s},onsuccess(e){if(!e){return}if(e.status=="success"){if(e.isFolder){e.message=BX.message("DISK_FOLDER_LIST_OK_FOLDER_COPIED").replace("#FOLDER#",e.name)}else{e.message=BX.message("DISK_FOLDER_LIST_OK_FILE_COPIED").replace("#FILE#",e.name)}e.message=e.message.replace("#TARGET_FOLDER#",e.destination.name);BX.Disk.showModalWithStatusAction(e);return}BX.Disk.showModalWithStatusAction(e)}});return false}),this)}}),new BX.PopupWindowCustomButton({text:BX.message("DISK_JS_BTN_CANCEL"),className:"ui-btn ui-btn-link",events:{click(e){BX.PopupWindowManager.getCurrentPopup().destroy()}}})]}});o.show()};FolderListClass.prototype.openMoveModalWindow=function(e,t){let s=null;let i=null;const o=new BX.Disk.Tree.Modal(this.rootObject,{events:{onSelectFolder(e,t){if(!e.getAttribute("data-can-add")){BX.removeClass(e,"selected");return}if(i){BX.removeClass(i,"selected")}s=t;i=e},onUnSelectFolder(){s=null;i=null}},modalParameters:{title:BX.message("DISK_FOLDER_LIST_TITLE_MODAL_TREE"),contentTitle:BX.message("DISK_FOLDER_LIST_TITLE_MODAL_MOVE_TO").replace("#NAME#",t.name),buttons:[new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_LIST_TITLE_MODAL_MOVE_TO_BUTTON"),className:"ui-btn ui-btn-success",events:{click:BX.delegate((function(e){if(!s){BX.PreventDefault(e);return false}BX.PopupWindowManager.getCurrentPopup().close();BX.PreventDefault(e);BX.Disk.ajaxPromise({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","moveTo"),data:{objectId:t.id,targetObjectId:s}}).then((e=>{if(this.commonGrid.isGrid()){this.commonGrid.instance.getRows().unselectAll()}this.commonGrid.selectItemById(t.id);this.commonGrid.reload();if(e.isFolder){e.message=BX.message("DISK_FOLDER_LIST_OK_FOLDER_MOVED").replace("#FOLDER#",e.name)}else{e.message=BX.message("DISK_FOLDER_LIST_OK_FILE_MOVED").replace("#FILE#",e.name)}e.message=e.message.replace("#TARGET_FOLDER#",e.destination.name);BX.Disk.showModalWithStatusAction(e)}));return false}),this)}}),new BX.PopupWindowCustomButton({text:BX.message("DISK_JS_BTN_CANCEL"),className:"ui-btn ui-btn-link",events:{click(e){BX.PopupWindowManager.getCurrentPopup().destroy()}}})]}});o.show()};let isChangedRights=false;let storageNewRights={};let originalRights={};let detachedRights={};let moduleTasks={};let entityToNewShared={};let loadedReadOnlyEntityToNewShared={};let entityToNewSharedMaxTaskName="";FolderListClass.prototype.showSharingDetailWithChangeRights=function(e){entityToNewShared={};loadedReadOnlyEntityToNewShared={};e=e||{};const t=e.object.id;BX.Disk.modalWindowLoader(BX.Disk.addToLinkParam(this.ajaxUrl,"action","showSharingDetailChangeRights"),{id:`folder_list_sharing_detail_object_${t}`,responseType:"json",postData:{objectId:t},afterSuccessLoad:BX.delegate((function(s){if(s.status!="success"){s.errors=s.errors||[{}];BX.Disk.showModalWithStatusAction({status:"error",message:s.errors.pop().message})}const i={name:s.owner.name,avatar:s.owner.avatar,link:s.owner.link};if(s.unifiedLink){const e=s.unifiedLink.availableAccessLevels.find((e=>e.value===s.unifiedLink.currentAccessLevel));const t=BX.create("span",{props:{className:"bx-disk-filepage-used-people-permission"},text:e.name});const i="disk_open_menu_with_rights";t.addEventListener("click",(e=>{const i="access-level-menu";const o=s.unifiedLink.availableAccessLevels.map((e=>({id:e.value,text:e.name,onclick(){t.textContent=e.name;if(entityToNewShared.unifiedLink.currentAccessLevel!==e.value){entityToNewShared.unifiedLink.newAccessLevel=e.value}BX.PopupMenu.destroy(i)}})));BX.PopupMenu.show(i,e.target,o,{autoHide:true,offsetTop:0,offsetLeft:0,angle:{position:"top",offset:45},autoHide:true,overlay:{opacity:.01},events:{onPopupClose(){BX.PopupMenu.destroy(i)}}})}));var o=BX.create("table",{props:{id:"bx-disk-popup-shared-universal-list",className:"bx-disk-popup-shared-people-list"},children:[BX.create("thead",{children:[BX.create("tr",{children:[BX.create("td",{props:{className:"bx-disk-popup-shared-people-list-head-col1"}}),BX.create("td",{props:{className:"bx-disk-popup-shared-people-list-head-col2"},text:BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_RIGHTS")}),BX.create("td",{props:{className:"bx-disk-popup-shared-people-list-head-col3"}})]}),BX.create("tr",{children:[BX.create("td",{props:{className:"bx-disk-popup-shared-people-list-head-col1"},children:[BX.create("span",{props:{className:"bx-disk-filepage-used-people-link"},children:[BX.create("span",{props:{className:"bx-disk-filepage-used-people-avatar link",style:"--ui-icon-set__icon-size: 15px;"}}),BX.create("span",{text:BX.message("DISK_FOLDER_LIST_UNIFIED_RIGHT_USERS")})]})]}),BX.create("td",{props:{className:"bx-disk-popup-shared-people-list-head-col2"},children:[t]}),BX.create("td",{props:{className:"bx-disk-popup-shared-people-list-head-col3"}})]})]})]})}BX.Disk.modalWindow({modalId:"bx-disk-detail-sharing-folder-change-right",title:BX.message("DISK_FOLDER_LIST_SHARING_TITLE_MODAL_3"),contentClassName:"",contentStyle:{},events:{onAfterPopupShow:BX.delegate((function(){BX.addCustomEvent("onChangeRightOfSharing",BX.proxy(this.onChangeRightOfSharing,this));for(const e in s.members){if(!s.members.hasOwnProperty(e)){continue}entityToNewShared[s.members[e].entityId]={item:{id:s.members[e].entityId,name:s.members[e].name,avatar:s.members[e].avatar},type:s.members[e].type,right:s.members[e].right}}if(s.unifiedLink){entityToNewShared.unifiedLink=s.unifiedLink}BX.SocNetLogDestination.init({name:this.destFormName,searchInput:BX("feed-add-post-destination-input"),bindMainPopup:{node:BX("feed-add-post-destination-container"),offsetTop:"5px",offsetLeft:"15px"},bindSearchPopup:{node:BX("feed-add-post-destination-container"),offsetTop:"5px",offsetLeft:"15px"},callback:{select:BX.proxy(this.onSelectDestination,this),unSelect:BX.proxy(this.onUnSelectDestination,this),openDialog:BX.proxy(this.onOpenDialogDestination,this),closeDialog:BX.proxy(this.onCloseDialogDestination,this),openSearch:BX.proxy(this.onOpenSearchDestination,this),closeSearch:BX.proxy(this.onCloseSearchDestination,this)},items:s.destination.items,itemsLast:s.destination.itemsLast,itemsSelected:s.destination.itemsSelected});const e=this.destFormName;BX.bind(BX("feed-add-post-destination-container"),"click",(t=>{BX.SocNetLogDestination.openDialog(e);BX.PreventDefault(t)}));BX.bind(BX("feed-add-post-destination-input"),"keyup",BX.proxy(this.onKeyUpDestination,this));BX.bind(BX("feed-add-post-destination-input"),"keydown",BX.proxy(this.onKeyDownDestination,this))}),this),onPopupClose:BX.delegate((function(){if(BX.SocNetLogDestination&&BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.closeDialog()}BX.removeCustomEvent("onChangeRightOfSharing",BX.proxy(this.onChangeRightOfSharing,this));BX.proxy_context.destroy()}),this)},content:[BX.create("div",{props:{className:"bx-disk-popup-content"},children:[BX.create("table",{props:{className:"bx-disk-popup-shared-people-list"},children:[BX.create("thead",{html:"<tr>"+`<td class="bx-disk-popup-shared-people-list-head-col1">${BX.message("DISK_FOLDER_LIST_SHARING_LABEL_OWNER")}</td>`+"</tr>"}),BX.create("tr",{html:"<tr>"+`<td class="bx-disk-popup-shared-people-list-col1" style="border-bottom: none;"><a class="bx-disk-filepage-used-people-link" href="${i.link}"><span class="bx-disk-filepage-used-people-avatar" style="background-image: url('${encodeURI(i.avatar)}');"></span>${BX.util.htmlspecialchars(i.name)}</a></td>`+"</tr>"})]}),o,BX.create("table",{props:{id:"bx-disk-popup-shared-people-list",className:"bx-disk-popup-shared-people-list"},children:[BX.create("thead",{html:"<tr>"+`<td class="bx-disk-popup-shared-people-list-head-col1">${BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_RIGHTS_USER")}</td>`+`<td class="bx-disk-popup-shared-people-list-head-col2">${BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_RIGHTS")}</td>`+'<td class="bx-disk-popup-shared-people-list-head-col3"></td>'+"</tr>"})]}),BX.create("div",{props:{id:"feed-add-post-destination-container",className:"feed-add-post-destination-wrap"},children:[BX.create("span",{props:{className:"feed-add-post-destination-item"}}),BX.create("span",{props:{id:"feed-add-post-destination-input-box",className:"feed-add-destination-input-box"},style:{background:"transparent"},children:[BX.create("input",{props:{type:"text",value:"",id:"feed-add-post-destination-input",className:"feed-add-destination-inp"}})]}),BX.create("a",{props:{href:"#",id:"bx-destination-tag",className:"feed-add-destination-link"},style:{background:"transparent"},text:BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_ADD_RIGHTS_USER"),events:{click:BX.delegate((()=>{}),this)}})]})]})],buttons:[new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_LIST_BTN_SAVE"),className:"ui-btn ui-btn-success",events:{click:BX.delegate((function(){BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","changeSharingAndRights"),data:{objectId:t,entityToNewShared:entityToNewShared},onsuccess:BX.delegate((function(s){if(!s){return}if(e.object.isFolder){s.message=BX.message("DISK_FOLDER_LIST_OK_FOLDER_SHARE_MODIFIED").replace("#FOLDER#",e.object.name)}else{let t=e.object.name.split(".");const i=t.pop().toLowerCase();t=t.join(".");if(t&&i==="board"){s.message=BX.message("DISK_FOLDER_LIST_OK_BOARD_SHARE_MODIFIED").replace("#FILE#",t)}else{s.message=BX.message("DISK_FOLDER_LIST_OK_FILE_SHARE_MODIFIED").replace("#FILE#",e.object.name)}}BX.Disk.showModalWithStatusAction(s);this.showSharingIcon(t)}),this)});BX.PopupWindowManager.getCurrentPopup().close()}),this)}}),new BX.PopupWindowCustomButton({text:BX.message("DISK_JS_BTN_CANCEL"),className:"ui-btn ui-btn-link",events:{click(e){BX.PopupWindowManager.getCurrentPopup().destroy()}}})]})}),this)})};function showAccessCodeFullName(e){e=e||{};return(e.provider?`${e.provider}: `:"")+e.name}FolderListClass.prototype.showRights=function(e){e=e||{};const t=e.object.id;const s={};BX.Disk.modalWindowLoader(BX.Disk.addToLinkParam(this.ajaxUrl,"action","showRightsDetail"),{id:`folder_list_sharing_detail_object_${t}`,responseType:"json",postData:{objectId:t},afterSuccessLoad:BX.delegate((function(e){if(e.status!="success"){e.errors=e.errors||[{}];BX.Disk.showModalWithStatusAction({status:"error",message:e.errors.pop().message})}for(const t in e.rights){if(!e.rights.hasOwnProperty(t)){continue}const i=e.rights[t];for(const o in i){if(!i.hasOwnProperty(o)){continue}s[t]={readOnly:true,item:{id:t,name:showAccessCodeFullName(e.accessCodeNames[t]),avatar:null},type:"group",right:{title:i[o].TASK.TITLE}}}}BX.Disk.modalWindow({modalId:"bx-disk-detail-sharing-folder-change-right",title:BX.message("DISK_FOLDER_LIST_SHARING_TITLE_MODAL_3"),contentClassName:"",contentStyle:{},events:{onAfterPopupShow:BX.delegate((()=>{for(const e in s){if(!s.hasOwnProperty(e)){continue}BX.Disk.appendRight(s[e])}}),this),onPopupClose:BX.delegate((()=>{BX.proxy_context.destroy()}),this)},content:[BX.create("div",{props:{className:"bx-disk-popup-content"},children:[BX.create("table",{props:{id:"bx-disk-popup-shared-people-list",className:"bx-disk-popup-shared-people-list"},children:[BX.create("thead",{html:"<tr>"+`<td class="bx-disk-popup-shared-people-list-head-col1">${BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_RIGHTS_USER")}</td>`+`<td class="bx-disk-popup-shared-people-list-head-col2">${BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_RIGHTS")}</td>`+'<td class="bx-disk-popup-shared-people-list-head-col3"></td>'+"</tr>"})]}),BX.create("a",{text:BX.message("DISK_FOLDER_TOOLBAR_BTN_CREATE_FOLDER"),props:{id:"bx-disk-destination-object-modal",className:"bx-disk-btn bx-disk-btn-big bx-disk-btn-transparent border"},events:{click:BX.delegate((()=>{}),this)},children:[BX.create("span",{props:{className:"bx-disk-btn-icon bx-disk-btn-icon-plus"}}),BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_ADD_RIGHTS_USER")]}),BX.create("div",{html:'<span class="feed-add-destination-input-box" id="feed-add-post-destination-input-box">'+'<input autocomplete="nope" type="text" value="" class="feed-add-destination-inp" id="feed-add-post-destination-input"/>'+"</span>"})]})],buttons:[]})}),this)})};FolderListClass.prototype.showRightsOnStorage=function(){storageNewRights={};const e=this.storage.id;const t={};BX.Disk.modalWindowLoader(BX.Disk.addToLinkParam(this.ajaxUrl,"action","showRightsOnStorageDetail"),{id:`folder_list_rights_detail_storage_${e}`,responseType:"json",postData:{storageId:e},afterSuccessLoad:BX.delegate((function(s,i){i&&i.close();if(s.status!=="success"){s.errors=s.errors||[{}];BX.Disk.showModalWithStatusAction({status:"error",message:s.errors.pop().message});return}if(BX.Disk.isEmptyObject(moduleTasks)){moduleTasks=BX.clone(s.tasks,true);BX.Disk.setModuleTasks(moduleTasks)}for(const e in s.rights){if(!s.rights.hasOwnProperty(e)){continue}const i=s.rights[e];for(const o in i){if(!i.hasOwnProperty(o)){continue}t[e]={readOnly:Boolean(i[o].READ_ONLY),item:{id:e,name:showAccessCodeFullName(s.accessCodeNames[e]),avatar:null},type:"group",right:{title:i[o].TASK.TITLE,id:i[o].TASK.ID}}}}const o=Boolean(s.showExtendedRights);const n=s.systemFolders.show;var a=BX.Disk.modalWindow({modalId:"bx-disk-detail-sharing-folder-change-right",title:BX.message("DISK_FOLDER_LIST_RIGHTS_TITLE_MODAL_WITH_NAME").replace("#OBJECT#",s.storage.name),withoutWindowManager:true,contentClassName:"",contentStyle:{},events:{onAfterPopupShow:BX.delegate((function(){storageNewRights=BX.clone(t,true);isChangedRights=false;BX.Access.Init({groups:{disabled:this.isBitrix24}});const e={};for(const e in storageNewRights){if(!storageNewRights.hasOwnProperty(e)){continue}storageNewRights[e].isBitrix24=this.isBitrix24;BX.Disk.appendSystemRight(storageNewRights[e])}BX.addCustomEvent("onChangeSystemRight",BX.proxy(this.onChangeSystemRight,this));BX.addCustomEvent("onDetachSystemRight",BX.proxy(this.onDetachSystemRight,this));BX.bind(BX("feed-add-post-destination-container"),"click",BX.delegate((function(e){const t={};for(const e in storageNewRights){if(!storageNewRights.hasOwnProperty(e)){continue}t[e]=true}BX.Access.SetSelected(t);BX.Access.ShowForm({showSelected:true,callback:BX.delegate((function(e){const t=[];for(const s in e){for(const i in e[s]){t.push(e[s][i]);this.onSelectSystemRight(e[s][i],s)}}}),this)});return BX.PreventDefault(e)}),this))}),this),onPopupClose:BX.delegate((function(){BX.removeCustomEvent("onChangeSystemRight",BX.proxy(this.onChangeRight,this))}),this)},content:[BX.create("div",{props:{className:"bx-disk-popup-content"},children:[BX.create("table",{props:{id:"bx-disk-popup-shared-people-list",className:"bx-disk-popup-shared-people-list"},children:[BX.create("thead",{html:"<tr>"+`<td class="bx-disk-popup-shared-people-list-head-col1">${BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_RIGHTS_USER")}</td>`+`<td class="bx-disk-popup-shared-people-list-head-col2">${BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_RIGHTS")}</td>`+'<td class="bx-disk-popup-shared-people-list-head-col3"></td>'+"</tr>"})]}),BX.create("div",{props:{id:"feed-add-post-destination-container",className:"feed-add-post-destination-wrap"},children:[BX.create("span",{props:{className:"feed-add-post-destination-item"}}),BX.create("span",{props:{id:"feed-add-post-destination-input-box",className:"feed-add-destination-input-box"},style:{background:"transparent"},children:[BX.create("input",{props:{type:"text",value:"",id:"feed-add-post-destination-input",className:"feed-add-destination-inp"}})]}),BX.create("a",{props:{href:"#",id:"bx-destination-tag",className:"feed-add-destination-link"},style:{background:"transparent"},text:BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_ADD_RIGHTS_USER"),events:{click:BX.delegate((()=>{}),this)}})]}),BX.create("div",{style:{marginTop:"27px",marginBottom:"20px"},html:`<div><input type="checkbox" ${o?'checked="checked"':""} id="showExtendedRights"/><label for="showExtendedRights">${BX.message("DISK_FOLDER_LIST_LABEL_SHOW_EXTENDED_RIGHTS")}</label></div>${n?`<div><input type="checkbox" id="setRightsOnPseudoSystemFolders"/><label for="setRightsOnPseudoSystemFolders">${BX.message("DISK_FOLDER_LIST_LABEL_CHANGE_SYSTEM_FOLDERS").replace("#FOLDERS#",s.systemFolders.names.join(", "))}</label></div>`:""}`})]})],buttons:[new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_LIST_BTN_SAVE"),className:"ui-btn ui-btn-success",events:{click:BX.delegate((function(){BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","saveRightsOnStorage"),data:{isChangedRights:isChangedRights?1:0,showExtendedRights:BX("showExtendedRights").checked?1:0,storageId:e,storageNewRights:storageNewRights},onsuccess:BX.delegate((e=>{if(!e){return}BX.Disk.showModalWithStatusAction(e);document.location.reload()}),this)});if(a){a.close()}}),this)}}),new BX.PopupWindowCustomButton({text:BX.message("DISK_JS_BTN_CANCEL"),className:"ui-btn ui-btn-link",events:{click(e){if(a){a.close()}}}})]})}),this)})};FolderListClass.prototype.showRightsOnObjectDetail=function(e){storageNewRights={};const t=this.storage.id;const s={};e=e||{};const i=e.object.id;BX.Disk.modalWindowLoader(BX.Disk.addToLinkParam(this.ajaxUrl,"action","showRightsOnObjectDetail"),{id:`folder_list_rights_detail_object_${i}`,responseType:"json",postData:{objectId:i,storageId:t},afterSuccessLoad:BX.delegate((function(t,o){o&&o.close();if(t.status!=="success"){t.errors=t.errors||[{}];BX.Disk.showModalWithStatusAction({status:"error",message:t.errors.pop().message});return}if(BX.Disk.isEmptyObject(moduleTasks)){moduleTasks=BX.clone(t.tasks,true);BX.Disk.setModuleTasks(moduleTasks)}for(const e in t.rights){if(!t.rights.hasOwnProperty(e)){continue}const i=t.rights[e];for(const o in i){if(!i.hasOwnProperty(o)){continue}s[e]={item:{id:e,name:showAccessCodeFullName(t.accessCodeNames[e]),avatar:null},type:"group",right:{title:i[o].TASK.TITLE,id:i[o].TASK.ID}}}}var n=BX.Disk.modalWindow({modalId:"bx-disk-detail-sharing-folder-change-right",title:BX.message("DISK_FOLDER_LIST_RIGHTS_TITLE_MODAL_WITH_NAME").replace("#OBJECT#",t.object.name),withoutWindowManager:true,contentClassName:"",contentStyle:{},events:{onAfterPopupShow:BX.delegate((function(){storageNewRights=BX.clone(s,true);originalRights=BX.clone(s,true);detachedRights={};BX.Access.Init({groups:{disabled:this.isBitrix24}});for(const e in storageNewRights){if(!storageNewRights.hasOwnProperty(e)){continue}storageNewRights[e].isBitrix24=this.isBitrix24;BX.Disk.appendSystemRight(storageNewRights[e])}BX.addCustomEvent("onChangeSystemRight",BX.proxy(this.onChangeSystemRight,this));BX.addCustomEvent("onDetachSystemRight",BX.proxy(this.onDetachSystemRight,this));BX.bind(BX("feed-add-post-destination-container"),"click",BX.delegate((function(e){const t={};for(const e in storageNewRights){if(!storageNewRights.hasOwnProperty(e)){continue}t[e]=true}BX.Access.SetSelected(t);BX.Access.ShowForm({showSelected:true,callback:BX.delegate((function(e){const t=[];for(const s in e){for(const i in e[s]){t.push(e[s][i]);this.onSelectSystemRight(e[s][i],s)}}}),this)});return BX.PreventDefault(e)}),this))}),this),onPopupClose:BX.delegate((function(){BX.removeCustomEvent("onChangeSystemRight",BX.proxy(this.onChangeRight,this))}),this)},content:[BX.create("div",{props:{className:"bx-disk-popup-content"},children:[BX.create("table",{props:{id:"bx-disk-popup-shared-people-list",className:"bx-disk-popup-shared-people-list"},children:[BX.create("thead",{html:"<tr>"+`<td class="bx-disk-popup-shared-people-list-head-col1">${BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_RIGHTS_USER")}</td>`+`<td class="bx-disk-popup-shared-people-list-head-col2">${BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_RIGHTS")}</td>`+'<td class="bx-disk-popup-shared-people-list-head-col3"></td>'+"</tr>"})]}),BX.create("div",{props:{id:"feed-add-post-destination-container",className:"feed-add-post-destination-wrap"},children:[BX.create("span",{props:{className:"feed-add-post-destination-item"}}),BX.create("span",{props:{id:"feed-add-post-destination-input-box",className:"feed-add-destination-input-box"},style:{background:"transparent"},children:[BX.create("input",{props:{type:"text",value:"",id:"feed-add-post-destination-input",className:"feed-add-destination-inp"}})]}),BX.create("a",{props:{href:"#",id:"bx-destination-tag",className:"feed-add-destination-link"},style:{background:"transparent"},text:BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_ADD_RIGHTS_USER"),events:{click:BX.delegate((()=>{}),this)}})]})]})],buttons:[new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_LIST_BTN_SAVE"),className:"ui-btn ui-btn-success",events:{click:BX.delegate((function(){BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","saveRightsOnObject"),data:{objectId:i,objectNewRights:storageNewRights,detachedRights:detachedRights},onsuccess:BX.delegate((t=>{if(!t){return}if(e.object.isFolder){t.message=BX.message("DISK_FOLDER_LIST_OK_FOLDER_RIGHTS_MODIFIED").replace("#FOLDER#",e.object.name)}else{t.message=BX.message("DISK_FOLDER_LIST_OK_FILE_RIGHTS_MODIFIED").replace("#FILE#",e.object.name)}BX.Disk.showModalWithStatusAction(t)}),this)});if(n){n.close()}}),this)}}),new BX.PopupWindowCustomButton({text:BX.message("DISK_JS_BTN_CANCEL"),className:"ui-btn ui-btn-link",events:{click(e){if(n){n.close()}}}})]})}),this)})};FolderListClass.prototype.openSlider=function(e){BX.SidePanel.Instance.open(e,{allowChangeHistory:false})};FolderListClass.prototype.showSettingsOnBizproc=function(){const e=this.storage.id;let t="";BX.Disk.modalWindowLoader(BX.Disk.addToLinkParam(this.ajaxUrl,"action","showSettingsOnBizproc"),{responseType:"json",postData:{storageId:e},afterSuccessLoad:BX.delegate((function(s){if(s.status!="success"){s.errors=s.errors||[{}];BX.Disk.showModalWithStatusAction({status:"error",message:s.errors.pop().message})}if(s.statusBizProc){t="checked"}BX.Disk.modalWindow({modalId:"bx-disk-settings-bizproc",title:BX.message("DISK_FOLDER_LIST_BIZPROC_TITLE_MODAL"),contentClassName:"",events:{},content:[BX.create("table",{html:`<tr><td><label for="activationBizProc">${BX.message("DISK_FOLDER_LIST_BIZPROC_LABEL")}</label></td>`+`<td><input type="checkbox" id="activationBizProc" ${t} /></td>`+"</tr>"})],buttons:[new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_LIST_BTN_SAVE"),className:"ui-btn ui-btn-success",events:{click:BX.delegate((function(){BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","saveSettingsOnBizproc"),data:{storageId:e,activationBizproc:BX("activationBizProc").checked?1:0},onsuccess:BX.delegate((e=>{if(!e){return}if(e.status=="success"){BX.Disk.showModalWithStatusAction(e)}else{e.errors=e.errors||[{}];BX.Disk.showModalWithStatusAction({status:"error",message:e.errors.pop().message})}location.reload()}),this)})}),this)}}),new BX.PopupWindowCustomButton({text:BX.message("DISK_JS_BTN_CANCEL"),className:"ui-btn ui-btn-link",events:{click(e){BX.PopupWindowManager.getCurrentPopup().destroy()}}})]})}),this)})};FolderListClass.prototype.openWindowForSelectDocumentService=function(){BX.Disk.InformationPopups.openWindowForSelectDocumentService({})};FolderListClass.prototype.showHiddenContent=function(e){e.style.display=e.style.display=="none"?"block":"none"};FolderListClass.prototype.hide=function(e){if(!e.getAttribute("displayOld")){e.setAttribute("displayOld",e.style.display)}e.style.display="none"};FolderListClass.prototype.showNetworkDriveConnect=function(e){e=e||{};const t=e.link;const s=this.showHiddenContent;const i=this.hide;s(BX("bx-disk-network-drive-full"));BX.Disk.modalWindow({modalId:"bx-disk-show-network-drive-connect",title:BX.message("DISK_FOLDER_LIST_PAGE_TITLE_NETWORK_DRIVE"),contentClassName:"tac",contentStyle:{},events:{onAfterPopupShow(){const e=BX("disk-get-network-drive-link");BX.focus(e);e.setSelectionRange(0,e.value.length)},onPopupClose(){i(BX("bx-disk-network-drive"));i(BX("bx-disk-network-drive-full"));document.body.appendChild(BX("bx-disk-network-drive-full"));this.destroy()}},content:[BX.create("label",{text:`${BX.message("DISK_FOLDER_LIST_PAGE_TITLE_NETWORK_DRIVE_DESCR_MODAL")} :`,props:{className:"bx-disk-popup-label",for:"disk-get-network-drive-link"}}),BX.create("input",{style:{marginTop:"10px"},props:{id:"disk-get-network-drive-link",className:"bx-disk-popup-input",type:"text",value:t}}),BX("bx-disk-network-drive-full")],buttons:[new BX.PopupWindowCustomButton({text:BX.message("DISK_JS_BTN_CLOSE"),className:"ui-btn ui-btn-link",events:{click(){BX.PopupWindowManager.getCurrentPopup().close()}}})]});if(BX("bx-disk-network-drive-secure-label")){i(BX.findChildByClassName(BX("bx-disk-show-network-drive-connect"),"bx-disk-popup-label"));i(BX.findChildByClassName(BX("bx-disk-show-network-drive-connect"),"bx-disk-popup-input"))}};FolderListClass.prototype.showSharingDetailWithSharing=function(e){entityToNewShared={};loadedReadOnlyEntityToNewShared={};e=e||{};const t=e.object.id;BX.Disk.modalWindowLoader(BX.Disk.addToLinkParam(this.ajaxUrl,"action","showSharingDetailAppendSharing"),{id:`folder_list_sharing_detail_object_${t}`,responseType:"json",postData:{objectId:t},afterSuccessLoad:BX.delegate((function(e){if(e.status!="success"){e.errors=e.errors||[{}];BX.Disk.showModalWithStatusAction({status:"error",message:e.errors.pop().message})}const s={name:e.owner.name,avatar:e.owner.avatar,link:e.owner.link};entityToNewSharedMaxTaskName=e.owner.maxTaskName;BX.Disk.modalWindow({modalId:"bx-disk-detail-sharing-folder-change-right",title:BX.message("DISK_FOLDER_LIST_SHARING_TITLE_MODAL_3"),contentClassName:"",contentStyle:{},events:{onAfterPopupShow:BX.delegate((function(){BX.addCustomEvent("onChangeRightOfSharing",BX.proxy(this.onChangeRightOfSharing,this));for(const t in e.members){if(!e.members.hasOwnProperty(t)){continue}entityToNewShared[e.members[t].entityId]={item:{id:e.members[t].entityId,name:e.members[t].name,avatar:e.members[t].avatar},type:e.members[t].type,right:e.members[t].right}}loadedReadOnlyEntityToNewShared=BX.clone(entityToNewShared,true);BX.SocNetLogDestination.init({name:this.destFormName,searchInput:BX("feed-add-post-destination-input"),bindMainPopup:{node:BX("feed-add-post-destination-container"),offsetTop:"5px",offsetLeft:"15px"},bindSearchPopup:{node:BX("feed-add-post-destination-container"),offsetTop:"5px",offsetLeft:"15px"},callback:{select:BX.proxy(this.onSelectDestination,this),unSelect:BX.proxy(this.onUnSelectDestination,this),openDialog:BX.proxy(this.onOpenDialogDestination,this),closeDialog:BX.proxy(this.onCloseDialogDestination,this),openSearch:BX.proxy(this.onOpenSearchDestination,this),closeSearch:BX.proxy(this.onCloseSearchDestination,this)},items:e.destination.items,itemsLast:e.destination.itemsLast,itemsSelected:e.destination.itemsSelected});const t=this.destFormName;BX.bind(BX("feed-add-post-destination-container"),"click",(e=>{BX.SocNetLogDestination.openDialog(t);BX.PreventDefault(e)}));BX.bind(BX("feed-add-post-destination-input"),"keyup",BX.proxy(this.onKeyUpDestination,this));BX.bind(BX("feed-add-post-destination-input"),"keydown",BX.proxy(this.onKeyDownDestination,this))}),this),onPopupClose:BX.delegate((function(){if(BX.SocNetLogDestination&&BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.closeDialog()}BX.removeCustomEvent("onChangeRightOfSharing",BX.proxy(this.onChangeRightOfSharing,this));BX.proxy_context.destroy()}),this)},content:[BX.create("div",{props:{className:"bx-disk-popup-content"},children:[BX.create("table",{props:{className:"bx-disk-popup-shared-people-list"},children:[BX.create("thead",{html:"<tr>"+`<td class="bx-disk-popup-shared-people-list-head-col1">${BX.message("DISK_FOLDER_LIST_SHARING_LABEL_OWNER")}</td>`+"</tr>"}),BX.create("tr",{html:"<tr>"+`<td class="bx-disk-popup-shared-people-list-col1" style="border-bottom: none;"><a class="bx-disk-filepage-used-people-link" href="${s.link}"><span class="bx-disk-filepage-used-people-avatar" style="background-image: url('${encodeURI(s.avatar)}');"></span>${BX.util.htmlspecialchars(s.name)}</a></td>`+"</tr>"})]}),BX.create("table",{props:{id:"bx-disk-popup-shared-people-list",className:"bx-disk-popup-shared-people-list"},children:[BX.create("thead",{html:"<tr>"+`<td class="bx-disk-popup-shared-people-list-head-col1">${BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_RIGHTS_USER")}</td>`+`<td class="bx-disk-popup-shared-people-list-head-col2">${BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_RIGHTS")}</td>`+'<td class="bx-disk-popup-shared-people-list-head-col3"></td>'+"</tr>"})]}),BX.create("div",{props:{id:"feed-add-post-destination-container",className:"feed-add-post-destination-wrap"},children:[BX.create("span",{props:{className:"feed-add-post-destination-item"}}),BX.create("span",{props:{id:"feed-add-post-destination-input-box",className:"feed-add-destination-input-box"},style:{background:"transparent"},children:[BX.create("input",{props:{type:"text",value:"",id:"feed-add-post-destination-input",className:"feed-add-destination-inp"}})]}),BX.create("a",{props:{href:"#",id:"bx-destination-tag",className:"feed-add-destination-link"},style:{background:"transparent"},text:BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_ADD_RIGHTS_USER"),events:{click:BX.delegate((()=>{}),this)}})]})]})],buttons:[new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_LIST_BTN_SAVE"),className:"ui-btn ui-btn-success",events:{click:BX.delegate((function(){BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","appendSharing"),data:{objectId:t,entityToNewShared:entityToNewShared},onsuccess:BX.delegate((function(e){if(!e){return}BX.Disk.showModalWithStatusAction(e);const s=BX.delegate(getIconElementByObjectId,this)(t);if(s){if(!entityToNewShared||BX.Disk.isEmptyObject(entityToNewShared)){BX.removeClass(s,"icon-shared icon-shared_2 shared");BX.removeClass(s,"icon-shared_1")}else{BX.addClass(s,"icon-shared icon-shared_2 shared")}}}),this)});BX.PopupWindowManager.getCurrentPopup().close()}),this)}}),new BX.PopupWindowCustomButton({text:BX.message("DISK_JS_BTN_CANCEL"),className:"ui-btn ui-btn-link",events:{click(e){BX.PopupWindowManager.getCurrentPopup().destroy()}}})]})}),this)})};FolderListClass.prototype.onCreateExtendedFolder=function(){this.showCreateFolderWithSharing({})};FolderListClass.prototype.showCreateFolderWithSharing=function(){entityToNewShared={};storageNewRights={};const e=this.storage.id;const t={};BX.Disk.modalWindowLoader(BX.Disk.addToLinkParam(this.ajaxUrl,"action","showCreateFolderWithSharingInCommon"),{id:`folder_list_rights_detail_storage_${e}`,responseType:"json",postData:{storageId:e},afterSuccessLoad:BX.delegate((function(s){if(s.status!="success"){s.errors=s.errors||[{}];BX.Disk.showModalWithStatusAction({status:"error",message:s.errors.pop().message})}if(BX.Disk.isEmptyObject(moduleTasks)){moduleTasks=BX.clone(s.tasks,true);BX.Disk.setModuleTasks(moduleTasks)}for(const e in s.rights){if(!s.rights.hasOwnProperty(e)){continue}const i=s.rights[e];for(const o in i){if(!i.hasOwnProperty(o)){continue}t[e]={detachOnly:true,item:{id:e,name:s.accessCodeNames[e].name,avatar:null},type:"group",right:{title:i[o].TASK.TITLE,id:i[o].TASK.ID}}}}BX.Disk.modalWindow({modalId:"bx-disk-detail-sharing-create-folder",title:BX.message("DISK_FOLDER_LIST_CREATE_FOLDER_MODAL"),contentClassName:"",contentStyle:{},events:{onAfterPopupShow:BX.delegate((function(){BX.focus(BX("disk-new-create-filename"));storageNewRights=BX.clone(t,true);for(const e in t){if(!t.hasOwnProperty(e)){continue}BX.Disk.appendRight(t[e])}BX.addCustomEvent("onChangeRightOfSharing",BX.proxy(this.onChangeRightOfSharing,this));BX.addCustomEvent("onChangeRight",BX.proxy(this.onChangeRight,this));BX.addCustomEvent("onDetachRight",BX.proxy(this.onDetachRight,this));BX.SocNetLogDestination.init({name:this.destFormName,searchInput:BX("feed-add-post-destination-input"),bindMainPopup:{node:BX("feed-add-post-destination-container"),offsetTop:"5px",offsetLeft:"15px"},bindSearchPopup:{node:BX("feed-add-post-destination-container"),offsetTop:"5px",offsetLeft:"15px"},callback:{select:BX.proxy(this.onSelectDestination,this),unSelect:BX.proxy(this.onUnSelectDestination,this),openDialog:BX.proxy(this.onOpenDialogDestination,this),closeDialog:BX.proxy(this.onCloseDialogDestination,this),openSearch:BX.proxy(this.onOpenSearchDestination,this),closeSearch:BX.proxy(this.onCloseSearchDestination,this)},items:s.destination.items,itemsLast:s.destination.itemsLast,itemsSelected:s.destination.itemsSelected});const e=this.destFormName;BX.bind(BX("feed-add-post-destination-container"),"click",(t=>{BX.SocNetLogDestination.openDialog(e);BX.PreventDefault(t)}));BX.bind(BX("feed-add-post-destination-input"),"keyup",BX.proxy(this.onKeyUpDestination,this));BX.bind(BX("feed-add-post-destination-input"),"keydown",BX.proxy(this.onKeyDownDestination,this))}),this),onPopupClose:BX.delegate((function(){if(BX.SocNetLogDestination&&BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.closeDialog()}BX.removeCustomEvent("onChangeRight",BX.proxy(this.onChangeRight,this));BX.proxy_context.destroy()}),this)},content:[BX.create("div",{props:{className:"bx-disk-popup-content-small"},children:[BX.create("label",{props:{className:"bx-disk-popup-label",for:"disk-new-create-filename"},children:[BX.create("span",{props:{className:"req"},text:"*"}),BX.message("DISK_FOLDER_LIST_LABEL_NAME_CREATE_FOLDER")]}),BX.create("input",{props:{id:"disk-new-create-filename",className:"bx-disk-popup-input",type:"text",value:""},style:{fontSize:"16px",marginTop:"10px"}})]}),BX.create("div",{props:{className:"bx-disk-popup-content"},children:[BX.create("table",{props:{id:"bx-disk-popup-shared-people-list",className:"bx-disk-popup-shared-people-list"},children:[BX.create("thead",{html:"<tr>"+`<td class="bx-disk-popup-shared-people-list-head-col1">${BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_RIGHTS_USER")}</td>`+`<td class="bx-disk-popup-shared-people-list-head-col2">${BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_RIGHTS")}</td>`+'<td class="bx-disk-popup-shared-people-list-head-col3"></td>'+"</tr>"})]}),BX.create("div",{props:{id:"feed-add-post-destination-container",className:"feed-add-post-destination-wrap"},children:[BX.create("span",{props:{className:"feed-add-post-destination-item"}}),BX.create("span",{props:{id:"feed-add-post-destination-input-box",className:"feed-add-destination-input-box"},style:{background:"transparent"},children:[BX.create("input",{props:{type:"text",value:"",id:"feed-add-post-destination-input",className:"feed-add-destination-inp"}})]}),BX.create("a",{props:{href:"#",id:"bx-destination-tag",className:"feed-add-destination-link"},style:{background:"transparent"},text:BX.message("DISK_FOLDER_LIST_SHARING_LABEL_NAME_ADD_RIGHTS_USER"),events:{click:BX.delegate((()=>{}),this)}})]})]})],buttons:[new BX.PopupWindowCustomButton({text:BX.message("DISK_FOLDER_LIST_BTN_SAVE"),className:"ui-btn ui-btn-success",events:{click:BX.delegate((function(){const t=BX("disk-new-create-filename").value;if(!t){BX.focus(BX("disk-new-create-filename"));return}BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","createFolderWithSharing"),data:{name:t,storageId:e,storageNewRights:storageNewRights||{},entityToNewShared:entityToNewShared||{}},onsuccess:BX.delegate((e=>{if(!e){return}BX.Disk.showModalWithStatusAction(e);if(e.status&&e.status=="success"){window.document.location=BX.Disk.getUrlToShowObjectInGrid(e.folder.id)}}),this)});BX.PopupWindowManager.getCurrentPopup().close()}),this)}}),new BX.PopupWindowCustomButton({text:BX.message("DISK_JS_BTN_CANCEL"),className:"ui-btn ui-btn-link",events:{click(e){BX.PopupWindowManager.getCurrentPopup().destroy()}}})]})}),this)})};FolderListClass.prototype.onSelectSystemRight=function(e,t){storageNewRights[e.id]=storageNewRights[e.id]||{};isChangedRights=true;const s=BX.Access.GetProviderPrefix(t,e.id);storageNewRights[e.id]={item:{avatar:null,id:e.id,name:(s?`${s}: `:"")+e.name},type:"user",right:"read"};storageNewRights[e.id].isBitrix24=this.isBitrix24;BX.Disk.appendSystemRight(storageNewRights[e.id])};FolderListClass.prototype.onSelectRightDestination=function(e,t,s){storageNewRights[e.id]=storageNewRights[e.id]||{};storageNewRights[e.id]={item:e,type:t,right:storageNewRights[e.id].right||{}};BX.Disk.appendRight({destFormName:this.destFormName,item:e,type:t,right:storageNewRights[e.id].right})};FolderListClass.prototype.onUnSelectRightDestination=function(e,t,s){const i=e.id;delete storageNewRights[i];const o=BX.findChild(BX("bx-disk-popup-shared-people-list"),{attribute:{"data-dest-id":`${String(i)}`}},true);if(o){BX.remove(o)}};FolderListClass.prototype.onChangeSystemRight=function(e,t){if(storageNewRights[e]){isChangedRights=true;storageNewRights[e].right={id:t.ID,title:t.TITLE}}};FolderListClass.prototype.onDetachSystemRight=function(e){if(storageNewRights[e]){isChangedRights=true;BX.Access.DeleteSelected(e);detachedRights[e]=storageNewRights[e];delete storageNewRights[e]}};FolderListClass.prototype.onChangeRight=function(e,t){if(storageNewRights[e]){storageNewRights[e].right={id:t.ID,title:t.TITLE}}};FolderListClass.prototype.onDetachRight=function(e){if(storageNewRights[e]){delete storageNewRights[e]}};FolderListClass.prototype.onSelectDestination=function(e,t,s){entityToNewShared[e.id]=entityToNewShared[e.id]||{};BX.Disk.appendNewShared({maxTaskName:entityToNewSharedMaxTaskName,readOnly:Boolean(loadedReadOnlyEntityToNewShared[e.id]),destFormName:this.destFormName,item:e,type:t,right:entityToNewShared[e.id].right});entityToNewShared[e.id]={item:e,type:t,right:entityToNewShared[e.id].right||"disk_access_read"}};FolderListClass.prototype.onUnSelectDestination=function(e,t,s){const i=e.id;if(loadedReadOnlyEntityToNewShared[i]){return false}delete entityToNewShared[i];const o=BX.findChild(BX("bx-disk-popup-shared-people-list"),{attribute:{"data-dest-id":`${String(i)}`}},true);if(o){BX.remove(o)}};FolderListClass.prototype.onChangeRightOfSharing=function(e,t){if(entityToNewShared[e]){entityToNewShared[e].right=t}};FolderListClass.prototype.onOpenDialogDestination=function(){BX.style(BX("feed-add-post-destination-input-box"),"display","inline-block");BX.style(BX("bx-destination-tag"),"display","none");BX.focus(BX("feed-add-post-destination-input"));if(BX.SocNetLogDestination.popupWindow){BX.SocNetLogDestination.popupWindow.adjustPosition({forceTop:true})}};FolderListClass.prototype.onCloseDialogDestination=function(){const e=BX("feed-add-post-destination-input");if(!BX.SocNetLogDestination.isOpenSearch()&&e&&e.value.length<=0){BX.style(BX("feed-add-post-destination-input-box"),"display","none");BX.style(BX("bx-destination-tag"),"display","inline-block")}};FolderListClass.prototype.onOpenSearchDestination=function(){if(BX.SocNetLogDestination.popupSearchWindow){BX.SocNetLogDestination.popupSearchWindow.adjustPosition({forceTop:true})}};FolderListClass.prototype.onCloseSearchDestination=function(){const e=BX("feed-add-post-destination-input");if(!BX.SocNetLogDestination.isOpenSearch()&&e&&e.value.length>0){BX.style(BX("feed-add-post-destination-input-box"),"display","none");BX.style(BX("bx-destination-tag"),"display","inline-block");BX("feed-add-post-destination-input").value=""}};FolderListClass.prototype.onKeyDownDestination=function(e){const t=this.destFormName;if(e.keyCode==8&&BX("feed-add-post-destination-input").value.length<=0){BX.SocNetLogDestination.sendEvent=false;BX.SocNetLogDestination.deleteLastItem(t)}return true};FolderListClass.prototype.onKeyUpDestination=function(e){const t=this.destFormName;if(e.keyCode==16||e.keyCode==17||e.keyCode==18||e.keyCode==20||e.keyCode==244||e.keyCode==224||e.keyCode==91){return false}if(e.keyCode==13){BX.SocNetLogDestination.selectFirstSearchItem(t);return BX.PreventDefault(e)}if(e.keyCode==27){BX("feed-add-post-destination-input").value=""}else{BX.SocNetLogDestination.search(BX("feed-add-post-destination-input").value,true,t)}if(BX.SocNetLogDestination.sendEvent&&BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.closeDialog()}if(e.keyCode==8){BX.SocNetLogDestination.sendEvent=true}return BX.PreventDefault(e)};FolderListClass.prototype.showSearchProcessInConnectedFolders=function(){if(this.layout.loader){return}this.layout.loader=BX.create("div",{props:{className:"bx-disk-interface-filelist-loader"},children:[BX.create("div",{props:{className:"bx-disk-interface-filelist-loader-wrapper"},children:[this.layout.loaderWrapper=BX.create("div",{props:{className:"bx-disk-interface-filelist-loader-container"}}),BX.create("div",{props:{className:"bx-disk-interface-filelist-loader-text"},text:BX.message("DISK_FOLDER_LIST_SEARCH_PROGRESS_LABEL")})]})]});const e=new BX.Loader({size:170});e.show(this.layout.loaderWrapper);if(this.commonGrid.isGrid()){document.querySelector(".main-grid-wrapper").appendChild(this.layout.loader)}else if(this.commonGrid.isTile()){this.commonGrid.getContainer().parentNode.appendChild(this.layout.loader)}};FolderListClass.prototype.removeSearchProcessInConnectedFolders=function(){if(!this.layout.loader){return}this.layout.loader.parentNode.removeChild(this.layout.loader);this.layout.loader=null};return FolderListClass}();(function(){"use strict";BX.namespace("BX.Disk.Model.FolderList");BX.Disk.Model.FolderList.SearchProgress=function(e){BX.Disk.Model.Item.apply(this,arguments);this.templateId="search-progress"};BX.Disk.Model.FolderList.SearchProgress.prototype={__proto__:BX.Disk.Model.Item.prototype,constructor:BX.Disk.Model.FolderList.SearchProgress,isTimeToShow(){return this.state.total>0&&this.state.total!==this.state.current},getDefaultStateValues(){return{isTimeToShow:this.isTimeToShow.bind(this)}}};BX.Disk.Model.FolderList.CommonGrid=function(e){this.instance=e.instance};BX.Disk.Model.FolderList.CommonGrid.prototype={constructor:BX.Disk.Model.FolderList.CommonGrid,getId(){return this.instance.getId()},isGrid(){return!this.isTile()},isTile(){return BX.TileGrid.Grid&&this.instance instanceof BX.TileGrid.Grid},getContainer(){return this.instance.getContainer()},fade(){if(this.isGrid()){this.instance.tableFade()}else{this.instance.setFadeContainer();this.instance.getLoader();this.instance.showLoader()}},unFade(){if(this.isGrid()){this.instance.tableUnfade()}else{this.instance.getLoader().hide();this.instance.unSetFadeContainer()}},getActionKey(){return`action_button_${this.instance.getId()}`},getSelectedIds(){if(this.isGrid()){return this.instance.getRows().getSelectedIds()}return this.instance.getSelectedItems().map((e=>e.getId()))},getIds(){if(this.isGrid()){return this.instance.getRows().getBodyChild().map((e=>e.getId()))}return this.instance.items.map((e=>e.id))},countItems(){if(this.isGrid()){return this.instance.getRows().getBodyChild().length}return this.instance.countItems()},reload(e,t){t=t||{};if(this.isGrid()){const s=new BX.Promise;this.instance.reloadTable("POST",t,(()=>{s.fulfill()}),e);return s}return this.instance.reload(e,t)},getActionsMenu(e){if(this.isGrid()){return this.instance.getRows().getById(e).getActionsMenu()}const t=this.instance.getItem(e);if(t){return t.getActionsMenu()}},getItemById(e){if(this.isGrid()){return this.instance.getRows().getById(e)}return this.instance.getItem(e)},scrollTo(e){let t;if(this.isGrid()){var s=this.instance.getRows().getById(e);if(s&&s.node){t=s.node}}else{const i=this.instance.getItem(e);if(s&&s.node){t=s.getContainer()}}if(t){new BX.easing({duration:500,start:{scroll:window.pageYOffset||document.documentElement.scrollTop},finish:{scroll:BX.pos(t).top},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step(e){window.scrollTo(0,e.scroll)}}).animate()}},getActionById(e,t){const s=this.getItemById(e);if(!s){return null}const i=s.getActions()||[];for(const e of i){if(e.id&&e.id===t){return e}}return null},removeItemById(e){BX.fireEvent(document.body,"click");if(this.isGrid()){this.instance.removeRow(e)}else{const t=this.instance.getItem(e);if(t){this.instance.removeItem(t)}}},selectItemById(e){let t;if(this.isGrid()){t=this.instance.getRows().getById(e);if(t){t.select()}}else{t=this.instance.getItem(e);if(t){this.instance.selectItem(t)}}},removeSelected(){if(this.isGrid()){this.instance.removeSelected()}else{}},sortByColumn(e){this.instance.sortByColumn(e)}};BX.namespace("BX.Disk.TileGrid");BX.Disk.TileGrid.Item=function(e){BX.TileGrid.Item.apply(this,arguments);this.isDraggable=e.isDraggable;this.isDroppable=e.isDroppable;this.dblClickDelay=0;this.title=e.name;this.isFolder=e.isFolder;this.isFile=e.isFile;this.canAdd=e.canAdd;this.isLocked=e.isLocked;this.isSymlink=e.isSymlink;this.image=e.image;this.actions=e.actions;this.link=e.link;this.attributes=e.attributes;this.item={container:null,action:null,title:null,titleWrapper:null,titleLink:null,titleInput:null,lock:null,symlink:null,imageBlock:null,picture:null,fileType:null,icons:null};this.actionsMenu=null;this.imageItemHandler=null;BX.addCustomEvent(window,"TileGrid.Grid:onItemDragStart",(()=>{if(this.actionsMenu){this.actionsMenu.popupWindow.close()}}))};BX.Disk.TileGrid.Item.prototype={__proto__:BX.TileGrid.Item.prototype,constructor:BX.TileGrid.Item,handleDblClick(){BX.onCustomEvent("Disk.TileItem.Item:onItemDblClick",[this])},handleEnter(){BX.onCustomEvent("Disk.TileItem.Item:onItemEnter",[this])},getContent(){this.item.container=BX.create("div",{attrs:{className:this.isFile?"disk-folder-list-item":"disk-folder-list-item disk-folder-list-item-folder"},children:[this.getImage(),this.getActionBlock(),BX.create("div",{props:{className:!this.getLocked()&&!this.getSymlink()?"disk-folder-list-item-bottom disk-folder-list-item-bottom-without-icons":"disk-folder-list-item-bottom"},children:[this.getTitle(),this.getIconsContainer()]})],events:{contextmenu:function(e){if(e.ctrlKey){return}this.showActionsMenu(e);this.gridTile.resetSelection();this.gridTile.selectItem(this);e.preventDefault()}.bind(this)}});if(this.image){this.imageItemHandler=BX.throttle(this.appendImageItem,20,this);BX.bind(window,"resize",this.imageItemHandler);BX.bind(window,"scroll",this.imageItemHandler)}return this.item.container},appendImageItem(){if(this.isVisibleOnFolderList()){this.item.picture.setAttribute("src",this.image);BX.bind(this.item.container,"animationend",BX.proxy(this.appendImageItem,this));BX.unbind(this.item.container,"animationend",BX.proxy(this.appendImageItem,this));BX.unbind(window,"resize",this.imageItemHandler);BX.unbind(window,"scroll",this.imageItemHandler)}},lock(){this.item.lock.style.display=null},unlock(){this.item.lock.style.display="none"},getIconsContainer(){this.item.icons=BX.create("div",{props:{className:"disk-folder-list-item-icons"},children:[this.getLocked(),this.getSymlink()]});return this.item.icons},getLocked(){this.item.lock=BX.create("div",{attrs:{className:"disk-folder-list-item-locked"},style:{display:this.isLocked?null:"none"}});return this.item.lock},getSymlink(){this.item.symlink=BX.create("div",{attrs:{className:"disk-folder-list-item-shared"},style:{display:this.isSymlink?null:"none"}});return this.item.symlink},getTitle(){return this.item.title=BX.create("div",{props:{className:"disk-folder-list-item-title"},children:[this.item.titleWrapper=BX.create("div",{props:{className:"disk-folder-list-item-title-wrapper"},children:[this.getTitleInput(),this.item.titleLink=BX.create("a",{attrs:{className:"disk-folder-list-item-title-link",href:this.link,title:this.title,id:`disk_obj_${this.id}`},events:{click:this.handleTitleClick.bind(this)},text:this.title,dataset:BX.mergeEx({objectId:this.id,canAdd:this.canAdd},this.attributes)})]})]})},handleTitleClick(e){BX.onCustomEvent("Disk.TileItem.Item:onTitleClick",[this,e])},getTitleInput(){this.item.titleInput=BX.create("input",{attrs:{className:"disk-folder-list-item-title-input",type:"text",value:this.title}});BX.bind(this.item.titleInput,"click",(e=>{e.stopPropagation()}));BX.addCustomEvent(window,"BX.TileGrid.Grid:resetSelectAllItems",this.cancelRenaming.bind(this));BX.addCustomEvent(window,"BX.TileGrid.Grid:selectItem",this.cancelRenaming.bind(this));BX.bind(this.item.titleInput,"keydown",(e=>{if(e.key==="Escape"){this.cancelRenaming();e.preventDefault()}if(e.key==="Enter"){this.cancelRenaming();this.runRename();e.preventDefault()}e.stopPropagation()}));BX.bind(this.item.titleInput,"blur",(e=>{this.cancelRenaming();this.runRename()}));return this.item.titleInput},onRename(){this.gridTile.resetSelection();jsDD.Disable();this.item.titleInput.value=this.title;BX.addClass(this.item.title,"disk-folder-list-item-title-rename");this.item.titleInput.focus();if(this.isFile){this.item.titleInput.setSelectionRange(0,this.title.lastIndexOf("."))}else{this.item.titleInput.select()}},cancelRenaming(){BX.removeClass(this.item.title,"disk-folder-list-item-title-rename");this.item.titleInput.blur();jsDD.Enable()},rename(e){BX.addClass(this.item.titleLink,"disk-folder-list-item-title-link-renamed");this.item.titleLink.addEventListener("animationend",(()=>{BX.removeClass(this.item.titleLink,"disk-folder-list-item-title-link-renamed")}));this.item.titleLink.textContent=e;this.item.titleLink.setAttribute("title",e);this.title=e;this.rebuildLinkAfterRename(e);jsDD.Enable()},rebuildLinkAfterRename(e){if(this.link){if(this.isFile){this.link=this.link.slice(0,Math.max(0,this.link.lastIndexOf("/")+1))+encodeURIComponent(e)}else{this.link=`${this.link.slice(0,Math.max(0,this.link.lastIndexOf("/",this.link.length-2)+1))+encodeURIComponent(e)}/`}this.item.titleLink.href=this.link;this.actions.forEach((function(e){if(e.id==="open"&&e.href){e.href=this.link}}),this)}this.destroyActionsMenu()},runRename(){if(this.item.titleInput.value===this.title){return}const e=this.title;this.rename(this.item.titleInput.value);BX.ajax.runAction("disk.api.commonActions.rename",{analyticsLabel:"folder.list",data:{objectId:this.getId(),newName:this.title,autoCorrect:true}}).then((e=>{if(e.data.object.name!==this.title){this.rename(e.data.object.name)}})).catch((t=>{BX.Disk.showModalWithStatusAction(t);this.rename(e)}))},afterRender(){if(!this.item.picture){return}if(this.isVisibleOnFolderList()){this.appendImageItem()}BX.bind(this.item.container,"animationend",BX.proxy(this.appendImageItem,this));this.item.picture.onload=function(){BX.show(this.item.picture);BX.hide(this.item.fileType)}.bind(this)},isVisibleOnFolderList(){const e=this.layout.container.getBoundingClientRect();const t=document.body.getBoundingClientRect();const s=this.layout.container.offsetHeight*2;if(e.top<0||e.bottom<0){return false}return t.height>e.top-s&&t.height>=e.bottom-s},getImage(){const e=this.getFileExtension(this.title);this.item.imageBlock=BX.create("div",{attrs:{className:"disk-folder-list-item-image"},children:[this.item.fileType=BX.create("div",{attrs:{className:`ui-icon ui-icon-file ui-icon-file-${e}`},style:{width:this.isFolder?"85%":"70%"},html:"<i></i>"}),this.item.picture=this.image?BX.create("img",{attrs:{className:"disk-folder-list-item-image-img"},style:{display:"none"}}):null]});return this.item.imageBlock},markAsShared(){this.isSymlink=true;if(this.isFolder){this.item.fileType.classList.add("ui-icon-file-folder-shared")}else if(this.item.symlink){this.item.symlink.style.display=null}},unmarkAsShared(){this.isSymlink=false;if(this.isFolder){this.item.fileType.classList.remove("ui-icon-file-folder-shared")}else if(this.item.symlink){this.item.symlink.style.display="none"}},getFileExtension(e){let t=e.slice(Math.max(0,e.lastIndexOf(".")+1));switch(t){case"mp4":case"mkv":case"mpeg":case"avi":case"3gp":case"flv":case"m4v":case"ogg":case"swf":case"wmv":t="mov";break;case"txt":t="txt";break;case"doc":case"docx":t="doc";break;case"xls":case"xlsx":t="xls";break;case"php":t="php";break;case"pdf":t="pdf";break;case"ppt":case"pptx":t="ppt";break;case"rar":t="rar";break;case"zip":t="zip";break;case"set":t="set";break;case"mov":t="mov";break;case"img":case"jpg":case"jpeg":case"gif":t="img";break;case"flp":case"board":t="board";break;case"odf":t="odf";break;case"odt":t="odt";break;case"ods":t="ods";break;case"odp":t="odp";break;default:t="empty"}this.isFolder?t="folder":null;this.isSymlink&&this.isFolder?t="folder-shared":null;return t},getActionBlock(){if(!this.item.action){this.item.action=BX.create("div",{attrs:{className:"disk-folder-list-item-action"},events:{click:function(e){this.showActionsMenu(e,BX.getEventTarget(e))}.bind(this)}})}return this.item.action},getActions(){return this.actions},destroyActionsMenu(){if(this.actionsMenu){this.actionsMenu.destroy();this.actionsMenu=null}},getActionsMenu(e){if(this.actionsMenu){return this.actionsMenu}this.actionsMenu=BX.PopupMenu.create(`-disk-folder-list-item-action-menu${this.getId()}`,e,this.actions,{autoHide:true,offsetLeft:20,angle:true});BX.bind(this.actionsMenu.popupWindow.popupContainer,"click",(e=>{const t=this.getActionsMenu();if(t){const s=BX.getEventTarget(e);const i=BX.findParent(s,{className:"menu-popup-item"},10);if(!i||!i.dataset.preventCloseContextMenu){t.close()}}}));return this.actionsMenu},showActionsMenu(e,t){BX.fireEvent(document.body,"click");const s=this.getActionsMenu(t);s.show();if(!t){s.popupWindow.popupContainer.style.top=`${e.pageY}px`;s.popupWindow.popupContainer.style.left=`${e.pageX-35}px`}else if(t){const e=BX.pos(t);e.forceBindPosition=true;s.popupWindow.setBindElement(t);s.popupWindow.adjustPosition(e)}}}})();
//# sourceMappingURL=script.map.js