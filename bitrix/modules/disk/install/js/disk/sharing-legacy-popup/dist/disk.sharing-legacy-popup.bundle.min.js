this.BX=this.BX||{};this.BX.Disk=this.BX.Disk||{};(function(e,t,n){"use strict";var i,a;var o=function(){function e(){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"userBoxNode",null);babelHelpers.defineProperty(this,"isChangedRights",false);babelHelpers.defineProperty(this,"storageNewRights",{});babelHelpers.defineProperty(this,"originalRights",{});babelHelpers.defineProperty(this,"detachedRights",{});babelHelpers.defineProperty(this,"moduleTasks",{});babelHelpers.defineProperty(this,"entityToNewShared",{});babelHelpers.defineProperty(this,"loadedReadOnlyEntityToNewShared",{});babelHelpers.defineProperty(this,"entityToNewSharedMaxTaskName","");babelHelpers.defineProperty(this,"ajaxUrl","/bitrix/components/bitrix/disk.folder.list/ajax.php");babelHelpers.defineProperty(this,"destFormName","folder-list-destFormName")}babelHelpers.createClass(e,[{key:"showSharingDetailWithChangeRights",value:function e(o){var s=this;this.entityToNewShared={};this.loadedReadOnlyEntityToNewShared={};o=o||{};var d=o.object.id;BX.Disk.modalWindowLoader(BX.Disk.addToLinkParam(this.ajaxUrl,"action","showSharingDetailChangeRights"),{id:"folder_list_sharing_detail_object_".concat(d),responseType:"json",postData:{objectId:d},afterSuccessLoad:function e(r){if(r.status!=="success"){r.errors=r.errors||[{}];BX.Disk.showModalWithStatusAction({status:"error",message:r.errors.pop().message})}if(r.unifiedLink){var p=r.unifiedLink.availableAccessLevels.find((function(e){return e.value===r.unifiedLink.currentAccessLevel}));var l=t.Tag.render(i||(i=babelHelpers.taggedTemplateLiteral(['<span class="bx-disk-filepage-used-people-permission">',"</span>"])),p.name);t.Event.bind(l,"click",(function(e){var t="access-level-menu";var n=r.unifiedLink.availableAccessLevels.map((function(e){return{id:e.value,text:e.name,onclick:function n(){l.textContent=e.name;if(s.entityToNewShared.unifiedLink.currentAccessLevel!==e.value){s.entityToNewShared.unifiedLink.newAccessLevel=e.value}BX.PopupMenu.destroy(t)}}}));BX.PopupMenu.show(t,e.target,n,{autoHide:true,offsetTop:0,offsetLeft:0,angle:{position:"top",offset:45},overlay:{opacity:.01},events:{onPopupClose:function e(){BX.PopupMenu.destroy(t)}}})}));var c=t.Tag.render(a||(a=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t<table class="bx-disk-popup-shared-people-list" id="bx-disk-popup-shared-universal-list">\n\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t<td class="bx-disk-popup-shared-people-list-head-col1"></td>\n\t\t\t\t\t\t\t\t\t<td class="bx-disk-popup-shared-people-list-head-col2">','</td>\n\t\t\t\t\t\t\t\t\t<td class="bx-disk-popup-shared-people-list-head-col3"></td>\n\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t<td class="bx-disk-popup-shared-people-list-head-col1">\n\t\t\t\t\t\t\t\t\t\t<span href="" class="bx-disk-filepage-used-people-link">\n\t\t\t\t\t\t\t\t\t\t\t<span class="bx-disk-filepage-used-people-avatar link" style="--ui-icon-set__icon-size: 15px;"></span>\n\t\t\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t<td class="bx-disk-popup-shared-people-list-head-col2">\n\t\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t<td class="bx-disk-popup-shared-people-list-head-col3"></td>\n\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t'])),t.Loc.getMessage("JS_DISK_SHARING_LEGACY_POPUP_SHARING_LABEL_NAME_RIGHTS"),t.Loc.getMessage("JS_DISK_SHARING_LEGACY_POPUP_UNIFIED_RIGHT_USERS"),l)}var h={name:r.owner.name,avatar:r.owner.avatar,link:r.owner.link};BX.Disk.modalWindow({modalId:"bx-disk-detail-sharing-folder-change-right",title:BX.message("JS_DISK_SHARING_LEGACY_POPUP_TITLE_MODAL_3"),contentClassName:"",contentStyle:{},events:{onAfterPopupShow:function e(){BX.addCustomEvent("onChangeRightOfSharing",s.onChangeRightOfSharing.bind(s));for(var t in r.members){if(!r.members.hasOwnProperty(t)){continue}s.entityToNewShared[r.members[t].entityId]={item:{id:r.members[t].entityId,name:r.members[t].name,avatar:r.members[t].avatar},type:r.members[t].type,right:r.members[t].right}}if(r.unifiedLink){s.entityToNewShared.unifiedLink=r.unifiedLink}BX.SocNetLogDestination.init({name:s.destFormName,searchInput:BX("feed-add-post-destination-input"),bindMainPopup:{node:BX("feed-add-post-destination-container"),offsetTop:"5px",offsetLeft:"15px"},bindSearchPopup:{node:BX("feed-add-post-destination-container"),offsetTop:"5px",offsetLeft:"15px"},callback:{select:s.onSelectDestination.bind(s),unSelect:s.onUnSelectDestination.bind(s),openDialog:s.onOpenDialogDestination.bind(s),closeDialog:s.onCloseDialogDestination.bind(s),openSearch:s.onOpenSearchDestination.bind(s),closeSearch:s.onCloseSearchDestination.bind(s)},items:r.destination.items,itemsLast:r.destination.itemsLast,itemsSelected:r.destination.itemsSelected});var n=s.destFormName;BX.bind(BX("feed-add-post-destination-container"),"click",(function(e){BX.SocNetLogDestination.openDialog(n);BX.PreventDefault(e)}));BX.bind(BX("feed-add-post-destination-input"),"keyup",s.onKeyUpDestination.bind(s));BX.bind(BX("feed-add-post-destination-input"),"keydown",s.onKeyDownDestination.bind(s))},onPopupClose:function e(){if(BX.SocNetLogDestination&&BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.closeDialog()}BX.removeCustomEvent("onChangeRightOfSharing",s.onChangeRightOfSharing.bind(s))}},content:[BX.create("div",{props:{className:"bx-disk-popup-content"},children:[BX.create("table",{props:{className:"bx-disk-popup-shared-people-list"},children:[BX.create("thead",{html:"<tr>"+'<td class="bx-disk-popup-shared-people-list-head-col1">'.concat(BX.message("JS_DISK_SHARING_LEGACY_POPUP_LABEL_OWNER"),"</td>")+"</tr>"}),BX.create("tr",{html:"<tr>"+'<td class="bx-disk-popup-shared-people-list-col1" style="border-bottom: none;"><a class="bx-disk-filepage-used-people-link" href="'.concat(h.link,'"><span class="bx-disk-filepage-used-people-avatar" style="background-image: url(\'').concat(encodeURI(h.avatar),"');\"></span>").concat(t.Text.encode(h.name),"</a></td>")+"</tr>"})]}),c,BX.create("table",{props:{id:"bx-disk-popup-shared-people-list",className:"bx-disk-popup-shared-people-list"},children:[BX.create("thead",{html:"<tr>"+'<td class="bx-disk-popup-shared-people-list-head-col1">'.concat(BX.message("JS_DISK_SHARING_LEGACY_POPUP_LABEL_NAME_RIGHTS_USER"),"</td>")+'<td class="bx-disk-popup-shared-people-list-head-col2">'.concat(BX.message("JS_DISK_SHARING_LEGACY_POPUP_LABEL_NAME_RIGHTS"),"</td>")+'<td class="bx-disk-popup-shared-people-list-head-col3"></td>'+"</tr>"})]}),BX.create("div",{props:{id:"feed-add-post-destination-container",className:"feed-add-post-destination-wrap"},children:[BX.create("span",{props:{className:"feed-add-post-destination-item"}}),BX.create("span",{props:{id:"feed-add-post-destination-input-box",className:"feed-add-destination-input-box"},style:{background:"transparent"},children:[BX.create("input",{props:{type:"text",value:"",id:"feed-add-post-destination-input",className:"feed-add-destination-inp"}})]}),BX.create("a",{props:{href:"#",id:"bx-destination-tag",className:"feed-add-destination-link"},style:{background:"transparent"},text:BX.message("JS_DISK_SHARING_LEGACY_POPUP_LABEL_NAME_ADD_RIGHTS_USER"),events:{click:function e(){}}})]})]})],buttons:[new n.SaveButton({events:{click:function e(){BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(s.ajaxUrl,"action","changeSharingAndRights"),data:{objectId:d,entityToNewShared:s.entityToNewShared},onsuccess:function e(t){if(!t){return}var n=o.object.name.split(".");var i=n.pop().toLowerCase();n=n.join(".");if(n&&i==="board"){t.message=BX.message("JS_DISK_SHARING_LEGACY_POPUP_OK_BOARD_SHARE_MODIFIED").replace("#FILE#",n)}else{t.message=BX.message("JS_DISK_SHARING_LEGACY_POPUP_OK_FILE_SHARE_MODIFIED").replace("#FILE#",o.object.name)}BX.Disk.showModalWithStatusAction(t)}});BX.PopupWindowManager.getCurrentPopup().close()}}}),new BX.UI.CloseButton({events:{click:function e(){BX.PopupWindowManager.getCurrentPopup().close()}}})]})}})}},{key:"showSharingDetailWithSharing",value:function e(i){var a=this;this.entityToNewShared={};this.loadedReadOnlyEntityToNewShared={};i=i||{};var o=i.object.id;BX.Disk.modalWindowLoader(BX.Disk.addToLinkParam(this.ajaxUrl,"action","showSharingDetailAppendSharing"),{id:"folder_list_sharing_detail_object_".concat(o),responseType:"json",postData:{objectId:o},afterSuccessLoad:function e(i){if(i.status!=="success"){i.errors=i.errors||[{}];BX.Disk.showModalWithStatusAction({status:"error",message:i.errors.pop().message})}var s={name:i.owner.name,avatar:i.owner.avatar,link:i.owner.link};a.entityToNewSharedMaxTaskName=i.owner.maxTaskName;BX.Disk.modalWindow({modalId:"bx-disk-detail-sharing-folder-change-right",title:BX.message("JS_DISK_SHARING_LEGACY_POPUP_TITLE_MODAL_3"),contentClassName:"",contentStyle:{},events:{onAfterPopupShow:function e(){BX.addCustomEvent("onChangeRightOfSharing",a.onChangeRightOfSharing.bind(a));for(var t in i.members){if(!i.members.hasOwnProperty(t)){continue}a.entityToNewShared[i.members[t].entityId]={item:{id:i.members[t].entityId,name:i.members[t].name,avatar:i.members[t].avatar},type:i.members[t].type,right:i.members[t].right}}a.loadedReadOnlyEntityToNewShared=BX.clone(a.entityToNewShared,true);BX.SocNetLogDestination.init({name:a.destFormName,searchInput:BX("feed-add-post-destination-input"),bindMainPopup:{node:BX("feed-add-post-destination-container"),offsetTop:"5px",offsetLeft:"15px"},bindSearchPopup:{node:BX("feed-add-post-destination-container"),offsetTop:"5px",offsetLeft:"15px"},callback:{select:a.onSelectDestination.bind(a),unSelect:a.onUnSelectDestination.bind(a),openDialog:a.onOpenDialogDestination.bind(a),closeDialog:a.onCloseDialogDestination.bind(a),openSearch:a.onOpenSearchDestination.bind(a),closeSearch:a.onCloseSearchDestination.bind(a)},items:i.destination.items,itemsLast:i.destination.itemsLast,itemsSelected:i.destination.itemsSelected});var n=a.destFormName;BX.bind(BX("feed-add-post-destination-container"),"click",(function(e){BX.SocNetLogDestination.openDialog(n);BX.PreventDefault(e)}));BX.bind(BX("feed-add-post-destination-input"),"keyup",a.onKeyUpDestination.bind(a));BX.bind(BX("feed-add-post-destination-input"),"keydown",a.onKeyDownDestination.bind(a))},onPopupClose:function e(){if(BX.SocNetLogDestination&&BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.closeDialog()}BX.removeCustomEvent("onChangeRightOfSharing",a.onChangeRightOfSharing.bind(a))}},content:[BX.create("div",{props:{className:"bx-disk-popup-content"},children:[BX.create("table",{props:{className:"bx-disk-popup-shared-people-list"},children:[BX.create("thead",{html:"<tr>"+'<td class="bx-disk-popup-shared-people-list-head-col1">'.concat(BX.message("JS_DISK_SHARING_LEGACY_POPUP_LABEL_OWNER"),"</td>")+"</tr>"}),BX.create("tr",{html:"<tr>"+'<td class="bx-disk-popup-shared-people-list-col1" style="border-bottom: none;"><a class="bx-disk-filepage-used-people-link" href="'.concat(s.link,'"><span class="bx-disk-filepage-used-people-avatar" style="background-image: url(\'').concat(encodeURI(s.avatar),"');\"></span>").concat(t.Text.encode(s.name),"</a></td>")+"</tr>"})]}),BX.create("table",{props:{id:"bx-disk-popup-shared-people-list",className:"bx-disk-popup-shared-people-list"},children:[BX.create("thead",{html:"<tr>"+'<td class="bx-disk-popup-shared-people-list-head-col1">'.concat(BX.message("JS_DISK_SHARING_LEGACY_POPUP_LABEL_NAME_RIGHTS_USER"),"</td>")+'<td class="bx-disk-popup-shared-people-list-head-col2">'.concat(BX.message("JS_DISK_SHARING_LEGACY_POPUP_LABEL_NAME_RIGHTS"),"</td>")+'<td class="bx-disk-popup-shared-people-list-head-col3"></td>'+"</tr>"})]}),BX.create("div",{props:{id:"feed-add-post-destination-container",className:"feed-add-post-destination-wrap"},children:[BX.create("span",{props:{className:"feed-add-post-destination-item"}}),BX.create("span",{props:{id:"feed-add-post-destination-input-box",className:"feed-add-destination-input-box"},style:{background:"transparent"},children:[BX.create("input",{props:{type:"text",value:"",id:"feed-add-post-destination-input",className:"feed-add-destination-inp"}})]}),BX.create("a",{props:{href:"#",id:"bx-destination-tag",className:"feed-add-destination-link"},style:{background:"transparent"},text:BX.message("JS_DISK_SHARING_LEGACY_POPUP_LABEL_NAME_ADD_RIGHTS_USER"),events:{click:function e(){}}})]})]})],buttons:[new n.SaveButton({events:{click:function e(){BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(a.ajaxUrl,"action","appendSharing"),data:{objectId:o,entityToNewShared:a.entityToNewShared},onsuccess:function e(t){if(!t){return}BX.Disk.showModalWithStatusAction(t)}});BX.PopupWindowManager.getCurrentPopup().close()}}}),new BX.UI.CloseButton({events:{click:function e(){BX.PopupWindowManager.getCurrentPopup().close()}}})]})}})}},{key:"showSharingDetailWithoutEdit",value:function e(t){t=t||{};BX.Disk.showSharingDetailWithoutEdit({ajaxUrl:"/bitrix/components/bitrix/disk.folder.list/ajax.php",object:t.object})}},{key:"onSelectDestination",value:function e(t,n,i){this.entityToNewShared[t.id]=this.entityToNewShared[t.id]||{};BX.Disk.appendNewShared({maxTaskName:this.entityToNewSharedMaxTaskName,readOnly:Boolean(this.loadedReadOnlyEntityToNewShared[t.id]),destFormName:this.destFormName,item:t,type:n,right:this.entityToNewShared[t.id].right||"disk_access_edit"});this.entityToNewShared[t.id]={item:t,type:n,right:this.entityToNewShared[t.id].right||"disk_access_edit"}}},{key:"onUnSelectDestination",value:function e(t,n,i){var a=t.id;if(this.loadedReadOnlyEntityToNewShared[a]){return false}delete this.entityToNewShared[a];var o=BX.findChild(BX("bx-disk-popup-shared-people-list"),{attribute:{"data-dest-id":"".concat(String(a))}},true);if(o){BX.remove(o)}}},{key:"onChangeRightOfSharing",value:function e(t,n){if(this.entityToNewShared[t]){this.entityToNewShared[t].right=n}}},{key:"onOpenDialogDestination",value:function e(){BX.style(BX("feed-add-post-destination-input-box"),"display","inline-block");BX.style(BX("bx-destination-tag"),"display","none");BX.focus(BX("feed-add-post-destination-input"));if(BX.SocNetLogDestination.popupWindow){BX.SocNetLogDestination.popupWindow.adjustPosition({forceTop:true})}}},{key:"onCloseDialogDestination",value:function e(){var t=BX("feed-add-post-destination-input");if(!BX.SocNetLogDestination.isOpenSearch()&&t&&t.value.length<=0){BX.style(BX("feed-add-post-destination-input-box"),"display","none");BX.style(BX("bx-destination-tag"),"display","inline-block")}}},{key:"onOpenSearchDestination",value:function e(){if(BX.SocNetLogDestination.popupSearchWindow){BX.SocNetLogDestination.popupSearchWindow.adjustPosition({forceTop:true})}}},{key:"onCloseSearchDestination",value:function e(){var t=BX("feed-add-post-destination-input");if(!BX.SocNetLogDestination.isOpenSearch()&&t&&t.value.length>0){BX.style(BX("feed-add-post-destination-input-box"),"display","none");BX.style(BX("bx-destination-tag"),"display","inline-block");BX("feed-add-post-destination-input").value=""}}},{key:"onKeyDownDestination",value:function e(t){var n=this.destFormName;if(t.keyCode==8&&BX("feed-add-post-destination-input").value.length<=0){BX.SocNetLogDestination.sendEvent=false;BX.SocNetLogDestination.deleteLastItem(n)}return true}},{key:"onKeyUpDestination",value:function e(t){var n=this.destFormName;if(t.keyCode==16||t.keyCode==17||t.keyCode==18||t.keyCode==20||t.keyCode==244||t.keyCode==224||t.keyCode==91){return false}if(t.keyCode==13){BX.SocNetLogDestination.selectFirstSearchItem(n);return BX.PreventDefault(t)}if(t.keyCode==27){BX("feed-add-post-destination-input").value=""}else{BX.SocNetLogDestination.search(BX("feed-add-post-destination-input").value,true,n)}if(BX.SocNetLogDestination.sendEvent&&BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.closeDialog()}if(t.keyCode==8){BX.SocNetLogDestination.sendEvent=true}return BX.PreventDefault(t)}}]);return e}();var s=function e(){babelHelpers.classCallCheck(this,e)};babelHelpers.defineProperty(s,"WITHOUT_EDIT","without-edit");babelHelpers.defineProperty(s,"WITH_CHANGE_RIGHTS","with-change-rights");babelHelpers.defineProperty(s,"WITH_SHARING","with-sharing");babelHelpers.defineProperty(s,"BLOCKED_BY_FEATURE","blocked-by-feature");e.LegacyPopup=o;e.SharingControlType=s})(this.BX.Disk.Sharing=this.BX.Disk.Sharing||{},BX,BX.UI);
//# sourceMappingURL=disk.sharing-legacy-popup.bundle.map.js