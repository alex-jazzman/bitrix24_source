{"version":3,"file":"phone-calls.bundle.js","sources":["../src/view/common.js","../src/view/keypad.js","../src/view/background-worker/base-worker.js","../src/view/background-worker/desktop-worker.js","../src/view/background-worker/browser-worker.js","../src/view/background-worker.js","../src/view/form-manager.js","../src/view/call-list.js","../src/view/folded-view.js","../src/view/desktop.js","../src/view/view.js","../src/controller.js","../src/index.js"],"sourcesContent":["export const baseZIndex = 15000;\nexport const nop = function() {};\n","import {Dom, Type, Text, Loc} from 'main.core';\nimport {Popup, Menu} from 'main.popup';\nimport {baseZIndex, nop} from './common';\n\nconst digits = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '*', '0', '#']\n\ntype KeypadParams = {\n\tbindElement: ?HTMLElement,\n\toffsetTop: ?number,\n\toffsetLeft: ?number,\n\tanglePosition: ?string,\n\tangleOffset: ?number,\n\thistory: string[],\n\tdefaultLineId: string,\n\tlines: Object,\n\tavailableLines: string[],\n\tcallInterceptAllowed: boolean,\n\thideDial: boolean,\n\tonButtonClick: () => void,\n\tonDial: () => void,\n\tonIntercept: () => void,\n\tonClose: () => void,\n}\n\nexport class Keypad\n{\n\tconstructor(params: KeypadParams)\n\t{\n\t\tif (!Type.isPlainObject(params))\n\t\t{\n\t\t\tparams = {}\n\t\t}\n\n\t\tthis.bindElement = params.bindElement || null;\n\t\tthis.offsetTop = params.offsetTop || 0;\n\t\tthis.offsetLeft = params.offsetLeft || 0;\n\t\tthis.anglePosition = params.anglePosition || '';\n\t\tthis.angleOffset = params.angleOffset || 0;\n\t\tthis.history = params.history || [];\n\n\t\tthis.selectedLineId = params.defaultLineId;\n\t\tthis.lines = params.lines || {}\n\t\tthis.availableLines = params.availableLines || [];\n\n\t\tthis.callInterceptAllowed = params.callInterceptAllowed === true;\n\n\t\tthis.zIndex = baseZIndex + 200;\n\n\t\t//flags\n\t\tthis.hideDial = (params.hideDial === true);\n\t\tthis.plusEntered = false;\n\n\t\tthis.callbacks = {\n\t\t\tonButtonClick: Type.isFunction(params.onButtonClick) ? params.onButtonClick : nop,\n\t\t\tonDial: Type.isFunction(params.onDial) ? params.onDial : nop,\n\t\t\tonIntercept: Type.isFunction(params.onIntercept) ? params.onIntercept : nop,\n\t\t\tonClose: Type.isFunction(params.onClose) ? params.onClose : nop\n\t\t}\n\n\t\tthis.elements = {\n\t\t\tinputContainer: null,\n\t\t\tinput: null,\n\t\t\tlineSelector: null,\n\t\t\tlineName: null,\n\t\t\tinterceptButton: null,\n\t\t\thistoryButton: null\n\t\t}\n\t\tthis.plusKeyTimeout = null;\n\n\t\tthis.popup = this.createPopup();\n\t}\n\n\tcreatePopup()\n\t{\n\t\tlet popupOptions = {\n\t\t\tid: 'phone-call-view-popup-keypad',\n\t\t\tbindElement: this.bindElement,\n\t\t\ttargetContainer: document.body,\n\t\t\tdarkMode: true,\n\t\t\tcloseByEsc: true,\n\t\t\tautoHide: true,\n\t\t\tzIndex: this.zIndex,\n\t\t\tcontent: this.render(),\n\t\t\tnoAllPaddings: true,\n\n\t\t\toffsetTop: this.offsetTop,\n\t\t\toffsetLeft: this.offsetLeft,\n\n\t\t\toverlay: {\n\t\t\t\tbackgroundColor: 'white',\n\t\t\t\topacity: 0\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tonPopupClose: this.onPopupClose.bind(this)\n\t\t\t}\n\t\t}\n\n\t\tif (this.anglePosition !== '')\n\t\t{\n\t\t\tpopupOptions.angle = {\n\t\t\t\tposition: this.anglePosition,\n\t\t\t\toffset: this.angleOffset\n\t\t\t}\n\t\t}\n\n\t\treturn new Popup(popupOptions);\n\t}\n\n\tonPopupClose()\n\t{\n\t\tthis.callbacks.onClose();\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.destroy();\n\t\t}\n\t}\n\n\tcanSelectLine()\n\t{\n\t\treturn this.availableLines.length > 1;\n\t}\n\n\tsetSelectedLineId(lineId)\n\t{\n\t\tthis.selectedLineId = lineId;\n\n\t\tif (this.elements.lineName)\n\t\t{\n\t\t\tthis.elements.lineName.innerText = this.getLineName(lineId)\n\t\t}\n\t}\n\n\tgetLineName(lineId)\n\t{\n\t\treturn this.lines.hasOwnProperty(lineId) ? this.lines[lineId].SHORT_NAME : '';\n\t}\n\n\trender()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-calc-wrap\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-calc-body\"}, children: [\n\t\t\t\t\t\tthis.elements.inputContainer = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-calc-panel'}, children: [\n\t\t\t\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-calc-panel-delete\"}, events: {\n\t\t\t\t\t\t\t\t\t\tclick: this._onDeleteButtonClick.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.input = Dom.create(\"input\", {\n\t\t\t\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\t\t\t\t'readonly': this.hideDial,\n\t\t\t\t\t\t\t\t\t\ttype: \"text\",\n\t\t\t\t\t\t\t\t\t\tvalue: '',\n\t\t\t\t\t\t\t\t\t\tplaceholder: Loc.getMessage(this.hideDial ? 'IM_PHONE_PUT_DIGIT' : 'IM_PHONE_PUT_NUMBER')\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-calc-panel-input\"},\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tkeydown: this._onInputKeydown.bind(this),\n\t\t\t\t\t\t\t\t\t\tkeyup: () => this._onAfterNumberChanged()\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-calc-btns-block\"},\n\t\t\t\t\t\t\tchildren: digits.map(\n\t\t\t\t\t\t\t\tdigit => renderNumber(digit, this._onKeyMouseDown.bind(this), this._onKeyMouseUp.bind(this))\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tthis.hideDial ? null : Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-call-btn-wrap\"}, children: [\n\t\t\t\t\t\tthis.elements.lineSelector = !this.canSelectLine() ? null : Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"im-phone-select-line\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tthis.elements.lineName = Dom.create(\"span\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"im-phone-select-line-name\"},\n\t\t\t\t\t\t\t\t\ttext: this.getLineName(this.selectedLineId)\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"span\", {props: {className: \"im-phone-select-line-select\"}})\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: this._onLineSelectClick.bind(this)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-btn-separate\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-btn\"},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-btn-text\"},\n\t\t\t\t\t\t\t\t\t\t\ttext: Loc.getMessage('IM_PHONE_CALL')\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tclick: this._onDialButtonClick.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.historyButton = Dom.create(\"span\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-btn-arrow\"},\n\t\t\t\t\t\t\t\t\tevents: {click: this._onShowHistoryButtonClick.bind(this)}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.interceptButton = Dom.create(\"span\", {\n\t\t\t\t\t\t\tprops: {className: \"im-phone-intercept-button\" + (this.callInterceptAllowed ? \"\" : \" im-phone-intercept-button-locked\")},\n\t\t\t\t\t\t\ttext: Loc.getMessage(\"IM_PHONE_CALL_VIEW_INTERCEPT\"),\n\t\t\t\t\t\t\tevents: {click: this._onInterceptButtonClick.bind(this)}\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t}\n\n\t_onInputKeydown(e: KeyboardEvent)\n\t{\n\t\tif (e.keyCode == 13)\n\t\t{\n\t\t\tthis.callbacks.onDial({\n\t\t\t\tphoneNumber: this.elements.input.value,\n\t\t\t\tlineId: this.selectedLineId\n\t\t\t});\n\t\t}\n\t\telse if (e.keyCode == 37 || e.keyCode == 39 || e.keyCode == 8 || e.keyCode == 107 || e.keyCode == 46 || e.keyCode == 35 || e.keyCode == 36) // left, right, backspace, num plus, home, end\n\t\t{}\n\t\telse if (e.key === '+' || e.key === '#' || e.key === '*') // +\n\t\t{}\n\t\telse if ((e.keyCode == 67 || e.keyCode == 86 || e.keyCode == 65 || e.keyCode == 88) && (e.metaKey || e.ctrlKey)) // ctrl+v/c/a/x\n\t\t{}\n\t\telse if (e.keyCode >= 48 && e.keyCode <= 57 && !e.shiftKey) // 0-9\n\t\t{\n\t\t\tinsertAtCursor(this.elements.input, e.key);\n\n\t\t\te.preventDefault();\n\t\t\tthis.callbacks.onButtonClick({\n\t\t\t\tkey: e.key\n\t\t\t});\n\t\t}\n\t\telse if (e.keyCode >= 96 && e.keyCode <= 105 && !e.shiftKey) // extra 0-9\n\t\t{\n\t\t\tinsertAtCursor(this.elements.input, e.key);\n\n\t\t\te.preventDefault();\n\t\t\tthis.callbacks.onButtonClick({\n\t\t\t\tkey: e.key\n\t\t\t});\n\t\t}\n\t\telse if (!e.ctrlKey && !e.metaKey && !e.altKey)\n\t\t{\n\t\t\te.preventDefault();\n\t\t}\n\t}\n\n\t_onAfterNumberChanged()\n\t{\n\t\tthis.elements.inputContainer.classList.toggle('bx-messenger-calc-panel-active', this.elements.input.value.length > 0);\n\n\t\tthis.elements.input.focus();\n\t}\n\n\t_onDeleteButtonClick()\n\t{\n\t\tthis.elements.input.value = this.elements.input.value.substr(0, this.elements.input.value.length - 1);\n\t\tthis._onAfterNumberChanged();\n\t}\n\n\t_onDialButtonClick()\n\t{\n\t\tthis.callbacks.onDial({\n\t\t\tphoneNumber: this.elements.input.value,\n\t\t\tlineId: this.selectedLineId\n\t\t});\n\t}\n\n\t_onInterceptButtonClick()\n\t{\n\t\tthis.callbacks.onIntercept({\n\t\t\tinterceptButton: this.elements.interceptButton\n\t\t})\n\t}\n\n\t_onKeyMouseDown(key)\n\t{\n\t\tif (key === '0')\n\t\t{\n\t\t\tthis.plusEntered = false;\n\t\t\tthis.plusKeyTimeout = setTimeout(() =>\n\t\t\t{\n\t\t\t\tif (!this.elements.input.value.startsWith('+'))\n\t\t\t\t{\n\t\t\t\t\tthis.plusEntered = true;\n\t\t\t\t\tthis.elements.input.value = '+' + this.elements.input.value;\n\t\t\t\t}\n\t\t\t}, 500);\n\t\t}\n\t}\n\n\t_onKeyMouseUp(key)\n\t{\n\t\tif (key === '0')\n\t\t{\n\t\t\tclearTimeout(this.plusKeyTimeout);\n\t\t\tif (!this.plusEntered)\n\t\t\t{\n\t\t\t\tinsertAtCursor(this.elements.input, '0');\n\t\t\t}\n\n\t\t\tthis.plusEntered = false;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tinsertAtCursor(this.elements.input, key);\n\t\t}\n\t\tthis._onAfterNumberChanged();\n\t\tthis.callbacks.onButtonClick({\n\t\t\tkey: key\n\t\t});\n\t}\n\n\t_onShowHistoryButtonClick()\n\t{\n\t\tlet menuItems = [];\n\n\t\tif (!Type.isArray(this.history) || this.history.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.history.forEach((phoneNumber, index) =>\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\tid: \"history_\" + index,\n\t\t\t\ttext: Text.encode(phoneNumber),\n\t\t\t\tonclick: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.historySelectMenu.close();\n\t\t\t\t\tthis.callbacks.onDial({\n\t\t\t\t\t\tphoneNumber: phoneNumber,\n\t\t\t\t\t\tlineId: this.selectedLineId\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t});\n\n\t\tthis.historySelectMenu = new Menu(\n\t\t\t'phoneCallViewDialHistory',\n\t\t\tthis.elements.historyButton,\n\t\t\tmenuItems,\n\t\t\t{\n\t\t\t\tautoHide: true,\n\t\t\t\toffsetTop: 0,\n\t\t\t\toffsetLeft: 0,\n\t\t\t\tzIndex: baseZIndex + 300,\n\t\t\t\tbindOptions: {\n\t\t\t\t\tposition: 'top'\n\t\t\t\t},\n\t\t\t\tangle: {\n\t\t\t\t\toffset: 33\n\t\t\t\t},\n\t\t\t\tcloseByEsc: true,\n\t\t\t\toverlay: {\n\t\t\t\t\tbackgroundColor: 'white',\n\t\t\t\t\topacity: 0\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose: () => this.historySelectMenu.destroy(),\n\t\t\t\t\tonPopupDestroy: () => this.historySelectMenu = null,\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t\tthis.historySelectMenu.show();\n\t}\n\n\t_onLineSelectClick(e)\n\t{\n\t\tlet menuItems = [];\n\t\tthis.availableLines.forEach((lineId) =>\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\tid: \"selectLine_\" + lineId,\n\t\t\t\ttext: Text.encode(this.getLineName(lineId)),\n\t\t\t\tonclick: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.lineSelectMenu.close();\n\t\t\t\t\tthis.setSelectedLineId(lineId);\n\t\t\t\t}\n\t\t\t})\n\t\t});\n\n\t\tthis.lineSelectMenu = new Menu(\n\t\t\t'phoneCallViewSelectLine',\n\t\t\tthis.elements.lineSelector,\n\t\t\tmenuItems,\n\t\t\t{\n\t\t\t\tautoHide: true,\n\t\t\t\tzIndex: this.zIndex + 100,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tbindOptions: {\n\t\t\t\t\tposition: 'top'\n\t\t\t\t},\n\t\t\t\toffsetLeft: 35,\n\t\t\t\tangle: {\n\t\t\t\t\toffset: 33\n\t\t\t\t},\n\t\t\t\toverlay: {\n\t\t\t\t\tbackgroundColor: 'white',\n\t\t\t\t\topacity: 0\n\t\t\t\t},\n\t\t\t\tmaxHeight: 600,\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose: () => this.lineSelectMenu.destroy(),\n\t\t\t\t\tonPopupDestroy: () => this.lineSelectMenu = null\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t\tthis.lineSelectMenu.show();\n\t}\n\n\tshow()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.show();\n\t\t\tthis.elements.input.focus();\n\t\t}\n\t}\n\n\tclose()\n\t{\n\t\tif (this.lineSelectMenu)\n\t\t{\n\t\t\tthis.lineSelectMenu.destroy();\n\t\t}\n\n\t\tif (this.historySelectMenu)\n\t\t{\n\t\t\tthis.historySelectMenu.destroy();\n\t\t}\n\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t}\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.lineSelectMenu)\n\t\t{\n\t\t\tthis.lineSelectMenu.destroy();\n\t\t}\n\n\t\tif (this.historySelectMenu)\n\t\t{\n\t\t\tthis.historySelectMenu.destroy();\n\t\t}\n\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.destroy();\n\t\t}\n\n\t\tthis.popup = null;\n\t}\n}\n\nfunction renderNumber(number: string, onMouseDown, onMouseUp)\n{\n\tlet classSuffix;\n\tif (number == '*')\n\t{\n\t\tclassSuffix = '10';\n\t}\n\telse if (number == '#')\n\t{\n\t\tclassSuffix = '11';\n\t}\n\telse\n\t{\n\t\tclassSuffix = number;\n\t}\n\treturn Dom.create(\"span\", {\n\t\tdataset: {'digit': number},\n\t\tprops: {className: \"bx-messenger-calc-btn bx-messenger-calc-btn-\" + classSuffix},\n\t\tchildren: [\n\t\t\tDom.create(\"span\", {props: {className: 'bx-messenger-calc-btn-num'}})\n\t\t],\n\t\tevents: {\n\t\t\tmousedown: (e) => onMouseDown(e.currentTarget.dataset.digit),\n\t\t\tmouseup: (e) => onMouseUp(e.currentTarget.dataset.digit)\n\t\t}\n\t});\n}\n\nfunction insertAtCursor(inputElement, value)\n{\n\tif (inputElement.selectionStart || inputElement.selectionStart == '0')\n\t{\n\t\tvar startPos = inputElement.selectionStart;\n\t\tvar endPos = inputElement.selectionEnd;\n\t\tinputElement.value = inputElement.value.substring(0, startPos)\n\t\t\t+ value\n\t\t\t+ inputElement.value.substring(endPos, inputElement.value.length);\n\t\tinputElement.selectionStart = startPos + value.length;\n\t\tinputElement.selectionEnd = startPos + value.length;\n\t}\n\telse\n\t{\n\t\tinputElement.value += value;\n\t}\n}","import {UiState, PhoneCallView, desktopEvents} from \"../view\";\n\n\nexport const callCardEvents = {\n\taddCommentButtonClick: 'addCommentButtonClick',\n\tmuteButtonClick: 'muteButtonClick',\n\tholdButtonClick: 'holdButtonClick',\n\ttransferButtonClick: 'transferButtonClick',\n\tcancelTransferButtonClick: 'cancelTransferButtonClick',\n\tcompleteTransferButtonClick: 'completeTransferButtonClick',\n\thangupButtonClick: 'hangupButtonClick',\n\tnextButtonClick: 'nextButtonClick',\n\tskipButtonClick: 'skipButtonClick',\n\tanswerButtonClick: 'answerButtonClick',\n\tentityChanged: 'entityChanged',\n\tqualityMeterClick: 'qualityMeterClick',\n\tdialpadButtonClick: 'dialpadButtonClick',\n\tmakeCallButtonClick: 'makeCallButtonClick',\n\tnotifyAdminButtonClick: 'notifyAdminButtonClick',\n\tcloseButtonClick: 'closeButtonClick',\n};\n\nconst UndefinedCallCard = {\n\tresult: 'error',\n\terrorCode: 'Call card is undefined'\n}\n\n/** @abstract */\nexport class BaseWorker\n{\n\n\tisExternalCall: boolean = false;\n\tused: boolean = false;\n\tCallCard: ?PhoneCallView;\n\n\n\n\t/** @abstract */\n\tinitializePlacement(): BaseWorker\n\t{\n\t\tthrow new Error('You have to implement the method initializePlacement!');\n\t}\n\n\t/** @abstract */\n\tinitializeInterface(placement: Object): BaseWorker\n\t{\n\t\tthrow new Error('You have to implement the method initializeInterface!');\n\t}\n\n\t/** @abstract */\n\temitInitializeEvent(params)\n\t{\n\t\tthrow new Error('You have to implement the method emitInitializeEvent!');\n\t}\n\n\t/** @abstract */\n\temitEvent(name: string, params)\n\t{\n\t\tthrow new Error('You have to implement the method emitEvent!');\n\t};\n\n\tsetCallCard(callCard: ?PhoneCallView): BaseWorker\n\t{\n\t\tthis.CallCard = callCard;\n\n\t\treturn this;\n\t}\n\n\tsetIsExternalCall(isExternalCall: boolean): BaseWorker\n\t{\n\t\tthis.isExternalCall = isExternalCall;\n\n\t\treturn this;\n\t}\n\n\tisCardActive(): boolean\n\t{\n\t\treturn this.CallCard instanceof PhoneCallView;\n\t}\n\n\tisUsed(): boolean\n\t{\n\t\treturn this.used;\n\t}\n\n\tinitializeInterfaceEvents(placement: Object): BaseWorker\n\t{\n\t\tplacement.prototype.events.push('BackgroundCallCard::initialized');\n\t\tplacement.prototype.events.push('BackgroundCallCard::addCommentButtonClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::muteButtonClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::holdButtonClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::closeButtonClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::transferButtonClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::cancelTransferButtonClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::completeTransferButtonClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::hangupButtonClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::nextButtonClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::skipButtonClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::answerButtonClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::entityChanged');\n\t\tplacement.prototype.events.push('BackgroundCallCard::qualityMeterClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::dialpadButtonClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::makeCallButtonClick');\n\t\tplacement.prototype.events.push('BackgroundCallCard::notifyAdminButtonClick');\n\n\t\treturn this;\n\t}\n\n\tgetEvents()\n\t{\n\t\treturn callCardEvents;\n\t}\n\n\tgetListUiStates(params: {}, callback: Function): void\n\t{\n\t\tthis.used = true;\n\t\tcallback(Object.keys(UiState).filter((state) =>\n\t\t{\n\t\t\tswitch (state)\n\t\t\t{\n\t\t\t\tcase 'sipPhoneError':\n\t\t\t\t\treturn false;\n\t\t\t\tcase 'idle':\n\t\t\t\t\treturn false;\n\t\t\t\tcase 'externalCard':\n\t\t\t\t\treturn false;\n\t\t\t\tdefault:\n\t\t\t\t\treturn true;\n\t\t\t}\n\t\t}));\n\t}\n\n\tsetUiState(params: {uiState: string, disableAutoStartTimer: ?boolean}, callback: Function): void\n\t{\n\t\tthis.used = true;\n\t\tif (!this.isCardActive() || !this.isExternalCall)\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (params && params.uiState && UiState[params.uiState])\n\t\t{\n\t\t\tthis.CallCard.setUiState(UiState[params.uiState]);\n\t\t\t// BX.onCustomEvent(window, \"CallCard::CallStateChanged\", [callState, additionalParams]);\n\t\t\t// this.setOnSlave(desktopEvents.setCallState, [callState, additionalParams]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcallback([{\n\t\t\t\tresult: 'error',\n\t\t\t\terrorCode: 'Invalid ui state'\n\t\t\t}]);\n\n\t\t\treturn;\n\t\t}\n\t\tif (params.uiState === 'connected')\n\t\t{\n\t\t\tif (params.disableAutoStartTimer)\n\t\t\t{\n\t\t\t\tthis.CallCard.stopTimer();\n\t\t\t\tthis.hideTimer();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showTimer();\n\t\t\t}\n\t\t}\n\n\t\tif (params.uiState !== 'connected' && !this.CallCard.isTimerStarted())\n\t\t{\n\t\t\tthis.hideTimer();\n\t\t}\n\n\t\tcallback([]);\n\t}\n\n\tsetMute(params: {muted: boolean}, callback: Function): void\n\t{\n\t\tthis.used = true;\n\t\tif (!this.isCardActive() || !this.isExternalCall)\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.CallCard.isMuted() === !!params.muted)\n\t\t{\n\t\t\tcallback([]);\n\n\t\t\treturn;\n\t\t}\n\t\tif (params.muted)\n\t\t{\n\t\t\tthis.CallCard.setMuted(params.muted)\n\t\t\tBX.addClass(this.CallCard.elements.buttons.mute, 'active');\n\t\t\tif (this.CallCard.isDesktop() && this.CallCard.slave)\n\t\t\t{\n\t\t\t\tBX.desktop.onCustomEvent(desktopEvents.onMute, []);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.CallCard.callbacks.mute();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.CallCard.setMuted(params.muted)\n\t\t\tBX.removeClass(this.CallCard.elements.buttons.mute, 'active');\n\t\t\tif (this.CallCard.isDesktop() && this.CallCard.slave)\n\t\t\t{\n\t\t\t\tBX.desktop.onCustomEvent(desktopEvents.onUnMute, []);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.CallCard.callbacks.unmute();\n\t\t\t}\n\t\t}\n\t\tcallback([]);\n\t}\n\n\tsetHold(params: {held: boolean}, callback: Function): void\n\t{\n\t\tthis.used = true;\n\t\tif (!this.isCardActive() || !this.isExternalCall)\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.CallCard.isHeld() === !!params.held)\n\t\t{\n\t\t\tcallback([]);\n\n\t\t\treturn;\n\t\t}\n\t\tif (params.held)\n\t\t{\n\t\t\tthis.CallCard.setHeld(params.held)\n\t\t\tBX.addClass(this.CallCard.elements.buttons.hold, 'active');\n\t\t\tif (this.CallCard.isDesktop() && this.CallCard.slave)\n\t\t\t{\n\t\t\t\tBX.desktop.onCustomEvent(desktopEvents.onHold, []);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.CallCard.callbacks.hold();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.CallCard.setHeld(params.held);\n\t\t\tBX.removeClass(this.CallCard.elements.buttons.hold, 'active');\n\t\t\tif (this.CallCard.isDesktop() && this.CallCard.slave)\n\t\t\t{\n\t\t\t\tBX.desktop.onCustomEvent(desktopEvents.onUnHold, []);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.CallCard.callbacks.unhold();\n\t\t\t}\n\t\t}\n\t\tcallback([]);\n\t}\n\n\tstartTimer(params: {}, callback: Function): void\n\t{\n\t\tthis.used = true;\n\t\tif (!this.isCardActive() || !this.isExternalCall)\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.showTimer();\n\t\tthis.CallCard.startTimer();\n\t}\n\n\tstopTimer(params: {}, callback: Function): void\n\t{\n\t\tthis.used = true;\n\t\tif (!this.isCardActive() || !this.isExternalCall)\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.CallCard.stopTimer();\n\t}\n\n\tclose(params: {}, callback: Function): void\n\t{\n\t\tthis.used = true;\n\t\tif (!this.isCardActive() || !this.isExternalCall)\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.CallCard.close();\n\t\tcallback([]);\n\n\t\tthis.CallCard = false;\n\t}\n\n\tsetCardTitle(params: {title: string}, callback: Function): void\n\t{\n\t\tthis.used = true;\n\t\tif (!this.isCardActive() || !this.isExternalCall)\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\n\t\t\treturn;\n\t\t}\n\t\tthis.CallCard.setTitle(params.title);\n\t\tcallback([]);\n\t}\n\n\tsetStatusText(params: {statusText: string}, callback: Function): void\n\t{\n\t\tthis.used = true;\n\t\tif (!this.isCardActive() || !this.isExternalCall)\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\n\t\t\treturn;\n\t\t}\n\t\tthis.CallCard.setStatusText(params.statusText);\n\t\tcallback([]);\n\t}\n\n\tshowTimer(): void\n\t{\n\t\tif (!this.CallCard.elements.timer.visible)\n\t\t{\n\t\t\tthis.CallCard.sections.timer.visible = true;\n\t\t\tthis.CallCard.elements.timer.style.display = '';\n\t\t\tif(this.CallCard.isFolded())\n\t\t\t{\n\t\t\t\tthis.CallCard.unfoldedElements.timer.style.display = '';\n\t\t\t}\n\t\t}\n\t}\n\n\thideTimer(): void\n\t{\n\t\tif (this.CallCard.sections.timer)\n\t\t{\n\t\t\tthis.CallCard.sections.timer.visible = false;\n\t\t}\n\t\tif (this.CallCard.elements.timer)\n\t\t{\n\t\t\tthis.CallCard.elements.timer.style.display = 'none';\n\t\t}\n\t\tthis.CallCard.initialTimestamp = 0;\n\t}\n\n\tgetUndefinedCallCardError()\n\t{\n\t\treturn UndefinedCallCard;\n\t}\n}","import {BaseWorker} from \"./base-worker\";\nimport {UiState} from \"../view\";\n\nconst desktopMethodEvents = {\n\tsetUiState: 'DesktopCallCardSetUiState',\n\tsetMute: 'DesktopCallCardSetMute',\n\tsetHold: 'DesktopCallCardSetHold',\n\tgetListUiState: 'DesktopCallCardGetListUiState',\n\tsetCardTitle: 'DesktopCallCardSetCardTitle',\n\tsetStatusText: 'DesktopCallCardSetStatusText',\n\tclose: 'DesktopCallCardClose',\n\tstartTimer: 'DesktopCallCardStartTimer',\n\tstopTimer: 'DesktopCallCardStopTimer',\n};\n\nconst corporatePortalPageEvents = {\n\taddCommentButtonClick: 'DesktopCallCardAddCommentButtonClick',\n\tmuteButtonClick: 'DesktopCallCardMuteButtonClick',\n\tholdButtonClick: 'DesktopCallCardHoldButtonClick',\n\ttransferButtonClick: 'DesktopCallCardTransferButtonClick',\n\tcancelTransferButtonClick: 'DesktopCallCardCancelTransferButtonClick',\n\tcompleteTransferButtonClick: 'DesktopCallCardCompleteTransferButtonClick',\n\thangupButtonClick: 'DesktopCallCardHangupButtonClick',\n\tnextButtonClick: 'DesktopCallCardNextButtonClick',\n\tskipButtonClick: 'DesktopCallCardSkipButtonClick',\n\tanswerButtonClick: 'DesktopCallCardAnswerButtonClick',\n\tentityChanged: 'DesktopCallCardEntityChanged',\n\tqualityMeterClick: 'DesktopCallCardQualityMeterClick',\n\tdialpadButtonClick: 'DesktopCallCardDialpadButtonClick',\n\tmakeCallButtonClick: 'DesktopCallCardMakeCallButtonClick',\n\tnotifyAdminButtonClick: 'DesktopCallCardNotifyAdminButtonClick',\n};\n\nexport class DesktopWorker extends BaseWorker\n{\n\n\teventHandlers: Array;\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.eventHandlers = [];\n\t}\n\n\tisCardActive(): boolean\n\t{\n\t\treturn super.isCardActive() || this.CallCard !== null;\n\t}\n\n\tinitializePlacement()\n\t{\n\t\tconst placement = BX.rest.AppLayout.initializePlacement('PAGE_BACKGROUND_WORKER');\n\n\t\tthis.initializeInterfaceMethods(placement);\n\t\tthis.initializeInterfaceEvents(placement);\n\t\tthis.addEventHandlersForEventsFromCallCard();\n\t}\n\n\tinitializeInterface(placement)\n\t{\n\n\t\tthis.initializeInterfaceMethods(placement);\n\t\tthis.addTransmitEventHandlers();\n\n\t}\n\tinitializeInterfaceMethods(placement)\n\t{\n\t\tplacement.prototype.CallCardGetListUiStates = (params, callback) => this.getListUiStates(params, callback);\n\n\t\tplacement.prototype.CallCardSetMute = (params, callback) => this.transmitSetMute(params, callback);\n\t\tplacement.prototype.CallCardSetHold = (params, callback) => this.transmitSetHold(params, callback);\n\t\tplacement.prototype.CallCardSetUiState = (params, callback) => this.transmitSetUiState(params, callback);\n\t\tplacement.prototype.CallCardSetCardTitle = (params, callback) => this.transmitSetCardTitle(params, callback);\n\t\tplacement.prototype.CallCardSetStatusText = (params, callback) => this.transmitSetStatusText(params, callback);\n\t\tplacement.prototype.CallCardClose = (params, callback) => this.transmitClose(params, callback);\n\t\tplacement.prototype.CallCardStartTimer = (params, callback) => this.transmitStartTimer(params, callback);\n\t\tplacement.prototype.CallCardStopTimer = (params, callback) => this.transmitStopTimer(params, callback);\n\t}\n\n\temitInitializeEvent(params)\n\t{\n\t\tif (!this.isExternalCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isCallCardPage())\n\t\t{\n\t\t\tBXDesktopSystem.BroadcastEvent('DesktopCallCardInitialized', [params]);\n\n\t\t\treturn;\n\t\t}\n\n\t\tBX.onCustomEvent(window, \"BackgroundCallCard::initialized\", [params]);\n\t}\n\n\temitEvent(name: string, params)\n\t{\n\t\tif (!this.isExternalCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isCallCardPage())\n\t\t{\n\t\t\tconst desktopEventName = 'DesktopCallCard' + (name[0].toUpperCase() + name.slice(1));\n\t\t\tBXDesktopSystem.BroadcastEvent(desktopEventName, [params]);\n\t\t}\n\n\t\tBX.onCustomEvent(window, 'BackgroundCallCard::' + name, [params]);\n\t}\n\n\tremoveDesktopEventHandlers()\n\t{\n\t\tfor (const event in this.getEvents())\n\t\t{\n\t\t\tthis.removeCustomEvents('DesktopCallCard' + (event[0].toUpperCase() + event.slice(1)));\n\t\t}\n\t\tthis.removeCustomEvents('DesktopCallCardInitialized');\n\t\tthis.removeCustomEvents('DesktopCallCardCloseButtonClick');\n\t}\n\t/*\n\t Transmit an event about changing the call card by calling methods\n\t from the rest application from the corporate portal window\n\t */\n\t//region Transmit events\n\n\taddTransmitEventHandlers()\n\t{\n\t\tthis\n\t\t\t.addCustomEvent(\n\t\t\t\tdesktopMethodEvents.getListUiState,\n\t\t\t\t(params, callback) =>\n\t\t\t\t\tthis.onTransmitHandler(params, callback, this.getListUiStates)\n\t\t\t)\n\t\t\t.addCustomEvent(\n\t\t\t\tdesktopMethodEvents.setUiState,\n\t\t\t\t(params, callback) =>\n\t\t\t\t\tthis.onTransmitHandler(params, callback, this.getCallCardPlatformWorker().setUiState)\n\t\t\t)\n\t\t\t.addCustomEvent(\n\t\t\t\tdesktopMethodEvents.setMute,\n\t\t\t\t(params, callback) =>\n\t\t\t\t\tthis.onTransmitHandler(params, callback, this.getCallCardPlatformWorker().setMute)\n\t\t\t)\n\t\t\t.addCustomEvent(\n\t\t\t\tdesktopMethodEvents.setHold,\n\t\t\t\t(params, callback) =>\n\t\t\t\t\tthis.onTransmitHandler(params, callback, this.getCallCardPlatformWorker().setHold)\n\t\t\t)\n\t\t\t.addCustomEvent(\n\t\t\t\tdesktopMethodEvents.setCardTitle,\n\t\t\t\t(params, callback) =>\n\t\t\t\t\tthis.onTransmitHandler(params, callback, this.getCallCardPlatformWorker().setCardTitle)\n\t\t\t)\n\t\t\t.addCustomEvent(\n\t\t\t\tdesktopMethodEvents.setStatusText,\n\t\t\t\t(params, callback) =>\n\t\t\t\t\tthis.onTransmitHandler(params, callback, this.getCallCardPlatformWorker().setStatusText)\n\t\t\t)\n\t\t\t.addCustomEvent(\n\t\t\t\tdesktopMethodEvents.close,\n\t\t\t\t(params, callback) =>\n\t\t\t\t\tthis.onTransmitHandler(params, callback, this.getCallCardPlatformWorker().close)\n\t\t\t)\n\t\t\t.addCustomEvent(\n\t\t\t\tdesktopMethodEvents.startTimer,\n\t\t\t\t(params, callback) =>\n\t\t\t\t\tthis.onTransmitHandler(params, callback, this.getCallCardPlatformWorker().startTimer)\n\t\t\t)\n\t\t\t.addCustomEvent(\n\t\t\t\tdesktopMethodEvents.stopTimer,\n\t\t\t\t(params, callback) =>\n\t\t\t\t\tthis.onTransmitHandler(params, callback, this.getCallCardPlatformWorker().stopTimer)\n\t\t\t);\n\t}\n\n\tonTransmitHandler(params: any, callback: Function, handler: Function)\n\t{\n\t\tif (this.isCorporatePortalPage())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.used = true;\n\t\tcallback = typeof (callback) === 'function' ? callback : BX.DoNothing;\n\n\t\thandler(params, callback);\n\t}\n\n\ttransmitSetUiState(params: {uiState: string, disableAutoStartTimer?: boolean}, callback: Function)\n\t{\n\t\tif (!this.isCardActive())\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\t\t\treturn;\n\t\t}\n\t\tif (!params.hasOwnProperty('uiState') || !UiState[params.uiState])\n\t\t{\n\t\t\tcallback([{\n\t\t\t\tresult: 'error',\n\t\t\t\terrorCode: 'Invalid ui state'\n\t\t\t}]);\n\n\t\t\treturn;\n\t\t}\n\t\tBXDesktopSystem.BroadcastEvent(desktopMethodEvents.setUiState, [params, BX.DoNothing]);\n\t\tcallback([]);\n\t}\n\n\ttransmitSetMute(params: {muted: boolean}, callback: Function)\n\t{\n\t\tif (!this.isCardActive())\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\t\t\treturn;\n\t\t}\n\t\tif (!params.hasOwnProperty('muted'))\n\t\t{\n\t\t\tcallback({\n\t\t\t\tresult: 'error',\n\t\t\t\terrorCode: 'missing field muted'\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tBXDesktopSystem.BroadcastEvent(desktopMethodEvents.setMute, [params, BX.DoNothing]);\n\t\tcallback([]);\n\t}\n\n\ttransmitSetHold(params: {held: boolean}, callback: Function)\n\t{\n\t\tif (!this.isCardActive())\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!params.hasOwnProperty('held'))\n\t\t{\n\t\t\tcallback([{\n\t\t\t\tresult: 'error',\n\t\t\t\terrorCode: 'missing field held'\n\t\t\t}]);\n\t\t}\n\n\t\tBXDesktopSystem.BroadcastEvent(desktopMethodEvents.setHold, [params, BX.DoNothing]);\n\t\tcallback([]);\n\t}\n\n\ttransmitStartTimer(params: {}, callback: Function)\n\t{\n\t\tif (!this.isCardActive())\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\t\t\treturn;\n\t\t}\n\n\t\tBXDesktopSystem.BroadcastEvent(desktopMethodEvents.startTimer, [params, BX.DoNothing]);\n\t\tcallback([]);\n\t}\n\n\ttransmitStopTimer(params: {}, callback: Function)\n\t{\n\t\tif (!this.isCardActive())\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\t\t\treturn;\n\t\t}\n\n\t\tBXDesktopSystem.BroadcastEvent(desktopMethodEvents.stopTimer, [params, BX.DoNothing]);\n\t\tcallback([]);\n\t}\n\n\ttransmitClose(params: {}, callback: Function)\n\t{\n\t\tif (!this.isCardActive())\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.CallCard = null;\n\t\tBXDesktopSystem.BroadcastEvent(desktopMethodEvents.close, [params, BX.DoNothing]);\n\t\tcallback([]);\n\t}\n\n\ttransmitSetCardTitle(params: {title: string}, callback: Function)\n\t{\n\t\tif (!this.isCardActive())\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\t\t\treturn;\n\t\t}\n\t\tif (!params.hasOwnProperty('title'))\n\t\t{\n\t\t\tcallback([{\n\t\t\t\tresult: 'error',\n\t\t\t\terrorCode: 'missing field title'\n\t\t\t}]);\n\n\t\t\treturn\n\t\t}\n\n\t\tBXDesktopSystem.BroadcastEvent(desktopMethodEvents.setCardTitle, [params, BX.DoNothing]);\n\t\tcallback([]);\n\t}\n\n\ttransmitSetStatusText(params: {statusText: string}, callback: Function)\n\t{\n\t\tif (!this.isCardActive())\n\t\t{\n\t\t\tcallback([this.getUndefinedCallCardError()]);\n\t\t\treturn;\n\t\t}\n\t\tif (!params.hasOwnProperty('statusText'))\n\t\t{\n\t\t\tcallback([{\n\t\t\t\tresult: 'error',\n\t\t\t\terrorCode: 'missing field statusText'\n\t\t\t}]);\n\n\t\t\treturn;\n\t\t}\n\n\t\tBXDesktopSystem.BroadcastEvent(desktopMethodEvents.setStatusText, [params, BX.DoNothing]);\n\t\tcallback([]);\n\t}\n\t//endregion\n\n\taddEventHandlersForEventsFromCallCard()\n\t{\n\t\tif (!this.isCorporatePortalPage())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tfor (const event in this.getEvents())\n\t\t{\n\t\t\tthis.addCustomEvent(corporatePortalPageEvents[event], (params, callback) =>\n\t\t\t{\n\t\t\t\tBX.onCustomEvent(window, 'BackgroundCallCard::' + event, [params, callback]);\n\t\t\t})\n\t\t}\n\n\t\tthis.addCustomEvent('DesktopCallCardInitialized', (params, callback) =>\n\t\t{\n\t\t\tif (!this.CallCard)\n\t\t\t{\n\t\t\t\tthis.CallCard = true;\n\t\t\t}\n\t\t\tBX.onCustomEvent(window, 'BackgroundCallCard::initialized', [params, callback]);\n\t\t});\n\n\t\tthis.addCustomEvent('DesktopCallCardCloseButtonClick', (params, callback) =>\n\t\t{\n\t\t\tthis.CallCard = null;\n\t\t\tBX.onCustomEvent(window, 'BackgroundCallCard::closeButtonClick', [params, callback]);\n\t\t});\n\t}\n\taddCustomEvent(eventName: string, eventHandler: Function)\n\t{\n\t\tconst realHandler = function (e)\n\t\t{\n\t\t\tconst arEventParams = [];\n\t\t\tfor (const i in e.detail)\n\t\t\t{\n\t\t\t\tarEventParams.push(e.detail[i]);\n\t\t\t}\n\n\t\t\teventHandler.apply(window, arEventParams);\n\t\t};\n\n\t\tif (!this.eventHandlers[eventName])\n\t\t{\n\t\t\tthis.eventHandlers[eventName] = [];\n\t\t}\n\n\t\tthis.eventHandlers[eventName].push(realHandler);\n\t\twindow.addEventListener(eventName, realHandler);\n\n\t\treturn this;\n\t}\n\n\tremoveCustomEvents(eventName)\n\t{\n\t\tif (!this.eventHandlers[eventName])\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.eventHandlers[eventName].forEach(eventHandler => window.removeEventListener(eventName, eventHandler));\n\t\tthis.eventHandlers[eventName] = [];\n\t}\n\n\tisCallCardPage(): boolean\n\t{\n\t\treturn BXDesktopWindow.GetWindowId() !== BXDesktopSystem.GetMainWindow().GetWindowId()\n\t}\n\n\tisCorporatePortalPage(): boolean\n\t{\n\t\treturn typeof(BXDesktopSystem) == \"undefined\" && typeof(BXDesktopWindow) == \"undefined\";\n\t}\n\n\tgetCallCardWindow(): window\n\t{\n\t\treturn BXWindows.find(element => element.name === 'callWindow');\n\t}\n\n\tgetCallCardPlatformWorker(): BaseWorker\n\t{\n\t\tconst callWindow = this.getCallCardWindow();\n\n\t\treturn callWindow.PCW.backgroundWorker.platformWorker;\n\t}\n}","import {BaseWorker} from \"./base-worker\";\n\n\nexport class BrowserWorker extends BaseWorker\n{\n\n\tinitializePlacement()\n\t{\n\t\tconst placement = BX.rest.AppLayout.initializePlacement('PAGE_BACKGROUND_WORKER');\n\n\t\tthis.initializeInterface(placement);\n\t\tthis.initializeInterfaceEvents(placement)\n\t}\n\n\tinitializeInterface(placement)\n\t{\n\t\tplacement.prototype.CallCardSetMute = (params, callback) => this.setMute(params, callback);\n\t\tplacement.prototype.CallCardSetHold = (params, callback) => this.setHold(params, callback);\n\t\tplacement.prototype.CallCardSetUiState = (params, callback) => this.setUiState(params, callback);\n\t\tplacement.prototype.CallCardGetListUiStates = (params, callback) => this.getListUiStates(params, callback);\n\t\tplacement.prototype.CallCardSetCardTitle = (params, callback) => this.setCardTitle(params, callback);\n\t\tplacement.prototype.CallCardSetStatusText = (params, callback) => this.setStatusText(params, callback);\n\t\tplacement.prototype.CallCardClose = (params, callback) => this.close(params, callback);\n\t\tplacement.prototype.CallCardStartTimer = (params, callback) => this.startTimer(params, callback);\n\t\tplacement.prototype.CallCardStopTimer = (params, callback) => this.stopTimer(params, callback);\n\t}\n\temitEvent(name: string, params)\n\t{\n\t\tif (!this.isExternalCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tBX.onCustomEvent(window, 'BackgroundCallCard::' + name, [params]);\n\t}\n\n\temitInitializeEvent(params)\n\t{\n\t\tif (!this.isExternalCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tBX.onCustomEvent(window, \"BackgroundCallCard::initialized\", [params]);\n\t}\n}","import {PhoneCallView} from './view'\nimport {BaseWorker, callCardEvents} from \"./background-worker/base-worker\";\nimport {DesktopWorker} from \"./background-worker/desktop-worker\";\nimport {BrowserWorker} from \"./background-worker/browser-worker\";\n\nexport const backgroundWorkerEvents = callCardEvents;\n\nexport class BackgroundWorker\n{\n\tplatformWorker: BaseWorker;\n\n\tconstructor()\n\t{\n\t\tthis.initializePlacement();\n\t}\n\n\tsetCallCard(callCard: ?PhoneCallView)\n\t{\n\t\tthis.platformWorker.CallCard = callCard;\n\t}\n\n\tinitializePlacement()\n\t{\n\t\tif (this.isDesktop())\n\t\t{\n\t\t\tthis.platformWorker = new DesktopWorker();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.platformWorker = new BrowserWorker();\n\t\t}\n\n\t\tthis.platformWorker.initializePlacement();\n\t}\n\n\temitEvent(name: string, params)\n\t{\n\t\tthis.platformWorker.emitEvent(name, params);\n\t}\n\n\tremoveDesktopEventHandlers()\n\t{\n\t\tthis.platformWorker.removeDesktopEventHandlers();\n\t}\n\tisDesktop()\n\t{\n\t\treturn typeof (BXDesktopSystem) !== 'undefined';\n\t}\n\n\tisUsed()\n\t{\n\t\treturn this.platformWorker.isUsed();\n\t}\n\n\tisActiveIntoCurrentCall()\n\t{\n\t\treturn this.isExternalCall && this.isUsed();\n\t}\n\n\tsetExternalCall(isExternalCall: boolean)\n\t{\n\t\tthis.platformWorker.setIsExternalCall(isExternalCall);\n\t}\n}\n","import {Type} from 'main.core';\n\nconst nop = function(){}\n\nexport class FormManager\n{\n\tconstructor(params)\n\t{\n\t\tthis.node = params.node;\n\t\tthis.currentForm = null;\n\t\tthis.callbacks = {\n\t\t\tonFormLoad: Type.isFunction(params.onFormLoad) ? params.onFormLoad : nop,\n\t\t\tonFormUnLoad: Type.isFunction(params.onFormUnLoad) ? params.onFormUnLoad : nop,\n\t\t\tonFormSend: Type.isFunction(params.onFormSend) ? params.onFormSend : nop\n\t\t}\n\t}\n\n\t/**\n\t * @param {object} params\n\t * @param {int} params.id\n\t * @param {string} params.secCode\n\t */\n\tload(params)\n\t{\n\t\tlet formData = this.getFormData(params);\n\t\twindow.Bitrix24FormLoader.load(formData);\n\t\tthis.currentForm = formData;\n\t};\n\n\tunload()\n\t{\n\t\tif (this.currentForm)\n\t\t{\n\t\t\twindow.Bitrix24FormLoader.unload(this.currentForm);\n\t\t\tthis.currentForm = null;\n\t\t}\n\t};\n\n\t/**\n\t * @param {object} params\n\t * @param {int} params.id\n\t * @param {string} params.secCode\n\t * @returns {object}\n\t */\n\tgetFormData(params)\n\t{\n\t\treturn {\n\t\t\tid: params.id,\n\t\t\tsec: params.secCode,\n\t\t\ttype: 'inline',\n\t\t\tlang: 'ru',\n\t\t\tref: window.location.href,\n\t\t\tnode: this.node,\n\t\t\thandlers:\n\t\t\t\t{\n\t\t\t\t\t'load': this._onFormLoad.bind(this),\n\t\t\t\t\t'unload': this._onFormUnLoad.bind(this),\n\t\t\t\t\t'send': this.onFormSend.bind(this)\n\t\t\t\t},\n\t\t\toptions:\n\t\t\t\t{\n\t\t\t\t\t'borders': false,\n\t\t\t\t\t'logo': false\n\t\t\t\t}\n\t\t}\n\t};\n\n\t_onFormLoad(form)\n\t{\n\t\tthis.callbacks.onFormLoad(form);\n\t}\n\n\t_onFormUnLoad(form)\n\t{\n\t\tthis.callbacks.onFormUnLoad(form);\n\t}\n\n\tonFormSend(form)\n\t{\n\t\tthis.callbacks.onFormSend(form);\n\t}\n}","import {Dom, Type, Text, Loc} from 'main.core';\nimport {Menu} from 'main.popup'\nimport {baseZIndex, nop} from './common'\n\nexport class CallList\n{\n\tconstructor(params)\n\t{\n\t\tthis.node = params.node;\n\t\tthis.id = params.id;\n\t\tthis.isDesktop = params.isDesktop;\n\n\t\tthis.entityType = '';\n\t\tthis.statuses = new Map(); // {STATUS_ID (string): { STATUS_NAME; string, CLASS: string, ITEMS: []}\n\t\tthis.elements = {};\n\t\tthis.currentStatusId = params.callListStatusId || 'IN_WORK';\n\t\tthis.currentItemIndex = params.itemIndex || 0;\n\t\tthis.callingStatusId = null;\n\t\tthis.callingItemIndex = null;\n\t\tthis.selectionLocked = false;\n\n\t\t// this.itemActionMenu = null;\n\t\tthis.callbacks = {\n\t\t\tonError: Type.isFunction(params.onError) ? params.onError : nop,\n\t\t\tonSelectedItem: Type.isFunction(params.onSelectedItem) ? params.onSelectedItem : nop\n\t\t};\n\n\t\tthis.showLimit = 10;\n\t\tthis.showDelta = 10;\n\t}\n\n\tinit(next)\n\t{\n\t\tif (!Type.isFunction(next))\n\t\t{\n\t\t\tnext = nop;\n\t\t}\n\n\t\tthis.load(() =>\n\t\t{\n\t\t\tconst currentStatus = this.statuses.get(this.currentStatusId)\n\t\t\tif (currentStatus && currentStatus.ITEMS.length > 0)\n\t\t\t{\n\t\t\t\tthis.update();\n\t\t\t\tthis.selectItem(this.currentStatusId, this.currentItemIndex);\n\t\t\t\tnext();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tBX.debug('empty call list. don\\'t know what to do');\n\t\t\t}\n\t\t})\n\t};\n\n\t/**\n\t * @param {object} params\n\t * @param {Node} params.node DOM node to render call list.\n\t */\n\treinit(params)\n\t{\n\t\tif (Type.isDomNode(params.node))\n\t\t{\n\t\t\tthis.node = params.node;\n\t\t}\n\n\t\tthis.update();\n\t\tthis.selectItem(this.currentStatusId, this.currentItemIndex);\n\t\tif (this.callingStatusId !== null && this.callingItemIndex !== null)\n\t\t{\n\t\t\tthis.setCallingElement(this.callingStatusId, this.callingItemIndex);\n\t\t}\n\n\t};\n\n\tload(next)\n\t{\n\t\tconst params = {\n\t\t\t'sessid': BX.bitrix_sessid(),\n\t\t\t'ajax_action': 'GET_CALL_LIST',\n\t\t\t'callListId': this.id\n\t\t};\n\n\t\tBX.ajax({\n\t\t\turl: CallList.getAjaxUrl(),\n\t\t\tmethod: 'POST',\n\t\t\tdataType: 'json',\n\t\t\tdata: params,\n\t\t\tonsuccess: (data) =>\n\t\t\t{\n\t\t\t\tif (!data.ERROR)\n\t\t\t\t{\n\t\t\t\t\tif (Type.isArray(data.STATUSES))\n\t\t\t\t\t{\n\t\t\t\t\t\t//this.statuses = data.STATUSES;\n\t\t\t\t\t\tdata.STATUSES.forEach((statusRecord) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstatusRecord.ITEMS = [];\n\t\t\t\t\t\t\tthis.statuses.set(statusRecord.STATUS_ID, statusRecord);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tdata.ITEMS.forEach((item) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlet itemStatus = this.statuses.get(item.STATUS_ID);\n\t\t\t\t\t\t\tif (itemStatus)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\titemStatus.ITEMS.push(item);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tthis.entityType = data.ENTITY_TYPE;\n\t\t\t\t\tlet currentStatus = this.statuses.get(this.currentStatusId);\n\t\t\t\t\tif (currentStatus && currentStatus.ITEMS.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.currentStatusId = this.getNonEmptyStatusId();\n\t\t\t\t\t\tthis.currentItemIndex = 0;\n\t\t\t\t\t}\n\t\t\t\t\tnext();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tconsole.log(data);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t};\n\n\tselectItem(statusId, newIndex)\n\t{\n\t\tlet currentNode = this.statuses.get(this.currentStatusId).ITEMS[this.currentItemIndex]._node;\n\t\tBX.removeClass(currentNode, 'im-phone-call-list-customer-block-active');\n\n\t\tif (this.itemActionMenu)\n\t\t{\n\t\t\tthis.itemActionMenu.close();\n\t\t}\n\n\t\tthis.currentStatusId = statusId;\n\t\tthis.currentItemIndex = newIndex;\n\n\t\tcurrentNode = this.statuses.get(this.currentStatusId).ITEMS[this.currentItemIndex]._node;\n\t\tBX.addClass(currentNode, 'im-phone-call-list-customer-block-active');\n\n\t\tconst newEntity = this.statuses.get(statusId).ITEMS[newIndex];\n\n\t\tif ((this.entityType == 'DEAL' || this.entityType == 'QUOTE' || this.entityType == 'INVOICE') && newEntity.ASSOCIATED_ENTITY)\n\t\t{\n\t\t\tthis.callbacks.onSelectedItem({\n\t\t\t\ttype: newEntity.ASSOCIATED_ENTITY.TYPE,\n\t\t\t\tid: newEntity.ASSOCIATED_ENTITY.ID,\n\t\t\t\tbindings: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: this.entityType,\n\t\t\t\t\t\tid: newEntity.ELEMENT_ID\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tphones: newEntity.ASSOCIATED_ENTITY.PHONES,\n\t\t\t\tstatusId: statusId,\n\t\t\t\tindex: newIndex\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callbacks.onSelectedItem({\n\t\t\t\ttype: this.entityType,\n\t\t\t\tid: newEntity.ELEMENT_ID,\n\t\t\t\tphones: newEntity.PHONES,\n\t\t\t\tstatusId: statusId,\n\t\t\t\tindex: newIndex\n\t\t\t});\n\t\t}\n\t};\n\n\tmoveToNextItem()\n\t{\n\t\tvar newIndex = this.currentItemIndex + 1;\n\t\tif (newIndex >= this.statuses.get(this.currentStatusId).ITEMS.length)\n\t\t{\n\t\t\tnewIndex = 0;\n\t\t}\n\n\t\tthis.selectItem(this.currentStatusId, newIndex);\n\t};\n\n\tsetCallingElement(statusId, index)\n\t{\n\t\tthis.callingStatusId = statusId;\n\t\tthis.callingItemIndex = index;\n\t\tconst currentNode = this.statuses.get(this.callingStatusId).ITEMS[this.callingItemIndex]._node;\n\t\tBX.addClass(currentNode, 'im-phone-call-list-customer-block-calling');\n\t\tthis.selectionLocked = true;\n\t};\n\n\tresetCallingElement()\n\t{\n\t\tif (this.callingStatusId === null || this.callingItemIndex === null)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentNode = this.statuses.get(this.callingStatusId).ITEMS[this.callingItemIndex]._node;\n\t\tBX.removeClass(currentNode, 'im-phone-call-list-customer-block-calling');\n\t\tthis.callingStatusId = null;\n\t\tthis.callingItemIndex = null;\n\t\tthis.selectionLocked = false;\n\t};\n\n\tupdate()\n\t{\n\t\tDom.clean(this.node)\n\t\tthis.node.append(this.render())\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: 'im-phone-call-list-container'},\n\t\t\tchildren: this.renderStatusBlocks()\n\t\t});\n\t};\n\n\trenderStatusBlocks(): HTMLElement[]\n\t{\n\t\tlet result = [];\n\n\t\tfor (let [statusId, status] of this.statuses)\n\t\t{\n\t\t\tif (!status || status.ITEMS.length === 0)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tstatus._node = this.renderStatusBlock(status);\n\t\t\tresult.push(status._node);\n\t\t}\n\t\treturn result;\n\t};\n\n\trenderCallListItems(statusId): HTMLElement[]\n\t{\n\t\tlet result = [];\n\t\tconst status = this.statuses.get(statusId);\n\n\t\tif (status._shownCount > 0)\n\t\t{\n\t\t\tif (status._shownCount > status.ITEMS.length)\n\t\t\t{\n\t\t\t\tstatus._shownCount = status.ITEMS.length;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tstatus._shownCount = Math.min(this.showLimit, status.ITEMS.length);\n\t\t}\n\n\t\tfor (let i = 0; i < status._shownCount; i++)\n\t\t{\n\t\t\tresult.push(this.renderCallListItem(status.ITEMS[i], statusId, i));\n\t\t}\n\n\t\tif (status.ITEMS.length > status._shownCount)\n\t\t{\n\t\t\tstatus._showMoreNode = Dom.create(\"div\", {\n\t\t\t\tprops: {className: 'im-phone-call-list-show-more-wrap'}, children: [\n\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\tprops: {className: 'im-phone-call-list-show-more-button'},\n\t\t\t\t\t\tdataset: {statusId: statusId},\n\t\t\t\t\t\ttext: Loc.getMessage('IM_PHONE_CALL_LIST_MORE').replace('#COUNT#', (status.ITEMS.length - status._shownCount)),\n\t\t\t\t\t\tevents: {click: this.onShowMoreClick.bind(this)}\n\t\t\t\t\t})\n\t\t\t\t]\n\t\t\t});\n\t\t\tresult.push(status._showMoreNode);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tstatus._showMoreNode = null;\n\t\t}\n\n\t\treturn result;\n\t};\n\n\trenderCallListItem(itemDescriptor, statusId, itemIndex)\n\t{\n\t\tconst statusName = this.statuses.get(statusId).NAME;\n\n\t\tlet phonesText = '';\n\t\tif (Type.isArray(itemDescriptor.PHONES))\n\t\t{\n\t\t\titemDescriptor.PHONES.forEach((phone, index) =>\n\t\t\t{\n\t\t\t\tif (index !== 0)\n\t\t\t\t{\n\t\t\t\t\tphonesText += '; ';\n\t\t\t\t}\n\n\t\t\t\tphonesText += Text.encode(phone.VALUE);\n\t\t\t})\n\t\t}\n\n\t\titemDescriptor._node = Dom.create(\"div\", {\n\t\t\tprops: {className: (this.currentStatusId == statusId && this.currentItemIndex == itemIndex ? 'im-phone-call-list-customer-block im-phone-call-list-customer-block-active' : 'im-phone-call-list-customer-block')},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-list-customer-block-action'},\n\t\t\t\t\tchildren: [Dom.create(\"span\", {text: statusName})],\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: (e) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\tif (this.itemActionMenu)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.itemActionMenu.close();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.showItemMenu(itemDescriptor, e.target);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-list-item-customer-name' + (itemDescriptor.ASSOCIATED_ENTITY ? ' im-phone-call-list-connection-line' : '')},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"a\", {\n\t\t\t\t\t\t\tattrs: {href: itemDescriptor.EDIT_URL, target: '_blank'},\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-list-item-customer-link'},\n\t\t\t\t\t\t\ttext: itemDescriptor.NAME,\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: (e) =>\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\twindow.open(itemDescriptor.EDIT_URL);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t}),\n\n\t\t\t\t(itemDescriptor.POST ? Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-list-item-customer-info'},\n\t\t\t\t\ttext: itemDescriptor.POST\n\t\t\t\t}) : null),\n\t\t\t\t(itemDescriptor.COMPANY_TITLE ? Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-list-item-customer-info'},\n\t\t\t\t\ttext: itemDescriptor.COMPANY_TITLE\n\t\t\t\t}) : null),\n\t\t\t\t(phonesText ? Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-list-item-customer-info'},\n\t\t\t\t\ttext: phonesText\n\t\t\t\t}) : null),\n\t\t\t\t(itemDescriptor.ASSOCIATED_ENTITY ? this.renderAssociatedEntity(itemDescriptor.ASSOCIATED_ENTITY) : null)\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: () =>\n\t\t\t\t{\n\t\t\t\t\tif (!this.selectionLocked && (this.currentStatusId != itemDescriptor.STATUS_ID || this.currentItemIndex != itemIndex))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.selectItem(itemDescriptor.STATUS_ID, itemIndex);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn itemDescriptor._node;\n\t};\n\n\trenderAssociatedEntity(associatedEntity)\n\t{\n\t\tlet phonesText = '';\n\t\tif (Type.isArray(associatedEntity.PHONES))\n\t\t{\n\t\t\tassociatedEntity.PHONES.forEach((phone, index) =>\n\t\t\t{\n\t\t\t\tif (index !== 0)\n\t\t\t\t{\n\t\t\t\t\tphonesText += '; ';\n\t\t\t\t}\n\n\t\t\t\tphonesText += Text.encode(phone.VALUE);\n\t\t\t})\n\t\t}\n\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: 'im-phone-call-list-item-customer-entity im-phone-call-list-connection-line-item'},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"a\", {\n\t\t\t\t\tattrs: {href: associatedEntity.EDIT_URL, target: '_blank'},\n\t\t\t\t\tprops: {className: 'im-phone-call-list-item-customer-link'},\n\t\t\t\t\ttext: associatedEntity.NAME,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: (e) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\twindow.open(associatedEntity.EDIT_URL);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-list-item-customer-info'},\n\t\t\t\t\ttext: associatedEntity.POST\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-list-item-customer-info'},\n\t\t\t\t\ttext: associatedEntity.COMPANY_TITLE\n\t\t\t\t}),\n\t\t\t\t(phonesText ? Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-list-item-customer-info'},\n\t\t\t\t\ttext: phonesText\n\t\t\t\t}) : null)\n\t\t\t]\n\t\t});\n\t};\n\n\tonShowMoreClick(e)\n\t{\n\t\tvar statusId = e.target.dataset.statusId;\n\t\tvar status = this.statuses.get(statusId);\n\n\t\tstatus._shownCount += this.showDelta;\n\t\tif (status._shownCount > status.ITEMS.length)\n\t\t{\n\t\t\tstatus._shownCount = status.ITEMS.length;\n\t\t}\n\n\t\tconst newStatusNode = this.renderStatusBlock(status);\n\t\tstatus._node.parentNode.replaceChild(newStatusNode, status._node);\n\t\tstatus._node = newStatusNode;\n\t};\n\n\tshowItemMenu(callListItem, node)\n\t{\n\t\tlet menuItems = [];\n\t\tlet menuItem;\n\t\tfor (let [statusId, status] of this.statuses)\n\t\t{\n\t\t\tmenuItem = {\n\t\t\t\tid: \"setStatus_\" + statusId,\n\t\t\t\ttext: status.NAME,\n\t\t\t\tonclick: this.actionMenuItemClickHandler(callListItem.ELEMENT_ID, statusId).bind(this)\n\t\t\t};\n\t\t\tmenuItems.push(menuItem);\n\t\t}\n\t\tmenuItems.push({\n\t\t\tid: 'callListItemActionMenu_delimiter',\n\t\t\tdelimiter: true\n\n\t\t});\n\t\tmenuItems.push({\n\t\t\tid: \"defer15min\",\n\t\t\ttext: Loc.getMessage('IM_PHONE_CALL_VIEW_CALL_LIST_DEFER_15_MIN'),\n\t\t\tonclick: () =>\n\t\t\t{\n\t\t\t\tthis.itemActionMenu.close();\n\t\t\t\tthis.setElementRank(callListItem.ELEMENT_ID, callListItem.RANK + 35);\n\t\t\t}\n\t\t});\n\t\tmenuItems.push({\n\t\t\tid: \"defer1hour\",\n\t\t\ttext: Loc.getMessage('IM_PHONE_CALL_VIEW_CALL_LIST_DEFER_HOUR'),\n\t\t\tonclick: () =>\n\t\t\t{\n\t\t\t\tthis.itemActionMenu.close();\n\t\t\t\tthis.setElementRank(callListItem.ELEMENT_ID, callListItem.RANK + 185);\n\t\t\t}\n\t\t});\n\t\tmenuItems.push({\n\t\t\tid: \"moveToEnd\",\n\t\t\ttext: Loc.getMessage('IM_PHONE_CALL_VIEW_CALL_LIST_TO_END'),\n\t\t\tonclick: () =>\n\t\t\t{\n\t\t\t\tthis.itemActionMenu.close();\n\t\t\t\tthis.setElementRank(callListItem.ELEMENT_ID, callListItem.RANK + 5100);\n\t\t\t}\n\t\t});\n\n\t\tthis.itemActionMenu = new Menu(\n\t\t\t'callListItemActionMenu',\n\t\t\tnode,\n\t\t\tmenuItems,\n\t\t\t{\n\t\t\t\tautoHide: true,\n\t\t\t\toffsetTop: 0,\n\t\t\t\toffsetLeft: 0,\n\t\t\t\tangle: {position: \"top\"},\n\t\t\t\tzIndex: baseZIndex + 200,\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose: () => this.itemActionMenu.destroy(),\n\t\t\t\t\tonPopupDestroy: () => this.itemActionMenu = null\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t\tthis.itemActionMenu.show();\n\t};\n\n\tactionMenuItemClickHandler(elementId, statusId)\n\t{\n\t\treturn () =>\n\t\t{\n\t\t\tthis.itemActionMenu.close();\n\t\t\tthis.setElementStatus(elementId, statusId);\n\t\t}\n\t};\n\n\tsetElementRank(elementId, rank)\n\t{\n\t\tthis.executeItemAction({\n\t\t\taction: 'SET_ELEMENT_RANK',\n\t\t\tparameters: {\n\t\t\t\tcallListId: this.id,\n\t\t\t\telementId: elementId,\n\t\t\t\trank: rank\n\t\t\t},\n\t\t\tsuccessCallback: (data) =>\n\t\t\t{\n\t\t\t\tif (data.ITEMS)\n\t\t\t\t{\n\t\t\t\t\tthis.repopulateItems(data.ITEMS);\n\t\t\t\t\tthis.update();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t};\n\n\tsetElementStatus(elementId, statusId)\n\t{\n\t\tthis.executeItemAction({\n\t\t\taction: 'SET_ELEMENT_STATUS',\n\t\t\tparameters: {\n\t\t\t\tcallListId: this.id,\n\t\t\t\telementId: elementId,\n\t\t\t\tstatusId: statusId\n\t\t\t},\n\t\t\tsuccessCallback: (data) =>\n\t\t\t{\n\t\t\t\tthis.repopulateItems(data.ITEMS);\n\t\t\t\tthis.update();\n\t\t\t}\n\t\t})\n\t};\n\n\t/**\n\t * @param {int} elementId\n\t * @param {int} webformResultId\n\t */\n\tsetWebformResult(elementId, webformResultId)\n\t{\n\t\tthis.executeItemAction({\n\t\t\taction: 'SET_WEBFORM_RESULT',\n\t\t\tparameters: {\n\t\t\t\tcallListId: this.id,\n\t\t\t\telementId: elementId,\n\t\t\t\twebformResultId: webformResultId\n\t\t\t}\n\t\t})\n\t};\n\n\texecuteItemAction(params)\n\t{\n\t\tif (!Type.isPlainObject(params))\n\t\t{\n\t\t\tparams = {};\n\t\t}\n\n\t\tif (!Type.isFunction(params.successCallback))\n\t\t{\n\t\t\tparams.successCallback = nop;\n\t\t}\n\n\t\tvar requestParams = {\n\t\t\t'sessid': BX.bitrix_sessid(),\n\t\t\t'ajax_action': params.action,\n\t\t\t'parameters': params.parameters\n\t\t};\n\n\t\tBX.ajax({\n\t\t\turl: CallList.getAjaxUrl(),\n\t\t\tmethod: 'POST',\n\t\t\tdataType: 'json',\n\t\t\tdata: requestParams,\n\t\t\tonsuccess: (data) => params.successCallback(data)\n\t\t});\n\t};\n\n\trepopulateItems(items)\n\t{\n\t\tfor (let [statusId, status] of this.statuses)\n\t\t{\n\t\t\tstatus.ITEMS = [];\n\t\t}\n\n\t\titems.forEach((item) => this.statuses.get(item.STATUS_ID).ITEMS.push(item));\n\n\t\tif (this.statuses.get(this.currentStatusId).ITEMS.length === 0)\n\t\t{\n\t\t\tthis.currentStatusId = this.getNonEmptyStatusId();\n\t\t\tthis.currentItemIndex = 0;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.currentItemIndex >= this.statuses.get(this.currentStatusId).ITEMS.length)\n\t\t\t{\n\t\t\t\tthis.currentItemIndex = 0;\n\t\t\t}\n\t\t}\n\n\t\tthis.selectItem(this.currentStatusId, this.currentItemIndex);\n\t};\n\n\tgetNonEmptyStatusId()\n\t{\n\t\tlet foundStatusId = false;\n\n\t\tfor (let [statusId, status] of this.statuses)\n\t\t{\n\t\t\tif (status.ITEMS.length > 0)\n\t\t\t{\n\t\t\t\tfoundStatusId = statusId;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn foundStatusId;\n\t};\n\n\tgetCurrentElement()\n\t{\n\t\treturn this.statuses.get(this.currentStatusId).ITEMS[this.currentItemIndex];\n\t};\n\n\tgetStatusTitle(statusId)\n\t{\n\t\tconst count = this.statuses.get(statusId).ITEMS.length;\n\n\t\treturn Text.encode(this.statuses.get(statusId).NAME) + ' (' + count.toString() + ')';\n\t};\n\n\trenderStatusBlock(status)\n\t{\n\t\tlet animationTimeout;\n\t\tlet itemsNode;\n\t\tlet measuringNode;\n\t\tconst statusId = status.STATUS_ID;\n\n\t\tif (!status.hasOwnProperty('_folded'))\n\t\t{\n\t\t\tstatus._folded = false;\n\t\t}\n\n\t\tlet className = 'im-phone-call-list-block';\n\n\t\tif (status.CLASS != '')\n\t\t{\n\t\t\tclassName = className + ' ' + status.CLASS;\n\t\t}\n\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: className}, children: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-list-block-title' + (status._folded ? '' : ' active')},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"span\", {text: this.getStatusTitle(statusId)}),\n\t\t\t\t\t\tDom.create(\"div\", {props: {className: 'im-phone-call-list-block-title-arrow'}})\n\t\t\t\t\t],\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: (e: Event) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\te.preventDefault()\n\t\t\t\t\t\t\tclearTimeout(animationTimeout);\n\t\t\t\t\t\t\tstatus._folded = !status._folded;\n\t\t\t\t\t\t\tif (status._folded)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tBX.removeClass(e.target, 'active');\n\t\t\t\t\t\t\t\titemsNode.style.height = measuringNode.clientHeight.toString() + 'px';\n\t\t\t\t\t\t\t\tanimationTimeout = setTimeout(function ()\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\titemsNode.style.height = 0;\n\t\t\t\t\t\t\t\t}, 50);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tBX.addClass(e.target, 'active');\n\t\t\t\t\t\t\t\titemsNode.style.height = 0;\n\t\t\t\t\t\t\t\tanimationTimeout = setTimeout(function ()\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\titemsNode.style.height = measuringNode.clientHeight + 'px';\n\t\t\t\t\t\t\t\t}, 50);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\titemsNode = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-list-items-block'},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tmeasuringNode = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-list-items-measuring'},\n\t\t\t\t\t\t\tchildren: this.renderCallListItems(statusId)\n\t\t\t\t\t\t})\n\t\t\t\t\t],\n\t\t\t\t\tevents: {\n\t\t\t\t\t\ttransitionend: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (!status._folded)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\titemsNode.style.removeProperty('height');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t}\n\n\tstatic getAjaxUrl(): string\n\t{\n\t\treturn (this.isDesktop ? '/desktop_app/call_list.ajax.php' : '/bitrix/components/bitrix/crm.activity.call_list/ajax.php')\n\t}\n}\n","import {Dom, Loc, Text, Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\n\nimport {CallList} from './call-list'\n\nlet avatars = {};\n\nconst Events = {\n\tonUnfold: \"onUnfold\"\n}\n\nexport class FoldedCallView extends EventEmitter\n{\n\tconstructor(params)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace(\"BX.VoxImplant.FoldedCallView\");\n\t\tthis.subscribeFromOptions(params.events)\n\n\t\tthis.currentItem = {};\n\t\tthis.callListParams = {\n\t\t\tid: 0,\n\t\t\twebformId: 0,\n\t\t\twebformSecCode: '',\n\t\t\titemIndex: 0,\n\t\t\titemStatusId: '',\n\t\t\tstatusList: {},\n\t\t\tentityType: ''\n\t\t};\n\t\tthis.node = null;\n\t\tthis.elements = {\n\t\t\tavatar: null,\n\t\t\tcallButton: null,\n\t\t\tnextButton: null,\n\t\t\tunfoldButton: null\n\t\t};\n\t\tthis._lsKey = 'bx-im-folded-call-view-data';\n\t\tthis._lsTtl = 86400;\n\t\tthis.init();\n\t}\n\n\tinit()\n\t{\n\t\tthis.load();\n\t\tif (this.callListParams.id > 0)\n\t\t{\n\t\t\tthis.currentItem = this.callListParams.statusList[this.callListParams.itemStatusId].ITEMS[this.callListParams.itemIndex];\n\t\t\tthis.render();\n\t\t}\n\t};\n\n\tload()\n\t{\n\t\tvar savedData = BX.localStorage.get(this._lsKey);\n\t\tif (Type.isPlainObject(savedData))\n\t\t{\n\t\t\tthis.callListParams = savedData;\n\t\t}\n\t};\n\n\tdestroy()\n\t{\n\t\tif (this.node)\n\t\t{\n\t\t\tDom.remove(this.node);\n\t\t\tthis.node = null;\n\t\t}\n\n\t\tBX.localStorage.remove(this._lsKey);\n\t};\n\n\tstore()\n\t{\n\t\tBX.localStorage.set(this._lsKey, this.callListParams, this._lsTtl);\n\t};\n\n\tfold(params, animation)\n\t{\n\t\tanimation = (animation === true);\n\t\tthis.callListParams.id = params.callListId;\n\t\tthis.callListParams.webformId = params.webformId;\n\t\tthis.callListParams.webformSecCode = params.webformSecCode;\n\t\tthis.callListParams.itemIndex = params.currentItemIndex;\n\t\tthis.callListParams.itemStatusId = params.currentItemStatusId;\n\t\tthis.callListParams.statusList = Object.fromEntries(params.statusList);\n\t\tthis.callListParams.entityType = params.entityType;\n\t\tthis.currentItem = this.callListParams.statusList[this.callListParams.itemStatusId].ITEMS[this.callListParams.itemIndex];\n\t\tthis.store();\n\t\tthis.render(animation);\n\t};\n\n\tunfold(makeCall: ?boolean)\n\t{\n\t\tDom.addClass(this.node, \"im-phone-folded-call-view-unfold\");\n\t\tthis.node.addEventListener('animationend', () =>\n\t\t{\n\t\t\tif (this.node)\n\t\t\t{\n\t\t\t\tDom.remove(this.node);\n\t\t\t\tthis.node = null;\n\t\t\t}\n\n\t\t\tBX.localStorage.remove(this._lsKey);\n\t\t\tif (this.callListParams.id === 0)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tlet restoredParams = {};\n\t\t\tif (this.callListParams.webformId > 0 && this.callListParams.webformSecCode !== '')\n\t\t\t{\n\t\t\t\trestoredParams.webformId = this.callListParams.webformId;\n\t\t\t\trestoredParams.webformSecCode = this.callListParams.webformSecCode;\n\t\t\t}\n\t\t\trestoredParams.callListStatusId = this.callListParams.itemStatusId;\n\t\t\trestoredParams.callListItemIndex = this.callListParams.itemIndex;\n\t\t\trestoredParams.makeCall = makeCall;\n\n\t\t\tthis.emit(Events.onUnfold, {\n\t\t\t\tcallListId: this.callListParams.id,\n\t\t\t\tcallListParams: restoredParams\n\t\t\t})\n\t\t});\n\t};\n\n\tmoveToNext()\n\t{\n\t\tthis.callListParams.itemIndex++;\n\t\tif (this.callListParams.itemIndex >= this.callListParams.statusList[this.callListParams.itemStatusId].ITEMS.length)\n\t\t{\n\t\t\tthis.callListParams.itemIndex = 0;\n\t\t}\n\n\t\tthis.currentItem = this.callListParams.statusList[this.callListParams.itemStatusId].ITEMS[this.callListParams.itemIndex];\n\t\tthis.store();\n\t\tthis.render();\n\t};\n\n\trender(animation)\n\t{\n\t\tanimation = (animation === true);\n\t\tif (this.node === null)\n\t\t{\n\t\t\tthis.node = Dom.create(\"div\", {\n\t\t\t\tprops: {\n\t\t\t\t\tid: 'im-phone-folded-call-view',\n\t\t\t\t\tclassName: 'im-phone-call-wrapper im-phone-call-wrapper-fixed im-phone-call-panel'\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tdblclick: this._onViewDblClick.bind(this)\n\t\t\t\t}\n\t\t\t});\n\t\t\tdocument.body.appendChild(this.node);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.clean(this.node);\n\t\t}\n\n\t\tthis.node.appendChild(Dom.create(\"div\", {\n\t\t\tprops: {className: 'im-phone-call-wrapper-fixed-left'},\n\t\t\tstyle: (animation ? {bottom: '-90px'} : {}),\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-wrapper-fixed-user'}, children: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-wrapper-fixed-user-image'}, children: [\n\t\t\t\t\t\t\t\tthis.elements.avatar = Dom.create(\"div\", {props: {className: 'im-phone-call-wrapper-fixed-user-image-item'}})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-wrapper-fixed-user-info'},\n\t\t\t\t\t\t\tchildren: this.renderUserInfo()\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t]\n\t\t}));\n\n\t\tthis.node.appendChild(Dom.create(\"div\", {\n\t\t\tprops: {className: 'im-phone-call-wrapper-fixed-right'}, children: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-wrapper-fixed-btn-container'}, children: [\n\t\t\t\t\t\tthis.elements.callButton = Dom.create(\"span\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-btn im-phone-call-btn-green'},\n\t\t\t\t\t\t\ttext: Loc.getMessage('IM_PHONE_CALL_VIEW_FOLDED_BUTTON_CALL'),\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: this._onDialButtonClick.bind(this)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.nextButton = Dom.create(\"span\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-btn im-phone-call-btn-gray im-phone-call-btn-arrow'},\n\t\t\t\t\t\t\ttext: Loc.getMessage('IM_PHONE_CALL_VIEW_FOLDED_BUTTON_NEXT'),\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: this._onNextButtonClick.bind(this)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t]\n\t\t}));\n\n\t\tthis.node.appendChild(Dom.create(\"div\", {\n\t\t\t\tprops: {className: 'im-phone-btn-block'}, children: [\n\t\t\t\t\tthis.elements.unfoldButton = Dom.create(\"div\", {\n\t\t\t\t\t\tprops: {className: 'im-phone-btn-arrow'},\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\tprops: {className: 'im-phone-btn-arrow-inner'},\n\t\t\t\t\t\t\t\ttext: Loc.getMessage(\"IM_PHONE_CALL_VIEW_UNFOLD\")\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t],\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tclick: this._onUnfoldButtonClick.bind(this)\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t]\n\t\t\t})\n\t\t);\n\n\t\tif (avatars[this.currentItem.ELEMENT_ID])\n\t\t{\n\t\t\tthis.elements.avatar.style.backgroundImage = 'url(\\'' + Text.encode(avatars[this.currentItem.ELEMENT_ID]) + '\\')';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.loadAvatar(this.callListParams.entityType, this.currentItem.ELEMENT_ID);\n\t\t}\n\n\t\tif (animation)\n\t\t{\n\t\t\tDom.addClass(this.node, 'im-phone-folded-call-view-fold');\n\t\t\tthis.node.addEventListener('animationend', function ()\n\t\t\t{\n\t\t\t\tBX.removeClass(this.node, 'im-phone-folded-call-view-fold');\n\t\t\t})\n\t\t}\n\t};\n\n\trenderUserInfo()\n\t{\n\t\tvar result = [];\n\n\t\tresult.push(Dom.create(\"div\", {\n\t\t\tprops: {className: 'im-phone-call-wrapper-fixed-user-name'},\n\t\t\ttext: this.currentItem.NAME\n\t\t}));\n\t\tif (this.currentItem.POST)\n\t\t{\n\t\t\tresult.push(Dom.create(\"div\", {\n\t\t\t\tprops: {className: 'im-phone-call-wrapper-fixed-user-item'},\n\t\t\t\ttext: this.currentItem.POST\n\t\t\t}));\n\t\t}\n\t\tif (this.currentItem.COMPANY_TITLE)\n\t\t{\n\t\t\tresult.push(Dom.create(\"div\", {\n\t\t\t\tprops: {className: 'im-phone-call-wrapper-fixed-user-item'},\n\t\t\t\ttext: this.currentItem.COMPANY_TITLE\n\t\t\t}));\n\t\t}\n\n\t\treturn result;\n\t};\n\n\tloadAvatar(entityType, entityId)\n\t{\n\t\tBX.ajax({\n\t\t\turl: CallList.getAjaxUrl(),\n\t\t\tmethod: 'POST',\n\t\t\tdataType: 'json',\n\t\t\tdata: {\n\t\t\t\t'sessid': BX.bitrix_sessid(),\n\t\t\t\t'ajax_action': 'GET_AVATAR',\n\t\t\t\t'entityType': entityType,\n\t\t\t\t'entityId': entityId\n\t\t\t},\n\t\t\tonsuccess: (data) =>\n\t\t\t{\n\t\t\t\tif (!data.avatar)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tavatars[entityId] = data.avatar;\n\t\t\t\tif (this.currentItem.ELEMENT_ID == entityId && this.elements.avatar)\n\t\t\t\t{\n\t\t\t\t\tthis.elements.avatar.style.backgroundImage = 'url(\\'' + Text.encode(data.avatar) + '\\')';\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t};\n\n\t_onViewDblClick(e)\n\t{\n\t\te.preventDefault();\n\t\tthis.unfold(false);\n\t};\n\n\t_onDialButtonClick(e)\n\t{\n\t\te.preventDefault();\n\t\tthis.unfold(true);\n\t};\n\n\t_onNextButtonClick(e)\n\t{\n\t\te.preventDefault();\n\t\tthis.moveToNext();\n\t};\n\n\t_onUnfoldButtonClick(e)\n\t{\n\t\te.preventDefault();\n\t\tthis.unfold(false);\n\t};\n\n\tstatic Events = Events;\n}","import {Type} from 'main.core';\nimport { DesktopApi } from 'im.v2.lib.desktop-api';\nimport type {MessengerFacade} from '../controller';\n\nconst desktopFeatureMap = {\n\t'iframe': 39\n};\n\nexport class Desktop\n{\n\tconstructor(params)\n\t{\n\t\tthis.parentPhoneCallView = params.parentPhoneCallView;\n\t\tthis.closable = params.closable;\n\t\tthis.title = params.title || '';\n\t\tthis.window = null;\n\t}\n\n\topenCallWindow(content, js, params)\n\t{\n\t\tparams = params || {};\n\n\t\tif (params.minSettingsWidth)\n\t\t{\n\t\t\tthis.minSettingsWidth = params.minSettingsWidth;\n\t\t}\n\n\t\tif (params.minSettingsHeight)\n\t\t{\n\t\t\tthis.minSettingsHeight = params.minSettingsHeight;\n\t\t}\n\n\t\tparams.resizable = (params.resizable === true);\n\n\t\tDesktopApi.createWindow(\"callWindow\", (callWindow) =>\n\t\t{\n\t\t\tcallWindow.SetProperty(\"clientSize\", {Width: params.width, Height: params.height});\n\t\t\tcallWindow.SetProperty(\"resizable\", params.resizable);\n\t\t\tif (params.resizable && params.hasOwnProperty('minWidth') && params.hasOwnProperty('minHeight'))\n\t\t\t{\n\t\t\t\tcallWindow.SetProperty(\"minClientSize\", {Width: params.minWidth, Height: params.minHeight});\n\t\t\t}\n\t\t\tcallWindow.SetProperty(\"title\", this.title);\n\t\t\tcallWindow.SetProperty(\"closable\", true);\n\n\t\t\t//callWindow.OpenDeveloperTools();\n\t\t\tlet html = this.#getHtmlPage(content, js, {});\n\t\t\tcallWindow.ExecuteCommand(\"html.load\", html);\n\t\t\tthis.window = callWindow;\n\t\t});\n\t};\n\n\tsetClosable(closable: boolean)\n\t{\n\t\tthis.closable = (closable === true);\n\t\tif (this.window)\n\t\t{\n\t\t\tthis.window.SetProperty(\"closable\", this.closable);\n\t\t}\n\t};\n\n\tsetTitle(title)\n\t{\n\t\tthis.title = title;\n\t\tif (this.window)\n\t\t{\n\t\t\tthis.window.SetProperty(\"title\", title)\n\t\t}\n\t};\n\n\t#getHtmlPage(content, jsContent, initImJs, bodyClass)\n\t{\n\t\tcontent = content || '';\n\t\tjsContent = jsContent || '';\n\t\tbodyClass = bodyClass || '';\n\n\t\tif (this.htmlWrapperHead == null)\n\t\t{\n\t\t\tthis.htmlWrapperHead = document.head.outerHTML.replace(/BX\\.PULL\\.start\\([^)]*\\);/g, '');\n\t\t}\n\n\t\tif (Type.isDomNode(content))\n\t\t{\n\t\t\tcontent = content.outerHTML;\n\t\t}\n\n\t\tif (Type.isDomNode(jsContent))\n\t\t{\n\t\t\tjsContent = jsContent.outerHTML;\n\t\t}\n\n\t\tif (Type.isStringFilled(jsContent))\n\t\t{\n\t\t\tjsContent =\n\t\t\t\t`<script type=\"text/javascript\">\n\t\t\t\t\tBX.ready(function() {\n\t\t\t\t\t\t${jsContent}\n\t\t\t\t\t});\n\t\t\t\t</script>`;\n\t\t}\n\n\t\tlet initJs = '';\n\t\tif (initImJs)\n\t\t{\n\t\t\tinitJs = `\n\t\t\t\t<script type=\"text/javascript\">\n\t\t\t\t\tBX.ready(function() {\n\t\t\t\t\t\t\tconst backgroundWorker = new BX.Voximplant.BackgroundWorker();\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\twindow.PCW = new BX.Voximplant.PhoneCallView({\n\t\t\t\t\t\t\t\tisDesktop: true,\n\t\t\t\t\t\t\t\tslave: true, \n\t\t\t\t\t\t\t\tskipOnResize: true, \n\t\t\t\t\t\t\t\tcallId: '${this.parentPhoneCallView.callId}',\n\t\t\t\t\t\t\t\tuiState: ${this.parentPhoneCallView._uiState},\n\t\t\t\t\t\t\t\tphoneNumber: '${this.parentPhoneCallView.phoneNumber}',\n\t\t\t\t\t\t\t\tcompanyPhoneNumber: '${this.parentPhoneCallView.companyPhoneNumber}',\n\t\t\t\t\t\t\t\tdirection: '${this.parentPhoneCallView.direction}',\n\t\t\t\t\t\t\t\tfromUserId: '${this.parentPhoneCallView.fromUserId}',\n\t\t\t\t\t\t\t\ttoUserId: '${this.parentPhoneCallView.toUserId}',\n\t\t\t\t\t\t\t\tcrm: ${this.parentPhoneCallView.crm},\n\t\t\t\t\t\t\t\thasSipPhone: ${this.parentPhoneCallView.hasSipPhone},\n\t\t\t\t\t\t\t\tdeviceCall: ${this.parentPhoneCallView.deviceCall},\n\t\t\t\t\t\t\t\ttransfer: ${this.parentPhoneCallView.transfer},\n\t\t\t\t\t\t\t\tcrmEntityType: '${this.parentPhoneCallView.crmEntityType}',\n\t\t\t\t\t\t\t\tcrmEntityId: '${this.parentPhoneCallView.crmEntityId}',\n\t\t\t\t\t\t\t\tcrmActivityId: '${this.parentPhoneCallView.crmActivityId}',\n\t\t\t\t\t\t\t\tcrmActivityEditUrl: '${this.parentPhoneCallView.crmActivityEditUrl}',\n\t\t\t\t\t\t\t\tcallListId: ${this.parentPhoneCallView.callListId},\n\t\t\t\t\t\t\t\tcallListStatusId: '${this.parentPhoneCallView.callListStatusId}',\n\t\t\t\t\t\t\t\tcallListItemIndex: ${this.parentPhoneCallView.callListItemIndex},\n\t\t\t\t\t\t\t\tconfig: ${this.parentPhoneCallView.config ? JSON.stringify(this.parentPhoneCallView.config) : '{}'},\n\t\t\t\t\t\t\t\tportalCall: ${this.parentPhoneCallView.portalCall ? 'true' : 'false'},\n\t\t\t\t\t\t\t\tportalCallData: ${this.parentPhoneCallView.portalCallData ? JSON.stringify(this.parentPhoneCallView.portalCallData) : '{}'},\n\t\t\t\t\t\t\t\tportalCallUserId: ${this.parentPhoneCallView.portalCallUserId},\n\t\t\t\t\t\t\t\twebformId: ${this.parentPhoneCallView.webformId},\n\t\t\t\t\t\t\t\twebformSecCode: '${this.parentPhoneCallView.webformSecCode}',\n\t\t\t\t\t\t\t\tbackgroundWorker: backgroundWorker,\n\t\t\t\t\t\t\t\trestApps: ${this.parentPhoneCallView.restApps ? JSON.stringify(this.parentPhoneCallView.restApps) : '[]'},\n\t\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t</script>`;\n\t\t}\n\t\treturn `\n\t\t\t<!DOCTYPE html>\n\t\t\t<html lang=\"${document.documentElement.lang}\">\n\t\t\t\t${this.htmlWrapperHead}\n\t\t\t\t<body class=\"im-desktop im-desktop-popup ${bodyClass}\">\n\t\t\t\t\t<div id=\"placeholder-messanger\">${content}</div>\n\t\t\t\t\t${initJs}\n\t\t\t\t\t${jsContent}\n\t\t\t\t</body>\n\t\t\t</html>\n\t\t`;\n\t};\n\n\taddCustomEvent(eventName, eventHandler)\n\t{\n\t\tBX.desktop.addCustomEvent(eventName, eventHandler);\n\t};\n\n\tonCustomEvent(windowTarget, eventName, arEventParams)\n\t{\n\t\tBX.desktop.onCustomEvent(windowTarget, eventName, arEventParams);\n\t};\n\n\tresize(width, height)\n\t{\n\t\tBXDesktopWindow.SetProperty(\"clientSize\", {Width: width, Height: height});\n\t};\n\n\tsetResizable(resizable)\n\t{\n\t\tresizable = (resizable === true);\n\t\tBXDesktopWindow.SetProperty(\"resizable\", resizable);\n\t};\n\n\tsetMinSize(width, height)\n\t{\n\t\tBXDesktopWindow.SetProperty(\"minClientSize\", {Width: width, Height: height});\n\t};\n\n\tsetWindowPosition(params)\n\t{\n\t\tBXDesktopWindow.SetProperty(\"position\", params);\n\t};\n\n\tcenter()\n\t{\n\t\tBXDesktopWindow.ExecuteCommand(\"center\");\n\t};\n\n\tgetVersion(full)\n\t{\n\t\tif (typeof (BXDesktopSystem) == 'undefined')\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\n\t\tif (!this.clientVersion)\n\t\t{\n\t\t\tthis.clientVersion = BXDesktopSystem.GetProperty('versionParts');\n\t\t}\n\n\t\treturn full ? this.clientVersion.join('.') : this.clientVersion[3];\n\t};\n\n\tisFeatureSupported(featureName)\n\t{\n\t\tif (!desktopFeatureMap.hasOwnProperty(featureName))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.getVersion() >= desktopFeatureMap[featureName];\n\t};\n}","/**\n * @bxjs_lang_path js_phone_call_view.php\n */\n\nimport {Dom, Type, Text, Runtime, Loc, Uri} from 'main.core';\nimport {Popup, Menu} from 'main.popup';\nimport {DesktopApi} from 'im.v2.lib.desktop-api';\nimport {BackgroundWorker, backgroundWorkerEvents} from './background-worker';\nimport {FormManager} from './form-manager';\nimport {CallList} from './call-list';\nimport {FoldedCallView} from './folded-view';\nimport {Desktop} from './desktop';\nimport {Keypad} from './keypad';\nimport type {Dialog} from 'ui.entity-selector';\nimport {baseZIndex, nop} from './common';\n\nimport type {MessengerFacade} from '../controller';\n\nexport const Direction = {\n\tincoming: 'incoming',\n\toutgoing: 'outgoing',\n\tcallback: 'callback',\n}\n\nexport const UiState = {\n\tincoming: 1,\n\ttransferIncoming: 2,\n\toutgoing: 3,\n\tconnectingIncoming: 4,\n\tconnectingOutgoing: 5,\n\tconnected: 6,\n\ttransferring: 7,\n\ttransferFailed: 8,\n\ttransferConnected: 9,\n\tidle: 10,\n\terror: 11,\n\tmoneyError: 12,\n\tsipPhoneError: 13,\n\tredial: 14,\n\texternalCard: 15,\n}\n\nexport const CallState = {\n\tidle: 'idle',\n\tconnecting: 'connecting',\n\tconnected: 'connected',\n}\n\nexport const CallProgress = {\n\tconnect: 'connect',\n\terror: 'error',\n\toffline: 'offline',\n\tonline: 'online',\n\twait: 'wait'\n}\n\nconst ButtonLayouts = {\n\tcentered: 'centered',\n\tspaced: 'spaced'\n};\n\n/* Phone Call UI */\nconst layouts = {\n\tsimple: 'simple',\n\tcrm: 'crm'\n}\n\nconst initialSize = {\n\tsimple: {\n\t\twidth: 550,\n\t\theight: 492\n\t},\n\tcrm: {\n\t\twidth: 550,\n\t\theight: 650\n\t}\n};\n\nconst lsKeys = {\n\theight: 'im-phone-call-view-height',\n\twidth: 'im-phone-call-view-width',\n\tcallView: 'bx-vox-call-view',\n\tcallInited: 'viInitedCall',\n\texternalCall: 'viExternalCard',\n};\n\nexport const desktopEvents = {\n\tsetTitle: 'phoneCallViewSetTitle',\n\tsetStatus: 'phoneCallViewSetStatus',\n\tsetUiState: 'phoneCallViewSetUiState',\n\tsetDeviceCall: 'phoneCallViewSetDeviceCall',\n\tsetCrmEntity: 'phoneCallViewSetCrmEntity',\n\tsetPortalCall: 'phoneCallViewSetPortalCall',\n\tsetPortalCallUserId: 'phoneCallViewSetPortalCallUserId',\n\tsetPortalCallQueueName: 'phoneCallViewSetPortalCallQueueName',\n\tsetPortalCallData: 'phoneCallViewSetPortalCallData',\n\tsetConfig: 'phoneCallViewSetConfig',\n\tsetCallState: 'phoneCallViewSetCallState',\n\treloadCrmCard: 'phoneCallViewReloadCrmCard',\n\tsetCallId: 'phoneCallViewSetCallId',\n\tsetLineNumber: 'phoneCallViewSetLineNumber',\n\tsetPhoneNumber: 'phoneCallViewSetPhoneNumber',\n\tsetCompanyPhoneNumber: 'phoneCallViewSetCompanyPhoneNumber',\n\tsetTransfer: 'phoneCallViewSetTransfer',\n\tcloseWindow: 'phoneCallViewCloseWindow',\n\n\tonHold: 'phoneCallViewOnHold',\n\tonUnHold: 'phoneCallViewOnUnHold',\n\tonMute: 'phoneCallViewOnMute',\n\tonUnMute: 'phoneCallViewOnUnMute',\n\tonMakeCall: 'phoneCallViewOnMakeCall',\n\tonCallListMakeCall: 'phoneCallViewOnCallListMakeCall',\n\tonAnswer: 'phoneCallViewOnAnswer',\n\tonSkip: 'phoneCallViewOnSkip',\n\tonHangup: 'phoneCallViewOnHangup',\n\tonClose: 'phoneCallViewOnClose',\n\tonStartTransfer: 'phoneCallViewOnStartTransfer',\n\tonCompleteTransfer: 'phoneCallViewOnCompleteTransfer',\n\tonCancelTransfer: 'phoneCallViewOnCancelTransfer',\n\tonBeforeUnload: 'phoneCallViewOnBeforeUnload',\n\tonSwitchDevice: 'phoneCallViewOnSwitchDevice',\n\tonQualityGraded: 'phoneCallViewOnQualityGraded',\n\tonDialpadButtonClicked: 'phoneCallViewOnDialpadButtonClicked',\n\tonCommentShown: 'phoneCallViewOnCommentShown',\n\tonSaveComment: 'phoneCallViewOnSaveComment',\n\tonSetAutoClose: 'phoneCallViewOnSetAutoClose',\n};\n\nconst blankAvatar = '/bitrix/js/im/images/blank.gif';\n\nexport type PhoneCallViewParams = {\n\tdarkMode: boolean,\n\tphoneNumber: ?string,\n\tlineNumber: ?string,\n\tcompanyPhoneNumber: ?string,\n\tdirection: string, /** @see Direction */\n\tuiState: number, /** @see UiState */\n\tbackgroundWorker: BackgroundWorker,\n\tfoldedCallView: FoldedCallView,\n\n\tfromUserId: ?number,\n\ttoUserId: ?number,\n\tconfig: Object,\n\tcallId: ?string,\n\tcrmEntityType: ?string,\n\tcrmEntityId: ?number,\n\tcrmActivityId: ?number,\n\tcrmActivityEditUrl: ?string,\n\tcrmData: ?Object,\n\tcrmBindings: Array,\n\n\tportalCallData: ?Object,\n\tportalCallUserId: ?number,\n\tportalCallQueueName: ?string,\n\n\thasSipPhone: ?boolean,\n\tdeviceCall: ?boolean,\n\tportalCall: ?boolean,\n\tcrm: ?boolean,\n\trecording: ?boolean,\n\tmakeCall: ?boolean,\n\tfolded: ?boolean,\n\tautoFold: ?boolean,\n\ttransfer: ?boolean,\n\n\tstatusText: ?string,\n\tinitialTimestamp: ?number,\n\tevents: EventHandlers,\n\n\tcallListId: ?number,\n\tcallListStatusId: ?number,\n\tcallListItemIndex: ?number,\n\twebformId: ?string,\n\twebformSecCode: ?string,\n\tslave: ?boolean,\n\tskipOnResize: ?boolean,\n\n\tisExternalCall: ?boolean,\n\tisDesktop: ?boolean,\n\n\trestApps: RestApp[],\n}\n\ntype EventHandlers = {\n\thold: () => void,\n\tunhold: () => void,\n\tmute: () => void,\n\tunmute: () => void,\n\tmakeCall: () => void,\n\tcallListMakeCall: () => void,\n\tanswer: () => void,\n\tskip: () => void,\n\thangup: () => void,\n\tclose: () => void,\n\ttransfer: (TransferTarget) => void,\n\tcompleteTransfer: () => void,\n\tcancelTransfer: () => void,\n\tswitchDevice: () => void,\n\tqualityGraded: () => void,\n\tdialpadButtonClicked: () => void,\n\tsaveComment: () => void,\n\tnotifyAdmin: () => void\n}\n\ntype RestApp = {\n\tid: number,\n\tname: string\n}\n\nexport class PhoneCallView\n{\n\tpopup: ?Popup\n\trestApps: RestApp[]\n\tformManager: ?FormManager\n\tfoldedCallView: FoldedCallView\n\tmessengerFacade: ?MessengerFacade\n\tbackgroundWorker: BackgroundWorker\n\n\tconstructor(params: PhoneCallViewParams)\n\t{\n\t\tthis.id = 'im-phone-call-view';\n\t\tthis.darkMode = params.darkMode === true;\n\n\t\t//params\n\t\tthis.phoneNumber = params.phoneNumber || 'hidden';\n\t\tthis.lineNumber = params.lineNumber || '';\n\t\tthis.companyPhoneNumber = params.companyPhoneNumber || '';\n\t\tthis.direction = params.direction || Direction.incoming;\n\t\tthis.fromUserId = params.fromUserId;\n\t\tthis.toUserId = params.toUserId;\n\t\tthis.config = params.config || {};\n\t\tthis.callId = params.callId || '';\n\t\tthis.callState = CallState.idle;\n\n\t\t//associated crm entities\n\t\tthis.crmEntityType = BX.prop.getString(params, 'crmEntityType', '');\n\t\tthis.crmEntityId = BX.prop.getInteger(params, 'crmEntityId', 0);\n\t\tthis.crmActivityId = BX.prop.getInteger(params, 'crmActivityId', 0);\n\t\tthis.crmActivityEditUrl = BX.prop.getString(params, 'crmActivityEditUrl', '');\n\t\tthis.crmData = BX.prop.getObject(params, 'crmData', {});\n\t\tthis.crmBindings = BX.prop.getArray(params, 'crmBindings', []);\n\t\tthis.externalRequests = {};\n\n\t\t//portal call\n\t\tthis.portalCallData = params.portalCallData;\n\t\tthis.portalCallUserId = params.portalCallUserId;\n\t\tthis.portalCallQueueName = params.portalCallQueueName;\n\n\t\t//flags\n\t\tthis.hasSipPhone = (params.hasSipPhone === true);\n\t\tthis.deviceCall = (params.deviceCall === true);\n\t\tthis.portalCall = (params.portalCall === true);\n\t\tthis.crm = (params.crm === true);\n\t\tthis.held = false;\n\t\tthis.muted = false;\n\t\tthis.recording = (params.recording === true);\n\t\tthis.makeCall = (params.makeCall === true); // emulate pressing on \"dial\" button right after showing call view\n\t\tthis.closable = false;\n\t\tthis.allowAutoClose = true;\n\t\tthis.folded = (params.folded === true);\n\t\tthis.autoFold = (params.autoFold === true);\n\t\tthis.transfer = (params.transfer === true);\n\n\t\tthis.title = '';\n\t\tthis._uiState = params.uiState || UiState.idle;\n\t\tthis.statusText = params.statusText || '';\n\t\tthis.progress = '';\n\t\tthis.quality = 0;\n\t\tthis.qualityPopup = null;\n\t\tthis.qualityGrade = 0;\n\t\tthis.comment = '';\n\t\tthis.commentShown = false;\n\n\t\t//timer\n\t\tthis.initialTimestamp = params.initialTimestamp || 0;\n\t\tthis.timerInterval = null;\n\n\t\tthis.elements = this.getInitialElements();\n\t\tthis.sections = this.getInitialSections();\n\n\t\tvar uiStateButtons = this.getUiStateButtons(this._uiState);\n\t\tthis.buttonLayout = uiStateButtons.layout;\n\t\tthis.buttons = uiStateButtons.buttons;\n\n\t\tthis.restApps = params.restApps || [];\n\n\t\tif (!Type.isPlainObject(params.events))\n\t\t{\n\t\t\tparams.events = {};\n\t\t}\n\n\t\tthis.callbacks = {\n\t\t\thold: Type.isFunction(params.events.hold) ? params.events.hold : nop,\n\t\t\tunhold: Type.isFunction(params.events.unhold) ? params.events.unhold : nop,\n\t\t\tmute: Type.isFunction(params.events.mute) ? params.events.mute : nop,\n\t\t\tunmute: Type.isFunction(params.events.unmute) ? params.events.unmute : nop,\n\t\t\tmakeCall: Type.isFunction(params.events.makeCall) ? params.events.makeCall : nop,\n\t\t\tcallListMakeCall: Type.isFunction(params.events.callListMakeCall) ? params.events.callListMakeCall : nop,\n\t\t\tanswer: Type.isFunction(params.events.answer) ? params.events.answer : nop,\n\t\t\tskip: Type.isFunction(params.events.skip) ? params.events.skip : nop,\n\t\t\thangup: Type.isFunction(params.events.hangup) ? params.events.hangup : nop,\n\t\t\tclose: Type.isFunction(params.events.close) ? params.events.close : nop,\n\t\t\ttransfer: Type.isFunction(params.events.transfer) ? params.events.transfer : nop,\n\t\t\tcompleteTransfer: Type.isFunction(params.events.completeTransfer) ? params.events.completeTransfer : nop,\n\t\t\tcancelTransfer: Type.isFunction(params.events.cancelTransfer) ? params.events.cancelTransfer : nop,\n\t\t\tswitchDevice: Type.isFunction(params.events.switchDevice) ? params.events.switchDevice : nop,\n\t\t\tqualityGraded: Type.isFunction(params.events.qualityGraded) ? params.events.qualityGraded : nop,\n\t\t\tdialpadButtonClicked: Type.isFunction(params.events.dialpadButtonClicked) ? params.events.dialpadButtonClicked : nop,\n\t\t\tsaveComment: Type.isFunction(params.events.saveComment) ? params.events.saveComment : nop,\n\t\t\tnotifyAdmin: Type.isFunction(params.events.notifyAdmin) ? params.events.notifyAdmin : nop,\n\t\t};\n\n\t\tthis.popup = null;\n\n\t\t// event handlers\n\t\tthis._onBeforeUnloadHandler = this._onBeforeUnload.bind(this);\n\t\tthis._onDblClickHandler = this._onDblClick.bind(this);\n\t\tthis._onHoldButtonClickHandler = this._onHoldButtonClick.bind(this);\n\t\tthis._onMuteButtonClickHandler = this._onMuteButtonClick.bind(this);\n\t\tthis._onTransferButtonClickHandler = this._onTransferButtonClick.bind(this);\n\t\tthis._onTransferCompleteButtonClickHandler = this._onTransferCompleteButtonClick.bind(this);\n\t\tthis._onTransferCancelButtonClickHandler = this._onTransferCancelButtonClick.bind(this);\n\t\tthis._onDialpadButtonClickHandler = this._onDialpadButtonClick.bind(this);\n\t\tthis._onHangupButtonClickHandler = this._onHangupButtonClick.bind(this);\n\t\tthis._onCloseButtonClickHandler = this._onCloseButtonClick.bind(this);\n\t\tthis._onMakeCallButtonClickHandler = this._onMakeCallButtonClick.bind(this);\n\t\tthis._onNextButtonClickHandler = this._onNextButtonClick.bind(this);\n\t\tthis._onRedialButtonClickHandler = this._onRedialButtonClick.bind(this);\n\t\tthis._onFoldButtonClickHandler = this._onFoldButtonClick.bind(this);\n\t\tthis._onAnswerButtonClickHandler = this._onAnswerButtonClick.bind(this);\n\t\tthis._onSkipButtonClickHandler = this._onSkipButtonClick.bind(this);\n\t\tthis._onSwitchDeviceButtonClickHandler = this._onSwitchDeviceButtonClick.bind(this);\n\t\tthis._onQualityMeterClickHandler = this._onQualityMeterClick.bind(this);\n\t\tthis._onPullEventCrmHandler = this._onPullEventCrm.bind(this);\n\n\t\t// tabs\n\t\tthis.hiddenTabs = [];\n\t\tthis.currentTabName = '';\n\t\tthis.moreTabsMenu = null;\n\n\t\t// callList\n\t\tthis.callListId = params.callListId || 0;\n\t\tthis.callListStatusId = params.callListStatusId || null;\n\t\tthis.callListItemIndex = params.callListItemIndex || null;\n\t\tthis.callListView = null;\n\t\tthis.currentEntity = null;\n\t\tthis.callingEntity = null;\n\t\tthis.numberSelectMenu = null;\n\n\t\t// webform\n\t\tthis.webformId = params.webformId || 0;\n\t\tthis.webformSecCode = params.webformSecCode || '';\n\t\tthis.webformLoaded = false;\n\n\t\t// partner data\n\t\tthis.restAppLayoutLoaded = false;\n\t\tthis.restAppLayoutLoading = false;\n\t\tthis.restAppInterface = null;\n\n\t\t// desktop integration\n\t\tthis.callWindow = null;\n\t\tthis.slave = params.slave === true;\n\t\tthis.skipOnResize = params.skipOnResize === true;\n\t\tthis.desktop = new Desktop({\n\t\t\tparentPhoneCallView: this,\n\t\t\tclosable: (this.callListId > 0 ? true : this.closable),\n\t\t});\n\n\t\tthis.currentLayout = (this.callListId > 0 ? layouts.crm : layouts.simple);\n\n\t\tthis.backgroundWorker = params.backgroundWorker;\n\t\tthis.backgroundWorker.setCallCard(this);\n\t\tthis.backgroundWorker.setExternalCall(!!params.isExternalCall);\n\n\t\tthis._isDesktop = params.messengerFacade ? params.messengerFacade.isDesktop() : params.isDesktop === true;\n\t\tthis.messengerFacade = params.messengerFacade;\n\t\tthis.foldedCallView = params.foldedCallView;\n\n\t\tthis.init();\n\n\t\tif (this.backgroundWorker.isDesktop())\n\t\t{\n\t\t\tthis.backgroundWorker.removeDesktopEventHandlers();\n\t\t}\n\t\tthis.backgroundWorker.platformWorker.emitInitializeEvent(this.getPlacementOptions());\n\t\tthis.createTitle().then(title => this.setTitle(title));\n\t\tif (params.hasOwnProperty('uiState'))\n\t\t{\n\t\t\tthis.setUiState(params['uiState']);\n\t\t}\n\t}\n\n\tgetInitialElements()\n\t{\n\t\treturn {\n\t\t\tmain: null,\n\t\t\ttitle: null,\n\t\t\tsections: {\n\t\t\t\tstatus: null,\n\t\t\t\ttimer: null,\n\t\t\t\tcrmButtons: null,\n\t\t\t},\n\t\t\tavatar: null,\n\t\t\tprogress: null,\n\t\t\ttimer: null,\n\t\t\tstatus: null,\n\t\t\tcommentEditorContainer: null,\n\t\t\tcommentEditor: null,\n\t\t\tqualityMeter: null,\n\t\t\tcrmCard: null,\n\t\t\tcrmButtonsContainer: null,\n\t\t\tcrmButtons: {},\n\t\t\tbuttonsContainer: null,\n\t\t\ttopLevelButtonsContainer: null,\n\t\t\ttopButtonsContainer: null, //well..\n\t\t\tbuttons: {},\n\t\t\tsidebarContainer: null,\n\t\t\ttabsContainer: null,\n\t\t\ttabsBodyContainer: null,\n\t\t\ttabs: {\n\t\t\t\tcallList: null,\n\t\t\t\twebform: null,\n\t\t\t\tapp: null\n\t\t\t},\n\t\t\ttabsBody: {\n\t\t\t\tcallList: null,\n\t\t\t\twebform: null,\n\t\t\t\tapp: null\n\t\t\t},\n\t\t\tmoreTabs: null\n\t\t};\n\t};\n\n\tgetInitialSections()\n\t{\n\t\treturn {\n\t\t\tstatus: {visible: false},\n\t\t\ttimer: {visible: false},\n\t\t\tcrmButtons: {visible: false},\n\t\t\tcommentEditor: {visible: false}\n\t\t}\n\t};\n\n\tinit()\n\t{\n\t\tif (DesktopApi.isChatWindow() && !this.slave)\n\t\t{\n\t\t\tconsole.log('Init phone call view window:', location.href);\n\t\t\tthis.desktop.openCallWindow('', null, {\n\t\t\t\twidth: this.getInitialWidth(),\n\t\t\t\theight: this.getInitialHeight(),\n\t\t\t\tresizable: (this.currentLayout == layouts.crm),\n\t\t\t\tminWidth: this.elements.sidebarContainer ? 950 : 550,\n\t\t\t\tminHeight: 650\n\t\t\t});\n\t\t\tthis.bindMasterDesktopEvents();\n\n\t\t\twindow.addEventListener('beforeunload', this.#onWindowUnload); //master window unload\n\t\t\treturn;\n\t\t}\n\n\t\tthis.elements.main = this.createLayout();\n\t\tthis.updateView();\n\n\t\tif (this.isDesktop())\n\t\t{\n\t\t\tdocument.body.appendChild(this.elements.main);\n\t\t\tthis.bindSlaveDesktopEvents();\n\t\t}\n\t\telse if (this.isFolded())\n\t\t{\n\t\t\tdocument.body.appendChild(this.elements.main);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.popup = this.createPopup();\n\t\t\tBX.addCustomEvent(window, \"onLocalStorageSet\", this.#onExternalEvent);\n\t\t}\n\n\t\tif (this.callListId > 0)\n\t\t{\n\t\t\tif (this.callListView)\n\t\t\t{\n\t\t\t\tthis.callListView.reinit({\n\t\t\t\t\tnode: this.elements.tabsBody.callList\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.callListView = new CallList({\n\t\t\t\t\tnode: this.elements.tabsBody.callList,\n\t\t\t\t\tid: this.callListId,\n\t\t\t\t\tstatusId: this.callListStatusId,\n\t\t\t\t\titemIndex: this.callListItemIndex,\n\t\t\t\t\tmakeCall: this.makeCall,\n\t\t\t\t\tisDesktop: this.isDesktop,\n\t\t\t\t\tonSelectedItem: this.onCallListSelectedItem.bind(this)\n\t\t\t\t});\n\n\t\t\t\tthis.callListView.init(() =>\n\t\t\t\t{\n\t\t\t\t\tif (this.makeCall)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._onMakeCallButtonClick();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis.setUiState(UiState.outgoing);\n\t\t\t}\n\t\t}\n\t\telse if (this.crm && !this.isFolded())\n\t\t{\n\t\t\tthis.loadCrmCard(this.crmEntityType, this.crmEntityId);\n\t\t}\n\n\t\tBX.addCustomEvent(\"onPullEvent-crm\", this._onPullEventCrmHandler);\n\t\tif (!this.isDesktop())\n\t\t{\n\t\t\twindow.addEventListener('beforeunload', this._onBeforeUnloadHandler);\n\t\t}\n\t};\n\n\treinit()\n\t{\n\t\tthis.elements = this.getInitialElements();\n\n\t\twindow.removeEventListener('beforeunload', this._unloadHandler);\n\t\tBX.removeCustomEvent(window, \"onLocalStorageSet\", this._externalEventHandler);\n\t\tBX.removeCustomEvent(\"onPullEvent-crm\", this._onPullEventCrmHandler);\n\n\t\tthis.init();\n\t};\n\n\tshow()\n\t{\n\t\tif (!this.popup && this.isDesktop())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!this.popup)\n\t\t{\n\t\t\tthis.reinit();\n\t\t}\n\n\t\tif (!this.isDesktop() && !this.isFolded())\n\t\t{\n\t\t\tthis.disableDocumentScroll();\n\t\t}\n\n\t\tthis.popup.show();\n\t\tBX.localStorage.set(lsKeys.callView, this.callId, 86400);\n\n\t\treturn this;\n\t};\n\n\tcreatePopup(): Popup\n\t{\n\t\treturn new Popup({\n\t\t\tid: this.getId(),\n\t\t\tbindElement: null,\n\t\t\ttargetContainer: document.body,\n\t\t\tcontent: this.elements.main,\n\t\t\tcloseIcon: false,\n\t\t\tnoAllPaddings: true,\n\t\t\tzIndex: baseZIndex,\n\t\t\toffsetLeft: 0,\n\t\t\toffsetTop: 0,\n\t\t\tcloseByEsc: false,\n\t\t\tdraggable: {restrict: false},\n\t\t\toverlay: {backgroundColor: 'black', opacity: 30},\n\t\t\tevents: {\n\t\t\t\tonPopupClose: () =>\n\t\t\t\t{\n\t\t\t\t\tif (this.isFolded())\n\t\t\t\t\t{\n\t\t\t\t\t\t// this.destroy();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.callbacks.close();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonPopupDestroy: () => this.popup = null\n\t\t\t}\n\t\t});\n\t};\n\n\tcreateLayout()\n\t{\n\t\tif (this.isFolded())\n\t\t{\n\t\t\treturn this.createLayoutFolded();\n\t\t}\n\t\telse if (this.currentLayout == layouts.crm)\n\t\t{\n\t\t\treturn this.createLayoutCrm();\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.createLayoutSimple();\n\t\t}\n\t};\n\n\tcreateLayoutCrm()\n\t{\n\t\tvar result = Dom.create(\"div\", {\n\t\t\tprops: {className: 'im-phone-call-top-level'},\n\t\t\tevents: {\n\t\t\t\tdblclick: this._onDblClickHandler\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tthis.elements.topLevelButtonsContainer = Dom.create(\"div\"),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-wrapper' + (this.hasSideBar() ? '' : ' im-phone-call-wrapper-without-sidebar')},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-container' + (this.hasSideBar() ? '' : ' im-phone-call-container-without-sidebar')},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-header-container'}, children: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-header'}, children: [\n\t\t\t\t\t\t\t\t\t\t\t\tthis.elements.title = Dom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-title-text'},\n\t\t\t\t\t\t\t\t\t\t\t\t\thtml: this.renderTitle()\n\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.crmCard = Dom.create(\"div\", {props: {className: 'im-phone-call-crm-card'}}),\n\t\t\t\t\t\t\t\tthis.elements.sections.status = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-section'},\n\t\t\t\t\t\t\t\t\tstyle: this.sections.status.visible ? {} : {display: 'none'},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-status-description'}, children: [\n\t\t\t\t\t\t\t\t\t\t\t\tthis.elements.status = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-status-description-item'},\n\t\t\t\t\t\t\t\t\t\t\t\t\ttext: this.statusText\n\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.sections.timer = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-section'},\n\t\t\t\t\t\t\t\t\tstyle: this.sections.timer.visible ? {} : {display: 'none'},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-status-timer'}, children: [\n\t\t\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-status-timer-item'}, children: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.elements.timer = Dom.create(\"span\")\n\t\t\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.commentEditorContainer = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-section'},\n\t\t\t\t\t\t\t\t\tstyle: this.commentShown ? {} : {display: 'none'},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-comments'}, children: [\n\t\t\t\t\t\t\t\t\t\t\t\tthis.elements.commentEditor = Dom.create(\"textarea\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName: 'im-phone-call-comments-textarea',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvalue: this.comment,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tplaceholder: Loc.getMessage('IM_PHONE_CALL_COMMENT_PLACEHOLDER')\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tbxchange: this._onCommentChanged.bind(this)\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.sections.crmButtons = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-section'},\n\t\t\t\t\t\t\t\t\tstyle: this.sections.crmButtons.visible ? {} : {display: 'none'},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tthis.elements.crmButtonsContainer = Dom.create(\"div\", {props: {className: 'im-phone-call-crm-buttons'}})\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.buttonsContainer = Dom.create(\"div\", {props: {className: 'im-phone-call-buttons-container'}}),\n\t\t\t\t\t\t\t\tthis.elements.topButtonsContainer = Dom.create(\"div\", {props: {className: 'im-phone-call-buttons-container-top'}})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\n\t\tif (this.hasSideBar())\n\t\t{\n\t\t\tthis.createSidebarLayout();\n\t\t\tif (this.elements.sidebarContainer)\n\t\t\t{\n\t\t\t\tresult.appendChild(this.elements.sidebarContainer);\n\t\t\t}\n\n\t\t\tsetTimeout(() => this.checkMoreButton(), 0);\n\t\t}\n\n\t\tif (this.isDesktop())\n\t\t{\n\t\t\tresult.style.position = 'fixed';\n\t\t\tresult.style.top = 0;\n\t\t\tresult.style.bottom = 0;\n\t\t\tresult.style.left = 0;\n\t\t\tresult.style.right = 0;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult.style.width = this.getInitialWidth() + 'px';\n\t\t\tresult.style.height = this.getInitialHeight() + 'px';\n\t\t}\n\n\t\treturn result;\n\t};\n\n\t/**\n\t * @return boolean\n\t */\n\thasSideBar()\n\t{\n\t\tif (this.isDesktop() && !this.desktop.isFeatureSupported('iframe'))\n\t\t{\n\t\t\treturn this.callListId > 0;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn (this.callListId > 0 || this.webformId > 0 || this.restApps.length > 0);\n\t\t}\n\t};\n\n\tgetInitialWidth()\n\t{\n\t\tconst storedWidth = (window.localStorage) ? parseInt(window.localStorage.getItem(lsKeys.width)) : 0;\n\n\t\tif (this.currentLayout == layouts.simple)\n\t\t{\n\t\t\treturn initialSize.simple.width;\n\t\t}\n\t\telse if (this.hasSideBar())\n\t\t{\n\t\t\tif (storedWidth > 0)\n\t\t\t{\n\t\t\t\treturn storedWidth;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn Math.min(Math.floor(screen.width * 0.8), 1200);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn initialSize.crm.width;\n\t\t}\n\t};\n\n\tgetInitialHeight()\n\t{\n\t\tconst storedHeight = (window.localStorage) ? parseInt(window.localStorage.getItem(lsKeys.height)) : 0;\n\n\t\tif (this.currentLayout == layouts.simple)\n\t\t{\n\t\t\treturn initialSize.simple.height\n\t\t}\n\t\telse if (storedHeight > 0)\n\t\t{\n\t\t\treturn storedHeight;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn initialSize.crm.height;\n\t\t}\n\t};\n\n\tsaveInitialSize(width, height)\n\t{\n\t\tif (!window.localStorage)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.currentLayout == layouts.crm)\n\t\t{\n\t\t\twindow.localStorage.setItem(lsKeys.height, height.toString());\n\t\t\tif (this.hasSideBar())\n\t\t\t{\n\t\t\t\twindow.localStorage.setItem(lsKeys.width, width);\n\t\t\t}\n\t\t}\n\t};\n\n\tshowSections(sections)\n\t{\n\t\tif (!Type.isArray(sections))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tsections.forEach((sectionName) =>\n\t\t{\n\t\t\tif (this.elements.sections[sectionName])\n\t\t\t{\n\t\t\t\tthis.elements.sections[sectionName].style.removeProperty('display');\n\t\t\t}\n\n\t\t\tif (this.sections[sectionName])\n\t\t\t{\n\t\t\t\tthis.sections[sectionName].visible = true;\n\t\t\t}\n\t\t});\n\t};\n\n\thideSections(sections)\n\t{\n\t\tif (!Type.isArray(sections))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tsections.forEach((sectionName) =>\n\t\t{\n\t\t\tif (this.elements.sections[sectionName])\n\t\t\t{\n\t\t\t\tthis.elements.sections[sectionName].style.display = 'none';\n\t\t\t}\n\n\t\t\tif (this.sections[sectionName])\n\t\t\t{\n\t\t\t\tthis.sections[sectionName].visible = false;\n\t\t\t}\n\t\t});\n\t};\n\n\tshowOnlySections(sections)\n\t{\n\t\tif (!Type.isArray(sections))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet sectionsIndex = {};\n\t\tsections.forEach(sectionName => sectionsIndex[sectionName] = true);\n\n\t\tfor (var sectionName in this.elements.sections)\n\t\t{\n\t\t\tif (!this.elements.sections.hasOwnProperty(sectionName) || !Type.isDomNode(this.elements.sections[sectionName]))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (sectionsIndex[sectionName])\n\t\t\t{\n\t\t\t\tthis.elements.sections[sectionName].style.removeProperty('display');\n\t\t\t\tif (this.sections.hasOwnProperty(sectionName))\n\t\t\t\t{\n\t\t\t\t\tthis.sections[sectionName].visible = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.elements.sections[sectionName].style.display = 'none';\n\t\t\t\tif (this.sections.hasOwnProperty(sectionName))\n\t\t\t\t{\n\t\t\t\t\tthis.sections[sectionName].visible = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tcreateSidebarLayout()\n\t{\n\t\tlet tabs = [];\n\t\tlet tabsBody = [];\n\n\t\tif (this.callListId > 0)\n\t\t{\n\t\t\tthis.elements.tabs.callList = Dom.create(\"span\", {\n\t\t\t\tprops: {className: 'im-phone-sidebar-tab'},\n\t\t\t\tdataset: {tabId: 'callList', tabBodyId: 'callList'},\n\t\t\t\ttext: Loc.getMessage('IM_PHONE_CALL_VIEW_CALL_LIST_TITLE'),\n\t\t\t\tevents: {click: this._onTabHeaderClick.bind(this)}\n\t\t\t});\n\t\t\ttabs.push(this.elements.tabs.callList);\n\t\t\tthis.elements.tabsBody.callList = Dom.create('div');\n\t\t\ttabsBody.push(this.elements.tabsBody.callList);\n\t\t}\n\n\t\tif (this.webformId > 0 && this.isWebformSupported())\n\t\t{\n\t\t\tthis.elements.tabs.webform = Dom.create(\"span\", {\n\t\t\t\tprops: {className: 'im-phone-sidebar-tab'},\n\t\t\t\tdataset: {tabId: 'webform', tabBodyId: 'webform'},\n\t\t\t\ttext: Loc.getMessage('IM_PHONE_CALL_VIEW_WEBFORM_TITLE'),\n\t\t\t\tevents: {click: this._onTabHeaderClick.bind(this)}\n\t\t\t});\n\t\t\ttabs.push(this.elements.tabs.webform);\n\t\t\tthis.elements.tabsBody.webform = Dom.create('div', {props: {className: 'im-phone-call-form-container'}});\n\t\t\ttabsBody.push(this.elements.tabsBody.webform);\n\n\t\t\tthis.formManager = new FormManager({\n\t\t\t\tnode: this.elements.tabsBody.webform,\n\t\t\t\tonFormSend: this._onFormSend.bind(this)\n\t\t\t})\n\t\t}\n\n\t\tif (this.restApps.length > 0 && this.isRestAppsSupported())\n\t\t{\n\t\t\tthis.restApps.forEach((restApp) =>\n\t\t\t{\n\t\t\t\tconst restAppId = restApp.id;\n\t\t\t\tconst tabId = 'restApp' + restAppId;\n\t\t\t\tthis.elements.tabs[tabId] = Dom.create(\"span\", {\n\t\t\t\t\tprops: {className: 'im-phone-sidebar-tab'},\n\t\t\t\t\tdataset: {tabId: tabId, tabBodyId: 'app', restAppId: restAppId},\n\t\t\t\t\ttext: Text.encode(restApp.name),\n\t\t\t\t\tevents: {click: this._onTabHeaderClick.bind(this)}\n\t\t\t\t});\n\t\t\t\ttabs.push(this.elements.tabs[tabId]);\n\n\t\t\t});\n\t\t\tthis.elements.tabsBody.app = Dom.create('div', {props: {className: 'im-phone-call-app-container'}});\n\t\t\ttabsBody.push(this.elements.tabsBody.app);\n\t\t}\n\n\t\tthis.elements.sidebarContainer = Dom.create(\"div\", {\n\t\t\tprops: {className: 'im-phone-sidebar-wrap'}, children: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-sidebar-tabs-container'}, children: [\n\t\t\t\t\t\tthis.elements.tabsContainer = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-sidebar-tabs-left'},\n\t\t\t\t\t\t\tchildren: tabs\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-sidebar-tabs-right'}, children: [\n\t\t\t\t\t\t\t\tthis.elements.moreTabs = Dom.create(\"span\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-sidebar-tab im-phone-sidebar-tab-more'},\n\t\t\t\t\t\t\t\t\tstyle: {display: 'none'},\n\t\t\t\t\t\t\t\t\tdataset: {},\n\t\t\t\t\t\t\t\t\ttext: Loc.getMessage('IM_PHONE_CALL_VIEW_MORE'),\n\t\t\t\t\t\t\t\t\tevents: {click: this._onTabMoreClick.bind(this)}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tthis.elements.tabsBodyContainer = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-sidebar-tabs-body-container'},\n\t\t\t\t\tchildren: tabsBody\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\n\t\tif (this.callListId > 0)\n\t\t{\n\t\t\tthis.setActiveTab({tabId: 'callList', tabBodyId: 'callList'});\n\t\t}\n\t\telse if (this.webformId > 0 && this.isWebformSupported())\n\t\t{\n\t\t\tthis.setActiveTab({tabId: 'webform', tabBodyId: 'webform'});\n\t\t}\n\t\telse if (this.restApps.length > 0 && this.isRestAppsSupported())\n\t\t{\n\t\t\tthis.setActiveTab({\n\t\t\t\ttabId: 'restApp' + this.restApps[0].id,\n\t\t\t\ttabBodyId: 'app',\n\t\t\t\trestAppId: this.restApps[0].id\n\t\t\t});\n\t\t}\n\t};\n\n\tcreateLayoutSimple()\n\t{\n\t\tvar portalCallUserImage = '';\n\t\tif (this.isPortalCall()\n\t\t\t&& this.portalCallData.hrphoto\n\t\t\t&& this.portalCallData.hrphoto[this.portalCallUserId]\n\t\t\t&& this.portalCallData.hrphoto[this.portalCallUserId] != blankAvatar\n\t\t)\n\t\t{\n\t\t\tportalCallUserImage = this.portalCallData.hrphoto[this.portalCallUserId];\n\t\t}\n\t\tvar result = Dom.create(\"div\", {\n\t\t\tprops: {className: 'im-phone-call-wrapper'}, children: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'im-phone-call-container'}, children: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-calling-section'}, children: [\n\t\t\t\t\t\t\t\tthis.elements.title = Dom.create(\"div\", {props: {className: 'im-phone-calling-text'}})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-section im-phone-calling-progress-section'}, children: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-calling-progress-container'}, children: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-calling-progress-container-block-l'},\n\t\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {props: {className: 'im-phone-calling-progress-phone'}})\n\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tthis.elements.progress = Dom.create(\"div\", {props: {className: 'im-phone-calling-progress-container-block-c'}}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-calling-progress-container-block-r'},\n\t\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t\tthis.elements.avatar = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-calling-progress-customer'},\n\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: Type.isStringFilled(portalCallUserImage) ? {'background-image': 'url(\\'' + portalCallUserImage + '\\')'} : {}\n\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-section'}, children: [\n\t\t\t\t\t\t\t\tthis.elements.status = Dom.create(\"div\", {props: {className: 'im-phone-calling-process-status'}})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.buttonsContainer = Dom.create(\"div\", {props: {className: 'im-phone-call-buttons-container'}}),\n\t\t\t\t\t\tthis.elements.topButtonsContainer = Dom.create(\"div\", {props: {className: 'im-phone-call-buttons-container-top'}})\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\n\t\tresult.style.width = this.getInitialWidth() + 'px';\n\t\tresult.style.height = this.getInitialHeight() + 'px';\n\n\t\treturn result;\n\t};\n\n\tcreateLayoutFolded()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"im-phone-call-panel-mini\"},\n\t\t\tstyle: {zIndex: baseZIndex},\n\t\t\tchildren: [\n\t\t\t\tthis.elements.sections.timer = this.elements.timer = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"im-phone-call-panel-mini-time\"},\n\t\t\t\t\tstyle: this.sections.timer.visible ? {} : {display: 'none'}\n\t\t\t\t}),\n\t\t\t\tthis.elements.buttonsContainer = Dom.create(\"div\", {props: {className: 'im-phone-call-panel-mini-buttons'}}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"im-phone-call-panel-mini-expand\"},\n\t\t\t\t\tevents: {click: () => this.unfold()}\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t};\n\n\tsetActiveTab(params)\n\t{\n\t\tconst tabId = params.tabId;\n\t\tconst tabBodyId = params.tabBodyId;\n\t\tconst restAppId = params.restAppId || '';\n\t\tparams.hidden = params.hidden === true;\n\t\tfor (let tab in this.elements.tabs)\n\t\t{\n\t\t\tif (this.elements.tabs.hasOwnProperty(tab) && Type.isDomNode(this.elements.tabs[tab]))\n\t\t\t{\n\t\t\t\tthis.elements.tabs[tab].classList.toggle('im-phone-sidebar-tab-active', tab == tabId)\n\t\t\t}\n\t\t}\n\n\t\tthis.elements.moreTabs.classList.toggle('im-phone-sidebar-tab-active', params.hidden);\n\n\t\tfor (let tab in this.elements.tabsBody)\n\t\t{\n\t\t\tif (this.elements.tabsBody.hasOwnProperty(tab) && Type.isDomNode(this.elements.tabsBody[tab]))\n\t\t\t{\n\t\t\t\tif (tab == tabBodyId)\n\t\t\t\t{\n\t\t\t\t\tthis.elements.tabsBody[tab].style.removeProperty('display');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.elements.tabsBody[tab].style.display = 'none';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.currentTabName = tabId;\n\n\t\tif (tabId === 'webform' && !this.webformLoaded)\n\t\t{\n\t\t\tthis.loadForm({\n\t\t\t\tid: this.webformId,\n\t\t\t\tsecCode: this.webformSecCode\n\t\t\t})\n\t\t}\n\n\t\tif (restAppId !== '')\n\t\t{\n\t\t\tthis.loadRestApp({\n\t\t\t\tid: restAppId,\n\t\t\t\tcallId: this.callId,\n\t\t\t\tnode: this.elements.tabsBody.app\n\t\t\t});\n\t\t}\n\t};\n\n\tisCurrentTabHidden()\n\t{\n\t\tlet result = false;\n\t\tfor (let i = 0; i < this.hiddenTabs.length; i++)\n\t\t{\n\t\t\tif (this.hiddenTabs[i].dataset.tabId == this.currentTabName)\n\t\t\t{\n\t\t\t\tresult = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t};\n\n\tcheckMoreButton()\n\t{\n\t\tif (!this.elements.tabsContainer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvar tabs = this.elements.tabsContainer.children;\n\t\tvar currentTab;\n\t\tthis.hiddenTabs = [];\n\n\t\tfor (var i = 0; i < tabs.length; i++)\n\t\t{\n\t\t\tcurrentTab = tabs.item(i);\n\t\t\tif (currentTab.offsetTop > 7)\n\t\t\t{\n\t\t\t\tthis.hiddenTabs.push(currentTab);\n\t\t\t}\n\t\t}\n\t\tif (this.hiddenTabs.length > 0)\n\t\t{\n\t\t\tthis.elements.moreTabs.style.removeProperty('display');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.moreTabs.style.display = 'none';\n\t\t}\n\n\t\tif (this.isCurrentTabHidden())\n\t\t{\n\t\t\tDom.addClass(this.elements.moreTabs, 'im-phone-sidebar-tab-active');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.removeClass(this.elements.moreTabs, 'im-phone-sidebar-tab-active');\n\t\t}\n\t};\n\n\t_onTabHeaderClick(e)\n\t{\n\t\tif (this.moreTabsMenu)\n\t\t{\n\t\t\tthis.moreTabsMenu.close();\n\t\t}\n\n\t\tthis.setActiveTab({\n\t\t\ttabId: e.target.dataset.tabId,\n\t\t\ttabBodyId: e.target.dataset.tabBodyId,\n\t\t\trestAppId: e.target.dataset.restAppId || '',\n\t\t\thidden: false\n\t\t});\n\t};\n\n\t_onTabMoreClick()\n\t{\n\t\tif (this.hiddenTabs.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.moreTabsMenu)\n\t\t{\n\t\t\tthis.moreTabsMenu.close();\n\t\t\treturn;\n\t\t}\n\n\t\tvar menuItems = [];\n\t\tthis.hiddenTabs.forEach((tabElement) =>\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\tid: \"selectTab_\" + tabElement.dataset.tabId,\n\t\t\t\ttext: tabElement.innerText,\n\t\t\t\tonclick: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.moreTabsMenu.close();\n\t\t\t\t\tthis.setActiveTab({\n\t\t\t\t\t\ttabId: tabElement.dataset.tabId,\n\t\t\t\t\t\ttabBodyId: tabElement.dataset.tabBodyId,\n\t\t\t\t\t\trestAppId: tabElement.dataset.restAppId || '',\n\t\t\t\t\t\thidden: true\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t});\n\n\t\tthis.moreTabsMenu = new Menu(\n\t\t\t'phoneCallViewMoreTabs',\n\t\t\tthis.elements.moreTabs,\n\t\t\tmenuItems,\n\t\t\t{\n\t\t\t\tautoHide: true,\n\t\t\t\toffsetTop: 0,\n\t\t\t\toffsetLeft: 0,\n\t\t\t\tangle: {position: \"top\"},\n\t\t\t\tzIndex: baseZIndex + 100,\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose: () => this.moreTabsMenu.destroy(),\n\t\t\t\t\tonPopupDestroy: () => this.moreTabsMenu = null\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t\tthis.moreTabsMenu.show();\n\t};\n\n\tgetId()\n\t{\n\t\treturn this.id;\n\t};\n\n\tcreateTitle()\n\t{\n\t\tlet callTitle = '';\n\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tBX.PhoneNumberParser.getInstance().parse(this.phoneNumber).then((parsedNumber) =>\n\t\t\t{\n\t\t\t\tif (this.phoneNumber == 'unknown')\n\t\t\t\t{\n\t\t\t\t\tresolve(Loc.getMessage('IM_PHONE_CALL_VIEW_NUMBER_UNKNOWN'));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (this.phoneNumber == 'hidden')\n\t\t\t\t{\n\t\t\t\t\tcallTitle = Loc.getMessage('IM_PHONE_HIDDEN_NUMBER');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tcallTitle = this.phoneNumber.toString();\n\n\t\t\t\t\tif (parsedNumber.isValid())\n\t\t\t\t\t{\n\t\t\t\t\t\tcallTitle = parsedNumber.format();\n\n\t\t\t\t\t\tif (parsedNumber.isInternational() && callTitle.charAt(0) != '+')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcallTitle = '+' + callTitle;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tcallTitle = this.phoneNumber.toString();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (this.isCallback())\n\t\t\t\t{\n\t\t\t\t\tcallTitle = Loc.getMessage('IM_PHONE_CALLBACK_TO').replace('#PHONE#', callTitle);\n\t\t\t\t}\n\t\t\t\telse if (this.isPortalCall())\n\t\t\t\t{\n\t\t\t\t\tswitch (this.direction)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase Direction.incoming:\n\t\t\t\t\t\t\tif (this.portalCallUserId)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tcallTitle = Loc.getMessage(\"IM_M_CALL_VOICE_FROM\").replace('#USER#', this.portalCallData.users[this.portalCallUserId].name);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase Direction.outgoing:\n\t\t\t\t\t\t\tif (this.portalCallUserId)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tcallTitle = Loc.getMessage(\"IM_M_CALL_VOICE_TO\").replace('#USER#', this.portalCallData.users[this.portalCallUserId].name);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tcallTitle = Loc.getMessage(\"IM_M_CALL_VOICE_TO\").replace('#USER#', this.portalCallQueueName) + ' (' + this.phoneNumber + ')';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tcallTitle = Loc.getMessage(this.direction === Direction.incoming ? 'IM_PHONE_CALL_VOICE_FROM' : 'IM_PHONE_CALL_VOICE_TO').replace('#PHONE#', callTitle);\n\n\t\t\t\t\tif (this.direction === Direction.incoming && this.companyPhoneNumber)\n\t\t\t\t\t{\n\t\t\t\t\t\tcallTitle = callTitle + ', ' + Loc.getMessage('IM_PHONE_CALL_TO_PHONE').replace('#PHONE#', this.companyPhoneNumber);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.isTransfer())\n\t\t\t\t\t{\n\t\t\t\t\t\tcallTitle = callTitle + ' ' + Loc.getMessage('IM_PHONE_CALL_TRANSFERED');\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tresolve(callTitle);\n\t\t\t});\n\t\t})\n\t};\n\n\trenderTitle()\n\t{\n\t\treturn Text.encode(this.title);\n\t};\n\n\trenderAvatar()\n\t{\n\t\tlet portalCallUserImage = '';\n\t\tif (this.isPortalCall()\n\t\t\t&& this.elements.avatar\n\t\t\t&& this.portalCallData.hrphoto\n\t\t\t&& this.portalCallData.hrphoto[this.portalCallUserId]\n\t\t\t&& this.portalCallData.hrphoto[this.portalCallUserId] != blankAvatar\n\t\t)\n\t\t{\n\t\t\tportalCallUserImage = this.portalCallData.hrphoto[this.portalCallUserId];\n\n\t\t\tDom.adjust(this.elements.avatar, {\n\t\t\t\tstyle: portalCallUserImage === '' ? {} : {'background-image': 'url(\\'' + portalCallUserImage + '\\')'}\n\t\t\t});\n\t\t}\n\t};\n\n\t_getCrmEditUrl(entityTypeName, entityId)\n\t{\n\t\tif (!Type.isStringFilled(entityTypeName))\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\tentityId = Number(entityId);\n\n\t\treturn '/crm/' + entityTypeName.toLowerCase() + '/edit/' + entityId.toString() + '/';\n\t};\n\n\t_generateExternalContext()\n\t{\n\t\treturn this._getRandomString(16);\n\t};\n\n\t_getRandomString(len)\n\t{\n\t\tconst charSet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n\t\tlet randomString = '';\n\t\tfor (let i = 0; i < len; i++)\n\t\t{\n\t\t\tconst randomPoz = Math.floor(Math.random() * charSet.length);\n\t\t\trandomString += charSet.substring(randomPoz, randomPoz + 1);\n\t\t}\n\t\treturn randomString;\n\t};\n\n\tsetPhoneNumber(phoneNumber)\n\t{\n\t\tthis.phoneNumber = phoneNumber;\n\t\tthis.setOnSlave(desktopEvents.setPhoneNumber, [phoneNumber]);\n\t};\n\n\tsetTitle(title)\n\t{\n\t\tthis.title = title;\n\t\tif (this.isDesktop())\n\t\t{\n\t\t\tif (this.slave)\n\t\t\t{\n\t\t\t\tBXDesktopWindow.SetProperty('title', title);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDesktopApi.emit(desktopEvents.setTitle, [title]);\n\t\t\t}\n\t\t}\n\n\t\tif (this.elements.title)\n\t\t{\n\t\t\tthis.elements.title.innerHTML = this.renderTitle();\n\t\t}\n\t};\n\n\tgetTitle()\n\t{\n\t\treturn this.title;\n\t};\n\n\tsetQuality(quality)\n\t{\n\t\tthis.quality = quality;\n\n\t\tif (this.elements.qualityMeter)\n\t\t{\n\t\t\tthis.elements.qualityMeter.style.width = this.getQualityMeterWidth();\n\t\t}\n\t};\n\n\tgetQualityMeterWidth(): string\n\t{\n\t\tif (this.quality > 0 && this.quality <= 5)\n\t\t{\n\t\t\treturn this.quality * 20 + '%';\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn '0';\n\t\t}\n\t};\n\n\tsetProgress(progress: $Keys<typeof CallProgress>)\n\t{\n\t\tif (this.progress === progress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.progress = progress;\n\n\t\tif (!this.elements.progress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.clean(this.elements.progress);\n\t\tthis.elements.progress.appendChild(this.renderProgress(this.progress));\n\t};\n\n\tsetStatusText(statusText)\n\t{\n\t\tif (this.isDesktop() && !this.slave)\n\t\t{\n\t\t\tDesktopApi.emit(desktopEvents.setStatus, [statusText]);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.statusText = statusText;\n\t\tif (this.elements.status)\n\t\t{\n\t\t\tthis.elements.status.innerText = this.statusText;\n\t\t}\n\t};\n\n\tsetConfig(config)\n\t{\n\t\tif (!Type.isPlainObject(config))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.config = config;\n\t\tif (!this.isDesktop() || this.slave)\n\t\t{\n\t\t\tthis.renderCrmButtons();\n\t\t}\n\t\tthis.setOnSlave(desktopEvents.setConfig, [config]);\n\t};\n\n\tsetCallId(callId)\n\t{\n\t\tthis.callId = callId;\n\t\tthis.setOnSlave(desktopEvents.setCallId, [callId]);\n\t};\n\n\tsetLineNumber(lineNumber)\n\t{\n\t\tthis.lineNumber = lineNumber;\n\t\tthis.setOnSlave(desktopEvents.setLineNumber, [lineNumber]);\n\t};\n\n\tsetCompanyPhoneNumber(companyPhoneNumber)\n\t{\n\t\tthis.companyPhoneNumber = companyPhoneNumber;\n\t\tthis.setOnSlave(desktopEvents.setCompanyPhoneNumber, [companyPhoneNumber]);\n\t};\n\n\tsetButtons(buttons, layout)\n\t{\n\t\tif (!ButtonLayouts[layout])\n\t\t{\n\t\t\tlayout = ButtonLayouts.centered;\n\t\t}\n\n\t\tthis.buttonLayout = layout;\n\t\tthis.buttons = buttons;\n\t\tthis.renderButtons();\n\t};\n\n\tsetUiState(uiState)\n\t{\n\t\tthis._uiState = uiState;\n\n\t\tvar stateButtons = this.getUiStateButtons(uiState);\n\t\tthis.buttons = stateButtons.buttons;\n\t\tthis.buttonLayout = stateButtons.layout;\n\n\t\tswitch (uiState)\n\t\t{\n\t\t\tcase UiState.incoming:\n\t\t\t\tthis.setClosable(false);\n\t\t\t\tthis.showOnlySections(['status']);\n\t\t\t\tthis.renderCrmButtons();\n\t\t\t\tthis.stopTimer();\n\t\t\t\tbreak;\n\t\t\tcase UiState.transferIncoming:\n\t\t\t\tthis.setClosable(false);\n\t\t\t\tthis.showOnlySections(['status']);\n\t\t\t\tthis.renderCrmButtons();\n\t\t\t\tthis.stopTimer();\n\t\t\t\tbreak;\n\t\t\tcase UiState.outgoing:\n\t\t\t\tthis.setClosable(true);\n\t\t\t\tthis.showOnlySections(['status']);\n\t\t\t\tthis.renderCrmButtons();\n\t\t\t\tthis.stopTimer();\n\t\t\t\tthis.hideCallIcon();\n\t\t\t\tbreak;\n\t\t\tcase UiState.connectingIncoming:\n\t\t\t\tthis.setClosable(false);\n\t\t\t\tthis.showOnlySections(['status']);\n\t\t\t\tthis.renderCrmButtons();\n\t\t\t\tthis.stopTimer();\n\t\t\t\tbreak;\n\t\t\tcase UiState.connectingOutgoing:\n\t\t\t\tthis.setClosable(false);\n\t\t\t\tthis.showOnlySections(['status']);\n\t\t\t\tthis.renderCrmButtons();\n\t\t\t\tthis.showCallIcon();\n\t\t\t\tthis.stopTimer();\n\t\t\t\tbreak;\n\t\t\tcase UiState.connected:\n\t\t\t\tif (this.deviceCall)\n\t\t\t\t{\n\t\t\t\t\tthis.setClosable(true);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.setClosable(false);\n\t\t\t\t}\n\n\t\t\t\tthis.showSections(['status', 'timer']);\n\t\t\t\tthis.renderCrmButtons();\n\t\t\t\tthis.showCallIcon();\n\t\t\t\tthis.startTimer();\n\t\t\t\tbreak;\n\t\t\tcase UiState.transferring:\n\t\t\t\tthis.setClosable(false);\n\t\t\t\tthis.showSections(['status', 'timer']);\n\t\t\t\tthis.renderCrmButtons();\n\t\t\t\tbreak;\n\t\t\tcase UiState.idle:\n\t\t\t\tthis.setClosable(true);\n\t\t\t\tthis.stopTimer();\n\t\t\t\tthis.hideCallIcon();\n\t\t\t\tthis.showOnlySections(['status']);\n\t\t\t\tthis.renderCrmButtons();\n\t\t\t\tbreak;\n\t\t\tcase UiState.error:\n\t\t\t\tthis.setClosable(true);\n\t\t\t\tthis.stopTimer();\n\t\t\t\tthis.hideCallIcon();\n\t\t\t\tbreak;\n\t\t\tcase UiState.moneyError:\n\t\t\t\tthis.setClosable(true);\n\t\t\t\tthis.stopTimer();\n\t\t\t\tthis.hideCallIcon();\n\t\t\t\tbreak;\n\t\t\tcase UiState.sipPhoneError:\n\t\t\t\tthis.setClosable(true);\n\t\t\t\tthis.stopTimer();\n\t\t\t\tthis.hideCallIcon();\n\t\t\t\tbreak;\n\t\t\tcase UiState.redial:\n\t\t\t\tthis.setClosable(true);\n\t\t\t\tthis.stopTimer();\n\t\t\t\tthis.hideCallIcon();\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (this.isDesktop() && !this.slave)\n\t\t{\n\t\t\tDesktopApi.emit(desktopEvents.setUiState, [uiState]);\n\t\t\treturn;\n\t\t}\n\t\tthis.renderButtons();\n\t};\n\n\t/**\n\t * @param {string} callState\n\t * @param {object} additionalParams\n\t * @see CallState\n\t */\n\tsetCallState(callState, additionalParams)\n\t{\n\t\tif (this.callState === callState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callState = callState;\n\n\t\tif (!Type.isPlainObject(additionalParams))\n\t\t{\n\t\t\tadditionalParams = {};\n\t\t}\n\n\t\tthis.renderButtons();\n\t\tif (callState === CallState.connected && this.isAutoFoldAllowed())\n\t\t{\n\t\t\tthis.fold();\n\t\t}\n\n\t\tBX.onCustomEvent(window, \"CallCard::CallStateChanged\", [callState, additionalParams]);\n\t\tthis.setOnSlave(desktopEvents.setCallState, [callState, additionalParams]);\n\t};\n\n\tisAutoFoldAllowed()\n\t{\n\t\treturn (this.autoFold === true && !this.isDesktop() && !this.isFolded() && this.restApps.length === 0);\n\t};\n\n\tisHeld()\n\t{\n\t\treturn this.held;\n\t};\n\n\tsetHeld(held)\n\t{\n\t\tthis.held = held;\n\t};\n\n\tsetRecording(recording)\n\t{\n\t\tthis.recording = recording;\n\t};\n\n\tisRecording()\n\t{\n\t\treturn this.recording;\n\t};\n\n\tisMuted()\n\t{\n\t\treturn this.muted;\n\t};\n\n\tsetMuted(muted)\n\t{\n\t\tthis.muted = muted;\n\t};\n\n\tisTransfer()\n\t{\n\t\treturn this.transfer;\n\t};\n\n\tsetTransfer(transfer)\n\t{\n\t\ttransfer = (transfer === true);\n\t\tif (this.transfer == transfer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.transfer = transfer;\n\t\tthis.setOnSlave(desktopEvents.setTransfer, [transfer]);\n\t\tthis.setUiState(this._uiState);\n\t};\n\n\tisCallback()\n\t{\n\t\treturn (this.direction === Direction.callback);\n\t};\n\n\tisPortalCall()\n\t{\n\t\treturn this.portalCall;\n\t};\n\n\tsetCallback(eventName, callback)\n\t{\n\t\tif (!this.callbacks.hasOwnProperty(eventName))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.callbacks[eventName] = Type.isFunction(callback) ? callback : nop;\n\t};\n\n\tsetDeviceCall(deviceCall)\n\t{\n\t\tthis.deviceCall = deviceCall;\n\n\t\tif (this.elements.buttons.sipPhone)\n\t\t{\n\t\t\tif (deviceCall)\n\t\t\t{\n\t\t\t\tDom.addClass(this.elements.buttons.sipPhone, 'active');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.removeClass(this.elements.buttons.sipPhone, 'active');\n\t\t\t}\n\t\t}\n\n\t\tif (this.isDesktop() && !this.slave)\n\t\t{\n\t\t\tDesktopApi.emit(desktopEvents.setDeviceCall, [deviceCall]);\n\t\t}\n\t};\n\n\tsetCrmEntity(params)\n\t{\n\t\tthis.crmEntityType = params.type;\n\t\tthis.crmEntityId = params.id;\n\t\tthis.crmActivityId = params.activityId || '';\n\t\tthis.crmActivityEditUrl = params.activityEditUrl || '';\n\t\tthis.crmBindings = Type.isArray(params.bindings) ? params.bindings : [];\n\n\t\tif (this.isDesktop() && !this.slave)\n\t\t{\n\t\t\tDesktopApi.emit(desktopEvents.setCrmEntity, [params]);\n\t\t}\n\t};\n\n\tsetCrmData(crmData)\n\t{\n\t\tif (!Type.isPlainObject(crmData))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.crm = true;\n\t\tthis.crmData = crmData;\n\t};\n\n\tloadCrmCard(entityType, entityId)\n\t{\n\t\tBX.onCustomEvent(window, 'CallCard::EntityChanged', [{\n\t\t\t'CRM_ENTITY_TYPE': entityType,\n\t\t\t'CRM_ENTITY_ID': entityId,\n\t\t\t'PHONE_NUMBER': this.phoneNumber\n\t\t}]);\n\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.entityChanged, {\n\t\t\t'CRM_ENTITY_TYPE': entityType,\n\t\t\t'CRM_ENTITY_ID': entityId,\n\t\t\t'PHONE_NUMBER': this.phoneNumber\n\t\t});\n\n\t\tBX.ajax.runAction(\"voximplant.callview.getCrmCard\", {\n\t\t\tdata: {\n\t\t\t\tentityType: entityType,\n\t\t\t\tentityId: entityId\n\t\t\t}\n\t\t}).then((response) =>\n\t\t{\n\t\t\tif (this.currentLayout == layouts.simple)\n\t\t\t{\n\t\t\t\tthis.currentLayout = layouts.crm;\n\t\t\t\tthis.crm = true;\n\t\t\t\tvar newMainElement = this.createLayoutCrm();\n\n\t\t\t\tthis.elements.main.parentNode.replaceChild(newMainElement, this.elements.main);\n\t\t\t\tthis.elements.main = newMainElement;\n\t\t\t\tthis.setUiState(this._uiState);\n\t\t\t\tthis.setStatusText(this.statusText);\n\t\t\t}\n\n\t\t\tif (this.elements.crmCard)\n\t\t\t{\n\t\t\t\tBX.html(this.elements.crmCard, response.data.html);\n\t\t\t\tsetTimeout(() =>\n\t\t\t\t{\n\t\t\t\t\tif (this.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.resizeWindow(this.getInitialWidth(), this.getInitialHeight());\n\t\t\t\t\t}\n\t\t\t\t\tthis.adjust();\n\t\t\t\t\tthis.bindCrmCardEvents();\n\t\t\t\t}, 100);\n\t\t\t}\n\n\t\t\tthis.renderCrmButtons();\n\t\t}).catch((response) => console.error(\"Could not load crm card: \", response.errors[0]));\n\t};\n\n\treloadCrmCard()\n\t{\n\t\tif (this.isDesktop() && !this.slave)\n\t\t{\n\t\t\tDesktopApi.emit(desktopEvents.reloadCrmCard, []);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.loadCrmCard(this.crmEntityType, this.crmEntityId);\n\t\t}\n\t};\n\n\tbindCrmCardEvents()\n\t{\n\t\tif (!this.elements.crmCard)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!BX.Crm || !BX.Crm.Page)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvar anchors = this.elements.crmCard.querySelectorAll('a[data-use-slider=Y]');\n\t\tfor (var i = 0; i < anchors.length; i++)\n\t\t{\n\t\t\tBX.bind(anchors[i], 'click', this.onCrmAnchorClick.bind(this));\n\t\t}\n\t};\n\n\tonCrmAnchorClick(e)\n\t{\n\t\tif (BX.Crm.Page.isSliderEnabled(e.currentTarget.href))\n\t\t{\n\t\t\tif (!this.isFolded())\n\t\t\t{\n\t\t\t\tthis.fold();\n\t\t\t}\n\t\t}\n\t};\n\n\tsetPortalCallUserId(userId)\n\t{\n\t\tthis.portalCallUserId = userId;\n\t\tthis.setOnSlave(desktopEvents.setPortalCallUserId, [userId]);\n\n\t\tif (this.portalCallData && this.portalCallData.users[this.portalCallUserId])\n\t\t{\n\t\t\tthis.renderAvatar();\n\t\t\tthis.createTitle().then(title => this.setTitle(title));\n\t\t}\n\t};\n\n\tsetPortalCallQueueName(queueName)\n\t{\n\t\tthis.portalCallQueueName = queueName;\n\t\tthis.setOnSlave(desktopEvents.setPortalCallQueueName, [queueName]);\n\n\t\tthis.createTitle().then(title => this.setTitle(title));\n\t};\n\n\tsetPortalCall(portalCall)\n\t{\n\t\tthis.portalCall = (portalCall === true);\n\t\tthis.setOnSlave(desktopEvents.setPortalCall, [portalCall]);\n\t};\n\n\tsetPortalCallData(data)\n\t{\n\t\tthis.portalCallData = data;\n\t\tthis.setOnSlave(desktopEvents.setPortalCallData, [data]);\n\t};\n\n\tsetOnSlave(message, parameters)\n\t{\n\t\tif (this.isDesktop() && !this.slave)\n\t\t{\n\t\t\tDesktopApi.emit(message, parameters);\n\t\t}\n\t};\n\n\tupdateView()\n\t{\n\t\tif (this.elements.title)\n\t\t{\n\t\t\tthis.elements.title.innerHTML = this.renderTitle();\n\t\t}\n\n\t\tif (this.elements.progress)\n\t\t{\n\t\t\tDom.clean(this.elements.progress);\n\t\t\tthis.elements.progress.appendChild(this.renderProgress(this.progress));\n\t\t}\n\n\t\tif (this.elements.status)\n\t\t{\n\t\t\tthis.elements.status.innerText = this.statusText;\n\t\t}\n\n\t\tthis.renderButtons();\n\t\tthis.renderTimer();\n\t};\n\n\trenderProgress(progress: $Keys<typeof CallProgress>): HTMLElement\n\t{\n\t\tlet result;\n\t\tswitch (progress)\n\t\t{\n\t\t\tcase CallProgress.connect:\n\t\t\t\tresult = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'bx-messenger-call-overlay-progress'}, children: [\n\t\t\t\t\t\tDom.create(\"img\", {props: {className: 'bx-messenger-call-overlay-progress-status bx-messenger-call-overlay-progress-status-anim-1'}}),\n\t\t\t\t\t\tDom.create(\"img\", {props: {className: 'bx-messenger-call-overlay-progress-status bx-messenger-call-overlay-progress-status-anim-2'}})\n\t\t\t\t\t]\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase CallProgress.online:\n\t\t\t\tresult = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'bx-messenger-call-overlay-progress bx-messenger-call-overlay-progress-online'},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"img\", {props: {className: 'bx-messenger-call-overlay-progress-status bx-messenger-call-overlay-progress-status-anim-3'}})\n\t\t\t\t\t]\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase CallProgress.error:\n\t\t\t\tprogress = CallProgress.offline;\n\t\t\t// fallthrough to default\n\t\t\tdefault:\n\t\t\t\tresult = Dom.create(\"div\", {props: {className: 'bx-messenger-call-overlay-progress bx-messenger-call-overlay-progress-' + progress}});\n\t\t}\n\n\t\treturn result;\n\t};\n\n\t/**\n\t * @param uiState UiState\n\t * @returns object {buttons: string[], layout: string}\n\t */\n\tgetUiStateButtons(uiState)\n\t{\n\t\tvar result = {\n\t\t\tbuttons: [],\n\t\t\tlayout: ButtonLayouts.centered\n\t\t};\n\t\tswitch (uiState)\n\t\t{\n\t\t\tcase UiState.incoming:\n\t\t\t\tresult.buttons = ['answer', 'skip'];\n\n\t\t\t\tbreak;\n\t\t\tcase UiState.transferIncoming:\n\t\t\t\tresult.buttons = ['answer', 'skip'];\n\t\t\t\tbreak;\n\t\t\tcase UiState.outgoing:\n\t\t\t\tresult.buttons = ['call'];\n\n\t\t\t\tif (this.callListId > 0)\n\t\t\t\t{\n\t\t\t\t\tresult.buttons.push('next');\n\t\t\t\t\tresult.buttons.push('fold');\n\n\t\t\t\t\tif (!this.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\tresult.buttons.push('topClose');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase UiState.connectingIncoming:\n\t\t\t\tresult.buttons = ['hangup'];\n\n\t\t\t\tbreak;\n\t\t\tcase UiState.connectingOutgoing:\n\t\t\t\tif (this.hasSipPhone)\n\t\t\t\t{\n\t\t\t\t\tresult.buttons.push('sipPhone');\n\t\t\t\t}\n\t\t\t\tresult.buttons.push('hangup');\n\t\t\t\tbreak;\n\t\t\tcase UiState.error:\n\t\t\t\tif (this.hasSipPhone)\n\t\t\t\t{\n\t\t\t\t\tresult.buttons.push('sipPhone');\n\t\t\t\t}\n\t\t\t\tif (this.callListId > 0)\n\t\t\t\t{\n\t\t\t\t\tresult.buttons.push('redial', 'next', 'topClose');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tresult.buttons.push('close');\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase UiState.moneyError:\n\t\t\t\tresult.buttons = ['notifyAdmin', 'close'];\n\t\t\t\tbreak;\n\t\t\tcase UiState.sipPhoneError:\n\t\t\t\tresult.buttons = ['sipPhone', 'close'];\n\t\t\t\tbreak;\n\t\t\tcase UiState.connected:\n\t\t\t\tresult.buttons = this.isTransfer() ? [] : ['hold'];\n\t\t\t\tif (!this.deviceCall)\n\t\t\t\t{\n\t\t\t\t\tresult.buttons.push('mute', 'qualityMeter');\n\t\t\t\t}\n\t\t\t\tresult.buttons.push('fold');\n\n\t\t\t\tif (!this.callListId && !this.isTransfer())\n\t\t\t\t{\n\t\t\t\t\tresult.buttons.push('transfer');\n\t\t\t\t}\n\n\t\t\t\tif (this.deviceCall)\n\t\t\t\t{\n\t\t\t\t\tresult.buttons.push('close');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tresult.buttons.push('dialpad', 'hangup');\n\t\t\t\t}\n\n\t\t\t\tresult.layout = ButtonLayouts.spaced;\n\t\t\t\tbreak;\n\t\t\tcase UiState.transferring:\n\t\t\t\tresult.buttons = ['transferComplete', 'transferCancel'];\n\t\t\t\tbreak;\n\t\t\tcase UiState.transferFailed:\n\t\t\t\tresult.buttons = ['transferCancel'];\n\t\t\t\tbreak;\n\t\t\tcase UiState.transferConnected:\n\t\t\t\tresult.buttons = ['hangup'];\n\t\t\t\tbreak;\n\t\t\tcase UiState.idle:\n\t\t\t\tif (this.hasSipPhone)\n\t\t\t\t{\n\t\t\t\t\tresult.buttons = ['close'];\n\t\t\t\t}\n\t\t\t\telse if (this.direction == Direction.incoming)\n\t\t\t\t{\n\t\t\t\t\tresult.buttons = ['close'];\n\t\t\t\t}\n\t\t\t\telse if (this.direction == Direction.outgoing)\n\t\t\t\t{\n\t\t\t\t\tresult.buttons = ['redial'];\n\t\t\t\t\tif (this.callListId > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tresult.buttons.push('next');\n\t\t\t\t\t\tresult.buttons.push('fold');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tresult.buttons.push('close');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (this.callListId > 0 && !this.isDesktop())\n\t\t\t\t{\n\t\t\t\t\tresult.buttons.push('topClose');\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase UiState.redial:\n\t\t\t\tresult.buttons = ['redial'];\n\t\t\t\tbreak;\n\t\t\tcase UiState.externalCard:\n\t\t\t\tresult.buttons = ['close'];\n\t\t\t\tresult.buttons.push('fold');\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn result;\n\t};\n\n\trenderButtons()\n\t{\n\t\tif (this.isFolded())\n\t\t{\n\t\t\tthis.renderButtonsFolded();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.renderButtonsDefault();\n\t\t}\n\t};\n\n\trenderButtonsDefault()\n\t{\n\t\tvar buttonsFragment = document.createDocumentFragment();\n\t\tvar topButtonsFragment = document.createDocumentFragment();\n\t\tvar topLevelButtonsFragment = document.createDocumentFragment();\n\t\tvar subContainers = {\n\t\t\tleft: null,\n\t\t\tright: null\n\t\t};\n\t\tthis.elements.buttons = {};\n\t\tif (this.buttonLayout == ButtonLayouts.spaced)\n\t\t{\n\t\t\tsubContainers.left = Dom.create('div', {props: {className: 'im-phone-call-buttons-container-left'}});\n\t\t\tsubContainers.right = Dom.create('div', {props: {className: 'im-phone-call-buttons-container-right'}});\n\t\t\tbuttonsFragment.appendChild(subContainers.left);\n\t\t\tbuttonsFragment.appendChild(subContainers.right);\n\t\t}\n\n\t\tthis.buttons.forEach((buttonName) =>\n\t\t{\n\t\t\tlet buttonNode;\n\n\t\t\tswitch (buttonName)\n\t\t\t{\n\t\t\t\tcase 'hold':\n\t\t\t\t\tbuttonNode = renderSimpleButton('', 'im-phone-call-btn-hold', this._onHoldButtonClickHandler);\n\t\t\t\t\tif (this.isHeld())\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.addClass(buttonNode, 'active');\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.buttonLayout == ButtonLayouts.spaced)\n\t\t\t\t\t{\n\t\t\t\t\t\tsubContainers.left.appendChild(buttonNode);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'mute':\n\t\t\t\t\tbuttonNode = renderSimpleButton('', 'im-phone-call-btn-mute', this._onMuteButtonClickHandler);\n\t\t\t\t\tif (this.isMuted())\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.addClass(buttonNode, 'active');\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.buttonLayout == ButtonLayouts.spaced)\n\t\t\t\t\t{\n\t\t\t\t\t\tsubContainers.left.appendChild(buttonNode);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'transfer':\n\t\t\t\t\tbuttonNode = renderSimpleButton('', 'im-phone-call-btn-transfer', this._onTransferButtonClickHandler);\n\t\t\t\t\tif (this.buttonLayout == ButtonLayouts.spaced)\n\t\t\t\t\t{\n\t\t\t\t\t\tsubContainers.left.appendChild(buttonNode);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'transferComplete':\n\t\t\t\t\tbuttonNode = renderSimpleButton(\n\t\t\t\t\t\tLoc.getMessage('IM_M_CALL_BTN_TRANSFER'),\n\t\t\t\t\t\t'im-phone-call-btn im-phone-call-btn-blue im-phone-call-btn-arrow',\n\t\t\t\t\t\tthis._onTransferCompleteButtonClickHandler\n\t\t\t\t\t);\n\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'transferCancel':\n\t\t\t\t\tbuttonNode = renderSimpleButton(\n\t\t\t\t\t\tLoc.getMessage('IM_M_CALL_BTN_RETURN'),\n\t\t\t\t\t\t'im-phone-call-btn im-phone-call-btn-red',\n\t\t\t\t\t\tthis._onTransferCancelButtonClickHandler\n\t\t\t\t\t);\n\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'dialpad':\n\t\t\t\t\tbuttonNode = renderSimpleButton('', 'im-phone-call-btn-dialpad', this._onDialpadButtonClickHandler);\n\t\t\t\t\tif (this.buttonLayout == ButtonLayouts.spaced)\n\t\t\t\t\t{\n\t\t\t\t\t\tsubContainers.left.appendChild(buttonNode);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'call':\n\t\t\t\t\tbuttonNode = renderSimpleButton(\n\t\t\t\t\t\tLoc.getMessage('IM_PHONE_CALL'),\n\t\t\t\t\t\t'im-phone-call-btn im-phone-call-btn-green',\n\t\t\t\t\t\tthis._onMakeCallButtonClickHandler\n\t\t\t\t\t);\n\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'answer':\n\t\t\t\t\tbuttonNode = renderSimpleButton(\n\t\t\t\t\t\tLoc.getMessage('IM_PHONE_BTN_ANSWER'),\n\t\t\t\t\t\t'im-phone-call-btn im-phone-call-btn-green',\n\t\t\t\t\t\tthis._onAnswerButtonClickHandler\n\t\t\t\t\t);\n\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'skip':\n\t\t\t\t\tbuttonNode = renderSimpleButton(\n\t\t\t\t\t\tLoc.getMessage('IM_PHONE_BTN_BUSY'),\n\t\t\t\t\t\t'im-phone-call-btn im-phone-call-btn-red',\n\t\t\t\t\t\tthis._onSkipButtonClickHandler\n\t\t\t\t\t);\n\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'hangup':\n\t\t\t\t\tbuttonNode = renderSimpleButton(\n\t\t\t\t\t\tLoc.getMessage('IM_M_CALL_BTN_HANGUP'),\n\t\t\t\t\t\t'im-phone-call-btn im-phone-call-btn-red  im-phone-call-btn-tube',\n\t\t\t\t\t\tthis._onHangupButtonClickHandler\n\t\t\t\t\t);\n\t\t\t\t\tif (this.buttonLayout == ButtonLayouts.spaced)\n\t\t\t\t\t{\n\t\t\t\t\t\tsubContainers.right.appendChild(buttonNode);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'close':\n\t\t\t\t\tbuttonNode = renderSimpleButton(\n\t\t\t\t\t\tLoc.getMessage('IM_M_CALL_BTN_CLOSE'),\n\t\t\t\t\t\t'im-phone-call-btn im-phone-call-btn-red',\n\t\t\t\t\t\tthis._onCloseButtonClickHandler\n\t\t\t\t\t);\n\t\t\t\t\tif (this.buttonLayout == ButtonLayouts.spaced)\n\t\t\t\t\t{\n\t\t\t\t\t\tsubContainers.right.appendChild(buttonNode);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'topClose':\n\t\t\t\t\tif (!this.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\tbuttonNode = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-top-close-btn'},\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: this._onCloseButtonClickHandler\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\ttopLevelButtonsFragment.appendChild(buttonNode);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'notifyAdmin':\n\t\t\t\t\tbuttonNode = renderSimpleButton(\n\t\t\t\t\t\tLoc.getMessage('IM_M_CALL_BTN_NOTIFY_ADMIN'),\n\t\t\t\t\t\t'im-phone-call-btn im-phone-call-btn-blue im-phone-call-btn-arrow',\n\t\t\t\t\t\t() =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.backgroundWorker.isUsed\n\t\t\t\t\t\t\t\t? this.backgroundWorker.emitEvent(backgroundWorkerEvents.notifyAdminButtonClick)\n\t\t\t\t\t\t\t\t: this.callbacks.notifyAdmin()\n\t\t\t\t\t\t\t;\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'sipPhone':\n\t\t\t\t\tbuttonNode = renderSimpleButton('', (this.deviceCall ? 'im-phone-call-btn-phone active' : 'im-phone-call-btn-phone'), this._onSwitchDeviceButtonClickHandler);\n\t\t\t\t\tif (this.buttonLayout == ButtonLayouts.spaced)\n\t\t\t\t\t{\n\t\t\t\t\t\tsubContainers.left.appendChild(buttonNode);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'qualityMeter':\n\t\t\t\t\tbuttonNode = Dom.create(\"span\", {\n\t\t\t\t\t\tprops: {className: 'im-phone-call-btn-signal'},\n\t\t\t\t\t\tevents: {click: this._onQualityMeterClickHandler},\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-btn-signal-icon-container'}, children: [\n\t\t\t\t\t\t\t\t\tDom.create(\"span\", {props: {className: 'im-phone-call-btn-signal-background'}}),\n\t\t\t\t\t\t\t\t\tthis.elements.qualityMeter = Dom.create(\"span\", {\n\t\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-btn-signal-active'},\n\t\t\t\t\t\t\t\t\t\tstyle: {width: this.getQualityMeterWidth()}\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t]\n\t\t\t\t\t});\n\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'settings':\n\t\t\t\t\t// todo\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'next':\n\t\t\t\t\tbuttonNode = renderSimpleButton(\n\t\t\t\t\t\tLoc.getMessage('IM_M_CALL_BTN_NEXT'),\n\t\t\t\t\t\t'im-phone-call-btn im-phone-call-btn-gray im-phone-call-btn-arrow',\n\t\t\t\t\t\tthis._onNextButtonClickHandler\n\t\t\t\t\t);\n\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'redial':\n\t\t\t\t\tbuttonNode = renderSimpleButton(\n\t\t\t\t\t\tLoc.getMessage('IM_M_CALL_BTN_RECALL'),\n\t\t\t\t\t\t'im-phone-call-btn im-phone-call-btn-green',\n\t\t\t\t\t\tthis._onMakeCallButtonClickHandler\n\t\t\t\t\t);\n\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'fold':\n\t\t\t\t\tif (!this.isDesktop() && this.canBeFolded())\n\t\t\t\t\t{\n\t\t\t\t\t\tbuttonNode = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-btn-arrow'},\n\t\t\t\t\t\t\ttext: Loc.getMessage('IM_PHONE_CALL_VIEW_FOLD'),\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: this._onFoldButtonClickHandler\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\ttopButtonsFragment.appendChild(buttonNode);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tthrow \"Unknown button \" + buttonName;\n\t\t\t}\n\n\t\t\tif (buttonNode)\n\t\t\t{\n\t\t\t\tthis.elements.buttons[buttonName] = buttonNode;\n\t\t\t}\n\t\t});\n\t\tif (this.elements.buttonsContainer)\n\t\t{\n\t\t\tDom.clean(this.elements.buttonsContainer);\n\t\t\tthis.elements.buttonsContainer.appendChild(buttonsFragment);\n\t\t}\n\t\tif (this.elements.topButtonsContainer)\n\t\t{\n\t\t\tDom.clean(this.elements.topButtonsContainer);\n\t\t\tthis.elements.topButtonsContainer.appendChild(topButtonsFragment);\n\t\t}\n\t\tif (this.elements.topLevelButtonsContainer)\n\t\t{\n\t\t\tDom.clean(this.elements.topLevelButtonsContainer);\n\t\t\tthis.elements.topLevelButtonsContainer.appendChild(topLevelButtonsFragment);\n\t\t}\n\t};\n\n\trenderButtonsFolded()\n\t{\n\t\tlet buttonsFragment = document.createDocumentFragment();\n\t\tlet buttonNode;\n\t\tthis.elements.buttons = {};\n\n\t\tthis.buttons.forEach((buttonName) =>\n\t\t{\n\t\t\tswitch (buttonName)\n\t\t\t{\n\t\t\t\tcase 'hangup':\n\t\t\t\t\tbuttonNode = renderSimpleButton(\n\t\t\t\t\t\tLoc.getMessage('IM_M_CALL_BTN_HANGUP'),\n\t\t\t\t\t\t'im-phone-call-panel-mini-cancel',\n\t\t\t\t\t\tthis._onHangupButtonClickHandler\n\t\t\t\t\t);\n\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'close':\n\t\t\t\t\tbuttonNode = renderSimpleButton(\n\t\t\t\t\t\tLoc.getMessage('IM_M_CALL_BTN_CLOSE'),\n\t\t\t\t\t\t'im-phone-call-panel-mini-cancel',\n\t\t\t\t\t\tthis._onCloseButtonClickHandler\n\t\t\t\t\t);\n\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\n\t\tif (this.elements.buttonsContainer)\n\t\t{\n\t\t\tDom.clean(this.elements.buttonsContainer);\n\t\t\tthis.elements.buttonsContainer.appendChild(buttonsFragment);\n\t\t}\n\t};\n\n\trenderCrmButtons()\n\t{\n\t\tlet buttonsFragment = document.createDocumentFragment();\n\t\tthis.elements.crmButtons = {};\n\n\t\tif (!this.elements.crmButtonsContainer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet buttons = ['addComment'];\n\n\t\tif (this.crmEntityType == 'CONTACT')\n\t\t{\n\t\t\tbuttons.push('addDeal');\n\t\t\tbuttons.push('addInvoice');\n\t\t}\n\t\telse if (this.crmEntityType == 'COMPANY')\n\t\t{\n\t\t\tbuttons.push('addDeal');\n\t\t\tbuttons.push('addInvoice');\n\t\t}\n\t\telse if (!this.crmEntityType && this.config.CRM_CREATE == 'none')\n\t\t{\n\t\t\tbuttons.push('addLead');\n\t\t\tbuttons.push('addContact');\n\t\t}\n\n\t\tif (buttons.length > 0)\n\t\t{\n\t\t\tbuttons.forEach((buttonName) =>\n\t\t\t{\n\t\t\t\tlet buttonNode;\n\t\t\t\tswitch (buttonName)\n\t\t\t\t{\n\t\t\t\t\tcase 'addComment':\n\t\t\t\t\t\tbuttonNode = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-crm-button im-phone-call-crm-button-comment' + (this.commentShown ? ' im-phone-call-crm-button-active' : '')},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tthis.elements.crmButtons.addCommentLabel = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-crm-button-item'},\n\t\t\t\t\t\t\t\t\ttext: this.commentShown ? Loc.getMessage('IM_PHONE_CALL_VIEW_SAVE') : Loc.getMessage('IM_PHONE_ACTION_CRM_COMMENT')\n\t\t\t\t\t\t\t\t})],\n\t\t\t\t\t\t\tevents: {click: this._onAddCommentButtonClick.bind(this)}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'addDeal':\n\t\t\t\t\t\tbuttonNode = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-crm-button'}, children: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-crm-button-item'},\n\t\t\t\t\t\t\t\t\ttext: Loc.getMessage('IM_PHONE_ACTION_CRM_DEAL')\n\t\t\t\t\t\t\t\t})],\n\t\t\t\t\t\t\tevents: {click: this._onAddDealButtonClick.bind(this)}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'addInvoice':\n\t\t\t\t\t\tbuttonNode = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-crm-button'}, children: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-crm-button-item'},\n\t\t\t\t\t\t\t\t\ttext: Loc.getMessage('IM_PHONE_ACTION_CRM_INVOICE')\n\t\t\t\t\t\t\t\t})],\n\t\t\t\t\t\t\tevents: {click: this._onAddInvoiceButtonClick.bind(this)}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'addLead':\n\t\t\t\t\t\tbuttonNode = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-crm-button'}, children: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-crm-button-item'},\n\t\t\t\t\t\t\t\t\ttext: Loc.getMessage('IM_CRM_BTN_NEW_LEAD')\n\t\t\t\t\t\t\t\t})],\n\t\t\t\t\t\t\tevents: {click: this._onAddLeadButtonClick.bind(this)}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'addContact':\n\t\t\t\t\t\tbuttonNode = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'im-phone-call-crm-button'}, children: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'im-phone-call-crm-button-item'},\n\t\t\t\t\t\t\t\t\ttext: Loc.getMessage('IM_CRM_BTN_NEW_CONTACT')\n\t\t\t\t\t\t\t\t})],\n\t\t\t\t\t\t\tevents: {click: this._onAddContactButtonClick.bind(this)}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (buttonNode)\n\t\t\t\t{\n\t\t\t\t\tbuttonsFragment.appendChild(buttonNode);\n\t\t\t\t\tthis.elements.crmButtons[buttonName] = buttonNode;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tDom.clean(this.elements.crmButtonsContainer);\n\t\t\tthis.elements.crmButtonsContainer.appendChild(buttonsFragment);\n\t\t\tthis.showSections(['crmButtons']);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.clean(this.elements.crmButtonsContainer);\n\t\t\tthis.hideSections(['crmButtons']);\n\t\t}\n\t};\n\n\tloadForm(params)\n\t{\n\t\tif (!this.formManager)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.formManager.load({\n\t\t\tid: params.id,\n\t\t\tsecCode: params.secCode\n\t\t})\n\t};\n\n\tunloadForm()\n\t{\n\t\tif (!this.formManager)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.formManager.unload();\n\t\tDom.clean(this.elements.tabsBody.webform);\n\t};\n\n\t_onFormSend(e)\n\t{\n\t\tif (!this.callListView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvar currentElement = this.callListView.getCurrentElement();\n\t\tthis.callListView.setWebformResult(currentElement.ELEMENT_ID, e.resultId);\n\t};\n\n\tloadRestApp(params)\n\t{\n\t\tvar restAppId = params.id;\n\t\tvar node = params.node;\n\n\t\tif (this.restAppLayoutLoaded)\n\t\t{\n\t\t\tBX.rest.AppLayout.getPlacement('CALL_CARD').load(restAppId, this.getPlacementOptions());\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.restAppLayoutLoading)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.restAppLayoutLoading = true;\n\n\t\tBX.ajax.runAction(\"voximplant.callView.loadRestApp\", {\n\t\t\tdata: {\n\t\t\t\t'appId': restAppId,\n\t\t\t\t'placementOptions': this.getPlacementOptions()\n\t\t\t}\n\t\t}).then((response) =>\n\t\t{\n\t\t\tif (!this.popup && !this.isDesktop())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tRuntime.html(node, response.data.html);\n\t\t\tthis.restAppLayoutLoaded = true;\n\t\t\tthis.restAppLayoutLoading = false;\n\t\t\tthis.restAppInterface = BX.rest.AppLayout.initializePlacement('CALL_CARD');\n\t\t\tthis.initializeAppInterface(this.restAppInterface);\n\t\t});\n\t};\n\n\tunloadRestApps()\n\t{\n\t\tif (!BX.rest || !BX.rest.AppLayout)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tvar placement = BX.rest.AppLayout.getPlacement('CALL_CARD');\n\t\tif (this.restAppLayoutLoaded && placement)\n\t\t{\n\t\t\tplacement.destroy();\n\t\t\tthis.restAppLayoutLoaded = false;\n\t\t}\n\t};\n\n\tinitializeAppInterface(appInterface)\n\t{\n\t\tappInterface.prototype.events.push('CallCard::EntityChanged');\n\t\tappInterface.prototype.events.push('CallCard::BeforeClose');\n\t\tappInterface.prototype.events.push('CallCard::CallStateChanged');\n\t\tappInterface.prototype.getStatus = (params, cb) =>\n\t\t{\n\t\t\tcb(this.getPlacementOptions());\n\t\t};\n\n\t\tappInterface.prototype.disableAutoClose = (params, cb) =>\n\t\t{\n\t\t\tthis.disableAutoClose();\n\t\t\tcb([]);\n\t\t};\n\n\t\tappInterface.prototype.enableAutoClose = (params, cb) =>\n\t\t{\n\t\t\tthis.enableAutoClose();\n\t\t\tcb([]);\n\t\t};\n\t};\n\n\tgetPlacementOptions()\n\t{\n\t\treturn {\n\t\t\t'CALL_ID': this.callId,\n\t\t\t'PHONE_NUMBER': this.phoneNumber === \"unknown\" ? undefined : this.phoneNumber,\n\t\t\t'LINE_NUMBER': this.lineNumber,\n\t\t\t'LINE_NAME': this.companyPhoneNumber,\n\t\t\t'CRM_ENTITY_TYPE': this.crmEntityType,\n\t\t\t'CRM_ENTITY_ID': this.crmEntityId,\n\t\t\t'CRM_ACTIVITY_ID': this.crmActivityId === 0 ? undefined : this.crmActivityId,\n\t\t\t'CRM_BINDINGS': this.crmBindings,\n\t\t\t'CALL_DIRECTION': this.direction,\n\t\t\t'CALL_STATE': this.callState,\n\t\t\t'CALL_LIST_MODE': this.callListId > 0\n\t\t}\n\t};\n\n\tisUnloadAllowed()\n\t{\n\t\tif (this.backgroundWorker.isActiveIntoCurrentCall())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.folded &&\n\t\t\t(\n\t\t\t\tthis.deviceCall ||\n\t\t\t\tthis._uiState === UiState.idle ||\n\t\t\t\tthis._uiState === UiState.error ||\n\t\t\t\tthis._uiState === UiState.externalCard\n\t\t\t);\n\t};\n\n\t_onBeforeUnload(e)\n\t{\n\t\tif (!this.isUnloadAllowed())\n\t\t{\n\t\t\te.returnValue = Loc.getMessage('IM_PHONE_CALL_VIEW_DONT_LEAVE');\n\t\t\treturn Loc.getMessage('IM_PHONE_CALL_VIEW_DONT_LEAVE');\n\t\t}\n\t};\n\n\t_onDblClick(e: Event)\n\t{\n\t\te.preventDefault()\n\t\tif (!this.isFolded() && this.canBeFolded())\n\t\t{\n\t\t\tthis.fold();\n\t\t}\n\t};\n\n\t_onHoldButtonClick()\n\t{\n\t\tif (this.isHeld())\n\t\t{\n\t\t\tthis.held = false;\n\t\t\tDom.removeClass(this.elements.buttons.hold, 'active');\n\t\t\tif (this.isDesktop() && this.slave)\n\t\t\t{\n\t\t\t\tDesktopApi.emit(desktopEvents.onUnHold, []);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.callbacks.unhold();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.held = true;\n\t\t\tDom.addClass(this.elements.buttons.hold, 'active');\n\t\t\tif (this.isDesktop() && this.slave)\n\t\t\t{\n\t\t\t\tDesktopApi.emit(desktopEvents.onHold, []);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.callbacks.hold();\n\t\t\t}\n\t\t}\n\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.holdButtonClick, this.isHeld())\n\t};\n\n\t_onMuteButtonClick()\n\t{\n\t\tif (this.isMuted())\n\t\t{\n\t\t\tthis.muted = false;\n\t\t\tDom.removeClass(this.elements.buttons.mute, 'active');\n\t\t\tif (this.isDesktop() && this.slave)\n\t\t\t{\n\t\t\t\tDesktopApi.emit(desktopEvents.onUnMute, []);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.callbacks.unmute();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.muted = true;\n\t\t\tDom.addClass(this.elements.buttons.mute, 'active');\n\t\t\tif (this.isDesktop() && this.slave)\n\t\t\t{\n\t\t\t\tDesktopApi.emit(desktopEvents.onMute, []);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.callbacks.mute();\n\t\t\t}\n\t\t}\n\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.muteButtonClick, this.isMuted());\n\t};\n\n\t_onTransferButtonClick()\n\t{\n\t\tthis.selectTransferTarget((result) =>\n\t\t{\n\t\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.transferButtonClick, result)\n\t\t\tif (this.isDesktop() && this.slave)\n\t\t\t{\n\t\t\t\tDesktopApi.emit(desktopEvents.onStartTransfer, [result]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.callbacks.transfer(result);\n\t\t\t}\n\t\t});\n\t};\n\n\t_onTransferCompleteButtonClick()\n\t{\n\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.completeTransferButtonClick);\n\t\tif (this.isDesktop() && this.slave)\n\t\t{\n\t\t\tDesktopApi.emit(desktopEvents.onCompleteTransfer, []);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callbacks.completeTransfer();\n\t\t}\n\t};\n\n\t_onTransferCancelButtonClick()\n\t{\n\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.cancelTransferButtonClick);\n\t\tif (this.isDesktop() && this.slave)\n\t\t{\n\t\t\tDesktopApi.emit(desktopEvents.onCancelTransfer, []);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callbacks.cancelTransfer();\n\t\t}\n\t};\n\n\t_onDialpadButtonClick()\n\t{\n\t\tthis.keypad = new Keypad({\n\t\t\tbindElement: this.elements.buttons.dialpad,\n\t\t\thideDial: true,\n\t\t\tonButtonClick: (e) =>\n\t\t\t{\n\t\t\t\tvar key = e.key;\n\t\t\t\tif (this.isDesktop() && this.slave)\n\t\t\t\t{\n\t\t\t\t\tDesktopApi.emit(desktopEvents.onDialpadButtonClicked, [key]);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.callbacks.dialpadButtonClicked(key);\n\t\t\t\t}\n\t\t\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.dialpadButtonClick, key);\n\t\t\t},\n\t\t\tonClose: () =>\n\t\t\t{\n\t\t\t\tthis.keypad.destroy();\n\t\t\t\tthis.keypad = null;\n\t\t\t}\n\t\t});\n\t\tthis.keypad.show();\n\t};\n\n\t_onHangupButtonClick()\n\t{\n\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.hangupButtonClick);\n\t\tif (this.isDesktop() && this.slave)\n\t\t{\n\t\t\tDesktopApi.emit(desktopEvents.onHangup, []);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callbacks.hangup();\n\t\t}\n\t};\n\n\t_onCloseButtonClick()\n\t{\n\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.closeButtonClick);\n\t\tif (this.isDesktop() && this.slave)\n\t\t{\n\t\t\tDesktopApi.emit(desktopEvents.onClose, []);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.close();\n\t\t}\n\t};\n\n\t_onMakeCallButtonClick()\n\t{\n\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.makeCallButtonClick);\n\t\tvar event = {};\n\t\tif (this.callListId > 0)\n\t\t{\n\t\t\tthis.callingEntity = this.currentEntity;\n\n\t\t\tif (this.currentEntity.phones.length === 0)\n\t\t\t{\n\t\t\t\t// show keypad and dial entered number\n\t\t\t\tthis.keypad = new Keypad({\n\t\t\t\t\tbindElement: this.elements.buttons.call ? this.elements.buttons.call : null,\n\t\t\t\t\tonClose: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.keypad.destroy();\n\t\t\t\t\t\tthis.keypad = null;\n\t\t\t\t\t},\n\t\t\t\t\tonDial: (e) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.keypad.close();\n\t\t\t\t\t\tthis.phoneNumber = e.phoneNumber;\n\t\t\t\t\t\tthis.createTitle().then(title => this.setTitle(title));\n\n\t\t\t\t\t\tevent = {\n\t\t\t\t\t\t\tphoneNumber: e.phoneNumber,\n\t\t\t\t\t\t\tcrmEntityType: this.crmEntityType,\n\t\t\t\t\t\t\tcrmEntityId: this.crmEntityId,\n\t\t\t\t\t\t\tcallListId: this.callListId\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tif (this.isDesktop() && this.slave)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tDesktopApi.emit(desktopEvents.onCallListMakeCall, [event]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.callbacks.callListMakeCall(event);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis.keypad.show();\n\t\t\t}\n\t\t\telse if (this.currentEntity.phones.length == 1)\n\t\t\t{\n\t\t\t\t// just dial the number\n\t\t\t\tevent.phoneNumber = this.currentEntity.phones[0].VALUE;\n\t\t\t\tevent.crmEntityType = this.crmEntityType;\n\t\t\t\tevent.crmEntityId = this.crmEntityId;\n\t\t\t\tevent.callListId = this.callListId;\n\t\t\t\tif (this.isDesktop() && this.slave)\n\t\t\t\t{\n\t\t\t\t\tDesktopApi.emit(desktopEvents.onCallListMakeCall, [event]);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.callbacks.callListMakeCall(event);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// allow user to select the number\n\t\t\t\tthis.showNumberSelectMenu({\n\t\t\t\t\tbindElement: this.elements.buttons.call ? this.elements.buttons.call : null,\n\t\t\t\t\tphoneNumbers: this.currentEntity.phones,\n\t\t\t\t\tonSelect: (e) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.closeNumberSelectMenu();\n\t\t\t\t\t\tthis.phoneNumber = e.phoneNumber;\n\t\t\t\t\t\tthis.createTitle().then(title => this.setTitle(title));\n\n\t\t\t\t\t\tevent = {\n\t\t\t\t\t\t\tphoneNumber: e.phoneNumber,\n\t\t\t\t\t\t\tcrmEntityType: this.crmEntityType,\n\t\t\t\t\t\t\tcrmEntityId: this.crmEntityId,\n\t\t\t\t\t\t\tcallListId: this.callListId\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tif (this.isDesktop() && this.slave)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tDesktopApi.emit(desktopEvents.onCallListMakeCall, [event]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.callbacks.callListMakeCall(event);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.isDesktop() && this.slave)\n\t\t\t{\n\t\t\t\tDesktopApi.emit(desktopEvents.onMakeCall, [this.phoneNumber]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.callbacks.makeCall(this.phoneNumber);\n\t\t\t}\n\t\t}\n\t};\n\n\t_onNextButtonClick()\n\t{\n\t\tif (!this.callListView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.nextButtonClick);\n\t\tthis.setUiState(UiState.outgoing);\n\t\tthis.callListView.moveToNextItem();\n\t\tthis.setStatusText('');\n\t};\n\n\t_onRedialButtonClick(e)\n\t{\n\n\t};\n\n\t_onCommentChanged()\n\t{\n\t\tthis.comment = this.elements.commentEditor.value;\n\t};\n\n\t_onAddCommentButtonClick()\n\t{\n\t\tthis.commentShown = !this.commentShown;\n\t\tif (this.isDesktop() && this.slave)\n\t\t{\n\t\t\tDesktopApi.emit(desktopEvents.onCommentShown, [this.commentShown]);\n\t\t}\n\n\t\tif (this.commentShown)\n\t\t{\n\t\t\tif (this.elements.crmButtons.addComment)\n\t\t\t{\n\t\t\t\tDom.addClass(this.elements.crmButtons.addComment, 'im-phone-call-crm-button-active');\n\t\t\t\tthis.elements.crmButtons.addCommentLabel.innerText = Loc.getMessage('IM_PHONE_CALL_VIEW_SAVE');\n\t\t\t}\n\t\t\tif (this.elements.commentEditor)\n\t\t\t{\n\t\t\t\tthis.elements.commentEditor.value = this.comment;\n\t\t\t\tthis.elements.commentEditor.focus();\n\t\t\t}\n\n\t\t\tif (this.elements.commentEditorContainer)\n\t\t\t{\n\t\t\t\tthis.elements.commentEditorContainer.style.removeProperty('display');\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\n\t\t\tif (this.elements.crmButtons.addComment)\n\t\t\t{\n\t\t\t\tDom.removeClass(this.elements.crmButtons.addComment, 'im-phone-call-crm-button-active');\n\t\t\t\tthis.elements.crmButtons.addCommentLabel.innerText = Loc.getMessage('IM_PHONE_ACTION_CRM_COMMENT');\n\t\t\t}\n\n\t\t\tif (this.elements.commentEditorContainer)\n\t\t\t{\n\t\t\t\tthis.elements.commentEditorContainer.style.display = 'none';\n\t\t\t}\n\n\t\t\tif (this.isDesktop() && this.slave)\n\t\t\t{\n\t\t\t\tDesktopApi.emit(desktopEvents.onSaveComment, [this.comment]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.saveComment();\n\t\t\t}\n\n\t\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.addCommentButtonClick, this.comment);\n\t\t}\n\t};\n\n\t_onAddDealButtonClick()\n\t{\n\t\tvar url = this._getCrmEditUrl('DEAL', 0);\n\t\tvar externalContext = this._generateExternalContext();\n\t\tif (this.crmEntityType === 'CONTACT')\n\t\t{\n\t\t\turl = Uri.addParam(url, {contact_id: this.crmEntityId});\n\t\t}\n\t\telse if (this.crmEntityType === 'COMPANY')\n\t\t{\n\t\t\turl = Uri.addParam(url, {company_id: this.crmEntityId});\n\t\t}\n\n\t\turl = Uri.addParam(url, {external_context: externalContext});\n\t\tif (this.callListId > 0)\n\t\t{\n\t\t\turl = Uri.addParam(url, {call_list_id: this.callListId});\n\t\t\turl = Uri.addParam(url, {call_list_element: this.currentEntity.id});\n\t\t}\n\n\t\tthis.externalRequests[externalContext] = {\n\t\t\ttype: 'add',\n\t\t\tcontext: externalContext,\n\t\t\twindow: window.open(url)\n\t\t};\n\t};\n\n\t_onAddInvoiceButtonClick()\n\t{\n\t\tlet url = this._getCrmEditUrl('INVOICE', 0);\n\t\tconst externalContext = this._generateExternalContext();\n\n\t\turl = Uri.addParam(url, {redirect: \"y\"});\n\t\tif (this.crmEntityType === 'CONTACT')\n\t\t{\n\t\t\turl = Uri.addParam(url, {contact: this.crmEntityId});\n\t\t}\n\t\telse if (this.crmEntityType === 'COMPANY')\n\t\t{\n\t\t\turl = Uri.addParam(url, {company: this.crmEntityId});\n\t\t}\n\n\t\turl = Uri.addParam(url, {external_context: externalContext});\n\t\tif (this.callListId > 0)\n\t\t{\n\t\t\turl = Uri.addParam(url, {call_list_id: this.callListId});\n\t\t\turl = Uri.addParam(url, {call_list_element: this.currentEntity.id});\n\t\t}\n\n\t\tthis.externalRequests[externalContext] = {\n\t\t\ttype: 'add',\n\t\t\tcontext: externalContext,\n\t\t\twindow: window.open(url)\n\t\t};\n\t};\n\n\t_onAddLeadButtonClick()\n\t{\n\t\tlet url = this._getCrmEditUrl('LEAD', 0);\n\t\turl = Uri.addParam(url, {\n\t\t\tphone: this.phoneNumber,\n\t\t\torigin_id: 'VI_' + this.callId\n\t\t});\n\t\twindow.open(url);\n\t};\n\n\t_onAddContactButtonClick()\n\t{\n\t\tlet url = this._getCrmEditUrl('CONTACT', 0);\n\t\turl = Uri.addParam(url, {\n\t\t\tphone: this.phoneNumber,\n\t\t\torigin_id: 'VI_' + this.callId\n\t\t});\n\t\twindow.open(url);\n\t};\n\n\t_onFoldButtonClick()\n\t{\n\t\tthis.fold();\n\t};\n\n\t_onAnswerButtonClick()\n\t{\n\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.answerButtonClick);\n\t\tif (this.isDesktop() && this.slave)\n\t\t{\n\t\t\tDesktopApi.emit(desktopEvents.onAnswer, []);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callbacks.answer();\n\t\t}\n\t};\n\n\t_onSkipButtonClick()\n\t{\n\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.skipButtonClick);\n\t\tif (this.isDesktop() && this.slave)\n\t\t{\n\t\t\tDesktopApi.emit(desktopEvents.onSkip, []);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callbacks.skip();\n\t\t}\n\t};\n\n\t_onSwitchDeviceButtonClick()\n\t{\n\t\tif (this.isDesktop() && this.slave)\n\t\t{\n\t\t\tDesktopApi.emit(desktopEvents.onSwitchDevice, [{\n\t\t\t\tphoneNumber: this.phoneNumber\n\t\t\t}]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callbacks.switchDevice({\n\t\t\t\tphoneNumber: this.phoneNumber\n\t\t\t});\n\t\t}\n\t};\n\n\t_onQualityMeterClick()\n\t{\n\t\tthis.showQualityPopup({\n\t\t\tonSelect: (qualityGrade) =>\n\t\t\t{\n\t\t\t\tthis.backgroundWorker.emitEvent(backgroundWorkerEvents.qualityMeterClick, qualityGrade);\n\t\t\t\tthis.qualityGrade = qualityGrade;\n\t\t\t\tthis.closeQualityPopup();\n\t\t\t\tif (this.isDesktop() && this.slave)\n\t\t\t\t{\n\t\t\t\t\tDesktopApi.emit(desktopEvents.onQualityGraded, [qualityGrade]);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.callbacks.qualityGraded(qualityGrade);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t};\n\n\t#onExternalEvent = (params) =>\n\t{\n\t\tconsole.warn('#onExternalEvent', params)\n\t\treturn\n\t\tparams = Type.isPlainObject(params) ? params : {};\n\t\tparams.key = params.key || '';\n\n\t\tvar value = params.value || {};\n\t\tvalue.entityTypeName = value.entityTypeName || '';\n\t\tvalue.context = value.context || '';\n\t\tvalue.isCanceled = Type.isBoolean(value.isCanceled) ? value.isCanceled : false;\n\n\t\tif (value.isCanceled)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (params.key === \"onCrmEntityCreate\" && this.externalRequests[value.context])\n\t\t{\n\t\t\tif (this.externalRequests[value.context])\n\t\t\t{\n\t\t\t\tif (this.externalRequests[value.context]['type'] == 'create')\n\t\t\t\t{\n\t\t\t\t\tthis.crmEntityType = value.entityTypeName;\n\t\t\t\t\tthis.crmEntityId = value.entityInfo.id;\n\t\t\t\t\tthis.loadCrmCard(this.crmEntityType, this.crmEntityId);\n\t\t\t\t}\n\t\t\t\telse if (this.externalRequests[value.context]['type'] == 'add')\n\t\t\t\t{\n\t\t\t\t\t// reload crm card\n\t\t\t\t\tthis.loadCrmCard(this.crmEntityType, this.crmEntityId);\n\t\t\t\t}\n\n\t\t\t\tif (this.externalRequests[value.context]['window'])\n\t\t\t\t{\n\t\t\t\t\tthis.externalRequests[value.context]['window'].close();\n\t\t\t\t}\n\n\t\t\t\tdelete this.externalRequests[value.context];\n\t\t\t}\n\t\t}\n\t};\n\n\t_onPullEventCrm(command, params)\n\t{\n\t\tif (command === 'external_event')\n\t\t{\n\t\t\tif (params.NAME === 'onCrmEntityCreate' && params.IS_CANCELED == false)\n\t\t\t{\n\t\t\t\tvar eventParams = params.PARAMS;\n\t\t\t\tif (this.externalRequests[eventParams.context])\n\t\t\t\t{\n\t\t\t\t\tvar crmEntityType = eventParams.entityTypeName;\n\t\t\t\t\tvar crmEntityId = eventParams.entityInfo.id;\n\n\t\t\t\t\tif (this.callListView)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar currentElement = this.callListView.getCurrentElement();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tonCallListSelectedItem(entity)\n\t{\n\t\tthis.currentEntity = entity;\n\t\tthis.crmEntityType = entity.type;\n\t\tthis.crmEntityId = entity.id;\n\t\tthis.comment = \"\";\n\n\t\tif (Type.isArray(entity.bindings))\n\t\t{\n\t\t\tthis.crmBindings = entity.bindings.map((value) =>\n\t\t\t\t{\n\t\t\t\t\treturn {'ENTITY_TYPE': value.type, 'ENTITY_ID': value.id}\n\t\t\t\t}\n\t\t\t)\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.crmBindings = [];\n\t\t}\n\n\t\tif (entity.phones.length > 0)\n\t\t{\n\t\t\tthis.phoneNumber = entity.phones[0].VALUE;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.phoneNumber = 'unknown';\n\t\t}\n\n\t\tthis.createTitle().then(title => this.setTitle(title));\n\t\tthis.loadCrmCard(entity.type, entity.id);\n\t\tif (this.currentTabName === 'webform')\n\t\t{\n\t\t\tthis.formManager.unload();\n\t\t\tthis.formManager.load({\n\t\t\t\tid: this.webformId,\n\t\t\t\tsecCode: this.webformSecCode,\n\t\t\t\tlang: Loc.getMessage(\"LANGUAGE_ID\"),\n\t\t\t})\n\t\t}\n\t\tif (this._uiState === UiState.redial)\n\t\t{\n\t\t\tthis.setUiState(UiState.outgoing);\n\t\t}\n\n\t\tthis.updateView();\n\t};\n\n\t#onWindowUnload = () =>\n\t{\n\t\tthis.close();\n\t}\n\n\tshowCallIcon()\n\t{\n\t\tif (!this.callListView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.callingEntity)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callListView.setCallingElement(this.callingEntity.statusId, this.callingEntity.index);\n\t};\n\n\thideCallIcon()\n\t{\n\t\tif (!this.callListView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callListView.resetCallingElement();\n\t};\n\n\tisTimerStarted()\n\t{\n\t\treturn !!this.timerInterval;\n\t}\n\n\tstartTimer()\n\t{\n\t\tif (this.isTimerStarted())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.initialTimestamp === 0)\n\t\t{\n\t\t\tthis.initialTimestamp = (new Date()).getTime();\n\t\t}\n\t\tthis.timerInterval = setInterval(this.renderTimer.bind(this), 1000);\n\t\tthis.renderTimer();\n\t};\n\n\trenderTimer()\n\t{\n\t\tif (!this.elements.timer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet currentTimestamp = (new Date()).getTime();\n\t\tlet elapsedMilliSeconds = (currentTimestamp - this.initialTimestamp);\n\n\t\tlet elapsedSeconds = Math.floor(elapsedMilliSeconds / 1000);\n\t\tlet minutes = Math.floor(elapsedSeconds / 60).toString();\n\t\tif (minutes.length < 2)\n\t\t{\n\t\t\tminutes = '0' + minutes;\n\t\t}\n\t\tlet seconds = (elapsedSeconds % 60).toString();\n\t\tif (seconds.length < 2)\n\t\t{\n\t\t\tseconds = '0' + seconds;\n\t\t}\n\t\tconst template = (this.isRecording() ? Loc.getMessage('IM_PHONE_TIMER_WITH_RECORD') : Loc.getMessage('IM_PHONE_TIMER_WITHOUT_RECORD'));\n\n\t\tif (this.isFolded())\n\t\t{\n\t\t\tthis.elements.timer.innerText = minutes + ':' + seconds;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.timer.innerText = template.replace('#MIN#', minutes).replace('#SEC#', seconds);\n\t\t}\n\t};\n\n\tstopTimer()\n\t{\n\t\tif (!this.isTimerStarted())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tclearInterval(this.timerInterval);\n\t\tthis.timerInterval = null;\n\t};\n\n\tshowQualityPopup(params)\n\t{\n\t\tif (!Type.isPlainObject(params))\n\t\t{\n\t\t\tparams = {};\n\t\t}\n\n\t\tif (!Type.isFunction(params.onSelect))\n\t\t{\n\t\t\tparams.onSelect = nop;\n\t\t}\n\n\t\tconst elements = {\n\t\t\t'1': null,\n\t\t\t'2': null,\n\t\t\t'3': null,\n\t\t\t'4': null,\n\t\t\t'5': null\n\t\t};\n\n\t\tthis.qualityPopup = new Popup({\n\t\t\tid: 'PhoneCallViewQualityGrade',\n\t\t\tbindElement: this.elements.qualityMeter,\n\t\t\ttargetContainer: document.body,\n\t\t\tdarkMode: true,\n\t\t\tcloseByEsc: true,\n\t\t\tautoHide: true,\n\t\t\tzIndex: baseZIndex + 200,\n\t\t\tnoAllPaddings: true,\n\t\t\toverlay: {\n\t\t\t\tbackgroundColor: 'white',\n\t\t\t\topacity: 0\n\t\t\t},\n\t\t\tbindOptions: {\n\t\t\t\tposition: 'top'\n\t\t\t},\n\t\t\tangle: {\n\t\t\t\tposition: 'bottom',\n\t\t\t\toffset: 30\n\t\t\t},\n\t\t\tcacheable: false,\n\t\t\tcontent: Dom.create(\"div\", {\n\t\t\t\tprops: {className: 'im-phone-popup-rating'}, children: [\n\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\tprops: {className: 'im-phone-popup-rating-title'},\n\t\t\t\t\t\ttext: Loc.getMessage('IM_PHONE_CALL_VIEW_RATE_QUALITY')\n\t\t\t\t\t}),\n\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\tprops: {className: 'im-phone-popup-rating-stars'}, children: [\n\t\t\t\t\t\t\telements['1'] = createStar(1, this.qualityGrade == '1', params.onSelect),\n\t\t\t\t\t\t\telements['2'] = createStar(2, this.qualityGrade == '2', params.onSelect),\n\t\t\t\t\t\t\telements['3'] = createStar(3, this.qualityGrade == '3', params.onSelect),\n\t\t\t\t\t\t\telements['4'] = createStar(4, this.qualityGrade == '4', params.onSelect),\n\t\t\t\t\t\t\telements['5'] = createStar(5, this.qualityGrade == '5', params.onSelect)\n\t\t\t\t\t\t], events: {\n\t\t\t\t\t\t\tmouseover: () =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (elements[this.qualityGrade])\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tDom.removeClass(elements[this.qualityGrade], 'im-phone-popup-rating-stars-item-active');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tmouseout: () =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (elements[this.qualityGrade])\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tDom.addClass(elements[this.qualityGrade], 'im-phone-popup-rating-stars-item-active');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t]\n\t\t\t}),\n\t\t\tevents: {\n\t\t\t\tonPopupClose: () => this.qualityPopup = null,\n\t\t\t}\n\t\t});\n\n\t\tthis.qualityPopup.show();\n\t};\n\n\tcloseQualityPopup()\n\t{\n\t\tif (this.qualityPopup)\n\t\t{\n\t\t\tthis.qualityPopup.close();\n\t\t}\n\t};\n\n\tsaveComment()\n\t{\n\t\tthis.callbacks.saveComment({\n\t\t\tcallId: this.callId,\n\t\t\tcomment: this.comment\n\t\t})\n\t};\n\n\tshowNumberSelectMenu(params)\n\t{\n\t\tvar menuItems = [];\n\t\tif (!Type.isPlainObject(params))\n\t\t{\n\t\t\tparams = {};\n\t\t}\n\n\t\tif (!Type.isArray(params.phoneNumbers))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tparams.onSelect = Type.isFunction(params.onSelect) ? params.onSelect : BX.DoNothing;\n\t\tparams.phoneNumbers.forEach((phoneNumber) =>\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\tid: 'number-select-' + BX.util.getRandomString(10),\n\t\t\t\ttext: phoneNumber.VALUE,\n\t\t\t\tonclick: () =>\n\t\t\t\t{\n\t\t\t\t\tparams.onSelect({\n\t\t\t\t\t\tphoneNumber: phoneNumber.VALUE\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t})\n\t\t});\n\n\t\tthis.numberSelectMenu = new Menu(\n\t\t\t'im-phone-call-view-number-select',\n\t\t\tparams.bindElement,\n\t\t\tmenuItems,\n\t\t\t{\n\t\t\t\tautoHide: true,\n\t\t\t\toffsetTop: 0,\n\t\t\t\toffsetLeft: 40,\n\t\t\t\tangle: {position: \"top\"},\n\t\t\t\tzIndex: baseZIndex + 200,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\toverlay: {\n\t\t\t\t\tbackgroundColor: 'white',\n\t\t\t\t\topacity: 0\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose: () => this.numberSelectMenu.destroy(),\n\t\t\t\t\tonPopupDestroy: () => this.numberSelectMenu = null\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t\tthis.numberSelectMenu.show();\n\t};\n\n\tcloseNumberSelectMenu()\n\t{\n\t\tif (this.numberSelectMenu)\n\t\t{\n\t\t\tthis.numberSelectMenu.close();\n\t\t}\n\t};\n\n\tfold()\n\t{\n\t\tif (!this.canBeFolded())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.callListId > 0 && this.callState === CallState.idle)\n\t\t{\n\t\t\tthis.foldCallView();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.foldCall();\n\t\t}\n\t};\n\n\tunfold()\n\t{\n\t\tif (!this.isDesktop() && this.isFolded())\n\t\t{\n\t\t\tDom.remove(this.elements.main);\n\t\t\tthis.folded = false;\n\t\t\tthis.elements = this.unfoldedElements;\n\t\t\tthis.show();\n\t\t}\n\t};\n\n\tfoldCall()\n\t{\n\t\tif (this.isDesktop() || !this.popup)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet popupNode = this.popup.getPopupContainer();\n\t\tlet overlayNode = this.popup.overlay.element;\n\n\t\tDom.addClass(popupNode, 'im-phone-call-view-folding');\n\t\tDom.addClass(overlayNode, 'popup-window-overlay-im-phone-call-view-folding');\n\t\tsetTimeout(() =>\n\t\t{\n\t\t\tthis.folded = true;\n\t\t\tthis.popup.close();\n\t\t\tthis.unfoldedElements = this.elements;\n\t\t\tDom.removeClass(popupNode, 'im-phone-call-view-folding');\n\t\t\tDom.removeClass(overlayNode, 'popup-window-overlay-im-phone-call-view-folding');\n\t\t\tthis.reinit();\n\t\t\tthis.enableDocumentScroll();\n\t\t}, 300);\n\t};\n\n\tfoldCallView()\n\t{\n\t\tconst popupNode = this.popup.getPopupContainer();\n\t\tconst overlayNode = this.popup.overlay.element;\n\n\t\tDom.addClass(popupNode, 'im-phone-call-view-folding');\n\t\tDom.addClass(overlayNode, 'popup-window-overlay-im-phone-call-view-folding');\n\t\tsetTimeout(\n\t\t\t() =>\n\t\t\t{\n\t\t\t\tthis.close();\n\t\t\t\tthis.foldedCallView.fold({\n\t\t\t\t\tcallListId: this.callListId,\n\t\t\t\t\twebformId: this.webformId,\n\t\t\t\t\twebformSecCode: this.webformSecCode,\n\t\t\t\t\tcurrentItemIndex: this.callListView.currentItemIndex,\n\t\t\t\t\tcurrentItemStatusId: this.callListView.currentStatusId,\n\t\t\t\t\tstatusList: this.callListView.statuses,\n\t\t\t\t\tentityType: this.callListView.entityType\n\t\t\t\t}, true);\n\t\t\t},\n\t\t\t300\n\t\t);\n\t};\n\n\tbindSlaveDesktopEvents()\n\t{\n\t\tDesktopApi.subscribe(desktopEvents.setTitle, this.setTitle.bind(this));\n\t\tDesktopApi.subscribe(desktopEvents.setStatus, this.setStatusText.bind(this));\n\t\tDesktopApi.subscribe(desktopEvents.setUiState, this.setUiState.bind(this));\n\t\tDesktopApi.subscribe(desktopEvents.setDeviceCall, this.setDeviceCall.bind(this));\n\t\tDesktopApi.subscribe(desktopEvents.setCrmEntity, this.setCrmEntity.bind(this));\n\t\tDesktopApi.subscribe(desktopEvents.reloadCrmCard, this.reloadCrmCard.bind(this));\n\t\tDesktopApi.subscribe(desktopEvents.setPortalCall, this.setPortalCall.bind(this));\n\t\tDesktopApi.subscribe(desktopEvents.setPortalCallUserId, this.setPortalCallUserId.bind(this));\n\t\tDesktopApi.subscribe(desktopEvents.setPortalCallQueueName, this.setPortalCallQueueName.bind(this));\n\t\tDesktopApi.subscribe(desktopEvents.setPortalCallData, this.setPortalCallData.bind(this));\n\t\tDesktopApi.subscribe(desktopEvents.setConfig, this.setConfig.bind(this));\n\t\tDesktopApi.subscribe(desktopEvents.setCallId, this.setCallId.bind(this));\n\t\tDesktopApi.subscribe(desktopEvents.setLineNumber, this.setLineNumber.bind(this));\n\t\tDesktopApi.subscribe(desktopEvents.setCompanyPhoneNumber, this.setCompanyPhoneNumber.bind(this));\n\t\tDesktopApi.subscribe(desktopEvents.setPhoneNumber, this.setPhoneNumber.bind(this));\n\t\tDesktopApi.subscribe(desktopEvents.setTransfer, this.setTransfer.bind(this));\n\t\tDesktopApi.subscribe(desktopEvents.setCallState, this.setCallState.bind(this));\n\t\tDesktopApi.subscribe(desktopEvents.closeWindow, () => window.close());\n\n\t\tBX.bind(window, \"beforeunload\", () =>\n\t\t{\n\t\t\tBX.unbindAll(window, \"beforeunload\");\n\t\t\tDesktopApi.emit(desktopEvents.onBeforeUnload, []);\n\t\t});\n\n\t\tBX.bind(window, \"resize\", Runtime.debounce(() =>\n\t\t{\n\t\t\tif (this.skipOnResize)\n\t\t\t{\n\t\t\t\tthis.skipOnResize = false;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.saveInitialSize(window.innerWidth, window.innerHeight)\n\t\t}, 100));\n\n\t\tBX.addCustomEvent(\"SidePanel.Slider:onOpen\", (event) =>\n\t\t{\n\t\t\tif (!event.getSlider().isSelfContained())\n\t\t\t{\n\t\t\t\tevent.denyAction();\n\t\t\t\twindow.open(event.slider.url);\n\t\t\t}\n\t\t});\n\n\t\t/*BX.bind(window, \"keydown\", function(e)\n\t\t{\n\t\t\tif(e.keyCode === 27)\n\t\t\t{\n\t\t\t\tDesktopApi.emit(desktopEvents.onBeforeUnload, []);\n\t\t\t}\n\t\t}.bind(this));*/\n\t};\n\n\tbindMasterDesktopEvents()\n\t{\n\t\tDesktopApi.subscribe(desktopEvents.onHold, () => this.callbacks.hold());\n\t\tDesktopApi.subscribe(desktopEvents.onUnHold, () => this.callbacks.unhold());\n\t\tDesktopApi.subscribe(desktopEvents.onMute, () => this.callbacks.mute());\n\t\tDesktopApi.subscribe(desktopEvents.onUnMute, () => this.callbacks.unmute());\n\t\tDesktopApi.subscribe(desktopEvents.onMakeCall, (phoneNumber) => this.callbacks.makeCall(phoneNumber));\n\t\tDesktopApi.subscribe(desktopEvents.onCallListMakeCall, (e) => this.callbacks.callListMakeCall(e));\n\t\tDesktopApi.subscribe(desktopEvents.onAnswer, () => this.callbacks.answer());\n\t\tDesktopApi.subscribe(desktopEvents.onSkip, () => this.callbacks.skip());\n\t\tDesktopApi.subscribe(desktopEvents.onHangup, () => this.callbacks.hangup());\n\t\tDesktopApi.subscribe(desktopEvents.onClose, () => this.close());\n\t\tDesktopApi.subscribe(desktopEvents.onStartTransfer, (e) => this.callbacks.transfer(e));\n\t\tDesktopApi.subscribe(desktopEvents.onCompleteTransfer, () => this.callbacks.completeTransfer());\n\t\tDesktopApi.subscribe(desktopEvents.onCancelTransfer, () => this.callbacks.cancelTransfer());\n\t\tDesktopApi.subscribe(desktopEvents.onSwitchDevice, (e) => this.callbacks.switchDevice(e));\n\t\tDesktopApi.subscribe(desktopEvents.onBeforeUnload, () =>\n\t\t{\n\t\t\tthis.desktop.window = null;\n\t\t\tthis.callbacks.hangup();\n\t\t\tthis.callbacks.close();\n\t\t}); //slave window unload\n\t\tDesktopApi.subscribe(desktopEvents.onQualityGraded, (grade) => this.callbacks.qualityGraded(grade));\n\t\tDesktopApi.subscribe(desktopEvents.onDialpadButtonClicked, (grade) => this.callbacks.dialpadButtonClicked(grade));\n\t\tDesktopApi.subscribe(desktopEvents.onCommentShown, (commentShown) => this.commentShown = commentShown);\n\t\tDesktopApi.subscribe(desktopEvents.onSaveComment, (comment) =>\n\t\t{\n\t\t\tthis.comment = comment;\n\t\t\tthis.saveComment();\n\t\t});\n\t\tDesktopApi.subscribe(desktopEvents.onSetAutoClose, (autoClose) => this.autoClose = autoClose);\n\n\t};\n\n\tunbindDesktopEvents()\n\t{\n\t\tfor (let eventId in desktopEvents)\n\t\t{\n\t\t\tif (desktopEvents.hasOwnProperty(eventId))\n\t\t\t{\n\t\t\t\tDesktopApi.unsubscribe(desktopEvents[eventId]);\n\t\t\t}\n\t\t}\n\t};\n\n\tisDesktop()\n\t{\n\t\treturn this._isDesktop;\n\t};\n\n\tisFolded()\n\t{\n\t\treturn this.folded;\n\t};\n\n\tcanBeFolded()\n\t{\n\t\treturn this.allowAutoClose && (this.callState === CallState.connected || (this.callState === CallState.idle && this.callListId > 0));\n\t};\n\n\tgetFoldedHeight()\n\t{\n\t\tif (!this.folded)\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\n\t\tif (!this.elements.main)\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\n\t\treturn this.elements.main.clientHeight + (this.elements.sections.status ? this.elements.sections.status.clientHeight : 0);\n\t};\n\n\tisWebformSupported()\n\t{\n\t\treturn (!this.isDesktop() || this.desktop.isFeatureSupported('iframe'));\n\t};\n\n\tisRestAppsSupported()\n\t{\n\t\treturn (!this.isDesktop() || this.desktop.isFeatureSupported('iframe'));\n\t};\n\n\tsetClosable(closable)\n\t{\n\t\tclosable = (closable === true);\n\t\tthis.closable = closable;\n\t\tif (this.isDesktop())\n\t\t{\n\t\t\t//this.desktop.setClosable(closable);\n\t\t}\n\t\telse if (this.popup)\n\t\t{\n\t\t\tthis.popup.setClosingByEsc(closable);\n\t\t\t//this.popup.setAutoHide(closable);\n\t\t}\n\t};\n\n\tisClosable()\n\t{\n\t\treturn this.closable;\n\t};\n\n\tadjust()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.adjustPosition();\n\t\t}\n\n\t\tif (this.isDesktop() && this.slave)\n\t\t{\n\t\t\tif (this.currentLayout == layouts.simple)\n\t\t\t{\n\t\t\t\tthis.desktop.setResizable(false);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.desktop.setResizable(true);\n\t\t\t\tthis.desktop.setMinSize((this.elements.sidebarContainer ? 900 : 550), 650);\n\t\t\t}\n\t\t\tthis.desktop.center();\n\t\t}\n\t};\n\n\tresizeWindow(width, height)\n\t{\n\t\tif (!this.isDesktop() || !this.slave)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.skipOnResize = true;\n\t\tthis.desktop.resize(width, height);\n\t};\n\n\tclose()\n\t{\n\t\tBX.onCustomEvent(window, 'CallCard::BeforeClose', []);\n\n\t\tif (this.isFolded() && this.elements.main)\n\t\t{\n\t\t\tDom.addClass(this.elements.main, 'im-phone-call-panel-mini-closing');\n\t\t\tsetTimeout(() =>\n\t\t\t\t{\n\t\t\t\t\tDom.remove(this.elements.main);\n\t\t\t\t\tthis.elements = this.getInitialElements();\n\t\t\t\t},\n\t\t\t\t300\n\t\t\t);\n\t\t}\n\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t}\n\n\t\tif (this.desktop.window)\n\t\t{\n\t\t\tDesktopApi.emit(desktopEvents.closeWindow, []);\n\t\t\t//this.desktop.window.ExecuteCommand('close');\n\t\t\t//this.desktop.window = null;\n\t\t}\n\n\t\tthis.enableDocumentScroll();\n\n\t\tthis.callbacks.close();\n\t\tBX.onCustomEvent(window, 'CallCard::AfterClose', []);\n\t};\n\n\tdisableAutoClose()\n\t{\n\t\tthis.allowAutoClose = false;\n\t\tif (this.isDesktop() && this.slave)\n\t\t{\n\t\t\tDesktopApi.emit(desktopEvents.onSetAutoClose, [this.allowAutoClose]);\n\t\t}\n\t\tthis.renderButtons();\n\t};\n\n\tenableAutoClose()\n\t{\n\t\tthis.allowAutoClose = true;\n\t\tif (this.isDesktop() && this.slave)\n\t\t{\n\t\t\tDesktopApi.emit(desktopEvents.onSetAutoClose, [this.allowAutoClose]);\n\t\t}\n\t\tthis.renderButtons();\n\t};\n\n\tautoClose()\n\t{\n\t\tif (this.allowAutoClose && !this.commentShown)\n\t\t{\n\t\t\tthis.close();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.onCustomEvent(window, 'CallCard::BeforeClose', []);\n\t\t}\n\t};\n\n\tdisableDocumentScroll()\n\t{\n\t\tconst scrollWidth = window.innerWidth - document.documentElement.clientWidth;\n\t\tdocument.body.style.setProperty('padding-right', scrollWidth + \"px\");\n\t\tdocument.body.classList.add('im-phone-call-disable-scroll');\n\t\tconst imBar = document.getElementById('bx-im-bar');\n\t\tif (imBar)\n\t\t{\n\t\t\timBar.style.setProperty('right', scrollWidth + \"px\");\n\t\t}\n\t};\n\n\tenableDocumentScroll()\n\t{\n\t\tdocument.body.classList.remove('im-phone-call-disable-scroll');\n\t\tdocument.body.style.removeProperty('padding-right');\n\t\tconst imBar = document.getElementById('bx-im-bar');\n\t\tif (imBar)\n\t\t{\n\t\t\timBar.style.removeProperty('right');\n\t\t}\n\t};\n\n\tdispose()\n\t{\n\t\twindow.removeEventListener('beforeunload', this._onBeforeUnloadHandler);\n\t\tBX.removeCustomEvent(\"onPullEvent-crm\", this._onPullEventCrmHandler);\n\t\tthis.unloadRestApps();\n\t\tthis.unloadForm();\n\n\t\tif (this.isFolded() && this.elements.main)\n\t\t{\n\t\t\tDom.addClass(this.elements.main, 'im-phone-call-panel-mini-closing');\n\t\t\tsetTimeout(() => Dom.remove(this.elements.main), 300);\n\t\t}\n\n\t\tif (this.backgroundWorker)\n\t\t{\n\t\t\tthis.backgroundWorker.setCallCard(null);\n\t\t\tthis.backgroundWorker = null;\n\t\t}\n\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.destroy();\n\t\t\tthis.popup = null;\n\t\t}\n\n\t\tif (this.qualityPopup)\n\t\t{\n\t\t\tthis.qualityPopup.close();\n\t\t}\n\n\t\tif (this.keypad)\n\t\t{\n\t\t\tthis.keypad.close();\n\t\t}\n\n\t\tif (this.numberSelectMenu)\n\t\t{\n\t\t\tthis.closeNumberSelectMenu();\n\t\t}\n\n\t\tthis.enableDocumentScroll();\n\n\t\tif (this.isDesktop())\n\t\t{\n\t\t\tthis.unbindDesktopEvents();\n\t\t\tif (this.desktop.window)\n\t\t\t{\n\t\t\t\tDesktopApi.emit(desktopEvents.closeWindow, []);\n\t\t\t\t//this.desktop.window.ExecuteCommand('close');\n\t\t\t\tthis.desktop.window = null;\n\t\t\t}\n\t\t\tif (!this.slave)\n\t\t\t{\n\t\t\t\twindow.removeEventListener('beforeunload', this._unloadHandler); //master window unload\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\twindow.removeEventListener('beforeunload', this._onBeforeUnloadHandler);\n\t\t}\n\n\t\tif (!BX.localStorage.get(lsKeys.callInited) && !BX.localStorage.get(lsKeys.externalCall))\n\t\t{\n\t\t\tBX.localStorage.remove(lsKeys.callView);\n\t\t}\n\t};\n\n\tcanBeUnloaded()\n\t{\n\t\tif (this.backgroundWorker.isUsed())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.allowAutoClose && this.isFolded();\n\t};\n\n\tisCallListMode()\n\t{\n\t\treturn (this.callListId > 0);\n\t};\n\n\tgetState()\n\t{\n\t\treturn {\n\t\t\tcallId: this.callId,\n\t\t\tfolded: this.folded,\n\t\t\tuiState: this._uiState,\n\t\t\tphoneNumber: this.phoneNumber,\n\t\t\tcompanyPhoneNumber: this.companyPhoneNumber,\n\t\t\tdirection: this.direction,\n\t\t\tfromUserId: this.fromUserId,\n\t\t\ttoUserId: this.toUserId,\n\t\t\tstatusText: this.statusText,\n\t\t\tcrm: this.crm,\n\t\t\thasSipPhone: this.hasSipPhone,\n\t\t\tdeviceCall: this.deviceCall,\n\t\t\ttransfer: this.transfer,\n\t\t\tcrmEntityType: this.crmEntityType,\n\t\t\tcrmEntityId: this.crmEntityId,\n\t\t\tcrmActivityId: this.crmActivityId,\n\t\t\tcrmActivityEditUrl: this.crmActivityEditUrl,\n\t\t\tcallListId: this.callListId,\n\t\t\tcallListStatusId: this.callListStatusId,\n\t\t\tcallListItemIndex: this.callListItemIndex,\n\t\t\tconfig: (this.config ? this.config : '{}'),\n\t\t\tportalCall: (this.portalCall ? 'true' : 'false'),\n\t\t\tportalCallData: (this.portalCallData ? this.portalCallData : '{}'),\n\t\t\tportalCallUserId: this.portalCallUserId,\n\t\t\twebformId: this.webformId,\n\t\t\twebformSecCode: this.webformSecCode,\n\t\t\tinitialTimestamp: this.initialTimestamp,\n\t\t\tcrmData: this.crmData\n\t\t};\n\t};\n\n\tselectTransferTarget(resultCallback: (TransferTarget) => void)\n\t{\n\t\tresultCallback = Type.isFunction(resultCallback) ? resultCallback : BX.DoNothing;\n\n\t\tRuntime.loadExtension('ui.entity-selector').then((exports: EntitySelector) =>\n\t\t{\n\t\t\tconst config =\n\t\t\t\tthis.backgroundWorker.isUsed()\n\t\t\t\t\t? this.getDialogConfigForBackgroundApp(resultCallback)\n\t\t\t\t\t: this.getDefaultDialogConfig(resultCallback)\n\t\t\t;\n\t\t\tconst Dialog: Dialog = exports.Dialog;\n\t\t\tconst transferDialog = new Dialog(config);\n\n\t\t\ttransferDialog.show();\n\t\t});\n\t};\n\n\tgetDialogConfigForBackgroundApp(resultCallback)\n\t{\n\t\treturn {\n\t\t\ttargetNode: this.elements.buttons.transfer,\n\t\t\tmultiple: false,\n\t\t\tcacheable: false,\n\t\t\thideOnSelect: false,\n\t\t\tenableSearch: true,\n\t\t\tentities: [\n\t\t\t\t{\n\t\t\t\t\tid: 'user',\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tinviteEmployeeLink: false,\n\t\t\t\t\t\tselectFields: ['personalPhone', 'personalMobile', 'workPhone']\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'department'\n\t\t\t\t},\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\t'Item:onSelect': (event) =>\n\t\t\t\t{\n\t\t\t\t\tevent.target.deselectAll();\n\n\t\t\t\t\tconst item = event.data.item;\n\n\t\t\t\t\tif (item.getEntityId() === 'user')\n\t\t\t\t\t{\n\t\t\t\t\t\tvar customData = item.getCustomData();\n\t\t\t\t\t\tif (customData.get('personalPhone') || customData.get('personalMobile') || customData.get('workPhone'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.showTransferToUserMenu({\n\t\t\t\t\t\t\t\tuserId: item.getId(),\n\t\t\t\t\t\t\t\tcustomData: Object.fromEntries(customData),\n\t\t\t\t\t\t\t\tdarkMode: this.darkMode,\n\t\t\t\t\t\t\t\tonSelect: (result: TransferTarget) =>\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tevent.target.hide();\n\t\t\t\t\t\t\t\t\tresultCallback({\n\t\t\t\t\t\t\t\t\t\tphoneNumber: this.phoneNumber,\n\t\t\t\t\t\t\t\t\t\ttarget: result.target\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tevent.target.hide();\n\t\t\t\t\t\t\tresultCallback({\n\t\t\t\t\t\t\t\tphoneNumber: this.phoneNumber,\n\t\t\t\t\t\t\t\ttarget: item.getId()\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tgetDefaultDialogConfig(resultCallback: (TransferTarget) => void)\n\t{\n\t\treturn {\n\t\t\ttargetNode: this.elements.buttons.transfer,\n\t\t\tmultiple: false,\n\t\t\tcacheable: false,\n\t\t\thideOnSelect: false,\n\t\t\tenableSearch: true,\n\t\t\tentities: [\n\t\t\t\t{\n\t\t\t\t\tid: 'user',\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tinviteEmployeeLink: false,\n\t\t\t\t\t\tselectFields: ['personalPhone', 'personalMobile', 'workPhone']\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'department'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'voximplant_group'\n\t\t\t\t},\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\t'Item:onSelect': (event) =>\n\t\t\t\t{\n\t\t\t\t\tevent.target.deselectAll();\n\n\t\t\t\t\tvar item = event.data.item;\n\n\t\t\t\t\tif (item.getEntityId() === 'user')\n\t\t\t\t\t{\n\t\t\t\t\t\tvar customData = item.getCustomData();\n\t\t\t\t\t\tif (customData.get('personalPhone') || customData.get('personalMobile') || customData.get('workPhone'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.showTransferToUserMenu({\n\t\t\t\t\t\t\t\tuserId: item.getId(),\n\t\t\t\t\t\t\t\tcustomData: Object.fromEntries(customData),\n\t\t\t\t\t\t\t\tdarkMode: this.darkMode,\n\t\t\t\t\t\t\t\tonSelect: (result: TransferTarget) =>\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tevent.target.hide();\n\t\t\t\t\t\t\t\t\tresultCallback(result)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tevent.target.hide();\n\t\t\t\t\t\t\tresultCallback({\n\t\t\t\t\t\t\t\ttype: 'user',\n\t\t\t\t\t\t\t\ttarget: item.getId()\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (item.getEntityId() === 'voximplant_group')\n\t\t\t\t\t{\n\t\t\t\t\t\tevent.target.hide();\n\t\t\t\t\t\tresultCallback({\n\t\t\t\t\t\t\ttype: 'queue',\n\t\t\t\t\t\t\ttarget: item.getId()\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tshowTransferToUserMenu(options: TransferOptions = {})\n\t{\n\t\tconst userId = Type.isInteger(options.userId) ? options.userId : 0;\n\t\tconst userCustomData = Type.isPlainObject(options.customData) ? options.customData : {};\n\t\tconst darkMode = options.darkMode === true;\n\t\tconst onSelect = Type.isFunction(options.onSelect) ? options.onSelect : nop;\n\t\tlet popup;\n\n\t\tconst onMenuItemClick = (e) =>\n\t\t{\n\t\t\tconst type = e.currentTarget.dataset[\"type\"];\n\t\t\tconst target = e.currentTarget.dataset[\"target\"];\n\t\t\tonSelect({\n\t\t\t\ttype: type,\n\t\t\t\ttarget: target,\n\t\t\t});\n\t\t\tpopup.close();\n\t\t};\n\n\t\tlet menuItems = [\n\t\t\t{\n\t\t\t\ticon: 'bx-messenger-menu-call-voice',\n\t\t\t\ttext: Loc.getMessage('IM_PHONE_INNER_CALL'),\n\t\t\t\tdataset: {\n\t\t\t\t\ttype: 'user',\n\t\t\t\t\ttarget: userId\n\t\t\t\t},\n\t\t\t\tonclick: onMenuItemClick\n\t\t\t},\n\t\t\t{\n\t\t\t\tdelimiter: true\n\t\t\t},\n\t\t];\n\n\t\tif (userCustomData[\"personalMobile\"])\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\thtml: renderTransferMenuItem(Loc.getMessage(\"IM_PHONE_PERSONAL_MOBILE\"), Text.encode(userCustomData[\"personalMobile\"])),\n\t\t\t\tdataset: {\n\t\t\t\t\ttype: 'pstn',\n\t\t\t\t\ttarget: userCustomData[\"personalMobile\"]\n\t\t\t\t},\n\t\t\t\tonclick: onMenuItemClick,\n\t\t\t});\n\t\t}\n\t\tif (userCustomData[\"personalPhone\"])\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\ttype: \"call\",\n\t\t\t\thtml: renderTransferMenuItem(Loc.getMessage(\"IM_PHONE_PERSONAL_PHONE\"), Text.encode(userCustomData[\"personalPhone\"])),\n\t\t\t\tdataset: {\n\t\t\t\t\ttype: 'pstn',\n\t\t\t\t\ttarget: userCustomData[\"personalPhone\"]\n\t\t\t\t},\n\t\t\t\tonclick: onMenuItemClick,\n\t\t\t});\n\t\t}\n\t\tif (userCustomData[\"workPhone\"])\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\thtml: renderTransferMenuItem(Loc.getMessage(\"IM_PHONE_WORK_PHONE\"), Text.encode(userCustomData[\"workPhone\"])),\n\t\t\t\tdataset: {\n\t\t\t\t\ttype: 'pstn',\n\t\t\t\t\ttarget: userCustomData[\"workPhone\"]\n\t\t\t\t},\n\t\t\t\tonclick: onMenuItemClick,\n\t\t\t});\n\t\t}\n\n\t\tpopup = new Menu({\n\t\t\tid: \"bx-messenger-phone-transfer-menu\",\n\t\t\tbindElement: null,\n\t\t\ttargetContainer: document.body,\n\t\t\tdarkMode: darkMode,\n\t\t\tlightShadow: true,\n\t\t\tautoHide: true,\n\t\t\tcloseByEsc: true,\n\t\t\tcacheable: false,\n\t\t\toverlay: {\n\t\t\t\tbackgroundColor: '#FFFFFF',\n\t\t\t\topacity: 0\n\t\t\t},\n\t\t\titems: menuItems,\n\t\t});\n\t\tpopup.show();\n\t}\n}\n\nfunction renderTransferMenuItem(surTitle: string, text: string): string\n{\n\treturn `<div class=\"transfer-menu-item-surtitle\">${Text.encode(surTitle)}</div><div class=\"transfer-menu-item-text\">${Text.encode(text)}</div>`\n}\n\nfunction renderSimpleButton(text, className, clickCallback)\n{\n\tlet params = {};\n\tif (Type.isStringFilled(text))\n\t{\n\t\tparams.text = text;\n\t}\n\n\tif (Type.isStringFilled(className))\n\t{\n\t\tparams.props = {className: className};\n\t}\n\n\tif (Type.isFunction(clickCallback))\n\t{\n\t\tparams.events = {click: clickCallback};\n\t}\n\n\treturn Dom.create('span', params);\n}\n\nfunction createStar(grade, active, onSelect)\n{\n\treturn Dom.create(\"div\", {\n\t\tprops: {className: 'im-phone-popup-rating-stars-item ' + (active ? 'im-phone-popup-rating-stars-item-active' : '')},\n\t\tdataset: {grade: grade},\n\t\tevents: {\n\t\t\tclick: (e) =>\n\t\t\t{\n\t\t\t\te.preventDefault();\n\t\t\t\tconst grade = e.currentTarget.dataset.grade;\n\t\t\t\tonSelect(grade);\n\t\t\t}\n\t\t}\n\t})\n}\n\ntype TransferOptions = {\n\tuserId: number,\n\tcustomData: Object,\n\tdarkMode: boolean,\n\tonSelect: (TransferTarget) => void,\n}\n\ntype TransferTarget = {\n\ttype: string,\n\ttarget: string,\n}","import { Browser, Type, Text, Runtime, Loc, Reflection } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { DesktopApi } from 'im.v2.lib.desktop-api';\n\nimport { Keypad } from './view/keypad'\nimport { PhoneCallView, Direction, UiState, CallState, CallProgress } from './view/view'\nimport { BackgroundWorker } from './view/background-worker';\nimport { FoldedCallView } from './view/folded-view';\nimport { Popup } from 'main.popup';\nimport { MessageBox, MessageBoxButtons } from 'ui.dialogs.messagebox';\n\nconst lsKeys = {\n\tcallInited: 'viInitedCall',\n\texternalCall: 'viExternalCard',\n\tvite: 'vite',\n\tdialHistory: 'vox-dial-history',\n\tfoldedView: 'vox-folded-call-card',\n\tcallView: 'bx-vox-call-view',\n}\n\nconst Events = {\n\tonCallCreated: 'onCallCreated',\n\tonCallConnected: 'onCallConnected',\n\tonCallDestroyed: 'onCallDestroyed',\n\tonDeviceCallStarted: 'onDeviceCallStarted',\n};\n\nexport type MessengerFacade = {\n\tisThemeDark: () => boolean,\n\tisDesktop: () => boolean,\n\thasActiveCall: () => boolean,\n\n\trepeatSound: (string, number, boolean) => void,\n\tstopRepeatSound: (name: string) => void,\n\tplaySound: (name: string, force: boolean) => void,\n\n\tsetLocalConfig: (key: string, value: any, ttl: ?number) => void,\n\tgetLocalConfig: (key: string) => any,\n\n\tgetAvatar: (userId: number) => ?string,\n}\n\ntype PhoneCallsControllerOptions = {\n\tphoneEnabled: boolean,\n\tuserId: number,\n\tuserEmail: string,\n\tisAdmin: boolean,\n\tcallCardRestApps: Array,\n\tcanInterceptCall: boolean,\n\trestApps: Array,\n\n\tdeviceActive: boolean,\n\tdeviceCall: boolean, //?\n\tdefaultLineId: string,\n\tavailableLines: Array,\n\n\tmessengerFacade: MessengerFacade,\n\tevents: { [key: string]: () => {} },\n}\n\nconst DeviceType = {\n\tWebrtc: 'WEBRTC',\n\tPhone: 'PHONE',\n}\n\nexport class PhoneCallsController extends EventEmitter\n{\n\tmessengerFacade: MessengerFacade\n\tuserEmail: string\n\n\tcallView: ?PhoneCallView\n\tfoldedCallView: FoldedCallView\n\tbackgroundWorker: BackgroundWorker\n\tkeypad: ?Keypad\n\tdefaultLineId: string\n\n\t_currentCall: ?VoxImplant.Call\n\tvoximplantClient: ?VoxImplant.Client\n\n\tcallId: string\n\tisCallHold: boolean\n\tisMuted: boolean\n\tisCallTransfer: boolean\n\n\thasSipPhone: boolean\n\tdeviceType: ?string\n\t/** @see DeviceType */\n\n\thasExternalCall: boolean\n\n\tphoneTransferTargetId: number\n\tphoneTransferTargetType: string\n\tphoneTransferCallId: string\n\tphoneTransferEnabled: boolean\n\tphoneCrm: Object\n\n\tinitiator: boolean\n\tcallInitUserId: number\n\tcallActive: boolean\n\tcallUserId: number\n\tphoneNumber: string\n\n\tdebug: boolean\n\n\tconstructor(options: PhoneCallsControllerOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Voximplant.PhoneCallsControllerOptions');\n\t\tthis.subscribeFromOptions(options.events)\n\n\t\tthis.debug = false;\n\n\t\tthis.phoneEnabled = Type.isBoolean(options.phoneEnabled) ? options.phoneEnabled : false;\n\n\t\tthis.userId = options.userId;\n\t\tthis.userEmail = options.userEmail;\n\t\tthis.isAdmin = options.isAdmin;\n\n\t\tconst history = BX.localStorage.get(lsKeys.dialHistory);\n\t\tthis.dialHistory = Type.isArray(history) ? history : [];\n\n\t\tthis.availableLines = Type.isArray(options.availableLines) ? options.availableLines : [];\n\t\tthis.defaultLineId = Type.isString(options.defaultLineId) ? options.defaultLineId : '';\n\t\tthis.callInterceptAllowed = options.canInterceptCall || false;\n\t\tthis.restApps = options.restApps;\n\n\t\tthis.hasSipPhone = options.deviceActive === true;\n\n\t\tthis.skippedCallsList = [];\n\t\tthis.skipIncomingCallTimer = null;\n\n\t\tthis.readDefaults();\n\t\tthis.restoreFoldedCallView();\n\n\t\tif (Browser.isLocalStorageSupported())\n\t\t{\n\t\t\tBX.addCustomEvent(window, \"onLocalStorageSet\", this.storageSet.bind(this));\n\t\t}\n\t\tBX.addCustomEvent(\"onPullEvent-voximplant\", this.#onPullEvent.bind(this));\n\n\t\t// call event handlers\n\t\tthis.onCallConnectedHandler = this.#onCallConnected.bind(this);\n\t\tthis.onCallDisconnectedHandler = this.#onCallDisconnected.bind(this);\n\t\tthis.onCallFailedHandler = this.#onCallFailed.bind(this);\n\t\tthis.onProgressToneStartHandler = this.#onProgressToneStart.bind(this);\n\t\tthis.onProgressToneStopHandler = this.#onProgressToneStop.bind(this);\n\n\t\tthis.messengerFacade = options.messengerFacade;\n\t\tthis.backgroundWorker = new BackgroundWorker();\n\t\tthis.foldedCallView = new FoldedCallView({\n\t\t\tevents: {\n\t\t\t\t[FoldedCallView.Events.onUnfold]: (event) => {\n\t\t\t\t\tconst data = event.getData();\n\t\t\t\t\tthis.startCallList(data.callListId, data.callListParams)\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tBX.garbage(() =>\n\t\t{\n\t\t\tif (this.hasActiveCall() && this.callView && this.callView.canBeUnloaded() && (this.hasExternalCall || this.deviceType === 'PHONE'))\n\t\t\t{\n\t\t\t\tBX.localStorage.set(lsKeys.foldedView, {\n\t\t\t\t\tcallId: this.callId,\n\t\t\t\t\tphoneCrm: this.phoneCrm,\n\t\t\t\t\tdeviceType: this.deviceType,\n\t\t\t\t\thasExternalCall: this.hasExternalCall,\n\t\t\t\t\tcallView: this.callView.getState()\n\t\t\t\t}, 15);\n\t\t\t}\n\t\t})\n\t}\n\n\thasActiveCall(): boolean\n\t{\n\t\treturn Boolean(this._currentCall || this.callView)\n\t}\n\n\tget currentCall(): ?VoxImplant.Call\n\t{\n\t\treturn this._currentCall\n\t}\n\n\tset currentCall(call: ?VoxImplant.Call)\n\t{\n\t\tif (this._currentCall)\n\t\t{\n\t\t\tthis.#removeCallEventListeners(this._currentCall);\n\n\t\t\tthis.emit(Events.onCallDestroyed, {\n\t\t\t\tcall: this._currentCall\n\t\t\t});\n\t\t}\n\t\tthis._currentCall = call;\n\n\t\tif (this._currentCall)\n\t\t{\n\t\t\tthis.#setCallEventListeners(call);\n\t\t\tthis.emit(Events.onCallCreated, {\n\t\t\t\tcall: call\n\t\t\t});\n\t\t}\n\t}\n\n\t#setCallEventListeners(call: VoxImplant.Call)\n\t{\n\t\tcall.addEventListener(VoxImplant.CallEvents.Connected, this.onCallConnectedHandler);\n\t\tcall.addEventListener(VoxImplant.CallEvents.Disconnected, this.onCallDisconnectedHandler);\n\t\tcall.addEventListener(VoxImplant.CallEvents.Failed, this.onCallFailedHandler);\n\t\tcall.addEventListener(VoxImplant.CallEvents.ProgressToneStart, this.onProgressToneStartHandler);\n\t\tcall.addEventListener(VoxImplant.CallEvents.ProgressToneStop, this.onProgressToneStopHandler);\n\t}\n\n\t#removeCallEventListeners(call: VoximplantCall)\n\t{\n\t\tcall.removeEventListener(VoxImplant.CallEvents.Connected, this.onCallConnectedHandler);\n\t\tcall.removeEventListener(VoxImplant.CallEvents.Disconnected, this.onCallDisconnectedHandler);\n\t\tcall.removeEventListener(VoxImplant.CallEvents.Failed, this.onCallFailedHandler);\n\t\tcall.removeEventListener(VoxImplant.CallEvents.ProgressToneStart, this.onProgressToneStartHandler);\n\t\tcall.removeEventListener(VoxImplant.CallEvents.ProgressToneStop, this.onProgressToneStopHandler);\n\t}\n\n\tready()\n\t{\n\t\treturn true; // TODO ??\n\t}\n\n\treadDefaults()\n\t{\n\t\tif (!localStorage)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.defaultMicrophone = localStorage.getItem('bx-im-settings-default-microphone');\n\t\tthis.defaultCamera = localStorage.getItem('bx-im-settings-default-camera');\n\t\tthis.defaultSpeaker = localStorage.getItem('bx-im-settings-default-speaker');\n\t\tthis.enableMicAutoParameters = (localStorage.getItem('bx-im-settings-enable-mic-auto-parameters') !== 'N');\n\t}\n\n\t#onPullEvent(command, params)\n\t{\n\t\tconst handlers = {\n\t\t\t'invite': this.#onPullInvite,\n\t\t\t'answer_self': this.#onPullAnswerSelf,\n\t\t\t'timeout': this.#onPullTimeout,\n\t\t\t'outgoing': this.#onPullOutgoing,\n\t\t\t'start': this.#onPullStart,\n\t\t\t'hold': this.#onPullHold,\n\t\t\t'unhold': this.#onPullUnhold,\n\t\t\t'update_crm': this.#onPullUpdateCrm,\n\t\t\t'updatePortalUser': this.#onPullUpdatePortalUser,\n\t\t\t'completeTransfer': this.#onPullCompleteTransfer,\n\t\t\t'phoneDeviceActive': this.#onPullPhoneDeviceActive,\n\t\t\t'changeDefaultLineId': this.#onPullChangeDefaultLineId,\n\t\t\t'replaceCallerId': this.#onPullReplaceCallerId,\n\t\t\t'showExternalCall': this.#onPullShowExternalCall,\n\t\t\t'hideExternalCall': this.#onPullHideExternalCall,\n\t\t}\n\n\t\tif (handlers.hasOwnProperty(command))\n\t\t{\n\t\t\thandlers[command].apply(this, [params]);\n\t\t}\n\t}\n\n\t#onPullInvite(params)\n\t{\n\t\tif (!this.phoneSupport())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.callView && !this.callView?.popup)\n\t\t{\n\t\t\tthis.#onCallViewClose();\n\t\t}\n\n\t\tif (\n\t\t\tBX.localStorage.get(lsKeys.callView)\n\t\t\t&& this.callView?.popup\n\t\t\t&& !Boolean(this._currentCall)\n\t\t\t&& !this.isCallListMode()\n\t\t\t&& !this.messengerFacade.hasActiveCall()\n\t\t)\n\t\t{\n\t\t\tthis.showCallViewBalloon();\n\t\t}\n\n\t\tif (this.hasActiveCall() || this.isCallListMode() || this.messengerFacade.hasActiveCall())\n\t\t{\n\t\t\tBX.rest.callMethod('voximplant.call.busy', {\n\t\t\t\tCALL_ID: params.callId,\n\t\t\t\tDEBUG_INFO: this.getDebugInfo(),\n\t\t\t});\n\t\t\treturn false;\n\t\t}\n\n\t\tif (\n\t\t\tBX.localStorage.get(lsKeys.callInited)\n\t\t\t|| BX.localStorage.get(lsKeys.externalCall)\n\t\t\t|| this.skippedCallsList.includes(params.callId)\n\t\t)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.checkDesktop().then(() => {\n\t\t\tif (params.CRM && params.CRM.FOUND)\n\t\t\t{\n\t\t\t\tthis.phoneCrm = params.CRM;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.phoneCrm = {};\n\t\t\t}\n\n\t\t\tthis.phonePortalCall = !!params.portalCall;\n\t\t\tif (this.phonePortalCall && params.portalCallData)\n\t\t\t{\n\t\t\t\tconst userData = params.portalCallData[params.portalCallUserId];\n\t\t\t\tif (userData)\n\t\t\t\t{\n\t\t\t\t\tparams.callerId = userData.name;\n\t\t\t\t}\n\n\t\t\t\tparams.phoneNumber = '';\n\t\t\t}\n\n\t\t\tthis.phoneCallConfig = params.config ? params.config : {};\n\t\t\tthis.phoneCallTime = 0;\n\n\t\t\tthis.messengerFacade.repeatSound('ringtone', 5000);\n\n\t\t\tBX.rest.callMethod('voximplant.call.sendWait', {\n\t\t\t\t'CALL_ID': params.callId,\n\t\t\t\t'DEBUG_INFO': this.getDebugInfo()\n\t\t\t})\n\n\t\t\tthis.isCallTransfer = !!params.isTransfer;\n\n\t\t\tthis.displayIncomingCall({\n\t\t\t\tchatId: params.chatId,\n\t\t\t\tcallId: params.callId,\n\t\t\t\tcallerId: params.callerId,\n\t\t\t\tlineNumber: params.lineNumber,\n\t\t\t\tcompanyPhoneNumber: params.phoneNumber,\n\t\t\t\tisCallback: params.isCallback,\n\t\t\t\tshowCrmCard: params.showCrmCard,\n\t\t\t\tcrmEntityType: params.crmEntityType,\n\t\t\t\tcrmEntityId: params.crmEntityId,\n\t\t\t\tcrmActivityId: params.crmActivityId,\n\t\t\t\tcrmActivityEditUrl: params.crmActivityEditUrl,\n\t\t\t\tportalCall: params.portalCall,\n\t\t\t\tportalCallUserId: params.portalCallUserId,\n\t\t\t\tportalCallData: params.portalCallData,\n\t\t\t\tconfig: params.config\n\t\t\t});\n\t\t}).catch(() => {});\n\t}\n\n\t#onPullAnswerSelf(params)\n\t{\n\t\tif (this.callSelfDisabled || this.callId != params.callId)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.messengerFacade.stopRepeatSound('ringtone');\n\t\tthis.messengerFacade.stopRepeatSound('dialtone');\n\n\t\tthis.phoneCallFinish();\n\t\tthis.callAbort();\n\t\tthis.callView.close();\n\n\t\tthis.callId = params.callId;\n\t}\n\n\t#onPullTimeout(params)\n\t{\n\t\tif (!this.skippedCallsList.includes(params.callId))\n\t\t{\n\t\t\tthis.skippedCallsList.push(params.callId);\n\t\t}\n\n\t\tif (this.phoneTransferCallId === params.callId)\n\t\t{\n\t\t\treturn this.errorInviteTransfer(params.failedCode, params.failedReason);\n\t\t}\n\t\telse if (this.callId != params.callId)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tclearInterval(this.phoneConnectedInterval);\n\t\tBX.localStorage.remove(lsKeys.callInited);\n\n\t\tvar external = this.hasExternalCall;\n\n\t\tthis.messengerFacade.stopRepeatSound('ringtone');\n\t\tthis.messengerFacade.stopRepeatSound('dialtone');\n\n\t\tthis.phoneCallFinish();\n\t\tthis.callAbort();\n\n\t\tif (!this.callView)\n\t\t{\n\t\t\treturn\n\t\t}\n\n\t\tthis.showCallViewBalloon();\n\t\tthis.callView.setCallState(CallState.idle, {failedCode: params.failedCode});\n\t\tif (external && params.failedCode == 486)\n\t\t{\n\t\t\tthis.callView.setProgress(CallProgress.offline);\n\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_PHONE_ERROR_BUSY_PHONE'));\n\t\t\tthis.callView.setUiState(UiState.sipPhoneError);\n\t\t}\n\t\telse if (external && params.failedCode == 480)\n\t\t{\n\t\t\tthis.callView.setProgress(CallProgress.error);\n\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_PHONE_ERROR_NA_PHONE'));\n\t\t\tthis.callView.setUiState(UiState.sipPhoneError);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.isCallListMode())\n\t\t\t{\n\t\t\t\tthis.callView.setStatusText('');\n\t\t\t\tthis.callView.setUiState(UiState.outgoing);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_PHONE_END'));\n\t\t\t\tthis.callView.setUiState(UiState.idle);\n\t\t\t\tthis.callView.autoClose();\n\t\t\t}\n\t\t}\n\t}\n\n\t#onPullOutgoing(params)\n\t{\n\t\tif ((this.phoneNumber == params.phoneNumber || params.phoneNumber.indexOf(this.phoneNumber) >= 0))\n\t\t{\n\t\t\tthis.deviceType = params.callDevice == DeviceType.Phone ? DeviceType.Phone : DeviceType.Webrtc;\n\t\t\tthis.phonePortalCall = !!params.portalCall;\n\n\t\t\tthis.phoneNumber = params.phoneNumber;\n\n\t\t\tif (this.hasExternalCall && this.deviceType == DeviceType.Phone)\n\t\t\t{\n\t\t\t\tthis.callView.setProgress(CallProgress.connect);\n\t\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_PHONE_WAIT_ANSWER'));\n\t\t\t}\n\n\t\t\tthis.phoneCallConfig = params.config ? params.config : {};\n\t\t\tthis.callId = params.callId;\n\t\t\tthis.phoneCallTime = 0;\n\t\t\tthis.phoneCrm = params.CRM;\n\t\t\tif (this.callView && params.showCrmCard)\n\t\t\t{\n\t\t\t\tthis.callView.setCrmData(params.CRM);\n\t\t\t\tthis.callView.setCrmEntity({\n\t\t\t\t\ttype: params.crmEntityType,\n\t\t\t\t\tid: params.crmEntityId,\n\t\t\t\t\tactivityId: params.crmActivityId,\n\t\t\t\t\tactivityEditUrl: params.crmActivityEditUrl,\n\t\t\t\t\tbindings: params.crmBindings\n\t\t\t\t});\n\t\t\t\tthis.callView.setConfig(params.config);\n\t\t\t\tthis.callView.setCallId(params.callId);\n\t\t\t\tif (params.lineNumber)\n\t\t\t\t{\n\t\t\t\t\tthis.callView.setLineNumber(params.lineNumber);\n\t\t\t\t}\n\n\t\t\t\tif (params.lineName)\n\t\t\t\t{\n\t\t\t\t\tthis.callView.setCompanyPhoneNumber(params.lineName);\n\t\t\t\t}\n\n\t\t\t\tthis.callView.reloadCrmCard();\n\t\t\t}\n\n\t\t\tif (this.callView && this.phonePortalCall)\n\t\t\t{\n\t\t\t\tthis.callView.setPortalCall(true);\n\t\t\t\tthis.callView.setPortalCallData(params.portalCallData);\n\t\t\t\tthis.callView.setPortalCallUserId(params.portalCallUserId);\n\t\t\t\tthis.callView.setPortalCallQueueName(params.portalCallQueueName);\n\t\t\t}\n\t\t}\n\t\telse if (!this.hasActiveCall() && params.callDevice === DeviceType.Phone)\n\t\t{\n\t\t\tthis.checkDesktop().then(() =>\n\t\t\t{\n\t\t\t\tthis.deviceType = params.callDevice === DeviceType.Phone ? DeviceType.Phone : DeviceType.Webrtc;\n\t\t\t\tthis.phonePortalCall = !!params.portalCall;\n\t\t\t\tthis.callId = params.callId;\n\t\t\t\tthis.phoneCallTime = 0;\n\t\t\t\tthis.phoneCallConfig = params.config ? params.config : {};\n\t\t\t\tthis.phoneCrm = params.CRM;\n\n\t\t\t\tthis.phoneDisplayExternal({\n\t\t\t\t\tcallId: params.callId,\n\t\t\t\t\tconfig: params.config ? params.config : {},\n\t\t\t\t\tphoneNumber: params.phoneNumber,\n\t\t\t\t\tportalCall: params.portalCall,\n\t\t\t\t\tportalCallUserId: params.portalCallUserId,\n\t\t\t\t\tportalCallData: params.portalCallData,\n\t\t\t\t\tportalCallQueueName: params.portalCallQueueName,\n\t\t\t\t\tshowCrmCard: params.showCrmCard,\n\t\t\t\t\tcrmEntityType: params.crmEntityType,\n\t\t\t\t\tcrmEntityId: params.crmEntityId\n\t\t\t\t});\n\t\t\t}).catch(() => {});\n\t\t}\n\t}\n\n\t#onPullStart(params)\n\t{\n\t\tif (this.phoneTransferCallId === params.callId)\n\t\t{\n\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_TRANSFER_CONNECTED'));\n\t\t\treturn;\n\t\t}\n\t\tif (this.callId != params.callId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callOverlayTimer('start');\n\t\tthis.messengerFacade.stopRepeatSound('ringtone');\n\t\tif (this.callId == params.callId && this.deviceType == DeviceType.Phone && (this.deviceType == params.callDevice || this.phonePortalCall))\n\t\t{\n\t\t\tthis.#onCallConnected();\n\t\t}\n\t\telse if (this.callId == params.callId && params.callDevice == DeviceType.Phone && this.phoneIncoming)\n\t\t{\n\t\t\tthis.deviceType = DeviceType.Phone;\n\t\t\tif (this.callView)\n\t\t\t{\n\t\t\t\tthis.callView.setDeviceCall(true);\n\t\t\t}\n\t\t\tthis.#onCallConnected();\n\t\t}\n\t\tif (params.CRM)\n\t\t{\n\t\t\tthis.phoneCrm = params.CRM;\n\t\t}\n\n\t\tif (this.phoneNumber !== '')\n\t\t{\n\t\t\tthis.phoneNumberLast = this.phoneNumber;\n\t\t\tthis.messengerFacade.setLocalConfig('phone_last', this.phoneNumber);\n\t\t}\n\t}\n\n\t#onPullHold(params)\n\t{\n\t\tif (this.callId == params.callId)\n\t\t{\n\t\t\tthis.isCallHold = true;\n\t\t}\n\t}\n\n\t#onPullUnhold(params)\n\t{\n\t\tif (this.callId == params.callId)\n\t\t{\n\t\t\tthis.isCallHold = false;\n\t\t}\n\t}\n\n\t#onPullUpdateCrm(params)\n\t{\n\t\tif (this.callId == params.callId && params.CRM && params.CRM.FOUND)\n\t\t{\n\t\t\tthis.phoneCrm = params.CRM;\n\n\t\t\tif (this.callView)\n\t\t\t{\n\t\t\t\tthis.callView.setCrmData(params.CRM);\n\t\t\t\tif (params.showCrmCard)\n\t\t\t\t{\n\t\t\t\t\tthis.callView.setCrmEntity({\n\t\t\t\t\t\ttype: params.crmEntityType,\n\t\t\t\t\t\tid: params.crmEntityId,\n\t\t\t\t\t\tactivityId: params.crmActivityId,\n\t\t\t\t\t\tactivityEditUrl: params.crmActivityEditUrl,\n\t\t\t\t\t\tbindings: params.crmBindings\n\t\t\t\t\t});\n\t\t\t\t\tthis.callView.reloadCrmCard();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t#onPullUpdatePortalUser(params)\n\t{\n\t\tif (this.callId == params.callId && this.callView)\n\t\t{\n\t\t\tthis.callView.setPortalCall(true);\n\t\t\tthis.callView.setPortalCallData(params.portalCallData);\n\t\t\tthis.callView.setPortalCallUserId(params.portalCallUserId);\n\t\t}\n\t}\n\n\t#onPullCompleteTransfer(params)\n\t{\n\t\tif (this.callId != params.callId)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.callId = params.newCallId;\n\n\t\tthis.phoneTransferTargetId = 0;\n\t\tthis.phoneTransferTargetType = '';\n\t\tthis.phoneTransferCallId = '';\n\t\tthis.phoneTransferEnabled = false;\n\t\tBX.localStorage.set(lsKeys.vite, false, 1);\n\n\t\tthis.deviceType = params.callDevice == DeviceType.Phone ? DeviceType.Phone : DeviceType.Webrtc;\n\t\tif (this.deviceType == DeviceType.Phone)\n\t\t{\n\t\t\tthis.callView.setDeviceCall(true);\n\t\t}\n\t\tthis.callView.setTransfer(false);\n\t\tthis.#onCallConnected();\n\t}\n\n\t#onPullPhoneDeviceActive(params)\n\t{\n\t\tthis.hasSipPhone = params.active == 'Y';\n\t}\n\n\t#onPullChangeDefaultLineId(params)\n\t{\n\t\tthis.defaultLineId = params.defaultLineId;\n\t}\n\n\t#onPullReplaceCallerId(params)\n\t{\n\t\tvar callTitle = Loc.getMessage('IM_PHONE_CALL_TRANSFER').replace('#PHONE#', params.callerId);\n\t\tthis.setCallOverlayTitle(callTitle);\n\t\tthis.callView.setPhoneNumber(params.callerId);\n\t\tif (params.CRM)\n\t\t{\n\t\t\tthis.phoneCrm = params.CRM;\n\t\t\tthis.callView.setCrmData(params.CRM);\n\t\t\tif (params.showCrmCard)\n\t\t\t{\n\t\t\t\tthis.callView.setCrmEntity({\n\t\t\t\t\ttype: params.crmEntityType,\n\t\t\t\t\tid: params.crmEntityId,\n\t\t\t\t\tactivityId: params.crmActivityId,\n\t\t\t\t\tactivityEditUrl: params.crmActivityEditUrl,\n\t\t\t\t\tbindings: params.crmBindings\n\t\t\t\t});\n\t\t\t\tthis.callView.reloadCrmCard();\n\t\t\t}\n\t\t}\n\t}\n\n\t#onPullShowExternalCall(params)\n\t{\n\t\tif (this.messengerFacade.hasActiveCall())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (BX.localStorage.get(lsKeys.callInited) || BX.localStorage.get(lsKeys.externalCall))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.checkDesktop().then(() =>\n\t\t{\n\t\t\tif (params.CRM && params.CRM.FOUND)\n\t\t\t{\n\t\t\t\tthis.phoneCrm = params.CRM;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.phoneCrm = {};\n\t\t\t}\n\n\t\t\tthis.showExternalCall({\n\t\t\t\tcallId: params.callId,\n\t\t\t\tfromUserId: params.fromUserId,\n\t\t\t\ttoUserId: params.toUserId,\n\t\t\t\tisCallback: params.isCallback,\n\t\t\t\tphoneNumber: params.phoneNumber,\n\t\t\t\tlineNumber: params.lineNumber,\n\t\t\t\tcompanyPhoneNumber: params.companyPhoneNumber,\n\t\t\t\tshowCrmCard: params.showCrmCard,\n\t\t\t\tcrmEntityType: params.crmEntityType,\n\t\t\t\tcrmEntityId: params.crmEntityId,\n\t\t\t\tcrmBindings: params.crmBindings,\n\t\t\t\tcrmActivityId: params.crmActivityId,\n\t\t\t\tcrmActivityEditUrl: params.crmActivityEditUrl,\n\t\t\t\tconfig: params.config,\n\t\t\t\tportalCall: params.portalCall,\n\t\t\t\tportalCallData: params.portalCallData,\n\t\t\t\tportalCallUserId: params.portalCallUserId\n\t\t\t});\n\t\t}).catch(() => {});\n\t}\n\n\t#onPullHideExternalCall(params)\n\t{\n\t\tif (this.hasActiveCall() && this.hasExternalCall && this.callId == params.callId)\n\t\t{\n\t\t\tthis.hideExternalCall();\n\t\t}\n\t}\n\n\tcorrectPhoneNumber(number)\n\t{\n\t\treturn number.toString().replace(/[^0-9+#*;,]/g, '');\n\t}\n\n\t#onIncomingCall(params)\n\t{\n\t\t// we can't use hasActiveCall here because the call view is open\n\t\tif (this.currentCall)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.currentCall = params.call;\n\t\tthis.currentCall.answer();\n\t}\n\n\tgetCallParams()\n\t{\n\t\tlet result = Type.isPlainObject(this.phoneParams) ? Runtime.clone(this.phoneParams) : {};\n\t\tif (this.phoneFullNumber != this.phoneNumber)\n\t\t{\n\t\t\tresult['FULL_NUMBER'] = this.phoneFullNumber;\n\t\t}\n\t\treturn JSON.stringify(result);\n\t}\n\n\t#startCall()\n\t{\n\t\tthis.phoneParams['CALLER_ID'] = '';\n\t\tthis.phoneParams['USER_ID'] = this.userId;\n\t\tthis.phoneLog('Call params: ', this.phoneNumber, this.phoneParams);\n\t\tif (!this.voximplantClient.connected())\n\t\t{\n\t\t\tthis.#phoneOnSDKReady();\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.currentCall = this.voximplantClient.call(this.phoneNumber, false, this.getCallParams());\n\n\t\tconst initParams = {\n\t\t\t'NUMBER': this.phoneNumber,\n\t\t\t'NUMBER_USER': Text.decode(this.phoneNumberUser),\n\t\t\t'IM_AJAX_CALL': 'Y',\n\t\t}\n\t\tBX.rest.callMethod('voximplant.call.init', initParams).then((response) =>\n\t\t{\n\t\t\tconst data = response.data();\n\t\t\tif (!(data.HR_PHOTO.length === 0))\n\t\t\t{\n\t\t\t\tthis.callOverlayUserId = data.DIALOG_ID;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.callOverlayChatId = data.DIALOG_ID.substring(4);\n\t\t\t}\n\t\t})\n\t}\n\n\tphoneCallFinish()\n\t{\n\t\tclearInterval(this.phoneConnectedInterval);\n\t\tclearInterval(this.phoneCallTimeInterval);\n\t\tBX.localStorage.remove(lsKeys.callInited);\n\n\t\tthis.callOverlayTimer('pause');\n\t\tthis.showCallViewBalloon();\n\n\t\tif (this.currentCall)\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tthis.currentCall.hangup({\n\t\t\t\t\t\"X-Disconnect-Code\": 200,\n\t\t\t\t\t\"X-Disconnect-Reason\": \"Normal hangup\"\n\t\t\t\t});\n\t\t\t} catch (e)\n\t\t\t{}\n\t\t\tthis.currentCall = null;\n\t\t\tthis.phoneLog('Call hangup call');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.scheduleApiDisconnect();\n\t\t}\n\n\t\tif (this.keypad)\n\t\t{\n\t\t\tthis.keypad.close();\n\t\t}\n\n\t\tBX.localStorage.set(lsKeys.vite, false, 1);\n\n\t\tthis.phoneRinging = 0;\n\t\tthis.phoneIncoming = false;\n\t\tthis.callActive = false;\n\t\tthis.callId = '';\n\t\tthis.hasExternalCall = false;\n\t\tthis.deviceType = DeviceType.Webrtc;\n\t\t//this.phonePortalCall = false;\n\t\tthis.phoneNumber = '';\n\t\tthis.phoneNumberUser = '';\n\t\tthis.phoneParams = {};\n\t\tthis.callOverlayOptions = {};\n\t\tthis.callSelfDisabled = false;\n\t\t//this.phoneCrm = {};\n\t\tthis.isMuted = false;\n\t\tthis.isCallHold = false;\n\t\tthis.isCallTransfer = false;\n\t\tthis.phoneMicAccess = false;\n\t\tthis.phoneTransferTargetType = '';\n\t\tthis.phoneTransferTargetId = 0;\n\t\tthis.phoneTransferCallId = '';\n\t\tthis.phoneTransferEnabled = false;\n\t}\n\n\tphoneOnAuthResult()\n\t{\n\t\tif (this.deviceType == DeviceType.Phone)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.phoneIncoming)\n\t\t{\n\t\t\tBX.rest.callMethod('voximplant.call.sendReady', {'CALL_ID': this.callId});\n\t\t}\n\t\telse if (this.callInitUserId == this.userId)\n\t\t{\n\t\t\tthis.#startCall();\n\t\t}\n\t}\n\n\t#onCallFailed(e)\n\t{\n\t\tconst headers = e.headers || {};\n\t\tthis.phoneLog('Call failed', e.code, e.reason);\n\n\t\tvar reason = Loc.getMessage('IM_PHONE_END');\n\t\tif (e.code == 603)\n\t\t{\n\t\t\treason = Loc.getMessage('IM_PHONE_DECLINE');\n\t\t}\n\t\telse if (e.code == 380)\n\t\t{\n\t\t\treason = Loc.getMessage('IM_PHONE_ERR_SIP_LICENSE');\n\t\t}\n\t\telse if (e.code == 436)\n\t\t{\n\t\t\treason = Loc.getMessage('IM_PHONE_ERR_NEED_RENT');\n\t\t}\n\t\telse if (e.code == 438)\n\t\t{\n\t\t\treason = Loc.getMessage('IM_PHONE_ERR_BLOCK_RENT');\n\t\t}\n\t\telse if (e.code == 400)\n\t\t{\n\t\t\treason = Loc.getMessage('IM_PHONE_ERR_LICENSE');\n\t\t}\n\t\telse if (e.code == 401)\n\t\t{\n\t\t\treason = Loc.getMessage('IM_PHONE_401');\n\t\t}\n\t\telse if (e.code == 480 || e.code == 503)\n\t\t{\n\t\t\tif (this.phoneNumber == 911 || this.phoneNumber == 112)\n\t\t\t{\n\t\t\t\treason = Loc.getMessage('IM_PHONE_NO_EMERGENCY');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treason = Loc.getMessage('IM_PHONE_UNAVAILABLE');\n\t\t\t}\n\t\t}\n\t\telse if (e.code == 484 || e.code == 404)\n\t\t{\n\t\t\tif (this.phoneNumber == 911 || this.phoneNumber == 112)\n\t\t\t{\n\t\t\t\treason = Loc.getMessage('IM_PHONE_NO_EMERGENCY');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treason = Loc.getMessage('IM_PHONE_INCOMPLETED');\n\t\t\t}\n\t\t}\n\t\telse if (e.code == 402)\n\t\t{\n\t\t\tif (headers.hasOwnProperty('X-Reason') && headers['X-Reason'] === \"SIP_PAYMENT_REQUIRED\")\n\t\t\t{\n\t\t\t\treason = Loc.getMessage('IM_PHONE_ERR_SIP_LICENSE');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treason = Loc.getMessage('IM_PHONE_NO_MONEY') + (this.isAdmin ? ' ' + Loc.getMessage('IM_PHONE_PAY_URL_NEW') : '');\n\t\t\t}\n\t\t}\n\t\telse if (e.code == 486 && this.phoneRinging > 1)\n\t\t{\n\t\t\treason = Loc.getMessage('IM_M_CALL_ST_DECLINE');\n\t\t}\n\t\telse if (e.code == 486)\n\t\t{\n\t\t\treason = Loc.getMessage('IM_PHONE_ERROR_BUSY');\n\t\t}\n\t\telse if (e.code == 403)\n\t\t{\n\t\t\treason = Loc.getMessage('IM_PHONE_403');\n\t\t\tthis.phoneServer = '';\n\t\t\tthis.phoneLogin = '';\n\t\t\tthis.phoneCheckBalance = true;\n\t\t}\n\t\telse if (e.code == 504)\n\t\t{\n\t\t\treason = Loc.getMessage('IM_PHONE_ERROR_CONNECT');\n\t\t}\n\t\telse\n\t\t{\n\t\t\treason = Loc.getMessage('IM_PHONE_ERROR');\n\t\t}\n\n\t\tif (e.code == 408 || e.code == 403)\n\t\t{\n\t\t\tthis.scheduleApiDisconnect();\n\t\t}\n\t\tthis.callOverlayProgress('offline');\n\t\tthis.callAbort(reason);\n\n\t\tthis.callView.setUiState(UiState.error);\n\t\tthis.callView.setCallState(CallState.idle);\n\t}\n\n\tscheduleApiDisconnect()\n\t{\n\t\tif (this.voximplantClient && this.voximplantClient.connected())\n\t\t{\n\t\t\tsetTimeout(() =>\n\t\t\t{\n\t\t\t\tif (this.voximplantClient && this.voximplantClient.connected())\n\t\t\t\t{\n\t\t\t\t\tthis.voximplantClient.disconnect();\n\t\t\t\t}\n\t\t\t}, 500);\n\t\t}\n\t}\n\n\t#onCallDisconnected(e)\n\t{\n\t\tthis.phoneLog('Call disconnected', this.currentCall ? this.currentCall.id() : '-', this.currentCall ? this.currentCall.state() : '-');\n\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.phoneCallFinish();\n\t\t\tthis.callOverlayDeleteEvents();\n\t\t\tthis.callOverlayStatus(Loc.getMessage('IM_M_CALL_ST_END'));\n\n\t\t\tthis.messengerFacade.playSound('stop');\n\t\t\tthis.callView.setCallState(CallState.idle);\n\t\t\tif (this.isCallListMode())\n\t\t\t{\n\t\t\t\tthis.callView.setUiState(UiState.outgoing);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_PHONE_END'));\n\t\t\t\tthis.callView.setUiState(UiState.idle);\n\t\t\t\tthis.callView.autoClose();\n\t\t\t}\n\t\t}\n\n\t\tthis.scheduleApiDisconnect();\n\t}\n\n\t#onProgressToneStart(e)\n\t{\n\t\tif (!this.currentCall)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.phoneLog('Progress tone start', this.currentCall.id());\n\t\tthis.phoneRinging++;\n\t\tthis.callOverlayStatus(Loc.getMessage('IM_PHONE_WAIT_ANSWER'));\n\t}\n\n\t#onProgressToneStop(e)\n\t{\n\t\tif (!this.currentCall)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tthis.phoneLog('Progress tone stop', this.currentCall.id());\n\t}\n\n\t#onConnectionEstablished(e)\n\t{\n\t\tthis.phoneLog('Connection established', this.voximplantClient.connected());\n\t}\n\n\t#onConnectionFailed(e)\n\t{\n\t\tthis.phoneLog('Connection failed');\n\t\tthis.phoneCallFinish();\n\t\tthis.callAbort(Loc.getMessage('IM_M_CALL_ERR'));\n\t}\n\n\t#onConnectionClosed(e)\n\t{\n\t\tthis.phoneLog('Connection closed');\n\t}\n\n\t#onMicResult(e)\n\t{\n\t\tthis.phoneMicAccess = e.result;\n\t\tthis.phoneLog('Mic Access Allowed', e.result);\n\n\t\tif (e.result)\n\t\t{\n\t\t\tthis.callOverlayProgress('connect');\n\t\t\tthis.callOverlayStatus(Loc.getMessage('IM_M_CALL_ST_CONNECT'));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.phoneCallFinish();\n\t\t\tthis.callOverlayProgress('offline');\n\t\t\tthis.callAbort(Loc.getMessage('IM_M_CALL_ST_NO_ACCESS'));\n\n\t\t\tthis.callView.setUiState(UiState.error);\n\t\t\tthis.callView.setCallState(CallState.idle);\n\t\t}\n\t}\n\n\t#onNetStatsReceived(e)\n\t{\n\t\tif (!this.currentCall || this.currentCall.state() != \"CONNECTED\")\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst percent = (100 - parseInt(e.stats.packetLoss));\n\t\tconst grade = this.displayCallQuality(percent);\n\n\t\tthis.currentCall.sendMessage(JSON.stringify({\n\t\t\t'COMMAND': 'meter',\n\t\t\t'PACKETLOSS': e.stats.packetLoss,\n\t\t\t'PERCENT': percent,\n\t\t\t'GRADE': grade\n\t\t}));\n\t}\n\n\tholdCall()\n\t{\n\t\tthis.toggleCallHold(true);\n\t}\n\n\tunholdCall()\n\t{\n\t\tthis.toggleCallHold(false);\n\t}\n\n\ttoggleCallHold(state)\n\t{\n\t\tif (!this.currentCall && this.deviceType == DeviceType.Webrtc)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (typeof (state) != 'undefined')\n\t\t{\n\t\t\tthis.isCallHold = !state;\n\t\t}\n\n\t\tif (this.isCallHold)\n\t\t{\n\t\t\tif (this.deviceType === DeviceType.Webrtc)\n\t\t\t{\n\t\t\t\tthis.currentCall.sendMessage(JSON.stringify({'COMMAND': 'unhold'}));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tBX.rest.callMethod('voximplant.call.unhold', {'CALL_ID': this.callId});\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.deviceType === DeviceType.Webrtc)\n\t\t\t{\n\t\t\t\tthis.currentCall.sendMessage(JSON.stringify({'COMMAND': 'hold'}));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tBX.rest.callMethod('voximplant.call.hold', {'CALL_ID': this.callId});\n\t\t\t}\n\t\t}\n\t\tthis.isCallHold = !this.isCallHold;\n\t}\n\n\tsendDTMF(key)\n\t{\n\t\tif (!this.currentCall)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.phoneLog('Send DTMF code', this.currentCall.id(), key);\n\n\t\tthis.currentCall.sendTone(key);\n\t}\n\n\tstartCallViaRestApp(number, lineId, params)\n\t{\n\t\tBX.rest.callMethod(\n\t\t\t'voximplant.call.startViaRest',\n\t\t\t{\n\t\t\t\t'NUMBER': number,\n\t\t\t\t'LINE_ID': lineId,\n\t\t\t\t'PARAMS': params,\n\t\t\t\t'SHOW': 'Y'\n\t\t\t}\n\t\t);\n\t}\n\n\tphoneSupport()\n\t{\n\t\treturn this.phoneEnabled && (this.hasSipPhone || this.ready());\n\t}\n\n\tmuteCall()\n\t{\n\t\tif (!this.currentCall)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.isMuted = true;\n\t\tthis.currentCall.muteMicrophone();\n\t}\n\n\tunmuteCall()\n\t{\n\t\tif (!this.currentCall)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.isMuted = false;\n\t\tthis.currentCall.unmuteMicrophone();\n\t}\n\n\ttoggleCallAudio()\n\t{\n\t\tif (!this.currentCall)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.isMuted)\n\t\t{\n\t\t\tthis.currentCall.unmuteMicrophone();\n\t\t\tthis.callView.setMuted(false);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.currentCall.muteMicrophone();\n\t\t}\n\t\tthis.isMuted = !this.isMuted;\n\t}\n\n\tphoneDeviceCall(status)\n\t{\n\t\tlet result = true;\n\t\tif (typeof (status) == 'boolean')\n\t\t{\n\t\t\tthis.messengerFacade.setLocalConfig('viDeviceCallBlock', !status);\n\t\t\tBX.localStorage.set('viDeviceCallBlock', !status, 86400);\n\t\t\tif (this.callView)\n\t\t\t{\n\t\t\t\tthis.callView.setDeviceCall(status);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet deviceCallBlock = this.messengerFacade.getLocalConfig('viDeviceCallBlock');\n\t\t\tif (!deviceCallBlock)\n\t\t\t{\n\t\t\t\tdeviceCallBlock = BX.localStorage.get('viDeviceCallBlock');\n\t\t\t}\n\t\t\tresult = this.hasSipPhone && !deviceCallBlock;\n\t\t}\n\t\treturn result;\n\n\t}\n\n\topenKeyPad(e = {})\n\t{\n\t\tif (Loc.getMessage[\"voximplantCanMakeCalls\"] == \"N\")\n\t\t{\n\t\t\tRuntime.loadExtension(\"voximplant.common\").then(() => BX.Voximplant.openLimitSlider());\n\t\t\treturn;\n\t\t}\n\n\t\tthis.loadPhoneLines().then(() => this.#doOpenKeyPad(e));\n\t}\n\n\t#doOpenKeyPad(e)\n\t{\n\t\tif (!this.phoneSupport() && !this.isRestLine(this.defaultLineId))\n\t\t{\n\t\t\tthis.showUnsupported();\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.hasActiveCall() || BX.localStorage.get(lsKeys.callInited) || BX.localStorage.get(lsKeys.externalCall))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.keypad)\n\t\t{\n\t\t\tthis.keypad.close();\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.keypad = new Keypad({\n\t\t\tbindElement: e.bindElement,\n\t\t\toffsetTop: e.offsetTop,\n\t\t\toffsetLeft: e.offsetLeft,\n\t\t\tanglePosition: e.anglePosition,\n\t\t\tangleOffset: e.angleOffset,\n\t\t\tdefaultLineId: this.defaultLineId,\n\t\t\tlines: this.phoneLines,\n\t\t\tavailableLines: this.availableLines,\n\t\t\thistory: this.dialHistory,\n\t\t\tcallInterceptAllowed: this.callInterceptAllowed,\n\n\t\t\tonDial: this.onKeyPadDial.bind(this),\n\t\t\tonIntercept: this.onKeyPadIntercept.bind(this),\n\t\t\tonClose: () =>\n\t\t\t{\n\t\t\t\tthis.onKeyPadClose();\n\t\t\t\tif (Type.isFunction(e.onClose))\n\t\t\t\t{\n\t\t\t\t\te.onClose()\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.keypad.show();\n\t}\n\n\tonKeyPadDial(e)\n\t{\n\t\tlet params = {};\n\t\tthis.closeKeyPad()\n\n\t\tif (e.lineId)\n\t\t{\n\t\t\tparams['LINE_ID'] = e.lineId;\n\t\t}\n\n\t\tthis.phoneCall(e.phoneNumber, params);\n\t}\n\n\tonKeyPadIntercept(e)\n\t{\n\t\tif (!this.callInterceptAllowed)\n\t\t{\n\t\t\tthis.keypad.close();\n\t\t\tif ('UI' in BX && 'InfoHelper' in BX.UI)\n\t\t\t{\n\t\t\t\tBX.UI.InfoHelper.show('limit_contact_center_telephony_intercept');\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tBX.rest.callMethod('voximplant.call.intercept').then((response) =>\n\t\t{\n\t\t\tconst data = response.data();\n\n\t\t\tif (!data.FOUND || data.FOUND == 'Y')\n\t\t\t{\n\t\t\t\tthis.keypad.close();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (data.ERROR)\n\t\t\t\t{\n\t\t\t\t\tthis.interceptErrorPopup = new Popup({\n\t\t\t\t\t\tid: 'intercept-call-error',\n\t\t\t\t\t\tbindElement: e.interceptButton,\n\t\t\t\t\t\ttargetContainer: document.body,\n\t\t\t\t\t\tcontent: Text.encode(data.ERROR),\n\t\t\t\t\t\tautoHide: true,\n\t\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\t\tcacheable: false,\n\t\t\t\t\t\tbindOptions: {\n\t\t\t\t\t\t\tposition: 'bottom'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tangle: {\n\t\t\t\t\t\t\toffset: 40\n\t\t\t\t\t\t},\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tonPopupClose: (e) => this.interceptErrorPopup = null,\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tthis.interceptErrorPopup.show();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tonKeyPadClose()\n\t{\n\t\tthis.keypad = null;\n\t}\n\n\tcloseKeyPad()\n\t{\n\t\tif (this.keypad)\n\t\t{\n\t\t\tthis.keypad.close();\n\t\t}\n\t}\n\n\tphoneDisplayExternal(params)\n\t{\n\t\tvar number = params.phoneNumber;\n\t\tthis.phoneLog(number, params);\n\n\t\tthis.phoneNumberUser = Text.encode(number);\n\n\t\tnumber = this.correctPhoneNumber(number);\n\t\tif (typeof (params) != 'object')\n\t\t{\n\t\t\tparams = {};\n\t\t}\n\n\t\tif (this.callActive)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.initiator = true;\n\t\tthis.callInitUserId = this.userId;\n\t\tthis.callActive = false;\n\t\tthis.callUserId = 0;\n\t\tthis.phoneNumber = number;\n\n\t\tthis.callView = new PhoneCallView({\n\t\t\tcallId: params.callId,\n\t\t\tconfig: params.config,\n\t\t\tdirection: Direction.outgoing,\n\t\t\tphoneNumber: this.phoneNumber,\n\t\t\tstatusText: Loc.getMessage('IM_M_CALL_ST_CONNECT'),\n\t\t\thasSipPhone: true,\n\t\t\tdeviceCall: true,\n\t\t\tportalCall: params.portalCall,\n\t\t\tportalCallUserId: params.portalCallUserId,\n\t\t\tportalCallData: params.portalCallData,\n\t\t\tportalCallQueueName: params.portalCallQueueName,\n\t\t\tcrm: params.showCrmCard,\n\t\t\tcrmEntityType: params.crmEntityType,\n\t\t\tcrmEntityId: params.crmEntityId,\n\t\t\tcrmData: this.phoneCrm,\n\t\t\tfoldedCallView: this.foldedCallView,\n\t\t\tbackgroundWorker: this.backgroundWorker,\n\t\t\tmessengerFacade: this.messengerFacade,\n\t\t\trestApps: this.restApps,\n\t\t});\n\t\tthis.#bindPhoneViewCallbacks(this.callView);\n\t\tthis.callView.setUiState(UiState.idle);\n\t\tthis.callView.setCallState(CallState.connected);\n\t\tthis.callView.show();\n\t}\n\n\tloadPhoneLines()\n\t{\n\t\tconst cachedLines = BX.localStorage.get('bx-im-phone-lines');\n\t\tif (cachedLines)\n\t\t{\n\t\t\tthis.phoneLines = cachedLines;\n\t\t\treturn Promise.resolve(cachedLines);\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tif (this.phoneLines)\n\t\t\t{\n\t\t\t\treturn resolve(this.phoneLines);\n\t\t\t}\n\n\t\t\tBX.ajax.runAction(\"voximplant.callView.getLines\").then((response) =>\n\t\t\t{\n\t\t\t\tthis.phoneLines = response.data;\n\t\t\t\tBX.localStorage.set('bx-im-phone-lines', this.phoneLines, 86400);\n\t\t\t\t{\n\t\t\t\t\tresolve(this.phoneLines);\n\t\t\t\t}\n\t\t\t}).catch((err) =>\n\t\t\t{\n\t\t\t\tconsole.error(err);\n\t\t\t\treject(err)\n\t\t\t})\n\t\t})\n\t}\n\n\tisRestLine(lineId)\n\t{\n\t\tif (!this.phoneLines)\n\t\t{\n\t\t\tthrow new Error(\"Phone lines are not loaded. Call PhoneCallsController.loadPhoneLines prior to using this method\")\n\t\t}\n\n\t\tif (this.phoneLines.hasOwnProperty(lineId))\n\t\t{\n\t\t\treturn this.phoneLines[lineId].TYPE === 'REST';\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tsetPhoneNumber(phoneNumber)\n\t{\n\t\tconst matches = /(\\+?\\d+)([;#]*)([\\d,]*)/.exec(phoneNumber);\n\t\tthis.phoneFullNumber = phoneNumber;\n\t\tif (matches)\n\t\t{\n\t\t\tthis.phoneNumber = matches[1];\n\t\t}\n\t}\n\n\tphoneCall(number, params)\n\t{\n\t\tthis.loadPhoneLines().then(() => this.#doPhoneCall(number, params));\n\t}\n\n\t#doPhoneCall(number, params = {})\n\t{\n\t\tif (BX.localStorage.get(lsKeys.callInited) || this.callView || this.hasActiveCall())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.phoneSupport())\n\t\t{\n\t\t\tthis.showUnsupported();\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.keypad)\n\t\t{\n\t\t\tthis.keypad.close();\n\t\t}\n\n\t\tif (Type.isStringFilled(number))\n\t\t{\n\t\t\tthis.addToHistory(number);\n\t\t}\n\n\t\tconst lineId = Type.isStringFilled(params['LINE_ID']) ? params['LINE_ID'] : this.defaultLineId;\n\t\tif (this.isRestLine(lineId))\n\t\t{\n\t\t\tthis.startCallViaRestApp(number, lineId, params);\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.phoneLog(number, params);\n\n\t\tthis.phoneNumberUser = Text.encode(number);\n\t\tlet numberOriginal = number;\n\n\t\tif (typeof (params) != 'object')\n\t\t{\n\t\t\tparams = {};\n\t\t}\n\n\t\tconst internationalNumber = this.correctPhoneNumber(number);\n\n\t\tif (internationalNumber.length <= 0)\n\t\t{\n\t\t\tMessageBox.alert(Loc.getMessage('IM_PHONE_WRONG_NUMBER_DESC'), Loc.getMessage('IM_PHONE_WRONG_NUMBER'))\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.setPhoneNumber(internationalNumber);\n\n\t\tthis.initiator = true;\n\t\tthis.callInitUserId = this.userId;\n\t\tthis.callActive = false;\n\t\tthis.callUserId = 0;\n\t\tthis.hasExternalCall = this.phoneDeviceCall();\n\t\tthis.phoneParams = params;\n\n\t\tthis.callView = new PhoneCallView({\n\t\t\tdarkMode: this.messengerFacade.isThemeDark(),\n\n\t\t\tphoneNumber: this.phoneFullNumber,\n\t\t\tcallTitle: this.phoneNumberUser,\n\t\t\tfromUserId: this.userId,\n\t\t\tdirection: Direction.outgoing,\n\t\t\tuiState: UiState.connectingOutgoing,\n\t\t\tstatus: Loc.getMessage('IM_M_CALL_ST_CONNECT'),\n\t\t\thasSipPhone: this.hasSipPhone,\n\t\t\tdeviceCall: this.hasExternalCall,\n\t\t\tcrmData: this.phoneCrm,\n\t\t\tautoFold: (params['AUTO_FOLD'] === true),\n\t\t\tfoldedCallView: this.foldedCallView,\n\t\t\tbackgroundWorker: this.backgroundWorker,\n\t\t\tmessengerFacade: this.messengerFacade,\n\t\t\trestApps: this.restApps,\n\t\t});\n\t\tthis.#bindPhoneViewCallbacks(this.callView);\n\t\tthis.callView.show();\n\n\t\tthis.messengerFacade.playSound(\"start\");\n\n\t\tif (this.hasExternalCall)\n\t\t{\n\t\t\tthis.deviceType = DeviceType.Phone;\n\t\t\tthis.callView.setProgress(CallProgress.wait);\n\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_PHONE_NOTICE'));\n\n\t\t\tconst callStartParams = {\n\t\t\t\t'NUMBER': numberOriginal.toString().replace(/[^0-9+*#,;]/g, ''),\n\t\t\t\t'PARAMS': params,\n\t\t\t};\n\n\t\t\tBX.rest.callMethod('voximplant.call.startWithDevice', callStartParams)\n\t\t\t\t.then((response) =>\n\t\t\t\t{\n\t\t\t\t\tconst data = response.data();\n\t\t\t\t\tthis.callId = data.CALL_ID;\n\t\t\t\t\tthis.hasExternalCall = (data.EXTERNAL === true);\n\t\t\t\t\tthis.phoneCallConfig = data.CONFIG;\n\t\t\t\t\tthis.callView.setProgress(CallProgress.wait);\n\t\t\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_WAIT_PHONE'));\n\t\t\t\t\tthis.callView.setUiState(UiState.connectingOutgoing);\n\t\t\t\t\tthis.callView.setCallState(CallState.connecting);\n\n\t\t\t\t\tthis.emit(Events.onDeviceCallStarted, {\n\t\t\t\t\t\tcallId: data.CALL_ID,\n\t\t\t\t\t\tconfig: data.CONFIG\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch(err =>\n\t\t\t\t{\n\t\t\t\t\tthis.callView.setProgress(CallProgress.error);\n\t\t\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_PHONE_ERROR'));\n\t\t\t\t\tthis.callView.setUiState(UiState.error);\n\t\t\t\t\tthis.callView.setCallState(CallState.idle);\n\t\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_CALL_INIT'));\n\n\t\t\tthis.phoneApiInit().then(() => this.#phoneOnSDKReady());\n\t\t}\n\t}\n\n\tshowUnsupported()\n\t{\n\t\tconst messageBox = new MessageBox({\n\t\t\tmessage: Loc.getMessage('IM_CALL_NO_WEBRT'),\n\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\tokCaption: Loc.getMessage('IM_M_CALL_BTN_DOWNLOAD'),\n\t\t\tcancelCaption: Loc.getMessage('IM_NOTIFY_CONFIRM_CLOSE'),\n\t\t\tonOk: () =>\n\t\t\t{\n\t\t\t\tconst url = Browser.isMac() ? \"http://dl.bitrix24.com/b24/bitrix24_desktop.dmg\" : \"http://dl.bitrix24.com/b24/bitrix24_desktop.exe\";\n\t\t\t\twindow.open(url, \"desktopApp\");\n\t\t\t\treturn true;\n\t\t\t},\n\t\t})\n\t\tmessageBox.show();\n\t}\n\n\taddToHistory(phoneNumber: string)\n\t{\n\t\tlet oldHistory = this.dialHistory;\n\t\tconst phoneIndex = oldHistory.indexOf(phoneNumber);\n\n\t\tif (phoneIndex === 0)\n\t\t{\n\t\t\t//it's the first element already, nothing to do\n\t\t}\n\t\telse if (phoneIndex > 0)\n\t\t{\n\t\t\t//moving number to the top\n\t\t\toldHistory.splice(phoneIndex, phoneIndex);\n\t\t\tthis.dialHistory = [phoneNumber].concat(oldHistory);\n\t\t}\n\t\telse\n\t\t{\n\t\t\t//adding as the top element of history\n\t\t\tthis.dialHistory = [phoneNumber].concat(oldHistory.slice(0, 4));\n\t\t}\n\n\t\tBX.localStorage.set(lsKeys.dialHistory, this.dialHistory, 31536000)\n\t\tthis.messengerFacade.setLocalConfig('phone-history', this.dialHistory);\n\t}\n\n\tstartCallList(callListId, params)\n\t{\n\t\tcallListId = Number(callListId);\n\t\tif (callListId === 0 || this.currentCall || this.callView || this.isCallListMode())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tthis.foldedCallView.destroy();\n\n\t\tthis.callListId = callListId;\n\t\tthis.callView = new PhoneCallView({\n\t\t\tcrm: true,\n\t\t\tcallListId: callListId,\n\t\t\tcallListStatusId: params.callListStatusId,\n\t\t\tcallListItemIndex: params.callListItemIndex,\n\t\t\tdirection: Direction.outgoing,\n\t\t\tmakeCall: (params.makeCall === true),\n\t\t\tuiState: UiState.outgoing,\n\t\t\twebformId: params.webformId || 0,\n\t\t\twebformSecCode: params.webformSecCode || '',\n\t\t\thasSipPhone: this.hasSipPhone,\n\t\t\tdeviceCall: this.phoneDeviceCall(),\n\t\t\tcrmData: this.phoneCrm,\n\t\t\tfoldedCallView: this.foldedCallView,\n\t\t\tbackgroundWorker: this.backgroundWorker,\n\t\t\tmessengerFacade: this.messengerFacade,\n\t\t\trestApps: this.restApps,\n\t\t});\n\n\t\tthis.#bindPhoneViewCallbacks(this.callView);\n\t\tthis.callView.show();\n\n\t\treturn true;\n\t}\n\n\tisCallListMode()\n\t{\n\t\treturn (this.callListId > 0);\n\t}\n\n\tcallListMakeCall(e)\n\t{\n\t\tthis.loadPhoneLines().then(() => this.#doCallListMakeCall(e));\n\t}\n\n\t#doCallListMakeCall(e)\n\t{\n\t\tif (this.isRestLine(this.defaultLineId))\n\t\t{\n\t\t\tthis.startCallViaRestApp(\n\t\t\t\te.phoneNumber,\n\t\t\t\tthis.defaultLineId,\n\t\t\t\t{\n\t\t\t\t\t'ENTITY_TYPE': 'CRM_' + e.crmEntityType,\n\t\t\t\t\t'ENTITY_ID': e.crmEntityId,\n\t\t\t\t\t'CALL_LIST_ID': e.callListId\n\t\t\t\t}\n\t\t\t);\n\t\t\treturn true;\n\t\t}\n\n\t\tif (BX.localStorage.get(lsKeys.callInited))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.callActive)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.callView)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.lastCallListCallParams = e;\n\n\t\tif (!this.phoneSupport())\n\t\t{\n\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_CALL_NO_WEBRT'));\n\t\t\tthis.callView.setUiState(UiState.error);\n\t\t\tthis.callView.setCallState(CallState.idle);\n\t\t\treturn false;\n\t\t}\n\n\t\tconst number = e.phoneNumber;\n\t\tconst numberOriginal = number;\n\t\tconst internationalNumber = this.correctPhoneNumber(number);\n\n\t\tif (internationalNumber.length <= 0)\n\t\t{\n\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_PHONE_WRONG_NUMBER_DESC').replace(\"<br/>\", \"\\n\"));\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.initiator = true;\n\t\tthis.callInitUserId = this.userId;\n\t\tthis.callActive = false;\n\t\tthis.callUserId = 0;\n\t\tthis.hasExternalCall = this.phoneDeviceCall();\n\t\tthis.setPhoneNumber(internationalNumber);\n\t\tthis.phoneParams = {\n\t\t\t'ENTITY_TYPE': 'CRM_' + e.crmEntityType,\n\t\t\t'ENTITY_ID': e.crmEntityId,\n\t\t\t'CALL_LIST_ID': e.callListId\n\t\t};\n\n\t\tthis.messengerFacade.playSound(\"start\");\n\n\t\tif (this.hasExternalCall)\n\t\t{\n\t\t\tthis.deviceType = DeviceType.Phone;\n\t\t\tthis.callView.setProgress(CallProgress.wait);\n\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_PHONE_NOTICE'));\n\t\t\tthis.callView.setUiState(UiState.connectingOutgoing);\n\t\t\tthis.callView.setCallState(CallState.connecting);\n\t\t\tconst callStartParams = {\n\t\t\t\t'NUMBER': numberOriginal.toString().replace(/[^0-9+*#,;]/g, ''),\n\t\t\t\t'PARAMS': this.phoneParams\n\t\t\t};\n\t\t\tBX.rest.callMethod('voximplant.call.startWithDevice', callStartParams)\n\t\t\t\t.then((response) =>\n\t\t\t\t{\n\t\t\t\t\tconst data = response.data();\n\t\t\t\t\tthis.callId = data.CALL_ID;\n\n\t\t\t\t\t// TODO: is this necessary? It did not work previously\n\t\t\t\t\tthis.hasExternalCall = (data.EXTERNAL === true);\n\t\t\t\t\tthis.phoneCallConfig = data.CONFIG;\n\n\t\t\t\t\tthis.callView.setProgress(CallProgress.wait);\n\t\t\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_WAIT_PHONE'));\n\t\t\t\t\tthis.callView.setUiState(UiState.connectingOutgoing);\n\t\t\t\t\tthis.callView.setCallState(CallState.connecting);\n\n\t\t\t\t\tthis.emit(Events.onDeviceCallStarted, {\n\t\t\t\t\t\tcallId: data.CALL_ID,\n\t\t\t\t\t\tconfig: data.CONFIG\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch(err =>\n\t\t\t\t{\n\t\t\t\t\tthis.callView.setProgress(CallProgress.error);\n\t\t\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_PHONE_ERROR'));\n\t\t\t\t\tthis.callView.setUiState(UiState.error);\n\t\t\t\t\tthis.callView.setCallState(CallState.idle);\n\t\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_CALL_INIT'));\n\t\t\tthis.callView.setUiState(UiState.connectingOutgoing);\n\t\t\tthis.callView.setCallState(CallState.connecting);\n\t\t\tthis.phoneApiInit().then(() => this.#phoneOnSDKReady());\n\t\t}\n\t}\n\n\tphoneIncomingAnswer()\n\t{\n\t\tthis.messengerFacade.stopRepeatSound('ringtone');\n\t\tthis.callSelfDisabled = true;\n\t\tBX.rest.callMethod('voximplant.call.answer', {'CALL_ID': this.callId});\n\n\t\tif (this.keypad)\n\t\t{\n\t\t\tthis.keypad.close();\n\t\t}\n\n\t\tthis.callView.setUiState(UiState.connectingIncoming);\n\t\tthis.callView.setCallState(CallState.connecting);\n\n\t\tthis.phoneApiInit().then(\n\t\t\t() => BX.rest.callMethod('voximplant.call.sendReady', {'CALL_ID': this.callId})\n\t\t);\n\t}\n\n\tphoneApiInit()\n\t{\n\t\tif (!this.phoneSupport())\n\t\t{\n\t\t\treturn Promise.reject('Telephony is not supported');\n\t\t}\n\n\t\tif (this.voximplantClient && this.voximplantClient.connected())\n\t\t{\n\t\t\tif (this.defaultMicrophone)\n\t\t\t{\n\t\t\t\tthis.voximplantClient.useAudioSource(this.defaultMicrophone);\n\t\t\t}\n\t\t\tif (this.defaultSpeaker)\n\t\t\t{\n\t\t\t\tVoxImplant.Hardware.AudioDeviceManager.get().setDefaultAudioSettings({\n\t\t\t\t\toutputId: this.defaultSpeaker\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tlet phoneApiParameters = {\n\t\t\tuseRTCOnly: true,\n\t\t\tmicRequired: true,\n\t\t\tvideoSupport: false,\n\t\t\tprogressTone: false\n\t\t};\n\n\t\tif (this.enableMicAutoParameters === false)\n\t\t{\n\t\t\tphoneApiParameters.audioConstraints = {\n\t\t\t\toptional: [\n\t\t\t\t\t{echoCancellation: false},\n\t\t\t\t\t{googEchoCancellation: false},\n\t\t\t\t\t{googEchoCancellation2: false},\n\t\t\t\t\t{googDAEchoCancellation: false},\n\t\t\t\t\t{googAutoGainControl: false},\n\t\t\t\t\t{googAutoGainControl2: false},\n\t\t\t\t\t{mozAutoGainControl: false},\n\t\t\t\t\t{googNoiseSuppression: false},\n\t\t\t\t\t{googNoiseSuppression2: false},\n\t\t\t\t\t{googHighpassFilter: false},\n\t\t\t\t\t{googTypingNoiseDetection: false},\n\t\t\t\t\t{googAudioMirroring: false}\n\t\t\t\t]\n\t\t\t};\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tBX.Voximplant.getClient({\n\t\t\t\t// debug: this.debug,\n\t\t\t\tapiParameters: phoneApiParameters\n\t\t\t}).then((client) =>\n\t\t\t{\n\t\t\t\tthis.voximplantClient = client;\n\n\t\t\t\tif (this.defaultMicrophone)\n\t\t\t\t{\n\t\t\t\t\tthis.voximplantClient.useAudioSource(this.defaultMicrophone);\n\t\t\t\t}\n\t\t\t\tif (this.defaultSpeaker)\n\t\t\t\t{\n\t\t\t\t\tVoxImplant.Hardware.AudioDeviceManager.get().setDefaultAudioSettings({\n\t\t\t\t\t\toutputId: this.defaultSpeaker\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (this.messengerFacade.isDesktop() && Type.isFunction(this.voximplantClient.setLoggerCallback))\n\t\t\t\t{\n\t\t\t\t\tthis.voximplantClient.enableSilentLogging();\n\t\t\t\t\tthis.voximplantClient.setLoggerCallback(e => this.phoneLog(e.label + \": \" + e.message))\n\t\t\t\t}\n\n\t\t\t\tthis.voximplantClient.addEventListener(VoxImplant.Events.ConnectionFailed, this.#onConnectionFailed.bind(this));\n\t\t\t\tthis.voximplantClient.addEventListener(VoxImplant.Events.ConnectionClosed, this.#onConnectionClosed.bind(this));\n\t\t\t\tthis.voximplantClient.addEventListener(VoxImplant.Events.IncomingCall, this.#onIncomingCall.bind(this));\n\t\t\t\tthis.voximplantClient.addEventListener(VoxImplant.Events.MicAccessResult, this.#onMicResult.bind(this));\n\t\t\t\tthis.voximplantClient.addEventListener(VoxImplant.Events.SourcesInfoUpdated, this.phoneOnInfoUpdated.bind(this));\n\t\t\t\tthis.voximplantClient.addEventListener(VoxImplant.Events.NetStatsReceived, this.#onNetStatsReceived.bind(this));\n\t\t\t\tresolve();\n\t\t\t}).catch((e) =>\n\t\t\t{\n\t\t\t\tBX.rest.callMethod('voximplant.call.onConnectionError', {\n\t\t\t\t\t'CALL_ID': this.callId,\n\t\t\t\t\t'ERROR': e\n\t\t\t\t})\n\n\t\t\t\tthis.phoneCallFinish();\n\t\t\t\tthis.messengerFacade.playSound('error');\n\t\t\t\tthis.callOverlayProgress('offline');\n\t\t\t\tthis.callAbort(Loc.getMessage('IM_PHONE_ERROR'));\n\t\t\t\tthis.callView.setUiState(UiState.error);\n\t\t\t\tthis.callView.setCallState(CallState.idle);\n\n\t\t\t\treject('Could not connect to Voximplant cloud');\n\t\t\t});\n\t\t})\n\t}\n\n\t#phoneOnSDKReady(params)\n\t{\n\t\tthis.phoneLog('SDK ready');\n\n\t\tparams = params || {};\n\t\tparams.delay = params.delay || false;\n\n\t\tif (!params.delay && this.hasSipPhone)\n\t\t{\n\t\t\tif (!this.phoneIncoming && !this.phoneDeviceCall())\n\t\t\t{\n\t\t\t\tthis.callOverlayProgress('wait');\n\t\t\t\tthis.callDialogAllowTimeout = setTimeout(() => this.#phoneOnSDKReady({delay: true}), 5000);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tthis.phoneLog('Connection exists');\n\n\t\tthis.callView.setProgress(CallProgress.connect);\n\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_CONNECT'));\n\t\tthis.phoneOnAuthResult({result: true});\n\t\tthis.callView.setCallState(CallState.connecting);\n\t\tif (this.phoneIncoming)\n\t\t{\n\t\t\tthis.callView.setUiState(UiState.connectingIncoming);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callView.setUiState(UiState.connectingOutgoing);\n\t\t}\n\t}\n\n\tphoneOnInfoUpdated(e)\n\t{\n\t\tthis.phoneLog('Info updated', this.voximplantClient.audioSources(), this.voximplantClient.videoSources());\n\t}\n\n\t#onCallConnected(e)\n\t{\n\t\tthis.messengerFacade.stopRepeatSound('ringtone', 5000);\n\n\t\tBX.localStorage.set(lsKeys.callInited, true, 7);\n\t\tclearInterval(this.phoneConnectedInterval);\n\t\tthis.phoneConnectedInterval = setInterval(\n\t\t\t() => BX.localStorage.set(lsKeys.callInited, true, 7),\n\t\t\t5000\n\t\t);\n\n\t\t// this.desktop.closeTopmostWindow();\n\n\t\tthis.phoneLog('Call connected', e);\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tBX.localStorage.set(lsKeys.callView, this.callView.callId, 86400);\n\t\t\tthis.callView.setUiState(UiState.connected);\n\t\t\tthis.callView.setCallState(CallState.connected);\n\t\t\tthis.callView.setProgress(CallProgress.online);\n\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_ONLINE'));\n\t\t}\n\n\t\tthis.callActive = true;\n\n\t\tthis.emit(Events.onCallConnected, {\n\t\t\tcall: this.currentCall,\n\t\t    isIncoming: this.phoneIncoming,\n\t\t\tisDeviceCall: this.phoneDeviceCall(),\n\t\t})\n\t}\n\n\t#bindPhoneViewCallbacks(callView)\n\t{\n\t\tif (!callView instanceof PhoneCallView)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tcallView.setCallback('mute', this.#onCallViewMute.bind(this));\n\t\tcallView.setCallback('unmute', this.#onCallViewUnmute.bind(this));\n\t\tcallView.setCallback('hold', this.#onCallViewHold.bind(this));\n\t\tcallView.setCallback('unhold', this.#onCallViewUnhold.bind(this));\n\t\tcallView.setCallback('answer', this.#onCallViewAnswer.bind(this));\n\t\tcallView.setCallback('skip', this.#onCallViewSkip.bind(this));\n\t\tcallView.setCallback('hangup', this.#onCallViewHangup.bind(this));\n\t\tcallView.setCallback('transfer', this.#onCallViewTransfer.bind(this));\n\t\tcallView.setCallback('cancelTransfer', this.#onCallViewCancelTransfer.bind(this));\n\t\tcallView.setCallback('completeTransfer', this.#onCallViewCompleteTransfer.bind(this));\n\t\tcallView.setCallback('callListMakeCall', this.#onCallViewCallListMakeCall.bind(this));\n\t\tcallView.setCallback('close', this.#onCallViewClose.bind(this));\n\t\tcallView.setCallback('switchDevice', this.#onCallViewSwitchDevice.bind(this));\n\t\tcallView.setCallback('qualityGraded', this.#onCallViewQualityGraded.bind(this));\n\t\tcallView.setCallback('dialpadButtonClicked', this.#onCallViewDialpadButtonClicked.bind(this));\n\t\tcallView.setCallback('saveComment', this.#onCallViewSaveComment.bind(this));\n\t}\n\n\t#onCallViewMute()\n\t{\n\t\tthis.muteCall();\n\t}\n\n\t#onCallViewUnmute()\n\t{\n\t\tthis.unmuteCall();\n\t}\n\n\t#onCallViewHold()\n\t{\n\t\tthis.holdCall();\n\t}\n\n\t#onCallViewUnhold()\n\t{\n\t\tthis.unholdCall();\n\t}\n\n\t#onCallViewAnswer()\n\t{\n\t\tif (this.skipIncomingCallTimer)\n\t\t{\n\t\t\tclearTimeout(this.skipIncomingCallTimer);\n\t\t}\n\t\tthis.phoneIncomingAnswer();\n\t}\n\n\t#onCallViewSkip()\n\t{\n\t\tBX.rest.callMethod('voximplant.call.skip', {'CALL_ID': this.callId});\n\n\t\tthis.phoneCallFinish();\n\t\tthis.callAbort();\n\t\tthis.callView.close();\n\t}\n\n\t#onCallViewHangup()\n\t{\n\t\tif (this.hasExternalCall && this.callId)\n\t\t{\n\t\t\tBX.rest.callMethod('voximplant.call.hangupDevice', {'CALL_ID': this.callId});\n\t\t}\n\n\t\tthis.phoneCallFinish();\n\t\tthis.messengerFacade.playSound('stop');\n\n\t\tif (!this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_FINISHED'));\n\t\tthis.callView.setCallState(CallState.idle);\n\t\tif (this.isCallListMode())\n\t\t{\n\t\t\tthis.callView.setUiState(UiState.outgoing);\n\t\t\tif (this.callView.isFolded())\n\t\t\t{\n\t\t\t\tthis.callView.unfold();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callView.close();\n\t\t}\n\t}\n\n\t#onCallViewTransfer(e)\n\t{\n\t\tif (e.type == 'user' || e.type == 'pstn' || e.type == 'queue')\n\t\t{\n\t\t\tthis.phoneTransferTargetType = e.type;\n\t\t\tthis.phoneTransferTargetId = e.target;\n\t\t\tthis.sendInviteTransfer();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconsole.error('Unknown transfer type', e);\n\t\t}\n\t}\n\n\t#onCallViewCancelTransfer(e)\n\t{\n\t\tthis.cancelInviteTransfer(e);\n\t}\n\n\t#onCallViewCompleteTransfer(e)\n\t{\n\t\tthis.completeTransfer(e)\n\t}\n\n\t#onCallViewCallListMakeCall(e)\n\t{\n\t\tthis.callListMakeCall(e)\n\t}\n\n\t#onCallViewClose()\n\t{\n\t\tthis.messengerFacade.stopRepeatSound('ringtone');\n\t\tthis.messengerFacade.stopRepeatSound('dialtone');\n\n\t\tthis.callListId = 0;\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.dispose();\n\t\t\tthis.closeCallViewBalloon();\n\t\t\tthis.callView = null;\n\t\t}\n\n\t\tif (this.deviceType == DeviceType.Phone)\n\t\t{\n\t\t\tthis.callId = '';\n\t\t\tthis.callActive = false;\n\t\t\tthis.hasExternalCall = false;\n\t\t\tthis.callSelfDisabled = false;\n\t\t\tclearInterval(this.phoneConnectedInterval);\n\n\t\t\tBX.localStorage.set(lsKeys.externalCall, false);\n\t\t}\n\t}\n\n\t#onCallViewSwitchDevice(e)\n\t{\n\t\tvar phoneNumber = e.phoneNumber;\n\t\tvar lastCallListCallParams = this.lastCallListCallParams;\n\t\tif (this.hasExternalCall && this.callId)\n\t\t{\n\t\t\tBX.rest.callMethod('voximplant.call.hangupDevice', {'CALL_ID': this.callId});\n\t\t}\n\t\tthis.phoneCallFinish();\n\t\tthis.callAbort();\n\t\tthis.phoneDeviceCall(!this.phoneDeviceCall());\n\t\tthis.callView.setDeviceCall(this.phoneDeviceCall());\n\t\tif (this.isCallListMode())\n\t\t{\n\t\t\tthis.callListMakeCall(lastCallListCallParams);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callView.close();\n\t\t\tthis.phoneCall(phoneNumber);\n\t\t}\n\t}\n\n\t#onCallViewQualityGraded(grade)\n\t{\n\t\tvar message = {\n\t\t\tCOMMAND: 'gradeQuality',\n\t\t\tgrade: grade\n\t\t};\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.currentCall.sendMessage(JSON.stringify(message));\n\t\t}\n\t}\n\n\t#onCallViewDialpadButtonClicked(key)\n\t{\n\t\tthis.sendDTMF(key);\n\t}\n\n\t#onCallViewSaveComment(e)\n\t{\n\t\tBX.rest.callMethod(\"voximplant.call.saveComment\", {\n\t\t\t'CALL_ID': e.callId,\n\t\t\t'COMMENT': e.comment\n\t\t})\n\t}\n\n\tdisplayIncomingCall(params)\n\t{\n\t\t/*chatId, callId, callerId, lineNumber, companyPhoneNumber, isCallback*/\n\t\tparams.isCallback = !!params.isCallback;\n\t\tthis.phoneLog('incoming call', params);\n\n\t\tif (!this.phoneSupport())\n\t\t{\n\t\t\tthis.showUnsupported();\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.phoneNumberUser = Text.encode(params.callerId);\n\t\tparams.callerId = params.callerId.replace(/[^a-zA-Z0-9\\.]/g, '');\n\n\t\tif (this.callActive)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.initiator = true;\n\t\tthis.callInitUserId = 0;\n\t\tthis.callActive = false;\n\t\tthis.callUserId = 0;\n\t\tthis.phoneIncoming = true;\n\t\tthis.callId = params.callId;\n\t\tthis.phoneNumber = params.callerId;\n\t\tthis.phoneParams = {};\n\n\t\tconst direction = params.isCallback ? Direction.callback : Direction.incoming;\n\n\t\tthis.callView = new PhoneCallView({\n\t\t\tuserId: this.userId,\n\t\t\tphoneNumber: this.phoneNumber,\n\t\t\tlineNumber: params.lineNumber,\n\t\t\tcompanyPhoneNumber: params.companyPhoneNumber,\n\t\t\tcallTitle: this.phoneNumberUser,\n\t\t\tdirection: direction,\n\t\t\ttransfer: this.isCallTransfer,\n\t\t\tstatusText: (params.isCallback ? Loc.getMessage('IM_PHONE_INVITE_CALLBACK') : Loc.getMessage('IM_PHONE_INVITE')),\n\t\t\tcrm: params.showCrmCard,\n\t\t\tcrmEntityType: params.crmEntityType,\n\t\t\tcrmEntityId: params.crmEntityId,\n\t\t\tcrmActivityId: params.crmActivityId,\n\t\t\tcrmActivityEditUrl: params.crmActivityEditUrl,\n\t\t\tcallId: this.callId,\n\t\t\tcrmData: this.phoneCrm,\n\t\t\tfoldedCallView: this.foldedCallView,\n\t\t\tbackgroundWorker: this.backgroundWorker,\n\t\t\tmessengerFacade: this.messengerFacade,\n\t\t\trestApps: this.restApps,\n\t\t});\n\t\tthis.#bindPhoneViewCallbacks(this.callView);\n\t\tthis.callView.setUiState(UiState.incoming);\n\t\tthis.callView.setCallState(CallState.connecting);\n\t\tif (params.config)\n\t\t{\n\t\t\tthis.callView.setConfig(params.config);\n\t\t}\n\n\t\tthis.callView.show();\n\n\t\tif (params.portalCall)\n\t\t{\n\t\t\tthis.callView.setPortalCall(true);\n\t\t\tthis.callView.setPortalCallData(params.portalCallData);\n\t\t\tthis.callView.setPortalCallUserId(params.portalCallUserId);\n\t\t}\n\n\t\tthis.skipIncomingCallTimer = setTimeout(() => this.callView?._onSkipButtonClick(), 35000);\n\t}\n\n\tsendInviteTransfer()\n\t{\n\t\tif (!this.currentCall && this.deviceType == DeviceType.Webrtc)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.phoneTransferTargetType || !this.phoneTransferTargetId)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tconst transferParams = {\n\t\t\t'CALL_ID': this.callId,\n\t\t\t'TARGET_TYPE': this.phoneTransferTargetType,\n\t\t\t'TARGET_ID': this.phoneTransferTargetId\n\t\t};\n\n\t\tBX.rest.callMethod('voximplant.call.startTransfer', transferParams).then((response) =>\n\t\t{\n\t\t\tconst data = response.data();\n\n\t\t\tif (data.SUCCESS == 'Y')\n\t\t\t{\n\t\t\t\tthis.phoneTransferEnabled = true;\n\t\t\t\tBX.localStorage.set(lsKeys.vite, true, 1);\n\n\t\t\t\tthis.phoneTransferCallId = data.DATA.CALL.CALL_ID;\n\t\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_TRANSFER'));\n\t\t\t\tthis.callView.setUiState(UiState.transferring);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconsole.error(\"Could not start call transfer. Error: \", data.ERRORS);\n\t\t\t}\n\t\t});\n\t}\n\n\tcancelInviteTransfer()\n\t{\n\t\tif (!this.currentCall && this.deviceType == DeviceType.Webrtc)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_ONLINE'));\n\t\tthis.callView.setUiState(UiState.connected);\n\n\t\tif (this.phoneTransferCallId !== '')\n\t\t{\n\t\t\tBX.rest.callMethod('voximplant.call.cancelTransfer', {'CALL_ID': this.phoneTransferCallId});\n\t\t}\n\n\t\tthis.phoneTransferTargetId = 0;\n\t\tthis.phoneTransferTargetType = '';\n\t\tthis.phoneTransferCallId = '';\n\t\tthis.phoneTransferEnabled = false;\n\t\tBX.localStorage.set(lsKeys.vite, false, 1);\n\t}\n\n\terrorInviteTransfer(code, reason)\n\t{\n\t\tif (code == '403' || code == '410' || code == '486')\n\t\t{\n\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_TRANSFER_' + code));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callView.setStatusText(Loc.getMessage('IM_M_CALL_ST_TRANSFER_1'));\n\t\t}\n\t\tthis.messengerFacade.playSound('error', true);\n\t\tthis.callView.setUiState(UiState.transferFailed);\n\n\t\tthis.phoneTransferTargetId = 0;\n\t\tthis.phoneTransferTargetType = '';\n\t\tthis.phoneTransferCallId = '';\n\t\tthis.phoneTransferEnabled = false;\n\t\tBX.localStorage.set(lsKeys.vite, false, 1);\n\t}\n\n\tcompleteTransfer()\n\t{\n\t\tBX.rest.callMethod('voximplant.call.completeTransfer', {'CALL_ID': this.phoneTransferCallId});\n\t}\n\n\tshowExternalCall(params)\n\t{\n\t\tvar direction;\n\t\tif (this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tsetTimeout(() => BX.localStorage.set(lsKeys.externalCall, true, 5), 100);\n\t\tclearInterval(this.phoneConnectedInterval);\n\t\tthis.phoneConnectedInterval = setInterval(() =>\n\t\t{\n\t\t\tif (this.hasExternalCall)\n\t\t\t{\n\t\t\t\tBX.localStorage.set(lsKeys.externalCall, true, 5);\n\t\t\t}\n\t\t}, 5000);\n\n\t\tthis.callId = params.callId;\n\t\tthis.callActive = true;\n\t\tthis.hasExternalCall = true;\n\n\t\tif (params.isCallback)\n\t\t{\n\t\t\tdirection = Direction.callback;\n\t\t}\n\t\telse if (params.fromUserId > 0)\n\t\t{\n\t\t\tdirection = Direction.outgoing;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdirection = Direction.incoming;\n\t\t}\n\n\t\tthis.callView = new PhoneCallView({\n\t\t\tcallId: params.callId,\n\t\t\tdirection: direction,\n\t\t\tphoneNumber: params.phoneNumber,\n\t\t\tlineNumber: params.lineNumber,\n\t\t\tcompanyPhoneNumber: params.companyPhoneNumber,\n\t\t\tfromUserId: params.fromUserId,\n\t\t\ttoUserId: params.toUserId,\n\t\t\tcrm: params.showCrmCard,\n\t\t\tcrmEntityType: params.crmEntityType,\n\t\t\tcrmEntityId: params.crmEntityId,\n\t\t\tcrmBindings: params.crmBindings,\n\t\t\tcrmActivityId: params.crmActivityId,\n\t\t\tcrmActivityEditUrl: params.crmActivityEditUrl,\n\t\t\tcrmData: this.phoneCrm,\n\t\t\tisExternalCall: true,\n\t\t\tfoldedCallView: this.foldedCallView,\n\t\t\tbackgroundWorker: this.backgroundWorker,\n\t\t\tmessengerFacade: this.messengerFacade,\n\t\t\trestApps: this.restApps,\n\t\t});\n\t\tthis.bindPhoneViewCallbacksExternalCall(this.callView);\n\t\tthis.callView.setUiState(UiState.externalCard);\n\t\tthis.callView.setCallState(CallState.connected);\n\t\tthis.callView.setConfig(params.config);\n\t\tthis.callView.show();\n\n\t\tif (params.portalCall)\n\t\t{\n\t\t\tthis.callView.setPortalCall(true);\n\t\t\tthis.callView.setPortalCallData(params.portalCallData);\n\t\t\tthis.callView.setPortalCallUserId(params.portalCallUserId);\n\t\t}\n\t}\n\n\tbindPhoneViewCallbacksExternalCall(callView)\n\t{\n\t\tcallView.setCallback('close', () =>\n\t\t{\n\t\t\tif (this.callView)\n\t\t\t{\n\t\t\t\tthis.callView.dispose();\n\t\t\t\tthis.closeCallViewBalloon();\n\t\t\t\tthis.callView = null;\n\t\t\t}\n\n\t\t\tthis.callId = '';\n\t\t\tthis.callActive = false;\n\t\t\tthis.hasExternalCall = false;\n\t\t\tthis.callSelfDisabled = false;\n\t\t\tclearInterval(this.phoneConnectedInterval);\n\t\t\tBX.localStorage.set(lsKeys.externalCall, false);\n\t\t});\n\t\tcallView.setCallback('saveComment', this.#onCallViewSaveComment.bind(this));\n\t}\n\n\thideExternalCall(clearFlag)\n\t{\n\t\tif (this.callView && !this.callView.isCallListMode())\n\t\t{\n\t\t\tthis.callView.autoClose();\n\t\t}\n\t}\n\n\tphoneLog()\n\t{\n\t\tif (this.messengerFacade.isDesktop())\n\t\t{\n\t\t\tlet text = '';\n\t\t\tfor (let i = 0; i < arguments.length; i++)\n\t\t\t{\n\t\t\t\tif (BX.type.isPlainObject(arguments[i]))\n\t\t\t\t{\n\t\t\t\t\ttry\n\t\t\t\t\t{\n\t\t\t\t\t\ttext = text + ' | ' + JSON.stringify(arguments[i]);\n\t\t\t\t\t} catch (e)\n\t\t\t\t\t{\n\t\t\t\t\t\ttext = text + ' | (circular structure)';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ttext = text + ' | ' + arguments[i];\n\t\t\t\t}\n\t\t\t}\n\t\t\tDesktopApi.writeToLogFile('phone.' + this.userEmail + '.log', text.substring(3));\n\t\t}\n\t\tif (this.debug)\n\t\t{\n\t\t\tif (console)\n\t\t\t{\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tconsole.log('Phone Log', JSON.stringify(arguments));\n\t\t\t\t} catch (e)\n\t\t\t\t{\n\t\t\t\t\tconsole.log('Phone Log', arguments[0]);\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Returns promise which will be resolved if\n\t *  - either Bitrix Desktop is found and this code is running inside it\n\t *  - or no Bitrix Desktop found\n\t * @returns {Promise}\n\t */\n\tcheckDesktop()\n\t{\n\t\tif (Reflection.getClass('BX.Messenger.v2.Lib.DesktopManager'))\n\t\t{\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tconst desktop = BX.Messenger.v2.Lib.DesktopManager.getInstance();\n\t\t\t\tdesktop.checkStatusInDifferentContext()\n\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\tif (result === false)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tif (Reflection.getClass('BX.desktopUtils'))\n\t\t{\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tBX.desktopUtils.runningCheck(\n\t\t\t\t\t() => {},\n\t\t\t\t\t() => resolve()\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\n\t\treturn Promise.resolve();\n\t}\n\n\trestoreFoldedCallView()\n\t{\n\t\tconst callProperties = BX.localStorage.get(lsKeys.foldedView);\n\n\t\tif (!Type.isPlainObject(callProperties))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callActive = true;\n\t\tthis.callId = callProperties.phoneCallId;\n\t\tthis.phoneCrm = callProperties.phoneCrm;\n\t\tthis.deviceType = callProperties.phoneCallDevice;\n\t\tthis.hasExternalCall = callProperties.hasExternalCall;\n\n\t\tlet callViewProperties = callProperties.callView;\n\t\tcallViewProperties.foldedCallView = this.foldedCallView;\n\t\tcallViewProperties.backgroundWorker = this.backgroundWorker;\n\t\tcallViewProperties.messengerFacade = this.messengerFacade;\n\t\tthis.callView = new PhoneCallView(callProperties.callView);\n\t\tif (this.hasExternalCall)\n\t\t{\n\t\t\tthis.callView.setUiState(UiState.externalCard);\n\t\t\tthis.callView.setCallState(CallState.connected);\n\t\t\tthis.bindPhoneViewCallbacksExternalCall(this.callView);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#bindPhoneViewCallbacks(this.callView);\n\t\t}\n\n\t\tif (this.hasExternalCall)\n\t\t{\n\t\t\tBX.localStorage.set(lsKeys.externalCall, true, 5);\n\t\t\tthis.phoneConnectedInterval = setInterval(\n\t\t\t\t() =>\n\t\t\t\t{\n\t\t\t\t\tif (this.hasExternalCall)\n\t\t\t\t\t{\n\t\t\t\t\t\tBX.localStorage.set(lsKeys.externalCall, true, 5);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t5000\n\t\t\t);\n\t\t}\n\n\t\tBX.rest.callMethod('voximplant.call.get', {'CALL_ID': this.callId}).catch(() =>\n\t\t{\n\t\t\t// call is not found\n\n\t\t\tthis.callId = '';\n\t\t\tthis.callActive = false;\n\t\t\tthis.hasExternalCall = false;\n\t\t\tthis.callSelfDisabled = false;\n\t\t\tclearInterval(this.phoneConnectedInterval);\n\t\t\tBX.localStorage.set(lsKeys.externalCall, false);\n\t\t\tif (this.callView)\n\t\t\t{\n\t\t\t\tthis.callView.dispose();\n\t\t\t\tthis.closeCallViewBalloon();\n\t\t\t\tthis.callView = null;\n\t\t\t}\n\t\t});\n\t}\n\n\tdisplayCallQuality(percent)\n\t{\n\t\tif (!this.currentCall || this.currentCall.state() != \"CONNECTED\")\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet grade = 5;\n\t\tif (100 == percent)\n\t\t{\n\t\t\tgrade = 5;\n\t\t}\n\t\telse if (percent >= 99)\n\t\t{\n\t\t\tgrade = 4;\n\t\t}\n\t\telse if (percent >= 97)\n\t\t{\n\t\t\tgrade = 3;\n\t\t}\n\t\telse if (percent >= 95)\n\t\t{\n\t\t\tgrade = 2;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tgrade = 1;\n\t\t}\n\n\t\tthis.callView.setQuality(grade);\n\t\treturn grade;\n\t}\n\n\tcallOverlayProgress(progress)\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setProgress(progress);\n\t\t\tif (progress === 'offline')\n\t\t\t{\n\t\t\t\tthis.messengerFacade.playSound('error');\n\t\t\t}\n\t\t}\n\t}\n\n\tcallOverlayStatus(status)\n\t{\n\t\tif (!Type.isStringFilled(status))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setStatusText(status);\n\t\t}\n\t}\n\n\tsetCallOverlayTitle(title)\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setTitle(title);\n\t\t}\n\t}\n\n\tcallOverlayTimer(state) // TODO not ready yet\n\t{\n\t\tstate = typeof (state) == 'undefined' ? 'start' : state;\n\n\t\tif (state == 'start')\n\t\t{\n\t\t\tthis.phoneCallTimeInterval = setInterval(() => this.phoneCallTime++, 1000);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tclearInterval(this.phoneCallTimeInterval);\n\t\t}\n\t}\n\n\tcallAbort(reason)\n\t{\n\t\tthis.callOverlayDeleteEvents();\n\n\t\tif (reason && this.callView)\n\t\t{\n\t\t\tif (this.callView)\n\t\t\t{\n\t\t\t\tthis.callView.setStatusText(reason);\n\t\t\t}\n\t\t}\n\t}\n\n\tcallOverlayDeleteEvents()\n\t{\n\t\t// this.desktop.closeTopmostWindow();\n\n\t\tthis.phoneCallFinish();\n\n\t\tthis.messengerFacade.stopRepeatSound('ringtone');\n\t\tthis.messengerFacade.stopRepeatSound('dialtone');\n\n\t\tclearTimeout(this.callDialogAllowTimeout);\n\t\tif (this.callDialogAllow)\n\t\t{\n\t\t\tthis.callDialogAllow.close();\n\t\t}\n\n\t}\n\n\tstorageSet(params)\n\t{\n\t\tif (params.key == lsKeys.vite)\n\t\t{\n\t\t\tif (params.value === true || !this.callSelfDisabled)\n\t\t\t{\n\t\t\t\tthis.phoneTransferEnabled = params.value;\n\t\t\t}\n\t\t}\n\t\telse if (params.key == lsKeys.externalCall)\n\t\t{\n\t\t\tif (params.value === false)\n\t\t\t{\n\t\t\t\tthis.hideExternalCall();\n\t\t\t}\n\t\t}\n\t}\n\n\tgetDebugInfo()\n\t{\n\t\treturn {\n\t\t\tvInitedCall: BX.localStorage.get('vInitedCall') ? 'Y' : 'N',\n\t\t\tisDesktop: this.messengerFacade.isDesktop() ? 'Y' : 'N',\n\t\t\tappVersion: navigator.appVersion,\n\t\t\thasActiveCall: this.messengerFacade.hasActiveCall() ? 'Y' : 'N',\n\t\t\tisCallListMode: this.isCallListMode() ? this.callListId : 'N',\n\t\t\tcurrentCall: this.currentCall ? this.currentCall.id() : 'N',\n\t\t\tcallView: this.callView ? this.callView.callId : 'N',\n\t\t\tcallViewPopup: this.callView?.popup ? 'Y' : 'N',\n\t\t};\n\t}\n\n\tshowNotification(notificationText, actions, params = {})\n\t{\n\t\tif (!actions)\n\t\t{\n\t\t\tactions = [];\n\t\t}\n\n\t\tconst options = {\n\t\t\tcontent: Text.encode(notificationText),\n\t\t\tposition: \"top-right\",\n\t\t\tcloseButton: true,\n\t\t\tactions: actions\n\t\t};\n\n\t\tif (params.autoHideDelay)\n\t\t{\n\t\t\toptions.autoHideDelay = params.autoHideDelay;\n\t\t}\n\t\telse\n\t\t{\n\t\t\toptions.autoHide = false;\n\t\t}\n\n\t\treturn BX.UI.Notification.Center.notify(options);\n\t}\n\n\tshowCallViewBalloon()\n\t{\n\t\tif (!this.openedCallViewBalloon && this.callView)\n\t\t{\n\t\t\tthis.openedCallViewBalloon = this.showNotification(Loc.getMessage('VOXIMPLANT_WARN_CLOSE_CALL_VIEW'));\n\t\t}\n\t}\n\n\tcloseCallViewBalloon()\n\t{\n\t\tif (this.openedCallViewBalloon)\n\t\t{\n\t\t\tthis.openedCallViewBalloon.close();\n\t\t\tthis.openedCallViewBalloon = null;\n\t\t}\n\t}\n\n\ttestSimple()\n\t{\n\t\tconst callId = 'test-call'\n\t\tthis.callView = new PhoneCallView({\n\t\t\tcallId,\n\t\t\trestApps: this.restApps,\n\t\t\tfoldedCallView: this.foldedCallView,\n\t\t\tbackgroundWorker: this.backgroundWorker,\n\t\t\tmessengerFacade: this.messengerFacade,\n\t\t\tdarkMode: this.messengerFacade.isThemeDark(),\n\t\t\tevents: {\n\t\t\t\tclose: () =>\n\t\t\t\t{\n\t\t\t\t\tconsole.trace('close')\n\t\t\t\t\tthis.callView?.dispose();\n\t\t\t\t\tthis.callView = null;\n\t\t\t\t},\n\t\t\t\thangup: () => this.callView.close(),\n\t\t\t\ttransfer: (e) => console.log('transfer', e),\n\t\t\t\tdialpadButtonClicked: (e) => console.log('dialpadButtonClicked', e),\n\t\t\t\thold: () => console.log('hold'),\n\t\t\t\tunhold: () => console.log('unhold'),\n\t\t\t\tmute: () => console.log('mute'),\n\t\t\t\tunmute: () => console.log('unmute'),\n\t\t\t}\n\t\t})\n\t\tthis.callView.show();\n\t}\n\n\ttestCrm()\n\t{\n\n\t}\n\n\ttestUser()\n\t{\n\t\tthis.callView = new PhoneCallView({\n\t\t\tmessengerFacade: this.messengerFacade,\n\t\t})\n\t}\n\n\tstatic Events = Events;\n}","import { PhoneCallsController } from './controller';\nimport { PhoneCallView } from './view/view';\nimport { FoldedCallView } from './view/folded-view';\nimport {BackgroundWorker} from './view/background-worker';\n\nimport './css/view.css';\n\nimport 'applayout';\nimport 'crm_form_loader';\nimport 'phone_number';\n\nexport {\n\tPhoneCallsController,\n\tPhoneCallView,\n\tBackgroundWorker,\n}\n\n// legacy compat\nBX.FoldedCallView = FoldedCallView;"],"names":["baseZIndex","nop","digits","Keypad","params","Type","isPlainObject","bindElement","offsetTop","offsetLeft","anglePosition","angleOffset","history","selectedLineId","defaultLineId","lines","availableLines","callInterceptAllowed","zIndex","hideDial","plusEntered","callbacks","onButtonClick","isFunction","onDial","onIntercept","onClose","elements","inputContainer","input","lineSelector","lineName","interceptButton","historyButton","plusKeyTimeout","popup","createPopup","popupOptions","id","targetContainer","document","body","darkMode","closeByEsc","autoHide","content","render","noAllPaddings","overlay","backgroundColor","opacity","events","onPopupClose","bind","angle","position","offset","Popup","destroy","length","lineId","innerText","getLineName","hasOwnProperty","SHORT_NAME","Dom","create","props","className","children","click","_onDeleteButtonClick","attrs","type","value","placeholder","Loc","getMessage","keydown","_onInputKeydown","keyup","_onAfterNumberChanged","map","digit","renderNumber","_onKeyMouseDown","_onKeyMouseUp","canSelectLine","text","_onLineSelectClick","_onDialButtonClick","_onShowHistoryButtonClick","_onInterceptButtonClick","e","keyCode","phoneNumber","key","metaKey","ctrlKey","shiftKey","insertAtCursor","preventDefault","altKey","classList","toggle","focus","substr","setTimeout","startsWith","clearTimeout","menuItems","isArray","forEach","index","push","Text","encode","onclick","historySelectMenu","close","Menu","bindOptions","onPopupDestroy","show","lineSelectMenu","setSelectedLineId","maxHeight","number","onMouseDown","onMouseUp","classSuffix","dataset","mousedown","currentTarget","mouseup","inputElement","selectionStart","startPos","endPos","selectionEnd","substring","callCardEvents","addCommentButtonClick","muteButtonClick","holdButtonClick","transferButtonClick","cancelTransferButtonClick","completeTransferButtonClick","hangupButtonClick","nextButtonClick","skipButtonClick","answerButtonClick","entityChanged","qualityMeterClick","dialpadButtonClick","makeCallButtonClick","notifyAdminButtonClick","closeButtonClick","UndefinedCallCard","result","errorCode","BaseWorker","Error","placement","name","callCard","CallCard","isExternalCall","PhoneCallView","used","prototype","callback","Object","keys","UiState","filter","state","isCardActive","getUndefinedCallCardError","uiState","setUiState","disableAutoStartTimer","stopTimer","hideTimer","showTimer","isTimerStarted","isMuted","muted","setMuted","BX","addClass","buttons","mute","isDesktop","slave","desktop","onCustomEvent","desktopEvents","onMute","removeClass","onUnMute","unmute","isHeld","held","setHeld","hold","onHold","onUnHold","unhold","startTimer","setTitle","title","setStatusText","statusText","timer","visible","sections","style","display","isFolded","unfoldedElements","initialTimestamp","desktopMethodEvents","setMute","setHold","getListUiState","setCardTitle","corporatePortalPageEvents","DesktopWorker","eventHandlers","rest","AppLayout","initializePlacement","initializeInterfaceMethods","initializeInterfaceEvents","addEventHandlersForEventsFromCallCard","addTransmitEventHandlers","CallCardGetListUiStates","getListUiStates","CallCardSetMute","transmitSetMute","CallCardSetHold","transmitSetHold","CallCardSetUiState","transmitSetUiState","CallCardSetCardTitle","transmitSetCardTitle","CallCardSetStatusText","transmitSetStatusText","CallCardClose","transmitClose","CallCardStartTimer","transmitStartTimer","CallCardStopTimer","transmitStopTimer","isCallCardPage","BXDesktopSystem","BroadcastEvent","window","desktopEventName","toUpperCase","slice","event","getEvents","removeCustomEvents","addCustomEvent","onTransmitHandler","getCallCardPlatformWorker","handler","isCorporatePortalPage","DoNothing","eventName","eventHandler","realHandler","arEventParams","i","detail","apply","addEventListener","removeEventListener","BXDesktopWindow","GetWindowId","GetMainWindow","BXWindows","find","element","callWindow","getCallCardWindow","PCW","backgroundWorker","platformWorker","BrowserWorker","initializeInterface","backgroundWorkerEvents","BackgroundWorker","emitEvent","removeDesktopEventHandlers","isUsed","setIsExternalCall","FormManager","node","currentForm","onFormLoad","onFormUnLoad","onFormSend","formData","getFormData","Bitrix24FormLoader","load","unload","sec","secCode","lang","ref","location","href","handlers","_onFormLoad","_onFormUnLoad","options","form","CallList","entityType","statuses","Map","currentStatusId","callListStatusId","currentItemIndex","itemIndex","callingStatusId","callingItemIndex","selectionLocked","onError","onSelectedItem","showLimit","showDelta","next","currentStatus","get","ITEMS","update","selectItem","debug","isDomNode","setCallingElement","bitrix_sessid","ajax","url","getAjaxUrl","method","dataType","data","onsuccess","ERROR","STATUSES","statusRecord","set","STATUS_ID","item","itemStatus","ENTITY_TYPE","getNonEmptyStatusId","console","log","statusId","newIndex","currentNode","_node","itemActionMenu","newEntity","ASSOCIATED_ENTITY","TYPE","ID","bindings","ELEMENT_ID","phones","PHONES","clean","append","renderStatusBlocks","status","renderStatusBlock","_shownCount","Math","min","renderCallListItem","_showMoreNode","replace","onShowMoreClick","itemDescriptor","statusName","NAME","phonesText","phone","VALUE","showItemMenu","target","EDIT_URL","open","POST","COMPANY_TITLE","renderAssociatedEntity","associatedEntity","newStatusNode","parentNode","replaceChild","callListItem","menuItem","actionMenuItemClickHandler","delimiter","setElementRank","RANK","elementId","setElementStatus","rank","executeItemAction","action","parameters","callListId","successCallback","repopulateItems","webformResultId","requestParams","items","foundStatusId","count","toString","animationTimeout","itemsNode","measuringNode","_folded","CLASS","getStatusTitle","height","clientHeight","renderCallListItems","transitionend","removeProperty","avatars","Events","onUnfold","FoldedCallView","setEventNamespace","subscribeFromOptions","currentItem","callListParams","webformId","webformSecCode","itemStatusId","statusList","avatar","callButton","nextButton","unfoldButton","_lsKey","_lsTtl","init","savedData","localStorage","remove","animation","currentItemStatusId","fromEntries","store","makeCall","restoredParams","callListItemIndex","emit","dblclick","_onViewDblClick","appendChild","bottom","renderUserInfo","_onNextButtonClick","_onUnfoldButtonClick","backgroundImage","loadAvatar","entityId","unfold","moveToNext","EventEmitter","desktopFeatureMap","Desktop","parentPhoneCallView","closable","js","minSettingsWidth","minSettingsHeight","resizable","DesktopApi","createWindow","SetProperty","Width","width","Height","minWidth","minHeight","html","ExecuteCommand","windowTarget","full","clientVersion","GetProperty","join","featureName","getVersion","jsContent","initImJs","bodyClass","htmlWrapperHead","head","outerHTML","isStringFilled","initJs","callId","_uiState","companyPhoneNumber","direction","fromUserId","toUserId","crm","hasSipPhone","deviceCall","transfer","crmEntityType","crmEntityId","crmActivityId","crmActivityEditUrl","config","JSON","stringify","portalCall","portalCallData","portalCallUserId","restApps","documentElement","Direction","incoming","outgoing","transferIncoming","connectingIncoming","connectingOutgoing","connected","transferring","transferFailed","transferConnected","idle","error","moneyError","sipPhoneError","redial","externalCard","CallState","connecting","CallProgress","connect","offline","online","wait","ButtonLayouts","centered","spaced","layouts","simple","initialSize","lsKeys","callView","callInited","externalCall","setStatus","setDeviceCall","setCrmEntity","setPortalCall","setPortalCallUserId","setPortalCallQueueName","setPortalCallData","setConfig","setCallState","reloadCrmCard","setCallId","setLineNumber","setPhoneNumber","setCompanyPhoneNumber","setTransfer","closeWindow","onMakeCall","onCallListMakeCall","onAnswer","onSkip","onHangup","onStartTransfer","onCompleteTransfer","onCancelTransfer","onBeforeUnload","onSwitchDevice","onQualityGraded","onDialpadButtonClicked","onCommentShown","onSaveComment","onSetAutoClose","blankAvatar","warn","entityTypeName","context","isCanceled","isBoolean","externalRequests","entityInfo","loadCrmCard","lineNumber","callState","prop","getString","getInteger","crmData","getObject","crmBindings","getArray","portalCallQueueName","recording","allowAutoClose","folded","autoFold","progress","quality","qualityPopup","qualityGrade","comment","commentShown","timerInterval","getInitialElements","getInitialSections","uiStateButtons","getUiStateButtons","buttonLayout","layout","callListMakeCall","answer","skip","hangup","completeTransfer","cancelTransfer","switchDevice","qualityGraded","dialpadButtonClicked","saveComment","notifyAdmin","_onBeforeUnloadHandler","_onBeforeUnload","_onDblClickHandler","_onDblClick","_onHoldButtonClickHandler","_onHoldButtonClick","_onMuteButtonClickHandler","_onMuteButtonClick","_onTransferButtonClickHandler","_onTransferButtonClick","_onTransferCompleteButtonClickHandler","_onTransferCompleteButtonClick","_onTransferCancelButtonClickHandler","_onTransferCancelButtonClick","_onDialpadButtonClickHandler","_onDialpadButtonClick","_onHangupButtonClickHandler","_onHangupButtonClick","_onCloseButtonClickHandler","_onCloseButtonClick","_onMakeCallButtonClickHandler","_onMakeCallButtonClick","_onNextButtonClickHandler","_onRedialButtonClickHandler","_onRedialButtonClick","_onFoldButtonClickHandler","_onFoldButtonClick","_onAnswerButtonClickHandler","_onAnswerButtonClick","_onSkipButtonClickHandler","_onSkipButtonClick","_onSwitchDeviceButtonClickHandler","_onSwitchDeviceButtonClick","_onQualityMeterClickHandler","_onQualityMeterClick","_onPullEventCrmHandler","_onPullEventCrm","hiddenTabs","currentTabName","moreTabsMenu","callListView","currentEntity","callingEntity","numberSelectMenu","webformLoaded","restAppLayoutLoaded","restAppLayoutLoading","restAppInterface","skipOnResize","currentLayout","setCallCard","setExternalCall","_isDesktop","messengerFacade","foldedCallView","emitInitializeEvent","getPlacementOptions","createTitle","then","main","crmButtons","commentEditorContainer","commentEditor","qualityMeter","crmCard","crmButtonsContainer","buttonsContainer","topLevelButtonsContainer","topButtonsContainer","sidebarContainer","tabsContainer","tabsBodyContainer","tabs","callList","webform","app","tabsBody","moreTabs","isChatWindow","openCallWindow","getInitialWidth","getInitialHeight","bindMasterDesktopEvents","createLayout","updateView","bindSlaveDesktopEvents","reinit","onCallListSelectedItem","_unloadHandler","removeCustomEvent","_externalEventHandler","disableDocumentScroll","getId","closeIcon","draggable","restrict","createLayoutFolded","createLayoutCrm","createLayoutSimple","hasSideBar","renderTitle","bxchange","_onCommentChanged","createSidebarLayout","checkMoreButton","top","left","right","isFeatureSupported","storedWidth","parseInt","getItem","floor","screen","storedHeight","setItem","sectionName","sectionsIndex","tabId","tabBodyId","_onTabHeaderClick","isWebformSupported","formManager","_onFormSend","isRestAppsSupported","restApp","restAppId","_onTabMoreClick","setActiveTab","portalCallUserImage","isPortalCall","hrphoto","hidden","tab","loadForm","loadRestApp","currentTab","isCurrentTabHidden","tabElement","callTitle","Promise","resolve","PhoneNumberParser","getInstance","parse","parsedNumber","isValid","format","isInternational","charAt","isCallback","users","isTransfer","adjust","Number","toLowerCase","_getRandomString","len","charSet","randomString","randomPoz","random","setOnSlave","innerHTML","getQualityMeterWidth","renderProgress","renderCrmButtons","renderButtons","stateButtons","setClosable","showOnlySections","hideCallIcon","showCallIcon","showSections","additionalParams","isAutoFoldAllowed","fold","sipPhone","activityId","activityEditUrl","runAction","response","newMainElement","resizeWindow","bindCrmCardEvents","errors","Crm","Page","anchors","querySelectorAll","onCrmAnchorClick","isSliderEnabled","userId","renderAvatar","queueName","message","renderTimer","renderButtonsFolded","renderButtonsDefault","buttonsFragment","createDocumentFragment","topButtonsFragment","topLevelButtonsFragment","subContainers","buttonName","buttonNode","renderSimpleButton","canBeFolded","CRM_CREATE","addCommentLabel","_onAddCommentButtonClick","_onAddDealButtonClick","_onAddInvoiceButtonClick","_onAddLeadButtonClick","_onAddContactButtonClick","hideSections","currentElement","getCurrentElement","setWebformResult","resultId","getPlacement","Runtime","initializeAppInterface","appInterface","getStatus","cb","disableAutoClose","enableAutoClose","undefined","isActiveIntoCurrentCall","isUnloadAllowed","returnValue","selectTransferTarget","keypad","dialpad","call","showNumberSelectMenu","phoneNumbers","onSelect","closeNumberSelectMenu","moveToNextItem","addComment","_getCrmEditUrl","externalContext","_generateExternalContext","Uri","addParam","contact_id","company_id","external_context","call_list_id","call_list_element","redirect","contact","company","origin_id","showQualityPopup","closeQualityPopup","command","IS_CANCELED","eventParams","PARAMS","entity","resetCallingElement","Date","getTime","setInterval","currentTimestamp","elapsedMilliSeconds","elapsedSeconds","minutes","seconds","template","isRecording","clearInterval","cacheable","createStar","mouseover","mouseout","util","getRandomString","foldCallView","foldCall","popupNode","getPopupContainer","overlayNode","enableDocumentScroll","subscribe","unbindAll","debounce","saveInitialSize","innerWidth","innerHeight","getSlider","isSelfContained","denyAction","slider","grade","autoClose","eventId","unsubscribe","setClosingByEsc","adjustPosition","setResizable","setMinSize","center","resize","scrollWidth","clientWidth","setProperty","add","imBar","getElementById","unloadRestApps","unloadForm","unbindDesktopEvents","resultCallback","loadExtension","exports","getDialogConfigForBackgroundApp","getDefaultDialogConfig","Dialog","transferDialog","targetNode","multiple","hideOnSelect","enableSearch","entities","inviteEmployeeLink","selectFields","deselectAll","getEntityId","customData","getCustomData","showTransferToUserMenu","hide","isInteger","userCustomData","onMenuItemClick","icon","renderTransferMenuItem","lightShadow","surTitle","clickCallback","active","vite","dialHistory","foldedView","onCallCreated","onCallConnected","onCallDestroyed","onDeviceCallStarted","DeviceType","Webrtc","Phone","PhoneCallsController","_classPrivateMethodInitSpec","phoneEnabled","userEmail","isAdmin","isString","canInterceptCall","deviceActive","skippedCallsList","skipIncomingCallTimer","readDefaults","restoreFoldedCallView","Browser","isLocalStorageSupported","storageSet","_classPrivateMethodGet","onCallConnectedHandler","onCallDisconnectedHandler","onCallFailedHandler","onProgressToneStartHandler","onProgressToneStopHandler","getData","startCallList","garbage","hasActiveCall","canBeUnloaded","hasExternalCall","deviceType","phoneCrm","getState","Boolean","_currentCall","defaultMicrophone","defaultCamera","defaultSpeaker","enableMicAutoParameters","phoneParams","clone","phoneFullNumber","phoneConnectedInterval","phoneCallTimeInterval","callOverlayTimer","showCallViewBalloon","currentCall","phoneLog","scheduleApiDisconnect","phoneRinging","phoneIncoming","callActive","phoneNumberUser","callOverlayOptions","callSelfDisabled","isCallHold","isCallTransfer","phoneMicAccess","phoneTransferTargetType","phoneTransferTargetId","phoneTransferCallId","phoneTransferEnabled","callMethod","callInitUserId","voximplantClient","disconnect","toggleCallHold","sendMessage","sendTone","ready","muteMicrophone","unmuteMicrophone","setLocalConfig","deviceCallBlock","getLocalConfig","Voximplant","openLimitSlider","loadPhoneLines","closeKeyPad","phoneCall","UI","InfoHelper","FOUND","interceptErrorPopup","correctPhoneNumber","initiator","callUserId","showCrmCard","cachedLines","phoneLines","reject","err","matches","exec","messageBox","MessageBox","MessageBoxButtons","OK_CANCEL","okCaption","cancelCaption","onOk","isMac","oldHistory","phoneIndex","indexOf","splice","concat","isCallListMode","phoneDeviceCall","stopRepeatSound","phoneApiInit","phoneSupport","useAudioSource","VoxImplant","Hardware","AudioDeviceManager","setDefaultAudioSettings","outputId","phoneApiParameters","useRTCOnly","micRequired","videoSupport","progressTone","audioConstraints","optional","echoCancellation","googEchoCancellation","googEchoCancellation2","googDAEchoCancellation","googAutoGainControl","googAutoGainControl2","mozAutoGainControl","googNoiseSuppression","googNoiseSuppression2","googHighpassFilter","googTypingNoiseDetection","googAudioMirroring","getClient","apiParameters","client","setLoggerCallback","enableSilentLogging","label","ConnectionFailed","ConnectionClosed","IncomingCall","MicAccessResult","SourcesInfoUpdated","phoneOnInfoUpdated","NetStatsReceived","phoneCallFinish","playSound","callOverlayProgress","callAbort","audioSources","videoSources","showUnsupported","callerId","transferParams","SUCCESS","DATA","CALL","CALL_ID","ERRORS","code","reason","bindPhoneViewCallbacksExternalCall","setCallback","dispose","closeCallViewBalloon","clearFlag","arguments","writeToLogFile","Reflection","getClass","Messenger","v2","Lib","DesktopManager","checkStatusInDifferentContext","desktopUtils","runningCheck","callProperties","phoneCallId","phoneCallDevice","callViewProperties","percent","setQuality","setProgress","phoneCallTime","callOverlayDeleteEvents","callDialogAllowTimeout","callDialogAllow","hideExternalCall","vInitedCall","appVersion","navigator","callViewPopup","notificationText","actions","closeButton","autoHideDelay","Notification","Center","notify","openedCallViewBalloon","showNotification","isThemeDark","trace","CallEvents","Connected","Disconnected","Failed","ProgressToneStart","ProgressToneStop","DEBUG_INFO","getDebugInfo","includes","checkDesktop","CRM","phonePortalCall","userData","phoneCallConfig","repeatSound","displayIncomingCall","chatId","errorInviteTransfer","failedCode","failedReason","external","callDevice","setCrmData","phoneDisplayExternal","phoneNumberLast","newCallId","setCallOverlayTitle","showExternalCall","getCallParams","initParams","decode","HR_PHOTO","callOverlayUserId","DIALOG_ID","callOverlayChatId","headers","phoneServer","phoneLogin","phoneCheckBalance","callOverlayStatus","stats","packetLoss","displayCallQuality","isRestLine","onKeyPadDial","onKeyPadIntercept","onKeyPadClose","addToHistory","startCallViaRestApp","numberOriginal","internationalNumber","alert","callStartParams","EXTERNAL","CONFIG","lastCallListCallParams","delay","phoneOnAuthResult","isIncoming","isDeviceCall","muteCall","unmuteCall","holdCall","unholdCall","phoneIncomingAnswer","sendInviteTransfer","cancelInviteTransfer","COMMAND","sendDTMF"],"mappings":"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"}