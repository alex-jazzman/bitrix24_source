{"version":3,"file":"script.js","sources":["src/index.js"],"sourcesContent":["import { Dom, Loc, Reflection, Tag, Text, Type, ajax, Runtime } from 'main.core';\nimport { DateTimeFormat } from 'main.date';\nimport { Button, ButtonSize, ButtonColor } from 'ui.buttons';\nimport 'ui.tooltip';\n\nimport './css/style.css';\n\nconst namespace = Reflection.namespace('BX.Lists.Component');\n\nconst HTML_ELEMENT_ID = 'lists-element-creation-guide';\nconst BP_STATE_FORM_NAME = 'lists_element_creation_guide_bp';\nconst BP_STATE_CONSTANTS_FORM_NAME = 'lists_element_creation_guide_bp_constants';\nconst AJAX_COMPONENT = 'bitrix:lists.element.creation_guide';\n\nconst STEPS = Object.freeze({\n\tDESCRIPTION: 'description',\n\tCONSTANTS: 'constants',\n\tFIELDS: 'fields',\n});\n\ntype ComponentData = {\n\tdescription: string,\n\tduration: ?number,\n\tsignedParameters: string,\n\tbpTemplateIds: [],\n\thasFieldsToShow: boolean,\n\thasStatesToTuning: boolean,\n\tcanUserTuningStates: boolean,\n};\n\ntype Step = {\n\tstep: string,\n\tcontentNode: HTMLElement,\n\tprogressBarNode: HTMLElement,\n};\n\nclass ElementCreationGuide\n{\n\t#steps: Array<Step> = [];\n\n\t#description: string;\n\t#duration: ?number = null;\n\t#signedParameters: string;\n\t#templateIds: [] = [];\n\n\t#currentStep: string = STEPS.DESCRIPTION;\n\t#startTime: number;\n\t#descriptionNode: HTMLElement;\n\t#durationNode: HTMLElement;\n\t#difference: number;\n\t#canUserTuningStates: boolean;\n\t#isAdminLoaded: boolean = false;\n\t#isLoading: boolean = false;\n\n\tconstructor(props: ComponentData)\n\t{\n\t\tif (!Type.isStringFilled(props.signedParameters))\n\t\t{\n\t\t\tthrow new TypeError('signedParameters must be filled string');\n\t\t}\n\t\tthis.#signedParameters = props.signedParameters;\n\n\t\tthis.#description = Type.isString(props.description) ? props.description : '';\n\n\t\tif (Type.isInteger(props.duration) && props.duration >= 0)\n\t\t{\n\t\t\tthis.#duration = props.duration;\n\t\t}\n\n\t\tif (Type.isArrayFilled(props.bpTemplateIds))\n\t\t{\n\t\t\tthis.#templateIds = props.bpTemplateIds;\n\t\t}\n\n\t\tthis.#canUserTuningStates = Type.isBoolean(props.canUserTuningStates) ? props.canUserTuningStates : false;\n\n\t\tthis.#startTime = Math.round(Date.now() / 1000);\n\n\t\tthis.#fillSteps(props);\n\t\tthis.#toggleButtons();\n\t\tthis.#renderProgressBar();\n\t\tthis.#renderFirstStep();\n\t}\n\n\t#fillSteps(props)\n\t{\n\t\tconst contentNode = document.querySelectorAll('.list-el-cg__content >.list-el-cg__content-body');\n\n\t\tconst showBPConstantsStep = Type.isBoolean(props.hasStatesToTuning) ? props.hasStatesToTuning : false;\n\t\tconst showFieldsStep = Type.isBoolean(props.hasFieldsToShow) ? props.hasFieldsToShow : false;\n\n\t\tthis.#steps.push({\n\t\t\tstep: STEPS.DESCRIPTION,\n\t\t\tcontentNode: contentNode.item(0),\n\t\t\tprogressBarNode: null,\n\t\t});\n\n\t\tif (showBPConstantsStep)\n\t\t{\n\t\t\tthis.#steps.push({\n\t\t\t\tstep: STEPS.CONSTANTS,\n\t\t\t\tcontentNode: contentNode.item(1),\n\t\t\t\tprogressBarNode: null,\n\t\t\t});\n\t\t}\n\n\t\tif (showFieldsStep)\n\t\t{\n\t\t\tthis.#steps.push({\n\t\t\t\tstep: STEPS.FIELDS,\n\t\t\t\tcontentNode: contentNode.item(2),\n\t\t\t\tprogressBarNode: null,\n\t\t\t});\n\t\t}\n\t}\n\n\t#toggleButtons()\n\t{\n\t\tconst backButton = document.getElementById(`${HTML_ELEMENT_ID}-back-button`);\n\t\tconst nextButton = document.getElementById(`${HTML_ELEMENT_ID}-next-button`);\n\t\tconst createButton = document.getElementById(`${HTML_ELEMENT_ID}-create-button`);\n\n\t\tthis.#removeNotTunedConstantsHint(createButton);\n\t\tthis.#removeNotTunedConstantsHint(nextButton);\n\n\t\tif (this.#isFirstStep())\n\t\t{\n\t\t\tconst showNextStep = this.#steps.length > 1;\n\t\t\tthis.#hideButton(showNextStep ? createButton : nextButton);\n\t\t\tthis.#showButton(showNextStep ? nextButton : createButton);\n\t\t}\n\t\telse if (this.#isLastStep())\n\t\t{\n\t\t\tthis.#hideButton(nextButton);\n\t\t\tthis.#showButton(createButton);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#hideButton(createButton);\n\t\t\tthis.#showButton(nextButton);\n\t\t}\n\n\t\tif (this.#currentStep === STEPS.CONSTANTS && !this.#canUserTuningStates)\n\t\t{\n\t\t\tthis.#disableButton(createButton);\n\t\t\tthis.#disableButton(nextButton);\n\t\t\tthis.#addNotTunedConstantsHint(createButton);\n\t\t\tthis.#addNotTunedConstantsHint(nextButton);\n\t\t}\n\n\t\tsetTimeout(() => {\n\t\t\tthis.#removeWaitFromButton(backButton);\n\t\t\tthis.#removeWaitFromButton(nextButton);\n\t\t\tthis.#removeWaitFromButton(createButton);\n\t\t}, 100);\n\t}\n\n\t#isFirstStep(): boolean\n\t{\n\t\treturn this.#currentStep === STEPS.DESCRIPTION;\n\t}\n\n\t#isLastStep(): boolean\n\t{\n\t\treturn (\n\t\t\t(this.#currentStep === STEPS.DESCRIPTION && this.#steps.length === 1)\n\t\t\t|| (this.#currentStep === STEPS.CONSTANTS && this.#steps.length === 2)\n\t\t\t|| (this.#currentStep === STEPS.FIELDS)\n\t\t);\n\t}\n\n\t#hideButton(button)\n\t{\n\t\tif (Type.isDomNode(button))\n\t\t{\n\t\t\tDom.addClass(button, ['--hidden']);\n\t\t\tthis.#disableButton(button);\n\t\t}\n\t}\n\n\t#disableButton(button)\n\t{\n\t\tif (Type.isDomNode(button))\n\t\t{\n\t\t\tDom.addClass(button, ['ui-btn-disabled']);\n\t\t\tDom.attr(button, 'disabled', 'disabled');\n\t\t}\n\t}\n\n\t#removeWaitFromButton(button)\n\t{\n\t\tif (Type.isDomNode(button))\n\t\t{\n\t\t\tDom.removeClass(button, 'ui-btn-wait');\n\t\t}\n\t}\n\n\t#setWaitToButton(button)\n\t{\n\t\tif (Type.isDomNode(button))\n\t\t{\n\t\t\tDom.addClass(button, 'ui-btn-wait');\n\t\t}\n\t}\n\n\t#showButton(button)\n\t{\n\t\tif (Type.isDomNode(button))\n\t\t{\n\t\t\tDom.removeClass(button, ['--hidden']);\n\t\t\tthis.#enableButton(button);\n\t\t}\n\t}\n\n\t#enableButton(button)\n\t{\n\t\tif (Type.isDomNode(button))\n\t\t{\n\t\t\tDom.removeClass(button, ['ui-btn-disabled']);\n\t\t\tDom.attr(button, 'disabled', null);\n\t\t}\n\t}\n\n\t#renderProgressBar(): void\n\t{\n\t\tconst container = document.getElementById(`${HTML_ELEMENT_ID}-breadcrumbs`);\n\t\tif (!container)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst { step0, step1, step2 } = Tag.render`\n\t\t\t<div>\n\t\t\t\t<div class=\"list-el-cg__breadcrumbs-item --active\" ref=\"step0\">\n\t\t\t\t\t<span>${Text.encode(Loc.getMessage('LISTS_ELEMENT_CREATION_GUIDE_CMP_STEP_RECOMMENDATION'))}</span>\n\t\t\t\t\t<span class=\"ui-icon-set --chevron-right\"></span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"list-el-cg__breadcrumbs-item\" ref=\"step1\">\n\t\t\t\t\t<span>${Text.encode(Loc.getMessage('LISTS_ELEMENT_CREATION_GUIDE_CMP_STEP_CONSTANTS'))}</span>\n\t\t\t\t\t<span class=\"ui-icon-set --chevron-right\"></span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"list-el-cg__breadcrumbs-item\" ref=\"step2\">\n\t\t\t\t\t<span>${Text.encode(Loc.getMessage('LISTS_ELEMENT_CREATION_GUIDE_CMP_STEP_FIELDS'))}</span>\n\t\t\t\t\t<span class=\"ui-icon-set --chevron-right\"></span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#steps[0].progressBarNode = step0;\n\t\tDom.append(step0, container);\n\n\t\tconst constantsStep = this.#steps.find((step) => step.step === STEPS.CONSTANTS);\n\t\tif (constantsStep)\n\t\t{\n\t\t\tconstantsStep.progressBarNode = step1;\n\t\t\tDom.append(step1, container);\n\t\t}\n\n\t\tconst fieldsStep = this.#steps.find((step) => step.step === STEPS.FIELDS);\n\t\tif (fieldsStep)\n\t\t{\n\t\t\tfieldsStep.progressBarNode = step2;\n\t\t\tDom.append(step2, container);\n\t\t}\n\t}\n\n\t#renderFirstStep()\n\t{\n\t\tconst container = document.getElementById(`${HTML_ELEMENT_ID}-container`);\n\t\tconst contentNode = this.#steps[0].contentNode;\n\t\tif (container && contentNode)\n\t\t{\n\t\t\tconst description = this.#renderDescription();\n\t\t\tthis.#descriptionNode = description;\n\t\t\tDom.append(description, contentNode);\n\n\t\t\tconst expandNode = this.#renderExpandDescriptionNode();\n\t\t\tDom.append(expandNode, contentNode);\n\n\t\t\tthis.#durationNode = this.#renderDuration();\n\t\t\tDom.append(this.#durationNode, container);\n\n\t\t\tconst slider = document.querySelector('.ui-page-slider-workarea-content-padding');\n\t\t\tconst difference = slider ? (slider.offsetHeight - window.innerHeight) : 0;\n\t\t\tthis.#difference = difference;\n\t\t\tif (difference > 0)\n\t\t\t{\n\t\t\t\tthis.#toggleDescription({ target: expandNode });\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.remove(expandNode);\n\t\t\t}\n\t\t}\n\t}\n\n\t#renderDescription(): HTMLElement\n\t{\n\t\tif (Type.isStringFilled(this.#description))\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"list-el-cg__content-wrapper\">\n\t\t\t\t\t${BX.util.nl2br(this.#description)}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"list-el-cg__content-wrapper\">\n\t\t\t\t<span class=\"list-el-cg__text-empty\">${Loc.getMessage('LISTS_ELEMENT_CREATION_GUIDE_CMP_EMPTY_DESCRIPTION')}</span>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#renderExpandDescriptionNode(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"list-el-cg__content-open\" onclick=\"${this.#toggleDescription.bind(this)}\">\n\t\t\t\t${Loc.getMessage('LISTS_ELEMENT_CREATION_GUIDE_CMP_EXPAND_DESCRIPTION')}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#toggleDescription(event)\n\t{\n\t\tconst target = event.target;\n\t\tif (target && this.#difference > 0)\n\t\t{\n\t\t\tDom.clean(target);\n\t\t\tif (Dom.hasClass(this.#descriptionNode, '--hide'))\n\t\t\t{\n\t\t\t\ttarget.innerText = Loc.getMessage('LISTS_ELEMENT_CREATION_GUIDE_CMP_COLLAPSE_DESCRIPTION');\n\t\t\t\tDom.style(this.#descriptionNode, 'height', `${this.#descriptionNode.scrollHeight}px`);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\ttarget.innerText = Loc.getMessage('LISTS_ELEMENT_CREATION_GUIDE_CMP_EXPAND_DESCRIPTION');\n\t\t\t\tDom.style(\n\t\t\t\t\tthis.#descriptionNode,\n\t\t\t\t\t'height',\n\t\t\t\t\t`${this.#descriptionNode.offsetHeight - this.#difference}px`,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tDom.toggleClass(this.#descriptionNode, ['--hide']);\n\t\t}\n\t}\n\n\t#renderDuration(): HTMLElement\n\t{\n\t\tif (Type.isNil(this.#duration))\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"list-el-cg__informer\">\n\t\t\t\t\t<div class=\"list-el-cg__informer-header\">\n\t\t\t\t\t\t<div class=\"list-el-cg__informer-title\">\n\t\t\t\t\t\t\t${Text.encode(Loc.getMessage('LISTS_ELEMENT_CREATION_GUIDE_CMP_AVERAGE_DURATION_TITLE'))}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"list-el-cg__informer-time\">\n\t\t\t\t\t\t\t<span class=\"list-el-cg__text-empty\">${Text.encode(Loc.getMessage('LISTS_ELEMENT_CREATION_GUIDE_CMP_EMPTY_DURATION'))}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"list-el-cg__informer-message\">${Loc.getMessage('LISTS_ELEMENT_CREATION_GUIDE_CMP_AVERAGE_DURATION_UNDEFINED_DESCRIPTION')}</div>\n\t\t\t\t\t<div class=\"list-el-cg__informer-bottom\"></div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\tconst formattedDuration = DateTimeFormat.format(\n\t\t\t[['s', 'sdiff'], ['i', 'idiff'], ['H', 'Hdiff'], ['d', 'ddiff'], ['m', 'mdiff'], ['Y', 'Ydiff']],\n\t\t\t0,\n\t\t\tthis.#duration,\n\t\t);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"list-el-cg__informer\">\n\t\t\t\t<div class=\"list-el-cg__informer-header\">\n\t\t\t\t\t<div class=\"list-el-cg__informer-title\">\n\t\t\t\t\t\t${Text.encode(Loc.getMessage('LISTS_ELEMENT_CREATION_GUIDE_CMP_AVERAGE_DURATION_TITLE'))}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"list-el-cg__informer-time\">\n\t\t\t\t\t\t<span>${Text.encode(formattedDuration)}</span>\n\t\t\t\t\t\t<div class=\"ui-icon-set --time-picker\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"list-el-cg__informer-message\">${Loc.getMessage('LISTS_ELEMENT_CREATION_GUIDE_CMP_AVERAGE_DURATION_DESCRIPTION')}</div>\n\t\t\t\t<div class=\"list-el-cg__informer-bottom\">\n\t\t\t\t\t<a\n\t\t\t\t\t\tclass=\"list-el-cg__link\" href=\"#\"\n\t\t\t\t\t\tonclick=\"${this.#handleDurationHintClick}\"\n\t\t\t\t\t>${Loc.getMessage('LISTS_ELEMENT_CREATION_GUIDE_CMP_AVERAGE_DURATION_HINT')}\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#handleDurationHintClick(event)\n\t{\n\t\tevent.preventDefault();\n\n\t\tconst ARTICLE_ID = '18783714';\n\n\t\tconst helper = Reflection.getClass('top.BX.Helper');\n\n\t\tif (helper)\n\t\t{\n\t\t\thelper.show(`redirect=detail&code=${ARTICLE_ID}`);\n\t\t}\n\t}\n\n\tnext()\n\t{\n\t\tif (this.#isLoading || this.#isLastStep())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentStepIndex = this.#steps.findIndex((step) => step.step === this.#currentStep);\n\n\t\tconst currentStep = this.#steps[currentStepIndex];\n\t\tconst nextStep = this.#steps[currentStepIndex + 1];\n\n\t\tconst changeStep = () => {\n\t\t\tDom.toggleClass(currentStep.progressBarNode, ['--active', '--complete']);\n\t\t\tDom.addClass(nextStep.progressBarNode, '--active');\n\n\t\t\tthis.#cleanErrors();\n\n\t\t\tDom.addClass(currentStep.contentNode, '--hidden');\n\t\t\tDom.removeClass(nextStep.contentNode, '--hidden');\n\n\t\t\tif (this.#currentStep === STEPS.DESCRIPTION)\n\t\t\t{\n\t\t\t\tDom.addClass(this.#durationNode, '--hidden');\n\t\t\t}\n\n\t\t\tthis.#currentStep = nextStep.step;\n\t\t\tthis.#toggleButtons();\n\t\t};\n\n\t\tif (currentStep.step === STEPS.CONSTANTS && this.#canUserTuningStates)\n\t\t{\n\t\t\tthis.#startLoading();\n\t\t\tthis.#setAllConstants()\n\t\t\t\t.then(() => {\n\t\t\t\t\tchangeStep();\n\t\t\t\t})\n\t\t\t\t.catch(() => {\n\t\t\t\t\tthis.#toggleButtons();\n\t\t\t\t})\n\t\t\t\t.finally(this.#finishLoading.bind(this))\n\t\t\t;\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (nextStep.step === STEPS.CONSTANTS && !this.#canUserTuningStates && !this.#isAdminLoaded)\n\t\t{\n\t\t\tthis.#startLoading();\n\t\t\tthis.#loadAdminList()\n\t\t\t\t.then(() => {})\n\t\t\t\t.catch(() => {})\n\t\t\t\t.finally(() => {\n\t\t\t\t\tthis.#isAdminLoaded = true;\n\t\t\t\t\tthis.#finishLoading();\n\t\t\t\t\tchangeStep();\n\t\t\t\t})\n\t\t\t;\n\n\t\t\treturn;\n\t\t}\n\n\t\tchangeStep();\n\t}\n\n\t#loadAdminList(): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst constantStep = this.#steps.find((step) => step.step === STEPS.CONSTANTS);\n\t\t\tajax.runComponentAction(\n\t\t\t\tAJAX_COMPONENT,\n\t\t\t\t'getListAdmin',\n\t\t\t\t{ json: { signedParameters: this.#signedParameters } },\n\t\t\t)\n\t\t\t\t.then(({ data }) => {\n\t\t\t\t\tif (Type.isArrayFilled(data?.admins))\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.append(this.#renderAdminList(data.admins, data.canNotify), constantStep.contentNode);\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve();\n\t\t\t\t})\n\t\t\t\t.catch(reject)\n\t\t\t;\n\t\t});\n\t}\n\n\t#renderAdminList(admins: [], canNotify: boolean = false): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div>\n\t\t\t\t<p>\n\t\t\t\t\t${Text.encode(Loc.getMessage('LISTS_ELEMENT_CREATION_GUIDE_CMP_NOT_TUNING_CONSTANTS_NOTIFY_ADMIN'))}\n\t\t\t\t</p>\n\t\t\t\t<p>\n\t\t\t\t\t${Text.encode(Loc.getMessage('LISTS_ELEMENT_CREATION_GUIDE_CMP_NOT_TUNING_CONSTANTS_NOTIFY'))}\n\t\t\t\t</p>\n\t\t\t\t${admins.map((admin) => {\n\t\t\t\t\tlet button = null;\n\t\t\t\t\tif (canNotify)\n\t\t\t\t\t{\n\t\t\t\t\t\tbutton = new Button({\n\t\t\t\t\t\t\ttext: Loc.getMessage('LISTS_ELEMENT_CREATION_GUIDE_CMP_NOT_TUNING_CONSTANTS_NOTIFY_BUTTON'),\n\t\t\t\t\t\t\tsize: ButtonSize.MEDIUM,\n\t\t\t\t\t\t\tcolor: ButtonColor.PRIMARY,\n\t\t\t\t\t\t\tonclick: this.#notifyAdmin.bind(this, admin),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Tag.render`\n\t\t\t\t\t\t<div style=\"padding: 12px 0; border-top: 1px solid var(--ui-color-palette-gray-10); line-height: 45px;\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tbx-tooltip-user-id=\"${admin.id}\"\n\t\t\t\t\t\t\t\tstyle=\"\n\t\t\t\t\t\t\t\t\tmargin-right: 10px;\n\t\t\t\t\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t\t\t\t\t\tline-height: 34px;\n\t\t\t\t\t\t\t\t\tvertical-align: middle;\n\t\t\t\t\t\t\t\t\theight: 36px;\n\t\t\t\t\t\t\t\t\twidth: 36px;\n\t\t\t\t\t\t\t\t\tbackground-image: url('${admin.img ? encodeURI(Text.encode(admin.img)) : ''}');\n\t\t\t\t\t\t\t\t\tborder-radius: var(--ui-border-radius-circle);\n\t\t\t\t\t\t\t\t\tbackground-size: cover;\n\t\t\t\t\t\t\t\t\"\n\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t\t<span>${Text.encode(admin.name)}</span>\n\t\t\t\t\t\t\t<div style=\"float: right;\">\n\t\t\t\t\t\t\t\t${button?.render()}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`;\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#notifyAdmin(admin: {}, button: Button)\n\t{\n\t\tbutton.setWaiting(true);\n\n\t\tajax.runComponentAction(\n\t\t\tAJAX_COMPONENT,\n\t\t\t'notifyAdmin',\n\t\t\t{\n\t\t\t\tjson: {\n\t\t\t\t\tsignedParameters: this.#signedParameters,\n\t\t\t\t\tadminId: admin.id,\n\t\t\t\t},\n\t\t\t},\n\t\t)\n\t\t\t.then(({ data }) => {\n\t\t\t\tif (data.success === true)\n\t\t\t\t{\n\t\t\t\t\tDom.replace(\n\t\t\t\t\t\tbutton.getContainer(),\n\t\t\t\t\t\tTag.render`\n\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\t${Text.encode(Loc.getMessage('LISTS_ELEMENT_CREATION_GUIDE_CMP_NOT_TUNING_CONSTANTS_NOTIFY_SUCCESS'))}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t`,\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tbutton.setWaiting(false);\n\t\t\t})\n\t\t\t.catch(() => {\n\t\t\t\tbutton.setWaiting(false);\n\t\t\t})\n\t\t;\n\t}\n\n\t#setAllConstants(): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst formData = new FormData();\n\t\t\tthis.#appendBPFormData(formData, true);\n\n\t\t\tthis.#setConstants(formData)\n\t\t\t\t.then(resolve)\n\t\t\t\t.catch(({ errors }) => {\n\t\t\t\t\tif (Array.isArray(errors))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#showErrors(errors);\n\t\t\t\t\t}\n\n\t\t\t\t\treject();\n\t\t\t\t})\n\t\t\t;\n\t\t});\n\t}\n\n\t#setConstants(formData: FormData): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tformData.set('signedParameters', this.#signedParameters);\n\n\t\t\tajax.runComponentAction(AJAX_COMPONENT, 'setConstants', { data: formData })\n\t\t\t\t.then(resolve)\n\t\t\t\t.catch(reject)\n\t\t\t;\n\t\t});\n\t}\n\n\tback()\n\t{\n\t\tif (this.#isFirstStep())\n\t\t{\n\t\t\tif (Reflection.getClass('BX.SidePanel') && BX.SidePanel.Instance.getSliderByWindow(window))\n\t\t\t{\n\t\t\t\tBX.SidePanel.Instance.getSliderByWindow(window).close(false);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentStepIndex = this.#steps.findIndex((step) => step.step === this.#currentStep);\n\t\tconst currentStep = this.#steps[currentStepIndex];\n\t\tconst previousStep = this.#steps[currentStepIndex - 1];\n\n\t\tDom.removeClass(currentStep.progressBarNode, '--active');\n\t\tDom.toggleClass(previousStep.progressBarNode, ['--active', '--complete']);\n\n\t\tthis.#cleanErrors();\n\n\t\tDom.addClass(currentStep.contentNode, '--hidden');\n\t\tDom.removeClass(previousStep.contentNode, '--hidden');\n\n\t\tif (previousStep.step === STEPS.DESCRIPTION)\n\t\t{\n\t\t\tDom.removeClass(this.#durationNode, '--hidden');\n\t\t}\n\n\t\tthis.#currentStep = previousStep.step;\n\t\tthis.#toggleButtons();\n\t}\n\n\tasync create()\n\t{\n\t\tif (\n\t\t\tthis.#isLoading\n\t\t\t|| !this.#isLastStep()\n\t\t\t|| (this.#currentStep === STEPS.CONSTANTS && !this.#canUserTuningStates)\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#currentStep === STEPS.CONSTANTS)\n\t\t{\n\t\t\tthis.#startLoading();\n\n\t\t\tlet hasErrors = false;\n\t\t\tawait this.#setAllConstants()\n\t\t\t\t.catch(() => {\n\t\t\t\t\tthis.#toggleButtons();\n\t\t\t\t\thasErrors = true;\n\t\t\t\t})\n\t\t\t;\n\n\t\t\tthis.#finishLoading();\n\t\t\tif (hasErrors)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.#startLoading();\n\t\tthis.#createElement()\n\t\t\t.then(({ data }) => {\n\t\t\t\tif (Reflection.getClass('BX.SidePanel') && BX.SidePanel.Instance.getSliderByWindow(window))\n\t\t\t\t{\n\t\t\t\t\tBX.SidePanel.Instance.getSliderByWindow(window).close(false);\n\t\t\t\t\tthis.#showSuccessNotification(data.elementUrl);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch(() => {\n\t\t\t\tthis.#toggleButtons();\n\t\t\t})\n\t\t\t.finally(this.#finishLoading.bind(this))\n\t\t;\n\t}\n\n\t#showSuccessNotification(href)\n\t{\n\t\tconst topRuntime: Runtime = Reflection.getClass('top.BX.Runtime');\n\t\tif (topRuntime)\n\t\t{\n\t\t\ttopRuntime.loadExtension('ui.notification')\n\t\t\t\t.then(() => {\n\t\t\t\t\tif (Reflection.getClass('top.BX.UI.Notification.Center'))\n\t\t\t\t\t{\n\t\t\t\t\t\tconst actions = [];\n\t\t\t\t\t\tif (Type.isStringFilled(href))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tactions.push({\n\t\t\t\t\t\t\t\thref,\n\t\t\t\t\t\t\t\ttitle: Loc.getMessage('LISTS_ELEMENT_CREATION_GUIDE_CMP_SUCCESS_CREATE_SEE'),\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttop.BX.UI.Notification.Center.notify({\n\t\t\t\t\t\t\tcontent: Text.encode(Loc.getMessage('LISTS_ELEMENT_CREATION_GUIDE_CMP_SUCCESS_CREATE')),\n\t\t\t\t\t\t\tactions,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch(() => {})\n\t\t\t;\n\t\t}\n\t}\n\n\tsaveConstants(templateId: number, button: HTMLButtonElement)\n\t{\n\t\tif (!this.#templateIds.includes(templateId) || !Type.isDomNode(button) || this.#isLoading)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#setWaitToButton(button);\n\n\t\tconst formData = new FormData();\n\t\tthis.#appendStateFormData(formData, `form_${BP_STATE_CONSTANTS_FORM_NAME}_${templateId}`);\n\t\tformData.append('templateIds[]', templateId);\n\n\t\tconst errorsNode = document.getElementById(`${HTML_ELEMENT_ID}-constants-${templateId}-errors`);\n\n\t\tthis.#startLoading();\n\t\tthis.#setConstants(formData)\n\t\t\t.then(() => {\n\t\t\t\tif (errorsNode)\n\t\t\t\t{\n\t\t\t\t\tthis.#cleanErrors(errorsNode);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch(({ errors }) => {\n\t\t\t\tif (Type.isArrayFilled(errors) && errorsNode)\n\t\t\t\t{\n\t\t\t\t\tthis.#showErrors(errors, errorsNode);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.finally(() => {\n\t\t\t\tthis.#finishLoading();\n\t\t\t\tthis.#removeWaitFromButton(button);\n\t\t\t})\n\t\t;\n\t}\n\n\t#createElement(): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst form: HTMLFormElement = document.forms.form_lists_element_creation_guide_element;\n\t\t\tconst formData: FormData = form ? new FormData(form) : new FormData();\n\n\t\t\tthis.#appendSectionFormData(formData);\n\t\t\tthis.#appendBPFormData(formData);\n\n\t\t\tformData.set('signedParameters', this.#signedParameters);\n\t\t\tformData.set('time', Math.round(Date.now() / 1000) - this.#startTime);\n\n\t\t\tajax.runComponentAction(\n\t\t\t\tAJAX_COMPONENT,\n\t\t\t\t'create',\n\t\t\t\t{ data: formData },\n\t\t\t)\n\t\t\t\t.then(resolve)\n\t\t\t\t.catch(({ errors }) => {\n\t\t\t\t\tif (Array.isArray(errors))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#showErrors(errors);\n\t\t\t\t\t}\n\n\t\t\t\t\treject();\n\t\t\t\t})\n\t\t\t;\n\t\t});\n\t}\n\n\t#appendSectionFormData(formData: FormData)\n\t{\n\t\tconst form: HTMLFormElement = document.forms.form_lists_element_creation_guide_section;\n\t\tif (form)\n\t\t{\n\t\t\tformData.set('IBLOCK_SECTION_ID', new FormData(form).get('IBLOCK_SECTION_ID'));\n\t\t}\n\t}\n\n\t#appendBPFormData(formData: FormData, isConstantsForms: boolean = false)\n\t{\n\t\tthis.#templateIds.forEach((id) => {\n\t\t\tconst formId = `form_${isConstantsForms ? BP_STATE_CONSTANTS_FORM_NAME : BP_STATE_FORM_NAME}_${id}`;\n\t\t\tif (document.forms[formId])\n\t\t\t{\n\t\t\t\tthis.#appendStateFormData(formData, formId);\n\t\t\t\tformData.append('templateIds[]', id);\n\t\t\t}\n\t\t});\n\t}\n\n\t#appendStateFormData(formData: FormData, formId: number)\n\t{\n\t\tconst form = document.forms[formId];\n\t\tif (form)\n\t\t{\n\t\t\tfor (const [key, value] of (new FormData(form)).entries())\n\t\t\t{\n\t\t\t\tif (key !== 'sessid')\n\t\t\t\t{\n\t\t\t\t\tformData.append(key, value);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t#showErrors(errors: [], toNode: HTMLElement = null)\n\t{\n\t\tthis.#cleanErrors(toNode);\n\n\t\tconst errorsNode = Type.isDomNode(toNode) ? toNode : document.getElementById(`${HTML_ELEMENT_ID}-errors`);\n\t\tif (errorsNode)\n\t\t{\n\t\t\tlet message = '';\n\t\t\terrors.forEach((error) => {\n\t\t\t\tif (error.message)\n\t\t\t\t{\n\t\t\t\t\tmessage += Text.encode(error.message);\n\t\t\t\t\tmessage += '<br/>';\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tDom.append(\n\t\t\t\tTag.render`\n\t\t\t\t\t<div class=\"ui-alert ui-alert-danger\">\n\t\t\t\t\t\t<span class=\"ui-alert-message\">${message}</span>\n\t\t\t\t\t</div>\n\t\t\t\t`,\n\t\t\t\terrorsNode,\n\t\t\t);\n\t\t}\n\t}\n\n\t#cleanErrors(fromNode: HTMLElement = null)\n\t{\n\t\tif (Type.isDomNode(fromNode))\n\t\t{\n\t\t\tDom.clean(fromNode);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst errorsNode = document.getElementById(`${HTML_ELEMENT_ID}-errors`);\n\t\tif (errorsNode)\n\t\t{\n\t\t\tDom.clean(errorsNode);\n\t\t}\n\n\t\tthis.#templateIds.forEach((templateId) => {\n\t\t\tconst node = document.getElementById(`${HTML_ELEMENT_ID}-constants-${templateId}-errors`);\n\t\t\tif (node)\n\t\t\t{\n\t\t\t\tDom.clean(node);\n\t\t\t}\n\t\t});\n\t}\n\n\t#startLoading()\n\t{\n\t\tthis.#isLoading = true;\n\t\tthis.#disableAllButtons();\n\t}\n\n\t#disableAllButtons()\n\t{\n\t\tfor (const button of document.getElementsByClassName('ui-btn'))\n\t\t{\n\t\t\tthis.#disableButton(button);\n\t\t}\n\t}\n\n\t#finishLoading()\n\t{\n\t\tthis.#isLoading = false;\n\t\tthis.#enableAllButtons();\n\t}\n\n\t#enableAllButtons()\n\t{\n\t\tfor (const button of document.getElementsByClassName('ui-btn'))\n\t\t{\n\t\t\tthis.#enableButton(button);\n\t\t}\n\t}\n\n\t#addNotTunedConstantsHint(button: HTMLElement)\n\t{\n\t\tif (Type.isDomNode(button))\n\t\t{\n\t\t\tDom.attr(button, 'title', Loc.getMessage('LISTS_ELEMENT_CREATION_GUIDE_CMP_NOT_TUNING_CONSTANTS_HINT'));\n\t\t}\n\t}\n\n\t#removeNotTunedConstantsHint(button: HTMLElement)\n\t{\n\t\tif (Type.isDomNode(button))\n\t\t{\n\t\t\tDom.attr(button, 'title', null);\n\t\t}\n\t}\n}\n\nnamespace.ElementCreationGuide = ElementCreationGuide;\n"],"names":["namespace","Reflection","HTML_ELEMENT_ID","BP_STATE_FORM_NAME","BP_STATE_CONSTANTS_FORM_NAME","AJAX_COMPONENT","STEPS","Object","freeze","DESCRIPTION","CONSTANTS","FIELDS","ElementCreationGuide","constructor","props","Type","isStringFilled","signedParameters","TypeError","isString","description","isInteger","duration","isArrayFilled","bpTemplateIds","isBoolean","canUserTuningStates","Math","round","Date","now","next","currentStepIndex","findIndex","step","currentStep","nextStep","changeStep","Dom","toggleClass","progressBarNode","addClass","contentNode","removeClass","then","catch","finally","bind","back","getClass","BX","SidePanel","Instance","getSliderByWindow","window","close","previousStep","create","hasErrors","data","elementUrl","saveConstants","templateId","button","includes","isDomNode","formData","FormData","append","errorsNode","document","getElementById","errors","querySelectorAll","showBPConstantsStep","hasStatesToTuning","showFieldsStep","hasFieldsToShow","push","item","backButton","nextButton","createButton","showNextStep","length","setTimeout","attr","container","step0","step1","step2","Tag","render","Text","encode","Loc","getMessage","constantsStep","find","fieldsStep","expandNode","slider","querySelector","difference","offsetHeight","innerHeight","target","remove","util","nl2br","event","clean","hasClass","innerText","style","scrollHeight","isNil","formattedDuration","DateTimeFormat","format","preventDefault","ARTICLE_ID","helper","show","Promise","resolve","reject","constantStep","ajax","runComponentAction","json","admins","canNotify","map","admin","Button","text","size","ButtonSize","MEDIUM","color","ButtonColor","PRIMARY","onclick","id","img","encodeURI","name","setWaiting","adminId","success","replace","getContainer","Array","isArray","set","href","topRuntime","loadExtension","actions","title","top","UI","Notification","Center","notify","content","form","forms","form_lists_element_creation_guide_element","form_lists_element_creation_guide_section","get","isConstantsForms","forEach","formId","key","value","entries","toNode","message","error","fromNode","node","getElementsByClassName"],"mappings":"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"}