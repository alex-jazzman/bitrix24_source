{"version":3,"file":"product-selector.bundle.js","sources":["../src/product-search-selector-footer.js","../src/product-creation-limited-footer.js","../src/selector-error-code.js","../src/product-search-input.js","../src/product-image-input.js","../src/barcode-search-selector-footer.js","../src/barcode-search-input.js","../src/product-selector.js"],"sourcesContent":["import {DefaultFooter, Dialog} from 'ui.entity-selector';\r\nimport {Dom, Loc, Tag, Type} from 'main.core';\r\nimport {BaseEvent} from \"main.core.events\";\r\nimport {Loader} from \"main.loader\";\r\nimport {ProductSelector} from \"catalog.product-selector\";\r\n\r\nexport default class ProductSearchSelectorFooter extends DefaultFooter\r\n{\r\n\tloader: Loader = null;\r\n\r\n\tconstructor(dialog: Dialog, options: { [option: string]: any })\r\n\t{\r\n\t\tsuper(dialog, options);\r\n\r\n\t\tthis.errorAdminHint = options.errorAdminHint || '';\r\n\t\tthis.getDialog().subscribe('onSearch', this.handleOnSearch.bind(this));\r\n\t}\r\n\r\n\tgetContent(): HTMLElement\r\n\t{\r\n\t\tlet phrase = '';\r\n\r\n\t\tconst isViewCreateButton = this.options.allowCreateItem === true || this.options.allowEditItem === false;\r\n\r\n\t\tif (this.isViewEditButton() && isViewCreateButton)\r\n\t\t{\r\n\t\t\tphrase = Tag.render`\r\n\t\t\t\t<div>${Loc.getMessage('CATALOG_SELECTOR_SEARCH_POPUP_FOOTER_1')}</div>\r\n\t\t\t`;\r\n\r\n\t\t\tconst createButton = phrase.querySelector('create-button');\r\n\t\t\tDom.replace(createButton, this.getLabelContainer());\r\n\r\n\t\t\tconst changeButton = phrase.querySelector('change-button');\r\n\t\t\tDom.replace(changeButton, this.getSaveContainer());\r\n\t\t}\r\n\t\telse if (this.isViewEditButton())\r\n\t\t{\r\n\t\t\tphrase = this.getSaveContainer();\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tphrase = this.getLabelContainer();\r\n\t\t}\r\n\r\n\t\treturn Tag.render`\r\n\t\t\t<div class=\"ui-selector-search-footer-box\">\r\n\t\t\t\t${phrase}\r\n\t\t\t\t${this.getHintContainer()}\r\n\t\t\t\t${this.getLoaderContainer()}\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\tisViewEditButton(): boolean\r\n\t{\r\n\t\treturn this.options.allowEditItem === true;\r\n\t}\r\n\r\n\tgetLoader(): Loader\r\n\t{\r\n\t\tif (Type.isNil(this.loader))\r\n\t\t{\r\n\t\t\tthis.loader = new Loader({\r\n\t\t\t\ttarget: this.getLoaderContainer(),\r\n\t\t\t\tsize: 17,\r\n\t\t\t\tcolor: 'rgba(82, 92, 105, 0.9)'\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn this.loader;\r\n\t}\r\n\r\n\tshowLoader(): void\r\n\t{\r\n\t\tvoid this.getLoader().show();\r\n\t}\r\n\r\n\thideLoader(): void\r\n\t{\r\n\t\tvoid this.getLoader().hide();\r\n\t}\r\n\r\n\tsetLabel(label: string)\r\n\t{\r\n\t\tif (Type.isString(label))\r\n\t\t{\r\n\t\t\tthis.getLabelContainer().textContent = label;\r\n\t\t}\r\n\t}\r\n\r\n\tgetLabelContainer(): HTMLElement\r\n\t{\r\n\t\treturn this.cache.remember('label', () => {\r\n\t\t\treturn Tag.render`\r\n\t\t\t\t<span>\r\n\t\t\t\t\t<span onclick=\"${this.handleClick.bind(this)}\" class=\"ui-selector-footer-link  ui-selector-footer-link-add\">\r\n\t\t\t\t\t\t${\r\n\t\t\t\t\t\t\tthis.getOption('creationLabel', Loc.getMessage('CATALOG_SELECTOR_SEARCH_POPUP_FOOTER_CREATE'))\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</span>\r\n\t\t\t\t\t${this.getQueryContainer()}\r\n\t\t\t\t</span>\r\n\t\t\t`;\r\n\t\t});\r\n\t}\r\n\r\n\tgetQueryContainer(): HTMLElement\r\n\t{\r\n\t\treturn this.cache.remember('name-container', () => {\r\n\t\t\treturn Tag.render`\r\n\t\t\t\t<span class=\"ui-selector-search-footer-query\"></span>\r\n\t\t\t`;\r\n\t\t});\r\n\t}\r\n\r\n\tgetSaveContainer(): HTMLElement\r\n\t{\r\n\t\treturn this.cache.remember('save-container', () => {\r\n\t\t\tconst className = `ui-selector-footer-link`;\r\n\r\n\t\t\tconst messageId =\r\n\t\t\t\t(this.options.inputName === ProductSelector.INPUT_FIELD_BARCODE)\r\n\t\t\t\t\t? 'CATALOG_SELECTOR_SEARCH_POPUP_FOOTER_BARCODE_CHANGE'\r\n\t\t\t\t\t: 'CATALOG_SELECTOR_SEARCH_POPUP_FOOTER_CHANGE'\r\n\t\t\t;\r\n\r\n\t\t\treturn Tag.render`\r\n\t\t\t<span class=\"${className}\" onclick=\"${this.onClickSaveChanges.bind(this)}\">\r\n\t\t\t\t${Loc.getMessage(messageId)}\r\n\t\t\t</span>\r\n\t\t`;\r\n\t\t});\r\n\t}\r\n\r\n\tgetLoaderContainer(): HTMLElement\r\n\t{\r\n\t\treturn this.cache.remember('loader', () => {\r\n\t\t\treturn Tag.render`\r\n\t\t\t\t<div class=\"ui-selector-search-footer-loader\"></div>\r\n\t\t\t`;\r\n\t\t});\r\n\t}\r\n\r\n\tgetHintContainer(): ?HTMLElement\r\n\t{\r\n\t\treturn this.cache.remember('hint', () => {\r\n\t\t\tlet message = null;\r\n\t\t\tif (!this.options.allowEditItem && !this.options.allowCreateItem)\r\n\t\t\t{\r\n\t\t\t\tmessage = Loc.getMessage('CATALOG_SELECTOR_SEARCH_POPUP_DISABLED_FOOTER_ALL_HINT', {\r\n\t\t\t\t\t'#ADMIN_HINT#': this.errorAdminHint\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\telse if (!this.options.allowEditItem)\r\n\t\t\t{\r\n\t\t\t\tmessage = Loc.getMessage('CATALOG_SELECTOR_SEARCH_POPUP_DISABLED_FOOTER_EDIT_HINT', {\r\n\t\t\t\t\t'#ADMIN_HINT#': this.errorAdminHint\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\telse if (!this.options.allowCreateItem)\r\n\t\t\t{\r\n\t\t\t\tmessage = Loc.getMessage('CATALOG_SELECTOR_SEARCH_POPUP_DISABLED_FOOTER_ADD_HINT', {\r\n\t\t\t\t\t'#ADMIN_HINT#': this.errorAdminHint\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (!message)\r\n\t\t\t{\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tconst hintNode = Tag.render`<span class=\"ui-btn ui-btn-icon-lock ui-btn-link\"></span>`;\r\n\t\t\thintNode.dataset.hint = message;\r\n\t\t\thintNode.dataset.hintNoIcon = true;\r\n\r\n\t\t\tBX.UI.Hint.initNode(hintNode);\r\n\r\n\t\t\treturn Tag.render`<div class=\"product-search-selector-disabled-footer-hint\">${hintNode}</div>`;\r\n\t\t});\r\n\t}\r\n\r\n\tonClickSaveChanges()\r\n\t{\r\n\t\tif (!this.options.allowEditItem)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst lastQuery = this.getDialog().getActiveTab().getLastSearchQuery();\r\n\t\tthis.getDialog().emit('ChangeItem:onClick', { query: lastQuery.query });\r\n\t\tthis.getDialog().clearSearch();\r\n\t\tthis.getDialog().hide();\r\n\t}\r\n\r\n\tcreateItem(): void\r\n\t{\r\n\t\tif (!this.options.allowCreateItem)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst tagSelector = this.getDialog().getTagSelector();\r\n\t\tif (tagSelector && tagSelector.isLocked())\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst finalize = () => {\r\n\t\t\tthis.hideLoader();\r\n\t\t\tif (this.getDialog().getTagSelector())\r\n\t\t\t{\r\n\t\t\t\tthis.getDialog().getTagSelector().unlock();\r\n\t\t\t\tthis.getDialog().focusSearch();\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tevent.preventDefault();\r\n\t\tthis.showLoader();\r\n\r\n\t\tif (tagSelector)\r\n\t\t{\r\n\t\t\ttagSelector.lock();\r\n\t\t}\r\n\r\n\t\tthis.getDialog()\r\n\t\t\t.emitAsync('Search:onItemCreateAsync', {\r\n\t\t\t\tsearchQuery: this.getDialog().getActiveTab().getLastSearchQuery()\r\n\t\t\t})\r\n\t\t\t.then(() => {\r\n\t\t\t\tthis.getTab().clearResults();\r\n\t\t\t\tthis.getDialog().clearSearch();\r\n\t\t\t\tif (this.getDialog().getActiveTab() === this.getTab())\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.getDialog().selectFirstTab();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfinalize();\r\n\t\t\t})\r\n\t\t\t.catch(() => {\r\n\t\t\t\tfinalize();\r\n\t\t\t})\r\n\t\t;\r\n\t}\r\n\r\n\thandleClick(): void\r\n\t{\r\n\t\tthis.createItem();\r\n\t}\r\n\r\n\thandleOnSearch(event: BaseEvent): void\r\n\t{\r\n\t\tconst { query } = event.getData();\r\n\r\n\t\tif (this.options.currentValue === query || query === '')\r\n\t\t{\r\n\t\t\tthis.hide();\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.show();\r\n\t\t}\r\n\r\n\t\tthis.getQueryContainer().textContent = \" \" + query;\r\n\t}\r\n}\r\n","import {DefaultFooter} from 'ui.entity-selector';\r\nimport {Event, Loc, Tag} from 'main.core';\r\nimport 'ui.info-helper';\r\n\r\nexport default class ProductCreationLimitedFooter extends DefaultFooter\r\n{\r\n\tgetContent(): HTMLElement\r\n\t{\r\n\t\tconst phrase = Tag.render`\r\n\t\t\t<div>${Loc.getMessage('CATALOG_SELECTOR_LIMITED_PRODUCT_CREATION')}</div>\r\n\t\t`;\r\n\r\n\t\tconst infoButton = Tag.render`\r\n\t\t\t<a class=\"ui-btn ui-btn-sm ui-btn-primary ui-btn-hover ui-btn-round\">\r\n\t\t\t\t${Loc.getMessage('CATALOG_SELECTOR_LICENSE_EXPLODE')}\r\n\t\t\t</a>\r\n\t\t`;\r\n\r\n\t\tEvent.bind(infoButton, 'click', () => {\r\n\t\t\tBX.UI.InfoHelper.show('limit_shop_products');\r\n\t\t});\r\n\r\n\t\treturn Tag.render`\r\n\t\t\t<div class=\"ui-selector-search-footer-box\">\r\n\t\t\t\t<div class=\"ui-selector-search-footer-box\">\r\n\t\t\t\t\t<div class=\"tariff-lock\"></div>\r\n\t\t\t\t\t${phrase}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div>\r\n\t\t\t\t\t${infoButton}\r\n\t\t\t\t</div>\t\t\t\t\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n}","export class SelectorErrorCode\r\n{\r\n\tstatic NOT_SELECTED_PRODUCT: string = 'NOT_SELECTED_PRODUCT';\r\n\tstatic FAILED_PRODUCT: string = 'FAILED_PRODUCT';\r\n\r\n\tstatic getCodes(): Array<string>\r\n\t{\r\n\t\treturn [\r\n\t\t\tSelectorErrorCode.NOT_SELECTED_PRODUCT,\r\n\t\t\tSelectorErrorCode.FAILED_PRODUCT,\r\n\t\t]\r\n\t}\r\n}","import {ajax, Browser, Cache, Dom, Event, Extension, Loc, Runtime, Tag, Text, Type} from 'main.core';\r\nimport {Dialog, Item} from 'ui.entity-selector';\r\nimport './component.css';\r\nimport {EventEmitter} from 'main.core.events';\r\nimport {ProductModel} from 'catalog.product-model';\r\nimport {ProductSelector} from 'catalog.product-selector';\r\nimport ProductSearchSelectorFooter from './product-search-selector-footer';\r\nimport ProductCreationLimitedFooter from './product-creation-limited-footer';\r\nimport {SelectorErrorCode} from './selector-error-code';\r\nimport 'ui.notification';\r\n\r\nclass DialogMode\r\n{\r\n\tstatic SEARCHING: string = 'SEARCHING';\r\n\tstatic SHOW_PRODUCT_ITEM: string = 'SHOW_PRODUCT_ITEM';\r\n\tstatic SHOW_RECENT: string = 'SHOW_RECENT';\r\n}\r\n\r\nexport class ProductSearchInput\r\n{\r\n\tstatic SEARCH_TYPE_ID = 'hms-product';\r\n\r\n\tmodel: ProductModel;\r\n\tselector: ProductSelector;\r\n\tcache = new Cache.MemoryCache();\r\n\r\n\tconstructor(id, options = {})\r\n\t{\r\n\t\tthis.id = id || Text.getRandom();\r\n\t\tthis.selector = options.selector;\r\n\t\tif (!(this.selector instanceof ProductSelector))\r\n\t\t{\r\n\t\t\tthrow new Error('Product selector instance not found.');\r\n\t\t}\r\n\r\n\t\tthis.model = options.model || {};\r\n\t\tthis.isEnabledSearch = options.isSearchEnabled;\r\n\t\tthis.isEnabledDetailLink = options.isEnabledDetailLink;\r\n\t\tthis.inputName = options.inputName || ProductSelector.INPUT_FIELD_NAME;\r\n\t\tthis.immutableFieldNames = [ProductSelector.INPUT_FIELD_BARCODE, ProductSelector.INPUT_FIELD_NAME];\r\n\t\tif (!this.immutableFieldNames.includes(this.inputName))\r\n\t\t{\r\n\t\t\tthis.immutableFieldNames.push(this.inputName);\r\n\t\t}\r\n\t\tthis.ajaxInProcess = false;\r\n\t\tthis.loadedSelectedItem = null;\r\n\r\n\t\tthis.handleSearchInput = Runtime.debounce(this.searchInDialog, 500, this);\r\n\t}\r\n\r\n\tdestroy()\r\n\t{\r\n\r\n\t}\r\n\r\n\tgetId(): string\r\n\t{\r\n\t\treturn this.id;\r\n\t}\r\n\r\n\tgetSelectorType(): string\r\n\t{\r\n\t\treturn ProductSelector.INPUT_FIELD_NAME;\r\n\t}\r\n\r\n\tgetField(fieldName): string\r\n\t{\r\n\t\treturn this.model.getField(fieldName);\r\n\t}\r\n\r\n\tgetValue(): string\r\n\t{\r\n\t\treturn this.getField(this.inputName);\r\n\t}\r\n\r\n\tgetFilledValue(): string\r\n\t{\r\n\t\treturn this.getNameInput().value || '';\r\n\t}\r\n\r\n\tisSearchEnabled(): boolean\r\n\t{\r\n\t\treturn this.isEnabledSearch;\r\n\t}\r\n\r\n\ttoggleIcon(icon, value)\r\n\t{\r\n\t\tif (Type.isDomNode(icon))\r\n\t\t{\r\n\t\t\tDom.style(icon, 'display', value);\r\n\t\t}\r\n\t}\r\n\r\n\tgetNameBlock(): HTMLElement\r\n\t{\r\n\t\treturn this.cache.remember('nameBlock', () => {\r\n\t\t\treturn Tag.render`\r\n\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\r\n\t\t\t\t\t${this.getNameTag()}\r\n\t\t\t\t\t${this.getNameInput()}\r\n\t\t\t\t\t${this.getHiddenNameInput()}\r\n\t\t\t\t</div>\r\n\t\t\t`;\r\n\t\t});\r\n\t}\r\n\r\n\tgetNameTag(): ?HTMLElement\r\n\t{\r\n\t\tif (!this.model.isNew())\r\n\t\t{\r\n\t\t\treturn '';\r\n\t\t}\r\n\r\n\t\treturn Tag.render`\r\n\t\t\t<div class=\"ui-ctl-tag\">${Loc.getMessage('CATALOG_SELECTOR_NEW_TAG_TITLE')}</div>\r\n\t\t`;\r\n\t}\r\n\r\n\tgetNameInput(): HTMLInputElement\r\n\t{\r\n\t\treturn this.cache.remember('nameInput', () => {\r\n\t\t\tconst input = Tag.render`\r\n\t\t\t\t<input type=\"text\"\r\n\t\t\t\t\tclass=\"ui-ctl-element ui-ctl-textbox\"\r\n\t\t\t\t\tautocomplete=\"off\"\r\n\t\t\t\t\tdata-name=\"${Text.encode(this.inputName)}\"\r\n\t\t\t\t\tvalue=\"${Text.encode(this.getValue())}\"\r\n\t\t\t\t\tplaceholder=\"${Text.encode(this.getPlaceholder())}\"\r\n\t\t\t\t\ttitle=\"${Text.encode(this.getValue())}\"\r\n\t\t\t\t\tonchange=\"${this.handleNameInputHiddenChange.bind(this)}\"\r\n\t\t\t\t>\r\n\t\t\t`;\r\n\r\n\t\t\tif (this.selector.getConfig('SELECTOR_INPUT_DISABLED', false))\r\n\t\t\t{\r\n\t\t\t\tDom.addClass(input, 'ui-ctl-disabled');\r\n\t\t\t\tinput.setAttribute('disabled', true);\r\n\t\t\t}\r\n\r\n\t\t\treturn input;\r\n\t\t});\r\n\t}\r\n\r\n\tgetHiddenNameInput(): HTMLInputElement\r\n\t{\r\n\t\treturn this.cache.remember('hiddenNameInput', () => {\r\n\t\t\treturn Tag.render`\r\n\t\t\t\t<input\r\n\t\t\t\t \ttype=\"hidden\"\r\n\t\t\t\t\tname=\"${Text.encode(this.inputName)}\"\r\n\t\t\t\t\tvalue=\"${Text.encode(this.getValue())}\"\r\n\t\t\t\t>\r\n\t\t\t`;\r\n\t\t});\r\n\t}\r\n\r\n\thandleNameInputHiddenChange(event: UIEvent)\r\n\t{\r\n\t\tthis.getHiddenNameInput().value = event.target.value;\r\n\t}\r\n\r\n\tgetClearIcon(): HTMLElement\r\n\t{\r\n\t\treturn this.cache.remember('closeIcon', () => {\r\n\t\t\treturn Tag.render`\r\n\t\t\t\t<button\r\n\t\t\t\t\tclass=\"ui-ctl-after ui-ctl-icon-clear\"\r\n\t\t\t\t\tonclick=\"${this.handleClearIconClick.bind(this)}\"\r\n\t\t\t\t></button>\r\n\t\t\t`;\r\n\t\t});\r\n\t}\r\n\r\n\tgetArrowIcon(): HTMLElement\r\n\t{\r\n\t\treturn this.cache.remember('arrowIcon', () => {\r\n\t\t\treturn Tag.render`\r\n\t\t\t\t<a\r\n\t\t\t\t\thref=\"${Text.encode(this.model.getDetailPath())}\"\r\n\t\t\t\t\ttarget=\"_blank\"\r\n\t\t\t\t\tclass=\"ui-ctl-after ui-ctl-icon-forward\"\r\n\t\t\t\t>\r\n\t\t\t`;\r\n\t\t});\r\n\t}\r\n\r\n\tgetSearchIcon(): HTMLElement\r\n\t{\r\n\t\treturn this.cache.remember('searchIcon', () => {\r\n\t\t\treturn Tag.render`\r\n\t\t\t\t<button\r\n\t\t\t\t\tclass=\"ui-ctl-after ui-ctl-icon-search\"\r\n\t\t\t\t\tonclick=\"${this.handleSearchIconClick.bind(this)}\"\r\n\t\t\t\t></button>\r\n\t\t\t`;\r\n\t\t});\r\n\t}\r\n\r\n\tlayout(): HTMLElement\r\n\t{\r\n\t\tthis.clearInputCache();\r\n\t\tconst block = Tag.render`<div class=\"ui-ctl ui-ctl-w100 ui-ctl-after-icon\"></div>`;\r\n\r\n\t\tthis.toggleIcon(this.getClearIcon(), 'none');\r\n\t\tDom.append(this.getClearIcon(), block);\r\n\r\n\t\tif (this.isSearchEnabled())\r\n\t\t{\r\n\t\t\tif (this.selector.isProductSearchEnabled())\r\n\t\t\t{\r\n\t\t\t\tthis.initHasDialogItems();\r\n\t\t\t}\r\n\r\n\t\t\tthis.toggleIcon(\r\n\t\t\t\tthis.getSearchIcon(),\r\n\t\t\t\tType.isStringFilled(this.getFilledValue()) ? 'none' : 'block'\r\n\t\t\t);\r\n\t\t\tDom.append(this.getSearchIcon(), block);\r\n\r\n\t\t\tEvent.bind(this.getNameInput(), 'click', this.handleClickNameInput.bind(this));\r\n\t\t\tEvent.bind(this.getNameInput(), 'input', this.handleSearchInput);\r\n\t\t\tEvent.bind(this.getNameInput(), 'blur', this.handleNameInputBlur.bind(this));\r\n\t\t\tEvent.bind(this.getNameInput(), 'keydown', this.handleNameInputKeyDown.bind(this));\r\n\r\n\t\t\tthis.dialogMode =\r\n\t\t\t\tthis.model.isCatalogExisted()\r\n\t\t\t\t\t? DialogMode.SHOW_PRODUCT_ITEM\r\n\t\t\t\t\t: DialogMode.SHOW_RECENT\r\n\t\t\t;\r\n\t\t}\r\n\r\n\t\tif (this.showDetailLink() && Type.isStringFilled(this.getValue()))\r\n\t\t{\r\n\t\t\tthis.toggleIcon(this.getClearIcon(), 'none');\r\n\t\t\tthis.toggleIcon(this.getSearchIcon(), 'none');\r\n\t\t\tthis.toggleIcon(this.getArrowIcon(), 'block');\r\n\t\t\tDom.append(this.getArrowIcon(), block);\r\n\t\t}\r\n\r\n\t\tEvent.bind(this.getNameInput(), 'click', this.handleIconsSwitchingOnNameInput.bind(this));\r\n\t\tEvent.bind(this.getNameInput(), 'input', this.handleIconsSwitchingOnNameInput.bind(this));\r\n\t\tEvent.bind(this.getNameInput(), 'change', this.handleNameInputChange.bind(this));\r\n\r\n\t\tDom.append(this.getNameBlock(), block);\r\n\t\treturn block;\r\n\t}\r\n\r\n\tshowDetailLink(): boolean\r\n\t{\r\n\t\treturn this.isEnabledDetailLink;\r\n\t}\r\n\r\n\tgetDialog(): ?Dialog\r\n\t{\r\n\t\t// return this.cache.remember('dialog', () => {\r\n\t\t\tconst searchTypeId = ProductSearchInput.SEARCH_TYPE_ID ;\r\n\t\t\tconst entity = {\r\n\t\t\t\tid: searchTypeId,\r\n\t\t\t\toptions: {\r\n\t\t\t\t\tiblockId: this.model.getIblockId(),\r\n\t\t\t\t\tbasePriceId: this.model.getBasePriceId(),\r\n\t\t\t\t\tcurrency: this.model.getCurrency(),\r\n                    filters: this.model.getOption(\"editor\").controller._model.getField(\"PRODUCT_LIST_DATA\")\r\n\t\t\t\t},\r\n\t\t\t\tdynamicLoad: true,\r\n\t\t\t\tdynamicSearch: true,\r\n\t\t\t};\r\n\t\t\tconst restrictedProductTypes = this.selector.getConfig('RESTRICTED_PRODUCT_TYPES', null);\r\n\t\t\tif (!Type.isNil(restrictedProductTypes))\r\n\t\t\t{\r\n\t\t\t\tentity.options.restrictedProductTypes = restrictedProductTypes;\r\n\t\t\t}\r\n\r\n\t\t\tconst params = {\r\n\t\t\t\tid: this.id + '_' + searchTypeId,\r\n\t\t\t\theight: 300,\r\n\t\t\t\twidth: Math.max(this.getNameInput()?.offsetWidth, 565),\r\n\t\t\t\tcontext: 'catalog-products',\r\n\t\t\t\ttargetNode: this.getNameInput(),\r\n\t\t\t\tenableSearch: false,\r\n\t\t\t\tmultiple: false,\r\n\t\t\t\tdropdownMode: true,\r\n\t\t\t\tsearchTabOptions: {\r\n\t\t\t\t\tstub: true,\r\n\t\t\t\t\tstubOptions: {\r\n\t\t\t\t\t\ttitle: Tag.message`${'CATALOG_SELECTOR_IS_EMPTY_TITLE'}`,\r\n\t\t\t\t\t\tsubtitle:\r\n\t\t\t\t\t\t\tthis.isAllowedCreateProduct()\r\n\t\t\t\t\t\t\t\t? Tag.message`${'CATALOG_SELECTOR_IS_EMPTY_SUBTITLE'}`\r\n\t\t\t\t\t\t\t\t: ''\r\n\t\t\t\t\t\t,\r\n\t\t\t\t\t\tarrow: true\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tevents: {\r\n\t\t\t\t\t'Item:onSelect': this.onProductSelect.bind(this),\r\n\t\t\t\t\t'Search:onItemCreateAsync': this.createProduct.bind(this),\r\n\t\t\t\t\t'ChangeItem:onClick': this.showChangeNotification.bind(this),\r\n\t\t\t\t},\r\n\t\t\t\tentities: [entity]\r\n\t\t\t};\r\n\r\n\t\t\tconst settingsCollection = Extension.getSettings('catalog.product-selector');\r\n\t\t\tif (Type.isObject(settingsCollection.get('limitInfo')))\r\n\t\t\t{\r\n\t\t\t\tparams.footer = ProductCreationLimitedFooter;\r\n\t\t\t}\r\n\t\t\telse if (this.model && this.model.isCatalogExisted())\r\n\t\t\t{\r\n\t\t\t\tparams.footer = ProductSearchSelectorFooter;\r\n\t\t\t\tparams.footerOptions = {\r\n\t\t\t\t\tinputName: this.inputName,\r\n\t\t\t\t\tallowEditItem: this.isAllowedEditProduct(),\r\n\t\t\t\t\tallowCreateItem: this.isAllowedCreateProduct(),\r\n\t\t\t\t\terrorAdminHint: settingsCollection.get('errorAdminHint'),\r\n\t\t\t\t\tcreationLabel: Loc.getMessage('CATALOG_SELECTOR_SEARCH_POPUP_FOOTER_CREATE'),\r\n\t\t\t\t\tcurrentValue: this.getValue(),\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tparams.searchOptions = { allowCreateItem: this.isAllowedCreateProduct() };\r\n\t\t\t}\r\n\r\n\t\t\treturn new Dialog(params);\r\n\t\t// });\r\n\t}\r\n\r\n\tinitHasDialogItems()\r\n\t{\r\n\t\tif (!Type.isNil(this.selector.getConfig('EXIST_DIALOG_ITEMS')))\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!this.selector.getModel().isEmpty())\r\n\t\t{\r\n\t\t\tthis.selector.setConfig('EXIST_DIALOG_ITEMS', true);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// is null, that not send ajax\r\n\t\tthis.selector.setConfig('EXIST_DIALOG_ITEMS', false);\r\n\r\n\t\tconst dialog = this.getDialog();\r\n\t\tif (dialog.hasDynamicLoad())\r\n\t\t{\r\n\t\t\tthis.#loadPreselectedItems();\r\n\t\t\tdialog.subscribeOnce('onLoad', () => {\r\n\t\t\t\tif (dialog.getPreselectedItems().length > 1)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.selector.setConfig('EXIST_DIALOG_ITEMS', true);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.selector.setConfig('EXIST_DIALOG_ITEMS', true);\r\n\t\t}\r\n\t}\r\n\r\n\tisAllowedCreateProduct(): boolean\r\n\t{\r\n\t\treturn this.selector.getConfig('IS_ALLOWED_CREATION_PRODUCT', true) && this.selector.checkProductAddRights();\r\n\t}\r\n\r\n\tisAllowedEditProduct(): boolean\r\n\t{\r\n\t\treturn this.selector.checkProductEditRights();\r\n\t}\r\n\r\n\thandleNameInputKeyDown(event: KeyboardEvent): void\r\n\t{\r\n\t\tconst dialog = this.getDialog();\r\n\t\tif (event.key === 'Enter' && dialog.getActiveTab() === dialog.getSearchTab())\r\n\t\t{\r\n\t\t\t// prevent a form submit\r\n\t\t\tevent.stopPropagation();\r\n\t\t\tevent.preventDefault();\r\n\r\n\t\t\tif ((Browser.isMac() && event.metaKey) || event.ctrlKey)\r\n\t\t\t{\r\n\t\t\t\tdialog.getSearchTab().getFooter().createItem();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\thandleIconsSwitchingOnNameInput(event: UIEvent): void\r\n\t{\r\n\t\tthis.toggleIcon(this.getArrowIcon(), 'none');\r\n\r\n\t\tif (Type.isStringFilled(event.target.value))\r\n\t\t{\r\n\t\t\tthis.toggleIcon(this.getClearIcon(), 'block');\r\n\t\t\tthis.toggleIcon(this.getSearchIcon(), 'none');\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.toggleIcon(this.getClearIcon(), 'none');\r\n\t\t\tif (this.isSearchEnabled())\r\n\t\t\t{\r\n\t\t\t\tthis.toggleIcon(this.getSearchIcon(), 'block');\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tclearInputCache()\r\n\t{\r\n\t\tthis.cache.delete('dialog');\r\n\t\tthis.cache.delete('nameBlock');\r\n\t\tthis.cache.delete('nameInput');\r\n\t\tthis.cache.delete('hiddenNameInput');\r\n\t}\r\n\r\n\thandleClearIconClick(event: UIEvent)\r\n\t{\r\n\t\tthis.selector.emit('onBeforeClear', {\r\n\t\t\tselectorId: this.selector.getId(),\r\n\t\t\trowId: this.selector.getRowId()\r\n\t\t});\r\n\r\n\t\tthis.loadedSelectedItem = null;\r\n\t\tif (this.selector.isProductSearchEnabled() && !this.model.isEmpty())\r\n\t\t{\r\n\t\t\tthis.selector.clearState();\r\n\t\t\tthis.selector.clearLayout();\r\n\t\t\tthis.selector.layout();\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tconst newValue = '';\r\n\t\t\tthis.toggleIcon(this.getClearIcon(), 'none');\r\n\t\t\tthis.onChangeValue(newValue);\r\n\t\t}\r\n\r\n\t\tthis.selector.focusName();\r\n\r\n\t\tthis.selector.emit('onClear', {\r\n\t\t\tselectorId: this.selector.getId(),\r\n\t\t\trowId: this.selector.getRowId()\r\n\t\t});\r\n\r\n\t\tevent.stopPropagation();\r\n\t\tevent.preventDefault();\r\n\t}\r\n\r\n\thandleNameInputChange(event: UIEvent)\r\n\t{\r\n\t\tconst value = event.target.value;\r\n\t\tthis.onChangeValue(value);\r\n\t}\r\n\r\n\tonChangeValue(value: string)\r\n\t{\r\n\t\tconst fields = {};\r\n\t\tthis.getNameInput().title = value;\r\n\t\tthis.getNameInput().value = value;\r\n\t\tfields[this.inputName] = value;\r\n\t\tEventEmitter.emit('ProductSelector::onNameChange', {\r\n\t\t\trowId: this.selector.getRowId(),\r\n\t\t\tfields\r\n\t\t});\r\n\r\n\t\tif (!this.selector.isEnabledAutosave())\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.selector.getModel().setFields(fields);\r\n\t\tthis.selector.getModel().save().then(() => {\r\n\t\t\tBX.UI.Notification.Center.notify({\r\n\t\t\t\tid: 'saving_field_notify_name',\r\n\t\t\t\tcloseButton: false,\r\n\t\t\t\tcontent: Tag.render`<div>${Loc.getMessage('CATALOG_SELECTOR_SAVING_NOTIFICATION_NAME')}</div>`,\r\n\t\t\t\tautoHide: true,\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tfocusName()\r\n\t{\r\n\t\trequestAnimationFrame(() => this.getNameInput().focus());\r\n\t}\r\n\r\n\tsearchInDialog(): void\r\n\t{\r\n\t\tconst searchQuery = this.getFilledValue().trim();\r\n\t\tif (searchQuery === '')\r\n\t\t{\r\n\t\t\tif (this.isHasDialogItems === false)\r\n\t\t\t{\r\n\t\t\t\tthis.getDialog().hide();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis.loadedSelectedItem = null;\r\n\t\t\tthis.#showPreselectedItems()\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.dialogMode = DialogMode.SEARCHING;\r\n\t\tthis.#searchItem(searchQuery);\r\n\t\tthis.isSearchingInProcess = true;\r\n\t}\r\n\r\n\t#showSelectedItem()\r\n\t{\r\n\t\tif (!this.selector.isProductSearchEnabled())\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst dialog = this.getDialog();\r\n\t\tdialog.removeItems();\r\n\r\n\t\tnew Promise((resolve) => {\r\n\t\t\tif (!Type.isNil(this.loadedSelectedItem))\r\n\t\t\t{\r\n\t\t\t\tresolve();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tdialog.showLoader();\r\n\t\t\tajax.runAction(\r\n\t\t\t\t'catalog.productSelector.getSkuSelectorItem',\r\n\t\t\t\t{\r\n\t\t\t\t\tjson: {\r\n\t\t\t\t\t\tid: this.selector.getModel().getSkuId(),\r\n\t\t\t\t\t\toptions: {\r\n\t\t\t\t\t\t\tiblockId: this.model.getIblockId(),\r\n\t\t\t\t\t\t\tbasePriceId: this.model.getBasePriceId(),\r\n\t\t\t\t\t\t\tcurrency: this.model.getCurrency(),\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t)\r\n\t\t\t\t.then((response) => {\r\n\t\t\t\t\tdialog.hideLoader();\r\n\t\t\t\t\tthis.loadedSelectedItem = null;\r\n\t\t\t\t\tif (Type.isObject(response.data) && !dialog.isLoading())\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.loadedSelectedItem = dialog.addItem(response.data);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tresolve();\r\n\t\t\t\t});\r\n\t\t})\r\n\t\t\t.then(() => {\r\n\t\t\t\tif (!Type.isNil(this.loadedSelectedItem))\r\n\t\t\t\t{\r\n\t\t\t\t\tdialog.setPreselectedItems([this.selector.getModel().getSkuId()]);\r\n\t\t\t\t\tdialog.getRecentTab().getRootNode().addItem(this.loadedSelectedItem);\r\n\t\t\t\t\tdialog.selectFirstTab();\r\n\t\t\t\t\tdialog.getFooter()?.hide();\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.searchInDialog();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\tdialog.getPopup().show();\r\n\t\tdialog.getFooter()?.hide();\r\n\t}\r\n\r\n\t#loadPreselectedItems()\r\n\t{\r\n\t\tconst dialog = this.getDialog();\r\n\t\tif (dialog.isLoading())\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this.loadedSelectedItem)\r\n\t\t{\r\n\t\t\tdialog.removeItems();\r\n\t\t\tdialog.loadState = 'UNSENT';\r\n\t\t\tthis.loadedSelectedItem = null;\r\n\t\t}\r\n\r\n\t\tdialog.load();\r\n\t}\r\n\r\n\t#showPreselectedItems()\r\n\t{\r\n\t\tif (!this.selector.isProductSearchEnabled())\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.dialogMode = DialogMode.SHOW_RECENT;\r\n\t\tconst dialog = this.getDialog();\r\n\t\tthis.#loadPreselectedItems();\r\n\r\n\t\tdialog.selectFirstTab();\r\n\t\tdialog.getFooter()?.hide();\r\n\t\tdialog.show();\r\n\t}\r\n\r\n\t#searchItem(searchQuery: string = '')\r\n\t{\r\n\t\tif (!this.selector.isProductSearchEnabled())\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst dialog = this.getDialog();\r\n\t\tdialog.getPopup().show();\r\n\t\tdialog.search(searchQuery);\r\n\t}\r\n\r\n\thandleClickNameInput(): void\r\n\t{\r\n\t\tconst dialog = this.getDialog();\r\n\r\n\t\tif (\r\n\t\t\tdialog.isOpen()\r\n\t\t\t|| (this.getFilledValue() === '' && this.isHasDialogItems === false)\r\n\t\t)\r\n\t\t{\r\n\t\t\tdialog.hide();\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.showItems();\r\n\t}\r\n\r\n\tshowItems()\r\n\t{\r\n\t\tif (this.getFilledValue() === '')\r\n\t\t{\r\n\t\t\tthis.#showPreselectedItems();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!this.model.isCatalogExisted() || this.dialogMode !== DialogMode.SHOW_PRODUCT_ITEM)\r\n\t\t{\r\n\t\t\tthis.searchInDialog();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.#showSelectedItem();\r\n\t}\r\n\r\n\thandleNameInputBlur(event: UIEvent)\r\n\t{\r\n\t\t// timeout to toggle clear icon handler while cursor is inside of name input\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.toggleIcon(this.getClearIcon(), 'none');\r\n\r\n\t\t\tif (this.showDetailLink() && Type.isStringFilled(this.getValue()))\r\n\t\t\t{\r\n\t\t\t\tif (this.isSearchEnabled())\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.toggleIcon(this.getSearchIcon(), 'none');\r\n\t\t\t\t}\r\n\t\t\t\tthis.toggleIcon(this.getArrowIcon(), 'block');\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tthis.toggleIcon(this.getArrowIcon(), 'none');\r\n\t\t\t\tif (this.isSearchEnabled())\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.toggleIcon(\r\n\t\t\t\t\t\tthis.getSearchIcon(),\r\n\t\t\t\t\t\tType.isStringFilled(this.getFilledValue()) ? 'none' : 'block'\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, 200);\r\n\r\n\t\tif (this.isSearchEnabled() && this.selector.isEnabledEmptyProductError())\r\n\t\t{\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tif (\r\n\t\t\t\t\t!this.selector.inProcess()\r\n\t\t\t\t\t&& (\r\n\t\t\t\t\t\tthis.model.isEmpty()\r\n\t\t\t\t\t\t|| !Type.isStringFilled(this.getFilledValue())\r\n\t\t\t\t\t)\r\n\t\t\t\t)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.model.getErrorCollection().setError(\r\n\t\t\t\t\t\tSelectorErrorCode.NOT_SELECTED_PRODUCT,\r\n\t\t\t\t\t\tthis.selector.getEmptySelectErrorMessage()\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tthis.selector.layoutErrors();\r\n\t\t\t\t}\r\n\t\t\t}, 200);\r\n\t\t}\r\n\t}\r\n\r\n\thandleSearchIconClick(event: UIEvent)\r\n\t{\r\n\t\tthis.searchInDialog();\r\n\t\tthis.focusName();\r\n\r\n\t\tevent.stopPropagation();\r\n\t\tevent.preventDefault();\r\n\t}\r\n\r\n\tgetImmutableFieldNames(): []\r\n\t{\r\n\t\treturn this.immutableFieldNames;\r\n\t}\r\n\r\n\tsetInputValueOnProductSelect(item: Item)\r\n\t{\r\n\t\titem.getDialog().getTargetNode().value = item.getTitle()\r\n\t}\r\n\r\n\tonProductSelect(event)\r\n\t{\r\n\t\tconst item = event.getData().item;\r\n\t\tthis.setInputValueOnProductSelect(item);\r\n\r\n\t\tthis.toggleIcon(this.getSearchIcon(), 'none');\r\n\t\tthis.clearErrors();\r\n\t\tif (this.selector)\r\n\t\t{\r\n\t\t\tconst isNew = item.getCustomData().get('isNew');\r\n\t\t\tconst immutableFields = [];\r\n\t\t\tthis.getImmutableFieldNames().forEach((key) => {\r\n\t\t\t\tif (!Type.isNil(item.getCustomData().get(key)))\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.model.setField(key, item.getCustomData().get(key));\r\n\t\t\t\t\timmutableFields.push(key);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tthis.selector.onProductSelect(\r\n\t\t\t\titem.getId(),\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tisNew,\r\n\t\t\t\t\t\timmutableFields,\r\n\t\t\t\t}\r\n\t\t\t);\r\n\r\n\t\t\tthis.selector.clearLayout();\r\n\t\t\tthis.selector.layout();\r\n\t\t}\r\n\r\n\t\tthis.dialogMode = DialogMode.SHOW_PRODUCT_ITEM;\r\n\t\tthis.loadedSelectedItem = item;\r\n\t\tthis.cache.delete('dialog');\r\n\t}\r\n\r\n\tclearErrors()\r\n\t{\r\n\t\tconst errors = this.model.getErrorCollection().getErrors();\r\n\t\tfor (const code in errors)\r\n\t\t{\r\n\t\t\tif (ProductSelector.ErrorCodes.getCodes().includes(code))\r\n\t\t\t{\r\n\t\t\t\tthis.model.getErrorCollection().removeError(code);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tcreateProductModelFromSearchQuery(searchQuery: string): ProductModel\r\n\t{\r\n\t\tconst fields = {...this.selector.getModel().getFields()};\r\n\t\tfields[this.inputName] = searchQuery;\r\n\r\n\t\treturn new ProductModel({\r\n\t\t\tisSimpleModel: true,\r\n\t\t\tisNew: true,\r\n\t\t\tcurrency: this.selector.options.currency,\r\n\t\t\tiblockId: this.selector.getModel().getIblockId(),\r\n\t\t\tbasePriceId: this.selector.getModel().getBasePriceId(),\r\n\t\t\tfields\r\n\t\t})\r\n\t}\r\n\r\n\tcreateProduct(event): ?Promise\r\n\t{\r\n\t\tif (this.ajaxInProcess)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.ajaxInProcess = true;\r\n\t\tconst dialog: Dialog = event.getTarget();\r\n\t\tconst {searchQuery} = event.getData();\r\n\t\tconst newProduct = this.createProductModelFromSearchQuery(searchQuery.getQuery());\r\n\r\n\t\tEventEmitter.emit(this.selector, 'onBeforeCreate', {model: newProduct});\r\n\r\n\t\treturn new Promise(\r\n\t\t\t(resolve, reject) => {\r\n\t\t\t\tif (!this.checkCreationModel(newProduct))\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.ajaxInProcess = false;\r\n\t\t\t\t\tdialog.hide();\r\n\t\t\t\t\treject();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdialog.showLoader();\r\n\t\t\t\tnewProduct.save()\r\n\t\t\t\t\t.then(response => {\r\n\t\t\t\t\t\tdialog.hideLoader();\r\n\t\t\t\t\t\tconst id = Text.toInteger(response.data.id);\r\n\t\t\t\t\t\tconst item = dialog.addItem({\r\n\t\t\t\t\t\t\tid,\r\n\t\t\t\t\t\t\tentityId: ProductSearchInput.SEARCH_TYPE_ID,\r\n\t\t\t\t\t\t\ttitle: searchQuery.getQuery(),\r\n\t\t\t\t\t\t\ttabs: dialog.getRecentTab().getId(),\r\n\t\t\t\t\t\t\tcustomData: {\r\n\t\t\t\t\t\t\t\tisNew: true,\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tthis.selector.getModel().setOption('isSimpleModel', false);\r\n\t\t\t\t\t\tthis.selector.getModel().setOption('isNew', true);\r\n\r\n\t\t\t\t\t\tthis.getImmutableFieldNames().forEach((name) => {\r\n\t\t\t\t\t\t\tthis.selector.getModel().setField(name, newProduct.getField(name));\r\n\t\t\t\t\t\t\tthis.selector.getModel().setOption(name, newProduct.getField(name));\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tif (item)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\titem.select();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tdialog.hide();\r\n\t\t\t\t\t\tthis.cache.delete('dialog');\r\n\t\t\t\t\t\tthis.ajaxInProcess = false;\r\n\t\t\t\t\t\tthis.isHasDialogItems = true;\r\n\t\t\t\t\t\tresolve();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch((errorResponse) => {\r\n\t\t\t\t\t\tdialog.hideLoader();\r\n\t\t\t\t\t\terrorResponse.errors.forEach((error) => {\r\n\t\t\t\t\t\t\tBX.UI.Notification.Center.notify({\r\n\t\t\t\t\t\t\t\tcloseButton: true,\r\n\t\t\t\t\t\t\t\tcontent: Tag.render`<div>${error.message}</div>`,\r\n\t\t\t\t\t\t\t\tautoHide: true,\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tthis.ajaxInProcess = false;\r\n\t\t\t\t\t\treject();\r\n\t\t\t\t\t});\r\n\t\t\t});\r\n\t}\r\n\r\n\tcheckCreationModel(creationModel: ProductModel): boolean\r\n\t{\r\n\t\treturn true;\r\n\t}\r\n\r\n\tshowChangeNotification(event): void\r\n\t{\r\n\t\tconst {query} = event.getData();\r\n\t\tconst options = {\r\n\t\t\ttitle: Loc.getMessage('CATALOG_SELECTOR_SAVING_NOTIFICATION_' + this.selector.getType()),\r\n\t\t\tevents: {\r\n\t\t\t\tonSave: () => {\r\n\t\t\t\t\tif (this.selector)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.selector.getModel().setField(this.inputName, query);\r\n\t\t\t\t\t\tthis.selector.getModel().save([this.inputName])\r\n\t\t\t\t\t\t\t.catch((errorResponse) => {\r\n\t\t\t\t\t\t\t\terrorResponse.errors.forEach((error) => {\r\n\t\t\t\t\t\t\t\t\tBX.UI.Notification.Center.notify({\r\n\t\t\t\t\t\t\t\t\t\tcloseButton: true,\r\n\t\t\t\t\t\t\t\t\t\tcontent: Tag.render`<div>${error.message}</div>`,\r\n\t\t\t\t\t\t\t\t\t\tautoHide: true,\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t};\r\n\r\n\t\tif (this.selector.getConfig('ROLLBACK_INPUT_AFTER_CANCEL', false))\r\n\t\t{\r\n\t\t\toptions.declineCancelTitle = Loc.getMessage('CATALOG_SELECTOR_SAVING_NOTIFICATION_CANCEL_TITLE');\r\n\t\t\toptions.events.onCancel = () => {\r\n\t\t\t\tthis.selector.clearLayout();\r\n\t\t\t\tthis.selector.layout();\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tthis.selector.getModel().showSaveNotifier(\r\n\t\t\t'nameChanger_' + this.selector.getId(),\r\n\t\t\toptions\r\n\t\t);\r\n\t}\r\n\r\n\tgetPlaceholder(): string\r\n\t{\r\n\t\treturn (\r\n\t\t\tthis.isSearchEnabled() && this.model.isEmpty()\r\n\t\t\t\t? Loc.getMessage('CATALOG_SELECTOR_BEFORE_SEARCH_TITLE')\r\n\t\t\t\t: Loc.getMessage('CATALOG_SELECTOR_VIEW_NAME_TITLE')\r\n\t\t);\r\n\t}\r\n\r\n\tremoveSpotlight()\r\n\t{\r\n\t}\r\n\r\n\tremoveQrAuth()\r\n\t{\r\n\t}\r\n}\r\n","import {Runtime, Tag, Text, Type, Dom} from 'main.core';\r\nimport './component.css';\r\nimport {ProductSelector} from 'catalog.product-selector';\r\n\r\nexport class ProductImageInput\r\n{\r\n\tconstructor(id, options = {})\r\n\t{\r\n\t\tthis.id = id || Text.getRandom();\r\n\t\tthis.selector = options.selector || null;\r\n\t\tif (!(this.selector instanceof ProductSelector))\r\n\t\t{\r\n\t\t\tthrow new Error('Product selector instance not found.');\r\n\t\t}\r\n\r\n\t\tthis.config = options.config || {};\r\n\r\n\t\tif (!Type.isStringFilled(this.selector.getModel()?.getImageCollection().getEditInput()))\r\n\t\t{\r\n\t\t\tthis.restoreDefaultInputHtml();\r\n\t\t}\r\n\r\n\t\tthis.enableSaving = options.enableSaving;\r\n\r\n\t\tthis.uploaderFieldMap = {};\r\n\t}\r\n\r\n\tgetId()\r\n\t{\r\n\t\treturn this.id;\r\n\t}\r\n\r\n\tsetId(id)\r\n\t{\r\n\t\tthis.id = id;\r\n\t}\r\n\r\n\tsetView(html): void\r\n\t{\r\n\t\tthis.selector.getModel()?.getImageCollection().setPreview(html);\r\n\t}\r\n\r\n\tsetInputHtml(html): void\r\n\t{\r\n\t\tthis.selector.getModel()?.getImageCollection().setEditInput(html);\r\n\t}\r\n\r\n\trestoreDefaultInputHtml(): void\r\n\t{\r\n\t\tconst defaultInput = `\r\n\t\t\t<div class='ui-image-input-container ui-image-input-img--disabled'>\r\n\t\t\t\t<div class='adm-fileinput-wrapper '>\r\n\t\t\t\t\t<div class='adm-fileinput-area mode-pict adm-fileinput-drag-area'></div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n`\t\t;\r\n\r\n\t\tthis.selector.getModel()?.getImageCollection().setEditInput(defaultInput);\r\n\t\tthis.selector.getModel()?.getImageCollection().setPreview(defaultInput);\r\n\t}\r\n\r\n\tisViewMode(): boolean\r\n\t{\r\n\t\treturn this.selector && (this.selector.isViewMode() || !this.selector.model.isSaveable());\r\n\t}\r\n\r\n\tisEnabledLiveSaving(): boolean\r\n\t{\r\n\t\treturn this.enableSaving;\r\n\t}\r\n\r\n\tlayout(): HTMLElement\r\n\t{\r\n\t\tconst imageContainer = Tag.render`<div></div>`;\r\n\t\tconst html =\r\n\t\t\tthis.isViewMode()\r\n\t\t\t\t? this.selector.getModel()?.getImageCollection()?.getPreview()\r\n\t\t\t\t: this.selector.getModel()?.getImageCollection()?.getEditInput()\r\n\t\t;\r\n\r\n\t\tRuntime.html(imageContainer, html);\r\n\r\n\t\treturn imageContainer;\r\n\t}\r\n}","import {Loc, Tag, Dom, Type} from 'main.core';\r\nimport {BaseEvent} from \"main.core.events\";\r\nimport ProductSearchSelectorFooter from \"./product-search-selector-footer\";\r\n\r\nexport class BarcodeSearchSelectorFooter extends ProductSearchSelectorFooter\r\n{\r\n\tconstructor(id, options = {})\r\n\t{\r\n\t\tsuper(id, options);\r\n\t\tthis.isEmptyBarcode = options.isEmptyBarcode;\r\n\t\tthis.getDialog().subscribe('SearchTab:onLoad', this.handleOnSearchLoad.bind(this));\r\n\t}\r\n\r\n\tgetContent(): HTMLElement\r\n\t{\r\n\t\tthis.barcodeContent = super.getContent();\r\n\t\tthis.scannerContent = this.getScannerContent();\r\n\t\tDom.style(this.barcodeContent, 'display', 'none');\r\n\r\n\t\treturn Tag.render`\r\n\t\t\t<div class=\"catalog-footers-container\">\r\n\t\t\t\t${this.barcodeContent}\r\n\t\t\t\t${this.scannerContent}\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\tisViewEditButton(): boolean\r\n\t{\r\n\t\treturn !this.isEmptyBarcode && super.isViewEditButton();\r\n\t}\r\n\r\n\tgetScannerContent(): HTMLElement\r\n\t{\r\n\t\tconst phrase = Tag.render`\r\n\t\t\t<div>${Loc.getMessage('CATALOG_SELECTOR_SEARCH_POPUP_FOOTER_BARCODE')}</div>\r\n\t\t`;\r\n\r\n\t\tconst createButton = phrase.querySelector('create-button');\r\n\r\n\t\tDom.replace(createButton, this.getScannerLabelContainer());\r\n\r\n\t\treturn Tag.render`\r\n\t\t\t<div class=\"ui-selector-search-footer-box\">\r\n\t\t\t\t${phrase}\r\n\t\t\t\t${this.getLoaderContainer()}\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\tgetScannerLabelContainer(): HTMLElement\r\n\t{\r\n\t\treturn this.cache.remember('scannerLabel', () => {\r\n\t\t\treturn Tag.render`\r\n\t\t\t\t<span onclick=\"${this.handleScannerClick.bind(this)}\">\r\n\t\t\t\t\t<span class=\"ui-selector-footer-link ui-selector-footer-link-add footer-link--warehouse-barcode-icon\">\r\n\t\t\t\t\t\t${Loc.getMessage('CATALOG_SELECTOR_SEARCH_POPUP_FOOTER_BARCODE_START_SCAN_LABEL')}\r\n\t\t\t\t\t</span>\r\n\t\t\t\t\t${this.getScannerQueryContainer()}\r\n\t\t\t\t</span>\r\n\t\t\t`;\r\n\t\t});\r\n\t}\r\n\r\n\tgetScannerQueryContainer(): HTMLElement\r\n\t{\r\n\t\treturn this.cache.remember('scanner_name-container', () => {\r\n\t\t\treturn Tag.render`\r\n\t\t\t\t<span class=\"ui-selector-search-footer-query\"></span>\r\n\t\t\t`;\r\n\t\t});\r\n\t}\r\n\r\n\thandleScannerClick(): void\r\n\t{\r\n\t\tconst inputEntity = this.options?.inputEntity;\r\n\t\tif (inputEntity)\r\n\t\t{\r\n\t\t\tinputEntity.startMobileScanner();\r\n\t\t}\r\n\t}\r\n\r\n\thandleOnSearch(event: BaseEvent): void\r\n\t{\r\n\t\tconst { query } = event.getData();\r\n\r\n\t\tif (!Type.isStringFilled(query))\r\n\t\t{\r\n\t\t\tthis.show();\r\n\t\t\tDom.style(this.scannerContent, 'display', '');\r\n\t\t\tDom.style(this.barcodeContent, 'display', 'none');\r\n\t\t}\r\n\t\telse if (this.options.currentValue === query)\r\n\t\t{\r\n\t\t\tthis.hide();\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.show();\r\n\t\t\tDom.style(this.barcodeContent, 'display', '');\r\n\t\t\tDom.style(this.scannerContent, 'display', 'none');\r\n\t\t}\r\n\r\n\t\tthis.getQueryContainer().textContent = \" \" + query;\r\n\t\tthis.getScannerQueryContainer().textContent = \" \" + query;\r\n\t}\r\n\r\n\thandleOnSearchLoad(event: BaseEvent): void\r\n\t{\r\n\t\tconst {searchTab} = event.getData();\r\n\t\tthis.getDialog().getItems().forEach(item => {\r\n\t\t\tif (item.getCustomData().get('BARCODE') === searchTab.getLastSearchQuery().getQuery())\r\n\t\t\t{\r\n\t\t\t\tthis.hide();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}","import {Extension, Loc, Tag, Type, Text, Dom, Event, userOptions, ajax} from 'main.core';\r\nimport {Dialog, Item} from 'ui.entity-selector';\r\nimport './component.css';\r\nimport {EventEmitter} from 'main.core.events';\r\nimport {ProductModel} from 'catalog.product-model';\r\nimport ProductCreationLimitedFooter from './product-creation-limited-footer';\r\nimport {ProductSearchInput} from './product-search-input';\r\nimport {ProductSelector} from 'catalog.product-selector';\r\nimport {BarcodeScanner} from 'catalog.barcode-scanner';\r\nimport 'ui.notification';\r\nimport {BarcodeSearchSelectorFooter} from './barcode-search-selector-footer';\r\nimport {QrAuthorization} from 'ui.qrauthorization';\r\nimport {SelectorErrorCode} from './selector-error-code';\r\nimport 'spotlight';\r\nimport {Guide} from 'ui.tour';\r\n\r\nexport class BarcodeSearchInput extends ProductSearchInput\r\n{\r\n\tstatic SEARCH_TYPE_ID = 'barcode';\r\n\r\n\tonFocusHandler = this.handleFocusEvent.bind(this);\r\n\tonBlurHandler = this.handleBlurEvent.bind(this);\r\n\r\n\tconstructor(id, options = {})\r\n\t{\r\n\t\tsuper(id, options);\r\n\r\n\t\tthis.focused = false;\r\n\t\tthis.settingsCollection = Extension.getSettings('catalog.product-selector');\r\n\r\n\t\tthis.isInstalledMobileApp =\r\n\t\t\tthis.selector.getConfig('IS_INSTALLED_MOBILE_APP')\r\n\t\t\t|| this.settingsCollection.get('isInstallMobileApp')\r\n\t\t;\r\n\r\n\t\tif (\r\n\t\t\t!this.settingsCollection.get('isEnabledQrAuth')\r\n\t\t\t&& this.selector.getConfig('ENABLE_BARCODE_QR_AUTH', true)\r\n\t\t)\r\n\t\t{\r\n\t\t\tthis.qrAuth = new QrAuthorization();\r\n\t\t\tthis.qrAuth.createQrCodeImage();\r\n\t\t}\r\n\t}\r\n\r\n\tdestroy()\r\n\t{\r\n\t\tEvent.unbind(this.getNameInput(), 'focus', this.onFocusHandler);\r\n\t\tEvent.unbind(this.getNameInput(), 'blur', this.onBlurHandler);\r\n\t}\r\n\r\n\thandleFocusEvent()\r\n\t{\r\n\t\tthis.focused = true;\r\n\t}\r\n\r\n\thandleBlurEvent()\r\n\t{\r\n\t\tthis.focused = false;\r\n\t}\r\n\r\n\tisSearchEnabled(): boolean\r\n\t{\r\n\t\treturn true;\r\n\t}\r\n\r\n\tshowDetailLink(): boolean\r\n\t{\r\n\t\treturn false\r\n\t}\r\n\r\n\tgetNameBlock(): HTMLElement\r\n\t{\r\n\t\treturn this.cache.remember('nameBlock', () => {\r\n\t\t\treturn Tag.render`\r\n\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\r\n\t\t\t\t\t${this.getNameInput()}\r\n\t\t\t\t\t${this.getHiddenNameInput()}\r\n\t\t\t\t</div>\r\n\t\t\t`;\r\n\t\t});\r\n\t}\r\n\r\n\tgetDialog(): ?Dialog\r\n\t{\r\n\t\treturn this.cache.remember('dialog', () => {\r\n\t\t\tconst entity = {\r\n\t\t\t\tid: BarcodeSearchInput.SEARCH_TYPE_ID,\r\n\t\t\t\toptions: {\r\n\t\t\t\t\tiblockId: this.model.getIblockId(),\r\n\t\t\t\t\tbasePriceId: this.model.getBasePriceId(),\r\n\t\t\t\t\tcurrency: this.model.getCurrency(),\r\n\t\t\t\t},\r\n\t\t\t\tdynamicLoad: true,\r\n\t\t\t\tdynamicSearch: true,\r\n\t\t\t\tsearchFields: [\r\n\t\t\t\t\t{ name: 'title', type: 'string', system: true, searchable: false },\r\n\t\t\t\t],\r\n\t\t\t};\r\n\r\n\t\t\tconst restrictedProductTypes = this.selector.getConfig('RESTRICTED_PRODUCT_TYPES', null);\r\n\t\t\tif (!Type.isNil(restrictedProductTypes))\r\n\t\t\t{\r\n\t\t\t\tentity.options.restrictedProductTypes = restrictedProductTypes;\r\n\t\t\t}\r\n\r\n\t\t\tconst params = {\r\n\t\t\t\tid: this.id + '_' + BarcodeSearchInput.SEARCH_TYPE_ID,\r\n\t\t\t\theight: 300,\r\n\t\t\t\twidth: Math.max(this.getNameInput()?.offsetWidth, 565),\r\n\t\t\t\tcontext: null,\r\n\t\t\t\ttargetNode: this.getNameInput(),\r\n\t\t\t\tenableSearch: false,\r\n\t\t\t\tmultiple: false,\r\n\t\t\t\tdropdownMode: true,\r\n\t\t\t\tsearchTabOptions: {\r\n\t\t\t\t\tstub: true,\r\n\t\t\t\t\tstubOptions: {\r\n\t\t\t\t\t\ttitle: Tag.message`${'CATALOG_SELECTOR_IS_EMPTY_TITLE'}`,\r\n\t\t\t\t\t\tsubtitle:\r\n\t\t\t\t\t\t\tthis.isAllowedCreateProduct()\r\n\t\t\t\t\t\t\t\t? Tag.message`${'CATALOG_SELECTOR_IS_EMPTY_SUBTITLE'}`\r\n\t\t\t\t\t\t\t\t: ''\r\n\t\t\t\t\t\t,\r\n\t\t\t\t\t\tarrow: true\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tevents: {\r\n\t\t\t\t\t'Item:onSelect': this.onProductSelect.bind(this),\r\n\t\t\t\t\t'Search:onItemCreateAsync': this.createProduct.bind(this),\r\n\t\t\t\t\t'ChangeItem:onClick': this.showChangeNotification.bind(this),\r\n\t\t\t\t},\r\n\t\t\t\tentities: [entity]\r\n\t\t\t};\r\n\r\n\t\t\tif (this.model.getSkuId() && !Type.isStringFilled(this.model.getField(this.inputName)))\r\n\t\t\t{\r\n\t\t\t\tparams.preselectedItems = [[BarcodeSearchInput.SEARCH_TYPE_ID, this.model.getSkuId()]];\r\n\t\t\t}\r\n\r\n\t\t\tif (Type.isObject(this.settingsCollection.get('limitInfo')))\r\n\t\t\t{\r\n\t\t\t\tparams.footer = ProductCreationLimitedFooter;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tparams.footer = BarcodeSearchSelectorFooter;\r\n\t\t\t\tparams.footerOptions = {\r\n\t\t\t\t\tinputEntity: this,\r\n\t\t\t\t\tisEmptyBarcode: !this.model || !this.model.isCatalogExisted(),\r\n\t\t\t\t\tinputName: this.inputName,\r\n\t\t\t\t\terrorAdminHint: this.settingsCollection.get('errorAdminHint'),\r\n\t\t\t\t\tallowEditItem: this.isAllowedEditProduct(),\r\n\t\t\t\t\tallowCreateItem: this.isAllowedCreateProduct(),\r\n\t\t\t\t\tcreationLabel: Loc.getMessage('CATALOG_SELECTOR_SEARCH_POPUP_FOOTER_CREATE_WITH_BARCODE'),\r\n\t\t\t\t\tcurrentValue: this.getValue(),\r\n\t\t\t\t\tsearchOptions: {\r\n\t\t\t\t\t\tallowCreateItem: this.isAllowedCreateProduct(),\r\n\t\t\t\t\t\tfooterOptions: {\r\n\t\t\t\t\t\t\tlabel: Loc.getMessage('CATALOG_SELECTOR_SEARCH_POPUP_FOOTER_CREATE_WITH_BARCODE')\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\treturn new Dialog(params);\r\n\t\t});\r\n\t}\r\n\r\n\tlayoutMobileQrPopup(): HTMLElement\r\n\t{\r\n\t\treturn this.cache.remember('qrMobilePopup', () => {\r\n\r\n\t\t\tconst closeIcon = Tag.render`<span class=\"popup-window-close-icon\"></span>`;\r\n\t\t\tEvent.bind(closeIcon, 'click', this.closeMobilePopup.bind(this));\r\n\r\n\t\t\tlet sendButton = '';\r\n\t\t\tlet helpButton = '';\r\n\t\t\tif (top.BX.Helper)\r\n\t\t\t{\r\n\t\t\t\thelpButton = Tag.render`\r\n\t\t\t\t\t<a class=\"product-selector-mobile-popup-link ui-btn ui-btn-light-border ui-btn-round\">\r\n\t\t\t\t\t\t${Loc.getMessage('CATALOG_SELECTOR_MOBILE_POPUP_HELP_BUTTON')}\r\n\t\t\t\t\t</a>\r\n\t\t\t\t`;\r\n\t\t\t\tEvent.bind(helpButton, 'click', () => {\r\n\t\t\t\t\ttop.BX.Helper.show(\"redirect=detail&code=14956818\");\r\n\t\t\t\t});\r\n\r\n\t\t\t\tsendButton = Tag.render`\r\n\t\t\t\t\t<a class=\"product-selector-mobile-popup-link ui-btn ui-btn-link\">\r\n\t\t\t\t\t\t${Loc.getMessage('CATALOG_SELECTOR_MOBILE_POPUP_SEND_PUSH_BUTTON')}\r\n\t\t\t\t\t</a>\r\n\t\t\t\t`;\r\n\r\n\t\t\t\tEvent.bind(sendButton, 'click', () => {\r\n\t\t\t\t\ttop.BX.Helper.show(\"redirect=detail&code=15042444\");\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn Tag.render`\r\n\t\t\t\t<div data-role=\"mobile-popup\">\r\n\t\t\t\t\t<div class=\"product-selector-mobile-popup-overlay\"></div>\r\n\t\t\t\t\t<div class=\"product-selector-mobile-popup-content\">\r\n\t\t\t\t\t\t<div class=\"product-selector-mobile-popup-title\">${Loc.getMessage('CATALOG_SELECTOR_MOBILE_POPUP_TITLE')}</div>\r\n\t\t\t\t\t\t<div class=\"product-selector-mobile-popup-text\">${Loc.getMessage('CATALOG_SELECTOR_MOBILE_POPUP_INSTRUCTION')}</div>\r\n\t\t\t\t\t\t<div class=\"product-selector-mobile-popup-qr\">\r\n\t\t\t\t\t\t\t${this.qrAuth.getQrNode()}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"product-selector-mobile-popup-link-container\">\r\n\t\t\t\t\t\t\t${helpButton}\r\n\t\t\t\t\t\t\t${sendButton}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t${closeIcon}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t`;\r\n\t\t});\r\n\t}\r\n\r\n\tcloseMobilePopup()\r\n\t{\r\n\t\tthis.removeQrAuth();\r\n\r\n\t\tajax\r\n\t\t\t.runAction(\r\n\t\t\t\t'catalog.ProductSelector.isInstalledMobileApp',\r\n\t\t\t\t{\r\n\t\t\t\t\tjson: {}\r\n\t\t\t\t}\r\n\t\t\t)\r\n\t\t\t.then((result) => {\r\n\t\t\t\tthis.selector.emit('onBarcodeQrClose', {});\r\n\r\n\t\t\t\tif (result.data === true)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.selector.emit('onBarcodeScannerInstallChecked', {});\r\n\t\t\t\t\tthis.isInstalledMobileApp = true;\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t;\r\n\r\n\t\tuserOptions.save('product-selector', 'barcodeQrAuth', 'showed', 'Y');\r\n\t}\r\n\r\n\thandleClickNameInput(event: UIEvent)\r\n\t{\r\n\t\tif (this.qrAuth && this.getDialog().getContainer())\r\n\t\t{\r\n\t\t\tif (!Dom.hasClass(this.getDialog().getContainer(), 'qr-barcode-info'))\r\n\t\t\t{\r\n\t\t\t\tDom.addClass(this.getDialog().getContainer(),'qr-barcode-info');\r\n\t\t\t}\r\n\r\n\t\t\tif (this.getDialog().getContainer())\r\n\t\t\t{\r\n\t\t\t\tDom.append(this.layoutMobileQrPopup(), this.getDialog().getContainer());\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tsuper.handleClickNameInput(event);\r\n\t}\r\n\r\n\tshowItems()\r\n\t{\r\n\t\tthis.searchInDialog();\r\n\t}\r\n\r\n\tonChangeValue(value: string)\r\n\t{\r\n\t\tconst fields = {};\r\n\r\n\t\tthis.getNameInput().title = value;\r\n\t\tthis.getNameInput().value = value;\r\n\r\n\t\tfields[this.inputName] = value;\r\n\r\n\t\tEventEmitter.emit('ProductSelector::onBarcodeChange', {\r\n\t\t\trowId: this.selector.getRowId(),\r\n\t\t\tfields\r\n\t\t});\r\n\r\n\t\tthis.selector.emit('onBarcodeChange', {value});\r\n\r\n\t\tif (this.selector.isEnabledAutosave())\r\n\t\t{\r\n\t\t\tthis.selector.getModel().setField(this.inputName, value);\r\n\t\t\tthis.selector.getModel().showSaveNotifier(\r\n\t\t\t\t'barcodeChanger_' + this.selector.getId(),\r\n\t\t\t\t{\r\n\t\t\t\t\ttitle: Loc.getMessage('CATALOG_SELECTOR_SAVING_NOTIFICATION_BARCODE'),\r\n\t\t\t\t\tdisableCancel: true,\r\n\t\t\t\t\tevents: {\r\n\t\t\t\t\t\tonSave: () => {\r\n\t\t\t\t\t\t\tif (this.selector)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tthis.selector.getModel().save([this.inputName]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\tsearchInDialog(): void\r\n\t{\r\n\t\tconst searchQuery = this.getFilledValue().trim();\r\n\t\tthis.searchByBarcode(searchQuery);\r\n\t}\r\n\r\n\tsearchByBarcode(searchQuery: string = ''): void\r\n\t{\r\n\t\tif (!this.selector.isProductSearchEnabled())\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst dialog = this.getDialog();\r\n\t\tif (!dialog)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tdialog.removeItems();\r\n\t\tif (!Type.isStringFilled(searchQuery))\r\n\t\t{\r\n\t\t\tif (this.model && this.model.isCatalogExisted())\r\n\t\t\t{\r\n\t\t\t\tdialog.setPreselectedItems([[BarcodeSearchInput.SEARCH_TYPE_ID, this.model.getSkuId()]])\r\n\t\t\t\tdialog.loadState = 'UNSENT';\r\n\t\t\t\tdialog.load();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tdialog.show();\r\n\t\tdialog.search(searchQuery);\r\n\t}\r\n\r\n\thandleNameInputBlur(event: UIEvent)\r\n\t{\r\n\t\t// timeout to toggle clear icon handler while cursor is inside of name input\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.toggleIcon(this.getClearIcon(), 'none');\r\n\r\n\t\t\tif (this.showDetailLink() && Type.isStringFilled(this.getValue()))\r\n\t\t\t{\r\n\t\t\t\tthis.toggleIcon(this.getSearchIcon(), 'none');\r\n\t\t\t\tthis.toggleIcon(this.getArrowIcon(), 'block');\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tthis.toggleIcon(this.getArrowIcon(), 'none');\r\n\t\t\t\tthis.toggleIcon(\r\n\t\t\t\t\tthis.getSearchIcon(),\r\n\t\t\t\t\tType.isStringFilled(this.getFilledValue()) ? 'none' : 'block'\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}, 200);\r\n\t}\r\n\r\n\tsetInputValueOnProductSelect(item: Item)\r\n\t{\r\n\t\titem.getDialog().getTargetNode().value = item.getSubtitle()\r\n\t}\r\n\r\n\tgetCreationProduct(name)\r\n\t{\r\n\t\tconst fields = {...this.selector.getModel().getFields()};\r\n\t\tfields[ProductSelector.INPUT_FIELD_NAME] = name;\r\n\r\n\t\treturn new ProductModel({\r\n\t\t\tisSimpleModel: true,\r\n\t\t\tisNew: true,\r\n\t\t\tcurrency: this.selector.options.currency,\r\n\t\t\tiblockId: this.selector.getModel().getIblockId(),\r\n\t\t\tbasePriceId: this.selector.getModel().getBasePriceId(),\r\n\t\t\tfields\r\n\t\t})\r\n\t}\r\n\r\n\tcreateProductModelFromSearchQuery(searchQuery: string)\r\n\t{\r\n\t\tconst model = super.createProductModelFromSearchQuery(searchQuery);\r\n\t\tmodel.setField(ProductSelector.INPUT_FIELD_NAME, Loc.getMessage('CATALOG_SELECTOR_NEW_BARCODE_PRODUCT_NAME'));\r\n\t\tmodel.setField(this.inputName, searchQuery);\r\n\r\n\t\treturn model;\r\n\t}\r\n\r\n\tcheckCreationModel(creationModel: ProductModel): boolean\r\n\t{\r\n\t\tif (!Type.isStringFilled(creationModel.getField(ProductSelector.INPUT_FIELD_NAME)))\r\n\t\t{\r\n\t\t\tthis.model.getErrorCollection().setError(\r\n\t\t\t\tSelectorErrorCode.NOT_SELECTED_PRODUCT,\r\n\t\t\t\tLoc.getMessage('CATALOG_SELECTOR_EMPTY_TITLE')\r\n\t\t\t);\r\n\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\tgetPlaceholder(): string\r\n\t{\r\n\t\treturn (\r\n\t\t\tthis.isSearchEnabled() && this.model.isEmpty()\r\n\t\t\t\t? Loc.getMessage('CATALOG_SELECTOR_BEFORE_SEARCH_BARCODE_TITLE')\r\n\t\t\t\t: Loc.getMessage('CATALOG_SELECTOR_VIEW_BARCODE_TITLE')\r\n\t\t);\r\n\t}\r\n\r\n\thandleClearIconClick(event: UIEvent)\r\n\t{\r\n\t\tthis.toggleIcon(this.getClearIcon(), 'none');\r\n\t\tthis.onChangeValue('');\r\n\r\n\t\tthis.selector.focusName();\r\n\r\n\t\tevent.stopPropagation();\r\n\t\tevent.preventDefault();\r\n\t}\r\n\r\n\tstartMobileScanner(event)\r\n\t{\r\n\t\tif (this.isInstalledMobileApp)\r\n\t\t{\r\n\t\t\tthis.sendMobilePush(event);\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!this.qrAuth)\r\n\t\t{\r\n\t\t\tthis.qrAuth = new QrAuthorization();\r\n\t\t\tthis.qrAuth.createQrCodeImage();\r\n\t\t}\r\n\r\n\t\tif (this.getDialog().isOpen())\r\n\t\t{\r\n\t\t\tthis.getDialog().hide();\r\n\t\t\tthis.getDialog().subscribeOnce('onHide', this.handleClickNameInput.bind(this));\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.handleClickNameInput(event);\r\n\t\t}\r\n\t}\r\n\r\n\tsendMobilePush(event)\r\n\t{\r\n\t\tevent?.preventDefault();\r\n\t\tthis.getDialog().hide();\r\n\t\tthis.getNameInput().focus();\r\n\r\n\t\tif (!this.selector.isEnabledMobileScanning())\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst token = this.selector.getMobileScannerToken();\r\n\t\tBarcodeScanner.open(token);\r\n\r\n\t\tconst repeatLink = Tag.render`<span class='ui-notification-balloon-action'>${Loc.getMessage('CATALOG_SELECTOR_SEND_PUSH_ON_SCANNER_NOTIFICATION_REPEAT')}</span>`;\r\n\t\tEvent.bind(repeatLink, 'click', this.sendMobilePush.bind(this));\r\n\r\n\t\tconst content = Tag.render`\r\n\t\t\t<div>\r\n\t\t\t\t<span>${Loc.getMessage('CATALOG_SELECTOR_SEND_PUSH_ON_SCANNER_NOTIFICATION')}</span>\r\n\t\t\t\t${repeatLink}\r\n\t\t\t</div>\r\n\t\t`;\r\n\r\n\t\tBX.UI.Notification.Center.notify({\r\n\t\t\tcontent,\r\n\t\t\tcategory: 'sending_push_barcode_scanner_notification',\r\n\t\t\tautoHideDelay: 5000,\r\n\t\t});\r\n\t}\r\n\r\n\tgetProductIdByBarcode(barcode)\r\n\t{\r\n\t\treturn ajax.runAction(\r\n\t\t\t'catalog.ProductSelector.getProductIdByBarcode',\r\n\t\t\t{\r\n\t\t\t\tjson: {\r\n\t\t\t\t\tbarcode: barcode,\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t)\r\n\t}\r\n\r\n\tapplyScannerData(barcode)\r\n\t{\r\n\t\tthis.getProductIdByBarcode(barcode).then((response) => {\r\n\t\t\tconst productId = response?.data;\r\n\t\t\tif (productId)\r\n\t\t\t{\r\n\t\t\t\tthis.selectScannedBarcodeProduct(productId);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tthis.searchByBarcode(barcode);\r\n\t\t\t}\r\n\t\t\tthis.getNameInput().value = Text.encode(barcode);\r\n\t\t});\r\n\t}\r\n\r\n\tselectScannedBarcodeProduct(productId)\r\n\t{\r\n\t\tthis.toggleIcon(this.getSearchIcon(), 'none');\r\n\t\tthis.clearErrors();\r\n\t\tif (this.selector)\r\n\t\t{\r\n\t\t\tthis.selector.onProductSelect(\r\n\t\t\t\tproductId,\r\n\t\t\t\t{\r\n\t\t\t\t\tisNew: false,\r\n\t\t\t\t\timmutableFields: [],\r\n\t\t\t\t}\r\n\t\t\t);\r\n\r\n\t\t\tthis.selector.clearLayout();\r\n\t\t\tthis.selector.layout();\r\n\t\t}\r\n\r\n\t\tthis.cache.delete('dialog');\r\n\t}\r\n\r\n\tgetBarcodeIcon(): HTMLElement\r\n\t{\r\n\t\treturn this.cache.remember('barcodeIcon', () => {\r\n\t\t\tconst barcodeIcon = Tag.render`\r\n\t\t\t\t<button\tclass=\"ui-ctl-before warehouse-barcode-icon\" title=\"${Loc.getMessage('CATALOG_SELECTOR_BARCODE_ICON_TITLE')}\"></button>\r\n\t\t\t`;\r\n\r\n\t\t\tif (\r\n\t\t\t\t!this.settingsCollection.get('isShowedBarcodeSpotlightInfo')\r\n\t\t\t\t&& this.settingsCollection.get('isAllowedShowBarcodeSpotlightInfo')\r\n\t\t\t\t&& this.selector.getConfig('ENABLE_INFO_SPOTLIGHT', true)\r\n\t\t\t)\r\n\t\t\t{\r\n\t\t\t\tthis.spotlight = new BX.SpotLight(\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tid: 'selector_barcode_scanner_info',\r\n\t\t\t\t\t\ttargetElement: barcodeIcon,\r\n\t\t\t\t\t\tautoSave: true,\r\n\t\t\t\t\t\ttargetVertex: \"middle-center\",\r\n\t\t\t\t\t\tzIndex: 200\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\r\n\t\t\t\tthis.spotlight.show();\r\n\r\n\t\t\t\tEventEmitter.subscribe(this.spotlight, 'BX.SpotLight:onTargetEnter', () => {\r\n\t\t\t\t\tconst guide = new Guide({\r\n\t\t\t\t\t\tsteps: [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\ttarget: barcodeIcon,\r\n\t\t\t\t\t\t\t\ttitle: Loc.getMessage('CATALOG_SELECTOR_BARCODE_SCANNER_FIRST_TIME_HINT_TITLE'),\r\n\t\t\t\t\t\t\t\ttext: Loc.getMessage('CATALOG_SELECTOR_BARCODE_SCANNER_FIRST_TIME_HINT_TEXT'),\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t\tonEvents: true,\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tguide.getPopup().setAutoHide(true);\r\n\t\t\t\t\tguide.showNextStep();\r\n\t\t\t\t\tthis.selector.setConfig('ENABLE_INFO_SPOTLIGHT', false);\r\n\t\t\t\t\tthis.selector.emit('onSpotlightClose', {});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tEvent.bind(barcodeIcon, 'click', (event) => {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tif (this.qrAuth)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.handleClickNameInput(event);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.startMobileScanner(event);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn barcodeIcon;\r\n\t\t});\r\n\t}\r\n\r\n\tlayout(): HTMLElement\r\n\t{\r\n\t\tconst block = super.layout();\r\n\t\tDom.append(this.getBarcodeIcon(), block);\r\n\t\tthis.getNameInput().className += ' catalog-product-field-input-barcode';\r\n\t\tEvent.bind(this.getNameInput(), 'focus', this.onFocusHandler);\r\n\t\tEvent.bind(this.getNameInput(), 'blur', this.onBlurHandler);\r\n\r\n\t\treturn block;\r\n\t}\r\n\r\n\tremoveSpotlight()\r\n\t{\r\n\t\tif (this.spotlight)\r\n\t\t{\r\n\t\t\tthis.spotlight.close();\r\n\t\t}\r\n\t}\r\n\r\n\tremoveQrAuth()\r\n\t{\r\n\t\tconst mobilePopup = this.getDialog().getContainer()?.querySelector('[data-role=\"mobile-popup\"]');\r\n\t\tif (mobilePopup)\r\n\t\t{\r\n\t\t\tDom.remove(mobilePopup);\r\n\t\t\tif (Dom.hasClass(this.getDialog().getContainer(), 'qr-barcode-info'))\r\n\t\t\t{\r\n\t\t\t\tDom.removeClass(this.getDialog().getContainer(),'qr-barcode-info');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.qrAuth = null;\r\n\t}\r\n}\r\n","import { ajax, Cache, Dom, Extension, Loc, Reflection, Runtime, Tag, Text, Type } from 'main.core';\r\nimport 'ui.design-tokens';\r\nimport 'ui.forms';\r\nimport 'fileinput';\r\nimport 'ui.notification';\r\nimport { EventEmitter } from 'main.core.events';\r\nimport { SkuTree } from 'catalog.sku-tree';\r\nimport { ProductSearchInput } from './product-search-input';\r\nimport { ProductImageInput } from './product-image-input';\r\nimport { ProductModel, RightActionDictionary } from 'catalog.product-model';\r\nimport './component.css';\r\nimport { BarcodeSearchInput } from './barcode-search-input';\r\nimport { SelectorErrorCode } from './selector-error-code';\r\n\r\nconst instances = new Map();\r\nconst iblockSkuTreeProperties = new Map();\r\n\r\nexport class ProductSelector extends EventEmitter\r\n{\r\n\tstatic MODE_VIEW = 'view';\r\n\tstatic MODE_EDIT = 'edit';\r\n\tstatic SHORT_VIEW_FORMAT = 'short';\r\n\tstatic FULL_VIEW_FORMAT = 'full';\r\n\tstatic INPUT_FIELD_NAME = 'NAME';\r\n\tstatic INPUT_FIELD_BARCODE = 'BARCODE';\r\n\r\n\tstatic ErrorCodes = SelectorErrorCode;\r\n\tstatic UIInputRequest = null;\r\n\t#inAjaxProcess = false;\r\n\tmode: ProductSelector.MODE_EDIT | ProductSelector.MODE_VIEW = ProductSelector.MODE_EDIT;\r\n\tcache = new Cache.MemoryCache();\r\n\ttype = ProductSelector.INPUT_FIELD_NAME;\r\n\tfileInput: ?ProductImageInput;\r\n\tsearchInput: ?ProductSearchInput;\r\n\tskuTreeInstance: ?SkuTree;\r\n\tmobileScannerToken = null;\r\n\r\n\tvariationChangeHandler = this.handleVariationChange.bind(this);\r\n\tonSaveImageHandler = this.onSaveImage.bind(this);\r\n\tonChangeFieldsHandler = Runtime.debounce(this.onChangeFields, 500, this);\r\n\tonUploaderIsInitedHandler = this.onUploaderIsInited.bind(this);\r\n\tonNameChangeFieldHandler = Runtime.debounce(this.onNameChange, 500, this);\r\n\r\n\tstatic getById(id: string): ?ProductSelector\r\n\t{\r\n\t\treturn instances.get(id) || null;\r\n\t}\r\n\r\n\tconstructor(id, options = {})\r\n\t{\r\n\t\tsuper();\r\n\t\tthis.setEventNamespace('BX.Catalog.ProductSelector');\r\n\r\n\t\tthis.id = id || Text.getRandom();\r\n\t\toptions.inputFieldName = options.inputFieldName || ProductSelector.INPUT_FIELD_NAME;\r\n\t\tthis.options = options || {};\r\n\t\tthis.settings = Extension.getSettings('catalog.product-selector');\r\n\r\n\t\tthis.type = this.options.type || ProductSelector.INPUT_FIELD_NAME;\r\n\r\n\t\tthis.setMode(options.mode);\r\n\r\n\t\tif (options.model && (options.model instanceof ProductModel))\r\n\t\t{\r\n\t\t\tthis.model = options.model;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.model = ProductModel.getById(this.id);\r\n\t\t}\r\n\r\n\t\tif (!(this.model instanceof ProductModel))\r\n\t\t{\r\n\t\t\tthis.model = new ProductModel(\r\n\t\t\t\t{\r\n\t\t\t\t\tcurrency: options.currency,\r\n\t\t\t\t\tiblockId: Text.toNumber(options.iblockId),\r\n\t\t\t\t\tbasePriceId: Text.toNumber(options.basePriceId),\r\n\t\t\t\t\tfields: options.fields,\r\n\t\t\t\t\tskuTree: options.skuTree,\r\n\t\t\t\t\tstoreMap: options.storeMap,\r\n\t\t\t\t},\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tthis.model.getImageCollection().setMorePhotoValues(options.morePhotoValues);\r\n\t\tif (!Type.isNil(this.getConfig('DETAIL_PATH')))\r\n\t\t{\r\n\t\t\tthis.model.setDetailPath(this.getConfig('DETAIL_PATH'));\r\n\t\t}\r\n\r\n\t\tif (options.failedProduct)\r\n\t\t{\r\n\t\t\tthis.model.getErrorCollection().setError(\r\n\t\t\t\tSelectorErrorCode.FAILED_PRODUCT,\r\n\t\t\t\t'',\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tif (this.isShowableEmptyProductError())\r\n\t\t{\r\n\t\t\tthis.model.getErrorCollection().setError(\r\n\t\t\t\tSelectorErrorCode.NOT_SELECTED_PRODUCT,\r\n\t\t\t\tthis.getEmptySelectErrorMessage(),\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tif (options.fileView)\r\n\t\t{\r\n\t\t\tthis.model.getImageCollection().setPreview(options.fileView);\r\n\t\t}\r\n\r\n\t\tif (options.fileInput)\r\n\t\t{\r\n\t\t\tthis.model.getImageCollection().setEditInput(options.fileInput);\r\n\t\t}\r\n\r\n\t\tthis.layout();\r\n\r\n\t\tif (options.skuTree)\r\n\t\t{\r\n\t\t\tthis.updateSkuTree(options.skuTree);\r\n\t\t}\r\n\r\n\t\tif (options.scannerToken)\r\n\t\t{\r\n\t\t\tthis.setMobileScannerToken(options.scannerToken);\r\n\t\t}\r\n\r\n\t\tthis.subscribeEvents();\r\n\r\n\t\tinstances.set(this.id, this);\r\n\t}\r\n\r\n\tsetModel(model: ProductModel): void\r\n\t{\r\n\t\tthis.model = model;\r\n\t}\r\n\r\n\tgetModel(): ProductModel\r\n\t{\r\n\t\treturn this.model;\r\n\t}\r\n\r\n\tsetMode(mode: ProductSelector.MODE_VIEW | ProductSelector.MODE_EDIT): void\r\n\t{\r\n\t\tif (!Type.isNil(mode))\r\n\t\t{\r\n\t\t\tthis.mode = mode === ProductSelector.MODE_VIEW ? ProductSelector.MODE_VIEW : ProductSelector.MODE_EDIT;\r\n\t\t}\r\n\t}\r\n\r\n\tisViewMode(): boolean\r\n\t{\r\n\t\treturn this.mode === ProductSelector.MODE_VIEW;\r\n\t}\r\n\r\n\tisShortViewFormat(): boolean\r\n\t{\r\n\t\treturn this.getConfig('VIEW_FORMAT', ProductSelector.FULL_VIEW_FORMAT) === ProductSelector.SHORT_VIEW_FORMAT;\r\n\t}\r\n\r\n\tisSaveable(): boolean\r\n\t{\r\n\t\treturn !this.isViewMode() && this.model.isSaveable();\r\n\t}\r\n\r\n\tisEnabledAutosave(): boolean\r\n\t{\r\n\t\treturn this.isSaveable() && this.getConfig('ENABLE_AUTO_SAVE', false);\r\n\t}\r\n\r\n\tisEnabledMobileScanning(): boolean\r\n\t{\r\n\t\treturn !this.isViewMode() && this.getConfig('ENABLE_MOBILE_SCANNING', true);\r\n\t}\r\n\r\n\tgetEmptySelectErrorMessage()\r\n\t{\r\n\t\treturn this.checkProductAddRights()\r\n\t\t\t? Loc.getMessage('CATALOG_SELECTOR_SELECTED_PRODUCT_TITLE')\r\n\t\t\t: Loc.getMessage('CATALOG_SELECTOR_SELECT_PRODUCT_TITLE')\r\n\t\t;\r\n\t}\r\n\r\n\tgetMobileScannerToken(): string\r\n\t{\r\n\t\treturn this.mobileScannerToken || Text.getRandom(16);\r\n\t}\r\n\r\n\tcheckProductViewRights(): boolean\r\n\t{\r\n\t\treturn this.model.checkAccess(RightActionDictionary.ACTION_PRODUCT_VIEW) ?? true;\r\n\t}\r\n\r\n\tcheckProductEditRights(): boolean\r\n\t{\r\n\t\treturn this.model.checkAccess(RightActionDictionary.ACTION_PRODUCT_EDIT) ?? false;\r\n\t}\r\n\r\n\tcheckProductAddRights(): boolean\r\n\t{\r\n\t\treturn this.model.checkAccess(RightActionDictionary.ACTION_PRODUCT_ADD) ?? false;\r\n\t}\r\n\r\n\tsetMobileScannerToken(token: string): void\r\n\t{\r\n\t\tthis.mobileScannerToken = token;\r\n\t}\r\n\r\n\tremoveMobileScannerToken(): void\r\n\t{\r\n\t\tthis.mobileScannerToken = null;\r\n\t}\r\n\r\n\tgetId(): string\r\n\t{\r\n\t\treturn this.id;\r\n\t}\r\n\r\n\tgetType(): string\r\n\t{\r\n\t\treturn this.type;\r\n\t}\r\n\r\n\tgetConfig(name, defaultValue)\r\n\t{\r\n\t\treturn BX.prop.get(this.options.config, name, defaultValue);\r\n\t}\r\n\r\n\tsetConfig(name, value): this\r\n\t{\r\n\t\tthis.options.config[name] = value;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tgetRowId(): string\r\n\t{\r\n\t\treturn this.getConfig('ROW_ID');\r\n\t}\r\n\r\n\tgetFileInput(): ProductImageInput\r\n\t{\r\n\t\tif (!this.fileInput)\r\n\t\t{\r\n\t\t\tthis.fileInput = new ProductImageInput(\r\n\t\t\t\tthis.options.fileInputId,\r\n\t\t\t\t{\r\n\t\t\t\t\tselector: this,\r\n\t\t\t\t\tenableSaving: this.getConfig('ENABLE_IMAGE_CHANGE_SAVING', false),\r\n\t\t\t\t},\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\treturn this.fileInput;\r\n\t}\r\n\r\n\tisProductSearchEnabled(): boolean\r\n\t{\r\n\t\treturn this.getConfig('ENABLE_SEARCH', false)\r\n\t\t\t&& this.model.getIblockId() > 0\r\n\t\t\t&& this.checkProductViewRights()\r\n\t\t;\r\n\t}\r\n\r\n\tisSkuTreeEnabled(): boolean\r\n\t{\r\n\t\treturn this.getConfig('ENABLE_SKU_TREE', true) !== false;\r\n\t}\r\n\r\n\tisImageFieldEnabled(): boolean\r\n\t{\r\n\t\treturn this.getConfig('ENABLE_IMAGE_INPUT', true) !== false;\r\n\t}\r\n\r\n\tisShowableEmptyProductError(): boolean\r\n\t{\r\n\t\tconst emptyChanged = this.model.isEmpty() && this.model.isChanged();\r\n\r\n\t\treturn this.isEnabledEmptyProductError() && (emptyChanged || this.model.isSimple());\r\n\t}\r\n\r\n\tisShowableErrors(): boolean\r\n\t{\r\n\t\treturn this.isEnabledEmptyProductError() || this.isEnabledEmptyImagesError();\r\n\t}\r\n\r\n\tisEnabledEmptyProductError(): boolean\r\n\t{\r\n\t\treturn this.getConfig('ENABLE_EMPTY_PRODUCT_ERROR', false);\r\n\t}\r\n\r\n\tisEnabledEmptyImagesError(): boolean\r\n\t{\r\n\t\treturn this.getConfig('ENABLE_EMPTY_IMAGES_ERROR', false);\r\n\t}\r\n\r\n\tisEnabledChangesRendering(): boolean\r\n\t{\r\n\t\treturn this.getConfig('ENABLE_CHANGES_RENDERING', true);\r\n\t}\r\n\r\n\tisInputDetailLinkEnabled(): boolean\r\n\t{\r\n\t\treturn this.getConfig('ENABLE_INPUT_DETAIL_LINK', false)\r\n\t\t\t&& Type.isStringFilled(this.model.getDetailPath())\r\n\t\t\t&& this.checkProductViewRights()\r\n\t\t;\r\n\t}\r\n\r\n\tgetWrapper(): HTMLElement\r\n\t{\r\n\t\tif (!this.wrapper)\r\n\t\t{\r\n\t\t\tthis.wrapper = document.getElementById(this.id);\r\n\t\t}\r\n\r\n\t\treturn this.wrapper;\r\n\t}\r\n\r\n\trenderTo(node)\r\n\t{\r\n\t\tthis.clearLayout();\r\n\t\tthis.wrapper = node;\r\n\t\tthis.layout();\r\n\t}\r\n\r\n\tlayout()\r\n\t{\r\n\t\tconst wrapper = this.getWrapper();\r\n\t\tif (!wrapper)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.defineWrapperClass(wrapper);\r\n\t\twrapper.innerHTML = '';\r\n\r\n\t\tconst block = Tag.render`<div class=\"catalog-product-field-inner\"></div>`;\r\n\t\tDom.append(this.layoutNameBlock(), block);\r\n\r\n\t\tif (this.getSkuTreeInstance())\r\n\t\t{\r\n\t\t\tDom.append(this.getSkuTreeInstance().layout(), block);\r\n\t\t}\r\n\r\n\t\tDom.append(this.getErrorContainer(), block);\r\n\r\n\t\tif (!this.isViewMode())\r\n\t\t{\r\n\t\t\tDom.append(block, wrapper);\r\n\t\t}\r\n\r\n\t\tif (this.isImageFieldEnabled())\r\n\t\t{\r\n\t\t\tif (Reflection.getClass('BX.UI.ImageInput'))\r\n\t\t\t{\r\n\t\t\t\tthis.layoutImage();\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tif (ProductSelector.UIInputRequest instanceof Promise)\r\n\t\t\t\t{\r\n\t\t\t\t\tProductSelector.UIInputRequest.then(() => {\r\n\t\t\t\t\t\tthis.layoutImage();\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tProductSelector.UIInputRequest = new Promise(resolve => {\r\n\t\t\t\t\t\tajax\r\n\t\t\t\t\t\t\t.runAction(\r\n\t\t\t\t\t\t\t\t'catalog.productSelector.getFileInput',\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tjson: {\r\n\t\t\t\t\t\t\t\t\t\tiblockId: this.getModel().getIblockId(),\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\t\t\tthis.layoutImage();\r\n\t\t\t\t\t\t\t\tProductSelector.UIInputRequest = null;\r\n\t\t\t\t\t\t\t\tresolve();\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tDom.append(this.getImageContainer(), wrapper);\r\n\t\t}\r\n\r\n\t\tif (this.isViewMode())\r\n\t\t{\r\n\t\t\tDom.append(block, wrapper);\r\n\t\t}\r\n\r\n\t\tif (this.isViewMode())\r\n\t\t{\r\n\t\t\tDom.append(block, wrapper);\r\n\t\t}\r\n\r\n\t\tif (this.isShowableErrors)\r\n\t\t{\r\n\t\t\tthis.layoutErrors();\r\n\t\t}\r\n\r\n\t\tthis.subscribeToVariationChange();\r\n\t}\r\n\r\n\tfocusName(): this\r\n\t{\r\n\t\tif (this.searchInput)\r\n\t\t{\r\n\t\t\tthis.searchInput.focusName();\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tgetImageContainer(): HTMLElement\r\n\t{\r\n\t\treturn this.cache.remember('imageContainer', () => (\r\n\t\t\tTag.render`<div class=\"catalog-product-img\"></div>`\r\n\t\t));\r\n\t}\r\n\r\n\tgetErrorContainer(): HTMLElement\r\n\t{\r\n\t\treturn this.cache.remember('errorContainer', () => (\r\n\t\t\tTag.render`<div class=\"catalog-product-error\"></div>`\r\n\t\t));\r\n\t}\r\n\r\n\tlayoutErrors()\r\n\t{\r\n\t\tthis.getErrorContainer().innerHTML = '';\r\n\t\tthis.clearImageErrorBorder();\r\n\t\tif (!this.model.getErrorCollection().hasErrors())\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst errors = this.model.getErrorCollection().getErrors();\r\n\t\tfor (const code in errors)\r\n\t\t{\r\n\t\t\tif (!ProductSelector.ErrorCodes.getCodes().includes(code))\r\n\t\t\t{\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif (code === 'EMPTY_IMAGE')\r\n\t\t\t{\r\n\t\t\t\tthis.setImageErrorBorder();\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tDom.append(\r\n\t\t\t\t\tTag.render`<div class=\"catalog-product-error-item\">${errors[code].text}</div>`,\r\n\t\t\t\t\tthis.getErrorContainer(),\r\n\t\t\t\t);\r\n\r\n\t\t\t\tif (this.searchInput)\r\n\t\t\t\t{\r\n\t\t\t\t\tDom.addClass(this.searchInput.getNameBlock(), 'ui-ctl-danger');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tsetImageErrorBorder()\r\n\t{\r\n\t\tDom.addClass(\r\n\t\t\tthis.getImageContainer().querySelector('.adm-fileinput-area'),\r\n\t\t\t'adm-fileinput-drag-area-error',\r\n\t\t);\r\n\t}\r\n\r\n\tclearImageErrorBorder()\r\n\t{\r\n\t\tDom.removeClass(\r\n\t\t\tthis.getImageContainer().querySelector('.adm-fileinput-area'),\r\n\t\t\t'adm-fileinput-drag-area-error',\r\n\t\t);\r\n\t}\r\n\r\n\tonUploaderIsInited()\r\n\t{\r\n\t\tif (this.isEnabledEmptyImagesError())\r\n\t\t{\r\n\t\t\trequestAnimationFrame(this.layoutErrors.bind(this));\r\n\t\t}\r\n\t}\r\n\r\n\tlayoutImage()\r\n\t{\r\n\t\tthis.getImageContainer().innerHTML = '';\r\n\t\tDom.append(this.getFileInput().layout(), this.getImageContainer());\r\n\t\tthis.refreshImageSelectorId = null;\r\n\t}\r\n\r\n\tclearState(): void\r\n\t{\r\n\t\tthis\r\n\t\t\t.getModel()\r\n\t\t\t.initFields({\r\n\t\t\t\tID: '',\r\n\t\t\t\tNAME: '',\r\n\t\t\t\tBARCODE: '',\r\n\t\t\t\tPRODUCT_ID: null,\r\n\t\t\t\tSKU_ID: null,\r\n\t\t\t})\r\n\t\t\t.setOption('isNew', false)\r\n\t\t;\r\n\r\n\t\tthis\r\n\t\t\t.getFileInput()\r\n\t\t\t.restoreDefaultInputHtml()\r\n\t\t;\r\n\r\n\t\tthis\r\n\t\t\t.getModel()\r\n\t\t\t.clearSkuTree()\r\n\t\t;\r\n\t\tthis.skuTreeInstance = null;\r\n\r\n\t\tthis\r\n\t\t\t.getModel()\r\n\t\t\t.getStoreCollection()\r\n\t\t\t.clear()\r\n\t\t;\r\n\t}\r\n\r\n\tclearLayout(): void\r\n\t{\r\n\t\tthis.unsubscribeToVariationChange();\r\n\t\tconst wrapper = this.getWrapper();\r\n\t\tif (wrapper)\r\n\t\t{\r\n\t\t\twrapper.innerHTML = '';\r\n\t\t}\r\n\t}\r\n\r\n\tsubscribeEvents()\r\n\t{\r\n\t\tEventEmitter.incrementMaxListeners('ProductList::onChangeFields', 1);\r\n\t\tEventEmitter.incrementMaxListeners('ProductSelector::onNameChange', 1);\r\n\t\tEventEmitter.incrementMaxListeners('Catalog.ImageInput::save', 1);\r\n\t\tEventEmitter.incrementMaxListeners('onUploaderIsInited', 1);\r\n\r\n\t\tEventEmitter.subscribe('ProductList::onChangeFields', this.onChangeFieldsHandler);\r\n\t\tEventEmitter.subscribe('ProductSelector::onNameChange', this.onNameChangeFieldHandler);\r\n\t\tEventEmitter.subscribe('Catalog.ImageInput::save', this.onSaveImageHandler);\r\n\t\tEventEmitter.subscribe('onUploaderIsInited', this.onUploaderIsInitedHandler);\r\n\t}\r\n\r\n\tunsubscribeEvents()\r\n\t{\r\n\t\tthis.unsubscribeToVariationChange();\r\n\r\n\t\tEventEmitter.unsubscribe('Catalog.ImageInput::save', this.onSaveImageHandler);\r\n\t\tEventEmitter.unsubscribe('ProductList::onChangeFields', this.onChangeFieldsHandler);\r\n\t\tEventEmitter.unsubscribe('onUploaderIsInited', this.onUploaderIsInitedHandler);\r\n\t\tEventEmitter.unsubscribe('onUploaderIsInited', this.onUploaderIsInitedHandler);\r\n\t\tEventEmitter.unsubscribe('ProductSelector::onNameChange', this.onNameChangeFieldHandler);\r\n\t}\r\n\r\n\tdefineWrapperClass(wrapper)\r\n\t{\r\n\t\tif (this.isViewMode())\r\n\t\t{\r\n\t\t\tDom.addClass(wrapper, 'catalog-product-view');\r\n\t\t\tDom.removeClass(wrapper, 'catalog-product-edit');\r\n\r\n\t\t\tif (this.isShortViewFormat())\r\n\t\t\t{\r\n\t\t\t\tDom.addClass(wrapper, '--short-format');\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tDom.addClass(wrapper, 'catalog-product-edit');\r\n\t\t\tDom.removeClass(wrapper, 'catalog-product-view');\r\n\t\t}\r\n\r\n\t\tif (this.isImageFieldEnabled())\r\n\t\t{\r\n\t\t\tDom.addClass(wrapper, '--with-images');\r\n\t\t}\r\n\t}\r\n\r\n\tgetNameBlockView(): HTMLElement\r\n\t{\r\n\t\tconst productName = Text.encode(this.model.getField('NAME'));\r\n\t\tconst namePlaceholder = Loc.getMessage('CATALOG_SELECTOR_VIEW_NAME_TITLE');\r\n\r\n\t\tif (this.getModel().getDetailPath())\r\n\t\t{\r\n\t\t\treturn Tag.render`\r\n\t\t\t\t<a href=\"${this.getModel().getDetailPath()}\" title=\"${namePlaceholder}\">${productName}</a>\r\n\t\t\t`;\r\n\t\t}\r\n\r\n\t\treturn Tag.render`<span title=\"${namePlaceholder}\">${productName}</span>`;\r\n\t}\r\n\r\n\tgetNameInputFilledValue(): string\r\n\t{\r\n\t\tif (this.searchInput)\r\n\t\t{\r\n\t\t\treturn this.searchInput.getFilledValue();\r\n\t\t}\r\n\r\n\t\treturn '';\r\n\t}\r\n\r\n\tlayoutNameBlock(): HTMLElement\r\n\t{\r\n\t\tconst block = Tag.render`<div class=\"catalog-product-field-input\"></div>`;\r\n\r\n\t\tif (this.isViewMode())\r\n\t\t{\r\n\t\t\tDom.append(this.getNameBlockView(), block);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tif (this.getType() === ProductSelector.INPUT_FIELD_BARCODE)\r\n\t\t\t{\r\n\t\t\t\tif (!this.searchInput)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.searchInput = new BarcodeSearchInput(\r\n\t\t\t\t\t\tthis.id,\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tselector: this,\r\n\t\t\t\t\t\t\tmodel: this.getModel(),\r\n\t\t\t\t\t\t\tinputName: this.options.inputFieldName,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tthis.searchInput = new ProductSearchInput(\r\n\t\t\t\t\tthis.id,\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tselector: this,\r\n\t\t\t\t\t\tmodel: this.getModel(),\r\n\t\t\t\t\t\tinputName: this.options.inputFieldName,\r\n\t\t\t\t\t\tisSearchEnabled: this.isProductSearchEnabled(),\r\n\t\t\t\t\t\tisEnabledEmptyProductError: this.isEnabledEmptyProductError(),\r\n\t\t\t\t\t\tisEnabledDetailLink: this.isInputDetailLinkEnabled(),\r\n\t\t\t\t\t},\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\tDom.append(this.searchInput.layout(), block);\r\n\t\t}\r\n\r\n\t\treturn block;\r\n\t}\r\n\r\n\tsearchInDialog(): ProductSelector\r\n\t{\r\n\t\tthis.searchInput.searchInDialog();\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tupdateSkuTree(tree): ProductSelector\r\n\t{\r\n\t\tthis.getModel().setSkuTree(tree);\r\n\t\tthis.skuTreeInstance = null;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tgetIblockSkuTreeProperties(): Promise\r\n\t{\r\n\t\treturn new Promise((resolve) => {\r\n\t\t\tif (iblockSkuTreeProperties.has(this.getModel().getIblockId()))\r\n\t\t\t{\r\n\t\t\t\tresolve(iblockSkuTreeProperties.get(this.getModel().getIblockId()));\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tajax\r\n\t\t\t\t\t.runAction(\r\n\t\t\t\t\t\t'catalog.productSelector.getSkuTreeProperties',\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tjson: {\r\n\t\t\t\t\t\t\t\tiblockId: this.getModel().getIblockId(),\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t)\r\n\t\t\t\t\t.then(response => {\r\n\t\t\t\t\t\tiblockSkuTreeProperties.set(this.getModel().getIblockId(), response);\r\n\t\t\t\t\t\tresolve(response);\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tgetSkuTreeInstance(): SkuTree\r\n\t{\r\n\t\tif (this.isSkuTreeEnabled() && this.getModel()?.getSkuTree() && !this.skuTreeInstance)\r\n\t\t{\r\n\t\t\tthis.skuTreeInstance = new SkuTree({\r\n\t\t\t\tskuTree: this.getModel().getSkuTree(),\r\n\t\t\t\tselectable: this.getConfig('ENABLE_SKU_SELECTION', true),\r\n\t\t\t\thideUnselected: this.getConfig('HIDE_UNSELECTED_ITEMS', false),\r\n\t\t\t\tisShortView: this.isViewMode() && this.isShortViewFormat(),\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn this.skuTreeInstance;\r\n\t}\r\n\r\n\tsubscribeToVariationChange()\r\n\t{\r\n\t\tconst skuTree = this.getSkuTreeInstance();\r\n\t\tif (skuTree)\r\n\t\t{\r\n\t\t\tthis.unsubscribeToVariationChange();\r\n\t\t\tskuTree.subscribe('SkuProperty::onChange', this.variationChangeHandler);\r\n\t\t}\r\n\t}\r\n\r\n\tunsubscribeToVariationChange()\r\n\t{\r\n\t\tconst skuTree = this.getSkuTreeInstance();\r\n\t\tif (skuTree)\r\n\t\t{\r\n\t\t\tskuTree.unsubscribe('SkuProperty::onChange', this.variationChangeHandler);\r\n\t\t}\r\n\t}\r\n\r\n\thandleVariationChange(event)\r\n\t{\r\n\t\tconst [skuFields] = event.getData();\r\n\t\tconst productId = Text.toNumber(skuFields.PARENT_PRODUCT_ID);\r\n\t\tconst variationId = Text.toNumber(skuFields.ID);\r\n\r\n\t\tif (productId <= 0 || variationId <= 0)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.emit('onBeforeChange', {\r\n\t\t\tselectorId: this.getId(),\r\n\t\t\trowId: this.getRowId(),\r\n\t\t});\r\n\r\n\t\tthis.#inAjaxProcess = true;\r\n\t\tajax\r\n\t\t\t.runAction(\r\n\t\t\t\t'catalog.productSelector.getSelectedSku',\r\n\t\t\t\t{\r\n\t\t\t\t\tjson: {\r\n\t\t\t\t\t\tvariationId,\r\n\t\t\t\t\t\toptions: {\r\n\t\t\t\t\t\t\tpriceId: this.basePriceId,\r\n\t\t\t\t\t\t\tcurrency: this.model.getCurrency(),\r\n\t\t\t\t\t\t\turlBuilder: this.getConfig('URL_BUILDER_CONTEXT'),\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t)\r\n\t\t\t.then(response => this.processResponse(response, { ...this.options.config }));\r\n\t}\r\n\r\n\tonChangeFields(event)\r\n\t{\r\n\t\tconst eventData = event.getData();\r\n\r\n\t\tif (eventData.rowId !== this.getRowId())\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst fields = eventData.fields;\r\n\t\tthis.getModel().setFields(fields);\r\n\t}\r\n\r\n\treloadFileInput()\r\n\t{\r\n\t\tajax\r\n\t\t\t.runAction(\r\n\t\t\t\t'catalog.productSelector.getFileInput',\r\n\t\t\t\t{\r\n\t\t\t\t\tjson: {\r\n\t\t\t\t\t\tiblockId: this.getModel().getIblockId(),\r\n\t\t\t\t\t\tskuId: this.getModel()?.getSkuId(),\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t)\r\n\t\t\t.then((event) => {\r\n\t\t\t\tthis.getModel().getImageCollection().setEditInput(event.data.html);\r\n\t\t\t\tif (this.isImageFieldEnabled())\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.layoutImage();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t}\r\n\r\n\tonNameChange(event)\r\n\t{\r\n\t\tconst eventData = event.getData();\r\n\r\n\t\tif (eventData.rowId !== this.getRowId() || !this.isEnabledAutosave())\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst fields = eventData.fields;\r\n\t\tthis.getModel().setFields(fields);\r\n\t\tthis.getModel().save().then(() => {\r\n\t\t\tBX.UI.Notification.Center.notify({\r\n\t\t\t\tid: 'saving_field_notify_name',\r\n\t\t\t\tcloseButton: false,\r\n\t\t\t\tcontent: Tag.render`<div>${Loc.getMessage('CATALOG_SELECTOR_SAVING_NOTIFICATION_NAME_CHANGED')}</div>`,\r\n\t\t\t\tautoHide: true,\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tonSaveImage(event)\r\n\t{\r\n\t\tconst [, inputId, response] = event.getData();\r\n\t\tif (inputId !== this.getFileInput().getId())\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.getFileInput().setId(response.data.id);\r\n\t\tthis.getFileInput().setInputHtml(response.data.input);\r\n\t\tthis.getFileInput().setView(response.data.preview);\r\n\t\tthis.getModel().getImageCollection().setMorePhotoValues(response.data.values);\r\n\t\tif (this.isImageFieldEnabled())\r\n\t\t{\r\n\t\t\tthis.layoutImage();\r\n\t\t}\r\n\r\n\t\tthis.emit('onChange', {\r\n\t\t\tselectorId: this.id,\r\n\t\t\trowId: this.getRowId(),\r\n\t\t\tfields: this.getModel().getFields(),\r\n\t\t\tmorePhoto: this.getModel().getImageCollection().getMorePhotoValues(),\r\n\t\t});\r\n\t}\r\n\r\n\tinProcess()\r\n\t{\r\n\t\treturn this.#inAjaxProcess;\r\n\t}\r\n\r\n\tonProductSelect(productId, itemConfig)\r\n\t{\r\n\t\tthis.emit('onProductSelect', {\r\n\t\t\tselectorId: this.getId(),\r\n\t\t\trowId: this.getRowId(),\r\n\t\t});\r\n\r\n\t\tthis.emit('onBeforeChange', {\r\n\t\t\tselectorId: this.getId(),\r\n\t\t\trowId: this.getRowId(),\r\n\t\t});\r\n\r\n\t\tthis.productSelectAjaxAction(productId, itemConfig);\r\n\t}\r\n\r\n\tproductSelectAjaxAction(\r\n\t\tproductId,\r\n\t\titemConfig = {\r\n\t\t\tisNew: false,\r\n\t\t\timmutableFields: [],\r\n\t\t},\r\n\t)\r\n\t{\r\n\t\tthis.#inAjaxProcess = true;\r\n\t\tajax\r\n\t\t\t.runAction(\r\n\t\t\t\t'catalog.productSelector.getProduct',\r\n\t\t\t\t{\r\n\t\t\t\t\tjson: {\r\n\t\t\t\t\t\tproductId,\r\n\t\t\t\t\t\toptions: {\r\n\t\t\t\t\t\t\tpriceId: this.basePriceId,\r\n\t\t\t\t\t\t\tcurrency: this.model.getCurrency(),\r\n\t\t\t\t\t\t\turlBuilder: this.getConfig('URL_BUILDER_CONTEXT'),\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t)\r\n\t\t\t.then(response => this.processResponse(response, { ...this.options.config, ...itemConfig }, true));\r\n\t}\r\n\r\n\tprocessResponse(response, config = {}, isProductAction = false)\r\n\t{\r\n\t\tconst data = response?.data || null;\r\n\t\tthis.#inAjaxProcess = false;\r\n\r\n\t\tconst fields = data?.fields || [];\r\n\t\tif (Type.isArray(config.immutableFields))\r\n\t\t{\r\n\t\t\tconfig.immutableFields.forEach((field) => {\r\n\t\t\t\tfields[field] = this.getModel().getField(field);\r\n\t\t\t});\r\n\r\n\t\t\tdata.fields = fields;\r\n\t\t}\r\n\r\n\t\tif (isProductAction)\r\n\t\t{\r\n\t\t\tthis.clearState();\r\n\t\t}\r\n\r\n\t\tif (data)\r\n\t\t{\r\n\t\t\tthis.changeSelectedElement(data, config);\r\n\t\t}\r\n\t\telse if (!isProductAction)\r\n\t\t{\r\n\t\t\tthis.productSelectAjaxAction(this.getModel().getProductId());\r\n\t\t}\r\n\r\n\t\tthis.unsubscribeToVariationChange();\r\n\r\n\t\tif (this.isEnabledChangesRendering())\r\n\t\t{\r\n\t\t\tthis.clearLayout();\r\n\t\t\tthis.layout();\r\n\t\t}\r\n\r\n\t\tthis.emit('onChange', {\r\n\t\t\tselectorId: this.id,\r\n\t\t\trowId: this.getRowId(),\r\n\t\t\tisNew: config.isNew || false,\r\n\t\t\tfields,\r\n\t\t\tmorePhoto: this.getModel().getImageCollection().getMorePhotoValues(),\r\n\t\t});\r\n\t}\r\n\r\n\tchangeSelectedElement(data, config)\r\n\t{\r\n\t\tconst productId = Text.toInteger(data.productId);\r\n\t\tconst productChanged = this.getModel().getProductId() !== productId;\r\n\r\n\t\tif (productChanged)\r\n\t\t{\r\n\t\t\tthis.getModel().setOption('productId', productId);\r\n\t\t\tthis.getModel().setOption('skuId', Text.toInteger(data.skuId));\r\n\t\t\tthis.getModel().setOption('isSimpleModel', false);\r\n\t\t\tthis.getModel().setOption('isNew', config.isNew);\r\n\t\t}\r\n\r\n\t\tthis.getModel().initFields(data.fields);\r\n\r\n\t\tconst imageField = {\r\n\t\t\tid: '',\r\n\t\t\tinput: '',\r\n\t\t\tpreview: '',\r\n\t\t\tvalues: [],\r\n\t\t};\r\n\r\n\t\tif (Type.isObject(data.image))\r\n\t\t{\r\n\t\t\timageField.id = data.image.id;\r\n\t\t\timageField.input = data.image.input;\r\n\t\t\timageField.preview = data.image.preview;\r\n\t\t\timageField.values = data.image.values;\r\n\t\t}\r\n\r\n\t\tthis.getFileInput().setId(imageField.id);\r\n\t\tthis.getFileInput().setInputHtml(imageField.input);\r\n\t\tthis.getFileInput().setView(imageField.preview);\r\n\r\n\t\tthis.getModel().getImageCollection().setMorePhotoValues(imageField.values);\r\n\t\tthis.checkEmptyImageError();\r\n\r\n\t\tif (data.detailUrl)\r\n\t\t{\r\n\t\t\tthis.getModel().setDetailPath(data.detailUrl);\r\n\t\t}\r\n\r\n\t\tif (Type.isObject(data.skuTree))\r\n\t\t{\r\n\t\t\tthis.updateSkuTree(data.skuTree);\r\n\t\t}\r\n\t}\r\n\r\n\tcheckEmptyImageError()\r\n\t{\r\n\t\tif (\r\n\t\t\t!Type.isArrayFilled(this.getModel().getImageCollection().getMorePhotoValues())\r\n\t\t\t&& this.isEnabledEmptyImagesError()\r\n\t\t)\r\n\t\t{\r\n\t\t\tthis.getModel().getErrorCollection().setError(\r\n\t\t\t\t'EMPTY_IMAGE',\r\n\t\t\t\tLoc.getMessage('CATALOG_SELECTOR_EMPTY_IMAGE_ERROR'),\r\n\t\t\t);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.getModel().getErrorCollection().removeError('EMPTY_IMAGE');\r\n\t\t}\r\n\t}\r\n\r\n\tremoveSpotlight()\r\n\t{\r\n\t\tthis.searchInput?.removeSpotlight();\r\n\t\tthis.setConfig('ENABLE_INFO_SPOTLIGHT', false);\r\n\t}\r\n\r\n\tremoveQrAuth()\r\n\t{\r\n\t\tthis.searchInput?.removeQrAuth();\r\n\t\tthis.setConfig('ENABLE_BARCODE_QR_AUTH', false);\r\n\t}\r\n}\r\n"],"names":["ProductSearchSelectorFooter","dialog","options","loader","errorAdminHint","getDialog","subscribe","handleOnSearch","bind","getContent","phrase","isViewCreateButton","allowCreateItem","allowEditItem","isViewEditButton","Tag","render","Loc","getMessage","createButton","querySelector","Dom","replace","getLabelContainer","changeButton","getSaveContainer","getHintContainer","getLoaderContainer","getLoader","Type","isNil","Loader","target","size","color","showLoader","show","hideLoader","hide","setLabel","label","isString","textContent","cache","remember","handleClick","getOption","getQueryContainer","className","messageId","inputName","ProductSelector","INPUT_FIELD_BARCODE","onClickSaveChanges","message","hintNode","dataset","hint","hintNoIcon","BX","UI","Hint","initNode","lastQuery","getActiveTab","getLastSearchQuery","emit","query","clearSearch","createItem","tagSelector","getTagSelector","isLocked","finalize","unlock","focusSearch","event","preventDefault","lock","emitAsync","searchQuery","then","getTab","clearResults","selectFirstTab","catch","getData","currentValue","DefaultFooter","ProductCreationLimitedFooter","infoButton","Event","InfoHelper","SelectorErrorCode","getCodes","NOT_SELECTED_PRODUCT","FAILED_PRODUCT","DialogMode","SEARCHING","SHOW_PRODUCT_ITEM","SHOW_RECENT","ProductSearchInput","id","Cache","MemoryCache","Text","getRandom","selector","Error","model","isEnabledSearch","isSearchEnabled","isEnabledDetailLink","INPUT_FIELD_NAME","immutableFieldNames","includes","push","ajaxInProcess","loadedSelectedItem","handleSearchInput","Runtime","debounce","searchInDialog","destroy","getId","getSelectorType","getField","fieldName","getValue","getFilledValue","getNameInput","value","toggleIcon","icon","isDomNode","style","getNameBlock","getNameTag","getHiddenNameInput","isNew","input","encode","getPlaceholder","handleNameInputHiddenChange","getConfig","addClass","setAttribute","getClearIcon","handleClearIconClick","getArrowIcon","getDetailPath","getSearchIcon","handleSearchIconClick","layout","clearInputCache","block","append","isProductSearchEnabled","initHasDialogItems","isStringFilled","handleClickNameInput","handleNameInputBlur","handleNameInputKeyDown","dialogMode","isCatalogExisted","showDetailLink","handleIconsSwitchingOnNameInput","handleNameInputChange","searchTypeId","SEARCH_TYPE_ID","entity","iblockId","getIblockId","basePriceId","getBasePriceId","currency","getCurrency","filters","controller","_model","dynamicLoad","dynamicSearch","restrictedProductTypes","params","height","width","Math","max","offsetWidth","context","targetNode","enableSearch","multiple","dropdownMode","searchTabOptions","stub","stubOptions","title","subtitle","isAllowedCreateProduct","arrow","events","onProductSelect","createProduct","showChangeNotification","entities","settingsCollection","Extension","getSettings","isObject","get","footer","footerOptions","isAllowedEditProduct","creationLabel","searchOptions","Dialog","getModel","isEmpty","setConfig","hasDynamicLoad","subscribeOnce","getPreselectedItems","length","checkProductAddRights","checkProductEditRights","key","getSearchTab","stopPropagation","Browser","isMac","metaKey","ctrlKey","getFooter","delete","selectorId","rowId","getRowId","clearState","clearLayout","newValue","onChangeValue","focusName","fields","EventEmitter","isEnabledAutosave","setFields","save","Notification","Center","notify","closeButton","content","autoHide","requestAnimationFrame","focus","trim","isHasDialogItems","isSearchingInProcess","isOpen","showItems","setTimeout","isEnabledEmptyProductError","inProcess","getErrorCollection","setError","getEmptySelectErrorMessage","layoutErrors","getImmutableFieldNames","setInputValueOnProductSelect","item","getTargetNode","getTitle","clearErrors","getCustomData","immutableFields","forEach","setField","errors","getErrors","code","ErrorCodes","removeError","createProductModelFromSearchQuery","getFields","ProductModel","isSimpleModel","getTarget","newProduct","getQuery","Promise","resolve","reject","checkCreationModel","response","toInteger","data","addItem","entityId","tabs","getRecentTab","customData","setOption","name","select","errorResponse","error","creationModel","getType","onSave","declineCancelTitle","onCancel","showSaveNotifier","removeSpotlight","removeQrAuth","removeItems","ajax","runAction","json","getSkuId","isLoading","setPreselectedItems","getRootNode","getPopup","loadState","load","search","ProductImageInput","config","getImageCollection","getEditInput","restoreDefaultInputHtml","enableSaving","uploaderFieldMap","setId","setView","html","setPreview","setInputHtml","setEditInput","defaultInput","isViewMode","isSaveable","isEnabledLiveSaving","imageContainer","getPreview","BarcodeSearchSelectorFooter","isEmptyBarcode","handleOnSearchLoad","barcodeContent","scannerContent","getScannerContent","getScannerLabelContainer","handleScannerClick","getScannerQueryContainer","inputEntity","startMobileScanner","searchTab","getItems","BarcodeSearchInput","onFocusHandler","handleFocusEvent","onBlurHandler","handleBlurEvent","focused","isInstalledMobileApp","qrAuth","QrAuthorization","createQrCodeImage","unbind","searchFields","type","system","searchable","preselectedItems","layoutMobileQrPopup","closeIcon","closeMobilePopup","sendButton","helpButton","top","Helper","getQrNode","result","userOptions","getContainer","hasClass","disableCancel","searchByBarcode","getSubtitle","getCreationProduct","sendMobilePush","isEnabledMobileScanning","token","getMobileScannerToken","BarcodeScanner","open","repeatLink","category","autoHideDelay","getProductIdByBarcode","barcode","applyScannerData","productId","selectScannedBarcodeProduct","getBarcodeIcon","barcodeIcon","spotlight","SpotLight","targetElement","autoSave","targetVertex","zIndex","guide","Guide","steps","text","onEvents","setAutoHide","showNextStep","close","mobilePopup","remove","removeClass","instances","Map","iblockSkuTreeProperties","getById","mode","MODE_EDIT","mobileScannerToken","variationChangeHandler","handleVariationChange","onSaveImageHandler","onSaveImage","onChangeFieldsHandler","onChangeFields","onUploaderIsInitedHandler","onUploaderIsInited","onNameChangeFieldHandler","onNameChange","setEventNamespace","inputFieldName","settings","setMode","toNumber","skuTree","storeMap","setMorePhotoValues","morePhotoValues","setDetailPath","failedProduct","isShowableEmptyProductError","fileView","fileInput","updateSkuTree","scannerToken","setMobileScannerToken","subscribeEvents","set","setModel","MODE_VIEW","isShortViewFormat","FULL_VIEW_FORMAT","SHORT_VIEW_FORMAT","checkProductViewRights","checkAccess","RightActionDictionary","ACTION_PRODUCT_VIEW","ACTION_PRODUCT_EDIT","ACTION_PRODUCT_ADD","removeMobileScannerToken","defaultValue","prop","getFileInput","fileInputId","isSkuTreeEnabled","isImageFieldEnabled","emptyChanged","isChanged","isSimple","isShowableErrors","isEnabledEmptyImagesError","isEnabledChangesRendering","isInputDetailLinkEnabled","getWrapper","wrapper","document","getElementById","renderTo","node","defineWrapperClass","innerHTML","layoutNameBlock","getSkuTreeInstance","getErrorContainer","Reflection","getClass","layoutImage","UIInputRequest","getImageContainer","subscribeToVariationChange","searchInput","clearImageErrorBorder","hasErrors","setImageErrorBorder","refreshImageSelectorId","initFields","ID","NAME","BARCODE","PRODUCT_ID","SKU_ID","clearSkuTree","skuTreeInstance","getStoreCollection","clear","unsubscribeToVariationChange","incrementMaxListeners","unsubscribeEvents","unsubscribe","getNameBlockView","productName","namePlaceholder","getNameInputFilledValue","tree","setSkuTree","getIblockSkuTreeProperties","has","getSkuTree","SkuTree","selectable","hideUnselected","isShortView","skuFields","PARENT_PRODUCT_ID","variationId","priceId","urlBuilder","processResponse","eventData","reloadFileInput","skuId","inputId","preview","values","morePhoto","getMorePhotoValues","itemConfig","productSelectAjaxAction","isProductAction","isArray","field","changeSelectedElement","getProductId","productChanged","imageField","image","checkEmptyImageError","detailUrl","isArrayFilled"],"mappings":"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"}