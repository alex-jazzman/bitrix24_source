{"version":3,"file":"registry.bundle.js","sources":["../src/base/base.js","../src/recent/recent.js","../src/user/user.js","../src/message/classes/message-base.js","../src/message/classes/channel.js","../src/message/classes/comments.js","../src/message/classes/copilot.js","../src/message/classes/ai-assistant.js","../src/message/message-menu-manager.js"],"sourcesContent":["import { EventEmitter } from 'main.core.events';\nimport { Event } from 'main.core';\nimport { Menu } from 'ui.system.menu';\nimport { Store } from 'ui.vue3.vuex';\nimport { RestClient } from 'rest.client';\n\nimport { Core } from 'im.v2.application.core';\n\nimport type { MenuItemOptions, MenuOptions, MenuSectionOptions } from 'ui.system.menu';\n\nconst EVENT_NAMESPACE = 'BX.Messenger.v2.Lib.Menu';\n\nexport class BaseMenu extends EventEmitter\n{\n\tmenuInstance: Menu;\n\tcontext: Object;\n\ttarget: HTMLElement;\n\tstore: Store;\n\trestClient: RestClient;\n\tid: String = 'im-base-context-menu';\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace(EVENT_NAMESPACE);\n\n\t\tthis.store = Core.getStore();\n\t\tthis.restClient = Core.getRestClient();\n\t}\n\n\t// public\n\topenMenu(context: Object, target: HTMLElement)\n\t{\n\t\tif (this.menuInstance)\n\t\t{\n\t\t\tthis.close();\n\t\t}\n\t\tthis.context = context;\n\t\tthis.target = target;\n\t\tthis.menuInstance = new Menu(this.getMenuOptions());\n\t\tthis.menuInstance.show(this.target);\n\n\t\tthis.#bindBlurEvent();\n\t}\n\n\tgetMenuOptions(): MenuOptions\n\t{\n\t\treturn {\n\t\t\tid: this.id,\n\t\t\tbindOptions: { forceBindPosition: true, position: 'bottom' },\n\t\t\ttargetContainer: document.body,\n\t\t\tcacheable: false,\n\t\t\tcloseByEsc: true,\n\t\t\tclassName: this.getMenuClassName(),\n\t\t\titems: this.#prepareItems(),\n\t\t\tsections: this.getMenuGroups(),\n\t\t};\n\t}\n\n\tgetMenuItems(): MenuItemOptions | null[]\n\t{\n\t\treturn [];\n\t}\n\n\tgetMenuGroups(): MenuSectionOptions[]\n\t{\n\t\treturn [];\n\t}\n\n\tgroupItems(menuItems: MenuItemOptions | null[], group: string): MenuItemOptions[]\n\t{\n\t\treturn menuItems.filter((item) => item !== null).map((item: MenuItemOptions) => {\n\t\t\treturn {\n\t\t\t\t...item,\n\t\t\t\tsectionCode: group,\n\t\t\t};\n\t\t});\n\t}\n\n\tgetMenuClassName(): string\n\t{\n\t\treturn '';\n\t}\n\n\tonClosePopup()\n\t{\n\t\tthis.close();\n\t}\n\n\tclose()\n\t{\n\t\tif (!this.menuInstance)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.menuInstance.destroy();\n\t\tthis.menuInstance = null;\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.close();\n\t}\n\n\tgetCurrentUserId(): number\n\t{\n\t\treturn Core.getUserId();\n\t}\n\n\t#prepareItems(): MenuItemOptions[]\n\t{\n\t\treturn this.getMenuItems().filter((item) => item !== null);\n\t}\n\n\t#bindBlurEvent(): void\n\t{\n\t\tEvent.bindOnce(window, 'blur', () => {\n\t\t\tthis.destroy();\n\t\t});\n\t}\n}\n","import { Analytics } from 'im.v2.lib.analytics';\nimport { Loc, Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { MessageBox, MessageBoxButtons } from 'ui.dialogs.messagebox';\n\nimport { Core } from 'im.v2.application.core';\nimport { ActionByRole, EventType, SidebarDetailBlock, ChatType, UserType, ActionByUserType } from 'im.v2.const';\nimport { CallManager } from 'im.v2.lib.call';\nimport { LegacyRecentService } from 'im.v2.provider.service.recent';\nimport { ChatService } from 'im.v2.provider.service.chat';\nimport { Utils } from 'im.v2.lib.utils';\nimport { PermissionManager } from 'im.v2.lib.permission';\nimport { showLeaveChatConfirm } from 'im.v2.lib.confirm';\nimport { ChannelManager } from 'im.v2.lib.channel';\nimport { Messenger } from 'im.public';\nimport { InviteManager } from 'im.v2.lib.invite';\n\nimport { BaseMenu } from '../base/base';\n\nimport type { ImModelRecentItem, ImModelUser, ImModelChat } from 'im.v2.model';\nimport type { MenuItemOptions, MenuSectionOptions, MenuOptions } from 'ui.system.menu';\n\ntype MenuItemContext = {\n\tdialogId: string,\n\tcompactMode?: boolean,\n\trecentItem?: ImModelRecentItem\n}\n\nconst MenuSectionCode = Object.freeze({\n\tmain: 'main',\n\tinvite: 'invite',\n});\n\nexport class RecentMenu extends BaseMenu\n{\n\tcontext: MenuItemContext;\n\tcallManager: CallManager;\n\tpermissionManager: PermissionManager;\n\tchatService: ChatService;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis.id = 'im-recent-context-menu';\n\t\tthis.chatService = new ChatService();\n\t\tthis.callManager = CallManager.getInstance();\n\t\tthis.permissionManager = PermissionManager.getInstance();\n\t}\n\n\tgetMenuOptions(): MenuOptions\n\t{\n\t\treturn {\n\t\t\t...super.getMenuOptions(),\n\t\t\tclassName: this.getMenuClassName(),\n\t\t\tangle: true,\n\t\t\toffsetLeft: 32,\n\t\t};\n\t}\n\n\tgetMenuClassName(): string\n\t{\n\t\treturn this.context.compactMode ? '' : super.getMenuClassName();\n\t}\n\n\tgetMenuItems(): MenuItemOptions | null[]\n\t{\n\t\tif (this.#isInvitationActive())\n\t\t{\n\t\t\tconst mainGroupItems = [\n\t\t\t\tthis.getSendMessageItem(),\n\t\t\t\tthis.getOpenProfileItem(),\n\t\t\t];\n\n\t\t\treturn [\n\t\t\t\t...this.groupItems(mainGroupItems, MenuSectionCode.main),\n\t\t\t\t...this.groupItems(this.getInviteItems(), MenuSectionCode.invite),\n\t\t\t];\n\t\t}\n\n\t\treturn [\n\t\t\tthis.getUnreadMessageItem(),\n\t\t\tthis.getPinMessageItem(),\n\t\t\tthis.getMuteItem(),\n\t\t\tthis.getOpenProfileItem(),\n\t\t\tthis.getChatsWithUserItem(),\n\t\t\tthis.getHideItem(),\n\t\t\tthis.getLeaveItem(),\n\t\t];\n\t}\n\n\tgetMenuGroups(): MenuSectionOptions[]\n\t{\n\t\tif (this.#isInvitationActive())\n\t\t{\n\t\t\treturn [\n\t\t\t\t{ code: MenuSectionCode.main },\n\t\t\t\t{ code: MenuSectionCode.invite },\n\t\t\t];\n\t\t}\n\n\t\treturn [];\n\t}\n\n\tgetSendMessageItem(): MenuItemOptions\n\t{\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_LIB_MENU_WRITE_V2'),\n\t\t\tonClick: () => {\n\t\t\t\tvoid Messenger.openChat(this.context.dialogId);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetOpenItem(): MenuItemOptions\n\t{\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_LIB_MENU_OPEN'),\n\t\t\tonClick: () => {\n\t\t\t\tvoid Messenger.openChat(this.context.dialogId);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetUnreadMessageItem(): ?MenuItemOptions\n\t{\n\t\tconst { recentItem, dialogId } = this.context;\n\t\tif (!recentItem)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst dialog = this.store.getters['chats/get'](dialogId, true);\n\t\tconst showReadOption = recentItem.unread || dialog.counter > 0;\n\n\t\treturn {\n\t\t\ttitle: showReadOption ? Loc.getMessage('IM_LIB_MENU_READ') : Loc.getMessage('IM_LIB_MENU_UNREAD'),\n\t\t\tonClick: () => {\n\t\t\t\tif (showReadOption)\n\t\t\t\t{\n\t\t\t\t\tthis.chatService.readDialog(dialogId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.chatService.unreadDialog(dialogId);\n\t\t\t\t}\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetPinMessageItem(): ?MenuItemOptions\n\t{\n\t\tconst { recentItem, dialogId } = this.context;\n\t\tif (!recentItem)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst isPinned = recentItem.pinned;\n\n\t\treturn {\n\t\t\ttitle: isPinned ? Loc.getMessage('IM_LIB_MENU_UNPIN_MSGVER_1') : Loc.getMessage('IM_LIB_MENU_PIN_MSGVER_1'),\n\t\t\tonClick: () => {\n\t\t\t\tif (isPinned)\n\t\t\t\t{\n\t\t\t\t\tthis.chatService.unpinChat(dialogId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.chatService.pinChat(dialogId);\n\t\t\t\t\tAnalytics.getInstance().chatPins.onPin(dialogId);\n\t\t\t\t}\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetMuteItem(): ?MenuItemOptions\n\t{\n\t\tconst { dialogId } = this.context;\n\t\tconst canMute = this.permissionManager.canPerformActionByRole(ActionByRole.mute, dialogId);\n\t\tif (!canMute)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst dialog = this.store.getters['chats/get'](dialogId, true);\n\t\tconst isMuted = dialog.muteList.includes(Core.getUserId());\n\n\t\treturn {\n\t\t\ttitle: isMuted ? Loc.getMessage('IM_LIB_MENU_UNMUTE_2') : Loc.getMessage('IM_LIB_MENU_MUTE_2'),\n\t\t\tonClick: () => {\n\t\t\t\tif (isMuted)\n\t\t\t\t{\n\t\t\t\t\tthis.chatService.unmuteChat(dialogId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.chatService.muteChat(dialogId);\n\t\t\t\t}\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetOpenProfileItem(): ?MenuItemOptions\n\t{\n\t\tif (!this.isUser() || this.isBot())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst profileUri = Utils.user.getProfileLink(this.context.dialogId);\n\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_LIB_MENU_OPEN_PROFILE_V2'),\n\t\t\tonClick: () => {\n\t\t\t\tBX.SidePanel.Instance.open(profileUri);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetHideItem(): ?MenuItemOptions\n\t{\n\t\tif (!this.#canHideChat())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_LIB_MENU_HIDE_MSGVER_1'),\n\t\t\tonClick: () => {\n\t\t\t\tLegacyRecentService.getInstance().hideChat(this.context.dialogId);\n\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetLeaveItem(): ?MenuItemOptions\n\t{\n\t\tif (this.isCollabChat())\n\t\t{\n\t\t\treturn this.#leaveCollab();\n\t\t}\n\n\t\treturn this.#leaveChat();\n\t}\n\n\tgetChatsWithUserItem(): ?MenuItemOptions\n\t{\n\t\tif (!this.isUser() || this.isBot() || this.isChatWithCurrentUser())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst isAnyChatOpened = this.store.getters['application/getLayout'].entityId.length > 0;\n\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_LIB_MENU_FIND_SHARED_CHATS'),\n\t\t\tonClick: async () => {\n\t\t\t\tif (!isAnyChatOpened)\n\t\t\t\t{\n\t\t\t\t\tawait Messenger.openChat(this.context.dialogId);\n\t\t\t\t}\n\n\t\t\t\tEventEmitter.emit(EventType.sidebar.open, {\n\t\t\t\t\tpanel: SidebarDetailBlock.chatsWithUser,\n\t\t\t\t\tstandalone: true,\n\t\t\t\t\tdialogId: this.context.dialogId,\n\t\t\t\t});\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\t// region invitation\n\tgetInviteItems(): MenuItemOptions[]\n\t{\n\t\tconst { recentItem } = this.context;\n\t\tif (!recentItem)\n\t\t{\n\t\t\treturn [];\n\t\t}\n\n\t\tconst items = [];\n\n\t\tlet canInvite; // TODO change to APPLICATION variable\n\t\tif (Type.isUndefined(BX.MessengerProxy))\n\t\t{\n\t\t\tcanInvite = true;\n\t\t\tconsole.error('BX.MessengerProxy.canInvite() method not found in v2 version!');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcanInvite = BX.MessengerProxy.canInvite();\n\t\t}\n\n\t\tconst canManageInvite = canInvite && Core.getUserId() === recentItem.invitation.originator;\n\t\tif (canManageInvite)\n\t\t{\n\t\t\titems.push(\n\t\t\t\tthis.getResendInviteItem(),\n\t\t\t\tthis.getCancelInviteItem(),\n\t\t\t);\n\t\t}\n\n\t\treturn items;\n\t}\n\n\tgetResendInviteItem(): ?MenuItemOptions\n\t{\n\t\tconst { recentItem, dialogId } = this.context;\n\t\tif (!recentItem || !this.#canResendInvitation())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_LIB_INVITE_RESEND'),\n\t\t\tonClick: () => {\n\t\t\t\tInviteManager.resendInvite(dialogId);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetCancelInviteItem(): MenuItemOptions\n\t{\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_LIB_INVITE_CANCEL'),\n\t\t\tonClick: () => {\n\t\t\t\tMessageBox.show({\n\t\t\t\t\tmessage: Loc.getMessage('IM_LIB_INVITE_CANCEL_CONFIRM'),\n\t\t\t\t\tmodal: true,\n\t\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t\t\tonOk: (messageBox) => {\n\t\t\t\t\t\tInviteManager.cancelInvite(this.context.dialogId);\n\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t},\n\t\t\t\t\tonCancel: (messageBox) => {\n\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\t// endregion\n\n\tgetChat(): ImModelChat\n\t{\n\t\treturn this.store.getters['chats/get'](this.context.dialogId, true);\n\t}\n\n\tisUser(): boolean\n\t{\n\t\treturn this.store.getters['chats/isUser'](this.context.dialogId);\n\t}\n\n\tisBot(): boolean\n\t{\n\t\tif (!this.isUser())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst user: ImModelUser = this.store.getters['users/get'](this.context.dialogId);\n\n\t\treturn user.type === UserType.bot;\n\t}\n\n\tisChannel(): boolean\n\t{\n\t\treturn ChannelManager.isChannel(this.context.dialogId);\n\t}\n\n\tisCommentsChat(): boolean\n\t{\n\t\tconst { type }: ImModelChat = this.store.getters['chats/get'](this.context.dialogId, true);\n\n\t\treturn type === ChatType.comment;\n\t}\n\n\tisCollabChat(): boolean\n\t{\n\t\tconst { type }: ImModelChat = this.store.getters['chats/get'](this.context.dialogId, true);\n\n\t\treturn type === ChatType.collab;\n\t}\n\n\tisChatWithCurrentUser(): boolean\n\t{\n\t\treturn this.getCurrentUserId() === Number.parseInt(this.context.dialogId, 10);\n\t}\n\n\t#leaveChat(): ?MenuItemOptions\n\t{\n\t\tconst canLeaveChat = this.permissionManager.canPerformActionByRole(ActionByRole.leave, this.context.dialogId);\n\t\tif (!canLeaveChat)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst title = this.isChannel()\n\t\t\t? Loc.getMessage('IM_LIB_MENU_LEAVE_CHANNEL')\n\t\t\t: Loc.getMessage('IM_LIB_MENU_LEAVE_MSGVER_1')\n\t\t;\n\n\t\treturn {\n\t\t\ttitle,\n\t\t\tonClick: async () => {\n\t\t\t\tthis.menuInstance.close();\n\t\t\t\tconst userChoice = await showLeaveChatConfirm(this.context.dialogId);\n\t\t\t\tif (userChoice === true)\n\t\t\t\t{\n\t\t\t\t\tthis.chatService.leaveChat(this.context.dialogId);\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\t}\n\n\t#leaveCollab(): ?MenuItemOptions\n\t{\n\t\tconst canLeaveChat = this.permissionManager.canPerformActionByRole(ActionByRole.leave, this.context.dialogId);\n\t\tconst canLeaveCollab = this.permissionManager.canPerformActionByUserType(ActionByUserType.leaveCollab);\n\t\tif (!canLeaveChat || !canLeaveCollab)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_LIB_MENU_LEAVE_MSGVER_1'),\n\t\t\tonClick: async () => {\n\t\t\t\tthis.menuInstance.close();\n\t\t\t\tconst userChoice = await showLeaveChatConfirm(this.context.dialogId);\n\t\t\t\tif (!userChoice)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.chatService.leaveCollab(this.context.dialogId);\n\t\t\t},\n\t\t};\n\t}\n\n\t#canHideChat(): boolean\n\t{\n\t\tconst { recentItem, dialogId } = this.context;\n\t\tif (!recentItem)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst isInvitation = this.#isInvitationActive();\n\t\tconst isFakeUser = recentItem.isFakeElement;\n\t\tconst isAiAssistantBot = this.store.getters['users/bots/isAiAssistant'](dialogId);\n\n\t\treturn !isInvitation && !isFakeUser && !isAiAssistantBot;\n\t}\n\n\t#isInvitationActive(): boolean\n\t{\n\t\tconst { recentItem } = this.context;\n\t\tif (!recentItem || !recentItem.invitation)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn recentItem.invitation.isActive;\n\t}\n\n\t#canResendInvitation(): boolean\n\t{\n\t\tconst { recentItem } = this.context;\n\t\tif (!recentItem || !recentItem.invitation)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn recentItem.invitation.canResend;\n\t}\n}\n","import { Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\nimport { Messenger } from 'im.public';\nimport { Utils } from 'im.v2.lib.utils';\nimport { ChatService } from 'im.v2.provider.service.chat';\nimport { showKickUserConfirm } from 'im.v2.lib.confirm';\nimport { PermissionManager } from 'im.v2.lib.permission';\nimport { ActionByRole, ChatType, EventType, UserType } from 'im.v2.const';\n\nimport { BaseMenu } from '../base/base';\n\nimport type { MenuItemOptions } from 'ui.system.menu';\nimport type { ImModelUser, ImModelChat } from 'im.v2.model';\n\ntype UserMenuContext = {\n\tuser: ImModelUser,\n\tdialog: ImModelChat\n};\n\nexport class UserMenu extends BaseMenu\n{\n\tcontext: UserMenuContext;\n\tpermissionManager: PermissionManager;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis.id = 'bx-im-user-context-menu';\n\t\tthis.permissionManager = PermissionManager.getInstance();\n\t}\n\n\tgetKickItem(): ?MenuItemOptions\n\t{\n\t\tconst canKick = this.permissionManager.canPerformActionByRole(ActionByRole.kick, this.context.dialog.dialogId);\n\t\tif (!canKick)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttitle: this.#getKickItemText(),\n\t\t\tonClick: async () => {\n\t\t\t\tthis.menuInstance.close();\n\t\t\t\tconst userChoice = await showKickUserConfirm(this.context.dialog.dialogId);\n\t\t\t\tif (userChoice !== true)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvoid this.#kickUser();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetMentionItem(): MenuItemOptions\n\t{\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_LIB_MENU_USER_MENTION'),\n\t\t\tonClick: () => {\n\t\t\t\tEventEmitter.emit(EventType.textarea.insertMention, {\n\t\t\t\t\tmentionText: this.context.user.name,\n\t\t\t\t\tmentionReplacement: Utils.text.getMentionBbCode(this.context.user.id, this.context.user.name),\n\t\t\t\t\tdialogId: this.context.dialog.dialogId,\n\t\t\t\t\tisMentionSymbol: false,\n\t\t\t\t});\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetSendItem(): ?MenuItemOptions\n\t{\n\t\tif (this.context.dialog.type === ChatType.user)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_LIB_MENU_USER_WRITE'),\n\t\t\tonClick: () => {\n\t\t\t\tvoid Messenger.openChat(this.context.user.id);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetProfileItem(): ?MenuItemOptions\n\t{\n\t\tif (this.isBot())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst profileUri = Utils.user.getProfileLink(this.context.user.id);\n\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_LIB_MENU_OPEN_PROFILE_V2'),\n\t\t\tonClick: () => {\n\t\t\t\tBX.SidePanel.Instance.open(profileUri);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tisCollabChat(): boolean\n\t{\n\t\tconst { type }: ImModelChat = this.store.getters['chats/get'](this.context.dialog.dialogId, true);\n\n\t\treturn type === ChatType.collab;\n\t}\n\n\tisBot(): boolean\n\t{\n\t\treturn this.context.user.type === UserType.bot;\n\t}\n\n\t#getKickItemText(): string\n\t{\n\t\tif (this.isCollabChat())\n\t\t{\n\t\t\treturn Loc.getMessage('IM_LIB_MENU_USER_KICK_FROM_COLLAB');\n\t\t}\n\n\t\treturn Loc.getMessage('IM_LIB_MENU_USER_KICK_FROM_CHAT');\n\t}\n\n\t#kickUser(): Promise\n\t{\n\t\tif (this.isCollabChat())\n\t\t{\n\t\t\treturn (new ChatService()).kickUserFromCollab(this.context.dialog.dialogId, this.context.user.id);\n\t\t}\n\n\t\treturn (new ChatService()).kickUserFromChat(this.context.dialog.dialogId, this.context.user.id);\n\t}\n}\n","import { Loc, Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { MenuItemDesign } from 'ui.system.menu';\nimport { Outline as OutlineIcons } from 'ui.icon-set.api.core';\n\nimport { PromoManager } from 'im.v2.lib.promo';\nimport { Analytics } from 'im.v2.lib.analytics';\nimport { ChannelManager } from 'im.v2.lib.channel';\nimport { Core } from 'im.v2.application.core';\nimport { Parser } from 'im.v2.lib.parser';\nimport { EntityCreator } from 'im.v2.lib.entity-creator';\nimport { MessageService } from 'im.v2.provider.service.message';\nimport { DiskService } from 'im.v2.provider.service.disk';\nimport { EventType, PlacementType, ActionByRole, PromoId } from 'im.v2.const';\nimport { MarketManager } from 'im.v2.lib.market';\nimport { Utils } from 'im.v2.lib.utils';\nimport { PermissionManager } from 'im.v2.lib.permission';\nimport { showDeleteChannelPostConfirm, showDownloadAllFilesConfirm } from 'im.v2.lib.confirm';\nimport { Notifier } from 'im.v2.lib.notifier';\n\n// noinspection ES6PreferShortImport\nimport { BaseMenu } from '../../base/base';\n\nimport type { ImModelMessage, ImModelChat, ImModelFile } from 'im.v2.model';\nimport type { MenuItemOptions, MenuOptions, MenuSectionOptions } from 'ui.system.menu';\nexport type MessageMenuContext = ImModelMessage & { dialogId: string };\n\nconst MenuSectionCode = Object.freeze({\n\tmain: 'main',\n\tselect: 'select',\n\tcreate: 'create',\n\tmarket: 'market',\n});\n\nexport class MessageMenu extends BaseMenu\n{\n\tcontext: MessageMenuContext;\n\tdiskService: DiskService;\n\n\tmaxPins: number = 20;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis.id = 'bx-im-message-context-menu';\n\t\tthis.diskService = new DiskService();\n\t\tthis.marketManager = MarketManager.getInstance();\n\t}\n\n\tgetMenuOptions(): MenuOptions\n\t{\n\t\treturn {\n\t\t\t...super.getMenuOptions(),\n\t\t\tclassName: this.getMenuClassName(),\n\t\t\tangle: true,\n\t\t\toffsetLeft: 11,\n\t\t\tminWidth: 238,\n\t\t};\n\t}\n\n\tgetMenuItems(): MenuItemOptions | null[]\n\t{\n\t\tconst mainGroupItems = [\n\t\t\tthis.getReplyItem(),\n\t\t\tthis.getCopyItem(),\n\t\t\tthis.getEditItem(),\n\t\t\tthis.getDownloadFileItem(),\n\t\t\tthis.getPinItem(),\n\t\t\tthis.getForwardItem(),\n\t\t\t...this.getAdditionalItems(),\n\t\t\tthis.getDeleteItem(),\n\t\t];\n\n\t\treturn [\n\t\t\t...this.groupItems(mainGroupItems, MenuSectionCode.main),\n\t\t\t...this.groupItems([this.getSelectItem()], MenuSectionCode.select),\n\t\t];\n\t}\n\n\tgetMenuGroups(): MenuSectionOptions[]\n\t{\n\t\treturn [\n\t\t\t{ code: MenuSectionCode.main },\n\t\t\t{ code: MenuSectionCode.select },\n\t\t];\n\t}\n\n\tgetNestedMenuGroups(): MenuSectionOptions[]\n\t{\n\t\treturn [\n\t\t\t{ code: MenuSectionCode.main },\n\t\t\t{ code: MenuSectionCode.create },\n\t\t\t{ code: MenuSectionCode.market },\n\t\t];\n\t}\n\n\tgetSelectItem(): ?MenuItemOptions\n\t{\n\t\tif (this.#isDeletedMessage() || !this.#isRealMessage())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_DIALOG_CHAT_MENU_SELECT'),\n\t\t\ticon: OutlineIcons.CIRCLE_CHECK,\n\t\t\tonClick: () => {\n\t\t\t\tAnalytics.getInstance().messageContextMenu.onSelect(this.context.dialogId);\n\n\t\t\t\tEventEmitter.emit(EventType.dialog.openBulkActionsMode, {\n\t\t\t\t\tmessageId: this.context.id,\n\t\t\t\t\tdialogId: this.context.dialogId,\n\t\t\t\t});\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetReplyItem(): MenuItemOptions\n\t{\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_DIALOG_CHAT_MENU_REPLY'),\n\t\t\tonClick: () => {\n\t\t\t\tAnalytics.getInstance().messageContextMenu.onReply(this.context.dialogId);\n\t\t\t\tEventEmitter.emit(EventType.textarea.replyMessage, {\n\t\t\t\t\tmessageId: this.context.id,\n\t\t\t\t\tdialogId: this.context.dialogId,\n\t\t\t\t});\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t\ticon: OutlineIcons.QUOTE,\n\t\t};\n\t}\n\n\tgetForwardItem(): ?MenuItemOptions\n\t{\n\t\tif (this.#isDeletedMessage() || !this.#isRealMessage())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_DIALOG_CHAT_MENU_FORWARD'),\n\t\t\ticon: OutlineIcons.FORWARD,\n\t\t\tonClick: () => {\n\t\t\t\tAnalytics.getInstance().messageContextMenu.onForward(this.context.dialogId);\n\t\t\t\tEventEmitter.emit(EventType.dialog.showForwardPopup, {\n\t\t\t\t\tmessagesIds: [this.context.id],\n\t\t\t\t});\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetCopyItem(): ?MenuItemOptions\n\t{\n\t\tif (this.#isDeletedMessage() || this.context.text.trim().length === 0)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_DIALOG_CHAT_MENU_COPY'),\n\t\t\tonClick: async () => {\n\t\t\t\tAnalytics.getInstance().messageContextMenu.onCopyText({\n\t\t\t\t\tdialogId: this.context.dialogId,\n\t\t\t\t\tmessageId: this.context.id,\n\t\t\t\t});\n\n\t\t\t\tconst textToCopy = Parser.prepareCopy(this.context);\n\n\t\t\t\tawait Utils.text.copyToClipboard(textToCopy);\n\t\t\t\tNotifier.message.onCopyComplete();\n\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t\ticon: OutlineIcons.COPY,\n\t\t};\n\t}\n\n\tgetCopyLinkItem(): MenuItemOptions\n\t{\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_DIALOG_CHAT_MENU_COPY_LINK_MSGVER_1'),\n\t\t\ticon: OutlineIcons.LINK,\n\t\t\tonClick: () => {\n\t\t\t\tAnalytics.getInstance().messageContextMenu.onCopyLink(this.context.dialogId);\n\n\t\t\t\tconst textToCopy = Utils.text.getMessageLink(this.context.dialogId, this.context.id);\n\t\t\t\tif (BX.clipboard?.copy(textToCopy))\n\t\t\t\t{\n\t\t\t\t\tNotifier.message.onCopyLinkComplete();\n\t\t\t\t}\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetCopyFileItem(): ?MenuItemOptions\n\t{\n\t\tif (this.context.files.length !== 1)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_DIALOG_CHAT_MENU_COPY_FILE'),\n\t\t\ticon: OutlineIcons.COPY,\n\t\t\tonClick: () => {\n\t\t\t\tconst fileId = this.context.files[0];\n\t\t\t\tAnalytics.getInstance().messageContextMenu.onCopyFile({\n\t\t\t\t\tdialogId: this.context.dialogId,\n\t\t\t\t\tfileId,\n\t\t\t\t});\n\n\t\t\t\tconst textToCopy = Parser.prepareCopyFile(this.context);\n\t\t\t\tif (BX.clipboard?.copy(textToCopy))\n\t\t\t\t{\n\t\t\t\t\tNotifier.file.onCopyComplete();\n\t\t\t\t}\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetPinItem(): ?MenuItemOptions\n\t{\n\t\tconst canPin = PermissionManager.getInstance().canPerformActionByRole(\n\t\t\tActionByRole.pinMessage,\n\t\t\tthis.context.dialogId,\n\t\t);\n\n\t\tif (this.#isDeletedMessage() || !canPin)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst isPinned = this.store.getters['messages/pin/isPinned']({\n\t\t\tchatId: this.context.chatId,\n\t\t\tmessageId: this.context.id,\n\t\t});\n\n\t\treturn {\n\t\t\ttitle: isPinned ? Loc.getMessage('IM_DIALOG_CHAT_MENU_UNPIN') : Loc.getMessage('IM_DIALOG_CHAT_MENU_PIN'),\n\t\t\ticon: OutlineIcons.PIN,\n\t\t\tonClick: () => {\n\t\t\t\tconst messageService = new MessageService({ chatId: this.context.chatId });\n\t\t\t\tif (isPinned)\n\t\t\t\t{\n\t\t\t\t\tmessageService.unpinMessage(this.context.chatId, this.context.id);\n\t\t\t\t\tAnalytics.getInstance().messageContextMenu.onUnpin(this.context.dialogId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tif (this.#arePinsExceedLimit())\n\t\t\t\t\t{\n\t\t\t\t\t\tNotifier.chat.onMessagesPinLimitError(this.maxPins);\n\t\t\t\t\t\tAnalytics.getInstance().messageContextMenu.onReachingPinsLimit(this.context.dialogId);\n\t\t\t\t\t\tthis.menuInstance.close();\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tmessageService.pinMessage(this.context.chatId, this.context.id);\n\t\t\t\t\tAnalytics.getInstance().messageContextMenu.onPin(this.context.dialogId);\n\t\t\t\t}\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetFavoriteItem(): MenuItemOptions\n\t{\n\t\tif (this.#isDeletedMessage())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst isInFavorite = this.store.getters['sidebar/favorites/isFavoriteMessage'](this.context.chatId, this.context.id);\n\n\t\tconst menuItemText = isInFavorite\n\t\t\t? Loc.getMessage('IM_DIALOG_CHAT_MENU_REMOVE_FROM_SAVED')\n\t\t\t: Loc.getMessage('IM_DIALOG_CHAT_MENU_SAVE')\n\t\t;\n\n\t\treturn {\n\t\t\ttitle: menuItemText,\n\t\t\ticon: OutlineIcons.FAVORITE,\n\t\t\tonClick: () => {\n\t\t\t\tconst messageService = new MessageService({ chatId: this.context.chatId });\n\t\t\t\tif (isInFavorite)\n\t\t\t\t{\n\t\t\t\t\tmessageService.removeMessageFromFavorite(this.context.id);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tAnalytics.getInstance().messageContextMenu.onAddFavorite({\n\t\t\t\t\t\tdialogId: this.context.dialogId,\n\t\t\t\t\t\tmessageId: this.context.id,\n\t\t\t\t\t});\n\n\t\t\t\t\tmessageService.addMessageToFavorite(this.context.id);\n\t\t\t\t}\n\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetMarkItem(): ?MenuItemOptions\n\t{\n\t\tconst canUnread = this.context.viewed && !this.#isOwnMessage();\n\n\t\tconst dialog: ImModelChat = this.store.getters['chats/getByChatId'](this.context.chatId);\n\t\tconst isMarked = this.context.id === dialog.markedId;\n\t\tif (!canUnread || isMarked)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_DIALOG_CHAT_MENU_MARK'),\n\t\t\ticon: OutlineIcons.NEW_MESSAGE,\n\t\t\tonClick: () => {\n\t\t\t\tAnalytics.getInstance().messageContextMenu.onMark(this.context.dialogId);\n\n\t\t\t\tconst messageService = new MessageService({ chatId: this.context.chatId });\n\t\t\t\tmessageService.markMessage(this.context.id);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetCreateTaskItem(): ?MenuItemOptions\n\t{\n\t\tif (this.#isDeletedMessage())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_DIALOG_CHAT_MENU_CREATE_TASK_MSGVER_1'),\n\t\t\ticon: OutlineIcons.TASK,\n\t\t\tonClick: () => {\n\t\t\t\tAnalytics.getInstance().messageContextMenu.onCreateTask(this.context.dialogId);\n\n\t\t\t\tconst entityCreator = new EntityCreator(this.context.chatId);\n\t\t\t\tvoid entityCreator.createTaskForMessage(this.context.id);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetCreateMeetingItem(): ?MenuItemOptions\n\t{\n\t\tif (this.#isDeletedMessage())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_DIALOG_CHAT_MENU_CREATE_MEETING_MSGVER_1'),\n\t\t\ticon: OutlineIcons.CALENDAR_WITH_SLOTS,\n\t\t\tonClick: () => {\n\t\t\t\tAnalytics.getInstance().messageContextMenu.onCreateEvent(this.context.dialogId);\n\n\t\t\t\tconst entityCreator = new EntityCreator(this.context.chatId);\n\t\t\t\tvoid entityCreator.createMeetingForMessage(this.context.id);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetEditItem(): ?MenuItemOptions\n\t{\n\t\tif (\n\t\t\t!this.#isOwnMessage()\n\t\t\t|| this.#isDeletedMessage()\n\t\t\t|| this.#isForwardedMessage()\n\t\t)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_DIALOG_CHAT_MENU_EDIT'),\n\t\t\ticon: OutlineIcons.EDIT_L,\n\t\t\tonClick: () => {\n\t\t\t\tAnalytics.getInstance().messageContextMenu.onEdit(this.context.dialogId);\n\n\t\t\t\tEventEmitter.emit(EventType.textarea.editMessage, {\n\t\t\t\t\tmessageId: this.context.id,\n\t\t\t\t\tdialogId: this.context.dialogId,\n\t\t\t\t});\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetDeleteItem(): ?MenuItemOptions\n\t{\n\t\tif (this.#isDeletedMessage())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst permissionManager = PermissionManager.getInstance();\n\t\tconst canDeleteOthersMessage = permissionManager.canPerformActionByRole(\n\t\t\tActionByRole.deleteOthersMessage,\n\t\t\tthis.context.dialogId,\n\t\t);\n\t\tif (!this.#isOwnMessage() && !canDeleteOthersMessage)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_DIALOG_CHAT_MENU_DELETE'),\n\t\t\tdesign: MenuItemDesign.Alert,\n\t\t\ticon: OutlineIcons.TRASHCAN,\n\t\t\tonClick: this.#onDelete.bind(this),\n\t\t};\n\t}\n\n\tgetMarketItems(): MenuItemOptions[]\n\t{\n\t\tconst { dialogId, id } = this.context;\n\t\tconst placements = this.marketManager.getAvailablePlacementsByType(PlacementType.contextMenu, dialogId);\n\t\tconst marketMenuItem = [];\n\n\t\tconst context = { messageId: id, dialogId };\n\n\t\tplacements.forEach((placement) => {\n\t\t\tmarketMenuItem.push({\n\t\t\t\ttitle: placement.title,\n\t\t\t\ticon: OutlineIcons.MARKET,\n\t\t\t\tonClick: () => {\n\t\t\t\t\tvoid MarketManager.openSlider(placement, context);\n\t\t\t\t\tthis.menuInstance.close();\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\n\t\tconst MARKET_ITEMS_LIMIT = 10;\n\n\t\treturn marketMenuItem.slice(0, MARKET_ITEMS_LIMIT);\n\t}\n\n\tgetDownloadFileItem(): ?MenuItemOptions\n\t{\n\t\tif (!Type.isArrayFilled(this.context.files))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this.#isSingleFile())\n\t\t{\n\t\t\treturn this.#getDownloadSingleFileItem();\n\t\t}\n\n\t\treturn this.#getDownloadSeveralFilesItem();\n\t}\n\n\tgetSaveToDiskItem(): ?MenuItemOptions\n\t{\n\t\tif (!Type.isArrayFilled(this.context.files))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst menuItemText = this.#isSingleFile()\n\t\t\t? Loc.getMessage('IM_DIALOG_CHAT_MENU_SAVE_ON_DISK_MSGVER_1')\n\t\t\t: Loc.getMessage('IM_DIALOG_CHAT_MENU_SAVE_ALL_ON_DISK');\n\n\t\treturn {\n\t\t\ttitle: menuItemText,\n\t\t\ticon: OutlineIcons.FOLDER_24,\n\t\t\tonClick: async function() {\n\t\t\t\tAnalytics.getInstance().messageContextMenu.onSaveOnDisk({\n\t\t\t\t\tmessageId: this.context.id,\n\t\t\t\t\tdialogId: this.context.dialogId,\n\t\t\t\t});\n\n\t\t\t\tthis.menuInstance.close();\n\t\t\t\tawait this.diskService.save(this.context.files);\n\t\t\t\tNotifier.file.onDiskSaveComplete(this.#isSingleFile());\n\t\t\t}.bind(this),\n\t\t};\n\t}\n\n\tgetAdditionalItems(): MenuItemOptions[]\n\t{\n\t\tconst items = this.getNestedItems();\n\t\tif (this.#needNestedMenu(items))\n\t\t{\n\t\t\treturn [{\n\t\t\t\ttitle: Loc.getMessage('IM_DIALOG_CHAT_MENU_MORE'),\n\t\t\t\tsubMenu: {\n\t\t\t\t\titems,\n\t\t\t\t\tsections: this.getNestedMenuGroups(),\n\t\t\t\t},\n\t\t\t}];\n\t\t}\n\n\t\treturn items;\n\t}\n\n\tgetNestedItems(): MenuItemOptions[]\n\t{\n\t\tconst mainGroupItems = [\n\t\t\tthis.getCopyLinkItem(),\n\t\t\tthis.getCopyFileItem(),\n\t\t\tthis.getMarkItem(),\n\t\t\tthis.getFavoriteItem(),\n\t\t\tthis.getSaveToDiskItem(),\n\t\t];\n\n\t\tconst createGroupItems = [\n\t\t\tthis.getCreateTaskItem(),\n\t\t\tthis.getCreateMeetingItem(),\n\t\t];\n\n\t\treturn [\n\t\t\t...this.groupItems(mainGroupItems, MenuSectionCode.main),\n\t\t\t...this.groupItems(createGroupItems, MenuSectionCode.create),\n\t\t\t...this.groupItems(this.getMarketItems(), MenuSectionCode.market),\n\t\t];\n\t}\n\n\t#needNestedMenu(additionalItems: MenuItemOptions[]): boolean\n\t{\n\t\tconst NESTED_MENU_MIN_ITEMS = 3;\n\t\tconst menuItems = additionalItems.filter((item) => item !== null);\n\n\t\treturn menuItems.length >= NESTED_MENU_MIN_ITEMS;\n\t}\n\n\t#isOwnMessage(): boolean\n\t{\n\t\treturn this.context.authorId === Core.getUserId();\n\t}\n\n\t#isDeletedMessage(): boolean\n\t{\n\t\treturn this.context.isDeleted;\n\t}\n\n\t#getFirstFile(): ?ImModelFile\n\t{\n\t\treturn this.store.getters['files/get'](this.context.files[0]);\n\t}\n\n\t#isSingleFile(): boolean\n\t{\n\t\treturn this.context.files.length === 1;\n\t}\n\n\t#isForwardedMessage(): boolean\n\t{\n\t\treturn Type.isStringFilled(this.context.forward.id);\n\t}\n\n\t#isRealMessage(): boolean\n\t{\n\t\treturn this.store.getters['messages/isRealMessage'](this.context.id);\n\t}\n\n\tasync #onDelete()\n\t{\n\t\tconst { id: messageId, dialogId, chatId } = this.context;\n\t\tAnalytics.getInstance().messageContextMenu.onDelete({ messageId, dialogId });\n\t\tthis.menuInstance.close();\n\n\t\tif (await this.#isDeletionCancelled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst messageService = new MessageService({ chatId });\n\t\tmessageService.deleteMessages([messageId]);\n\t}\n\n\tasync #isDeletionCancelled(): Promise<boolean>\n\t{\n\t\tconst { id: messageId, dialogId } = this.context;\n\t\tif (!ChannelManager.isChannel(dialogId))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst confirmResult = await showDeleteChannelPostConfirm();\n\t\tif (!confirmResult)\n\t\t{\n\t\t\tAnalytics.getInstance().messageContextMenu.onCancelDelete({ messageId, dialogId });\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t#getDownloadSingleFileItem(): MenuItemOptions\n\t{\n\t\tconst file = this.#getFirstFile();\n\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_DIALOG_CHAT_MENU_DOWNLOAD_FILE'),\n\t\t\ticon: OutlineIcons.DOWNLOAD,\n\t\t\tonClick: function() {\n\t\t\t\tUtils.file.downloadFiles([file]);\n\n\t\t\t\tAnalytics.getInstance().messageContextMenu.onFileDownload({\n\t\t\t\t\tmessageId: this.context.id,\n\t\t\t\t\tdialogId: this.context.dialogId,\n\t\t\t\t});\n\t\t\t\tthis.menuInstance.close();\n\t\t\t}.bind(this),\n\t\t};\n\t}\n\n\t#getDownloadSeveralFilesItem(): MenuItemOptions\n\t{\n\t\tconst files: ImModelFile[] = this.context.files.map((fileId) => {\n\t\t\treturn this.store.getters['files/get'](fileId);\n\t\t});\n\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_DIALOG_CHAT_MENU_DOWNLOAD_FILES'),\n\t\t\ticon: OutlineIcons.DOWNLOAD,\n\t\t\tonClick: async () => {\n\t\t\t\tAnalytics.getInstance().messageContextMenu.onFileDownload({\n\t\t\t\t\tmessageId: this.context.id,\n\t\t\t\t\tdialogId: this.context.dialogId,\n\t\t\t\t});\n\t\t\t\tUtils.file.downloadFiles(files);\n\n\t\t\t\tconst needToShowPopup = PromoManager.getInstance().needToShow(PromoId.downloadSeveralFiles);\n\t\t\t\tif (needToShowPopup && Utils.browser.isChrome() && !Utils.platform.isBitrixDesktop())\n\t\t\t\t{\n\t\t\t\t\tthis.menuInstance?.close();\n\t\t\t\t\tawait showDownloadAllFilesConfirm();\n\t\t\t\t\tvoid PromoManager.getInstance().markAsWatched(PromoId.downloadSeveralFiles);\n\t\t\t\t}\n\t\t\t\tthis.menuInstance?.close();\n\t\t\t},\n\t\t};\n\t}\n\n\t#arePinsExceedLimit(): string\n\t{\n\t\tconst pins = this.store.getters['messages/pin/getPinned'](this.context.chatId);\n\n\t\treturn pins.length >= this.maxPins;\n\t}\n}\n","import { MessageMenu } from './message-base';\n\nimport type { MenuItemOptions, MenuSectionOptions } from 'ui.system.menu';\n\nconst MenuSectionCode = Object.freeze({\n\tmain: 'main',\n\tselect: 'select',\n\tcreate: 'create',\n});\n\nexport class ChannelMessageMenu extends MessageMenu\n{\n\tgetMenuItems(): MenuItemOptions[]\n\t{\n\t\tconst mainGroupItems = [\n\t\t\tthis.getCopyItem(),\n\t\t\tthis.getEditItem(),\n\t\t\tthis.getDownloadFileItem(),\n\t\t\tthis.getPinItem(),\n\t\t\tthis.getForwardItem(),\n\t\t\t...this.getAdditionalItems(),\n\t\t\tthis.getDeleteItem(),\n\t\t];\n\n\t\treturn [\n\t\t\t...this.groupItems(mainGroupItems, MenuSectionCode.main),\n\t\t\t...this.groupItems([this.getSelectItem()], MenuSectionCode.select),\n\t\t];\n\t}\n\n\tgetNestedMenuGroups(): MenuSectionOptions[]\n\t{\n\t\treturn [\n\t\t\t{ code: MenuSectionCode.main },\n\t\t\t{ code: MenuSectionCode.create },\n\t\t];\n\t}\n\n\tgetNestedItems(): MenuItemOptions[]\n\t{\n\t\tconst mainGroupItems = [\n\t\t\tthis.getCopyLinkItem(),\n\t\t\tthis.getCopyFileItem(),\n\t\t\tthis.getMarkItem(),\n\t\t\tthis.getFavoriteItem(),\n\t\t\tthis.getSaveToDiskItem(),\n\t\t];\n\n\t\tconst createGroupItems = [\n\t\t\tthis.getCreateTaskItem(),\n\t\t\tthis.getCreateMeetingItem(),\n\t\t];\n\n\t\treturn [\n\t\t\t...this.groupItems(mainGroupItems, MenuSectionCode.main),\n\t\t\t...this.groupItems(createGroupItems, MenuSectionCode.create),\n\t\t];\n\t}\n}\n","import { Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Outline as OutlineIcons } from 'ui.icon-set.api.core';\n\nimport { EventType } from 'im.v2.const';\nimport { ChannelManager } from 'im.v2.lib.channel';\n\nimport { MessageMenu } from './message-base';\n\nimport type { MenuItemOptions, MenuSectionOptions } from 'ui.system.menu';\n\nconst MenuSectionCode = Object.freeze({\n\tmain: 'main',\n\tselect: 'select',\n\tfile: 'file',\n\topen: 'open',\n\tcreate: 'create',\n});\n\nexport class CommentsMessageMenu extends MessageMenu\n{\n\tgetMenuItems(): MenuItemOptions[]\n\t{\n\t\tconst message = this.context;\n\t\tconst contextDialogId = this.context.dialogId;\n\t\tif (ChannelManager.isCommentsPostMessage(message, contextDialogId))\n\t\t{\n\t\t\tconst mainGroupItems = [\n\t\t\t\tthis.getCopyItem(),\n\t\t\t\tthis.getCopyFileItem(),\n\t\t\t];\n\t\t\tconst fileGroupItems = [\n\t\t\t\tthis.getDownloadFileItem(),\n\t\t\t\tthis.getSaveToDiskItem(),\n\t\t\t];\n\n\t\t\treturn [\n\t\t\t\t...this.groupItems(mainGroupItems, MenuSectionCode.main),\n\t\t\t\t...this.groupItems(fileGroupItems, MenuSectionCode.file),\n\t\t\t\t...this.groupItems([this.getOpenInChannelItem()], MenuSectionCode.open),\n\t\t\t];\n\t\t}\n\n\t\treturn [\n\t\t\tthis.getReplyItem(),\n\t\t\tthis.getCopyItem(),\n\t\t\tthis.getEditItem(),\n\t\t\tthis.getDownloadFileItem(),\n\t\t\t...this.getAdditionalItems(),\n\t\t\tthis.getDeleteItem(),\n\t\t];\n\t}\n\n\tgetMenuGroups(): MenuSectionOptions[]\n\t{\n\t\treturn [\n\t\t\t{ code: MenuSectionCode.main },\n\t\t\t{ code: MenuSectionCode.file },\n\t\t\t{ code: MenuSectionCode.open },\n\t\t];\n\t}\n\n\tgetNestedMenuGroups(): MenuSectionOptions[]\n\t{\n\t\treturn [\n\t\t\t{ code: MenuSectionCode.main },\n\t\t\t{ code: MenuSectionCode.create },\n\t\t];\n\t}\n\n\tgetNestedItems(): MenuItemOptions[]\n\t{\n\t\tconst mainGroupItems = [\n\t\t\tthis.getCopyFileItem(),\n\t\t\tthis.getFavoriteItem(),\n\t\t\tthis.getSaveToDiskItem(),\n\t\t];\n\n\t\tconst createGroupItems = [\n\t\t\tthis.getCreateTaskItem(),\n\t\t\tthis.getCreateMeetingItem(),\n\t\t];\n\n\t\treturn [\n\t\t\t...this.groupItems(mainGroupItems, MenuSectionCode.main),\n\t\t\t...this.groupItems(createGroupItems, MenuSectionCode.create),\n\t\t];\n\t}\n\n\tgetOpenInChannelItem(): MenuItemOptions\n\t{\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_LIB_MENU_COMMENTS_OPEN_IN_CHANNEL'),\n\t\t\ticon: OutlineIcons.GO_TO_MESSAGE,\n\t\t\tonClick: () => {\n\t\t\t\tEventEmitter.emit(EventType.dialog.closeComments);\n\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n}\n","import { Analytics } from 'im.v2.lib.analytics';\nimport { Loc, Runtime } from 'main.core';\nimport { Outline as OutlineIcons } from 'ui.icon-set.api.core';\n\nimport { CopilotManager } from 'im.v2.lib.copilot';\n\nimport { MessageMenu } from './message-base';\n\nimport type { ImModelChat } from 'im.v2.model';\nimport type { MenuItemOptions, MenuSectionOptions } from 'ui.system.menu';\n\nconst CopilotChatContext = Object.freeze({\n\tpersonal: 'chat_copilot_tab_one_by_one',\n\tgroup: 'chat_copilot_tab_multi',\n});\n\nconst MenuSectionCode = Object.freeze({\n\tmain: 'main',\n\tselect: 'select',\n\tcreate: 'create',\n\tmarket: 'market',\n});\n\nexport class CopilotMessageMenu extends MessageMenu\n{\n\tgetMenuItems(): MenuItemOptions[]\n\t{\n\t\tconst mainGroupItems = [\n\t\t\tthis.getCopyItem(),\n\t\t\tthis.getMarkItem(),\n\t\t\tthis.getFavoriteItem(),\n\t\t\tthis.getForwardItem(),\n\t\t\tthis.getSendFeedbackItem(),\n\t\t\tthis.getDeleteItem(),\n\t\t];\n\n\t\treturn [\n\t\t\t...this.groupItems(mainGroupItems, MenuSectionCode.main),\n\t\t\t...this.groupItems([this.getSelectItem()], MenuSectionCode.select),\n\t\t];\n\t}\n\n\tgetMenuGroups(): MenuSectionOptions[]\n\t{\n\t\treturn [\n\t\t\t{ code: MenuSectionCode.main },\n\t\t\t{ code: MenuSectionCode.select },\n\t\t];\n\t}\n\n\tgetSendFeedbackItem(): MenuItemOptions\n\t{\n\t\tconst copilotManager = new CopilotManager();\n\t\tif (!copilotManager.isCopilotBot(this.context.authorId))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_LIB_MENU_AI_ASSISTANT_FEEDBACK'),\n\t\t\ticon: OutlineIcons.FEEDBACK,\n\t\t\tonClick: () => {\n\t\t\t\tAnalytics.getInstance().messageContextMenu.onSendFeedback(this.context.dialogId);\n\n\t\t\t\tvoid this.openForm();\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tasync openForm()\n\t{\n\t\tconst formId = Math.round(Math.random() * 1000);\n\n\t\tawait Runtime.loadExtension(['ui.feedback.form']);\n\t\tBX.UI.Feedback.Form.open({\n\t\t\tid: `im.copilot.feedback-${formId}`,\n\t\t\tforms: [\n\t\t\t\t{ zones: ['es'], id: 684, lang: 'es', sec: 'svvq1x' },\n\t\t\t\t{ zones: ['en'], id: 686, lang: 'en', sec: 'tjwodz' },\n\t\t\t\t{ zones: ['de'], id: 688, lang: 'de', sec: 'nrwksg' },\n\t\t\t\t{ zones: ['com.br'], id: 690, lang: 'com.br', sec: 'kpte6m' },\n\t\t\t\t{ zones: ['ru', 'by', 'kz'], id: 692, lang: 'ru', sec: 'jbujn0' },\n\t\t\t],\n\t\t\tpresets: {\n\t\t\t\tsender_page: this.getCopilotChatContext(),\n\t\t\t\tlanguage: Loc.getMessage('LANGUAGE_ID'),\n\t\t\t\tcp_answer: this.context.text,\n\t\t\t},\n\t\t});\n\t}\n\n\tgetCopilotChatContext(): $Values<typeof CopilotChatContext>\n\t{\n\t\tconst chat: ImModelChat = this.store.getters['chats/get'](this.context.dialogId);\n\t\tif (chat.userCounter <= 2)\n\t\t{\n\t\t\treturn CopilotChatContext.personal;\n\t\t}\n\n\t\treturn CopilotChatContext.group;\n\t}\n}\n","import { MessageMenu } from './message-base';\n\nimport type { MenuItemOptions } from 'ui.system.menu';\n\nconst MenuSectionCode = Object.freeze({\n\tmain: 'main',\n\tselect: 'select',\n\tcreate: 'create',\n\tmarket: 'market',\n});\n\nexport class AiAssistantMessageMenu extends MessageMenu\n{\n\tgetMenuItems(): MenuItemOptions[]\n\t{\n\t\tconst mainGroupItems = [\n\t\t\tthis.getReplyItem(),\n\t\t\tthis.getCopyItem(),\n\t\t\tthis.getDownloadFileItem(),\n\t\t\tthis.getPinItem(),\n\t\t\tthis.getForwardItem(),\n\t\t\t...this.getAdditionalItems(),\n\t\t\tthis.getDeleteItem(),\n\t\t];\n\n\t\treturn [\n\t\t\t...this.groupItems(mainGroupItems, MenuSectionCode.main),\n\t\t\t...this.groupItems([this.getSelectItem()], MenuSectionCode.select),\n\t\t];\n\t}\n}\n","import { Core } from 'im.v2.application.core';\nimport { ChannelManager } from 'im.v2.lib.channel';\nimport { CopilotManager } from 'im.v2.lib.copilot';\nimport { ChatType, MessageComponent } from 'im.v2.const';\n\n// noinspection ES6PreferShortImport\nimport { MessageMenu } from './classes/message-base';\nimport { ChannelMessageMenu } from './classes/channel';\nimport { CommentsMessageMenu } from './classes/comments';\nimport { CopilotMessageMenu } from './classes/copilot';\nimport { AiAssistantMessageMenu } from './classes/ai-assistant';\n\nimport type { ImModelChat } from 'im.v2.model';\nimport type { MessageMenuContext } from 'im.v2.lib.menu';\n\ntype MenuCheckFunction = (context: MessageMenuContext) => boolean;\ntype MessageType = $Values<typeof MessageComponent>;\n\nexport class MessageMenuManager\n{\n\tstatic #instance = null;\n\n\t#defaultMenuByCallback: Map<MenuCheckFunction, MessageMenu> = new Map();\n\t#customMenuByCallback: Map<MenuCheckFunction, MessageMenu> = new Map();\n\t#menuByMessageType: Map<MessageType, MessageMenu> = new Map();\n\t#menuInstance = null;\n\n\tstatic getInstance(): MessageMenuManager\n\t{\n\t\tif (!this.#instance)\n\t\t{\n\t\t\tthis.#instance = new MessageMenuManager();\n\t\t}\n\n\t\treturn this.#instance;\n\t}\n\n\tconstructor()\n\t{\n\t\tthis.#registerDefaultMenus();\n\t}\n\n\topenMenu(context: MessageMenuContext, bindElement: HTMLElement): void\n\t{\n\t\tthis.#destroyMenuInstance();\n\n\t\tconst MenuClass = this.#resolveMenuClass(context);\n\t\tthis.#menuInstance = new MenuClass();\n\t\tthis.#menuInstance.openMenu(context, bindElement);\n\t}\n\n\tregisterMenuByCallback(callback: MenuCheckFunction, menuClass: MessageMenu): void\n\t{\n\t\tthis.#customMenuByCallback.set(callback, menuClass);\n\t}\n\n\tregisterMenuByMessageType(messageType: MessageType, menuClass: MessageMenu): void\n\t{\n\t\tif (this.#hasMenuForMessageType(messageType))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#menuByMessageType.set(messageType, menuClass);\n\t}\n\n\t#resolveMenuClass(context: MessageMenuContext): MessageMenu\n\t{\n\t\tif (!this.#isCustomMenuAllowed(context))\n\t\t{\n\t\t\treturn this.#getDefaultMenuClass(context);\n\t\t}\n\n\t\tconst customMenu = this.#getCustomMenuClass(context);\n\n\t\treturn customMenu ?? this.#getDefaultMenuClass(context);\n\t}\n\n\t#registerDefaultMenus()\n\t{\n\t\tthis.#defaultMenuByCallback.set(this.#isChannel.bind(this), ChannelMessageMenu);\n\t\tthis.#defaultMenuByCallback.set(this.#isComment.bind(this), CommentsMessageMenu);\n\t\tthis.#defaultMenuByCallback.set(this.#isCopilot.bind(this), CopilotMessageMenu);\n\t\tthis.#defaultMenuByCallback.set(this.#isAiAssistant.bind(this), AiAssistantMessageMenu);\n\t}\n\n\t#isCustomMenuAllowed(context: MessageMenuContext): boolean\n\t{\n\t\treturn !ChannelManager.isCommentsPostMessage(context, context.dialogId);\n\t}\n\n\t#getDefaultMenuClass(context: MessageMenuContext): MessageMenu\n\t{\n\t\tconst MenuClass = this.#getClassByMap(this.#defaultMenuByCallback, context);\n\n\t\treturn MenuClass ?? MessageMenu;\n\t}\n\n\t#getCustomMenuClass(context: MessageMenuContext): MessageMenu | null\n\t{\n\t\tif (this.#hasMenuForMessageType(context.componentId))\n\t\t{\n\t\t\treturn this.#getMenuForMessageType(context.componentId);\n\t\t}\n\n\t\treturn this.#getClassByMap(this.#customMenuByCallback, context);\n\t}\n\n\t#getClassByMap(menuMap: Map<MenuCheckFunction, MessageMenu>, context: MessageMenuContext): MessageMenu | null\n\t{\n\t\tconst menuMapEntries = menuMap.entries();\n\t\tfor (const [callback, MenuClass] of menuMapEntries)\n\t\t{\n\t\t\tif (callback(context))\n\t\t\t{\n\t\t\t\treturn MenuClass;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t#getDialog(dialogId: string): ImModelChat\n\t{\n\t\treturn Core.getStore().getters['chats/get'](dialogId, true);\n\t}\n\n\t#isChannel(context: MessageMenuContext): boolean\n\t{\n\t\treturn ChannelManager.isChannel(context.dialogId);\n\t}\n\n\t#isComment(context: MessageMenuContext): boolean\n\t{\n\t\tconst chat = this.#getDialog(context.dialogId);\n\n\t\treturn chat.type === ChatType.comment;\n\t}\n\n\t#isCopilot(context: MessageMenuContext): boolean\n\t{\n\t\treturn (new CopilotManager()).isCopilotChat(context.dialogId);\n\t}\n\n\t#isAiAssistant(context: MessageMenuContext): boolean\n\t{\n\t\treturn Core.getStore().getters['users/bots/isAiAssistant'](context.dialogId);\n\t}\n\n\t#hasMenuForMessageType(messageType: MessageType): boolean\n\t{\n\t\treturn this.#menuByMessageType.has(messageType);\n\t}\n\n\t#getMenuForMessageType(messageType: MessageType): MessageMenu\n\t{\n\t\treturn this.#menuByMessageType.get(messageType);\n\t}\n\n\t#destroyMenuInstance(): void\n\t{\n\t\tif (!this.#menuInstance)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#menuInstance.destroy();\n\t\tthis.#menuInstance = null;\n\t}\n}\n"],"names":["EVENT_NAMESPACE","BaseMenu","EventEmitter","constructor","id","setEventNamespace","store","Core","getStore","restClient","getRestClient","openMenu","context","target","menuInstance","close","Menu","getMenuOptions","show","bindOptions","forceBindPosition","position","targetContainer","document","body","cacheable","closeByEsc","className","getMenuClassName","items","sections","getMenuGroups","getMenuItems","groupItems","menuItems","group","filter","item","map","sectionCode","onClosePopup","destroy","getCurrentUserId","getUserId","Event","bindOnce","window","MenuSectionCode","Object","freeze","main","invite","RecentMenu","chatService","ChatService","callManager","CallManager","getInstance","permissionManager","PermissionManager","angle","offsetLeft","compactMode","mainGroupItems","getSendMessageItem","getOpenProfileItem","getInviteItems","getUnreadMessageItem","getPinMessageItem","getMuteItem","getChatsWithUserItem","getHideItem","getLeaveItem","code","title","Loc","getMessage","onClick","Messenger","openChat","dialogId","getOpenItem","recentItem","dialog","getters","showReadOption","unread","counter","readDialog","unreadDialog","isPinned","pinned","unpinChat","pinChat","Analytics","chatPins","onPin","canMute","canPerformActionByRole","ActionByRole","mute","isMuted","muteList","includes","unmuteChat","muteChat","isUser","isBot","profileUri","Utils","user","getProfileLink","BX","SidePanel","Instance","open","LegacyRecentService","hideChat","isCollabChat","isChatWithCurrentUser","isAnyChatOpened","entityId","length","emit","EventType","sidebar","panel","SidebarDetailBlock","chatsWithUser","standalone","canInvite","Type","isUndefined","MessengerProxy","console","error","canManageInvite","invitation","originator","push","getResendInviteItem","getCancelInviteItem","InviteManager","resendInvite","MessageBox","message","modal","buttons","MessageBoxButtons","OK_CANCEL","onOk","messageBox","cancelInvite","onCancel","getChat","type","UserType","bot","isChannel","ChannelManager","isCommentsChat","ChatType","comment","collab","Number","parseInt","canLeaveChat","leave","userChoice","showLeaveChatConfirm","leaveChat","canLeaveCollab","canPerformActionByUserType","ActionByUserType","leaveCollab","isInvitation","isFakeUser","isFakeElement","isAiAssistantBot","isActive","canResend","UserMenu","getKickItem","canKick","kick","showKickUserConfirm","getMentionItem","textarea","insertMention","mentionText","name","mentionReplacement","text","getMentionBbCode","isMentionSymbol","getSendItem","getProfileItem","kickUserFromCollab","kickUserFromChat","select","create","market","MessageMenu","maxPins","diskService","DiskService","marketManager","MarketManager","minWidth","getReplyItem","getCopyItem","getEditItem","getDownloadFileItem","getPinItem","getForwardItem","getAdditionalItems","getDeleteItem","getSelectItem","getNestedMenuGroups","icon","OutlineIcons","CIRCLE_CHECK","messageContextMenu","onSelect","openBulkActionsMode","messageId","onReply","replyMessage","QUOTE","FORWARD","onForward","showForwardPopup","messagesIds","trim","onCopyText","textToCopy","Parser","prepareCopy","copyToClipboard","Notifier","onCopyComplete","COPY","getCopyLinkItem","LINK","onCopyLink","getMessageLink","clipboard","copy","onCopyLinkComplete","getCopyFileItem","files","fileId","onCopyFile","prepareCopyFile","file","canPin","pinMessage","chatId","PIN","messageService","MessageService","unpinMessage","onUnpin","chat","onMessagesPinLimitError","onReachingPinsLimit","getFavoriteItem","isInFavorite","menuItemText","FAVORITE","removeMessageFromFavorite","onAddFavorite","addMessageToFavorite","getMarkItem","canUnread","viewed","isMarked","markedId","NEW_MESSAGE","onMark","markMessage","getCreateTaskItem","TASK","onCreateTask","entityCreator","EntityCreator","createTaskForMessage","getCreateMeetingItem","CALENDAR_WITH_SLOTS","onCreateEvent","createMeetingForMessage","EDIT_L","onEdit","editMessage","canDeleteOthersMessage","deleteOthersMessage","design","MenuItemDesign","Alert","TRASHCAN","bind","getMarketItems","placements","getAvailablePlacementsByType","PlacementType","contextMenu","marketMenuItem","forEach","placement","MARKET","openSlider","MARKET_ITEMS_LIMIT","slice","isArrayFilled","getSaveToDiskItem","FOLDER_24","onSaveOnDisk","save","onDiskSaveComplete","getNestedItems","subMenu","createGroupItems","additionalItems","NESTED_MENU_MIN_ITEMS","authorId","isDeleted","isStringFilled","forward","onDelete","deleteMessages","confirmResult","showDeleteChannelPostConfirm","onCancelDelete","DOWNLOAD","downloadFiles","onFileDownload","needToShowPopup","PromoManager","needToShow","PromoId","downloadSeveralFiles","browser","isChrome","platform","isBitrixDesktop","showDownloadAllFilesConfirm","markAsWatched","pins","ChannelMessageMenu","CommentsMessageMenu","contextDialogId","isCommentsPostMessage","fileGroupItems","getOpenInChannelItem","GO_TO_MESSAGE","closeComments","CopilotChatContext","personal","CopilotMessageMenu","getSendFeedbackItem","copilotManager","CopilotManager","isCopilotBot","FEEDBACK","onSendFeedback","openForm","formId","Math","round","random","Runtime","loadExtension","UI","Feedback","Form","forms","zones","lang","sec","presets","sender_page","getCopilotChatContext","language","cp_answer","userCounter","AiAssistantMessageMenu","MessageMenuManager","Map","bindElement","MenuClass","registerMenuByCallback","callback","menuClass","set","registerMenuByMessageType","messageType","customMenu","componentId","menuMap","menuMapEntries","entries","isCopilotChat","has","get"],"mappings":"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"}