this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,s,t,i,o,r,a,n,l,c,p){"use strict";const d="icon.png";const b="internal.png";const v="http://127.0.0.1:20141";const u=500;const h="bx-im-messenger__out-of-view";const k={};const g={testImageLoad(e,s,t=d){const i=Date.now();let o=false;const r=a.Dom.create({tag:"img",attrs:{src:`${v}/${t}?${i}`,"data-id":i},props:{className:h},events:{error(){if(o){return}const e=this.dataset.id;s(false,e);clearTimeout(k[e]);a.Dom.remove(this)},load(){const s=this.dataset.id;e(true,s);clearTimeout(k[s]);a.Dom.remove(this)}}});document.body.append(r);k[i]=setTimeout((()=>{o=true;s(false,i);a.Dom.remove(r)}),u)},testInternetConnection(){const e=Date.now();const s=a.Extension.getSettings("im.v2.lib.desktop");const t=s.get("internetCheckUrl");return new Promise((s=>{fetch(`${t}.${e}`).then((e=>{if(e.status===200){s(true);return}s(false)})).catch((()=>{s(false)}))}))},IMAGE_DESKTOP_RUN:d,IMAGE_DESKTOP_TWO_WINDOW_MODE:b};let L=[];let f=0;const P={openConference(e){if(!n.Utils.conference.isValidCode(e)){return false}if(!c.DesktopApi.isDesktop()){return false}let s=null;const t=[{width:2560,height:1440},{width:2048,height:1152},{width:1920,height:1080},{width:1600,height:900},{width:1366,height:768},{width:1024,height:576}];for(const e of t){s=e;if(screen.width>e.width&&screen.height>e.height){break}}L=L.filter((e=>Boolean(c.DesktopApi.findWindow(e))));L.push(n.Utils.conference.getWindowNameByCode(e));c.DesktopApi.createWindow(n.Utils.conference.getWindowNameByCode(e),(t=>{t.SetProperty("title",a.Loc.getMessage("IM_LIB_DESKTOP_CONFERENCE_TITLE"));t.SetProperty("clientSize",{Width:s.width,Height:s.height});t.ExecuteCommand("center");t.SetProperty("minClientSize",{Width:940,Height:400});t.SetProperty("backgroundColor","#2B3038");t.ExecuteCommand("html.load",`<script>location.href="/desktop_app/router.php?alias=${e}&videoconf";<\/script>`);t.ExecuteCommand("show");t.ExecuteCommand("center")}));return true},toggleConference(){if(f>L.length-1){f=0;c.DesktopApi.showWindow();return true}L=L.filter((e=>Boolean(c.DesktopApi.findWindow(e))));for(let e=f;e<L.length;e++){f++;const s=c.DesktopApi.findWindow(L[e]);if(s){c.DesktopApi.activateWindow(s);break}}return true}};const B=60*60*1e3;var D=babelHelpers.classPrivateFieldLooseKey("initDate");var y=babelHelpers.classPrivateFieldLooseKey("sidePanelManager");var C=babelHelpers.classPrivateFieldLooseKey("startReloadCheck");var m=babelHelpers.classPrivateFieldLooseKey("isReloadNeeded");var F=babelHelpers.classPrivateFieldLooseKey("reloadWindow");class H{static init(){return new H}constructor(){Object.defineProperty(this,F,{value:x});Object.defineProperty(this,m,{value:T});Object.defineProperty(this,C,{value:w});Object.defineProperty(this,D,{writable:true,value:void 0});Object.defineProperty(this,y,{writable:true,value:BX.SidePanel.Instance});babelHelpers.classPrivateFieldLooseBase(this,D)[D]=new Date;babelHelpers.classPrivateFieldLooseBase(this,C)[C]()}}function w(){setInterval((async()=>{const e=await babelHelpers.classPrivateFieldLooseBase(this,m)[m]();if(e){babelHelpers.classPrivateFieldLooseBase(this,F)[F]()}}),B)}async function T(){if(n.Utils.date.isSameDay(new Date,babelHelpers.classPrivateFieldLooseBase(this,D)[D])){return false}if(babelHelpers.classPrivateFieldLooseBase(this,y)[y].opened){p.Logger.desktop("Checker: checkDayForReload, slider is open - delay reload");return false}if(i.CallManager.getInstance().hasCurrentCall()){p.Logger.desktop("Checker: checkDayForReload, call is active - delay reload");return false}return g.testInternetConnection()}function x(){p.Logger.desktop("Checker: checkDayForReload, new day - reload window");c.DesktopApi.reloadWindow()}const E="!!";const O={encodeParams(e){if(!a.Type.isPlainObject(e)){return""}let s="";Object.entries(e).forEach((([e,t])=>{const i="";s+=`${i}${e}${E}${t}`}));return s},decodeParams(e){const s={};if(!a.Type.isStringFilled(e)){return s}const t=e.split(E);for(let e=0;e<t.length;e+=2){const i=t[e];const o=t[e+1];s[i]=o}return s},encodeParamsJson(e){if(!a.Type.isPlainObject(e)){return"{}"}let s="";try{s=encodeURIComponent(JSON.stringify(e))}catch(e){console.error("DesktopUtils: could not encode params.",e);s="{}"}return s},decodeParamsJson(e){let s={};if(!a.Type.isStringFilled(e)){return s}try{s=JSON.parse(decodeURIComponent(e))}catch(e){console.error("DesktopUtils: could not decode encoded params.",e)}return s}};var A=babelHelpers.classPrivateFieldLooseKey("subscribeToBxProtocolEvent");var I=babelHelpers.classPrivateFieldLooseKey("subscribeToLegacyBxProtocolEvent");class S{static init(){return new S}constructor(){Object.defineProperty(this,I,{value:K});Object.defineProperty(this,A,{value:M});babelHelpers.classPrivateFieldLooseBase(this,A)[A]();babelHelpers.classPrivateFieldLooseBase(this,I)[I]()}}function M(){c.DesktopApi.subscribe(l.EventType.desktop.onBxLink,((e,t)=>{const i=t!=null?t:{};Object.entries(i).forEach((([e,s])=>{i[e]=decodeURIComponent(s)}));if(e!==l.DesktopBxLink.openPage){c.DesktopApi.activateWindow()}if(e===l.DesktopBxLink.chat){var o;const e=(o=i.messageId)!=null?o:0;void s.Messenger.openChat(i.dialogId,e)}else if(e===l.DesktopBxLink.lines){void s.Messenger.openLines(i.dialogId)}else if(e===l.DesktopBxLink.conference){void Qe.getInstance().openConference(i.code)}else if(e===l.DesktopBxLink.call){const e=i.withVideo!=="N";void s.Messenger.startVideoCall(i.dialogId,e)}else if(e===l.DesktopBxLink.phone){const e=O.decodeParamsJson(i.phoneParams);void s.Messenger.startPhoneCall(i.number,e)}else if(e===l.DesktopBxLink.callList){const e=O.decodeParamsJson(i.callListParams);void s.Messenger.startCallList(i.callListId,e)}else if(e===l.DesktopBxLink.notifications){void s.Messenger.openNotifications()}else if(e===l.DesktopBxLink.recentSearch){void s.Messenger.openRecentSearch()}else if(e===l.DesktopBxLink.copilot){void s.Messenger.openCopilot(i.dialogId)}else if(e===l.DesktopBxLink.collab){void s.Messenger.openCollab(i.dialogId)}else if(e===l.DesktopBxLink.settings){void s.Messenger.openSettings({onlyPanel:i.section})}else if(e===l.DesktopBxLink.chatCreation){void s.Messenger.openChatCreation(i.chatType)}else if(e===l.DesktopBxLink.timeManager){var r,a;(r=BX.Timeman)==null?void 0:(a=r.Monitor)==null?void 0:a.openReport()}else if(e===l.DesktopBxLink.openTab){c.DesktopApi.setActiveTab()}else if(e===l.DesktopBxLink.openPage){const e=O.decodeParamsJson(i.options);c.DesktopApi.openPage(e.url,e.options)}}))}function K(){c.DesktopApi.subscribe(l.EventType.desktop.onBxLink,((e,t)=>{const i=t!=null?t:{};Object.entries(i).forEach((([e,s])=>{i[e]=decodeURIComponent(s)}));c.DesktopApi.activateWindow();if(e===l.LegacyDesktopBxLink.messenger){if(i.dialog){void s.Messenger.openChat(i.dialog)}else if(i.chat){void s.Messenger.openChat(`chat${i.chat}`)}else{void s.Messenger.openChat()}}else if(e===l.LegacyDesktopBxLink.chat&&i.id){void s.Messenger.openChat(`chat${i.id}`)}else if(e===l.LegacyDesktopBxLink.notify){void s.Messenger.openNotifications()}else if(e===l.LegacyDesktopBxLink.callTo){if(i.video){void s.Messenger.startVideoCall(i.video)}else if(i.audio){void s.Messenger.startVideoCall(i.audio,false)}else if(i.phone){void s.Messenger.startPhoneCall(i.phone)}}else if(e===l.LegacyDesktopBxLink.callList){void s.Messenger.openRecentSearch()}}))}var j=babelHelpers.classPrivateFieldLooseKey("subscribeToLogoutEvent");var $=babelHelpers.classPrivateFieldLooseKey("onExit");class W{static init(){return new W}constructor(){Object.defineProperty(this,$,{value:R});Object.defineProperty(this,j,{value:U});babelHelpers.classPrivateFieldLooseBase(this,j)[j]()}}function U(){c.DesktopApi.subscribe(l.EventType.desktop.onExit,babelHelpers.classPrivateFieldLooseBase(this,$)[$].bind(this))}function R(){t.runAction(l.RestMethod.imV2DesktopLogout).finally((()=>{c.DesktopApi.shutdown()}))}var N=babelHelpers.classPrivateFieldLooseKey("initDate");var X=babelHelpers.classPrivateFieldLooseKey("wakeUpTimer");var _=babelHelpers.classPrivateFieldLooseKey("subscribeToWakeUpEvent");var V=babelHelpers.classPrivateFieldLooseKey("onWakeUp");var J=babelHelpers.classPrivateFieldLooseKey("subscribeToIconClickEvent");var G=babelHelpers.classPrivateFieldLooseKey("onIconClick");var z=babelHelpers.classPrivateFieldLooseKey("subscribeToAwayEvent");var q=babelHelpers.classPrivateFieldLooseKey("onUserAway");var Y=babelHelpers.classPrivateFieldLooseKey("subscribeToFocusEvent");var Q=babelHelpers.classPrivateFieldLooseKey("subscribeToBlurEvent");var Z=babelHelpers.classPrivateFieldLooseKey("removeNativeNotifications");var ee=babelHelpers.classPrivateFieldLooseKey("setInitialStatus");var se=babelHelpers.classPrivateFieldLooseKey("subscribeToStatusChange");class te{static init(){return new te}constructor(){Object.defineProperty(this,se,{value:ve});Object.defineProperty(this,ee,{value:be});Object.defineProperty(this,Z,{value:de});Object.defineProperty(this,Q,{value:pe});Object.defineProperty(this,Y,{value:ce});Object.defineProperty(this,q,{value:le});Object.defineProperty(this,z,{value:ne});Object.defineProperty(this,G,{value:ae});Object.defineProperty(this,J,{value:re});Object.defineProperty(this,V,{value:oe});Object.defineProperty(this,_,{value:ie});Object.defineProperty(this,N,{writable:true,value:void 0});Object.defineProperty(this,X,{writable:true,value:null});this.sidePanelManager=BX.SidePanel.Instance;babelHelpers.classPrivateFieldLooseBase(this,N)[N]=new Date;babelHelpers.classPrivateFieldLooseBase(this,_)[_]();babelHelpers.classPrivateFieldLooseBase(this,z)[z]();babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]();babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]();babelHelpers.classPrivateFieldLooseBase(this,J)[J]();babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]();babelHelpers.classPrivateFieldLooseBase(this,se)[se]()}}function ie(){c.DesktopApi.subscribe(l.EventType.desktop.onWakeUp,babelHelpers.classPrivateFieldLooseBase(this,V)[V].bind(this))}async function oe(){const e=await g.testInternetConnection();if(!e){p.Logger.desktop("StatusHandler: onWakeUp event, no internet connection, delay 60 sec");clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,X)[X]);babelHelpers.classPrivateFieldLooseBase(this,X)[X]=setTimeout(babelHelpers.classPrivateFieldLooseBase(this,V)[V].bind(this),60*1e3);return}if(n.Utils.date.isSameHour(new Date,babelHelpers.classPrivateFieldLooseBase(this,N)[N])){p.Logger.desktop("StatusHandler: onWakeUp event, same hour - restart pull client");o.Core.getPullClient().restart()}else{if(this.sidePanelManager.opened){clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,X)[X]);babelHelpers.classPrivateFieldLooseBase(this,X)[X]=setTimeout(babelHelpers.classPrivateFieldLooseBase(this,V)[V].bind(this),60*1e3);p.Logger.desktop("StatusHandler: onWakeUp event, slider is open, delay 60 sec");return}if(i.CallManager.getInstance().hasCurrentCall()){clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,X)[X]);babelHelpers.classPrivateFieldLooseBase(this,X)[X]=setTimeout(babelHelpers.classPrivateFieldLooseBase(this,V)[V].bind(this),60*1e3);p.Logger.desktop("StatusHandler: onWakeUp event, call is active, delay 60 sec");return}p.Logger.desktop("StatusHandler: onWakeUp event, reload window");c.DesktopApi.reloadWindow()}}function re(){c.DesktopApi.subscribe(l.EventType.desktop.onIconClick,babelHelpers.classPrivateFieldLooseBase(this,G)[G].bind(this))}function ae(){Qe.getInstance().toggleConference()}function ne(){c.DesktopApi.subscribe(l.EventType.desktop.onUserAway,babelHelpers.classPrivateFieldLooseBase(this,q)[q].bind(this))}function le(e){const s=e?l.RestMethod.imUserStatusIdleStart:l.RestMethod.imUserStatusIdleEnd;o.Core.getRestClient().callMethod(s).catch((e=>{console.error(`Desktop: error in ${s}  - ${e}`)}))}function ce(){a.Event.bind(window,"focus",babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].bind(this))}function pe(){a.Event.bind(window,"blur",babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].bind(this))}function de(){if(!a.Browser.isWin()||!c.DesktopApi.isChatWindow()){return}c.DesktopApi.removeNativeNotifications()}function be(){const e=o.Core.getStore().getters["application/settings/get"](l.Settings.user.status);c.DesktopApi.setIconStatus(e)}function ve(){const e=(e,s)=>s["application/settings/get"](l.Settings.user.status);o.Core.getStore().watch(e,(e=>{c.DesktopApi.setIconStatus(e)}))}var ue=babelHelpers.classPrivateFieldLooseKey("store");var he=babelHelpers.classPrivateFieldLooseKey("subscribeToCountersChange");var ke=babelHelpers.classPrivateFieldLooseKey("onCounterChange");class ge{static init(){return new ge}constructor(){Object.defineProperty(this,ke,{value:fe});Object.defineProperty(this,he,{value:Le});Object.defineProperty(this,ue,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,ue)[ue]=o.Core.getStore();babelHelpers.classPrivateFieldLooseBase(this,ke)[ke]();babelHelpers.classPrivateFieldLooseBase(this,he)[he]()}}function Le(){r.EventEmitter.subscribe(l.EventType.counter.onNotificationCounterChange,babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].bind(this));r.EventEmitter.subscribe(l.EventType.counter.onChatCounterChange,babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].bind(this))}function fe(){const e=babelHelpers.classPrivateFieldLooseBase(this,ue)[ue].getters["counters/getTotalChatCounter"];const s=babelHelpers.classPrivateFieldLooseBase(this,ue)[ue].getters["notifications/getCounter"];const t=e>0;c.DesktopApi.setCounter(e+s,t)}var Pe=babelHelpers.classPrivateFieldLooseKey("bindHotkeys");class Be{static init(){return new Be}constructor(){Object.defineProperty(this,Pe,{value:De});babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]()}}function De(){a.Event.bind(window,"keydown",(e=>{const s=n.Utils.key.isCombination(e,"Ctrl+R");if(s){c.DesktopApi.reloadWindow();p.Logger.desktop("NOTICE: User reload window (hotkey)");return}const t=n.Utils.key.isCombination(e,"Ctrl+Shift+L");if(t){c.DesktopApi.openLogsFolder();p.Logger.desktop("NOTICE: User open log folder (hotkey)");return}const i=n.Utils.key.isCombination(e,"Ctrl+Shift+D");if(i){c.DesktopApi.openDeveloperTools();p.Logger.desktop("NOTICE: User open developer tools (hotkey)")}}))}var ye=babelHelpers.classPrivateFieldLooseKey("subscribeToNewTabEvent");var Ce=babelHelpers.classPrivateFieldLooseKey("onNewTabClick");class me{static init(){return new me}constructor(){Object.defineProperty(this,Ce,{value:He});Object.defineProperty(this,ye,{value:Fe});babelHelpers.classPrivateFieldLooseBase(this,ye)[ye]()}}function Fe(){c.DesktopApi.subscribe(l.EventType.desktop.onNewTabClick,babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce].bind(this))}function He(){c.DesktopApi.createTab("/desktop/menu/")}var we=babelHelpers.classPrivateFieldLooseKey("sendInitEvent");var Te=babelHelpers.classPrivateFieldLooseKey("initSliderBindings");var xe=babelHelpers.classPrivateFieldLooseKey("getSliderBindingsStatus");var Ee=babelHelpers.classPrivateFieldLooseKey("initComplete");var Oe=babelHelpers.classPrivateFieldLooseKey("subscribeOnErrorEvent");var Ae=babelHelpers.classPrivateFieldLooseKey("handleInvalidAuthError");class Ie{static init(){return new Ie}constructor(){Object.defineProperty(this,Ae,{value:We});Object.defineProperty(this,Oe,{value:$e});Object.defineProperty(this,Ee,{value:je});Object.defineProperty(this,xe,{value:Ke});Object.defineProperty(this,Te,{value:Me});Object.defineProperty(this,we,{value:Se});H.init();te.init();W.init();S.init();ge.init();Be.init();me.init();babelHelpers.classPrivateFieldLooseBase(this,we)[we]();babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe]();babelHelpers.classPrivateFieldLooseBase(this,Te)[Te]();babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee]()}}function Se(){const{currentUser:e}=o.Core.getApplicationData();c.DesktopApi.emit(l.EventType.desktop.onInit,[{userInfo:e!=null?e:{}}])}function Me(){const e=babelHelpers.classPrivateFieldLooseBase(this,xe)[xe]();if(e){BX.SidePanel.Instance.enableAnchorBinding();return}BX.SidePanel.Instance.disableAnchorBinding()}function Ke(){const e=c.DesktopApi.getCustomSetting(c.DesktopSettingsKey.sliderBindingsStatus,"1");return e==="1"}function je(){c.DesktopApi.setLogInfo=function(...e){p.Logger.desktop(...e)};window.BX.debugEnable(true);c.DesktopApi.printWelcomePrompt()}function $e(){r.EventEmitter.subscribe(l.EventType.request.onAuthError,(()=>babelHelpers.classPrivateFieldLooseBase(this,Ae)[Ae]()))}function We(){return c.DesktopApi.login()}var Ue=babelHelpers.classPrivateFieldLooseKey("initComplete");class Re{static init(){return new Re}constructor(){Object.defineProperty(this,Ue,{value:Ne});me.init();babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue]()}}function Ne(){c.DesktopApi.setLogInfo=function(...e){p.Logger.desktop(...e)}}const Xe=2;const _e=1e3;var Ve=babelHelpers.classPrivateFieldLooseKey("desktopIsActive");var Je=babelHelpers.classPrivateFieldLooseKey("desktopActiveVersion");var Ge=babelHelpers.classPrivateFieldLooseKey("locationChangedToBx");var ze=babelHelpers.classPrivateFieldLooseKey("enableRedirectCounter");var qe=babelHelpers.classPrivateFieldLooseKey("prepareBxUrl");var Ye=babelHelpers.classPrivateFieldLooseKey("initDesktopStatus");class Qe{static getInstance(){if(!this.instance){this.instance=new this}return this.instance}static init(){Qe.getInstance()}static isDesktop(){return c.DesktopApi.isDesktop()}static isChatWindow(){return c.DesktopApi.isChatWindow()}constructor(){Object.defineProperty(this,Ye,{value:es});Object.defineProperty(this,qe,{value:Ze});Object.defineProperty(this,Ve,{writable:true,value:void 0});Object.defineProperty(this,Je,{writable:true,value:void 0});Object.defineProperty(this,Ge,{writable:true,value:false});Object.defineProperty(this,ze,{writable:true,value:1});babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]();if(Qe.isDesktop()){if(c.DesktopApi.isChatWindow()){Ie.init()}else{Re.init()}}}isDesktopActive(){if(Qe.isDesktop()){return true}return babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve]}setDesktopActive(e){babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve]=e}setDesktopVersion(e){babelHelpers.classPrivateFieldLooseBase(this,Je)[Je]=e}getDesktopVersion(){return babelHelpers.classPrivateFieldLooseBase(this,Je)[Je]}isLocationChangedToBx(){return babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge]}redirectToChat(e="",s=0){p.Logger.warn("Desktop: redirectToChat",e);let t=`bx://${l.DesktopBxLink.chat}/dialogId/${e}`;if(s>0){t+=`/messageId/${s}`}this.openBxLink(t);return Promise.resolve()}redirectToLines(e=""){p.Logger.warn("Desktop: redirectToLines",e);this.openBxLink(`bx://${l.DesktopBxLink.lines}/dialogId/${e}`);return Promise.resolve()}redirectToCopilot(e=""){p.Logger.warn("Desktop: redirectToCopilot",e);this.openBxLink(`bx://${l.DesktopBxLink.copilot}/dialogId/${e}`);return Promise.resolve()}redirectToCollab(e=""){p.Logger.warn("Desktop: redirectToCollab",e);this.openBxLink(`bx://${l.DesktopBxLink.collab}/dialogId/${e}`);return Promise.resolve()}redirectToNotifications(){p.Logger.warn("Desktop: redirectToNotifications");this.openBxLink(`bx://${l.DesktopBxLink.notifications}`);return Promise.resolve()}redirectToRecentSearch(){p.Logger.warn("Desktop: redirectToRecentSearch");this.openBxLink(`bx://${l.DesktopBxLink.recentSearch}`);return Promise.resolve()}redirectToConference(e){p.Logger.warn("Desktop: redirectToConference",e);this.openBxLink(`bx://${l.DesktopBxLink.conference}/code/${e}`);return Promise.resolve()}redirectToSettings(e){p.Logger.warn("Desktop: redirectToSettings",e);this.openBxLink(`bx://${l.DesktopBxLink.settings}/section/${e}`);return Promise.resolve()}openConference(e){p.Logger.warn("Desktop: openConference",e);const s=P.openConference(e);if(!s){return Promise.resolve(false)}return Promise.resolve(true)}toggleConference(){p.Logger.warn("Desktop: toggleConference");P.toggleConference()}redirectToChatCreation(e){p.Logger.warn("Desktop: redirectToChatCreation",e);this.openBxLink(`bx://${l.DesktopBxLink.chatCreation}/chatType/${e}/`);return Promise.resolve()}redirectToVideoCall(e="",s=true){p.Logger.warn("Desktop: redirectToVideoCall",e,s);const t=s?"Y":"N";this.openBxLink(`bx://${l.DesktopBxLink.call}/dialogId/${e}/withVideo/${t}`);return Promise.resolve()}redirectToPhoneCall(e,s){p.Logger.warn("Desktop: redirectToPhoneCall",e,s);const t=O.encodeParamsJson(s);this.openBxLink(`bx://${l.DesktopBxLink.phone}/number/${e}/phoneParams/${t}`);return Promise.resolve()}redirectToCallList(e,s){p.Logger.warn("Desktop: redirectToCallList",e,s);const t=O.encodeParamsJson(s);this.openBxLink(`bx://${l.DesktopBxLink.callList}/callListId/${e}/callListParams/${t}`);return Promise.resolve()}openAccountTab(e){this.openBxLink(`bx://v2/${e}/${l.DesktopBxLink.openTab}`)}openPage(e,s={}){const t=O.encodeParamsJson({url:e,options:s});this.openBxLink(`bx://${l.DesktopBxLink.openPage}/options/${t}`)}checkStatusInDifferentContext(){if(!this.isDesktopActive()){return Promise.resolve(false)}if(c.DesktopApi.isChatWindow()){return Promise.resolve(false)}return new Promise((e=>{g.testImageLoad((()=>{e(true)}),(()=>{e(false)}))}))}checkForRedirect(){if(!this.isRedirectEnabled()||!this.isRedirectOptionEnabled()){return Promise.resolve(false)}return this.checkStatusInDifferentContext()}checkForOpenBrowserPage(){if(!this.isDesktopActive()||!this.isRedirectOptionEnabled()){return Promise.resolve(false)}const e=this.getDesktopVersion();if(!c.DesktopApi.isFeatureSupportedInVersion(e,c.DesktopFeature.openPage.id)){return Promise.resolve(false)}return new Promise((e=>{g.testImageLoad((()=>{g.testImageLoad((()=>{e(true)}),(()=>{e(false)}),g.IMAGE_DESKTOP_TWO_WINDOW_MODE)}),(()=>{e(false)}),g.IMAGE_DESKTOP_RUN)}))}isRedirectEnabled(){return babelHelpers.classPrivateFieldLooseBase(this,ze)[ze]>0}enableRedirect(){babelHelpers.classPrivateFieldLooseBase(this,ze)[ze]++}disableRedirect(){babelHelpers.classPrivateFieldLooseBase(this,ze)[ze]--}isRedirectOptionEnabled(){if(c.DesktopApi.isDesktop()&&!c.DesktopApi.isChatWindow()){return true}return o.Core.getStore().getters["application/settings/get"](l.Settings.desktop.enableRedirect)}openBxLink(e){const s=babelHelpers.classPrivateFieldLooseBase(this,qe)[qe](e);babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge]=true;setTimeout((()=>{const e=new r.BaseEvent({compatData:[]});r.EventEmitter.emit(window,"BXLinkOpened",e);babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge]=false}),_e);location.href=s}}function Ze(e){if(/^bx:\/\/v(\d)\//.test(e)){return e}return e.replace("bx://",`bx://v${Xe}/${location.hostname}/`)}function es(){const e=a.Extension.getSettings("im.v2.lib.desktop");this.setDesktopActive(e.get("desktopIsActive"));this.setDesktopVersion(e.get("desktopActiveVersion"))}e.DesktopManager=Qe})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Application,BX.Event,BX,BX.Messenger.v2.Lib,BX.Messenger.v2.Const,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib);
//# sourceMappingURL=desktop-manager.bundle.map.js