this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,t,s,i,n,a,o,r,l,c,g,h,d,u,I,m,M,p,b,v,C,L,_,f,P,y,F,x){"use strict";const B="BX.Messenger.v2.Lib.Menu";var E=babelHelpers.classPrivateFieldLooseKey("prepareItems");var A=babelHelpers.classPrivateFieldLooseKey("bindBlurEvent");class H extends L.EventEmitter{constructor(){super();Object.defineProperty(this,A,{value:k});Object.defineProperty(this,E,{value:O});this.id="im-base-context-menu";this.setEventNamespace(B);this.store=h.Core.getStore();this.restClient=h.Core.getRestClient()}openMenu(e,t){if(this.menuInstance){this.close()}this.context=e;this.target=t;this.menuInstance=new c.Menu(this.getMenuOptions());this.menuInstance.show(this.target);babelHelpers.classPrivateFieldLooseBase(this,A)[A]()}getMenuOptions(){return{id:this.id,bindOptions:{forceBindPosition:true,position:"bottom"},targetContainer:document.body,cacheable:false,closeByEsc:true,className:this.getMenuClassName(),items:babelHelpers.classPrivateFieldLooseBase(this,E)[E](),sections:this.getMenuGroups()}}getMenuItems(){return[]}getMenuGroups(){return[]}groupItems(e,t){return e.filter((e=>e!==null)).map((e=>({...e,sectionCode:t})))}getMenuClassName(){return""}onClosePopup(){this.close()}close(){if(!this.menuInstance){return}this.menuInstance.destroy();this.menuInstance=null}destroy(){this.close()}getCurrentUserId(){return h.Core.getUserId()}}function O(){return this.getMenuItems().filter((e=>e!==null))}function k(){y.Event.bindOnce(window,"blur",(()=>{this.destroy()}))}const N=Object.freeze({main:"main",invite:"invite"});var S=babelHelpers.classPrivateFieldLooseKey("leaveChat");var U=babelHelpers.classPrivateFieldLooseKey("leaveCollab");var T=babelHelpers.classPrivateFieldLooseKey("canHideChat");var D=babelHelpers.classPrivateFieldLooseKey("isInvitationActive");var w=babelHelpers.classPrivateFieldLooseKey("canResendInvitation");class R extends H{constructor(){super();Object.defineProperty(this,w,{value:V});Object.defineProperty(this,D,{value:X});Object.defineProperty(this,T,{value:G});Object.defineProperty(this,U,{value:j});Object.defineProperty(this,S,{value:K});this.id="im-recent-context-menu";this.chatService=new l.ChatService;this.callManager=n.CallManager.getInstance();this.permissionManager=b.PermissionManager.getInstance()}getMenuOptions(){return{...super.getMenuOptions(),className:this.getMenuClassName()}}getMenuClassName(){return this.context.compactMode?"":super.getMenuClassName()}getMenuItems(){if(babelHelpers.classPrivateFieldLooseBase(this,D)[D]()){const e=[this.getSendMessageItem(),this.getOpenProfileItem()];return[...this.groupItems(e,N.main),...this.groupItems(this.getInviteItems(),N.invite)]}return[this.getUnreadMessageItem(),this.getPinMessageItem(),this.getMuteItem(),this.getOpenProfileItem(),this.getChatsWithUserItem(),this.getHideItem(),this.getLeaveItem()]}getMenuGroups(){if(babelHelpers.classPrivateFieldLooseBase(this,D)[D]()){return[{code:N.main},{code:N.invite}]}return[]}getSendMessageItem(){return{title:y.Loc.getMessage("IM_LIB_MENU_WRITE_V2"),onClick:()=>{void r.Messenger.openChat(this.context.dialogId);this.menuInstance.close()}}}getOpenItem(){return{title:y.Loc.getMessage("IM_LIB_MENU_OPEN"),onClick:()=>{void r.Messenger.openChat(this.context.dialogId);this.menuInstance.close()}}}getUnreadMessageItem(){const{recentItem:e,dialogId:t}=this.context;if(!e){return null}const s=this.store.getters["chats/get"](t,true);const i=e.unread||s.counter>0;return{title:i?y.Loc.getMessage("IM_LIB_MENU_READ"):y.Loc.getMessage("IM_LIB_MENU_UNREAD"),onClick:()=>{if(i){this.chatService.readDialog(t)}else{this.chatService.unreadDialog(t)}this.menuInstance.close()}}}getPinMessageItem(){const{recentItem:e,dialogId:t}=this.context;if(!e){return null}const s=e.pinned;return{title:s?y.Loc.getMessage("IM_LIB_MENU_UNPIN_MSGVER_1"):y.Loc.getMessage("IM_LIB_MENU_PIN_MSGVER_1"),onClick:()=>{if(s){this.chatService.unpinChat(t)}else{this.chatService.pinChat(t);P.Analytics.getInstance().chatPins.onPin(t)}this.menuInstance.close()}}}getMuteItem(){const{dialogId:e}=this.context;const t=this.permissionManager.canPerformActionByRole(_.ActionByRole.mute,e);if(!t){return null}const s=this.store.getters["chats/get"](e,true);const i=s.muteList.includes(h.Core.getUserId());return{title:i?y.Loc.getMessage("IM_LIB_MENU_UNMUTE_2"):y.Loc.getMessage("IM_LIB_MENU_MUTE_2"),onClick:()=>{if(i){this.chatService.unmuteChat(e)}else{this.chatService.muteChat(e)}this.menuInstance.close()}}}getOpenProfileItem(){if(!this.isUser()||this.isBot()){return null}const e=p.Utils.user.getProfileLink(this.context.dialogId);return{title:y.Loc.getMessage("IM_LIB_MENU_OPEN_PROFILE_V2"),onClick:()=>{BX.SidePanel.Instance.open(e);this.menuInstance.close()}}}getHideItem(){if(!babelHelpers.classPrivateFieldLooseBase(this,T)[T]()){return null}return{title:y.Loc.getMessage("IM_LIB_MENU_HIDE_MSGVER_1"),onClick:()=>{a.LegacyRecentService.getInstance().hideChat(this.context.dialogId);this.menuInstance.close()}}}getLeaveItem(){if(this.isCollabChat()){return babelHelpers.classPrivateFieldLooseBase(this,U)[U]()}return babelHelpers.classPrivateFieldLooseBase(this,S)[S]()}getChatsWithUserItem(){if(!this.isUser()||this.isBot()||this.isChatWithCurrentUser()){return null}const e=this.store.getters["application/getLayout"].entityId.length>0;return{title:y.Loc.getMessage("IM_LIB_MENU_FIND_SHARED_CHATS"),onClick:async()=>{if(!e){await r.Messenger.openChat(this.context.dialogId)}L.EventEmitter.emit(_.EventType.sidebar.open,{panel:_.SidebarDetailBlock.chatsWithUser,standalone:true,dialogId:this.context.dialogId});this.menuInstance.close()}}}getInviteItems(){const{recentItem:e}=this.context;if(!e){return[]}const t=[];let s;if(y.Type.isUndefined(BX.MessengerProxy)){s=true;console.error("BX.MessengerProxy.canInvite() method not found in v2 version!")}else{s=BX.MessengerProxy.canInvite()}const i=s&&h.Core.getUserId()===e.invitation.originator;if(i){t.push(this.getResendInviteItem(),this.getCancelInviteItem())}return t}getResendInviteItem(){const{recentItem:e,dialogId:t}=this.context;if(!e||!babelHelpers.classPrivateFieldLooseBase(this,w)[w]()){return null}return{title:y.Loc.getMessage("IM_LIB_INVITE_RESEND"),onClick:()=>{o.InviteManager.resendInvite(t);this.menuInstance.close()}}}getCancelInviteItem(){return{title:y.Loc.getMessage("IM_LIB_INVITE_CANCEL"),onClick:()=>{i.MessageBox.show({message:y.Loc.getMessage("IM_LIB_INVITE_CANCEL_CONFIRM"),modal:true,buttons:i.MessageBoxButtons.OK_CANCEL,onOk:e=>{o.InviteManager.cancelInvite(this.context.dialogId);e.close()},onCancel:e=>{e.close()}});this.menuInstance.close()}}}getChat(){return this.store.getters["chats/get"](this.context.dialogId,true)}isUser(){return this.store.getters["chats/isUser"](this.context.dialogId)}isBot(){if(!this.isUser()){return false}const e=this.store.getters["users/get"](this.context.dialogId);return e.type===_.UserType.bot}isChannel(){return f.ChannelManager.isChannel(this.context.dialogId)}isCommentsChat(){const{type:e}=this.store.getters["chats/get"](this.context.dialogId,true);return e===_.ChatType.comment}isCollabChat(){const{type:e}=this.store.getters["chats/get"](this.context.dialogId,true);return e===_.ChatType.collab}isChatWithCurrentUser(){return this.getCurrentUserId()===Number.parseInt(this.context.dialogId,10)}}function K(){const e=this.permissionManager.canPerformActionByRole(_.ActionByRole.leave,this.context.dialogId);if(!e){return null}const t=this.isChannel()?y.Loc.getMessage("IM_LIB_MENU_LEAVE_CHANNEL"):y.Loc.getMessage("IM_LIB_MENU_LEAVE_MSGVER_1");return{title:t,onClick:async()=>{this.menuInstance.close();const e=await v.showLeaveChatConfirm(this.context.dialogId);if(e===true){this.chatService.leaveChat(this.context.dialogId)}}}}function j(){const e=this.permissionManager.canPerformActionByRole(_.ActionByRole.leave,this.context.dialogId);const t=this.permissionManager.canPerformActionByUserType(_.ActionByUserType.leaveCollab);if(!e||!t){return null}return{title:y.Loc.getMessage("IM_LIB_MENU_LEAVE_MSGVER_1"),onClick:async()=>{this.menuInstance.close();const e=await v.showLeaveChatConfirm(this.context.dialogId);if(!e){return}this.chatService.leaveCollab(this.context.dialogId)}}}function G(){const{recentItem:e,dialogId:t}=this.context;if(!e){return null}const s=babelHelpers.classPrivateFieldLooseBase(this,D)[D]();const i=e.isFakeElement;const n=this.store.getters["users/bots/isAiAssistant"](t);return!s&&!i&&!n}function X(){const{recentItem:e}=this.context;if(!e||!e.invitation){return false}return e.invitation.isActive}function V(){const{recentItem:e}=this.context;if(!e||!e.invitation){return false}return e.invitation.canResend}var W=babelHelpers.classPrivateFieldLooseKey("getKickItemText");var z=babelHelpers.classPrivateFieldLooseKey("kickUser");class Y extends H{constructor(){super();Object.defineProperty(this,z,{value:Q});Object.defineProperty(this,W,{value:q});this.id="bx-im-user-context-menu";this.permissionManager=b.PermissionManager.getInstance()}getKickItem(){const e=this.permissionManager.canPerformActionByRole(_.ActionByRole.kick,this.context.dialog.dialogId);if(!e){return null}return{title:babelHelpers.classPrivateFieldLooseBase(this,W)[W](),onClick:async()=>{this.menuInstance.close();const e=await v.showKickUserConfirm(this.context.dialog.dialogId);if(e!==true){return}void babelHelpers.classPrivateFieldLooseBase(this,z)[z]()}}}getMentionItem(){return{title:y.Loc.getMessage("IM_LIB_MENU_USER_MENTION"),onClick:()=>{L.EventEmitter.emit(_.EventType.textarea.insertMention,{mentionText:this.context.user.name,mentionReplacement:p.Utils.text.getMentionBbCode(this.context.user.id,this.context.user.name),dialogId:this.context.dialog.dialogId,isMentionSymbol:false});this.menuInstance.close()}}}getSendItem(){if(this.context.dialog.type===_.ChatType.user){return null}return{title:y.Loc.getMessage("IM_LIB_MENU_USER_WRITE"),onClick:()=>{void r.Messenger.openChat(this.context.user.id);this.menuInstance.close()}}}getProfileItem(){if(this.isBot()){return null}const e=p.Utils.user.getProfileLink(this.context.user.id);return{title:y.Loc.getMessage("IM_LIB_MENU_OPEN_PROFILE_V2"),onClick:()=>{BX.SidePanel.Instance.open(e);this.menuInstance.close()}}}isCollabChat(){const{type:e}=this.store.getters["chats/get"](this.context.dialog.dialogId,true);return e===_.ChatType.collab}isBot(){return this.context.user.type===_.UserType.bot}}function q(){if(this.isCollabChat()){return y.Loc.getMessage("IM_LIB_MENU_USER_KICK_FROM_COLLAB")}return y.Loc.getMessage("IM_LIB_MENU_USER_KICK_FROM_CHAT")}function Q(){if(this.isCollabChat()){return(new l.ChatService).kickUserFromCollab(this.context.dialog.dialogId,this.context.user.id)}return(new l.ChatService).kickUserFromChat(this.context.dialog.dialogId,this.context.user.id)}const $=Object.freeze({main:"main",select:"select",create:"create",market:"market"});var J=babelHelpers.classPrivateFieldLooseKey("needNestedMenu");var Z=babelHelpers.classPrivateFieldLooseKey("isOwnMessage");var ee=babelHelpers.classPrivateFieldLooseKey("isDeletedMessage");var te=babelHelpers.classPrivateFieldLooseKey("getFirstFile");var se=babelHelpers.classPrivateFieldLooseKey("isSingleFile");var ie=babelHelpers.classPrivateFieldLooseKey("isForwardedMessage");var ne=babelHelpers.classPrivateFieldLooseKey("isRealMessage");var ae=babelHelpers.classPrivateFieldLooseKey("onDelete");var oe=babelHelpers.classPrivateFieldLooseKey("isDeletionCancelled");var re=babelHelpers.classPrivateFieldLooseKey("getDownloadSingleFileItem");var le=babelHelpers.classPrivateFieldLooseKey("getDownloadSeveralFilesItem");var ce=babelHelpers.classPrivateFieldLooseKey("arePinsExceedLimit");class ge extends H{constructor(){super();Object.defineProperty(this,ce,{value:_e});Object.defineProperty(this,le,{value:Le});Object.defineProperty(this,re,{value:Ce});Object.defineProperty(this,oe,{value:ve});Object.defineProperty(this,ae,{value:be});Object.defineProperty(this,ne,{value:pe});Object.defineProperty(this,ie,{value:Me});Object.defineProperty(this,se,{value:me});Object.defineProperty(this,te,{value:Ie});Object.defineProperty(this,ee,{value:ue});Object.defineProperty(this,Z,{value:de});Object.defineProperty(this,J,{value:he});this.maxPins=20;this.id="bx-im-message-context-menu";this.diskService=new m.DiskService;this.marketManager=M.MarketManager.getInstance()}getMenuOptions(){return{...super.getMenuOptions(),className:this.getMenuClassName(),angle:true,offsetLeft:11,minWidth:238}}getMenuItems(){const e=[this.getReplyItem(),this.getCopyItem(),this.getEditItem(),this.getDownloadFileItem(),this.getPinItem(),this.getForwardItem(),...this.getAdditionalItems(),this.getDeleteItem()];return[...this.groupItems(e,$.main),...this.groupItems([this.getSelectItem()],$.select)]}getMenuGroups(){return[{code:$.main},{code:$.select}]}getNestedMenuGroups(){return[{code:$.main},{code:$.create},{code:$.market}]}getSelectItem(){if(babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]()||!babelHelpers.classPrivateFieldLooseBase(this,ne)[ne]()){return null}return{title:y.Loc.getMessage("IM_DIALOG_CHAT_MENU_SELECT"),icon:F.Outline.CIRCLE_CHECK,onClick:()=>{P.Analytics.getInstance().messageContextMenu.onSelect(this.context.dialogId);L.EventEmitter.emit(_.EventType.dialog.openBulkActionsMode,{messageId:this.context.id,dialogId:this.context.dialogId});this.menuInstance.close()}}}getReplyItem(){return{title:y.Loc.getMessage("IM_DIALOG_CHAT_MENU_REPLY"),onClick:()=>{P.Analytics.getInstance().messageContextMenu.onReply(this.context.dialogId);L.EventEmitter.emit(_.EventType.textarea.replyMessage,{messageId:this.context.id,dialogId:this.context.dialogId});this.menuInstance.close()},icon:F.Outline.QUOTE}}getForwardItem(){if(babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]()||!babelHelpers.classPrivateFieldLooseBase(this,ne)[ne]()){return null}return{title:y.Loc.getMessage("IM_DIALOG_CHAT_MENU_FORWARD"),icon:F.Outline.FORWARD,onClick:()=>{P.Analytics.getInstance().messageContextMenu.onForward(this.context.dialogId);L.EventEmitter.emit(_.EventType.dialog.showForwardPopup,{messagesIds:[this.context.id]});this.menuInstance.close()}}}getCopyItem(){if(babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]()||this.context.text.trim().length===0){return null}return{title:y.Loc.getMessage("IM_DIALOG_CHAT_MENU_COPY"),onClick:async()=>{P.Analytics.getInstance().messageContextMenu.onCopyText({dialogId:this.context.dialogId,messageId:this.context.id});const e=d.Parser.prepareCopy(this.context);await p.Utils.text.copyToClipboard(e);C.Notifier.message.onCopyComplete();this.menuInstance.close()},icon:F.Outline.COPY}}getCopyLinkItem(){return{title:y.Loc.getMessage("IM_DIALOG_CHAT_MENU_COPY_LINK_MSGVER_1"),icon:F.Outline.LINK,onClick:()=>{var e;P.Analytics.getInstance().messageContextMenu.onCopyLink(this.context.dialogId);const t=p.Utils.text.getMessageLink(this.context.dialogId,this.context.id);if((e=BX.clipboard)!=null&&e.copy(t)){C.Notifier.message.onCopyLinkComplete()}this.menuInstance.close()}}}getCopyFileItem(){if(this.context.files.length!==1){return null}return{title:y.Loc.getMessage("IM_DIALOG_CHAT_MENU_COPY_FILE"),icon:F.Outline.COPY,onClick:()=>{var e;const t=this.context.files[0];P.Analytics.getInstance().messageContextMenu.onCopyFile({dialogId:this.context.dialogId,fileId:t});const s=d.Parser.prepareCopyFile(this.context);if((e=BX.clipboard)!=null&&e.copy(s)){C.Notifier.file.onCopyComplete()}this.menuInstance.close()}}}getPinItem(){const e=b.PermissionManager.getInstance().canPerformActionByRole(_.ActionByRole.pinMessage,this.context.dialogId);if(babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]()||!e){return null}const t=this.store.getters["messages/pin/isPinned"]({chatId:this.context.chatId,messageId:this.context.id});return{title:t?y.Loc.getMessage("IM_DIALOG_CHAT_MENU_UNPIN"):y.Loc.getMessage("IM_DIALOG_CHAT_MENU_PIN"),icon:F.Outline.PIN,onClick:()=>{const e=new I.MessageService({chatId:this.context.chatId});if(t){e.unpinMessage(this.context.chatId,this.context.id);P.Analytics.getInstance().messageContextMenu.onUnpin(this.context.dialogId)}else{if(babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]()){C.Notifier.chat.onMessagesPinLimitError(this.maxPins);P.Analytics.getInstance().messageContextMenu.onReachingPinsLimit(this.context.dialogId);this.menuInstance.close();return}e.pinMessage(this.context.chatId,this.context.id);P.Analytics.getInstance().messageContextMenu.onPin(this.context.dialogId)}this.menuInstance.close()}}}getFavoriteItem(){if(babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]()){return null}const e=this.store.getters["sidebar/favorites/isFavoriteMessage"](this.context.chatId,this.context.id);const t=e?y.Loc.getMessage("IM_DIALOG_CHAT_MENU_REMOVE_FROM_SAVED"):y.Loc.getMessage("IM_DIALOG_CHAT_MENU_SAVE");return{title:t,icon:F.Outline.FAVORITE,onClick:()=>{const t=new I.MessageService({chatId:this.context.chatId});if(e){t.removeMessageFromFavorite(this.context.id)}else{P.Analytics.getInstance().messageContextMenu.onAddFavorite({dialogId:this.context.dialogId,messageId:this.context.id});t.addMessageToFavorite(this.context.id)}this.menuInstance.close()}}}getMarkItem(){const e=this.context.viewed&&!babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]();const t=this.store.getters["chats/getByChatId"](this.context.chatId);const s=this.context.id===t.markedId;if(!e||s){return null}return{title:y.Loc.getMessage("IM_DIALOG_CHAT_MENU_MARK"),icon:F.Outline.NEW_MESSAGE,onClick:()=>{P.Analytics.getInstance().messageContextMenu.onMark(this.context.dialogId);const e=new I.MessageService({chatId:this.context.chatId});e.markMessage(this.context.id);this.menuInstance.close()}}}getCreateTaskItem(){if(babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]()){return null}return{title:y.Loc.getMessage("IM_DIALOG_CHAT_MENU_CREATE_TASK_MSGVER_1"),icon:F.Outline.TASK,onClick:()=>{P.Analytics.getInstance().messageContextMenu.onCreateTask(this.context.dialogId);const e=new u.EntityCreator(this.context.chatId);void e.createTaskForMessage(this.context.id);this.menuInstance.close()}}}getCreateMeetingItem(){if(babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]()){return null}return{title:y.Loc.getMessage("IM_DIALOG_CHAT_MENU_CREATE_MEETING_MSGVER_1"),icon:F.Outline.CALENDAR_WITH_SLOTS,onClick:()=>{P.Analytics.getInstance().messageContextMenu.onCreateEvent(this.context.dialogId);const e=new u.EntityCreator(this.context.chatId);void e.createMeetingForMessage(this.context.id);this.menuInstance.close()}}}getEditItem(){if(!babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]()||babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]()||babelHelpers.classPrivateFieldLooseBase(this,ie)[ie]()){return null}return{title:y.Loc.getMessage("IM_DIALOG_CHAT_MENU_EDIT"),icon:F.Outline.EDIT_L,onClick:()=>{P.Analytics.getInstance().messageContextMenu.onEdit(this.context.dialogId);L.EventEmitter.emit(_.EventType.textarea.editMessage,{messageId:this.context.id,dialogId:this.context.dialogId});this.menuInstance.close()}}}getDeleteItem(){if(babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]()){return null}const e=b.PermissionManager.getInstance();const t=e.canPerformActionByRole(_.ActionByRole.deleteOthersMessage,this.context.dialogId);if(!babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]()&&!t){return null}return{title:y.Loc.getMessage("IM_DIALOG_CHAT_MENU_DELETE"),design:c.MenuItemDesign.Alert,icon:F.Outline.TRASHCAN,onClick:babelHelpers.classPrivateFieldLooseBase(this,ae)[ae].bind(this)}}getMarketItems(){const{dialogId:e,id:t}=this.context;const s=this.marketManager.getAvailablePlacementsByType(_.PlacementType.contextMenu,e);const i=[];const n={messageId:t,dialogId:e};s.forEach((e=>{i.push({title:e.title,icon:F.Outline.MARKET,onClick:()=>{void M.MarketManager.openSlider(e,n);this.menuInstance.close()}})}));const a=10;return i.slice(0,a)}getDownloadFileItem(){if(!y.Type.isArrayFilled(this.context.files)){return null}if(babelHelpers.classPrivateFieldLooseBase(this,se)[se]()){return babelHelpers.classPrivateFieldLooseBase(this,re)[re]()}return babelHelpers.classPrivateFieldLooseBase(this,le)[le]()}getSaveToDiskItem(){if(!y.Type.isArrayFilled(this.context.files)){return null}const e=babelHelpers.classPrivateFieldLooseBase(this,se)[se]()?y.Loc.getMessage("IM_DIALOG_CHAT_MENU_SAVE_ON_DISK_MSGVER_1"):y.Loc.getMessage("IM_DIALOG_CHAT_MENU_SAVE_ALL_ON_DISK");return{title:e,icon:F.Outline.FOLDER_24,onClick:async function(){P.Analytics.getInstance().messageContextMenu.onSaveOnDisk({messageId:this.context.id,dialogId:this.context.dialogId});this.menuInstance.close();await this.diskService.save(this.context.files);C.Notifier.file.onDiskSaveComplete(babelHelpers.classPrivateFieldLooseBase(this,se)[se]())}.bind(this)}}getAdditionalItems(){const e=this.getNestedItems();if(babelHelpers.classPrivateFieldLooseBase(this,J)[J](e)){return[{title:y.Loc.getMessage("IM_DIALOG_CHAT_MENU_MORE"),subMenu:{items:e,sections:this.getNestedMenuGroups()}}]}return e}getNestedItems(){const e=[this.getCopyLinkItem(),this.getCopyFileItem(),this.getMarkItem(),this.getFavoriteItem(),this.getSaveToDiskItem()];const t=[this.getCreateTaskItem(),this.getCreateMeetingItem()];return[...this.groupItems(e,$.main),...this.groupItems(t,$.create),...this.groupItems(this.getMarketItems(),$.market)]}}function he(e){const t=3;const s=e.filter((e=>e!==null));return s.length>=t}function de(){return this.context.authorId===h.Core.getUserId()}function ue(){return this.context.isDeleted}function Ie(){return this.store.getters["files/get"](this.context.files[0])}function me(){return this.context.files.length===1}function Me(){return y.Type.isStringFilled(this.context.forward.id)}function pe(){return this.store.getters["messages/isRealMessage"](this.context.id)}async function be(){const{id:e,dialogId:t,chatId:s}=this.context;P.Analytics.getInstance().messageContextMenu.onDelete({messageId:e,dialogId:t});this.menuInstance.close();if(await babelHelpers.classPrivateFieldLooseBase(this,oe)[oe]()){return}const i=new I.MessageService({chatId:s});i.deleteMessages([e])}async function ve(){const{id:e,dialogId:t}=this.context;if(!f.ChannelManager.isChannel(t)){return false}const s=await v.showDeleteChannelPostConfirm();if(!s){P.Analytics.getInstance().messageContextMenu.onCancelDelete({messageId:e,dialogId:t});return true}return false}function Ce(){const e=babelHelpers.classPrivateFieldLooseBase(this,te)[te]();return{title:y.Loc.getMessage("IM_DIALOG_CHAT_MENU_DOWNLOAD_FILE"),icon:F.Outline.DOWNLOAD,onClick:function(){p.Utils.file.downloadFiles([e]);P.Analytics.getInstance().messageContextMenu.onFileDownload({messageId:this.context.id,dialogId:this.context.dialogId});this.menuInstance.close()}.bind(this)}}function Le(){const e=this.context.files.map((e=>this.store.getters["files/get"](e)));return{title:y.Loc.getMessage("IM_DIALOG_CHAT_MENU_DOWNLOAD_FILES"),icon:F.Outline.DOWNLOAD,onClick:async()=>{var t;P.Analytics.getInstance().messageContextMenu.onFileDownload({messageId:this.context.id,dialogId:this.context.dialogId});p.Utils.file.downloadFiles(e);const s=g.PromoManager.getInstance().needToShow(_.PromoId.downloadSeveralFiles);if(s&&p.Utils.browser.isChrome()&&!p.Utils.platform.isBitrixDesktop()){var i;(i=this.menuInstance)==null?void 0:i.close();await v.showDownloadAllFilesConfirm();void g.PromoManager.getInstance().markAsWatched(_.PromoId.downloadSeveralFiles)}(t=this.menuInstance)==null?void 0:t.close()}}}function _e(){const e=this.store.getters["messages/pin/getPinned"](this.context.chatId);return e.length>=this.maxPins}const fe=Object.freeze({main:"main",select:"select",create:"create"});class Pe extends ge{getMenuItems(){const e=[this.getCopyItem(),this.getEditItem(),this.getDownloadFileItem(),this.getPinItem(),this.getForwardItem(),...this.getAdditionalItems(),this.getDeleteItem()];return[...this.groupItems(e,fe.main),...this.groupItems([this.getSelectItem()],fe.select)]}getNestedMenuGroups(){return[{code:fe.main},{code:fe.create}]}getNestedItems(){const e=[this.getCopyLinkItem(),this.getCopyFileItem(),this.getMarkItem(),this.getFavoriteItem(),this.getSaveToDiskItem()];const t=[this.getCreateTaskItem(),this.getCreateMeetingItem()];return[...this.groupItems(e,fe.main),...this.groupItems(t,fe.create)]}}const ye=Object.freeze({main:"main",select:"select",file:"file",open:"open",create:"create"});class Fe extends ge{getMenuItems(){const e=this.context;const t=this.context.dialogId;if(f.ChannelManager.isCommentsPostMessage(e,t)){const e=[this.getCopyItem(),this.getCopyFileItem()];const t=[this.getDownloadFileItem(),this.getSaveToDiskItem()];return[...this.groupItems(e,ye.main),...this.groupItems(t,ye.file),...this.groupItems([this.getOpenInChannelItem()],ye.open)]}return[this.getReplyItem(),this.getCopyItem(),this.getEditItem(),this.getDownloadFileItem(),...this.getAdditionalItems(),this.getDeleteItem()]}getMenuGroups(){return[{code:ye.main},{code:ye.file},{code:ye.open}]}getNestedMenuGroups(){return[{code:ye.main},{code:ye.create}]}getNestedItems(){const e=[this.getCopyFileItem(),this.getFavoriteItem(),this.getSaveToDiskItem()];const t=[this.getCreateTaskItem(),this.getCreateMeetingItem()];return[...this.groupItems(e,ye.main),...this.groupItems(t,ye.create)]}getOpenInChannelItem(){return{title:y.Loc.getMessage("IM_LIB_MENU_COMMENTS_OPEN_IN_CHANNEL"),icon:F.Outline.GO_TO_MESSAGE,onClick:()=>{L.EventEmitter.emit(_.EventType.dialog.closeComments);this.menuInstance.close()}}}}const xe=Object.freeze({personal:"chat_copilot_tab_one_by_one",group:"chat_copilot_tab_multi"});const Be=Object.freeze({main:"main",select:"select",create:"create",market:"market"});class Ee extends ge{getMenuItems(){const e=[this.getCopyItem(),this.getMarkItem(),this.getFavoriteItem(),this.getForwardItem(),this.getSendFeedbackItem(),this.getDeleteItem()];return[...this.groupItems(e,Be.main),...this.groupItems([this.getSelectItem()],Be.select)]}getMenuGroups(){return[{code:Be.main},{code:Be.select}]}getSendFeedbackItem(){const e=new x.CopilotManager;if(!e.isCopilotBot(this.context.authorId)){return null}return{title:y.Loc.getMessage("IM_LIB_MENU_AI_ASSISTANT_FEEDBACK"),icon:F.Outline.FEEDBACK,onClick:()=>{P.Analytics.getInstance().messageContextMenu.onSendFeedback(this.context.dialogId);void this.openForm();this.menuInstance.close()}}}async openForm(){const e=Math.round(Math.random()*1e3);await y.Runtime.loadExtension(["ui.feedback.form"]);BX.UI.Feedback.Form.open({id:`im.copilot.feedback-${e}`,forms:[{zones:["es"],id:684,lang:"es",sec:"svvq1x"},{zones:["en"],id:686,lang:"en",sec:"tjwodz"},{zones:["de"],id:688,lang:"de",sec:"nrwksg"},{zones:["com.br"],id:690,lang:"com.br",sec:"kpte6m"},{zones:["ru","by","kz"],id:692,lang:"ru",sec:"jbujn0"}],presets:{sender_page:this.getCopilotChatContext(),language:y.Loc.getMessage("LANGUAGE_ID"),cp_answer:this.context.text}})}getCopilotChatContext(){const e=this.store.getters["chats/get"](this.context.dialogId);if(e.userCounter<=2){return xe.personal}return xe.group}}const Ae=Object.freeze({main:"main",select:"select",create:"create",market:"market"});class He extends ge{getMenuItems(){const e=[this.getCopyItem(),this.getDownloadFileItem(),this.getForwardItem(),...this.getAdditionalItems()];return this.groupItems(e,Ae.main)}getNestedItems(){const e=[this.getCopyFileItem(),this.getMarkItem(),this.getFavoriteItem(),this.getSaveToDiskItem()];const t=[this.getCreateTaskItem(),this.getCreateMeetingItem()];return[...this.groupItems(e,Ae.main),...this.groupItems(t,Ae.create),...this.groupItems(this.getMarketItems(),Ae.market)]}}var Oe=babelHelpers.classPrivateFieldLooseKey("instance");var ke=babelHelpers.classPrivateFieldLooseKey("defaultMenuByCallback");var Ne=babelHelpers.classPrivateFieldLooseKey("customMenuByCallback");var Se=babelHelpers.classPrivateFieldLooseKey("menuByMessageType");var Ue=babelHelpers.classPrivateFieldLooseKey("menuInstance");var Te=babelHelpers.classPrivateFieldLooseKey("resolveMenuClass");var De=babelHelpers.classPrivateFieldLooseKey("registerDefaultMenus");var we=babelHelpers.classPrivateFieldLooseKey("isCustomMenuAllowed");var Re=babelHelpers.classPrivateFieldLooseKey("getDefaultMenuClass");var Ke=babelHelpers.classPrivateFieldLooseKey("getCustomMenuClass");var je=babelHelpers.classPrivateFieldLooseKey("getClassByMap");var Ge=babelHelpers.classPrivateFieldLooseKey("getDialog");var Xe=babelHelpers.classPrivateFieldLooseKey("isChannel");var Ve=babelHelpers.classPrivateFieldLooseKey("isComment");var We=babelHelpers.classPrivateFieldLooseKey("isCopilot");var ze=babelHelpers.classPrivateFieldLooseKey("isAiAssistant");var Ye=babelHelpers.classPrivateFieldLooseKey("hasMenuForMessageType");var qe=babelHelpers.classPrivateFieldLooseKey("getMenuForMessageType");var Qe=babelHelpers.classPrivateFieldLooseKey("destroyMenuInstance");class $e{static getInstance(){if(!babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe]){babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe]=new $e}return babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe]}constructor(){Object.defineProperty(this,Qe,{value:ht});Object.defineProperty(this,qe,{value:gt});Object.defineProperty(this,Ye,{value:ct});Object.defineProperty(this,ze,{value:lt});Object.defineProperty(this,We,{value:rt});Object.defineProperty(this,Ve,{value:ot});Object.defineProperty(this,Xe,{value:at});Object.defineProperty(this,Ge,{value:nt});Object.defineProperty(this,je,{value:it});Object.defineProperty(this,Ke,{value:st});Object.defineProperty(this,Re,{value:tt});Object.defineProperty(this,we,{value:et});Object.defineProperty(this,De,{value:Ze});Object.defineProperty(this,Te,{value:Je});Object.defineProperty(this,ke,{writable:true,value:new Map});Object.defineProperty(this,Ne,{writable:true,value:new Map});Object.defineProperty(this,Se,{writable:true,value:new Map});Object.defineProperty(this,Ue,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,De)[De]()}openMenu(e,t){babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe]();const s=babelHelpers.classPrivateFieldLooseBase(this,Te)[Te](e);babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue]=new s;babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].openMenu(e,t)}registerMenuByCallback(e,t){babelHelpers.classPrivateFieldLooseBase(this,Ne)[Ne].set(e,t)}registerMenuByMessageType(e,t){if(babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye](e)){return}babelHelpers.classPrivateFieldLooseBase(this,Se)[Se].set(e,t)}}function Je(e){if(!babelHelpers.classPrivateFieldLooseBase(this,we)[we](e)){return babelHelpers.classPrivateFieldLooseBase(this,Re)[Re](e)}const t=babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke](e);return t!=null?t:babelHelpers.classPrivateFieldLooseBase(this,Re)[Re](e)}function Ze(){babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].set(babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].bind(this),Pe);babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].set(babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve].bind(this),Fe);babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].set(babelHelpers.classPrivateFieldLooseBase(this,We)[We].bind(this),Ee);babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].set(babelHelpers.classPrivateFieldLooseBase(this,ze)[ze].bind(this),He)}function et(e){return!f.ChannelManager.isCommentsPostMessage(e,e.dialogId)}function tt(e){const t=babelHelpers.classPrivateFieldLooseBase(this,je)[je](babelHelpers.classPrivateFieldLooseBase(this,ke)[ke],e);return t!=null?t:ge}function st(e){if(babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye](e.componentId)){return babelHelpers.classPrivateFieldLooseBase(this,qe)[qe](e.componentId)}return babelHelpers.classPrivateFieldLooseBase(this,je)[je](babelHelpers.classPrivateFieldLooseBase(this,Ne)[Ne],e)}function it(e,t){const s=e.entries();for(const[e,i]of s){if(e(t)){return i}}return null}function nt(e){return h.Core.getStore().getters["chats/get"](e,true)}function at(e){return f.ChannelManager.isChannel(e.dialogId)}function ot(e){const t=babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge](e.dialogId);return t.type===_.ChatType.comment}function rt(e){return(new x.CopilotManager).isCopilotChat(e.dialogId)}function lt(e){return h.Core.getStore().getters["users/bots/isAiAssistant"](e.dialogId)}function ct(e){return babelHelpers.classPrivateFieldLooseBase(this,Se)[Se].has(e)}function gt(e){return babelHelpers.classPrivateFieldLooseBase(this,Se)[Se].get(e)}function ht(){if(!babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue]){return}babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].destroy();babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue]=null}Object.defineProperty($e,Oe,{writable:true,value:null});e.BaseMenu=H;e.RecentMenu=R;e.UserMenu=Y;e.MessageMenuManager=$e;e.MessageMenu=ge;e.AiAssistantMessageMenu=He})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX.Vue3.Vuex,BX,BX.UI.Dialogs,BX.Messenger.v2.Lib,BX.Messenger.v2.Service,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Service,BX.UI.System,BX.Messenger.v2.Lib,BX.Messenger.v2.Application,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Service,BX.Messenger.v2.Service,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Event,BX.Messenger.v2.Const,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX,BX.UI.IconSet,BX.Messenger.v2.Lib);
//# sourceMappingURL=registry.bundle.map.js