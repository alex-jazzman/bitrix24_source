{"version":3,"file":"messenger.bundle.js","sources":["../src/config/component-map.js","../src/messenger.js"],"sourcesContent":["import { ChatContent } from 'im.v2.component.content.chat';\nimport { CreateChatContent, UpdateChatContent } from 'im.v2.component.content.chat-forms.forms';\nimport { MarketContent } from 'im.v2.component.content.market';\nimport { NotificationContent } from 'im.v2.component.content.notification';\nimport { OpenlinesContent } from 'im.v2.component.content.openlines';\nimport { OpenlinesV2Content } from 'im.v2.component.content.openlinesV2';\nimport { SettingsContent } from 'im.v2.component.content.settings';\nimport { AiAssistantListRouter } from 'im.v2.component.list.container.ai-assistant';\nimport { ChannelListContainer } from 'im.v2.component.list.container.channel';\nimport { CollabListContainer } from 'im.v2.component.list.container.collab';\nimport { CopilotListContainer } from 'im.v2.component.list.container.copilot';\nimport { OpenlineListContainer } from 'im.v2.component.list.container.openline';\nimport { RecentListContainer } from 'im.v2.component.list.container.recent';\n\nimport type { BitrixVueComponentProps } from 'ui.vue3';\nimport type { LayoutType } from 'im.v2.const';\n\ntype ComponentMap = Record<LayoutType, { list: BitrixVueComponentProps, content: BitrixVueComponentProps }>\n\nexport const LayoutComponentMap: ComponentMap = {\n\tchat: {\n\t\tlist: RecentListContainer,\n\t\tcontent: ChatContent,\n\t},\n\tcreateChat: {\n\t\tlist: RecentListContainer,\n\t\tcontent: CreateChatContent,\n\t},\n\tupdateChat: {\n\t\tlist: RecentListContainer,\n\t\tcontent: UpdateChatContent,\n\t},\n\tchannel: {\n\t\tlist: ChannelListContainer,\n\t\tcontent: ChatContent,\n\t},\n\tnotification: {\n\t\tlist: RecentListContainer,\n\t\tcontent: NotificationContent,\n\t},\n\topenlines: {\n\t\tcontent: OpenlinesContent,\n\t},\n\topenlinesV2: {\n\t\tlist: OpenlineListContainer,\n\t\tcontent: OpenlinesV2Content,\n\t},\n\tconference: {\n\t\tlist: RecentListContainer,\n\t\tcontent: ChatContent,\n\t},\n\tsettings: {\n\t\tcontent: SettingsContent,\n\t},\n\tcopilot: {\n\t\tlist: CopilotListContainer,\n\t\tcontent: ChatContent,\n\t},\n\taiAssistant: {\n\t\tlist: AiAssistantListRouter,\n\t\tcontent: ChatContent,\n\t},\n\tcollab: {\n\t\tlist: CollabListContainer,\n\t\tcontent: ChatContent,\n\t},\n\tmarket: {\n\t\tcontent: MarketContent,\n\t},\n};\n","import 'planner';\nimport 'im.integration.viewer';\nimport 'ui.design-tokens';\nimport 'ui.fonts.opensans';\nimport 'im.v2.css.tokens';\nimport 'im.v2.css.icons';\nimport 'im.v2.css.classes';\n\nimport { MessengerNavigation } from 'im.v2.component.navigation';\nimport { OpenlinesContent } from 'im.v2.component.content.openlines';\nimport { CounterManager } from 'im.v2.lib.counter';\nimport { Logger } from 'im.v2.lib.logger';\nimport { InitManager } from 'im.v2.lib.init';\nimport { Layout, type LayoutType } from 'im.v2.const';\nimport { CallManager } from 'im.v2.lib.call';\nimport { ThemeManager } from 'im.v2.lib.theme';\nimport { DesktopManager } from 'im.v2.lib.desktop';\nimport { LayoutManager } from 'im.v2.lib.layout';\nimport { NavigationManager, type NavigationMenuItemParams } from 'im.v2.lib.navigation';\n\nimport { LayoutComponentMap } from './config/component-map';\n\nimport './css/messenger.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { BitrixVueComponentProps } from 'ui.vue3';\nimport type { ImModelLayout } from 'im.v2.model';\n\n// @vue/component\nexport const Messenger = {\n\tname: 'MessengerRoot',\n\tcomponents: { MessengerNavigation, OpenlinesContent },\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\topenlinesContentOpened: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tlayout(): ImModelLayout\n\t\t{\n\t\t\treturn this.$store.getters['application/getLayout'];\n\t\t},\n\t\tlayoutName(): LayoutType\n\t\t{\n\t\t\treturn this.layout.name;\n\t\t},\n\t\tentityId(): string\n\t\t{\n\t\t\treturn this.layout.entityId;\n\t\t},\n\t\thasListComponent(): boolean\n\t\t{\n\t\t\treturn Boolean(this.listComponent);\n\t\t},\n\t\tlistComponent(): ?BitrixVueComponentProps\n\t\t{\n\t\t\treturn LayoutComponentMap[this.layoutName].list;\n\t\t},\n\t\tcontentComponent(): BitrixVueComponentProps\n\t\t{\n\t\t\treturn LayoutComponentMap[this.layoutName].content;\n\t\t},\n\t\tisOpenline(): boolean\n\t\t{\n\t\t\treturn this.layout.name === Layout.openlines;\n\t\t},\n\t\tcontainerClasses(): string[]\n\t\t{\n\t\t\treturn {\n\t\t\t\t'--dark-theme': ThemeManager.isDarkTheme(),\n\t\t\t\t'--light-theme': ThemeManager.isLightTheme(),\n\t\t\t\t'--desktop': DesktopManager.isDesktop(),\n\t\t\t\t'--air': LayoutManager.getInstance().isAirDesignEnabled(),\n\t\t\t};\n\t\t},\n\t\tcallContainerClass(): string[]\n\t\t{\n\t\t\treturn [CallManager.viewContainerClass];\n\t\t},\n\t\thasNavigation(): boolean\n\t\t{\n\t\t\tconst hasNavigation = !LayoutManager.getInstance().isAirDesignEnabled();\n\n\t\t\treturn hasNavigation ?? true;\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tlayoutName:\n\t\t{\n\t\t\thandler(newLayoutName)\n\t\t\t{\n\t\t\t\tif (newLayoutName !== Layout.openlines)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.openlinesContentOpened = true;\n\t\t\t},\n\t\t\timmediate: true,\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tInitManager.start();\n\t\t// emit again because external code expects to receive it after the messenger is opened (not via quick-access).\n\t\tCounterManager.getInstance().emitCounters();\n\t\tLayoutManager.init();\n\t\tLogger.warn('MessengerRoot created');\n\n\t\tvoid this.getLayoutManager().prepareInitialLayout();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.getLayoutManager().destroy();\n\t},\n\tmethods:\n\t{\n\t\tonNavigationClick(payload: NavigationMenuItemParams)\n\t\t{\n\t\t\tNavigationManager.open(payload);\n\t\t},\n\t\tonEntitySelect({ layoutName, entityId })\n\t\t{\n\t\t\tvoid this.getLayoutManager().setLayout({ name: layoutName, entityId });\n\t\t},\n\t\tgetLayoutManager(): LayoutManager\n\t\t{\n\t\t\treturn LayoutManager.getInstance();\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-messenger__scope bx-im-messenger__container\" :class=\"containerClasses\">\n\t\t\t<MessengerNavigation\n\t\t\t\tv-if=\"hasNavigation\"\n\t\t\t\t:currentLayoutName=\"layoutName\" \n\t\t\t\t@navigationClick=\"onNavigationClick\"\n\t\t\t/>\n\t\t\t<div class=\"bx-im-messenger__layout_container\">\n\t\t\t\t<div class=\"bx-im-messenger__layout_content\">\n\t\t\t\t\t<div v-if=\"hasListComponent\" class=\"bx-im-messenger__list_container\">\n\t\t\t\t\t\t<KeepAlive>\n\t\t\t\t\t\t\t<component :is=\"listComponent\" @selectEntity=\"onEntitySelect\" />\n\t\t\t\t\t\t</KeepAlive>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bx-im-messenger__content_container\" :class=\"{'--with-list': hasListComponent}\">\n\t\t\t\t\t\t<div v-if=\"openlinesContentOpened\" class=\"bx-im-messenger__openlines_container\" :class=\"{'--hidden': !isOpenline}\">\n\t\t\t\t\t\t\t<OpenlinesContent v-show=\"isOpenline\" :entityId=\"entityId\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<component v-if=\"!isOpenline\" :is=\"contentComponent\" :entityId=\"entityId\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div :class=\"callContainerClass\"></div>\n\t`,\n};\n"],"names":["LayoutComponentMap","chat","list","RecentListContainer","content","ChatContent","createChat","CreateChatContent","updateChat","UpdateChatContent","channel","ChannelListContainer","notification","NotificationContent","openlines","OpenlinesContent","openlinesV2","OpenlineListContainer","OpenlinesV2Content","conference","settings","SettingsContent","copilot","CopilotListContainer","aiAssistant","AiAssistantListRouter","collab","CollabListContainer","market","MarketContent","Messenger","name","components","MessengerNavigation","data","openlinesContentOpened","computed","layout","$store","getters","layoutName","entityId","hasListComponent","Boolean","listComponent","contentComponent","isOpenline","Layout","containerClasses","ThemeManager","isDarkTheme","isLightTheme","DesktopManager","isDesktop","LayoutManager","getInstance","isAirDesignEnabled","callContainerClass","CallManager","viewContainerClass","hasNavigation","watch","handler","newLayoutName","immediate","created","InitManager","start","CounterManager","emitCounters","init","Logger","warn","getLayoutManager","prepareInitialLayout","beforeUnmount","destroy","methods","onNavigationClick","payload","NavigationManager","open","onEntitySelect","setLayout","template"],"mappings":"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"}