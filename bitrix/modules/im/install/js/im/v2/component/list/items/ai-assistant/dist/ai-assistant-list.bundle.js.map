{"version":3,"file":"ai-assistant-list.bundle.js","sources":["../src/classes/recent-service.js","../src/classes/context-menu-manager.js","../src/ai-assistant-list.js"],"sourcesContent":["import { RestMethod } from 'im.v2.const';\nimport { BaseRecentService } from 'im.v2.provider.service.recent';\n\nexport class AiAssistantRecentService extends BaseRecentService\n{\n\tgetRestMethodName(): string\n\t{\n\t\treturn RestMethod.imV2RecentAiAssistantTail;\n\t}\n\n\tgetRecentSaveActionName(): string\n\t{\n\t\treturn 'recent/setAiAssistant';\n\t}\n}\n","import { RecentMenu } from 'im.v2.lib.menu';\n\nimport type { MenuItemOptions } from 'ui.system.menu';\n\nexport class AiAssistantRecentMenu extends RecentMenu\n{\n\tgetMenuItems(): MenuItemOptions[]\n\t{\n\t\treturn [\n\t\t\tthis.getUnreadMessageItem(),\n\t\t\tthis.getPinMessageItem(),\n\t\t\tthis.getMuteItem(),\n\t\t\tthis.getHideItem(),\n\t\t\tthis.getLeaveItem(),\n\t\t];\n\t}\n}\n","import { DraftManager } from 'im.v2.lib.draft';\nimport { Utils } from 'im.v2.lib.utils';\nimport { ListLoadingState as LoadingState } from 'im.v2.component.elements.list-loading-state';\nimport { RecentItem } from 'im.v2.component.list.items.recent';\n\nimport { AiAssistantRecentService } from './classes/recent-service';\nimport { AiAssistantRecentMenu } from './classes/context-menu-manager';\n\nimport './css/ai-assistant-list.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelRecentItem } from 'im.v2.model';\n\n// @vue/component\nexport const AiAssistantList = {\n\tname: 'AiAssistantList',\n\tcomponents: { RecentItem, LoadingState },\n\temits: ['chatClick'],\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisLoading: false,\n\t\t\tisLoadingNextPage: false,\n\t\t};\n\t},\n\tcomputed: {\n\t\tcollection(): ImModelRecentItem[]\n\t\t{\n\t\t\treturn this.$store.getters['recent/getAiAssistantCollection'];\n\t\t},\n\t\tsortedItems(): ImModelRecentItem[]\n\t\t{\n\t\t\treturn [...this.collection].sort((a, b) => {\n\t\t\t\tconst firstDate = this.$store.getters['recent/getSortDate'](a.dialogId);\n\t\t\t\tconst secondDate = this.$store.getters['recent/getSortDate'](b.dialogId);\n\n\t\t\t\treturn secondDate - firstDate;\n\t\t\t});\n\t\t},\n\t\tpinnedItems(): ImModelRecentItem[]\n\t\t{\n\t\t\treturn this.sortedItems.filter((item) => {\n\t\t\t\treturn item.pinned === true;\n\t\t\t});\n\t\t},\n\t\tgeneralItems(): ImModelRecentItem[]\n\t\t{\n\t\t\treturn this.sortedItems.filter((item) => {\n\t\t\t\treturn item.pinned === false;\n\t\t\t});\n\t\t},\n\t\tisEmptyCollection(): boolean\n\t\t{\n\t\t\treturn this.collection.length === 0;\n\t\t},\n\t},\n\tasync created()\n\t{\n\t\tthis.contextMenuManager = new AiAssistantRecentMenu();\n\n\t\tthis.isLoading = true;\n\t\tawait this.getRecentService().loadFirstPage();\n\t\tthis.isLoading = false;\n\t\tvoid DraftManager.getInstance().initDraftHistory();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.contextMenuManager.destroy();\n\t},\n\tmethods: {\n\t\tasync onScroll(event: Event)\n\t\t{\n\t\t\tthis.contextMenuManager.close();\n\t\t\tif (!Utils.dom.isOneScreenRemaining(event.target) || !this.getRecentService().hasMoreItemsToLoad())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoadingNextPage = true;\n\t\t\tawait this.getRecentService().loadNextPage();\n\t\t\tthis.isLoadingNextPage = false;\n\t\t},\n\t\tonClick(item)\n\t\t{\n\t\t\tthis.$emit('chatClick', item.dialogId);\n\t\t},\n\t\tonRightClick(item: ImModelRecentItem, event: PointerEvent)\n\t\t{\n\t\t\tevent.preventDefault();\n\n\t\t\tconst context = {\n\t\t\t\tdialogId: item.dialogId,\n\t\t\t\trecentItem: item,\n\t\t\t};\n\t\t\tthis.contextMenuManager.openMenu(context, event.currentTarget);\n\t\t},\n\t\tgetRecentService(): AiAssistantRecentService\n\t\t{\n\t\t\tif (!this.service)\n\t\t\t{\n\t\t\t\tthis.service = new AiAssistantRecentService();\n\t\t\t}\n\n\t\t\treturn this.service;\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-list-ai-assistant__container\">\n\t\t\t<LoadingState v-if=\"isLoading && isEmptyCollection\" />\n\t\t\t<div v-else @scroll=\"onScroll\" class=\"bx-im-list-ai-assistant__scroll-container\">\n\t\t\t\t<div v-if=\"isEmptyCollection\" class=\"bx-im-list-ai-assistant__empty\">\n\t\t\t\t\t<div class=\"bx-im-list-ai-assistant__empty_icon\"></div>\n\t\t\t\t\t<div class=\"bx-im-list-ai-assistant__empty_text\">\n\t\t\t\t\t\t{{ loc('IM_LIST_COPILOT_EMPTY') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-if=\"pinnedItems.length > 0\" class=\"bx-im-list-ai-assistant__pinned_container\">\n\t\t\t\t\t<RecentItem\n\t\t\t\t\t\tv-for=\"item in pinnedItems\"\n\t\t\t\t\t\t:key=\"item.dialogId\"\n\t\t\t\t\t\t:item=\"item\"\n\t\t\t\t\t\t@click=\"onClick(item, $event)\"\n\t\t\t\t\t\t@click.right=\"onRightClick(item, $event)\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-list-ai-assistant__general_container\">\n\t\t\t\t\t<RecentItem\n\t\t\t\t\t\tv-for=\"item in generalItems\"\n\t\t\t\t\t\t:key=\"item.dialogId\"\n\t\t\t\t\t\t:item=\"item\"\n\t\t\t\t\t\t@click=\"onClick(item, $event)\"\n\t\t\t\t\t\t@click.right=\"onRightClick(item, $event)\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<LoadingState v-if=\"isLoadingNextPage\" />\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n"],"names":["AiAssistantRecentService","BaseRecentService","getRestMethodName","RestMethod","imV2RecentAiAssistantTail","getRecentSaveActionName","AiAssistantRecentMenu","RecentMenu","getMenuItems","getUnreadMessageItem","getPinMessageItem","getMuteItem","getHideItem","getLeaveItem","AiAssistantList","name","components","RecentItem","LoadingState","emits","data","isLoading","isLoadingNextPage","computed","collection","$store","getters","sortedItems","sort","a","b","firstDate","dialogId","secondDate","pinnedItems","filter","item","pinned","generalItems","isEmptyCollection","length","created","contextMenuManager","getRecentService","loadFirstPage","DraftManager","getInstance","initDraftHistory","beforeUnmount","destroy","methods","onScroll","event","close","Utils","dom","isOneScreenRemaining","target","hasMoreItemsToLoad","loadNextPage","onClick","$emit","onRightClick","preventDefault","context","recentItem","openMenu","currentTarget","service","loc","phraseCode","$Bitrix","Loc","getMessage","template"],"mappings":"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"}