{"version":3,"file":"collab-list.bundle.js","sources":["../src/components/empty-state.js","../src/classes/collab-service.js","../src/classes/context-menu-manager.js","../src/collab-list.js"],"sourcesContent":["// @vue/component\nexport const EmptyState = {\n\tname: 'EmptyState',\n\tmethods:\n\t{\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-list-collab__empty\">\n\t\t\t<div class=\"bx-im-list-collab__empty_icon\"></div>\n\t\t\t<div class=\"bx-im-list-collab__empty_text\">\n\t\t\t\t{{ loc('IM_LIST_COLLAB_EMPTY_V2') }}\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { RestMethod } from 'im.v2.const';\nimport { BaseRecentService } from 'im.v2.provider.service.recent';\n\nexport class CollabService extends BaseRecentService\n{\n\tgetRestMethodName(): string\n\t{\n\t\treturn RestMethod.imV2RecentCollabTail;\n\t}\n\n\tgetRecentSaveActionName(): string\n\t{\n\t\treturn 'recent/setCollab';\n\t}\n}\n","import { RecentMenu } from 'im.v2.lib.menu';\n\nimport type { MenuItemOptions } from 'ui.system.menu';\n\nexport class CollabRecentMenu extends RecentMenu\n{\n\tgetMenuItems(): MenuItemOptions[]\n\t{\n\t\treturn [\n\t\t\tthis.getUnreadMessageItem(),\n\t\t\tthis.getPinMessageItem(),\n\t\t\tthis.getMuteItem(),\n\t\t];\n\t}\n}\n","import { DraftManager } from 'im.v2.lib.draft';\nimport { Utils } from 'im.v2.lib.utils';\nimport { ListLoadingState as LoadingState } from 'im.v2.component.elements.list-loading-state';\nimport { RecentItem } from 'im.v2.component.list.items.recent';\n\nimport { EmptyState } from './components/empty-state';\nimport { CollabService } from './classes/collab-service';\nimport { CollabRecentMenu } from './classes/context-menu-manager';\n\nimport './css/collab-list.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelRecentItem } from 'im.v2.model';\n\n// @vue/component\nexport const CollabList = {\n\tname: 'CollabList',\n\tcomponents: { EmptyState, LoadingState, RecentItem },\n\temits: ['chatClick'],\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisLoading: false,\n\t\t\tisLoadingNextPage: false,\n\t\t\tfirstPageLoaded: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tcollection(): ImModelRecentItem[]\n\t\t{\n\t\t\treturn this.$store.getters['recent/getCollabCollection'];\n\t\t},\n\t\tpreparedItems(): ImModelRecentItem[]\n\t\t{\n\t\t\treturn [...this.collection].sort((a, b) => {\n\t\t\t\tconst firstDate: Date = this.$store.getters['recent/getSortDate'](a.dialogId);\n\t\t\t\tconst secondDate: Date = this.$store.getters['recent/getSortDate'](b.dialogId);\n\n\t\t\t\treturn secondDate - firstDate;\n\t\t\t});\n\t\t},\n\t\tpinnedItems(): ImModelRecentItem[]\n\t\t{\n\t\t\treturn this.preparedItems.filter((item) => {\n\t\t\t\treturn item.pinned === true;\n\t\t\t});\n\t\t},\n\t\tgeneralItems(): ImModelRecentItem[]\n\t\t{\n\t\t\treturn this.preparedItems.filter((item) => {\n\t\t\t\treturn item.pinned === false;\n\t\t\t});\n\t\t},\n\t\tisEmptyCollection(): boolean\n\t\t{\n\t\t\treturn this.collection.length === 0;\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.contextMenuManager = new CollabRecentMenu();\n\t\tvoid DraftManager.getInstance().initDraftHistory();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.contextMenuManager.destroy();\n\t},\n\tasync activated()\n\t{\n\t\tthis.isLoading = true;\n\t\tawait this.getRecentService().loadFirstPage();\n\t\tthis.firstPageLoaded = true;\n\t\tthis.isLoading = false;\n\t},\n\tmethods:\n\t{\n\t\tasync onScroll(event: Event)\n\t\t{\n\t\t\tthis.contextMenuManager.close();\n\t\t\tif (!Utils.dom.isOneScreenRemaining(event.target) || !this.getRecentService().hasMoreItemsToLoad())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoadingNextPage = true;\n\t\t\tawait this.getRecentService().loadNextPage();\n\t\t\tthis.isLoadingNextPage = false;\n\t\t},\n\t\tonClick(item: ImModelRecentItem)\n\t\t{\n\t\t\tthis.$emit('chatClick', item.dialogId);\n\t\t},\n\t\tonRightClick(item: ImModelRecentItem, event: PointerEvent)\n\t\t{\n\t\t\tevent.preventDefault();\n\n\t\t\tconst context = {\n\t\t\t\tdialogId: item.dialogId,\n\t\t\t\trecentItem: item,\n\t\t\t};\n\t\t\tthis.contextMenuManager.openMenu(context, event.currentTarget);\n\t\t},\n\t\tgetRecentService(): CollabService\n\t\t{\n\t\t\tif (!this.service)\n\t\t\t{\n\t\t\t\tthis.service = new CollabService();\n\t\t\t}\n\n\t\t\treturn this.service;\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-list-collab__container\">\n\t\t\t<LoadingState v-if=\"isLoading && !firstPageLoaded\" />\n\t\t\t<div v-else @scroll=\"onScroll\" class=\"bx-im-list-collab__scroll-container\">\n\t\t\t\t<EmptyState v-if=\"isEmptyCollection\" />\n\t\t\t\t<div v-if=\"pinnedItems.length > 0\" class=\"bx-im-list-collab__pinned_container\">\n\t\t\t\t\t<RecentItem\n\t\t\t\t\t\tv-for=\"item in pinnedItems\"\n\t\t\t\t\t\t:key=\"item.dialogId\"\n\t\t\t\t\t\t:item=\"item\"\n\t\t\t\t\t\t@click=\"onClick(item)\"\n\t\t\t\t\t\t@click.right=\"onRightClick(item, $event)\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-list-collab__general_container\">\n\t\t\t\t\t<RecentItem\n\t\t\t\t\t\tv-for=\"item in generalItems\"\n\t\t\t\t\t\t:key=\"item.dialogId\"\n\t\t\t\t\t\t:item=\"item\"\n\t\t\t\t\t\t@click=\"onClick(item)\"\n\t\t\t\t\t\t@click.right=\"onRightClick(item, $event)\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<LoadingState v-if=\"isLoadingNextPage\" />\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n"],"names":["EmptyState","name","methods","loc","phraseCode","$Bitrix","Loc","getMessage","template","CollabService","BaseRecentService","getRestMethodName","RestMethod","imV2RecentCollabTail","getRecentSaveActionName","CollabRecentMenu","RecentMenu","getMenuItems","getUnreadMessageItem","getPinMessageItem","getMuteItem","CollabList","components","LoadingState","RecentItem","emits","data","isLoading","isLoadingNextPage","firstPageLoaded","computed","collection","$store","getters","preparedItems","sort","a","b","firstDate","dialogId","secondDate","pinnedItems","filter","item","pinned","generalItems","isEmptyCollection","length","created","contextMenuManager","DraftManager","getInstance","initDraftHistory","beforeUnmount","destroy","activated","getRecentService","loadFirstPage","onScroll","event","close","Utils","dom","isOneScreenRemaining","target","hasMoreItemsToLoad","loadNextPage","onClick","$emit","onRightClick","preventDefault","context","recentItem","openMenu","currentTarget","service"],"mappings":"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"}