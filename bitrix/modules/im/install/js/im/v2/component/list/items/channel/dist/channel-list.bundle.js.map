{"version":3,"file":"channel-list.bundle.js","sources":["../src/components/channel-item/components/message-text.js","../src/components/channel-item/channel-item.js","../src/components/empty-state.js","../src/classes/channel-service.js","../src/classes/pull-watch-manager.js","../src/classes/context-menu-manager.js","../src/channel-list.js"],"sourcesContent":["import { DateFormatter, DateTemplate } from 'im.v2.lib.date-formatter';\nimport { Core } from 'im.v2.application.core';\nimport { AvatarSize, MessageAvatar } from 'im.v2.component.elements.avatar';\nimport { Utils } from 'im.v2.lib.utils';\nimport { Parser } from 'im.v2.lib.parser';\n\nimport type { ImModelChat, ImModelRecentItem, ImModelMessage, ImModelUser } from 'im.v2.model';\n\n// @vue/component\nexport const MessageText = {\n\tname: 'MessageText',\n\tcomponents: { MessageAvatar },\n\tprops:\n\t{\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\trecentItem(): ImModelRecentItem\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.recentItem.dialogId, true);\n\t\t},\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.$store.getters['recent/getMessage'](this.recentItem.dialogId);\n\t\t},\n\t\tformattedDate(): string\n\t\t{\n\t\t\treturn this.formatDate(this.message.date);\n\t\t},\n\t\tisLastMessageAuthor(): boolean\n\t\t{\n\t\t\treturn this.message.authorId === Core.getUserId();\n\t\t},\n\t\tlastMessageAuthorAvatar(): string\n\t\t{\n\t\t\tconst author: ImModelUser = this.$store.getters['users/get'](this.message.authorId);\n\n\t\t\tif (!author)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\treturn author.avatar;\n\t\t},\n\t\tlastMessageAuthorAvatarStyle(): Object\n\t\t{\n\t\t\treturn { backgroundImage: `url('${this.lastMessageAuthorAvatar}')` };\n\t\t},\n\t\tmessageText(): string\n\t\t{\n\t\t\tif (this.message.isDeleted)\n\t\t\t{\n\t\t\t\treturn this.loc('IM_LIST_RECENT_DELETED_MESSAGE');\n\t\t\t}\n\n\t\t\tconst formattedText = Parser.purifyRecent(this.recentItem);\n\t\t\tif (!formattedText)\n\t\t\t{\n\t\t\t\treturn this.loc('IM_LIST_RECENT_CHAT_TYPE_GROUP_V2');\n\t\t\t}\n\n\t\t\treturn formattedText;\n\t\t},\n\t\tformattedMessageText(): string\n\t\t{\n\t\t\tconst SPLIT_INDEX = 27;\n\n\t\t\treturn Utils.text.insertUnseenWhitespace(this.messageText, SPLIT_INDEX);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tformatDate(date): string\n\t\t{\n\t\t\treturn DateFormatter.formatByTemplate(date, DateTemplate.recent);\n\t\t},\n\t\tloc(phraseCode: string, replacements: {[string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-list-channel-item__message_container\">\n\t\t\t<span class=\"bx-im-list-channel-item__message_text\">\n\t\t\t\t<span v-if=\"isLastMessageAuthor\" class=\"bx-im-list-channel-item__message_author-icon --self\"></span>\n\t\t\t\t<MessageAvatar\n\t\t\t\t\tv-else-if=\"message.authorId\"\n\t\t\t\t\t:messageId=\"message.id\"\n\t\t\t\t\t:authorId=\"message.authorId\"\n\t\t\t\t\t:size=\"AvatarSize.XXS\"\n\t\t\t\t\tclass=\"bx-im-list-channel-item__message_author-avatar\"\n\t\t\t\t/>\n\t\t\t\t<span class=\"bx-im-list-channel-item__message_text_content\">{{ formattedMessageText }}</span>\n\t\t\t</span>\n\t\t</div>\n\t`,\n};\n","import 'main.date';\n\nimport { Core } from 'im.v2.application.core';\nimport { ChatType, Settings, Layout } from 'im.v2.const';\nimport { ChatAvatar, AvatarSize } from 'im.v2.component.elements.avatar';\nimport { ChatTitle } from 'im.v2.component.elements.chat-title';\n\nimport { MessageText } from './components/message-text';\nimport { DateFormatter, DateTemplate } from 'im.v2.lib.date-formatter';\n\nimport './css/channel-item.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelRecentItem, ImModelChat, ImModelMessage } from 'im.v2.model';\n\n// @vue/component\nexport const ChannelItem = {\n\tname: 'ChannelItem',\n\tcomponents: { ChatAvatar, ChatTitle, MessageText },\n\tprops: {\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {};\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\trecentItem(): ImModelRecentItem\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tformattedDate(): string\n\t\t{\n\t\t\tif (this.needsBirthdayPlaceholder)\n\t\t\t{\n\t\t\t\treturn this.loc('IM_LIST_RECENT_BIRTHDAY_DATE');\n\t\t\t}\n\n\t\t\treturn this.formatDate(this.message.date);\n\t\t},\n\t\tformattedCounter(): string\n\t\t{\n\t\t\treturn this.dialog.counter > 99 ? '99+' : this.dialog.counter.toString();\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.recentItem.dialogId, true);\n\t\t},\n\t\tlayout(): { name: string, entityId: string }\n\t\t{\n\t\t\treturn this.$store.getters['application/getLayout'];\n\t\t},\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.$store.getters['recent/getMessage'](this.recentItem.dialogId);\n\t\t},\n\t\tisUser(): boolean\n\t\t{\n\t\t\treturn this.dialog.type === ChatType.user;\n\t\t},\n\t\tisChat(): boolean\n\t\t{\n\t\t\treturn !this.isUser;\n\t\t},\n\t\tisChatSelected(): boolean\n\t\t{\n\t\t\tif (this.layout.name !== Layout.channel)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.layout.entityId === this.recentItem.dialogId;\n\t\t},\n\t\tisChatMuted(): boolean\n\t\t{\n\t\t\tif (this.isUser)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst isMuted = this.dialog.muteList.find((element) => {\n\t\t\t\treturn element === Core.getUserId();\n\t\t\t});\n\n\t\t\treturn Boolean(isMuted);\n\t\t},\n\t\tneedsBirthdayPlaceholder(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['recent/needsBirthdayPlaceholder'](this.recentItem.dialogId);\n\t\t},\n\t\tshowLastMessage(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['application/settings/get'](Settings.recent.showLastMessage);\n\t\t},\n\t\tinvitation(): { isActive: boolean, originator: number, canResend: boolean }\n\t\t{\n\t\t\treturn this.recentItem.invitation;\n\t\t},\n\t\twrapClasses(): { [string]: boolean }\n\t\t{\n\t\t\treturn {\n\t\t\t\t'--selected': this.isChatSelected,\n\t\t\t};\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tformatDate(date): string\n\t\t{\n\t\t\treturn DateFormatter.formatByTemplate(date, DateTemplate.recent);\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div :data-id=\"recentItem.dialogId\" :class=\"wrapClasses\" class=\"bx-im-list-channel-item__wrap\">\n\t\t\t<div class=\"bx-im-list-channel-item__container\">\n\t\t\t\t<div class=\"bx-im-list-channel-item__avatar_container\">\n\t\t\t\t\t<div class=\"bx-im-list-channel-item__avatar_content\">\n\t\t\t\t\t\t<ChatAvatar \n\t\t\t\t\t\t\t:avatarDialogId=\"recentItem.dialogId\" \n\t\t\t\t\t\t\t:contextDialogId=\"recentItem.dialogId\"\n\t\t\t\t\t\t\t:size=\"AvatarSize.XL\" \n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-list-channel-item__content_container\">\n\t\t\t\t\t<div class=\"bx-im-list-channel-item__content_header\">\n\t\t\t\t\t\t<ChatTitle :dialogId=\"recentItem.dialogId\" />\n\t\t\t\t\t\t<div class=\"bx-im-list-channel-item__date\">\n\t\t\t\t\t\t\t<span>{{ formattedDate }}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bx-im-list-channel-item__content_bottom\">\n\t\t\t\t\t\t<MessageText :item=\"recentItem\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import type { JsonObject } from 'main.core';\n\n// @vue/component\nexport const EmptyState = {\n\tname: 'EmptyState',\n\tdata(): JsonObject\n\t{\n\t\treturn {};\n\t},\n\tmethods:\n\t{\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-list-channel__empty\">\n\t\t\t<div class=\"bx-im-list-channel__empty_icon\"></div>\n\t\t\t<div class=\"bx-im-list-channel__empty_text\">{{ loc('IM_LIST_CHANNEL_EMPTY') }}</div>\n\t\t</div>\n\t`,\n};\n","import { Core } from 'im.v2.application.core';\nimport { RestMethod } from 'im.v2.const';\nimport { BaseRecentService, type RecentRestResult } from 'im.v2.provider.service.recent';\n\nimport type { RawMessage } from 'im.v2.provider.service.types';\n\nexport class ChannelService extends BaseRecentService\n{\n\t#lastMessageId: number = 0;\n\n\tgetRestMethodName(): string\n\t{\n\t\treturn RestMethod.imV2RecentChannelTail;\n\t}\n\n\tgetRecentSaveActionName(): string\n\t{\n\t\treturn 'recent/setChannel';\n\t}\n\n\tgetRequestFilter(firstPage: boolean = false): Record\n\t{\n\t\treturn {\n\t\t\tlastMessageId: firstPage ? null : this.#lastMessageId,\n\t\t};\n\t}\n\n\tonAfterRequest(firstPage: boolean): void\n\t{\n\t\tif (!firstPage)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid Core.getStore().dispatch('recent/clearChannelCollection');\n\t}\n\n\thandlePaginationField(result: RecentRestResult): void\n\t{\n\t\tconst { messages } = result;\n\t\tthis.#lastMessageId = this.#getMinMessageId(messages);\n\t}\n\n\t#getMinMessageId(messages: RawMessage[]): number\n\t{\n\t\tif (messages.length === 0)\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\n\t\tconst firstMessageId = messages[0].id;\n\n\t\treturn messages.reduce((minId, nextMessage) => {\n\t\t\treturn Math.min(minId, nextMessage.id);\n\t\t}, firstMessageId);\n\t}\n}\n","import { Core } from 'im.v2.application.core';\nimport { RestMethod } from 'im.v2.const';\nimport { runAction } from 'im.v2.lib.rest';\n\nimport type { PULL as Pull } from 'pull.client';\n\nconst TAG = 'IM_SHARED_CHANNEL_LIST';\n\nexport class PullWatchManager\n{\n\t#pullClient: Pull;\n\n\tconstructor()\n\t{\n\t\tthis.#pullClient = Core.getPullClient();\n\t}\n\n\tsubscribe(): void\n\t{\n\t\tthis.#pullClient.extendWatch(TAG);\n\t\tthis.#requestWatchStart();\n\t}\n\n\tunsubscribe(): void\n\t{\n\t\tthis.#pullClient.clearWatch(TAG);\n\t}\n\n\t#requestWatchStart(): void\n\t{\n\t\tvoid runAction(RestMethod.imV2RecentChannelExtendPullWatch);\n\t}\n}\n","import { Loc } from 'main.core';\n\nimport { Layout } from 'im.v2.const';\nimport { LayoutManager } from 'im.v2.lib.layout';\nimport { RecentMenu } from 'im.v2.lib.menu';\n\nimport type { MenuItemOptions } from 'ui.system.menu';\n\nexport class ChannelRecentMenu extends RecentMenu\n{\n\tgetMenuItems(): MenuItemOptions[]\n\t{\n\t\treturn [\n\t\t\tthis.getOpenItem(),\n\t\t];\n\t}\n\n\tgetOpenItem(): MenuItemOptions\n\t{\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_LIB_MENU_OPEN'),\n\t\t\tonClick: () => {\n\t\t\t\tvoid LayoutManager.getInstance().setLayout({\n\t\t\t\t\tname: Layout.channel,\n\t\t\t\t\tentityId: this.context.dialogId,\n\t\t\t\t});\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n}\n","import { Utils } from 'im.v2.lib.utils';\nimport { ListLoadingState as LoadingState } from 'im.v2.component.elements.list-loading-state';\n\nimport { ChannelItem } from './components/channel-item/channel-item';\nimport { EmptyState } from './components/empty-state';\nimport { ChannelService } from './classes/channel-service';\nimport { PullWatchManager } from './classes/pull-watch-manager';\nimport { ChannelRecentMenu } from './classes/context-menu-manager';\n\nimport './css/channel-list.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelRecentItem, ImModelMessage } from 'im.v2.model';\n\n// @vue/component\nexport const ChannelList = {\n\tname: 'ChannelList',\n\tcomponents: { EmptyState, LoadingState, ChannelItem },\n\temits: ['chatClick'],\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisLoading: false,\n\t\t\tisLoadingNextPage: false,\n\t\t\tfirstPageLoaded: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tcollection(): ImModelRecentItem[]\n\t\t{\n\t\t\treturn this.$store.getters['recent/getChannelCollection'];\n\t\t},\n\t\tpreparedItems(): ImModelRecentItem[]\n\t\t{\n\t\t\treturn [...this.collection].sort((a, b) => {\n\t\t\t\tconst firstMessage: ImModelMessage = this.$store.getters['messages/getById'](a.messageId);\n\t\t\t\tconst secondMessage: ImModelMessage = this.$store.getters['messages/getById'](b.messageId);\n\n\t\t\t\treturn secondMessage.date - firstMessage.date;\n\t\t\t});\n\t\t},\n\t\tisEmptyCollection(): boolean\n\t\t{\n\t\t\treturn this.collection.length === 0;\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.contextMenuManager = new ChannelRecentMenu();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.contextMenuManager.destroy();\n\t},\n\tasync activated()\n\t{\n\t\tthis.isLoading = true;\n\t\tawait this.getRecentService().loadFirstPage();\n\t\tthis.firstPageLoaded = true;\n\t\tthis.isLoading = false;\n\t\tthis.getPullWatchManager().subscribe();\n\t},\n\tdeactivated()\n\t{\n\t\tthis.getPullWatchManager().unsubscribe();\n\t},\n\tmethods:\n\t{\n\t\tasync onScroll(event: Event)\n\t\t{\n\t\t\tthis.contextMenuManager.close();\n\t\t\tif (!Utils.dom.isOneScreenRemaining(event.target) || !this.getRecentService().hasMoreItemsToLoad())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoadingNextPage = true;\n\t\t\tawait this.getRecentService().loadNextPage();\n\t\t\tthis.isLoadingNextPage = false;\n\t\t},\n\t\tonClick(item: ImModelRecentItem)\n\t\t{\n\t\t\tthis.$emit('chatClick', item.dialogId);\n\t\t},\n\t\tonRightClick(item: ImModelRecentItem, event: PointerEvent)\n\t\t{\n\t\t\tevent.preventDefault();\n\t\t\tconst context = {\n\t\t\t\tdialogId: item.dialogId,\n\t\t\t\trecentItem: item,\n\t\t\t};\n\t\t\tthis.contextMenuManager.openMenu(context, event.currentTarget);\n\t\t},\n\t\tgetRecentService(): ChannelService\n\t\t{\n\t\t\tif (!this.service)\n\t\t\t{\n\t\t\t\tthis.service = new ChannelService();\n\t\t\t}\n\n\t\t\treturn this.service;\n\t\t},\n\t\tgetPullWatchManager(): PullWatchManager\n\t\t{\n\t\t\tif (!this.pullWatchManager)\n\t\t\t{\n\t\t\t\tthis.pullWatchManager = new PullWatchManager();\n\t\t\t}\n\n\t\t\treturn this.pullWatchManager;\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-list-channel__container\">\n\t\t\t<LoadingState v-if=\"isLoading && !firstPageLoaded\" />\n\t\t\t<div v-else @scroll=\"onScroll\" class=\"bx-im-list-channel__scroll-container\">\n\t\t\t\t<EmptyState v-if=\"isEmptyCollection\" />\n\t\t\t\t<div class=\"bx-im-list-channel__general_container\">\n\t\t\t\t\t<ChannelItem\n\t\t\t\t\t\tv-for=\"item in preparedItems\"\n\t\t\t\t\t\t:key=\"item.dialogId\"\n\t\t\t\t\t\t:item=\"item\"\n\t\t\t\t\t\t@click=\"onClick(item)\"\n\t\t\t\t\t\t@click.right=\"onRightClick(item, $event)\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<LoadingState v-if=\"isLoadingNextPage\" />\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n"],"names":["MessageText","name","components","MessageAvatar","props","item","type","Object","required","computed","AvatarSize","recentItem","dialog","$store","getters","dialogId","message","formattedDate","formatDate","date","isLastMessageAuthor","authorId","Core","getUserId","lastMessageAuthorAvatar","author","avatar","lastMessageAuthorAvatarStyle","backgroundImage","messageText","isDeleted","loc","formattedText","Parser","purifyRecent","formattedMessageText","SPLIT_INDEX","Utils","text","insertUnseenWhitespace","methods","DateFormatter","formatByTemplate","DateTemplate","recent","phraseCode","replacements","$Bitrix","Loc","getMessage","template","ChannelItem","ChatAvatar","ChatTitle","data","needsBirthdayPlaceholder","formattedCounter","counter","toString","layout","isUser","ChatType","user","isChat","isChatSelected","Layout","channel","entityId","isChatMuted","isMuted","muteList","find","element","Boolean","showLastMessage","Settings","invitation","wrapClasses","EmptyState","ChannelService","BaseRecentService","getRestMethodName","RestMethod","imV2RecentChannelTail","getRecentSaveActionName","getRequestFilter","firstPage","lastMessageId","onAfterRequest","getStore","dispatch","handlePaginationField","result","messages","length","firstMessageId","id","reduce","minId","nextMessage","Math","min","TAG","PullWatchManager","constructor","getPullClient","subscribe","extendWatch","unsubscribe","clearWatch","runAction","imV2RecentChannelExtendPullWatch","ChannelRecentMenu","RecentMenu","getMenuItems","getOpenItem","title","onClick","LayoutManager","getInstance","setLayout","context","menuInstance","close","ChannelList","LoadingState","emits","isLoading","isLoadingNextPage","firstPageLoaded","collection","preparedItems","sort","a","b","firstMessage","messageId","secondMessage","isEmptyCollection","created","contextMenuManager","beforeUnmount","destroy","activated","getRecentService","loadFirstPage","getPullWatchManager","deactivated","onScroll","event","dom","isOneScreenRemaining","target","hasMoreItemsToLoad","loadNextPage","$emit","onRightClick","preventDefault","openMenu","currentTarget","service","pullWatchManager"],"mappings":"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"}