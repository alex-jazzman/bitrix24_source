{"version":3,"file":"service.bundle.js","sources":["../src/service.js","../src/service-manager.js"],"sourcesContent":["import { Extension, Type } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\n\nexport class Service extends EventEmitter\n{\n\t#code: string;\n\t#available: boolean = false;\n\t#active: boolean = false;\n\n\tconstructor(code: string)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Baas');\n\t\tthis.#code = code;\n\t\tconst props = Extension.getSettings('baas.service').services[this.#code];\n\t\tif (Type.isPlainObject(props))\n\t\t{\n\t\t\tthis.#available = props.isAvailable;\n\t\t\tthis.#active = props.isActive;\n\t\t}\n\n\t\tif (BX.PULL && Extension.getSettings('baas.service').pull)\n\t\t{\n\t\t\tBX.PULL.extendWatch(Extension.getSettings('baas.service').pull.channelName);\n\n\t\t\tEventEmitter.subscribe('onPullEvent-baas', (event: BaseEvent) => {\n\t\t\t\tconst [command: string, params] = event.getData();\n\t\t\t\tif (command === 'updateService' && this.#code === params.service.code)\n\t\t\t\t{\n\t\t\t\t\tif (this.#active !== params.service.isActive)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#active = params.service.isActive;\n\t\t\t\t\t\tthis.emit('onServiceActivityChanged', new BaseEvent({\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tcode: this.#code,\n\t\t\t\t\t\t\t\tactivity: this.#active,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}));\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.#available !== params.service.isAvailable)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#available = params.service.isAvailable;\n\t\t\t\t\t\tthis.emit('onServiceAvailabilityChanged', new BaseEvent({\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tcode: this.#code,\n\t\t\t\t\t\t\t\tavailability: this.#available,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tisAvailable(): boolean\n\t{\n\t\treturn this.#available;\n\t}\n\n\tisActive(): boolean\n\t{\n\t\treturn this.#active;\n\t}\n}\n","import { Service } from './service';\n\nexport class ServiceManager\n{\n\tstatic #services = [];\n\n\tstatic getByCode(code: string): Service\n\t{\n\t\tif (!this.#services[code])\n\t\t{\n\t\t\tthis.#services[code] = new Service(code);\n\t\t}\n\n\t\treturn this.#services[code];\n\t}\n}\n"],"names":["Service","EventEmitter","constructor","code","setEventNamespace","props","Extension","getSettings","services","Type","isPlainObject","isAvailable","isActive","BX","PULL","pull","extendWatch","channelName","subscribe","event","command","params","getData","service","emit","BaseEvent","data","activity","availability","ServiceManager","getByCode"],"mappings":";;;;CAC2D;CAAA;CAAA;AAE3D,CAAO,MAAMA,OAAO,SAASC,6BAAY,CACzC;GAKCC,WAAW,CAACC,IAAY,EACxB;KACC,KAAK,EAAE;KAAC;OAAA;OAAA;;KAAA;OAAA;OAAA,OALa;;KAAK;OAAA;OAAA,OACR;;KAKlB,IAAI,CAACC,iBAAiB,CAAC,SAAS,CAAC;KACjC,4CAAI,kBAASD,IAAI;KACjB,MAAME,KAAK,GAAGC,mBAAS,CAACC,WAAW,CAAC,cAAc,CAAC,CAACC,QAAQ,yCAAC,IAAI,gBAAO;KACxE,IAAIC,cAAI,CAACC,aAAa,CAACL,KAAK,CAAC,EAC7B;OACC,4CAAI,4BAAcA,KAAK,CAACM,WAAW;OACnC,4CAAI,sBAAWN,KAAK,CAACO,QAAQ;;KAG9B,IAAIC,EAAE,CAACC,IAAI,IAAIR,mBAAS,CAACC,WAAW,CAAC,cAAc,CAAC,CAACQ,IAAI,EACzD;OACCF,EAAE,CAACC,IAAI,CAACE,WAAW,CAACV,mBAAS,CAACC,WAAW,CAAC,cAAc,CAAC,CAACQ,IAAI,CAACE,WAAW,CAAC;OAE3EhB,6BAAY,CAACiB,SAAS,CAAC,kBAAkB,EAAGC,KAAgB,IAAK;SAChE,MAAM,CAACC,OAAe,EAAEC,MAAM,CAAC,GAAGF,KAAK,CAACG,OAAO,EAAE;SACjD,IAAIF,OAAO,KAAK,eAAe,IAAI,4CAAI,oBAAWC,MAAM,CAACE,OAAO,CAACpB,IAAI,EACrE;WACC,IAAI,4CAAI,wBAAakB,MAAM,CAACE,OAAO,CAACX,QAAQ,EAC5C;aACC,4CAAI,sBAAWS,MAAM,CAACE,OAAO,CAACX,QAAQ;aACtC,IAAI,CAACY,IAAI,CAAC,0BAA0B,EAAE,IAAIC,0BAAS,CAAC;eACnDC,IAAI,EAAE;iBACLvB,IAAI,0CAAE,IAAI,eAAM;iBAChBwB,QAAQ,0CAAE,IAAI;;cAEf,CAAC,CAAC;;WAGJ,IAAI,4CAAI,8BAAgBN,MAAM,CAACE,OAAO,CAACZ,WAAW,EAClD;aACC,4CAAI,4BAAcU,MAAM,CAACE,OAAO,CAACZ,WAAW;aAC5C,IAAI,CAACa,IAAI,CAAC,8BAA8B,EAAE,IAAIC,0BAAS,CAAC;eACvDC,IAAI,EAAE;iBACLvB,IAAI,0CAAE,IAAI,eAAM;iBAChByB,YAAY,0CAAE,IAAI;;cAEnB,CAAC,CAAC;;;QAGL,CAAC;;;GAIJjB,WAAW,GACX;KACC,+CAAO,IAAI;;GAGZC,QAAQ,GACR;KACC,+CAAO,IAAI;;CAEb;;CChEoC;AAEpC,CAAO,MAAMiB,cAAc,CAC3B;GAGC,OAAOC,SAAS,CAAC3B,IAAY,EAC7B;KACC,IAAI,CAAC,4CAAI,wBAAWA,IAAI,CAAC,EACzB;OACC,4CAAI,wBAAWA,IAAI,CAAC,GAAG,IAAIH,OAAO,CAACG,IAAI,CAAC;;KAGzC,OAAO,4CAAI,wBAAWA,IAAI,CAAC;;CAE7B;CAAC,sBAbY0B,cAAc;GAAA;GAAA,OAEP;CAAE;;;;;;;;;"}