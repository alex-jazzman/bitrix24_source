this.BX=this.BX||{};this.BX.Baas=this.BX.Baas||{};(function(e,t,s,a,i,o,r,n,c,l,p,u,d,b,v){"use strict";let h=e=>e,m,_;var g=babelHelpers.classPrivateFieldLooseKey("purchasedPackages");class E extends b.EventEmitter{constructor(e){super();this.FORMAT_DATE="YYYY-MM-DD";Object.defineProperty(this,g,{writable:true,value:[]});babelHelpers.classPrivateFieldLooseBase(this,g)[g]=e;this.setEventNamespace("BX.Baas")}prepareGroupedPurchases(e){const t={startDate:new Date,expirationDate:new Date,actual:"N",services:{}};e.forEach((e=>{const s=a.DateTimeFormat.parse(e.startDate,false,this.FORMAT_DATE);const i=a.DateTimeFormat.parse(e.expirationDate,false,this.FORMAT_DATE);if(s<t.startDate){t.startDate=s}if(t.expirationDate<i){t.expirationDate=i}const o=e.actual==="Y"||e.actual===true;t.actual=o?"Y":t.actual;const r=d.Type.isArray(e.services)?e.services:Object.values(e.services);r.forEach((e=>{const s=e.code;t.services[s]=t.services[s]||{code:s,current:0,maximal:0};t.services[s].current+=parseInt(e.current,10);t.services[s].maximal+=parseInt(e.maximal,10)}))}));return t}getGroupedPurchases(){return babelHelpers.classPrivateFieldLooseBase(this,g)[g]}getPurchaseCodes(){return this.getGroupedPurchases().map((e=>e.purchaseCode)).join(",")}getContainer(){const e=this.prepareGroupedPurchases(this.getGroupedPurchases());e.startDate=a.DateTimeFormat.format(a.DateTimeFormat.getFormat("LONG_DATE_FORMAT"),e.startDate);e.expirationDate=a.DateTimeFormat.format(a.DateTimeFormat.getFormat("LONG_DATE_FORMAT"),e.expirationDate);const t=this.getGroupedPurchases().length;const s=this.getGroupedPurchases().length>1;const i={current:0,maximal:0,active:"N"};Object.keys(e.services).forEach((t=>{const s=e.services[t];i.current+=parseInt(s.current,10);i.maximal+=parseInt(s.maximal,10)}));if(s){const s=t>2?"--more":"--two";return d.Tag.render(m||(m=h`
			<div class="ui-popupcomponentmaker__content--section ${0}">
				<div class="ui-popupcomponentmaker__content--section-item">
					<div class="ui-popupconstructor-content-item-wrapper">
						<div class="ui-popupconstructor-content-item-wrapper_information">
							<div class="ui-popupconstructor-content-item-wrapper-title">
								<div class="ui-popupconstructor-content-item__title">
									${0}
								</div>
								<div class="ui-popupconstructor-content-item-subject">
									<div class="ui-label ui-label-success ui-label-sm --active ui-label-fill">
										<div class="ui-label-status"></div>
										<span class="ui-label-inner">${0}</span>
									</div>
									<button class="ui-popupconstructor-content-item-menu" style="display: none;" type="button"></button>
								</div>
							</div>
							<div class="ui-popupconstructor-content-item-progressbar">${0}</div>
							<div class="ui-popupconstructor-content-item-limit">
								<span>${0} </span>
								${0}
							</div>
						</div>
					</div>
				</div>
			</div>`),s,[d.Loc.getMessage("BAAS_WIDGET_PURCHASES_TITLE"),": ",t].join(""),d.Loc.getMessage("BAAS_WIDGET_PURCHASES_ARE_ACTIVE"),this.createProgressBar(i.current,i.maximal).getContainer(),this.getLeftUnitsLabel(),d.Loc.getMessage("BAAS_WIDGET_PURCHASE_LEFT_STATUS",{"#left#":`<span class="ui-popupconstructor-content-item-num">${i.current}</span>`,"#total#":`<span class="ui-popupconstructor-content-item-num">${i.maximal}</span>`,"#date#":`<span class="ui-popupconstructor-content-item-date">${e.expirationDate}</span>`}))}return d.Tag.render(_||(_=h`
			<div class="ui-popupcomponentmaker__content--section">
				<div class="ui-popupcomponentmaker__content--section-item">
					<div class="ui-popupconstructor-content-item-wrapper">
						<div class="ui-popupconstructor-content-item-wrapper_information">
							<div class="ui-popupconstructor-content-item-wrapper-title">
								<div class="ui-popupconstructor-content-item__title">
									${0}
								</div>
								<div class="ui-popupconstructor-content-item-subject">
									<div class="ui-label ui-label-success ui-label-sm --active ui-label-fill" ${0}>
										<div class="ui-label-status"></div>
										<span class="ui-label-inner">${0}</span>
									</div>
									<div class="ui-label ui-label-success ui-label-sm --paid ui-label-fill" ${0}>
										<div class="ui-label-status"></div>
										<span class="ui-label-inner">${0}</span>
									</div>
									<button class="ui-popupconstructor-content-item-menu" style="display: none;" type="button"></button>
								</div>
							</div>
							<div class="ui-popupconstructor-content-item-progressbar">${0}</div>
							<div class="ui-popupconstructor-content-item-limit">
								<span>${0} </span>
								${0}
							</div>
						</div>
					</div>
				</div>
			</div>`),d.Loc.getMessage("BAAS_WIDGET_PURCHASE_TITLE"),e.actual==="Y"?"":'style="display: none;"',d.Loc.getMessage("BAAS_WIDGET_PURCHASE_IS_ACTIVE"),e.actual==="Y"?'style="display: none;"':"",d.Loc.getMessage("BAAS_WIDGET_PURCHASES_ARE_PAID"),this.createProgressBar(i.current,i.maximal).getContainer(),this.getLeftUnitsLabel(),d.Loc.getMessage("BAAS_WIDGET_PURCHASE_LEFT_STATUS",{"#left#":`<span class="ui-popupconstructor-content-item-num">${i.current}</span>`,"#total#":`<span class="ui-popupconstructor-content-item-num">${i.maximal}</span>`,"#date#":`<span class="ui-popupconstructor-content-item-date">${e.expirationDate}</span>`}))}getLeftUnitsLabel(){return d.Loc.getMessage("BAAS_WIDGET_PURCHASE_LEFT")}getData(){return babelHelpers.classPrivateFieldLooseBase(this,g)[g]}createProgressBar(e,t){return new s.ProgressBar({value:Math.round(e/t*100),size:4})}}let P=e=>e,T,L,A;var f=babelHelpers.classPrivateFieldLooseKey("prepareActiveAndFuturePurchases");class B extends E{constructor(...e){super(...e);Object.defineProperty(this,f,{value:F})}getContainer(){const e=babelHelpers.classPrivateFieldLooseBase(this,f)[f](this.getGroupedPurchases());const t=this.getGroupedPurchases().length;const s=t>2?"--more":"--two";const a=e.active?e.active.current:e.next.current;const i=e.active?e.active.maximal:e.next.maximal;const o=e.active?e.active.expirationDate:e.next.startDate;const r=e.expirationDate;return d.Tag.render(T||(T=P`
			<div class="ui-popupcomponentmaker__content--section ${0}">
				<div class="ui-popupcomponentmaker__content--section-item">
					<div class="ui-popupconstructor-content-item-wrapper">
						<div class="ui-popupconstructor-content-item-wrapper_information">
							<div class="ui-popupconstructor-content-item-wrapper-title">
								<div class="ui-popupconstructor-content-item__title">
									${0}
								</div>
								<div class="ui-popupconstructor-content-item-subject">
									<div class="ui-label ui-label-success ui-label-sm --active ui-label-fill">
										<div class="ui-label-status"></div>
										<span class="ui-label-inner">${0}</span>
									</div>
								</div>
							</div>
							<div class="ui-popupconstructor-content-item-progressbar">${0}</div>
							${0}
							<div class="ui-popupconstructor-content-item-limit">
							${0}
							</div>
						</div>
					</div>
				</div>
			</div>`),s,d.Loc.getMessage("BAAS_WIDGET_PURCHASE_TITLE"),d.Loc.getMessage("BAAS_WIDGET_PURCHASE_IS_ACTIVE"),this.createProgressBar(a,i).getContainer(),e.active?d.Tag.render(L||(L=P`
								<div class="ui-popupconstructor-content-item-limit">
									<span>${0} </span>
										${0}
								</div>`),this.getLeftUnitsLabel(),d.Loc.getMessage("BAAS_WIDGET_PURCHASE_LEFT_STATUS",{"#left#":`<span class="ui-popupconstructor-content-item-num">${a}</span>`,"#total#":`<span class="ui-popupconstructor-content-item-num">${i}</span>`,"#date#":`<span class="ui-popupconstructor-content-item-date">${o}</span>`})):d.Tag.render(A||(A=P`
								<div class="ui-popupconstructor-content-item-limit">
									<span>${0} </span>
										${0}
								</div>
							`),this.getFutureUnitsLabel(),d.Loc.getMessage("BAAS_WIDGET_PURCHASE_WILL_BE_AVAILABLE_STATUS",{"#left#":`<span class="ui-popupconstructor-content-item-num">${a}</span>`,"#total#":`<span class="ui-popupconstructor-content-item-num">${i}</span>`,"#date#":`<span class="ui-popupconstructor-content-item-date">${o}</span>`})),d.Loc.getMessage("BAAS_WIDGET_PURCHASE_ANNUAL_LIFETIME",{"#date#":`<span class="ui-popupconstructor-content-item-date">${r}</span>`}))}getFutureUnitsLabel(){return d.Loc.getMessage("BAAS_WIDGET_PURCHASES_FUTURE_UNITS")}}function F(e){const t={};const s={};let i=new Date;e.forEach((e=>{const o=e.actual==="Y"||e.actual===true;const r={...e};if(o){var n;const s=a.DateTimeFormat.parse(e.expirationDate,false,this.FORMAT_DATE).getTime();t[s]=(n=t[s])!=null?n:[];t[s].push(r)}else{var c;const t=a.DateTimeFormat.parse(e.startDate,false,this.FORMAT_DATE).getTime();s[t]=(c=s[t])!=null?c:[];s[t].push(r)}const l=a.DateTimeFormat.parse(e.expirationDate,false,this.FORMAT_DATE);if(l>i){i=l}}));const o={expirationDate:a.DateTimeFormat.format(a.DateTimeFormat.getFormat("LONG_DATE_FORMAT"),i)};const r=Object.keys(t);if(r.length>0){o.active={current:0,maximal:0,expirationDateObject:new Date,expirationDate:""};r.forEach((e=>{const s=t[e];s.forEach((e=>{Object.keys(e.services).forEach((t=>{const s=e.services[t];o.active.current+=parseInt(s.current,10);o.active.maximal+=parseInt(s.maximal,10)}));const t=a.DateTimeFormat.parse(e.expirationDate,false,this.FORMAT_DATE);if(o.active.expirationDateObject<t){o.active.expirationDateObject=t}}))}));o.active.expirationDate=a.DateTimeFormat.format(a.DateTimeFormat.getFormat("DAY_MONTH_FORMAT"),o.active.expirationDateObject)}else{o.next={current:0,maximal:0,startDateObject:new Date,startDate:""};const e=Object.keys(s).sort(((e,t)=>e<t?-1:1));const t=e[0];const a=s[t];a.forEach((e=>{Object.keys(e.services).forEach((t=>{const s=e.services[t];o.next.current+=parseInt(s.current,10);o.next.maximal+=parseInt(s.maximal,10)}));o.next.startDate=e.startDate}))}return o}let S=e=>e,D;var C=babelHelpers.classPrivateFieldLooseKey("package");var H=babelHelpers.classPrivateFieldLooseKey("openNewPurchase");class I extends b.EventEmitter{constructor(e){super();Object.defineProperty(this,H,{value:y});this.FORMAT_DATE="YYYY-MM-DD";Object.defineProperty(this,C,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,C)[C]=e;this.setEventNamespace("BX.Baas")}getContainer(){const e=babelHelpers.classPrivateFieldLooseBase(this,C)[C].getData();return d.Tag.render(D||(D=S`
			<div data-bx-package="${0}">
				<div class="ui-popupconstructor-content-main-title">
					${0}
					<div class="ui-popupconstructor-content-item__title">${0}</div>
				</div>
				<div class="ui-popupcomponentmaker__content-wrap">
					<div class="ui-popupcomponentmaker__content">
						${0}
						<div class="ui-popupcomponentmaker__content--section --add" onclick="${0}">
							<div class="ui-popupcomponentmaker__content--section-item">
								<div class="ui-popupconstructor-content-item-wrapper">
									<div class="ui-popupconstructor-content-item-add">${0}</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		`),d.Text.encode(e.code),babelHelpers.classPrivateFieldLooseBase(this,C)[C].getIcon(),d.Text.encode(e.title),this.renderPurchases(),babelHelpers.classPrivateFieldLooseBase(this,H)[H].bind(this),d.Loc.getMessage("BAAS_WIDGET_PURCHASE_ADD"))}renderPurchases(){const e=this.getData();const t=this.groupPackages(e.purchaseInfo.purchases);return[...t].map((e=>this.createPurchasedPackageTileContainer(...e)))}createPurchasedPackageTileContainer(e,t=false){const s=t===true?this.getAnnualTileFabric(e):this.getDefaultTileFabric(e);const a=s.getContainer();a.dataset.bxRole="purchase-tile";a.dataset.bxPurchasecodes=s.getPurchaseCodes();return a}setDefaultTileFabric(e){this.getDefaultTileFabric=e}getDefaultTileFabric(e){return new E(e)}setAnnualTileFabric(e){this.getAnnualTileFabric=e}getAnnualTileFabric(e){return new B(e)}getData(){return babelHelpers.classPrivateFieldLooseBase(this,C)[C].getData()}groupPackages(e){const t={};const s={};[...e].forEach((e=>{const i=e.length<=1;[...e].forEach((e=>{let o=a.DateTimeFormat.parse(e.expirationDate,false,this.FORMAT_DATE).getTime();if(i){if(!t[o]){t[o]=[]}t[o].push(e)}else{o=e.purchaseCode;if(!s[o]){s[o]={}}s[o][a.DateTimeFormat.parse(e.startDate,false,this.FORMAT_DATE).getTime()]=e}}))}));const i=t;Object.keys(s).forEach((e=>{const t=Object.keys(s[e]).sort(((e,t)=>e<t?-1:1));let a=t[0];while(i[a]){a+=1}i[a]=s[e]}));const o=Object.keys(i).sort(((e,t)=>e<t?-1:1));return[...o].map((e=>{const t=!d.Type.isArray(i[e]);let s=i[e];if(t){s=Object.values(i[e])}return[s,t&&s.length>1]}))}}function y(){babelHelpers.classPrivateFieldLooseBase(this,C)[C].openNewPurchase()}class O extends E{getLeftUnitsLabel(){return d.Loc.getMessage("BAAS_WIDGET_AI_PURCHASE_LEFT")}}class w extends E{getLeftUnitsLabel(){return d.Loc.getMessage("BAAS_WIDGET_AI_PURCHASE_LEFT")}}class x extends B{getLeftUnitsLabel(){return d.Loc.getMessage("BAAS_WIDGET_AI_PURCHASE_LEFT")}}let k=e=>e,M,R;class U extends E{getContainer(){const e=this.prepareGroupedPurchases(this.getGroupedPurchases());e.startDate=a.DateTimeFormat.format(a.DateTimeFormat.getFormat("LONG_DATE_FORMAT"),e.startDate);e.expirationDate=a.DateTimeFormat.format(a.DateTimeFormat.getFormat("LONG_DATE_FORMAT"),e.expirationDate);const t=this.getGroupedPurchases().length;const s=this.getGroupedPurchases().length>1;if(s){const s=t>2?"--more":"--two";return d.Tag.render(M||(M=k`
			<div class="ui-popupcomponentmaker__content--section ${0}">
				<div class="ui-popupcomponentmaker__content--section-item">
					<div class="ui-popupconstructor-content-item-wrapper">
						<div class="ui-popupconstructor-content-item-wrapper_information">
							<div class="ui-popupconstructor-content-item-wrapper-title">
								<div class="ui-popupconstructor-content-item__title">
									${0}
								</div>
								<div class="ui-popupconstructor-content-item-subject">
									<div class="ui-label ui-label-success ui-label-sm --active ui-label-fill">
										<div class="ui-label-status"></div>
										<span class="ui-label-inner">${0}</span>
									</div>
									<button class="ui-popupconstructor-content-item-menu" style="display: none;" type="button"></button>
								</div>
							</div>
							<div class="ui-popupconstructor-content-item-limit">
								<span>${0} </span>
								<span class="ui-popupconstructor-content-item-date">${0}</span>
							</div>
						</div>
					</div>
				</div>
			</div>`),s,[d.Loc.getMessage("BAAS_WIDGET_PURCHASES_TITLE"),": ",t].join(""),d.Loc.getMessage("BAAS_WIDGET_PURCHASES_ARE_ACTIVE"),d.Loc.getMessage("BAAS_WIDGET_DFT_PURCHASE_LEFT"),e.expirationDate)}return d.Tag.render(R||(R=k`
			<div class="ui-popupcomponentmaker__content--section">
				<div class="ui-popupcomponentmaker__content--section-item">
					<div class="ui-popupconstructor-content-item-wrapper">
						<div class="ui-popupconstructor-content-item-wrapper_information">
							<div class="ui-popupconstructor-content-item-wrapper-title">
								<div class="ui-popupconstructor-content-item__title">${0}</div>
								<div class="ui-popupconstructor-content-item-subject">
									<div class="ui-label ui-label-success ui-label-sm --active ui-label-fill">
										<div class="ui-label-status"></div>
										<span class="ui-label-inner">${0}</span>
									</div>
								</div>
							</div>
							<div class="ui-popupconstructor-content-item-limit">
								<span>${0} </span>
								<span class="ui-popupconstructor-content-item-date">${0}</span>
							</div>
						</div>
					</div>
				</div>
			</div>`),d.Loc.getMessage("BAAS_WIDGET_PURCHASE_TITLE"),d.Loc.getMessage("BAAS_WIDGET_PURCHASE_IS_ACTIVE"),d.Loc.getMessage("BAAS_WIDGET_DFT_PURCHASE_LEFT"),e.expirationDate)}}var N=babelHelpers.classPrivateFieldLooseKey("detectServiceCode");class j{constructor(){Object.defineProperty(this,N,{value:G})}create(e){const t=babelHelpers.classPrivateFieldLooseBase(this,N)[N](e.getData().purchaseInfo.purchases);const s=new I(e);if(t==="ai_copilot_token"){s.setDefaultTileFabric(((...e)=>new w(...e)));s.setAnnualTileFabric(((...e)=>new x(...e)))}else if(t==="documentgenerator_fast_transform"){s.setDefaultTileFabric(((...e)=>new U(...e)));s.groupPackages=e=>{const t=[];[...e].forEach((e=>{[...e].forEach((e=>{t.push(e)}))}));return[[t]]}}else if(t==="disk-oo-edit"){s.setDefaultTileFabric(((...e)=>new O(...e)))}return s}}function G(e){let t=null;let s=false;[...e].forEach((e=>{[...e].forEach((e=>{if(e.services.length>1){s=true}else{const a=e.services[0].code;if(t===null){t=a}else if(a!==t){s=true}}}))}));return s?null:t}let $=e=>e,W,X,K,V,Y,z;var Q=babelHelpers.classPrivateFieldLooseKey("cache");var q=babelHelpers.classPrivateFieldLooseKey("data");var J=babelHelpers.classPrivateFieldLooseKey("renderIcon");var Z=babelHelpers.classPrivateFieldLooseKey("renderMoreLink");var ee=babelHelpers.classPrivateFieldLooseKey("renderButton");var te=babelHelpers.classPrivateFieldLooseKey("isPaidLicense");var se=babelHelpers.classPrivateFieldLooseKey("renderButtonDescription");var ae=babelHelpers.classPrivateFieldLooseKey("getPurchaseBlock");var ie=babelHelpers.classPrivateFieldLooseKey("adjustPackage");class oe extends b.EventEmitter{constructor(e){super();Object.defineProperty(this,ie,{value:de});Object.defineProperty(this,ae,{value:ue});Object.defineProperty(this,se,{value:pe});Object.defineProperty(this,te,{value:le});Object.defineProperty(this,ee,{value:ce});Object.defineProperty(this,Z,{value:ne});Object.defineProperty(this,J,{value:re});Object.defineProperty(this,Q,{writable:true,value:new d.Cache.MemoryCache});Object.defineProperty(this,q,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,q)[q]=e;this.setEventNamespace("BX.Baas");if(BX.PULL&&d.Extension.getSettings("baas.store").pull){BX.PULL.extendWatch(d.Extension.getSettings("baas.store").pull.channelName);b.EventEmitter.subscribe("onPullEvent-baas",(e=>{const[t,s]=e.getData();if(t==="updateService"&&s.packages){[...s.packages].forEach((e=>{if(e.code===babelHelpers.classPrivateFieldLooseBase(this,q)[q].code){babelHelpers.classPrivateFieldLooseBase(this,ie)[ie](e)}}))}}))}}getContainer(){return babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].remember("container",(()=>{const e=babelHelpers.classPrivateFieldLooseBase(this,q)[q];return d.Tag.render(W||(W=$`
				<div class="ui-popupconstructor-content-item-wrapper" data-bx-role="package-tile" data-bx-package="${0}">
					<div class="ui-popupconstructor-content-item-wrapper_information">
						<div class="ui-popupconstructor-content-item-wrapper-title">
							${0}
							<div class="ui-popupconstructor-content-item__title">${0}</div>
						</div>
						<div>
							<div class="ui-popupconstructor-content-item__description">
								${0}
								${0}
							</div>
						</div>
						${0}
					</div>
					<div class="ui-popupconstructor-content-item-wrapper_button">
						${0}
						${0}
					</div>
				</div>
			`),d.Text.encode(e.code),this.getIcon(),d.Text.encode(e.title),d.Text.encode(e.description),babelHelpers.classPrivateFieldLooseBase(this,Z)[Z](babelHelpers.classPrivateFieldLooseBase(this,q)[q].featurePromotionCode),babelHelpers.classPrivateFieldLooseBase(this,ae)[ae](),babelHelpers.classPrivateFieldLooseBase(this,ee)[ee](babelHelpers.classPrivateFieldLooseBase(this,q)[q]),babelHelpers.classPrivateFieldLooseBase(this,se)[se](babelHelpers.classPrivateFieldLooseBase(this,q)[q]))}))}getIcon(){return babelHelpers.classPrivateFieldLooseBase(this,J)[J](babelHelpers.classPrivateFieldLooseBase(this,q)[q].icon)}openNewPurchase(){const e=babelHelpers.classPrivateFieldLooseBase(this,q)[q].purchaseUrl;const t=d.Extension.getSettings("baas.store").get("isBitrix24License");if(t&&!babelHelpers.classPrivateFieldLooseBase(this,te)[te]()){const e=/product=(\w+)/gi;const t={package:babelHelpers.classPrivateFieldLooseBase(this,q)[q].code};if(e.test(babelHelpers.classPrivateFieldLooseBase(this,q)[q].purchaseUrl)){t.package=babelHelpers.classPrivateFieldLooseBase(this,q)[q].purchaseUrl.match(e)[0].replace("product=","")}n.License.openPurchasePage(t)}else if(t&&d.Extension.getSettings("baas.store").get("canBaasOnlyBePurchasedByAdmin")&&!d.Extension.getSettings("baas.store").get("isCurrentUserAdmin")){BX.UI.Notification.Center.notify({content:d.Loc.getMessage("BAAS_WIDGET_ONLY_ADMIN_CAN_PURCHASE_BAAS"),category:"baas",autoHideDelay:5e3})}else if(e.indexOf("http")===0){window.open(e)}else{BX.SidePanel.Instance.open(e,{width:1250,cacheable:false})}this.emit("onClickToBuyPackage",{packageCode:babelHelpers.classPrivateFieldLooseBase(this,q)[q].code})}showPurchases(){b.EventEmitter.emit(b.EventEmitter.GLOBAL_TARGET,this.getFullEventName("onPurchaseShown"),new b.BaseEvent({data:{package:this,packageCode:babelHelpers.classPrivateFieldLooseBase(this,q)[q].code}}));const e=this.getContainer().closest("div.popup-window");const t=10;const s=e.offsetWidth-t*2;const a=e.offsetHeight-t*2;const i=new j;const o=r.PopupManager.create({id:"purchase",autoHide:true,cacheable:false,closeIcon:true,lightShadow:true,draggable:false,closeByEsc:true,padding:0,className:"--baas-widget --purchase",content:i.create(this).getContainer(),bindElement:e,offsetTop:0-a-t,offsetLeft:t,bindOptions:{position:"bottom"},width:s,height:a,events:{onClose:()=>{b.EventEmitter.emit(b.EventEmitter.GLOBAL_TARGET,this.getFullEventName("onPurchaseHidden"),new b.BaseEvent({data:{package:this}}))}}});o.show()}getData(){return babelHelpers.classPrivateFieldLooseBase(this,q)[q]}}function re(e){var t;const s={};const a=(t=e.style)!=null?t:{};let i=d.Tag.render(X||(X=$`
			<div class="ui-popupconstructor-content-item__icon ui-icon-set"></div>
		`));if(d.Type.isStringFilled(e.className)){if(v.Set[e.className]){s.icon=v.Set[e.className];if(e.color){s.color=e.color}i=new v.Icon(s).render()}else{d.Dom.addClass(i,e.className)}}d.Dom.style(i,a);return i}function ne(e){if(!d.Type.isStringFilled(e)){return null}const t=d.Tag.render(K||(K=$`
			<div class="ui-popupconstructor-content-item__more-link">${0}</div>
		`),d.Loc.getMessage("BAAS_WIDGET_MORE_LINK_TITLE"));const s=t=>{t.stopPropagation();const s=o.FeaturePromotersRegistry.getPromoter({code:e});s.show()};d.Event.bind(t,"click",s);return t}function ce(e){if(!d.Type.isPlainObject(e.price)){return null}const t=e.isActive?new l.Button({round:true,text:d.Loc.getMessage("BAAS_WIDGET_BUY_BUTTON_TITLE"),size:l.Button.Size.EXTRA_SMALL,color:l.Button.Color.SUCCESS,noCaps:true,onclick:this.openNewPurchase.bind(this)}):new l.Button({round:true,text:d.Loc.getMessage("BAAS_WIDGET_BUY_BUTTON_TITLE"),size:l.Button.Size.EXTRA_SMALL,color:l.Button.Color.SUCCESS,state:l.Button.State.DISABLED,noCaps:true,onclick:()=>false});return t.render()}function le(){return d.Extension.getSettings("baas.store").isBaasActive}function pe(e){return e.isActive?d.Tag.render(V||(V=$`
			<div class="ui-popupconstructor-content-item__button-description">
				<div>${0}</div>
				${0}
			</div>
		`),e.price.value,e.price.description):null}function ue(){return babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].remember("purchase-block",(()=>{const e=babelHelpers.classPrivateFieldLooseBase(this,q)[q];if(d.Type.isPlainObject(e.purchaseInfo)){const t=e.purchaseInfo;if(t&&t.purchaseCount>0){const e=new i.Label({text:t.purchaseCount>1?d.Loc.getMessage("BAAS_WIDGET_PURCHASES_ARE_ACTIVE"):d.Loc.getMessage("BAAS_WIDGET_PURCHASE_IS_ACTIVE"),size:i.LabelSize.SM,fill:true,customClass:"--active"});const s=t.purchaseBalance>20?null:t.purchaseBalance>0?new i.Label({text:d.Loc.getMessage("BAAS_WIDGET_PURCHASE_LIMIT_IS_ALMOST_EXCEEDED"),size:i.LabelSize.SM,fill:true,customClass:"--almost"}):new i.Label({text:d.Loc.getMessage("BAAS_WIDGET_PURCHASE_LIMIT_IS_EXCEEDED"),size:i.LabelSize.SM,fill:true,customClass:"--exceeded"});return d.Tag.render(Y||(Y=$`
						<div class="ui-popupconstructor-content-item__purchase-description" onclick="${0}">
							<span class="ui-link ui-link-dashed">${0}: ${0}</span>
							${0}
							${0}
						</div>
					`),this.showPurchases.bind(this),d.Loc.getMessage("BAAS_WIDGET_PURCHASE_TITLE"),t.purchaseCount,e.render(),s?s.render():"")}}return d.Tag.render(z||(z=$`<div></div>`))}))}function de(e){babelHelpers.classPrivateFieldLooseBase(this,q)[q].purchaseInfo=e.purchaseInfo;if(babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].has("purchase-block")){const e=babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].get("purchase-block");babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].delete("purchase-block");const t=babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]();d.Dom.replace(e,t)}}class be{create(e){return new oe(e)}}var ve=babelHelpers.classPrivateFieldLooseKey("cache");var he=babelHelpers.classPrivateFieldLooseKey("items");class me extends p.BaseTemplate{constructor(e){super();Object.defineProperty(this,ve,{writable:true,value:new d.Cache.MemoryCache});Object.defineProperty(this,he,{writable:true,value:[]});babelHelpers.classPrivateFieldLooseBase(this,he)[he]=d.Type.isPlainObject(e)?e.items:[]}setOptions(e){if(e.items){babelHelpers.classPrivateFieldLooseBase(this,he)[he]=d.Type.isPlainObject(e.items)?Object.values(e.items):d.Type.isArray(e.items)?e.items:[]}super.setOptions(e)}getContent(){return babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].remember("popup-content",(()=>{const e=new be;return babelHelpers.classPrivateFieldLooseBase(this,he)[he].map(((t,s)=>{var a;const i=e.create(t);return{html:i.getContainer(),background:(a=t.styles)==null?void 0:a.background,margin:s===0?"12px 0 0 0":null}}))}))}}var _e=babelHelpers.classPrivateFieldLooseKey("events");class ge extends v.Icon{constructor(e={}){super(e);Object.defineProperty(this,_e,{writable:true,value:{}});if(e.events){babelHelpers.classPrivateFieldLooseBase(this,_e)[_e]=e.events}}render(){this.iconElement=super.render();d.Dom.style(this.iconElement,"opacity","60%");Object.keys(babelHelpers.classPrivateFieldLooseBase(this,_e)[_e]).forEach((e=>{d.Event.bind(this.iconElement,e,babelHelpers.classPrivateFieldLooseBase(this,_e)[_e][e])}));return this.iconElement}}var Ee=babelHelpers.classPrivateFieldLooseKey("serviceCode");var Pe=babelHelpers.classPrivateFieldLooseKey("lastContext");var Te=babelHelpers.classPrivateFieldLooseKey("active");var Le=babelHelpers.classPrivateFieldLooseKey("send");class Ae{constructor(e){Object.defineProperty(this,Ee,{writable:true,value:void 0});Object.defineProperty(this,Pe,{writable:true,value:void 0});Object.defineProperty(this,Te,{writable:true,value:false});babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee]=e;babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]=Ae.CONTEXT_IS_NOT_SET;this.onClickToBuyPackage=this.onClickToBuyPackage.bind(this);this.onPurchaseShown=this.onPurchaseShown.bind(this)}activate(){babelHelpers.classPrivateFieldLooseBase(this,Te)[Te]=true;b.EventEmitter.subscribe("BX.Baas:onClickToBuyPackage",this.onClickToBuyPackage);b.EventEmitter.subscribe("BX.Baas:onPurchaseShown",this.onPurchaseShown);return this}deactivate(){b.EventEmitter.unsubscribe("BX.Baas:onClickToBuyPackage",this.onClickToBuyPackage);b.EventEmitter.unsubscribe("BX.Baas:onPurchaseShown",this.onPurchaseShown);babelHelpers.classPrivateFieldLooseBase(this,Te)[Te]=false;return this}onShowFrom(e){babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]=e;babelHelpers.classPrivateFieldLooseBase(this.constructor,Le)[Le](this.constructor.EVENT_SHOW_POPUP,babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee],e)}onPlayerEvents(e,t){if(babelHelpers.classPrivateFieldLooseBase(this,Te)[Te]){babelHelpers.classPrivateFieldLooseBase(this.constructor,Le)[Le](e,babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee],babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe],t?{p2:t}:{})}}onClickToBuyPackage(e){babelHelpers.classPrivateFieldLooseBase(this.constructor,Le)[Le](this.constructor.EVENT_CLICK_TO_BUY,babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee],babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe],{p2:e.getData().packageCode.replaceAll("_","-")})}onPurchaseShown(e){babelHelpers.classPrivateFieldLooseBase(this.constructor,Le)[Le](this.constructor.EVENT_CLICK_TO_VIEW_PURCHASE,babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee],babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe],{p2:e.getData().packageCode.replaceAll("_","-")})}static createByServiceCode(e){let t=null;switch(e){case"ai_copilot_token":t=this.SERVICE_AI_COPILOT_TOKEN;break;case"disk_oo_edit":t=this.SERVICE_DISK_OO_EDIT;break;case"documentgenerator_fast_transform":t=this.SERVICE_DOCUMENTGENERATOR_FAST_TRANSFORM;break;default:t=this.SERVICE_ALL;break}return new this(t)}static guessContextByServiceCode(e){let t=null;switch(e){case"ai_copilot_token":t=this.CONTEXT_STREAM;break;case"disk_oo_edit":t=this.CONTEXT_TASKS;break;case"documentgenerator_fast_transform":t=this.CONTEXT_CRM;break;default:t=this.CONTEXT_LICENSE_WIDGET;break}return t}}function fe(e,t,s,a={}){u.sendData(Object.assign(a,{tool:"boost",category:"buy",event:e,type:t,c_section:s,p1:d.Extension.getSettings("baas.store").get("isCurrentUserAdmin")?"isAdmin_Y":"isAdmin_N"}))}Object.defineProperty(Ae,Le,{value:fe});Ae.EVENT_SHOW_POPUP="show";Ae.EVENT_CLICK_TO_BUY="button_buy_click";Ae.EVENT_CLICK_TO_VIEW_PURCHASE="button_click_active_boost";Ae.SERVICE_ALL="main";Ae.SERVICE_AI_COPILOT_TOKEN="copilot";Ae.SERVICE_DOCUMENTGENERATOR_FAST_TRANSFORM="speed";Ae.SERVICE_DISK_OO_EDIT="docs";Ae.CONTEXT_IS_NOT_SET="notSet";Ae.CONTEXT_LICENSE_WIDGET="headerPopup";Ae.CONTEXT_IM_CHAT="chat";Ae.CONTEXT_STREAM="stream";Ae.CONTEXT_CRM="CRM";Ae.CONTEXT_TASKS="tasks";var Be=babelHelpers.classPrivateFieldLooseKey("getPopupWithHeader");var Fe=babelHelpers.classPrivateFieldLooseKey("getLastBoundElement");var Se=babelHelpers.classPrivateFieldLooseKey("fetchData");var De=babelHelpers.classPrivateFieldLooseKey("onPurchaseShown");var Ce=babelHelpers.classPrivateFieldLooseKey("onPackageHidden");var He=babelHelpers.classPrivateFieldLooseKey("instance");class Ie extends b.EventEmitter{constructor(e){super();Object.defineProperty(this,Ce,{value:ke});Object.defineProperty(this,De,{value:xe});Object.defineProperty(this,Se,{value:we});Object.defineProperty(this,Fe,{value:Oe});Object.defineProperty(this,Be,{value:ye});this.cache=new d.Cache.MemoryCache;this.setEventNamespace("BX.Baas");b.EventEmitter.subscribe(b.EventEmitter.GLOBAL_TARGET,"BX.Baas:onPurchaseShown",(e=>babelHelpers.classPrivateFieldLooseBase(this,De)[De](e)));b.EventEmitter.subscribe(b.EventEmitter.GLOBAL_TARGET,"BX.Baas:onPurchaseHidden",(e=>babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce](e)));this.cache.set("boundElements",new WeakMap)}getPopup(){return babelHelpers.classPrivateFieldLooseBase(this,Be)[Be]().getPopup()}getAnalytic(){return this.cache.remember("analyticObject",(()=>new Ae(Ae.SERVICE_ALL)))}getAjaxPromise(){return d.ajax.runAction("baas.Service.getAll")}setData(e){this.cache.set("response-data",e);return this}convertIntoWidgetDataType(){const e=this.cache.get("response-data");d.Dom.addClass(this.getPopup().contentContainer,"--baas-widget --baas-common");const t=d.Type.isStringFilled(e.adsInfo&&e.adsInfo.featurePromotionCode);const s={header:{icon:new ge({icon:v.Actions.CHEVRON_LEFT,size:22,color:"#fff",events:{click:()=>{this.emit("onClickBack");this.hide()}}}).render(),top:{title:d.Loc.getMessage("BAAS_WIDGET_TITLE"),subtitle:""},info:e.adsInfo&&e.adsInfo.title?{title:e.adsInfo.title,subtitle:e.adsInfo.subtitle,subtitleDescription:e.adsInfo.subtitleDescription,roundContent:{posterUrl:e.adsInfo.iconUrl,videos:[{url:e.adsInfo.videoUrl,type:e.adsInfo.videoFileType}]},moreLabel:t?d.Loc.getMessage("BAAS_WIDGET_MORE_LINK_TITLE"):"",code:t?e.adsInfo.featurePromotionCode:null}:{title:d.Loc.getMessage("BAAS_WIDGET_DESCRIPTION"),roundContent:new v.Icon({icon:v.Set.QR_CODE_1}).render(),moreLabel:"",code:null}}};if(d.Type.isArray(e.packages)&&e.packages.length>0){s.items=e.packages}else{s.header.button=new l.Button({text:d.Loc.getMessage("BAAS_WIDGET_RELOAD_PACKAGES"),color:l.ButtonColor.LIGHT_BORDER,size:l.ButtonSize.SMALL,onclick:()=>{this.reload()},round:true,noCaps:true})}return s}bind(e,t){this.cache.set("boundLastElement",e);if(!this.cache.get("boundElements").has(e)){this.cache.get("boundElements").set(e);Event.bind(e,"click",(()=>{this.show(e)}))}this.bindAnalyticContext(e,t||Ae.CONTEXT_IS_NOT_SET);return this}bindAnalyticContext(e,t){e.dataset.bxAnalyticContextLabel=t;return this}show(e){const t=this.getPopup();if(!e){e=this.cache.get("boundLastElement")}if(e&&e!==t.bindElement){t.setBindElement(e)}t.show();return this}toggle(e){const t=this.getPopup();if(t.isShown()){this.hide()}else{this.show(e)}return this}hide(){const e=this.getPopup();e.close();return this}reload(){const e=this.getPopup();e.close();this.cache.delete("widgetData");this.cache.delete("baas-popup");this.show(e.bindElement)}static getInstance(){if(babelHelpers.classPrivateFieldLooseBase(this,He)[He]===null){babelHelpers.classPrivateFieldLooseBase(this,He)[He]=new this}return babelHelpers.classPrivateFieldLooseBase(this,He)[He]}}function ye(){return this.cache.remember("baas-popup",(()=>new p.PopupWithHeader({target:babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe](),id:`baas-components-maker-${this.constructor.justCounter++}`,width:344,content:[],asyncData:babelHelpers.classPrivateFieldLooseBase(this,Se)[Se](),template:new me,analyticsCallback:(e,t)=>{this.getAnalytic().onPlayerEvents(e,t)},popupOptions:{autoHide:true,closeByEsc:true,events:{onShow:e=>{var t;const s=e.getTarget();const a=d.Dom.getPosition(s.bindElement);const i=s.getPopupContainer().offsetWidth;const o=a.width/2-i/2;const n=r.Popup.getOption("angleLeftOffset")-r.Popup.getOption("angleMinTop");s.setAngle({offset:i/2-n});s.setOffset({offsetLeft:o+r.Popup.getOption("angleLeftOffset")});this.getAnalytic().activate().onShowFrom((t=s.bindElement.dataset.bxAnalyticContextLabel)!=null?t:Ae.CONTEXT_IS_NOT_SET)},onClose:()=>{this.getAnalytic().deactivate()}}}})))}function Oe(){return this.cache.has("boundLastElement")?this.cache.get("boundLastElement"):null}function we(){return new Promise(((e,t)=>{if(this.cache.has("widgetData")){e({data:this.cache.get("widgetData")})}else{this.getAjaxPromise().then((t=>{t.data=this.setData(t.data).convertIntoWidgetDataType();e(t)})).catch(t)}}))}function xe(e){var t;const s=e.getData().package;if(this.cache.has("baas-popup")&&(t=this.getPopup())!=null&&t.getContentContainer().contains(s.getContainer())){this.getPopup().setAutoHide(false);this.getPopup().setClosingByEsc(false)}}function ke(e){const t=e.getData().package;if(this.cache.has("baas-popup")&&this.getPopup().getContentContainer().contains(t.getContainer())){this.getPopup().setAutoHide(true);this.getPopup().setClosingByEsc(true)}}Ie.justCounter=0;Object.defineProperty(Ie,He,{writable:true,value:null});let Me=e=>e,Re,Ue;var Ne=babelHelpers.classPrivateFieldLooseKey("serviceCode");var je=babelHelpers.classPrivateFieldLooseKey("serviceData");var Ge=babelHelpers.classPrivateFieldLooseKey("getIconContainer");var $e=babelHelpers.classPrivateFieldLooseKey("getSubtitleContainer");var We=babelHelpers.classPrivateFieldLooseKey("adjustFromPull");var Xe=babelHelpers.classPrivateFieldLooseKey("instances");class Ke extends Ie{constructor(e){super(e);Object.defineProperty(this,We,{value:ze});Object.defineProperty(this,$e,{value:Ye});Object.defineProperty(this,Ge,{value:Ve});Object.defineProperty(this,Ne,{writable:true,value:void 0});Object.defineProperty(this,je,{writable:true,value:void 0});if(BX.PULL&&d.Extension.getSettings("baas.store").pull){BX.PULL.extendWatch(d.Extension.getSettings("baas.store").pull.channelName);b.EventEmitter.subscribe("onPullEvent-baas",(e=>{const[t,s]=e.getData();if(t==="updateService"&&s.service.code===babelHelpers.classPrivateFieldLooseBase(this,Ne)[Ne]){babelHelpers.classPrivateFieldLooseBase(this,We)[We](s.service)}}))}}setServiceCode(e){babelHelpers.classPrivateFieldLooseBase(this,Ne)[Ne]=e;return this}setData(e){super.setData(e);babelHelpers.classPrivateFieldLooseBase(this,je)[je]=e.service;babelHelpers.classPrivateFieldLooseBase(this,je)[je].icon.className=v.Set[babelHelpers.classPrivateFieldLooseBase(this,je)[je].icon.className]?babelHelpers.classPrivateFieldLooseBase(this,je)[je].icon.className:"QR_CODE_1";return this}getAjaxPromise(){return d.ajax.runAction("baas.Service.get",{data:{code:babelHelpers.classPrivateFieldLooseBase(this,Ne)[Ne]}})}getAnalytic(){return this.cache.remember("analyticObject",(()=>Ae.createByServiceCode(babelHelpers.classPrivateFieldLooseBase(this,Ne)[Ne])))}convertIntoWidgetDataType(){var e;const t=this.cache.get("response-data");d.Dom.addClass(this.getPopup().contentContainer,"--baas-widget --baas-specified");return{header:{icon:babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge](),top:{title:t.service.title,subtitle:babelHelpers.classPrivateFieldLooseBase(this,$e)[$e]()},info:t.adsInfo?{title:t.adsInfo.title,subtitle:t.adsInfo.subtitle,subtitleDescription:t.adsInfo.subtitleDescription,roundContent:{posterUrl:t.adsInfo.iconUrl,videos:[{url:t.adsInfo.videoUrl,type:t.adsInfo.videoFileType}]},moreLabel:d.Loc.getMessage("BAAS_WIDGET_MORE_LINK_TITLE"),code:t.adsInfo.featurePromotionCode||t.service.featurePromotionCode}:{title:t.service.description,roundContent:new v.Icon({icon:(e=v.Set[t.service.icon.className])!=null?e:v.Set.QR_CODE_1}).render(),moreLabel:d.Loc.getMessage("BAAS_WIDGET_MORE_LINK_TITLE"),code:t.service.featurePromotionCode}},items:t.packages}}bindAnalyticContext(e,t){if(Ae.CONTEXT_IS_NOT_SET===t){t=Ae.guessContextByServiceCode(babelHelpers.classPrivateFieldLooseBase(this,Ne)[Ne])}super.bindAnalyticContext(e,t);return this}static getInstanceByCode(e){if(!babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe][e]){babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe][e]=(new this).setServiceCode(e)}return babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe][e]}}function Ve(){return this.cache.remember("baas-popup-icon",(()=>{const e=babelHelpers.classPrivateFieldLooseBase(this,je)[je].icon;const t=e.className;let s=d.Tag.render(Re||(Re=Me`<div class="ui-popupconstructor-content-item__icon ui-icon-set"></div>`));if(v.Set[t]){const a={icon:v.Set[t]};if(e.color){a.color=e.color}s=new v.Icon(a).render()}else{d.Dom.addClass(s,t)}return s}))}function Ye(){return this.cache.remember("baas-popup-subtitle",(()=>d.Tag.render(Ue||(Ue=Me`<span>${0}</span>`),d.Text.encode(babelHelpers.classPrivateFieldLooseBase(this,je)[je].isActive?babelHelpers.classPrivateFieldLooseBase(this,je)[je].activeSubtitle:babelHelpers.classPrivateFieldLooseBase(this,je)[je].inactiveSubtitle))))}function ze(e){if(e.isActive!==babelHelpers.classPrivateFieldLooseBase(this,je)[je].isActive){if(e.isActive===true){babelHelpers.classPrivateFieldLooseBase(this,$e)[$e]().innerHTML=d.Text.encode(babelHelpers.classPrivateFieldLooseBase(this,je)[je].activeSubtitle)}else{babelHelpers.classPrivateFieldLooseBase(this,$e)[$e]().innerHTML=d.Text.encode(babelHelpers.classPrivateFieldLooseBase(this,je)[je].inactiveSubtitle)}}babelHelpers.classPrivateFieldLooseBase(this,je)[je].isActive=e.isActive;babelHelpers.classPrivateFieldLooseBase(this,je)[je].value=e.value}Object.defineProperty(Ke,Xe,{writable:true,value:[]});e.Widget=Ie;e.ServiceWidget=Ke;e.Analytics=Ae})(this.BX.Baas.Store=this.BX.Baas.Store||{},BX,BX.UI,BX.Main,BX.UI,BX.UI,BX.Main,BX.Bitrix24,BX,BX.UI,BX.UI,BX.UI.Analytics,BX,BX.Event,BX.UI.IconSet);
//# sourceMappingURL=list.bundle.map.js