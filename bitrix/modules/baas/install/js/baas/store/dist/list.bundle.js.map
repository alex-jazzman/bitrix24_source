{"version":3,"file":"list.bundle.js","sources":["../src/purchase/purchase-tile-default.js","../src/purchase/purchase-tile-annual.js","../src/purchase/purchases.js","../src/purchase/purchase-tile-disk-oo-edit.js","../src/purchase/purchase-tile-ai-copilot-token.js","../src/purchase/purchase-tile-ai-copilot-annual-token.js","../src/purchase/purchase-tile-documentgenerator-fast-transform.js","../src/purchase/purchases-factory.js","../src/package-item.js","../src/package-item-factory.js","../src/package-template-manager.js","../src/widget-icon.js","../src/analytics.js","../src/widget.js","../src/service-widget.js"],"sourcesContent":["import { Tag, Loc, Type } from 'main.core';\nimport { DateTimeFormat } from 'main.date';\nimport { EventEmitter } from 'main.core.events';\nimport { ProgressBar } from 'ui.progressbar';\nimport { ResponsePurchasedPackageDataType, ServiceInPurchasedPackageType } from '../types/response-purchased-package-data-type';\n\nexport class PurchaseTileDefault extends EventEmitter\n{\n\tFORMAT_DATE: String = 'YYYY-MM-DD'; // 'Y-m-d';\n\t#purchasedPackages: ?ResponsePurchasedPackageDataType[] = [];\n\n\tconstructor(purchasedPackages: ResponsePurchasedPackageDataType[])\n\t{\n\t\tsuper();\n\n\t\tthis.#purchasedPackages = purchasedPackages;\n\t\tthis.setEventNamespace('BX.Baas');\n\t}\n\n\tprepareGroupedPurchases(purchasedPackages: ResponsePurchasedPackageDataType[]): ResponsePurchasedPackageDataType\n\t{\n\t\tconst groupedPackageInfo = {\n\t\t\tstartDate: new Date(),\n\t\t\texpirationDate: new Date(),\n\t\t\tactual: 'N',\n\t\t\tservices: {},\n\t\t};\n\n\t\tpurchasedPackages.forEach((pack: ResponsePurchasedPackageDataType) => {\n\t\t\tconst startDate = DateTimeFormat.parse(pack.startDate, false, this.FORMAT_DATE);\n\t\t\tconst expirationDate = DateTimeFormat.parse(pack.expirationDate, false, this.FORMAT_DATE);\n\n\t\t\tif (startDate < groupedPackageInfo.startDate)\n\t\t\t{\n\t\t\t\tgroupedPackageInfo.startDate = startDate;\n\t\t\t}\n\n\t\t\tif (groupedPackageInfo.expirationDate < expirationDate)\n\t\t\t{\n\t\t\t\tgroupedPackageInfo.expirationDate = expirationDate;\n\t\t\t}\n\n\t\t\tconst actual = (pack.actual === 'Y' || pack.actual === true);\n\t\t\tgroupedPackageInfo.actual = actual ? 'Y' : groupedPackageInfo.actual;\n\t\t\tconst services = Type.isArray(pack.services) ? pack.services : Object.values(pack.services);\n\n\t\t\tservices\n\t\t\t\t.forEach((service: ServiceInPurchasedPackageType) => {\n\t\t\t\t\tconst serviceCode = service.code;\n\t\t\t\t\tgroupedPackageInfo.services[serviceCode] = groupedPackageInfo.services[serviceCode] || {\n\t\t\t\t\t\tcode: serviceCode,\n\t\t\t\t\t\tcurrent: 0,\n\t\t\t\t\t\tmaximal: 0,\n\t\t\t\t\t};\n\t\t\t\t\tgroupedPackageInfo.services[serviceCode].current += parseInt(service.current, 10);\n\t\t\t\t\tgroupedPackageInfo.services[serviceCode].maximal += parseInt(service.maximal, 10);\n\t\t\t\t})\n\t\t\t;\n\t\t});\n\n\t\treturn groupedPackageInfo;\n\t}\n\n\tgetGroupedPurchases(): ResponsePurchasedPackageDataType[]\n\t{\n\t\treturn this.#purchasedPackages;\n\t}\n\n\tgetPurchaseCodes(): string\n\t{\n\t\treturn this.getGroupedPurchases().map((pack: ResponsePurchasedPackageDataType) => pack.purchaseCode).join(',');\n\t}\n\n\tgetContainer(): HTMLElement\n\t{\n\t\tconst pack: ResponsePurchasedPackageDataType = this.prepareGroupedPurchases(this.getGroupedPurchases());\n\t\tpack.startDate = DateTimeFormat.format(DateTimeFormat.getFormat('LONG_DATE_FORMAT'), pack.startDate);\n\t\tpack.expirationDate = DateTimeFormat.format(DateTimeFormat.getFormat('LONG_DATE_FORMAT'), pack.expirationDate);\n\n\t\tconst count = this.getGroupedPurchases().length;\n\t\tconst multiple = this.getGroupedPurchases().length > 1;\n\n\t\tconst serviceGrouped: ServiceInPurchasedPackageType = {\n\t\t\tcurrent: 0,\n\t\t\tmaximal: 0,\n\t\t\tactive: 'N',\n\t\t};\n\n\t\tObject\n\t\t\t.keys(pack.services)\n\t\t\t.forEach((serviceCode: string) => {\n\t\t\t\tconst service: ServiceInPurchasedPackageType = pack.services[serviceCode];\n\t\t\t\tserviceGrouped.current += parseInt(service.current, 10);\n\t\t\t\tserviceGrouped.maximal += parseInt(service.maximal, 10);\n\t\t\t})\n\t\t;\n\n\t\tif (multiple)\n\t\t{\n\t\t\tconst modifiedClass = count > 2 ? '--more' : '--two';\n\n\t\t\treturn Tag.render`\n\t\t\t<div class=\"ui-popupcomponentmaker__content--section ${modifiedClass}\">\n\t\t\t\t<div class=\"ui-popupcomponentmaker__content--section-item\">\n\t\t\t\t\t<div class=\"ui-popupconstructor-content-item-wrapper\">\n\t\t\t\t\t\t<div class=\"ui-popupconstructor-content-item-wrapper_information\">\n\t\t\t\t\t\t\t<div class=\"ui-popupconstructor-content-item-wrapper-title\">\n\t\t\t\t\t\t\t\t<div class=\"ui-popupconstructor-content-item__title\">\n\t\t\t\t\t\t\t\t\t${[Loc.getMessage('BAAS_WIDGET_PURCHASES_TITLE'), ': ', count].join('')}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"ui-popupconstructor-content-item-subject\">\n\t\t\t\t\t\t\t\t\t<div class=\"ui-label ui-label-success ui-label-sm --active ui-label-fill\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"ui-label-status\"></div>\n\t\t\t\t\t\t\t\t\t\t<span class=\"ui-label-inner\">${Loc.getMessage('BAAS_WIDGET_PURCHASES_ARE_ACTIVE')}</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<button class=\"ui-popupconstructor-content-item-menu\" style=\"display: none;\" type=\"button\"></button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"ui-popupconstructor-content-item-progressbar\">${this.createProgressBar(serviceGrouped.current, serviceGrouped.maximal).getContainer()}</div>\n\t\t\t\t\t\t\t<div class=\"ui-popupconstructor-content-item-limit\">\n\t\t\t\t\t\t\t\t<span>${this.getLeftUnitsLabel()} </span>\n\t\t\t\t\t\t\t\t${Loc.getMessage('BAAS_WIDGET_PURCHASE_LEFT_STATUS', {\n\t\t\t\t\t\t\t\t\t'#left#': `<span class=\"ui-popupconstructor-content-item-num\">${serviceGrouped.current}</span>`,\n\t\t\t\t\t\t\t\t\t'#total#': `<span class=\"ui-popupconstructor-content-item-num\">${serviceGrouped.maximal}</span>`,\n\t\t\t\t\t\t\t\t\t'#date#': `<span class=\"ui-popupconstructor-content-item-date\">${pack.expirationDate}</span>`,\n\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>`;\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-popupcomponentmaker__content--section\">\n\t\t\t\t<div class=\"ui-popupcomponentmaker__content--section-item\">\n\t\t\t\t\t<div class=\"ui-popupconstructor-content-item-wrapper\">\n\t\t\t\t\t\t<div class=\"ui-popupconstructor-content-item-wrapper_information\">\n\t\t\t\t\t\t\t<div class=\"ui-popupconstructor-content-item-wrapper-title\">\n\t\t\t\t\t\t\t\t<div class=\"ui-popupconstructor-content-item__title\">\n\t\t\t\t\t\t\t\t\t${Loc.getMessage('BAAS_WIDGET_PURCHASE_TITLE')}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"ui-popupconstructor-content-item-subject\">\n\t\t\t\t\t\t\t\t\t<div class=\"ui-label ui-label-success ui-label-sm --active ui-label-fill\" ${pack.actual === 'Y' ? '' : 'style=\"display: none;\"'}>\n\t\t\t\t\t\t\t\t\t\t<div class=\"ui-label-status\"></div>\n\t\t\t\t\t\t\t\t\t\t<span class=\"ui-label-inner\">${Loc.getMessage('BAAS_WIDGET_PURCHASE_IS_ACTIVE')}</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class=\"ui-label ui-label-success ui-label-sm --paid ui-label-fill\" ${pack.actual === 'Y' ? 'style=\"display: none;\"' : ''}>\n\t\t\t\t\t\t\t\t\t\t<div class=\"ui-label-status\"></div>\n\t\t\t\t\t\t\t\t\t\t<span class=\"ui-label-inner\">${Loc.getMessage('BAAS_WIDGET_PURCHASES_ARE_PAID')}</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<button class=\"ui-popupconstructor-content-item-menu\" style=\"display: none;\" type=\"button\"></button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"ui-popupconstructor-content-item-progressbar\">${this.createProgressBar(serviceGrouped.current, serviceGrouped.maximal).getContainer()}</div>\n\t\t\t\t\t\t\t<div class=\"ui-popupconstructor-content-item-limit\">\n\t\t\t\t\t\t\t\t<span>${this.getLeftUnitsLabel()} </span>\n\t\t\t\t\t\t\t\t${Loc.getMessage('BAAS_WIDGET_PURCHASE_LEFT_STATUS', {\n\t\t\t\t\t\t\t\t\t'#left#': `<span class=\"ui-popupconstructor-content-item-num\">${serviceGrouped.current}</span>`,\n\t\t\t\t\t\t\t\t\t'#total#': `<span class=\"ui-popupconstructor-content-item-num\">${serviceGrouped.maximal}</span>`,\n\t\t\t\t\t\t\t\t\t'#date#': `<span class=\"ui-popupconstructor-content-item-date\">${pack.expirationDate}</span>`,\n\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>`\n\t\t;\n\t}\n\n\tgetLeftUnitsLabel(): string\n\t{\n\t\treturn Loc.getMessage('BAAS_WIDGET_PURCHASE_LEFT');\n\t}\n\n\tgetData(): ResponsePurchasedPackageDataType[]\n\t{\n\t\treturn this.#purchasedPackages;\n\t}\n\n\tcreateProgressBar(current: number, maximal: number): ProgressBar\n\t{\n\t\treturn new ProgressBar({\n\t\t\tvalue: Math.round(current / maximal * 100),\n\t\t\tsize: 4,\n\t\t});\n\t}\n}\n","import { Tag, Loc, Type } from 'main.core';\nimport { DateTimeFormat } from 'main.date';\nimport { ResponsePurchasedPackageDataType, ServiceInPurchasedPackageType } from '../types/response-purchased-package-data-type';\nimport { PurchaseTileDefault } from './purchase-tile-default';\n\nexport class PurchaseTileAnnual extends PurchaseTileDefault\n{\n\t#prepareActiveAndFuturePurchases(purchasedPackages: ResponsePurchasedPackageDataType[]): Object\n\t{\n\t\tconst rawActivePacks = {};\n\t\tconst rawInactivePacks = {};\n\t\tlet expirationDateObj = new Date();\n\n\t\tpurchasedPackages\n\t\t\t.forEach(\n\t\t\t\t(rawPack: ResponsePurchasedPackageDataType) => {\n\t\t\t\t\tconst actual = (rawPack.actual === 'Y' || rawPack.actual === true);\n\t\t\t\t\tconst pack = { ...rawPack };\n\t\t\t\t\tif (actual)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst expDateActive = DateTimeFormat.parse(rawPack.expirationDate, false, this.FORMAT_DATE).getTime();\n\t\t\t\t\t\trawActivePacks[expDateActive] = rawActivePacks[expDateActive] ?? [];\n\t\t\t\t\t\trawActivePacks[expDateActive].push(pack);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tconst startDate = DateTimeFormat.parse(rawPack.startDate, false, this.FORMAT_DATE).getTime();\n\t\t\t\t\t\trawInactivePacks[startDate] = rawInactivePacks[startDate] ?? [];\n\t\t\t\t\t\trawInactivePacks[startDate].push(pack);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst expDate = DateTimeFormat.parse(rawPack.expirationDate, false, this.FORMAT_DATE);\n\n\t\t\t\t\tif (expDate > expirationDateObj)\n\t\t\t\t\t{\n\t\t\t\t\t\texpirationDateObj = expDate;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t)\n\t\t;\n\n\t\tconst result = {\n\t\t\texpirationDate: DateTimeFormat.format(DateTimeFormat.getFormat('LONG_DATE_FORMAT'), expirationDateObj),\n\t\t};\n\n\t\tconst activePackKeys = Object.keys(rawActivePacks);\n\t\tif (activePackKeys.length > 0)\n\t\t{\n\t\t\tresult.active = {\n\t\t\t\tcurrent: 0,\n\t\t\t\tmaximal: 0,\n\t\t\t\texpirationDateObject: new Date(),\n\t\t\t\texpirationDate: '',\n\t\t\t};\n\t\t\tactivePackKeys\n\t\t\t\t.forEach(\n\t\t\t\t\t(key) => {\n\t\t\t\t\t\tconst packs = rawActivePacks[key];\n\t\t\t\t\t\tpacks\n\t\t\t\t\t\t\t.forEach((pack) => {\n\t\t\t\t\t\t\t\tObject\n\t\t\t\t\t\t\t\t\t.keys(pack.services)\n\t\t\t\t\t\t\t\t\t.forEach((serviceCode: string) => {\n\t\t\t\t\t\t\t\t\t\tconst service: ServiceInPurchasedPackageType = pack.services[serviceCode];\n\t\t\t\t\t\t\t\t\t\tresult.active.current += parseInt(service.current, 10);\n\t\t\t\t\t\t\t\t\t\tresult.active.maximal += parseInt(service.maximal, 10);\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t\tconst expDateActive = DateTimeFormat.parse(pack.expirationDate, false, this.FORMAT_DATE);\n\n\t\t\t\t\t\t\t\tif (result.active.expirationDateObject < expDateActive)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tresult.active.expirationDateObject = expDateActive;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t;\n\t\t\t\t\t},\n\t\t\t\t)\n\t\t\t;\n\t\t\tresult.active.expirationDate = DateTimeFormat.format(\n\t\t\t\tDateTimeFormat.getFormat('DAY_MONTH_FORMAT'),\n\t\t\t\tresult.active.expirationDateObject,\n\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult.next = {\n\t\t\t\tcurrent: 0,\n\t\t\t\tmaximal: 0,\n\t\t\t\tstartDateObject: new Date(),\n\t\t\t\tstartDate: '',\n\t\t\t};\n\n\t\t\tconst inactivePackKeys = Object\n\t\t\t\t.keys(rawInactivePacks)\n\t\t\t\t.sort((a, b) => {\n\t\t\t\t\treturn a < b ? -1 : 1;\n\t\t\t\t})\n\t\t\t;\n\t\t\tconst firstDate = inactivePackKeys[0];\n\t\t\tconst futurePacks = rawInactivePacks[firstDate];\n\n\t\t\tfuturePacks\n\t\t\t\t.forEach((pack) => {\n\t\t\t\t\tObject\n\t\t\t\t\t\t.keys(pack.services)\n\t\t\t\t\t\t.forEach((serviceCode: string) => {\n\t\t\t\t\t\t\tconst service: ServiceInPurchasedPackageType = pack.services[serviceCode];\n\t\t\t\t\t\t\tresult.next.current += parseInt(service.current, 10);\n\t\t\t\t\t\t\tresult.next.maximal += parseInt(service.maximal, 10);\n\t\t\t\t\t\t})\n\t\t\t\t\t;\n\t\t\t\t\tresult.next.startDate = pack.startDate;\n\t\t\t\t})\n\t\t\t;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetContainer(): HTMLElement\n\t{\n\t\tconst packageInfo = this.#prepareActiveAndFuturePurchases(this.getGroupedPurchases());\n\n\t\tconst count = this.getGroupedPurchases().length;\n\t\tconst modifiedClass = count > 2 ? '--more' : '--two';\n\t\tconst current = packageInfo.active ? packageInfo.active.current : packageInfo.next.current;\n\t\tconst maximal = packageInfo.active ? packageInfo.active.maximal : packageInfo.next.maximal;\n\t\tconst theDate = packageInfo.active ? packageInfo.active.expirationDate : packageInfo.next.startDate;\n\t\tconst expirationDate = packageInfo.expirationDate;\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-popupcomponentmaker__content--section ${modifiedClass}\">\n\t\t\t\t<div class=\"ui-popupcomponentmaker__content--section-item\">\n\t\t\t\t\t<div class=\"ui-popupconstructor-content-item-wrapper\">\n\t\t\t\t\t\t<div class=\"ui-popupconstructor-content-item-wrapper_information\">\n\t\t\t\t\t\t\t<div class=\"ui-popupconstructor-content-item-wrapper-title\">\n\t\t\t\t\t\t\t\t<div class=\"ui-popupconstructor-content-item__title\">\n\t\t\t\t\t\t\t\t\t${Loc.getMessage('BAAS_WIDGET_PURCHASE_TITLE')}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"ui-popupconstructor-content-item-subject\">\n\t\t\t\t\t\t\t\t\t<div class=\"ui-label ui-label-success ui-label-sm --active ui-label-fill\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"ui-label-status\"></div>\n\t\t\t\t\t\t\t\t\t\t<span class=\"ui-label-inner\">${Loc.getMessage('BAAS_WIDGET_PURCHASE_IS_ACTIVE')}</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"ui-popupconstructor-content-item-progressbar\">${this.createProgressBar(current, maximal).getContainer()}</div>\n\t\t\t\t\t\t\t${packageInfo.active ? Tag.render`\n\t\t\t\t\t\t\t\t<div class=\"ui-popupconstructor-content-item-limit\">\n\t\t\t\t\t\t\t\t\t<span>${this.getLeftUnitsLabel()} </span>\n\t\t\t\t\t\t\t\t\t\t${Loc.getMessage('BAAS_WIDGET_PURCHASE_LEFT_STATUS', {\n\t\t\t\t\t\t\t\t\t\t'#left#': `<span class=\"ui-popupconstructor-content-item-num\">${current}</span>`,\n\t\t\t\t\t\t\t\t\t\t'#total#': `<span class=\"ui-popupconstructor-content-item-num\">${maximal}</span>`,\n\t\t\t\t\t\t\t\t\t\t'#date#': `<span class=\"ui-popupconstructor-content-item-date\">${theDate}</span>`,\n\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t</div>` : Tag.render`\n\t\t\t\t\t\t\t\t<div class=\"ui-popupconstructor-content-item-limit\">\n\t\t\t\t\t\t\t\t\t<span>${this.getFutureUnitsLabel()} </span>\n\t\t\t\t\t\t\t\t\t\t${Loc.getMessage('BAAS_WIDGET_PURCHASE_WILL_BE_AVAILABLE_STATUS', {\n\t\t\t\t\t\t\t\t\t\t\t'#left#': `<span class=\"ui-popupconstructor-content-item-num\">${current}</span>`,\n\t\t\t\t\t\t\t\t\t\t\t'#total#': `<span class=\"ui-popupconstructor-content-item-num\">${maximal}</span>`,\n\t\t\t\t\t\t\t\t\t\t\t'#date#': `<span class=\"ui-popupconstructor-content-item-date\">${theDate}</span>`,\n\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t`}\n\t\t\t\t\t\t\t<div class=\"ui-popupconstructor-content-item-limit\">\n\t\t\t\t\t\t\t${Loc.getMessage('BAAS_WIDGET_PURCHASE_ANNUAL_LIFETIME', {\n\t\t\t\t\t\t\t\t'#date#': `<span class=\"ui-popupconstructor-content-item-date\">${expirationDate}</span>`,\n\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>`\n\t\t;\n\t}\n\n\tgetFutureUnitsLabel(): string\n\t{\n\t\treturn Loc.getMessage('BAAS_WIDGET_PURCHASES_FUTURE_UNITS');\n\t}\n}\n","import { Tag, Text, Loc, Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { DateTimeFormat } from 'main.date';\nimport { PackageItem } from '../package-item';\nimport { PurchaseTileDefault } from './purchase-tile-default';\nimport { PurchaseTileAnnual } from './purchase-tile-annual';\nimport { ResponsePurchaseDataType } from '../types/response-purchase-data-type';\nimport type { ResponsePackageDataType } from '../types/response-package-data-type';\n\nexport class Purchases extends EventEmitter\n{\n\tFORMAT_DATE = 'YYYY-MM-DD';\n\t#package: ?PackageItem = null;\n\n\tconstructor(packageItem: PackageItem)\n\t{\n\t\tsuper();\n\t\tthis.#package = packageItem;\n\t\tthis.setEventNamespace('BX.Baas');\n\t}\n\n\tgetContainer(): HTMLElement\n\t{\n\t\tconst data: ResponsePackageDataType = this.#package.getData();\n\n\t\treturn Tag.render`\n\t\t\t<div data-bx-package=\"${Text.encode(data.code)}\">\n\t\t\t\t<div class=\"ui-popupconstructor-content-main-title\">\n\t\t\t\t\t${this.#package.getIcon()}\n\t\t\t\t\t<div class=\"ui-popupconstructor-content-item__title\">${Text.encode(data.title)}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-popupcomponentmaker__content-wrap\">\n\t\t\t\t\t<div class=\"ui-popupcomponentmaker__content\">\n\t\t\t\t\t\t${this.renderPurchases()}\n\t\t\t\t\t\t<div class=\"ui-popupcomponentmaker__content--section --add\" onclick=\"${this.#openNewPurchase.bind(this)}\">\n\t\t\t\t\t\t\t<div class=\"ui-popupcomponentmaker__content--section-item\">\n\t\t\t\t\t\t\t\t<div class=\"ui-popupconstructor-content-item-wrapper\">\n\t\t\t\t\t\t\t\t\t<div class=\"ui-popupconstructor-content-item-add\">${Loc.getMessage('BAAS_WIDGET_PURCHASE_ADD')}</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\trenderPurchases(): HTMLElement[]\n\t{\n\t\tconst data: ResponsePackageDataType = this.getData();\n\t\tconst groupedPackages = this.groupPackages(data.purchaseInfo.purchases);\n\n\t\treturn [...groupedPackages]\n\t\t\t.map((group) => this.createPurchasedPackageTileContainer(...group))\n\t\t;\n\t}\n\n\tcreatePurchasedPackageTileContainer(groupedPackages, groupedByPurchase = false): HTMLElement\n\t{\n\t\tconst fabric = groupedByPurchase === true\n\t\t\t? this.getAnnualTileFabric(groupedPackages)\n\t\t\t: this.getDefaultTileFabric(groupedPackages)\n\t\t;\n\n\t\tconst container = fabric.getContainer();\n\t\tcontainer.dataset.bxRole = 'purchase-tile';\n\t\tcontainer.dataset.bxPurchasecodes = fabric.getPurchaseCodes();\n\n\t\treturn container;\n\t}\n\n\tsetDefaultTileFabric(classFabric: Function)\n\t{\n\t\tthis.getDefaultTileFabric = classFabric;\n\t}\n\n\tgetDefaultTileFabric(groupedPackages: ResponsePurchaseDataType[]): PurchaseTileDefault\n\t{\n\t\treturn (new PurchaseTileDefault(groupedPackages));\n\t}\n\n\tsetAnnualTileFabric(classFabric: Function)\n\t{\n\t\tthis.getAnnualTileFabric = classFabric;\n\t}\n\n\tgetAnnualTileFabric(groupedPackages: ResponsePurchaseDataType[]): PurchaseTileAnnual\n\t{\n\t\treturn (new PurchaseTileAnnual(groupedPackages));\n\t}\n\n\tgetData(): ResponsePackageDataType\n\t{\n\t\treturn this.#package.getData();\n\t}\n\n\tgroupPackages(purchases: ?ResponsePurchaseDataType[]): Object\n\t{\n\t\tconst singlePackages = {};\n\t\tconst groupedPackages = {};\n\n\t\t[...purchases]\n\t\t\t.forEach((purchase) => {\n\t\t\t\tconst onePackageInAPurchase = purchase.length <= 1;\n\n\t\t\t\t[...purchase]\n\t\t\t\t\t.forEach((purchasedPackage) => {\n\t\t\t\t\t\tlet id = DateTimeFormat.parse(purchasedPackage.expirationDate, false, this.FORMAT_DATE).getTime();\n\n\t\t\t\t\t\tif (onePackageInAPurchase)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (!singlePackages[id])\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tsinglePackages[id] = [];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tsinglePackages[id].push(purchasedPackage);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid = purchasedPackage.purchaseCode;\n\t\t\t\t\t\t\tif (!groupedPackages[id])\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tgroupedPackages[id] = {};\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tgroupedPackages[id][\n\t\t\t\t\t\t\t\tDateTimeFormat.parse(purchasedPackage.startDate, false, this.FORMAT_DATE).getTime()\n\t\t\t\t\t\t\t] = purchasedPackage;\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t;\n\t\t\t})\n\t\t;\n\n\t\tconst finalPackages = singlePackages;\n\n\t\t// region find the earliest date in propped packages\n\t\tObject\n\t\t\t.keys(groupedPackages)\n\t\t\t.forEach((key) => {\n\t\t\t\tconst sortedKeys = Object\n\t\t\t\t\t.keys(groupedPackages[key])\n\t\t\t\t\t.sort((a, b) => {\n\t\t\t\t\t\treturn a < b ? -1 : 1;\n\t\t\t\t\t})\n\t\t\t\t;\n\t\t\t\tlet earliestDate = sortedKeys[0];\n\t\t\t\twhile (finalPackages[earliestDate])\n\t\t\t\t{\n\t\t\t\t\tearliestDate += 1;\n\t\t\t\t}\n\t\t\t\tfinalPackages[earliestDate] = groupedPackages[key];\n\t\t\t})\n\t\t;\n\t\t// endregion\n\n\t\tconst sortedKeys = Object\n\t\t\t.keys(finalPackages)\n\t\t\t.sort((a, b) => {\n\t\t\t\treturn a < b ? -1 : 1;\n\t\t\t})\n\t\t;\n\n\t\treturn [...sortedKeys]\n\t\t\t.map((key) => {\n\t\t\t\tconst annual = !Type.isArray(finalPackages[key]);\n\t\t\t\tlet packages = finalPackages[key];\n\t\t\t\tif (annual)\n\t\t\t\t{\n\t\t\t\t\tpackages = Object.values(finalPackages[key]);\n\t\t\t\t}\n\n\t\t\t\treturn [packages, annual && packages.length > 1];\n\t\t\t})\n\t\t;\n\t}\n\n\t#openNewPurchase()\n\t{\n\t\tthis.#package.openNewPurchase();\n\t}\n}\n","import { Loc } from 'main.core';\nimport { PurchaseTileDefault } from './purchase-tile-default';\n\nexport class PurchaseTileDiskOoEdit extends PurchaseTileDefault\n{\n\tgetLeftUnitsLabel(): string\n\t{\n\t\treturn Loc.getMessage('BAAS_WIDGET_AI_PURCHASE_LEFT');\n\t}\n}\n","import { Loc } from 'main.core';\nimport { PurchaseTileDefault } from './purchase-tile-default';\n\nexport class PurchaseTileAiCopilotToken extends PurchaseTileDefault\n{\n\tgetLeftUnitsLabel(): string\n\t{\n\t\treturn Loc.getMessage('BAAS_WIDGET_AI_PURCHASE_LEFT');\n\t}\n}\n","import { Loc } from 'main.core';\nimport { PurchaseTileAnnual } from './purchase-tile-annual';\n\nexport class PurchaseTileAiCopilotAnnualToken extends PurchaseTileAnnual\n{\n\tgetLeftUnitsLabel(): string\n\t{\n\t\treturn Loc.getMessage('BAAS_WIDGET_AI_PURCHASE_LEFT');\n\t}\n}\n","import { Loc, Tag } from 'main.core';\nimport { DateTimeFormat } from 'main.date';\nimport { PurchaseTileDefault } from './purchase-tile-default';\nimport { ResponsePurchasedPackageDataType } from '../types/response-purchased-package-data-type';\n\nexport class PurchaseTileDocumentgeneratorFastTransform extends PurchaseTileDefault\n{\n\tgetContainer(): HTMLElement\n\t{\n\t\tconst pack: ResponsePurchasedPackageDataType = this.prepareGroupedPurchases(this.getGroupedPurchases());\n\t\tpack.startDate = DateTimeFormat.format(DateTimeFormat.getFormat('LONG_DATE_FORMAT'), pack.startDate);\n\t\tpack.expirationDate = DateTimeFormat.format(DateTimeFormat.getFormat('LONG_DATE_FORMAT'), pack.expirationDate);\n\n\t\tconst count = this.getGroupedPurchases().length;\n\t\tconst multiple = this.getGroupedPurchases().length > 1;\n\n\t\tif (multiple)\n\t\t{\n\t\t\tconst modifiedClass = count > 2 ? '--more' : '--two';\n\n\t\t\treturn Tag.render`\n\t\t\t<div class=\"ui-popupcomponentmaker__content--section ${modifiedClass}\">\n\t\t\t\t<div class=\"ui-popupcomponentmaker__content--section-item\">\n\t\t\t\t\t<div class=\"ui-popupconstructor-content-item-wrapper\">\n\t\t\t\t\t\t<div class=\"ui-popupconstructor-content-item-wrapper_information\">\n\t\t\t\t\t\t\t<div class=\"ui-popupconstructor-content-item-wrapper-title\">\n\t\t\t\t\t\t\t\t<div class=\"ui-popupconstructor-content-item__title\">\n\t\t\t\t\t\t\t\t\t${[Loc.getMessage('BAAS_WIDGET_PURCHASES_TITLE'), ': ', count].join('')}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"ui-popupconstructor-content-item-subject\">\n\t\t\t\t\t\t\t\t\t<div class=\"ui-label ui-label-success ui-label-sm --active ui-label-fill\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"ui-label-status\"></div>\n\t\t\t\t\t\t\t\t\t\t<span class=\"ui-label-inner\">${Loc.getMessage('BAAS_WIDGET_PURCHASES_ARE_ACTIVE')}</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<button class=\"ui-popupconstructor-content-item-menu\" style=\"display: none;\" type=\"button\"></button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"ui-popupconstructor-content-item-limit\">\n\t\t\t\t\t\t\t\t<span>${Loc.getMessage('BAAS_WIDGET_DFT_PURCHASE_LEFT')} </span>\n\t\t\t\t\t\t\t\t<span class=\"ui-popupconstructor-content-item-date\">${pack.expirationDate}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>`;\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-popupcomponentmaker__content--section\">\n\t\t\t\t<div class=\"ui-popupcomponentmaker__content--section-item\">\n\t\t\t\t\t<div class=\"ui-popupconstructor-content-item-wrapper\">\n\t\t\t\t\t\t<div class=\"ui-popupconstructor-content-item-wrapper_information\">\n\t\t\t\t\t\t\t<div class=\"ui-popupconstructor-content-item-wrapper-title\">\n\t\t\t\t\t\t\t\t<div class=\"ui-popupconstructor-content-item__title\">${Loc.getMessage('BAAS_WIDGET_PURCHASE_TITLE')}</div>\n\t\t\t\t\t\t\t\t<div class=\"ui-popupconstructor-content-item-subject\">\n\t\t\t\t\t\t\t\t\t<div class=\"ui-label ui-label-success ui-label-sm --active ui-label-fill\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"ui-label-status\"></div>\n\t\t\t\t\t\t\t\t\t\t<span class=\"ui-label-inner\">${Loc.getMessage('BAAS_WIDGET_PURCHASE_IS_ACTIVE')}</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"ui-popupconstructor-content-item-limit\">\n\t\t\t\t\t\t\t\t<span>${Loc.getMessage('BAAS_WIDGET_DFT_PURCHASE_LEFT')} </span>\n\t\t\t\t\t\t\t\t<span class=\"ui-popupconstructor-content-item-date\">${pack.expirationDate}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>`;\n\t}\n}\n","import { Type } from 'main.core';\nimport { ResponsePurchaseDataType } from '../types/response-purchase-data-type';\nimport { Purchases } from './purchases';\nimport { PurchaseTileDiskOoEdit } from './purchase-tile-disk-oo-edit';\nimport { PurchaseTileAiCopilotToken } from './purchase-tile-ai-copilot-token';\nimport { PurchaseTileAiCopilotAnnualToken } from './purchase-tile-ai-copilot-annual-token';\nimport { PurchaseTileDocumentgeneratorFastTransform } from './purchase-tile-documentgenerator-fast-transform';\nimport { PackageItem } from '../package-item';\n\nexport class PurchasesFactory\n{\n\tcreate(packageItem: PackageItem): PurchasesDefault\n\t{\n\t\tconst serviceCode = this.#detectServiceCode(packageItem.getData().purchaseInfo.purchases);\n\t\tconst purchase = new Purchases(packageItem);\n\n\t\tif (serviceCode === 'ai_copilot_token')\n\t\t{\n\t\t\tpurchase.setDefaultTileFabric((...params) => new PurchaseTileAiCopilotToken(...params));\n\t\t\tpurchase.setAnnualTileFabric((...params) => new PurchaseTileAiCopilotAnnualToken(...params));\n\t\t}\n\t\telse if (serviceCode === 'documentgenerator_fast_transform')\n\t\t{\n\t\t\tpurchase.setDefaultTileFabric((...params) => new PurchaseTileDocumentgeneratorFastTransform(...params));\n\t\t\tpurchase.groupPackages = (purchases: ?ResponsePurchaseDataType[]) => {\n\t\t\t\tconst groupedPackages = [];\n\n\t\t\t\t[...purchases]\n\t\t\t\t\t.forEach((purchase) => {\n\t\t\t\t\t\t[...purchase]\n\t\t\t\t\t\t\t.forEach((purchasedPackage) => {\n\t\t\t\t\t\t\t\tgroupedPackages.push(purchasedPackage);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t;\n\t\t\t\t\t})\n\t\t\t\t;\n\n\t\t\t\treturn [[groupedPackages]];\n\t\t\t};\n\t\t}\n\t\telse if (serviceCode === 'disk-oo-edit')\n\t\t{\n\t\t\tpurchase.setDefaultTileFabric((...params) => new PurchaseTileDiskOoEdit(...params));\n\t\t}\n\n\t\treturn purchase;\n\t}\n\n\t#detectServiceCode(purchases: Array): ?string\n\t{\n\t\tlet serviceCode = null;\n\t\tlet multiple = false;\n\n\t\t[...purchases]\n\t\t\t.forEach((purchase) => {\n\t\t\t\t[...purchase]\n\t\t\t\t\t.forEach((purchasedPackage) => {\n\t\t\t\t\t\tif (purchasedPackage.services.length > 1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmultiple = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst thisServiceCode = purchasedPackage.services[0].code;\n\t\t\t\t\t\t\tif (serviceCode === null)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tserviceCode = thisServiceCode;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if (thisServiceCode !== serviceCode)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tmultiple = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t;\n\t\t\t})\n\t\t;\n\n\t\treturn multiple ? null : serviceCode;\n\t}\n}\n","import { Cache, Dom, Tag, Text, Type, Loc, Extension, Event } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Button } from 'ui.buttons';\nimport { PurchasesFactory } from './purchase/purchases-factory';\nimport { ResponseDataType } from './types/response-data-type';\nimport type { ResponsePackageDataType } from './types/response-package-data-type';\nimport { Icon, Set } from 'ui.icon-set.api.core';\nimport { Label, LabelSize } from 'ui.label';\nimport { FeaturePromotersRegistry } from 'ui.info-helper';\nimport { PopupManager } from 'main.popup';\nimport { License } from 'bitrix24.license';\nimport 'ui.notification';\n\nexport class PackageItem extends EventEmitter\n{\n\t#cache: Cache.MemoryCache = new Cache.MemoryCache();\n\t#data: ?ResponsePackageDataType = null;\n\n\tconstructor(data: ResponsePackageDataType)\n\t{\n\t\tsuper();\n\t\tthis.#data = data;\n\t\tthis.setEventNamespace('BX.Baas');\n\n\t\tif (BX.PULL && Extension.getSettings('baas.store').pull)\n\t\t{\n\t\t\tBX.PULL.extendWatch(Extension.getSettings('baas.store').pull.channelName);\n\n\t\t\tEventEmitter.subscribe('onPullEvent-baas', (event: BaseEvent) => {\n\t\t\t\tconst [command: string, params: ResponseDataType] = event.getData();\n\t\t\t\tif (command === 'updateService' && params.packages)\n\t\t\t\t{\n\t\t\t\t\t[...params.packages]\n\t\t\t\t\t\t.forEach((packagePullData: ResponsePackageDataType) => {\n\t\t\t\t\t\t\tif (packagePullData.code === this.#data.code)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.#adjustPackage(packagePullData);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tgetContainer(): HTMLElement\n\t{\n\t\treturn this.#cache.remember('container', () => {\n\t\t\tconst data = this.#data;\n\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"ui-popupconstructor-content-item-wrapper\" data-bx-role=\"package-tile\" data-bx-package=\"${Text.encode(data.code)}\">\n\t\t\t\t\t<div class=\"ui-popupconstructor-content-item-wrapper_information\">\n\t\t\t\t\t\t<div class=\"ui-popupconstructor-content-item-wrapper-title\">\n\t\t\t\t\t\t\t${this.getIcon()}\n\t\t\t\t\t\t\t<div class=\"ui-popupconstructor-content-item__title\">${Text.encode(data.title)}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<div class=\"ui-popupconstructor-content-item__description\">\n\t\t\t\t\t\t\t\t${Text.encode(data.description)}\n\t\t\t\t\t\t\t\t${this.#renderMoreLink(this.#data.featurePromotionCode)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t${this.#getPurchaseBlock()}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"ui-popupconstructor-content-item-wrapper_button\">\n\t\t\t\t\t\t${this.#renderButton(this.#data)}\n\t\t\t\t\t\t${this.#renderButtonDescription(this.#data)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetIcon(): HTMLElement\n\t{\n\t\treturn this.#renderIcon(this.#data.icon);\n\t}\n\n\t#renderIcon(iconParams: { className: ?string, color: ?string, style: ?Object }): ?HTMLElement\n\t{\n\t\tconst params = {};\n\t\tconst style = iconParams.style ?? {};\n\n\t\tlet iconNode = Tag.render`\n\t\t\t<div class=\"ui-popupconstructor-content-item__icon ui-icon-set\"></div>\n\t\t`;\n\n\t\tif (Type.isStringFilled(iconParams.className))\n\t\t{\n\t\t\tif (Set[iconParams.className])\n\t\t\t{\n\t\t\t\tparams.icon = Set[iconParams.className];\n\n\t\t\t\tif (iconParams.color)\n\t\t\t\t{\n\t\t\t\t\tparams.color = iconParams.color;\n\t\t\t\t}\n\t\t\t\ticonNode = (new Icon(params)).render();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.addClass(iconNode, iconParams.className);\n\t\t\t}\n\t\t}\n\n\t\tDom.style(iconNode, style);\n\n\t\treturn iconNode;\n\t}\n\n\t#renderMoreLink(featurePromotionCode: ?string): ?HTMLElement\n\t{\n\t\tif (!Type.isStringFilled(featurePromotionCode))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst node = Tag.render`\n\t\t\t<div class=\"ui-popupconstructor-content-item__more-link\">${Loc.getMessage('BAAS_WIDGET_MORE_LINK_TITLE')}</div>\n\t\t`;\n\t\tconst onclick = (e) => {\n\t\t\te.stopPropagation();\n\t\t\tconst popup = FeaturePromotersRegistry.getPromoter({ code: featurePromotionCode });\n\t\t\tpopup.show();\n\t\t};\n\n\t\tEvent.bind(node, 'click', onclick);\n\n\t\treturn node;\n\t}\n\n\t#renderButton(data: ResponsePackageDataType): HTMLElement\n\t{\n\t\tif (!Type.isPlainObject(data.price))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst button = data.isActive ? new Button({\n\t\t\tround: true,\n\t\t\ttext: Loc.getMessage('BAAS_WIDGET_BUY_BUTTON_TITLE'),\n\t\t\tsize: Button.Size.EXTRA_SMALL,\n\t\t\tcolor: Button.Color.SUCCESS,\n\t\t\tnoCaps: true,\n\t\t\tonclick: this.openNewPurchase.bind(this),\n\t\t}) : new Button({\n\t\t\tround: true,\n\t\t\ttext: Loc.getMessage('BAAS_WIDGET_BUY_BUTTON_TITLE'),\n\t\t\tsize: Button.Size.EXTRA_SMALL,\n\t\t\tcolor: Button.Color.SUCCESS,\n\t\t\tstate: Button.State.DISABLED,\n\t\t\tnoCaps: true,\n\t\t\tonclick: () => {\n\t\t\t\treturn false;\n\t\t\t},\n\t\t});\n\n\t\treturn button.render();\n\t}\n\n\t#isPaidLicense(): boolean\n\t{\n\t\treturn Extension.getSettings('baas.store').isBaasActive;\n\t}\n\n\topenNewPurchase()\n\t{\n\t\tconst purchaseUrl = this.#data.purchaseUrl;\n\t\tconst isBitrix24 = Extension.getSettings('baas.store').get('isBitrix24License');\n\n\t\tif (isBitrix24 && !this.#isPaidLicense())\n\t\t{\n\t\t\tconst findPackageCode = /product=(\\w+)/gi;\n\t\t\tconst params = { package: this.#data.code };\n\n\t\t\tif (findPackageCode.test(this.#data.purchaseUrl))\n\t\t\t{\n\t\t\t\tparams.package = this.#data.purchaseUrl.match(findPackageCode)[0].replace('product=', '');\n\t\t\t}\n\n\t\t\tLicense.openPurchasePage(params);\n\t\t}\n\t\telse if (\n\t\t\tisBitrix24\n\t\t\t&& Extension.getSettings('baas.store').get('canBaasOnlyBePurchasedByAdmin')\n\t\t\t&& !Extension.getSettings('baas.store').get('isCurrentUserAdmin')\n\t\t)\n\t\t{\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tcontent: Loc.getMessage('BAAS_WIDGET_ONLY_ADMIN_CAN_PURCHASE_BAAS'),\n\t\t\t\tcategory: 'baas',\n\t\t\t\tautoHideDelay: 5000,\n\t\t\t});\n\t\t}\n\t\telse if (purchaseUrl.indexOf('http') === 0)\n\t\t{\n\t\t\twindow.open(purchaseUrl);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.SidePanel.Instance.open(\n\t\t\t\tpurchaseUrl,\n\t\t\t\t{\n\t\t\t\t\twidth: 1250,\n\t\t\t\t\tcacheable: false,\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\n\t\tthis.emit('onClickToBuyPackage', { packageCode: this.#data.code });\n\t}\n\n\t#renderButtonDescription(data: ResponsePackageDataType): ?HTMLElement\n\t{\n\t\treturn data.isActive ? Tag.render`\n\t\t\t<div class=\"ui-popupconstructor-content-item__button-description\">\n\t\t\t\t<div>${data.price.value}</div>\n\t\t\t\t${data.price.description}\n\t\t\t</div>\n\t\t` : null;\n\t}\n\n\t#getPurchaseBlock(): HTMLElement\n\t{\n\t\treturn this.#cache.remember('purchase-block', (): HTMLElement => {\n\t\t\tconst data: ResponsePackageDataType = this.#data;\n\n\t\t\tif (Type.isPlainObject(data.purchaseInfo))\n\t\t\t{\n\t\t\t\tconst purchaseInfo = data.purchaseInfo;\n\n\t\t\t\tif (purchaseInfo && purchaseInfo.purchaseCount > 0)\n\t\t\t\t{\n\t\t\t\t\tconst activityLabel = new Label({\n\t\t\t\t\t\ttext: (purchaseInfo.purchaseCount > 1\n\t\t\t\t\t\t\t? Loc.getMessage('BAAS_WIDGET_PURCHASES_ARE_ACTIVE')\n\t\t\t\t\t\t\t: Loc.getMessage('BAAS_WIDGET_PURCHASE_IS_ACTIVE')\n\t\t\t\t\t\t),\n\t\t\t\t\t\tsize: LabelSize.SM,\n\t\t\t\t\t\tfill: true,\n\t\t\t\t\t\tcustomClass: '--active',\n\t\t\t\t\t});\n\t\t\t\t\tconst limitLabel = purchaseInfo.purchaseBalance > 20 ? null : (\n\t\t\t\t\t\tpurchaseInfo.purchaseBalance > 0 ? new Label({\n\t\t\t\t\t\t\ttext: Loc.getMessage('BAAS_WIDGET_PURCHASE_LIMIT_IS_ALMOST_EXCEEDED'),\n\t\t\t\t\t\t\tsize: LabelSize.SM,\n\t\t\t\t\t\t\tfill: true,\n\t\t\t\t\t\t\tcustomClass: '--almost',\n\t\t\t\t\t\t}) : new Label({\n\t\t\t\t\t\t\ttext: Loc.getMessage('BAAS_WIDGET_PURCHASE_LIMIT_IS_EXCEEDED'),\n\t\t\t\t\t\t\tsize: LabelSize.SM,\n\t\t\t\t\t\t\tfill: true,\n\t\t\t\t\t\t\tcustomClass: '--exceeded',\n\t\t\t\t\t\t})\n\t\t\t\t\t);\n\n\t\t\t\t\treturn Tag.render`\n\t\t\t\t\t\t<div class=\"ui-popupconstructor-content-item__purchase-description\" onclick=\"${this.showPurchases.bind(this)}\">\n\t\t\t\t\t\t\t<span class=\"ui-link ui-link-dashed\">${Loc.getMessage('BAAS_WIDGET_PURCHASE_TITLE')}: ${purchaseInfo.purchaseCount}</span>\n\t\t\t\t\t\t\t${activityLabel.render()}\n\t\t\t\t\t\t\t${limitLabel ? limitLabel.render() : ''}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn Tag.render`<div></div>`;\n\t\t});\n\t}\n\n\tshowPurchases()\n\t{\n\t\tEventEmitter.emit(\n\t\t\tEventEmitter.GLOBAL_TARGET,\n\t\t\tthis.getFullEventName('onPurchaseShown'),\n\t\t\tnew BaseEvent({ data: { package: this, packageCode: this.#data.code } }),\n\t\t);\n\t\tconst bindElement = this.getContainer().closest('div.popup-window');\n\n\t\tconst padding = 10;\n\t\tconst popupWidth = bindElement.offsetWidth - padding * 2;\n\t\tconst popupHeight = bindElement.offsetHeight - padding * 2;\n\t\tconst fabric = new PurchasesFactory();\n\n\t\tconst popup = PopupManager.create({\n\t\t\tid: 'purchase',\n\t\t\tautoHide: true,\n\t\t\tcacheable: false,\n\t\t\tcloseIcon: true,\n\t\t\tlightShadow: true,\n\t\t\tdraggable: false,\n\t\t\tcloseByEsc: true,\n\t\t\tpadding: 0,\n\t\t\tclassName: '--baas-widget --purchase',\n\t\t\tcontent: fabric.create(this).getContainer(),\n\n\t\t\tbindElement,\n\t\t\toffsetTop: 0 - popupHeight - padding,\n\t\t\toffsetLeft: padding,\n\t\t\tbindOptions: {\n\t\t\t\tposition: 'bottom',\n\t\t\t},\n\t\t\twidth: popupWidth,\n\t\t\theight: popupHeight,\n\n\t\t\tevents: {\n\t\t\t\tonClose: () => {\n\t\t\t\t\tEventEmitter.emit(\n\t\t\t\t\t\tEventEmitter.GLOBAL_TARGET,\n\t\t\t\t\t\tthis.getFullEventName('onPurchaseHidden'),\n\t\t\t\t\t\tnew BaseEvent({ data: { package: this } }),\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tpopup.show();\n\t}\n\n\t#adjustPackage(newPackageData: ResponsePackageDataType)\n\t{\n\t\tthis.#data.purchaseInfo = newPackageData.purchaseInfo;\n\t\tif (this.#cache.has('purchase-block'))\n\t\t{\n\t\t\tconst oldNode = this.#cache.get('purchase-block');\n\t\t\tthis.#cache.delete('purchase-block');\n\t\t\tconst newNode = this.#getPurchaseBlock();\n\t\t\tDom.replace(oldNode, newNode);\n\t\t}\n\t}\n\n\tgetData(): ResponsePackageDataType\n\t{\n\t\treturn this.#data;\n\t}\n}\n","import { WidgetPackageDataType } from './types/widget-package-data-type';\nimport { PackageItem } from './package-item';\n\nexport class PackageItemFactory\n{\n\tcreate(data: WidgetPackageDataType): PackageItem\n\t{\n\t\treturn new PackageItem(data);\n\t}\n}\n","import { Cache, Type, Tag } from 'main.core';\nimport { Button } from 'ui.buttons';\nimport type { WidgetPackageDataType } from './types/widget-package-data-type';\nimport { BaseTemplate } from 'ui.popup-with-header';\nimport { PackageItemFactory } from './package-item-factory';\n\nexport type ResultContent = {\n\thtml: HTMLElement,\n\tbackgroundColor?: string,\n\tmargin?: string,\n};\n\nexport class PackageTemplateManager extends BaseTemplate\n{\n\t#cache = new Cache.MemoryCache();\n\t#items: WidgetPackageDataType[] = [];\n\n\tconstructor(options?: { items: WidgetPackageDataType[]})\n\t{\n\t\tsuper();\n\t\tthis.#items = Type.isPlainObject(options) ? options.items : [];\n\t}\n\n\tsetOptions(data: {[key: string]: any }): void\n\t{\n\t\tif (data.items)\n\t\t{\n\t\t\tthis.#items = (Type.isPlainObject(data.items) ? Object.values(data.items)\n\t\t\t\t: (Type.isArray(data.items) ? data.items : [])\n\t\t\t);\n\t\t}\n\n\t\tsuper.setOptions(data);\n\t}\n\n\tgetContent(): Array<ResultContent>\n\t{\n\t\treturn this.#cache.remember('popup-content', () => {\n\t\t\tconst factory = new PackageItemFactory();\n\n\t\t\treturn this.#items.map((serviceData: WidgetPackageDataType, index) => {\n\t\t\t\tconst item = factory.create(serviceData);\n\n\t\t\t\treturn {\n\t\t\t\t\thtml: item.getContainer(),\n\t\t\t\t\tbackground: serviceData.styles?.background,\n\t\t\t\t\tmargin: index === 0 ? '12px 0 0 0' : null,\n\t\t\t\t};\n\t\t\t});\n\t\t});\n\t}\n}\n","import { Dom, Event } from 'main.core';\nimport { Icon, IconOptions } from 'ui.icon-set.api.core';\n\nexport class WidgetIcon extends Icon\n{\n\t#events: Object = {};\n\n\tconstructor(params: IconOptions = {})\n\t{\n\t\tsuper(params);\n\n\t\tif (params.events)\n\t\t{\n\t\t\tthis.#events = params.events;\n\t\t}\n\t}\n\n\trender(): Node\n\t{\n\t\tthis.iconElement = super.render();\n\t\tDom.style(this.iconElement, 'opacity', '60%');\n\t\tObject.keys(this.#events).forEach((eventName) => {\n\t\t\tEvent.bind(this.iconElement, eventName, this.#events[eventName]);\n\t\t});\n\n\t\treturn this.iconElement;\n\t}\n}\n","import { Extension } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { sendData } from 'ui.analytics';\n\nexport class Analytics\n{\n\tstatic EVENT_SHOW_POPUP = 'show';\n\tstatic EVENT_CLICK_TO_BUY = 'button_buy_click';\n\tstatic EVENT_CLICK_TO_VIEW_PURCHASE = 'button_click_active_boost';\n\n\tstatic SERVICE_ALL = 'main';\n\tstatic SERVICE_AI_COPILOT_TOKEN = 'copilot';\n\tstatic SERVICE_DOCUMENTGENERATOR_FAST_TRANSFORM = 'speed';\n\tstatic SERVICE_DISK_OO_EDIT = 'docs';\n\n\tstatic CONTEXT_IS_NOT_SET = 'notSet';\n\tstatic CONTEXT_LICENSE_WIDGET = 'headerPopup';\n\tstatic CONTEXT_IM_CHAT = 'chat';\n\tstatic CONTEXT_STREAM = 'stream';\n\tstatic CONTEXT_CRM = 'CRM';\n\tstatic CONTEXT_TASKS = 'tasks';\n\n\t#serviceCode: string;\n\t#lastContext: string;\n\t#active: boolean = false;\n\n\tconstructor(serviceCode: string)\n\t{\n\t\tthis.#serviceCode = serviceCode;\n\t\tthis.#lastContext = Analytics.CONTEXT_IS_NOT_SET;\n\t\tthis.onClickToBuyPackage = this.onClickToBuyPackage.bind(this);\n\t\tthis.onPurchaseShown = this.onPurchaseShown.bind(this);\n\t}\n\n\tactivate(): this\n\t{\n\t\tthis.#active = true;\n\t\tEventEmitter.subscribe('BX.Baas:onClickToBuyPackage', this.onClickToBuyPackage);\n\t\tEventEmitter.subscribe('BX.Baas:onPurchaseShown', this.onPurchaseShown);\n\n\t\treturn this;\n\t}\n\n\tdeactivate(): this\n\t{\n\t\tEventEmitter.unsubscribe('BX.Baas:onClickToBuyPackage', this.onClickToBuyPackage);\n\t\tEventEmitter.unsubscribe('BX.Baas:onPurchaseShown', this.onPurchaseShown);\n\t\tthis.#active = false;\n\n\t\treturn this;\n\t}\n\n\tonShowFrom(context: string)\n\t{\n\t\tthis.#lastContext = context;\n\t\tthis.constructor.#send(this.constructor.EVENT_SHOW_POPUP, this.#serviceCode, context);\n\t}\n\n\tonPlayerEvents(eventName: string, additionalVideoParameter: string)\n\t{\n\t\tif (this.#active)\n\t\t{\n\t\t\tthis.constructor.#send(\n\t\t\t\teventName,\n\t\t\t\tthis.#serviceCode,\n\t\t\t\tthis.#lastContext,\n\t\t\t\tadditionalVideoParameter ? { p2: additionalVideoParameter } : {},\n\t\t\t);\n\t\t}\n\t}\n\n\tonClickToBuyPackage(event: BaseEvent)\n\t{\n\t\tthis.constructor.#send(\n\t\t\tthis.constructor.EVENT_CLICK_TO_BUY,\n\t\t\tthis.#serviceCode,\n\t\t\tthis.#lastContext,\n\t\t\t{ p2: event.getData().packageCode.replaceAll('_', '-') },\n\t\t);\n\t}\n\n\tonPurchaseShown(event: BaseEvent)\n\t{\n\t\tthis.constructor.#send(\n\t\t\tthis.constructor.EVENT_CLICK_TO_VIEW_PURCHASE,\n\t\t\tthis.#serviceCode,\n\t\t\tthis.#lastContext,\n\t\t\t{ p2: event.getData().packageCode.replaceAll('_', '-') },\n\t\t);\n\t}\n\n\tstatic #send(event: string, serviceCode: string, context: string, additional: Object = {})\n\t{\n\t\tsendData(Object.assign(additional, {\n\t\t\ttool: 'boost',\n\t\t\tcategory: 'buy',\n\t\t\tevent,\n\t\t\ttype: serviceCode,\n\t\t\tc_section: context,\n\t\t\tp1: Extension.getSettings('baas.store').get('isCurrentUserAdmin') ? 'isAdmin_Y' : 'isAdmin_N',\n\t\t}));\n\t}\n\n\tstatic createByServiceCode(serviceCodeId: string): this\n\t{\n\t\tlet serviceCode = null;\n\t\tswitch (serviceCodeId)\n\t\t{\n\t\t\tcase 'ai_copilot_token':\n\t\t\t\tserviceCode = this.SERVICE_AI_COPILOT_TOKEN;\n\t\t\t\tbreak;\n\t\t\tcase 'disk_oo_edit':\n\t\t\t\tserviceCode = this.SERVICE_DISK_OO_EDIT;\n\t\t\t\tbreak;\n\t\t\tcase 'documentgenerator_fast_transform':\n\t\t\t\tserviceCode = this.SERVICE_DOCUMENTGENERATOR_FAST_TRANSFORM;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tserviceCode = this.SERVICE_ALL;\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn new this(serviceCode);\n\t}\n\n\tstatic guessContextByServiceCode(serviceCodeId: string): string\n\t{\n\t\tlet serviceContext = null;\n\t\tswitch (serviceCodeId)\n\t\t{\n\t\t\tcase 'ai_copilot_token':\n\t\t\t\tserviceContext = this.CONTEXT_STREAM;\n\t\t\t\tbreak;\n\t\t\tcase 'disk_oo_edit':\n\t\t\t\tserviceContext = this.CONTEXT_TASKS;\n\t\t\t\tbreak;\n\t\t\tcase 'documentgenerator_fast_transform':\n\t\t\t\tserviceContext = this.CONTEXT_CRM;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tserviceContext = this.CONTEXT_LICENSE_WIDGET;\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn serviceContext;\n\t}\n}\n","import type { AjaxResponse, AjaxSuccess } from 'main.core';\nimport { Cache, Loc, ajax, Dom, Type } from 'main.core';\nimport { EventEmitter, BaseEvent } from 'main.core.events';\nimport 'ui.icons.b24';\nimport { Popup } from 'main.popup';\nimport { Button, ButtonColor, ButtonSize } from 'ui.buttons';\nimport { PackageItem } from './package-item';\nimport { PackageTemplateManager } from './package-template-manager';\nimport { ResponseDataType } from './types/response-data-type';\nimport type { WidgetDataType } from './types/widget-data-type';\nimport { PopupWithHeader } from 'ui.popup-with-header';\nimport { Actions, Icon, Set } from 'ui.icon-set.api.core';\nimport { WidgetIcon } from './widget-icon';\nimport { Analytics } from './analytics';\n\nexport class Widget extends EventEmitter\n{\n\tstatic justCounter: Number = 0;\n\tcache: Cache.MemoryCache = new Cache.MemoryCache();\n\tanalytic: Analytics;\n\n\tconstructor(widgetData: ?WidgetDataType)\n\t{\n\t\tsuper();\n\n\t\tthis.setEventNamespace('BX.Baas');\n\n\t\tEventEmitter.subscribe(\n\t\t\tEventEmitter.GLOBAL_TARGET,\n\t\t\t'BX.Baas:onPurchaseShown',\n\t\t\t(event: BaseEvent) => this.#onPurchaseShown(event),\n\t\t);\n\t\tEventEmitter.subscribe(\n\t\t\tEventEmitter.GLOBAL_TARGET,\n\t\t\t'BX.Baas:onPurchaseHidden',\n\t\t\t(event: BaseEvent) => this.#onPackageHidden(event),\n\t\t);\n\n\t\tthis.cache.set('boundElements', new WeakMap());\n\t}\n\n\t#getPopupWithHeader(): PopupWithHeader\n\t{\n\t\treturn this.cache.remember('baas-popup', () => {\n\t\t\treturn new PopupWithHeader({\n\t\t\t\ttarget: this.#getLastBoundElement(),\n\t\t\t\tid: `baas-components-maker-${this.constructor.justCounter++}`,\n\t\t\t\twidth: 344,\n\t\t\t\tcontent: [],\n\t\t\t\tasyncData: this.#fetchData(),\n\t\t\t\ttemplate: new PackageTemplateManager(),\n\t\t\t\tanalyticsCallback: (event, additionalParameter) => {\n\t\t\t\t\tthis.getAnalytic().onPlayerEvents(event, additionalParameter);\n\t\t\t\t},\n\t\t\t\tpopupOptions: {\n\t\t\t\t\tautoHide: true,\n\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonShow: (event: BaseEvent): void => {\n\t\t\t\t\t\t\tconst popup = event.getTarget();\n\t\t\t\t\t\t\tconst targetPos = Dom.getPosition(popup.bindElement);\n\t\t\t\t\t\t\tconst popupWidth = popup.getPopupContainer().offsetWidth;\n\t\t\t\t\t\t\tconst offsetLeft = (targetPos.width / 2) - (popupWidth / 2);\n\t\t\t\t\t\t\tconst angleShift = Popup.getOption('angleLeftOffset') - Popup.getOption('angleMinTop');\n\n\t\t\t\t\t\t\tpopup.setAngle({ offset: popupWidth / 2 - angleShift });\n\t\t\t\t\t\t\tpopup.setOffset({ offsetLeft: offsetLeft + Popup.getOption('angleLeftOffset') });\n\n\t\t\t\t\t\t\tthis.getAnalytic().activate().onShowFrom(\n\t\t\t\t\t\t\t\tpopup.bindElement.dataset.bxAnalyticContextLabel ?? Analytics.CONTEXT_IS_NOT_SET,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonClose: () => {\n\t\t\t\t\t\t\tthis.getAnalytic().deactivate();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tgetPopup(): Popup\n\t{\n\t\treturn this.#getPopupWithHeader().getPopup();\n\t}\n\n\tgetAnalytic(): Analytics\n\t{\n\t\treturn this.cache.remember('analyticObject', () => {\n\t\t\treturn new Analytics(Analytics.SERVICE_ALL);\n\t\t});\n\t}\n\n\t#getLastBoundElement(): ?HTMLElement\n\t{\n\t\treturn (this.cache.has('boundLastElement') ? this.cache.get('boundLastElement') : null);\n\t}\n\n\tgetAjaxPromise(): Promise\n\t{\n\t\treturn ajax.runAction('baas.Service.getAll');\n\t}\n\n\t#fetchData(): Array\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (this.cache.has('widgetData'))\n\t\t\t{\n\t\t\t\tresolve({ data: this.cache.get('widgetData') });\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.getAjaxPromise()\n\t\t\t\t\t.then((response: AjaxResponse<AjaxSuccess>) => {\n\t\t\t\t\t\tresponse.data = this.setData(response.data).convertIntoWidgetDataType();\n\t\t\t\t\t\tresolve(response);\n\t\t\t\t\t})\n\t\t\t\t\t.catch(reject)\n\t\t\t\t;\n\t\t\t}\n\t\t});\n\t}\n\n\tsetData(data: ResponseDataType): this\n\t{\n\t\tthis.cache.set('response-data', data);\n\n\t\treturn this;\n\t}\n\n\tconvertIntoWidgetDataType(): WidgetDataType\n\t{\n\t\tconst data: ResponseDataType = this.cache.get('response-data');\n\t\tDom.addClass(this.getPopup().contentContainer, '--baas-widget --baas-common');\n\n\t\tconst showMore = Type.isStringFilled(data.adsInfo && data.adsInfo.featurePromotionCode);\n\t\tconst result = {\n\t\t\theader: {\n\t\t\t\ticon: new WidgetIcon({\n\t\t\t\t\ticon: Actions.CHEVRON_LEFT,\n\t\t\t\t\tsize: 22,\n\t\t\t\t\tcolor: '#fff',\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\tthis.emit('onClickBack');\n\t\t\t\t\t\t\tthis.hide();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t}).render(),\n\t\t\t\ttop: {\n\t\t\t\t\ttitle: Loc.getMessage('BAAS_WIDGET_TITLE'),\n\t\t\t\t\tsubtitle: '',\n\t\t\t\t},\n\t\t\t\tinfo: data.adsInfo && data.adsInfo.title ? {\n\t\t\t\t\ttitle: data.adsInfo.title,\n\t\t\t\t\tsubtitle: data.adsInfo.subtitle,\n\t\t\t\t\tsubtitleDescription: data.adsInfo.subtitleDescription,\n\t\t\t\t\troundContent: {\n\t\t\t\t\t\tposterUrl: data.adsInfo.iconUrl,\n\t\t\t\t\t\tvideos: [{\n\t\t\t\t\t\t\turl: data.adsInfo.videoUrl,\n\t\t\t\t\t\t\ttype: data.adsInfo.videoFileType,\n\t\t\t\t\t\t}],\n\t\t\t\t\t},\n\t\t\t\t\tmoreLabel: showMore ? Loc.getMessage('BAAS_WIDGET_MORE_LINK_TITLE') : '',\n\t\t\t\t\tcode: showMore ? data.adsInfo.featurePromotionCode : null,\n\t\t\t\t} : {\n\t\t\t\t\ttitle: Loc.getMessage('BAAS_WIDGET_DESCRIPTION'),\n\t\t\t\t\troundContent: new Icon({ icon: Set.QR_CODE_1 }).render(),\n\t\t\t\t\tmoreLabel: '',\n\t\t\t\t\tcode: null,\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\n\t\tif (Type.isArray(data.packages) && data.packages.length > 0)\n\t\t{\n\t\t\tresult.items = data.packages;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult.header.button = new Button({\n\t\t\t\ttext: Loc.getMessage('BAAS_WIDGET_RELOAD_PACKAGES'),\n\t\t\t\tcolor: ButtonColor.LIGHT_BORDER,\n\t\t\t\tsize: ButtonSize.SMALL,\n\t\t\t\tonclick: () => {\n\t\t\t\t\tthis.reload();\n\t\t\t\t},\n\t\t\t\tround: true,\n\t\t\t\tnoCaps: true,\n\t\t\t});\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tbind(node: HTMLElement, bxAnalyticContextLabel: ?string): this\n\t{\n\t\tthis.cache.set('boundLastElement', node);\n\n\t\tif (!this.cache.get('boundElements').has(node))\n\t\t{\n\t\t\tthis.cache.get('boundElements').set(node);\n\t\t\tEvent.bind(node, 'click', () => {\n\t\t\t\tthis.show(node);\n\t\t\t});\n\t\t}\n\n\t\tthis.bindAnalyticContext(node, bxAnalyticContextLabel || Analytics.CONTEXT_IS_NOT_SET);\n\n\t\treturn this;\n\t}\n\n\tbindAnalyticContext(node: HTMLElement, bxAnalyticContextLabel: string): this\n\t{\n\t\tnode.dataset.bxAnalyticContextLabel = bxAnalyticContextLabel;\n\n\t\treturn this;\n\t}\n\n\tshow(node: ?HTMLElement): this\n\t{\n\t\tconst popup = this.getPopup();\n\t\tif (!node)\n\t\t{\n\t\t\tnode = this.cache.get('boundLastElement');\n\t\t}\n\n\t\tif (node && node !== popup.bindElement)\n\t\t{\n\t\t\tpopup.setBindElement(node);\n\t\t}\n\t\tpopup.show();\n\n\t\treturn this;\n\t}\n\n\ttoggle(node: ?HTMLElement): this\n\t{\n\t\tconst popup = this.getPopup();\n\t\tif (popup.isShown())\n\t\t{\n\t\t\tthis.hide();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.show(node);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\thide(): this\n\t{\n\t\tconst popup = this.getPopup();\n\t\tpopup.close();\n\n\t\treturn this;\n\t}\n\n\t#onPurchaseShown(event: BaseEvent): void\n\t{\n\t\tconst packageItem: PackageItem = event.getData().package;\n\t\tif (this.cache.has('baas-popup') && this.getPopup()?.getContentContainer().contains(packageItem.getContainer()))\n\t\t{\n\t\t\tthis.getPopup().setAutoHide(false);\n\t\t\tthis.getPopup().setClosingByEsc(false);\n\t\t}\n\t}\n\n\t#onPackageHidden(event: BaseEvent)\n\t{\n\t\tconst packageItem: PackageItem = event.getData().package;\n\t\tif (this.cache.has('baas-popup') && this.getPopup().getContentContainer().contains(packageItem.getContainer()))\n\t\t{\n\t\t\tthis.getPopup().setAutoHide(true);\n\t\t\tthis.getPopup().setClosingByEsc(true);\n\t\t}\n\t}\n\n\treload()\n\t{\n\t\tconst popup = this.getPopup();\n\t\tpopup.close();\n\t\tthis.cache.delete('widgetData');\n\t\tthis.cache.delete('baas-popup');\n\t\tthis.show(popup.bindElement);\n\t}\n\n\tstatic #instance = null;\n\n\tstatic getInstance(): Widget\n\t{\n\t\tif (this.#instance === null)\n\t\t{\n\t\t\tthis.#instance = new this();\n\t\t}\n\n\t\treturn this.#instance;\n\t}\n}\n","import { Loc, ajax, Tag, Text, Dom, Extension } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { ResponseDataType } from './types/response-data-type';\nimport { ResponseServiceDataType } from './types/response-service-data-type';\nimport type { WidgetDataType } from './types/widget-data-type';\nimport { Icon, Set } from 'ui.icon-set.api.core';\nimport { Widget } from './widget';\nimport { Analytics } from './analytics';\n\nexport class ServiceWidget extends Widget\n{\n\t#serviceCode: string;\n\t#serviceData: ResponseServiceDataType;\n\n\tconstructor(widgetData: ?WidgetDataType)\n\t{\n\t\tsuper(widgetData);\n\n\t\tif (BX.PULL && Extension.getSettings('baas.store').pull)\n\t\t{\n\t\t\tBX.PULL.extendWatch(Extension.getSettings('baas.store').pull.channelName);\n\n\t\t\tEventEmitter.subscribe('onPullEvent-baas', (event: BaseEvent) => {\n\t\t\t\tconst [command: string, params: ResponseDataType] = event.getData();\n\n\t\t\t\tif (command === 'updateService' && params.service.code === this.#serviceCode)\n\t\t\t\t{\n\t\t\t\t\tthis.#adjustFromPull(params.service);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tsetServiceCode(code: string): this\n\t{\n\t\tthis.#serviceCode = code;\n\n\t\treturn this;\n\t}\n\n\tsetData(data: ResponseDataType): this\n\t{\n\t\tsuper.setData(data);\n\t\tthis.#serviceData = data.service;\n\t\tthis.#serviceData.icon.className = Set[this.#serviceData.icon.className] ? this.#serviceData.icon.className : 'QR_CODE_1';\n\n\t\treturn this;\n\t}\n\n\tgetAjaxPromise(): Promise\n\t{\n\t\treturn ajax.runAction('baas.Service.get', { data: { code: this.#serviceCode } });\n\t}\n\n\tgetAnalytic(): Analytics\n\t{\n\t\treturn this.cache.remember('analyticObject', () => {\n\t\t\treturn Analytics.createByServiceCode(this.#serviceCode);\n\t\t});\n\t}\n\n\t#getIconContainer(): ?HTMLElement\n\t{\n\t\treturn this.cache.remember('baas-popup-icon', () => {\n\t\t\tconst iconParams: { className: ?string, color: ?string, style: ?Object } = this.#serviceData.icon;\n\t\t\t// const iconClass = this.#serviceData.isActive ? iconParams.className : 'LOCK';\n\t\t\tconst iconClass = iconParams.className;\n\t\t\tlet iconNode = Tag.render`<div class=\"ui-popupconstructor-content-item__icon ui-icon-set\"></div>`;\n\n\t\t\tif (Set[iconClass])\n\t\t\t{\n\t\t\t\tconst params = { icon: Set[iconClass] };\n\t\t\t\tif (iconParams.color)\n\t\t\t\t{\n\t\t\t\t\tparams.color = iconParams.color;\n\t\t\t\t}\n\t\t\t\ticonNode = (new Icon(params)).render();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.addClass(iconNode, iconClass);\n\t\t\t}\n\n\t\t\treturn iconNode;\n\t\t});\n\t}\n\n\t#getSubtitleContainer(): HTMLElement\n\t{\n\t\treturn this.cache.remember('baas-popup-subtitle', () => {\n\t\t\treturn Tag.render`<span>${Text.encode(this.#serviceData.isActive ? this.#serviceData.activeSubtitle : this.#serviceData.inactiveSubtitle)}</span>`;\n\t\t});\n\t}\n\n\tconvertIntoWidgetDataType(): WidgetDataType\n\t{\n\t\tconst data: ResponseDataType = this.cache.get('response-data');\n\t\tDom.addClass(this.getPopup().contentContainer, '--baas-widget --baas-specified');\n\n\t\treturn {\n\t\t\theader: {\n\t\t\t\ticon: this.#getIconContainer(),\n\t\t\t\ttop: {\n\t\t\t\t\ttitle: data.service.title,\n\t\t\t\t\tsubtitle: this.#getSubtitleContainer(),\n\t\t\t\t},\n\t\t\t\tinfo: data.adsInfo ? {\n\t\t\t\t\ttitle: data.adsInfo.title,\n\t\t\t\t\tsubtitle: data.adsInfo.subtitle,\n\t\t\t\t\tsubtitleDescription: data.adsInfo.subtitleDescription,\n\t\t\t\t\troundContent: {\n\t\t\t\t\t\tposterUrl: data.adsInfo.iconUrl,\n\t\t\t\t\t\tvideos: [{\n\t\t\t\t\t\t\turl: data.adsInfo.videoUrl,\n\t\t\t\t\t\t\ttype: data.adsInfo.videoFileType,\n\t\t\t\t\t\t}],\n\t\t\t\t\t},\n\t\t\t\t\tmoreLabel: Loc.getMessage('BAAS_WIDGET_MORE_LINK_TITLE'),\n\t\t\t\t\tcode: data.adsInfo.featurePromotionCode || data.service.featurePromotionCode,\n\t\t\t\t} : {\n\t\t\t\t\ttitle: data.service.description,\n\t\t\t\t\troundContent: new Icon({\n\t\t\t\t\t\ticon: (Set[data.service.icon.className] ?? Set.QR_CODE_1),\n\t\t\t\t\t}).render(),\n\t\t\t\t\tmoreLabel: Loc.getMessage('BAAS_WIDGET_MORE_LINK_TITLE'),\n\t\t\t\t\tcode: data.service.featurePromotionCode,\n\t\t\t\t},\n\t\t\t},\n\t\t\titems: data.packages,\n\t\t};\n\t}\n\n\t#adjustFromPull(newServiceData: ResponseServiceDataType)\n\t{\n\t\tif (newServiceData.isActive !== this.#serviceData.isActive)\n\t\t{\n\t\t\t// const iconParams: { className: ?string, color: ?string, style: ?Object } = this.#serviceData.icon;\n\t\t\t// const iconClass = Set[iconParams.className] ? `--${Set[iconParams.className]}` : iconParams.className;\n\n\t\t\tif (newServiceData.isActive === true)\n\t\t\t{\n\t\t\t\t// Dom.removeClass(this.#getIconContainer(), `--${Set.LOCK}`);\n\t\t\t\t// Dom.addClass(this.#getIconContainer(), iconClass);\n\n\t\t\t\tthis.#getSubtitleContainer().innerHTML = Text.encode(this.#serviceData.activeSubtitle);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// Dom.addClass(this.#getIconContainer(), `--${Set.LOCK}`);\n\t\t\t\t// Dom.removeClass(this.#getIconContainer(), iconClass);\n\n\t\t\t\tthis.#getSubtitleContainer().innerHTML = Text.encode(this.#serviceData.inactiveSubtitle);\n\t\t\t}\n\t\t}\n\n\t\tthis.#serviceData.isActive = newServiceData.isActive;\n\t\tthis.#serviceData.value = newServiceData.value;\n\t}\n\n\tbindAnalyticContext(node: HTMLElement, bxAnalyticContextLabel: string): this\n\t{\n\t\tif (Analytics.CONTEXT_IS_NOT_SET === bxAnalyticContextLabel)\n\t\t{\n\t\t\tbxAnalyticContextLabel = Analytics.guessContextByServiceCode(this.#serviceCode);\n\t\t}\n\n\t\tsuper.bindAnalyticContext(node, bxAnalyticContextLabel);\n\n\t\treturn this;\n\t}\n\n\tstatic #instances = [];\n\n\tstatic getInstanceByCode(code: string): Widget\n\t{\n\t\tif (!this.#instances[code])\n\t\t{\n\t\t\tthis.#instances[code] = (new this()).setServiceCode(code);\n\t\t}\n\n\t\treturn this.#instances[code];\n\t}\n}\n"],"names":["PurchaseTileDefault","EventEmitter","constructor","purchasedPackages","FORMAT_DATE","setEventNamespace","prepareGroupedPurchases","groupedPackageInfo","startDate","Date","expirationDate","actual","services","forEach","pack","DateTimeFormat","parse","Type","isArray","Object","values","service","serviceCode","code","current","maximal","parseInt","getGroupedPurchases","getPurchaseCodes","map","purchaseCode","join","getContainer","format","getFormat","count","length","multiple","serviceGrouped","active","keys","modifiedClass","Tag","render","Loc","getMessage","createProgressBar","getLeftUnitsLabel","getData","ProgressBar","value","Math","round","size","PurchaseTileAnnual","packageInfo","next","theDate","getFutureUnitsLabel","rawActivePacks","rawInactivePacks","expirationDateObj","rawPack","expDateActive","getTime","push","expDate","result","activePackKeys","expirationDateObject","key","packs","startDateObject","inactivePackKeys","sort","a","b","firstDate","futurePacks","Purchases","packageItem","data","Text","encode","getIcon","title","renderPurchases","bind","groupedPackages","groupPackages","purchaseInfo","purchases","group","createPurchasedPackageTileContainer","groupedByPurchase","fabric","getAnnualTileFabric","getDefaultTileFabric","container","dataset","bxRole","bxPurchasecodes","setDefaultTileFabric","classFabric","setAnnualTileFabric","singlePackages","purchase","onePackageInAPurchase","purchasedPackage","id","finalPackages","sortedKeys","earliestDate","annual","packages","openNewPurchase","PurchaseTileDiskOoEdit","PurchaseTileAiCopilotToken","PurchaseTileAiCopilotAnnualToken","PurchaseTileDocumentgeneratorFastTransform","PurchasesFactory","create","params","thisServiceCode","PackageItem","Cache","MemoryCache","BX","PULL","Extension","getSettings","pull","extendWatch","channelName","subscribe","event","command","packagePullData","remember","description","featurePromotionCode","icon","purchaseUrl","isBitrix24","get","findPackageCode","package","test","match","replace","License","openPurchasePage","UI","Notification","Center","notify","content","category","autoHideDelay","indexOf","window","open","SidePanel","Instance","width","cacheable","emit","packageCode","showPurchases","GLOBAL_TARGET","getFullEventName","BaseEvent","bindElement","closest","padding","popupWidth","offsetWidth","popupHeight","offsetHeight","popup","PopupManager","autoHide","closeIcon","lightShadow","draggable","closeByEsc","className","offsetTop","offsetLeft","bindOptions","position","height","events","onClose","show","iconParams","style","iconNode","isStringFilled","Set","color","Icon","Dom","addClass","node","onclick","e","stopPropagation","FeaturePromotersRegistry","getPromoter","Event","isPlainObject","price","button","isActive","Button","text","Size","EXTRA_SMALL","Color","SUCCESS","noCaps","state","State","DISABLED","isBaasActive","purchaseCount","activityLabel","Label","LabelSize","SM","fill","customClass","limitLabel","purchaseBalance","newPackageData","has","oldNode","delete","newNode","PackageItemFactory","PackageTemplateManager","BaseTemplate","options","items","setOptions","getContent","factory","serviceData","index","item","html","background","styles","margin","WidgetIcon","iconElement","eventName","Analytics","CONTEXT_IS_NOT_SET","onClickToBuyPackage","onPurchaseShown","activate","deactivate","unsubscribe","onShowFrom","context","EVENT_SHOW_POPUP","onPlayerEvents","additionalVideoParameter","p2","EVENT_CLICK_TO_BUY","replaceAll","EVENT_CLICK_TO_VIEW_PURCHASE","createByServiceCode","serviceCodeId","SERVICE_AI_COPILOT_TOKEN","SERVICE_DISK_OO_EDIT","SERVICE_DOCUMENTGENERATOR_FAST_TRANSFORM","SERVICE_ALL","guessContextByServiceCode","serviceContext","CONTEXT_STREAM","CONTEXT_TASKS","CONTEXT_CRM","CONTEXT_LICENSE_WIDGET","additional","sendData","assign","tool","type","c_section","p1","CONTEXT_IM_CHAT","Widget","widgetData","cache","set","WeakMap","getPopup","getAnalytic","getAjaxPromise","ajax","runAction","setData","convertIntoWidgetDataType","contentContainer","showMore","adsInfo","header","Actions","CHEVRON_LEFT","click","hide","top","subtitle","info","subtitleDescription","roundContent","posterUrl","iconUrl","videos","url","videoUrl","videoFileType","moreLabel","QR_CODE_1","ButtonColor","LIGHT_BORDER","ButtonSize","SMALL","reload","bxAnalyticContextLabel","bindAnalyticContext","setBindElement","toggle","isShown","close","getInstance","PopupWithHeader","target","justCounter","asyncData","template","analyticsCallback","additionalParameter","popupOptions","onShow","getTarget","targetPos","getPosition","getPopupContainer","angleShift","Popup","getOption","setAngle","offset","setOffset","Promise","resolve","reject","then","response","catch","getContentContainer","contains","setAutoHide","setClosingByEsc","ServiceWidget","setServiceCode","getInstanceByCode","iconClass","activeSubtitle","inactiveSubtitle","newServiceData","innerHTML"],"mappings":"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"}