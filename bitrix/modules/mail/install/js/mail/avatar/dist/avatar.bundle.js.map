{"version":3,"file":"avatar.bundle.js","sources":["../src/avatar.js"],"sourcesContent":["import { Tag } from 'main.core';\nimport './css/style.css';\n\nexport class Avatar\n{\n\tstatic stringToHashCode(string)\n\t{\n\t\tlet hashCode = 0;\n\n\t\tfor (let i = 0; i < string.length; i++)\n\t\t{\n\t\t\thashCode = string.charCodeAt(i) + ((hashCode << 5) - hashCode);\n\t\t}\n\n\t\treturn hashCode;\n\t}\n\n\tstatic alignChannelRangeColor(chanelCode)\n\t{\n\t\tif(chanelCode > 255)\n\t\t{\n\t\t\treturn 255;\n\t\t}\n\t\telse if(chanelCode < 0)\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn Math.ceil(chanelCode);\n\t\t}\n\t}\n\n\tstatic hashToColor(hash)\n\t{\n\t\tconst maxIntensityAllChannels = 255*3;\n\t\tconst minIntensityAllChannels = 0;\n\t\tconst differenceCoefficientForGrayDetection = 0.20;\n\n\t\tlet r = (hash & 0xFF0000) >> 16;\n\t\tlet g = (hash & 0x00FF00) >> 8;\n\t\tlet b = (hash & 0x0000FF);\n\n\t\tconst contrastRatioForPastelColors = 1.5;\n\t\tconst contrastRatioForDarkColors = 2.5;\n\t\tconst channelReductionCoefficientIfGray = 2;\n\n\t\tif(maxIntensityAllChannels - (r+g+b) < 100)\n\t\t{\t//Pastel colors or white\n\t\t\tr/=contrastRatioForPastelColors;\n\t\t\tg/=contrastRatioForPastelColors;\n\t\t\tb/=contrastRatioForPastelColors;\n\t\t}\n\t\telse if((r+g+b) < (200 - minIntensityAllChannels))\n\t\t{\n\t\t\t//Very dark colors\n\t\t\tr*=contrastRatioForDarkColors;\n\t\t\tg*=contrastRatioForDarkColors;\n\t\t\tb*=contrastRatioForDarkColors;\n\t\t}\n\n\t\tlet channels = [r,g,b];\n\t\tchannels.sort(function(a,b){\n\t\t\treturn a - b;\n\t\t})\n\n\t\tif(((channels[channels.length - 1]-channels[0])/channels[0]) < differenceCoefficientForGrayDetection)\n\t\t{\n\t\t\t//Shade of gray\n\t\t\tg/=channelReductionCoefficientIfGray;\n\t\t}\n\n\t\tr=this.alignChannelRangeColor(r);\n\t\tg=this.alignChannelRangeColor(g);\n\t\tb=this.alignChannelRangeColor(b);\n\n\t\tconst color = \"#\" + (\"0\" + r.toString(16)).substr(-2) + (\"0\" + g.toString(16)).substr(-2) + (\"0\" + b.toString(16)).substr(-2);\n\t\treturn color.toUpperCase();\n\t}\n\n\tstatic stringToColor(name)\n\t{\n\t\treturn this.hashToColor(this.stringToHashCode(name));\n\t}\n\n\tstatic getInitials(string, email)\n\t{\n\t\tstring=string.replace(/[0-9]|[-\\u0026\\u002f\\u005c\\u0023\\u002c\\u002b\\u0028\\u0029\\u0024\\u007e\\u0025\\u002e\\u0027\\u0022\\u003a\\u002a\\u003f\\u003c\\u003e\\u007b\\u007d\\u00ab\\u00bb]/g,\"\");\n\t\tstring=string.replace(/^\\s+|\\s+$/g, '');\n\n\t\tconst names = string.split(' ');\n\n\t\tlet initials = names[0].substring(0, 1).toUpperCase();\n\n\t\tif (names.length > 1)\n\t\t{\n\t\t\tinitials += names[names.length - 1].substring(0, 1).toUpperCase();\n\t\t}\n\n\t\tif(initials === '')\n\t\t{\n\t\t\tinitials = email[0].toUpperCase();\n\t\t}\n\n\t\treturn initials;\n\t}\n\n\tstatic getAvatarData(config = {\n\t\tfullName: 'User Quest',\n\t\temail: 'info@example.com',\n\t})\n\t{\n\t\treturn {\n\t\t\t'abbreviation': this.getInitials(config['fullName'], config['email']),\n\t\t\t'color': this.stringToColor(config['email']),\n\t\t};\n\t}\n\n\tstatic build(config = {\n\t\tsize: 'small',\n\t\tfullName: 'User Quest',\n\t\temail: 'info@example.com',\n\t})\n\t{\n\t\tconst whiteList = new Set(['small', 'big']);\n\n\t\tif (config['size'] === undefined || !whiteList.has(config['size']))\n\t\t{\n\t\t\tconfig['size'] = 'small';\n\t\t}\n\n\t\tconst data = this.getAvatarData(config);\n\n\t\tlet avatar = Tag.render`<span class=\"mail-ui-avatar mail-ui-avatar-${config['size']}\">${data['abbreviation']}</span>`;\n\t\tavatar.style.backgroundColor = data['color'];\n\n\t\treturn avatar;\n\t}\n\n\tstatic replaceElementWithAvatar(object, avatar)\n\t{\n\t\tconst parent = object.parentNode;\n\t\tparent.insertBefore(avatar, object);\n\t\tparent.removeChild(object);\n\t}\n\n\tstatic replaceTagsWithAvatars(config = { className: 'mail-ui-avatar' })\n\t{\n\t\tconst elements = document.getElementsByClassName(config['className']);\n\t\tfor (let element of elements)\n\t\t{\n\t\t\tthis.replaceElementWithAvatar(element, this.build({\n\t\t\t\tfullName: element.getAttribute('user-name'),\n\t\t\t\temail: element.getAttribute('email'),\n\t\t\t}));\n\t\t}\n\t}\n}"],"names":["Avatar","string","hashCode","i","length","charCodeAt","chanelCode","Math","ceil","hash","maxIntensityAllChannels","minIntensityAllChannels","differenceCoefficientForGrayDetection","r","g","b","contrastRatioForPastelColors","contrastRatioForDarkColors","channelReductionCoefficientIfGray","channels","sort","a","alignChannelRangeColor","color","toString","substr","toUpperCase","name","hashToColor","stringToHashCode","email","replace","names","split","initials","substring","config","fullName","getInitials","stringToColor","size","whiteList","Set","undefined","has","data","getAvatarData","avatar","Tag","render","style","backgroundColor","object","parent","parentNode","insertBefore","removeChild","className","elements","document","getElementsByClassName","element","replaceElementWithAvatar","build","getAttribute"],"mappings":";;;;;;;;;AAAA,KAGaA,MAAM;GAAA;KAAA;;GAAA;KAAA;KAAA,iCAEMC,MAAM,EAC9B;OACC,IAAIC,QAAQ,GAAG,CAAC;OAEhB,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,MAAM,CAACG,MAAM,EAAED,CAAC,EAAE,EACtC;SACCD,QAAQ,GAAGD,MAAM,CAACI,UAAU,CAACF,CAAC,CAAC,IAAI,CAACD,QAAQ,IAAI,CAAC,IAAIA,QAAQ,CAAC;;OAG/D,OAAOA,QAAQ;;;KACf;KAAA,uCAE6BI,UAAU,EACxC;OACC,IAAGA,UAAU,GAAG,GAAG,EACnB;SACC,OAAO,GAAG;QACV,MACI,IAAGA,UAAU,GAAG,CAAC,EACtB;SACC,OAAO,CAAC;QACR,MAED;SACC,OAAOC,IAAI,CAACC,IAAI,CAACF,UAAU,CAAC;;;;KAE7B;KAAA,4BAEkBG,IAAI,EACvB;OACC,IAAMC,uBAAuB,GAAG,GAAG,GAAC,CAAC;OACrC,IAAMC,uBAAuB,GAAG,CAAC;OACjC,IAAMC,qCAAqC,GAAG,IAAI;OAElD,IAAIC,CAAC,GAAG,CAACJ,IAAI,GAAG,QAAQ,KAAK,EAAE;OAC/B,IAAIK,CAAC,GAAG,CAACL,IAAI,GAAG,QAAQ,KAAK,CAAC;OAC9B,IAAIM,CAAC,GAAIN,IAAI,GAAG,QAAS;OAEzB,IAAMO,4BAA4B,GAAG,GAAG;OACxC,IAAMC,0BAA0B,GAAG,GAAG;OACtC,IAAMC,iCAAiC,GAAG,CAAC;OAE3C,IAAGR,uBAAuB,IAAIG,CAAC,GAACC,CAAC,GAACC,CAAC,CAAC,GAAG,GAAG,EAC1C;;SACCF,CAAC,IAAEG,4BAA4B;SAC/BF,CAAC,IAAEE,4BAA4B;SAC/BD,CAAC,IAAEC,4BAA4B;QAC/B,MACI,IAAIH,CAAC,GAACC,CAAC,GAACC,CAAC,GAAK,GAAG,GAAGJ,uBAAwB,EACjD;;SAECE,CAAC,IAAEI,0BAA0B;SAC7BH,CAAC,IAAEG,0BAA0B;SAC7BF,CAAC,IAAEE,0BAA0B;;OAG9B,IAAIE,QAAQ,GAAG,CAACN,CAAC,EAACC,CAAC,EAACC,CAAC,CAAC;OACtBI,QAAQ,CAACC,IAAI,CAAC,UAASC,CAAC,EAACN,CAAC,EAAC;SAC1B,OAAOM,CAAC,GAAGN,CAAC;QACZ,CAAC;OAEF,IAAI,CAACI,QAAQ,CAACA,QAAQ,CAACf,MAAM,GAAG,CAAC,CAAC,GAACe,QAAQ,CAAC,CAAC,CAAC,IAAEA,QAAQ,CAAC,CAAC,CAAC,GAAIP,qCAAqC,EACpG;;SAECE,CAAC,IAAEI,iCAAiC;;OAGrCL,CAAC,GAAC,IAAI,CAACS,sBAAsB,CAACT,CAAC,CAAC;OAChCC,CAAC,GAAC,IAAI,CAACQ,sBAAsB,CAACR,CAAC,CAAC;OAChCC,CAAC,GAAC,IAAI,CAACO,sBAAsB,CAACP,CAAC,CAAC;OAEhC,IAAMQ,KAAK,GAAG,GAAG,GAAG,CAAC,GAAG,GAAGV,CAAC,CAACW,QAAQ,CAAC,EAAE,CAAC,EAAEC,MAAM,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,GAAGX,CAAC,CAACU,QAAQ,CAAC,EAAE,CAAC,EAAEC,MAAM,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,GAAGV,CAAC,CAACS,QAAQ,CAAC,EAAE,CAAC,EAAEC,MAAM,CAAC,CAAC,CAAC,CAAC;OAC7H,OAAOF,KAAK,CAACG,WAAW,EAAE;;;KAC1B;KAAA,8BAEoBC,IAAI,EACzB;OACC,OAAO,IAAI,CAACC,WAAW,CAAC,IAAI,CAACC,gBAAgB,CAACF,IAAI,CAAC,CAAC;;;KACpD;KAAA,4BAEkB1B,MAAM,EAAE6B,KAAK,EAChC;OACC7B,MAAM,GAACA,MAAM,CAAC8B,OAAO,CAAC,sJAAsJ,EAAC,EAAE,CAAC;OAChL9B,MAAM,GAACA,MAAM,CAAC8B,OAAO,CAAC,YAAY,EAAE,EAAE,CAAC;OAEvC,IAAMC,KAAK,GAAG/B,MAAM,CAACgC,KAAK,CAAC,GAAG,CAAC;OAE/B,IAAIC,QAAQ,GAAGF,KAAK,CAAC,CAAC,CAAC,CAACG,SAAS,CAAC,CAAC,EAAE,CAAC,CAAC,CAACT,WAAW,EAAE;OAErD,IAAIM,KAAK,CAAC5B,MAAM,GAAG,CAAC,EACpB;SACC8B,QAAQ,IAAIF,KAAK,CAACA,KAAK,CAAC5B,MAAM,GAAG,CAAC,CAAC,CAAC+B,SAAS,CAAC,CAAC,EAAE,CAAC,CAAC,CAACT,WAAW,EAAE;;OAGlE,IAAGQ,QAAQ,KAAK,EAAE,EAClB;SACCA,QAAQ,GAAGJ,KAAK,CAAC,CAAC,CAAC,CAACJ,WAAW,EAAE;;OAGlC,OAAOQ,QAAQ;;;KACf;KAAA,gCAMD;OAAA,IAJqBE,MAAM,uEAAG;SAC7BC,QAAQ,EAAE,YAAY;SACtBP,KAAK,EAAE;QACP;OAEA,OAAO;SACN,cAAc,EAAE,IAAI,CAACQ,WAAW,CAACF,MAAM,CAAC,UAAU,CAAC,EAAEA,MAAM,CAAC,OAAO,CAAC,CAAC;SACrE,OAAO,EAAE,IAAI,CAACG,aAAa,CAACH,MAAM,CAAC,OAAO,CAAC;QAC3C;;;KACD;KAAA,wBAOD;OAAA,IALaA,MAAM,uEAAG;SACrBI,IAAI,EAAE,OAAO;SACbH,QAAQ,EAAE,YAAY;SACtBP,KAAK,EAAE;QACP;OAEA,IAAMW,SAAS,GAAG,IAAIC,GAAG,CAAC,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;OAE3C,IAAIN,MAAM,CAAC,MAAM,CAAC,KAAKO,SAAS,IAAI,CAACF,SAAS,CAACG,GAAG,CAACR,MAAM,CAAC,MAAM,CAAC,CAAC,EAClE;SACCA,MAAM,CAAC,MAAM,CAAC,GAAG,OAAO;;OAGzB,IAAMS,IAAI,GAAG,IAAI,CAACC,aAAa,CAACV,MAAM,CAAC;OAEvC,IAAIW,MAAM,GAAGC,aAAG,CAACC,MAAM,gJAA8Cb,MAAM,CAAC,MAAM,CAAC,EAAKS,IAAI,CAAC,cAAc,CAAC,CAAS;OACrHE,MAAM,CAACG,KAAK,CAACC,eAAe,GAAGN,IAAI,CAAC,OAAO,CAAC;OAE5C,OAAOE,MAAM;;;KACb;KAAA,yCAE+BK,MAAM,EAAEL,MAAM,EAC9C;OACC,IAAMM,MAAM,GAAGD,MAAM,CAACE,UAAU;OAChCD,MAAM,CAACE,YAAY,CAACR,MAAM,EAAEK,MAAM,CAAC;OACnCC,MAAM,CAACG,WAAW,CAACJ,MAAM,CAAC;;;KAC1B;KAAA,yCAGD;OAAA,IAD8BhB,MAAM,uEAAG;SAAEqB,SAAS,EAAE;QAAkB;OAErE,IAAMC,QAAQ,GAAGC,QAAQ,CAACC,sBAAsB,CAACxB,MAAM,CAAC,WAAW,CAAC,CAAC;OAAC,2CAClDsB,QAAQ;SAAA;OAAA;SAA5B,oDACA;WAAA,IADSG,OAAO;WAEf,IAAI,CAACC,wBAAwB,CAACD,OAAO,EAAE,IAAI,CAACE,KAAK,CAAC;aACjD1B,QAAQ,EAAEwB,OAAO,CAACG,YAAY,CAAC,WAAW,CAAC;aAC3ClC,KAAK,EAAE+B,OAAO,CAACG,YAAY,CAAC,OAAO;YACnC,CAAC,CAAC;;;SACH;;SAAA;;;;GACD;CAAA;;;;;;;;"}