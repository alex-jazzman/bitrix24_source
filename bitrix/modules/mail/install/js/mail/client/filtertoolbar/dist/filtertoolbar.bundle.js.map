{"version":3,"file":"filtertoolbar.bundle.js","sources":["../src/filtertoolbar.js"],"sourcesContent":["import { Tag } from 'main.core';\nimport './css/style.css';\nimport { Loc } from 'main.core';\nimport { BaseEvent, EventEmitter } from \"main.core.events\";\nimport 'ui.fonts.opensans';\n\nexport class FilterToolbar\n{\n\t#wrapper;\n\t#filter;\n\t#statusBtn = false;\n\t#counterBtn;\n\t#filterApi;\n\t#readAllBtn;\n\t#counter;\n\t#filterTitle;\n\n\tconstructor(config = {\n\t\twrapper: [],\n\t\tfilter: [],\n\t})\n\t{\n\t\tEventEmitter.subscribe('BX.Main.Filter:apply', (event) => {\n\n\t\t\tlet isSeen = this.#filter.getFilterFieldsValues()['IS_SEEN'];\n\n\t\t\tif(isSeen === 'N')\n\t\t\t{\n\t\t\t\tthis.activateBtn();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.deactivateBtn();\n\t\t\t}\n\t\t});\n\n\t\tthis.#wrapper = config['wrapper'];\n\t\tthis.#filter = config['filter'];\n\t\tthis.#filterApi = this.#filter.getApi();\n\t}\n\n\tsetCount(num)\n\t{\n\t\tnum = Number(num);\n\t\tnum = isNaN(num) ? 0 : num;\n\n\t\tif(num !== undefined)\n\t\t{\n\t\t\tthis.#counter.textContent = num;\n\n\t\t\tif(num !== 0)\n\t\t\t{\n\t\t\t\tthis.#counter.classList.remove('mail-counter-zero');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#counter.classList.add('mail-counter-zero');\n\t\t\t}\n\n\t\t}\n\t}\n\n\tactivateBtn()\n\t{\n\t\tthis.#statusBtn = true;\n\t\tthis.#counterBtn.classList.add('mail-msg-counter-number-selected');\n\t}\n\n\tdeactivateBtn()\n\t{\n\t\tthis.#statusBtn = false;\n\t\tthis.#counterBtn.classList.remove('mail-msg-counter-number-selected');\n\t}\n\n\tonClickFilterButton()\n\t{\n\t\tif(!this.#statusBtn)\n\t\t{\n\t\t\tthis.activateBtn();\n\t\t\tthis.setUnreadFilter();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.deactivateBtn();\n\t\t\tthis.removeUnreadFilter();\n\t\t}\n\t}\n\n\tremoveUnreadFilter()\n\t{\n\t\tif (!!this.#filter && (this.#filter instanceof BX.Main.Filter))\n\t\t{\n\t\t\tthis.#filterApi.setFields({\n\t\t\t\t'DIR': this.#filter.getFilterFieldsValues()['DIR'],\n\t\t\t});\n\t\t\tthis.#filterApi.apply();\n\t\t}\n\t}\n\n\thideReadAllBtn()\n\t{\n\t\tthis.#readAllBtn.classList.add('mail-toolbar-hide-element');\n\t}\n\n\tshowReadAllBtn()\n\t{\n\t\tthis.#readAllBtn.classList.remove('mail-toolbar-hide-element');\n\t}\n\n\thideCounter()\n\t{\n\t\tthis.#counterBtn.classList.add('mail-toolbar-hide-element');\n\t\tthis.#filterTitle.classList.add('mail-toolbar-hide-element');\n\t}\n\n\tshowCounter()\n\t{\n\t\tthis.#counterBtn.classList.remove('mail-toolbar-hide-element');\n\t\tthis.#filterTitle.classList.remove('mail-toolbar-hide-element');\n\t}\n\n\tsetUnreadFilter()\n\t{\n\t\tif (!!this.#filter && (this.#filter instanceof BX.Main.Filter))\n\t\t{\n\t\t\tthis.#filterApi.setFields({\n\t\t\t\t'DIR': this.#filter.getFilterFieldsValues()['DIR'],\n\t\t\t\t'IS_SEEN': 'N'\n\t\t\t});\n\t\t\tthis.#filterApi.apply();\n\t\t}\n\t}\n\n\tbuild(config ={\n\t\tfilterId: '',\n\t})\n\t{\n\t\tconst mailFilterToolbar = Tag.render`<div class=\"mail-filter-toolbar\">\n\t\t\t<div class=\"mail-filter-counter\" data-role=\"mail-filter-counter\">\n\t\t\t\t<div data-role=\"mail-filter-title\">\n\t\t\t\t\t${Loc.getMessage(\"MAIL_FILTER_TOOLBAR_TITLE\")}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>`;\n\n\t\tconst counterBtn = Tag.render`<span class=\"mail-toolbar-counter\">\n\t\t\t<span class=\"mail-msg-counter-number\" data-role=\"unread-counter-number\"></span>\n\t\t\t<span class=\"mail-msg-counter-text\">${Loc.getMessage(\"MAIL_FILTER_NOT_READ\")}</span>\n\t\t\t<span class=\"mail-msg-counter-remove\"></span>\n\t\t</span>`;\n\n\t\tconst readAllBtn = Tag.render`<span class=\"mail-toolbar-counter\">\n\t\t\t<span class=\"mail-msg-counter-text\">${Loc.getMessage(\"MAIL_FILTER_READ_ALL\")}</span>\n\t\t</span>`;\n\n\t\tthis.#counter = counterBtn.querySelector('[data-role=\"unread-counter-number\"]');\n\t\tthis.#filterTitle = mailFilterToolbar.querySelector('[data-role=\"mail-filter-title\"]');\n\n\t\tthis.#readAllBtn = readAllBtn;\n\t\tthis.#counterBtn = counterBtn;\n\n\t\tcounterBtn.onclick = ()=>\n\t\t{\n\t\t\tthis.onClickFilterButton()\n\t\t}\n\n\t\treadAllBtn.onclick = ()=>\n\t\t{\n\t\t\tBX.Mail.Client.Message.List['mail-client-list-manager'].onReadClick('all');\n\t\t\tthis.removeUnreadFilter();\n\t\t}\n\n\t\tconst mailFilterCounter = mailFilterToolbar.querySelector('[data-role=\"mail-filter-counter\"]');\n\n\t\tmailFilterCounter.append(counterBtn);\n\t\tmailFilterCounter.append(readAllBtn);\n\t\tthis.#wrapper.append(mailFilterToolbar);\n\n\t\tEventEmitter.subscribe('BX.Mail.Home:updatingCounters', function(event) {\n\n\t\t\tif(event['data']['name'] === 'dirs')\n\t\t\t{\n\t\t\t\tconst counters = event['data']['counters'];\n\t\t\t\tconst hidden = event['data']['hidden'];\n\t\t\t\tconst currentDir = event['data']['selectedDirectory'];\n\t\t\t\tlet currentFolderCount = counters[currentDir];\n\n\t\t\t\tif(currentDir !== '')\n\t\t\t\t{\n\t\t\t\t\tthis.showReadAllBtn()\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tcurrentFolderCount = event['data']['total'];\n\t\t\t\t\tthis.hideReadAllBtn()\n\t\t\t\t}\n\n\t\t\t\tif(hidden[currentDir] && currentDir !== '')\n\t\t\t\t{\n\t\t\t\t\tthis.hideCounter();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.setCount(currentFolderCount);\n\t\t\t\t\tthis.showCounter();\n\t\t\t\t}\n\t\t\t}\n\t\t}.bind(this));\n\n\t}\n}"],"names":["FilterToolbar","config","wrapper","filter","EventEmitter","subscribe","event","isSeen","getFilterFieldsValues","activateBtn","deactivateBtn","getApi","num","Number","isNaN","undefined","textContent","classList","remove","add","setUnreadFilter","removeUnreadFilter","BX","Main","Filter","setFields","apply","mailFilterToolbar","Tag","render","Loc","getMessage","counterBtn","readAllBtn","querySelector","onclick","onClickFilterButton","Mail","Client","Message","List","onReadClick","mailFilterCounter","append","counters","hidden","currentDir","currentFolderCount","showReadAllBtn","hideReadAllBtn","hideCounter","setCount","showCounter","bind"],"mappings":"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"}