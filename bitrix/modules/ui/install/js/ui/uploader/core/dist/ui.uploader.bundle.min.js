this.BX=this.BX||{};this.BX.UI=this.BX.UI||{};(function(e,s,t){"use strict";const i={INIT:"init",ADDED:"added",LOADING:"loading",PENDING:"pending",PREPARING:"preparing",UPLOADING:"uploading",COMPLETE:"complete",LOAD_FAILED:"load-failed",UPLOAD_FAILED:"upload-failed"};const r={CLIENT:"client",SERVER:"server"};const l={ADD:"onAdd",BEFORE_UPLOAD:"onBeforeUpload",UPLOAD_START:"onUploadStart",UPLOAD_ERROR:"onUploadError",UPLOAD_PROGRESS:"onUploadProgress",UPLOAD_COMPLETE:"onUploadComplete",UPLOAD_CONTROLLER_INIT:"onUploadControllerInit",LOAD_START:"onLoadStart",LOAD_PROGRESS:"onLoadProgress",LOAD_COMPLETE:"onLoadComplete",LOAD_ERROR:"onLoadError",LOAD_CONTROLLER_INIT:"onLoadControllerInit",REMOVE_ERROR:"onRemoveError",REMOVE_COMPLETE:"onRemoveComplete",REMOVE_CONTROLLER_INIT:"onRemoveControllerInit",STATE_CHANGE:"onStateChange",STATUS_CHANGE:"onStatusChange",VALIDATE_FILE_ASYNC:"onValidateFileAsync",PREPARE_FILE_ASYNC:"onPrepareFileAsync"};const a=e=>{const s=t.Type.isStringFilled(e)?e.lastIndexOf("."):-1;return s>0?e.slice(Math.max(0,s+1)):""};let o=null;const n=(e,s=null)=>{if(o===null){o=Yi.getVideoExtensions()}const i=t.Type.isFile(e)?e.name:e;const r=t.Type.isFile(e)?e.type:s;const l=a(i).toLowerCase();return o.includes(l)&&(r===null||/^video\/[\d.a-z-]+$/i.test(r))};class c extends t.BaseError{constructor(e,...s){let i=t.Type.isString(s[0])?s[0]:null;let r=t.Type.isString(s[1])?s[1]:null;const l=t.Type.isPlainObject(s[s.length-1])?s[s.length-1]:{};const a={};Object.keys(l).forEach((e=>{a[`#${e}#`]=l[e]}));if(!t.Type.isString(i)&&t.Loc.hasMessage(`UPLOADER_${e}`)){i=t.Loc.getMessage(`UPLOADER_${e}`,a)}if(t.Type.isStringFilled(i)&&!t.Type.isString(r)&&t.Loc.hasMessage(`UPLOADER_${e}_DESC`)){r=t.Loc.getMessage(`UPLOADER_${e}_DESC`,a)}super(i,e,l);this.description="";this.origin=c.Origin.CLIENT;this.type=c.Type.USER;this.setDescription(r)}static createFromAjaxErrors(e){if(!t.Type.isArrayFilled(e)||!t.Type.isPlainObject(e[0])){return new this("SERVER_ERROR")}const s=e.find((e=>e.type==="file-uploader"));if(s&&!s.system){const{code:e,message:t,description:i,customData:r}=s;const l=new this(e,t,i,r);l.setOrigin(c.Origin.SERVER);l.setType(c.Type.USER);return l}let{code:i,message:r,description:l}=e[0];const{customData:a,system:o,type:n}=e[0];if(i==="NETWORK_ERROR"){r=t.Loc.getMessage("UPLOADER_NETWORK_ERROR")}else{i=t.Type.isStringFilled(i)?i:"SERVER_ERROR";if(!t.Type.isStringFilled(l)){l=r;r=t.Loc.getMessage("UPLOADER_SERVER_ERROR")}}console.error("Uploader",e);const d=new this(i,r,l,a);d.setOrigin(c.Origin.SERVER);if(n==="file-uploader"){d.setType(o?c.Type.SYSTEM:c.Type.USER)}else{d.setType(c.Type.UNKNOWN)}return d}static createFromError(e){return new this(e.name,e.message)}getDescription(){return this.description}setDescription(e){if(t.Type.isString(e)){this.description=e}return this}getOrigin(){return this.origin}setOrigin(e){if(Object.values(c.Origin).includes(e)){this.origin=e}return this}getType(){return this.type}setType(e){if(t.Type.isStringFilled(e)){this.type=e}return this}clone(){const e=JSON.parse(JSON.stringify(this));const s=new c(e.code,e.message,e.description,e.customData);s.setOrigin(e.origin);s.setType(e.type);return s}toString(){return`Uploader Error (${this.getCode()}): ${this.getMessage()} (${this.getOrigin()})`}toJSON(){return{code:this.getCode(),message:this.getMessage(),description:this.getDescription(),origin:this.getOrigin(),type:this.getType(),customData:this.getCustomData()}}}c.Origin={SERVER:"server",CLIENT:"client"};c.Type={USER:"user",SYSTEM:"system",UNKNOWN:"unknown"};var d=babelHelpers.classPrivateFieldLooseKey("server");var b=babelHelpers.classPrivateFieldLooseKey("options");class h extends s.EventEmitter{constructor(e,s={}){super();Object.defineProperty(this,d,{writable:true,value:void 0});Object.defineProperty(this,b,{writable:true,value:void 0});this.setEventNamespace("BX.UI.Uploader.UploadController");babelHelpers.classPrivateFieldLooseBase(this,d)[d]=e;babelHelpers.classPrivateFieldLooseBase(this,b)[b]=s}getServer(){return babelHelpers.classPrivateFieldLooseBase(this,d)[d]}getOptions(){return babelHelpers.classPrivateFieldLooseBase(this,b)[b]}getOption(e,s){if(!t.Type.isUndefined(babelHelpers.classPrivateFieldLooseBase(this,b)[b][e])){return babelHelpers.classPrivateFieldLooseBase(this,b)[b][e]}if(!t.Type.isUndefined(s)){return s}return null}upload(e){throw new Error("You must implement upload() method.")}abort(){throw new Error("You must implement abort() method.")}}var p=babelHelpers.classPrivateFieldLooseKey("server");var u=babelHelpers.classPrivateFieldLooseKey("options");class v extends s.EventEmitter{constructor(e,s={}){super();Object.defineProperty(this,p,{writable:true,value:void 0});Object.defineProperty(this,u,{writable:true,value:void 0});this.setEventNamespace("BX.UI.Uploader.LoadController");babelHelpers.classPrivateFieldLooseBase(this,p)[p]=e;babelHelpers.classPrivateFieldLooseBase(this,u)[u]=s}getServer(){return babelHelpers.classPrivateFieldLooseBase(this,p)[p]}getOptions(){return babelHelpers.classPrivateFieldLooseBase(this,u)[u]}getOption(e,s){if(!t.Type.isUndefined(babelHelpers.classPrivateFieldLooseBase(this,u)[u][e])){return babelHelpers.classPrivateFieldLooseBase(this,u)[u][e]}if(!t.Type.isUndefined(s)){return s}return null}load(e){throw new Error("You must implement load() method.")}abort(){throw new Error("You must implement abort() method.")}}var g=babelHelpers.classPrivateFieldLooseKey("server");var P=babelHelpers.classPrivateFieldLooseKey("options");class F extends s.EventEmitter{constructor(e,s={}){super();Object.defineProperty(this,g,{writable:true,value:void 0});Object.defineProperty(this,P,{writable:true,value:void 0});this.setEventNamespace("BX.UI.Uploader.RemoveController");babelHelpers.classPrivateFieldLooseBase(this,g)[g]=e;babelHelpers.classPrivateFieldLooseBase(this,P)[P]=s}getServer(){return babelHelpers.classPrivateFieldLooseBase(this,g)[g]}getOptions(){return babelHelpers.classPrivateFieldLooseBase(this,P)[P]}getOption(e,s){if(!t.Type.isUndefined(babelHelpers.classPrivateFieldLooseBase(this,P)[P][e])){return babelHelpers.classPrivateFieldLooseBase(this,P)[P][e]}if(!t.Type.isUndefined(s)){return s}return null}remove(e){throw new Error("You must implement remove() method.")}}let f=window.crypto||window.msCrypto;if(!f&&typeof process==="object"){f=require("crypto").webcrypto}const L=()=>`${1e7}-${1e3}-${4e3}-${8e3}-${1e11}`.replaceAll(/[018]/g,(e=>(e^f.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)));const m=e=>{if(!t.Type.isStringFilled(e)){return""}const s=e.split("/").pop();if(/javascript/.test(s)){return"js"}if(/plain/.test(s)){return"txt"}if(/svg/.test(s)){return"svg"}if(/[a-z]+/.test(s)){return s}return""};let y=0;const H=(e,s)=>{let i=s;if(!t.Type.isStringFilled(i)){const s=new Date;i=`File ${s.getFullYear()}-${s.getMonth()}-${s.getDate()}-${++y}`;const t=m(e.type);if(t){i+=`.${t}`}}try{return new File([e],i,{lastModified:Date.now(),lastModifiedDate:new Date,type:e.type})}catch{const s=e.slice(0,e.size,e.type);s.name=i;s.lastModified=Date.now();s.lastModifiedDate=new Date;return s}};const E=/^data:((?:\w+\/(?:(?!;).)+)?)((?:;[\W\w]*?[^;])*),(.+)$/;const B=e=>t.Type.isString(e)?e.match(E):false;const T=e=>{const s=atob(e.split(",")[1]);const t=e.split(",")[0].split(":")[1].split(";")[0];const i=new ArrayBuffer(s.length);const r=new Uint8Array(i);for(let e=0;e<s.length;e++){r[e]=s.codePointAt(e)}return new Blob([i],{type:t})};const w=new Set(["jpg","bmp","jpeg","jpe","gif","png","webp"]);const O=(e,s=null)=>{const i=t.Type.isFile(e)?e.name:e;const r=t.Type.isFile(e)?e.type:s;const l=a(i).toLowerCase();return w.has(l)&&(r===null||/^image\/[\d.a-z-]+$/i.test(r))};const S=(e,s=1024)=>{let i=0;const r=I();let l=e;while(l>=s&&r[i+1]){l/=s;i++}return(t.Type.isInteger(l)?l:l.toFixed(1))+r[i]};let A=null;const I=()=>{if(A!==null){return A}const e=t.Loc.getMessage("UPLOADER_FILE_SIZE_POSTFIXES").split(/\|/);A=t.Type.isArrayFilled(e)?e:["B","kB","MB","GB","TB"];return A};var R=babelHelpers.classPrivateFieldLooseKey("id");var C=babelHelpers.classPrivateFieldLooseKey("file");var D=babelHelpers.classPrivateFieldLooseKey("serverFileId");var U=babelHelpers.classPrivateFieldLooseKey("name");var M=babelHelpers.classPrivateFieldLooseKey("size");var _=babelHelpers.classPrivateFieldLooseKey("type");var N=babelHelpers.classPrivateFieldLooseKey("width");var z=babelHelpers.classPrivateFieldLooseKey("height");var j=babelHelpers.classPrivateFieldLooseKey("animated");var x=babelHelpers.classPrivateFieldLooseKey("treatImageAsFile");var K=babelHelpers.classPrivateFieldLooseKey("clientPreview");var k=babelHelpers.classPrivateFieldLooseKey("clientPreviewUrl");var G=babelHelpers.classPrivateFieldLooseKey("clientPreviewWidth");var W=babelHelpers.classPrivateFieldLooseKey("clientPreviewHeight");var V=babelHelpers.classPrivateFieldLooseKey("serverPreviewUrl");var $=babelHelpers.classPrivateFieldLooseKey("serverPreviewWidth");var X=babelHelpers.classPrivateFieldLooseKey("serverPreviewHeight");var J=babelHelpers.classPrivateFieldLooseKey("downloadUrl");var Y=babelHelpers.classPrivateFieldLooseKey("status");var q=babelHelpers.classPrivateFieldLooseKey("origin");var Q=babelHelpers.classPrivateFieldLooseKey("errors");var Z=babelHelpers.classPrivateFieldLooseKey("progress");var ee=babelHelpers.classPrivateFieldLooseKey("customData");var se=babelHelpers.classPrivateFieldLooseKey("viewerAttrs");var te=babelHelpers.classPrivateFieldLooseKey("uploadController");var ie=babelHelpers.classPrivateFieldLooseKey("loadController");var re=babelHelpers.classPrivateFieldLooseKey("removeController");var le=babelHelpers.classPrivateFieldLooseKey("forceServerLoad");var ae=babelHelpers.classPrivateFieldLooseKey("uploadCallbacks");var oe=babelHelpers.classPrivateFieldLooseKey("setStatus");class ne extends s.EventEmitter{constructor(e,s={}){super();Object.defineProperty(this,oe,{value:ce});Object.defineProperty(this,R,{writable:true,value:null});Object.defineProperty(this,C,{writable:true,value:null});Object.defineProperty(this,D,{writable:true,value:null});Object.defineProperty(this,U,{writable:true,value:null});Object.defineProperty(this,M,{writable:true,value:0});Object.defineProperty(this,_,{writable:true,value:""});Object.defineProperty(this,N,{writable:true,value:null});Object.defineProperty(this,z,{writable:true,value:null});Object.defineProperty(this,j,{writable:true,value:false});Object.defineProperty(this,x,{writable:true,value:false});Object.defineProperty(this,K,{writable:true,value:null});Object.defineProperty(this,k,{writable:true,value:null});Object.defineProperty(this,G,{writable:true,value:null});Object.defineProperty(this,W,{writable:true,value:null});Object.defineProperty(this,V,{writable:true,value:null});Object.defineProperty(this,$,{writable:true,value:null});Object.defineProperty(this,X,{writable:true,value:null});Object.defineProperty(this,J,{writable:true,value:null});Object.defineProperty(this,Y,{writable:true,value:i.INIT});Object.defineProperty(this,q,{writable:true,value:r.CLIENT});Object.defineProperty(this,Q,{writable:true,value:[]});Object.defineProperty(this,Z,{writable:true,value:0});Object.defineProperty(this,ee,{writable:true,value:Object.create(null)});Object.defineProperty(this,se,{writable:true,value:null});Object.defineProperty(this,te,{writable:true,value:null});Object.defineProperty(this,ie,{writable:true,value:null});Object.defineProperty(this,re,{writable:true,value:null});Object.defineProperty(this,le,{writable:true,value:false});Object.defineProperty(this,ae,{writable:true,value:new be(this)});this.setEventNamespace("BX.UI.Uploader.File");const a=t.Type.isPlainObject(s)?s:{};if(t.Type.isFile(e)){babelHelpers.classPrivateFieldLooseBase(this,C)[C]=e;this.update(a)}else if(t.Type.isBlob(e)){babelHelpers.classPrivateFieldLooseBase(this,C)[C]=H(e,a.name||e.name);this.update(a)}else if(B(e)){const s=T(e);babelHelpers.classPrivateFieldLooseBase(this,C)[C]=H(s,a.name);this.update(a)}else if(t.Type.isNumber(e)||t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,q)[q]=r.SERVER;babelHelpers.classPrivateFieldLooseBase(this,D)[D]=e;this.update(a)}else if(t.Type.isPlainObject(e)&&(t.Type.isNumber(e.serverFileId)||t.Type.isStringFilled(e.serverFileId))){babelHelpers.classPrivateFieldLooseBase(this,q)[q]=r.SERVER;this.update(e)}babelHelpers.classPrivateFieldLooseBase(this,R)[R]=t.Type.isStringFilled(a.id)?a.id:L();if(babelHelpers.classPrivateFieldLooseBase(this,q)[q]===r.SERVER){babelHelpers.classPrivateFieldLooseBase(this,le)[le]=a.preload===true||t.Type.isPlainObject(e)&&e.preload===true}this.subscribeFromOptions({[l.ADD]:()=>{babelHelpers.classPrivateFieldLooseBase(this,oe)[oe](i.ADDED)}});this.subscribeFromOptions(a.events)}load(){if(!this.canLoad()){return}babelHelpers.classPrivateFieldLooseBase(this,oe)[oe](i.LOADING);this.emit(l.LOAD_START);babelHelpers.classPrivateFieldLooseBase(this,ie)[ie].load(this)}shouldForceServerLoad(){return babelHelpers.classPrivateFieldLooseBase(this,le)[le]}upload(e={}){babelHelpers.classPrivateFieldLooseBase(this,ae)[ae].subscribe(e);if(this.isComplete()&&this.isUploadable()){babelHelpers.classPrivateFieldLooseBase(this,ae)[ae].emit("onComplete");return}if(this.isUploadFailed()){babelHelpers.classPrivateFieldLooseBase(this,ae)[ae].emit("onError",{error:this.getError()});return}if(!this.canUpload()){babelHelpers.classPrivateFieldLooseBase(this,ae)[ae].emit("onError",{error:new c("FILE_UPLOAD_NOT_ALLOWED")});return}const t=new s.BaseEvent({data:{file:this}});this.emit(l.BEFORE_UPLOAD,t);if(t.isDefaultPrevented()){return}babelHelpers.classPrivateFieldLooseBase(this,oe)[oe](i.PREPARING);const r=new s.BaseEvent({data:{file:this}});this.emitAsync(l.PREPARE_FILE_ASYNC,r).then((()=>{babelHelpers.classPrivateFieldLooseBase(this,oe)[oe](i.UPLOADING);this.emit(l.UPLOAD_START);babelHelpers.classPrivateFieldLooseBase(this,te)[te].upload(this)})).catch((e=>{const s=this.addError(e);babelHelpers.classPrivateFieldLooseBase(this,oe)[oe](i.UPLOAD_FAILED);this.emit(l.UPLOAD_ERROR,{error:s})}))}remove(e){if(this.getStatus()===i.INIT){return}babelHelpers.classPrivateFieldLooseBase(this,oe)[oe](i.INIT);this.emit(l.REMOVE_COMPLETE);this.abort();const s=!e||e.removeFromServer!==false;if(s&&babelHelpers.classPrivateFieldLooseBase(this,re)[re]!==null&&this.getOrigin()===r.CLIENT){babelHelpers.classPrivateFieldLooseBase(this,re)[re].remove(this)}babelHelpers.classPrivateFieldLooseBase(this,te)[te]=null;babelHelpers.classPrivateFieldLooseBase(this,ie)[ie]=null;babelHelpers.classPrivateFieldLooseBase(this,re)[re]=null}abort(){if(this.isLoading()){babelHelpers.classPrivateFieldLooseBase(this,oe)[oe](i.LOAD_FAILED);const e=new c("FILE_LOAD_ABORTED");this.emit(l.LOAD_ERROR,{error:e})}else if(this.isUploading()){babelHelpers.classPrivateFieldLooseBase(this,oe)[oe](i.UPLOAD_FAILED);const e=new c("FILE_UPLOAD_ABORTED");this.emit("onUploadError",{error:e});babelHelpers.classPrivateFieldLooseBase(this,ae)[ae].emit("onError",{error:e})}if(babelHelpers.classPrivateFieldLooseBase(this,ie)[ie]){babelHelpers.classPrivateFieldLooseBase(this,ie)[ie].abort()}if(babelHelpers.classPrivateFieldLooseBase(this,te)[te]){babelHelpers.classPrivateFieldLooseBase(this,te)[te].abort()}}getUploadController(){return babelHelpers.classPrivateFieldLooseBase(this,te)[te]}setUploadController(e){if(!(e instanceof h)&&!t.Type.isNull(e)){return}const s=babelHelpers.classPrivateFieldLooseBase(this,te)[te]!==e;babelHelpers.classPrivateFieldLooseBase(this,te)[te]=e;if(babelHelpers.classPrivateFieldLooseBase(this,te)[te]&&s){babelHelpers.classPrivateFieldLooseBase(this,te)[te].subscribeOnce("onError",(e=>{const s=this.addError(e.getData().error);babelHelpers.classPrivateFieldLooseBase(this,oe)[oe](i.UPLOAD_FAILED);this.emit(l.UPLOAD_ERROR,{error:s});babelHelpers.classPrivateFieldLooseBase(this,ae)[ae].emit("onError",{error:s})}));babelHelpers.classPrivateFieldLooseBase(this,te)[te].subscribe("onProgress",(e=>{const{progress:s}=e.getData();this.setProgress(s);this.emit(l.UPLOAD_PROGRESS,{progress:s})}));babelHelpers.classPrivateFieldLooseBase(this,te)[te].subscribeOnce("onUpload",(e=>{babelHelpers.classPrivateFieldLooseBase(this,oe)[oe](i.COMPLETE);this.update(e.getData().fileInfo);this.emit(l.UPLOAD_COMPLETE);babelHelpers.classPrivateFieldLooseBase(this,ae)[ae].emit("onComplete")}))}if(s){this.emit(l.UPLOAD_CONTROLLER_INIT,{controller:e})}}setLoadController(e){if(!(e instanceof v)){return}const t=babelHelpers.classPrivateFieldLooseBase(this,ie)[ie]!==e;babelHelpers.classPrivateFieldLooseBase(this,ie)[ie]=e;if(babelHelpers.classPrivateFieldLooseBase(this,ie)[ie]&&t){babelHelpers.classPrivateFieldLooseBase(this,ie)[ie].subscribeOnce("onError",(e=>{const s=this.addError(e.getData().error);babelHelpers.classPrivateFieldLooseBase(this,oe)[oe](i.LOAD_FAILED);this.emit(l.LOAD_ERROR,{error:s})}));babelHelpers.classPrivateFieldLooseBase(this,ie)[ie].subscribe("onProgress",(e=>{const{progress:s}=e.getData();this.emit(l.LOAD_PROGRESS,{progress:s})}));babelHelpers.classPrivateFieldLooseBase(this,ie)[ie].subscribeOnce("onLoad",(e=>{if(this.getOrigin()===r.CLIENT){const e=new s.BaseEvent({data:{file:this}});this.emitAsync(l.VALIDATE_FILE_ASYNC,e).then((()=>{if(this.isUploadable()){babelHelpers.classPrivateFieldLooseBase(this,oe)[oe](i.PENDING);this.emit(l.LOAD_COMPLETE)}else{const e=new s.BaseEvent({data:{file:this}});this.emitAsync(l.PREPARE_FILE_ASYNC,e).then((()=>{babelHelpers.classPrivateFieldLooseBase(this,oe)[oe](i.COMPLETE);this.emit(l.LOAD_COMPLETE)})).catch((e=>{const s=this.addError(e);babelHelpers.classPrivateFieldLooseBase(this,oe)[oe](i.LOAD_FAILED);this.emit(l.LOAD_ERROR,{error:s})}))}})).catch((e=>{const s=this.addError(e);babelHelpers.classPrivateFieldLooseBase(this,oe)[oe](i.LOAD_FAILED);this.emit(l.LOAD_ERROR,{error:s})}))}else{this.update(e.getData().fileInfo);if(this.isUploadable()){babelHelpers.classPrivateFieldLooseBase(this,oe)[oe](i.PENDING)}else{babelHelpers.classPrivateFieldLooseBase(this,oe)[oe](i.COMPLETE)}this.emit(l.LOAD_COMPLETE)}}))}if(t){this.emit(l.LOAD_CONTROLLER_INIT,{controller:e})}}setRemoveController(e){if(!(e instanceof F)&&!t.Type.isNull(e)){return}const s=babelHelpers.classPrivateFieldLooseBase(this,re)[re]!==e;babelHelpers.classPrivateFieldLooseBase(this,re)[re]=e;if(babelHelpers.classPrivateFieldLooseBase(this,re)[re]&&s){babelHelpers.classPrivateFieldLooseBase(this,re)[re].subscribeOnce("onError",(e=>{}));babelHelpers.classPrivateFieldLooseBase(this,re)[re].subscribeOnce("onRemove",(e=>{}))}if(s){this.emit(l.REMOVE_CONTROLLER_INIT,{controller:e})}}isReadyToUpload(){return this.getStatus()===i.PENDING}isUploadable(){return babelHelpers.classPrivateFieldLooseBase(this,te)[te]!==null}isLoadable(){return babelHelpers.classPrivateFieldLooseBase(this,ie)[ie]!==null}isRemoveable(){return babelHelpers.classPrivateFieldLooseBase(this,re)[re]!==null}canUpload(){return this.isReadyToUpload()&&this.isUploadable()}canLoad(){return this.getStatus()===i.ADDED&&this.isLoadable()}isUploading(){return this.getStatus()===i.UPLOADING}isPreparing(){return this.getStatus()===i.PREPARING}isLoading(){return this.getStatus()===i.LOADING}isComplete(){return this.getStatus()===i.COMPLETE}isFailed(){return this.getStatus()===i.LOAD_FAILED||this.getStatus()===i.UPLOAD_FAILED}isLoadFailed(){return this.getStatus()===i.LOAD_FAILED}isUploadFailed(){return this.getStatus()===i.UPLOAD_FAILED}getBinary(){return babelHelpers.classPrivateFieldLooseBase(this,C)[C]}setFile(e){if(t.Type.isFile(e)){babelHelpers.classPrivateFieldLooseBase(this,C)[C]=e}else if(t.Type.isBlob(e)){babelHelpers.classPrivateFieldLooseBase(this,C)[C]=H(e,this.getName())}}update(e){if(t.Type.isPlainObject(e)){this.setName(e.name);this.setType(e.type);this.setSize(e.size);this.setServerFileId(e.serverFileId);this.setWidth(e.width);this.setHeight(e.height);this.setTreatImageAsFile(e.treatImageAsFile);this.setClientPreview(e.clientPreview,e.clientPreviewWidth,e.clientPreviewHeight);this.setServerPreview(e.serverPreviewUrl,e.serverPreviewWidth,e.serverPreviewHeight);this.setDownloadUrl(e.downloadUrl);this.setCustomData(e.customData);this.setViewerAttrs(e.viewerAttrs);this.setLoadController(e.loadController);this.setUploadController(e.uploadController);this.setRemoveController(e.removeController)}}getName(){return babelHelpers.classPrivateFieldLooseBase(this,U)[U]===null?this.getBinary()?this.getBinary().name:"":babelHelpers.classPrivateFieldLooseBase(this,U)[U]}setName(e){if(t.Type.isStringFilled(e)||t.Type.isNull(e)){babelHelpers.classPrivateFieldLooseBase(this,U)[U]=e;this.emit(l.STATE_CHANGE,{property:"name",value:e})}}getExtension(){const e=this.getName();const s=e.lastIndexOf(".");return s>=0?e.slice(Math.max(0,s+1)).toLowerCase():""}getType(){return this.getBinary()?this.getBinary().type:babelHelpers.classPrivateFieldLooseBase(this,_)[_]}setType(e){if(t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,_)[_]=e;this.emit(l.STATE_CHANGE,{property:"type",value:e})}}getSize(){return this.getBinary()?this.getBinary().size:babelHelpers.classPrivateFieldLooseBase(this,M)[M]}getSizeFormatted(){return S(this.getSize())}setSize(e){if(t.Type.isNumber(e)&&e>=0){babelHelpers.classPrivateFieldLooseBase(this,M)[M]=e;this.emit(l.STATE_CHANGE,{property:"size",value:e})}}getId(){return babelHelpers.classPrivateFieldLooseBase(this,R)[R]}getServerFileId(){return babelHelpers.classPrivateFieldLooseBase(this,D)[D]}getServerId(){return this.getServerFileId()}setServerFileId(e){if(t.Type.isNumber(e)||t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,D)[D]=e;this.emit(l.STATE_CHANGE,{property:"serverFileId",value:e})}}getStatus(){return babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]}getOrigin(){return babelHelpers.classPrivateFieldLooseBase(this,q)[q]}getDownloadUrl(){return babelHelpers.classPrivateFieldLooseBase(this,J)[J]}setDownloadUrl(e){if(t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,J)[J]=e;this.emit(l.STATE_CHANGE,{property:"downloadUrl",value:e})}}getWidth(){return babelHelpers.classPrivateFieldLooseBase(this,N)[N]}setWidth(e){if(t.Type.isNumber(e)){babelHelpers.classPrivateFieldLooseBase(this,N)[N]=e;this.emit(l.STATE_CHANGE,{property:"width",value:e})}}getHeight(){return babelHelpers.classPrivateFieldLooseBase(this,z)[z]}setHeight(e){if(t.Type.isNumber(e)){babelHelpers.classPrivateFieldLooseBase(this,z)[z]=e;this.emit(l.STATE_CHANGE,{property:"height",value:e})}}isAnimated(){return babelHelpers.classPrivateFieldLooseBase(this,j)[j]}setAnimated(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,j)[j]=e;this.emit(l.STATE_CHANGE,{property:"animated",value:e})}}setTreatImageAsFile(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,x)[x]=e;this.emit(l.STATE_CHANGE,{property:"treatImageAsFile",value:e})}}shouldTreatImageAsFile(){return babelHelpers.classPrivateFieldLooseBase(this,x)[x]}getPreviewUrl(){return this.getClientPreview()?this.getClientPreviewUrl():this.getServerPreviewUrl()}getPreviewWidth(){return this.getClientPreview()?this.getClientPreviewWidth():this.getServerPreviewWidth()}getPreviewHeight(){return this.getClientPreview()?this.getClientPreviewHeight():this.getServerPreviewHeight()}getClientPreview(){return babelHelpers.classPrivateFieldLooseBase(this,K)[K]}setClientPreview(e,s=null,i=null){if(t.Type.isBlob(e)||t.Type.isNull(e)){this.revokeClientPreviewUrl();const r=t.Type.isNull(e)?null:URL.createObjectURL(e);babelHelpers.classPrivateFieldLooseBase(this,K)[K]=e;babelHelpers.classPrivateFieldLooseBase(this,k)[k]=r;babelHelpers.classPrivateFieldLooseBase(this,G)[G]=s;babelHelpers.classPrivateFieldLooseBase(this,W)[W]=i;this.emit(l.STATE_CHANGE,{property:"clientPreviewUrl",value:r});this.emit(l.STATE_CHANGE,{property:"clientPreviewWidth",value:s});this.emit(l.STATE_CHANGE,{property:"clientPreviewHeight",value:i})}}getClientPreviewUrl(){return babelHelpers.classPrivateFieldLooseBase(this,k)[k]}revokeClientPreviewUrl(){if(babelHelpers.classPrivateFieldLooseBase(this,k)[k]!==null){URL.revokeObjectURL(babelHelpers.classPrivateFieldLooseBase(this,k)[k]);babelHelpers.classPrivateFieldLooseBase(this,k)[k]=null;this.emit(l.STATE_CHANGE,{property:"clientPreviewUrl",value:null})}}getClientPreviewWidth(){return babelHelpers.classPrivateFieldLooseBase(this,G)[G]}getClientPreviewHeight(){return babelHelpers.classPrivateFieldLooseBase(this,W)[W]}getServerPreviewUrl(){return babelHelpers.classPrivateFieldLooseBase(this,V)[V]}setServerPreview(e,s=null,i=null){if(t.Type.isStringFilled(e)||t.Type.isNull(e)){babelHelpers.classPrivateFieldLooseBase(this,V)[V]=e;babelHelpers.classPrivateFieldLooseBase(this,$)[$]=s;babelHelpers.classPrivateFieldLooseBase(this,X)[X]=i;this.emit(l.STATE_CHANGE,{property:"serverPreviewUrl",value:e});this.emit(l.STATE_CHANGE,{property:"serverPreviewWidth",value:s});this.emit(l.STATE_CHANGE,{property:"serverPreviewHeight",value:i})}}getServerPreviewWidth(){return babelHelpers.classPrivateFieldLooseBase(this,$)[$]}getServerPreviewHeight(){return babelHelpers.classPrivateFieldLooseBase(this,X)[X]}isImage(){if(this.shouldTreatImageAsFile()){return false}return this.getWidth()>0&&this.getHeight()>0&&O(this.getName(),this.getType())}isVideo(){return n(this.getName())}getProgress(){return babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]}setProgress(e){if(t.Type.isNumber(e)){babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]=e;this.emit(l.STATE_CHANGE,{property:"progress",value:e})}}addError(e){const s=e instanceof Error?c.createFromError(e):e;babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].push(s);this.emit(l.STATE_CHANGE);return s}getError(){return babelHelpers.classPrivateFieldLooseBase(this,Q)[Q][0]||null}getErrors(){return babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]}getState(){return JSON.parse(JSON.stringify(this))}setCustomData(e,s){if(t.Type.isNull(e)){babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]=Object.create(null);this.emit(l.STATE_CHANGE,{property:"customData",value:null})}else if(t.Type.isPlainObject(e)){Object.entries(e).forEach((e=>{const[s,t]=e;this.setCustomData(s,t)}))}else if(t.Type.isString(e)){if(t.Type.isNull(s)){delete babelHelpers.classPrivateFieldLooseBase(this,ee)[ee][e];this.emit(l.STATE_CHANGE,{property:"customData",customProperty:e,value:null})}else if(!t.Type.isUndefined(s)){babelHelpers.classPrivateFieldLooseBase(this,ee)[ee][e]=s;this.emit(l.STATE_CHANGE,{property:"customData",customProperty:e,value:s})}}}getCustomData(e){if(t.Type.isUndefined(e)){return babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]}if(t.Type.isStringFilled(e)){return babelHelpers.classPrivateFieldLooseBase(this,ee)[ee][e]}return undefined}setViewerAttrs(e){if(t.Type.isNull(e)||t.Type.isPlainObject(e)){babelHelpers.classPrivateFieldLooseBase(this,se)[se]=e;this.emit(l.STATE_CHANGE,{property:"viewerAttrs",value:e})}}getViewerAttrs(){return babelHelpers.classPrivateFieldLooseBase(this,se)[se]}toJSON(){return{id:this.getId(),serverFileId:this.getServerFileId(),serverId:this.getServerFileId(),status:this.getStatus(),name:this.getName(),size:this.getSize(),sizeFormatted:this.getSizeFormatted(),type:this.getType(),extension:this.getExtension(),origin:this.getOrigin(),isImage:this.isImage(),isVideo:this.isVideo(),failed:this.isFailed(),width:this.getWidth(),height:this.getHeight(),animated:this.isAnimated(),progress:this.getProgress(),error:this.getError(),errors:this.getErrors(),previewUrl:this.getPreviewUrl(),previewWidth:this.getPreviewWidth(),previewHeight:this.getPreviewHeight(),clientPreviewUrl:this.getClientPreviewUrl(),clientPreviewWidth:this.getClientPreviewWidth(),clientPreviewHeight:this.getClientPreviewHeight(),serverPreviewUrl:this.getServerPreviewUrl(),serverPreviewWidth:this.getServerPreviewWidth(),serverPreviewHeight:this.getServerPreviewHeight(),downloadUrl:this.getDownloadUrl(),customData:this.getCustomData(),viewerAttrs:this.getViewerAttrs()}}}function ce(e){babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]=e;this.emit(l.STATE_CHANGE,{property:"status",value:e});this.emit(l.STATUS_CHANGE)}var de=babelHelpers.classPrivateFieldLooseKey("emitter");class be{constructor(e){Object.defineProperty(this,de,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,de)[de]=new s.EventEmitter(e,"BX.UI.Uploader.File.UploadCallbacks")}subscribe(e={}){const s=t.Type.isPlainObject(e)?e:{};if(t.Type.isFunction(s.onComplete)){this.getEmitter().subscribeOnce("onComplete",s.onComplete)}if(t.Type.isFunction(s.onError)){this.getEmitter().subscribeOnce("onError",s.onError)}}emit(e,s){if(babelHelpers.classPrivateFieldLooseBase(this,de)[de]){babelHelpers.classPrivateFieldLooseBase(this,de)[de].emit(e,s);babelHelpers.classPrivateFieldLooseBase(this,de)[de].unsubscribeAll()}}getEmitter(){if(t.Type.isNull(babelHelpers.classPrivateFieldLooseBase(this,de)[de])){babelHelpers.classPrivateFieldLooseBase(this,de)[de]=new s.EventEmitter(this,"BX.UI.Uploader.File.UploadCallbacks")}return babelHelpers.classPrivateFieldLooseBase(this,de)[de]}}var he=babelHelpers.classPrivateFieldLooseKey("data");var pe=babelHelpers.classPrivateFieldLooseKey("offset");var ue=babelHelpers.classPrivateFieldLooseKey("retries");class ve{constructor(e,s){Object.defineProperty(this,he,{writable:true,value:null});Object.defineProperty(this,pe,{writable:true,value:0});Object.defineProperty(this,ue,{writable:true,value:[]});babelHelpers.classPrivateFieldLooseBase(this,he)[he]=e;babelHelpers.classPrivateFieldLooseBase(this,pe)[pe]=s}getNextRetryDelay(){if(babelHelpers.classPrivateFieldLooseBase(this,ue)[ue].length===0){return null}return babelHelpers.classPrivateFieldLooseBase(this,ue)[ue].shift()}setRetries(e){if(t.Type.isArray(e)){babelHelpers.classPrivateFieldLooseBase(this,ue)[ue]=e}}getData(){return babelHelpers.classPrivateFieldLooseBase(this,he)[he]}getOffset(){return babelHelpers.classPrivateFieldLooseBase(this,pe)[pe]}getSize(){return this.getData().size}}var ge=babelHelpers.classPrivateFieldLooseKey("file");var Pe=babelHelpers.classPrivateFieldLooseKey("chunkOffset");var Fe=babelHelpers.classPrivateFieldLooseKey("chunkTimeout");var fe=babelHelpers.classPrivateFieldLooseKey("token");var Le=babelHelpers.classPrivateFieldLooseKey("xhr");var me=babelHelpers.classPrivateFieldLooseKey("aborted");var ye=babelHelpers.classPrivateFieldLooseKey("uploadChunk");var He=babelHelpers.classPrivateFieldLooseKey("retryUploadChunk");var Ee=babelHelpers.classPrivateFieldLooseKey("getNextChunk");class Be extends h{constructor(e,s={}){super(e,s);Object.defineProperty(this,Ee,{value:Oe});Object.defineProperty(this,He,{value:we});Object.defineProperty(this,ye,{value:Te});Object.defineProperty(this,ge,{writable:true,value:null});Object.defineProperty(this,Pe,{writable:true,value:null});Object.defineProperty(this,Fe,{writable:true,value:null});Object.defineProperty(this,fe,{writable:true,value:null});Object.defineProperty(this,Le,{writable:true,value:null});Object.defineProperty(this,me,{writable:true,value:false})}upload(e){if(!t.Type.isFile(e.getBinary())){this.emit("onError",{error:new c("WRONG_FILE_SOURCE")});return}if(babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]!==null){return}babelHelpers.classPrivateFieldLooseBase(this,ge)[ge]=e;const s=babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee]();if(s){babelHelpers.classPrivateFieldLooseBase(this,ye)[ye](s)}}abort(){if(babelHelpers.classPrivateFieldLooseBase(this,Le)[Le]){babelHelpers.classPrivateFieldLooseBase(this,me)[me]=true;babelHelpers.classPrivateFieldLooseBase(this,Le)[Le].abort();babelHelpers.classPrivateFieldLooseBase(this,Le)[Le]=null}clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe])}getFile(){return babelHelpers.classPrivateFieldLooseBase(this,ge)[ge]}getChunkSize(){return this.getServer().getChunkSize()}getChunkOffset(){return babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]}getToken(){return babelHelpers.classPrivateFieldLooseBase(this,fe)[fe]}setToken(e){if(t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,fe)[fe]=e}}}function Te(e){const s=this.getFile().getSize();const i=e.getOffset()===0&&s===e.getSize();let r=this.getFile().getName();if(r.normalize){r=r.normalize()}const l=t.Type.isStringFilled(this.getFile().getType())?this.getFile().getType():"application/octet-stream";const a=[{name:"Content-Type",value:l},{name:"X-Upload-Content-Name",value:encodeURIComponent(r)}];if(!i){const t=e.getOffset();const i=e.getOffset()+e.getSize()-1;const r=`bytes ${t}-${i}/${s}`;a.push({name:"Content-Range",value:r})}const o=this.getServer().getControllerOptions();t.ajax.runAction("ui.fileuploader.upload",{headers:a,data:e.getData(),preparePost:false,getParameters:{controller:this.getServer().getController(),controllerOptions:o?JSON.stringify(o):null,token:this.getToken()||""},onrequeststart:e=>{babelHelpers.classPrivateFieldLooseBase(this,Le)[Le]=e;babelHelpers.classPrivateFieldLooseBase(this,me)[me]=false},onprogressupload:s=>{if(s.lengthComputable){const t=this.getFile().getSize();const i=Math.min(t,e.getOffset()+s.loaded);const r=t>0?Math.floor(i/t*100):100;this.emit("onProgress",{progress:r})}}}).then((s=>{if(s.data.token){this.setToken(s.data.token);if(this.getFile().getServerFileId()===null){this.getFile().setServerFileId(s.data.token)}const t=this.getFile().getSize();const i=t>0?Math.floor((e.getOffset()+e.getSize())/t*100):100;this.emit("onProgress",{progress:i});const r=babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee]();if(r){babelHelpers.classPrivateFieldLooseBase(this,ye)[ye](r)}else{this.emit("onProgress",{progress:100});this.emit("onUpload",{fileInfo:s.data.file})}}else{this.emit("onError",{error:new c("SERVER_ERROR")})}})).catch((s=>{if(babelHelpers.classPrivateFieldLooseBase(this,me)[me]){return}const t=c.createFromAjaxErrors(s.errors);const i=t.getCode()==="NETWORK_ERROR"||t.getType()===c.Type.UNKNOWN;if(!i||!babelHelpers.classPrivateFieldLooseBase(this,He)[He](e)){this.emit("onError",{error:t})}}))}function we(e){const s=e.getNextRetryDelay();if(s===null){return false}clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe]);babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe]=setTimeout((()=>{babelHelpers.classPrivateFieldLooseBase(this,ye)[ye](e)}),s);return true}function Oe(){if(this.getChunkOffset()!==null&&this.getChunkOffset()>=this.getFile().getSize()){return null}if(this.getChunkOffset()===null){babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]=0}let e=null;if(this.getChunkOffset()===0&&this.getFile().getSize()<=this.getChunkSize()){e=new ve(this.getFile().getBinary(),this.getChunkOffset());babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]=this.getFile().getSize()}else{const s=Math.min(this.getChunkSize(),this.getFile().getSize()-this.getChunkOffset());const t=this.getChunkOffset()+s;const i=this.getFile().getBinary().slice(this.getChunkOffset(),t);e=new ve(i,this.getChunkOffset());babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]=t}e.setRetries([...this.getServer().getChunkRetryDelays()]);return e}const Se=new WeakMap;const Ae=new WeakMap;function Ie(e,s){const i=e.getServer();const r=e.getOption("timeout",100);let l=Se.get(i);if(!l){l={tasks:[],load:t.Runtime.debounce(Ce,r,i),xhr:null,aborted:false};Se.set(i,l)}l.tasks.push({controller:e,file:s});l.load()}function Re(e,s){const t=e.getServer();const i=Se.get(t);if(i){i.tasks=i.tasks.filter((e=>e.file!==s));if(i.tasks.length===0){Se.delete(t)}}else{const e=Ae.get(s);if(e){e.tasks=e.tasks.filter((e=>e.file!==s));Ae.delete(s);if(e.tasks.length===0){e.aborted=true;e.xhr.abort()}}}}function Ce(){const e=this;const s=Se.get(e);if(!s){return}Se.delete(e);if(s.tasks.length===0){return}const i=[];s.tasks.forEach((e=>{const t=e.file;i.push(t.getServerFileId());Ae.set(t,s)}));const r=e.getControllerOptions();t.ajax.runAction("ui.fileuploader.load",{data:{fileIds:i},getParameters:{controller:e.getController(),controllerOptions:r?JSON.stringify(r):null},onrequeststart:e=>{s.xhr=e},onprogress:e=>{if(e.lengthComputable){const t=e.total>0?Math.floor(e.loaded/e.total*100):100;s.tasks.forEach((e=>{const{controller:s}=e;s.emit("onProgress",{progress:t})}))}}}).then((e=>{var t;if((t=e.data)!=null&&t.files){const t={};e.data.files.forEach((e=>{t[e.id]=e}));s.tasks.forEach((e=>{const{controller:s,file:i}=e;const r=t[i.getServerFileId()]||null;Ae.delete(i);if(r&&r.success){s.emit("onProgress",{progress:100});s.emit("onLoad",{fileInfo:r.data.file})}else{const e=c.createFromAjaxErrors(r==null?void 0:r.errors);s.emit("onError",{error:e})}}))}else{const e=new c("SERVER_ERROR");s.tasks.forEach((s=>{const{controller:t,file:i}=s;Ae.delete(i);t.emit("onError",{error:e.clone()})}))}})).catch((e=>{const t=s.aborted?null:c.createFromAjaxErrors(e.errors);s.tasks.forEach((e=>{const{controller:i,file:r}=e;Ae.delete(r);if(!s.aborted){i.emit("onError",{error:t.clone()})}}))}))}var De=babelHelpers.classPrivateFieldLooseKey("file");class Ue extends v{constructor(e,s={}){super(e,s);Object.defineProperty(this,De,{writable:true,value:null})}load(e){if(this.getServer().getController()){babelHelpers.classPrivateFieldLooseBase(this,De)[De]=e;Ie(this,e)}else{this.emit("onProgress",{progress:100});this.emit("onLoad",{fileInfo:null})}}abort(){if(this.getServer().getController()&&babelHelpers.classPrivateFieldLooseBase(this,De)[De]){Re(this,babelHelpers.classPrivateFieldLooseBase(this,De)[De])}}}class Me extends v{constructor(e,s={}){super(e,s)}load(e){if(t.Type.isFile(e.getBinary())){this.emit("onProgress",{progress:100});this.emit("onLoad",{fileInfo:e})}else{this.emit("onError",{error:new c("WRONG_FILE_SOURCE")})}}abort(){}}const _e=new WeakMap;function Ne(e,s){const i=e.getServer();let r=_e.get(i);if(!r){r={tasks:[],remove:t.Runtime.debounce(ze,1e3,i),xhr:null};_e.set(i,r)}r.tasks.push({controller:e,file:s});r.remove()}function ze(){const e=this;const s=_e.get(e);if(!s){return}const{tasks:i}=s;_e.delete(e);const r=[];i.forEach((e=>{const s=e.file;if(s.getServerFileId()!==null){r.push(s.getServerFileId())}}));if(r.length===0){return}const l=e.getControllerOptions();t.ajax.runAction("ui.fileuploader.remove",{data:{fileIds:r},getParameters:{controller:e.getController(),controllerOptions:l?JSON.stringify(l):null},onrequeststart:e=>{s.xhr=e}}).then((e=>{var s;if((s=e.data)!=null&&s.files){const s={};e.data.files.forEach((e=>{s[e.id]=e}));i.forEach((e=>{const{controller:t,file:i}=e;const r=s[i.getServerFileId()]||null;if(r&&r.success){t.emit("onRemove",{fileId:r.id})}else{const e=c.createFromAjaxErrors(r==null?void 0:r.errors);t.emit("onError",{error:e})}}))}else{const e=new c("SERVER_ERROR");i.forEach((s=>{const{controller:t}=s;t.emit("onError",{error:e.clone()})}))}})).catch((e=>{const s=c.createFromAjaxErrors(e.errors);i.forEach((e=>{const{controller:t}=e;t.emit("onError",{error:s.clone()})}))}))}class je extends F{remove(e){Ne(this,e)}}class xe extends v{constructor(e,s={}){super(e,s)}load(e){if(t.Type.isStringFilled(e.getName())){this.emit("onProgress",{progress:100});this.emit("onLoad",{fileInfo:e})}else{this.emit("onError",{error:new c("WRONG_FILE_SOURCE")})}}abort(){}}var Ke=babelHelpers.classPrivateFieldLooseKey("controller");var ke=babelHelpers.classPrivateFieldLooseKey("controllerOptions");var Ge=babelHelpers.classPrivateFieldLooseKey("uploadControllerClass");var We=babelHelpers.classPrivateFieldLooseKey("uploadControllerOptions");var Ve=babelHelpers.classPrivateFieldLooseKey("loadControllerClass");var $e=babelHelpers.classPrivateFieldLooseKey("loadControllerOptions");var Xe=babelHelpers.classPrivateFieldLooseKey("removeControllerClass");var Je=babelHelpers.classPrivateFieldLooseKey("removeControllerOptions");var Ye=babelHelpers.classPrivateFieldLooseKey("chunkSize");var qe=babelHelpers.classPrivateFieldLooseKey("defaultChunkSize");var Qe=babelHelpers.classPrivateFieldLooseKey("chunkMinSize");var Ze=babelHelpers.classPrivateFieldLooseKey("chunkMaxSize");var es=babelHelpers.classPrivateFieldLooseKey("chunkRetryDelays");var ss=babelHelpers.classPrivateFieldLooseKey("calcChunkSize");class ts{constructor(e){Object.defineProperty(this,ss,{value:is});Object.defineProperty(this,Ke,{writable:true,value:null});Object.defineProperty(this,ke,{writable:true,value:null});Object.defineProperty(this,Ge,{writable:true,value:null});Object.defineProperty(this,We,{writable:true,value:{}});Object.defineProperty(this,Ve,{writable:true,value:null});Object.defineProperty(this,$e,{writable:true,value:{}});Object.defineProperty(this,Xe,{writable:true,value:null});Object.defineProperty(this,Je,{writable:true,value:{}});Object.defineProperty(this,Ye,{writable:true,value:null});Object.defineProperty(this,qe,{writable:true,value:null});Object.defineProperty(this,Qe,{writable:true,value:null});Object.defineProperty(this,Ze,{writable:true,value:null});Object.defineProperty(this,es,{writable:true,value:[1e3,3e3,6e3]});const s=t.Type.isPlainObject(e)?e:{};babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke]=t.Type.isStringFilled(s.controller)?s.controller:null;babelHelpers.classPrivateFieldLooseBase(this,ke)[ke]=t.Type.isPlainObject(s.controllerOptions)?s.controllerOptions:null;const i=t.Type.isNumber(s.chunkSize)&&s.chunkSize>0?s.chunkSize:this.getDefaultChunkSize();babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]=s.forceChunkSize===true?i:babelHelpers.classPrivateFieldLooseBase(this,ss)[ss](i);if(s.chunkRetryDelays===false||s.chunkRetryDelays===null){babelHelpers.classPrivateFieldLooseBase(this,es)[es]=[]}else if(t.Type.isArray(s.chunkRetryDelays)){babelHelpers.classPrivateFieldLooseBase(this,es)[es]=s.chunkRetryDelays}const r=["uploadControllerClass","loadControllerClass","removeControllerClass"];r.forEach((e=>{let i=null;if(t.Type.isStringFilled(s[e])){i=t.Runtime.getClass(s[e]);if(!t.Type.isFunction(i)){throw new TypeError(`Uploader.Server: "${e}" must be a function.`)}}else if(t.Type.isFunction(s[e])){i=s[e]}switch(e){case"uploadControllerClass":babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge]=i;break;case"loadControllerClass":babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve]=i;break;case"removeControllerClass":babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe]=i;break;default:}}));babelHelpers.classPrivateFieldLooseBase(this,$e)[$e]=t.Type.isPlainObject(s.loadControllerOptions)?s.loadControllerOptions:{};babelHelpers.classPrivateFieldLooseBase(this,We)[We]=t.Type.isPlainObject(s.uploadControllerOptions)?s.uploadControllerOptions:{};babelHelpers.classPrivateFieldLooseBase(this,Je)[Je]=t.Type.isPlainObject(s.removeControllerOptions)?s.removeControllerOptions:{}}createUploadController(){if(babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge]){const e=new(babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge])(this,babelHelpers.classPrivateFieldLooseBase(this,We)[We]);if(!(e instanceof h)){throw new TypeError('Uploader.Server: "uploadControllerClass" must be an instance of AbstractUploadController.')}return e}if(t.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke])){return new Be(this,babelHelpers.classPrivateFieldLooseBase(this,We)[We])}return null}createServerLoadController(){if(babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve]){const e=new(babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve])(this,babelHelpers.classPrivateFieldLooseBase(this,$e)[$e]);if(!(e instanceof v)){throw new TypeError('Uploader.Server: "loadControllerClass" must be an instance of AbstractLoadController.')}return e}return this.createDefaultServerLoadController()}createDefaultServerLoadController(){return new Ue(this,babelHelpers.classPrivateFieldLooseBase(this,$e)[$e])}createClientLoadController(){return new Me(this,babelHelpers.classPrivateFieldLooseBase(this,$e)[$e])}createServerlessLoadController(){return new xe(this,babelHelpers.classPrivateFieldLooseBase(this,$e)[$e])}createRemoveController(){if(babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe]){const e=new(babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe])(this,babelHelpers.classPrivateFieldLooseBase(this,Je)[Je]);if(!(e instanceof F)){throw new TypeError('Uploader.Server: "removeControllerClass" must be an instance of AbstractRemoveController.')}return e}if(t.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke])){return new je(this,babelHelpers.classPrivateFieldLooseBase(this,Je)[Je])}return null}getController(){return babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke]}getControllerOptions(){return babelHelpers.classPrivateFieldLooseBase(this,ke)[ke]}getChunkSize(){return babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]}getDefaultChunkSize(){if(babelHelpers.classPrivateFieldLooseBase(this,qe)[qe]===null){const e=t.Extension.getSettings("ui.uploader.core");babelHelpers.classPrivateFieldLooseBase(this,qe)[qe]=e.get("defaultChunkSize",5*1024*1024)}return babelHelpers.classPrivateFieldLooseBase(this,qe)[qe]}getChunkMinSize(){if(babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe]===null){const e=t.Extension.getSettings("ui.uploader.core");babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe]=e.get("chunkMinSize",1024*1024)}return babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe]}getChunkMaxSize(){if(babelHelpers.classPrivateFieldLooseBase(this,Ze)[Ze]===null){const e=t.Extension.getSettings("ui.uploader.core");babelHelpers.classPrivateFieldLooseBase(this,Ze)[Ze]=e.get("chunkMaxSize",5*1024*1024)}return babelHelpers.classPrivateFieldLooseBase(this,Ze)[Ze]}getChunkRetryDelays(){return babelHelpers.classPrivateFieldLooseBase(this,es)[es]}}function is(e){return Math.min(Math.max(this.getChunkMinSize(),e),this.getChunkMaxSize())}var rs=babelHelpers.classPrivateFieldLooseKey("uploader");class ls{constructor(e,s={}){Object.defineProperty(this,rs,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,rs)[rs]=e}getUploader(){return babelHelpers.classPrivateFieldLooseBase(this,rs)[rs]}apply(...e){throw new Error("You must implement apply() method.")}}var as=babelHelpers.classPrivateFieldLooseKey("maxFileSize");var os=babelHelpers.classPrivateFieldLooseKey("minFileSize");var ns=babelHelpers.classPrivateFieldLooseKey("maxTotalFileSize");var cs=babelHelpers.classPrivateFieldLooseKey("imageMaxFileSize");var ds=babelHelpers.classPrivateFieldLooseKey("imageMinFileSize");var bs=babelHelpers.classPrivateFieldLooseKey("treatOversizeImageAsFile");class hs extends ls{constructor(e,s={}){super(e);Object.defineProperty(this,as,{writable:true,value:256*1024*1024});Object.defineProperty(this,os,{writable:true,value:0});Object.defineProperty(this,ns,{writable:true,value:null});Object.defineProperty(this,cs,{writable:true,value:48*1024*1024});Object.defineProperty(this,ds,{writable:true,value:0});Object.defineProperty(this,bs,{writable:true,value:false});const i=t.Extension.getSettings("ui.uploader.core");babelHelpers.classPrivateFieldLooseBase(this,as)[as]=i.get("maxFileSize",babelHelpers.classPrivateFieldLooseBase(this,as)[as]);babelHelpers.classPrivateFieldLooseBase(this,os)[os]=i.get("minFileSize",babelHelpers.classPrivateFieldLooseBase(this,os)[os]);babelHelpers.classPrivateFieldLooseBase(this,ns)[ns]=i.get("maxTotalFileSize",babelHelpers.classPrivateFieldLooseBase(this,ns)[ns]);babelHelpers.classPrivateFieldLooseBase(this,cs)[cs]=i.get("imageMaxFileSize",babelHelpers.classPrivateFieldLooseBase(this,cs)[cs]);babelHelpers.classPrivateFieldLooseBase(this,ds)[ds]=i.get("imageMinFileSize",babelHelpers.classPrivateFieldLooseBase(this,ds)[ds]);const r=t.Type.isPlainObject(s)?s:{};this.setMaxFileSize(r.maxFileSize);this.setMinFileSize(r.minFileSize);this.setMaxTotalFileSize(r.maxTotalFileSize);this.setImageMaxFileSize(r.imageMaxFileSize);this.setImageMinFileSize(r.imageMinFileSize);this.setTreatOversizeImageAsFile(r.treatOversizeImageAsFile)}apply(e){return new Promise(((s,t)=>{if(this.getMaxFileSize()!==null&&e.getSize()>this.getMaxFileSize()){t(new c("MAX_FILE_SIZE_EXCEEDED",{maxFileSize:S(this.getMaxFileSize()),maxFileSizeInBytes:this.getMaxFileSize()}));return}if(e.getSize()<this.getMinFileSize()){t(new c("MIN_FILE_SIZE_EXCEEDED",{minFileSize:S(this.getMinFileSize()),minFileSizeInBytes:this.getMinFileSize()}));return}if(O(e.getName(),e.getType())){if(this.getImageMaxFileSize()!==null&&e.getSize()>this.getImageMaxFileSize()){if(this.shouldTreatOversizeImageAsFile()){e.setTreatImageAsFile(true)}else{t(new c("IMAGE_MAX_FILE_SIZE_EXCEEDED",{imageMaxFileSize:S(this.getImageMaxFileSize()),imageMaxFileSizeInBytes:this.getImageMaxFileSize()}));return}}if(e.getSize()<this.getImageMinFileSize()){if(this.shouldTreatOversizeImageAsFile()){e.setTreatImageAsFile(true)}else{t(new c("IMAGE_MIN_FILE_SIZE_EXCEEDED",{imageMinFileSize:S(this.getImageMinFileSize()),imageMinFileSizeInBytes:this.getImageMinFileSize()}));return}}}if(this.getMaxTotalFileSize()!==null&&this.getUploader().getTotalSize()>this.getMaxTotalFileSize()){t(new c("MAX_TOTAL_FILE_SIZE_EXCEEDED",{maxTotalFileSize:S(this.getMaxTotalFileSize()),maxTotalFileSizeInBytes:this.getMaxTotalFileSize()}));return}s()}))}getMaxFileSize(){return babelHelpers.classPrivateFieldLooseBase(this,as)[as]}setMaxFileSize(e){if(t.Type.isNumber(e)&&e>=0||t.Type.isNull(e)){babelHelpers.classPrivateFieldLooseBase(this,as)[as]=e}}getMinFileSize(){return babelHelpers.classPrivateFieldLooseBase(this,os)[os]}setMinFileSize(e){if(t.Type.isNumber(e)&&e>=0){babelHelpers.classPrivateFieldLooseBase(this,os)[os]=e}}getMaxTotalFileSize(){return babelHelpers.classPrivateFieldLooseBase(this,ns)[ns]}setMaxTotalFileSize(e){if(t.Type.isNumber(e)&&e>=0||t.Type.isNull(e)){babelHelpers.classPrivateFieldLooseBase(this,ns)[ns]=e}}getImageMaxFileSize(){return babelHelpers.classPrivateFieldLooseBase(this,cs)[cs]}setImageMaxFileSize(e){if(t.Type.isNumber(e)&&e>=0||t.Type.isNull(e)){babelHelpers.classPrivateFieldLooseBase(this,cs)[cs]=e}}getImageMinFileSize(){return babelHelpers.classPrivateFieldLooseBase(this,ds)[ds]}setImageMinFileSize(e){if(t.Type.isNumber(e)&&e>=0){babelHelpers.classPrivateFieldLooseBase(this,ds)[ds]=e}}setTreatOversizeImageAsFile(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,bs)[bs]=e}}shouldTreatOversizeImageAsFile(){return babelHelpers.classPrivateFieldLooseBase(this,bs)[bs]}}const ps=(e,s)=>{if(!t.Type.isArrayFilled(s)){return true}const i=e.type;const r=i.replace(/\/.*$/,"");for(const l of s){if(!t.Type.isStringFilled(l)){continue}const s=l.trim().toLowerCase();if(s.charAt(0)==="."){if(e.name.toLowerCase().includes(s,e.name.length-s.length)){return true}}else if(/\/\*$/.test(s)){if(r===s.replace(/\/.*$/,"")){return true}}else if(i===s){return true}}return false};class us extends ls{constructor(e,s={}){super(e)}apply(e){return new Promise(((s,t)=>{if(ps(e.getBinary(),this.getUploader().getAcceptedFileTypes())){s()}else{t(new c("FILE_TYPE_NOT_ALLOWED"))}}))}}const vs=e=>{if(e.arrayBuffer){return e.arrayBuffer()}return new Promise(((s,t)=>{const i=new FileReader;i.readAsArrayBuffer(e);i.onload=()=>{const e=i.result;s(e)};i.onerror=()=>{t(i.error)}}))};const gs=e=>{const s=[];for(let t=0;t<e.length;t++){s.push(e.codePointAt(t)&255)}return s};const Ps=(e,s,t)=>{for(let i=t,r=0;r<s.length;){if(e.getUint8(i++)!==s[r++]){return false}}return true};const Fs=gs("GIF87a");const fs=gs("GIF89a");class Ls{getSize(e){return new Promise(((s,t)=>{if(e.size<10){t(new Error("GIF signature not found."));return}vs(e).then((e=>{const i=new DataView(e);if(!Ps(i,Fs,0)&&!Ps(i,fs,0)){t(new Error("GIF signature not found."));return}let r=0;for(let e=0,s=i.byteLength-9;e<s&&r<2;e++){if(i.getUint8(e)===0&&i.getUint8(e+1)===33&&i.getUint8(e+2)===249&&i.getUint8(e+3)===4&&i.getUint8(e+8)===0&&(i.getUint8(e+9)===44||i.getUint8(e+9)===33)){r++}}const l=r>1;s({width:i.getUint16(6,true),height:i.getUint16(8,true),animated:l})})).catch((e=>{t(e)}))}))}}const ms=gs("\x89PNG\r\n\x1a\n");const ys=gs("IHDR");const Hs=gs("CgBI");class Es{getSize(e){return new Promise(((s,t)=>{if(e.size<40){t(new Error("PNG signature not found."));return}const i=e.slice(0,40);vs(i).then((e=>{const i=new DataView(e);if(!Ps(i,ms,0)){t(new Error("PNG signature not found."));return}if(Ps(i,Hs,12)){if(Ps(i,ys,28)){s({width:i.getUint32(32),height:i.getUint32(36)})}else{t(new Error("PNG IHDR not found."))}}else if(Ps(i,ys,12)){s({width:i.getUint32(16),height:i.getUint32(20)})}else{t(new Error("PNG IHDR not found."))}})).catch((e=>t(e)))}))}}const Bs=16973;class Ts{getSize(e){return new Promise(((s,t)=>{if(e.size<26){t(new Error("BMP signature not found."));return}const i=e.slice(0,26);vs(i).then((e=>{const i=new DataView(e);if(!i.getUint16(0)===Bs){t(new Error("BMP signature not found."));return}s({width:i.getUint32(18,true),height:Math.abs(i.getInt32(22,true))})})).catch((e=>{t(e)}))}))}}const ws=gs("Exif\0\0");class Os{getSize(e){return new Promise(((s,t)=>{if(e.size<2){t(new Error("JPEG signature not found."));return}vs(e).then((e=>{const i=new DataView(e);if(i.getUint8(0)!==255||i.getUint8(1)!==216){t(new Error("JPEG signature not found."));return}let r=2;let l=-1;for(;;){if(i.byteLength-r<2){t(new Error("JPEG signature not found."));return}if(i.getUint8(r++)!==255){t(new Error("JPEG signature not found."));return}let e=i.getUint8(r++);let a=0;while(e===255){e=i.getUint8(r++)}if(e>=208&&e<=217||e===1){a=0}else if(e>=192&&e<=254){if(i.byteLength-r<2){t(new Error("JPEG signature not found."));return}a=i.getUint16(r)-2;r+=2}else{t(new Error("JPEG unknown markers."));return}if(e===217||e===218){t(new Error("JPEG end of the data stream."));return}if(e===225&&a>=10&&Ps(i,ws,r)){const e=new DataView(i.buffer,r+6,r+a);l=As(e)}if(a>=5&&e>=192&&e<=207&&e!==196&&e!==200&&e!==204){if(i.byteLength-r<a){t(new Error("JPEG size not found."));return}let e=i.getUint16(r+3);let o=i.getUint16(r+1);if(l>=5&&l<=8){[e,o]=[o,e]}s({width:e,height:o,orientation:l});return}r+=a}})).catch((e=>{t(e)}))}))}}const Ss={BIG_ENDIAN:19789,LITTLE_ENDIAN:18761};const As=e=>{const s=e.getUint16(0);const t=s===Ss.BIG_ENDIAN;const i=s===Ss.LITTLE_ENDIAN;if(t||i){return Is(e,i)}return-1};const Is=(e,s=false)=>{const t=8;const i=e.getUint16(t,s);const r=12;const l=2;for(let a=0;a<i;a++){const i=t+l+a*r;const o=i+r;if(i>e.byteLength){return-1}const n=new DataView(e.buffer,e.byteOffset+i,o-i);const c=n.getUint16(0,s);if(c===274){const e=n.getUint16(2,s);if(e!==3){return-1}const t=n.getUint32(4,s);if(t!==1){return-1}return n.getUint16(8,s)}}return-1};const Rs=1380533830;const Cs=1464156752;const Ds=1448097824;const Us=1448097868;const Ms=1448097880;class _s{getSize(e){return new Promise(((s,t)=>{if(e.size<16){t(new Error("WEBP signature not found."));return}const i=e.slice(0,30);vs(i).then((e=>{const i=new DataView(e);if(i.getUint32(0)!==Rs&&i.getUint32(8)!==Cs){t(new Error("WEBP signature not found."));return}const r=i.getUint32(12);const l=new DataView(e,20,10);if(r===Ds&&l.getUint8(0)!==47){s({width:l.getUint16(6,true)&16383,height:l.getUint16(8,true)&16383});return}if(r===Us&&l.getUint8(0)===47){const e=l.getUint32(1,true);s({width:(e&16383)+1,height:(e>>14&16383)+1});return}if(r===Ms){const e=l.getUint8(0);const t=(e&192)===0;const i=(e&1)===0;if(t&&i){const t=(e&2)===2;const i=1+(l.getUint8(6)<<16|l.getUint8(5)<<8|l.getUint8(4));const r=1+(Math.trunc(l.getUint8(9))|l.getUint8(8)<<8|l.getUint8(7));s({width:i,height:r,animated:t});return}}t(new Error("WEBP signature not found."))})).catch((e=>{t(e)}))}))}}const Ns=new Os;const zs={gif:new Ls,png:new Es,bmp:new Ts,jpg:Ns,jpeg:Ns,jpe:Ns,webp:new _s};const js=e=>{if(e.size===0){return Promise.reject(new Error("Unknown image type."))}const s=a(e.name).toLowerCase();const t=e.type.replace(/^image\//,"");const i=zs[s]||zs[t];if(!i){return Promise.reject(new Error("Unknown image type."))}return i.getSize(e)};var xs=babelHelpers.classPrivateFieldLooseKey("imageMinWidth");var Ks=babelHelpers.classPrivateFieldLooseKey("imageMinHeight");var ks=babelHelpers.classPrivateFieldLooseKey("imageMaxWidth");var Gs=babelHelpers.classPrivateFieldLooseKey("imageMaxHeight");var Ws=babelHelpers.classPrivateFieldLooseKey("ignoreUnknownImageTypes");var Vs=babelHelpers.classPrivateFieldLooseKey("treatOversizeImageAsFile");class $s extends ls{constructor(e,s={}){super(e);Object.defineProperty(this,xs,{writable:true,value:1});Object.defineProperty(this,Ks,{writable:true,value:1});Object.defineProperty(this,ks,{writable:true,value:7e3});Object.defineProperty(this,Gs,{writable:true,value:7e3});Object.defineProperty(this,Ws,{writable:true,value:false});Object.defineProperty(this,Vs,{writable:true,value:false});const i=t.Extension.getSettings("ui.uploader.core");babelHelpers.classPrivateFieldLooseBase(this,xs)[xs]=i.get("imageMinWidth",babelHelpers.classPrivateFieldLooseBase(this,xs)[xs]);babelHelpers.classPrivateFieldLooseBase(this,Ks)[Ks]=i.get("imageMinHeight",babelHelpers.classPrivateFieldLooseBase(this,Ks)[Ks]);babelHelpers.classPrivateFieldLooseBase(this,ks)[ks]=i.get("imageMaxWidth",babelHelpers.classPrivateFieldLooseBase(this,ks)[ks]);babelHelpers.classPrivateFieldLooseBase(this,Gs)[Gs]=i.get("imageMaxHeight",babelHelpers.classPrivateFieldLooseBase(this,Gs)[Gs]);const r=t.Type.isPlainObject(s)?s:{};this.setImageMinWidth(r.imageMinWidth);this.setImageMinHeight(r.imageMinHeight);this.setImageMaxWidth(r.imageMaxWidth);this.setImageMaxHeight(r.imageMaxHeight);this.setIgnoreUnknownImageTypes(r.ignoreUnknownImageTypes);this.setTreatOversizeImageAsFile(r.treatOversizeImageAsFile)}apply(e){return new Promise(((s,t)=>{if(!O(e.getName(),e.getType())){s();return}js(e.getBinary()).then((({width:i,height:r,animated:l})=>{e.setWidth(i);e.setHeight(r);e.setAnimated(l===true);if(i<this.getImageMinWidth()||r<this.getImageMinHeight()){if(this.shouldTreatOversizeImageAsFile()){e.setTreatImageAsFile(true);s()}else{t(new c("IMAGE_IS_TOO_SMALL",{minWidth:this.getImageMinWidth(),minHeight:this.getImageMinHeight()}))}}else if(i>this.getImageMaxWidth()||r>this.getImageMaxHeight()){if(this.shouldTreatOversizeImageAsFile()){e.setTreatImageAsFile(true);s()}else{t(new c("IMAGE_IS_TOO_BIG",{maxWidth:this.getImageMaxWidth(),maxHeight:this.getImageMaxHeight()}))}}else{s()}})).catch((i=>{if(this.getIgnoreUnknownImageTypes()){e.setTreatImageAsFile(true);s()}else{if(i){console.warn("Uploader ImageSizeFilter:",i)}t(new c("IMAGE_TYPE_NOT_SUPPORTED"))}}))}))}getImageMinWidth(){return babelHelpers.classPrivateFieldLooseBase(this,xs)[xs]}setImageMinWidth(e){if(t.Type.isNumber(e)&&e>0){babelHelpers.classPrivateFieldLooseBase(this,xs)[xs]=e}}getImageMinHeight(){return babelHelpers.classPrivateFieldLooseBase(this,Ks)[Ks]}setImageMinHeight(e){if(t.Type.isNumber(e)&&e>0){babelHelpers.classPrivateFieldLooseBase(this,Ks)[Ks]=e}}getImageMaxWidth(){return babelHelpers.classPrivateFieldLooseBase(this,ks)[ks]}setImageMaxWidth(e){if(t.Type.isNumber(e)&&e>0){babelHelpers.classPrivateFieldLooseBase(this,ks)[ks]=e}}getImageMaxHeight(){return babelHelpers.classPrivateFieldLooseBase(this,Gs)[Gs]}setImageMaxHeight(e){if(t.Type.isNumber(e)&&e>0){babelHelpers.classPrivateFieldLooseBase(this,Gs)[Gs]=e}}getIgnoreUnknownImageTypes(){return babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws]}setIgnoreUnknownImageTypes(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,Ws)[Ws]=e}}setTreatOversizeImageAsFile(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,Vs)[Vs]=e}}shouldTreatOversizeImageAsFile(){return babelHelpers.classPrivateFieldLooseBase(this,Vs)[Vs]}}const Xs=e=>{const s=new Blob(["(",e.toString(),")()"],{type:"application/javascript"});const t=URL.createObjectURL(s);const i=new Worker(t);return{post:(e,s,t)=>{const r=L();i.onmessage=e=>{if(e.data.id===r){s(e.data.message)}};i.postMessage({id:r,message:e},t)},terminate:()=>{i.terminate();URL.revokeObjectURL(t)}}};const Js=function(){self.onmessage=e=>{setTimeout((()=>{createImageBitmap(e.data.message.file).then((s=>{var t;self.postMessage({id:e==null?void 0:(t=e.data)==null?void 0:t.id,message:s},[s])})).catch((()=>{self.postMessage({id:e.data.id,message:null},[])}))}),0)}};const Ys=()=>{self.onmessage=e=>{setTimeout((()=>{const{file:s,options:t={},getResizedImageSizeSource:i,createImagePreviewCanvasSource:r,sharpenSource:l,shouldSharpenSource:a}=e.data.message;createImageBitmap(s).then((s=>{const o=new Function(`return ${i}`)();const{targetWidth:n,targetHeight:c,useOriginalSize:d}=o(s,t);if(d){var b;s.close();self.postMessage({id:e==null?void 0:(b=e.data)==null?void 0:b.id,message:{useOriginalSize:d,targetWidth:n,targetHeight:c}},[])}else{var h;const t=new Function(`return ${r}`)();let i=t(s,n,c);const o=new Function(`return ${l}`)();const b=new Function(`return ${a}`)();if(b(s,n,c)){o(i,n,c,.2)}s.close();const p=i.transferToImageBitmap();i.width=0;i.height=0;i=null;self.postMessage({id:e==null?void 0:(h=e.data)==null?void 0:h.id,message:{bitmap:p,useOriginalSize:d,targetWidth:n,targetHeight:c}},[p])}})).catch((s=>{console.log("Uploader: Resize Worker Error (createImageBitmap)",s);self.postMessage({id:e.data.id,message:null},[])}))}),0)}};const qs=e=>new Promise(((s,t)=>{const i=document.createElement("img");const r=URL.createObjectURL(e);i.src=r;i.onerror=e=>{URL.revokeObjectURL(i.src);t(e)};i.onload=()=>{URL.revokeObjectURL(r);s({width:i.naturalWidth,height:i.naturalHeight,image:i})}}));const Qs=(e,s,t)=>{const i=Math.round(s);const r=Math.round(t);const l=typeof window!=="undefined"&&typeof document!=="undefined"&&typeof parent!=="undefined";const a=(e,s)=>{if(l){const t=document.createElement("canvas");t.width=e;t.height=s;return t}return new OffscreenCanvas(e,s)};if(e.height<=r&&e.width<=i){const s=a(i,r);const t=s.getContext("2d");t.imageSmoothingQuality="high";t.drawImage(e,0,0,i,r);return s}let o=Math.floor(e.width);let n=Math.floor(e.height);let c=e;let d=null;while(o*.5>i){const e=Math.floor(o*.5);const s=Math.floor(n*.5);d=a(e,s);const t=d.getContext("2d");t.imageSmoothingQuality="high";t.drawImage(c,0,0,o,n,0,0,e,s);o=e;n=s;c=d}const b=a(i,r);const h=b.getContext("2d");h.imageSmoothingQuality="high";h.drawImage(d===null?e:d,0,0,o,n,0,0,i,r);if(d){d.width=0;d.height=0;d=null;c.width=0;c.height=0;c=null}return b};const Zs=(e,s)=>{const{mode:t="contain",upscale:i=false}=s;let{width:r,height:l}=s;if(!r&&!l){return{targetWidth:0,targetHeight:0,useOriginalSize:true}}if(r===null){r=l}else if(l===null){l=r}if(t!=="force"){const s=r/e.width;const a=l/e.height;let o=1;if(t==="cover"){o=Math.max(s,a)}else if(t==="contain"){o=Math.min(s,a)}if(o>1&&i===false){return{targetWidth:e.width,targetHeight:e.height,useOriginalSize:true}}r=e.width*o;l=e.height*o}return{targetWidth:Math.floor(r),targetHeight:Math.floor(l),useOriginalSize:false}};const et=window.HTMLCanvasElement&&window.HTMLCanvasElement.prototype;const st=window.HTMLCanvasElement&&et.toBlob;const tt=!t.Type.isUndefined(window.OffscreenCanvas);const it=(e,s,t)=>new Promise(((i,r)=>{if(tt&&e instanceof OffscreenCanvas){e.convertToBlob({type:s,quality:t}).then((e=>{i(e)})).catch((e=>{r(e)}))}else if(st){e.toBlob((e=>{i(e)}),s,t)}else{const r=T(e.toDataURL(s,t));i(r)}}));const rt=t.Browser.isSafari()?["image/jpeg","image/png"]:["image/jpeg","image/png","image/webp"];const lt=e=>rt.includes(e);const at=(e,s,t,i)=>{const r=e.getContext("2d");const l=[0,-1,0,-1,5,-1,0,-1,0];const a=Math.round(Math.sqrt(l.length));const o=Math.trunc(a*.5);const n=r.createImageData(s,t);const c=n.data;const d=r.getImageData(0,0,s,t).data;let b=t;while(b--){let e=s;while(e--){const r=b;const n=e;const h=(b*s+e)*4;let p=0;let u=0;let v=0;for(let e=0;e<a;e++){for(let i=0;i<a;i++){const c=r+e-o;const b=n+i-o;if(c>=0&&c<t&&b>=0&&b<s){const t=(c*s+b)*4;const r=l[e*a+i];p+=d[t]*r;u+=d[t+1]*r;v+=d[t+2]*r}}}c[h]=p*i+d[h]*(1-i);c[h+1]=u*i+d[h+1]*(1-i);c[h+2]=v*i+d[h+2]*(1-i);c[h+3]=d[h+3]}}r.putImageData(n,0,0)};const ot=(e,s,t)=>{const i=s/e.width;const r=t/e.height;const l=Math.min(i,r);return l<.5};const nt=(e,s)=>{const{targetWidth:t,targetHeight:i}=Zs(e,s);const r=Qs(e,t,i);if(ot(e,t,i)){at(r,t,i,.2)}const{quality:l=.92}=s;const a=lt(s.mimeType)?s.mimeType:"image/jpeg";return it(r,a,l).then((e=>({width:t,height:i,blob:e})))};const ct=(e,s)=>{const t=lt(s.mimeType)?s.mimeType:"image/jpeg";const i=s.mimeTypeMode;if(i==="force"){return t}return lt(e.type)?e.type:t};const dt=e=>e.slice(0,Math.max(0,e.lastIndexOf(".")))||e;const bt={jpeg:"jpg"};const ht=(e,s)=>{const t=dt(e);const i=s.split("/")[1];const r=bt[i]||i;return`${t}.${r}`};let pt="createImageBitmap"in window&&!t.Type.isUndefined(window.ImageBitmap)&&ImageBitmap.prototype&&ImageBitmap.prototype.close;if(pt&&t.Browser.isSafari()){const e=navigator.userAgent.toLowerCase();const s=/version\/([\d.]+)/i;const t=s.exec(e);if(t&&t[1]&&t[1]<"16.4"){pt=false}}const ut=Qs.toString();const vt=Zs.toString();const gt=at.toString();const Pt=ot.toString();const Ft=pt&&!t.Type.isUndefined(window.OffscreenCanvas);const ft=(e,s)=>new Promise(((i,r)=>{if(Ft){const r=Xs(Ys);const l=ct(e,s);r.post({file:e,type:l,options:s,createImagePreviewCanvasSource:ut,getResizedImageSizeSource:vt,sharpenSource:gt,shouldSharpenSource:Pt},(o=>{r.terminate();if(o){const{bitmap:r,targetWidth:n,targetHeight:c,useOriginalSize:d}=o;if(d){i({preview:e,width:n,height:c})}else{let o=document.createElement("canvas");o.width=r.width;o.height=r.height;const d=o.getContext("bitmaprenderer");d.transferFromImageBitmap(r);const{quality:b=.92}=s;it(o,l,b).then((s=>{let r=s;if(t.Type.isFile(e)){const t=ht(e.name,l);r=H(s,t)}i({preview:r,width:n,height:c})})).catch((e=>{console.log("Uploader: convertCanvasToBlob error",e);a()})).finally((()=>{o.width=0;o.height=0;o=null;r.close()}))}}else{a()}}))}else if(pt){const s=Xs(Js);s.post({file:e},(e=>{s.terminate();if(e){l(e)}else{a()}}))}else{a()}function l(l){const{useOriginalSize:a,targetWidth:o,targetHeight:n}=Zs(l,s);if(a){if("close"in l){l.close()}i({preview:e,width:o,height:n})}else{const a=ct(e,s);nt(l,{...s,mimeType:a}).then((({blob:s,width:r,height:l})=>{let o=s;if(t.Type.isFile(e)){const t=ht(e.name,a);o=H(s,t)}i({preview:o,width:r,height:l})})).catch((e=>{r(e)})).finally((()=>{if("close"in l){l.close()}}))}}function a(){console.log("Uploader: resize image fallback");qs(e).then((({image:e})=>{l(e)})).catch((e=>{r(e)}))}}));const Lt=e=>/^video\/[\d.a-z-]+$/i.test(e.getType())||e.getExtension()==="mkv";const mt=(e,s={width:300,height:3e3},i=10)=>new Promise(((r,l)=>{const a=document.createElement("video");a.setAttribute("src",URL.createObjectURL(e));a.load();t.Event.bind(a,"error",(e=>{l(e||"Error while loading video file")}));t.Event.bind(a,"loadedmetadata",(()=>{a.currentTime=a.duration<i?0:i;t.Event.bind(a,"seeked",(()=>{const e={width:a.videoWidth,height:a.videoHeight};const{targetWidth:t,targetHeight:i}=Zs(e,s);if(!t||!i){l();return}const o=Qs(a,t,i);const{quality:n=.92,mimeType:c="image/jpeg"}=s;it(o,c,n).then((e=>{r({preview:e,width:t,height:i})})).catch((()=>{l()}))}))}))}));var yt=babelHelpers.classPrivateFieldLooseKey("imagePreviewWidth");var Ht=babelHelpers.classPrivateFieldLooseKey("imagePreviewHeight");var Et=babelHelpers.classPrivateFieldLooseKey("imagePreviewQuality");var Bt=babelHelpers.classPrivateFieldLooseKey("imagePreviewMimeType");var Tt=babelHelpers.classPrivateFieldLooseKey("imagePreviewMimeTypeMode");var wt=babelHelpers.classPrivateFieldLooseKey("imagePreviewUpscale");var Ot=babelHelpers.classPrivateFieldLooseKey("imagePreviewResizeMode");var St=babelHelpers.classPrivateFieldLooseKey("imagePreviewFilter");var At=babelHelpers.classPrivateFieldLooseKey("getResizeImageOptions");class It extends ls{constructor(e,s={}){super(e);Object.defineProperty(this,At,{value:Rt});Object.defineProperty(this,yt,{writable:true,value:300});Object.defineProperty(this,Ht,{writable:true,value:300});Object.defineProperty(this,Et,{writable:true,value:.92});Object.defineProperty(this,Bt,{writable:true,value:"image/jpeg"});Object.defineProperty(this,Tt,{writable:true,value:"auto"});Object.defineProperty(this,wt,{writable:true,value:false});Object.defineProperty(this,Ot,{writable:true,value:"contain"});Object.defineProperty(this,St,{writable:true,value:null});const i=t.Type.isPlainObject(s)?s:{};this.setImagePreviewWidth(i.imagePreviewWidth);this.setImagePreviewHeight(i.imagePreviewHeight);this.setImagePreviewQuality(i.imagePreviewQuality);this.setImagePreviewUpscale(i.imagePreviewUpscale);this.setImagePreviewResizeMode(i.imagePreviewResizeMode);this.setImagePreviewMimeType(i.imagePreviewMimeType);this.setImagePreviewMimeTypeMode(i.imagePreviewMimeTypeMode);this.setImagePreviewFilter(i.imagePreviewFilter)}apply(e){return new Promise((s=>{if(!e.shouldTreatImageAsFile()&&O(e.getBinary())){const i=this.invokeFilter(e);if(i===false){s();return}const r=t.Type.isPlainObject(i)?i:{};ft(e.getBinary(),babelHelpers.classPrivateFieldLooseBase(this,At)[At](r)).then((({preview:t,width:i,height:r})=>{e.setClientPreview(t,i,r);s()})).catch((e=>{if(e){console.warn("Uploader: image resize error",e)}s()}))}else if(Lt(e)&&!t.Browser.isSafari()){mt(e.getBinary(),babelHelpers.classPrivateFieldLooseBase(this,At)[At]()).then((({preview:t,width:i,height:r})=>{e.setClientPreview(t,i,r);s()})).catch((e=>{if(e){console.warn("Uploader: video preview error",e)}s()}))}else{s()}}))}getImagePreviewWidth(){return babelHelpers.classPrivateFieldLooseBase(this,yt)[yt]}setImagePreviewWidth(e){if(t.Type.isNumber(e)&&e>0){babelHelpers.classPrivateFieldLooseBase(this,yt)[yt]=e}}getImagePreviewHeight(){return babelHelpers.classPrivateFieldLooseBase(this,Ht)[Ht]}setImagePreviewHeight(e){if(t.Type.isNumber(e)&&e>0){babelHelpers.classPrivateFieldLooseBase(this,Ht)[Ht]=e}}getImagePreviewQuality(){return babelHelpers.classPrivateFieldLooseBase(this,Et)[Et]}setImagePreviewQuality(e){if(t.Type.isNumber(e)&&e>.1&&e<=1){babelHelpers.classPrivateFieldLooseBase(this,Et)[Et]=e}}getImagePreviewUpscale(){return babelHelpers.classPrivateFieldLooseBase(this,wt)[wt]}setImagePreviewUpscale(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,wt)[wt]=e}}getImagePreviewResizeMode(){return babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot]}setImagePreviewResizeMode(e){if(["contain","force","cover"].includes(e)){babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot]=e}}getImagePreviewMimeType(){return babelHelpers.classPrivateFieldLooseBase(this,Bt)[Bt]}setImagePreviewMimeType(e){if(["image/jpeg","image/png","image/webp"].includes(e)){babelHelpers.classPrivateFieldLooseBase(this,Bt)[Bt]=e}}getImagePreviewMimeTypeMode(){return babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt]}setImagePreviewMimeTypeMode(e){if(["auto","force"].includes(e)){babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt]=e}}setImagePreviewFilter(e){if(t.Type.isFunction(e)){babelHelpers.classPrivateFieldLooseBase(this,St)[St]=e}}invokeFilter(e){if(babelHelpers.classPrivateFieldLooseBase(this,St)[St]!==null){const s=babelHelpers.classPrivateFieldLooseBase(this,St)[St](e);if(t.Type.isBoolean(s)||t.Type.isPlainObject(s)){return s}}return true}}function Rt(e={}){return{width:t.Type.isNumber(e.width)?e.width:this.getImagePreviewWidth(),height:t.Type.isNumber(e.height)?e.height:this.getImagePreviewHeight(),mode:t.Type.isStringFilled(e.mode)?e.mode:this.getImagePreviewResizeMode(),upscale:t.Type.isBoolean(e.upscale)?e.upscale:this.getImagePreviewUpscale(),quality:t.Type.isNumber(e.quality)?e.quality:this.getImagePreviewQuality(),mimeType:t.Type.isStringFilled(e.mimeType)?e.mimeType:this.getImagePreviewMimeType(),mimeTypeMode:t.Type.isStringFilled(e.mimeTypeMode)?e.mimeTypeMode:this.getImagePreviewMimeTypeMode()}}var Ct=babelHelpers.classPrivateFieldLooseKey("resizeWidth");var Dt=babelHelpers.classPrivateFieldLooseKey("resizeHeight");var Ut=babelHelpers.classPrivateFieldLooseKey("resizeMethod");var Mt=babelHelpers.classPrivateFieldLooseKey("resizeMimeType");var _t=babelHelpers.classPrivateFieldLooseKey("resizeMimeTypeMode");var Nt=babelHelpers.classPrivateFieldLooseKey("resizeQuality");var zt=babelHelpers.classPrivateFieldLooseKey("resizeFilter");class jt extends ls{constructor(e,s={}){super(e);Object.defineProperty(this,Ct,{writable:true,value:null});Object.defineProperty(this,Dt,{writable:true,value:null});Object.defineProperty(this,Ut,{writable:true,value:"contain"});Object.defineProperty(this,Mt,{writable:true,value:"image/jpeg"});Object.defineProperty(this,_t,{writable:true,value:"auto"});Object.defineProperty(this,Nt,{writable:true,value:.92});Object.defineProperty(this,zt,{writable:true,value:null});const i=t.Type.isPlainObject(s)?s:{};this.setResizeWidth(i.imageResizeWidth);this.setResizeHeight(i.imageResizeHeight);this.setResizeMode(i.imageResizeMode);this.setResizeMimeType(i.imageResizeMimeType);this.setResizeMimeTypeMode(i.imageResizeMimeTypeMode);this.setResizeQuality(i.imageResizeQuality);this.setResizeFilter(i.imageResizeFilter)}apply(e){return new Promise((s=>{if(this.getResizeWidth()===null&&this.getResizeHeight()===null){s();return}if(e.shouldTreatImageAsFile()||!O(e.getBinary())){s();return}const i=this.invokeFilter(e);if(i===false){s();return}const r=t.Type.isPlainObject(i)?i:{};const l={width:t.Type.isNumber(r.width)?r.width:this.getResizeWidth(),height:t.Type.isNumber(r.height)?r.height:this.getResizeHeight(),mode:t.Type.isStringFilled(r.mode)?r.mode:this.getResizeMode(),quality:t.Type.isNumber(r.quality)?r.quality:this.getResizeQuality(),mimeType:t.Type.isStringFilled(r.mimeType)?r.mimeType:this.getResizeMimeType(),mimeTypeMode:t.Type.isStringFilled(r.mimeTypeMode)?r.mimeTypeMode:this.getResizeMimeTypeMode()};ft(e.getBinary(),l).then((({preview:t,width:i,height:r})=>{e.setWidth(i);e.setHeight(r);e.setFile(t);s()})).catch((e=>{if(e){console.warn("image resize error",e)}s()}))}))}getResizeWidth(){return babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct]}setResizeWidth(e){if(t.Type.isNumber(e)&&e>0||t.Type.isNull(e)){babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct]=e}}getResizeHeight(){return babelHelpers.classPrivateFieldLooseBase(this,Dt)[Dt]}setResizeHeight(e){if(t.Type.isNumber(e)&&e>0||t.Type.isNull(e)){babelHelpers.classPrivateFieldLooseBase(this,Dt)[Dt]=e}}getResizeMode(){return babelHelpers.classPrivateFieldLooseBase(this,Ut)[Ut]}setResizeMode(e){if(["contain","force","cover"].includes(e)){babelHelpers.classPrivateFieldLooseBase(this,Ut)[Ut]=e}}getResizeMimeType(){return babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt]}setResizeMimeType(e){if(["image/jpeg","image/png","image/webp"].includes(e)){babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt]=e}}getResizeMimeTypeMode(){return babelHelpers.classPrivateFieldLooseBase(this,_t)[_t]}setResizeMimeTypeMode(e){if(["auto","force"].includes(e)){babelHelpers.classPrivateFieldLooseBase(this,_t)[_t]=e}}getResizeQuality(){return babelHelpers.classPrivateFieldLooseBase(this,Nt)[Nt]}setResizeQuality(e){if(t.Type.isNumber(e)&&e>.1&&e<=1){babelHelpers.classPrivateFieldLooseBase(this,Nt)[Nt]=e}}setResizeFilter(e){if(t.Type.isFunction(e)){babelHelpers.classPrivateFieldLooseBase(this,zt)[zt]=e}}invokeFilter(e){if(babelHelpers.classPrivateFieldLooseBase(this,zt)[zt]!==null){const s=babelHelpers.classPrivateFieldLooseBase(this,zt)[zt](e);if(t.Type.isBoolean(s)||t.Type.isPlainObject(s)){return s}}return true}}const xt={STARTED:0,STOPPED:1};const Kt={UPLOAD_START:"onUploadStart",UPLOAD_COMPLETE:"onUploadComplete",ERROR:"onError",MAX_FILE_COUNT_EXCEEDED:"onMaxFileCountExceeded",DESTROY:"onDestroy",BEFORE_BROWSE:"onBeforeBrowse",BEFORE_DROP:"onBeforeDrop",BEFORE_PASTE:"onBeforePaste",BEFORE_FILES_ADD:"onBeforeFilesAdd",FILE_BEFORE_ADD:"File:onBeforeAdd",FILE_ADD_START:"File:onAddStart",FILE_LOAD_START:"File:onLoadStart",FILE_LOAD_PROGRESS:"File:onLoadProgress",FILE_LOAD_COMPLETE:"File:onLoadComplete",FILE_ERROR:"File:onError",FILE_ADD:"File:onAdd",FILE_REMOVE:"File:onRemove",FILE_UPLOAD_START:"File:onUploadStart",FILE_UPLOAD_PROGRESS:"File:onUploadProgress",FILE_UPLOAD_COMPLETE:"File:onUploadComplete",FILE_COMPLETE:"File:onComplete",FILE_STATUS_CHANGE:"File:onStatusChange",FILE_STATE_CHANGE:"File:onStateChange"};const kt={VALIDATION:"validation",PREPARATION:"preparation"};const Gt=e=>new Promise(((s,t)=>{const i=[];let r=0;let l=0;const a=()=>{if(l===0&&r===0){s(i)}};const o=e=>{r++;const s=e.createReader();const n=()=>{s.readEntries((e=>{if(e.length===0){r--;a();return}e.forEach((e=>{if(e.isDirectory){o(e)}else{l++;e.file((e=>{i.push(e);l--;a()}))}}));n()}),t)};n()};o(e)}));const Wt=e=>"webkitGetAsEntry"in e&&(e.webkitGetAsEntry()||{}).isDirectory===true;const Vt=e=>{if("webkitGetAsEntry"in e){const s=e.webkitGetAsEntry();if(s){return s.isFile||s.isDirectory}}return e.kind==="file"};const $t=e=>new Promise(((s,t)=>{if(Wt(e)){Gt(e.webkitGetAsEntry()).then(s).catch(t);return}s([e.getAsFile()])}));const Xt=(e,s=true)=>new Promise(((t,i)=>{if(!e.items||e.items.length===0){t(e.files?[...e.files]:[]);return}const r=[...e.items].filter((e=>s?Vt(e):e.kind==="file")).map((e=>$t(e)));Promise.all(r).then((e=>{const s=[];e.forEach((e=>{s.push(...e)}));t(s)})).catch(i)}));const Jt=(e,s=true)=>new Promise(((t,i)=>{if(!e.items){t(e.files?e.files.length>0:false);return}const r=[...e.items].every((e=>s?Vt(e):e.kind==="file"&&!Wt(e)));t(r)}));const Yt=(e,s=true)=>{if(!e.types.includes("Files")){return false}let t=0;let i=0;const r=e.items;for(const e of r){if(e.kind==="string"){i++}else{const i=s?Vt(e):e.kind==="file"&&!Wt(e);if(i){t++}}}return t>=i};let qt=null;const Qt=()=>{if(qt===null){try{const e=new DataTransfer;const s=new File(["hello"],"my.txt");e.items.add(s);const t=document.createElement("input");t.setAttribute("type","file");t.files=e.files;qt=t.files.length===1}catch{qt=false}}return qt};const Zt=(e,s)=>{try{const i=new DataTransfer;const r=t.Type.isArray(s)?s:[s];r.forEach((e=>{i.items.add(e)}));e.files=i.files}catch{return false}return true};const ei=new Map;var si=babelHelpers.classPrivateFieldLooseKey("id");var ti=babelHelpers.classPrivateFieldLooseKey("files");var ii=babelHelpers.classPrivateFieldLooseKey("multiple");var ri=babelHelpers.classPrivateFieldLooseKey("autoUpload");var li=babelHelpers.classPrivateFieldLooseKey("allowReplaceSingle");var ai=babelHelpers.classPrivateFieldLooseKey("maxParallelUploads");var oi=babelHelpers.classPrivateFieldLooseKey("maxParallelLoads");var ni=babelHelpers.classPrivateFieldLooseKey("acceptOnlyImages");var ci=babelHelpers.classPrivateFieldLooseKey("acceptedFileTypes");var di=babelHelpers.classPrivateFieldLooseKey("ignoredFileNames");var bi=babelHelpers.classPrivateFieldLooseKey("maxFileCount");var hi=babelHelpers.classPrivateFieldLooseKey("server");var pi=babelHelpers.classPrivateFieldLooseKey("hiddenFields");var ui=babelHelpers.classPrivateFieldLooseKey("hiddenFieldsContainer");var vi=babelHelpers.classPrivateFieldLooseKey("hiddenFieldName");var gi=babelHelpers.classPrivateFieldLooseKey("assignAsFile");var Pi=babelHelpers.classPrivateFieldLooseKey("assignServerFile");var Fi=babelHelpers.classPrivateFieldLooseKey("filters");var fi=babelHelpers.classPrivateFieldLooseKey("status");var Li=babelHelpers.classPrivateFieldLooseKey("onBeforeUploadHandler");var mi=babelHelpers.classPrivateFieldLooseKey("onFileStatusChangeHandler");var yi=babelHelpers.classPrivateFieldLooseKey("onFileStateChangeHandler");var Hi=babelHelpers.classPrivateFieldLooseKey("onInputFileChangeHandler");var Ei=babelHelpers.classPrivateFieldLooseKey("onPasteHandler");var Bi=babelHelpers.classPrivateFieldLooseKey("onDropHandler");var Ti=babelHelpers.classPrivateFieldLooseKey("browsingNodes");var wi=babelHelpers.classPrivateFieldLooseKey("dropNodes");var Oi=babelHelpers.classPrivateFieldLooseKey("pastingNodes");var Si=babelHelpers.classPrivateFieldLooseKey("setLoadEvents");var Ai=babelHelpers.classPrivateFieldLooseKey("setUploadEvents");var Ii=babelHelpers.classPrivateFieldLooseKey("setRemoveEvents");var Ri=babelHelpers.classPrivateFieldLooseKey("handleBeforeUpload");var Ci=babelHelpers.classPrivateFieldLooseKey("handleFileStatusChange");var Di=babelHelpers.classPrivateFieldLooseKey("handleFileStateChange");var Ui=babelHelpers.classPrivateFieldLooseKey("exceedsMaxFileCount");var Mi=babelHelpers.classPrivateFieldLooseKey("applyFilters");var _i=babelHelpers.classPrivateFieldLooseKey("removeFile");var Ni=babelHelpers.classPrivateFieldLooseKey("handleBrowseClick");var zi=babelHelpers.classPrivateFieldLooseKey("handleInputFileChange");var ji=babelHelpers.classPrivateFieldLooseKey("handleDrop");var xi=babelHelpers.classPrivateFieldLooseKey("preventDefault");var Ki=babelHelpers.classPrivateFieldLooseKey("handlePaste");var ki=babelHelpers.classPrivateFieldLooseKey("uploadNext");var Gi=babelHelpers.classPrivateFieldLooseKey("loadNext");var Wi=babelHelpers.classPrivateFieldLooseKey("setHiddenField");var Vi=babelHelpers.classPrivateFieldLooseKey("updateHiddenField");var $i=babelHelpers.classPrivateFieldLooseKey("resetHiddenField");var Xi=babelHelpers.classPrivateFieldLooseKey("resetHiddenFields");var Ji=babelHelpers.classPrivateFieldLooseKey("syncInputPositions");class Yi extends s.EventEmitter{static getById(e){return ei.get(e)||null}static getInstances(){return[...ei.values()]}constructor(e){super();Object.defineProperty(this,Ji,{value:Pr});Object.defineProperty(this,Xi,{value:gr});Object.defineProperty(this,$i,{value:vr});Object.defineProperty(this,Vi,{value:ur});Object.defineProperty(this,Wi,{value:pr});Object.defineProperty(this,Gi,{value:hr});Object.defineProperty(this,ki,{value:br});Object.defineProperty(this,Ki,{value:dr});Object.defineProperty(this,xi,{value:cr});Object.defineProperty(this,ji,{value:nr});Object.defineProperty(this,zi,{value:or});Object.defineProperty(this,Ni,{value:ar});Object.defineProperty(this,_i,{value:lr});Object.defineProperty(this,Mi,{value:rr});Object.defineProperty(this,Ui,{value:ir});Object.defineProperty(this,Di,{value:tr});Object.defineProperty(this,Ci,{value:sr});Object.defineProperty(this,Ri,{value:er});Object.defineProperty(this,Ii,{value:Zi});Object.defineProperty(this,Ai,{value:Qi});Object.defineProperty(this,Si,{value:qi});Object.defineProperty(this,si,{writable:true,value:null});Object.defineProperty(this,ti,{writable:true,value:[]});Object.defineProperty(this,ii,{writable:true,value:false});Object.defineProperty(this,ri,{writable:true,value:true});Object.defineProperty(this,li,{writable:true,value:true});Object.defineProperty(this,ai,{writable:true,value:2});Object.defineProperty(this,oi,{writable:true,value:10});Object.defineProperty(this,ni,{writable:true,value:false});Object.defineProperty(this,ci,{writable:true,value:[]});Object.defineProperty(this,di,{writable:true,value:[".ds_store","thumbs.db","desktop.ini"]});Object.defineProperty(this,bi,{writable:true,value:null});Object.defineProperty(this,hi,{writable:true,value:null});Object.defineProperty(this,pi,{writable:true,value:new Map});Object.defineProperty(this,ui,{writable:true,value:null});Object.defineProperty(this,vi,{writable:true,value:"file"});Object.defineProperty(this,gi,{writable:true,value:false});Object.defineProperty(this,Pi,{writable:true,value:true});Object.defineProperty(this,Fi,{writable:true,value:new Map});Object.defineProperty(this,fi,{writable:true,value:xt.STOPPED});Object.defineProperty(this,Li,{writable:true,value:null});Object.defineProperty(this,mi,{writable:true,value:null});Object.defineProperty(this,yi,{writable:true,value:null});Object.defineProperty(this,Hi,{writable:true,value:null});Object.defineProperty(this,Ei,{writable:true,value:null});Object.defineProperty(this,Bi,{writable:true,value:null});Object.defineProperty(this,Ti,{writable:true,value:new Map});Object.defineProperty(this,wi,{writable:true,value:new Set});Object.defineProperty(this,Oi,{writable:true,value:new Set});this.setEventNamespace("BX.UI.Uploader");babelHelpers.classPrivateFieldLooseBase(this,Li)[Li]=babelHelpers.classPrivateFieldLooseBase(this,Ri)[Ri].bind(this);babelHelpers.classPrivateFieldLooseBase(this,mi)[mi]=babelHelpers.classPrivateFieldLooseBase(this,Ci)[Ci].bind(this);babelHelpers.classPrivateFieldLooseBase(this,yi)[yi]=babelHelpers.classPrivateFieldLooseBase(this,Di)[Di].bind(this);babelHelpers.classPrivateFieldLooseBase(this,Hi)[Hi]=babelHelpers.classPrivateFieldLooseBase(this,zi)[zi].bind(this);babelHelpers.classPrivateFieldLooseBase(this,Ei)[Ei]=babelHelpers.classPrivateFieldLooseBase(this,Ki)[Ki].bind(this);babelHelpers.classPrivateFieldLooseBase(this,Bi)[Bi]=babelHelpers.classPrivateFieldLooseBase(this,ji)[ji].bind(this);const s=t.Type.isPlainObject(e)?{...e}:{};babelHelpers.classPrivateFieldLooseBase(this,si)[si]=t.Type.isStringFilled(s.id)?s.id:`ui-uploader-${t.Text.getRandom().toLowerCase()}`;babelHelpers.classPrivateFieldLooseBase(this,ii)[ii]=t.Type.isBoolean(s.multiple)?s.multiple:false;const i=t.Type.isBoolean(s.acceptOnlyImages)?s.acceptOnlyImages:null;const r=Yi.getGlobalOption("acceptOnlyImages",null);this.setAcceptOnlyImages(i||r);if(t.Type.isString(s.acceptedFileTypes)||t.Type.isArray(s.acceptedFileTypes)){this.setAcceptedFileTypes(s.acceptedFileTypes)}else if(i!==true){const e=Yi.getGlobalOption("acceptedFileTypes",null);this.setAcceptedFileTypes(e)}const l=t.Type.isArray(s.ignoredFileNames)?s.ignoredFileNames:Yi.getGlobalOption("ignoredFileNames",null);this.setIgnoredFileNames(l);this.setMaxFileCount(s.maxFileCount);this.setAllowReplaceSingle(s.allowReplaceSingle);this.assignBrowse(s.browseElement);this.assignDropzone(s.dropElement);this.assignPaste(s.pasteElement);this.setHiddenFieldsContainer(s.hiddenFieldsContainer);this.setHiddenFieldName(s.hiddenFieldName);this.setAssignAsFile(s.assignAsFile);this.setAssignServerFile(s.assignServerFile);this.setAutoUpload(s.autoUpload);this.setMaxParallelUploads(s.maxParallelUploads);this.setMaxParallelLoads(s.maxParallelLoads);let a=t.Type.isPlainObject(s.serverOptions)?s.serverOptions:{};a={controller:s.controller,controllerOptions:s.controllerOptions,...a};babelHelpers.classPrivateFieldLooseBase(this,hi)[hi]=new ts(a);this.subscribeFromOptions(s.events);this.addFilter(kt.VALIDATION,new hs(this,s));this.addFilter(kt.VALIDATION,new us(this,s));this.addFilter(kt.VALIDATION,new $s(this,s));this.addFilter(kt.VALIDATION,new It(this,s));this.addFilter(kt.PREPARATION,new jt(this,s));this.addFilters(s.filters);this.addFiles(s.files);ei.set(babelHelpers.classPrivateFieldLooseBase(this,si)[si],this)}static getGlobalOption(e,s=null){const i=t.Extension.getSettings("ui.uploader.core");return i.get(e,s)}addFiles(e){if(!t.Type.isArrayLike(e)){return[]}const r=[];[...e].forEach((e=>{if(e instanceof ne){if(e.getStatus()===i.INIT){r.push(e)}}else if(t.Type.isArrayFilled(e)){r.push(new ne(e[0],e[1]))}else{r.push(new ne(e))}}));const l=new s.BaseEvent({data:{files:[...r]}});this.emit(Kt.BEFORE_FILES_ADD,l);if(l.isDefaultPrevented()){const{error:e}=l.getData();if(e instanceof c){this.emit(Kt.ERROR,{error:e})}return[]}if(babelHelpers.classPrivateFieldLooseBase(this,Ui)[Ui](r)){return[]}const a=[];r.forEach((e=>{const s=this.addFile(e);if(s!==null){a.push(s)}}));return a}addFile(e,a){let o=null;if(e instanceof ne){if(e.getStatus()===i.INIT){o=e}else{return null}}else{o=new ne(e,a)}if(this.getIgnoredFileNames().includes(o.getName().toLowerCase())){return null}if(babelHelpers.classPrivateFieldLooseBase(this,Ui)[Ui]([o])){return null}if(!this.isMultiple()&&this.shouldReplaceSingle()&&babelHelpers.classPrivateFieldLooseBase(this,ti)[ti].length>0){const e=babelHelpers.classPrivateFieldLooseBase(this,ti)[ti][0];this.removeFile(e)}const n=new s.BaseEvent({data:{file:o}});this.emit(Kt.FILE_BEFORE_ADD,n);if(n.isDefaultPrevented()){return null}o.subscribe(l.STATUS_CHANGE,babelHelpers.classPrivateFieldLooseBase(this,mi)[mi]);o.subscribe(l.STATE_CHANGE,babelHelpers.classPrivateFieldLooseBase(this,yi)[yi]);babelHelpers.classPrivateFieldLooseBase(this,Ai)[Ai](o);babelHelpers.classPrivateFieldLooseBase(this,Si)[Si](o);babelHelpers.classPrivateFieldLooseBase(this,Ii)[Ii](o);if(!o.isLoadable()){if(o.getOrigin()===r.SERVER){const e=t.Type.isStringFilled(o.getName());if(!e||o.shouldForceServerLoad()){o.setLoadController(this.getServer().createServerLoadController())}else{o.setLoadController(this.getServer().createServerlessLoadController())}}else{o.setLoadController(this.getServer().createClientLoadController())}}if(!o.isUploadable()&&o.getOrigin()===r.CLIENT){const e=this.getServer().createUploadController();o.setUploadController(e)}if(!o.isRemoveable()){o.setRemoveController(this.getServer().createRemoveController())}babelHelpers.classPrivateFieldLooseBase(this,ti)[ti].push(o);o.emit(l.ADD);this.emit(Kt.FILE_ADD_START,{file:o});if(o.getOrigin()===r.CLIENT){babelHelpers.classPrivateFieldLooseBase(this,Gi)[Gi]()}else{o.load()}return o}start(){if(this.getStatus()!==xt.STARTED&&this.getPendingFileCount()>0){babelHelpers.classPrivateFieldLooseBase(this,fi)[fi]=xt.STARTED;this.emit(Kt.UPLOAD_START);babelHelpers.classPrivateFieldLooseBase(this,ki)[ki]()}}stop(){if(babelHelpers.classPrivateFieldLooseBase(this,fi)[fi]!==xt.STOPPED){babelHelpers.classPrivateFieldLooseBase(this,fi)[fi]=xt.STOPPED;this.emit("onStop")}}destroy(e){this.emit(Kt.DESTROY);this.unassignBrowseAll();this.unassignDropzoneAll();this.unassignPasteAll();const s=!e||e.removeFilesFromServer!==false;this.removeFiles({removeFromServer:s});babelHelpers.classPrivateFieldLooseBase(this,Xi)[Xi]();ei.delete(this.getId());babelHelpers.classPrivateFieldLooseBase(this,ti)[ti]=[];babelHelpers.classPrivateFieldLooseBase(this,hi)[hi]=null;babelHelpers.classPrivateFieldLooseBase(this,ci)[ci]=null;babelHelpers.classPrivateFieldLooseBase(this,di)[di]=null;babelHelpers.classPrivateFieldLooseBase(this,Fi)[Fi]=null;Object.setPrototypeOf(this,null)}removeFiles(e){this.getFiles().forEach((s=>{s.remove(e)}))}removeFile(e,s){const i=t.Type.isString(e)?this.getFile(e):e;const r=babelHelpers.classPrivateFieldLooseBase(this,ti)[ti].indexOf(i);if(r===-1){return}i.remove(s)}getFile(e){return babelHelpers.classPrivateFieldLooseBase(this,ti)[ti].find((s=>s.getId()===e))||null}getFiles(){return[...babelHelpers.classPrivateFieldLooseBase(this,ti)[ti]]}getFileCount(){return babelHelpers.classPrivateFieldLooseBase(this,ti)[ti].length}getId(){return babelHelpers.classPrivateFieldLooseBase(this,si)[si]}isMultiple(){return babelHelpers.classPrivateFieldLooseBase(this,ii)[ii]}getStatus(){return babelHelpers.classPrivateFieldLooseBase(this,fi)[fi]}addFilter(e,s,i={}){let r=null;if(t.Type.isFunction(s)||t.Type.isString(s)){const e=t.Type.isString(s)?t.Reflection.getClass(s):s;if(t.Type.isFunction(e)){r=new e(this,i)}}else{r=s}if(r instanceof ls){let s=babelHelpers.classPrivateFieldLooseBase(this,Fi)[Fi].get(e);if(!t.Type.isArray(s)){s=[];babelHelpers.classPrivateFieldLooseBase(this,Fi)[Fi].set(e,s)}s.push(r)}else{throw new TypeError("Uploader: a filter must be an instance of FileUploader.Filter.")}}addFilters(e){if(t.Type.isArray(e)){e.forEach((e=>{if(t.Type.isPlainObject(e)){this.addFilter(e.type,e.filter,e.options)}}))}}getServer(){return babelHelpers.classPrivateFieldLooseBase(this,hi)[hi]}assignBrowse(e){const s=t.Type.isElementNode(e)?[e]:e;if(!t.Type.isArray(s)){return}s.forEach((e=>{if(!t.Type.isElementNode(e)||babelHelpers.classPrivateFieldLooseBase(this,Ti)[Ti].has(e)){return}let s=null;if(e.tagName==="INPUT"&&e.type==="file"){s=e;if(s.files&&s.files.length>0){this.addFiles(s.files)}const i=s.getAttribute("accept");if(t.Type.isStringFilled(i)){this.setAcceptedFileTypes(i)}babelHelpers.classPrivateFieldLooseBase(this,Ti)[Ti].set(e,null)}else{s=document.createElement("input");s.setAttribute("type","file");const i=babelHelpers.classPrivateFieldLooseBase(this,Ni)[Ni].bind(this,s,e);babelHelpers.classPrivateFieldLooseBase(this,Ti)[Ti].set(e,i);t.Event.bind(e,"click",i)}if(this.isMultiple()){s.setAttribute("multiple","multiple")}if(t.Type.isArrayFilled(this.getAcceptedFileTypes())){s.setAttribute("accept",this.getAcceptedFileTypes().join(","))}t.Event.bind(s,"change",babelHelpers.classPrivateFieldLooseBase(this,Hi)[Hi])}))}unassignBrowse(e){const s=t.Type.isElementNode(e)?[e]:e;if(!t.Type.isArray(s)){return}s.forEach((e=>{if(babelHelpers.classPrivateFieldLooseBase(this,Ti)[Ti].has(e)){t.Event.unbind(e,"click",babelHelpers.classPrivateFieldLooseBase(this,Ti)[Ti].get(e));t.Event.unbind(e,"change",babelHelpers.classPrivateFieldLooseBase(this,Hi)[Hi]);babelHelpers.classPrivateFieldLooseBase(this,Ti)[Ti].delete(e)}}))}unassignBrowseAll(){[...babelHelpers.classPrivateFieldLooseBase(this,Ti)[Ti].keys()].forEach((e=>{this.unassignBrowse(e)}))}assignDropzone(e){const s=t.Type.isElementNode(e)?[e]:e;if(!t.Type.isArray(s)){return}s.forEach((e=>{if(!t.Type.isElementNode(e)||babelHelpers.classPrivateFieldLooseBase(this,wi)[wi].has(e)){return}t.Event.bind(e,"dragover",babelHelpers.classPrivateFieldLooseBase(this,xi)[xi]);t.Event.bind(e,"dragenter",babelHelpers.classPrivateFieldLooseBase(this,xi)[xi]);t.Event.bind(e,"drop",babelHelpers.classPrivateFieldLooseBase(this,Bi)[Bi]);babelHelpers.classPrivateFieldLooseBase(this,wi)[wi].add(e)}))}unassignDropzone(e){const s=t.Type.isElementNode(e)?[e]:e;if(!t.Type.isArray(s)){return}s.forEach((e=>{if(babelHelpers.classPrivateFieldLooseBase(this,wi)[wi].has(e)){t.Event.unbind(e,"dragover",babelHelpers.classPrivateFieldLooseBase(this,xi)[xi]);t.Event.unbind(e,"dragenter",babelHelpers.classPrivateFieldLooseBase(this,xi)[xi]);t.Event.unbind(e,"drop",babelHelpers.classPrivateFieldLooseBase(this,Bi)[Bi]);babelHelpers.classPrivateFieldLooseBase(this,wi)[wi].delete(e)}}))}unassignDropzoneAll(){[...babelHelpers.classPrivateFieldLooseBase(this,wi)[wi]].forEach((e=>{this.unassignDropzone(e)}))}assignPaste(e){const s=t.Type.isElementNode(e)?[e]:e;if(!t.Type.isArray(s)){return}s.forEach((e=>{if(!t.Type.isElementNode(e)||babelHelpers.classPrivateFieldLooseBase(this,Oi)[Oi].has(e)){return}t.Event.bind(e,"paste",babelHelpers.classPrivateFieldLooseBase(this,Ei)[Ei]);babelHelpers.classPrivateFieldLooseBase(this,Oi)[Oi].add(e)}))}unassignPaste(e){const s=t.Type.isElementNode(e)?[e]:e;if(!t.Type.isArray(s)){return}s.forEach((e=>{if(babelHelpers.classPrivateFieldLooseBase(this,Oi)[Oi].has(e)){t.Event.unbind(e,"paste",babelHelpers.classPrivateFieldLooseBase(this,Ei)[Ei]);babelHelpers.classPrivateFieldLooseBase(this,Oi)[Oi].delete(e)}}))}unassignPasteAll(){[...babelHelpers.classPrivateFieldLooseBase(this,Oi)[Oi]].forEach((e=>{this.unassignPaste(e)}))}getHiddenFieldsContainer(){let e=null;if(t.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,ui)[ui])){e=document.querySelector(babelHelpers.classPrivateFieldLooseBase(this,ui)[ui]);if(!t.Type.isElementNode(e)){console.error(`Uploader: a hidden field container was not found (${babelHelpers.classPrivateFieldLooseBase(this,ui)[ui]}).`)}}else if(t.Type.isElementNode(babelHelpers.classPrivateFieldLooseBase(this,ui)[ui])){e=babelHelpers.classPrivateFieldLooseBase(this,ui)[ui]}return e}setHiddenFieldsContainer(e){if(t.Type.isStringFilled(e)||t.Type.isElementNode(e)||t.Type.isNull(e)){babelHelpers.classPrivateFieldLooseBase(this,ui)[ui]=e}}getHiddenFieldName(){return babelHelpers.classPrivateFieldLooseBase(this,vi)[vi]}setHiddenFieldName(e){if(t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,vi)[vi]=e}}shouldAssignAsFile(){return babelHelpers.classPrivateFieldLooseBase(this,gi)[gi]}setAssignAsFile(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,gi)[gi]=e}}shouldAssignServerFile(){return babelHelpers.classPrivateFieldLooseBase(this,Pi)[Pi]}setAssignServerFile(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,Pi)[Pi]=e}}getTotalSize(){return babelHelpers.classPrivateFieldLooseBase(this,ti)[ti].reduce(((e,s)=>e+s.getSize()),0)}shouldAutoUpload(){return babelHelpers.classPrivateFieldLooseBase(this,ri)[ri]}setAutoUpload(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,ri)[ri]=e}}getMaxParallelUploads(){return babelHelpers.classPrivateFieldLooseBase(this,ai)[ai]}setMaxParallelUploads(e){if(t.Type.isNumber(e)&&e>0){babelHelpers.classPrivateFieldLooseBase(this,ai)[ai]=e}}getMaxParallelLoads(){return babelHelpers.classPrivateFieldLooseBase(this,oi)[oi]}setMaxParallelLoads(e){if(t.Type.isNumber(e)&&e>0){babelHelpers.classPrivateFieldLooseBase(this,oi)[oi]=e}}getUploadingFileCount(){return babelHelpers.classPrivateFieldLooseBase(this,ti)[ti].filter((e=>e.isUploading()||e.isPreparing())).length}getPendingFileCount(){return babelHelpers.classPrivateFieldLooseBase(this,ti)[ti].filter((e=>e.isReadyToUpload())).length}static getImageExtensions(){return this.getGlobalOption("imageExtensions",["jpg","bmp","jpeg","jpe","gif","png","webp"])}static getVideoExtensions(){return this.getGlobalOption("videoExtensions",["avi","wmv","mp4","mov","webm","flv","m4v","mkv","vob","3gp","ogv","h264"])}setAcceptOnlyImages(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,ni)[ni]=e;if(e){this.acceptOnlyImages()}}}acceptOnlyImages(){const e=Yi.getImageExtensions().map((e=>`.${e}`));this.setAcceptedFileTypes(e);babelHelpers.classPrivateFieldLooseBase(this,ni)[ni]=true}shouldAcceptOnlyImages(){return babelHelpers.classPrivateFieldLooseBase(this,ni)[ni]}getAcceptedFileTypes(){return babelHelpers.classPrivateFieldLooseBase(this,ci)[ci]}setAcceptedFileTypes(e){const s=t.Type.isString(e)?e.split(","):e;if(t.Type.isArray(s)){babelHelpers.classPrivateFieldLooseBase(this,ci)[ci]=[];babelHelpers.classPrivateFieldLooseBase(this,ni)[ni]=false;s.forEach((e=>{if(t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,ci)[ci].push(e)}}))}}getIgnoredFileNames(){return babelHelpers.classPrivateFieldLooseBase(this,di)[di]}setIgnoredFileNames(e){if(t.Type.isArray(e)){babelHelpers.classPrivateFieldLooseBase(this,di)[di]=[];e.forEach((e=>{if(t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,di)[di].push(e.toLowerCase())}}))}}setMaxFileCount(e){if(t.Type.isNumber(e)&&e>0||e===null){babelHelpers.classPrivateFieldLooseBase(this,bi)[bi]=e}}getMaxFileCount(){return babelHelpers.classPrivateFieldLooseBase(this,bi)[bi]}setAllowReplaceSingle(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,li)[li]=e}}shouldReplaceSingle(){return babelHelpers.classPrivateFieldLooseBase(this,li)[li]}}function qi(e){e.subscribeFromOptions({[l.LOAD_START]:()=>{this.emit(Kt.FILE_LOAD_START,{file:e})},[l.LOAD_PROGRESS]:s=>{const{progress:t}=s.getData();this.emit(Kt.FILE_LOAD_PROGRESS,{file:e,progress:t})},[l.LOAD_ERROR]:s=>{const{error:t}=s.getData();this.emit(Kt.FILE_ERROR,{file:e,error:t});this.emit(Kt.FILE_ADD,{file:e,error:t});babelHelpers.classPrivateFieldLooseBase(this,Gi)[Gi]()},[l.LOAD_COMPLETE]:()=>{this.emit(Kt.FILE_ADD,{file:e});this.emit(Kt.FILE_LOAD_COMPLETE,{file:e});if(!e.isUploadable()){this.emit(Kt.FILE_COMPLETE,{file:e});babelHelpers.classPrivateFieldLooseBase(this,Wi)[Wi](e)}else if(this.shouldAutoUpload()){e.upload()}babelHelpers.classPrivateFieldLooseBase(this,Gi)[Gi]()},[l.VALIDATE_FILE_ASYNC]:e=>{const s=e.getData().file;return babelHelpers.classPrivateFieldLooseBase(this,Mi)[Mi](kt.VALIDATION,s)},[l.PREPARE_FILE_ASYNC]:e=>{const s=e.getData().file;return babelHelpers.classPrivateFieldLooseBase(this,Mi)[Mi](kt.PREPARATION,s)}})}function Qi(e){e.subscribeFromOptions({[l.BEFORE_UPLOAD]:babelHelpers.classPrivateFieldLooseBase(this,Li)[Li],[l.UPLOAD_START]:()=>{this.emit(Kt.FILE_UPLOAD_START,{file:e})},[l.UPLOAD_PROGRESS]:s=>{const{progress:t}=s.getData();this.emit(Kt.FILE_UPLOAD_PROGRESS,{file:e,progress:t})},[l.UPLOAD_ERROR]:s=>{const{error:t}=s.getData();this.emit(Kt.FILE_ERROR,{file:e,error:t});babelHelpers.classPrivateFieldLooseBase(this,ki)[ki]()},[l.UPLOAD_COMPLETE]:()=>{this.emit(Kt.FILE_UPLOAD_COMPLETE,{file:e});this.emit(Kt.FILE_COMPLETE,{file:e});babelHelpers.classPrivateFieldLooseBase(this,Wi)[Wi](e);babelHelpers.classPrivateFieldLooseBase(this,ki)[ki]()}})}function Zi(e){e.subscribeOnce(l.REMOVE_ERROR,(s=>{const{error:t}=s.getData();this.emit(Kt.FILE_ERROR,{file:e,error:t})}));e.subscribeOnce(l.REMOVE_COMPLETE,(()=>{babelHelpers.classPrivateFieldLooseBase(this,_i)[_i](e)}))}function er(e){if(this.getStatus()===xt.STOPPED){e.preventDefault();this.start()}else if(this.getUploadingFileCount()>=this.getMaxParallelUploads()){e.preventDefault()}}function sr(e){const s=e.getTarget();this.emit(Kt.FILE_STATUS_CHANGE,{file:s})}function tr(e){const s=e.getTarget();const t=e.getData().property;const i=e.getData().value;if(t==="serverFileId"){babelHelpers.classPrivateFieldLooseBase(this,Vi)[Vi](s)}this.emit(Kt.FILE_STATE_CHANGE,{file:s,property:t,value:i})}function ir(e){const s=e.length;const t=babelHelpers.classPrivateFieldLooseBase(this,ti)[ti].length;if(!this.isMultiple()&&s>1){return true}let i=null;if(this.isMultiple()){i=this.getMaxFileCount()}else{i=this.shouldReplaceSingle()?null:1}if(i!==null&&t+s>i){const e=new c("MAX_FILE_COUNT_EXCEEDED",{maxFileCount:i});this.emit(Kt.MAX_FILE_COUNT_EXCEEDED,{error:e});this.emit(Kt.ERROR,{error:e});return true}return false}function rr(e,...s){return new Promise(((t,i)=>{const r=[...babelHelpers.classPrivateFieldLooseBase(this,Fi)[Fi].get(e)||[]];if(r.length===0){t();return}const l=r.shift();r.reduce(((e,t)=>e.then((()=>t.apply(...s)))),l.apply(...s)).then((e=>t(e))).catch((e=>i(e)))}))}function lr(e){const s=babelHelpers.classPrivateFieldLooseBase(this,ti)[ti].indexOf(e);if(s!==-1){babelHelpers.classPrivateFieldLooseBase(this,ti)[ti].splice(s,1)}e.unsubscribeAll();this.emit(Kt.FILE_REMOVE,{file:e});babelHelpers.classPrivateFieldLooseBase(this,$i)[$i](e)}function ar(e,t){const i=new s.BaseEvent({data:{input:e,node:t}});this.emit(Kt.BEFORE_BROWSE,i);if(i.isDefaultPrevented()){return}e.click()}function or(e){const s=e.currentTarget;this.addFiles([...s.files]);s.value=""}function nr(e){e.preventDefault();const t=new s.BaseEvent({data:{dragEvent:e}});this.emit(Kt.BEFORE_DROP,t);if(t.isDefaultPrevented()){return}Xt(e.dataTransfer).then((e=>{this.addFiles(e)})).catch((e=>{console.error("Uploader: data transfer error",e)}))}function cr(e){e.preventDefault()}function dr(e){const t=e.clipboardData;if(!t){return}const i=new s.BaseEvent({data:{clipboardEvent:e}});this.emit(Kt.BEFORE_PASTE,i);if(i.isDefaultPrevented()){return}if(Yt(t)){e.preventDefault();Xt(t).then((e=>{this.addFiles(e)})).catch((e=>{console.error("Uploader: data transfer error",e)}))}}function br(){if(this.getStatus()!==xt.STARTED){return}const e=this.getMaxParallelUploads();const s=this.getUploadingFileCount();const t=babelHelpers.classPrivateFieldLooseBase(this,ti)[ti].filter((e=>e.isReadyToUpload()));const i=t.length;if(s<e){const i=Math.min(e-s,t.length);for(let e=0;e<i;e++){const s=t[e];s.upload()}}if(s===0&&i===0){babelHelpers.classPrivateFieldLooseBase(this,fi)[fi]=xt.STOPPED;this.emit(Kt.UPLOAD_COMPLETE)}}function hr(){const e=this.getMaxParallelLoads();const s=babelHelpers.classPrivateFieldLooseBase(this,ti)[ti].filter((e=>e.isLoading())).length;const t=babelHelpers.classPrivateFieldLooseBase(this,ti)[ti].filter((e=>e.getStatus()===i.ADDED&&e.getOrigin()===r.CLIENT));if(s<e){const i=Math.min(e-s,t.length);for(let e=0;e<i;e++){const s=t[e];s.load()}}}function pr(e){const s=this.getHiddenFieldsContainer();if(!s||babelHelpers.classPrivateFieldLooseBase(this,pi)[pi].has(e.getId())){return}if(e.getOrigin()===r.SERVER&&!this.shouldAssignServerFile()){return}const i=e.getOrigin()===r.CLIENT&&!e.isUploadable()&&this.shouldAssignAsFile()&&Qt();const l=document.createElement("input");l.type=i?"file":"hidden";l.name=this.getHiddenFieldName()+(this.isMultiple()?"[]":"");if(i){t.Dom.style(l,{visibility:"hidden",left:0,top:0,width:0,height:0,position:"absolute","pointer-events":"none"});Zt(l,e.getBinary())}else if(e.getServerFileId()!==null){l.value=e.getServerFileId()}t.Dom.append(l,s);babelHelpers.classPrivateFieldLooseBase(this,pi)[pi].set(e.getId(),l);babelHelpers.classPrivateFieldLooseBase(this,Ji)[Ji]()}function ur(e){const s=babelHelpers.classPrivateFieldLooseBase(this,pi)[pi].get(e.getId());if(s&&s.type==="hidden"){if(e.getServerFileId()===null){babelHelpers.classPrivateFieldLooseBase(this,$i)[$i](e)}else{s.value=e.getServerFileId()}}}function vr(e){const s=babelHelpers.classPrivateFieldLooseBase(this,pi)[pi].get(e.getId());if(s){t.Dom.remove(s);babelHelpers.classPrivateFieldLooseBase(this,pi)[pi].delete(e.getId())}}function gr(){[...babelHelpers.classPrivateFieldLooseBase(this,pi)[pi].values()].forEach((e=>{t.Dom.remove(e)}));babelHelpers.classPrivateFieldLooseBase(this,pi)[pi]=[]}function Pr(){const e=this.getHiddenFieldsContainer();if(!e){return}this.getFiles().forEach((s=>{const i=babelHelpers.classPrivateFieldLooseBase(this,pi)[pi].get(s.getId());if(i){t.Dom.append(i,e)}}))}const Fr=e=>/^image\/[\d.a-z-]+$/i.test(e.type);const fr={JPEG:65496,APP1:65505,EXIF:1165519206,TIFF:18761,Orientation:274,Unknown:65280};const Lr=(e,s,t=false)=>e.getUint16(s,t);const mr=(e,s,t=false)=>e.getUint32(s,t);const yr=e=>new Promise(((s,t)=>{const i=new FileReader;i.onload=function(e){const t=new DataView(e.target.result);if(Lr(t,0)!==fr.JPEG){s(-1);return}const i=t.byteLength;let r=2;while(r<i){const e=Lr(t,r);r+=2;if(e===fr.APP1){r+=2;if(mr(t,r)!==fr.EXIF){break}const e=Lr(t,r+=6)===fr.TIFF;r+=mr(t,r+4,e);const i=Lr(t,r,e);r+=2;for(let l=0;l<i;l++){if(Lr(t,r+l*12,e)===fr.Orientation){s(Lr(t,r+l*12+8,e));return}}}else if((e&fr.Unknown)===fr.Unknown){r+=Lr(t,r)}else{break}}s(-1)};i.readAsArrayBuffer(e.slice(0,64*1024))}));const Hr=e=>/^image\/jpeg$/i.test(e.type);var Er=Object.freeze({formatFileSize:S,getFileExtension:a,getFilenameWithoutExtension:dt,getExtensionFromType:m,getJpegOrientation:yr,getArrayBuffer:vs,isDataUri:B,isImage:Fr,isResizableImage:O,isSupportedVideo:n,isJpeg:Hr,getImageSize:js,getResizedImageSize:Zs,resizeImage:ft,loadImage:qs,isValidFileType:ps,canAppendFileToForm:Qt,assignFileToInput:Zt,createFileFromBlob:H,createBlobFromDataUri:T,createVideoPreview:mt,createUniqueId:L,createWorker:Xs,getFilesFromDataTransfer:Xt,hasDataTransferOnlyFiles:Jt,isFilePasted:Yt});e.Uploader=Yi;e.UploaderStatus=xt;e.UploaderEvent=Kt;e.FileStatus=i;e.FileOrigin=r;e.FileEvent=l;e.FilterType=kt;e.Helpers=Er;e.UploaderError=c;e.Server=ts;e.AbstractLoadController=v;e.AbstractUploadController=h;e.AbstractRemoveController=F;e.formatFileSize=S;e.getFileExtension=a;e.getFilenameWithoutExtension=dt;e.getExtensionFromType=m;e.getJpegOrientation=yr;e.getArrayBuffer=vs;e.isDataUri=B;e.isImage=Fr;e.isResizableImage=O;e.isSupportedVideo=n;e.isJpeg=Hr;e.getImageSize=js;e.getResizedImageSize=Zs;e.resizeImage=ft;e.loadImage=qs;e.isValidFileType=ps;e.canAppendFileToForm=Qt;e.assignFileToInput=Zt;e.createFileFromBlob=H;e.createBlobFromDataUri=T;e.createVideoPreview=mt;e.createUniqueId=L;e.createWorker=Xs;e.getFilesFromDataTransfer=Xt;e.hasDataTransferOnlyFiles=Jt;e.isFilePasted=Yt})(this.BX.UI.Uploader=this.BX.UI.Uploader||{},BX.Event,BX);
//# sourceMappingURL=ui.uploader.bundle.map.js