{"version":3,"file":"video-player.bundle.js","sources":["../src/global-settings.js","../src/player-manager.js","../src/player.js","../src/index.js"],"sourcesContent":["import { type JsonObject, type JsonValue, Type } from 'main.core';\n\nexport class GlobalSettings\n{\n\t#options: JsonObject = null;\n\t#localStorageKey: string = null;\n\t#batchStarted: boolean = false;\n\n\tconstructor(localStorageKey: string)\n\t{\n\t\tthis.#localStorageKey = localStorageKey;\n\t}\n\n\t#init()\n\t{\n\t\tif (this.#options === null)\n\t\t{\n\t\t\tthis.#options = JSON.parse(window.localStorage.getItem(this.#localStorageKey)) || {};\n\t\t}\n\t}\n\n\tget(option: string, defaultValue?: any): any\n\t{\n\t\tthis.#init();\n\n\t\tif (!Type.isUndefined(this.#options[option]))\n\t\t{\n\t\t\treturn this.#options[option];\n\t\t}\n\n\t\tif (!Type.isUndefined(defaultValue))\n\t\t{\n\t\t\treturn defaultValue;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tset(option: string, value: JsonValue): void\n\t{\n\t\tthis.#init();\n\n\t\tthis.#options[option] = value;\n\n\t\tif (!this.#batchStarted)\n\t\t{\n\t\t\tthis.#batchStarted = true;\n\t\t\tqueueMicrotask(() => {\n\t\t\t\tthis.#batchStarted = false;\n\t\t\t\twindow.localStorage.setItem(this.#localStorageKey, JSON.stringify(this.#options));\n\t\t\t});\n\t\t}\n\t}\n}\n","import { Type, Event, Runtime, Reflection } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport type { Player } from './player';\n\nexport class PlayerManager\n{\n\tstatic #isStarted: false;\n\tstatic #players: Array<Player> = [];\n\n\tstatic addPlayer(player)\n\t{\n\t\tthis.#players.push(player);\n\n\t\tthis.#bindPlayerEvents(player);\n\n\t\tif (player.autostart || player.lazyload)\n\t\t{\n\t\t\tthis.#init();\n\t\t}\n\t}\n\n\tstatic removePlayer(playerToRemove)\n\t{\n\t\tthis.#players = this.#players.filter((player: Player) => player !== playerToRemove);\n\t}\n\n\tstatic #init(): void\n\t{\n\t\tif (this.#isStarted)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#isStarted = true;\n\n\t\tEvent.ready(() => {\n\t\t\tEvent.bind(window, 'scroll', Runtime.throttle(this.#handleScroll, 300, this));\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.#handleScroll();\n\t\t\t}, 50);\n\n\t\t\t/** @type {BX.SidePanel.Manager} */\n\t\t\tconst sliderManager = Reflection.getClass('top.BX.SidePanel.Instance');\n\t\t\tif (window !== window.top && sliderManager !== null)\n\t\t\t{\n\t\t\t\t// When players are inside an iframe\n\t\t\t\tconst currentSlider = sliderManager.getSliderByWindow(window);\n\t\t\t\tif (currentSlider)\n\t\t\t\t{\n\t\t\t\t\tEvent.EventEmitter.subscribe(currentSlider, 'SidePanel.Slider:onCloseComplete', () => {\n\t\t\t\t\t\tthis.#players.forEach((player: Player) => {\n\t\t\t\t\t\t\tplayer.pause();\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tstatic #bindPlayerEvents(player)\n\t{\n\t\tconst events = player.getEventList();\n\t\tfor (const eventName of events)\n\t\t{\n\t\t\tEvent.EventEmitter.subscribe(player, eventName, () => {\n\t\t\t\tEvent.EventEmitter.emit(this, `PlayerManager.${eventName}`, new BaseEvent({ compatData: [player] }));\n\t\t\t});\n\t\t}\n\t}\n\n\tstatic #handleScroll(): void\n\t{\n\t\tif (this.#players.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet topVisiblePlayer = false;\n\t\tlet isAnyPlaying = false;\n\n\t\tconst players = [...this.#players];\n\t\tfor (const [index, player] of players.entries())\n\t\t{\n\t\t\tif (!document.getElementById(player.id))\n\t\t\t{\n\t\t\t\tthis.#players.splice(index, 1);\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (player.lazyload && !player.inited && this.isVisibleOnScreen(player.id, 2))\n\t\t\t{\n\t\t\t\tplayer.init();\n\t\t\t}\n\n\t\t\tif (!player.autostart)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (player.active)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (player.isEnded())\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (this.isVisibleOnScreen(player.id, 1))\n\t\t\t{\n\t\t\t\tif (topVisiblePlayer === false)\n\t\t\t\t{\n\t\t\t\t\ttopVisiblePlayer = player;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (player.isPlaying())\n\t\t\t{\n\t\t\t\tplayer.pause();\n\t\t\t}\n\n\t\t\tif (player.isPlaying())\n\t\t\t{\n\t\t\t\tisAnyPlaying = true;\n\t\t\t}\n\t\t}\n\n\t\tif (isAnyPlaying)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (topVisiblePlayer !== false)\n\t\t{\n\t\t\tif (!topVisiblePlayer.inited)\n\t\t\t{\n\t\t\t\ttopVisiblePlayer.autostart = true;\n\t\t\t}\n\t\t\telse if (topVisiblePlayer.isReady() && !topVisiblePlayer.isEnded())\n\t\t\t{\n\t\t\t\ttopVisiblePlayer.mute(true);\n\n\t\t\t\tEvent.EventEmitter.subscribeOnce(\n\t\t\t\t\ttopVisiblePlayer,\n\t\t\t\t\t'Player:onClick',\n\t\t\t\t\t(event: BaseEvent) => {\n\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\ttopVisiblePlayer.mute(false);\n\t\t\t\t\t\t}, 100);\n\t\t\t\t\t},\n\t\t\t\t);\n\n\t\t\t\ttopVisiblePlayer.play();\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic getElementCoords(element: HTMLElement): Object\n\t{\n\t\tconst VISIBLE_OFFSET = 0.25;\n\n\t\tconst box = element.getBoundingClientRect();\n\n\t\tconst elementHeight = box.bottom - box.top;\n\t\tconst top = box.top + VISIBLE_OFFSET * elementHeight;\n\t\tconst bottom = box.bottom - VISIBLE_OFFSET * elementHeight;\n\n\t\tconst elementWidth = box.right - box.left;\n\t\tconst left = box.left + VISIBLE_OFFSET * elementWidth;\n\t\tconst right = box.right - VISIBLE_OFFSET * elementWidth;\n\n\t\treturn {\n\t\t\ttop: top + window.pageYOffset,\n\t\t\tbottom: bottom + window.pageYOffset,\n\t\t\tleft: left + window.pageXOffset,\n\t\t\tright: right + window.pageXOffset,\n\t\t\toriginTop: top,\n\t\t\toriginLeft: left,\n\t\t\toriginBottom: bottom,\n\t\t\toriginRight: right,\n\t\t};\n\t}\n\n\tstatic isVisibleOnScreen(id: string, screens: number): boolean\n\t{\n\t\tlet visible = false;\n\n\t\tconst element = document.getElementById(id);\n\t\tif (element === null)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst coords = this.getElementCoords(element);\n\t\tconst clientHeight = document.documentElement.clientHeight;\n\n\t\tlet windowTop = window.pageYOffset || document.documentElement.scrollTop;\n\t\tlet windowBottom = windowTop + clientHeight;\n\n\t\tconst numberOfScreens = screens ? parseInt(screens, 10) : 1;\n\n\t\tif (numberOfScreens > 1)\n\t\t{\n\t\t\twindowTop -= clientHeight * (numberOfScreens - 1);\n\t\t\twindowBottom += clientHeight * (numberOfScreens - 1);\n\t\t}\n\n\t\tconst topVisible = coords.top > windowTop && coords.top < windowBottom;\n\t\tconst bottomVisible = coords.bottom < windowBottom && coords.bottom > windowTop;\n\n\t\tconst onScreen = topVisible || bottomVisible;\n\n\t\tif (onScreen && screens > 1)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (!onScreen)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst playerElement = document.getElementById(id);\n\t\tconst playerCenterX = coords.originLeft + (coords.originRight - coords.originLeft) / 2;\n\t\tconst playerCenterY = coords.originTop + (coords.originBottom - coords.originTop) / 2 + 20;\n\n\t\tconst currentPlayerCenterElement = document.elementFromPoint(playerCenterX, playerCenterY);\n\n\t\tif (\n\t\t\tcurrentPlayerCenterElement !== null\n\t\t\t&& (\n\t\t\t\tcurrentPlayerCenterElement === playerElement\n\t\t\t\t|| currentPlayerCenterElement.parentNode === playerElement\n\t\t\t\t|| currentPlayerCenterElement.parentNode.parentNode === playerElement\n\t\t\t)\n\t\t)\n\t\t{\n\t\t\tvisible = true;\n\t\t}\n\n\t\treturn (onScreen && visible);\n\t}\n\n\tstatic getPlayerById(id): Player | null\n\t{\n\t\tif (!Type.isStringFilled(id))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tfor (const player of this.#players)\n\t\t{\n\t\t\tif (player.id === id)\n\t\t\t{\n\t\t\t\treturn player;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n}\n","/* eslint-disable @bitrix24/bitrix24-rules/no-native-dom-methods */\nimport { Dom, Type, Event, Reflection, Loc, type JsonObject } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport { videojs } from 'ui.video-js';\nimport { GlobalSettings } from './global-settings';\nimport { PlayerManager } from './player-manager';\n\nlet langSetup = false;\nvideojs.hook('beforesetup', (videoEl, options) => {\n\tDom.addClass(videoEl, 'ui-video-player ui-icon-set__scope');\n\tif (videoEl.tagName.toLowerCase() === 'audio')\n\t{\n\t\tDom.addClass(videoEl, 'vjs-audio-only-mode');\n\t}\n\n\tif (langSetup === false)\n\t{\n\t\tvideojs.addLanguage('video-player', {\n\t\t\tPlay: Loc.getMessage('VIDEO_PLAYER_PLAY'),\n\t\t\tPause: Loc.getMessage('VIDEO_PLAYER_PAUSE'),\n\t\t\tReplay: Loc.getMessage('VIDEO_PLAYER_REPLAY'),\n\t\t\t'Current Time': Loc.getMessage('VIDEO_PLAYER_CURRENT_TIME'),\n\t\t\tDuration: Loc.getMessage('VIDEO_PLAYER_DURATION'),\n\t\t\t'Remaining Time': Loc.getMessage('VIDEO_PLAYER_REMAINING_TIME'),\n\t\t\tLoaded: Loc.getMessage('VIDEO_PLAYER_LOADED'),\n\t\t\tProgress: Loc.getMessage('VIDEO_PLAYER_PROGRESS'),\n\t\t\t'Progress Bar': Loc.getMessage('VIDEO_PLAYER_PROGRESS_BAR'),\n\t\t\tFullscreen: Loc.getMessage('VIDEO_PLAYER_FULLSCREEN'),\n\t\t\t'Exit Fullscreen': Loc.getMessage('VIDEO_PLAYER_EXIT_FULLSCREEN'),\n\t\t\tMute: Loc.getMessage('VIDEO_PLAYER_MUTE'),\n\t\t\tUnmute: Loc.getMessage('VIDEO_PLAYER_UNMUTE'),\n\t\t\t'Playback Rate': Loc.getMessage('VIDEO_PLAYER_PLAYBACK_RATE'),\n\t\t\t'Volume Level': Loc.getMessage('VIDEO_PLAYER_VOLUME_LEVEL'),\n\t\t\t'You aborted the media playback': Loc.getMessage('VIDEO_PLAYER_ABORTED_PLAYBACK'),\n\t\t\t'A network error caused the media download to fail part-way.': Loc.getMessage('VIDEO_PLAYER_NETWORK_ERROR'),\n\t\t\t'The media could not be loaded, either because the server or network failed or because the format is not supported.': Loc.getMessage('VIDEO_PLAYER_FORMAT_NOT_SUPPORTED'),\n\t\t\t'The media playback was aborted due to a corruption problem or because the media used features your browser did not support.': Loc.getMessage('VIDEO_PLAYER_PLAYBACK_WAS_ABORTED'),\n\t\t\t'No compatible source was found for this media.': Loc.getMessage('VIDEO_PLAYER_NO_COMPATIBLE_SOURCE'),\n\t\t\t'The media is encrypted and we do not have the keys to decrypt it.': Loc.getMessage('VIDEO_PLAYER_MEDIA_IS_ENCRYPTED'),\n\t\t\t'Play Video': Loc.getMessage('VIDEO_PLAYER_PLAY_VIDEO'),\n\t\t\t'Exit Picture-in-Picture': Loc.getMessage('VIDEO_PLAYER_EXIT_PICTURE_IN_PICTURE'),\n\t\t\t'Picture-in-Picture': Loc.getMessage('VIDEO_PLAYER_PICTURE_IN_PICTURE'),\n\t\t});\n\n\t\tlangSetup = true;\n\t}\n\n\treturn options;\n});\n\nexport class Player\n{\n\tinited: boolean = false;\n\tid: string = null;\n\tmuted: boolean = false;\n\thasStarted: boolean = false;\n\tvjsPlayer: boolean = null;\n\tisAudio: boolean = false;\n\n\tstatic #globalSettings = new GlobalSettings('bx-video-player-settings');\n\n\tconstructor(id, params)\n\t{\n\t\tthis.id = id;\n\t\tthis.#fillParameters(params);\n\n\t\tPlayerManager.addPlayer(this);\n\n\t\tthis.#fireEvent('onCreate');\n\t}\n\n\tisReady(): boolean\n\t{\n\t\t// eslint-disable-next-line no-underscore-dangle\n\t\treturn this.vjsPlayer && this.vjsPlayer.isReady_;\n\t}\n\n\tplay(): void\n\t{\n\t\tthis.setPlayedState();\n\t\tthis.hasStarted = true;\n\t\ttry\n\t\t{\n\t\t\tthis.vjsPlayer.play();\n\t\t}\n\t\tcatch\n\t\t{\n\t\t\t// fail silently\n\t\t}\n\n\t\tthis.#fireEvent('onPlay');\n\t}\n\n\tpause(): void\n\t{\n\t\ttry\n\t\t{\n\t\t\tthis.vjsPlayer.pause();\n\t\t}\n\t\tcatch\n\t\t{\n\t\t\t// fail silently\n\t\t}\n\n\t\tthis.#fireEvent('onPause');\n\t}\n\n\ttoggle(): void\n\t{\n\t\tif (this.isPlaying())\n\t\t{\n\t\t\tthis.pause();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.play();\n\t\t}\n\t}\n\n\tisPlaying(): boolean\n\t{\n\t\tif (this.vjsPlayer)\n\t\t{\n\t\t\treturn this.isReady() && !this.vjsPlayer.paused();\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tisEnded(): boolean\n\t{\n\t\tif (this.vjsPlayer)\n\t\t{\n\t\t\treturn this.vjsPlayer.ended();\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tsetPlayedState(): void\n\t{\n\t\tconst storageHash = this.#getStorageHash();\n\n\t\tconst localStorage = Reflection.getClass('BX.localStorage');\n\t\tif (localStorage)\n\t\t{\n\t\t\tlocalStorage.set(storageHash, 'played', 14 * 24 * 3600);\n\t\t}\n\t}\n\n\tisPlayed(): boolean\n\t{\n\t\tconst storageHash = this.#getStorageHash();\n\t\t/** @type {BX.localStorage} */\n\t\tconst localStorage = Reflection.getClass('BX.localStorage');\n\t\tif (localStorage)\n\t\t{\n\t\t\treturn localStorage.get(storageHash) === 'played';\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t#getStorageHash(): string\n\t{\n\t\tlet storageHash = this.id;\n\t\tif (Type.isArrayFilled(this.params.sources) && this.params.sources[0].src)\n\t\t{\n\t\t\tstorageHash = this.params.sources[0].src;\n\t\t}\n\n\t\treturn `player_${storageHash}`;\n\t}\n\n\tgetElement(): HTMLElement | null\n\t{\n\t\treturn document.getElementById(this.id);\n\t}\n\n\tcreateElement(): HTMLElement | null\n\t{\n\t\tlet node = this.getElement();\n\t\tif (node)\n\t\t{\n\t\t\treturn node;\n\t\t}\n\n\t\tif (!this.id)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tlet tagName = 'video';\n\n\t\tconst classes = ['video-js', 'ui-video-player', 'ui-icon-set__scope'];\n\t\tif (this.isAudio)\n\t\t{\n\t\t\ttagName = 'audio';\n\t\t\tclasses.push('vjs-audio-only-mode');\n\t\t}\n\n\t\tlet className = classes.join(' ');\n\n\t\tif (this.skin)\n\t\t{\n\t\t\tclassName += ` ${this.skin}`;\n\t\t}\n\n\t\tconst attrs = {\n\t\t\tid: this.id,\n\t\t\tclassName,\n\t\t\twidth: this.width,\n\t\t\theight: this.height,\n\t\t\tcontrols: true,\n\t\t};\n\n\t\tif (this.muted)\n\t\t{\n\t\t\tattrs.muted = true;\n\t\t}\n\n\t\tnode = Dom.create(tagName, { attrs });\n\n\t\tif (Type.isArrayFilled(this.params.sources))\n\t\t{\n\t\t\tfor (const source of this.params.sources)\n\t\t\t{\n\t\t\t\tif (!source.src || !source.type)\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst sourceTag = Dom.create('source', {\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tsrc: source.src,\n\t\t\t\t\t\ttype: source.type,\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tDom.append(sourceTag, node);\n\t\t\t}\n\t\t}\n\n\t\treturn node;\n\t}\n\n\t#fillParameters(options: JsonObject)\n\t{\n\t\tconst defaults = this.#getDefaultOptions();\n\t\tconst params = Type.isPlainObject(options) ? { ...defaults, ...options } : defaults;\n\t\tif (Type.isArrayFilled(params.techOrder))\n\t\t{\n\t\t\t// Compatibility\n\t\t\tparams.techOrder = params.techOrder.filter((tech: string) => tech !== 'flash');\n\t\t}\n\n\t\tthis.autostart = params.autostart || false;\n\n\t\tif (params.playbackRate)\n\t\t{\n\t\t\tparams.playbackRate = parseFloat(params.playbackRate);\n\t\t\tif (params.playbackRate !== 1)\n\t\t\t{\n\t\t\t\tif (params.playbackRate <= 0)\n\t\t\t\t{\n\t\t\t\t\tparams.playbackRate = 1;\n\t\t\t\t}\n\n\t\t\t\tif (params.playbackRate > 3)\n\t\t\t\t{\n\t\t\t\t\tparams.playbackRate = 3;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (params.playbackRate !== 1)\n\t\t\t{\n\t\t\t\tthis.playbackRate = params.playbackRate;\n\t\t\t}\n\t\t}\n\n\t\tthis.volume = BX.Type.isNumber(params.volume) ? params.volume : null;\n\n\t\tthis.startTime = params.startTime || 0;\n\t\tthis.onInit = params.onInit;\n\t\tthis.lazyload = params.lazyload;\n\t\tthis.skin = params.skin || '';\n\t\tthis.isAudio = params.isAudio || false;\n\n\t\tif (this.isAudio)\n\t\t{\n\t\t\tparams.width = params.width || 400;\n\t\t\tparams.height = params.height || 30;\n\t\t\tparams.audioOnlyMode = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tparams.width = Math.max(params.width || 560, 400);\n\t\t\tparams.height = Math.max(params.height || 315, 130);\n\t\t}\n\n\t\tthis.width = params.width;\n\t\tthis.height = params.height;\n\t\tthis.duration = params.duration || null;\n\t\tthis.muted = params.muted || false;\n\n\t\tthis.params = params;\n\t\tthis.active = this.isPlayed();\n\t}\n\n\t#getDefaultOptions(): JsonObject\n\t{\n\t\treturn {\n\t\t\tcontrols: true,\n\t\t\tplaybackRates: [0.5, 1, 1.25, 1.5, 1.75, 2],\n\t\t\tlanguage: 'video-player',\n\t\t\tuserActions: {\n\t\t\t\tclick: this.#handleClick.bind(this),\n\t\t\t\thotkeys: this.#handleKeyDown.bind(this),\n\t\t\t},\n\t\t};\n\t}\n\n\tsetSource(source): void\n\t{\n\t\tif (!source)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.vjsPlayer.src(source);\n\t\tthis.#fireEvent('onSetSource');\n\t}\n\n\tgetSource(): string\n\t{\n\t\treturn this.vjsPlayer.src();\n\t}\n\n\tinit(): void\n\t{\n\t\tif (this.vjsPlayer !== null)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#fireEvent('onBeforeInit');\n\n\t\tif (videojs.players[this.id])\n\t\t{\n\t\t\tvideojs.players[this.id].dispose();\n\t\t}\n\n\t\tthis.vjsPlayer = videojs(this.id, this.params);\n\n\t\tif (this.isAudio)\n\t\t{\n\t\t\tthis.#hideAudioControls();\n\t\t\tthis.#setInitialVolume();\n\t\t}\n\n\t\tthis.vjsPlayer.on('fullscreenchange', () => {\n\t\t\tthis.vjsPlayer.focus();\n\t\t});\n\n\t\tif (this.duration > 0)\n\t\t{\n\t\t\tthis.vjsPlayer.one('loadedmetadata', () => {\n\t\t\t\tthis.vjsPlayer.duration(this.duration);\n\t\t\t});\n\t\t}\n\n\t\tthis.#proxyEvents();\n\n\t\tthis.vjsPlayer.ready(() => {\n\t\t\tconst controlBar = this.vjsPlayer.getChild('ControlBar');\n\t\t\tconst playbackButton = controlBar.getChild('PlaybackRateMenuButton');\n\t\t\tif (playbackButton)\n\t\t\t{\n\t\t\t\t// eslint-disable-next-line no-underscore-dangle\n\t\t\t\tvideojs.off(playbackButton.menuButton_.el(), 'mouseenter');\n\t\t\t\tvideojs.off(playbackButton.el(), 'mouseleave');\n\t\t\t}\n\n\t\t\tthis.vjsPlayer.one('play', this.#handlePlayOnce.bind(this));\n\n\t\t\tthis.inited = true;\n\t\t\tif (Type.isFunction(this.onInit))\n\t\t\t{\n\t\t\t\tthis.onInit(this);\n\t\t\t}\n\n\t\t\tthis.#fireEvent('onAfterInit');\n\n\t\t\tif (this.autostart && !this.lazyload)\n\t\t\t{\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tif (!this.hasStarted)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.play();\n\t\t\t\t\t}\n\t\t\t\t}, 200);\n\t\t\t}\n\t\t});\n\t}\n\n\tisInited(): boolean\n\t{\n\t\treturn this.vjsPlayer !== null;\n\t}\n\n\tgetEventList(): Array<string>\n\t{\n\t\treturn [\n\t\t\t'Player:onBeforeInit',\n\t\t\t'Player:onAfterInit',\n\t\t\t'Player:onCreate',\n\t\t\t'Player:onSetSource',\n\t\t\t'Player:onKeyDown',\n\t\t\t'Player:onPlay',\n\t\t\t'Player:onPause',\n\t\t\t'Player:onClick',\n\t\t\t'Player:onError',\n\t\t\t'Player:onEnded',\n\t\t\t'Player:onEnterPictureInPicture',\n\t\t\t'Player:onLeavePictureInPicture',\n\t\t];\n\t}\n\n\tmute(mute: boolean | undefined): boolean\n\t{\n\t\treturn this.vjsPlayer?.muted(mute);\n\t}\n\n\tisMuted(): boolean\n\t{\n\t\treturn this.vjsPlayer?.muted();\n\t}\n\n\tfocus(): void\n\t{\n\t\tthis.vjsPlayer?.focus();\n\t}\n\n\tmoveBackward(skipTime: number): void\n\t{\n\t\tconst currentVideoTime = this.vjsPlayer.currentTime();\n\t\tconst liveTracker = this.vjsPlayer.liveTracker;\n\n\t\tconst seekableStart = liveTracker && liveTracker.isLive() && liveTracker.seekableStart();\n\t\tlet newTime = 0;\n\n\t\tif (seekableStart && (currentVideoTime - skipTime <= seekableStart))\n\t\t{\n\t\t\tnewTime = seekableStart;\n\t\t}\n\t\telse if (currentVideoTime >= skipTime)\n\t\t{\n\t\t\tnewTime = currentVideoTime - skipTime;\n\t\t}\n\n\t\tthis.vjsPlayer.currentTime(newTime);\n\t}\n\n\tmoveForward(skipTime: number): void\n\t{\n\t\tif (!Type.isNumber(this.vjsPlayer.duration()))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentVideoTime = this.vjsPlayer.currentTime();\n\t\tconst liveTracker = this.vjsPlayer.liveTracker;\n\t\tconst duration = (liveTracker && liveTracker.isLive()) ? liveTracker.seekableEnd() : this.vjsPlayer.duration();\n\t\tconst newTime = currentVideoTime + skipTime <= duration ? currentVideoTime + skipTime : duration;\n\n\t\tthis.vjsPlayer.currentTime(newTime);\n\t}\n\n\tincreasePlaybackRate(): void\n\t{\n\t\tconst playbackRates: Number[] = this.vjsPlayer.playbackRates();\n\t\tconst currentPlayback = this.vjsPlayer.playbackRate();\n\n\t\tconst nextPlayback = playbackRates.find((value) => {\n\t\t\treturn value > currentPlayback;\n\t\t});\n\n\t\tif (nextPlayback)\n\t\t{\n\t\t\tthis.vjsPlayer.playbackRate(nextPlayback);\n\t\t}\n\t}\n\n\tdecreasePlaybackRate(): void\n\t{\n\t\tconst playbackRates = [...this.vjsPlayer.playbackRates()].reverse();\n\t\tconst currentPlayback = this.vjsPlayer.playbackRate();\n\n\t\tconst prevPlayback = playbackRates.find((value) => {\n\t\t\treturn value < currentPlayback;\n\t\t});\n\n\t\tif (prevPlayback)\n\t\t{\n\t\t\tthis.vjsPlayer.playbackRate(prevPlayback);\n\t\t}\n\t}\n\n\t#hideAudioControls(): void\n\t{\n\t\tthis.vjsPlayer.removeChild('BigPlayButton');\n\t\tthis.vjsPlayer.removeChild('TextTrackSettings');\n\t\tthis.vjsPlayer.removeChild('PosterImage');\n\t\tthis.vjsPlayer.controlBar.removeChild('FullscreenToggle');\n\t\tthis.vjsPlayer.controlBar.removeChild('PictureInPictureToggle');\n\t\tthis.vjsPlayer.controlBar.removeChild('ChaptersButton');\n\t\tthis.vjsPlayer.controlBar.removeChild('DescriptionsButton');\n\n\t\tif (this.skin === 'vjs-audio-wave-skin' || this.skin === 'vjs-viewer-audio-player-skin')\n\t\t{\n\t\t\tthis.vjsPlayer.removeChild('VolumePanel');\n\t\t\tthis.vjsPlayer.controlBar.removeChild('VolumePanel');\n\t\t\tthis.vjsPlayer.controlBar.removeChild('CurrentTimeDisplay');\n\t\t\tthis.vjsPlayer.controlBar.removeChild('PlaybackRateMenuButton');\n\t\t}\n\t}\n\n\t#handlePlayOnce(): void\n\t{\n\t\tif (this.playbackRate !== 1)\n\t\t{\n\t\t\tthis.vjsPlayer.playbackRate(this.playbackRate);\n\t\t}\n\n\t\tthis.#setInitialVolume();\n\n\t\tif (this.startTime > 0)\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tthis.vjsPlayer.currentTime(this.startTime);\n\t\t\t}\n\t\t\tcatch\n\t\t\t{\n\t\t\t\t// Fail silently\n\t\t\t}\n\t\t}\n\n\t\tthis.vjsPlayer.on('volumechange', () => {\n\t\t\tthis.constructor.#globalSettings.set('volume', this.vjsPlayer.volume());\n\t\t\tthis.active = true;\n\t\t});\n\t}\n\n\t#setInitialVolume(): void\n\t{\n\t\tconst hasVolumePanel = !BX.Type.isNil(this.vjsPlayer.controlBar.getChild('VolumePanel'));\n\t\tif (hasVolumePanel)\n\t\t{\n\t\t\tconst volume = this.volume === null ? this.constructor.#globalSettings.get('volume', 0.8) : this.volume;\n\t\t\tthis.vjsPlayer.volume(volume);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst volume = this.volume === null ? 0.8 : this.volume;\n\t\t\tthis.vjsPlayer.volume(volume);\n\t\t}\n\t}\n\n\t#handleClick(event: MouseEvent): void\n\t{\n\t\tthis.toggle();\n\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t}\n\n\t#handleKeyDown(event: KeyboardEvent): void\n\t{\n\t\tconst beforeKeyDownEvent = new BaseEvent({ event });\n\t\tthis.#fireEvent('onBeforeKeyDown', beforeKeyDownEvent);\n\t\tif (beforeKeyDownEvent.isDefaultPrevented())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tswitch (event.code)\n\t\t{\n\t\t\tcase 'KeyK':\n\t\t\tcase 'Space':\n\t\t\t{\n\t\t\t\tthis.toggle();\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopPropagation();\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'KeyF':\n\t\t\t{\n\t\t\t\tif (!this.isAudio)\n\t\t\t\t{\n\t\t\t\t\tif (this.vjsPlayer.isFullscreen())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.vjsPlayer.exitFullscreen();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.vjsPlayer.requestFullscreen();\n\t\t\t\t\t}\n\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'KeyJ':\n\t\t\t{\n\t\t\t\tthis.moveBackward(10);\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopPropagation();\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'KeyL':\n\t\t\t{\n\t\t\t\tthis.moveForward(10);\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopPropagation();\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'ArrowLeft':\n\t\t\t{\n\t\t\t\tthis.moveBackward(5);\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopPropagation();\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'ArrowRight':\n\t\t\t{\n\t\t\t\tthis.moveForward(5);\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopPropagation();\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'KeyM':\n\t\t\t{\n\t\t\t\tif (this.isMuted())\n\t\t\t\t{\n\t\t\t\t\tthis.mute(false);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.mute(true);\n\t\t\t\t}\n\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopPropagation();\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'Comma':\n\t\t\t{\n\t\t\t\tthis.decreasePlaybackRate();\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopPropagation();\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'Period':\n\t\t\t{\n\t\t\t\tthis.increasePlaybackRate();\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopPropagation();\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tdefault: {\n\t\t\t\t// nothing\n\t\t\t}\n\t\t}\n\n\t\tthis.#fireEvent('onKeyDown', new BaseEvent({ event }));\n\t}\n\n\t#fireEvent(eventName: string, event): void\n\t{\n\t\tif (Type.isStringFilled(eventName))\n\t\t{\n\t\t\tconst fullName = `Player:${eventName}`;\n\n\t\t\tconst compatEvent = event || new BaseEvent();\n\t\t\tcompatEvent.setCompatData([this, fullName]);\n\n\t\t\tEvent.EventEmitter.emit(this, fullName, compatEvent);\n\t\t}\n\t}\n\n\t#proxyEvents()\n\t{\n\t\tthis.vjsPlayer.on('play', () => {\n\t\t\tthis.#fireEvent('onPlay');\n\t\t\tthis.hasStarted = true;\n\t\t});\n\n\t\tthis.vjsPlayer.on('pause', () => {\n\t\t\tthis.#fireEvent('onPause');\n\t\t});\n\n\t\tthis.vjsPlayer.on('click', () => {\n\t\t\tthis.active = true;\n\t\t\tthis.#fireEvent('onClick');\n\t\t});\n\n\t\tthis.vjsPlayer.on('ended', () => {\n\t\t\tthis.#fireEvent('onEnded');\n\t\t});\n\n\t\tthis.vjsPlayer.on('error', () => {\n\t\t\tthis.#fireEvent('onError');\n\t\t});\n\n\t\tthis.vjsPlayer.on('enterpictureinpicture', () => {\n\t\t\tthis.#fireEvent('onEnterPictureInPicture');\n\t\t});\n\n\t\tthis.vjsPlayer.on('leavepictureinpicture', () => {\n\t\t\tconst event = new BaseEvent();\n\t\t\tthis.#fireEvent('onLeavePictureInPicture', event);\n\n\t\t\tif (!event.isDefaultPrevented())\n\t\t\t{\n\t\t\t\tconst visible = PlayerManager.isVisibleOnScreen(this.id, 1);\n\t\t\t\tif (!visible)\n\t\t\t\t{\n\t\t\t\t\tthis.pause();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tdestroy()\n\t{\n\t\tPlayerManager.removePlayer(this);\n\n\t\tthis.vjsPlayer.dispose();\n\t\tthis.vjsPlayer = null;\n\t}\n}\n","import { Reflection } from 'main.core';\nimport { Player } from './player';\nimport { PlayerManager } from './player-manager';\n\nimport './css/player.css';\nimport './css/audio-wave-skin.css';\n\n// compatibility\nconst filemanNS = Reflection.namespace('BX.Fileman');\nfilemanNS.Player = Player;\nfilemanNS.PlayerManager = PlayerManager;\n\nexport {\n\tPlayer,\n\tPlayerManager,\n};\n"],"names":["GlobalSettings","constructor","localStorageKey","get","option","defaultValue","Type","isUndefined","set","value","queueMicrotask","window","localStorage","setItem","JSON","stringify","parse","getItem","PlayerManager","addPlayer","player","push","autostart","lazyload","removePlayer","playerToRemove","filter","getElementCoords","element","VISIBLE_OFFSET","box","getBoundingClientRect","elementHeight","bottom","top","elementWidth","right","left","pageYOffset","pageXOffset","originTop","originLeft","originBottom","originRight","isVisibleOnScreen","id","screens","visible","document","getElementById","coords","clientHeight","documentElement","windowTop","scrollTop","windowBottom","numberOfScreens","parseInt","topVisible","bottomVisible","onScreen","playerElement","playerCenterX","playerCenterY","currentPlayerCenterElement","elementFromPoint","parentNode","getPlayerById","isStringFilled","Event","ready","bind","Runtime","throttle","setTimeout","sliderManager","Reflection","getClass","currentSlider","getSliderByWindow","EventEmitter","subscribe","forEach","pause","events","getEventList","eventName","emit","BaseEvent","compatData","length","topVisiblePlayer","isAnyPlaying","players","index","entries","splice","inited","init","active","isEnded","isPlaying","isReady","mute","subscribeOnce","event","play","langSetup","videojs","hook","videoEl","options","Dom","addClass","tagName","toLowerCase","addLanguage","Play","Loc","getMessage","Pause","Replay","Duration","Loaded","Progress","Fullscreen","Mute","Unmute","Player","params","muted","hasStarted","vjsPlayer","isAudio","isReady_","setPlayedState","toggle","paused","ended","storageHash","isPlayed","getElement","createElement","node","classes","className","join","skin","attrs","width","height","controls","create","isArrayFilled","sources","source","src","type","sourceTag","append","setSource","getSource","dispose","on","focus","duration","one","controlBar","getChild","playbackButton","off","menuButton_","el","isFunction","onInit","isInited","isMuted","moveBackward","skipTime","currentVideoTime","currentTime","liveTracker","seekableStart","isLive","newTime","moveForward","isNumber","seekableEnd","increasePlaybackRate","playbackRates","currentPlayback","playbackRate","nextPlayback","find","decreasePlaybackRate","reverse","prevPlayback","destroy","defaults","isPlainObject","techOrder","tech","parseFloat","volume","BX","startTime","audioOnlyMode","Math","max","language","userActions","click","hotkeys","removeChild","hasVolumePanel","isNil","preventDefault","stopPropagation","beforeKeyDownEvent","isDefaultPrevented","code","isFullscreen","exitFullscreen","requestFullscreen","fullName","compatEvent","setCompatData","filemanNS","namespace"],"mappings":"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"}