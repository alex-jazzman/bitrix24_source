this.BX=this.BX||{};this.BX.UI=this.BX.UI||{};(function(e,s,t,a){"use strict";var i=babelHelpers.classPrivateFieldLooseKey("options");var l=babelHelpers.classPrivateFieldLooseKey("localStorageKey");var r=babelHelpers.classPrivateFieldLooseKey("batchStarted");var o=babelHelpers.classPrivateFieldLooseKey("init");class n{constructor(e){Object.defineProperty(this,o,{value:c});Object.defineProperty(this,i,{writable:true,value:null});Object.defineProperty(this,l,{writable:true,value:null});Object.defineProperty(this,r,{writable:true,value:false});babelHelpers.classPrivateFieldLooseBase(this,l)[l]=e}get(e,s){babelHelpers.classPrivateFieldLooseBase(this,o)[o]();if(!t.Type.isUndefined(babelHelpers.classPrivateFieldLooseBase(this,i)[i][e])){return babelHelpers.classPrivateFieldLooseBase(this,i)[i][e]}if(!t.Type.isUndefined(s)){return s}return null}set(e,s){babelHelpers.classPrivateFieldLooseBase(this,o)[o]();babelHelpers.classPrivateFieldLooseBase(this,i)[i][e]=s;if(!babelHelpers.classPrivateFieldLooseBase(this,r)[r]){babelHelpers.classPrivateFieldLooseBase(this,r)[r]=true;queueMicrotask((()=>{babelHelpers.classPrivateFieldLooseBase(this,r)[r]=false;window.localStorage.setItem(babelHelpers.classPrivateFieldLooseBase(this,l)[l],JSON.stringify(babelHelpers.classPrivateFieldLooseBase(this,i)[i]))}))}}}function c(){if(babelHelpers.classPrivateFieldLooseBase(this,i)[i]===null){babelHelpers.classPrivateFieldLooseBase(this,i)[i]=JSON.parse(window.localStorage.getItem(babelHelpers.classPrivateFieldLooseBase(this,l)[l]))||{}}}var d=babelHelpers.classPrivateFieldLooseKey("isStarted");var h=babelHelpers.classPrivateFieldLooseKey("players");var u=babelHelpers.classPrivateFieldLooseKey("init");var v=babelHelpers.classPrivateFieldLooseKey("bindPlayerEvents");var P=babelHelpers.classPrivateFieldLooseKey("handleScroll");class y{static addPlayer(e){babelHelpers.classPrivateFieldLooseBase(this,h)[h].push(e);babelHelpers.classPrivateFieldLooseBase(this,v)[v](e);if(e.autostart||e.lazyload){babelHelpers.classPrivateFieldLooseBase(this,u)[u]()}}static removePlayer(e){babelHelpers.classPrivateFieldLooseBase(this,h)[h]=babelHelpers.classPrivateFieldLooseBase(this,h)[h].filter((s=>s!==e))}static getElementCoords(e){const s=.25;const t=e.getBoundingClientRect();const a=t.bottom-t.top;const i=t.top+s*a;const l=t.bottom-s*a;const r=t.right-t.left;const o=t.left+s*r;const n=t.right-s*r;return{top:i+window.pageYOffset,bottom:l+window.pageYOffset,left:o+window.pageXOffset,right:n+window.pageXOffset,originTop:i,originLeft:o,originBottom:l,originRight:n}}static isVisibleOnScreen(e,s){let t=false;const a=document.getElementById(e);if(a===null){return false}const i=this.getElementCoords(a);const l=document.documentElement.clientHeight;let r=window.pageYOffset||document.documentElement.scrollTop;let o=r+l;const n=s?parseInt(s,10):1;if(n>1){r-=l*(n-1);o+=l*(n-1)}const c=i.top>r&&i.top<o;const d=i.bottom<o&&i.bottom>r;const h=c||d;if(h&&s>1){return true}if(!h){return false}const u=document.getElementById(e);const v=i.originLeft+(i.originRight-i.originLeft)/2;const P=i.originTop+(i.originBottom-i.originTop)/2+20;const y=document.elementFromPoint(v,P);if(y!==null&&(y===u||y.parentNode===u||y.parentNode.parentNode===u)){t=true}return h&&t}static getPlayerById(e){if(!t.Type.isStringFilled(e)){return null}for(const s of babelHelpers.classPrivateFieldLooseBase(this,h)[h]){if(s.id===e){return s}}return null}}function p(){if(babelHelpers.classPrivateFieldLooseBase(this,d)[d]){return}babelHelpers.classPrivateFieldLooseBase(this,d)[d]=true;t.Event.ready((()=>{t.Event.bind(window,"scroll",t.Runtime.throttle(babelHelpers.classPrivateFieldLooseBase(this,P)[P],300,this));setTimeout((()=>{babelHelpers.classPrivateFieldLooseBase(this,P)[P]()}),50);const e=t.Reflection.getClass("top.BX.SidePanel.Instance");if(window!==window.top&&e!==null){const s=e.getSliderByWindow(window);if(s){t.Event.EventEmitter.subscribe(s,"SidePanel.Slider:onCloseComplete",(()=>{babelHelpers.classPrivateFieldLooseBase(this,h)[h].forEach((e=>{e.pause()}))}))}}}))}function b(e){const s=e.getEventList();for(const i of s){t.Event.EventEmitter.subscribe(e,i,(()=>{t.Event.EventEmitter.emit(this,`PlayerManager.${i}`,new a.BaseEvent({compatData:[e]}))}))}}function f(){if(babelHelpers.classPrivateFieldLooseBase(this,h)[h].length===0){return}let e=false;let s=false;const a=[...babelHelpers.classPrivateFieldLooseBase(this,h)[h]];for(const[t,i]of a.entries()){if(!document.getElementById(i.id)){babelHelpers.classPrivateFieldLooseBase(this,h)[h].splice(t,1);continue}if(i.lazyload&&!i.inited&&this.isVisibleOnScreen(i.id,2)){i.init()}if(!i.autostart){continue}if(i.active){continue}if(i.isEnded()){continue}if(this.isVisibleOnScreen(i.id,1)){if(e===false){e=i}}else if(i.isPlaying()){i.pause()}if(i.isPlaying()){s=true}}if(s){return}if(e!==false){if(!e.inited){e.autostart=true}else if(e.isReady()&&!e.isEnded()){e.mute(true);t.Event.EventEmitter.subscribeOnce(e,"Player:onClick",(s=>{setTimeout((()=>{e.mute(false)}),100)}));e.play()}}}Object.defineProperty(y,P,{value:f});Object.defineProperty(y,v,{value:b});Object.defineProperty(y,u,{value:p});Object.defineProperty(y,d,{writable:true,value:void 0});Object.defineProperty(y,h,{writable:true,value:[]});let g=false;s.videojs.hook("beforesetup",((e,a)=>{t.Dom.addClass(e,"ui-video-player ui-icon-set__scope");if(e.tagName.toLowerCase()==="audio"){t.Dom.addClass(e,"vjs-audio-only-mode")}if(g===false){s.videojs.addLanguage("video-player",{Play:t.Loc.getMessage("VIDEO_PLAYER_PLAY"),Pause:t.Loc.getMessage("VIDEO_PLAYER_PAUSE"),Replay:t.Loc.getMessage("VIDEO_PLAYER_REPLAY"),"Current Time":t.Loc.getMessage("VIDEO_PLAYER_CURRENT_TIME"),Duration:t.Loc.getMessage("VIDEO_PLAYER_DURATION"),"Remaining Time":t.Loc.getMessage("VIDEO_PLAYER_REMAINING_TIME"),Loaded:t.Loc.getMessage("VIDEO_PLAYER_LOADED"),Progress:t.Loc.getMessage("VIDEO_PLAYER_PROGRESS"),"Progress Bar":t.Loc.getMessage("VIDEO_PLAYER_PROGRESS_BAR"),Fullscreen:t.Loc.getMessage("VIDEO_PLAYER_FULLSCREEN"),"Exit Fullscreen":t.Loc.getMessage("VIDEO_PLAYER_EXIT_FULLSCREEN"),Mute:t.Loc.getMessage("VIDEO_PLAYER_MUTE"),Unmute:t.Loc.getMessage("VIDEO_PLAYER_UNMUTE"),"Playback Rate":t.Loc.getMessage("VIDEO_PLAYER_PLAYBACK_RATE"),"Volume Level":t.Loc.getMessage("VIDEO_PLAYER_VOLUME_LEVEL"),"You aborted the media playback":t.Loc.getMessage("VIDEO_PLAYER_ABORTED_PLAYBACK"),"A network error caused the media download to fail part-way.":t.Loc.getMessage("VIDEO_PLAYER_NETWORK_ERROR"),"The media could not be loaded, either because the server or network failed or because the format is not supported.":t.Loc.getMessage("VIDEO_PLAYER_FORMAT_NOT_SUPPORTED"),"The media playback was aborted due to a corruption problem or because the media used features your browser did not support.":t.Loc.getMessage("VIDEO_PLAYER_PLAYBACK_WAS_ABORTED"),"No compatible source was found for this media.":t.Loc.getMessage("VIDEO_PLAYER_NO_COMPATIBLE_SOURCE"),"The media is encrypted and we do not have the keys to decrypt it.":t.Loc.getMessage("VIDEO_PLAYER_MEDIA_IS_ENCRYPTED"),"Play Video":t.Loc.getMessage("VIDEO_PLAYER_PLAY_VIDEO"),"Exit Picture-in-Picture":t.Loc.getMessage("VIDEO_PLAYER_EXIT_PICTURE_IN_PICTURE"),"Picture-in-Picture":t.Loc.getMessage("VIDEO_PLAYER_PICTURE_IN_PICTURE")});g=true}return a}));var L=babelHelpers.classPrivateFieldLooseKey("globalSettings");var m=babelHelpers.classPrivateFieldLooseKey("getStorageHash");var E=babelHelpers.classPrivateFieldLooseKey("fillParameters");var B=babelHelpers.classPrivateFieldLooseKey("getDefaultOptions");var j=babelHelpers.classPrivateFieldLooseKey("hideAudioControls");var F=babelHelpers.classPrivateFieldLooseKey("handlePlayOnce");var R=babelHelpers.classPrivateFieldLooseKey("setInitialVolume");var O=babelHelpers.classPrivateFieldLooseKey("handleClick");var H=babelHelpers.classPrivateFieldLooseKey("handleKeyDown");var _=babelHelpers.classPrivateFieldLooseKey("fireEvent");var I=babelHelpers.classPrivateFieldLooseKey("proxyEvents");class w{constructor(e,s){Object.defineProperty(this,I,{value:Y});Object.defineProperty(this,_,{value:K});Object.defineProperty(this,H,{value:V});Object.defineProperty(this,O,{value:M});Object.defineProperty(this,R,{value:S});Object.defineProperty(this,F,{value:C});Object.defineProperty(this,j,{value:D});Object.defineProperty(this,B,{value:T});Object.defineProperty(this,E,{value:A});Object.defineProperty(this,m,{value:k});this.inited=false;this.id=null;this.muted=false;this.hasStarted=false;this.vjsPlayer=null;this.isAudio=false;this.id=e;babelHelpers.classPrivateFieldLooseBase(this,E)[E](s);y.addPlayer(this);babelHelpers.classPrivateFieldLooseBase(this,_)[_]("onCreate")}isReady(){return this.vjsPlayer&&this.vjsPlayer.isReady_}play(){this.setPlayedState();this.hasStarted=true;try{this.vjsPlayer.play()}catch{}babelHelpers.classPrivateFieldLooseBase(this,_)[_]("onPlay")}pause(){try{this.vjsPlayer.pause()}catch{}babelHelpers.classPrivateFieldLooseBase(this,_)[_]("onPause")}toggle(){if(this.isPlaying()){this.pause()}else{this.play()}}isPlaying(){if(this.vjsPlayer){return this.isReady()&&!this.vjsPlayer.paused()}return false}isEnded(){if(this.vjsPlayer){return this.vjsPlayer.ended()}return false}setPlayedState(){const e=babelHelpers.classPrivateFieldLooseBase(this,m)[m]();const s=t.Reflection.getClass("BX.localStorage");if(s){s.set(e,"played",14*24*3600)}}isPlayed(){const e=babelHelpers.classPrivateFieldLooseBase(this,m)[m]();const s=t.Reflection.getClass("BX.localStorage");if(s){return s.get(e)==="played"}return true}getElement(){return document.getElementById(this.id)}createElement(){let e=this.getElement();if(e){return e}if(!this.id){return null}let s="video";const a=["video-js","ui-video-player","ui-icon-set__scope"];if(this.isAudio){s="audio";a.push("vjs-audio-only-mode")}let i=a.join(" ");if(this.skin){i+=` ${this.skin}`}const l={id:this.id,className:i,width:this.width,height:this.height,controls:true};if(this.muted){l.muted=true}e=t.Dom.create(s,{attrs:l});if(t.Type.isArrayFilled(this.params.sources)){for(const s of this.params.sources){if(!s.src||!s.type){continue}const a=t.Dom.create("source",{attrs:{src:s.src,type:s.type}});t.Dom.append(a,e)}}return e}setSource(e){if(!e){return}this.vjsPlayer.src(e);babelHelpers.classPrivateFieldLooseBase(this,_)[_]("onSetSource")}getSource(){return this.vjsPlayer.src()}init(){if(this.vjsPlayer!==null){return}babelHelpers.classPrivateFieldLooseBase(this,_)[_]("onBeforeInit");if(s.videojs.players[this.id]){s.videojs.players[this.id].dispose()}this.vjsPlayer=s.videojs(this.id,this.params);if(this.isAudio){babelHelpers.classPrivateFieldLooseBase(this,j)[j]();babelHelpers.classPrivateFieldLooseBase(this,R)[R]()}this.vjsPlayer.on("fullscreenchange",(()=>{this.vjsPlayer.focus()}));if(this.duration>0){this.vjsPlayer.one("loadedmetadata",(()=>{this.vjsPlayer.duration(this.duration)}))}babelHelpers.classPrivateFieldLooseBase(this,I)[I]();this.vjsPlayer.ready((()=>{const e=this.vjsPlayer.getChild("ControlBar");const a=e.getChild("PlaybackRateMenuButton");if(a){s.videojs.off(a.menuButton_.el(),"mouseenter");s.videojs.off(a.el(),"mouseleave")}this.vjsPlayer.one("play",babelHelpers.classPrivateFieldLooseBase(this,F)[F].bind(this));this.inited=true;if(t.Type.isFunction(this.onInit)){this.onInit(this)}babelHelpers.classPrivateFieldLooseBase(this,_)[_]("onAfterInit");if(this.autostart&&!this.lazyload){setTimeout((()=>{if(!this.hasStarted){this.play()}}),200)}}))}isInited(){return this.vjsPlayer!==null}getEventList(){return["Player:onBeforeInit","Player:onAfterInit","Player:onCreate","Player:onSetSource","Player:onKeyDown","Player:onPlay","Player:onPause","Player:onClick","Player:onError","Player:onEnded","Player:onEnterPictureInPicture","Player:onLeavePictureInPicture"]}mute(e){var s;return(s=this.vjsPlayer)==null?void 0:s.muted(e)}isMuted(){var e;return(e=this.vjsPlayer)==null?void 0:e.muted()}focus(){var e;(e=this.vjsPlayer)==null?void 0:e.focus()}moveBackward(e){const s=this.vjsPlayer.currentTime();const t=this.vjsPlayer.liveTracker;const a=t&&t.isLive()&&t.seekableStart();let i=0;if(a&&s-e<=a){i=a}else if(s>=e){i=s-e}this.vjsPlayer.currentTime(i)}moveForward(e){if(!t.Type.isNumber(this.vjsPlayer.duration())){return}const s=this.vjsPlayer.currentTime();const a=this.vjsPlayer.liveTracker;const i=a&&a.isLive()?a.seekableEnd():this.vjsPlayer.duration();const l=s+e<=i?s+e:i;this.vjsPlayer.currentTime(l)}increasePlaybackRate(){const e=this.vjsPlayer.playbackRates();const s=this.vjsPlayer.playbackRate();const t=e.find((e=>e>s));if(t){this.vjsPlayer.playbackRate(t)}}decreasePlaybackRate(){const e=[...this.vjsPlayer.playbackRates()].reverse();const s=this.vjsPlayer.playbackRate();const t=e.find((e=>e<s));if(t){this.vjsPlayer.playbackRate(t)}}destroy(){y.removePlayer(this);this.vjsPlayer.dispose();this.vjsPlayer=null}}function k(){let e=this.id;if(t.Type.isArrayFilled(this.params.sources)&&this.params.sources[0].src){e=this.params.sources[0].src}return`player_${e}`}function A(e){const s=babelHelpers.classPrivateFieldLooseBase(this,B)[B]();const a=t.Type.isPlainObject(e)?{...s,...e}:s;if(t.Type.isArrayFilled(a.techOrder)){a.techOrder=a.techOrder.filter((e=>e!=="flash"))}this.autostart=a.autostart||false;if(a.playbackRate){a.playbackRate=parseFloat(a.playbackRate);if(a.playbackRate!==1){if(a.playbackRate<=0){a.playbackRate=1}if(a.playbackRate>3){a.playbackRate=3}}if(a.playbackRate!==1){this.playbackRate=a.playbackRate}}this.volume=BX.Type.isNumber(a.volume)?a.volume:null;this.startTime=a.startTime||0;this.onInit=a.onInit;this.lazyload=a.lazyload;this.skin=a.skin||"";this.isAudio=a.isAudio||false;if(this.isAudio){a.width=a.width||400;a.height=a.height||30;a.audioOnlyMode=true}else{a.width=Math.max(a.width||560,400);a.height=Math.max(a.height||315,130)}this.width=a.width;this.height=a.height;this.duration=a.duration||null;this.muted=a.muted||false;this.params=a;this.active=this.isPlayed()}function T(){return{controls:true,playbackRates:[.5,1,1.25,1.5,1.75,2],language:"video-player",userActions:{click:babelHelpers.classPrivateFieldLooseBase(this,O)[O].bind(this),hotkeys:babelHelpers.classPrivateFieldLooseBase(this,H)[H].bind(this)}}}function D(){this.vjsPlayer.removeChild("BigPlayButton");this.vjsPlayer.removeChild("TextTrackSettings");this.vjsPlayer.removeChild("PosterImage");this.vjsPlayer.controlBar.removeChild("FullscreenToggle");this.vjsPlayer.controlBar.removeChild("PictureInPictureToggle");this.vjsPlayer.controlBar.removeChild("ChaptersButton");this.vjsPlayer.controlBar.removeChild("DescriptionsButton");if(this.skin==="vjs-audio-wave-skin"||this.skin==="vjs-viewer-audio-player-skin"){this.vjsPlayer.removeChild("VolumePanel");this.vjsPlayer.controlBar.removeChild("VolumePanel");this.vjsPlayer.controlBar.removeChild("CurrentTimeDisplay");this.vjsPlayer.controlBar.removeChild("PlaybackRateMenuButton")}}function C(){if(this.playbackRate!==1){this.vjsPlayer.playbackRate(this.playbackRate)}babelHelpers.classPrivateFieldLooseBase(this,R)[R]();if(this.startTime>0){try{this.vjsPlayer.currentTime(this.startTime)}catch{}}this.vjsPlayer.on("volumechange",(()=>{babelHelpers.classPrivateFieldLooseBase(this.constructor,L)[L].set("volume",this.vjsPlayer.volume());this.active=true}))}function S(){const e=!BX.Type.isNil(this.vjsPlayer.controlBar.getChild("VolumePanel"));if(e){const e=this.volume===null?babelHelpers.classPrivateFieldLooseBase(this.constructor,L)[L].get("volume",.8):this.volume;this.vjsPlayer.volume(e)}else{const e=this.volume===null?.8:this.volume;this.vjsPlayer.volume(e)}}function M(e){this.toggle();e.preventDefault();e.stopPropagation()}function V(e){const s=new a.BaseEvent({event:e});babelHelpers.classPrivateFieldLooseBase(this,_)[_]("onBeforeKeyDown",s);if(s.isDefaultPrevented()){return}switch(e.code){case"KeyK":case"Space":{this.toggle();e.preventDefault();e.stopPropagation();break}case"KeyF":{if(!this.isAudio){if(this.vjsPlayer.isFullscreen()){this.vjsPlayer.exitFullscreen()}else{this.vjsPlayer.requestFullscreen()}e.preventDefault();e.stopPropagation()}break}case"KeyJ":{this.moveBackward(10);e.preventDefault();e.stopPropagation();break}case"KeyL":{this.moveForward(10);e.preventDefault();e.stopPropagation();break}case"ArrowLeft":{this.moveBackward(5);e.preventDefault();e.stopPropagation();break}case"ArrowRight":{this.moveForward(5);e.preventDefault();e.stopPropagation();break}case"KeyM":{if(this.isMuted()){this.mute(false)}else{this.mute(true)}e.preventDefault();e.stopPropagation();break}case"Comma":{this.decreasePlaybackRate();e.preventDefault();e.stopPropagation();break}case"Period":{this.increasePlaybackRate();e.preventDefault();e.stopPropagation();break}default:}babelHelpers.classPrivateFieldLooseBase(this,_)[_]("onKeyDown",new a.BaseEvent({event:e}))}function K(e,s){if(t.Type.isStringFilled(e)){const i=`Player:${e}`;const l=s||new a.BaseEvent;l.setCompatData([this,i]);t.Event.EventEmitter.emit(this,i,l)}}function Y(){this.vjsPlayer.on("play",(()=>{babelHelpers.classPrivateFieldLooseBase(this,_)[_]("onPlay");this.hasStarted=true}));this.vjsPlayer.on("pause",(()=>{babelHelpers.classPrivateFieldLooseBase(this,_)[_]("onPause")}));this.vjsPlayer.on("click",(()=>{this.active=true;babelHelpers.classPrivateFieldLooseBase(this,_)[_]("onClick")}));this.vjsPlayer.on("ended",(()=>{babelHelpers.classPrivateFieldLooseBase(this,_)[_]("onEnded")}));this.vjsPlayer.on("error",(()=>{babelHelpers.classPrivateFieldLooseBase(this,_)[_]("onError")}));this.vjsPlayer.on("enterpictureinpicture",(()=>{babelHelpers.classPrivateFieldLooseBase(this,_)[_]("onEnterPictureInPicture")}));this.vjsPlayer.on("leavepictureinpicture",(()=>{const e=new a.BaseEvent;babelHelpers.classPrivateFieldLooseBase(this,_)[_]("onLeavePictureInPicture",e);if(!e.isDefaultPrevented()){const e=y.isVisibleOnScreen(this.id,1);if(!e){this.pause()}}}))}Object.defineProperty(w,L,{writable:true,value:new n("bx-video-player-settings")});const N=t.Reflection.namespace("BX.Fileman");N.Player=w;N.PlayerManager=y;e.Player=w;e.PlayerManager=y})(this.BX.UI.VideoPlayer=this.BX.UI.VideoPlayer||{},window,BX,BX.Event);
//# sourceMappingURL=video-player.bundle.map.js