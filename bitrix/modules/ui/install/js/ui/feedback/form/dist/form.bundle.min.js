this.BX=this.BX||{};this.BX.UI=this.BX.UI||{};(function(e,t){"use strict";var s=babelHelpers.classPrivateFieldLooseKey("list");var i=babelHelpers.classPrivateFieldLooseKey("loadedList");var a=babelHelpers.classPrivateFieldLooseKey("opened");var o=babelHelpers.classPrivateFieldLooseKey("loadInline");var l=babelHelpers.classPrivateFieldLooseKey("appendFormToSlider");var r=babelHelpers.classPrivateFieldLooseKey("getContainerNode");var n=babelHelpers.classPrivateFieldLooseKey("appendPresets");var d=babelHelpers.classPrivateFieldLooseKey("appendFormScript");var c=babelHelpers.classPrivateFieldLooseKey("handleB24FormInit");class p{static getList(){return babelHelpers.classPrivateFieldLooseBase(p,s)[s]}static getById(e){return babelHelpers.classPrivateFieldLooseBase(p,s)[s].find((t=>t.id===e))||null}static open(e){if(babelHelpers.classPrivateFieldLooseBase(p,a)[a]){return}const t=e.id;const s=babelHelpers.classPrivateFieldLooseBase(p,i)[i][t];if(s){s.openPanel();return}const o=new p({map:e});babelHelpers.classPrivateFieldLooseBase(p,i)[i][e.id]=o;o.openPanel()}constructor(e){Object.defineProperty(this,c,{value:v});Object.defineProperty(this,d,{value:m});Object.defineProperty(this,n,{value:u});Object.defineProperty(this,r,{value:f});Object.defineProperty(this,l,{value:b});Object.defineProperty(this,o,{value:h});this.init(e);babelHelpers.classPrivateFieldLooseBase(p,s)[s].push(this)}init(e){this.cached=false;if(e.map!==undefined){this.map=e.map;return}this.id=e.id;this.portal=e.portal;this.presets=e.presets||{};this.form=e.form||{};this.title=e.title||"";this.showTitle=t.Type.isBoolean(e.showTitle)?e.showTitle:true;if(e.button){this.button=BX(e.button);t.Event.bind(this.button,"click",this.openPanel.bind(this))}else if(e.node){this.node=BX(e.node);babelHelpers.classPrivateFieldLooseBase(this,o)[o]()}}openPanel(){babelHelpers.classPrivateFieldLooseBase(p,a)[a]=true;BX.SidePanel.Instance.open(`ui:feedback-form-${this.id}`,{cacheable:false,contentCallback:()=>Promise.resolve(),animationDuration:200,events:{onLoad:this.checkSidePanelLoad.bind(this),onBeforeCloseComplete:this.checkSidePanelClosed.bind(this)},width:600})}checkSidePanelClosed(){babelHelpers.classPrivateFieldLooseBase(p,a)[a]=false}checkSidePanelLoad(e){if(this.map&&this.cached===false){t.ajax.runAction("ui.feedback.loadData",{json:{title:this.map.title||null,id:this.map.id||null,presets:this.map.presets||null,portalUri:this.map.portalUri||null,forms:this.map.forms||null,defaultForm:this.map.defaultForm||null}}).then((t=>{const s=t.data.params;this.id=s.id;this.title=s.title;this.form=s.form;this.presets=s.presets;this.portal=s.portal;this.cached=true;this.onSidePanelLoad(e)})).catch((e=>{console.error(e)}));return}this.onSidePanelLoad(e)}onSidePanelLoad(e){const t=e.getSlider();if(!t){return}babelHelpers.classPrivateFieldLooseBase(this,l)[l](t);setTimeout((()=>{t.showLoader()}),0);this.loadForm(this.checkLoader.bind(this,t))}checkLoader(e){setTimeout((()=>{e.closeLoader()}),100)}loadForm(e=null){const s=this.form;if(!s||!s.id||!s.lang||!s.sec){return}if(s.presets){babelHelpers.classPrivateFieldLooseBase(this,n)[n](s.presets)}const i=`b24form${this.id}`;babelHelpers.classPrivateFieldLooseBase(this,d)[d](`${this.portal}/bitrix/js/crm/form_loader.js`,i);t.Event.bind(top,"b24:form:init",babelHelpers.classPrivateFieldLooseBase(this,c)[c]);top[i]({id:s.id,lang:s.lang,sec:s.sec,type:"inline",node:this.formNode,presets:this.presets,handlers:{load:e||(()=>{})}})}}function h(){if(!this.node){return}t.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,r)[r](true),this.node);this.loadForm()}function b(e){if(!e){return}t.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,r)[r](),e.layout.content)}function f(e=false){this.formNode=t.Dom.create("div");const s=t.Dom.create("div",{style:{marginBottom:"25px",font:"26px/26px var(--ui-font-family-primary, var(--ui-font-family-helvetica))",color:"var(--ui-color-text-primary)"},text:this.title});const i=e?null:{padding:"20px",overflowY:"auto"};return t.Dom.create("div",{style:i,children:[this.showTitle?s:null,this.formNode]})}function u(e){Object.entries(e).forEach((([e,t])=>{this.presets[e]=t}))}function m(e,s){top.Bitrix24FormObject=s;top[s]=top[s]||function(){arguments[0].ref=e;(top[s].forms=top[s].forms||[]).push(arguments[0])};if(top[s].forms){return}const i=top.document.createElement("script");const a=Date.now();i.async=1;i.src=`${e}?${a}`;const o=top.document.getElementsByTagName("script")[0];t.Dom.insertBefore(i,o)}function v(e){const t=e.detail.object;t.design.setFont("var(--ui-font-family-primary),var(--ui-font-family-helvetica)")}Object.defineProperty(p,s,{writable:true,value:[]});Object.defineProperty(p,i,{writable:true,value:{}});Object.defineProperty(p,a,{writable:true,value:false});e.Form=p})(this.BX.UI.Feedback=this.BX.UI.Feedback||{},BX);
//# sourceMappingURL=form.bundle.map.js