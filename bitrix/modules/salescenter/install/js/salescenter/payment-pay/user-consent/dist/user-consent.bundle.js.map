{"version":3,"file":"user-consent.bundle.js","sources":["../src/user-consent.js"],"sourcesContent":["import { EventEmitter } from 'main.core.events';\nimport { EventType } from 'sale.payment-pay.const';\n\nexport class UserConsent\n{\n\t/**\n\t * @public\n\t * @param {object} options\n\t */\n\tconstructor(options)\n\t{\n\t\tthis.options = options || {};\n\n\t\tthis.eventName = this.option('eventName', false);\n\t\tthis.items = this.option('items', []);\n\t\tthis.preselectedConsentsIsSubmitted = false;\n\t\tthis.setCallback(null);\n\n\t\tthis.subscribeToEvents();\n\t}\n\n\tsetCallback(callback): void\n\t{\n\t\tthis.callback = callback;\n\t}\n\n\trunCallback(): void\n\t{\n\t\tif (this.callback)\n\t\t{\n\t\t\tthis.callback();\n\t\t}\n\t\tthis.setCallback(null);\n\t}\n\n\t/**\n\t * @private\n\t */\n\tsubscribeToEvents()\n\t{\n\t\tEventEmitter.subscribe(EventType.consent.accepted, (event) => {\n\t\t\tconst currentId = event.getData()[0].config.id;\n\t\t\tconst currentItem = this.getItemById(currentId);\n\t\t\tif (currentItem)\n\t\t\t{\n\t\t\t\tcurrentItem.checked = 'Y';\n\t\t\t}\n\n\t\t\tconst firstRequiredUncheckedItem = this.getFirstRequiredUncheckedItem();\n\t\t\tif (firstRequiredUncheckedItem && this.callback)\n\t\t\t{\n\t\t\t\tEventEmitter.emit(`${this.eventName}-${firstRequiredUncheckedItem.id}`);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.runCallback();\n\t\t});\n\t\tEventEmitter.subscribe(EventType.consent.refused, (event) => {\n\t\t\tconst currentId = event.getData()[0].config.id;\n\t\t\tconst currentItem = this.getItemById(currentId);\n\t\t\tif (currentItem)\n\t\t\t{\n\t\t\t\tcurrentItem.checked = 'N';\n\t\t\t}\n\n\t\t\tthis.setCallback(null);\n\t\t});\n\t}\n\n\t/**\n\t * @public\n\t * @returns {boolean}\n\t */\n\tisAvailable(): boolean\n\t{\n\t\treturn BX.UserConsent && this.eventName;\n\t}\n\n\t/**\n\t * @public\n\t * @param callback\n\t */\n\taskUserToPerform(callback): void\n\t{\n\t\tthis.setCallback(callback);\n\t\tif (!this.isAvailable())\n\t\t{\n\t\t\tthis.runCallback();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.preselectedConsentsIsSubmitted)\n\t\t{\n\t\t\tthis.sendEventsForCheckedConsents();\n\t\t\tthis.preselectedConsentsIsSubmitted = true;\n\t\t}\n\n\t\tconst firstRequiredUncheckedItem = this.getFirstRequiredUncheckedItem();\n\t\tif (firstRequiredUncheckedItem)\n\t\t{\n\t\t\tEventEmitter.emit(`${this.eventName}-${firstRequiredUncheckedItem.id}`);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.runCallback();\n\t}\n\n\tsendEventsForCheckedConsents(): void\n\t{\n\t\tthis.items.forEach((item) => {\n\t\t\tif (item.checked === 'Y')\n\t\t\t{\n\t\t\t\tEventEmitter.emit(`${this.eventName}-${item.id}`);\n\t\t\t}\n\t\t});\n\t}\n\n\tgetFirstRequiredUncheckedItem(): ?Object\n\t{\n\t\treturn this.items.find((item) => item.required === 'Y' && item.checked === 'N') ?? null;\n\t}\n\n\tgetItemById(currentId): ?Object\n\t{\n\t\treturn this.items.find((item) => parseInt(item.id, 10) === currentId) ?? null;\n\t}\n\n\t/**\n\t * @private\n\t * @param {string} name\n\t * @param defaultValue\n\t * @returns {*}\n\t */\n\toption(name: string, defaultValue): Object\n\t{\n\t\treturn Object.hasOwn(this.options, name) ? this.options[name] : defaultValue;\n\t}\n}\n"],"names":["UserConsent","options","eventName","option","items","preselectedConsentsIsSubmitted","setCallback","subscribeToEvents","callback","EventEmitter","subscribe","EventType","consent","accepted","event","currentId","getData","config","id","currentItem","getItemById","checked","firstRequiredUncheckedItem","getFirstRequiredUncheckedItem","emit","runCallback","refused","BX","isAvailable","sendEventsForCheckedConsents","forEach","item","find","required","parseInt","name","defaultValue","Object","hasOwn"],"mappings":"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"}