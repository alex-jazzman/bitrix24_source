{"version":3,"file":"backend-provider.bundle.js","sources":["../src/backend-provider.js"],"sourcesContent":["import {ajax, Type} from 'main.core';\nimport {AbstractBackendProvider} from 'sale.payment-pay.lib';\n\nexport class BackendProvider extends AbstractBackendProvider\n{\n\tconstructor(options) {\n\t\tsuper(options);\n\n\t\tthis.returnUrl = this.option('returnUrl', this.getCurrentUrl());\n\t\tthis.orderId = this.option('orderId', null);\n\t\tthis.paymentId = this.option('paymentId', null);\n\t\tthis.accessCode = this.option('accessCode', null);\n\t\tthis.paySystemId = null;\n\t\tthis.response = null;\n\t}\n\n\t/**\n\t * @override\n\t * @returns {Promise}\n\t */\n\tinitiatePayment() {\n\t\tif (!this.paySystemId) {\n\t\t\tthrow new Error('Payment system undefined');\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tajax.runComponentAction(\n\t\t\t\t'bitrix:salescenter.payment.pay',\n\t\t\t\t'initiatePay',\n\t\t\t\t{\n\t\t\t\t\tmode: 'ajax',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tfields: {\n\t\t\t\t\t\t\tpaySystemId: this.paySystemId,\n\t\t\t\t\t\t\treturnUrl: this.returnUrl,\n\t\t\t\t\t\t\torderId: this.orderId,\n\t\t\t\t\t\t\tpaymentId: this.paymentId,\n\t\t\t\t\t\t\taccessCode: this.accessCode,\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t).then((response) => {\n\t\t\t\tthis.response = response;\n\t\t\t\tresolve(this);\n\t\t\t}).catch((error) => {\n\t\t\t\tthis.response = error;\n\t\t\t\tresolve(this);\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * @override\n\t * @returns {object|string|*}\n\t */\n\tgetResponse() {\n\t\treturn this.response;\n\t}\n\n\t/**\n\t * @override\n\t * @returns {boolean}\n\t */\n\tisResponseSucceed() {\n\t\treturn Type.isObject(this.response) && this.response.status === 'success';\n\t}\n\n\t/**\n\t * @override\n\t * @returns {string|null}\n\t */\n\tgetPaymentGateUrl() {\n\t\tif (Type.isObject(this.response.data) && Type.isStringFilled(this.response.data.url)) {\n\t\t\treturn this.response.data.url;\n\t\t}\n\t\treturn null;\n\t}\n\n\t/**\n\t * @override\n\t * @returns {string|null}\n\t */\n\tgetPaymentFormHtml() {\n\t\tif (Type.isObject(this.response.data) && Type.isStringFilled(this.response.data.html)) {\n\t\t\treturn this.response.data.html;\n\t\t}\n\t\treturn null;\n\t}\n\n\t/**\n\t * @private\n\t * @returns {string}\n\t */\n\tgetCurrentUrl() {\n\t\treturn window.location.href;\n\t}\n}\n"],"names":["BackendProvider","options","returnUrl","option","getCurrentUrl","orderId","paymentId","accessCode","paySystemId","response","Error","Promise","resolve","reject","ajax","runComponentAction","mode","data","fields","then","error","Type","isObject","status","isStringFilled","url","html","window","location","href","AbstractBackendProvider"],"mappings":";;;;;;KAGaA,eAAe;GAAA;GAE3B,yBAAYC,OAAO,EAAE;KAAA;KAAA;KACpB,6GAAMA,OAAO;KAEb,MAAKC,SAAS,GAAG,MAAKC,MAAM,CAAC,WAAW,EAAE,MAAKC,aAAa,EAAE,CAAC;KAC/D,MAAKC,OAAO,GAAG,MAAKF,MAAM,CAAC,SAAS,EAAE,IAAI,CAAC;KAC3C,MAAKG,SAAS,GAAG,MAAKH,MAAM,CAAC,WAAW,EAAE,IAAI,CAAC;KAC/C,MAAKI,UAAU,GAAG,MAAKJ,MAAM,CAAC,YAAY,EAAE,IAAI,CAAC;KACjD,MAAKK,WAAW,GAAG,IAAI;KACvB,MAAKC,QAAQ,GAAG,IAAI;KAAC;;;;CAIvB;CACA;CACA;GAHC;KAAA;KAAA,kCAIkB;OAAA;OACjB,IAAI,CAAC,IAAI,CAACD,WAAW,EAAE;SACtB,MAAM,IAAIE,KAAK,CAAC,0BAA0B,CAAC;;OAG5C,OAAO,IAAIC,OAAO,CAAC,UAACC,OAAO,EAAEC,MAAM,EAAK;SACvCC,cAAI,CAACC,kBAAkB,CACtB,gCAAgC,EAChC,aAAa,EACb;WACCC,IAAI,EAAE,MAAM;WACZC,IAAI,EAAE;aACLC,MAAM,EAAE;eACPV,WAAW,EAAE,MAAI,CAACA,WAAW;eAC7BN,SAAS,EAAE,MAAI,CAACA,SAAS;eACzBG,OAAO,EAAE,MAAI,CAACA,OAAO;eACrBC,SAAS,EAAE,MAAI,CAACA,SAAS;eACzBC,UAAU,EAAE,MAAI,CAACA;;;UAGnB,CACD,CAACY,IAAI,CAAC,UAACV,QAAQ,EAAK;WACpB,MAAI,CAACA,QAAQ,GAAGA,QAAQ;WACxBG,OAAO,CAAC,MAAI,CAAC;UACb,CAAC,SAAM,CAAC,UAACQ,KAAK,EAAK;WACnB,MAAI,CAACX,QAAQ,GAAGW,KAAK;WACrBR,OAAO,CAAC,MAAI,CAAC;UACb,CAAC;QACF,CAAC;;;CAIJ;CACA;CACA;;KAHC;KAAA,8BAIc;OACb,OAAO,IAAI,CAACH,QAAQ;;;CAItB;CACA;CACA;;KAHC;KAAA,oCAIoB;OACnB,OAAOY,cAAI,CAACC,QAAQ,CAAC,IAAI,CAACb,QAAQ,CAAC,IAAI,IAAI,CAACA,QAAQ,CAACc,MAAM,KAAK,SAAS;;;CAI3E;CACA;CACA;;KAHC;KAAA,oCAIoB;OACnB,IAAIF,cAAI,CAACC,QAAQ,CAAC,IAAI,CAACb,QAAQ,CAACQ,IAAI,CAAC,IAAII,cAAI,CAACG,cAAc,CAAC,IAAI,CAACf,QAAQ,CAACQ,IAAI,CAACQ,GAAG,CAAC,EAAE;SACrF,OAAO,IAAI,CAAChB,QAAQ,CAACQ,IAAI,CAACQ,GAAG;;OAE9B,OAAO,IAAI;;;CAIb;CACA;CACA;;KAHC;KAAA,qCAIqB;OACpB,IAAIJ,cAAI,CAACC,QAAQ,CAAC,IAAI,CAACb,QAAQ,CAACQ,IAAI,CAAC,IAAII,cAAI,CAACG,cAAc,CAAC,IAAI,CAACf,QAAQ,CAACQ,IAAI,CAACS,IAAI,CAAC,EAAE;SACtF,OAAO,IAAI,CAACjB,QAAQ,CAACQ,IAAI,CAACS,IAAI;;OAE/B,OAAO,IAAI;;;CAIb;CACA;CACA;;KAHC;KAAA,gCAIgB;OACf,OAAOC,MAAM,CAACC,QAAQ,CAACC,IAAI;;;GAC3B;CAAA,EA5FmCC,2CAAuB;;;;;;;;"}