this.BX=this.BX||{},this.BX.Booking=this.BX.Booking||{},function(t,e,n,i,o,s,r,a,l,c,p,u,d,h,v,m,_,g){"use strict";const B={name:"BookingEventPopupClient",directives:{hint:a.hint},components:{UiAvatar:l.Avatar,UiButton:c.Button,UiIcon:m.BIcon},setup:()=>({AirButtonStyle:c.AirButtonStyle,ButtonSize:c.ButtonSize,ButtonStyle:c.ButtonStyle,Outline:m.Outline}),computed:{...v.mapGetters({client:g.Model.BookingInfo+"/client"}),isPermitted(){var t,e;return Boolean(null==(t=this.client)||null==(e=t.permissions)?void 0:e.read)},clientName(){return this.client?this.isPermitted?this.client.name:this.loc("BOOKING_EVENT_POPUP_NO_ACCESS"):this.loc("BOOKING_EVENT_POPUP_CLIENT_IS_UNAVAILABLE")},clientImageLink(){return this.isPermitted?this.client.image:""}},methods:{soonHint(){return{text:this.loc("BOOKING_EVENT_POPUP_SOON_HINT"),popupOptions:{}}},openClient(){if(!this.isPermitted||!this.client)return;const t=this.client.type.toLowerCase();p.SidePanelInstance.open(`/crm/${t}/details/${this.client.id}/`)}},template:'\n\t\t<div class="booking-event-popup__person-block">\n\t\t\t<div class="booking-event-popup__person">\n\t\t\t\t<div class="booking-event-popup__person_avatar">\n\t\t\t\t\t<UiAvatar\n\t\t\t\t\t\t:userName="isPermitted ? clientName : null"\n\t\t\t\t\t\t:userpicPath="clientImageLink"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class="booking-event-popup__person_data">\n\t\t\t\t\t<div v-if="client !== null" class="booking-event-popup__person_status">\n\t\t\t\t\t\t{{ loc(\'BOOKING_EVENT_POPUP_CLIENT\') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\t:class="[\n\t\t\t\t\t\t\t\'booking-event-popup__person_name\',\n\t\t\t\t\t\t\t{ \'--no-access\': !isPermitted }\n\t\t\t\t\t\t]"\n\t\t\t\t\t\t@click="openClient"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ clientName }}\n\t\t\t\t\t\t<template v-if="client && !isPermitted">\n\t\t\t\t\t\t\t<UiIcon :name="Outline.LOCK_S" :size="20" color="rgb(var(--ui-color-palette-gray-50-rgb))"/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<UiButton\n\t\t\t\tv-hint="soonHint"\n\t\t\t\t:buttonClass="[\'--air\', ButtonStyle.NO_CAPS, AirButtonStyle.OUTLINE_NO_ACCENT]"\n\t\t\t\t:text="loc(\'BOOKING_EVENT_POPUP_CALL_LABEL\')"\n\t\t\t\t:icon="Outline.PHONE_UP"\n\t\t\t\ticonPosition="right"\n\t\t\t\t:size="ButtonSize.SMALL"\n\t\t\t\tdisabled\n\t\t\t\tuseAirDesign\n\t\t\t/>\n\t\t</div>\n\t'},P={name:"BookingEventPopupNote",components:{UiIcon:m.BIcon},setup:()=>({iconName:m.Outline.NOTE}),data:()=>({showedMore:!1}),computed:{...v.mapGetters({note:g.Model.BookingInfo+"/note"}),more(){return this.loc("BOOKING_EVENT_POPUP_NOTE_MORE")},shortNote(){return this.showedMore?this.note:this.note.slice(0,100-this.more.length).trimEnd()}},template:'\n\t\t<div class="booking-event-popup__person-info">\n\t\t\t<div class="booking-event-popup__person-info_icon">\n\t\t\t\t<UiIcon :name="iconName" :size="22" color="rgba(250, 167, 44, 1)"/>\n\t\t\t</div>\n\t\t\t<div class="booking-event-popup__person-info_text">\n\t\t\t\t<text>{{ shortNote }}</text>\n\t\t\t\t<span\n\t\t\t\t\tv-if="shortNote.length < note.length"\n\t\t\t\t\tclass="booking-event-popup__person-info_text-more"\n\t\t\t\t\t@click="showedMore = true"\n\t\t\t\t>\n\t\t\t\t\t{{ more }}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\t'},b={name:"EntitiesList",components:{UiCounter:d.Counter,UiIcon:m.BIcon},props:{title:{type:String,required:!0},iconName:{type:String,required:!0},entities:{type:Array,default:()=>[]},hasNoAccess:{type:Boolean,default:!1}},setup:()=>({Outline:m.Outline,CounterSize:u.CounterSize,CounterStyle:u.CounterStyle}),data:()=>({limit:90}),computed:{entitiesCount(){return this.entities.length},hasMore(){return!this.hasNoAccess&&this.entities.length>this.names.length},more(){return this.loc("BOOKING_EVENT_POPUP_ENTITIES_MORE",{"#COUNT#":this.entities.length-this.names.length||""})},count(){var t;return null!=(t=this.entitiesCount)?t:this.entities.length},names(){if(this.hasNoAccess)return[this.loc("BOOKING_EVENT_POPUP_NO_ACCESS")];if(this.limit===1/0)return this.entities.map((({name:t})=>t));let t=0;const e=[];if(1===this.entities.length)return this.entities.map((({name:t})=>t));for(const n of this.entities){if(t+n.name.length>this.limit)break;t+=n.name.length,e.push(n.name)}return e}},template:'\n\t\t<div class="booking-event-popup__resources-item">\n\t\t\t<div class="booking-event-popup__resources-item_icon">\n\t\t\t\t<UiIcon :name="iconName" :size="20"/>\n\t\t\t</div>\n\t\t\t<div class="booking-event-popup__resources-item_info">\n\t\t\t\t<div class="booking-event-popup__resources-item_title">\n\t\t\t\t\t{{ title }}\n\t\t\t\t\t<UiCounter\n\t\t\t\t\t\tv-if="!hasNoAccess"\n\t\t\t\t\t\t:value="count"\n\t\t\t\t\t\t:maxValue="999"\n\t\t\t\t\t\t:size="CounterSize.SMALL"\n\t\t\t\t\t\t:style="CounterStyle.FILLED"\n\t\t\t\t\t/>\n\t\t\t\t\t<template v-if="hasNoAccess">\n\t\t\t\t\t\t<UiIcon :name="Outline.LOCK_S" :size="20" color="rgb(var(--ui-color-palette-gray-50-rgb))"/>\n\t\t\t\t\t</template>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\t:class="[\n\t\t\t\t\t\t\'booking-event-popup__resources-item_text\',\n\t\t\t\t\t\t{ \'--no-access\': hasNoAccess }\n\t\t\t\t\t]"\n\t\t\t\t>\n\t\t\t\t\t{{ names.join(\', \') }}{{ hasMore ? \', \' : \'\' }}\n\t\t\t\t\t<span\n\t\t\t\t\t\tv-if="hasMore"\n\t\t\t\t\t\tclass="booking-event-popup__resources-item_text-more"\n\t\t\t\t\t\t@click="limit = Infinity"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ more }}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'},E={name:"BookingEventPopupApp",components:{BookingEventPopupClient:B,BookingEventPopupNote:P,ResourceEntitiesList:{name:"ResourceEntitiesList",components:{EntitiesList:b},computed:{...v.mapGetters({resources:g.Model.BookingInfo+"/resources"})},render(){if(0===this.resources.length)return null;const t=this.resources.some((({permissions:t})=>!t.read));return h.h(b,{title:this.loc("BOOKING_EVENT_POPUP_RESOURCES_TITLE"),iconName:m.Outline.PRODUCT,entities:t?[]:this.resources,hasNoAccess:t})}},ServicesEntitiesList:{name:"ServicesEntitiesList",components:{EntitiesList:b},computed:{...v.mapGetters({services:g.Model.BookingInfo+"/services"})},render(){if(0===this.services.length)return null;const t=this.services.some((({permissions:t})=>!t.read));return h.h(b,{title:this.loc("BOOKING_EVENT_POPUP_SERVICES_TITLE"),iconName:m.Outline.THREE_PERSONS,entities:t?[]:this.services,hasNoAccess:t})}}},props:{bookingId:{type:Number,required:!0}},data:()=>({fetching:!1}),computed:{...v.mapGetters({note:g.Model.BookingInfo+"/note"})},watch:{fetching:{handler(t){t?this.showLoader():this.hideLoader()},immediate:!0}},created(){this.loader=new s.Loader},mounted(){this.fetchBookingInfo()},methods:{async fetchBookingInfo(){try{this.fetching=!0,await r.calendarDataService.loadBookingInfo(this.bookingId)}catch(t){console.error("BookingEventPopup. Get data error",t)}finally{this.fetching=!1}},showLoader(){var t;null==(t=this.loader)||t.show(this.$refs.app)},hideLoader(){var t;null==(t=this.loader)||t.hide(this.$refs.app)}},template:'\n\t\t<div ref="app" class="booking-event-popup__content">\n\t\t\t<div class="booking-event-popup__title">{{ loc(\'BOOKING_EVENT_POPUP_TITLE\') }}</div>\n\t\t\t<BookingEventPopupClient v-if="!fetching"/>\n\t\t\t<BookingEventPopupNote v-if="note"/>\n\t\t\t<div class="booking-event-popup__resources">\n\t\t\t\t<ResourceEntitiesList/>\n\t\t\t\t<ServicesEntitiesList/>\n\t\t\t</div>\n\t\t</div>\n\t'};let k=null;var O=babelHelpers.classPrivateFieldLooseKey("bookingId"),N=babelHelpers.classPrivateFieldLooseKey("app"),I=babelHelpers.classPrivateFieldLooseKey("initPopup"),f=babelHelpers.classPrivateFieldLooseKey("mountApplication"),L=babelHelpers.classPrivateFieldLooseKey("close");function C(){k||(k=new e.Popup({id:"calendar-entity-booking-event-popup-"+babelHelpers.classPrivateFieldLooseBase(this,O)[O],bindElement:null,content:"",width:490,minHeight:100,maxHeight:330,closeByEsc:!0,closeIcon:!0,className:"booking-event-popup",autoHide:!0,events:{onPopupAfterClose:async()=>{await babelHelpers.classPrivateFieldLooseBase(this,L)[L]()}},padding:13}))}function S(t){const e=h.BitrixVue.createApp(E,{...n.Core.getParams(),bookingId:babelHelpers.classPrivateFieldLooseBase(this,O)[O]});e.mixin(i.locMixin),e.use(n.Core.getStore()),e.mount(t),babelHelpers.classPrivateFieldLooseBase(this,N)[N]=e}async function y(){var t;babelHelpers.classPrivateFieldLooseBase(this,N)[N].unmount(),babelHelpers.classPrivateFieldLooseBase(this,N)[N]=null,await n.Core.removeDynamicModule(g.Model.BookingInfo),null==(t=k)||t.destroy(),k=null}t.BookingEventPopup=class{constructor(t){Object.defineProperty(this,L,{value:y}),Object.defineProperty(this,f,{value:S}),Object.defineProperty(this,I,{value:C}),Object.defineProperty(this,O,{writable:!0,value:void 0}),Object.defineProperty(this,N,{writable:!0,value:void 0}),babelHelpers.classPrivateFieldLooseBase(this,O)[O]=t.bookingId}async show(){k||(k||babelHelpers.classPrivateFieldLooseBase(this,I)[I](),await n.Core.init({skipBookingCore:!0,skipPull:!0}),await n.Core.addDynamicModule(o.BookingInfo.create().setVariables({bookingId:babelHelpers.classPrivateFieldLooseBase(this,O)[O]})),k.show(),babelHelpers.classPrivateFieldLooseBase(this,f)[f](k.getContentContainer()))}}}(this.BX.Booking.Application=this.BX.Booking.Application||{},BX.Main,BX.Booking,BX.Booking.Component.Mixin,BX.Booking.Model,BX,BX.Booking.Provider.Service,BX.Vue3.Directives,BX.Booking.Component,BX.Booking.Component,BX.Booking.Lib,BX.UI,BX.UI.Vue3.Components,BX.Vue3,BX.Vue3.Vuex,BX.UI.IconSet,BX,BX.Booking.Const);
//# sourceMappingURL=booking-event-popup.bundle.map.js