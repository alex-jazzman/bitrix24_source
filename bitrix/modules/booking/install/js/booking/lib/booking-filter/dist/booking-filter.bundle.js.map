{"version":3,"file":"booking-filter.bundle.js","sources":["../src/booking-filter.js","../src/booking-date-count-filter.js"],"sourcesContent":["import { Type } from 'main.core';\nimport { Model } from 'booking.const';\nimport { Core } from 'booking.core';\nimport type { BookingUIFilter, BookingListFilter } from './types';\n\nconst CounterDictionary = Object.freeze({\n\tBookingDelayed: 'booking_delayed',\n\tBookingUnconfirmed: 'booking_unconfirmed',\n});\n\nexport class BookingFilter\n{\n\tprepareFilter(fields: BookingUIFilter, withinMonth: boolean = false): BookingListFilter\n\t{\n\t\tconst dateTs = Core.getStore().getters[`${Model.Interface}/${withinMonth ? 'viewDateTs' : 'selectedDateTs'}`];\n\t\tconst date = new Date(dateTs);\n\n\t\tconst filter = {\n\t\t\tWITHIN: {\n\t\t\t\tDATE_FROM: date.getTime() / 1000,\n\t\t\t\tDATE_TO: withinMonth\n\t\t\t\t\t? date.setMonth(date.getMonth() + 1) / 1000\n\t\t\t\t\t: date.setDate(date.getDate() + 1) / 1000,\n\t\t\t},\n\t\t};\n\n\t\tif (Type.isArrayFilled(fields.CREATED_BY))\n\t\t{\n\t\t\tfilter.CREATED_BY = fields.CREATED_BY.map((id: string) => Number(id));\n\t\t}\n\n\t\tif (Type.isArrayFilled(fields.CONTACT))\n\t\t{\n\t\t\tfilter.CRM_CONTACT_ID = fields.CONTACT.map((id: string) => Number(id));\n\t\t}\n\n\t\tif (Type.isArrayFilled(fields.COMPANY))\n\t\t{\n\t\t\tfilter.CRM_COMPANY_ID = fields.COMPANY.map((id: string) => Number(id));\n\t\t}\n\n\t\tif (Type.isArrayFilled(fields.RESOURCE))\n\t\t{\n\t\t\tfilter.RESOURCE_ID = fields.RESOURCE.map((id: string) => Number(id));\n\t\t}\n\n\t\tif (fields.CONFIRMED)\n\t\t{\n\t\t\tfilter.IS_CONFIRMED = { Y: 1, N: 0 }[fields.CONFIRMED];\n\t\t}\n\n\t\tif (fields.REQUIRE_ATTENTION)\n\t\t{\n\t\t\tfilter.HAS_COUNTER_OF_TYPE = {\n\t\t\t\tD: CounterDictionary.BookingDelayed,\n\t\t\t\tAC: CounterDictionary.BookingUnconfirmed,\n\t\t\t}[fields.REQUIRE_ATTENTION];\n\t\t}\n\n\t\treturn filter;\n\t}\n}\n\nexport const bookingFilter = new BookingFilter();\n","import { BookingFilter } from './booking-filter';\nimport type { BookingListFilter, BookingUIFilter } from './types';\n\nclass BookingDateCountFilter extends BookingFilter\n{\n\tprepareUndatedFilter(fields: BookingUIFilter, withinMonth: boolean = false): BookingListFilter\n\t{\n\t\tconst filter = super.prepareFilter(fields, withinMonth);\n\n\t\tdelete filter.WITHIN;\n\n\t\treturn filter;\n\t}\n\n\tprepareFutureOnlyFilter(fields: BookingUIFilter, withinMonth: boolean = false): BookingListFilter\n\t{\n\t\tconst filter = super.prepareFilter(fields, withinMonth);\n\n\t\tfilter.WITHIN = {\n\t\t\tDATE_FROM: Math.trunc(Date.now() / 1000),\n\t\t};\n\n\t\treturn filter;\n\t}\n\n\tprepareFutureFilter(fields: BookingUIFilter, withinMonth = false): BookingListFilter\n\t{\n\t\tconst filter = super.prepareFilter(fields, withinMonth);\n\t\tconst dateFrom = filter.WITHIN.DATE_FROM;\n\t\tconst today = Math.trunc(Date.now() / 1000);\n\n\t\tif (dateFrom < today)\n\t\t{\n\t\t\tfilter.WITHIN.DATE_FROM = today;\n\t\t}\n\n\t\treturn filter;\n\t}\n}\n\nexport const bookingDateCountFilter = new BookingDateCountFilter();\n"],"names":["CounterDictionary","Object","freeze","BookingDelayed","BookingUnconfirmed","BookingFilter","prepareFilter","fields","withinMonth","dateTs","Core","getStore","getters","Model","Interface","date","Date","filter","WITHIN","DATE_FROM","getTime","DATE_TO","setMonth","getMonth","setDate","getDate","Type","isArrayFilled","CREATED_BY","map","id","Number","CONTACT","CRM_CONTACT_ID","COMPANY","CRM_COMPANY_ID","RESOURCE","RESOURCE_ID","CONFIRMED","IS_CONFIRMED","Y","N","REQUIRE_ATTENTION","HAS_COUNTER_OF_TYPE","D","AC","bookingFilter","BookingDateCountFilter","prepareUndatedFilter","prepareFutureOnlyFilter","Math","trunc","now","prepareFutureFilter","dateFrom","today","bookingDateCountFilter"],"mappings":"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"}