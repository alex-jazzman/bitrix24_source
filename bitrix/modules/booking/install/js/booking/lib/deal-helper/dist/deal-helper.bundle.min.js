this.BX=this.BX||{};this.BX.Booking=this.BX.Booking||{};(function(e,a,s,t,i,l,o){"use strict";const r=s.SidePanel||BX.SidePanel;class n{openDealSidePanel({deal:e,onClose:a}){r.Instance.open(`/crm/deal/details/${e.value}/`,{events:{onClose:()=>a(e)}})}createCrmDeal({itemId:e,itemIdQueryParamName:s,queryParams:t={},clients:i,onLoad:o,onClose:n}){const d=new a.Uri("/crm/deal/details/0/");d.setQueryParam(s,e);Object.keys(t).forEach((e=>{d.setQueryParam(e,t[e])}));i.forEach((e=>{const a={[l.CrmEntity.Contact]:"contact_id",[l.CrmEntity.Company]:"company_id"}[e.type.code];d.setQueryParam(a,e.id)}));r.Instance.open(d.toString(),{events:{onLoad:({slider:e})=>{e.getWindow().BX.Event.EventEmitter.subscribe("onCrmEntityCreate",(e=>{const[t]=e.getData();o({isDeal:t.entityTypeName===l.CrmEntity.Deal,isCanceled:t.isCanceled,itemIdFromQuery:parseInt(new a.Uri(t.sliderUrl).getQueryParam(s),10),dealData:this.mapEntityInfoToDeal(t.entityInfo)})}))},onClose:()=>n()}})}mapEntityInfoToDeal(e){return{moduleId:l.Module.Crm,entityTypeId:e.typeName,value:e.id,data:[]}}}var d=babelHelpers.classPrivateFieldLooseKey("bookingId");var c=babelHelpers.classPrivateFieldLooseKey("deal");var v=babelHelpers.classPrivateFieldLooseKey("booking");class b extends n{constructor(e){super();Object.defineProperty(this,v,{get:u,set:void 0});Object.defineProperty(this,c,{get:p,set:void 0});Object.defineProperty(this,d,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,d)[d]=e}hasDeal(){return Boolean(babelHelpers.classPrivateFieldLooseBase(this,c)[c])}openDeal(){super.openDealSidePanel({deal:babelHelpers.classPrivateFieldLooseBase(this,c)[c],onClose:async e=>{if(e!=null&&e.value){void t.bookingService.getById(babelHelpers.classPrivateFieldLooseBase(this,d)[d])}}})}createDeal(){var e;const a="bookingId";super.createCrmDeal({itemIdQueryParamName:a,itemId:babelHelpers.classPrivateFieldLooseBase(this,d)[d],clients:((e=babelHelpers.classPrivateFieldLooseBase(this,v)[v])==null?void 0:e.clients)||[],onLoad:async e=>{if(!e.isDeal||babelHelpers.classPrivateFieldLooseBase(this,d)[d]!==e.itemIdFromQuery){return}await this.saveDeal(e.dealData)},onClose:async()=>{var e;if((e=babelHelpers.classPrivateFieldLooseBase(this,c)[c])!=null&&e.value){await this.saveDeal(babelHelpers.classPrivateFieldLooseBase(this,c)[c])}}})}saveDeal(e){const a=e?[e]:[];void t.bookingService.update({id:babelHelpers.classPrivateFieldLooseBase(this,d)[d],externalData:a})}}function p(){var e,a;return((e=babelHelpers.classPrivateFieldLooseBase(this,v)[v])==null?void 0:(a=e.externalData)==null?void 0:a.find((e=>e.entityTypeId===l.CrmEntity.Deal)))||null}function u(){return i.Core.getStore().getters[`${l.Model.Bookings}/getById`](babelHelpers.classPrivateFieldLooseBase(this,d)[d])}var y=babelHelpers.classPrivateFieldLooseKey("waitListItemId");var B=babelHelpers.classPrivateFieldLooseKey("deal");var P=babelHelpers.classPrivateFieldLooseKey("waitListItem");class m extends n{constructor(e){super();Object.defineProperty(this,P,{get:L,set:void 0});Object.defineProperty(this,B,{get:h,set:void 0});Object.defineProperty(this,y,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,y)[y]=e}hasDeal(){return Boolean(babelHelpers.classPrivateFieldLooseBase(this,B)[B])}openDeal(){super.openDealSidePanel({deal:babelHelpers.classPrivateFieldLooseBase(this,B)[B],onClose:async e=>{if(e!=null&&e.value){await o.waitListService.getById(babelHelpers.classPrivateFieldLooseBase(this,y)[y])}}})}createDeal(){var e;const a="waitListItemId";super.createCrmDeal({itemIdQueryParamName:a,itemId:babelHelpers.classPrivateFieldLooseBase(this,y)[y],clients:((e=babelHelpers.classPrivateFieldLooseBase(this,P)[P])==null?void 0:e.clients)||[],onLoad:async e=>{if(!e.isDeal||babelHelpers.classPrivateFieldLooseBase(this,y)[y]!==e.itemIdFromQuery){return}await this.saveDeal(e.dealData)},onClose:async()=>{var e;if((e=babelHelpers.classPrivateFieldLooseBase(this,B)[B])!=null&&e.value){await this.saveDeal(babelHelpers.classPrivateFieldLooseBase(this,B)[B])}}})}async saveDeal(e){const a=e?[e]:[];await o.waitListService.update({id:babelHelpers.classPrivateFieldLooseBase(this,y)[y],externalData:a})}}function h(){var e,a;return((e=babelHelpers.classPrivateFieldLooseBase(this,P)[P])==null?void 0:(a=e.externalData)==null?void 0:a.find((e=>e.entityTypeId===l.CrmEntity.Deal)))||null}function L(){return i.Core.getStore().getters[`${l.Model.WaitList}/getById`](babelHelpers.classPrivateFieldLooseBase(this,y)[y])}e.DealHelper=n;e.BookingDealHelper=b;e.WaitListDealHelper=m})(this.BX.Booking.Lib=this.BX.Booking.Lib||{},BX,BX.SidePanel,BX.Booking.Provider.Service,BX.Booking,BX.Booking.Const,BX.Booking.Provider.Service);
//# sourceMappingURL=deal-helper.bundle.map.js