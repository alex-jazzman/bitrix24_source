this.BX=this.BX||{};this.BX.Booking=this.BX.Booking||{};(function(e,s,t,a,i,l){"use strict";const o=t.SidePanel||BX.SidePanel;var r=babelHelpers.classPrivateFieldLooseKey("bookingId");var n=babelHelpers.classPrivateFieldLooseKey("deal");var d=babelHelpers.classPrivateFieldLooseKey("booking");class c{constructor(e){Object.defineProperty(this,d,{get:b,set:void 0});Object.defineProperty(this,n,{get:v,set:void 0});Object.defineProperty(this,r,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,r)[r]=e}hasDeal(){return Boolean(babelHelpers.classPrivateFieldLooseBase(this,n)[n])}openDeal(){o.Instance.open(`/crm/deal/details/${babelHelpers.classPrivateFieldLooseBase(this,n)[n].value}/`,{events:{onClose:()=>{var e;if((e=babelHelpers.classPrivateFieldLooseBase(this,n)[n])!=null&&e.value){void l.bookingService.getById(babelHelpers.classPrivateFieldLooseBase(this,r)[r])}}}})}createDeal(){var e,t;const a="bookingId";const l=new s.Uri("/crm/deal/details/0/");l.setQueryParam(a,babelHelpers.classPrivateFieldLooseBase(this,r)[r]);((e=(t=babelHelpers.classPrivateFieldLooseBase(this,d)[d])==null?void 0:t.clients)!=null?e:[]).forEach((e=>{const s={[i.CrmEntity.Contact]:"contact_id",[i.CrmEntity.Company]:"company_id"}[e.type.code];l.setQueryParam(s,e.id)}));o.Instance.open(l.toString(),{events:{onLoad:({slider:e})=>{e.getWindow().BX.Event.EventEmitter.subscribe("onCrmEntityCreate",(e=>{const[t]=e.getData();const l=t.entityTypeName===i.CrmEntity.Deal;const o=Number(new s.Uri(t.sliderUrl).getQueryParam(a));if(!l||o!==babelHelpers.classPrivateFieldLooseBase(this,r)[r]){return}const n=this.mapEntityInfoToDeal(t.entityInfo);this.saveDeal(n)}))},onClose:()=>{var e;if((e=babelHelpers.classPrivateFieldLooseBase(this,n)[n])!=null&&e.value){this.saveDeal(babelHelpers.classPrivateFieldLooseBase(this,n)[n])}}}})}mapEntityInfoToDeal(e){return{moduleId:i.Module.Crm,entityTypeId:e.typeName,value:e.id,data:[]}}saveDeal(e){const s=e?[e]:[];void l.bookingService.update({id:babelHelpers.classPrivateFieldLooseBase(this,r)[r],externalData:s})}}function v(){var e,s,t;return(e=(s=babelHelpers.classPrivateFieldLooseBase(this,d)[d])==null?void 0:(t=s.externalData)==null?void 0:t.find((e=>e.entityTypeId===i.CrmEntity.Deal)))!=null?e:null}function b(){return a.Core.getStore().getters[`${i.Model.Bookings}/getById`](babelHelpers.classPrivateFieldLooseBase(this,r)[r])}e.DealHelper=c})(this.BX.Booking.Lib=this.BX.Booking.Lib||{},BX,BX.SidePanel,BX.Booking,BX.Booking.Const,BX.Booking.Provider.Service);
//# sourceMappingURL=deal-helper.bundle.map.js