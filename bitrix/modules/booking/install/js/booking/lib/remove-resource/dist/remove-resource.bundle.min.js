this.BX=this.BX||{};this.BX.Booking=this.BX.Booking||{};(function(e,s,o,t,i,a,l,r){"use strict";class c{static confirmDelete(){return new Promise((e=>{const s=l.MessageBox.create({title:a.Loc.getMessage("BOOKING_RESOURCE_CONFIRM_DELETE_TITLE"),yesCaption:a.Loc.getMessage("BOOKING_RESOURCE_CONFIRM_DELETE_YES"),modal:true,buttons:l.MessageBoxButtons.YES_CANCEL,popupOptions:{className:"booking-resource-remove-confirmation",minHeight:135,closeByEsc:true,closeIcon:true,closeIconSize:r.CloseIconSize.LARGE},useAirDesign:true,onYes:async s=>{s.close();e(true)},onCancel:s=>{s.close();e(false)}});s.show()}))}static confirmMoveFutureBooking(){return new Promise((e=>{const s=l.MessageBox.create({title:a.Loc.getMessage("BOOKING_RESOURCE_CONFIRM_MOVE_FUTURE_BOOKINGS_TITLE"),message:a.Loc.getMessage("BOOKING_RESOURCE_CONFIRM_MOVE_FUTURE_BOOKINGS_TEXT"),yesCaption:a.Loc.getMessage("BOOKING_RESOURCE_CONFIRM_MOVE_FUTURE_BOOKINGS_YES"),noCaption:a.Loc.getMessage("BOOKING_RESOURCE_CONFIRM_MOVE_FUTURE_BOOKINGS_NO"),buttons:l.MessageBoxButtons.YES_NO,popupOptions:{className:"booking-resource-remove-confirmation booking-resource-remove-confirmation-move-bookings --air",minHeight:176,minWidth:418,closeByEsc:true,closeIcon:true,closeIconSize:r.CloseIconSize.LARGE},useAirDesign:true,onYes:async s=>{s.close();e(true)},onNo:s=>{s.close();e(false)}});s.show()}))}static confirmAfterMoveFutureBooking(e){return new Promise((s=>{const o=l.MessageBox.create({title:a.Loc.getMessage("BOOKING_RESOURCE_CONFIRM_AFTER_MOVE_FUTURE_BOOKINGS_TITLE"),message:a.Loc.getMessage("BOOKING_RESOURCE_CONFIRM_AFTER_MOVE_FUTURE_BOOKINGS_TEXT"),yesCaption:a.Loc.getMessage("BOOKING_RESOURCE_CONFIRM_AFTER_MOVE_FUTURE_BOOKINGS_YES"),noCaption:a.Loc.getMessage("BOOKING_RESOURCE_CONFIRM_AFTER_MOVE_FUTURE_BOOKINGS_NO"),buttons:l.MessageBoxButtons.YES_NO,popupOptions:{id:`booking-resource-remove-confirmation-${e.id}`,className:"booking-resource-remove-confirmation booking-resource-remove-confirmation-after-clear --air",minHeight:176,closeByEsc:true,closeIcon:true,closeIconSize:r.CloseIconSize.LARGE},useAirDesign:true,onYes:async e=>{e.close();s(true)},onNo:e=>{e.close();s(false)}});o.show()}))}}const n=5;var b=babelHelpers.classPrivateFieldLooseKey("resourceId");var d=babelHelpers.classPrivateFieldLooseKey("shouldRemoveFutureBookings");var v=babelHelpers.classPrivateFieldLooseKey("futureBookingIds");var u=babelHelpers.classPrivateFieldLooseKey("isDeletionCancelled");var B=babelHelpers.classPrivateFieldLooseKey("balloon");var O=babelHelpers.classPrivateFieldLooseKey("secondsLeft");var p=babelHelpers.classPrivateFieldLooseKey("countdownInterval");var F=babelHelpers.classPrivateFieldLooseKey("runCancellableDeletion");var g=babelHelpers.classPrivateFieldLooseKey("runCountdown");var L=babelHelpers.classPrivateFieldLooseKey("getBalloonTitle");var h=babelHelpers.classPrivateFieldLooseKey("cancelDeletion");var E=babelHelpers.classPrivateFieldLooseKey("onBalloonClose");var P=babelHelpers.classPrivateFieldLooseKey("cancelRemovingResource");class _{constructor(e){Object.defineProperty(this,P,{value:H});Object.defineProperty(this,L,{value:I});Object.defineProperty(this,g,{value:f});Object.defineProperty(this,F,{value:R});Object.defineProperty(this,b,{writable:true,value:void 0});Object.defineProperty(this,d,{writable:true,value:false});Object.defineProperty(this,v,{writable:true,value:[]});Object.defineProperty(this,u,{writable:true,value:void 0});Object.defineProperty(this,B,{writable:true,value:void 0});Object.defineProperty(this,O,{writable:true,value:void 0});Object.defineProperty(this,p,{writable:true,value:void 0});Object.defineProperty(this,h,{writable:true,value:()=>{babelHelpers.classPrivateFieldLooseBase(this,u)[u]=true;babelHelpers.classPrivateFieldLooseBase(this,B)[B].close();void t.Core.getStore().dispatch(`${o.Model.Interface}/removeDeletingResource`,babelHelpers.classPrivateFieldLooseBase(this,b)[b]);if(babelHelpers.classPrivateFieldLooseBase(this,v)[v].length>0){void t.Core.getStore().dispatch(`${o.Model.Interface}/removeDeletingBooking`,babelHelpers.classPrivateFieldLooseBase(this,v)[v])}}});Object.defineProperty(this,E,{writable:true,value:()=>{clearInterval(babelHelpers.classPrivateFieldLooseBase(this,p)[p]);if(babelHelpers.classPrivateFieldLooseBase(this,u)[u]){babelHelpers.classPrivateFieldLooseBase(this,u)[u]=false;return}void i.resourceService.delete(babelHelpers.classPrivateFieldLooseBase(this,b)[b],babelHelpers.classPrivateFieldLooseBase(this,d)[d])}});babelHelpers.classPrivateFieldLooseBase(this,b)[b]=e}async run(){await babelHelpers.classPrivateFieldLooseBase(this,P)[P]();const e=await i.resourceService.hasFutureBookings(babelHelpers.classPrivateFieldLooseBase(this,b)[b]);if(e){const e=await c.confirmMoveFutureBooking();if(e){await t.Core.getStore().dispatch(`${o.Model.Filter}/setDeletingResourceFilter`,{resourceId:babelHelpers.classPrivateFieldLooseBase(this,b)[b]})}else{babelHelpers.classPrivateFieldLooseBase(this,d)[d]=true;babelHelpers.classPrivateFieldLooseBase(this,F)[F]()}return}const s=await c.confirmDelete();if(s){babelHelpers.classPrivateFieldLooseBase(this,F)[F]()}}async runAfterMoveBookings(){await babelHelpers.classPrivateFieldLooseBase(this,P)[P]();const e=await i.resourceService.hasFutureBookings(babelHelpers.classPrivateFieldLooseBase(this,b)[b]);if(e){return}const s=t.Core.getStore().getters[`${o.Model.Resources}/getById`](babelHelpers.classPrivateFieldLooseBase(this,b)[b]);const a=await c.confirmAfterMoveFutureBooking(s);if(a){babelHelpers.classPrivateFieldLooseBase(this,F)[F]()}}}function R(){babelHelpers.classPrivateFieldLooseBase(this,O)[O]=n;babelHelpers.classPrivateFieldLooseBase(this,B)[B]=BX.UI.Notification.Center.notify({id:`booking-notify-remove-resource-${babelHelpers.classPrivateFieldLooseBase(this,b)[b]}`,content:babelHelpers.classPrivateFieldLooseBase(this,L)[L](),actions:[{title:a.Loc.getMessage("BOOKING_RESOURCE_REMOVE_BALLOON_CANCEL"),events:{mouseup:babelHelpers.classPrivateFieldLooseBase(this,h)[h]}}],events:{onClose:babelHelpers.classPrivateFieldLooseBase(this,E)[E]}});babelHelpers.classPrivateFieldLooseBase(this,g)[g]()}function f(){void t.Core.getStore().dispatch(`${o.Model.Interface}/addDeletingResource`,babelHelpers.classPrivateFieldLooseBase(this,b)[b]);if(babelHelpers.classPrivateFieldLooseBase(this,d)[d]){const e=t.Core.getStore().getters[`${o.Model.Bookings}/getFutureByResourceId`](babelHelpers.classPrivateFieldLooseBase(this,b)[b]);babelHelpers.classPrivateFieldLooseBase(this,v)[v]=e.map((e=>e.id));if(babelHelpers.classPrivateFieldLooseBase(this,v)[v].length>0){void t.Core.getStore().dispatch(`${o.Model.Interface}/addDeletingBooking`,babelHelpers.classPrivateFieldLooseBase(this,v)[v])}}babelHelpers.classPrivateFieldLooseBase(this,p)[p]=setInterval((()=>{babelHelpers.classPrivateFieldLooseBase(this,O)[O]--;babelHelpers.classPrivateFieldLooseBase(this,B)[B].update({content:babelHelpers.classPrivateFieldLooseBase(this,L)[L]()});if(babelHelpers.classPrivateFieldLooseBase(this,O)[O]<=0){babelHelpers.classPrivateFieldLooseBase(this,B)[B].close()}}),1e3)}function I(){return a.Loc.getMessage("BOOKING_RESOURCE_REMOVE_BALLOON_TEXT",{"#COUNTDOWN#":babelHelpers.classPrivateFieldLooseBase(this,O)[O]})}async function H(){const e=t.Core.getStore();if(e.getters[`${o.Model.Filter}/isDeletingResourceFilterMode`]){await Promise.all([e.dispatch(`${o.Model.Filter}/clearFilter`),e.dispatch(`${o.Model.Interface}/setPinnedResourceIds`,[])])}}e.RemoveResource=_})(this.BX.Booking.Lib=this.BX.Booking.Lib||{},BX,BX.Booking.Const,BX.Booking,BX.Booking.Provider.Service,BX,BX.UI.Dialogs,BX.Main);
//# sourceMappingURL=remove-resource.bundle.map.js