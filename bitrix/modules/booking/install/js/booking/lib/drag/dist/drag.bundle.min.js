this.BX=this.BX||{};this.BX.Booking=this.BX.Booking||{};(function(e,s,t,a,o,i,l,r,n,d){"use strict";var c=babelHelpers.classPrivateFieldLooseKey("params");var b=babelHelpers.classPrivateFieldLooseKey("dragManager");var v=babelHelpers.classPrivateFieldLooseKey("draggedId");var g=babelHelpers.classPrivateFieldLooseKey("draggedKind");var p=babelHelpers.classPrivateFieldLooseKey("onDragStart");var u=babelHelpers.classPrivateFieldLooseKey("onDragMove");var h=babelHelpers.classPrivateFieldLooseKey("onDragEnd");var B=babelHelpers.classPrivateFieldLooseKey("getDraggedElements");var P=babelHelpers.classPrivateFieldLooseKey("tryGetLostDraggedElements");var f=babelHelpers.classPrivateFieldLooseKey("getAdditionalBookingElements");var F=babelHelpers.classPrivateFieldLooseKey("updateScroll");var L=babelHelpers.classPrivateFieldLooseKey("getSpeed");var m=babelHelpers.classPrivateFieldLooseKey("isDragDeleteHovered");var H=babelHelpers.classPrivateFieldLooseKey("moveBooking");var y=babelHelpers.classPrivateFieldLooseKey("moveWaitListItem");var I=babelHelpers.classPrivateFieldLooseKey("setEditingBookingId");var k=babelHelpers.classPrivateFieldLooseKey("timeFormatted");var T=babelHelpers.classPrivateFieldLooseKey("draggedBooking");var D=babelHelpers.classPrivateFieldLooseKey("draggedDataTransfer");var O=babelHelpers.classPrivateFieldLooseKey("draggedBookingId");var K=babelHelpers.classPrivateFieldLooseKey("draggedBookingResourceId");var $=babelHelpers.classPrivateFieldLooseKey("hoveredCell");var M=babelHelpers.classPrivateFieldLooseKey("offset");var C=babelHelpers.classPrivateFieldLooseKey("gridWrap");var S=babelHelpers.classPrivateFieldLooseKey("gridColumns");class j{constructor(e){Object.defineProperty(this,S,{get:te,set:void 0});Object.defineProperty(this,C,{get:se,set:void 0});Object.defineProperty(this,M,{get:ee,set:void 0});Object.defineProperty(this,$,{get:Z,set:void 0});Object.defineProperty(this,K,{get:V,set:void 0});Object.defineProperty(this,O,{get:Q,set:void 0});Object.defineProperty(this,D,{get:J,set:void 0});Object.defineProperty(this,T,{get:U,set:void 0});Object.defineProperty(this,k,{get:Y,set:void 0});Object.defineProperty(this,I,{value:N});Object.defineProperty(this,y,{value:G});Object.defineProperty(this,H,{value:_});Object.defineProperty(this,m,{value:q});Object.defineProperty(this,L,{value:W});Object.defineProperty(this,F,{value:x});Object.defineProperty(this,f,{value:z});Object.defineProperty(this,P,{value:A});Object.defineProperty(this,B,{value:w});Object.defineProperty(this,h,{value:R});Object.defineProperty(this,u,{value:X});Object.defineProperty(this,p,{value:E});Object.defineProperty(this,c,{writable:true,value:void 0});Object.defineProperty(this,b,{writable:true,value:void 0});Object.defineProperty(this,v,{writable:true,value:void 0});Object.defineProperty(this,g,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,c)[c]={element:"booking-booking",...e};babelHelpers.classPrivateFieldLooseBase(this,b)[b]=new o.Draggable({container:babelHelpers.classPrivateFieldLooseBase(this,c)[c].container,draggable:babelHelpers.classPrivateFieldLooseBase(this,c)[c].draggable,elementsPreventingDrag:[".booking-booking-resize"],delay:200});babelHelpers.classPrivateFieldLooseBase(this,b)[b].subscribe("start",babelHelpers.classPrivateFieldLooseBase(this,p)[p].bind(this));babelHelpers.classPrivateFieldLooseBase(this,b)[b].subscribe("move",babelHelpers.classPrivateFieldLooseBase(this,u)[u].bind(this));babelHelpers.classPrivateFieldLooseBase(this,b)[b].subscribe("end",babelHelpers.classPrivateFieldLooseBase(this,h)[h].bind(this))}destroy(){babelHelpers.classPrivateFieldLooseBase(this,b)[b].destroy()}}async function E(e){var a;const{draggable:o,source:{dataset:n},clientX:d,clientY:b}=e.getData();babelHelpers.classPrivateFieldLooseBase(this,c)[c].element=`booking-${n.kind}`;babelHelpers.classPrivateFieldLooseBase(this,g)[g]=n.kind;babelHelpers.classPrivateFieldLooseBase(this,v)[v]=parseInt(n.id,10);await l.Core.getStore().dispatch(`${i.Model.Interface}/setDraggedDataTransfer`,{kind:babelHelpers.classPrivateFieldLooseBase(this,g)[g],id:babelHelpers.classPrivateFieldLooseBase(this,v)[v],resourceId:(a=parseInt(n.resourceId,10))!=null?a:0});s.Dom.style(o,"pointer-events","none");babelHelpers.classPrivateFieldLooseBase(this,f)[f](babelHelpers.classPrivateFieldLooseBase(this,c)[c].container).forEach((e=>{const t=s.Runtime.clone(e);o.append(t);const a=e.getBoundingClientRect().left-o.getBoundingClientRect().left;const i=e.getBoundingClientRect().top-o.getBoundingClientRect().top;s.Dom.style(t,"transition","none");s.Dom.style(t,"transform",`translate(${a}px, ${i}px)`);s.Dom.style(t,"animation","none")}));babelHelpers.classPrivateFieldLooseBase(this,B)[B](babelHelpers.classPrivateFieldLooseBase(this,c)[c].container).forEach((e=>{if(o.contains(e)){return}s.Dom.addClass(e,"--drag-source");s.Dom.style(e,"visibility","visible")}));const p=d-o.getBoundingClientRect().left;const u=b-o.getBoundingClientRect().top;babelHelpers.classPrivateFieldLooseBase(this,B)[B](o).forEach((e=>{s.Dom.style(e,"transform-origin",`${p}px ${u}px`)}));t.PopupManager.getPopups().forEach((e=>e.close()));void r.busySlots.loadBusySlots()}function X(e){if(s.Type.isNull(babelHelpers.classPrivateFieldLooseBase(this,g)[g])){return}const{draggable:t,clientX:a,clientY:o}=e.getData();babelHelpers.classPrivateFieldLooseBase(this,f)[f](t).forEach(((e,t)=>{s.Dom.style(e,"transition","");s.Dom.style(e,"transform",`rotate(${t===1?4:0}deg)`);s.Dom.style(e,"zIndex",`-${t+1}`)}));if(babelHelpers.classPrivateFieldLooseBase(this,m)[m](a,o)){s.Dom.addClass(t,"--deleting")}else{s.Dom.removeClass(t,"--deleting")}if(babelHelpers.classPrivateFieldLooseBase(this,g)[g]===i.DraggedElementKind.Booking){t.querySelectorAll('[data-element="booking-booking-time"]').forEach((e=>{e.innerText=babelHelpers.classPrivateFieldLooseBase(this,k)[k]}))}babelHelpers.classPrivateFieldLooseBase(this,F)[F](t,a,o)}async function R(){clearInterval(this.scrollTimeout);babelHelpers.classPrivateFieldLooseBase(this,B)[B](babelHelpers.classPrivateFieldLooseBase(this,c)[c].container).forEach((e=>{s.Dom.removeClass(e,"--drag-source");s.Dom.style(e,"visibility","")}));if(babelHelpers.classPrivateFieldLooseBase(this,$)[$]){if(babelHelpers.classPrivateFieldLooseBase(this,g)[g]===i.DraggedElementKind.Booking){void babelHelpers.classPrivateFieldLooseBase(this,H)[H]({booking:babelHelpers.classPrivateFieldLooseBase(this,T)[T],resourceId:babelHelpers.classPrivateFieldLooseBase(this,K)[K],cell:babelHelpers.classPrivateFieldLooseBase(this,$)[$]})}else if(babelHelpers.classPrivateFieldLooseBase(this,g)[g]===i.DraggedElementKind.WaitListItem){void babelHelpers.classPrivateFieldLooseBase(this,y)[y]({cell:babelHelpers.classPrivateFieldLooseBase(this,$)[$]})}}babelHelpers.classPrivateFieldLooseBase(this,g)[g]=null;babelHelpers.classPrivateFieldLooseBase(this,v)[v]=null;await l.Core.getStore().dispatch(`${i.Model.Interface}/clearDraggedDataTransfer`);void r.busySlots.loadBusySlots()}function w(e){const s=babelHelpers.classPrivateFieldLooseBase(this,D)[D].id||babelHelpers.classPrivateFieldLooseBase(this,v)[v];const t=[...e.querySelectorAll(`[data-element="${babelHelpers.classPrivateFieldLooseBase(this,c)[c].element}"][data-id="${s}"]`)];if(!s&&t.length===0){return babelHelpers.classPrivateFieldLooseBase(this,P)[P](e)}return t}function A(e){return[...e.querySelectorAll(`[data-element="${babelHelpers.classPrivateFieldLooseBase(this,c)[c].element}"].--drag-source`)]}function z(e){const s=babelHelpers.classPrivateFieldLooseBase(this,O)[O];const t=babelHelpers.classPrivateFieldLooseBase(this,K)[K];return[...e.querySelectorAll(`[data-element="${babelHelpers.classPrivateFieldLooseBase(this,c)[c].element}"][data-id="${s}"]:not([data-resource-id="${t}"])`)]}function x(e,s,t){clearTimeout(this.scrollTimeout);if(babelHelpers.classPrivateFieldLooseBase(this,m)[m](s,t)){return}const a=babelHelpers.classPrivateFieldLooseBase(this,C)[C].getBoundingClientRect();const o=e.getBoundingClientRect();this.scrollTimeout=setTimeout((()=>babelHelpers.classPrivateFieldLooseBase(this,F)[F](e)),16);if(o.left<a.left){babelHelpers.classPrivateFieldLooseBase(this,S)[S].scrollLeft-=babelHelpers.classPrivateFieldLooseBase(this,L)[L](o.left,a.left)}else if(o.right>a.right){babelHelpers.classPrivateFieldLooseBase(this,S)[S].scrollLeft+=babelHelpers.classPrivateFieldLooseBase(this,L)[L](o.right,a.right)}else if(o.top<a.top){babelHelpers.classPrivateFieldLooseBase(this,C)[C].scrollTop-=babelHelpers.classPrivateFieldLooseBase(this,L)[L](o.top,a.top)}else if(o.bottom>a.bottom){babelHelpers.classPrivateFieldLooseBase(this,C)[C].scrollTop+=2*babelHelpers.classPrivateFieldLooseBase(this,L)[L](o.bottom,a.bottom)}else{clearTimeout(this.scrollTimeout)}}function W(e,s){return(Math.floor(Math.sqrt(Math.abs(e-s)))+1)/2}function q(e,s){var t;if(!e||!s){return false}return(t=document.elementFromPoint(e,s))==null?void 0:t.closest('[data-element="booking-drag-delete"]')}async function _({booking:e,resourceId:s,cell:t}){if(t.fromTs===e.dateFromTs&&t.toTs===e.dateToTs&&t.resourceId===s){return}const a=e.resourcesIds.includes(t.resourceId)?e.resourcesIds:e.resourcesIds.filter((e=>e!==s));await d.bookingService.update({id:e.id,dateFromTs:t.fromTs,dateToTs:t.toTs,resourcesIds:[...new Set([t.resourceId,...a])],timezoneFrom:e.timezoneFrom,timezoneTo:e.timezoneTo})}async function G({cell:e}){var s,t,a,o;const r=l.Core.getStore();const c=babelHelpers.classPrivateFieldLooseBase(this,D)[D].id;const b=r.getters[`${i.Model.WaitList}/getById`](c);const v=e.resourceId;const g=r.getters[`${i.Model.Resources}/getById`](v);const p=g==null?void 0:(s=g.slotRanges)==null?void 0:(t=s[0])==null?void 0:t.timezone;const u=[...b.clients];const h=r.getters[`${i.Model.Interface}/intersections`];if(r.getters[`${i.Model.Interface}/editingWaitListItemId`]===c){await babelHelpers.classPrivateFieldLooseBase(this,I)[I](c)}const B=await d.bookingService.createFromWaitListItem(c,{id:`wl${c}`,clients:u,primaryClient:u.length>0?u[0]:undefined,externalData:[...b.externalData],name:b.name,note:b.note,resourcesIds:[...new Set([e.resourceId,...(a=h[0])!=null?a:[],...(o=h[e.resourceId])!=null?o:[]])],dateFromTs:e.fromTs,dateToTs:e.toTs,timezoneFrom:p,timezoneTo:p});if(B.success&&B.booking){n.BookingAnalytics.sendAddBooking({isOverbooking:false});if(r.getters[`${i.Model.Interface}/editingBookingId`]===c){await babelHelpers.classPrivateFieldLooseBase(this,I)[I](B.booking.id)}}}async function N(e){const s=l.Core.getStore();await Promise.all([s.dispatch(`${i.Model.Interface}/setEditingBookingId`,e),s.dispatch(`${i.Model.Interface}/setEditingWaitListItemId`,null)])}function Y(){var e,t,o,i;const l=a.DateTimeFormat.getFormat("SHORT_TIME_FORMAT");const r=(e=(t=babelHelpers.classPrivateFieldLooseBase(this,$)[$])==null?void 0:t.fromTs)!=null?e:babelHelpers.classPrivateFieldLooseBase(this,T)[T].dateFromTs;const n=(o=(i=babelHelpers.classPrivateFieldLooseBase(this,$)[$])==null?void 0:i.toTs)!=null?o:babelHelpers.classPrivateFieldLooseBase(this,T)[T].dateToTs;return s.Loc.getMessage("BOOKING_BOOKING_TIME_RANGE",{"#FROM#":a.DateTimeFormat.format(l,(r+babelHelpers.classPrivateFieldLooseBase(this,M)[M])/1e3),"#TO#":a.DateTimeFormat.format(l,(n+babelHelpers.classPrivateFieldLooseBase(this,M)[M])/1e3)})}function U(){var e;return(e=l.Core.getStore().getters[`${i.Model.Bookings}/getById`](babelHelpers.classPrivateFieldLooseBase(this,O)[O]))!=null?e:null}function J(){return l.Core.getStore().getters[`${i.Model.Interface}/draggedDataTransfer`]}function Q(){return l.Core.getStore().getters[`${i.Model.Interface}/draggedBookingId`]}function V(){return l.Core.getStore().getters[`${i.Model.Interface}/draggedBookingResourceId`]}function Z(){return l.Core.getStore().getters[`${i.Model.Interface}/hoveredCell`]}function ee(){return l.Core.getStore().getters[`${i.Model.Interface}/offset`]}function se(){return BX("booking-booking-grid-wrap")}function te(){return BX("booking-booking-grid-columns")}e.Drag=j})(this.BX.Booking.Lib=this.BX.Booking.Lib||{},BX,BX.Main,BX.Main,BX.UI.DragAndDrop,BX.Booking.Const,BX.Booking,BX.Booking.Lib,BX.Booking.Lib,BX.Booking.Provider.Service);
//# sourceMappingURL=drag.bundle.map.js