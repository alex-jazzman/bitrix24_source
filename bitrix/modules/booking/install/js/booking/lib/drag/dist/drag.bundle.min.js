this.BX=this.BX||{};this.BX.Booking=this.BX.Booking||{};(function(e,s,t,o,a,l,i,r,n,d,c){"use strict";var b=babelHelpers.classPrivateFieldLooseKey("params");var g=babelHelpers.classPrivateFieldLooseKey("dragManager");var v=babelHelpers.classPrivateFieldLooseKey("draggedId");var p=babelHelpers.classPrivateFieldLooseKey("draggedKind");var u=babelHelpers.classPrivateFieldLooseKey("onDragStart");var h=babelHelpers.classPrivateFieldLooseKey("onDragMove");var B=babelHelpers.classPrivateFieldLooseKey("onDragEnd");var P=babelHelpers.classPrivateFieldLooseKey("getDraggedElements");var f=babelHelpers.classPrivateFieldLooseKey("tryGetLostDraggedElements");var F=babelHelpers.classPrivateFieldLooseKey("getAdditionalBookingElements");var L=babelHelpers.classPrivateFieldLooseKey("updateScroll");var H=babelHelpers.classPrivateFieldLooseKey("getSpeed");var m=babelHelpers.classPrivateFieldLooseKey("isDragDeleteHovered");var y=babelHelpers.classPrivateFieldLooseKey("moveBooking");var I=babelHelpers.classPrivateFieldLooseKey("moveWaitListItem");var k=babelHelpers.classPrivateFieldLooseKey("setEditingBookingId");var D=babelHelpers.classPrivateFieldLooseKey("timeFormatted");var T=babelHelpers.classPrivateFieldLooseKey("showPopupOnNonDraggableBookingFromDeletedResource");var O=babelHelpers.classPrivateFieldLooseKey("getResourceById");var K=babelHelpers.classPrivateFieldLooseKey("draggedBooking");var $=babelHelpers.classPrivateFieldLooseKey("draggedDataTransfer");var C=babelHelpers.classPrivateFieldLooseKey("draggedBookingId");var M=babelHelpers.classPrivateFieldLooseKey("draggedBookingResourceId");var S=babelHelpers.classPrivateFieldLooseKey("hoveredCell");var j=babelHelpers.classPrivateFieldLooseKey("offset");var E=babelHelpers.classPrivateFieldLooseKey("gridWrap");var R=babelHelpers.classPrivateFieldLooseKey("gridColumns");class X{constructor(e){Object.defineProperty(this,R,{get:re,set:void 0});Object.defineProperty(this,E,{get:ie,set:void 0});Object.defineProperty(this,j,{get:le,set:void 0});Object.defineProperty(this,S,{get:ae,set:void 0});Object.defineProperty(this,M,{get:oe,set:void 0});Object.defineProperty(this,C,{get:te,set:void 0});Object.defineProperty(this,$,{get:se,set:void 0});Object.defineProperty(this,K,{get:ee,set:void 0});Object.defineProperty(this,O,{value:Z});Object.defineProperty(this,T,{value:V});Object.defineProperty(this,D,{get:Q,set:void 0});Object.defineProperty(this,k,{value:J});Object.defineProperty(this,I,{value:U});Object.defineProperty(this,y,{value:Y});Object.defineProperty(this,m,{value:G});Object.defineProperty(this,H,{value:_});Object.defineProperty(this,L,{value:q});Object.defineProperty(this,F,{value:N});Object.defineProperty(this,f,{value:W});Object.defineProperty(this,P,{value:x});Object.defineProperty(this,B,{value:z});Object.defineProperty(this,h,{value:A});Object.defineProperty(this,u,{value:w});Object.defineProperty(this,b,{writable:true,value:void 0});Object.defineProperty(this,g,{writable:true,value:void 0});Object.defineProperty(this,v,{writable:true,value:void 0});Object.defineProperty(this,p,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,b)[b]={element:"booking-booking",...e};babelHelpers.classPrivateFieldLooseBase(this,g)[g]=new a.Draggable({container:babelHelpers.classPrivateFieldLooseBase(this,b)[b].container,draggable:babelHelpers.classPrivateFieldLooseBase(this,b)[b].draggable,elementsPreventingDrag:[".booking-booking-resize"],delay:200});babelHelpers.classPrivateFieldLooseBase(this,g)[g].subscribe("start",babelHelpers.classPrivateFieldLooseBase(this,u)[u].bind(this));babelHelpers.classPrivateFieldLooseBase(this,g)[g].subscribe("move",babelHelpers.classPrivateFieldLooseBase(this,h)[h].bind(this));babelHelpers.classPrivateFieldLooseBase(this,g)[g].subscribe("end",babelHelpers.classPrivateFieldLooseBase(this,B)[B].bind(this))}destroy(){babelHelpers.classPrivateFieldLooseBase(this,g)[g].destroy()}}async function w(e){var o;const{draggable:a,source:{dataset:n},clientX:d,clientY:c}=e.getData();babelHelpers.classPrivateFieldLooseBase(this,b)[b].element=`booking-${n.kind}`;babelHelpers.classPrivateFieldLooseBase(this,p)[p]=n.kind;babelHelpers.classPrivateFieldLooseBase(this,v)[v]=parseInt(n.id,10);await i.Core.getStore().dispatch(`${l.Model.Interface}/setDraggedDataTransfer`,{kind:babelHelpers.classPrivateFieldLooseBase(this,p)[p],id:babelHelpers.classPrivateFieldLooseBase(this,v)[v],resourceId:(o=parseInt(n.resourceId,10))!=null?o:0});s.Dom.style(a,"pointer-events","none");babelHelpers.classPrivateFieldLooseBase(this,F)[F](babelHelpers.classPrivateFieldLooseBase(this,b)[b].container).forEach((e=>{const t=s.Runtime.clone(e);a.append(t);const o=e.getBoundingClientRect().left-a.getBoundingClientRect().left;const l=e.getBoundingClientRect().top-a.getBoundingClientRect().top;s.Dom.style(t,"transition","none");s.Dom.style(t,"transform",`translate(${o}px, ${l}px)`);s.Dom.style(t,"animation","none")}));babelHelpers.classPrivateFieldLooseBase(this,P)[P](babelHelpers.classPrivateFieldLooseBase(this,b)[b].container).forEach((e=>{if(a.contains(e)){return}s.Dom.addClass(e,"--drag-source");s.Dom.style(e,"visibility","visible")}));const g=d-a.getBoundingClientRect().left;const u=c-a.getBoundingClientRect().top;babelHelpers.classPrivateFieldLooseBase(this,P)[P](a).forEach((e=>{s.Dom.style(e,"transform-origin",`${g}px ${u}px`)}));t.PopupManager.getPopups().forEach((e=>e.close()));void r.busySlots.loadBusySlots()}function A(e){if(s.Type.isNull(babelHelpers.classPrivateFieldLooseBase(this,p)[p])){return}const{draggable:t,clientX:o,clientY:a}=e.getData();babelHelpers.classPrivateFieldLooseBase(this,F)[F](t).forEach(((e,t)=>{s.Dom.style(e,"transition","");s.Dom.style(e,"transform",`rotate(${t===1?4:0}deg)`);s.Dom.style(e,"zIndex",`-${t+1}`)}));if(babelHelpers.classPrivateFieldLooseBase(this,m)[m](o,a)){s.Dom.addClass(t,"--deleting")}else{s.Dom.removeClass(t,"--deleting")}if(babelHelpers.classPrivateFieldLooseBase(this,p)[p]===l.DraggedElementKind.Booking){t.querySelectorAll('[data-element="booking-booking-time"]').forEach((e=>{e.innerText=babelHelpers.classPrivateFieldLooseBase(this,D)[D]}))}babelHelpers.classPrivateFieldLooseBase(this,L)[L](t,o,a)}async function z(e){var t,o;clearInterval(this.scrollTimeout);babelHelpers.classPrivateFieldLooseBase(this,P)[P](babelHelpers.classPrivateFieldLooseBase(this,b)[b].container).forEach((e=>{s.Dom.removeClass(e,"--drag-source");s.Dom.style(e,"visibility","")}));if(babelHelpers.classPrivateFieldLooseBase(this,S)[S]&&!((t=babelHelpers.classPrivateFieldLooseBase(this,O)[O](babelHelpers.classPrivateFieldLooseBase(this,S)[S].resourceId))!=null&&t.isDeleted)){if(babelHelpers.classPrivateFieldLooseBase(this,p)[p]===l.DraggedElementKind.Booking){void babelHelpers.classPrivateFieldLooseBase(this,y)[y]({booking:babelHelpers.classPrivateFieldLooseBase(this,K)[K],resourceId:babelHelpers.classPrivateFieldLooseBase(this,M)[M],cell:babelHelpers.classPrivateFieldLooseBase(this,S)[S]})}else if(babelHelpers.classPrivateFieldLooseBase(this,p)[p]===l.DraggedElementKind.WaitListItem){void babelHelpers.classPrivateFieldLooseBase(this,I)[I]({cell:babelHelpers.classPrivateFieldLooseBase(this,S)[S]})}}if((o=babelHelpers.classPrivateFieldLooseBase(this,O)[O](babelHelpers.classPrivateFieldLooseBase(this,M)[M]))!=null&&o.isDeleted){const s=babelHelpers.classPrivateFieldLooseBase(this,K)[K].id;if(i.Core.getStore().getters[`${l.Model.Interface}/deletingBookings`][s]){return}babelHelpers.classPrivateFieldLooseBase(this,T)[T](e.data.source,s)}babelHelpers.classPrivateFieldLooseBase(this,p)[p]=null;babelHelpers.classPrivateFieldLooseBase(this,v)[v]=null;await i.Core.getStore().dispatch(`${l.Model.Interface}/clearDraggedDataTransfer`);void r.busySlots.loadBusySlots()}function x(e){const s=babelHelpers.classPrivateFieldLooseBase(this,$)[$].id||babelHelpers.classPrivateFieldLooseBase(this,v)[v];const t=[...e.querySelectorAll(`[data-element="${babelHelpers.classPrivateFieldLooseBase(this,b)[b].element}"][data-id="${s}"]`)];if(!s&&t.length===0){return babelHelpers.classPrivateFieldLooseBase(this,f)[f](e)}return t}function W(e){return[...e.querySelectorAll(`[data-element="${babelHelpers.classPrivateFieldLooseBase(this,b)[b].element}"].--drag-source`)]}function N(e){const s=babelHelpers.classPrivateFieldLooseBase(this,C)[C];const t=babelHelpers.classPrivateFieldLooseBase(this,M)[M];return[...e.querySelectorAll(`[data-element="${babelHelpers.classPrivateFieldLooseBase(this,b)[b].element}"][data-id="${s}"]:not([data-resource-id="${t}"])`)]}function q(e,s,t){clearTimeout(this.scrollTimeout);if(babelHelpers.classPrivateFieldLooseBase(this,m)[m](s,t)){return}const o=babelHelpers.classPrivateFieldLooseBase(this,E)[E].getBoundingClientRect();const a=e.getBoundingClientRect();this.scrollTimeout=setTimeout((()=>babelHelpers.classPrivateFieldLooseBase(this,L)[L](e)),16);if(a.left<o.left){babelHelpers.classPrivateFieldLooseBase(this,R)[R].scrollLeft-=babelHelpers.classPrivateFieldLooseBase(this,H)[H](a.left,o.left)}else if(a.right>o.right){babelHelpers.classPrivateFieldLooseBase(this,R)[R].scrollLeft+=babelHelpers.classPrivateFieldLooseBase(this,H)[H](a.right,o.right)}else if(a.top<o.top){babelHelpers.classPrivateFieldLooseBase(this,E)[E].scrollTop-=babelHelpers.classPrivateFieldLooseBase(this,H)[H](a.top,o.top)}else if(a.bottom>o.bottom){babelHelpers.classPrivateFieldLooseBase(this,E)[E].scrollTop+=2*babelHelpers.classPrivateFieldLooseBase(this,H)[H](a.bottom,o.bottom)}else{clearTimeout(this.scrollTimeout)}}function _(e,s){return(Math.floor(Math.sqrt(Math.abs(e-s)))+1)/2}function G(e,s){var t;if(!e||!s){return false}return(t=document.elementFromPoint(e,s))==null?void 0:t.closest('[data-element="booking-drag-delete"]')}async function Y({booking:e,resourceId:s,cell:t}){if(t.fromTs===e.dateFromTs&&t.toTs===e.dateToTs&&t.resourceId===s){return}const o=e.resourcesIds.includes(t.resourceId)?e.resourcesIds:[t.resourceId,...e.resourcesIds.filter((e=>e!==s))];await d.bookingService.update({id:e.id,dateFromTs:t.fromTs,dateToTs:t.toTs,resourcesIds:[...new Set(o)],timezoneFrom:e.timezoneFrom,timezoneTo:e.timezoneTo})}async function U({cell:e}){var s,t,o,a;const r=i.Core.getStore();const c=babelHelpers.classPrivateFieldLooseBase(this,$)[$].id;const b=r.getters[`${l.Model.WaitList}/getById`](c);const g=e.resourceId;const v=r.getters[`${l.Model.Resources}/getById`](g);const p=v==null?void 0:(s=v.slotRanges)==null?void 0:(t=s[0])==null?void 0:t.timezone;const u=[...b.clients];const h=r.getters[`${l.Model.Interface}/intersections`];if(r.getters[`${l.Model.Interface}/editingWaitListItemId`]===c){await babelHelpers.classPrivateFieldLooseBase(this,k)[k](c)}const B=await d.bookingService.createFromWaitListItem(c,{id:`wl${c}`,clients:u,primaryClient:u.length>0?u[0]:undefined,externalData:[...b.externalData],name:b.name,note:b.note,resourcesIds:[...new Set([e.resourceId,...(o=h[0])!=null?o:[],...(a=h[e.resourceId])!=null?a:[]])],dateFromTs:e.fromTs,dateToTs:e.toTs,timezoneFrom:p,timezoneTo:p});if(B.success&&B.booking){n.BookingAnalytics.sendAddBooking({isOverbooking:false});if(r.getters[`${l.Model.Interface}/editingBookingId`]===c){await babelHelpers.classPrivateFieldLooseBase(this,k)[k](B.booking.id)}}}async function J(e){const s=i.Core.getStore();await Promise.all([s.dispatch(`${l.Model.Interface}/setEditingBookingId`,e),s.dispatch(`${l.Model.Interface}/setEditingWaitListItemId`,null)])}function Q(){var e,t,a,l;const i=o.DateTimeFormat.getFormat("SHORT_TIME_FORMAT");const r=(e=(t=babelHelpers.classPrivateFieldLooseBase(this,S)[S])==null?void 0:t.fromTs)!=null?e:babelHelpers.classPrivateFieldLooseBase(this,K)[K].dateFromTs;const n=(a=(l=babelHelpers.classPrivateFieldLooseBase(this,S)[S])==null?void 0:l.toTs)!=null?a:babelHelpers.classPrivateFieldLooseBase(this,K)[K].dateToTs;return s.Loc.getMessage("BOOKING_BOOKING_TIME_RANGE",{"#FROM#":o.DateTimeFormat.format(i,(r+babelHelpers.classPrivateFieldLooseBase(this,j)[j])/1e3),"#TO#":o.DateTimeFormat.format(i,(n+babelHelpers.classPrivateFieldLooseBase(this,j)[j])/1e3)})}function V(e,s){const t=`booking-non-draggable-booking-${s}`;const o=new c.NonDraggableBookingPopup({id:t,bindElement:e});o.show();setTimeout((()=>{o.destroy(t)}),5e3)}function Z(e){return i.Core.getStore().getters[`${l.Model.Resources}/getById`](e)}function ee(){var e;return(e=i.Core.getStore().getters[`${l.Model.Bookings}/getById`](babelHelpers.classPrivateFieldLooseBase(this,C)[C]))!=null?e:null}function se(){return i.Core.getStore().getters[`${l.Model.Interface}/draggedDataTransfer`]}function te(){return i.Core.getStore().getters[`${l.Model.Interface}/draggedBookingId`]}function oe(){return i.Core.getStore().getters[`${l.Model.Interface}/draggedBookingResourceId`]}function ae(){return i.Core.getStore().getters[`${l.Model.Interface}/hoveredCell`]}function le(){return i.Core.getStore().getters[`${l.Model.Interface}/offset`]}function ie(){return BX("booking-booking-grid-wrap")}function re(){return BX("booking-booking-grid-columns")}e.Drag=X})(this.BX.Booking.Lib=this.BX.Booking.Lib||{},BX,BX.Main,BX.Main,BX.UI.DragAndDrop,BX.Booking.Const,BX.Booking,BX.Booking.Lib,BX.Booking.Lib,BX.Booking.Provider.Service,BX.Booking.Component);
//# sourceMappingURL=drag.bundle.map.js