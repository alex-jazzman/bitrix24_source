{"version":3,"file":"drag.bundle.js","sources":["../src/drag.js"],"sourcesContent":["import { Dom, Loc, Runtime, Type } from 'main.core';\nimport { Popup, PopupManager } from 'main.popup';\nimport { DateTimeFormat } from 'main.date';\nimport { Draggable, DragMoveEvent, DragStartEvent } from 'ui.draganddrop.draggable';\n\nimport { Model, DraggedElementKind } from 'booking.const';\nimport { Core } from 'booking.core';\nimport { busySlots } from 'booking.lib.busy-slots';\nimport { BookingAnalytics } from 'booking.lib.analytics';\nimport { bookingService } from 'booking.provider.service.booking-service';\nimport type { BookingModel } from 'booking.model.bookings';\nimport type { DraggedDataTransfer } from 'booking.model.interface';\n\ntype Params = {\n\tdraggable: string,\n\tcontainer: HTMLElement,\n\telement: 'booking-booking' | 'booking-waitlist-item',\n};\n\nexport class Drag\n{\n\t#params: Params;\n\t#dragManager: Draggable;\n\t#draggedId: ?number;\n\t#draggedKind: ?$Values<typeof DraggedElementKind>;\n\n\tconstructor(params: Params)\n\t{\n\t\tthis.#params = {\n\t\t\telement: 'booking-booking',\n\t\t\t...params,\n\t\t};\n\n\t\tthis.#dragManager = new Draggable({\n\t\t\tcontainer: this.#params.container,\n\t\t\tdraggable: this.#params.draggable,\n\t\t\telementsPreventingDrag: ['.booking-booking-resize'],\n\t\t\tdelay: 200,\n\t\t});\n\n\t\tthis.#dragManager.subscribe('start', this.#onDragStart.bind(this));\n\t\tthis.#dragManager.subscribe('move', this.#onDragMove.bind(this));\n\t\tthis.#dragManager.subscribe('end', this.#onDragEnd.bind(this));\n\t}\n\n\tdestroy(): void\n\t{\n\t\tthis.#dragManager.destroy();\n\t}\n\n\tasync #onDragStart(event: DragStartEvent): Promise<void>\n\t{\n\t\tconst { draggable, source: { dataset }, clientX, clientY } = event.getData();\n\n\t\tthis.#params.element = `booking-${dataset.kind}`;\n\t\tthis.#draggedKind = dataset.kind;\n\t\tthis.#draggedId = parseInt(dataset.id, 10);\n\n\t\tawait Core.getStore().dispatch(`${Model.Interface}/setDraggedDataTransfer`, {\n\t\t\tkind: this.#draggedKind,\n\t\t\tid: this.#draggedId,\n\t\t\tresourceId: parseInt(dataset.resourceId, 10) ?? 0,\n\t\t});\n\n\t\tDom.style(draggable, 'pointer-events', 'none');\n\t\tthis.#getAdditionalBookingElements(this.#params.container).forEach((element) => {\n\t\t\tconst clone = Runtime.clone(element);\n\t\t\tdraggable.append(clone);\n\n\t\t\tconst translateX = element.getBoundingClientRect().left - draggable.getBoundingClientRect().left;\n\t\t\tconst translateY = element.getBoundingClientRect().top - draggable.getBoundingClientRect().top;\n\t\t\tDom.style(clone, 'transition', 'none');\n\t\t\tDom.style(clone, 'transform', `translate(${translateX}px, ${translateY}px)`);\n\t\t\tDom.style(clone, 'animation', 'none');\n\t\t});\n\n\t\tthis.#getDraggedElements(this.#params.container).forEach((element) => {\n\t\t\tif (draggable.contains(element))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tDom.addClass(element, '--drag-source');\n\t\t\tDom.style(element, 'visibility', 'visible');\n\t\t});\n\n\t\tconst transformOriginX = clientX - draggable.getBoundingClientRect().left;\n\t\tconst transformOriginY = clientY - draggable.getBoundingClientRect().top;\n\t\tthis.#getDraggedElements(draggable).forEach((clone) => {\n\t\t\tDom.style(clone, 'transform-origin', `${transformOriginX}px ${transformOriginY}px`);\n\t\t});\n\n\t\tPopupManager.getPopups().forEach((popup: Popup) => popup.close());\n\n\t\tvoid busySlots.loadBusySlots();\n\t}\n\n\t#onDragMove(event: DragMoveEvent): void\n\t{\n\t\tif (Type.isNull(this.#draggedKind))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst { draggable, clientX, clientY } = event.getData();\n\n\t\tthis.#getAdditionalBookingElements(draggable).forEach((clone, index) => {\n\t\t\tDom.style(clone, 'transition', '');\n\t\t\tDom.style(clone, 'transform', `rotate(${index === 1 ? 4 : 0}deg)`);\n\t\t\tDom.style(clone, 'zIndex', `-${index + 1}`);\n\t\t});\n\n\t\tif (this.#isDragDeleteHovered(clientX, clientY))\n\t\t{\n\t\t\tDom.addClass(draggable, '--deleting');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.removeClass(draggable, '--deleting');\n\t\t}\n\n\t\tif (this.#draggedKind === DraggedElementKind.Booking)\n\t\t{\n\t\t\tdraggable.querySelectorAll('[data-element=\"booking-booking-time\"]').forEach((time) => {\n\t\t\t\ttime.innerText = this.#timeFormatted;\n\t\t\t});\n\t\t}\n\n\t\tthis.#updateScroll(draggable, clientX, clientY);\n\t}\n\n\tasync #onDragEnd(): Promise<void>\n\t{\n\t\tclearInterval(this.scrollTimeout);\n\n\t\tthis.#getDraggedElements(this.#params.container).forEach((element) => {\n\t\t\tDom.removeClass(element, '--drag-source');\n\t\t\tDom.style(element, 'visibility', '');\n\t\t});\n\n\t\tif (this.#hoveredCell)\n\t\t{\n\t\t\tif (this.#draggedKind === DraggedElementKind.Booking)\n\t\t\t{\n\t\t\t\tvoid this.#moveBooking({\n\t\t\t\t\tbooking: this.#draggedBooking,\n\t\t\t\t\tresourceId: this.#draggedBookingResourceId,\n\t\t\t\t\tcell: this.#hoveredCell,\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (this.#draggedKind === DraggedElementKind.WaitListItem)\n\t\t\t{\n\t\t\t\tvoid this.#moveWaitListItem({\n\t\t\t\t\tcell: this.#hoveredCell,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tthis.#draggedKind = null;\n\t\tthis.#draggedId = null;\n\t\tawait Core.getStore().dispatch(`${Model.Interface}/clearDraggedDataTransfer`);\n\n\t\tvoid busySlots.loadBusySlots();\n\t}\n\n\t#getDraggedElements(container: HTMLElement): HTMLElement[]\n\t{\n\t\tconst id = this.#draggedDataTransfer.id || this.#draggedId;\n\t\tconst items = [\n\t\t\t...container\n\t\t\t\t.querySelectorAll(`[data-element=\"${this.#params.element}\"][data-id=\"${id}\"]`),\n\t\t];\n\n\t\tif (!id && items.length === 0)\n\t\t{\n\t\t\treturn this.#tryGetLostDraggedElements(container);\n\t\t}\n\n\t\treturn items;\n\t}\n\n\t#tryGetLostDraggedElements(container): HTMLElement[]\n\t{\n\t\treturn [...container.querySelectorAll(`[data-element=\"${this.#params.element}\"].--drag-source`)];\n\t}\n\n\t#getAdditionalBookingElements(container: HTMLElement): HTMLElement[]\n\t{\n\t\tconst id = this.#draggedBookingId;\n\t\tconst resourceId = this.#draggedBookingResourceId;\n\n\t\treturn [\n\t\t\t...container\n\t\t\t\t.querySelectorAll(`[data-element=\"${this.#params.element}\"][data-id=\"${id}\"]:not([data-resource-id=\"${resourceId}\"])`),\n\t\t];\n\t}\n\n\t#updateScroll(draggable: HTMLElement, x: number, y: number): void\n\t{\n\t\tclearTimeout(this.scrollTimeout);\n\t\tif (this.#isDragDeleteHovered(x, y))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst gridRect = this.#gridWrap.getBoundingClientRect();\n\t\tconst draggableRect = draggable.getBoundingClientRect();\n\n\t\tthis.scrollTimeout = setTimeout(() => this.#updateScroll(draggable), 16);\n\n\t\tif (draggableRect.left < gridRect.left)\n\t\t{\n\t\t\tthis.#gridColumns.scrollLeft -= this.#getSpeed(draggableRect.left, gridRect.left);\n\t\t}\n\t\telse if (draggableRect.right > gridRect.right)\n\t\t{\n\t\t\tthis.#gridColumns.scrollLeft += this.#getSpeed(draggableRect.right, gridRect.right);\n\t\t}\n\t\telse if (draggableRect.top < gridRect.top)\n\t\t{\n\t\t\tthis.#gridWrap.scrollTop -= this.#getSpeed(draggableRect.top, gridRect.top);\n\t\t}\n\t\telse if (draggableRect.bottom > gridRect.bottom)\n\t\t{\n\t\t\tthis.#gridWrap.scrollTop += 2 * this.#getSpeed(draggableRect.bottom, gridRect.bottom);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tclearTimeout(this.scrollTimeout);\n\t\t}\n\t}\n\n\t#getSpeed(a: number, b: number): number\n\t{\n\t\treturn (Math.floor(Math.sqrt(Math.abs(a - b))) + 1) / 2;\n\t}\n\n\t#isDragDeleteHovered(x: number, y: number): boolean\n\t{\n\t\tif (!x || !y)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn document.elementFromPoint(x, y)?.closest('[data-element=\"booking-drag-delete\"]');\n\t}\n\n\tasync #moveBooking({ booking, resourceId, cell }: {\n\t\tbooking: BookingModel,\n\t\tresourceId: number,\n\t\tcell: CellDto\n\t}): void\n\t{\n\t\tif (cell.fromTs === booking.dateFromTs && cell.toTs === booking.dateToTs && cell.resourceId === resourceId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst resourceIds = booking.resourcesIds.includes(cell.resourceId)\n\t\t\t? booking.resourcesIds\n\t\t\t: [\n\t\t\t\tcell.resourceId,\n\t\t\t\t...booking.resourcesIds.filter((id: number) => id !== resourceId),\n\t\t\t]\n\t\t;\n\n\t\tawait bookingService.update({\n\t\t\tid: booking.id,\n\t\t\tdateFromTs: cell.fromTs,\n\t\t\tdateToTs: cell.toTs,\n\t\t\tresourcesIds: [...new Set(resourceIds)],\n\t\t\ttimezoneFrom: booking.timezoneFrom,\n\t\t\ttimezoneTo: booking.timezoneTo,\n\t\t});\n\t}\n\n\tasync #moveWaitListItem({ cell }: { cell: CellDto }): void\n\t{\n\t\tconst $store = Core.getStore();\n\t\tconst waitListItemId = this.#draggedDataTransfer.id;\n\t\tconst waitListItem = $store.getters[`${Model.WaitList}/getById`](waitListItemId);\n\t\tconst resourceId = cell.resourceId;\n\t\tconst resource = $store.getters[`${Model.Resources}/getById`](resourceId);\n\t\tconst timezone = resource?.slotRanges?.[0]?.timezone;\n\t\tconst clients = [...waitListItem.clients];\n\t\tconst intersections = $store.getters[`${Model.Interface}/intersections`];\n\n\t\tif ($store.getters[`${Model.Interface}/editingWaitListItemId`] === waitListItemId)\n\t\t{\n\t\t\tawait this.#setEditingBookingId(waitListItemId);\n\t\t}\n\n\t\tconst result = await bookingService.createFromWaitListItem(waitListItemId, {\n\t\t\tid: `wl${waitListItemId}`,\n\t\t\tclients,\n\t\t\tprimaryClient: clients.length > 0 ? clients[0] : undefined,\n\t\t\texternalData: [...waitListItem.externalData],\n\t\t\tname: waitListItem.name,\n\t\t\tnote: waitListItem.note,\n\t\t\tresourcesIds: [\n\t\t\t\t...new Set([\n\t\t\t\t\tcell.resourceId,\n\t\t\t\t\t...(intersections[0] ?? []),\n\t\t\t\t\t...(intersections[cell.resourceId] ?? []),\n\t\t\t\t]),\n\t\t\t],\n\t\t\tdateFromTs: cell.fromTs,\n\t\t\tdateToTs: cell.toTs,\n\t\t\ttimezoneFrom: timezone,\n\t\t\ttimezoneTo: timezone,\n\t\t});\n\n\t\tif (result.success && result.booking)\n\t\t{\n\t\t\tBookingAnalytics.sendAddBooking({ isOverbooking: false });\n\n\t\t\tif ($store.getters[`${Model.Interface}/editingBookingId`] === waitListItemId)\n\t\t\t{\n\t\t\t\tawait this.#setEditingBookingId(result.booking.id);\n\t\t\t}\n\t\t}\n\t}\n\n\tasync #setEditingBookingId(id: number | string): Promise<void>\n\t{\n\t\tconst $store = Core.getStore();\n\n\t\tawait Promise.all([\n\t\t\t$store.dispatch(`${Model.Interface}/setEditingBookingId`, id),\n\t\t\t$store.dispatch(`${Model.Interface}/setEditingWaitListItemId`, null),\n\t\t]);\n\t}\n\n\tget #timeFormatted(): string\n\t{\n\t\tconst timeFormat = DateTimeFormat.getFormat('SHORT_TIME_FORMAT');\n\t\tconst from = this.#hoveredCell?.fromTs ?? this.#draggedBooking.dateFromTs;\n\t\tconst to = this.#hoveredCell?.toTs ?? this.#draggedBooking.dateToTs;\n\n\t\treturn Loc.getMessage('BOOKING_BOOKING_TIME_RANGE', {\n\t\t\t'#FROM#': DateTimeFormat.format(timeFormat, (from + this.#offset) / 1000),\n\t\t\t'#TO#': DateTimeFormat.format(timeFormat, (to + this.#offset) / 1000),\n\t\t});\n\t}\n\n\tget #draggedBooking(): BookingModel | null\n\t{\n\t\treturn Core.getStore().getters[`${Model.Bookings}/getById`](this.#draggedBookingId) ?? null;\n\t}\n\n\tget #draggedDataTransfer(): DraggedDataTransfer\n\t{\n\t\treturn Core.getStore().getters[`${Model.Interface}/draggedDataTransfer`];\n\t}\n\n\tget #draggedBookingId(): number\n\t{\n\t\treturn Core.getStore().getters[`${Model.Interface}/draggedBookingId`];\n\t}\n\n\tget #draggedBookingResourceId(): number\n\t{\n\t\treturn Core.getStore().getters[`${Model.Interface}/draggedBookingResourceId`];\n\t}\n\n\tget #hoveredCell(): CellDto\n\t{\n\t\treturn Core.getStore().getters[`${Model.Interface}/hoveredCell`];\n\t}\n\n\tget #offset(): number\n\t{\n\t\treturn Core.getStore().getters[`${Model.Interface}/offset`];\n\t}\n\n\tget #gridWrap(): HTMLElement\n\t{\n\t\treturn BX('booking-booking-grid-wrap');\n\t}\n\n\tget #gridColumns(): HTMLElement\n\t{\n\t\treturn BX('booking-booking-grid-columns');\n\t}\n}\n"],"names":["Drag","constructor","params","element","Draggable","container","draggable","elementsPreventingDrag","delay","subscribe","bind","destroy","event","source","dataset","clientX","clientY","getData","kind","parseInt","id","Core","getStore","dispatch","Model","Interface","resourceId","Dom","style","forEach","clone","Runtime","append","translateX","getBoundingClientRect","left","translateY","top","contains","addClass","transformOriginX","transformOriginY","PopupManager","getPopups","popup","close","busySlots","loadBusySlots","Type","isNull","index","removeClass","DraggedElementKind","Booking","querySelectorAll","time","innerText","clearInterval","scrollTimeout","booking","cell","WaitListItem","items","length","x","y","clearTimeout","gridRect","draggableRect","setTimeout","scrollLeft","right","scrollTop","bottom","a","b","Math","floor","sqrt","abs","document","elementFromPoint","closest","fromTs","dateFromTs","toTs","dateToTs","resourceIds","resourcesIds","includes","filter","bookingService","update","Set","timezoneFrom","timezoneTo","$store","waitListItemId","waitListItem","getters","WaitList","resource","Resources","timezone","slotRanges","clients","intersections","result","createFromWaitListItem","primaryClient","undefined","externalData","name","note","success","BookingAnalytics","sendAddBooking","isOverbooking","Promise","all","timeFormat","DateTimeFormat","getFormat","from","to","Loc","getMessage","format","Bookings","BX"],"mappings":"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"}