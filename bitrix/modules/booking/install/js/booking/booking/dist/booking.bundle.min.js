this.BX=this.BX||{};(function(t,e,o,i,s,n,r,a,d,l,c,u,h,m,p,g,b,f,I,k,v,B,T,y,w,M,E,S,C,L,O,D,P,$,F,N,_,R,A,H,z,G,x,K,W,U,q,X,V,j,Y,Z,Q,J,tt,et,ot,it,st,nt,rt,at,dt,lt,ct,ut,ht,mt,pt,gt,bt,ft){"use strict";const It=50;const kt="--booking-off-hours-cell-height";const vt="--booking-booking-collapse";const Bt="--booking-booking-expand";var Tt=babelHelpers.classPrivateFieldLooseKey("animation");var yt=babelHelpers.classPrivateFieldLooseKey("container");var wt=babelHelpers.classPrivateFieldLooseKey("content");var Mt=babelHelpers.classPrivateFieldLooseKey("gridWrap");var Et=babelHelpers.classPrivateFieldLooseKey("fromHour");var St=babelHelpers.classPrivateFieldLooseKey("toHour");class Ct{constructor(){Object.defineProperty(this,St,{get:$t,set:void 0});Object.defineProperty(this,Et,{get:Pt,set:void 0});Object.defineProperty(this,Mt,{get:Dt,set:void 0});Object.defineProperty(this,wt,{get:Ot,set:void 0});Object.defineProperty(this,yt,{get:Lt,set:void 0});Object.defineProperty(this,Tt,{writable:true,value:void 0})}expand({keepScroll:t}){ht.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,yt)[yt],vt);ht.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,yt)[yt],Bt);this.animate(0,It,t)}collapse(){ht.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,yt)[yt],Bt);ht.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,yt)[yt],vt);this.animate(It,0,true)}animate(t,e,o=false){var i;const s=babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt].scrollTop;const n=babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt].scrollHeight;const r=babelHelpers.classPrivateFieldLooseBase(this,Et)[Et]/(24-(babelHelpers.classPrivateFieldLooseBase(this,St)[St]-babelHelpers.classPrivateFieldLooseBase(this,Et)[Et]));(i=babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt])==null?void 0:i.stop();babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt]=new BX.easing({duration:200,start:{height:t},finish:{height:e},step:({height:t})=>{ht.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,wt)[wt],kt,`calc(var(--zoom) * ${t}px)`);if(o){const t=babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt].scrollHeight-n;babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt].scrollTop=s+t*r}}});babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt].animate()}setExpanded(t){const e=babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt].scrollTop;const o=babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt].scrollHeight;const i=babelHelpers.classPrivateFieldLooseBase(this,Et)[Et]/(24-(babelHelpers.classPrivateFieldLooseBase(this,St)[St]-babelHelpers.classPrivateFieldLooseBase(this,Et)[Et]));const s=t?It:0;const n=t?Bt:vt;ht.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,yt)[yt],[vt,Bt]);ht.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,yt)[yt],n);ht.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,wt)[wt],kt,`calc(var(--zoom) * ${s}px)`);const r=babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt].scrollHeight-o;babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt].scrollTop=e+r*i;void S.Core.getStore().dispatch(`${bt.Model.Interface}/setOffHoursExpanded`,t)}}function Lt(){return S.Core.getParams().container}function Ot(){return BX("booking-content")}function Dt(){return BX("booking-booking-grid-wrap")}function Pt(){return S.Core.getStore().getters["interface/fromHour"]}function $t(){return S.Core.getStore().getters["interface/toHour"]}const Ft=new Ct;const Nt=Object.freeze({NotConfirmed:"booking-filter-preset-unconfirmed",Delayed:"booking-filter-preset-delayed",CreatedByMe:"booking-filter-preset-created-by-me"});const _t=Object.freeze({CreatedBy:"CREATED_BY",Contact:"CONTACT",Company:"COMPANY",Resource:"RESOURCE",Confirmed:"CONFIRMED",Delayed:"DELAYED"});const Rt={emits:["apply","clear"],props:{filterId:{type:String,required:true}},data(){return{filter:null}},created(){this.filter=BX.Main.filterManager.getById(this.filterId);r.EventEmitter.subscribe("BX.Main.Filter:beforeApply",this.onBeforeApply)},methods:{onBeforeApply(t){const[e]=t.getData();if(e!==this.filterId){return}if(this.isFilterEmpty()){this.$emit("clear")}else{this.$emit("apply")}},setPresetId(t){if(this.getPresetId()===t){return}this.filter.getApi().setFilter({preset_id:t})},getPresetId(){const t=this.filter.getPreset().getCurrentPresetId();return t==="tmp_filter"?null:t},isFilterEmpty(){return Object.keys(this.getFields()).length===0},getFields(){const t=[_t.Confirmed,_t.Delayed];const e=[_t.Company,_t.Contact,_t.CreatedBy,_t.Resource];const o=this.filter.getFilterFieldsValues();const i=t.filter((t=>["Y","N"].includes(o[t]))).reduce(((t,e)=>({...t,[e]:o[e]})),{});e.forEach((t=>{var e;if(((e=o[t])==null?void 0:e.length)>0){i[t]=o[t]}}));return i}},template:`\n\t\t<div></div>\n\t`};const At=Object.freeze({NotConfirmed:"not-confirmed",Delayed:"delayed"});const Ht={emits:["activeItem"],props:{target:HTMLElement},mounted(){this.addCounterPanel();r.EventEmitter.subscribe("BX.UI.CounterPanel.Item:activate",this.onActiveItem);r.EventEmitter.subscribe("BX.UI.CounterPanel.Item:deactivate",this.onActiveItem)},computed:ut.mapGetters({counters:"counters/get"}),methods:{setItem(t){if(this.getActiveItem()===t){return}Object.values(At).forEach((t=>this.counterPanel.getItemById(t).deactivate()));const e=this.counterPanel.getItemById(t);e==null?void 0:e.activate()},addCounterPanel(){this.counterPanel=new a.CounterPanel({target:this.target,items:[{id:At.NotConfirmed,title:this.loc("BOOKING_BOOKING_COUNTER_PANEL_NOT_CONFIRMED"),value:this.counters.unConfirmed,color:zt(d.CounterColor,d.CounterColor.THEME)},{id:At.Delayed,title:this.loc("BOOKING_BOOKING_COUNTER_PANEL_DELAYED"),value:this.counters.delayed}]});this.counterPanel.init()},onActiveItem(){this.$emit("activeItem",this.getActiveItem())},getActiveItem(){var t,e;return(t=(e=this.counterPanel.getItems().find((({isActive:t})=>t)))==null?void 0:e.id)!=null?t:null}},watch:{counters(t){this.counterPanel.getItems().forEach((e=>{if(e.id===At.NotConfirmed){e.updateColor(zt(d.CounterColor,d.CounterColor.DANGER));e.updateValue(t.unConfirmed)}if(e.id===At.Delayed){e.updateColor(zt(d.CounterColor,d.CounterColor.DANGER));e.updateValue(t.delayed)}}))}},template:`\n\t\t<div v-if="false"></div>\n\t`};const zt=(t,e)=>Object.entries(t).find((([,t])=>t===e))[0];const Gt={props:{value:{type:Number,required:true},valueFormatted:{type:String,required:true},increasedValue:{type:Number,required:true},increasedValueFormatted:{type:String,required:true},popupId:{type:String,required:true},title:{type:String,required:true},rows:{type:Array,required:true},button:{type:Object,required:false}},data(){return{isPopupShown:false}},methods:{onMouseEnter(){this.clearTimeouts();this.showTimeout=setTimeout((()=>this.showPopup()),100)},onMouseLeave(){ht.Event.unbind(document,"mouseover",this.updateHoverElement);ht.Event.bind(document,"mouseover",this.updateHoverElement);this.clearTimeouts();if(!this.button){this.closePopup();return}this.closeTimeout=setTimeout((()=>{var t;this.popupContainer=document.getElementById(this.popupId);if(!((t=this.popupContainer)!=null&&t.contains(this.hoverElement))&&!this.$refs.container.contains(this.hoverElement)){this.closePopup()}if(this.popupContainer){ht.Event.unbind(this.popupContainer,"mouseleave",this.onMouseLeave);ht.Event.bind(this.popupContainer,"mouseleave",this.onMouseLeave)}}),100)},updateHoverElement(t){this.hoverElement=t.target},showPopup(){this.clearTimeouts();this.isPopupShown=true},closePopup(){this.clearTimeouts();this.isPopupShown=false;ht.Event.unbind(this.popupContainer,"mouseleave",this.onMouseLeave);ht.Event.unbind(document,"mouseover",this.updateHoverElement)},clearTimeouts(){clearTimeout(this.closeTimeout);clearTimeout(this.showTimeout)},close(){this.closePopup();this.$emit("close")}},watch:{value(){var t;(t=this.$refs.animation)==null?void 0:t.replaceWith(this.$refs.animation)}},components:{StatisticsPopup:H.StatisticsPopup},template:`\n\t\t<div class="booking-toolbar-after-title-info-profit-container" ref="container">\n\t\t\t<div\n\t\t\t\tv-html="valueFormatted"\n\t\t\t\tclass="booking-toolbar-after-title-info-profit"\n\t\t\t\t@click="showPopup"\n\t\t\t\t@mouseenter="onMouseEnter"\n\t\t\t\t@mouseleave="onMouseLeave"\n\t\t\t></div>\n\t\t\t<div\n\t\t\t\tv-if="increasedValue > 0"\n\t\t\t\tv-html="increasedValueFormatted"\n\t\t\t\tclass="booking-toolbar-after-title-profit-increased"\n\t\t\t\tref="animation"\n\t\t\t></div>\n\t\t</div>\n\t\t<StatisticsPopup\n\t\t\tv-if="isPopupShown"\n\t\t\t:popupId="popupId"\n\t\t\t:bindElement="$refs.container"\n\t\t\t:title="title"\n\t\t\t:rows="rows"\n\t\t\t:button="button"\n\t\t\t@close="close"\n\t\t/>\n\t`};const xt={data(){return{increasedValue:0}},computed:{...ut.mapGetters({totalNewClientsToday:`${bt.Model.Interface}/totalNewClientsToday`,totalClients:`${bt.Model.Interface}/totalClients`}),popupId(){return"booking-booking-after-title-clients-popup"},title(){return this.loc("BOOKING_BOOKING_AFTER_TITLE_CLIENTS_POPUP_TITLE")},rows(){return[{title:this.loc("BOOKING_BOOKING_AFTER_TITLE_CLIENTS_POPUP_TOTAL_CLIENTS_TODAY"),value:`+${this.totalNewClientsToday}`},{title:this.loc("BOOKING_BOOKING_AFTER_TITLE_CLIENTS_POPUP_TOTAL_CLIENTS"),value:`<div>${this.totalClients}</div>`}]},button(){return{title:this.loc("BOOKING_BOOKING_CLIENTS_LIST"),click:()=>BX.SidePanel.Instance.open("/crm/contact/list/")}},clientsProfitFormatted(){return ht.Loc.getMessagePlural("BOOKING_BOOKING_PLUS_NUM_CLIENTS",this.totalNewClientsToday,{"#NUM#":this.totalNewClientsToday})},increasedValueFormatted(){return ht.Loc.getMessagePlural("BOOKING_BOOKING_PLUS_NUM_CLIENTS",this.increasedValue,{"#NUM#":this.increasedValue})}},watch:{totalNewClientsToday(t,e){this.increasedValue=t-e}},components:{Statistics:Gt},template:`\n\t\t<Statistics\n\t\t\t:value="totalNewClientsToday"\n\t\t\t:valueFormatted="clientsProfitFormatted"\n\t\t\t:increasedValue="increasedValue"\n\t\t\t:increasedValueFormatted="increasedValueFormatted"\n\t\t\t:popupId="popupId"\n\t\t\t:title="title"\n\t\t\t:rows="rows"\n\t\t\t:button="button"\n\t\t/>\n\t`};const Kt={data(){return{increasedValue:0}},computed:{...ut.mapGetters({moneyStatistics:`${bt.Model.Interface}/moneyStatistics`}),popupId(){return"booking-booking-after-title-profit-popup"},title(){return this.loc("BOOKING_BOOKING_AFTER_TITLE_PROFIT_POPUP_TITLE")},rows(){var t,e,o,i;const s=(t=(e=this.moneyStatistics)==null?void 0:(o=e.month)==null?void 0:(i=o.filter((({currencyId:t})=>t!==this.baseCurrencyId)))==null?void 0:i.map((({currencyId:t})=>t)))!=null?t:[];return[this.getTodayRow(this.baseCurrencyId),...s.map((t=>this.getTodayRow(t))),this.getMonthRow(this.baseCurrencyId),...s.map((t=>this.getMonthRow(t)))]},todayProfit(){return this.getTodayProfit(this.moneyStatistics)},todayProfitFormatted(){return this.formatTodayProfit(this.todayProfit)},increasedValueFormatted(){return this.formatTodayProfit(this.increasedValue)},baseCurrencyId(){return A.currencyFormat.getBaseCurrencyId()}},methods:{getTodayRow(t){const e=this.loc("BOOKING_BOOKING_AFTER_TITLE_PROFIT_POPUP_TOTAL_TODAY");return{title:t===this.baseCurrencyId?e:"",value:`+${this.getTodayProfitFormatted(t)}`}},getMonthRow(t){const e=this.loc("BOOKING_BOOKING_AFTER_TITLE_PROFIT_POPUP_MONTH",{"#MONTH#":nt.DateTimeFormat.format("f")});return{title:t===this.baseCurrencyId?e:"",value:`<div>${this.getMonthProfitFormatted(t)}</div>`}},getTodayProfitFormatted(t){var e,o,i;const s=(e=this.moneyStatistics)==null?void 0:(o=e.today)==null?void 0:o.find((({currencyId:e})=>e===t));const n=(i=s==null?void 0:s.opportunity)!=null?i:0;return A.currencyFormat.format(t,n)},getMonthProfitFormatted(t){var e,o,i;const s=(e=this.moneyStatistics)==null?void 0:(o=e.month)==null?void 0:o.find((({currencyId:e})=>e===t));const n=(i=s==null?void 0:s.opportunity)!=null?i:0;return A.currencyFormat.format(t,n)},getTodayProfit(t){var e,o;const i=t==null?void 0:(e=t.today)==null?void 0:e.find((({currencyId:t})=>t===this.baseCurrencyId));return(o=i==null?void 0:i.opportunity)!=null?o:0},formatTodayProfit(t){return`+ <span>${A.currencyFormat.format(this.baseCurrencyId,t)}</span>`}},watch:{moneyStatistics(t,e){this.increasedValue=this.getTodayProfit(t)-this.getTodayProfit(e)}},components:{Statistics:Gt},template:`\n\t\t<Statistics\n\t\t\t:value="todayProfit"\n\t\t\t:valueFormatted="todayProfitFormatted"\n\t\t\t:increasedValue="increasedValue"\n\t\t\t:increasedValueFormatted="increasedValueFormatted"\n\t\t\t:popupId="popupId"\n\t\t\t:title="title"\n\t\t\t:rows="rows"\n\t\t/>\n\t`};const Wt={computed:{dateFormatted(){const t=nt.DateTimeFormat.getFormat("DAY_SHORT_MONTH_FORMAT");return nt.DateTimeFormat.format(t,Date.now()/1e3)}},components:{Clients:xt,Profit:Kt},template:`\n\t\t<div class="booking-toolbar-after-title">\n\t\t\t<div class="booking-toolbar-after-title-date" ref="date">\n\t\t\t\t{{ dateFormatted }}\n\t\t\t</div>\n\t\t\t<div class="booking-toolbar-after-title-info">\n\t\t\t\t<Clients/>\n\t\t\t\t<Profit/>\n\t\t\t</div>\n\t\t</div>\n\t`};const Ut=ht.Extension.getSettings("booking.booking").webForms;const qt={components:{UiButton:dt.Button,BMenu:l.BMenu},props:{container:{type:HTMLElement,required:true}},setup(){return{ButtonColor:dt.ButtonColor,ButtonSize:dt.ButtonSize,ButtonIcon:dt.ButtonIcon}},data(){return{isMenuShown:false}},computed:{...ut.mapGetters({expanded:`${bt.Model.Interface}/expanded`}),menuOptions(){const t="create";return{id:"booking-settings-menu",bindElement:this.$refs.button.$el,offsetTop:8,sections:[{code:t}],items:[{title:this.loc("BOOKING_TOP_MENU_ITEM_FORMS_ALL_FORMS"),onClick:this.openAllForms},{sectionCode:t,title:this.loc("BOOKING_TOP_MENU_ITEM_FORMS_CREATE_FORM"),subMenu:{items:Ut.presets.map((t=>({title:t.NAME,onClick:()=>this.createFormFromPreset(t.LINK)})))}}]}}},mounted(){this.container.replaceWith(this.$refs.button.$el)},methods:{handleClick(){this.isMenuShown=true},openAllForms(){BX.SidePanel.Instance.open(Ut.link,{cacheable:false})},createFormFromPreset(t){window.open(t,"_blank")}},template:`\n\t\t<UiButton\n\t\t\tv-show="expanded"\n\t\t\tbuttonClass="ui-btn-themes"\n\t\t\t:color="ButtonColor.LIGHT_BORDER"\n\t\t\t:size="ButtonSize.SMALL"\n\t\t\t:icon="ButtonIcon.DOTS"\n\t\t\tref="button"\n\t\t\t@click="handleClick"\n\t\t/>\n\t\t<BMenu v-if="isMenuShown" :options="menuOptions" @close="isMenuShown = false"/>\n\t`};const Xt={props:{bottom:{type:Boolean,default:false}},computed:{...ut.mapGetters({offHoursHover:"interface/offHoursHover",offHoursExpanded:"interface/offHoursExpanded",fromHour:"interface/fromHour",toHour:"interface/toHour"}),fromFormatted(){if(this.bottom){return this.formatHour(this.toHour)}return this.formatHour(0)},toFormatted(){if(this.bottom){return this.formatHour(24)}return this.formatHour(this.fromHour)}},methods:{formatHour(t){const e=nt.DateTimeFormat.getFormat("SHORT_TIME_FORMAT");const o=(new Date).setHours(t,0)/1e3;return nt.DateTimeFormat.format(e,o)},animateOffHours({keepScroll:t}){if(this.offHoursExpanded){Ft.collapse()}else{Ft.expand({keepScroll:t})}void this.$store.dispatch("interface/setOffHoursExpanded",!this.offHoursExpanded)}},template:`\n\t\t<div\n\t\t\tclass="booking-booking-off-hours"\n\t\t\t:class="{'--hover': offHoursHover, '--bottom': bottom, '--top': !bottom}"\n\t\t\t@click="animateOffHours({ keepScroll: bottom })"\n\t\t\t@mouseenter="$store.dispatch('interface/setOffHoursHover', true)"\n\t\t\t@mouseleave="$store.dispatch('interface/setOffHoursHover', false)"\n\t\t>\n\t\t\t<div class="booking-booking-off-hours-border"></div>\n\t\t\t<span>{{ fromFormatted }}</span>\n\t\t\t<span>{{ toFormatted }}</span>\n\t\t</div>\n\t`};const Vt={name:"HelpPopup",components:{RichLoc:u.RichLoc,StickyPopup:T.StickyPopup},emits:["close"],props:{bindElement:{type:HTMLElement,required:true}},computed:{popupId(){return"booking-quick-filter-help-popup"},config(){return{className:"booking-quick-filter-help-popup",bindElement:this.bindElement,offsetLeft:this.bindElement.offsetWidth,offsetTop:this.bindElement.offsetHeight,maxWidth:220}}},methods:{closePopup(){this.$emit("close")}},template:`\n\t\t<StickyPopup\n\t\t\t:id="popupId"\n\t\t\t:config="config"\n\t\t\t@close="closePopup"\n\t\t>\n\t\t\t<div class="booking-quick-filter-help-popup-content">\n\t\t\t\t<div class="booking-quick-filter-help-popup-icon-container">\n\t\t\t\t\t<div class="booking-quick-filter-help-popup-icon"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="booking-quick-filter-help-popup-description">\n\t\t\t\t\t<RichLoc :text="loc('BOOKING_QUICK_FILTER_HELP_MSGVER_1')" placeholder="[bold]">\n\t\t\t\t\t\t<template #bold="{ text }">\n\t\t\t\t\t\t\t<span>{{ text }}</span>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</RichLoc>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</StickyPopup>\n\t`};const jt={props:{hour:{type:Number,required:true}},data(){return{IconSet:j.Set,isHelpPopupShown:false}},computed:{active(){return this.hour in this.$store.getters[`${bt.Model.Interface}/quickFilter`].active},hovered(){return this.hour in this.$store.getters[`${bt.Model.Interface}/quickFilter`].hovered}},methods:{onClick(){this.closeHelpPopup();if(this.active){void this.$store.dispatch(`${bt.Model.Interface}/deactivateQuickFilter`,this.hour)}else{void this.$store.dispatch(`${bt.Model.Interface}/activateQuickFilter`,this.hour)}},hover(){this.helpPopupTimeout=setTimeout((()=>this.showHelpPopup()),1e3);void this.$store.dispatch(`${bt.Model.Interface}/hoverQuickFilter`,this.hour)},flee(){this.closeHelpPopup();void this.$store.dispatch(`${bt.Model.Interface}/fleeQuickFilter`,this.hour)},showHelpPopup(){this.isHelpPopupShown=true},closeHelpPopup(){clearTimeout(this.helpPopupTimeout);this.isHelpPopupShown=false}},components:{Icon:j.BIcon,HelpPopup:Vt},template:`\n\t\t<div\n\t\t\tclass="booking-booking-quick-filter-container"\n\t\t\t:class="{'--hover': hovered || active, '--active': active}"\n\t\t>\n\t\t\t<div\n\t\t\t\tclass="booking-booking-quick-filter"\n\t\t\t\t@mouseenter="hover"\n\t\t\t\t@mouseleave="flee"\n\t\t\t\t@click="onClick"\n\t\t\t>\n\t\t\t\t<Icon :name="active ? IconSet.CROSS_25 : IconSet.FUNNEL"/>\n\t\t\t</div>\n\t\t\t<HelpPopup\n\t\t\t\tv-if="isHelpPopupShown"\n\t\t\t\t:bindElement="$el"\n\t\t\t\t@close="closeHelpPopup"\n\t\t\t/>\n\t\t</div>\n\t`};const Yt={computed:{...ut.mapGetters({offHoursHover:"interface/offHoursHover",offHoursExpanded:"interface/offHoursExpanded",fromHour:"interface/fromHour",toHour:"interface/toHour"}),panelHours(){const t=nt.DateTimeFormat.getFormat("SHORT_TIME_FORMAT");const e=this.offHoursExpanded?24:this.toHour;return E.range(0,24).map((o=>{const i=(new Date).setHours(o,0)/1e3;return{value:o,formatted:nt.DateTimeFormat.format(t,i),offHours:o<this.fromHour||o>=this.toHour,last:o===e}}))}},components:{OffHours:Xt,QuickFilter:jt},template:`\n\t\t<div class="booking-booking-grid-left-panel-container">\n\t\t\t<div class="booking-booking-grid-left-panel">\n\t\t\t\t<OffHours/>\n\t\t\t\t<OffHours :bottom="true"/>\n\t\t\t\t<template v-for="hour of panelHours" :key="hour.value">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="hour.last"\n\t\t\t\t\t\tclass="booking-booking-grid-left-panel-time-text"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ hour.formatted }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="hour.value !== 24"\n\t\t\t\t\t\tclass="booking-booking-grid-left-panel-time"\n\t\t\t\t\t\t:class="{'--off-hours': hour.offHours}"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="booking-booking-grid-left-panel-time-text">\n\t\t\t\t\t\t\t{{ hour.formatted }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<QuickFilter :hour="hour.value"/>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t`};const Zt={data(){return{visible:true}},mounted(){this.updateNowLine();setInterval((()=>this.updateNowLine()),1e3)},computed:ut.mapGetters({zoom:`${bt.Model.Interface}/zoom`,selectedDateTs:`${bt.Model.Interface}/selectedDateTs`,offHoursExpanded:`${bt.Model.Interface}/offHoursExpanded`,fromHour:`${bt.Model.Interface}/fromHour`,toHour:`${bt.Model.Interface}/toHour`,offset:`${bt.Model.Interface}/offset`}),methods:{setVisible(t){this.visible=t;this.updateNowLine()},updateNowLine(){const t=new Date(Date.now()+this.offset);const e=50*this.zoom;const o=this.fromHour*60;const i=t.getHours()*60+t.getMinutes();const s=this.offHoursExpanded?24:this.toHour;const n=Math.min(s*60+21,i);const r=(n-o)*(e/60);ht.Dom.style(this.$refs.nowLine,"top",`${r}px`);const a=nt.DateTimeFormat.getFormat("SHORT_TIME_FORMAT");const d=nt.DateTimeFormat.format(a,t.getTime()/1e3);if(d!==this.$refs.nowText.innerText){this.$refs.nowText.innerText=d}const l=new Date(this.selectedDateTs+this.offset);const c=this.visible&&Date.UTC(l.getFullYear(),l.getMonth(),l.getDate())===Date.UTC(t.getFullYear(),t.getMonth(),t.getDate());ht.Dom.style(this.$refs.nowLine,"display",c?"":"none")}},watch:{selectedDateTs(){this.updateNowLine()},zoom(){this.updateNowLine()},offHoursExpanded(t){const e=new Date;const o=e.getHours()*60+e.getMinutes();if(o<this.toHour*60){return}this.setVisible(!t);setTimeout((()=>this.setVisible(true)),200)}},template:`\n\t\t<div class="booking-booking-grid-now-line" ref="nowLine">\n\t\t\t<div class="booking-booking-grid-now-line-text" ref="nowText"></div>\n\t\t</div>\n\t`};const Qt={name:"BookingActionsPopupClient",props:{bookingId:{type:[Number,String],required:true}},emits:["freeze","unfreeze"],computed:{booking(){return this.$store.getters["bookings/getById"](this.bookingId)}},methods:{async addClients({clients:t}){await ot.bookingService.update({id:this.booking.id,clients:t})},async updateClients({clients:t}){await ot.bookingService.update({id:this.booking.id,clients:t})},async updateNote({note:t}){await ot.bookingService.update({id:this.booking.id,note:t})}},components:{Client:O.Client},template:`\n\t\t<Client\n\t\t\t:id="bookingId"\n\t\t\t:clients="booking.clients"\n\t\t\t:primaryClientData="booking.primaryClient"\n\t\t\t:note="booking.note"\n\t\t\t:dataId="bookingId"\n\t\t\t:dataAttributes="{\n\t\t\t\t'data-booking-id': bookingId,\n\t\t\t}"\n\t\t\tdataElementPrefix="booking"\n\t\t\t@freeze="$emit('freeze')"\n\t\t\t@unfreeze="$emit('unfreeze')"\n\t\t\t@addClients="addClients"\n\t\t\t@updateClients="updateClients"\n\t\t\t@updateNote="updateNote"\n\t\t/>\n\t`};const Jt={name:"BookingActionsPopupDeal",components:{Deal:O.Deal},props:{bookingId:{type:[Number,String],required:true}},emits:["freeze","unfreeze"],setup(t){const e=new P.BookingDealHelper(t.bookingId);return{dealHelper:e}},computed:{booking(){return this.$store.getters[`${bt.Model.Bookings}/getById`](this.bookingId)},deal(){var t,e;return(t=(e=this.booking.externalData)==null?void 0:e.find((t=>t.entityTypeId===bt.CrmEntity.Deal)))!=null?t:null}},template:`\n\t\t<Deal\n\t\t\t:deal="deal"\n\t\t\t:dealHelper="dealHelper"\n\t\t\t:dataId="booking.id"\n\t\t\t:dataAttributes="{\n\t\t\t\t'data-booking-id': bookingId,\n\t\t\t}"\n\t\t\tdataElementPrefix="booking"\n\t\t\t@freeze="$emit('freeze')"\n\t\t\t@unfreeze="$emit('unfreeze')"\n\t\t/>\n\t`};const te={name:"BookingActionsPopupDocument",props:{bookingId:{type:[Number,String],required:true}},data(){return{isLoading:true}},async mounted(){await m.bookingActionsService.getDocData();this.isLoading=false},components:{Document:O.Document},template:`\n\t\t<Document\n\t\t\t:id="bookingId"\n\t\t\t:loading="isLoading"\n\t\t\tdisabled\n\t\t/>\n\t`};const ee={name:"BookingActionsPopupMessage",emits:["freeze","unfreeze"],props:{bookingId:{type:Number,required:true}},data(){return{isLoading:true,isPrimaryClientIdUpdated:false}},mounted(){void this.fetchMessageData()},computed:{...ut.mapGetters({isCurrentSenderAvailable:`${bt.Model.Interface}/isCurrentSenderAvailable`}),booking(){return this.$store.getters["bookings/getById"](this.bookingId)},client(){const t=this.booking.primaryClient;return t?this.$store.getters["clients/getByClientData"](t):null},clientId(){var t;return(t=this.booking.primaryClient)==null?void 0:t.id},updatedAt(){return this.booking.updatedAt}},watch:{clientId(){this.isPrimaryClientIdUpdated=true},updatedAt(){if(this.isPrimaryClientIdUpdated&&this.isCurrentSenderAvailable){void this.fetchMessageData();this.isPrimaryClientIdUpdated=false}}},methods:{async sendMessage({notificationType:t}){try{await m.bookingActionsService.sendMessage(this.bookingId,t);void this.fetchMessageData()}catch(t){if(ht.Type.isArrayFilled(t.errors)){h.Notifier.notify({id:"booking-message-send-error",text:t.errors[0].message})}}},async fetchMessageData(){this.isLoading=true;await m.bookingActionsService.getMessageData(this.bookingId);this.isLoading=false}},components:{Message:O.Message},template:`\n\t\t<Message\n\t\t\t:id="bookingId"\n\t\t\t:clientData="booking.primaryClient"\n\t\t\t:loading="isLoading"\n\t\t\t:dataId="bookingId"\n\t\t\tdataElementPrefix="booking"\n\t\t\t@open="$emit('freeze')"\n\t\t\t@close="$emit('unfreeze')"\n\t\t\t@updateNotificationType="sendMessage"\n\t\t/>\n\t`};const oe={emits:["freeze","unfreeze"],name:"BookingActionsPopupConfirmation",props:{bookingId:{type:[Number,String],required:true}},computed:{booking(){return this.$store.getters[`${bt.Model.Bookings}/getById`](this.bookingId)}},methods:{updateConfirmationStatus({isConfirmed:t}){void ot.bookingService.update({id:this.booking.id,isConfirmed:t})}},components:{Confirmation:O.Confirmation},template:`\n\t\t<Confirmation\n\t\t\t:id="bookingId"\n\t\t\t:isConfirmed="booking.isConfirmed"\n\t\t\t:counters="booking.counters"\n\t\t\t:dataId="booking.id"\n\t\t\tdataElementPrefix="booking"\n\t\t\t@open="$emit('freeze')"\n\t\t\t@close="$emit('unfreeze')"\n\t\t\t@updateConfirmationStatus="updateConfirmationStatus"\n\t\t/>\n\t`};const ie={emits:["freeze","unfreeze"],name:"BookingActionsPopupVisit",props:{bookingId:{type:[Number,String],required:true}},computed:{booking(){return this.$store.getters[`${bt.Model.Bookings}/getById`](this.bookingId)}},methods:{updateVisitStatus({visitStatus:t}){void ot.bookingService.update({id:this.booking.id,visitStatus:t})}},components:{Icon:j.BIcon,Loader:p.Loader,Visit:O.Visit},template:`\n\t\t<Visit\n\t\t\t:id="booking.id"\n\t\t\t:visitStatus="booking.visitStatus"\n\t\t\t:dataId="booking.id"\n\t\t\tdataElementPrefix="booking"\n\t\t\t:hasClients="booking.clients.length > 0"\n\t\t\t@freeze="$emit('freeze')"\n\t\t\t@unfreeze="$emit('unfreeze')"\n\t\t\t@update:visitStatus="updateVisitStatus"\n\t\t/>\n\t`};const se={name:"BookingActionsPopupOverbooking",components:{Icon:j.BIcon},directives:{hint:g.hint},props:{bookingId:{type:[Number,String],required:true},resourceId:{type:Number,required:true},disabled:{type:Boolean,default:false}},emits:["close"],setup(t){const e=j.Set.PLUS_20;const o=20;const i=mt.computed((()=>t.disabled?"var(--ui-color-palette-gray-20)":"var(--ui-color-palette-gray-60)"));return{plusIcon:e,plusIconSize:o,plusIconColor:i}},computed:{...ut.mapGetters({getBookingById:`${bt.Model.Bookings}/getById`,dictionary:`${bt.Model.Dictionary}/getBookingVisitStatuses`,isFeatureEnabled:`${bt.Model.Interface}/isFeatureEnabled`,timezone:`${bt.Model.Interface}/timezone`,embedItems:`${bt.Model.Interface}/embedItems`}),booking(){return this.getBookingById(this.bookingId)},hasOverbookingHint(){if(!this.disabled){return undefined}return{text:this.loc("BB_ACTIONS_POPUP_OVERBOOKING_DISABLED_HINT")}},clients(){const t=this.embedItems.filter((t=>t.entityTypeId==="CONTACT"||t.entityTypeId==="COMPANY"));return t.map((t=>({id:t.value,type:{code:t.entityTypeId,module:t.moduleId}})))}},methods:{async addOverbooking(){if(this.disabled){return}if(!this.isFeatureEnabled){et.limit.show();return}const t={...this.booking,id:ht.Text.getRandom(10),clients:this.clients,counter:0,counters:[],createdAt:Date.now(),externalData:this.embedItems,isConfirmed:false,name:null,note:null,resourcesIds:[this.resourceId],primaryClient:undefined,rrule:null,timezoneFrom:this.timezone,timezoneTo:this.timezone,updatedAt:Date.now(),visitStatus:this.dictionary.Unknown};delete t.name;const e=await ot.bookingService.add(t);if(e.success&&e.booking){lt.BookingAnalytics.sendAddBooking({isOverbooking:true})}this.$emit("close")}},template:`\n\t\t<div\n\t\t\tv-hint="hasOverbookingHint"\n\t\t\tclass="booking-actions-popup__item-overbooking-button"\n\t\t\t:class="{'--disabled': disabled}"\n\t\t\trole="button"\n\t\t\ttabindex="0"\n\t\t\t@click="addOverbooking"\n\t\t>\n\t\t\t<Icon :name="plusIcon" :size="plusIconSize" :color="plusIconColor"/>\n\t\t\t<div class="booking-actions-popup__item-overbooking-label">\n\t\t\t\t{{ loc('BB_ACTIONS_POPUP_OVERBOOKING_LABEL') }}\n\t\t\t</div>\n\t\t</div>\n\t`};const ne={name:"BookingActionsPopupWaitlist",components:{Icon:j.BIcon},props:{bookingId:{type:[Number,String],required:true}},computed:{...ut.mapGetters({getBookingById:`${bt.Model.Bookings}/getById`}),clockIcon(){return j.Set.BLACK_CLOCK},disabled(){return!L.isRealId(this.bookingId)}},methods:{async toWaitList(){if(this.disabled){return}const t=this.bookingId;const e=this.getBookingById(t);await this.$store.dispatch(`${bt.Model.Interface}/addDeletingBooking`,t);const o=await N.waitListService.createFromBooking(t,{id:`tmp-id-${Date.now()}-${ht.Text.getRandom(4)}`,clients:e.clients,primaryClient:e.primaryClient,externalData:e.externalData,createdAt:Date.now(),updatedAt:Date.now()});if(o.success&&o.waitListItem){lt.BookingAnalytics.sendAddWaitListItem()}}},template:`\n\t\t<div\n\t\t\tclass="booking--booking-actions-popup__item-waitlist-btn --end"\n\t\t\t:class="{'--disabled': disabled}"\n\t\t\t@click="toWaitList">\n\t\t\t<Icon :name="clockIcon" :size="20" color="var(--ui-color-palette-gray-60)"/>\n\t\t\t<div class="booking-actions-popup__item-waitlist-label">\n\t\t\t\t{{ loc('BB_ACTIONS_POPUP_OVERBOOKING_LIST') }}\n\t\t\t</div>\n\t\t</div>\n\t`};function re(t,{emit:e}){const o=t.bookingId;const i=()=>{e("close");new _.RemoveBooking(o)};return mt.h(O.RemoveButton,{dataAttributes:{"data-booking-id":o,"data-element":"booking-menu-remove-button"},onRemove:i})}const ae=["bookingId"];re.props=ae;re.emits=["close"];const de=Object.freeze({client:"client",confirmation:"confirmation",deal:"deal",document:"document",fullForm:"fullForm",message:"message",visit:"visit",overbooking:"overbooking",remove:"remove",waitList:"waitList"});const le={name:"BookingActionsPopup",components:{ActionsPopup:O.ActionsPopup,Overbooking:se,Waitlist:ne,BookingRemoveBtn:re},props:{bindElement:{type:HTMLElement,required:true},bookingId:{type:[Number,String],required:true},resourceId:{type:Number,required:true},options:{type:Object,default:null}},emits:["close"],data(){return{soonTmp:false}},computed:{config(){return{offsetLeft:this.getOffsetLeft(),offsetTop:-200}},contentStructure(){return[{id:de.client,props:{bookingId:this.bookingId},component:Qt},[{id:de.deal,props:{bookingId:this.bookingId},component:Jt},{id:de.document,props:{bookingId:this.bookingId},component:te}],{id:de.message,props:{bookingId:this.bookingId},component:ee},{id:de.confirmation,props:{bookingId:this.bookingId},component:oe},{id:de.visit,props:{bookingId:this.bookingId},component:ie},[{id:de.fullForm,props:{bookingId:this.bookingId},component:O.FullForm},{id:de.info,class:"--shrink",props:{bookingId:this.bookingId},component:O.Info}]]},booking(){return this.$store.getters[`${bt.Model.Bookings}/getById`](this.bookingId)}},methods:{getOffsetLeft(){const{left:t}=this.bindElement.getBoundingClientRect();if(window.innerWidth-t<325){return-325}return this.bindElement.offsetWidth}},template:`\n\t\t<ActionsPopup\n\t\t\t:popupId="bookingId"\n\t\t\t:bindElement="bindElement"\n\t\t\t:contentStructure="contentStructure"\n\t\t\t:popupOptions="config"\n\t\t\t@close="$emit('close')"\n\t\t>\n\t\t\t<template #footer>\n\t\t\t\t<Overbooking\n\t\t\t\t\tv-if="!options?.overbooking?.hidden"\n\t\t\t\t\t:bookingId\n\t\t\t\t\t:resourceId\n\t\t\t\t\t:disabled="Boolean(options?.overbooking?.disabled)"\n\t\t\t\t\t@close="$emit('close')"\n\t\t\t\t/>\n\t\t\t\t<Waitlist :bookingId/>\n\t\t\t\t<BookingRemoveBtn :bookingId @close="$emit('close')"/>\n\t\t\t</template>\n\t\t</ActionsPopup>\n\t`};const ce={name:"BookingActions",props:{bookingId:{type:[Number,String],required:true},resourceId:{type:Number,required:true},actionsPopupOptions:{type:Object,default:null}},data(){return{showPopup:false}},mounted(){if(this.isEditingBookingMode&&this.editingBookingId===this.bookingId){this.showPopup=true}},computed:ut.mapGetters({editingBookingId:`${bt.Model.Interface}/editingBookingId`,isEditingBookingMode:`${bt.Model.Interface}/isEditingBookingMode`}),methods:{clickHandler(){this.showPopup=true}},components:{BookingActionsPopup:le},template:`\n\t\t<div \n\t\t\tref="node"\n\t\t\tclass="booking-booking-booking-actions"\n\t\t\tdata-element="booking-booking-actions-button"\n\t\t\t:data-id="bookingId"\n\t\t\t:data-resource-id="resourceId"\n\t\t\t@click="clickHandler"\n\t\t>\n\t\t\t<div class="booking-booking-booking-actions-inner">\n\t\t\t\t<div class="ui-icon-set --chevron-down"></div>\n\t\t\t</div>\n\t\t</div>\n\t\t<BookingActionsPopup\n\t\t\tv-if="showPopup"\n\t\t\t:bookingId\n\t\t\t:bindElement="this.$refs.node"\n\t\t\t:resourceId\n\t\t\t:options="actionsPopupOptions"\n\t\t\t@close="showPopup = false"\n\t\t/>\n\t`};const ue={name:"BookingAddClient",props:{bookingId:{type:[Number,String],required:true},resourceId:{type:Number,required:true},expired:{type:Boolean,default:false}},computed:{...ut.mapGetters({getBookingById:`${bt.Model.Bookings}/getById`})},mounted(){if(L.isRealId(this.bookingId)){ft.ahaMoments.setBookingForAhaMoment(this.bookingId)}if(ft.ahaMoments.shouldShow(bt.AhaMoment.AddClient,{bookingId:this.bookingId})){void this.showAhaMoment()}},methods:{async addClientsToBook(t){const e=this.getBookingById(this.bookingId);await ot.bookingService.update({id:e.id,clients:t})},async showAhaMoment(){var t,e;await ft.ahaMoments.show({id:"booking-add-client",title:this.loc("BOOKING_AHA_ADD_CLIENT_TITLE"),text:this.loc("BOOKING_AHA_ADD_CLIENT_TEXT_MSGVER_1"),target:(t=this.$refs.bookingAddClientBtn)==null?void 0:(e=t.$refs)==null?void 0:e.button});ft.ahaMoments.setShown(bt.AhaMoment.AddClient)}},components:{AddClient:D.AddClient},template:`\n\t\t<AddClient\n\t\t\t:expired="expired"\n\t\t\t:dataAttributes="{\n\t\t\t\t'data-id': bookingId,\n\t\t\t\t'data-element': 'booking-add-client-button',\n\t\t\t\t'data-resource-id': resourceId,\n\t\t\t}"\n\t\t\tbuttonClass="booking-booking-booking-add-client"\n\t\t\tref="bookingAddClientBtn"\n\t\t\t@add="addClientsToBook"\n\t\t/>\n\t`};const he={name:"ChangeTimePopup",emits:["close"],props:{bookingId:{type:[Number,String],required:true},resourceId:{type:Number,required:true},targetNode:{type:HTMLElement,required:true}},data(){return{ButtonSize:dt.ButtonSize,ButtonColor:dt.ButtonColor,ButtonIcon:dt.ButtonIcon,fromTs:0,toTs:0,duration:0}},created(){this.fromTs=this.booking.dateFromTs;this.toTs=this.booking.dateToTs;this.duration=this.toTs-this.fromTs},mounted(){ht.Event.bind(document,"scroll",this.adjustPosition,true)},beforeUnmount(){ht.Event.unbind(document,"scroll",this.adjustPosition,true)},computed:{...ut.mapGetters({selectedDateTs:`${bt.Model.Interface}/selectedDateTs`}),popupId(){return`booking-change-time-popup-${this.bookingId}`},config(){return{className:"booking-booking-change-time-popup",bindElement:this.targetNode,offsetTop:-10,bindOptions:{forceBindPosition:true,position:"top"},angle:{offset:this.targetNode.offsetWidth/2}}},isBusy(){const t=this.bookingId;const e=this.bookings.filter((({id:e,dateToTs:o,dateFromTs:i})=>{if(e!==t&&this.overbookingMap.has(e)){var s;const o=this.overbookingMap.get(e);const i=o.items.find((t=>t.resourceId===this.resourceId));const n=(i==null?void 0:(s=i.intersections)==null?void 0:s.filter((e=>e.id!==t&&e.dateToTs>this.fromTs&&this.toTs>e.dateFromTs)))||[];if(i&&n.length===0){return false}}return e!==t&&o>this.fromTs&&this.toTs>i}));return e.length>0},bookings(){return this.$store.getters[`${bt.Model.Bookings}/getByDateAndResources`](this.selectedDateTs,this.booking.resourcesIds)},booking(){return this.$store.getters["bookings/getById"](this.bookingId)},overbookingMap(){return this.$store.getters[`${bt.Model.Bookings}/overbookingMap`]}},methods:{adjustPosition(){this.$refs.popup.adjustPosition();this.$refs.timeFrom.adjustMenuPosition();this.$refs.timeTo.adjustMenuPosition()},closePopup(){const t=this.booking.dateFromTs!==this.fromTs||this.booking.dateToTs!==this.toTs;if(!this.isBusy&&t){void ot.bookingService.update({id:this.booking.id,dateFromTs:this.fromTs,dateToTs:this.toTs,timezoneFrom:this.booking.timezoneFrom,timezoneTo:this.booking.timezoneTo})}this.$emit("close")},freeze(){this.$refs.popup.getPopupInstance().setAutoHide(false)},unfreeze(){this.$refs.popup.getPopupInstance().setAutoHide(true)}},watch:{fromTs(){this.toTs=this.fromTs+this.duration},toTs(){if(this.toTs<=this.fromTs){this.fromTs=this.toTs-this.duration}this.duration=this.toTs-this.fromTs},isBusy(){setTimeout((()=>this.adjustPosition()),0)}},components:{Popup:T.Popup,TimeSelector:f.TimeSelector,Button:dt.Button},template:`\n\t\t<Popup\n\t\t\t:id="popupId"\n\t\t\t:config="config"\n\t\t\t@close="closePopup"\n\t\t\tref="popup"\n\t\t>\n\t\t\t<div class="booking-booking-change-time-popup-content">\n\t\t\t\t<div class="booking-booking-change-time-popup-main">\n\t\t\t\t\t<TimeSelector\n\t\t\t\t\t\tv-model="fromTs"\n\t\t\t\t\t\t:hasError="isBusy"\n\t\t\t\t\t\tdata-element="booking-change-time-from"\n\t\t\t\t\t\t:data-ts="fromTs"\n\t\t\t\t\t\t:data-booking-id="bookingId"\n\t\t\t\t\t\tref="timeFrom"\n\t\t\t\t\t\t@freeze="freeze"\n\t\t\t\t\t\t@unfreeze="unfreeze"\n\t\t\t\t\t\t@enterSave="closePopup"\n\t\t\t\t\t/>\n\t\t\t\t\t<div class="booking-booking-change-time-popup-separator"></div>\n\t\t\t\t\t<TimeSelector\n\t\t\t\t\t\tv-model="toTs"\n\t\t\t\t\t\t:hasError="isBusy"\n\t\t\t\t\t\t:minTs="fromTs"\n\t\t\t\t\t\tdata-element="booking-change-time-to"\n\t\t\t\t\t\t:data-ts="toTs"\n\t\t\t\t\t\t:data-booking-id="bookingId"\n\t\t\t\t\t\tref="timeTo"\n\t\t\t\t\t\t@freeze="freeze"\n\t\t\t\t\t\t@unfreeze="unfreeze"\n\t\t\t\t\t\t@enterSave="closePopup"\n\t\t\t\t\t/>\n\t\t\t\t\t<Button\n\t\t\t\t\t\tclass="booking-booking-change-time-popup-button"\n\t\t\t\t\t\t:size="ButtonIcon.MEDIUM"\n\t\t\t\t\t\t:color="ButtonColor.PRIMARY"\n\t\t\t\t\t\t:icon="ButtonIcon.DONE"\n\t\t\t\t\t\t:disabled="isBusy"\n\t\t\t\t\t\t@click="closePopup"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div v-if="isBusy" class="booking-booking-change-time-popup-error">\n\t\t\t\t\t{{ loc('BOOKING_BOOKING_TIME_IS_NOT_AVAILABLE') }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</Popup>\n\t`};const me={props:{bookingId:{type:[Number,String],required:true},resourceId:{type:Number,required:true},dateFromTs:{type:Number,required:true},dateToTs:{type:Number,required:true}},data(){return{showPopup:false}},computed:{...ut.mapGetters({offset:`${bt.Model.Interface}/offset`,isFeatureEnabled:`${bt.Model.Interface}/isFeatureEnabled`}),booking(){return this.$store.getters["bookings/getById"](this.bookingId)},timeFormatted(){const t=nt.DateTimeFormat.getFormat("SHORT_TIME_FORMAT");return this.loc("BOOKING_BOOKING_TIME_RANGE",{"#FROM#":nt.DateTimeFormat.format(t,(this.dateFromTs+this.offset)/1e3),"#TO#":nt.DateTimeFormat.format(t,(this.dateToTs+this.offset)/1e3)})}},methods:{clickHandler(){if(!this.isFeatureEnabled){return}this.showPopup=true},closePopup(){this.showPopup=false}},components:{ChangeTimePopup:he},template:`\n\t\t<div\n\t\t\tclass="booking-booking-booking-time"\n\t\t\t:class="{'--lock': !isFeatureEnabled}"\n\t\t\tdata-element="booking-booking-time"\n\t\t\t:data-booking-id="bookingId"\n\t\t\t:data-resource-id="resourceId"\n\t\t\t:data-from="booking.dateFromTs"\n\t\t\t:data-to="booking.dateToTs"\n\t\t\tref="time"\n\t\t\t@click="clickHandler"\n\t\t>\n\t\t\t{{ timeFormatted }}\n\t\t</div>\n\t\t<ChangeTimePopup\n\t\t\tv-if="showPopup"\n\t\t\t:bookingId="bookingId"\n\t\t\t:resourceId="resourceId"\n\t\t\t:targetNode="$refs.time"\n\t\t\t@close="closePopup"\n\t\t/>\n\t`};const pe={name:"BookingName",components:{Name:D.Name},props:{bookingId:{type:[Number,String],required:true},resourceId:{type:Number,required:true}},computed:{booking(){return this.$store.getters[`${bt.Model.Bookings}/getById`](this.bookingId)},client(){const t=this.booking.primaryClient;return t?this.$store.getters[`${bt.Model.Clients}/getByClientData`](t):null},bookingName(){var t;return((t=this.client)==null?void 0:t.name)||this.booking.name||this.loc("BOOKING_BOOKING_DEFAULT_BOOKING_NAME")}},template:`\n\t\t<Name\n\t\t\t:name="bookingName"\n\t\t\tclassName="booking-booking-booking-name"\n\t\t\t:dataAttributes="{\n\t\t\t\t'data-element': 'booking-booking-name',\n\t\t\t\t'data-id': bookingId,\n\t\t\t\t'data-resource-id':resourceId,\n\t\t\t}"\n\t\t/>\n\t`};const ge={name:"BookingNote",components:{Note:D.Note,NotePopup:I.NotePopup},props:{bookingId:{type:[Number,String],required:true},bindElement:{type:Function,required:true},visiblePopup:{type:Boolean,default:false}},computed:{booking(){return this.$store.getters[`${bt.Model.Bookings}/getById`](this.bookingId)}},watch:{visiblePopup(t){if(t){var e;(e=this.$refs.note)==null?void 0:e.showViewPopup()}else{var o;(o=this.$refs.note)==null?void 0:o.closeViewPopup()}}},methods:{async saveBookingNote({note:t}){await ot.bookingService.update({id:this.booking.id,note:t})}},template:`\n\t\t<Note\n\t\t\tref="note"\n\t\t\t:id="bookingId"\n\t\t\t:note="booking.note"\n\t\t\t:bindElement\n\t\t\tclassName="booking-booking-booking-note-button"\n\t\t\t:dataId="bookingId"\n\t\t\tdataElementPrefix="booking"\n\t\t\t:dataAttributes="{\n\t\t\t\t'data-id': bookingId,\n\t\t\t\t'data-element': 'booking-booking-note-button',\n\t\t\t}"\n\t\t\t@save="saveBookingNote"\n\t\t/>\n\t`};const be={name:"BookingProfit",components:{Profit:D.Profit},props:{bookingId:{type:[Number,String],required:true},resourceId:{type:Number,required:true}},computed:{booking(){return this.$store.getters[`${bt.Model.Bookings}/getById`](this.bookingId)},deal(){var t,e;return(t=(e=this.booking.externalData)==null?void 0:e.find((t=>t.entityTypeId===bt.CrmEntity.Deal)))!=null?t:null}},template:`\n\t\t<Profit\n\t\t\t:deal\n\t\t\t:dataAttributes="{\n\t\t\t\t'data-id': bookingId,\n\t\t\t\t'data-resource-id': resourceId,\n\t\t\t\t'data-element': 'booking-booking-profit'\n\t\t\t}"\n\t\t\tclassName="booking-booking-booking-profit"\n\t\t/>\n\t`};const fe={name:"BookingCrmButton",components:{CrmButton:D.CrmButton},props:{bookingId:{type:[Number,String],required:true}},setup(t){const e=new P.BookingDealHelper(t.bookingId);return{dealHelper:e}},template:`\n\t\t<CrmButton\n\t\t\t:dealHelper\n\t\t\t:dataAttributes="{\n\t\t\t\t'data-booking-id': bookingId,\n\t\t\t\t'data-element': 'booking-crm-button'\n\t\t\t}"\n\t\t/>\n\t`};const Ie={components:{BIcon:j.BIcon,UiCounter:B.Counter},props:{bookingId:{type:[Number,String],required:true},nowTs:{type:Number,required:true}},setup(){return{Animated:k.Animated,Main:k.Main,CounterColor:B.CounterColor,CounterSize:B.CounterSize}},computed:{...ut.mapGetters({notificationTypes:`${bt.Model.Dictionary}/getNotifications`}),booking(){return this.$store.getters[`${bt.Model.Bookings}/getById`](this.bookingId)},showClocking(){var t;if(this.showCounter||this.isExpiredBooking||this.hasVisitStatus||this.isNotVisited){return false}const e=Object.fromEntries(Object.entries(this.notificationTypes).map((([t,{value:e}])=>[t,e])));const o=(t=this.booking.messages)==null?void 0:t.some((({notificationType:t})=>t===e.Confirmation));return!this.booking.isConfirmed&&o},showConfirmed(){if(this.showCounter||this.isExpiredBooking||this.isNotVisited){return false}return this.booking.isConfirmed},showCounter(){return this.booking.counter>0},isExpiredBooking(){return this.nowTs>this.booking.dateToTs},hasVisitStatus(){return[bt.VisitStatus.Visited,bt.VisitStatus.NotVisited].includes(this.booking.visitStatus)},isNotVisited(){const t=this.nowTs>this.booking.dateFromTs;const e=this.booking.visitStatus===bt.VisitStatus.Unknown;const o=this.booking.visitStatus===bt.VisitStatus.NotVisited;return t&&e||o}},template:`\n\t\t<div class="booking--counter">\n\t\t\t<div v-if="showClocking" class="booking-counter-icon --clocking">\n\t\t\t\t<BIcon :name="Animated.LOADER_CLOCK" :hoverable="false"/>\n\t\t\t</div>\n\t\t\t<div v-else-if="showConfirmed" class="booking-counter-icon --confirmed">\n\t\t\t\t<BIcon :name="Main.CHECK" :hoverable="false"/>\n\t\t\t</div>\n\t\t\t<UiCounter\n\t\t\t\tv-else-if="showCounter"\n\t\t\t\t:value="booking.counter"\n\t\t\t\t:color="CounterColor.DANGER"\n\t\t\t\t:size="CounterSize.LARGE"\n\t\t\t\tborder\n\t\t\t/>\n\t\t</div>\n\t`};const ke=Object.freeze({From:-1,None:0,To:1});const ve=rt.Duration.getUnitDurations().i*5;const Be=rt.Duration.getUnitDurations().i*15;const Te={name:"BookingResize",props:{bookingId:{type:[Number,String],required:true},resourceId:{type:Number,required:true}},setup(){const t=null;const e=null;return{tooltipTop:t,tooltipBottom:e}},data(){return{resizeDirection:ke.None,resizeFromTs:null,resizeToTs:null}},computed:{...ut.mapGetters({selectedDateTs:`${bt.Model.Interface}/selectedDateTs`,overbookingMap:`${bt.Model.Bookings}/overbookingMap`}),booking(){return this.$store.getters[`${bt.Model.Bookings}/getById`](this.bookingId)},limits(){return{fromTs:new Date(this.selectedDateTs).setHours(0,0,0,0),toTs:new Date(this.selectedDateTs).setHours(24,0,0,0)}},initialHeight(){return w.grid.calculateHeight(this.booking.dateFromTs,this.booking.dateToTs)},initialDuration(){return Math.max(this.booking.dateToTs-this.booking.dateFromTs,Be)},dateFromTsRounded(){return this.roundTimestamp(this.resizeFromTs)},dateToTsRounded(){return this.roundTimestamp(this.resizeToTs)},closestOnFrom(){return this.colliding.reduce(((t,{toTs:e})=>t<e&&e<=this.booking.dateFromTs?e:t),0)},closestOnTo(){return this.colliding.reduce(((t,{fromTs:e})=>this.booking.dateToTs<=e&&e<t?e:t),Infinity)},excludeBookings(){const t=this.overbookingMap;return e=>{if(e.id===this.bookingId){return true}const o=t.get(e.id);const i=this.booking.resourcesIds;return!o||o.items.every((t=>!i.includes(t.resourceId)))}},colliding(){return this.$store.getters[`${bt.Model.Interface}/getColliding`](this.booking.resourcesIds,this.excludeBookings)},hasIntersections(){return this.booking.resourcesIds.length>1}},methods:{createPopup(t){return new V.Popup({autoHide:true,cacheable:true,darkMode:true,...t})},showTooltipTop(t){if(!this.tooltipTop){this.tooltipTop=this.createPopup({id:`resize-top-${this.bookingId}-${this.resourceId}`,bindElement:this.$refs.bookingResizeTop,bindOptions:{position:"bottom"},offsetLeft:this.$refs.bookingResizeTop.offsetWidth/2,content:this.loc("BOOKING_RESIZE_GRID_LIMIT"),...t})}else if(t!=null&&t.content){this.tooltipTop.setContent(t.content)}this.tooltipTop.show()},showTooltipBottom(t){if(!this.tooltipBottom){this.tooltipBottom=this.createPopup({id:`resize-bottom-${this.bookingId}-${this.resourceId}`,bindElement:this.$refs.bookingResizeBottom,bindOptions:{position:"bottom"},offsetLeft:this.$refs.bookingResizeBottom.offsetWidth/2,content:this.loc("BOOKING_RESIZE_GRID_LIMIT"),...t})}else if(t!=null&&t.content){this.tooltipBottom.setContent(t.content)}this.tooltipBottom.show()},hideTooltips(){var t,e;(t=this.tooltipTop)==null?void 0:t.close==null?void 0:t.close();(e=this.tooltipBottom)==null?void 0:e.close==null?void 0:e.close()},onMouseDown(t){const e=ht.Dom.hasClass(t.target,"--from")?ke.From:ke.To;void this.startResize(e)},async startResize(t=ke.To){ht.Dom.style(document.body,"user-select","none");ht.Event.bind(window,"mouseup",this.endResize);ht.Event.bind(window,"pointermove",this.resize);this.resizeDirection=t;void this.updateIds(this.bookingId,this.resourceId)},resize(t){if(!this.resizeDirection){return}const e=this.resizeDirection===ke.To?t.clientY-this.$el.getBoundingClientRect().top:this.$el.getBoundingClientRect().bottom-t.clientY;const o=e*this.initialDuration/this.initialHeight;const i=Math.max(o,ve);if(this.resizeDirection===ke.To){const t=this.booking.dateFromTs+i;const e=Math.min(t,this.limits.toTs);this.manageToLimitNotification(t,e);this.resizeFromTs=this.booking.dateFromTs;this.resizeToTs=Math.min(e,this.closestOnTo)}else{const t=this.booking.dateToTs-i;const e=Math.max(t,this.limits.fromTs);this.manageFromLimitNotification(t,e);this.resizeFromTs=Math.max(e,this.closestOnFrom);this.resizeToTs=this.booking.dateToTs}this.$emit("update",this.resizeFromTs,this.resizeToTs)},async endResize(){this.resizeBooking();this.hideTooltips();ht.Dom.style(document.body,"user-select","");ht.Event.unbind(window,"mouseup",this.endResize);ht.Event.unbind(window,"pointermove",this.resize);this.$emit("update",null,null);await this.updateIds(null,null)},manageFromLimitNotification(t,e){const o=this.colliding.filter((({toTs:t})=>t===this.closestOnFrom));if(t<this.limits.fromTs){this.showTooltipTop({content:this.loc("BOOKING_RESIZE_GRID_LIMIT")});return}if(e<this.closestOnFrom){if(this.checkClosestByIntersection(o)){this.showTooltipTop({content:this.loc("BOOKING_RESIZE_INTERSECTIONS_LIMIT")});return}this.showTooltipTop({content:this.loc("BOOKING_RESIZE_LIMIT")});return}this.hideTooltips()},manageToLimitNotification(t,e){const o=this.colliding.filter((({fromTs:t})=>t===this.closestOnTo));if(t>this.limits.toTs){this.showTooltipBottom({content:this.loc("BOOKING_RESIZE_GRID_LIMIT")});return}if(e>this.closestOnTo){if(this.checkClosestByIntersection(o)){this.showTooltipBottom({content:this.loc("BOOKING_RESIZE_INTERSECTIONS_LIMIT")});return}this.showTooltipBottom({content:this.loc("BOOKING_RESIZE_LIMIT")});return}this.hideTooltips()},checkClosestByIntersection(t){return this.hasIntersections&&(t.length===1||t.filter((t=>t.resourcesIds[0]!==this.resourceId)).length>=2)},async updateIds(t,e){await Promise.all([this.$store.dispatch(`${bt.Model.Interface}/setResizedBookingId`,t),this.$store.dispatch(`${bt.Model.Interface}/setDraggedBookingResourceId`,e)]);void J.busySlots.loadBusySlots()},resizeBooking(){if(!this.dateFromTsRounded||!this.dateToTsRounded){return}if(this.dateFromTsRounded===this.booking.dateFromTs&&this.dateToTsRounded===this.booking.dateToTs){return}const t=this.bookingId;const e={id:t,dateFromTs:this.dateFromTsRounded,dateToTs:this.dateToTsRounded,timezoneFrom:this.booking.timezoneFrom,timezoneTo:this.booking.timezoneTo};if(!L.isRealId(this.bookingId)){void this.$store.dispatch(`${bt.Model.Bookings}/update`,{id:t,booking:e});return}void ot.bookingService.update({id:t,...e})},roundTimestamp(t){const e=rt.Duration.getUnitDurations().i*5;return Math.round(t/e)*e}},template:`\n\t\t<div>\n\t\t\t<div ref="bookingResizeTop" class="booking-booking-resize --from" @mousedown="onMouseDown"></div>\n\t\t\t<div ref="bookingResizeBottom" class="booking-booking-resize --to" @mousedown="onMouseDown"></div>\n\t\t</div>\n\t`};const ye=280;const we={name:"BookingBase",props:{bookingId:{type:[Number,String],required:true},resourceId:{type:Number,required:true},nowTs:{type:Number,required:true},width:{type:Number,default:ye},leftOffset:{type:Number,default:0},bookingClass:{type:[String,Object,Array],default:""},bookingStyle:{type:[String,Object,Array],default:""}},data(){return{visible:true,isDisabledPopupShown:false,resizeFromTs:null,resizeToTs:null,visibleNotePopup:false}},mounted(){this.updateVisibility();this.updateVisibilityDuringTransition();setTimeout((()=>{if(!this.isReal&&b.mousePosition.isMousePressed()){void this.$refs.resize.startResize()}}),300)},beforeUnmount(){var t;if(this.deletingBookings[this.bookingId]||!((t=this.booking)!=null&&t.resourcesIds.includes(this.resourceId))){this.$el.remove()}},computed:{...ut.mapGetters({resourcesIds:`${bt.Model.Interface}/resourcesIds`,zoom:`${bt.Model.Interface}/zoom`,scroll:`${bt.Model.Interface}/scroll`,draggedBookingId:`${bt.Model.Interface}/draggedBookingId`,draggedDataTransfer:`${bt.Model.Interface}/draggedDataTransfer`,editingBookingId:`${bt.Model.Interface}/editingBookingId`,isEditingBookingMode:`${bt.Model.Interface}/isEditingBookingMode`,deletingBookings:`${bt.Model.Interface}/deletingBookings`}),isReal(){return L.isRealId(this.bookingId)},booking(){return this.$store.getters[`${bt.Model.Bookings}/getById`](this.bookingId)},client(){const t=this.booking.primaryClient;return t?this.$store.getters[`${bt.Model.Clients}/getByClientData`](t):null},left(){return w.grid.calculateLeft(this.resourceId)},top(){return w.grid.calculateTop(this.dateFromTs)},height(){return w.grid.calculateHeight(this.dateFromTs,this.dateToTs)},realHeight(){return w.grid.calculateRealHeight(this.dateFromTs,this.dateToTs)},dateFromTs(){var t;return(t=this.resizeFromTs)!=null?t:this.booking.dateFromTs},dateToTs(){var t;return(t=this.resizeToTs)!=null?t:this.booking.dateToTs},dateFromTsRounded(){var t;return(t=this.roundTimestamp(this.resizeFromTs))!=null?t:this.dateFromTs},dateToTsRounded(){var t;return(t=this.roundTimestamp(this.resizeToTs))!=null?t:this.dateToTs},disabled(){return this.isEditingBookingMode&&this.editingBookingId!==this.bookingId},bookingOffset(){return this.leftOffset*this.zoom},isExpiredBooking(){return this.booking.dateToTs<this.nowTs},isNotVisited(){const t=this.nowTs>this.booking.dateFromTs;const e=this.booking.visitStatus===bt.VisitStatus.Unknown;const o=this.booking.visitStatus===bt.VisitStatus.NotVisited;return t&&e||o},disabledHover(){return this.draggedDataTransfer.id>0&&(this.draggedDataTransfer.kind!==bt.DraggedElementKind.Booking||this.draggedDataTransfer.id!==this.bookingId)}},methods:{updateVisibilityDuringTransition(){var t;(t=this.animation)==null?void 0:t.stop();this.animation=new BX.easing({duration:200,start:{},finish:{},step:this.updateVisibility});this.animation.animate()},updateVisibility(){if(!this.$el){return}const t=this.$el.getBoundingClientRect();this.visible=t.right>0&&t.left<window.innerWidth},onNoteMouseEnter(){this.showNoteTimeout=setTimeout((()=>{this.visibleNotePopup=true}),100)},onNoteMouseLeave(){clearTimeout(this.showNoteTimeout);this.visibleNotePopup=false},onClick(t){if(this.disabled){this.isDisabledPopupShown=true;t.stopPropagation()}},resizeUpdate(t,e){this.resizeFromTs=t;this.resizeToTs=e},roundTimestamp(t){const e=rt.Duration.getUnitDurations().i*5;return t?Math.round(t/e)*e:null}},watch:{scroll(){this.updateVisibility()},zoom(){this.updateVisibility()},resourcesIds(){this.updateVisibilityDuringTransition()},visible(t){if(t){return}setTimeout((()=>{this.updateVisibility()}),2e3)}},components:{Actions:ce,BookingAddClient:ue,BookingCrmButton:fe,BookingTime:me,BookingName:pe,BookingNote:ge,BookingProfit:be,Communication:D.Communication,Counter:Ie,DisabledPopup:D.DisabledPopup,Resize:Te},template:`\n\t\t<div\n\t\t\tclass="booking-booking-booking booking--draggable-item"\n\t\t\tdata-element="booking-booking"\n\t\t\t:data-id="bookingId"\n\t\t\t:data-resource-id="resourceId"\n\t\t\tdata-kind="booking"\n\t\t\t:style="[bookingStyle, {\n\t\t\t\t'--left': left + bookingOffset + 'px',\n\t\t\t\t'--top': top + 'px',\n\t\t\t\t'--height': height + 'px',\n\t\t\t\t'--width': width + 'px',\n\t\t\t}].flat(1)"\n\t\t\t:class="[bookingClass, {\n\t\t\t\t'--not-real': !isReal,\n\t\t\t\t'--zoom-is-less-than-08': zoom < 0.8,\n\t\t\t\t'--compact-mode': realHeight < 40 || zoom < 0.8,\n\t\t\t\t'--small': realHeight <= 15,\n\t\t\t\t'--long': realHeight >= 65,\n\t\t\t\t'--disabled': disabled,\n\t\t\t\t'--confirmed': booking.isConfirmed && !isNotVisited,\n\t\t\t\t'--expired': isExpiredBooking,\n\t\t\t\t'--not-visited': isNotVisited,\n\t\t\t\t'--resizing': resizeFromTs && resizeToTs,\n\t\t\t\t'--no-pointer-events': disabledHover,\n\t\t\t}].flat(1)"\n\t\t\t@click.capture="onClick"\n\t\t>\n\t\t\t<div v-if="visible" class="booking-booking-booking-padding">\n\t\t\t\t<Counter :bookingId="bookingId" :nowTs="nowTs"/>\n\t\t\t\t<div class="booking-booking-booking-inner">\n\t\t\t\t\t<div class="booking-booking-booking-content">\n\t\t\t\t\t\t<div class="booking-booking-booking-content-row">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass="booking-booking-booking-name-container"\n\t\t\t\t\t\t\t\t@mouseenter="onNoteMouseEnter"\n\t\t\t\t\t\t\t\t@mouseleave="onNoteMouseLeave"\n\t\t\t\t\t\t\t\t@click="visibleNotePopup = true"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<BookingName :bookingId="bookingId" :resourceId="resourceId"/>\n\t\t\t\t\t\t\t\t<BookingNote\n\t\t\t\t\t\t\t\t\t:bookingId="bookingId"\n\t\t\t\t\t\t\t\t\t:bindElement="() => $el"\n\t\t\t\t\t\t\t\t\t:visiblePopup="visibleNotePopup"\n\t\t\t\t\t\t\t\t\tref="note"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<BookingTime\n\t\t\t\t\t\t\t\t:bookingId="bookingId"\n\t\t\t\t\t\t\t\t:resourceId="resourceId"\n\t\t\t\t\t\t\t\t:dateFromTs="dateFromTsRounded"\n\t\t\t\t\t\t\t\t:dateToTs="dateToTsRounded"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<BookingProfit :bookingId="bookingId" :resourceId="resourceId"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="booking-booking-booking-content-row --lower">\n\t\t\t\t\t\t\t<BookingTime\n\t\t\t\t\t\t\t\t:bookingId="bookingId"\n\t\t\t\t\t\t\t\t:resourceId="resourceId"\n\t\t\t\t\t\t\t\t:dateFromTs="dateFromTsRounded"\n\t\t\t\t\t\t\t\t:dateToTs="dateToTsRounded"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<div v-if="client" class="booking-booking-booking-buttons">\n\t\t\t\t\t\t\t\t<Communication/>\n\t\t\t\t\t\t\t\t<BookingCrmButton :bookingId="bookingId"/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<BookingAddClient\n\t\t\t\t\t\t\t\tv-else\n\t\t\t\t\t\t\t\t:bookingId="bookingId"\n\t\t\t\t\t\t\t\t:resourceId="resourceId"\n\t\t\t\t\t\t\t\t:expired="isExpiredBooking"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<slot name="actions">\n\t\t\t\t\t\t<Actions :bookingId="bookingId" :resourceId="resourceId"/>\n\t\t\t\t\t</slot>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<Resize\n\t\t\t\tv-if="!disabled"\n\t\t\t\t:bookingId="bookingId"\n\t\t\t\t:resourceId="resourceId"\n\t\t\t\tref="resize"\n\t\t\t\t@update="resizeUpdate"\n\t\t\t/>\n\t\t\t<DisabledPopup\n\t\t\t\tv-if="isDisabledPopupShown"\n\t\t\t\t:popupId="['booking-booking-disabled-popup', bookingId, resourceId].join('-')"\n\t\t\t\t:bindElement="() => $el"\n\t\t\t\tcontentClass="booking-booking-disabled-popup-content"\n\t\t\t\t@close="isDisabledPopupShown = false"\n\t\t\t/>\n\t\t\t<slot/>\n\t\t</div>\n\t`};function Me({booking:t,colliding:e,selectedDateTs:o,draggedBookingResourcesIds:i}){const s=new Date(o).setHours(0,0,0,0);const n=new Date(o).setHours(24,0,0,0);const r={fromTs:s,toTs:n};if(i.length>1){const o=e.find((({fromTs:e})=>e===t.dateFromTs));if(o&&i.every((t=>o.resourcesIds.includes(t)))){return null}}for(const{fromTs:o,toTs:i}of e){if(i<=t.dateFromTs){r.fromTs=Math.max(r.fromTs,i)}if(t.dateToTs<=o){r.toTs=Math.min(r.toTs,o)}}if(r.fromTs===s&&r.toTs===n){return null}return r}function Ee(t,e,o){const i=o.dateToTs-o.dateFromTs;if(e.dateFromTs>=t.fromTs&&e.dateFromTs+i<=t.toTs){return{dateFromTs:e.dateFromTs,dateToTs:e.dateFromTs+i}}if(e.dateToTs-i>=t.fromTs&&e.dateToTs<=t.toTs){return{dateFromTs:e.dateToTs-i,dateToTs:e.dateToTs}}return{dateFromTs:t.fromTs,dateToTs:t.fromTs+i}}function Se(t){const e=t.length>0?t.length:1;return ye/e}function Ce({bookingId:t,bookingWidth:e,overlappingBookings:o}){let i=o.indexOf(t);if(i===-1){i=0}return e*i}const Le={name:"Booking",props:{bookingId:{type:[Number,String],required:true},resourceId:{type:Number,required:true},nowTs:{type:Number,required:true},bookingUiGroups:{type:Array,default:()=>[]}},data(){return{dropArea:false,freeSpace:null}},computed:{...ut.mapGetters({getBookingById:`${bt.Model.Bookings}/getById`,overbookingMap:`${bt.Model.Bookings}/overbookingMap`,selectedDateTs:`${bt.Model.Interface}/selectedDateTs`,deletingBookings:`${bt.Model.Interface}/deletingBookings`,animationPause:`${bt.Model.Interface}/animationPause`,isBookingCreatedFromEmbed:`${bt.Model.Interface}/isBookingCreatedFromEmbed`,editingBookingId:`${bt.Model.Interface}/editingBookingId`,draggedDataTransfer:`${bt.Model.Interface}/draggedDataTransfer`,draggedBookingId:`${bt.Model.Interface}/draggedBookingId`,getWaitListItemById:`${bt.Model.WaitList}/getById`,getResourceById:`${bt.Model.Resources}/getById`}),booking(){return this.getBookingById(this.bookingId)},deletingBookings(){return Object.values(this.$store.getters[`${bt.Model.Interface}/deletingBookings`])},overbooking(){return this.overbookingMap.get(this.bookingId)||null},overbookingInResource(){var t,e;return((t=this.overbooking)==null?void 0:(e=t.items)==null?void 0:e.find((t=>t.resourceId===this.resourceId)))||null},hasOverbooking(){var t;return(((t=this.overbookingInResource)==null?void 0:t.intersections)||[]).some((({id:t})=>!this.deletingBookings.includes(t)))},isShifted(){return this.hasOverbooking&&ht.Type.isPlainObject(this.overbookingInResource)&&this.overbookingInResource.shifted},overlappingBookings(){var t;const e=!this.isShifted||!this.hasOverbooking?this.bookingId:this.overbookingDependencies[0];return((t=this.bookingUiGroups.find((({bookingIds:t})=>t.includes(e))))==null?void 0:t.bookingIds)||[]},overbookingDependencies(){var t;return(((t=this.overbookingInResource)==null?void 0:t.intersections)||[]).map((({id:t})=>t))},bookingWidth(){if(this.hasOverbooking){return Se(this.overlappingBookings)/2}return Se(this.overlappingBookings)},leftOffset(){if(this.isShifted){const t=this.overbookingDependencies[0];const e=Ce({bookingId:t,bookingWidth:this.bookingWidth,overlappingBookings:this.overlappingBookings});return e*2+this.bookingWidth}return Ce({bookingId:this.booking.id,bookingWidth:this.hasOverbooking?this.bookingWidth*2:this.bookingWidth,overlappingBookings:this.overlappingBookings})},actionsPopupOptions(){return{overbooking:{disabled:this.overbooking!==null}}},realBooking(){return ht.Type.isNumber(this.bookingId)},hasAccent(){return this.editingBookingId===this.bookingId||this.isBookingCreatedFromEmbed(this.bookingId)}},methods:{dragMouseEnter(){if(this.dropArea||!this.draggedDataTransfer.id){return}if(this.draggedDataTransfer.kind===bt.DraggedElementKind.WaitListItem){this.freeSpace={fromTs:this.booking.dateFromTs,toTs:this.booking.dateToTs,resourcesIds:this.booking.resourcesIds};this.dropArea=true;return}const t=this.draggedBookingId;if(t===null){return}const e=this.getBookingById(t);const o=this.booking.dateToTs-this.booking.dateFromTs;const i=e.dateToTs-e.dateFromTs;if(o>=i&&e.resourcesIds.length<=1){this.freeSpace={fromTs:this.booking.dateFromTs,toTs:this.booking.dateToTs,resourcesIds:this.booking.resourcesIds};this.dropArea=true;return}const s=t=>{if(t.id===this.draggedBookingId){return true}const e=this.overbookingMap.get(t.id);const o=this.resourceId;return!e||e.items.some((t=>t.resourceId===o))};const n=this.$store.getters[`${bt.Model.Interface}/getColliding`](this.resourceId,s);if(n.length===0){this.freeSpace={fromTs:this.booking.dateFromTs,toTs:this.booking.dateToTs,resourcesIds:this.booking.resourcesIds};this.dropArea=true;return}const r=Me({booking:this.booking,colliding:n,selectedDateTs:this.selectedDateTs,draggedBookingResourcesIds:e.resourcesIds});this.freeSpace=r;this.dropArea=r&&r.toTs-r.fromTs>=i},dragMouseLeave(){this.dropArea=false;this.freeSpace=null},async dropElement(){const t=this.draggedDataTransfer.id;if(!t||!this.freeSpace){return}if(this.draggedDataTransfer.kind===bt.DraggedElementKind.Booking){await this.dropBooking(t);return}if(this.draggedDataTransfer.kind===bt.DraggedElementKind.WaitListItem){await this.dropWaitListItem(t)}},async dropBooking(t){const e=this.getBookingById(t);const{dateFromTs:o,dateToTs:i}=Ee(this.freeSpace,this.booking,e);const s={id:t,dateFromTs:o,dateToTs:i,timezoneFrom:e.timezoneFrom,timezoneTo:e.timezoneTo,resourcesIds:[...new Set([this.resourceId,...e.resourcesIds.slice(1,e.resourcesIds.length)])]};if(!L.isRealId(t)){await this.$store.dispatch(`${bt.Model.Bookings}/update`,{id:t,booking:s});return}await ot.bookingService.update({id:t,...s})},async dropWaitListItem(t){var e,o;const i=this.getWaitListItemById(t);const s=[...i.clients];const n=this.getResourceById(this.resourceId);const r=n==null?void 0:(e=n.slotRanges)==null?void 0:(o=e[0])==null?void 0:o.timezone;const a={id:`wl${t}`,resourcesIds:[this.resourceId],name:i.name,note:i.note,clients:s,primaryClient:s.length>0?s[0]:undefined,externalData:[...i.externalData],dateFromTs:this.booking.dateFromTs,dateToTs:this.booking.dateToTs,timezoneFrom:r,timezoneTo:r};const d=await ot.bookingService.createFromWaitListItem(t,a);if(d.success&&d.booking){lt.BookingAnalytics.sendAddBooking({isOverbooking:true})}},startDropHandler(){ht.Event.bind(this.$el,"mousemove",this.dragMouseEnter,{capture:true});ht.Event.bind(this.$el,"mouseleave",this.dragMouseLeave,{capture:true});ht.Event.bind(this.$el,"mouseup",this.dropElement,{capture:true})},stopDropHandler(){this.dropArea=false;this.freeSpace=null;ht.Event.unbind(this.$el,"mousemove",this.dragMouseEnter,{capture:true});ht.Event.unbind(this.$el,"mouseleave",this.dragMouseLeave,{capture:true});ht.Event.unbind(this.$el,"mouseup",this.dropElement,{capture:true})}},watch:{draggedDataTransfer:{handler(t){if(this.hasOverbooking){return}if(t.kind===bt.DraggedElementKind.Booking&&t.id===this.bookingId){return}if(!t||!t.kind||!t.id){this.stopDropHandler()}else{this.startDropHandler()}},deep:true}},components:{BookingBase:we,Actions:ce},template:`\n\t\t<BookingBase\n\t\t\t:bookingId\n\t\t\t:resourceId\n\t\t\t:nowTs\n\t\t\t:leftOffset\n\t\t\t:bookingClass="{\n\t\t\t\t'--short': overlappingBookings.length > 1,\n\t\t\t\t'--overbooking': hasOverbooking,\n\t\t\t\t'--shifted': isShifted && !realBooking,\n\t\t\t\t'--drop-area': dropArea,\n\t\t\t\t'--accent': hasAccent,\n\t\t\t\t'not-transition': animationPause,\n\t\t\t}"\n\t\t\t:width="bookingWidth"\n\t\t>\n\t\t\t<template #actions>\n\t\t\t\t<Actions\n\t\t\t\t\t:bookingId\n\t\t\t\t\t:resourceId\n\t\t\t\t\t:actionsPopupOptions\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<div class="booking--booking-pseudo-overbooking"></div>\n\t\t</BookingBase>\n\t`};const Oe={name:"BusyPopup",components:{Popup:T.Popup},props:{busySlot:{type:Object,required:true}},emits:["close"],computed:{...ut.mapGetters({offset:`${bt.Model.Interface}/offset`,mousePosition:`${bt.Model.Interface}/mousePosition`}),resource(){const t=this.busySlot.type===bt.BusySlot.Intersection?this.busySlot.intersectingResourceId:this.busySlot.resourceId;return this.$store.getters[`${bt.Model.Resources}/getById`](t)},popupId(){return`booking-booking-busy-popup-${this.busySlot.resourceId}`},config(){const t=200;const e=V.Popup.getOption("angleMinBottom");const o=t/2-e;return{bindElement:this.mousePosition,width:t,background:"#2878ca",offsetTop:-5,offsetLeft:-o+e,bindOptions:{forceBindPosition:true,position:"top"},angle:{offset:o,position:"bottom"},angleBorderRadius:"4px 0",autoHide:false}},textFormatted(){const t=nt.DateTimeFormat.getFormat("SHORT_TIME_FORMAT");const e=this.busySlot.type===bt.BusySlot.Intersection?"BOOKING_BOOKING_INTERSECTING_RESOURCE_IS_BUSY":"BOOKING_BOOKING_RESOURCE_IS_BUSY";return this.loc(e,{"#RESOURCE#":this.resource.name,"#TIME_FROM#":nt.DateTimeFormat.format(t,(this.busySlot.fromTs+this.offset)/1e3),"#TIME_TO#":nt.DateTimeFormat.format(t,(this.busySlot.toTs+this.offset)/1e3)})}},watch:{mousePosition:{handler(){this.adjustPosition()},deep:true}},methods:{adjustPosition(){var t;const e=(t=this.$refs.popup)==null?void 0:t.getPopupInstance();if(!e){return}e.setBindElement(this.mousePosition);e.adjustPosition()},closePopup(){this.$emit("close")}},template:`\n\t\t<Popup\n\t\t\tv-if="mousePosition.left !== 0 && mousePosition.top !== 0"\n\t\t\t:id="popupId"\n\t\t\t:config="config"\n\t\t\tref="popup"\n\t\t\t@close="closePopup"\n\t\t>\n\t\t\t<div class="booking-booking-busy-popup">\n\t\t\t\t{{ textFormatted }}\n\t\t\t</div>\n\t\t</Popup>\n\t`};const{mapGetters:De}=ut.createNamespacedHelpers(bt.Model.Interface);const Pe="booking-booking-busy-slot";const $e={name:"BusySlot",props:{busySlot:{type:Object,required:true}},setup(){return{BookingBusySlotClassName:Pe}},data(){return{isPopupShown:false}},computed:{...De({disabledBusySlots:"disabledBusySlots",isFilterMode:"isFilterMode",isEditingBookingMode:"isEditingBookingMode",isDragMode:"isDragMode"}),isDisabled(){const t=this.isDragMode&&this.busySlot.type===bt.BusySlot.OffHours;if(this.isFilterMode||t){return true}return this.busySlot.id in this.disabledBusySlots},left(){return w.grid.calculateLeft(this.busySlot.resourceId)},top(){return w.grid.calculateTop(this.busySlot.fromTs)},height(){return w.grid.calculateHeight(this.busySlot.fromTs,this.busySlot.toTs)}},methods:{onClick(){if(this.isFilterMode||this.isEditingBookingMode||this.busySlot.type===bt.BusySlot.Intersection){return}void this.$store.dispatch(`${bt.Model.Interface}/addDisabledBusySlot`,this.busySlot)},onMouseEnter(){clearTimeout(this.showTimeout);this.showTimeout=setTimeout((()=>this.showPopup()),300);ht.Event.unbind(document,"mousemove",this.onMouseMove);ht.Event.bind(document,"mousemove",this.onMouseMove)},onMouseMove(t){if(this.cursorInsideContainer(t.target)){this.updatePopup(t)}else{ht.Event.unbind(document,"mousemove",this.onMouseMove);this.closePopup()}},onMouseLeave(t){var e,o;if((e=t.relatedTarget)!=null&&(o=e.closest(".popup-window"))!=null&&o.querySelector(".booking-booking-busy-popup")){return}ht.Event.unbind(document,"mousemove",this.onMouseMove);this.closePopup()},cursorInsideContainer(t){return!ht.Type.isNull(t)&&ht.Dom.hasClass(t,this.BookingBusySlotClassName)},updatePopup(t){var e,o;const i=(e=this.$refs.container)==null?void 0:e.getBoundingClientRect();if(this.isDragMode||!i||t.clientY>i.top+i.height||t.clientY<i.top||t.clientX<i.left||t.clientX>i.left+i.width){this.closePopup();return}(o=this.showTimeout)!=null?o:this.showTimeout=setTimeout((()=>this.showPopup()),300)},showPopup(){this.isPopupShown=true},closePopup(){clearTimeout(this.showTimeout);this.showTimeout=null;this.isPopupShown=false}},components:{BusyPopup:Oe},template:`\n\t\t<div\n\t\t\tv-if="left >= 0"\n\t\t\t:class="[BookingBusySlotClassName, {\n\t\t\t\t'--disabled': isDisabled,\n\t\t\t}]"\n\t\t\t:style="{\n\t\t\t\t'--left': left + 'px',\n\t\t\t\t'--top': top + 'px',\n\t\t\t\t'--height': height + 'px',\n\t\t\t}"\n\t\t\tdata-element="booking-busy-slot"\n\t\t\t:data-id="busySlot.resourceId"\n\t\t\t:data-from="busySlot.fromTs"\n\t\t\t:data-to="busySlot.toTs"\n\t\t\tref="container"\n\t\t\t@click.stop="onClick"\n\t\t\t@mouseenter.stop="onMouseEnter"\n\t\t\t@mouseleave.stop="onMouseLeave"\n\t\t></div>\n\t\t<BusyPopup\n\t\t\tv-if="isPopupShown"\n\t\t\t:busySlot="busySlot"\n\t\t\t@close="closePopup"\n\t\t/>\n\t`};const Fe={props:{cell:{type:Object,required:true},className:{type:[String,Object],default:""}},components:{Icon:j.BIcon},data(){return{IconSet:j.Set}},computed:{...ut.mapGetters({selectedCells:`${bt.Model.Interface}/selectedCells`,zoom:`${bt.Model.Interface}/zoom`,intersections:`${bt.Model.Interface}/intersections`,timezone:`${bt.Model.Interface}/timezone`,offset:`${bt.Model.Interface}/offset`,isFeatureEnabled:`${bt.Model.Interface}/isFeatureEnabled`,draggedDataTransfer:`${bt.Model.Interface}/draggedDataTransfer`,embedItems:`${bt.Model.Interface}/embedItems`}),selected(){return this.cell.id in this.selectedCells},hasSelectedCells(){return Object.keys(this.selectedCells).length>0},timeFormatted(){const t=nt.DateTimeFormat.getFormat("SHORT_TIME_FORMAT");return this.loc("BOOKING_BOOKING_TIME_RANGE",{"#FROM#":nt.DateTimeFormat.format(t,(this.cell.fromTs+this.offset)/1e3),"#TO#":nt.DateTimeFormat.format(t,(this.cell.toTs+this.offset)/1e3)})},height(){return w.grid.calculateRealHeight(this.cell.fromTs,this.cell.toTs)},externalData(){return this.embedItems},clients(){const t=this.embedItems.filter((t=>t.entityTypeId==="CONTACT"||t.entityTypeId==="COMPANY"));return t.map((t=>({id:t.value,type:{code:t.entityTypeId,module:t.moduleId}})))}},methods:{onCellSelected({target:{checked:t}}){if(!this.isFeatureEnabled){et.limit.show();return}if(t){this.$store.dispatch(`${bt.Model.Interface}/addSelectedCell`,this.cell)}else{this.$store.dispatch(`${bt.Model.Interface}/removeSelectedCell`,this.cell)}},onMouseDown(){var t,e;if(!this.isFeatureEnabled){void et.limit.show();return}void this.$store.dispatch(`${bt.Model.Interface}/setHoveredCell`,null);this.creatingBookingId=`tmp-id-${Date.now()}-${Math.random()}`;void this.$store.dispatch(`${bt.Model.Interface}/addQuickFilterIgnoredBookingId`,this.creatingBookingId);void this.$store.dispatch(`${bt.Model.Bookings}/add`,{id:this.creatingBookingId,dateFromTs:this.cell.fromTs,dateToTs:this.cell.toTs,resourcesIds:[...new Set([this.cell.resourceId,...(t=this.intersections[0])!=null?t:[],...(e=this.intersections[this.cell.resourceId])!=null?e:[]])],timezoneFrom:this.timezone,timezoneTo:this.timezone,externalData:this.externalData,clients:this.clients});ht.Event.bind(window,"mouseup",this.addBooking)},addBooking(){ht.Event.unbind(window,"mouseup",this.addBooking);if(!this.isFeatureEnabled){void et.limit.show();return}setTimeout((async()=>{const t=this.$store.getters[`${bt.Model.Bookings}/getById`](this.creatingBookingId);const e=await ot.bookingService.add(t);if(e.success&&e.booking){const t=this.$store.getters[`${bt.Model.Bookings}/overbookingMap`];lt.BookingAnalytics.sendAddBooking({isOverbooking:Boolean(t==null?void 0:t.has==null?void 0:t.has(e.booking.id))})}}))}},template:`\n\t\t<div\n\t\t\tclass="booking-booking-base-cell"\n\t\t\t:class="[className, {\n\t\t\t\t'--selected': selected,\n\t\t\t\t'--bounded-to-bottom': cell.boundedToBottom,\n\t\t\t\t'--height-is-less-than-40': height < 40,\n\t\t\t\t'--compact-mode': height < 40 || zoom < 0.8,\n\t\t\t\t'--small': height <= 12.5,\n\t\t\t}]"\n\t\t\t:style="{\n\t\t\t\t'--height': height + 'px',\n\t\t\t}"\n\t\t\tdata-element="booking-base-cell"\n\t\t\t:data-resource-id="cell.resourceId"\n\t\t\t:data-from="cell.fromTs"\n\t\t\t:data-to="cell.toTs"\n\t\t\t:data-selected="selected"\n\t\t>\n\t\t\t<div class="booking-booking-grid-cell-padding">\n\t\t\t\t<div class="booking-booking-grid-cell-inner">\n\t\t\t\t\t<label\n\t\t\t\t\t\tclass="booking-booking-grid-cell-time"\n\t\t\t\t\t\tdata-element="booking-grid-cell-select-label"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span class="booking-booking-grid-cell-time-inner">\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tv-if="!draggedDataTransfer.id"\n\t\t\t\t\t\t\t\tclass="booking-booking-grid-cell-checkbox"\n\t\t\t\t\t\t\t\ttype="checkbox"\n\t\t\t\t\t\t\t\t:checked="selected"\n\t\t\t\t\t\t\t\t@change="onCellSelected"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span data-element="booking-grid-cell-time">\n\t\t\t\t\t\t\t\t{{ timeFormatted }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</label>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="!hasSelectedCells && !draggedDataTransfer.id"\n\t\t\t\t\t\tclass="booking-booking-grid-cell-select-button-container"\n\t\t\t\t\t\tref="button"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass="booking-booking-grid-cell-select-button"\n\t\t\t\t\t\t\t:class="{'--lock': !isFeatureEnabled}"\n\t\t\t\t\t\t\tdata-element="booking-grid-cell-add-button"\n\t\t\t\t\t\t\t@mousedown="onMouseDown"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class="booking-booking-grid-cell-select-button-text">\n\t\t\t\t\t\t\t\t{{ loc('BOOKING_BOOKING_SELECT') }}\n\t\t\t\t\t\t\t\t<Icon v-if="!isFeatureEnabled" :name="IconSet.LOCK" />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="ui-icon-set --chevron-right"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const Ne={name:"HoveredCell",components:{BaseCell:Fe},props:{cell:{type:Object,required:true},draggedBooking:{type:Object,default:null}},data(){return{overbookingPositionsInCell:[]}},computed:{...ut.mapGetters({overbookingMap:`${bt.Model.Bookings}/overbookingMap`}),left(){const t=w.grid.calculateLeft(this.cell.resourceId);const e=this.overbookingPositionsInCell;if(e.length>1){return-1}if(e.length===0||e[0]){return t}return t+w.grid.calculateWidth(this.width)},top(){return w.grid.calculateTop(this.cell.fromTs)},height(){const t=this.cell.fromTs;const e=this.draggedBooking?this.draggedBooking.dateToTs-this.draggedBooking.dateFromTs:Infinity;const o=e<this.cell.toTs-t?t+e:this.cell.toTs;return w.grid.calculateHeight(t,o)},width(){return this.overbookingPositionsInCell.length===0?280:280/2}},mounted(){this.calcOverbookingPositionsInCell()},methods:{calcOverbookingPositionsInCell(){const t=this.cell.resourceId;const e={dateFromTs:this.cell.fromTs,dateToTs:this.cell.toTs};const o=[];for(const[,i]of this.overbookingMap){const s=i.items.find((e=>e.resourceId===t));if(s&&y.checkBookingIntersection(i.booking,e)&&!o.includes(s==null?void 0:s.shifted)){o.push(s==null?void 0:s.shifted)}if(o.length>2){break}}this.overbookingPositionsInCell=o}},template:`\n\t\t<div\n\t\t\tv-if="left >= 0"\n\t\t\tclass="booking-booking-selected-cell"\n\t\t\t:style="{\n\t\t\t\t'--left': left + 'px',\n\t\t\t\t'--top': top + 'px',\n\t\t\t\t'--height': height + 'px',\n\t\t\t\t'--width': width + 'px',\n\t\t\t}"\n\t\t\t@mouseleave="$store.dispatch('interface/setHoveredCell', null)"\n\t\t>\n\t\t\t<BaseCell\n\t\t\t\t:cell="cell"\n\t\t\t\t:className="{ '--overbooking': overbookingPositionsInCell.length > 0 }"\n\t\t\t/>\n\t\t</div>\n\t`};const _e={props:{hour:{type:Number,required:true}},computed:{...ut.mapGetters({selectedDateTs:`${bt.Model.Interface}/selectedDateTs`,resourcesIds:`${bt.Model.Interface}/resourcesIds`}),top(){return w.grid.calculateTop(this.fromTs)},width(){return this.resourcesIds.length*280},fromTs(){return new Date(this.selectedDateTs).setHours(this.hour)}},template:`\n\t\t<div\n\t\t\tclass="booking-booking-quick-filter-line"\n\t\t\t:style="{\n\t\t\t\t'--top': top + 'px',\n\t\t\t\t'--width': width + 'px',\n\t\t\t}"\n\t\t></div>\n\t`};const Re=15*60*1e3;function Ae({dateFromTs:t,dateToTs:e}){const o=e-t;return[t,o<Re?t+Re:e]}function He(t,e,o){var i;return{...e,resourcesIds:[t],uiSlot:Ae(e),overbooking:o==null?void 0:(i=o.items)==null?void 0:i.some((e=>e.resourceId===t&&e.shifted))}}function ze(t){const e=new Map;for(const i of t){var o;const t=((o=i.resourcesIds)==null?void 0:o[0])||0;let s=[];if(e.has(t)){s=e.get(t)||[]}s.push(i);e.set(t,s)}return e}function Ge(t){const e=[];if(t.length===0){return e}let o={slot:[0,0],bookingIds:[]};t.filter((t=>!t.overbooking)).map((t=>({id:t.id,uiSlot:t.uiSlot}))).sort(((t,e)=>t.uiSlot[0]-e.uiSlot[0])).forEach((t=>{if(o.bookingIds.length===0){o.slot=[t.uiSlot[0],t.uiSlot[1]]}else if(M.inInterval(t.uiSlot[0],o.slot)){o.slot[1]=t.uiSlot[1]}else{e.push(o);o={slot:[t.uiSlot[0],t.uiSlot[1]],bookingIds:[]}}o.bookingIds.push(t.id)}));e.push(o);return e}function xe(t){const e=new Map;if(t instanceof Map){[...t.keys()].forEach((o=>{const i=Ge(t.get(o)||[]);e.set(o,i)}))}return e}const{mapGetters:Ke}=ut.createNamespacedHelpers(bt.Model.Bookings);const{mapGetters:We}=ut.createNamespacedHelpers(bt.Model.Interface);const Ue={name:"Bookings",data(){return{nowTs:Date.now()}},computed:{...Ke({overbookingMap:"overbookingMap"}),...We({resourcesIds:"resourcesIds",selectedDateTs:"selectedDateTs",isFilterMode:"isFilterMode",filteredBookingsIds:"filteredBookingsIds",selectedCells:"selectedCells",hoveredCell:"hoveredCell",busySlots:"busySlots",quickFilter:"quickFilter",isFeatureEnabled:"isFeatureEnabled",editingBookingId:"editingBookingId",embedItems:"embedItems",draggedBookingId:"draggedBookingId"}),resourcesHash(){const t=this.$store.getters[`${bt.Model.Resources}/getByIds`](this.resourcesIds).map((({id:t,slotRanges:e})=>({id:t,slotRanges:e})));return JSON.stringify(t)},bookingsHash(){const t=this.bookings.map((({id:t,dateFromTs:e,dateToTs:o})=>({id:t,dateFromTs:e,dateToTs:o})));return JSON.stringify(t)},bookings(){const t=this.selectedDateTs;let e=[];if(this.isFilterMode){e=this.$store.getters[`${bt.Model.Bookings}/getByDateAndIds`](t,this.filteredBookingsIds)}else{e=this.$store.getters[`${bt.Model.Bookings}/getByDateAndResources`](t,this.resourcesIds)}return e.flatMap((t=>t.resourcesIds.filter((t=>this.resourcesIds.includes(t))).map((e=>He(e,t,this.overbookingMap.get(t.id)))))).sort(((t,e)=>{if(t.resourcesIds[0]!==e.resourcesIds[0]){return e.resourcesIds[0]-t.resourcesIds[0]}if(t.dateFromTs!==e.dateFromTs){return t.dateFromTs-e.dateFromTs}return e.overbooking-t.overbooking}))},cells(){const t=[...Object.values(this.selectedCells),this.hoveredCell];const e=this.selectedDateTs;const o=new Date(e).setDate(new Date(e).getDate()+1);return t.filter((t=>t&&t.toTs>e&&o>t.fromTs))},quickFilterHours(){const t=new Set(Object.values(this.quickFilter.active));return Object.values(this.quickFilter.hovered).filter((e=>!t.has(e)))},resourceBookings(){return ze(this.bookings)},resourceBookingsUiGroupsMap(){return xe(this.resourceBookings)},embedEditingMode(){var t,e;return this.isFeatureEnabled&&(this.editingBookingId>0||((t=(e=this.embedItems)==null?void 0:e.length)!=null?t:0)>0)},draggedBooking(){if(!this.draggedBookingId){return null}return this.bookings.find((({id:t})=>t===this.draggedBookingId))||null}},mounted(){this.startInterval()},methods:{generateBookingKey(t){return`${t.id}-${t.resourcesIds[0]}`},getBookingUiGroupsByResourceId(t){return this.resourceBookingsUiGroupsMap.get(t)||[]},startInterval(){setInterval((()=>{this.nowTs=Date.now()}),5*1e3)}},watch:{selectedDateTs(){void J.busySlots.loadBusySlots()},bookingsHash(){void J.busySlots.loadBusySlots()},resourcesHash(){void J.busySlots.loadBusySlots()},overbookingMap(){void J.busySlots.loadBusySlots()}},components:{Booking:Le,BusySlot:$e,Cell:Ne,QuickFilterLine:_e},template:`\n\t\t<div\n\t\t\tclass="booking-booking-bookings"\n\t\t\t:class="{\n\t\t\t\t'embed-editing-mode': embedEditingMode,\n\t\t\t}"\n\t\t>\n\t\t\t<TransitionGroup name="booking-transition-booking">\n\t\t\t\t<template v-for="booking of bookings" :key="generateBookingKey(booking)">\n\t\t\t\t\t<Booking\n\t\t\t\t\t\t:bookingId="booking.id"\n\t\t\t\t\t\t:resourceId="booking.resourcesIds[0]"\n\t\t\t\t\t\t:nowTs\n\t\t\t\t\t\t:bookingUiGroups="getBookingUiGroupsByResourceId(booking.resourcesIds[0])"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t</TransitionGroup>\n\t\t\t<template v-for="busySlot of busySlots" :key="busySlot.id">\n\t\t\t\t<BusySlot\n\t\t\t\t\t:busySlot="busySlot"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<template v-for="cell of cells" :key="cell.id">\n\t\t\t\t<Cell\n\t\t\t\t\t:cell="cell"\n\t\t\t\t\t:draggedBooking="draggedBooking"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<template v-for="hour of quickFilterHours" :key="hour">\n\t\t\t\t<QuickFilterLine\n\t\t\t\t\t:hour="hour"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t</div>\n\t`};const qe=30*60*1e3;const Xe={name:"Cell",props:{cell:{type:Object,required:true}},data(){return{halfOffset:0}},computed:{...ut.mapGetters({overbookingMap:`${bt.Model.Bookings}/overbookingMap`,isFilterMode:`${bt.Model.Interface}/isFilterMode`,isEditingBookingMode:`${bt.Model.Interface}/isEditingBookingMode`,draggedBookingId:`${bt.Model.Interface}/draggedBookingId`,draggedDataTransfer:`${bt.Model.Interface}/draggedDataTransfer`,resizedBookingId:`${bt.Model.Interface}/resizedBookingId`,quickFilter:`${bt.Model.Interface}/quickFilter`}),draggedElementId(){return this.draggedDataTransfer.id},isAvailable(){if(this.isFilterMode||this.resizedBookingId||this.isEditingBookingMode&&!this.draggedDataTransfer.id){return false}const{fromTs:t,toTs:e}=this.freeSpace;const o=this.cell.fromTs;const i=this.cell.fromTs+qe;return(e>o||e>i)&&e-t>=this.duration},fromTs(){return Math.min(this.freeSpace.toTs-this.duration,this.cell.fromTs)+this.halfOffset},toTs(){return this.fromTs+this.duration},duration(){if(this.draggedBooking){return this.draggedBooking.dateToTs-this.draggedBooking.dateFromTs}return this.cell.toTs-this.cell.fromTs},draggedBooking(){var t;return(t=this.$store.getters[`${bt.Model.Bookings}/getById`](this.draggedBookingId))!=null?t:null},freeSpace(){let t=0;let e=Infinity;for(const{fromTs:o,toTs:i}of this.colliding){if(this.cell.fromTs+qe>o&&this.cell.fromTs+qe<i){t=i;e=o;break}if(i<=this.cell.fromTs+qe){t=Math.max(t,i)}if(o>=this.cell.fromTs+qe){e=Math.min(e,o)}}return{fromTs:t,toTs:e}},colliding(){return this.$store.getters[`${bt.Model.Interface}/getColliding`](this.cell.resourceId,this.excludeBookingColliding)},quickFilterHovered(){return this.cell.minutes/60 in this.quickFilter.hovered},quickFilterActive(){return this.cell.minutes/60 in this.quickFilter.active}},methods:{excludeBookingColliding(t){if(t.id===this.draggedBookingId){return true}const e=this.cell.resourceId;const o=this.overbookingMap.get(t.id);return o&&o.items.some((t=>t.resourceId===e))},mouseEnterHandler(t){this.updateHalfHour(t)},mouseLeaveHandler(t){var e,o;const i=(e=t.relatedTarget)==null?void 0:e.closest(".booking-booking-base-cell");if(!i||(i==null?void 0:(o=i.dataset)==null?void 0:o.selected)==="true"){void this.$store.dispatch(`${bt.Model.Interface}/setHoveredCell`,null)}},mouseMoveHandler(t){this.updateHalfHour(t)},updateHalfHour(t){var e;if((e=this.$refs.button)!=null&&e.contains(t.target)){return}this.halfOffset=0;const o=t.clientY-window.scrollY;const i=this.$el.getBoundingClientRect();const s=o>(i.top+i.top+i.height)/2;const n=this.fromTs>=this.freeSpace.fromTs;const r=this.toTs+qe<=this.freeSpace.toTs;if(s&&r||!s&&!n){this.halfOffset=qe}if((!s&&!n||s&&!r)&&this.freeSpace.fromTs-this.cell.fromTs>0){this.halfOffset=this.freeSpace.fromTs-this.cell.fromTs}else if(!s&&n||s&&!r){this.halfOffset=0}const a=s===(this.halfOffset===0);if(this.duration<=qe&&a){this.clearCell(t);return}this.hoverCell({id:`${this.cell.resourceId}-${this.fromTs}-${this.toTs}`,fromTs:this.fromTs,toTs:this.toTs,resourceId:this.cell.resourceId,boundedToBottom:this.toTs===this.freeSpace.toTs})},clearCell(t){var e,o;const i=(e=t.relatedTarget)==null?void 0:e.closest(".booking-booking-base-cell");if(!i||(i==null?void 0:(o=i.dataset)==null?void 0:o.selected)==="true"){void this.$store.dispatch(`${bt.Model.Interface}/setHoveredCell`,null)}},hoverCell(t){void this.$store.dispatch(`${bt.Model.Interface}/setHoveredCell`,null);if(this.isAvailable){void this.$store.dispatch(`${bt.Model.Interface}/setHoveredCell`,t)}}},watch:{draggedElementId(){if(!this.draggedElementId){void this.$store.dispatch(`${bt.Model.Interface}/setHoveredCell`,null)}}},template:`\n\t\t<div\n\t\t\tclass="booking-booking-grid-cell"\n\t\t\t:class="{\n\t\t\t\t'--quick-filter-hovered': quickFilterHovered,\n\t\t\t\t'--quick-filter-active': quickFilterActive,\n\t\t\t}"\n\t\t\tdata-element="booking-grid-cell"\n\t\t\t:data-resource-id="cell.resourceId"\n\t\t\t:data-from="cell.fromTs"\n\t\t\t:data-to="cell.toTs"\n\t\t\t@mouseenter="mouseEnterHandler"\n\t\t\t@mouseleave="mouseLeaveHandler"\n\t\t\t@mousemove="mouseMoveHandler"\n\t\t></div>\n\t`};const Ve={props:{bottom:{type:Boolean,default:false}},computed:ut.mapGetters({offHoursHover:`${bt.Model.Interface}/offHoursHover`,offHoursExpanded:`${bt.Model.Interface}/offHoursExpanded`}),methods:{animateOffHours({keepScroll:t}){if(this.offHoursExpanded){Ft.collapse()}else{Ft.expand({keepScroll:t})}void this.$store.dispatch(`${bt.Model.Interface}/setOffHoursExpanded`,!this.offHoursExpanded)}},template:`\n\t\t<div class="booking-booking-grid-padding">\n\t\t\t<div\n\t\t\t\tclass="booking-booking-column-off-hours"\n\t\t\t\t:class="{'--bottom': bottom, '--hover': offHoursHover}"\n\t\t\t\t@click="animateOffHours({ keepScroll: bottom })"\n\t\t\t\t@mouseenter="$store.dispatch('interface/setOffHoursHover', true)"\n\t\t\t\t@mouseleave="$store.dispatch('interface/setOffHoursHover', false)"\n\t\t\t></div>\n\t\t</div>\n\t`};const{mapGetters:je}=ut.createNamespacedHelpers(bt.Model.Interface);const Ye={props:{resourceId:Number},data(){return{visible:true}},mounted(){this.updateVisibility();this.updateVisibilityDuringTransition()},computed:{...je({resourcesIds:"resourcesIds",zoom:"zoom",scroll:"scroll",selectedDateTs:"selectedDateTs",offHoursHover:"offHoursHover",offHoursExpanded:"offHoursExpanded",fromHour:"fromHour",toHour:"toHour",offset:"offset"}),resource(){return this.$store.getters["resources/getById"](this.resourceId)},fromMinutes(){return this.fromHour*60},toMinutes(){return this.toHour*60},slotSize(){var t,e;return(t=(e=this.resource.slotRanges[0])==null?void 0:e.slotSize)!=null?t:60},offHoursTopCells(){return this.cells.filter((t=>t.minutes<this.fromMinutes))},workTimeCells(){return this.cells.filter((t=>t.minutes>=this.fromMinutes&&t.minutes<this.toMinutes))},offHoursBottomCells(){return this.cells.filter((t=>t.minutes>=this.toMinutes))},cells(){const t=3600*1e3;const e=this.selectedDateTs;const o=new Date(e).setDate(new Date(e).getDate()+1);return E.range(e,o-t,t).map((t=>{const e=t+this.slotSize*60*1e3;return{id:`${this.resource.id}-${t}-${e}`,fromTs:t,toTs:e,minutes:new Date(t+this.offset).getHours()*60,resourceId:this.resource.id}}))}},methods:{updateVisibilityDuringTransition(){var t;(t=this.animation)==null?void 0:t.stop();this.animation=new BX.easing({duration:200,start:{},finish:{},step:this.updateVisibility});this.animation.animate()},updateVisibility(){const t=this.$el.getBoundingClientRect();this.visible=t.right>0&&t.left<window.innerWidth}},watch:{scroll(){this.updateVisibility()},zoom(){this.updateVisibility()},resourcesIds(){this.updateVisibilityDuringTransition()}},components:{Cell:Xe,OffHours:Ve},template:`\n\t\t<div\n\t\t\tclass="booking-booking-grid-column"\n\t\t\tdata-element="booking-grid-column"\n\t\t\t:data-id="resourceId"\n\t\t>\n\t\t\t<template v-if="visible">\n\t\t\t\t<OffHours/>\n\t\t\t\t<div class="booking-booking-grid-off-hours-cells">\n\t\t\t\t\t<Cell v-for="cell of offHoursTopCells" :key="cell.id" :cell="cell"/>\n\t\t\t\t</div>\n\t\t\t\t<Cell v-for="cell of workTimeCells" :key="cell.id" :cell="cell"/>\n\t\t\t\t<div class="booking-booking-grid-off-hours-cells --bottom">\n\t\t\t\t\t<Cell v-for="cell of offHoursBottomCells" :key="cell.id" :cell="cell"/>\n\t\t\t\t</div>\n\t\t\t\t<OffHours :bottom="true"/>\n\t\t\t</template>\n\t\t</div>\n\t`};let Ze=t=>t,Qe;const Je=ht.Extension.getSettings("booking.booking").isAirTemplate;const to=200;const eo="ui-counter-panel__scope";const oo="bitrix24-dark-theme --ui-context-content-light";var io=babelHelpers.classPrivateFieldLooseKey("slider");var so=babelHelpers.classPrivateFieldLooseKey("overlay");var no=babelHelpers.classPrivateFieldLooseKey("handleSliderClose");var ro=babelHelpers.classPrivateFieldLooseKey("renderOverlay");var ao=babelHelpers.classPrivateFieldLooseKey("isExpanded");var lo=babelHelpers.classPrivateFieldLooseKey("getInset");var co=babelHelpers.classPrivateFieldLooseKey("animate");var uo=babelHelpers.classPrivateFieldLooseKey("applyMaximizedStyles");var ho=babelHelpers.classPrivateFieldLooseKey("applyMinimizedStyles");var mo=babelHelpers.classPrivateFieldLooseKey("appContainer");var po=babelHelpers.classPrivateFieldLooseKey("appHeader");var go=babelHelpers.classPrivateFieldLooseKey("counterPanel");var bo=babelHelpers.classPrivateFieldLooseKey("appContent");var fo=babelHelpers.classPrivateFieldLooseKey("contentPaddingElement");var Io=babelHelpers.classPrivateFieldLooseKey("imBarWidth");class ko{constructor({onOverlayClick:t}){Object.defineProperty(this,Io,{get:Do,set:void 0});Object.defineProperty(this,fo,{get:Oo,set:void 0});Object.defineProperty(this,bo,{get:Lo,set:void 0});Object.defineProperty(this,go,{get:Co,set:void 0});Object.defineProperty(this,po,{get:So,set:void 0});Object.defineProperty(this,mo,{get:Eo,set:void 0});Object.defineProperty(this,ho,{value:Mo});Object.defineProperty(this,uo,{value:wo});Object.defineProperty(this,co,{value:yo});Object.defineProperty(this,lo,{value:To});Object.defineProperty(this,ao,{get:Bo,set:void 0});Object.defineProperty(this,ro,{value:vo});Object.defineProperty(this,io,{writable:true,value:void 0});Object.defineProperty(this,so,{writable:true,value:void 0});Object.defineProperty(this,no,{writable:true,value:()=>{if(babelHelpers.classPrivateFieldLooseBase(this,ao)[ao]){babelHelpers.classPrivateFieldLooseBase(this,io)[io].applyHacks();BX.SidePanel.Instance.disablePageScrollbar()}}});this.onOverlayClick=t;babelHelpers.classPrivateFieldLooseBase(this,io)[io]=new(BX.SidePanel.Manager.getSliderClass())("");babelHelpers.classPrivateFieldLooseBase(this,so)[so]=babelHelpers.classPrivateFieldLooseBase(this,ro)[ro]();if(top.BX){top.BX.Event.EventEmitter.subscribe("SidePanel.Slider:onCloseComplete",babelHelpers.classPrivateFieldLooseBase(this,no)[no]);top.BX.Event.EventEmitter.subscribe("SidePanel.Slider:onDestroy",babelHelpers.classPrivateFieldLooseBase(this,no)[no])}}async maximize(){await S.Core.getStore().dispatch(`${bt.Model.Interface}/setExpanded`,true);babelHelpers.classPrivateFieldLooseBase(this,io)[io].applyHacks();BX.SidePanel.Instance.disablePageScrollbar();const t=babelHelpers.classPrivateFieldLooseBase(this,lo)[lo](babelHelpers.classPrivateFieldLooseBase(this,mo)[mo]);ht.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,mo)[mo],"position","fixed");ht.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,mo)[mo],"inset","0 0 0 0");const e=babelHelpers.classPrivateFieldLooseBase(this,lo)[lo](babelHelpers.classPrivateFieldLooseBase(this,mo)[mo]);babelHelpers.classPrivateFieldLooseBase(this,uo)[uo]();ht.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,so)[so],"--closing");ht.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,so)[so],"--opening");ht.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,so)[so],document.body);await babelHelpers.classPrivateFieldLooseBase(this,co)[co](t,e)}async minimize(){await S.Core.getStore().dispatch(`${bt.Model.Interface}/setExpanded`,false);babelHelpers.classPrivateFieldLooseBase(this,io)[io].resetHacks();BX.SidePanel.Instance.enablePageScrollbar();const t=babelHelpers.classPrivateFieldLooseBase(this,lo)[lo](babelHelpers.classPrivateFieldLooseBase(this,mo)[mo]);ht.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,mo)[mo],"position",null);const e=babelHelpers.classPrivateFieldLooseBase(this,lo)[lo](babelHelpers.classPrivateFieldLooseBase(this,mo)[mo]);babelHelpers.classPrivateFieldLooseBase(this,ho)[ho]();ht.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,so)[so],"--opening");ht.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,so)[so],"--closing");ht.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,mo)[mo],"position","fixed");await babelHelpers.classPrivateFieldLooseBase(this,co)[co](t,e);ht.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,mo)[mo],"position",null);ht.Dom.remove(babelHelpers.classPrivateFieldLooseBase(this,so)[so])}}function vo(){return ht.Tag.render(Qe||(Qe=Ze`
			<div class="booking-booking-overlay" onclick="${0}"></div>
		`),this.onOverlayClick)}function Bo(){return S.Core.getStore().getters[`${bt.Model.Interface}/expanded`]}function To(t){const e=t.getBoundingClientRect();return{left:e.left,top:e.top,right:window.innerWidth-(e.left+e.width),bottom:window.innerHeight-(e.top+e.height)}}function yo(t,e){return new Promise((o=>new BX.easing({duration:to,start:t,finish:e,step:({top:t,right:e,bottom:o,left:i})=>{ht.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,mo)[mo],"inset",`${t}px ${e}px ${o}px ${i}px`)},complete:o}).animate()))}function wo(){ht.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,go)[go],eo);ht.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,mo)[mo],oo);ht.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,mo)[mo],"height","initial");ht.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,mo)[mo],"position","fixed");ht.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,mo)[mo],"clip-path",`inset(0 ${babelHelpers.classPrivateFieldLooseBase(this,Io)[Io]}px 0 0)`);ht.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,mo)[mo],"background","var(--ui-color-palette-white-base)");if(Je){ht.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,po)[po],"padding-left","12px");ht.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,po)[po],"padding-right","12px")}ht.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,po)[po],"border-bottom","1px solid var(--ui-color-base-10)");ht.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,po)[po],"max-width","100%");ht.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,po)[po].parentElement,"padding-right",`${babelHelpers.classPrivateFieldLooseBase(this,Io)[Io]}px`);ht.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,bo)[bo],"margin",0);ht.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,bo)[bo],"border-radius",0);if(Je){ht.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,fo)[fo],"padding",0)}else{ht.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,fo)[fo],"padding-bottom",0);ht.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,fo)[fo],"padding-right",`${babelHelpers.classPrivateFieldLooseBase(this,Io)[Io]}px`)}ht.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,so)[so],"--right",`${babelHelpers.classPrivateFieldLooseBase(this,Io)[Io]}px`);BX.ZIndexManager.register(babelHelpers.classPrivateFieldLooseBase(this,mo)[mo],{overlay:babelHelpers.classPrivateFieldLooseBase(this,so)[so]})}function Mo(){ht.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,go)[go],eo);ht.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,mo)[mo],oo);ht.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,mo)[mo],"position",null);ht.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,mo)[mo],"clip-path",null);ht.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,mo)[mo],"background",null);ht.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,po)[po],"border-bottom",null);ht.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,po)[po],"max-width",null);ht.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,po)[po].parentElement,"padding-right",null);ht.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,bo)[bo],"margin",null);ht.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,bo)[bo],"border-radius",null);if(Je){ht.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,fo)[fo],"padding",null)}else{ht.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,fo)[fo],"padding-bottom",null);ht.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,fo)[fo],"padding-right",null)}BX.ZIndexManager.unregister(babelHelpers.classPrivateFieldLooseBase(this,mo)[mo])}function Eo(){if(Je){return document.querySelector(".app__page")}return BX("content-table")}function So(){if(Je){return document.querySelector(".page__toolbar")}return document.querySelector(".page-header")}function Co(){return S.Core.getParams().counterPanelContainer.firstElementChild}function Lo(){if(Je){return BX("air-workarea-content")}return BX("workarea-content")}function Oo(){var t;if(Je){return document.querySelector(".app__page")}return(t=BX("workarea"))==null?void 0:t.parentElement}function Do(){if(Je){return 0}const t=Je?BX("right-bar"):BX("bx-im-bar");return window.innerWidth-t.getBoundingClientRect().left}const Po={props:{getColumnsContainer:Function},data(){return{isSlider:S.Core.getParams().isSlider,maximize:new ko({onOverlayClick:()=>this.collapse()}),desiredZoom:this.$store.getters["interface/zoom"],minZoom:.5,maxZoom:1}},mounted(){if(location.hash==="#maximize"){void this.maximize.maximize()}},computed:{...ut.mapGetters({zoom:"interface/zoom",expanded:"interface/expanded"}),zoomFormatted(){return this.loc("BOOKING_BOOKING_ZOOM_PERCENT",{"#PERCENT#":Math.round(this.zoom*100)})}},methods:{expand(t){if(location.hash==="#maximize"||this.isAnyModifierKeyPressed(t)){void this.maximize.maximize()}else{window.open(`${location.href}#maximize`,"_blank").focus()}},isAnyModifierKeyPressed(t){return t.altKey||t.shiftKey||t.ctrlKey||t.metaKey},collapse(){void this.maximize.minimize()},fitToScreen(){const t=260;const e=this.getColumnsContainer();const o=(e.offsetWidth-t)/(e.scrollWidth-t);const i=Math.floor(this.zoom*o*10)/10;this.zoomInto(i)},zoomInto(t){var e;if(Number.isNaN(t)){return}const o="--booking-booking-no-transition";const i=S.Core.getParams().container;const s=400;this.desiredZoom=Math.max(this.minZoom,Math.min(this.maxZoom,t));if(this.zoom===this.desiredZoom){return}(e=this.animation)==null?void 0:e.stop();ht.Dom.addClass(i,o);this.animation=new BX.easing({duration:Math.abs(this.zoom-this.desiredZoom)/this.minZoom*s,start:{zoom:this.zoom*100},finish:{zoom:this.desiredZoom*100},step:({zoom:t})=>this.$store.dispatch("interface/setZoom",t/100),complete:()=>ht.Dom.removeClass(i,o)});this.animation.animate()},async onMouseDown(t){ht.Event.unbind(window,"mouseup",this.onMouseUp);ht.Event.bind(window,"mouseup",this.onMouseUp);this.mouseDown=true;await new Promise((t=>setTimeout(t,50)));if(this.mouseDown){clearInterval(this.zoomInterval);this.zoomInterval=setInterval((()=>this.zoomInto(this.desiredZoom+t*.1)),40)}},onMouseUp(){this.mouseDown=false;if(this.desiredZoom>this.zoom){this.desiredZoom=Math.ceil(this.zoom*10)/10}if(this.desiredZoom<this.zoom){this.desiredZoom=Math.floor(this.zoom*10)/10}this.zoomInto(this.desiredZoom);clearInterval(this.zoomInterval);ht.Event.unbind(window,"mouseup",this.onMouseUp)},async showAhaMoment(){ft.ahaMoments.setPopupShown(bt.AhaMoment.ExpandGrid);await ft.ahaMoments.show({id:"booking-expand-grid",title:this.loc("BOOKING_AHA_EXPAND_GRID_TITLE_MSGVER_1"),text:this.loc("BOOKING_AHA_EXPAND_GRID_TEXT_MSGVER_1"),target:this.$refs.expand,top:true});ft.ahaMoments.setShown(bt.AhaMoment.ExpandGrid)}},template:`\n\t\t<div class="booking-booking-grid-scale-panel">\n\t\t\t<div v-if="!isSlider" class="booking-booking-grid-scale-panel-full-screen" ref="expand">\n\t\t\t\t<div v-if="expanded" class="ui-icon-set --collapse-diagonal" @click="collapse"></div>\n\t\t\t\t<div v-else class="ui-icon-set --expand-diagonal" @click="expand"></div>\n\t\t\t</div>\n\t\t\t<div class="booking-booking-grid-scale-panel-fit-to-screen">\n\t\t\t\t<div class="booking-booking-grid-scale-panel-fit-to-screen-text" @click="fitToScreen">\n\t\t\t\t\t{{ loc('BOOKING_BOOKING_SHOW_ALL') }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="booking-booking-grid-scale-panel-change">\n\t\t\t\t<div\n\t\t\t\t\tclass="ui-icon-set --minus-30"\n\t\t\t\t\t:class="{'--disabled': zoom <= minZoom}"\n\t\t\t\t\t@click="zoomInto(desiredZoom - 0.1)"\n\t\t\t\t\t@mousedown="onMouseDown(-1)"\n\t\t\t\t></div>\n\t\t\t\t<div v-html="zoomFormatted" class="booking-booking-grid-scale-panel-zoom"></div>\n\t\t\t\t<div\n\t\t\t\t\tclass="ui-icon-set --plus-30"\n\t\t\t\t\t:class="{'--disabled': zoom >= maxZoom}"\n\t\t\t\t\t@click="zoomInto(desiredZoom + 0.1)"\n\t\t\t\t\t@mousedown="onMouseDown(1)"\n\t\t\t\t></div>\n\t\t\t</div>\n\t\t</div>\n\t`};const{mapGetters:$o}=ut.createNamespacedHelpers(bt.Model.Interface);const Fo={data(){return{IconSet:j.Set}},created(){this.datePicker=new C.DatePicker({selectedDates:[this.selectedDateTs],inline:true,hideHeader:true});this.setViewDate();this.datePicker.subscribe(C.DatePickerEvent.SELECT,(t=>{const e=t.getData().date;const o=this.createDateFromUtc(e);void this.$store.dispatch(`${bt.Model.Interface}/setSelectedDateTs`,o.getTime());this.setViewDate()}))},mounted(){this.datePicker.setTargetNode(this.$refs.datePicker);this.datePicker.show()},beforeUnmount(){this.datePicker.destroy()},computed:{...ut.mapGetters({calendarExpanded:`${bt.Model.Interface}/calendarExpanded`}),...$o({filteredMarks:"filteredMarks",freeMarks:"freeMarks",isFilterMode:"isFilterMode",getCounterMarks:"getCounterMarks",offset:"offset"}),selectedDateTs(){return this.$store.getters[`${bt.Model.Interface}/selectedDateTs`]+this.offset},viewDateTs(){return this.$store.getters[`${bt.Model.Interface}/viewDateTs`]+this.offset},counterMarks(){if(this.isFilterMode){return this.getCounterMarks(this.filteredMarks)}return this.getCounterMarks()},formattedDate(){const t=this.calendarExpanded?this.loc("BOOKING_MONTH_YEAR_FORMAT"):nt.DateTimeFormat.getFormat("LONG_DATE_FORMAT");const e=this.calendarExpanded?this.viewDateTs/1e3:this.selectedDateTs/1e3;return nt.DateTimeFormat.format(t,e)}},methods:{onPreviousClick(){if(this.calendarExpanded){this.previousMonth()}else{this.previousDate()}},onNextClick(){if(this.calendarExpanded){this.nextMonth()}else{this.nextDate()}},previousDate(){const t=this.datePicker.getSelectedDate()||this.datePicker.getToday();this.datePicker.selectDate(C.getNextDate(t,"day",-1));this.setViewDate()},nextDate(){const t=this.datePicker.getSelectedDate()||this.datePicker.getToday();this.datePicker.selectDate(C.getNextDate(t,"day"));this.setViewDate()},previousMonth(){const t=this.datePicker.getViewDate();this.datePicker.setViewDate(C.getNextDate(t,"month",-1));this.setViewDate()},nextMonth(){const t=this.datePicker.getViewDate();this.datePicker.setViewDate(C.getNextDate(t,"month"));this.setViewDate()},setViewDate(){const t=this.createDateFromUtc(this.datePicker.getViewDate());const e=t.setDate(1);void this.$store.dispatch(`${bt.Model.Interface}/setViewDateTs`,e)},createDateFromUtc(t){return new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate())},updateMarks(){if(this.isFilterMode){this.setFilterMarks()}else{this.setFreeMarks()}this.setCounterMarks()},setFreeMarks(){const t="rgba(var(--ui-color-background-success-rgb), 0.7)";const e=this.prepareDates(this.freeMarks);this.datePicker.setDayColors([{matcher:e,bgColor:t}])},setFilterMarks(){const t="rgba(var(--ui-color-primary-rgb), 0.20)";const e=this.prepareDates(this.filteredMarks);this.datePicker.setDayColors([{matcher:e,bgColor:t}])},setCounterMarks(){const t=this.prepareDates(this.counterMarks);this.datePicker.setDayMarks([{matcher:t,bgColor:"red"}])},prepareDates(t){return t.map((t=>{const e=nt.DateTimeFormat.parse(t,false,bt.DateFormat.ServerParse);return this.prepareTimestamp(e.getTime())}))},prepareTimestamp(t){const e=nt.DateTimeFormat.getFormat("FORMAT_DATE");return nt.DateTimeFormat.format(e,t/1e3)},async collapseToggle(){await Promise.all([this.$store.dispatch(`${bt.Model.Interface}/setCalendarExpanded`,!this.calendarExpanded),Z.optionService.setBool(bt.Option.CalendarExpanded,this.calendarExpanded)])}},watch:{selectedDateTs(t){this.datePicker.selectDate(C.createDate(t));this.updateMarks()},filteredMarks(){this.updateMarks()},freeMarks(){this.updateMarks()},counterMarks(){this.setCounterMarks()},isFilterMode(){this.updateMarks()}},components:{Icon:j.BIcon},template:`\n\t\t<div class="booking-sidebar-calendar-container" :class="{'--expanded': calendarExpanded}">\n\t\t\t<div class="booking-booking-sidebar-calendar">\n\t\t\t\t<div class="booking-booking-sidebar-calendar-header">\n\t\t\t\t\t<div class="booking-sidebar-button" @click="onPreviousClick">\n\t\t\t\t\t\t<div class="ui-icon-set --chevron-left"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="booking-booking-sidebar-calendar-title">\n\t\t\t\t\t\t{{ formattedDate }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="booking-sidebar-button --right" @click="onNextClick">\n\t\t\t\t\t\t<div class="ui-icon-set --chevron-right"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="booking-sidebar-button" @click="collapseToggle">\n\t\t\t\t\t\t<Icon :name="calendarExpanded ? IconSet.COLLAPSE : IconSet.EXPAND_1"/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="booking-booking-sidebar-calendar-date-picker" ref="datePicker"></div>\n\t\t\t</div>\n\t\t</div>\n\t`};const No={name:"WaitListLayout",props:{waitListItemsCount:{type:Number,default:0},waitListClass:{type:[String,Object,Array],default:""},showEmptyState:{type:Boolean,default:false},dragging:{type:Boolean,default:false},expanded:{type:Boolean,default:false}},emits:["mouseUp"],methods:{showHelpDesk(){if(!top.BX.Helper){return}const t=bt.HelpDesk.WaitListDescription.anchorCode||null;const e={redirect:"detail",code:bt.HelpDesk.WaitListDescription.code,...t!==null&&{anchor:t}};const o=Object.entries(e).map((([t,e])=>`${t}=${e}`)).join("&");top.BX.Helper.show(o)}},template:`\n\t\t<div\n\t\t\tclass="booking-wait-list"\n\t\t\t:class="waitListClass"\n\t\t\t@mouseup.capture="$emit('mouseUp', $event)"\n\t\t>\n\t\t\t<div class="booking-wait-list-header">\n\t\t\t\t<div class="booking-wait-list-title">{{ loc('BOOKING_BOOKING_WAIT_LIST') }}</div>\n\t\t\t\t<div v-if="waitListItemsCount > 0" class="booking--wait-list-title-count">{{ waitListItemsCount }}</div>\n\t\t\t\t<div class="booking-wait-list-buttons">\n\t\t\t\t\t<slot name="header" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if="expanded"\n\t\t\t\tclass="booking--wait-list-content"\n\t\t\t>\n\t\t\t\t<div v-if="showEmptyState" class="booking-wait-list-empty">\n\t\t\t\t\t<div class="booking-wait-list-empty-icon"></div>\n\t\t\t\t\t<div class="booking-wait-list-empty-title">{{ loc('BOOKING_BOOKING_WAIT_LIST') }}</div>\n\t\t\t\t\t<div class="booking-wait-list-empty-subtitle">{{ loc('BOOKING_BOOKING_WAIT_LIST_DESCRIPTION') }}</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="booking-wait-list-empty-help"\n\t\t\t\t\t\t@click="showHelpDesk"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ loc('BOOKING_BOOKING_WAIT_LIST_HOW') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-if="dragging" class="booking-wait-list-drag-area">\n\t\t\t\t\t{{ loc('BOOKING_BOOKING_WAIT_LIST_DRAG_AREA') }}\n\t\t\t\t</div>\n\t\t\t\t<template v-else>\n\t\t\t\t\t<slot name="waitlist" />\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t`};const _o=()=>{const t=async()=>new Promise((t=>{const e=z.MessageBox.create({message:ht.Loc.getMessage("BOOKING_BOOKING_WAIT_LIST_GROUP_CONFIRM_DELETE"),yesCaption:ht.Loc.getMessage("BOOKING_BOOKING_WAIT_LIST_GROUP_CONFIRM_DELETE_YES"),modal:true,buttons:z.MessageBoxButtons.YES_CANCEL,onYes:()=>{e.close();t(true)},onCancel:()=>{e.close();t(false)}});e.show()}));const e=async e=>{if(await t()){await N.waitListService.deleteList(e)}};return{deleteWaitListGroup:e}};const Ro={name:"WaitListGroupMenu",props:{waitListGroup:{type:Object,required:true}},setup(){const t=null;const{deleteWaitListGroup:e}=_o();return{menuPopup:t,deleteWaitListGroup:e}},computed:{popupId(){return`wait-list-group-menu-${ht.Text.getRandom(4)}`}},unmounted(){if(this.menuPopup){this.destroy()}},methods:{openMenu(){var t,e;if((t=this.menuPopup)!=null&&(e=t.popupWindow)!=null&&e.isShown()){this.destroy();return}const o=this.$refs["menu-button"];this.menuPopup=V.MenuManager.create(this.popupId,o,this.getMenuItems(),{className:"booking--wait-list--wait-list-group-menu-popup",closeByEsc:true,autoHide:true,offsetTop:-3,offsetLeft:o.offsetWidth-6,angle:true,cacheable:true,events:{onDestroy:()=>this.unbindScrollEvent()}});this.menuPopup.show();this.bindScrollEvent()},getMenuItems(){return[{html:`<span>${this.loc("BOOKING_BOOKING_WAIT_LIST_GROUP_DELETE")}</span>`,onclick:async()=>{this.destroy();await this.deleteWaitListGroup(this.waitListGroup.items.map((({id:t})=>t)))}}]},destroy(){V.MenuManager.destroy(this.popupId);this.unbindScrollEvent()},bindScrollEvent(){ht.Event.bind(document,"scroll",this.adjustPosition,{capture:true})},unbindScrollEvent(){ht.Event.unbind(document,"scroll",this.adjustPosition,{capture:true})},adjustPosition(){var t,e;(t=this.menuPopup)==null?void 0:(e=t.popupWindow)==null?void 0:e.adjustPosition()}},template:`\n\t\t<button ref="menu-button" class="ui-icon-set --more" @click="openMenu"></button>\n\t`};const Ao={name:"WaitListGroups",components:{Icon:j.BIcon,WaitListGroupMenu:Ro},setup(){const t=null;return{dragManager:t,IconSet:j.Set}},computed:{...ut.mapGetters({editingWaitListItemId:`${bt.Model.Interface}/editingWaitListItemId`,isFeatureEnabled:`${bt.Model.Interface}/isFeatureEnabled`,animationPause:`${bt.Model.Interface}/animationPause`,waitListItems:`${bt.Model.WaitList}/get`}),waitListGroups(){const t=[{title:this.loc("BOOKING_BOOKING_WAIT_LIST_ADDED_TODAY"),items:[]},{title:this.loc("BOOKING_BOOKING_WAIT_LIST_ADDED_THIS_WEEK"),items:[]},{title:this.loc("BOOKING_BOOKING_WAIT_LIST_ADDED_THIS_MONTH"),items:[]},{title:this.loc("BOOKING_BOOKING_WAIT_LIST_ADDED_OVER_MONTH"),items:[]}];const e=(new Date).setHours(0,0,0,0);const{d:o,w:i,m:s}=rt.Duration.getUnitDurations();[...this.waitListItems].sort(((t,e)=>e.createdAt-t.createdAt)).forEach((n=>{const r=e-new Date(n.createdAt).setHours(0,0,0,0);if(r<o){t[0].items.push(n)}else if(r<i){t[1].items.push(n)}else if(r<s){t[2].items.push(n)}else{t[3].items.push(n)}}));return t.filter((({items:t})=>t.length>0))}},template:`\n\t\t<div class="booking-wait-list-groups">\n\t\t\t<div v-for="group of waitListGroups" :key="group.title" class="booking-wait-list-group">\n\t\t\t\t<div class="booking-wait-list-group-header">\n\t\t\t\t\t<div class="booking-wait-list-group-title">{{ group.title }}</div>\n\t\t\t\t\t<div class="booking-sidebar-button">\n\t\t\t\t\t\t<WaitListGroupMenu :waitListGroup="group"/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<TransitionGroup :name="animationPause ? 'none' : 'wait-list'" tag="div">\n\t\t\t\t\t<template v-for="item of group.items" :key="item.id">\n\t\t\t\t\t\t<slot name="item" :item="item"/>\n\t\t\t\t\t</template>\n\t\t\t\t</TransitionGroup>\n\t\t\t</div>\n\t\t</div>\n\t`};const Ho={name:"WaitListItemName",components:{Name:D.Name},props:{waitListItem:{type:Object,required:true}},computed:{client(){var t;const e=((t=this.waitListItem.clients)==null?void 0:t[0])||null;return e?this.$store.getters[`${bt.Model.Clients}/getByClientData`](e):null},itemName(){var t;return((t=this.client)==null?void 0:t.name)||this.waitListItem.name||this.loc("BOOKING_BOOKING_DEFAULT_BOOKING_NAME")}},template:`\n\t\t<Name\n\t\t\t:name="itemName"\n\t\t\t:dataAttributes="{\n\t\t\t\t'data-element': 'wait-list-item-name',\n\t\t\t\t'data-id': waitListItem.id,\n\t\t\t}"\n\t\t/>\n\t`};const zo={name:"WaitListItemNote",components:{Note:D.Note},props:{waitListItem:{type:Object,required:true},bindElement:{type:Function,required:true},visiblePopup:{type:Boolean,default:false}},watch:{visiblePopup(t){if(t){var e;(e=this.$refs.note)==null?void 0:e.showViewPopup()}else{var o;(o=this.$refs.note)==null?void 0:o.closeViewPopup()}}},methods:{async saveWaitListItemNote({note:t}){const e=this.waitListItem.id;await N.waitListService.update({id:e,note:t})}},template:`\n\t\t<Note\n\t\t\tref="note"\n\t\t\t:id="waitListItem.id"\n\t\t\t:note="waitListItem.note"\n\t\t\t:bindElement\n\t\t\tclassName="booking--wait-list-item-note"\n\t\t\t:dataId="waitListItem.id"\n\t\t\tdataElementPrefix="wait-list-item"\n\t\t\t:dataAttributes="{\n\t\t\t\t'data-id': waitListItem.id,\n\t\t\t\t'data-element': 'booking-wait-list-item-note-button',\n\t\t\t}"\n\t\t\t@save="saveWaitListItemNote"\n\t\t/>\n\t`};const Go={name:"WaitListItemProfit",components:{Profit:D.Profit},props:{waitListItem:{type:Object,required:true}},computed:{deal(){var t,e;return(t=(e=this.waitListItem.externalData)==null?void 0:e.find((t=>t.entityTypeId===bt.CrmEntity.Deal)))!=null?t:null}},template:`\n\t\t<Profit\n\t\t\t:deal\n\t\t\t:dataAttributes="{\n\t\t\t\t'data-id': waitListItem.id,\n\t\t\t\t'data-element': 'booking-wait-list-item-profit'\n\t\t\t}"\n\t\t/>\n\t`};const xo={name:"WaitListItemClient",components:{Client:O.Client},props:{waitListItemId:{type:Number,required:true}},emits:["freeze","unfreeze"],computed:{waitListItem(){return this.$store.getters[`${bt.Model.WaitList}/getById`](this.waitListItemId)}},methods:{async addClients({clients:t}){await N.waitListService.update({id:this.waitListItem.id,clients:t})},async updateClients({clients:t}){await N.waitListService.update({id:this.waitListItem.id,clients:t})},async updateNote({note:t}){await N.waitListService.update({id:this.waitListItem.id,note:t})}},template:`\n\t\t<Client\n\t\t\t:id="waitListItemId"\n\t\t\t:primaryClientData="waitListItem.clients?.[0] || null"\n\t\t\t:clients="waitListItem.clients"\n\t\t\t:note="waitListItem.note"\n\t\t\t:dataId="waitListItemId"\n\t\t\tdataElementPrefix="wait-list-item"\n\t\t\t:dataAttributes="{\n\t\t\t\t'data-wait-list-item-id': waitListItemId,\n\t\t\t}"\n\t\t\t@freeze="$emit('freeze')"\n\t\t\t@unfreeze="$emit('unfreeze')"\n\t\t\t@addClients="addClients"\n\t\t\t@updateClients="updateClients"\n\t\t\t@updateNote="updateNote"\n\t\t/>\n\t`};const Ko={name:"WaitListItemConfirmation",components:{Confirmation:O.Confirmation},props:{waitListItemId:{type:Number,required:true}},emits:["freeze","unfreeze"],template:`\n\t\t<Confirmation\n\t\t\t:id="waitListItemId"\n\t\t\t:isConfirmed="false"\n\t\t\t:counters="[]"\n\t\t\tdisabled\n\t\t\t:dataId="waitListItemId"\n\t\t\tdataPre\n\t\t/>\n\t`};const Wo={name:"WaitListItemDeal",components:{Deal:O.Deal},props:{waitListItemId:{type:Number,required:true}},emits:["freeze","unfreeze"],setup(t){const e=new P.WaitListDealHelper(t.waitListItemId);return{dealHelper:e}},computed:{waitListItem(){return this.$store.getters[`${bt.Model.WaitList}/getById`](this.waitListItemId)},deal(){var t,e,o;return(t=(e=this.waitListItem)==null?void 0:(o=e.externalData)==null?void 0:o.find((t=>t.entityTypeId===bt.CrmEntity.Deal)))!=null?t:null}},template:`\n\t\t<Deal\n\t\t\t:deal="deal"\n\t\t\t:dealHelper="dealHelper"\n\t\t\t:dataId="waitListItemId"\n\t\t\t:dataAttributes="{\n\t\t\t\t'data-wait-list-item-id': waitListItemId,\n\t\t\t}"\n\t\t\tdataElementPrefix="wait-list"\n\t\t\t@freeze="$emit('freeze')"\n\t\t\t@unfreeze="$emit('unfreeze')"\n\t\t/>\n\t`};const Uo={name:"WaitListItemDocument",components:{Document:O.Document},props:{waitListItemId:{type:Number,required:true}},setup(){const t=mt.ref(true);mt.onMounted((()=>{t.value=false}));return{isLoading:t}},template:`\n\t\t<Document\n\t\t\t:id="waitListItemId"\n\t\t\t:loading="isLoading"\n\t\t\tdisabled\n\t\t/>\n\t`};const qo={name:"WaitListItemMessage",components:{Message:O.Message},props:{waitListItemId:{type:Number,required:true}},template:`\n\t\t<Message\n\t\t\t:id="waitListItemId"\n\t\t\t:clientData="null"\n\t\t\t:loading="false"\n\t\t\tdisabled\n\t\t\t:dataId="waitListItemId"\n\t\t\tdataElementPrefix="wait-list"\n\t\t/>\n\t`};const Xo={name:"WaitListItemRemove",components:{RemoveButton:O.RemoveButton},props:{waitListItemId:{type:Number,required:true}},emits:["close"],methods:{remove(){new R.RemoveWaitListItem(this.waitListItemId);this.$emit("close")}},template:`\n\t\t<RemoveButton\n\t\t\tshowLabel\n\t\t\t:dataAttributes="{\n\t\t\t\t'data-id': waitListItemId,\n\t\t\t\t'data-element': 'booking-wait-list-item-menu-remove-button'\n\t\t\t}"\n\t\t\t@remove="remove"\n\t\t/>\n\t`};const Vo={name:"WaitListItemVisit",components:{Visit:O.Visit},props:{waitListItemId:{type:Number,required:true}},computed:{waitListItem(){return this.$store.getters[`${bt.Model.WaitList}/getById`](this.waitListItemId)}},template:`\n\t\t<Visit\n\t\t\t:id="waitListItem.id"\n\t\t\t:hasClients="waitListItem.clients.length > 0"\n\t\t\tvisitStatus="0"\n\t\t\tdisabled\n\t\t\t:dataId="waitListItem.id"\n\t\t\tdataElementPrefix="wait-list"\n\t\t/>\n\t`};const jo=Object.freeze({client:"client",confirmation:"confirmation",deal:"deal",document:"document",fullForm:"fullForm",message:"message",visit:"visit",overbooking:"overbooking",remove:"remove",waitList:"waitList"});const Yo={name:"WaitListItemActionsPopup",components:{ActionsPopup:O.ActionsPopup,FullForm:O.FullForm,WaitListItemClient:xo,WaitListItemConfirmation:Ko,WaitListItemDeal:Wo,WaitListItemDocument:Uo,WaitListItemMessage:qo,WaitListItemRemove:Xo,WaitListItemVisit:Vo},props:{waitListItem:{type:Object,required:true},bindElement:{type:HTMLElement,required:true}},emits:["close"],computed:{config(){return{offsetTop:-100,offsetLeft:-500,className:"booking--wait-list--wait-list-item--sticky-popup"}},contentStructure(){const t=this.waitListItem.id;return[{id:jo.client,props:{waitListItemId:t},component:xo},[{id:jo.deal,props:{waitListItemId:t},component:Wo},{id:jo.document,props:{waitListItemId:t},component:Uo}],[{id:jo.fullForm,props:{waitListItemId:t},component:O.FullForm},{id:jo.info,class:"--shrink",props:{waitListItemId:t},component:O.Info}]]}},template:`\n\t\t<ActionsPopup\n\t\t\t:popupId="waitListItem.id"\n\t\t\t:bindElement="bindElement"\n\t\t\t:contentStructure="contentStructure"\n\t\t\t:popupOptions="config"\n\t\t\t@close="$emit('close')"\n\t\t>\n\t\t\t<template #footer>\n\t\t\t\t<WaitListItemRemove\n\t\t\t\t\t:waitListItemId="waitListItem.id"\n\t\t\t\t\t@close="$emit('close')"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t</ActionsPopup>\n\t`};const Zo={name:"WaitListItemActions",components:{WaitListItemActionsPopup:Yo},props:{waitListItem:{type:Object,required:true}},data(){return{showPopup:false}},computed:{...ut.mapGetters({editingWaitListItemId:`${bt.Model.Interface}/editingWaitListItemId`,isEditingBookingMode:`${bt.Model.Interface}/isEditingBookingMode`})},mounted(){if(this.isEditingBookingMode&&this.editingWaitListItemId===this.waitListItem.id){this.showPopup=true}},methods:{clickHandler(){this.showPopup=!this.showPopup}},template:`\n\t\t<div\n\t\t\tref="node"\n\t\t\tclass="booking-booking-booking-actions booking--wait-list-item-actions"\n\t\t\tdata-element="booking-wait-list-item-actions-button"\n\t\t\t:data-id="waitListItem.id"\n\t\t\t@click="clickHandler"\n\t\t>\n\t\t\t<div class="booking-booking-booking-actions-inner">\n\t\t\t\t<div class="ui-icon-set --chevron-down"></div>\n\t\t\t</div>\n\t\t</div>\n\t\t<WaitListItemActionsPopup\n\t\t\tv-if="showPopup"\n\t\t\t:waitListItem\n\t\t\t:bindElement="this.$refs.node"\n\t\t\t@close="showPopup = false"\n\t\t/>\n\t`};const Qo={name:"WaitListItemAddClient",components:{AddClient:D.AddClient},props:{waitListItem:{type:Object,required:true}},methods:{async addClient(t){const e=this.waitListItem.id;await N.waitListService.update({id:e,clients:t})}},template:`\n\t\t<AddClient\n\t\t\t:dataAttributes="{\n\t\t\t\t'data-id': waitListItem.id,\n\t\t\t\t'data-element': 'booking-wait-list-item-add-client-button',\n\t\t\t}"\n\t\t\t:popupOffsetLeft="-300"\n\t\t\t@add="addClient"\n\t\t/>\n\t`};const Jo={name:"WaitListItemCrmButton",components:{CrmButton:D.CrmButton},props:{waitListItem:{type:Object,required:true}},setup(t){const e=new P.WaitListDealHelper(t.waitListItem.id);return{dealHelper:e}},template:`\n\t\t<CrmButton\n\t\t\t:dealHelper\n\t\t\t:dataAttributes="{\n\t\t\t\t'data-wait-list-item-id': waitListItem.id,\n\t\t\t\t'data-element': 'wait-list-item-crm-button'\n\t\t\t}"\n\t\t/>\n\t`};const ti={name:"WaitListItem",components:{BookingBase:D.BookingBase,Communication:D.Communication,DisabledPopup:D.DisabledPopup,WaitListItemName:Ho,WaitListItemNote:zo,WaitListItemProfit:Go,WaitListItemActions:Zo,WaitListItemAddClient:Qo,WaitListItemCrmButton:Jo},props:{item:{type:Object,required:true}},data(){return{isDisabledPopupShown:false,visibleNotePopup:false}},computed:{...ut.mapGetters({editingWaitListItemId:`${bt.Model.Interface}/editingWaitListItemId`,isEditingBookingMode:`${bt.Model.Interface}/isEditingBookingMode`,isWaitListItemCreatedFromEmbed:`${bt.Model.Interface}/isWaitListItemCreatedFromEmbed`,animationPause:`${bt.Model.Interface}/animationPause`}),hasClient(){return this.item.clients.length>0},disabled(){return this.isEditingBookingMode&&this.editingWaitListItemId!==this.item.id},dataAttributes(){return{"data-id":this.item.id,"data-kind":bt.DraggedElementKind.WaitListItem,"data-element":"booking-wait-list-item"}},hasAccent(){return this.editingWaitListItemId===this.item.id||this.isWaitListItemCreatedFromEmbed(this.item.id)}},methods:{onClick(){if(this.disabled){this.isDisabledPopupShown=true}},onNoteMouseEnter(){this.showNoteTimeout=setTimeout((()=>{this.visibleNotePopup=true}),100)},onNoteMouseLeave(){clearTimeout(this.showNoteTimeout);this.visibleNotePopup=false}},template:`\n\t\t<BookingBase\n\t\t\t:disabled\n\t\t\t:bookingClass="{\n\t\t\t\t'booking--draggable-item': true,\n\t\t\t\t'booking-wait-list-item': true,\n\t\t\t\t'--disabled': disabled,\n\t\t\t\t'--accent': hasAccent,\n\t\t\t\t'no-transition': animationPause,\n\t\t\t}"\n\t\t\t:dataAttributes="dataAttributes"\n\t\t\t@click="onClick"\n\t\t>\n\t\t\t<template #upper-content-row>\n\t\t\t\t<div\n\t\t\t\t\tclass="booking-booking-booking-name-container"\n\t\t\t\t\t@mouseenter="onNoteMouseEnter"\n\t\t\t\t\t@mouseleave="onNoteMouseLeave"\n\t\t\t\t>\n\t\t\t\t\t<WaitListItemName :waitListItem="item"/>\n\t\t\t\t\t<WaitListItemNote\n\t\t\t\t\t\t:waitListItem="item"\n\t\t\t\t\t\t:bindElement="() => $el"\n\t\t\t\t\t\t:visiblePopup="visibleNotePopup"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<WaitListItemProfit :waitListItem="item"/>\n\t\t\t</template>\n\t\t\t<template #lower-content-row>\n\t\t\t\t<div class="booking--wait-list-item--space"></div>\n\t\t\t\t<div v-if="hasClient" class="booking--booking-base-buttons">\n\t\t\t\t\t<Communication/>\n\t\t\t\t\t<WaitListItemCrmButton :waitListItem="item"/>\n\t\t\t\t</div>\n\t\t\t\t<WaitListItemAddClient\n\t\t\t\t\tv-else\n\t\t\t\t\t:waitListItem="item"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<template #end>\n\t\t\t\t<DisabledPopup\n\t\t\t\t\tv-if="isDisabledPopupShown"\n\t\t\t\t\t:popupId="'booking-wait-list-item-disabled-popup-' + item.id"\n\t\t\t\t\t:bindElement="() => $el"\n\t\t\t\t\t@close="isDisabledPopupShown = false"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<template #actions>\n\t\t\t\t<WaitListItemActions :waitListItem="item"/>\n\t\t\t</template>\n\t\t</BookingBase>\n\t`};const ei={name:"ButtonAddWaitListItem",components:{Button:dt.Button},setup(){return{ButtonColor:dt.ButtonColor,ButtonSize:dt.ButtonSize}},computed:{...ut.mapGetters({embedItems:`${bt.Model.Interface}/embedItems`,isLoaded:`${bt.Model.Interface}/isLoaded`,isEditingBookingMode:`${bt.Model.Interface}/isEditingBookingMode`,waitListItems:`${bt.Model.WaitList}/get`,waitListExpanded:`${bt.Model.Interface}/waitListExpanded`}),addButtonText(){return this.isLoaded&&this.waitListItems.length===0?this.loc("BOOKING_BOOKING_WAIT_LIST_ADD").replace("[plus]","+"):"+"},disabled(){return this.isEditingBookingMode||!this.isLoaded},clients(){const t=this.embedItems.filter((t=>t.entityTypeId==="CONTACT"||t.entityTypeId==="COMPANY"));return t.map((t=>({id:t.value,type:{code:t.entityTypeId,module:t.moduleId}})))}},methods:{async addWaitListItem(){if(this.disabled||!this.isLoaded){return}if(!this.waitListExpanded){await this.expandWaitListWidget()}const t=Date.now();const e=`tmp-id-${t}-${ht.Text.getRandom(4)}`;await this.addCreatedFromEmbedWaitListItem(e);const o=await N.waitListService.add({id:e,clients:this.clients,externalData:this.embedItems,createdAt:t,updatedAt:t});if(o.success&&o.waitListItem){lt.WaitListAnalytics.sendAddBooking();await this.addCreatedFromEmbedWaitListItem(o.waitListItem.id)}},async addCreatedFromEmbedWaitListItem(t){await this.$store.dispatch(`${bt.Model.Interface}/addCreatedFromEmbedWaitListItem`,t)},async expandWaitListWidget(){await this.$store.commit("interface/setWaitListExpanded",true)}},template:`\n\t\t<Button\n\t\t\tclass="booking-wait-list-add"\n\t\t\t:text="addButtonText"\n\t\t\t:size="ButtonSize.EXTRA_SMALL"\n\t\t\t:color="ButtonColor.SECONDARY_LIGHT"\n\t\t\t:disabled\n\t\t\t:round="true"\n\t\t\t@click="addWaitListItem"\n\t\t/>\n\t`};const oi={name:"WaitList",components:{Button:dt.Button,Icon:j.BIcon,ButtonAddWaitListItem:ei,WaitListLayout:No,WaitListGroups:Ao,WaitListItem:ti},data(){return{IconSet:j.Set,ButtonColor:dt.ButtonColor,ButtonSize:dt.ButtonSize}},computed:{...ut.mapGetters({getBookingById:`${bt.Model.Bookings}/getById`,waitListItems:`${bt.Model.WaitList}/get`,waitListExpanded:`${bt.Model.Interface}/waitListExpanded`,draggedBookingId:`${bt.Model.Interface}/draggedBookingId`,editingBookingId:`${bt.Model.Interface}/editingBookingId`,editingWaitListItemId:`${bt.Model.Interface}/editingWaitListItemId`,isFeatureEnabled:`${bt.Model.Interface}/isFeatureEnabled`,isBookingCreatedFromEmbed:`${bt.Model.Interface}/isBookingCreatedFromEmbed`,embedItems:`${bt.Model.Interface}/embedItems`}),isEmpty(){return this.waitListItems.length===0},showEmptyState(){return this.isEmpty&&!this.draggedBookingId},embedEditingMode(){var t,e;return this.isFeatureEnabled&&(this.editingBookingId>0||this.editingWaitListItemId>0||((t=(e=this.embedItems)==null?void 0:e.length)!=null?t:0)>0)}},watch:{async waitListExpanded(t,e){if(t!==e){await Z.optionService.setBool(bt.Option.WaitListExpanded,t)}}},methods:{async onMouseUp(){if(!this.draggedBookingId){return}const t=this.draggedBookingId;await this.$store.dispatch(`${bt.Model.Interface}/addDeletingBooking`,t);if(L.isRealId(t)){if(this.editingBookingId===t){await this.setEditingWaitListItemId(t)}const e=this.getBookingById(t);const o=await N.waitListService.createFromBooking(t,{id:t,clients:e.clients,primaryClient:e.primaryClient,externalData:e.externalData,createdAt:Date.now(),updatedAt:Date.now()});if(o.success&&o.waitListItem){lt.BookingAnalytics.sendAddWaitListItem();if(this.editingWaitListItemId===t){await this.setEditingWaitListItemId(o.waitListItem.id)}}}else{if(this.isBookingCreatedFromEmbed(t)){await this.addCreatedFromEmbedWaitListItem(t)}const e=await N.waitListService.add({id:t,clients:[],createdAt:Date.now(),updatedAt:Date.now()});if(e.success&&e.waitListItem){await this.addCreatedFromEmbedWaitListItem(e.waitListItem.id)}}},async addCreatedFromEmbedWaitListItem(t){await this.$store.dispatch(`${bt.Model.Interface}/addCreatedFromEmbedWaitListItem`,t)},async setEditingWaitListItemId(t){await Promise.all([this.$store.dispatch(`${bt.Model.Interface}/setEditingWaitListItemId`,t),this.$store.dispatch(`${bt.Model.Interface}/setEditingBookingId`,null)])},async collapseToggle(){await this.$store.dispatch(`${bt.Model.Interface}/setWaitListExpanded`,!this.waitListExpanded)}},template:`\n\t\t<WaitListLayout\n\t\t\t:dragging="Boolean(draggedBookingId)"\n\t\t\t:showEmptyState\n\t\t\t:expanded="waitListExpanded"\n\t\t\t:waitListItemsCount="waitListItems.length"\n\t\t\t:waitListClass="{\n\t\t\t\t'--expand': waitListExpanded,\n\t\t\t\t'embed-editing-mode': embedEditingMode,\n\t\t\t}"\n\t\t\t@mouseUp="onMouseUp"\n\t\t>\n\t\t\t<template #header>\n\t\t\t\t<ButtonAddWaitListItem/>\n\t\t\t\t<div class="booking-sidebar-button" @click="collapseToggle">\n\t\t\t\t\t<Icon :name="waitListExpanded ? IconSet.COLLAPSE : IconSet.EXPAND_1"/>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<template #waitlist>\n\t\t\t\t<WaitListGroups>\n\t\t\t\t\t<template #item="{ item }">\n\t\t\t\t\t\t<WaitListItem :item/>\n\t\t\t\t\t</template>\n\t\t\t\t</WaitListGroups>\n\t\t\t</template>\n\t\t</WaitListLayout>\n\t`};const ii={components:{Calendar:Fo,WaitList:oi},template:`\n\t\t<div class="booking-booking-sidebar">\n\t\t\t<Calendar/>\n\t\t\t<WaitList/>\n\t\t</div>\n\t`};const si={data(){return{IconSet:j.Set}},computed:{...ut.mapGetters({draggedDataTransfer:`${bt.Model.Interface}/draggedDataTransfer`})},methods:{onMouseUp(){if(this.draggedDataTransfer.kind===bt.DraggedElementKind.Booking){new _.RemoveBooking(this.draggedDataTransfer.id);return}if(this.draggedDataTransfer.kind===bt.DraggedElementKind.WaitListItem){new R.RemoveWaitListItem(this.draggedDataTransfer.id)}}},components:{Icon:j.BIcon},template:`\n\t\t<div v-if="draggedDataTransfer.id > 0" class="booking-booking-drag-delete">\n\t\t\t<div\n\t\t\t\tclass="booking-booking-drag-delete-button"\n\t\t\t\tdata-element="booking-drag-delete"\n\t\t\t\t@mouseup.capture="onMouseUp"\n\t\t\t>\n\t\t\t\t<Icon :name="IconSet.TRASH_BIN"/>\n\t\t\t\t<div class="booking-booking-drag-delete-button-text">\n\t\t\t\t\t{{ loc('BOOKING_BOOKING_DRAG_DELETE') }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const ni={data(){return{scrolledToBooking:false}},mounted(){this.ears=new st.Ears({container:this.$refs.columnsContainer,smallSize:true,className:"booking-booking-grid-columns-ears"}).init();ht.Event.EventEmitter.subscribe("BX.Main.Popup:onAfterClose",this.tryShowAhaMoment);ht.Event.EventEmitter.subscribe("BX.Main.Popup:onDestroy",this.tryShowAhaMoment)},computed:{...ut.mapGetters({resourcesIds:`${bt.Model.Interface}/resourcesIds`,scroll:`${bt.Model.Interface}/scroll`,editingBookingId:`${bt.Model.Interface}/editingBookingId`,editingWaitListItemId:`${bt.Model.Interface}/editingWaitListItemId`,isFeatureEnabled:`${bt.Model.Interface}/isFeatureEnabled`,isLoaded:`${bt.Model.Interface}/isLoaded`}),editingBooking(){var t;return(t=this.$store.getters["bookings/getById"](this.editingBookingId))!=null?t:null}},beforeUnmount(){var t;(t=this.dragManager)==null?void 0:t.destroy()},methods:{updateEars(){this.ears.toggleEars();this.tryShowAhaMoment()},areEarsShown(){const t="ui-ear-show";return ht.Dom.hasClass(this.ears.getRightEar(),t)||ht.Dom.hasClass(this.ears.getLeftEar(),t)},scrollToEditingBooking(){if(!this.editingBooking||this.scrolledToBooking){return}const t=w.grid.calculateTop(this.editingBooking.dateFromTs);const e=w.grid.calculateHeight(this.editingBooking.dateFromTs,this.editingBooking.dateToTs);this.$refs.inner.scrollTop=t+e/2+this.$refs.inner.offsetHeight/2;this.scrolledToBooking=true},tryShowAhaMoment(){if(this.areEarsShown()&&ft.ahaMoments.shouldShow(bt.AhaMoment.ExpandGrid)){ht.Event.EventEmitter.unsubscribe("BX.Main.Popup:onAfterClose",this.tryShowAhaMoment);ht.Event.EventEmitter.unsubscribe("BX.Main.Popup:onDestroy",this.tryShowAhaMoment);void this.$refs.scalePanel.showAhaMoment()}},initDragManager(t="",e=null){if(this.isFeatureEnabled){const o=t?`[data-id="${t}"]`:"";const i=e?`[data-kind="${e}"]`:"";this.dragManager=new c.Drag({container:this.$el.parentElement,draggable:`.booking--draggable-item${o}${i}`})}}},watch:{scroll(t){this.$refs.columnsContainer.scrollLeft=t},editingBooking(){this.scrollToEditingBooking()},isLoaded(t){if(t){let t=null;let e=null;if(this.editingBookingId){t=this.editingBookingId;e=bt.DraggedElementKind.Booking}if(this.editingWaitListItemId){t=this.editingWaitListItemId;e=bt.DraggedElementKind.WaitListItem}this.initDragManager(t,e)}},editingBookingId(t){if(t){this.initDragManager(t,bt.DraggedElementKind.Booking)}},editingWaitListItemId(t){if(t){this.initDragManager(t,bt.DraggedElementKind.WaitListItem)}}},components:{LeftPanel:Yt,NowLine:Zt,Column:Ye,Bookings:Ue,ScalePanel:Po,Sidebar:ii,DragDelete:si},template:`\n\t\t<div ref="bookingContainer" class="booking-booking-grid">\n\t\t\t<div\n\t\t\t\tid="booking-booking-grid-wrap"\n\t\t\t\tclass="booking-booking-grid-inner --vertical-scroll-bar"\n\t\t\t\tref="inner"\n\t\t\t>\n\t\t\t\t<LeftPanel/>\n\t\t\t\t<NowLine/>\n\t\t\t\t<div\n\t\t\t\t\tid="booking-booking-grid-columns"\n\t\t\t\t\tclass="booking-booking-grid-columns --horizontal-scroll-bar"\n\t\t\t\t\tref="columnsContainer"\n\t\t\t\t\t@scroll="$store.dispatch('interface/setScroll', $refs.columnsContainer.scrollLeft)"\n\t\t\t\t>\n\t\t\t\t\t<Bookings/>\n\t\t\t\t\t<TransitionGroup\n\t\t\t\t\t\tname="booking-transition-resource"\n\t\t\t\t\t\t@after-leave="updateEars"\n\t\t\t\t\t\t@after-enter="updateEars"\n\t\t\t\t\t>\n\t\t\t\t\t\t<template v-for="resourceId of resourcesIds" :key="resourceId">\n\t\t\t\t\t\t\t<Column :resourceId="resourceId"/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</TransitionGroup>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<ScalePanel\n\t\t\t\t:getColumnsContainer="() => $refs.columnsContainer"\n\t\t\t\tref="scalePanel"\n\t\t\t/>\n\t\t\t<DragDelete/>\n\t\t</div>\n\t\t<Sidebar/>\n\t`};const ri=0;const ai=12;const di="var(--ui-color-primary-alt)";const li="var(--ui-color-background-secondary)";const ci=14;const ui=27;const hi={name:"BatteryIcon",props:{percent:{type:Number,default:0},dataId:{type:[String,Number],default:""},height:{type:Number,default:ci},width:{type:Number,default:ui}},mounted(){this.repaint()},methods:{getCharge(t){if(t<=0){return ri}if(t>=100){return ai}return Math.round(t*ai*.01)},repaint(){var t;const e=((t=this.$refs["icon-battery-charge"])==null?void 0:t.children)||[];const o=this.getCharge(this.percent);let i=1;for(const t of e){t.setAttribute("fill",i>o?li:di);i++}}},watch:{percent:{handler(){this.repaint()}}},template:`\n\t\t<div :data-id="dataId" :data-percent="percent" data-element="booking-resource-workload-percent">\n\t\t\t<svg id="booking--battery-icon" :width="width" :height="height" viewBox="0 0 27 14" fill="none"\n\t\t\t\t xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t<rect width="23.2875" height="13.8" rx="4" fill="white"/>\n\t\t\t\t<rect x="22.6871" y="0.6" width="12.6" height="22.0875" rx="3.4" transform="rotate(90 22.6871 0.6)" stroke="#C9CCD0" stroke-width="1.2"/>\n\t\t\t\t<g ref="icon-battery-charge" id="booking--battery-icon-charge" clip-path="url(#clip0_5003_187951)">\n\t\t\t\t\t<rect x="2.58789" y="2.5875" width="1.50917" height="10" fill="#EDEEF0"/>\n\t\t\t\t\t<rect x="4.09766" y="2.5875" width="1.50917" height="10" fill="#EDEEF0"/>\n\t\t\t\t\t<rect x="5.60547" y="2.5875" width="1.50917" height="10" fill="#EDEEF0"/>\n\t\t\t\t\t<rect x="7.11523" y="2.5875" width="1.50917" height="10" fill="#EDEEF0"/>\n\t\t\t\t\t<rect x="8.625" y="2.5875" width="1.50917" height="10" fill="#EDEEF0"/>\n\t\t\t\t\t<rect x="10.1328" y="2.5875" width="1.50917" height="10" fill="#EDEEF0"/>\n\t\t\t\t\t<rect x="11.6426" y="2.5875" width="1.50917" height="10" fill="#EDEEF0"/>\n\t\t\t\t\t<rect x="13.1523" y="2.5875" width="1.50917" height="10" fill="#EDEEF0"/>\n\t\t\t\t\t<rect x="14.6621" y="2.5875" width="1.50917" height="10" fill="#EDEEF0"/>\n\t\t\t\t\t<rect x="16.1699" y="2.5875" width="1.50917" height="10" fill="#EDEEF0"/>\n\t\t\t\t\t<rect x="17.6797" y="2.5875" width="1.50917" height="10" fill="#EDEEF0"/>\n\t\t\t\t\t<rect x="19.1895" y="2.5875" width="1.50917" height="10" fill="#EDEEF0"/>\n\t\t\t\t</g>\n\t\t\t\t<g clip-path="url(#clip1_5003_187951)">\n\t\t\t\t\t<ellipse cx="23.102" cy="6.89999" rx="2.9" ry="3.48" transform="rotate(90 23.102 6.89999)" fill="#C9CCD0"/>\n\t\t\t\t</g>\n\t\t\t\t<defs>\n\t\t\t\t\t<clipPath id="clip0_5003_187951">\n\t\t\t\t\t\t<rect x="2.58789" y="2.5875" width="18.1125" height="8.625" rx="1.5" fill="white"/>\n\t\t\t\t\t</clipPath>\n\t\t\t\t\t<clipPath id="clip1_5003_187951">\n\t\t\t\t\t\t<rect width="6.9" height="2.15625" fill="white" transform="translate(26.7383 3.45) rotate(90)"/>\n\t\t\t\t\t</clipPath>\n\t\t\t\t</defs>\n\t\t\t</svg>\n\t\t</div>\n\t`};const mi={emits:["close"],props:{resourceId:{type:Number,required:true},slotsCount:{type:Number,required:true},bookingCount:{type:Number,required:true},workLoadPercent:{type:Number,required:true},bindElement:{type:HTMLElement,required:true}},computed:{popupId(){return"booking-booking-resource-workload-popup"},title(){return this.loc("BOOKING_BOOKING_RESOURCE_WORKLOAD_POPUP_TITLE")},rows(){return[{title:this.loc("BOOKING_BOOKING_RESOURCE_WORKLOAD_SLOTS_BOOKED"),value:this.slotsBookedFormatted,dataset:{element:"booking-resource-workload-popup-count",resourceId:this.resourceId,bookedCount:this.bookingCount,totalCount:this.slotsCount}},{title:this.loc("BOOKING_BOOKING_RESOURCE_WORKLOAD"),value:this.workLoadPercentFormatted,dataset:{element:"booking-resource-workload-popup-percent",resourceId:this.resourceId,percent:this.workLoadPercent}}]},slotsBookedFormatted(){return this.loc("BOOKING_BOOKING_RESOURCE_WORKLOAD_BOOKED_FROM_SLOTS_COUNT",{"#BOOKED#":this.bookingCount,"#SLOTS_COUNT#":this.slotsCount})},workLoadPercentFormatted(){return this.loc("BOOKING_BOOKING_RESOURCE_WORKLOAD_PERCENT",{"#PERCENT#":this.workLoadPercent})}},components:{StatisticsPopup:H.StatisticsPopup},template:`\n\t\t<StatisticsPopup\n\t\t\t:popupId="popupId"\n\t\t\t:bindElement="bindElement"\n\t\t\t:title="title"\n\t\t\t:rows="rows"\n\t\t\t:dataset="{\n\t\t\t\tid: resourceId,\n\t\t\t\telement: 'booking-resource-workload-popup',\n\t\t\t}"\n\t\t\t@close="$emit('close')"\n\t\t/>\n\t`};const pi={name:"ResourceWorkload",props:{resourceId:{type:Number,required:true},scale:{type:Number,default:1},isGrid:{type:Boolean,default:false}},data(){return{isPopupShown:false}},computed:{...ut.mapGetters({selectedDateTs:"interface/selectedDateTs",fromHour:"interface/fromHour",toHour:"interface/toHour"}),workLoadPercent(){if(this.slotsCount===0){return 0}const t=this.slotSize*this.slotsCount;return this.bookings.reduce(((e,o)=>e+Math.round(o.duration*100/t)),0)},slotSize(){var t;return(t=this.resource.slotRanges[0].slotSize)!=null?t:60},slotsCount(){const t=new Date(this.selectedDateTs);const e=bt.DateFormat.WeekDays[t.getDay()];const o=J.busySlots.filterSlotRanges(this.resource.slotRanges.filter((t=>t.weekDays.includes(e))));return Math.floor(o.reduce(((t,e)=>t+(e.to-e.from)/this.slotSize),0))},bookings(){const t=this.selectedDateTs;return this.$store.getters[`${bt.Model.Bookings}/getByDateAndResources`](t,[this.resourceId]).map((t=>({dateFromTs:t.dateFromTs,dateToTs:t.dateToTs,duration:(t.dateToTs-t.dateFromTs)/6e4})))},bookingCount(){return this.bookings.length},bookingsDuration(){return this.bookings.reduce(((t,e)=>t+e.duration),0)},resource(){return this.$store.getters["resources/getById"](this.resourceId)},batteryIconOptions(){return{height:Math.round(ci*this.scale),width:Math.round(ui*this.scale)}},bookingsCount(){return this.bookings.length}},methods:{onMouseEnter(){this.showTimeout=setTimeout((()=>this.showPopup()),100)},onMouseLeave(){clearTimeout(this.showTimeout);this.closePopup()},showPopup(){this.isPopupShown=true},closePopup(){this.isPopupShown=false},async showAhaMoment(){ft.ahaMoments.setPopupShown(bt.AhaMoment.ResourceWorkload);await ft.ahaMoments.show({id:"booking-resource-workload",title:this.loc("BOOKING_AHA_RESOURCE_WORKLOAD_TITLE"),text:this.loc("BOOKING_AHA_RESOURCE_WORKLOAD_TEXT"),article:bt.HelpDesk.AhaResourceWorkload,target:this.$refs.container});ft.ahaMoments.setShown(bt.AhaMoment.ResourceWorkload)}},watch:{bookingsCount(t,e){if(this.isGrid&&t>e&&ft.ahaMoments.shouldShow(bt.AhaMoment.ResourceWorkload)){void this.showAhaMoment()}}},components:{BatteryIcon:hi,WorkloadPopup:mi},template:`\n\t\t<div\n\t\t\tclass="booking-booking-header-resource-workload"\n\t\t\tdata-element="booking-resource-workload"\n\t\t\t:data-id="resourceId"\n\t\t\tref="container"\n\t\t\t@click="showPopup"\n\t\t\t@mouseenter="onMouseEnter"\n\t\t\t@mouseleave="onMouseLeave"\n\t\t>\n\t\t\t<BatteryIcon\n\t\t\t\t:percent="workLoadPercent"\n\t\t\t\t:data-id="resourceId"\n\t\t\t\t:height="batteryIconOptions.height"\n\t\t\t\t:width="batteryIconOptions.width"\n\t\t\t/>\n\t\t</div>\n\t\t<WorkloadPopup\n\t\t\tv-if="isPopupShown"\n\t\t\t:resourceId="resourceId"\n\t\t\t:slotsCount="slotsCount"\n\t\t\t:bookingCount="Math.ceil(bookingsDuration / slotSize)"\n\t\t\t:workLoadPercent="workLoadPercent"\n\t\t\t:bindElement="$refs.container"\n\t\t\t@close="closePopup"\n\t\t/>\n\t`};const gi={name:"ResourceMenu",props:{resourceId:{type:Number,required:true}},data(){return{menuPopup:null}},computed:{...ut.mapGetters({favoritesIds:`${bt.Model.Favorites}/get`,isEditingBookingMode:`${bt.Model.Interface}/isEditingBookingMode`,isFeatureEnabled:`${bt.Model.Interface}/isFeatureEnabled`}),popupId(){return`resource-menu-${this.resourceId||"new"}`}},created(){this.hint=BX.UI.Hint.createInstance({popupParameters:{}})},unmounted(){if(this.menuPopup){this.destroy()}},methods:{openMenu(){var t,e;if((t=this.menuPopup)!=null&&(e=t.popupWindow)!=null&&e.isShown()){this.destroy();return}const o=this.$refs["menu-button"];this.menuPopup=V.MenuManager.create(this.popupId,o,this.getMenuItems(),{className:"booking-resource-menu-popup",closeByEsc:true,autoHide:true,offsetTop:-3,offsetLeft:o.offsetWidth-6,angle:true,cacheable:true,events:{onDestroy:()=>this.unbindScrollEvent()}});this.menuPopup.show();this.bindScrollEvent()},getMenuItems(){return[{html:`<span>${this.loc("BOOKING_RESOURCE_MENU_EDIT_RESOURCE")}</span>`,className:this.isFeatureEnabled?"menu-popup-item menu-popup-no-icon":"menu-popup-item --lock",onclick:async()=>{if(!this.isFeatureEnabled){et.limit.show();return}const t=new W.ResourceCreationWizard;this.editResource(this.resourceId,t);this.destroy()}},{html:`<span>${this.loc("BOOKING_RESOURCE_MENU_HIDE")}</span>`,onclick:async()=>{this.destroy();await this.hideResource(this.resourceId)}},{html:`<span class="alert-text">${this.loc("BOOKING_RESOURCE_MENU_DELETE")}</span>`,onclick:async()=>{this.destroy();await this.deleteResource(this.resourceId)}}]},destroy(){V.MenuManager.destroy(this.popupId);this.unbindScrollEvent()},bindScrollEvent(){ht.Event.bind(document,"scroll",this.adjustPosition,{capture:true})},unbindScrollEvent(){ht.Event.unbind(document,"scroll",this.adjustPosition,{capture:true})},adjustPosition(){var t,e;(t=this.menuPopup)==null?void 0:(e=t.popupWindow)==null?void 0:e.adjustPosition()},async editResource(t,e){e.open(t)},async hideResource(t){const e=[...this.favoritesIds];const o=this.favoritesIds.indexOf(t);if(o===-1){return}e.splice(o,1);await q.hideResources(e)},async deleteResource(t){const e=await this.confirmDelete(t);if(e){await x.resourceService.delete(t)}},async confirmDelete(t){const e=await x.resourceService.hasBookings(t);return new Promise((t=>{const o=z.MessageBox.create({message:ht.Loc.getMessage("BOOKING_RESOURCE_CONFIRM_DELETE"),yesCaption:ht.Loc.getMessage("BOOKING_RESOURCE_CONFIRM_DELETE_YES"),modal:true,buttons:z.MessageBoxButtons.YES_CANCEL,onYes:()=>{o.close();t(true)},onCancel:()=>{o.close();t(false)}});if(e){const t=o.getPopupWindow();t.subscribe("onAfterShow",(()=>{const t=o.getYesButton();t.setDisabled(true);ht.Event.bind(t.getContainer(),"mouseenter",(()=>{this.hint.show(t.getContainer(),ht.Loc.getMessage("BOOKING_RESOURCE_CONFIRM_DELETE_HINT"),true)}));ht.Event.bind(t.getContainer(),"mouseleave",(()=>{this.hint.hide(t.getContainer())}))}))}o.show()}))}},template:`\n\t\t<button ref="menu-button" class="ui-icon-set --more" @click="openMenu"></button>\n\t`};const bi={props:{resourceId:{type:Number,required:true}},data(){return{visible:true}},mounted(){this.updateVisibility();this.updateVisibilityDuringTransition()},computed:{...ut.mapGetters({resourcesIds:`${bt.Model.Interface}/resourcesIds`,zoom:`${bt.Model.Interface}/zoom`,scroll:`${bt.Model.Interface}/scroll`,selectedDateTs:`${bt.Model.Interface}/selectedDateTs`}),resource(){return this.$store.getters[`${bt.Model.Resources}/getById`](this.resourceId)},resourceType(){return this.$store.getters[`${bt.Model.ResourceTypes}/getById`](this.resource.typeId)},profit(){const t=A.currencyFormat.getBaseCurrencyId();const e=this.bookings.map((({externalData:t})=>{var e;return(e=t==null?void 0:t.find((t=>t.entityTypeId===bt.CrmEntity.Deal)))!=null?e:null})).filter((e=>{var o;return(e==null?void 0:(o=e.data)==null?void 0:o.currencyId)===t}));if(e.length===0){return""}const o=[...new Map(e.map((t=>[t.value,t]))).values()];const i=o.reduce(((t,e)=>t+e.data.opportunity),0);return A.currencyFormat.format(t,i)},bookings(){return this.$store.getters[`${bt.Model.Bookings}/getByDateAndResources`](this.selectedDateTs,[this.resourceId])}},methods:{updateVisibilityDuringTransition(){var t;(t=this.animation)==null?void 0:t.stop();this.animation=new BX.easing({duration:200,start:{},finish:{},step:this.updateVisibility});this.animation.animate()},updateVisibility(){if(!this.$refs.container){return}const t=this.$refs.container.getBoundingClientRect();this.visible=t.right>0&&t.left<window.innerWidth}},watch:{scroll(){this.updateVisibility()},zoom(){this.updateVisibility()},resourcesIds(){this.updateVisibilityDuringTransition()}},components:{ResourceMenu:gi,ResourceWorkload:pi},template:`\n\t\t<div\n\t\t\tclass="booking-booking-header-resource"\n\t\t\tdata-element="booking-resource"\n\t\t\t:data-id="resourceId"\n\t\t\tref="container"\n\t\t>\n\t\t\t<template v-if="visible">\n\t\t\t\t<ResourceWorkload\n\t\t\t\t\t:resourceId="resourceId"\n\t\t\t\t\t:scale="zoom"\n\t\t\t\t\t:isGrid="true"\n\t\t\t\t/>\n\t\t\t\t<div class="booking-booking-header-resource-title">\n\t\t\t\t\t<div class="booking-booking-header-resource-name" :title="resource.name">\n\t\t\t\t\t\t{{ resource.name }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="booking-booking-header-resource-type" :title="resourceType.name">\n\t\t\t\t\t\t{{ resourceType.name }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="booking-booking-header-resource-profit" v-html="profit"></div>\n\t\t\t\t<div class="booking-booking-header-resource-actions">\n\t\t\t\t\t<ResourceMenu :resource-id/>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\t`};const fi={data(){return{IconSet:j.Set,hovered:false}},computed:ut.mapGetters({isLoaded:`${bt.Model.Interface}/isLoaded`,isFeatureEnabled:`${bt.Model.Interface}/isFeatureEnabled`}),methods:{async addResource(){if(!this.isFeatureEnabled){await et.limit.show();return}(new W.ResourceCreationWizard).open();lt.RcwAnalytics.sendClickAddResource()},async showAhaMoment(){await ft.ahaMoments.show({id:"booking-add-resource",title:this.loc("BOOKING_AHA_ADD_RESOURCES_TITLE"),text:this.loc("BOOKING_AHA_ADD_RESOURCES_TEXT_MSGVER_1"),article:{...bt.HelpDesk.AhaAddResource,title:this.loc("BOOKING_AHA_ARTICLE_LINK_TITLE")},target:this.$refs.button});ft.ahaMoments.setShown(bt.AhaMoment.AddResource)}},watch:{isLoaded(){if(ft.ahaMoments.shouldShow(bt.AhaMoment.AddResource)){void this.showAhaMoment()}}},components:{Icon:j.BIcon},template:`\n\t\t<div\n\t\t\tclass="booking-booking-header-add-resource-icon-container"\n\t\t\t:class="{ '--hover': hovered }"\n\t\t\t@click="addResource"\n\t\t\t@mouseenter="hovered = true"\n\t\t\t@mouseleave="hovered = false"\n\t\t>\n\t\t\t<div\n\t\t\t\tclass="booking-booking-header-add-resource-icon"\n\t\t\t\t:class="{'--lock': !isFeatureEnabled}"\n\t\t\t>\n\t\t\t\t<Icon v-if="isFeatureEnabled" :name="IconSet.PLUS_20"/>\n\t\t\t\t<Icon v-else :name="IconSet.LOCK" :size="16"/>\n\t\t\t</div>\n\t\t</div>\n\t\t<div\n\t\t\tclass="booking-booking-header-add-resource"\n\t\t\t:class="{ '--hover': hovered }"\n\t\t\tref="button"\n\t\t\t@click="addResource"\n\t\t\t@mouseenter="hovered = true"\n\t\t\t@mouseleave="hovered = false"\n\t\t>\n\t\t\t<div class="booking-booking-header-add-resource-text">\n\t\t\t\t{{ loc('BOOKING_BOOKING_ADD_RESOURCE') }}\n\t\t\t</div>\n\t\t</div>\n\t`};class Ii extends tt.BaseHeader{constructor(...t){super(...t);this.getContainer()}render(){return this.options.content}}const ki={emits:["update:modelValue"],data(){return{selectedTypes:{}}},computed:ut.mapGetters({resourceTypes:"resourceTypes/get"}),methods:{selectAll(){Object.keys(this.selectedTypes).forEach((t=>{this.selectedTypes[t]=true}))},deselectAll(){Object.keys(this.selectedTypes).forEach((t=>{this.selectedTypes[t]=false}))}},watch:{resourceTypes(t){t.forEach((t=>{var e,o,i;(i=(e=this.selectedTypes)[o=t.id])!=null?i:e[o]=true}))},selectedTypes:{handler(){this.$emit("update:modelValue",this.selectedTypes)},deep:true}},template:`\n\t\t<div class="booking-booking-resources-dialog-header-types">\n\t\t\t<div class="booking-booking-resources-dialog-header-header">\n\t\t\t\t<div class="booking-booking-resources-dialog-header-title">\n\t\t\t\t\t{{ loc('BOOKING_BOOKING_RESOURCES_DIALOG_RESOURCE_TYPES') }}\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tclass="booking-booking-resources-dialog-header-button"\n\t\t\t\t\tdata-element="booking-resources-dialog-select-all-types-button"\n\t\t\t\t\t@click="selectAll"\n\t\t\t\t>\n\t\t\t\t\t{{ loc('BOOKING_BOOKING_RESOURCES_DIALOG_SELECT_ALL') }}\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tclass="booking-booking-resources-dialog-header-button"\n\t\t\t\t\tdata-element="booking-resources-dialog-deselect-all-types-button"\n\t\t\t\t\t@click="deselectAll"\n\t\t\t\t>\n\t\t\t\t\t{{ loc('BOOKING_BOOKING_RESOURCES_DIALOG_DESELECT_ALL') }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="booking-booking-resources-dialog-header-items">\n\t\t\t\t<template v-for="resourceType of resourceTypes" :key="resourceType.id">\n\t\t\t\t\t<label\n\t\t\t\t\t\tclass="booking-booking-resources-dialog-header-item"\n\t\t\t\t\t\tdata-element="booking-resources-dialog-type"\n\t\t\t\t\t\t:data-id="resourceType.id"\n\t\t\t\t\t\t:data-selected="selectedTypes[resourceType.id]"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tclass="booking-booking-resources-dialog-header-item-text"\n\t\t\t\t\t\t\tdata-element="booking-resources-dialog-type-name"\n\t\t\t\t\t\t\t:data-id="resourceType.id"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ resourceType.name }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<input type="checkbox" v-model="selectedTypes[resourceType.id]">\n\t\t\t\t\t</label>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t`};const vi={emits:["startResize","endResize"],props:{getNode:{type:Function,required:true}},data(){return{isResized:false,startMouseY:0,startHeight:0}},methods:{startResize(t){this.$emit("startResize");ht.Dom.style(document.body,"user-select","none");ht.Event.bind(window,"mouseup",this.endResize);ht.Event.bind(window,"pointermove",this.resize);this.isResized=true;this.startMouseY=t.clientY;this.startHeight=this.getNode().offsetHeight},resize(t){if(!this.isResized){return}t.preventDefault();const e=110;const o=180;const i=this.startHeight+t.clientY-this.startMouseY;const s=Math.min(o,Math.max(i,e));ht.Dom.style(this.getNode(),"max-height",`${s}px`)},endResize(){this.$emit("endResize");ht.Dom.style(document.body,"user-select","");ht.Event.unbind(window,"mouseup",this.endResize);ht.Event.unbind(window,"pointermove",this.resize);this.isResized=false}},template:`\n\t\t<div\n\t\t\tclass="booking-booking-resources-dialog-header-resize"\n\t\t\t@mousedown="startResize"\n\t\t></div>\n\t`};const Bi={emits:["search"],data(){return{searchDebounced:ht.Runtime.debounce(this.search,200,this),query:""}},computed:{searchIcon(){return j.Set.SEARCH_2}},methods:{onInput(t){const e=t.target.value;this.query=e;if(ht.Type.isStringFilled(e)){this.searchDebounced(e)}else{this.search(e)}},search(t){if(this.query===t){this.$emit("search",t)}}},components:{Icon:j.BIcon},template:`\n\t\t<div class="booking-booking-resources-dialog-header-input-container">\n\t\t\t<input\n\t\t\t\tclass="booking-booking-resources-dialog-header-input"\n\t\t\t\t:placeholder="loc('BOOKING_BOOKING_RESOURCES_DIALOG_SEARCH')"\n\t\t\t\tdata-element="booking-resources-dialog-search-input"\n\t\t\t\t@input="onInput"\n\t\t\t>\n\t\t\t<div class="booking-booking-resources-dialog-header-input-icon">\n\t\t\t\t<Icon :name="searchIcon"/>\n\t\t\t</div>\n\t\t</div>\n\t`};const Ti={emits:["update:modelValue","search","startResize","endResize","selectAll","deselectAll"],data(){return{selectedTypes:{}}},computed:ut.mapGetters({resources:"resources/get"}),watch:{selectedTypes:{handler(){this.$emit("update:modelValue",this.selectedTypes)},deep:true}},components:{ResourceTypes:ki,Resize:vi,Search:Bi},template:`\n\t\t<div class="booking-booking-resources-dialog-header" ref="header">\n\t\t\t<ResourceTypes\n\t\t\t\tref="resourceTypes"\n\t\t\t\tv-model="selectedTypes"\n\t\t\t/>\n\t\t\t<Resize\n\t\t\t\t:getNode="() => this.$refs.resourceTypes.$el"\n\t\t\t\t@startResize="$emit('startResize')"\n\t\t\t\t@endResize="$emit('endResize')"\n\t\t\t/>\n\t\t\t<div class="booking-booking-resources-dialog-header-resources">\n\t\t\t\t<div class="booking-booking-resources-dialog-header-header">\n\t\t\t\t\t<div class="booking-booking-resources-dialog-header-title">\n\t\t\t\t\t\t{{ loc('BOOKING_BOOKING_RESOURCES_DIALOG_RESOURCES') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="booking-booking-resources-dialog-header-button"\n\t\t\t\t\t\tdata-element="booking-resources-dialog-select-all-button"\n\t\t\t\t\t\t@click="$emit('selectAll')"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ loc('BOOKING_BOOKING_RESOURCES_DIALOG_SELECT_ALL') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="booking-booking-resources-dialog-header-button"\n\t\t\t\t\t\tdata-element="booking-resources-dialog-deselect-all-button"\n\t\t\t\t\t\t@click="$emit('deselectAll')"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ loc('BOOKING_BOOKING_RESOURCES_DIALOG_DESELECT_ALL') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<Search @search="(query) => this.$emit('search', query)"/>\n\t\t\t</div>\n\t\t</div>\n\t`};class yi extends tt.BaseFooter{constructor(...t){super(...t);this.getContainer()}render(){return this.options.content}}const wi={name:"DialogFooter",emits:["reset"],computed:{buttonSettings(){return Object.freeze({size:dt.ButtonSize.SMALL,color:dt.ButtonColor.LINK})},buttonLabel(){return this.loc("BOOKING_BOOKING_RESOURCES_DIALOG_RESET")}},components:{UiButton:dt.Button},template:`\n\t\t<div class="booking--booking--select-resources-dialog-footer">\n\t\t\t<UiButton\n\t\t\t\t:size="buttonSettings.size"\n\t\t\t\t:color="buttonSettings.color"\n\t\t\t\t:text="buttonLabel"\n\t\t\t\tbutton-class="booking--booking--select-resources-dialog-footer__button"\n\t\t\t\t@click="$emit('reset')"\n\t\t\t/>\n\t\t</div>\n\t`};const Mi={data(){return{dialogFilled:false,query:"",saveItemsDebounce:ht.Runtime.debounce(this.saveItems,10,this),workloadRefs:{},selectedTypes:{}}},mounted(){this.dialog=new tt.Dialog({context:"BOOKING",targetNode:this.$refs.button,width:340,height:Math.min(window.innerHeight-280,600),offsetLeft:4,dropdownMode:true,preselectedItems:this.favoritesIds.map((t=>[bt.EntitySelectorEntity.Resource,t])),items:this.resources.map((t=>this.getItemOptions(t))),entities:[{id:bt.EntitySelectorEntity.Resource}],events:{onShow:this.onShow,"Item:onSelect":this.saveItemsDebounce,"Item:onDeselect":this.saveItemsDebounce},header:Ii,headerOptions:{content:this.$refs.dialogHeader.$el},footer:yi,footerOptions:{content:this.$refs.dialogFooter.$el}});ht.Event.bind(this.dialog.getRecentTab().getContainer(),"scroll",this.loadOnScroll);ht.Event.EventEmitter.subscribe("BX.Main.Popup:onAfterClose",this.tryShowAhaMoment);ht.Event.EventEmitter.subscribe("BX.Main.Popup:onDestroy",this.tryShowAhaMoment)},computed:{...ut.mapGetters({selectedDateTs:`${bt.Model.Interface}/selectedDateTs`,favoritesIds:`${bt.Model.Favorites}/get`,resources:`${bt.Model.Resources}/get`,isFilterMode:`${bt.Model.Interface}/isFilterMode`,isEditingBookingMode:`${bt.Model.Interface}/isEditingBookingMode`,isLoaded:`${bt.Model.Interface}/isLoaded`,mainResources:`${bt.Model.MainResources}/resources`}),mainResourceIds(){return new Set(this.mainResources)},isDefaultState(){return this.mainResourceIds.size===this.favoritesIds.length&&this.favoritesIds.every((t=>this.mainResourceIds.has(t)))}},methods:{showDialog(){this.updateItems();void this.loadMainResources();this.dialog.show()},async onShow(){if(this.dialogFilled){void this.loadOnScroll();return}this.dialogFilled=true;await U.resourceDialogService.fillDialog(this.selectedDateTs/1e3)},async loadOnScroll(){const t=this.dialog.getRecentTab().getContainer();const e=t.scrollTop;const o=t.scrollHeight-t.offsetHeight;if(e+10>=o){const t=X.resourcesDateCache.getIdsByDateTs(this.selectedDateTs/1e3);const e=this.resources.map((t=>t.id));const o=e.filter((e=>!t.includes(e))).slice(0,bt.Limit.ResourcesDialog);await U.resourceDialogService.loadByIds(o,this.selectedDateTs/1e3);this.updateItems()}},async loadMainResources(){await U.resourceDialogService.getMainResources()},updateItems(){this.dialog.getItems().forEach((t=>{const e=t.getId();const o=this.workloadRefs[e];const i=this.isItemHidden(e);const s=this.isItemSelected(e);t.getNodes().forEach((t=>{const e=t.getAvatarContainer();ht.Dom.style(e,"width","max-content");ht.Dom.style(e,"height","max-content");ht.Dom.append(o,e)}));t.setHidden(i);if(!t.isSelected()&&s){t.select()}if(t.isSelected()&&!s){t.deselect()}}))},saveItems(){void q.hideResources(this.dialog.getSelectedItems().map((t=>t.id)))},addItems(t){const e=t.reduce(((t,e)=>({...t,[e.id]:this.getItemOptions(e)})),{});Object.values(e).forEach((t=>this.dialog.addItem(t)));const o=this.dialog.getItems().map((t=>t.getId())).filter((t=>e[t]));this.dialog.removeItems();o.forEach((t=>this.dialog.addItem(e[t])));const i=this.dialog.getActiveTab();if(i){i.getContainer().append(i.getRootNode().getChildrenContainer());i.render()}this.updateItems();if(ht.Type.isStringFilled(this.query)){void this.search(this.query)}},getItemOptions(t){return{id:t.id,entityId:bt.EntitySelectorEntity.Resource,title:t.name,subtitle:this.getResourceType(t.typeId).name,avatarOptions:{bgImage:"none",borderRadius:"0"},tabs:bt.EntitySelectorTab.Recent,selected:this.isItemSelected(t.id),hidden:this.isItemHidden(t.id),nodeAttributes:{"data-id":t.id,"data-element":"booking-select-resources-dialog-item"}}},isItemSelected(t){return this.favoritesIds.includes(t)},isItemHidden(t){const e=X.resourcesDateCache.getIdsByDateTs(this.selectedDateTs/1e3);const o=this.getResource(t);const i=e.includes(t)&&o&&this.selectedTypes[o.typeId];return!i},getResource(t){return this.$store.getters["resources/getById"](t)},getResourceType(t){return this.$store.getters["resourceTypes/getById"](t)},async search(t){this.query=t;this.dialog.search(this.query);this.updateItems();this.dialog.getSearchTab().getStub().hide();this.dialog.getSearchTab().getSearchLoader().show();await U.resourceDialogService.doSearch(this.query,this.selectedDateTs/1e3);this.dialog.search(this.query);this.updateItems();this.dialog.getSearchTab().getSearchLoader().hide();if(this.dialog.getSearchTab().isEmptyResult()){this.dialog.getSearchTab().getStub().show()}},startResize(){this.dialog.freeze()},endResize(){setTimeout((()=>this.dialog.unfreeze()))},selectAll(){this.dialog.getItems().forEach((t=>{if(!t.isHidden()){t.select()}}))},deselectAll(){this.dialog.getItems().forEach((t=>{if(!t.isHidden()){t.deselect()}}))},setWorkloadRef(t,e){this.workloadRefs[e]=t},tryShowAhaMoment(){if(ft.ahaMoments.shouldShow(bt.AhaMoment.SelectResources)){ht.Event.EventEmitter.unsubscribe("BX.Main.Popup:onAfterClose",this.tryShowAhaMoment);ht.Event.EventEmitter.unsubscribe("BX.Main.Popup:onDestroy",this.tryShowAhaMoment);void this.showAhaMoment()}},async showAhaMoment(){await ft.ahaMoments.show({id:"booking-select-resources",title:this.loc("BOOKING_AHA_SELECT_RESOURCES_TITLE_MSGVER_1"),text:this.loc("BOOKING_AHA_SELECT_RESOURCES_TEXT_MSGVER_1"),article:{...bt.HelpDesk.AhaSelectResources,title:this.loc("BOOKING_AHA_ARTICLE_LINK_TITLE")},target:this.$refs.button});ft.ahaMoments.setShown(bt.AhaMoment.SelectResources)},reset(){const t=this.mainResourceIds;this.dialog.getItems().forEach((e=>{if(t.has(e.id)){e.select()}else{e.deselect()}}))}},watch:{favoritesIds(){this.updateItems()},resources:{handler(t){setTimeout((()=>this.addItems(t)));U.resourceDialogService.clearMainResourcesCache()},deep:true},selectedTypes:{handler(){this.updateItems()},deep:true},isLoaded(){this.tryShowAhaMoment()}},components:{DialogHeader:Ti,DialogFooter:wi,ResourceWorkload:pi},template:`\n\t\t<div\n\t\t\tclass="booking-booking-select-resources"\n\t\t\t:class="{'--disabled': isFilterMode}"\n\t\t\tdata-element="booking-select-resources"\n\t\t\tref="button"\n\t\t\t@click="showDialog"\n\t\t>\n\t\t\t<div class="ui-icon-set --funnel"></div>\n\t\t</div>\n\t\t<DialogHeader\n\t\t\tref="dialogHeader"\n\t\t\tv-model="selectedTypes"\n\t\t\t@search="search"\n\t\t\t@startResize="startResize"\n\t\t\t@endResize="endResize"\n\t\t\t@selectAll="selectAll"\n\t\t\t@deselectAll="deselectAll"\n\t\t/>\n\t\t<DialogFooter\n\t\t\tv-show="dialogFilled && !isDefaultState"\n\t\t\tref="dialogFooter"\n\t\t\t@reset="reset"\n\t\t/>\n\t\t<div class="booking-booking-select-resources-workload-container">\n\t\t\t<template v-for="resource of resources">\n\t\t\t\t<span class="booking-booking-select-resources-workload" :ref="(el) => setWorkloadRef(el, resource.id)">\n\t\t\t\t\t<ResourceWorkload :resourceId="resource.id"/>\n\t\t\t\t</span>\n\t\t\t</template>\n\t\t</div>\n\t`};const Ei={computed:ut.mapGetters({resourcesIds:`${bt.Model.Interface}/resourcesIds`,scroll:`${bt.Model.Interface}/scroll`,isEditingBookingMode:`${bt.Model.Interface}/isEditingBookingMode`}),watch:{scroll(t){this.$refs.inner.scrollLeft=t}},components:{Resource:bi,AddResourceButton:fi,SelectResources:Mi},template:`\n\t\t<div class="booking-booking-header">\n\t\t\t<SelectResources/>\n\t\t\t<div\n\t\t\t\tclass="booking-booking-header-inner"\n\t\t\t\tref="inner"\n\t\t\t\t@scroll="$store.dispatch('interface/setScroll', $refs.inner.scrollLeft)"\n\t\t\t>\n\t\t\t\t<TransitionGroup name="booking-transition-resource">\n\t\t\t\t\t<template v-for="resourceId of resourcesIds" :key="resourceId">\n\t\t\t\t\t\t<Resource :resourceId="resourceId"/>\n\t\t\t\t\t</template>\n\t\t\t\t</TransitionGroup>\n\t\t\t\t<AddResourceButton v-if="!isEditingBookingMode"/>\n\t\t\t</div>\n\t\t</div>\n\t`};const Si={emits:["change"],props:{resourceId:{type:Number,required:true}},data(){return{isSelected:false,selectedItems:[]}},mounted(){this.selector=this.createSelector()},unmounted(){this.selector.destroy();this.selector=null},methods:{createSelector(){var t;const e=(t=this.intersections[this.resourceId])!=null?t:[];return new tt.Dialog({id:`booking-intersection-selector-resource-${this.resourceId}`,targetNode:this.$refs.intersectionField,preselectedItems:e.map((t=>[bt.EntitySelectorEntity.Resource,t])),width:400,enableSearch:true,dropdownMode:true,context:"bookingResourceIntersection",multiple:true,cacheable:true,showAvatars:false,entities:[{id:bt.EntitySelectorEntity.Resource,dynamicLoad:true,dynamicSearch:true}],searchOptions:{allowCreateItem:false,footerOptions:{label:this.loc("BOOKING_BOOKING_ADD_INTERSECTION_DIALOG_SEARCH_FOOTER")}},events:{onHide:this.changeSelected.bind(this),onLoad:this.changeSelected.bind(this)}})},showSelector(){if(this.isFeatureEnabled){this.selector.show()}else{void et.limit.show()}},changeSelected(){this.selectedItems=this.selector.getSelectedItems();this.isSelected=this.selectedItems.length>0;const t=this.selectedItems.map((t=>t.id));this.$emit("change",t,this.resourceId)},handleRemove(t){this.selector.getItem([bt.EntitySelectorEntity.Resource,t]).deselect();this.changeSelected()}},computed:{...ut.mapGetters({intersections:`${bt.Model.Interface}/intersections`,isFeatureEnabled:`${bt.Model.Interface}/isFeatureEnabled`,resources:`${bt.Model.Resources}/get`}),resourcesIds(){return this.resources.map((({id:t})=>t))},firstItemTitle(){return this.selectedItems.length>0?this.selectedItems[0].title:""},remainingItemsCount(){return this.selectedItems.length>1?this.selectedItems.length-1:0}},watch:{resourcesIds(t,e){if(t.join(",")===e.join(",")){return}const o=e.filter((e=>!t.includes(e)));const i=t.filter((t=>!e.includes(t)));o.forEach((t=>{const e=this.selector.getItem([bt.EntitySelectorEntity.Resource,t]);this.selector.removeItem(e)}));i.forEach((t=>{const e=this.$store.getters[`${bt.Model.Resources}/getById`](t);const o=this.$store.getters[`${bt.Model.ResourceTypes}/getById`](e.typeId);this.selector.addItem({id:t,entityId:bt.EntitySelectorEntity.Resource,title:e.name,subtitle:o.name,tabs:bt.EntitySelectorTab.Recent})}));this.changeSelected()},resources:{handler(){this.selector.getItems().forEach((t=>{const e=this.$store.getters[`${bt.Model.Resources}/getById`](t.getId());if(!e){return}const o=this.$store.getters[`${bt.Model.ResourceTypes}/getById`](e.typeId);t.setTitle(e.name);t.setSubtitle(o.name)}));this.selector.getTagSelector().getTags().forEach((t=>{const e=this.$store.getters[`${bt.Model.Resources}/getById`](t.getId());if(!e){return}t.setTitle(e.name);t.render()}));this.selectedItems=this.selector.getSelectedItems()},deep:true}},template:`\n\t\t<div\n\t\t\tref="intersectionField"\n\t\t\tclass="booking-booking-intersections-resource"\n\t\t\t:data-id="'booking-booking-intersections-resource-' + resourceId"\n\t\t>\n\t\t\t<template v-if="isSelected">\n\t\t\t\t<div\n\t\t\t\t\tref="selectorItemContainer"\n\t\t\t\t\tclass="booking-booking-intersections-resource-container"\n\t\t\t\t>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="selectedItems.length > 0"\n\t\t\t\t\t\tclass="bbi-resource-selector-item bbi-resource-selector-tag"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="bbi-resource-selector-tag-content" :title="firstItemTitle">\n\t\t\t\t\t\t\t<div class="bbi-resource-selector-tag-title">{{ firstItemTitle }}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div \n\t\t\t\t\t\t\tclass="bbi-resource-selector-tag-remove"\n\t\t\t\t\t\t\t@click="handleRemove(selectedItems[0].id)"\n\t\t\t\t\t\t\t:data-id="'bbi-resource-selector-tag-remove-' + resourceId"\n\t\t\t\t\t\t></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="remainingItemsCount > 0"\n\t\t\t\t\t\tclass="bbi-resource-selector-item bbi-resource-selector-tag --count"\n\t\t\t\t\t\t@click="showSelector"\n\t\t\t\t\t\t:data-id="'bbi-resource-selector-tag-count-' + resourceId"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="bbi-resource-selector-tag-content">\n\t\t\t\t\t\t\t<div class="bbi-resource-selector-tag-title --count">+{{ remainingItemsCount }}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tclass="bbi-resource-selector-item bbi-resource-selector-add-button"\n\t\t\t\t\t\t\t@click="showSelector"\n\t\t\t\t\t\t\t:data-id="'bbi-resource-selector-add-button' + resourceId"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span class="bbi-resource-selector-add-button-caption">\n\t\t\t\t\t\t\t\t{{ loc('BOOKING_BOOKING_INTERSECTION_BUTTON_MORE') }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<template v-else>\n\t\t\t\t<span\n\t\t\t\t\tref="selectorButton"\n\t\t\t\t\tclass="bbi-resource-selector-item bbi-resource-selector-add-button"\n\t\t\t\t\t@click="showSelector"\n\t\t\t\t\t:data-id="'bbi-resource-selector-add-button' + resourceId"\n\t\t\t\t>\n\t\t\t\t\t<span class="bbi-resource-selector-add-button-caption">\n\t\t\t\t\t\t{{ loc('BOOKING_BOOKING_INTERSECTION_BUTTON_MSGVER_1') }}\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t</template>\n\t\t</div>\n\t`};const Ci={emits:["change"],created(){this.selector=this.createSelector();if(!this.isFeatureEnabled){this.selector.lock()}},mounted(){this.mountSelector();ht.Event.EventEmitter.subscribe("BX.Main.Popup:onAfterClose",this.tryShowAhaMoment);ht.Event.EventEmitter.subscribe("BX.Main.Popup:onDestroy",this.tryShowAhaMoment)},beforeUnmount(){this.destroySelector()},computed:{...ut.mapGetters({isEditingBookingMode:`${bt.Model.Interface}/isEditingBookingMode`,intersections:`${bt.Model.Interface}/intersections`,isLoaded:`${bt.Model.Interface}/isLoaded`,isFeatureEnabled:`${bt.Model.Interface}/isFeatureEnabled`,resources:`${bt.Model.Resources}/get`}),resourcesIds(){return this.resources.map((({id:t})=>t))}},methods:{createSelector(){return new tt.TagSelector({multiple:true,addButtonCaption:this.loc("BOOKING_BOOKING_ADD_INTERSECTION_MSGVER_1"),showCreateButton:false,maxHeight:50,dialogOptions:{header:this.loc("BOOKING_BOOKING_ADD_INTERSECTION_DIALOG_HEADER"),context:"bookingResourceIntersection",width:290,height:340,dropdownMode:true,enableSearch:true,cacheable:true,showAvatars:false,entities:[{id:bt.EntitySelectorEntity.Resource,dynamicLoad:true,dynamicSearch:true}],searchOptions:{allowCreateItem:false,footerOptions:{label:this.loc("BOOKING_BOOKING_ADD_INTERSECTION_DIALOG_SEARCH_FOOTER")}}},events:{onAfterTagAdd:this.onSelectorChange,onAfterTagRemove:this.onSelectorChange}})},onSelectorChange(){const t=this.selector.getDialog().getSelectedItems().map((({id:t})=>t));this.$emit("change",t)},mountSelector(){this.selector.renderTo(this.$refs.intersectionField)},destroySelector(){this.selector.getDialog().destroy();this.selector=null;this.$refs.intersectionField.innerHTML=""},getResource(t){return this.$store.getters["resources/getById"](t)},getResourceType(t){return this.$store.getters["resourceTypes/getById"](t)},tryShowAhaMoment(){if(ft.ahaMoments.shouldShow(bt.AhaMoment.ResourceIntersection)&&this.selector){ht.Event.EventEmitter.unsubscribe("BX.Main.Popup:onAfterClose",this.tryShowAhaMoment);ht.Event.EventEmitter.unsubscribe("BX.Main.Popup:onDestroy",this.tryShowAhaMoment);void this.showAhaMoment()}},async showAhaMoment(){await ft.ahaMoments.show({id:"booking-resource-intersection",title:this.loc("BOOKING_AHA_RESOURCE_INTERSECTION_TITLE"),text:this.loc("BOOKING_AHA_RESOURCE_INTERSECTION_TEXT"),article:bt.HelpDesk.AhaResourceIntersection,target:this.selector.getAddButton()});ft.ahaMoments.setShown(bt.AhaMoment.ResourceIntersection)},click(){if(!this.isFeatureEnabled){void et.limit.show()}}},watch:{intersections(t){var e;if(!this.isEditingBookingMode){return}const o=(e=t[0])!=null?e:[];o.forEach((t=>{const e=this.getResource(t);this.selector.getDialog().addItem({id:e.id,entityId:bt.EntitySelectorEntity.Resource,title:e.name,subtitle:this.getResourceType(e.typeId).name,selected:true})}))},isLoaded(){this.tryShowAhaMoment()},resourcesIds(t,e){if(t.join(",")===e.join(",")){return}const o=e.filter((e=>!t.includes(e)));const i=t.filter((t=>!e.includes(t)));o.forEach((t=>{const e=this.selector.getDialog().getItem([bt.EntitySelectorEntity.Resource,t]);this.selector.getDialog().removeItem(e);const o=this.selector.getTags().find((e=>e.getId()===t));o==null?void 0:o.remove()}));i.forEach((t=>{const e=this.$store.getters[`${bt.Model.Resources}/getById`](t);const o=this.$store.getters[`${bt.Model.ResourceTypes}/getById`](e.typeId);this.selector.getDialog().addItem({id:t,entityId:bt.EntitySelectorEntity.Resource,title:e.name,subtitle:o.name,tabs:bt.EntitySelectorTab.Recent})}));this.onSelectorChange();this.tryShowAhaMoment()},resources:{handler(){this.selector.getDialog().getItems().forEach((t=>{const e=this.$store.getters[`${bt.Model.Resources}/getById`](t.getId());if(!e){return}const o=this.$store.getters[`${bt.Model.ResourceTypes}/getById`](e.typeId);t.setTitle(e.name);t.setSubtitle(o.name)}));this.selector.getTags().forEach((t=>{const e=this.$store.getters[`${bt.Model.Resources}/getById`](t.getId());if(!e){return}t.setTitle(e.name);t.render()}))},deep:true}},template:`\n\t\t<div\n\t\t\tref="intersectionField"\n\t\t\tclass="booking-booking-intersections-line"\n\t\t\tdata-id="booking-booking-intersections-line"\n\t\t\t@click="click"\n\t\t></div>\n\t`};const Li={components:{Icon:j.BIcon,Multiple:Si,Single:Ci},data(){return{IconSet:j.Set,intersectionModeMenuItemId:"booking-intersection-menu-mode"}},mounted(){this.menu=V.MenuManager.create("booking-intersection-menu",this.$refs.intersectionMenu,this.getMenuItems(),{closeByEsc:true,autoHide:true,cacheable:true})},unmounted(){this.menu.destroy();this.menu=null},methods:{showMenu(){if(this.isFeatureEnabled){this.menu.show()}else{void et.limit.show()}},getMenuItems(){return[this.getIntersectionForAllItem(),{delimiter:true},this.getHelpDeskItem()]},getIntersectionForAllItem(){return{id:this.intersectionModeMenuItemId,dataset:{id:this.intersectionModeMenuItemId},text:this.loc("BOOKING_BOOKING_INTERSECTION_MENU_ALL"),className:this.isIntersectionForAll?"menu-popup-item menu-popup-item-accept":"menu-popup-item menu-popup-no-icon",onclick:()=>{this.menu.close();const t=!this.isIntersectionForAll;void this.$store.dispatch(`${bt.Model.Interface}/setIntersectionMode`,t);void Z.optionService.setBool(bt.Option.IntersectionForAll,t)}}},getHelpDeskItem(){return{id:"booking-intersection-menu-info",dataset:{id:"booking-intersection-menu-info"},text:this.loc("BOOKING_BOOKING_INTERSECTION_MENU_HOW"),onclick:()=>{Q.helpDesk.show(bt.HelpDesk.Intersection.code,bt.HelpDesk.Intersection.anchorCode)}}},async showIntersections(t,e=0){const o={...e===0?{}:this.intersections,[e]:t};await this.$store.dispatch(`${bt.Model.Interface}/setIntersections`,o);await J.busySlots.loadBusySlots()},toggleMenuItemActivityState(t){ht.Dom.toggleClass(t.getContainer(),"menu-popup-item-accept");ht.Dom.toggleClass(t.getContainer(),"menu-popup-no-icon")},updateScroll(){if(this.$refs.inner){this.$refs.inner.scrollLeft=this.scroll}}},watch:{async isIntersectionForAll(){await this.$store.dispatch(`${bt.Model.Interface}/setIntersections`,{});this.updateScroll();await J.busySlots.loadBusySlots();this.toggleMenuItemActivityState(this.menu.getMenuItem(this.intersectionModeMenuItemId))},scroll(){this.updateScroll()}},computed:{...ut.mapGetters({resourcesIds:`${bt.Model.Interface}/resourcesIds`,isFilterMode:`${bt.Model.Interface}/isFilterMode`,isEditingBookingMode:`${bt.Model.Interface}/isEditingBookingMode`,intersections:`${bt.Model.Interface}/intersections`,isIntersectionForAll:`${bt.Model.Interface}/isIntersectionForAll`,scroll:`${bt.Model.Interface}/scroll`,isLoaded:`${bt.Model.Interface}/isLoaded`,isFeatureEnabled:`${bt.Model.Interface}/isFeatureEnabled`}),hasIntersections(){return Object.values(this.intersections).some((t=>t.length>0))},disabled(){return!this.isLoaded||this.isFilterMode||this.isEditingBookingMode}},template:`\n\t\t<div class="booking-booking-intersections" :class="{'--disabled': disabled}">\n\t\t\t<div\n\t\t\t\tref="intersectionMenu"\n\t\t\t\tclass="booking-booking-intersections-left-panel"\n\t\t\t\t:class="{'--active': hasIntersections}"\n\t\t\t\t@click="showMenu"\n\t\t\t\tdata-id="booking-intersections-left-panel-menu"\n\t\t\t>\n\t\t\t\t<div class="ui-icon-set --double-rhombus"></div>\n\t\t\t\t<div v-if="!isFeatureEnabled" class="booking-lock-icon-container">\n\t\t\t\t\t<Icon :name="IconSet.LOCK"/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<Single v-if="isIntersectionForAll" @change="showIntersections"/>\n\t\t\t<template v-else>\n\t\t\t\t<div\n\t\t\t\t\tref="inner"\n\t\t\t\t\tclass="booking-booking-intersections-inner"\n\t\t\t\t\t@scroll="$store.dispatch('interface/setScroll', $refs.inner.scrollLeft)"\n\t\t\t\t>\n\t\t\t\t\t<div class="booking-booking-intersections-row">\n\t\t\t\t\t\t<div class="booking-booking-intersections-row-inner">\n\t\t\t\t\t\t\t<template v-for="resourceId of resourcesIds" :key="resourceId">\n\t\t\t\t\t\t\t\t<Multiple :resourceId="resourceId" @change="showIntersections"/>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="booking-booking-intersections-inner-blank"></div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\t`};const Oi={data(){return{DateTimeFormat:nt.DateTimeFormat}},computed:ut.mapGetters({fromHour:"interface/fromHour",toHour:"interface/toHour",zoom:"interface/zoom"}),components:{Header:Ei,Intersections:Li,Grid:ni},template:`\n\t\t<div\n\t\t\tid="booking-content"\n\t\t\tclass="booking --ui-context-content-light"\n\t\t\t:style="{\n\t\t\t\t'--from-hour': fromHour,\n\t\t\t\t'--to-hour': toHour,\n\t\t\t\t'--zoom': zoom,\n\t\t\t}"\n\t\t\t:class="{\n\t\t\t\t'--zoom-is-less-than-07': zoom < 0.7,\n\t\t\t\t'--zoom-is-less-than-08': zoom < 0.8,\n\t\t\t\t'--am-pm-mode': DateTimeFormat.isAmPmMode(),\n\t\t\t}"\n\t\t>\n\t\t\t<Header/>\n\t\t\t<Intersections/>\n\t\t\t<Grid/>\n\t\t</div>\n\t`};const Di={name:"BookingMultipleButton",emits:["book"],props:{fetching:Boolean},computed:{text(){return this.loc("BOOKING_MULTI_BUTTON_LABEL")},size(){return dt.ButtonSize.SMALL},color(){return dt.ButtonColor.SUCCESS}},components:{UiButton:dt.Button},template:`\n\t\t<UiButton\n\t\t\t:text\n\t\t\t:size\n\t\t\t:color\n\t\t\t:waiting="fetching"\n\t\t\t@click="$emit('book')"\n\t\t/>\n\t`};const Pi={name:"MultiBookingItem",components:{UiButton:dt.Button},emits:["remove-selected"],props:{id:{type:String,required:true},fromTs:{type:Number,required:true},toTs:{type:Number,required:true},resourceId:{type:Number,required:true}},computed:{...ut.mapGetters({offset:`${bt.Model.Interface}/offset`}),label(){return this.loc("BOOKING_MULTI_ITEM_TITLE",{"#DATE#":nt.DateTimeFormat.format("d M H:i",(this.fromTs+this.offset)/1e3),"#DURATION#":new rt.Duration(this.toTs-this.fromTs).format()})},buttonColor(){return dt.ButtonColor.LINK},buttonSize(){return dt.ButtonSize.EXTRA_SMALL}},template:`\n\t\t<div class="booking--multi-booking--book">\n\t\t\t<label>\n\t\t\t\t{{ label }}\n\t\t\t</label>\n\t\t\t<button\n\t\t\t\t:class="[buttonSize, buttonColor, 'ui-btn ui-icon-set --cross-20']"\n\t\t\t\ttype="button"\n\t\t\t\t@click="$emit('remove-selected', this.id)">\n\t\t\t</button>\n\t\t</div>\n\t`};const $i={name:"MultiBookingItemsList",components:{MultiBookingItem:Pi},emits:["remove-selected"],computed:{selectedCells(){return this.$store.getters[`${bt.Model.Interface}/selectedCells`]},selectedCellsCount(){return Object.keys(this.selectedCells).length}},mounted(){this.ears=new st.Ears({container:this.$refs.wrapper,smallSize:true,className:"booking--multi-booking--items-ears",noScrollbar:true}).init()},watch:{selectedCellsCount:{handler(){setTimeout((()=>this.ears.toggleEars()),0)}}},template:`\n\t\t<div class="booking--multi-booking--book-list">\n\t\t\t<div ref="wrapper" class="booking--multi-booking--books-wrapper">\n\t\t\t\t<MultiBookingItem\n\t\t\t\t\tv-for="cell in selectedCells"\n\t\t\t\t\t:key="cell.id"\n\t\t\t\t\t:id="cell.id"\n\t\t\t\t\t:from-ts="cell.fromTs"\n\t\t\t\t\t:to-ts="cell.toTs"\n\t\t\t\t\t:resource-id="cell.resourceId"\n\t\t\t\t\t@remove-selected="$emit('remove-selected', $event)"/>\n\t\t\t</div>\n\t\t</div>\n\t`};const Fi={name:"AddClientButton",emits:["update:model-value"],props:{modelValue:{type:Array,required:true}},data(){return{isPopupShown:false}},computed:{...ut.mapGetters({getByClientData:`${bt.Model.Clients}/getByClientData`}),color(){return dt.ButtonColor.LINK},size(){return dt.ButtonSize.EXTRA_SMALL},label(){var t;if(this.modelValue.length===0){return this.loc("BOOKING_MULTI_CLIENT")}return this.loc("BOOKING_MULTI_CLIENT_WHIT_NAME",{"#NAME#":((t=this.modelValue.find((t=>t.name)))==null?void 0:t.name)||""})},currentClient(){if(this.modelValue.length===0){return null}return{contact:this.findClientByType(bt.CrmEntity.Contact),company:this.findClientByType(bt.CrmEntity.Company)}}},methods:{createClients(t){const e=t.map((t=>this.getByClientData(t)));this.$emit("update:model-value",e)},findClientByType(t){return this.modelValue.find((({type:e})=>e.code===t))}},components:{ClientPopup:at.ClientPopup},template:`\n\t\t<button\n\t\t\t:class="['ui-btn', 'booking--multi-booking--client-button', color, size]"\n\t\t\ttype="button"\n\t\t\tref="button"\n\t\t\t@click="isPopupShown = !isPopupShown"\n\t\t>\n\t\t\t<i class="ui-icon-set --customer-card"></i>\n\t\t\t<span>{{ label }}</span>\n\t\t</button>\n\t\t<ClientPopup\n\t\t\tv-if="isPopupShown"\n\t\t\t:bind-element="$refs.button"\n\t\t\t:currentClient\n\t\t\t@create="createClients"\n\t\t\t@close="isPopupShown = false"/>\n\t`};const Ni={name:"CancelButton",emits:["click"],setup(){return{color:dt.ButtonColor.LINK,size:dt.ButtonSize.EXTRA_SMALL}},template:`\n\t\t<button\n\t\t\t:class="['ui-btn', 'booking--multi-booking--cancel-button', color, size]"\n\t\t\ttype="button"\n\t\t\tref="button"\n\t\t\t@click="$emit('click')"\n\t\t>\n\t\t\t<i\n\t\t\t\tclass="ui-icon-set --cross-25"\n\t\t\t\tstyle="--ui-icon-set__icon-base-color: rgba(var(--ui-color-palette-white-base-rgb), 0.3);--ui-icon-set__icon-size: var(--ui-size-2xl)"></i>\n\t\t</button>\n\t`};const _i={name:"MultiBooking",data(){return{fetching:false,clients:[],externalData:[]}},async beforeMount(){this.clients=[];this.externalData=[];if(this.embedItems.length===0){return}const t=this.embedItems.find((t=>t.entityTypeId===bt.CrmEntity.Contact));const e=this.embedItems.find((t=>t.entityTypeId===bt.CrmEntity.Company));const o=this.embedItems.find((t=>t.entityTypeId===bt.CrmEntity.Deal));if(t){const e=await it.clientService.getContactById(Number(t.value));if(e){this.clients.push(e)}}if(e){const t=await it.clientService.getCompanyById(Number(e.value));if(t){this.clients.push(t)}}if(o){this.externalData.push(o)}},computed:{...ut.mapGetters({selectedCells:`${bt.Model.Interface}/selectedCells`,timezone:`${bt.Model.Interface}/timezone`,embedItems:`${bt.Model.Interface}/embedItems`})},methods:{removeSelected(t){if(Object.hasOwnProperty.call(this.selectedCells,t)){this.$store.dispatch(`${bt.Model.Interface}/removeSelectedCell`,this.selectedCells[t])}},async book(){const t=this.getBookings();if(t.length===0){return}this.fetching=true;const e=await ot.bookingService.addList(t);lt.BookingAnalytics.sendAddMultiBookings(e.map((({id:t})=>t)));this.fetching=false;this.showNotification(e);await this.closeMultiBooking()},getBookings(){return Object.values(this.selectedCells).map((t=>({id:`tmp-id-${Date.now()}-${Math.random()}`,dateFromTs:t.fromTs,dateToTs:t.toTs,resourcesIds:[t.resourceId],timezoneFrom:this.timezone,timezoneTo:this.timezone,externalData:this.externalData,clients:this.clients})))},showNotification(t){const e=t.length;const o=BX.UI.Notification.Center.notify({id:ht.Text.getRandom(),content:ht.Loc.getMessagePlural("BOOKING_MULTI_CREATED",e,{"#QUANTITY#":e}),actions:[{title:this.loc("BOOKING_MULTI_CREATED_CANCEL"),events:{click:()=>this.reset(t,o)}}]})},async reset(t,e){await ot.bookingService.deleteList(t.map((({id:t})=>t)));e==null?void 0:e.close()},async closeMultiBooking(){await this.$store.dispatch(`${bt.Model.Interface}/clearSelectedCells`)}},components:{BookingMultipleButton:Di,MultiBookingItemsList:$i,AddClientButton:Fi,CancelButton:Ni},template:`\n\t\t<Teleport to="#uiToolbarContainer" defer>\n\t\t\t<div class="booking--multi-booking--bar">\n\t\t\t\t<BookingMultipleButton :fetching @book="book"/>\n\t\t\t\t<MultiBookingItemsList @remove-selected="removeSelected"/>\n\t\t\t\t<div class="booking--multi-booking--divider-vertical"></div>\n\t\t\t\t<AddClientButton v-model="clients"/>\n\t\t\t\t<div class="booking--multi-booking--space"></div>\n\t\t\t\t<div class="booking--multi-booking--close">\n\t\t\t\t\t<div class="booking--multi-booking--divider-vertical"></div>\n\t\t\t\t\t<CancelButton @click="closeMultiBooking"/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</Teleport>\n\t`};const Ri={data(){return{isBannerShown:false,bannerComponent:null}},computed:{...ut.mapGetters({canTurnOnDemo:`${bt.Model.Interface}/canTurnOnDemo`})},mounted(){if(ft.ahaMoments.shouldShow(bt.AhaMoment.Banner)){void this.showBanner()}},methods:{async showBanner(){pt.BannerDispatcher.critical.toQueue((async t=>{const{PromoBanner:e}=await ht.Runtime.loadExtension("booking.component.promo-banner");this.bannerComponent=mt.shallowRef(e);this.isBannerShown=true;this.setShown();this.bannerClosed=new gt.Resolvable;await this.bannerClosed;t()}))},closeBanner(){this.isBannerShown=false;this.bannerClosed.resolve()},setShown(){ft.ahaMoments.setShown(bt.AhaMoment.Banner);lt.BannerAnalytics.sendShowPopup()},buttonClick(){lt.BannerAnalytics.sendClickEnable()}},template:`\n\t\t<component\n\t\t\tv-if="isBannerShown"\n\t\t\t:is="bannerComponent"\n\t\t\t:canTurnOnDemo="canTurnOnDemo"\n\t\t\t@buttonClick="buttonClick"\n\t\t\t@close="closeBanner"\n\t\t/>\n\t`};const Ai={data(){return{isBannerShown:false,bannerComponent:null}},watch:{isShownTrialPopup(){if(ft.ahaMoments.shouldShow(bt.AhaMoment.TrialBanner)){if(!ct.AutoLauncher.isEnabled()){ct.AutoLauncher.enable()}void this.showBanner()}}},computed:{...ut.mapGetters({isShownTrialPopup:`${bt.Model.Interface}/isShownTrialPopup`})},methods:{async showBanner(){pt.BannerDispatcher.critical.toQueue((async t=>{const{TrialBanner:e}=await ht.Runtime.loadExtension("booking.component.trial-banner");this.bannerComponent=mt.shallowRef(e);this.isBannerShown=true;this.bannerClosed=new gt.Resolvable;await this.bannerClosed;t()}))},closeBanner(){this.isBannerShown=false;ft.ahaMoments.setShown(bt.AhaMoment.TrialBanner);this.bannerClosed.resolve()}},template:`\n\t\t<component v-if="isBannerShown" :is="bannerComponent" @close="closeBanner"/>\n\t`};const Hi={name:"BookingApp",components:{BaseComponent:Oi,AfterTitle:Wt,SettingsButton:qt,BookingFilter:Rt,CountersPanel:Ht,MultiBooking:_i,Banner:Ri,Trial:Ai},props:{afterTitleContainer:HTMLElement,counterPanelContainer:HTMLElement,settingsButtonContainer:HTMLElement,filterId:{type:String,required:true}},data(){return{loader:new o.Loader}},computed:{...ut.mapGetters({selectedDateTs:`${bt.Model.Interface}/selectedDateTs`,viewDateTs:`${bt.Model.Interface}/viewDateTs`,isFilterMode:`${bt.Model.Interface}/isFilterMode`,filteredBookingsIds:`${bt.Model.Interface}/filteredBookingsIds`,selectedCells:`${bt.Model.Interface}/selectedCells`,resourcesIds:`${bt.Model.Favorites}/get`,extraResourcesIds:`${bt.Model.Interface}/extraResourcesIds`,bookings:`${bt.Model.Bookings}/get`,intersections:`${bt.Model.Interface}/intersections`,editingBookingId:`${bt.Model.Interface}/editingBookingId`}),hasSelectedCells(){return Object.keys(this.selectedCells).length>0},editingBooking(){var t;return(t=this.$store.getters["bookings/getById"](this.editingBookingId))!=null?t:null}},watch:{selectedDateTs(){if(this.isFilterMode){void this.applyFilter()}else{void this.fetchPage(this.selectedDateTs/1e3)}},filteredBookingsIds(){if(this.isFilterMode){this.showResourcesWithBookings()}},isFilterMode(t){if(!t){void this.fetchPage(this.selectedDateTs/1e3)}},viewDateTs(){void this.updateMarks()},resourcesIds(){void this.updateMarks()},intersections(){void this.updateMarks()},editingBooking(t){var e,o;const i=(e=t==null?void 0:(o=t.resourcesIds)==null?void 0:o.slice(1))!=null?e:[];if(i.length>0){void this.$store.dispatch(`${bt.Model.Interface}/setIntersections`,{0:i})}}},beforeMount(){b.mousePosition.init()},async mounted(){this.showLoader();Ft.setExpanded(true);this.addAfterTitle();lt.SectionAnalytics.sendOpenSection();await Promise.all([s.dictionaryService.fetchData(),this.fetchPage(this.editingBookingId>0?0:this.selectedDateTs/1e3)]);void this.$store.dispatch(`${bt.Model.Interface}/setIsLoaded`,true)},beforeUnmount(){b.mousePosition.destroy()},methods:{async fetchPage(t=0){this.showLoader();await i.mainPageService.fetchData(t);if(this.extraResourcesIds.length>0){await U.resourceDialogService.loadByIds(this.extraResourcesIds,this.selectedDateTs/1e3)}this.hideLoader()},onActiveItem(t){if(this.ignoreConterPanel){return}this.$refs.filter.setPresetId(this.getPresetIdByCounterItem(t))},async applyFilter(){const t=this.$refs.filter.getPresetId();const e=this.$refs.filter.getFields();this.setCounterItem(this.getCounterItemByPresetId(t));this.showLoader();await Promise.all([this.$store.dispatch(`${bt.Model.Interface}/setFilterMode`,true),this.updateMarks(),ot.bookingService.filter(e)]);this.hideLoader()},async clearFilter(){this.setCounterItem(null);n.calendarService.clearFilterCache();ot.bookingService.clearFilterCache();void Promise.all([this.$store.dispatch(`${bt.Model.Interface}/setResourcesIds`,this.resourcesIds),this.$store.dispatch(`${bt.Model.Interface}/setFilterMode`,false),this.$store.dispatch(`${bt.Model.Interface}/setFilteredBookingsIds`,[]),this.$store.dispatch(`${bt.Model.Interface}/setFilteredMarks`,[])]);this.hideLoader()},setCounterItem(t){this.ignoreConterPanel=true;setTimeout((()=>{this.ignoreConterPanel=false}),0);this.$refs.countersPanel.setItem(t)},getCounterItemByPresetId(t){return{[Nt.NotConfirmed]:At.NotConfirmed,[Nt.Delayed]:At.Delayed}[t]},getPresetIdByCounterItem(t){return{[At.NotConfirmed]:Nt.NotConfirmed,[At.Delayed]:Nt.Delayed}[t]},addAfterTitle(){this.afterTitleContainer.append(this.$refs.afterTitle.$el)},showResourcesWithBookings(){const t=this.$store.getters[`${bt.Model.Bookings}/getByDateAndIds`](this.selectedDateTs,this.filteredBookingsIds).map((t=>t.resourcesIds[0])).filter(((t,e,o)=>o.indexOf(t)===e));void this.$store.dispatch(`${bt.Model.Interface}/setResourcesIds`,t)},async updateMarks(){if(this.isFilterMode){await this.updateFilterMarks()}else{await Promise.all([this.updateFreeMarks(),this.updateCounterMarks()])}},async updateFreeMarks(){const t=this.resourcesIds.map((t=>{var e,o;return[t,...(e=this.intersections[0])!=null?e:[],...(o=this.intersections[t])!=null?o:[]]}));await this.$store.dispatch(`${bt.Model.Interface}/setFreeMarks`,[]);await n.calendarService.loadMarks(this.viewDateTs,t)},async updateFilterMarks(){const t=this.$refs.filter.getFields();await this.$store.dispatch(`${bt.Model.Interface}/setFilteredMarks`,[]);await n.calendarService.loadFilterMarks(t)},async updateCounterMarks(){await n.calendarService.loadCounterMarks(this.viewDateTs)},showLoader(){void this.loader.show(this.$refs.baseComponent.$el)},hideLoader(){void this.loader.hide()}},template:`\n\t\t<div>\n\t\t\t<MultiBooking v-if="hasSelectedCells"/>\n\t\t\t<AfterTitle ref="afterTitle"/>\n\t\t\t<SettingsButton :container="settingsButtonContainer"/>\n\t\t\t<BookingFilter\n\t\t\t\t:filterId="filterId"\n\t\t\t\tref="filter"\n\t\t\t\t@apply="applyFilter"\n\t\t\t\t@clear="clearFilter"\n\t\t\t/>\n\t\t\t<CountersPanel\n\t\t\t\t:target="counterPanelContainer"\n\t\t\t\tref="countersPanel"\n\t\t\t\t@activeItem="onActiveItem"\n\t\t\t/>\n\t\t\t<BaseComponent ref="baseComponent"/>\n\t\t\t<Banner/>\n\t\t\t<Trial/>\n\t\t</div>\n\t`};var zi=babelHelpers.classPrivateFieldLooseKey("mountApplication");class Gi{constructor(t){Object.defineProperty(this,zi,{value:xi});S.Core.setParams(t);void babelHelpers.classPrivateFieldLooseBase(this,zi)[zi]()}}async function xi(){await S.Core.init();const t=mt.BitrixVue.createApp(Hi,S.Core.getParams());t.mixin(e.locMixin);t.use(S.Core.getStore());t.mount(S.Core.getParams().container)}t.Booking=Gi})(this.BX.Booking=this.BX.Booking||{},BX.Booking.Component.Mixin,BX,BX.Booking.Provider.Service,BX.Booking.Provider.Service,BX.Booking.Provider.Service,BX.Event,BX.UI,BX.UI,BX.UI.Vue3.Components,BX.Booking.Lib,BX.UI.Vue3.Components,BX.UI.NotificationManager,BX.Booking.Provider.Service,BX.Booking.Component,BX.Vue3.Directives,BX.Booking.Lib,BX.Booking.Component,BX.Booking.Component,BX.UI.IconSet,BX,BX.Booking.Component,BX.Booking.Component,BX.Booking.Lib,BX.Booking.Lib,BX.Booking.Lib,BX.Booking.Lib,BX.Booking,BX.UI.DatePicker,BX.Booking.Lib,BX.Booking.Component,BX.Booking.Component,BX.Booking.Lib,BX.Booking.Model,BX.Booking.Model,BX.Booking.Provider.Service,BX.Booking.Lib,BX.Booking.Lib,BX.Booking.Lib,BX.Booking.Component,BX.UI.Dialogs,BX,BX.Booking.Provider.Service,BX,BX.Booking,BX.Booking.Provider.Service,BX.Booking.Lib,BX.Booking.Lib,BX.Main,BX.UI.IconSet,BX,BX.Booking.Provider.Service,BX.Booking.Lib,BX.Booking.Lib,BX.UI.EntitySelector,BX.Booking.Lib,BX.Booking.Provider.Service,BX.Booking.Provider.Service,BX.UI,BX.Main,BX.Booking.Lib,BX.Booking.Component,BX.Booking.Component,BX.Booking.Lib,BX.UI.AutoLaunch,BX.Vue3.Vuex,BX,BX.Vue3,BX.UI,BX.Booking.Lib,BX.Booking.Const,BX.Booking.Lib);
//# sourceMappingURL=booking.bundle.map.js