this.BX=this.BX||{};this.BX.Booking=this.BX.Booking||{};(function(e,t,s,i,o){"use strict";function r(e,t){const s=[];const i=new Set;for(const[,o]of e){const{dateFromTs:e,dateToTs:r,resourcesIds:d}=o.booking;if(d.every((e=>!t.has(e)))){continue}o.items.filter((({resourceId:e})=>t.has(e))).forEach((({resourceId:t,intersections:o})=>{o.forEach((o=>{const d={fromTs:e>=o.dateFromTs?e:o.dateFromTs,toTs:r<=o.dateToTs?r:o.dateToTs,resourcesIds:[t]};const a=`${d.fromTs}-${d.toTs}-${d.resourcesIds.join("-")}`;if(!i.has(a)){i.add(a);s.push(d)}}))}))}return s}class d extends s.BuilderModel{getName(){return i.Model.Interface}getState(){var e,t;const s=new Date;const i=this.getVariable("schedule",{});return{isFeatureEnabled:this.getVariable("isFeatureEnabled",false),canTurnOnTrial:this.getVariable("canTurnOnTrial",false),canTurnOnDemo:this.getVariable("canTurnOnDemo",false),editingBookingId:this.getVariable("editingBookingId",0),editingWaitListItemId:this.getVariable("editingWaitListItemId",0),draggedBookingId:0,draggedBookingResourceId:0,draggedDataTransfer:{id:0,resourceId:0,kind:""},resizedBookingId:0,isLoaded:false,zoom:1,expanded:false,scroll:0,offHoursHover:false,offHoursExpanded:false,waitListExpanded:this.getVariable("waitListExpanded",true),calendarExpanded:this.getVariable("calendarExpanded",true),fromHour:(e=i.fromHour)!=null?e:9,toHour:(t=i.toHour)!=null?t:19,selectedDateTs:new Date(s.getFullYear(),s.getMonth(),s.getDate()).getTime(),viewDateTs:new Date(s.getFullYear(),s.getMonth()).getTime(),deletingBookings:{},deletingWaitListItemIds:{},selectedCells:{},hoveredCell:null,busySlots:{},disabledBusySlots:{},resourcesIds:[],isFilterMode:false,isIntersectionForAll:true,filteredBookingsIds:[],filteredMarks:[],counterMarks:[],freeMarks:[],totalClients:this.getVariable("totalClients",0),totalNewClientsToday:this.getVariable("totalNewClientsToday",0),moneyStatistics:this.getVariable("moneyStatistics",null),intersections:{},quickFilter:{hovered:{},active:{},ignoredBookingIds:{}},timezone:this.getVariable("timezone",Intl.DateTimeFormat().resolvedOptions().timeZone),mousePosition:{top:0,left:0},isCurrentSenderAvailable:false,isShownTrialPopup:false,embedItems:this.getVariable("embedItems",[]),animationPause:false,createdFromEmbedBookings:{},createdFromEmbedWaitListItems:{}}}getGetters(){return{isFeatureEnabled:e=>e.isFeatureEnabled||e.canTurnOnTrial,canTurnOnTrial:e=>e.canTurnOnTrial,canTurnOnDemo:e=>e.canTurnOnDemo,isShownTrialPopup:e=>e.isShownTrialPopup,editingBookingId:e=>e.editingBookingId,editingWaitListItemId:e=>e.editingWaitListItemId,isEditingBookingMode:e=>e.editingBookingId>0||e.editingWaitListItemId>0,draggedBookingId:e=>e.draggedDataTransfer.kind===i.DraggedElementKind.Booking?e.draggedDataTransfer.id:0,draggedBookingResourceId:e=>e.draggedDataTransfer.kind===i.DraggedElementKind.Booking?e.draggedDataTransfer.resourceId:0,draggedDataTransfer:e=>e.draggedDataTransfer,resizedBookingId:e=>e.resizedBookingId,isDragMode:e=>e.draggedDataTransfer.id>0||e.resizedBookingId,isLoaded:e=>e.isLoaded,zoom:e=>e.zoom,expanded:e=>e.expanded,scroll:e=>e.scroll,offHoursHover:e=>e.offHoursHover,offHoursExpanded:e=>e.offHoursExpanded,waitListExpanded:e=>e.waitListExpanded,calendarExpanded:e=>e.calendarExpanded,fromHour:e=>e.fromHour,toHour:e=>e.toHour,selectedDateTs:(e,t)=>e.selectedDateTs-t.offset,viewDateTs:(e,t)=>e.viewDateTs-t.offset,deletingBookings:e=>e.deletingBookings,deletingWaitListItems:e=>e.deletingWaitListItemIds,selectedCells:e=>e.selectedCells,hoveredCell:e=>e.hoveredCell,busySlots:e=>Object.values(e.busySlots),disabledBusySlots:e=>e.disabledBusySlots,resourcesIds:(e,t,s,o)=>{const r=o[`${i.Model.Bookings}/getByDate`](e.selectedDateTs).filter((e=>!t.isFilterMode&&e.counter>0)).map((e=>e.resourcesIds[0]));const d=[...new Set([...e.resourcesIds,...r])];const a=new Set(t.getOccupancy(d,Object.values(e.quickFilter.ignoredBookingIds)).filter((s=>Object.values(e.quickFilter.active).some((i=>{const o=new Date(e.selectedDateTs).setHours(i)-t.offset;const r=new Date(e.selectedDateTs).setHours(i+1)-t.offset;return r>s.fromTs&&o<s.toTs})))).flatMap((e=>e.resourcesIds)));return d.filter((e=>!a.has(e)))},extraResourcesIds:(e,t)=>{const s=e.resourcesIds;return t.resourcesIds.filter((e=>!s.includes(e)))},isFilterMode:e=>e.isFilterMode,isIntersectionForAll:e=>e.isIntersectionForAll,filteredBookingsIds:e=>e.filteredBookingsIds,filteredMarks:e=>e.filteredMarks,freeMarks:e=>e.freeMarks,totalClients:e=>e.totalClients,totalNewClientsToday:e=>e.totalNewClientsToday,moneyStatistics:e=>e.moneyStatistics,getCounterMarks:e=>(s=null)=>{if(t.Type.isNull(s)){return e.counterMarks}return e.counterMarks.filter((e=>s.includes(e)))},intersections:e=>e.intersections,quickFilter:e=>e.quickFilter,timezone:e=>e.timezone,offset:e=>{const t=o.Timezone.getOffset(e.selectedDateTs,e.timezone);return(t+new Date(e.selectedDateTs).getTimezoneOffset()*60)*1e3},mousePosition:e=>e.mousePosition,isCurrentSenderAvailable:e=>e.isCurrentSenderAvailable,getColliding:(e,t)=>(s,i)=>{const o=Array.isArray(s)?s:[s];return[...t.getOccupancy(o,i),...Object.values(e.selectedCells).filter((e=>o.includes(e.resourceId))).map((e=>({fromTs:e.fromTs,toTs:e.toTs,resourcesIds:[e.resourceId]})))]},getOccupancy:(e,s,o,d)=>(o,a=[])=>{const n=new Set(o);const l=d[`${i.Model.Bookings}/get`].filter((e=>{const s=e.resourcesIds.some((e=>n.has(e)));const i=t.Type.isFunction(a)?!a(e):!a.includes(e.id);return s&&i})).map((e=>({fromTs:e.dateFromTs,toTs:e.dateToTs,resourcesIds:e.resourcesIds})));const c=Object.values(e.busySlots).filter((t=>{const o=s.isDragMode&&t.type===i.BusySlot.OffHours;const r=!(t.id in e.disabledBusySlots)&&!o;const d=n.has(t.resourceId);const a=t.type===i.BusySlot.IntersectionOverbooking;return a&&r&&d})).map((({fromTs:e,toTs:t,resourceId:s})=>({fromTs:e,toTs:t,resourcesIds:[s]})));const m=r(d[`${i.Model.Bookings}/overbookingMap`],n);return[...l,...c,...m]},embedItems:e=>e.embedItems,animationPause:e=>e.animationPause,isBookingCreatedFromEmbed:e=>t=>t in e.createdFromEmbedBookings,isWaitListItemCreatedFromEmbed:e=>t=>t in e.createdFromEmbedWaitListItems}}getActions(){return{setEditingBookingId:(e,t)=>{e.commit("setEditingBookingId",t)},setEditingWaitListItemId:(e,t)=>{e.commit("setEditingWaitListItemId",t)},setDraggedBookingId:(e,t)=>{e.commit("setDraggedBookingId",t)},setDraggedBookingResourceId:(e,t)=>{e.commit("setDraggedBookingResourceId",t)},setDraggedDataTransfer:(e,t)=>{e.commit("setDraggedDataTransfer",t)},clearDraggedDataTransfer:e=>{e.commit("setDraggedDataTransfer",{kind:null,id:0,resourceId:0})},setResizedBookingId:(e,t)=>{e.commit("setResizedBookingId",t)},setIsLoaded:(e,t)=>{e.commit("setIsLoaded",t)},setZoom:(e,t)=>{e.commit("setZoom",t)},setExpanded:(e,t)=>{e.commit("setExpanded",t)},setScroll:(e,t)=>{e.commit("setScroll",t)},setOffHoursHover:(e,t)=>{e.commit("setOffHoursHover",t)},setOffHoursExpanded:(e,t)=>{e.commit("setOffHoursExpanded",t)},setWaitListExpanded:(e,t)=>{e.commit("setWaitListExpanded",t)},setCalendarExpanded:(e,t)=>{e.commit("setCalendarExpanded",t)},setSelectedDateTs:(e,t)=>{e.commit("setSelectedDateTs",t)},setViewDateTs:(e,t)=>{e.commit("setViewDateTs",t)},addDeletingBooking:(e,t)=>{e.commit("addDeletingBooking",t)},removeDeletingBooking:(e,t)=>{e.commit("removeDeletingBooking",t)},addDeletingWaitListItemId:(e,t)=>{e.commit("addDeletingWaitListItemId",t)},removeDeletingWaitListItemId:(e,t)=>{e.commit("removeDeletingWaitListItemId",t)},addSelectedCell:(e,t)=>{e.commit("addSelectedCell",t)},removeSelectedCell:(e,t)=>{e.commit("removeSelectedCell",t)},clearSelectedCells:e=>{e.commit("clearSelectedCells")},setHoveredCell:(e,t)=>{e.commit("setHoveredCell",t)},upsertBusySlotMany:(e,t)=>{t.forEach((t=>e.commit("upsertBusySlot",t)))},clearBusySlots:e=>{e.commit("clearBusySlots")},addDisabledBusySlot:(e,t)=>{e.commit("addDisabledBusySlot",t)},clearDisabledBusySlots:e=>{e.commit("clearDisabledBusySlots")},setResourcesIds:(e,t)=>{e.commit("setResourcesIds",t)},deleteResourceId:(e,t)=>{e.commit("deleteResourceId",t)},setFilterMode:(e,t)=>{e.commit("setFilterMode",t)},setIntersectionMode:(e,t)=>{e.commit("setIntersectionMode",t)},setFilteredBookingsIds:(e,t)=>{e.commit("setFilteredBookingsIds",t)},setFilteredMarks:(e,t)=>{e.commit("setFilteredMarks",t)},setFreeMarks:(e,t)=>{e.commit("setFreeMarks",t)},setTotalClients:(e,t)=>{e.commit("setTotalClients",t)},setTotalNewClientsToday:(e,t)=>{e.commit("setTotalNewClientsToday",t)},setMoneyStatistics:(e,t)=>{e.commit("setMoneyStatistics",t)},setCounterMarks:(e,t)=>{e.commit("setCounterMarks",t)},setIntersections:(e,t)=>{e.commit("setIntersections",t)},hoverQuickFilter:(e,t)=>{e.commit("hoverQuickFilter",t)},fleeQuickFilter:(e,t)=>{e.commit("fleeQuickFilter",t)},activateQuickFilter:(e,t)=>{e.commit("activateQuickFilter",t);e.commit("clearQuickFilterIgnoredBookingIds")},deactivateQuickFilter:(e,t)=>{e.commit("deactivateQuickFilter",t);e.commit("clearQuickFilterIgnoredBookingIds")},addQuickFilterIgnoredBookingId:(e,t)=>{e.commit("addQuickFilterIgnoredBookingId",t)},setMousePosition:(e,t)=>{e.commit("setMousePosition",t)},setIsCurrentSenderAvailable:(e,t)=>{e.commit("setIsCurrentSenderAvailable",t)},setIsFeatureEnabled:(e,t)=>{e.commit("setIsFeatureEnabled",t)},setCanTurnOnTrial:(e,t)=>{e.commit("setCanTurnOnTrial",t)},setIsShownTrialPopup:(e,t)=>{e.commit("setIsShownTrialPopup",t)},setEmbedItems:(e,t)=>{e.commit("setEmbedItems",t)},setAnimationPause:({commit:e},t)=>{e("setAnimationPause",t)},addCreatedFromEmbedBooking:({commit:e,getters:t},s)=>{const i=t.embedItems||[];if(i.length>0){e("addCreatedFromEmbedBooking",s)}},addCreatedFromEmbedWaitListItem:({commit:e,getters:t},s)=>{const i=t.embedItems||[];if(i.length>0){e("addCreatedFromEmbedWaitListItem",s)}}}}getMutations(){return{setEditingBookingId:(e,t)=>{e.editingBookingId=t},setEditingWaitListItemId:(e,t)=>{e.editingWaitListItemId=t},setDraggedBookingId:(e,t)=>{e.draggedBookingId=t},setResizedBookingId:(e,t)=>{e.resizedBookingId=t},setDraggedBookingResourceId:(e,t)=>{e.draggedBookingResourceId=t},setDraggedDataTransfer:(e,t)=>{e.draggedDataTransfer=t},setIsLoaded:(e,t)=>{e.isLoaded=t},setZoom:(e,t)=>{e.zoom=t},setExpanded:(e,t)=>{e.expanded=t},setScroll:(e,t)=>{e.scroll=t},setOffHoursHover:(e,t)=>{e.offHoursHover=t},setOffHoursExpanded:(e,t)=>{e.offHoursExpanded=t},setWaitListExpanded:(e,t)=>{e.waitListExpanded=t},setCalendarExpanded:(e,t)=>{e.calendarExpanded=t},setSelectedDateTs:(e,t)=>{e.selectedDateTs=t},setViewDateTs:(e,t)=>{e.viewDateTs=t},addDeletingBooking:(e,t)=>{e.deletingBookings[t]=t},removeDeletingBooking:(e,t)=>{delete e.deletingBookings[t]},addDeletingWaitListItemId:(e,s)=>{if(t.Type.isArray(s)){s.forEach((t=>{e.deletingWaitListItemIds[t]=t}))}else{e.deletingWaitListItemIds[s]=s}},removeDeletingWaitListItemId:(e,s)=>{if(t.Type.isArray(s)){s.forEach((t=>{delete e.deletingWaitListItemIds[t]}))}else{delete e.deletingWaitListItemIds[s]}},addSelectedCell:(e,t)=>{e.selectedCells[t.id]=t},removeSelectedCell:(e,t)=>{delete e.selectedCells[t.id]},clearSelectedCells:e=>{e.selectedCells={}},setHoveredCell:(e,t)=>{e.hoveredCell=t},upsertBusySlot:(e,t)=>{var s,i,o;(o=(s=e.busySlots)[i=t.id])!=null?o:s[i]=t;Object.assign(e.busySlots[t.id],t)},clearBusySlots:e=>{e.busySlots={}},addDisabledBusySlot:(e,t)=>{e.disabledBusySlots[t.id]=t},clearDisabledBusySlots:e=>{e.disabledBusySlots={}},setResourcesIds:(e,t)=>{e.resourcesIds=t.sort(((e,t)=>e-t))},deleteResourceId:(e,t)=>{e.resourcesIds=e.resourcesIds.filter((e=>e!==t))},setFilterMode:(e,t)=>{e.isFilterMode=t},setIntersectionMode:(e,t)=>{e.isIntersectionForAll=t},setFilteredBookingsIds:(e,t)=>{e.filteredBookingsIds=[...t]},setFilteredMarks:(e,t)=>{e.filteredMarks=t},setFreeMarks:(e,t)=>{e.freeMarks=t},setTotalClients:(e,t)=>{e.totalClients=t},setTotalNewClientsToday:(e,t)=>{e.totalNewClientsToday=t},setMoneyStatistics:(e,t)=>{e.moneyStatistics=t},setCounterMarks:(e,t)=>{e.counterMarks=t},setIntersections:(e,t)=>{e.intersections=t},hoverQuickFilter:(e,t)=>{e.quickFilter.hovered[t]=t},fleeQuickFilter:(e,t)=>{delete e.quickFilter.hovered[t]},activateQuickFilter:(e,t)=>{e.quickFilter.active[t]=t},deactivateQuickFilter:(e,t)=>{delete e.quickFilter.active[t]},addQuickFilterIgnoredBookingId:(e,t)=>{e.quickFilter.ignoredBookingIds[t]=t},clearQuickFilterIgnoredBookingIds:e=>{e.quickFilter.ignoredBookingIds={}},setMousePosition:(e,t)=>{e.mousePosition=t},setIsCurrentSenderAvailable:(e,t)=>{e.isCurrentSenderAvailable=t},setIsFeatureEnabled:(e,t)=>{e.isFeatureEnabled=t},setCanTurnOnTrial:(e,t)=>{e.canTurnOnTrial=t},setIsShownTrialPopup:(e,t)=>{e.isShownTrialPopup=t},setEmbedItems:(e,t)=>{e.embedItems=t},setAnimationPause:(e,t)=>{e.animationPause=t},addCreatedFromEmbedBooking:(e,s)=>{if(t.Type.isArray(s)){for(const t of s){e.createdFromEmbedBookings[t]=t}return}e.createdFromEmbedBookings[s]=s},addCreatedFromEmbedWaitListItem:(e,s)=>{if(t.Type.isArray(s)){for(const t of s){e.createdFromEmbedWaitListItems[t]=t}return}e.createdFromEmbedWaitListItems[s]=s}}}}e.Interface=d})(this.BX.Booking.Model=this.BX.Booking.Model||{},BX,BX.Vue3.Vuex,BX.Booking.Const,BX.Booking.Lib);
//# sourceMappingURL=interface.bundle.map.js