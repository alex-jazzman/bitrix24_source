this.BX=this.BX||{};this.BX.Booking=this.BX.Booking||{};(function(e,t,s,o,i){"use strict";function r(e,t){const s=[];const o=new Set;for(const[,i]of e){const{dateFromTs:e,dateToTs:r,resourcesIds:d}=i.booking;if(d.every((e=>!t.has(e)))){continue}i.items.filter((({resourceId:e})=>t.has(e))).forEach((({resourceId:t,intersections:i})=>{i.forEach((i=>{const d={fromTs:e>=i.dateFromTs?e:i.dateFromTs,toTs:r<=i.dateToTs?r:i.dateToTs,resourcesIds:[t]};const a=`${d.fromTs}-${d.toTs}-${d.resourcesIds.join("-")}`;if(!o.has(a)){o.add(a);s.push(d)}}))}))}return s}class d extends s.BuilderModel{getName(){return o.Model.Interface}getState(){var e,t;const s=new Date;const o=this.getVariable("schedule",{});return{isFeatureEnabled:this.getVariable("isFeatureEnabled",false),canTurnOnTrial:this.getVariable("canTurnOnTrial",false),canTurnOnDemo:this.getVariable("canTurnOnDemo",false),editingBookingId:this.getVariable("editingBookingId",0),editingWaitListItemId:this.getVariable("editingWaitListItemId",0),draggedBookingId:0,draggedBookingResourceId:0,draggedDataTransfer:{id:0,resourceId:0,kind:""},resizedBookingId:0,isLoaded:false,zoom:1,expanded:false,scroll:0,offHoursHover:false,offHoursExpanded:false,waitListExpanded:this.getVariable("waitListExpanded",true),calendarExpanded:this.getVariable("calendarExpanded",true),fromHour:(e=o.fromHour)!=null?e:9,toHour:(t=o.toHour)!=null?t:19,selectedDateTs:new Date(s.getFullYear(),s.getMonth(),s.getDate()).getTime(),viewDateTs:new Date(s.getFullYear(),s.getMonth()).getTime(),deletingBookings:{},deletingResources:{},deletingWaitListItemIds:{},selectedCells:{},hoveredCell:null,busySlots:{},disabledBusySlots:{},resourcesIds:[],pinnedResourceIds:[],isIntersectionForAll:true,counterMarks:[],freeMarks:[],totalClients:this.getVariable("totalClients",0),totalNewClientsToday:this.getVariable("totalNewClientsToday",0),moneyStatistics:this.getVariable("moneyStatistics",null),intersections:{},timezone:this.getVariable("timezone",Intl.DateTimeFormat().resolvedOptions().timeZone),mousePosition:{top:0,left:0},isCurrentSenderAvailable:false,isShownTrialPopup:false,embedItems:this.getVariable("embedItems",[]),animationPause:false,createdFromEmbedBookings:{},createdFromEmbedWaitListItems:{}}}getGetters(){return{isFeatureEnabled:e=>e.isFeatureEnabled||e.canTurnOnTrial,canTurnOnTrial:e=>e.canTurnOnTrial,canTurnOnDemo:e=>e.canTurnOnDemo,isShownTrialPopup:e=>e.isShownTrialPopup,editingBookingId:e=>e.editingBookingId,editingWaitListItemId:e=>e.editingWaitListItemId,isEditingBookingMode:e=>e.editingBookingId>0||e.editingWaitListItemId>0,draggedBookingId:e=>e.draggedDataTransfer.kind===o.DraggedElementKind.Booking?e.draggedDataTransfer.id:0,draggedBookingResourceId:e=>e.draggedDataTransfer.kind===o.DraggedElementKind.Booking?e.draggedDataTransfer.resourceId:0,draggedDataTransfer:e=>e.draggedDataTransfer,resizedBookingId:e=>e.resizedBookingId,isDragMode:e=>e.draggedDataTransfer.id>0||e.resizedBookingId,isLoaded:e=>e.isLoaded,zoom:e=>e.zoom,expanded:e=>e.expanded,scroll:e=>e.scroll,offHoursHover:e=>e.offHoursHover,offHoursExpanded:e=>e.offHoursExpanded,waitListExpanded:e=>e.waitListExpanded,calendarExpanded:e=>e.calendarExpanded,fromHour:e=>e.fromHour,toHour:e=>e.toHour,selectedDateTs:(e,t)=>e.selectedDateTs-t.offset,viewDateTs:(e,t)=>e.viewDateTs-t.offset,deletingBookings:e=>e.deletingBookings,deletingResources:e=>e.deletingResources,deletingWaitListItems:e=>e.deletingWaitListItemIds,selectedCells:e=>e.selectedCells,hoveredCell:e=>e.hoveredCell,busySlots:e=>Object.values(e.busySlots),disabledBusySlots:e=>e.disabledBusySlots,resourcesIds:(e,t,s,i)=>{const r=i[`${o.Model.Bookings}/getByDate`](e.selectedDateTs).filter((e=>!i[`${o.Model.Filter}/isFilterMode`]&&e.counter>0)).map((e=>e.resourcesIds[0]));const d=[...new Set([...e.pinnedResourceIds,...e.resourcesIds,...r])];const a=new Set(t.getOccupancy(d,Object.values(i[`${o.Model.Filter}/quickFilter`].ignoredBookingIds)).filter((s=>Object.values(i[`${o.Model.Filter}/quickFilter`].active).some((o=>{const i=new Date(e.selectedDateTs).setHours(o)-t.offset;const r=new Date(e.selectedDateTs).setHours(o+1)-t.offset;return r>s.fromTs&&i<s.toTs})))).flatMap((e=>e.resourcesIds)));Object.values(e.deletingResources).forEach((e=>a.add(Number(e))));return d.filter((e=>!a.has(e)))},extraResourcesIds:(e,t)=>{const s=e.resourcesIds;return t.resourcesIds.filter((e=>!s.includes(e)))},isIntersectionForAll:e=>e.isIntersectionForAll,freeMarks:e=>e.freeMarks,totalClients:e=>e.totalClients,totalNewClientsToday:e=>e.totalNewClientsToday,moneyStatistics:e=>e.moneyStatistics,getCounterMarks:e=>(s=null)=>{if(t.Type.isNull(s)){return e.counterMarks}return e.counterMarks.filter((e=>s.includes(e)))},intersections:e=>e.intersections,timezone:e=>e.timezone,offset:e=>{const t=i.Timezone.getOffset(e.selectedDateTs,e.timezone);return(t+new Date(e.selectedDateTs).getTimezoneOffset()*60)*1e3},mousePosition:e=>e.mousePosition,isCurrentSenderAvailable:e=>e.isCurrentSenderAvailable,getColliding:(e,t)=>(s,o)=>{const i=Array.isArray(s)?s:[s];return[...t.getOccupancy(i,o),...Object.values(e.selectedCells).filter((e=>i.includes(e.resourceId))).map((e=>({fromTs:e.fromTs,toTs:e.toTs,resourcesIds:[e.resourceId]})))]},getOccupancy:(e,s,i,d)=>(i,a=[])=>{const n=new Set(i);const l=d[`${o.Model.Bookings}/get`].filter((e=>{const s=e.resourcesIds.some((e=>n.has(e)));const o=t.Type.isFunction(a)?!a(e):!a.includes(e.id);return s&&o})).map((e=>({fromTs:e.dateFromTs,toTs:e.dateToTs,resourcesIds:e.resourcesIds})));const c=Object.values(e.busySlots).filter((t=>{const i=s.isDragMode&&t.type===o.BusySlot.OffHours;const r=!(t.id in e.disabledBusySlots)&&!i;const d=n.has(t.resourceId);const a=t.type===o.BusySlot.IntersectionOverbooking;return a&&r&&d})).map((({fromTs:e,toTs:t,resourceId:s})=>({fromTs:e,toTs:t,resourcesIds:[s]})));const m=r(d[`${o.Model.Bookings}/overbookingMap`],n);return[...l,...c,...m]},embedItems:e=>e.embedItems,animationPause:e=>e.animationPause,isBookingCreatedFromEmbed:e=>t=>t in e.createdFromEmbedBookings,isWaitListItemCreatedFromEmbed:e=>t=>t in e.createdFromEmbedWaitListItems}}getActions(){const e=e=>(s,o)=>{if(t.Type.isArray(o)){o.forEach((t=>s.commit(e,t)))}else{s.commit(e,o)}};return{setEditingBookingId:(e,t)=>{e.commit("setEditingBookingId",t)},setEditingWaitListItemId:(e,t)=>{e.commit("setEditingWaitListItemId",t)},setDraggedBookingId:(e,t)=>{e.commit("setDraggedBookingId",t)},setDraggedBookingResourceId:(e,t)=>{e.commit("setDraggedBookingResourceId",t)},setDraggedDataTransfer:(e,t)=>{e.commit("setDraggedDataTransfer",t)},clearDraggedDataTransfer:e=>{e.commit("setDraggedDataTransfer",{kind:null,id:0,resourceId:0})},setResizedBookingId:(e,t)=>{e.commit("setResizedBookingId",t)},setIsLoaded:(e,t)=>{e.commit("setIsLoaded",t)},setZoom:(e,t)=>{e.commit("setZoom",t)},setExpanded:(e,t)=>{e.commit("setExpanded",t)},setScroll:(e,t)=>{e.commit("setScroll",t)},setOffHoursHover:(e,t)=>{e.commit("setOffHoursHover",t)},setOffHoursExpanded:(e,t)=>{e.commit("setOffHoursExpanded",t)},setWaitListExpanded:(e,t)=>{e.commit("setWaitListExpanded",t)},setCalendarExpanded:(e,t)=>{e.commit("setCalendarExpanded",t)},setSelectedDateTs:(e,t)=>{e.commit("setSelectedDateTs",t)},setViewDateTs:(e,t)=>{e.commit("setViewDateTs",t)},addDeletingBooking:e("addDeletingBooking"),removeDeletingBooking:e("removeDeletingBooking"),addDeletingResource:e("addDeletingResource"),removeDeletingResource:e("removeDeletingResource"),addDeletingWaitListItemId:e("addDeletingWaitListItemId"),removeDeletingWaitListItemId:e("removeDeletingWaitListItemId"),addSelectedCell:(e,t)=>{e.commit("addSelectedCell",t)},removeSelectedCell:(e,t)=>{e.commit("removeSelectedCell",t)},clearSelectedCells:e=>{e.commit("clearSelectedCells")},setHoveredCell:(e,t)=>{e.commit("setHoveredCell",t)},upsertBusySlotMany:(e,t)=>{t.forEach((t=>e.commit("upsertBusySlot",t)))},clearBusySlots:e=>{e.commit("clearBusySlots")},addDisabledBusySlot:(e,t)=>{e.commit("addDisabledBusySlot",t)},clearDisabledBusySlots:e=>{e.commit("clearDisabledBusySlots")},setResourcesIds:(e,t)=>{e.commit("setResourcesIds",t)},setPinnedResourceIds:({commit:e},t)=>{e("setPinnedResourceIds",t)},deleteResourceId:(e,t)=>{e.commit("deleteResourceId",t)},setIntersectionMode:(e,t)=>{e.commit("setIntersectionMode",t)},setFreeMarks:(e,t)=>{e.commit("setFreeMarks",t)},setTotalClients:(e,t)=>{e.commit("setTotalClients",t)},setTotalNewClientsToday:(e,t)=>{e.commit("setTotalNewClientsToday",t)},setMoneyStatistics:(e,t)=>{e.commit("setMoneyStatistics",t)},setCounterMarks:(e,t)=>{e.commit("setCounterMarks",t)},setIntersections:(e,t)=>{e.commit("setIntersections",t)},setMousePosition:(e,t)=>{e.commit("setMousePosition",t)},setIsCurrentSenderAvailable:(e,t)=>{e.commit("setIsCurrentSenderAvailable",t)},setIsFeatureEnabled:(e,t)=>{e.commit("setIsFeatureEnabled",t)},setCanTurnOnTrial:(e,t)=>{e.commit("setCanTurnOnTrial",t)},setIsShownTrialPopup:(e,t)=>{e.commit("setIsShownTrialPopup",t)},setEmbedItems:(e,t)=>{e.commit("setEmbedItems",t)},setAnimationPause:({commit:e},t)=>{e("setAnimationPause",t)},addCreatedFromEmbedBooking:({commit:e,getters:t},s)=>{const o=t.embedItems||[];if(o.length>0){e("addCreatedFromEmbedBooking",s)}},addCreatedFromEmbedWaitListItem:({commit:e,getters:t},s)=>{const o=t.embedItems||[];if(o.length>0){e("addCreatedFromEmbedWaitListItem",s)}}}}getMutations(){return{setEditingBookingId:(e,t)=>{e.editingBookingId=t},setEditingWaitListItemId:(e,t)=>{e.editingWaitListItemId=t},setDraggedBookingId:(e,t)=>{e.draggedBookingId=t},setResizedBookingId:(e,t)=>{e.resizedBookingId=t},setDraggedBookingResourceId:(e,t)=>{e.draggedBookingResourceId=t},setDraggedDataTransfer:(e,t)=>{e.draggedDataTransfer=t},setIsLoaded:(e,t)=>{e.isLoaded=t},setZoom:(e,t)=>{e.zoom=t},setExpanded:(e,t)=>{e.expanded=t},setScroll:(e,t)=>{e.scroll=t},setOffHoursHover:(e,t)=>{e.offHoursHover=t},setOffHoursExpanded:(e,t)=>{e.offHoursExpanded=t},setWaitListExpanded:(e,t)=>{e.waitListExpanded=t},setCalendarExpanded:(e,t)=>{e.calendarExpanded=t},setSelectedDateTs:(e,t)=>{e.selectedDateTs=t},setViewDateTs:(e,t)=>{e.viewDateTs=t},addDeletingBooking:(e,t)=>{e.deletingBookings[t]=t},removeDeletingBooking:(e,t)=>{delete e.deletingBookings[t]},addDeletingResource:(e,t)=>{e.deletingResources[t]=t},removeDeletingResource:(e,t)=>{delete e.deletingResources[t]},addDeletingWaitListItemId:(e,t)=>{e.deletingWaitListItemIds[t]=t},removeDeletingWaitListItemId:(e,t)=>{delete e.deletingWaitListItemIds[t]},addSelectedCell:(e,t)=>{e.selectedCells[t.id]=t},removeSelectedCell:(e,t)=>{delete e.selectedCells[t.id]},clearSelectedCells:e=>{e.selectedCells={}},setHoveredCell:(e,t)=>{e.hoveredCell=t},upsertBusySlot:(e,t)=>{var s,o,i;(i=(s=e.busySlots)[o=t.id])!=null?i:s[o]=t;Object.assign(e.busySlots[t.id],t)},clearBusySlots:e=>{e.busySlots={}},addDisabledBusySlot:(e,t)=>{e.disabledBusySlots[t.id]=t},clearDisabledBusySlots:e=>{e.disabledBusySlots={}},setResourcesIds:(e,t)=>{e.resourcesIds=t.sort(((e,t)=>e-t))},setPinnedResourceIds:(e,t)=>{e.pinnedResourceIds=t},deleteResourceId:(e,t)=>{e.resourcesIds=e.resourcesIds.filter((e=>e!==t))},setIntersectionMode:(e,t)=>{e.isIntersectionForAll=t},setFreeMarks:(e,t)=>{e.freeMarks=t},setTotalClients:(e,t)=>{e.totalClients=t},setTotalNewClientsToday:(e,t)=>{e.totalNewClientsToday=t},setMoneyStatistics:(e,t)=>{e.moneyStatistics=t},setCounterMarks:(e,t)=>{e.counterMarks=t},setIntersections:(e,t)=>{e.intersections=t},setMousePosition:(e,t)=>{e.mousePosition=t},setIsCurrentSenderAvailable:(e,t)=>{e.isCurrentSenderAvailable=t},setIsFeatureEnabled:(e,t)=>{e.isFeatureEnabled=t},setCanTurnOnTrial:(e,t)=>{e.canTurnOnTrial=t},setIsShownTrialPopup:(e,t)=>{e.isShownTrialPopup=t},setEmbedItems:(e,t)=>{e.embedItems=t},setAnimationPause:(e,t)=>{e.animationPause=t},addCreatedFromEmbedBooking:(e,s)=>{if(t.Type.isArray(s)){for(const t of s){e.createdFromEmbedBookings[t]=t}return}e.createdFromEmbedBookings[s]=s},addCreatedFromEmbedWaitListItem:(e,s)=>{if(t.Type.isArray(s)){for(const t of s){e.createdFromEmbedWaitListItems[t]=t}return}e.createdFromEmbedWaitListItems[s]=s}}}}e.Interface=d})(this.BX.Booking.Model=this.BX.Booking.Model||{},BX,BX.Vue3.Vuex,BX.Booking.Const,BX.Booking.Lib);
//# sourceMappingURL=interface.bundle.map.js