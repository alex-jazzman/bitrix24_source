{"version":3,"file":"settings.bundle.js","sources":["../src/services/resource-store.js","../src/const/booking-form.js","../src/model/booking-settings-data-model.js","../src/components/resources-manager/content-header/content-header.js","../src/components/resources-manager/resources-selector/footer.js","../src/components/resources-manager/resources-selector/resources-selector.js","../src/components/resources-manager/resources-manager.js","../src/components/fields/booking-base-field.js","../src/components/fields/has-slots-all-available-resources-field.js","../src/components/fields/hint-field.js","../src/components/fields/hint-visibility-field.js","../src/components/fields/label-field.js","../src/components/fields/placeholder-field.js","../src/booking-settings-popup.js","../src/settings.js"],"sourcesContent":["import { crmFormService } from 'booking.provider.service.crm-form-service';\n\nimport type { ResourceModel } from 'booking.model.resources';\n\nclass ResourceStore\n{\n\t#resourcesById: Map<number, ResourceModel> = new Map();\n\n\tasync ensure(ids: number[]): Promise<void>\n\t{\n\t\tif (ids.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst needToLoadIds: number[] = ids.filter((id: number) => !this.#isLoaded(id));\n\t\tif (needToLoadIds.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst loaded: ResourceModel[] = await crmFormService.getResources(needToLoadIds);\n\t\tfor (const resource: ResourceModel of loaded)\n\t\t{\n\t\t\tthis.#resourcesById.set(resource.id, resource);\n\t\t}\n\t}\n\n\t#isLoaded(id: number): boolean\n\t{\n\t\treturn this.#resourcesById.has(id);\n\t}\n\n\tgetByIds(ids: number[]): ResourceModel[]\n\t{\n\t\treturn ids\n\t\t\t.map((id: number): ResourceModel | undefined => this.#resourcesById.get(id))\n\t\t\t.filter(Boolean)\n\t\t;\n\t}\n\n\tgetAll(): ResourceModel[]\n\t{\n\t\treturn [...this.#resourcesById.values()];\n\t}\n}\n\nexport const resourceStore: ResourceStore = new ResourceStore();\n","import { Loc } from 'main.core';\nimport type { BookingAutoSelectionForm, BookingDefaultForm } from '../types';\n\nconst defaultBookingForm = {\n\tresourceIds: [],\n\tlabel: Loc.getMessage('BOOKING_CRM_FORMS_SETTINGS_FIELD_LABEL_DEFAULT'),\n\tisVisibleHint: true,\n\thint: Loc.getMessage('BOOKING_CRM_FORMS_SETTINGS_HINT_DEFAULT_VALUE'),\n\thasSlotsAllAvailableResources: false,\n};\n\nexport const defaultBookingDefaultForm: BookingDefaultForm = {\n\t...defaultBookingForm,\n\tresourceIds: [],\n\ttextHeader: Loc.getMessage('BOOKING_CRM_FORMS_SETTINGS_FIELD_PLACEHOLDER_DEFAULT_VALUE'),\n};\n\nexport const defaultBookingAutoSelectionForm: BookingAutoSelectionForm = {\n\t...defaultBookingForm,\n\tresourceIds: [],\n\thasSlotsAllAvailableResources: false,\n\ttextHeader: Loc.getMessage('BOOKING_CRM_FORMS_SETTINGS_FIELD_PLACEHOLDER_AUTO_SELECT_DEFAULT_VALUE'),\n};\n","import { CrmFormTemplateId, CrmFormSettingsDataPropName } from 'booking.const';\n\nimport { defaultBookingDefaultForm, defaultBookingAutoSelectionForm } from '../const';\nimport type {\n\tBookingSettingsData,\n\tBookingSettingsDataProperty,\n\tBookingForm,\n\tBookingAutoSelectionForm,\n\tBookingDefaultForm,\n\tTemplateId,\n} from '../types';\n\nexport class BookingSettingsDataModel\n{\n\t#isAutoSelectionOn: boolean;\n\t#settingsData: BookingSettingsData;\n\n\tconstructor(settingsData: BookingSettingsData, isAutoSelectionOn: boolean, templateId: TemplateId)\n\t{\n\t\tthis.#isAutoSelectionOn = isAutoSelectionOn;\n\n\t\tconst autoSelectionData = (\n\t\t\tsettingsData[CrmFormSettingsDataPropName.autoSelection]\n\t\t\t|| this.#getAutoSelectionFormByTemplate(templateId)\n\t\t);\n\t\tconst defaultData = (\n\t\t\tsettingsData[CrmFormSettingsDataPropName.default]\n\t\t\t|| this.#getDefaultFormByTemplate(templateId)\n\t\t);\n\t\tthis.#settingsData = {\n\t\t\t[CrmFormSettingsDataPropName.isAutoSelectionOn]: isAutoSelectionOn,\n\t\t\t[CrmFormSettingsDataPropName.autoSelection]: autoSelectionData,\n\t\t\t[CrmFormSettingsDataPropName.default]: defaultData,\n\t\t};\n\t}\n\n\t#getAutoSelectionFormByTemplate(): BookingAutoSelectionForm\n\t{\n\t\treturn defaultBookingAutoSelectionForm;\n\t}\n\n\t#getDefaultFormByTemplate(templateId: TemplateId): BookingDefaultForm\n\t{\n\t\tif (templateId === CrmFormTemplateId.BookingAnyResource)\n\t\t{\n\t\t\treturn {\n\t\t\t\t...defaultBookingDefaultForm,\n\t\t\t\thasSlotsAllAvailableResources: true,\n\t\t\t};\n\t\t}\n\n\t\treturn { ...defaultBookingDefaultForm };\n\t}\n\n\tget dataSettingsProperty(): BookingSettingsDataProperty\n\t{\n\t\treturn this.#isAutoSelectionOn\n\t\t\t? CrmFormSettingsDataPropName.autoSelection\n\t\t\t: CrmFormSettingsDataPropName.default;\n\t}\n\n\tsetSettingsData(patch: Partial<BookingForm> = {}): void\n\t{\n\t\tObject.assign(this.#settingsData[this.dataSettingsProperty], patch);\n\t}\n\n\tget settingsData(): BookingSettingsData\n\t{\n\t\treturn this.#settingsData;\n\t}\n\n\tget form(): BookingForm\n\t{\n\t\treturn this.#settingsData[this.dataSettingsProperty];\n\t}\n}\n","import { BaseHeader } from 'ui.entity-selector';\n\nexport class ContentHeader extends BaseHeader\n{\n\tconstructor(...props)\n\t{\n\t\tsuper(...props);\n\n\t\tthis.getContainer();\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\treturn this.options.content;\n\t}\n}\n","import { Event, Tag, Loc, Type } from 'main.core';\nimport type { BaseEvent } from 'main.core.events';\nimport { BaseFooter } from 'ui.entity-selector';\nimport type { FooterOptions, ItemOptions, Tab } from 'ui.entity-selector';\n\nexport class ResourceSelectorDialogFooter extends BaseFooter\n{\n\t#resources = [];\n\t#onClose: Function | null = null;\n\t#onSave: Function | null = null;\n\n\tconstructor(tab: Tab, options: FooterOptions)\n\t{\n\t\tsuper(tab, options);\n\n\t\tthis.#resources = [];\n\n\t\tthis.#onClose = options.onClose || null;\n\t\tthis.#onSave = options.onSave || null;\n\n\t\tthis.getDialog().subscribe('Item:onSelect', this.#handleOnTagAdd.bind(this));\n\t\tthis.getDialog().subscribe('Item:onDeselect', this.#handleOnTagRemove.bind(this));\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tconst { footer, footerAddButton, footerCloseButton } = Tag.render`\n\t\t\t<div ref=\"footer\" class=\"crm-forms--booking--resource-selector-dialog__footer\">\n\t\t\t\t<button\n\t\t\t\t\tref=\"footerAddButton\"\n\t\t\t\t\tclass=\"ui-btn ui-btn ui-btn-sm ui-btn-primary ui-btn-round crm-forms--booking--resource-selector-dialog__footer-btn-width\"\n\t\t\t\t>\n\t\t\t\t\t${Loc.getMessage('BOOKING_CRM_FORMS_SETTINGS_RESOURCE_SELECTOR_DIALOG_ADD_BUTTON')}\n\t\t\t\t</button>\n\t\t\t\t<button ref=\"footerCloseButton\" class=\"ui-btn ui-btn ui-btn-sm ui-btn-light-border ui-btn-round crm-forms--booking--resource-selector-dialog__footer-btn-width\">\n\t\t\t\t\t${Loc.getMessage('BOOKING_CRM_FORMS_SETTINGS_RESOURCE_SELECTOR_DIALOG_CANCEL_BUTTON')}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.footerAddButton = footerAddButton;\n\t\tEvent.bind(footerAddButton, 'click', this.#add.bind(this));\n\n\t\tthis.footerCloseButton = footerCloseButton;\n\t\tEvent.bind(this.footerCloseButton, 'click', this.#close.bind(this));\n\n\t\treturn footer;\n\t}\n\n\tget resourcesCount(): number\n\t{\n\t\treturn this.#resources.length;\n\t}\n\n\t#add(): void\n\t{\n\t\tconst resources: ItemOptions[] = this.dialog.getSelectedItems();\n\t\tconst resourceIds = resources.map((resource) => resource.id);\n\n\t\tif (Type.isFunction(this.#onSave))\n\t\t{\n\t\t\tthis.#onSave({ resourceIds });\n\t\t}\n\n\t\tthis.#close();\n\t}\n\n\t#close(): void\n\t{\n\t\tif (Type.isFunction(this.#onClose))\n\t\t{\n\t\t\tthis.#onClose();\n\t\t}\n\n\t\tthis.dialog?.hide();\n\t}\n\n\tdestroyDialog(): void\n\t{\n\t\tEvent.unbindAll(this.footerAddButton, 'click');\n\t\tEvent.unbindAll(this.footerCloseButton, 'click');\n\t\tthis.getDialog().destroy();\n\t}\n\n\t#handleOnTagAdd(event: BaseEvent): void\n\t{\n\t\tconst { item } = event.getData();\n\t\tthis.#onResourceToggle(item, true);\n\t}\n\n\t#handleOnTagRemove(event: BaseEvent): void\n\t{\n\t\tconst { item } = event.getData();\n\t\tthis.#onResourceToggle(item, false);\n\t}\n\n\t#onResourceToggle(item: ItemOptions, isSelected: boolean = false): void\n\t{\n\t\tif (isSelected)\n\t\t{\n\t\t\tthis.#resources = [...this.#resources, item];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#resources = this.#resources.filter((resource) => resource.id !== item.id);\n\t\t}\n\t}\n}\n","import { Type } from 'main.core';\nimport { Dialog } from 'ui.entity-selector';\n\nimport { EntitySelectorEntity } from 'booking.const';\n\nimport { ResourceSelectorDialogFooter } from './footer';\nimport './resource-selector-dialog.css';\n\ntype ResourcesSelectorOptions = {\n\ttargetNode: HTMLElement;\n\tselectedIds: ?number[];\n\tonClose: () => void;\n\tonSave: ({ resourceIds: number[] }) => void;\n}\n\nexport class ResourcesSelector\n{\n\t#selector: ?Dialog = null;\n\t#targetNode: HTMLElement;\n\t#selectedIds: number[];\n\t#selectedItems = [];\n\t#onClose: Function = null;\n\t#onSave: Function = null;\n\n\tconstructor(options: ResourcesSelectorOptions)\n\t{\n\t\tthis.#targetNode = options.targetNode;\n\t\tthis.#selectedIds = options.selectedIds || [];\n\t\tthis.#selectedItems = [];\n\t\tthis.#onClose = options.onClose;\n\t\tthis.#onSave = options.onSave;\n\t}\n\n\tgetSelectedItems(): []\n\t{\n\t\treturn this.#selectedItems;\n\t}\n\n\tcreateSelector(): Dialog\n\t{\n\t\tthis.#selector = new Dialog({\n\t\t\tid: 'crm-forms--booking--booking-setting--resources-selector',\n\t\t\tpreselectedItems: this.#selectedIds.map((id: number) => [EntitySelectorEntity.Resource, id]),\n\t\t\twidth: 400,\n\t\t\tenableSearch: true,\n\t\t\tdropdownMode: true,\n\t\t\tcontext: 'crmFormsBookingResourcesSelector',\n\t\t\tmultiple: true,\n\t\t\tcacheable: true,\n\t\t\tshowAvatars: false,\n\t\t\tfooter: ResourceSelectorDialogFooter,\n\t\t\tfooterOptions: {\n\t\t\t\tonSave: this.#onSave,\n\t\t\t\tonClose: this.#onClose,\n\t\t\t},\n\t\t\tentities: [\n\t\t\t\t{\n\t\t\t\t\tid: EntitySelectorEntity.Resource,\n\t\t\t\t\tdynamicLoad: true,\n\t\t\t\t\tdynamicSearch: true,\n\t\t\t\t},\n\t\t\t],\n\t\t\tsearchOptions: {\n\t\t\t\tallowCreateItem: false,\n\t\t\t},\n\t\t\tpopupOptions: {\n\t\t\t\toverlay: { opacity: 40 },\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tonHide: this.hide.bind(this),\n\t\t\t\tonLoad: this.#changeSelected.bind(this),\n\t\t\t},\n\t\t});\n\n\t\treturn this.#selector;\n\t}\n\n\tgetSelectedIds(): number[]\n\t{\n\t\treturn this.#selectedItems.map(({ id }) => id);\n\t}\n\n\thide(): void\n\t{\n\t\tif (Type.isFunction(this.#onClose))\n\t\t{\n\t\t\tthis.#onClose();\n\t\t}\n\t}\n\n\t#changeSelected(): void\n\t{\n\t\tthis.#selectedItems = this.#selector.getSelectedItems();\n\t}\n}\n","import { Dom, Event, Loc, Tag, Type } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport { Dialog, Item } from 'ui.entity-selector';\n\nimport { EntitySelectorEntity, EntitySelectorTab } from 'booking.const';\nimport type { ResourceModel } from 'booking.model.resources';\n\nimport { ContentHeader } from './content-header/content-header';\nimport { ResourcesSelector } from './resources-selector/resources-selector';\nimport { resourceStore } from '../../services/resource-store';\n\nimport './resources-manager.css';\n\ntype ResourcesManagerOptions = {\n\ttarget: HTMLElement,\n\tselectedIds: number[],\n\tonUpdateResourceIds: (number[]) => void,\n\tonClose: (number[]) => void | null,\n}\n\nconst subHeaderClassName = 'crm-form--booking--resources-manager--header-resources-section';\n\nexport class ResourcesManager\n{\n\tdialog: ?Dialog = null;\n\t#targetNode: HTMLElement;\n\t#selectedIds: number[];\n\t#resourcesIds: number[];\n\t#loadingResources: boolean = false;\n\t#options: ResourcesManagerOptions;\n\t#btnDeleteResources: HTMLElement;\n\t#btnChangeResources: HTMLElement;\n\n\tconstructor(options: ResourcesManagerOptions)\n\t{\n\t\tthis.#resourcesIds = options.selectedIds || [];\n\t\tthis.#selectedIds = [];\n\t\tthis.#targetNode = options.target;\n\t\tthis.#options = options;\n\t}\n\n\tasync show(): void\n\t{\n\t\tif (!this.dialog)\n\t\t{\n\t\t\tthis.#initDialog();\n\n\t\t\tawait this.#loadResources(this.#resourcesIds);\n\n\t\t\tconst renderInitialContent = this.#resourcesIds.length > 0\n\t\t\t\t? this.#addSelectedItems.bind(this)\n\t\t\t\t: this.#appendEmptyState.bind(this)\n\t\t\t;\n\n\t\t\trenderInitialContent();\n\t\t}\n\n\t\tthis.dialog.show();\n\n\t\tEvent.bind(document, 'scroll', this.adjustPosition, true);\n\t}\n\n\tclose(): void\n\t{\n\t\tif (this.dialog)\n\t\t{\n\t\t\tthis.#options.onUpdateResourceIds(this.#resourcesIds);\n\t\t\tif (Type.isFunction(this.#options.onClose))\n\t\t\t{\n\t\t\t\tthis.#options.onClose(this.#resourcesIds);\n\t\t\t}\n\t\t\tthis.dialog.destroy();\n\t\t\tEvent.unbind(document, 'scroll', this.adjustPosition, true);\n\t\t}\n\t}\n\n\tadjustPosition(): void\n\t{\n\t\tif (this.dialog)\n\t\t{\n\t\t\tthis.dialog.adjustPosition();\n\t\t}\n\t}\n\n\tget selectedResources(): ResourceModel[]\n\t{\n\t\tif (this.#resourcesIds.length === 0)\n\t\t{\n\t\t\treturn [];\n\t\t}\n\n\t\treturn resourceStore.getByIds(this.#resourcesIds);\n\t}\n\n\t#initDialog(): void\n\t{\n\t\tthis.dialog = new Dialog({\n\t\t\ttargetNode: this.#targetNode,\n\t\t\tid: 'booking-crm-form-resource-selector',\n\t\t\theight: Math.max(window.innerHeight - 300, 500),\n\t\t\twidth: 356,\n\t\t\toffsetLeft: this.#targetNode.offsetWidth + 5,\n\t\t\toffsetTop: -300,\n\t\t\taddTagOnSelect: false,\n\t\t\tshowAvatars: false,\n\t\t\tfocusOnFirst: false,\n\t\t\tdropdownMode: true,\n\t\t\tenableSearch: true,\n\t\t\tsearchOptions: {\n\t\t\t\tallowCreateItem: false,\n\t\t\t},\n\t\t\theader: ContentHeader,\n\t\t\theaderOptions: {\n\t\t\t\tcontent: this.#getHeaderContent(),\n\t\t\t},\n\t\t\tpopupOptions: {\n\t\t\t\tclassName: 'crm-form--booking--resource-manager-popup',\n\t\t\t\tangle: {\n\t\t\t\t\tposition: 'left',\n\t\t\t\t},\n\t\t\t},\n\t\t\ttagSelectorOptions: {\n\t\t\t\ttextBoxWidth: '90%',\n\t\t\t\tplaceholder: Loc.getMessage('BOOKING_CRM_FORMS_SETTINGS_RESOURCE_MANAGER_SEARCH_PLACEHOLDER'),\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tonHide: () => this.#options.onClose?.(this.#resourcesIds),\n\t\t\t\t'Item:onSelect': (event: BaseEvent) => {\n\t\t\t\t\tthis.#selectItem(event.getData().item);\n\t\t\t\t},\n\t\t\t\t'Item:onDeselect': (event: BaseEvent) => {\n\t\t\t\t\tthis.#deselectItem(event.getData().item);\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tif (this.#resourcesIds.length > 0)\n\t\t{\n\t\t\tthis.#appendSubHeaderContent();\n\t\t}\n\n\t\tthis.dialog.removeItems();\n\t}\n\n\t#selectItem(item: Item): void\n\t{\n\t\tthis.#selectedIds.push(item.id);\n\n\t\tif (this.#selectedIds.length > 0)\n\t\t{\n\t\t\tthis.#showDeleteButton();\n\t\t}\n\t}\n\n\t#deselectItem(item: Item): void\n\t{\n\t\tthis.#selectedIds = this.#selectedIds.filter((id) => id !== item.id);\n\n\t\tif (this.#selectedIds.length === 0)\n\t\t{\n\t\t\tthis.#hideDeleteButton();\n\t\t}\n\t}\n\n\t#deleteResources(): void\n\t{\n\t\tif (this.#selectedIds.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#setResourceIds(\n\t\t\tthis.#resourcesIds.filter((id) => !this.#selectedIds.includes(id)),\n\t\t);\n\t\tthis.#selectedIds = [];\n\t\tthis.#hideDeleteButton();\n\t}\n\n\t#appendEmptyState(): void\n\t{\n\t\tconst container = this.dialog.getPopup().getContentContainer();\n\n\t\tif (Type.isDomNode(container.querySelector('.crm-forms--booking--resources-manager-empty-state')))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst emptyState = Tag.render`\n\t\t\t<div class=\"crm-forms--booking--resources-manager-empty-state d-flex h-100 w-100 justify-content-center\">\n\t\t\t\t<div class=\"d-flex flex-column align-items-center p-4\">\n\t\t\t\t\t<div class=\"mb-3 crm-forms--booking--resources-manager-empty-state_icon\"></div>\n\t\t\t\t\t<div class=\"mb-3 crm-forms--booking--resources-manager-empty-state_title fw-medium fs-6 lh-base\">\n\t\t\t\t\t\t${Loc.getMessage('BOOKING_CRM_FORMS_SETTINGS_RESOURCE_MANAGER_EMPTY_TITLE')}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"mb-3 crm-forms--booking--resources-manager-empty-state_text fw-normal\">\n\t\t\t\t\t\t${Loc.getMessage('BOOKING_CRM_FORMS_SETTINGS_RESOURCE_MANAGER_EMPTY_MESSAGE')}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"btn btn-primary g-btn-size-l crm-forms--booking--resources-manager__empty-state-btn-add\"\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\tonclick=\"${this.#openResourceSelector.bind(this)}\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t${Loc.getMessage('BOOKING_CRM_FORMS_SETTINGS_RESOURCE_MANAGER_ADD_RESOURCES_BUTTON')}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tDom.insertBefore(emptyState, container.querySelector('.ui-selector-items'));\n\t}\n\n\t#removeEmptyState(): void\n\t{\n\t\tconst emptyStateEl = this.dialog.getPopup().getContentContainer().querySelector(\n\t\t\t'.crm-forms--booking--resources-manager-empty-state',\n\t\t);\n\t\tremoveElement(emptyStateEl);\n\t}\n\n\t#updateResourcesCount(resourcesCount: number): void\n\t{\n\t\tconst resourcesCountEl = this.dialog.getPopup().getContentContainer().querySelector(\n\t\t\t'.crm-form--booking--resources-manager--header-resources-count',\n\t\t);\n\t\tif (Type.isDomNode(resourcesCountEl))\n\t\t{\n\t\t\tresourcesCountEl.innerText = resourcesCount;\n\t\t}\n\t}\n\n\tasync #loadResources(ids: number[]): Promise<void>\n\t{\n\t\tif (ids.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#setLoadingResources(true);\n\t\tawait resourceStore.ensure(ids);\n\t\tthis.#setLoadingResources(false);\n\t}\n\n\t#addSelectedItems(): void\n\t{\n\t\tthis.dialog.removeItems();\n\n\t\tconst resources: ResourceModel[] = resourceStore.getByIds(this.#resourcesIds);\n\t\tfor (const resource: ResourceModel of resources)\n\t\t{\n\t\t\tthis.dialog.addItem({\n\t\t\t\tid: resource.id,\n\t\t\t\tentityId: EntitySelectorEntity.Resource,\n\t\t\t\ttitle: resource.name,\n\t\t\t\tsubtitle: resource.typeName,\n\t\t\t\ttabs: EntitySelectorTab.Recent,\n\t\t\t});\n\t\t}\n\t}\n\n\t#setLoadingResources(loading: boolean): void\n\t{\n\t\tthis.#loadingResources = loading;\n\t\tif (this.#loadingResources)\n\t\t{\n\t\t\tthis.dialog.showLoader();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.dialog.hideLoader();\n\t\t}\n\t}\n\n\t#setResourceIds(selectedIds: number[]): void\n\t{\n\t\tthis.#resourcesIds = selectedIds;\n\t\tthis.#addSelectedItems();\n\t\tthis.#updateResourcesCount(selectedIds.length);\n\t\tthis.#options.onUpdateResourceIds(selectedIds);\n\n\t\tif (selectedIds.length > 0)\n\t\t{\n\t\t\tthis.#appendSubHeaderContent();\n\t\t\tthis.#removeEmptyState();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#appendEmptyState();\n\t\t\tthis.#removeSubHeadContent();\n\t\t}\n\t}\n\n\t#openResourceSelector(event): void\n\t{\n\t\tconst resourceSelector = new ResourcesSelector({\n\t\t\ttargetNode: event?.target || null,\n\t\t\tselectedIds: this.#resourcesIds,\n\t\t\tonSave: this.#saveResourceSelector.bind(this),\n\t\t\tonClose: this.#closeResourceSelector.bind(this),\n\t\t}).createSelector();\n\t\tthis.dialog.freeze();\n\t\tresourceSelector.show();\n\t}\n\n\tasync #saveResourceSelector({ resourceIds }: { resourceIds: number[] }): void\n\t{\n\t\tawait this.#loadResources(resourceIds);\n\t\tthis.#setResourceIds(resourceIds);\n\t}\n\n\t#closeResourceSelector(): void\n\t{\n\t\tthis.dialog.unfreeze();\n\t}\n\n\t#getHeaderContent(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"w-100 pt-3 px-3\">\n\t\t\t\t<div class=\"d-flex align-items-end w-100\">\n\t\t\t\t\t<h5 class=\"flex-grow-1\">\n\t\t\t\t\t\t${Loc.getMessage('BOOKING_CRM_FORMS_SETTINGS_RESOURCE_MANAGER_HEADER_TITLE')}\n\t\t\t\t\t</h5>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"landing-ui-button-icon-remove\" \n\t\t\t\t\t\trole=\"button\"\n\t\t\t\t\t\ttabindex=\"0\"\n\t\t\t\t\t\tonclick=\"${this.close.bind(this)}\"\n\t\t\t\t\t></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#appendSubHeaderContent(): HTMLElement\n\t{\n\t\tif (this.dialog.getPopup().getPopupContainer().querySelector(`.${subHeaderClassName}`))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst buttonChangeResourcesLabel = Loc.getMessage(\n\t\t\t'BOOKING_CRM_FORMS_SETTINGS_RESOURCE_MANAGER_HEADER_ADD_RESOURCES_BUTTON',\n\t\t\t{\n\t\t\t\t'#PLUS#': '+',\n\t\t\t},\n\t\t);\n\t\tconst buttonDeleteResourcesLabel = Loc.getMessage(\n\t\t\t'BOOKING_CRM_FORMS_SETTINGS_RESOURCE_MANAGER_HEADER_DELETE_RESOURCES_BUTTON',\n\t\t\t{\n\t\t\t\t'#ICON#': 'Ã—',\n\t\t\t},\n\t\t);\n\t\tconst resourcesCount = Loc.getMessage('BOOKING_CRM_FORMS_SETTINGS_RESOURCE_MANAGER_RESOURCES_COUNT', {\n\t\t\t'#COUNT#': `<span class=\"crm-form--booking--resources-manager--header-resources-count\">${this.#resourcesIds.length}</span>`,\n\t\t});\n\n\t\tconst { root, btnDeleteResources, btnChangeResources } = Tag.render`\n\t\t\t<div class=\"${subHeaderClassName} d-flex align-items-center\">\n\t\t\t\t<div class=\"crm-form--booking--resources-manager--header-resources flex-grow-1\">\n\t\t\t\t\t<span class=\"pr-2 crm-form--booking--resources-manager--header-resources-title\">\n\t\t\t\t\t\t${resourcesCount}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<button\n\t\t\t\t\t\tref=\"btnDeleteResources\"\n\t\t\t\t\t\tclass=\"crm-form--booking--resources-manager--header__btn --none btn btn-outline-danger g-btn-size-sm\"\n\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\tonclick=\"${this.#deleteResources.bind(this)}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t${buttonDeleteResourcesLabel}\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\tref=\"btnChangeResources\"\n\t\t\t\t\t\tclass=\"crm-form--booking--resources-manager--header__btn btn btn-primary g-btn-size-sm\"\n\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\tonclick=\"${this.#openResourceSelector.bind(this)}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t${buttonChangeResourcesLabel}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t\tthis.#btnChangeResources = btnChangeResources;\n\t\tthis.#btnDeleteResources = btnDeleteResources;\n\n\t\tconst searchEl = this.dialog.getPopup().getPopupContainer().querySelector('.ui-selector-search');\n\n\t\tDom.insertAfter(root, searchEl);\n\t}\n\n\t#showDeleteButton(): void\n\t{\n\t\tif (Type.isDomNode(this.#btnDeleteResources) && Type.isDomNode(this.#btnChangeResources))\n\t\t{\n\t\t\tDom.addClass(this.#btnChangeResources, '--none');\n\t\t\tDom.removeClass(this.#btnDeleteResources, '--none');\n\t\t}\n\t}\n\n\t#hideDeleteButton(): void\n\t{\n\t\tif (Type.isDomNode(this.#btnDeleteResources) && Type.isDomNode(this.#btnChangeResources))\n\t\t{\n\t\t\tDom.removeClass(this.#btnChangeResources, '--none');\n\t\t\tDom.addClass(this.#btnDeleteResources, '--none');\n\t\t}\n\t}\n\n\t#removeSubHeadContent(): void\n\t{\n\t\tconst subHeadEl = document.querySelector(`.${subHeaderClassName}`);\n\t\tremoveElement(subHeadEl);\n\t}\n}\n\nfunction removeElement(el: any): void\n{\n\tif (Type.isDomNode(el))\n\t{\n\t\tDom.remove(el);\n\t}\n}\n","export class BookingBaseField<T, V>\n{\n\t#field;\n\n\tconstructor(field: T)\n\t{\n\t\tthis.#field = field;\n\t}\n\n\tgetValue(): V\n\t{\n\t\treturn this.#field.getValue();\n\t}\n\n\tsetValue(value: V): void\n\t{\n\t\tthis.#field.setValue(value);\n\t}\n\n\tgetField(): T\n\t{\n\t\treturn this.#field;\n\t}\n\n\tgetLayout(): HTMLElement\n\t{\n\t\treturn this.#field.layout;\n\t}\n}\n","import { Loc, Text, Type } from 'main.core';\nimport { BookingBaseField } from './booking-base-field';\n\nconst DATA_HINT = 'data-hint';\nconst DATA_HINT_NO_ICON = 'data-hint-no-icon';\n\nexport class HasSlotsAllAvailableResourcesField extends BookingBaseField<BX.Landing.UI.Field.Checkbox, boolean>\n{\n\t#disabled: boolean;\n\n\tconstructor(value: boolean, onChange: ?(value: boolean) => void, disabled = false)\n\t{\n\t\tsuper(new BX.Landing.UI.Field.Checkbox({\n\t\t\tselector: 'hasSlotsAllAvailableResources',\n\t\t\tcompact: true,\n\t\t\tmultiple: false,\n\t\t\titems: [],\n\t\t}));\n\n\t\tthis.#addItem(disabled);\n\t\tthis.#disabled = disabled;\n\n\t\tif (Type.isFunction(onChange))\n\t\t{\n\t\t\tthis.getField().subscribe('onChange', () => {\n\t\t\t\tonChange(Boolean(this.getField().getValue()));\n\t\t\t});\n\t\t}\n\n\t\tthis.setValue(value);\n\t}\n\n\t#addItem(disabled = false): void\n\t{\n\t\tconst hintMessage = Loc.getMessage('BOOKING_CRM_FORMS_SETTINGS_SHOW_SLOTS_ALL_AVAILABLE_RESOURCES_HELP_HINT', {\n\t\t\t'#NBSP# ': '&nbsp;',\n\t\t});\n\n\t\tthis.getField().addItem({\n\t\t\tname: Loc.getMessage('BOOKING_CRM_FORMS_SETTINGS_SHOW_SLOTS_ALL_AVAILABLE_RESOURCES'),\n\t\t\thtml: `\n\t\t\t\t${Text.encode(Loc.getMessage('BOOKING_CRM_FORMS_SETTINGS_SHOW_SLOTS_ALL_AVAILABLE_RESOURCES'))}\n\t\t\t\t<span\n\t\t\t\t\tclass=\"landing-ui-form-help booking--crm-forms-settins--show-slots-all-available-resources-help-hint\"\n\t\t\t\t\ttitle=\"\"\n\t\t\t\t\t${DATA_HINT}=\"${hintMessage}\"\n\t\t\t\t\tonclick=\"return false;\"\n\t\t\t\t>\n\t\t\t\t\t<div></div>\n\t\t\t\t</span>\n\t\t\t`,\n\t\t\tvalue: 'hasSlotsAllAvailableResources',\n\t\t\tdisabled,\n\t\t});\n\t}\n\n\tsetValue(value: boolean): void\n\t{\n\t\tsuper.setValue(value ? ['hasSlotsAllAvailableResources'] : false);\n\t}\n\n\t#updateLayoutDataAttrs(layout: HTMLElement): HTMLElement\n\t{\n\t\tif (this.#disabled)\n\t\t{\n\t\t\tlayout.setAttribute(\n\t\t\t\tDATA_HINT,\n\t\t\t\tLoc.getMessage('BOOKING_CRM_FORMS_SETTINGS_SHOW_SLOTS_ALL_AVAILABLE_RESOURCES_DISABLED_HINT'),\n\t\t\t);\n\t\t\tlayout.setAttribute(DATA_HINT_NO_ICON, true);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlayout.removeAttribute(DATA_HINT);\n\t\t\tlayout.removeAttribute(DATA_HINT_NO_ICON);\n\t\t}\n\n\t\treturn layout;\n\t}\n\n\tgetLayout(): HTMLElement\n\t{\n\t\treturn this.#updateLayoutDataAttrs(super.getLayout());\n\t}\n}\n","import { Loc, Type } from 'main.core';\nimport { BookingBaseField } from './booking-base-field';\n\nexport class HintField extends BookingBaseField<BX.Landing.UI.Field.Text, string>\n{\n\tconstructor(value: string, onChange: ?(value: string) => void)\n\t{\n\t\tsuper(new BX.Landing.UI.Field.Text({\n\t\t\ttitle: Loc.getMessage('BOOKING_CRM_FORMS_SETTINGS_HINT_LABEL'),\n\t\t\ttextOnly: true,\n\t\t\tcontent: value,\n\t\t}));\n\n\t\tif (Type.isFunction(onChange))\n\t\t{\n\t\t\tthis.getField().subscribe('onChange', () => onChange(this.getValue() || ''));\n\t\t}\n\n\t\tthis.setValue(value);\n\t}\n\n\tsetValue(value: string): void\n\t{\n\t\tsuper.setValue(value);\n\t}\n}\n","import { Loc, Type } from 'main.core';\nimport { BookingBaseField } from './booking-base-field';\n\nexport class HintVisibilityField extends BookingBaseField<BX.Landing.UI.Field.Checkbox, boolean>\n{\n\tconstructor(value: boolean, onChange: ?(isVisibleHint: boolean) => void)\n\t{\n\t\tsuper(new BX.Landing.UI.Field.Checkbox({\n\t\t\tselector: 'isVisibleHint',\n\t\t\tcompact: true,\n\t\t\tmultiple: false,\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\tname: Loc.getMessage('BOOKING_CRM_FORMS_SETTINGS_IS_VISIBLE_HINT_LABEL'),\n\t\t\t\t\tvalue: 'isVisibleHint',\n\t\t\t\t},\n\t\t\t],\n\t\t}));\n\n\t\tif (Type.isFunction(onChange))\n\t\t{\n\t\t\tthis.getField().subscribe('onChange', () => onChange(Boolean(this.getValue())));\n\t\t}\n\n\t\tthis.setValue(value);\n\t}\n\n\tsetValue(value: boolean): void\n\t{\n\t\tsuper.setValue(value ? ['isVisibleHint'] : false);\n\t}\n}\n","import { Loc, Type } from 'main.core';\nimport { BookingBaseField } from './booking-base-field';\n\nexport class LabelField extends BookingBaseField<BX.Landing.UI.Field.Text, string>\n{\n\tconstructor(value: string, onChange: ?(value: string) => void)\n\t{\n\t\tsuper(new BX.Landing.UI.Field.Text({\n\t\t\ttitle: Loc.getMessage('BOOKING_CRM_FORMS_SETTINGS_FIELD_LABEL'),\n\t\t\ttextOnly: true,\n\t\t\tcontent: value,\n\t\t}));\n\n\t\tif (Type.isFunction(onChange))\n\t\t{\n\t\t\tthis.getField().subscribe('onChange', () => onChange(this.getValue() || ''));\n\t\t}\n\n\t\tthis.setValue(value);\n\t}\n\n\tsetValue(value: string): void\n\t{\n\t\tsuper.setValue(value);\n\t}\n}\n","import { Loc, Type } from 'main.core';\nimport { BookingBaseField } from './booking-base-field';\n\nexport class PlaceholderField extends BookingBaseField<BX.Landing.UI.Field.Text, string>\n{\n\tconstructor(value: string, onChange: ?(value: string) => void)\n\t{\n\t\tsuper(new BX.Landing.UI.Field.Text({\n\t\t\ttitle: Loc.getMessage('BOOKING_CRM_FORMS_SETTINGS_FIELD_PLACEHOLDER'),\n\t\t\ttextOnly: true,\n\t\t\tcontent: value,\n\t\t}));\n\n\t\tif (Type.isFunction(onChange))\n\t\t{\n\t\t\tthis.getField().subscribe('onChange', () => onChange(this.getValue() || ''));\n\t\t}\n\n\t\tthis.setValue(value);\n\t}\n\n\tsetValue(value: string): void\n\t{\n\t\tsuper.setValue(value);\n\t}\n}\n","import { Dom, Loc, Tag, Type } from 'main.core';\nimport { Loader } from 'main.loader';\nimport { EventEmitter } from 'main.core.events';\nimport type { ListItemOptions } from 'landing.ui.component.listitem';\n\nimport { resourceStore } from './services/resource-store';\nimport { BookingSettingsDataModel } from './model/booking-settings-data-model';\nimport { ResourcesManager } from './components/resources-manager/resources-manager';\nimport {\n\tHasSlotsAllAvailableResourcesField,\n\tHintField,\n\tHintVisibilityField,\n\tLabelField,\n\tPlaceholderField,\n} from './components/fields';\nimport type { BookingSettingsData } from './types';\nimport type { ResourceModel } from 'booking.model.resources';\n\ntype BookingSettingsPopupOptions = {\n\tlistItemOptions: ListItemOptions & { sourceOptions: { settingsData: ?BookingSettingsData } },\n\tisAutoSelectionOn: boolean,\n\ttemplateId: string;\n}\n\nexport class BookingSettingsPopup extends EventEmitter\n{\n\t#options: ListItemOptions;\n\t#layout: {\n\t\tlabel: LabelField,\n\t\tplaceholder: PlaceholderField,\n\t\thint: HintField,\n\t\tisVisibleHint: HintVisibilityField,\n\t\thasSlotsAllAvailableResources: HasSlotsAllAvailableResourcesField,\n\t};\n\n\t#bookingSettingsDataModel: BookingSettingsDataModel;\n\t#isAutoSelectionOn: boolean;\n\n\t#resourceLoader: ?Loader = null;\n\t#loadingResources: boolean = false;\n\n\t#resourcesManagerButton: ?HTMLElement = null;\n\n\tconstructor({ listItemOptions, isAutoSelectionOn, templateId }: BookingSettingsPopupOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Booking.CrmForm.BookingSettingsPopup');\n\n\t\tthis.#options = listItemOptions;\n\t\tthis.#isAutoSelectionOn = isAutoSelectionOn;\n\n\t\tthis.#bookingSettingsDataModel = new BookingSettingsDataModel(\n\t\t\tlistItemOptions.sourceOptions.settingsData || {},\n\t\t\tisAutoSelectionOn,\n\t\t\ttemplateId,\n\t\t);\n\n\t\tthis.#initFields(this.#bookingSettingsDataModel.form);\n\t}\n\n\t#initFields(settingsData: Object): void\n\t{\n\t\tconst changeField = (field: { [key: string]: mixed }) => {\n\t\t\tthis.#updateSettings(field);\n\t\t};\n\n\t\tthis.#layout = {};\n\t\tthis.#layout.label = new LabelField(\n\t\t\tsettingsData.label || '',\n\t\t\t(label: string) => changeField({ label }),\n\t\t);\n\t\tthis.#layout.placeholder = new PlaceholderField(\n\t\t\tsettingsData.textHeader || '',\n\t\t\t(textHeader: string) => changeField({ textHeader }),\n\t\t);\n\t\tthis.#layout.hint = new HintField(\n\t\t\tsettingsData.hint || '',\n\t\t\t(hint: string) => changeField({ hint }),\n\t\t);\n\t\tthis.#layout.isVisibleHint = new HintVisibilityField(\n\t\t\tBoolean(settingsData?.isVisibleHint),\n\t\t\t(isVisibleHint) => changeField({ isVisibleHint }),\n\t\t);\n\t\tthis.#layout.hasSlotsAllAvailableResources = new HasSlotsAllAvailableResourcesField(\n\t\t\tBoolean(settingsData?.hasSlotsAllAvailableResources),\n\t\t\t(hasSlotsAllAvailableResources) => changeField({ hasSlotsAllAvailableResources }),\n\t\t\tthis.#isAutoSelectionOn,\n\t\t);\n\t}\n\n\tasync show(): void\n\t{\n\t\tawait this.#loadResources(this.#getResourceIds());\n\n\t\tconst container = this.#getBodyContainer();\n\n\t\tDom.append(this.#renderContent(), container);\n\t\tBX.UI.Hint.init(container);\n\t\tthis.#updateResourcesCounter();\n\t\tDom.style(container, 'display', 'block');\n\t}\n\n\tasync #loadResources(ids: number): Promise<void>\n\t{\n\t\tif (ids.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#setLoadingResources(true);\n\n\t\tawait resourceStore.ensure(this.#getResourceIds());\n\t\tthis.#setResourceIds(this.#filterAvailableResourceIds(ids));\n\n\t\tthis.#setLoadingResources(false);\n\t}\n\n\t#setLoadingResources(loading: boolean): void\n\t{\n\t\tconst container = this.#getHeaderContainer();\n\n\t\tthis.#loadingResources = loading;\n\t\tif (this.#loadingResources)\n\t\t{\n\t\t\tthis.#resourceLoader ??= new Loader({ size: 40 });\n\n\t\t\tDom.style(container, 'opacity', 0.8);\n\t\t\tvoid this.#resourceLoader.show(container);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.style(container, 'opacity', 1);\n\t\t\tvoid this.#resourceLoader.hide();\n\t\t}\n\t}\n\n\t#filterAvailableResourceIds(ids: number[]): number[]\n\t{\n\t\tconst availableResources: ResourceModel[] = resourceStore.getAll();\n\t\tconst availableResourceIds: Set<number> = new Set(\n\t\t\tavailableResources.map((resource: ResourceModel): number => resource.id),\n\t\t);\n\n\t\treturn ids.filter((id: number) => availableResourceIds.has(id));\n\t}\n\n\tclose(): void\n\t{\n\t\tconst container = this.#getBodyContainer();\n\t\tthis.emit('onClose');\n\n\t\tDom.style(container, 'display', 'none');\n\t\tDom.clean(container);\n\t}\n\n\tgetSettings(): Object\n\t{\n\t\tthis.#updateSettings();\n\n\t\treturn this.#options.sourceOptions.settingsData;\n\t}\n\n\t#getHeaderContainer(): HTMLElement\n\t{\n\t\treturn document.querySelector(`.landing-ui-component-list-item[data-id=\"${this.#options.id}\"] .landing-ui-component-list-item-header`);\n\t}\n\n\t#getBodyContainer(): HTMLElement\n\t{\n\t\treturn document.querySelector(`.landing-ui-component-list-item[data-id=\"${this.#options.id}\"] .landing-ui-component-list-item-body`);\n\t}\n\n\t#renderContent(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"landing-ui-form landing-ui-form-form-settings booking-crm-forms-settings\">\n\t\t\t\t<div class=\"landing-ui-form-description\"></div>\n\t\t\t\t${this.#renderResource()}\n\t\t\t\t${this.#renderLabelField()}\n\t\t\t\t${this.#renderPlaceholderField()}\n\t\t\t\t${this.#renderHintField()}\n\t\t\t\t${this.#renderIsVisibleHint()}\n\t\t\t\t${this.#renderHasSlotsAllAvailableResources()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#renderResource(): HTMLElement\n\t{\n\t\tthis.#resourcesManagerButton = Tag.render`\n\t\t\t<button\n\t\t\t\tid=\"booking--crm-forms--resource-manager-button\"\n\t\t\t\ttype=\"button\"\n\t\t\t\tclass=\"btn btn-primary g-btn-size-l\"\n\t\t\t\tonclick=\"${this.#showResourcesManager.bind(this)}\"\n\t\t\t>\n\t\t\t\t${this.#getResourceIds().length > 0\n\t\t\t? Loc.getMessage('BOOKING_CRM_FORMS_SETTINGS_RESOURCES_FIELD_CHANGE_BUTTON')\n\t\t\t: Loc.getMessage('BOOKING_CRM_FORMS_SETTINGS_RESOURCES_FIELD_ADD_BUTTON')\n\t\t}\n\t\t\t</button>\n\t\t`;\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"landing-ui-field d-flex\">\n\t\t\t\t<div class=\"flex-grow-1\">\n\t\t\t\t\t<div class=\"g-line-height-1_7 g-font-size-18 g-font-weight-500 g-color-gray-dark-v2\">\n\t\t\t\t\t\t${Loc.getMessage('BOOKING_CRM_FORMS_SETTINGS_RESOURCES_FIELD_LABEL')}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"crm-form--booking-resources-count\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div style=\"align-self: flex-end\">\n\t\t\t\t\t${this.#resourcesManagerButton}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#showResourcesManager(): void\n\t{\n\t\tconst resourcesManager = new ResourcesManager({\n\t\t\ttarget: this.#resourcesManagerButton,\n\t\t\tselectedIds: this.#getResourceIds(),\n\t\t\tonUpdateResourceIds: (resourceIds: number[]) => {\n\t\t\t\tthis.#setResourceIds(resourceIds);\n\t\t\t\tthis.#updateSettings();\n\t\t\t\tthis.#updateResourcesCounter();\n\t\t\t\tthis.#updateResourceManagerButton();\n\t\t\t},\n\t\t});\n\t\tresourcesManager.show();\n\t}\n\n\t#getResourceIds(): number[]\n\t{\n\t\treturn this.#bookingSettingsDataModel.form.resourceIds;\n\t}\n\n\t#setResourceIds(resourceIds: number[] | mixin): void\n\t{\n\t\tthis.#bookingSettingsDataModel.setSettingsData({\n\t\t\tresourceIds: Type.isArray(resourceIds) ? resourceIds : [],\n\t\t});\n\t\tthis.#updateSettings();\n\t}\n\n\t#updateResourcesCounter(): void\n\t{\n\t\tconst counterEl = this.#getBodyContainer().querySelector('.crm-form--booking-resources-count');\n\n\t\tif (Type.isDomNode(counterEl))\n\t\t{\n\t\t\tcounterEl.innerText = this.#getResourceIds().length > 0\n\t\t\t\t? Loc.getMessage('BOOKING_CRM_FORMS_SETTINGS_RESOURCES_FIELD_TEXT', {\n\t\t\t\t\t'#COUNT#': this.#getResourceIds().length,\n\t\t\t\t})\n\t\t\t\t: Loc.getMessage('BOOKING_CRM_FORMS_SETTINGS_RESOURCES_FIELD_EMPTY');\n\t\t}\n\t}\n\n\t#updateResourceManagerButton(): void\n\t{\n\t\tif (Type.isDomNode(this.#resourcesManagerButton))\n\t\t{\n\t\t\tthis.#resourcesManagerButton.innerText = this.#getResourceIds().length > 0\n\t\t\t\t? Loc.getMessage('BOOKING_CRM_FORMS_SETTINGS_RESOURCES_FIELD_CHANGE_BUTTON')\n\t\t\t\t: Loc.getMessage('BOOKING_CRM_FORMS_SETTINGS_RESOURCES_FIELD_ADD_BUTTON');\n\t\t}\n\t}\n\n\t#renderLabelField(): HTMLElement\n\t{\n\t\treturn this.#layout.label.getLayout();\n\t}\n\n\t#renderPlaceholderField(): HTMLElement\n\t{\n\t\treturn this.#layout.placeholder.getLayout();\n\t}\n\n\t#renderHintField(): HTMLElement\n\t{\n\t\tif (this.#isAutoSelectionOn && !this.#bookingSettingsDataModel.form.hint)\n\t\t{\n\t\t\tthis.#layout.hint.setValue(\n\t\t\t\tLoc.getMessage('BOOKING_CRM_FORMS_SETTINGS_HINT_DEFAULT_VALUE'),\n\t\t\t);\n\t\t}\n\n\t\treturn this.#layout.hint.getLayout();\n\t}\n\n\t#renderIsVisibleHint(): HTMLElement\n\t{\n\t\treturn this.#layout.isVisibleHint.getLayout();\n\t}\n\n\t#renderHasSlotsAllAvailableResources(): HTMLElement | string\n\t{\n\t\treturn this.#layout.hasSlotsAllAvailableResources.getLayout();\n\t}\n\n\t#updateSettings(settings = null): void\n\t{\n\t\tthis.#bookingSettingsDataModel.setSettingsData(settings);\n\n\t\tthis.#options.sourceOptions.settingsData = {\n\t\t\t...this.#options.sourceOptions.settingsData,\n\t\t\tisAutoSelectionOn: this.#isAutoSelectionOn,\n\t\t\t...this.#bookingSettingsDataModel.settingsData,\n\t\t};\n\n\t\tthis.emit('onChange');\n\t\tthis.#options.form.emit('onChange');\n\t}\n}\n","import { Dom, Extension, Runtime } from 'main.core';\nimport type { ListItemOptions } from 'landing.ui.component.listitem';\n\nimport { BookingSettingsPopup } from './booking-settings-popup';\nimport type { FormOptions } from './types';\n\nexport class Settings\n{\n\t#isAutoSelectionOn: boolean;\n\t#options: ListItemOptions;\n\n\tsettingsPopup: BookingSettingsPopup;\n\n\tconstructor(listItemOptions: ListItemOptions, formOptions: FormOptions = {})\n\t{\n\t\tthis.#options = listItemOptions;\n\t\tthis.#isAutoSelectionOn = Boolean(formOptions?.bookingResourceAutoSelection?.use);\n\n\t\tthis.settingsPopup = new BookingSettingsPopup({\n\t\t\tlistItemOptions,\n\t\t\tisAutoSelectionOn: this.#isAutoSelectionOn,\n\t\t\ttemplateId: formOptions?.templateId,\n\t\t});\n\t}\n\n\tgetSettings(): Object\n\t{\n\t\treturn this.settingsPopup.getSettings();\n\t}\n\n\tshowSettingsPopup(): void\n\t{\n\t\tconst isToolDisabled = Extension.getSettings('booking.crm-forms.settings').isToolDisabled;\n\t\tif (isToolDisabled)\n\t\t{\n\t\t\tRuntime.loadExtension('ui.info-helper')\n\t\t\t\t.then(({ InfoHelper }) => {\n\t\t\t\t\tInfoHelper.show('limit_v2_booking_off');\n\t\t\t\t})\n\t\t\t\t.catch((err) => {\n\t\t\t\t\tconsole.error(err);\n\t\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst container = document.querySelector(`.landing-ui-component-list-item[data-id=\"${this.#options.id}\"] .landing-ui-component-list-item-body`);\n\n\t\tif (Dom.style(container, 'display') === 'block')\n\t\t{\n\t\t\tthis.settingsPopup.close();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.settingsPopup.show();\n\t\t}\n\t}\n}\n"],"names":["ResourceStore","Map","ensure","ids","length","needToLoadIds","filter","id","loaded","crmFormService","getResources","resource","set","getByIds","map","get","Boolean","getAll","values","has","resourceStore","defaultBookingForm","resourceIds","label","Loc","getMessage","isVisibleHint","hint","hasSlotsAllAvailableResources","defaultBookingDefaultForm","textHeader","defaultBookingAutoSelectionForm","BookingSettingsDataModel","constructor","settingsData","isAutoSelectionOn","templateId","autoSelectionData","CrmFormSettingsDataPropName","autoSelection","defaultData","default","dataSettingsProperty","setSettingsData","patch","Object","assign","form","CrmFormTemplateId","BookingAnyResource","ContentHeader","BaseHeader","props","getContainer","render","options","content","ResourceSelectorDialogFooter","BaseFooter","tab","onClose","onSave","getDialog","subscribe","bind","footer","footerAddButton","footerCloseButton","Tag","Event","resourcesCount","destroyDialog","unbindAll","destroy","resources","dialog","getSelectedItems","Type","isFunction","hide","event","item","getData","isSelected","ResourcesSelector","targetNode","selectedIds","createSelector","Dialog","preselectedItems","EntitySelectorEntity","Resource","width","enableSearch","dropdownMode","context","multiple","cacheable","showAvatars","footerOptions","entities","dynamicLoad","dynamicSearch","searchOptions","allowCreateItem","popupOptions","overlay","opacity","events","onHide","onLoad","getSelectedIds","subHeaderClassName","ResourcesManager","target","show","renderInitialContent","document","adjustPosition","close","onUpdateResourceIds","unbind","selectedResources","height","Math","max","window","innerHeight","offsetLeft","offsetWidth","offsetTop","addTagOnSelect","focusOnFirst","header","headerOptions","className","angle","position","tagSelectorOptions","textBoxWidth","placeholder","removeItems","push","includes","container","getPopup","getContentContainer","isDomNode","querySelector","emptyState","Dom","insertBefore","emptyStateEl","removeElement","resourcesCountEl","innerText","addItem","entityId","title","name","subtitle","typeName","tabs","EntitySelectorTab","Recent","loading","showLoader","hideLoader","resourceSelector","freeze","unfreeze","getPopupContainer","buttonChangeResourcesLabel","buttonDeleteResourcesLabel","root","btnDeleteResources","btnChangeResources","searchEl","insertAfter","addClass","removeClass","subHeadEl","el","remove","BookingBaseField","field","getValue","setValue","value","getField","getLayout","layout","DATA_HINT","DATA_HINT_NO_ICON","HasSlotsAllAvailableResourcesField","onChange","disabled","BX","Landing","UI","Field","Checkbox","selector","compact","items","hintMessage","html","Text","encode","setAttribute","removeAttribute","HintField","textOnly","HintVisibilityField","LabelField","PlaceholderField","BookingSettingsPopup","EventEmitter","listItemOptions","setEventNamespace","sourceOptions","append","Hint","init","style","emit","clean","getSettings","changeField","Loader","size","availableResources","availableResourceIds","Set","resourcesManager","isArray","counterEl","settings","Settings","formOptions","bookingResourceAutoSelection","use","settingsPopup","showSettingsPopup","isToolDisabled","Extension","Runtime","loadExtension","then","InfoHelper","catch","err","console","error"],"mappings":"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"}