{"version":3,"file":"field.bundle.js","sources":["../src/const/const.js","../src/lib/mappers.js","../src/occupancy.js","../src/components/resource-select-block/resource-selector.js","../src/components/resource-select-block/resource-select-block.js","../src/components/calendar-block/calendar-block.js","../src/components/resource-slots-ui-block/resource-slots-ui-block.js","../src/components/time-selector-block/time-selector-block.js","../src/components/available-slots-block/available-slots-block.js","../src/field.js"],"sourcesContent":["import type { Resource } from '../types';\n\nexport const ALL_RESOURCES_ID = -1;\n\nexport const AllResource: Resource = {\n\tid: ALL_RESOURCES_ID,\n\tname: '',\n\ttypeName: '',\n\tslotRanges: [],\n};\n\nexport const DayIndexDict = Object.freeze({\n\tSun: 0,\n\tMon: 1,\n\tTue: 2,\n\tWed: 3,\n\tThu: 4,\n\tFri: 5,\n\tSat: 6,\n});\n","import { DayIndexDict } from '../const/const';\nimport type { Resource } from '../types';\n\nexport function mapDtoToResource(resourcesDto: ResourceDto[]): Resource[]\n{\n\treturn resourcesDto.map((dto) => {\n\t\treturn {\n\t\t\t...dto,\n\t\t\tslotRanges: dto.slotRanges.map((slotRange) => {\n\t\t\t\treturn {\n\t\t\t\t\t...slotRange,\n\t\t\t\t\tweekDays: slotRange.weekDays.map((weekDay) => DayIndexDict[weekDay]),\n\t\t\t\t};\n\t\t\t}),\n\t\t};\n\t});\n}\n\ntype ResourceDto = {\n\tid: number,\n\tname: string,\n\ttypeName: string,\n\tslotRanges: {\n\t\tid: number,\n\t\tfrom: number,\n\t\tto: number,\n\t\ttimezone: string,\n\t\tweekDays: string[],\n\t\tslotSize: number,\n\t}[];\n}\n","import { DateTimeFormat } from 'main.date';\n\nimport { DateFormat } from 'booking.const';\nimport { Segments } from 'booking.lib.segments';\nimport { SlotRanges } from 'booking.lib.slot-ranges';\n\nimport type { ResourceSlot, SlotRange } from './types';\n\ntype OccupancyItem = {\n\tfromTs: number,\n\ttoTs: number,\n\tresourcesIds: ?number[],\n};\n\nlet occupancyInstance: Occupancy | null = null;\n\nexport function createOccupancy(runAction: function): Occupancy\n{\n\tif (occupancyInstance instanceof Occupancy)\n\t{\n\t\treturn occupancyInstance;\n\t}\n\n\toccupancyInstance = new Occupancy(runAction);\n\n\treturn occupancyInstance;\n}\n\nexport class Occupancy\n{\n\t#runAction: function = () => {};\n\t#timezone: string;\n\t#resources: { id: number, slotRanges: SlotRange[] }[];\n\t#requestCache: { [dateTs: number]: { [resourceId: number]: Promise } } = {};\n\t#requestedResourcesIds: { [dateTs: number]: Set } = {};\n\t#occupancy: { [dateTs: number]: { [resourceId: number]: OccupancyItem[] } } = {};\n\n\tconstructor(runAction: function)\n\t{\n\t\tthis.#runAction = runAction;\n\t}\n\n\tsetResources(resources): this\n\t{\n\t\tthis.#resources = resources;\n\n\t\treturn this;\n\t}\n\n\tsetTimezone(timezone: string): this\n\t{\n\t\tthis.#timezone = timezone;\n\n\t\treturn this;\n\t}\n\n\tasync getOccupancy(ids: number[], dateTs: number): Promise<OccupancyItem[]>\n\t{\n\t\tconst requestedResourcesIds = this.#requestedResourcesIds[dateTs];\n\t\tconst unrequestedResourcesIds = ids.filter((id: number) => !requestedResourcesIds?.has(id));\n\n\t\tif (unrequestedResourcesIds.length > 0)\n\t\t{\n\t\t\tconst request = this.#requestOccupancy(unrequestedResourcesIds, dateTs);\n\n\t\t\tthis.#requestCache[dateTs] ??= {};\n\t\t\tunrequestedResourcesIds.forEach((resourceId: number) => {\n\t\t\t\tthis.#requestCache[dateTs][resourceId] = request;\n\t\t\t});\n\t\t}\n\n\t\tawait Promise.all(this.#getPromises(ids, dateTs));\n\n\t\treturn this.#calculateOccupancy(ids, dateTs);\n\t}\n\n\tasync #requestOccupancy(ids: number[], dateTs: number): Promise<void>\n\t{\n\t\tthis.#occupancy[dateTs] ??= {};\n\t\tthis.#requestedResourcesIds[dateTs] ??= new Set();\n\t\tids.forEach((resourceId: number) => {\n\t\t\tthis.#occupancy[dateTs][resourceId] ??= [];\n\t\t\tthis.#requestedResourcesIds[dateTs].add(resourceId);\n\t\t});\n\n\t\tconst { data: occupancy } = await this.#runAction('booking.api_v1.CrmForm.getOccupancy', {\n\t\t\tdata: {\n\t\t\t\tids,\n\t\t\t\tdateTs: dateTs / 1000,\n\t\t\t},\n\t\t});\n\n\t\toccupancy.forEach(({ resourcesIds, fromTs, toTs }) => {\n\t\t\tresourcesIds.forEach((resourceId: number) => {\n\t\t\t\tthis.#occupancy[dateTs][resourceId]?.push({ fromTs, toTs, resourcesIds });\n\t\t\t});\n\t\t});\n\t}\n\n\t#getPromises(ids: number[], dateTs: number): Promise[]\n\t{\n\t\treturn Object.keys(this.#requestCache[dateTs])\n\t\t\t.filter((resourceId: string) => ids.includes(Number(resourceId)))\n\t\t\t.map((resourceId: string) => this.#requestCache[dateTs][resourceId]);\n\t}\n\n\t#calculateOccupancy(resourcesIds: number[], dateTs: number): OccupancyItem[]\n\t{\n\t\tconst segments = new Segments([[dateTs, new Date(dateTs).setDate(new Date(dateTs).getDate() + 1)]]);\n\t\tconst resource = this.#resources.find(({ id }) => id === resourcesIds[0]);\n\t\tconst selectedWeekDay = DateFormat.WeekDays[new Date(dateTs).getDay()];\n\n\t\tSlotRanges\n\t\t\t.applyTimezone(resource.slotRanges, dateTs, this.#timezone)\n\t\t\t.filter((slotRange: SlotRange) => slotRange.weekDays.includes(selectedWeekDay))\n\t\t\t.forEach((slotRange: SlotRange) => segments.subtract([\n\t\t\t\tnew Date(dateTs).setMinutes(slotRange.from),\n\t\t\t\tnew Date(dateTs).setMinutes(slotRange.to),\n\t\t\t]))\n\t\t;\n\n\t\treturn resourcesIds\n\t\t\t.flatMap((resourceId: number) => this.#occupancy[dateTs][resourceId])\n\t\t\t.map(({ fromTs, toTs, resourcesIds: slotResourcesIds }) => {\n\t\t\t\treturn {\n\t\t\t\t\tfromTs: fromTs * 1000,\n\t\t\t\t\ttoTs: toTs * 1000,\n\t\t\t\t\tresourcesIds: slotResourcesIds,\n\t\t\t\t};\n\t\t\t});\n\t}\n\n\tstatic calcResourceSlots({\n\t\tdate,\n\t\tslotRanges,\n\t\tresourceOccupancy,\n\t\tresourceId = null,\n\t\ttimezone,\n\t}: CalcResourceSlotsOptions): ResourceSlot[]\n\t{\n\t\tconst slots: ResourceSlot[] = [];\n\t\tconst now = Date.now();\n\n\t\tSlotRanges\n\t\t\t.applyTimezone(slotRanges, date.getTime(), timezone)\n\t\t\t.filter((slotRange) => slotRange.weekDays.includes(date.getDay()))\n\t\t\t.sort((a, b) => a.from - b.from)\n\t\t\t.forEach((slotRange) => {\n\t\t\t\tconst slotSizeTs = slotRange.slotSize * 60 * 1000;\n\t\t\t\tconst slotToTs = convertMinToTs(date, slotRange.to);\n\t\t\t\tconst step = slotRange.slotSize <= 120 ? 30 : 60;\n\t\t\t\tconst stepTs = step * 60 * 1000;\n\n\t\t\t\tconst occupancies = resourceId === null\n\t\t\t\t\t? resourceOccupancy\n\t\t\t\t\t: resourceOccupancy.filter(({ resourcesIds }) => resourcesIds.includes(resourceId));\n\n\t\t\t\tlet fromTs = convertMinToTs(date, slotRange.from);\n\t\t\t\tif (fromTs < now)\n\t\t\t\t{\n\t\t\t\t\tfromTs = roundSlotStart(fromTs, step);\n\t\t\t\t}\n\n\t\t\t\twhile (fromTs < slotToTs)\n\t\t\t\t{\n\t\t\t\t\tconst toTs = fromTs + slotSizeTs;\n\n\t\t\t\t\tif (fromTs <= now || toTs > slotToTs || checkIsOccupiedSlot({ fromTs, toTs }, occupancies))\n\t\t\t\t\t{\n\t\t\t\t\t\tfromTs += stepTs;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tslots.push({\n\t\t\t\t\t\tfromTs,\n\t\t\t\t\t\ttoTs,\n\t\t\t\t\t\tlabel: DateTimeFormat.format('H:i', new Date(fromTs)),\n\t\t\t\t\t});\n\t\t\t\t\tfromTs += stepTs;\n\t\t\t\t}\n\t\t\t});\n\n\t\treturn slots;\n\t}\n}\n\nfunction roundSlotStart(slotStartTs: number, step: number): number\n{\n\tconst date = new Date(slotStartTs);\n\tdate.setMinutes((step - date.getMinutes() > 3) ? step : step * 2);\n\n\treturn date.getTime();\n}\n\nfunction convertMinToTs(date: Date, min: number): number\n{\n\tconst d = new Date(date);\n\td.setHours(0, 0, 0, 0);\n\td.setMinutes(min);\n\n\treturn d.getTime();\n}\n\nfunction checkIsOccupiedSlot(slot: { fromTs: number, toTs: number }, resourceOccupancy: OccupancyItem[]): boolean\n{\n\treturn resourceOccupancy.some((occupancy) => {\n\t\treturn (\n\t\t\t(slot.fromTs >= occupancy.fromTs && slot.fromTs < occupancy.toTs)\n\t\t\t|| (slot.toTs > occupancy.fromTs && slot.toTs <= occupancy.toTs)\n\t\t);\n\t});\n}\n\ntype CalcResourceSlotsOptions = {\n\tdate: Date,\n\tresourceOccupancy: OccupancyItem;\n\tslotRanges: SlotRange[];\n\tresourceId: ?number;\n\ttimezone: string;\n}\n","import './resource-selector.css';\n\n// @vue/component\nexport const ResourceSelector = {\n\tname: 'ResourceSelector',\n\tprops: {\n\t\tresources: {\n\t\t\ttype: Array,\n\t\t\tdefault: () => [],\n\t\t},\n\t},\n\temits: ['select'],\n\ttemplate: `\n\t\t<div class=\"booking--crm-forms--resource-selector\">\n\t\t\t<div\n\t\t\t\tv-for=\"(resource) in resources\"\n\t\t\t\t:key=\"resource.id\"\n\t\t\t\tclass=\"b24-form-control-list-selector-item booking--crm-forms--resource-selector-resource\"\n\t\t\t\t@click=\"$emit('select', resource)\"\n\t\t\t>\n\t\t\t\t<div>\n\t\t\t\t\t<div class=\"booking--crm-forms--time-selector-block-resource-name\">\n\t\t\t\t\t\t{{ resource.name }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"booking--crm-forms--time-selector-block-resource-type-name\">\n\t\t\t\t\t\t{{ resource.typeName }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { ResourceSelector } from './resource-selector';\n// eslint-disable-next-line no-unused-vars\nimport type { Resource } from '../../types';\n\n// @vue/component\nexport const ResourceSelectBlock = {\n\tname: 'ResourceSelectBlock',\n\tcomponents: {\n\t\tResourceSelector,\n\t},\n\tprops: {\n\t\tresourceId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\t/**\n\t\t * @type {Resource[]}\n\t\t */\n\t\tresources: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tsettingsData: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tfetching: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\terrorMessage: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\thasErrors: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tdependencies: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['update:resourceId'],\n\tdata(): { dropdownOpened: false }\n\t{\n\t\treturn {\n\t\t\tdropdownOpened: false,\n\t\t};\n\t},\n\tcomputed: {\n\t\tlabel(): string\n\t\t{\n\t\t\treturn this.settingsData?.label || '';\n\t\t},\n\t\tplaceholder(): string\n\t\t{\n\t\t\treturn `${this.settingsData?.textHeader || ''} *`;\n\t\t},\n\t\tresource(): Object\n\t\t{\n\t\t\treturn this.resources.find((resource) => resource.id === this.resourceId);\n\t\t},\n\t\tresourceName(): string\n\t\t{\n\t\t\treturn this.resource?.name || '';\n\t\t},\n\t\thint(): { visible: boolean, text: string }\n\t\t{\n\t\t\treturn {\n\t\t\t\ttext: this.settingsData?.hint || '',\n\t\t\t\tvisible: Boolean(this.settingsData?.isVisibleHint),\n\t\t\t};\n\t\t},\n\t\tfieldItemDropdownComponent(): Object\n\t\t{\n\t\t\treturn this.dependencies.mixinDropdown.components['field-item-dropdown'];\n\t\t},\n\t},\n\tmethods: {\n\t\ttoggleDropdown()\n\t\t{\n\t\t\tif (this.dropdownOpened)\n\t\t\t{\n\t\t\t\tthis.closeDropdown();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.fetching)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.dropdownOpened = true;\n\t\t},\n\t\tcloseDropdown()\n\t\t{\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.dropdownOpened = false;\n\t\t\t}, 0);\n\t\t},\n\t\tsetResource(resource): void\n\t\t{\n\t\t\tthis.$emit('update:resourceId', resource.id);\n\n\t\t\tif (this.dropdownOpened)\n\t\t\t{\n\t\t\t\tthis.closeDropdown();\n\t\t\t}\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"booking-crm-forms-field\"\n\t\t\t:class=\"{\n\t\t\t\t'--error': hasErrors,\n\t\t\t}\"\n\t\t>\n\t\t\t<div class=\"b24-form-field-layout-section booking-crm-forms-field-title\">\n\t\t\t\t{{ label }}\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tref=\"tagSelector\"\n\t\t\t\tclass=\"booking-crm-forms-field-tag-selector b24-form-control-string\"\n\t\t\t\t:class=\"{\n\t\t\t\t\t'--disabled': fetching,\n\t\t\t\t}\"\n\t\t\t>\n\t\t\t\t<div\n\t\t\t\t\tclass=\"b24-form-control-container b24-form-control-icon-after\"\n\t\t\t\t\t@click=\"toggleDropdown\"\n\t\t\t\t>\n\t\t\t\t\t<input\n\t\t\t\t\t\tname=\"resourceName\"\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\treadonly\n\t\t\t\t\t\t:placeholder=\"placeholder\"\n\t\t\t\t\t\t:value=\"resourceName\"\n\t\t\t\t\t\tclass=\"b24-form-control booking--crm-forms--field-tag-selector-input\"\n\t\t\t\t\t\t@click.capture.stop.prevent=\"toggleDropdown\"\n\t\t\t\t\t/>\n\t\t\t\t\t<div class=\"booking--crm-forms--field-tag-selector-input-icon\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"b24-form-control-alert-message\" style=\"top: 75px\">{{ errorMessage }}</div>\n\t\t\t<component\n\t\t\t\tv-if=\"dropdownOpened\"\n\t\t\t\t:is=\"fieldItemDropdownComponent\"\n\t\t\t\t:marginTop=\"0\"\n\t\t\t\t:visible=\"dropdownOpened\"\n\t\t\t\t:title=\"label\"\n\t\t\t\t@close=\"closeDropdown()\"\n\t\t\t>\n\t\t\t\t<ResourceSelector :resources=\"resources\" @select=\"setResource\"/>\n\t\t\t</component>\n\t\t\t<div v-if=\"hint.visible\" class=\"booking--crm-forms--field-hint\">\n\t\t\t\t<div class=\"booking--crm-forms--field-hint-text\">{{ hint.text }}</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { DateTimeFormat } from 'main.date';\nimport { DatePicker, DatePickerEvent, getNextDate } from 'ui.date-picker';\n\nimport { locMixin } from 'booking.component.mixin.loc-mixin';\n\nimport './calendar-block.css';\n\n// @vue/component\nexport const CalendarBlock = {\n\tname: 'CalendarBlock',\n\tmixins: [locMixin],\n\tprops: {\n\t\tdate: {\n\t\t\ttype: Date,\n\t\t\tdefault: null,\n\t\t},\n\t\tresource: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\ttitleOnly: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\thasError: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\terrorMessage: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\temits: ['updateDate'],\n\tdata(): { viewDate: Date | null, disabledPrevMonth: boolean }\n\t{\n\t\treturn {\n\t\t\tviewDate: null,\n\t\t\tdisabledPrevMonth: true,\n\t\t};\n\t},\n\tcomputed: {\n\t\tformattedViewDate(): string\n\t\t{\n\t\t\treturn DateTimeFormat.format('f Y', this.viewDate);\n\t\t},\n\t\ttitle(): string\n\t\t{\n\t\t\tif (this.date !== null && this.titleOnly)\n\t\t\t{\n\t\t\t\treturn this.loc('BOOKING_CRM_FORMS_FIELD_TIME_TITLE', {\n\t\t\t\t\t'#DATE#': DateTimeFormat.format(this.loc('DAY_MONTH_FORMAT'), this.date),\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn this.loc('BOOKING_CRM_FORMS_FIELD_DATE_TIME_TITLE');\n\t\t},\n\t},\n\tcreated(): void\n\t{\n\t\tthis.viewDate = this.date;\n\t\tconst selectedDates = this.date instanceof Date\n\t\t\t? [this.date.getTime()]\n\t\t\t: [];\n\n\t\tthis.datePicker = new DatePicker({\n\t\t\tselectedDates,\n\t\t\tstartDate: new Date(),\n\t\t\tinline: true,\n\t\t\thideHeader: true,\n\t\t});\n\n\t\tthis.datePicker.subscribe(DatePickerEvent.SELECT, (event) => {\n\t\t\tconst date = event.getData().date;\n\t\t\tconst selectedDate = this.toDateFromUtc(date);\n\t\t\tthis.setViewDate();\n\n\t\t\tif (selectedDate !== this.date)\n\t\t\t{\n\t\t\t\tthis.$emit('updateDate', selectedDate);\n\t\t\t}\n\t\t});\n\t},\n\tmounted(): void\n\t{\n\t\tthis.datePicker.setTargetNode(this.$refs.datePicker);\n\t\tthis.datePicker.show();\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tthis.datePicker.destroy();\n\t},\n\tmethods: {\n\t\tsetPreviousMonth(): void\n\t\t{\n\t\t\tconst viewDate = this.datePicker.getViewDate();\n\n\t\t\tif (viewDate.getMonth() === (new Date()).getMonth())\n\t\t\t{\n\t\t\t\tthis.updateDisabledPrevMonth();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.datePicker.setViewDate(getNextDate(viewDate, 'month', -1));\n\t\t\tthis.setViewDate();\n\t\t},\n\t\tsetNextMonth(): void\n\t\t{\n\t\t\tconst viewDate = this.datePicker.getViewDate();\n\n\t\t\tthis.updateDisabledPrevMonth();\n\t\t\tthis.datePicker.setViewDate(getNextDate(viewDate, 'month'));\n\t\t\tthis.setViewDate();\n\t\t},\n\t\tsetViewDate(): void\n\t\t{\n\t\t\tthis.viewDate = this.toDateFromUtc(this.datePicker.getViewDate());\n\t\t\tthis.updateDisabledPrevMonth();\n\t\t},\n\t\ttoDateFromUtc(date: Date): Date\n\t\t{\n\t\t\treturn new Date(date.getUTCFullYear(), date.getUTCMonth(), date.getUTCDate());\n\t\t},\n\t\tupdateDisabledPrevMonth(): void\n\t\t{\n\t\t\tconst viewDate = this.datePicker.getViewDate();\n\t\t\tthis.disabledPrevMonth = viewDate.getMonth() <= (new Date()).getMonth();\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"booking-crm-forms-field booking--crm-forms--calendar-block\"\n\t\t\t:class=\"{\n\t\t\t\t'--error': hasError,\n\t\t\t}\"\n\t\t>\n\t\t\t<div class=\"b24-form-field-layout-section booking-crm-forms-field-title\">{{ title }}</div>\n\t\t\t<div\n\t\t\t\tv-if=\"hasError\"\n\t\t\t\tclass=\"b24-form-control-alert-message\"\n\t\t\t\tstyle=\"top: 30px\"\n\t\t\t>\n\t\t\t\t{{ errorMessage }}\n\t\t\t</div>\n\t\t\t<div v-show=\"!titleOnly\" class=\"booking--crm-forms--calendar-block-content\">\n\t\t\t\t<div class=\"booking--crm-forms--calendar-block-datepicker-header\">\n\t\t\t\t\t<div class=\"booking--crm-forms--calendar-block-datepicker-header-title\">\n\t\t\t\t\t\t{{ formattedViewDate }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"booking--crm-forms--calendar-block-datepicker-header-button --left\"\n\t\t\t\t\t\t:class=\"{ '--disabled': disabledPrevMonth }\"\n\t\t\t\t\t\t@click=\"setPreviousMonth\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"booking--crm-forms--calendar-block-datepicker-icon --chevron-left\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"booking--crm-forms--calendar-block-datepicker-header-button --right\"\n\t\t\t\t\t\t@click=\"setNextMonth\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"booking--crm-forms--calendar-block-datepicker-icon --chevron-right\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div ref=\"datePicker\" class=\"booking--crm-forms--calendar-block-datepicker\"></div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { DateTimeFormat } from 'main.date';\nimport { Loader } from 'main.loader';\n\nimport { locMixin } from 'booking.component.mixin.loc-mixin';\n// eslint-disable-next-line no-unused-vars\nimport type { Resource, ResourceSlot } from '../../types';\nimport './resource-slots.css';\n\nexport type ResourceSlotsUiBlockSelectEventPayload = {\n\tdate: Date,\n\tresource: Resource,\n\tslot: ResourceSlot,\n}\n\n// @vue/component\nexport const ResourceSlotsUiBlock = {\n\tname: 'ResourceSlotsUiBlock',\n\tmixins: [locMixin],\n\tprops: {\n\t\t/**\n\t\t * @type {ResourceSlot|null}\n\t\t */\n\t\tslot: {\n\t\t\ttype: Object,\n\t\t\tdefault: null,\n\t\t},\n\t\tdate: {\n\t\t\ttype: Date,\n\t\t\trequired: true,\n\t\t},\n\t\t/**\n\t\t * @type {Resource}\n\t\t */\n\t\tresource: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tresourceSlots: {\n\t\t\ttype: Array,\n\t\t\tdefault: () => [],\n\t\t},\n\t\tloading: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: ['select'],\n\tcomputed: {\n\t\tformatDate(): string\n\t\t{\n\t\t\treturn DateTimeFormat.format(this.loc('DAY_MONTH_FORMAT'), this.date);\n\t\t},\n\t\ttitle(): string\n\t\t{\n\t\t\treturn this.loc('BOOKING_CRM_FORMS_FIELD_TIME_TITLE', {\n\t\t\t\t'#DATE#': this.formatDate,\n\t\t\t});\n\t\t},\n\t\temptySlotsMessage(): string\n\t\t{\n\t\t\tconst day = this.date.getDay();\n\t\t\tif (this.resource.slotRanges.every(({ weekDays }) => !weekDays.includes(day)))\n\t\t\t{\n\t\t\t\treturn this.loc('BOOKING_CRM_FORMS_RESOURCE_RESOURCE_NOT_WORKING_MESSAGE');\n\t\t\t}\n\n\t\t\treturn this.loc('BOOKING_CRM_FORMS_RESOURCE_NO_SLOTS_MESSAGE', {\n\t\t\t\t'#BR#': '<br />',\n\t\t\t});\n\t\t},\n\t},\n\twatch: {\n\t\tloading: {\n\t\t\thandler(loading: boolean): void\n\t\t\t{\n\t\t\t\tif (loading)\n\t\t\t\t{\n\t\t\t\t\tthis.loader?.show?.(this.$refs.slotsContainer);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.loader?.hide?.();\n\t\t\t\t}\n\t\t\t},\n\t\t\timmediate: true,\n\t\t},\n\t},\n\tbeforeMount(): void\n\t{\n\t\tthis.loader = new Loader({\n\t\t\ttarget: this.$refs.slotsContainer,\n\t\t\tsize: 60,\n\t\t});\n\t},\n\tmethods: {\n\t\tselectSlot(slot: ResourceSlot): void\n\t\t{\n\t\t\tconst payload: ResourceSlotsUiBlockSelectEventPayload = {\n\t\t\t\tdate: this.date,\n\t\t\t\tresource: this.resource,\n\t\t\t\tslot,\n\t\t\t};\n\t\t\tthis.$emit('select', payload);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"booking-crm-forms-field booking--crm-forms--resource-slots\">\n\t\t\t<slot name=\"title\"/>\n\t\t\t<div class=\"booking--crm-forms--time-selector-block-header\">\n\t\t\t\t<div class=\"booking--crm-forms--time-selector-block-resource\">\n\t\t\t\t\t<div class=\"booking--crm-forms--time-selector-block-resource-name\">\n\t\t\t\t\t\t{{ resource.name }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"booking--crm-forms--time-selector-block-resource-type-name\">\n\t\t\t\t\t\t{{ resource.typeName }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"booking--crm-forms--time-selector-block-header__button\">\n\t\t\t\t\t<slot name=\"changeDateBtn\" :date=\"date\" :resource=\"resource\"/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div ref=\"slotsContainer\" class=\"booking--crm-forms--resource-slots__slot-list-wrapper\">\n\t\t\t\t<div v-show=\"!loading\" class=\"booking--crm-forms--resource-slots__slot-list\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-for=\"resourceSlot in resourceSlots\"\n\t\t\t\t\t\t:key=\"resourceSlot\"\n\t\t\t\t\t\tclass=\"booking--crm-forms-time-selector-block-time-list-item booking--crm-forms--resource-slots__slot\"\n\t\t\t\t\t\t:class=\"{\n\t\t\t\t\t\t\t'--selected': slot !== null && resourceSlot.fromTs === slot.fromTs\n\t\t\t\t\t\t}\"\n\t\t\t\t\t\t@click=\"selectSlot(resourceSlot)\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span>{{ resourceSlot.label }}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<template v-if=\"resourceSlots.length === 0\">\n\t\t\t\t\t\t<div class=\"booking--crm-forms--resource-slots__empty-slots\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"booking--crm-forms--resource-slots__empty-slots-message\"\n\t\t\t\t\t\t\t\tv-html=\"emptySlotsMessage\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { locMixin } from 'booking.component.mixin.loc-mixin';\n\nimport { Occupancy, createOccupancy } from '../../occupancy';\nimport { ResourceSlotsUiBlock } from '../resource-slots-ui-block/resource-slots-ui-block';\n// eslint-disable-next-line no-unused-vars\nimport type { Resource, ResourceSlot, ResourceOccupancy } from '../../types';\nimport './time-selector-block.css';\n\ntype TimeSelectorBlockData = {\n\tresourceOccupancy: ResourceOccupancy,\n}\n\n// @vue/component\nexport const TimeSelectorBlock = {\n\tname: 'TimeSelectorBlock',\n\tcomponents: {\n\t\tResourceSlotsUiBlock,\n\t},\n\tmixins: [locMixin],\n\tinject: ['isPreview'],\n\tprops: {\n\t\tslot: {\n\t\t\ttype: Object,\n\t\t\tdefault: null,\n\t\t},\n\t\t/**\n\t\t * @type {Resource}\n\t\t */\n\t\tresource: {\n\t\t\ttype: Object,\n\t\t\tdefault: null,\n\t\t},\n\t\t/**\n\t\t * @type {Resource[]}\n\t\t */\n\t\tresources: {\n\t\t\ttype: Array,\n\t\t\tdefault: () => [],\n\t\t},\n\t\tdate: {\n\t\t\ttype: Date,\n\t\t\trequired: true,\n\t\t},\n\t\tfetching: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tshowChangeDateButton: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\trunAction: {\n\t\t\ttype: Function,\n\t\t\trequired: true,\n\t\t},\n\t\ttimezone: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['update:slot', 'update:fetching', 'showCalendar'],\n\tdata(): TimeSelectorBlockData\n\t{\n\t\treturn {\n\t\t\tresourceOccupancy: [],\n\t\t};\n\t},\n\tcomputed: {\n\t\tresourceSlots(): ResourceSlot[]\n\t\t{\n\t\t\treturn Occupancy.calcResourceSlots({\n\t\t\t\tdate: this.date,\n\t\t\t\tslotRanges: this.resource?.slotRanges || [],\n\t\t\t\tresourceOccupancy: this.resourceOccupancy || [],\n\t\t\t\ttimezone: this.timezone,\n\t\t\t});\n\t\t},\n\t},\n\twatch: {\n\t\tdate: {\n\t\t\thandler(date: Date | null): void\n\t\t\t{\n\t\t\t\tif (date instanceof Date && !this.isPreview)\n\t\t\t\t{\n\t\t\t\t\tvoid this.fetchOccupancy();\n\t\t\t\t}\n\t\t\t},\n\t\t\timmediate: true,\n\t\t},\n\t\tresource: {\n\t\t\thandler(): void\n\t\t\t{\n\t\t\t\tif (!this.isPreview)\n\t\t\t\t{\n\t\t\t\t\tvoid this.fetchOccupancy();\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t},\n\tcreated(): void\n\t{\n\t\tthis.initOccupancy();\n\t},\n\tmethods: {\n\t\tinitOccupancy(): void\n\t\t{\n\t\t\tif (this.occupancy instanceof Occupancy)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.occupancy = createOccupancy(this.runAction);\n\t\t\tthis.occupancy.setResources(this.resources);\n\t\t\tthis.occupancy.setTimezone(this.timezone);\n\t\t},\n\t\tasync fetchOccupancy(): Promise<void>\n\t\t{\n\t\t\tif (!this.date || this.fetching || this.resource === null)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.occupancy)\n\t\t\t{\n\t\t\t\tthis.initOccupancy();\n\t\t\t}\n\n\t\t\tthis.$emit('update:fetching', true);\n\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst response = await this.occupancy.getOccupancy([this.resource.id], this.date.getTime());\n\t\t\t\tthis.resourceOccupancy = response || [];\n\t\t\t}\n\t\t\tcatch (error)\n\t\t\t{\n\t\t\t\tconsole.error('Booking.CrmForms. GetOccupancy error', error);\n\t\t\t}\n\t\t\tfinally\n\t\t\t{\n\t\t\t\tthis.$emit('update:fetching', false);\n\t\t\t}\n\t\t},\n\t\tchangeSlot({ slot }: { slot: ResourceSlot }): void\n\t\t{\n\t\t\tthis.$emit('update:slot', slot);\n\t\t},\n\t\tchangeDate(): void\n\t\t{\n\t\t\tthis.$emit('showCalendar');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<ResourceSlotsUiBlock\n\t\t\t:slot=\"slot\"\n\t\t\t:resource=\"resource\"\n\t\t\t:date=\"date\"\n\t\t\t:resourceSlots=\"resourceSlots\"\n\t\t\t:loading=\"fetching\"\n\t\t\t@select=\"changeSlot\"\n\t\t>\n\t\t\t<template #changeDateBtn>\n\t\t\t\t<button\n\t\t\t\t\tv-if=\"showChangeDateButton\"\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tclass=\"booking--crm-forms--change-date-btn\"\n\t\t\t\t\t@click=\"changeDate\"\n\t\t\t\t>\n\t\t\t\t\t{{ loc('BOOKING_CRM_FORMS_CHANGE_DATE_BUTTON_CAPTION') }}\n\t\t\t\t</button>\n\t\t\t</template>\n\t\t</ResourceSlotsUiBlock>\n\t`,\n};\n","import { Loader } from 'main.loader';\n\nimport { locMixin } from 'booking.component.mixin.loc-mixin';\n\nimport { Occupancy, createOccupancy } from '../../occupancy';\nimport { ResourceSlotsUiBlock } from '../resource-slots-ui-block/resource-slots-ui-block';\nimport type { ResourceSlotsUiBlockSelectEventPayload } from '../resource-slots-ui-block/resource-slots-ui-block';\nimport './available-slots-block.css';\n\nconst DELAY = 300;\n\n// @vue/component\nexport const AvailableSlotsBlock = {\n\tname: 'AvailableSlotsBlock',\n\tcomponents: {\n\t\tResourceSlotsUiBlock,\n\t},\n\tmixins: [locMixin],\n\tinject: ['isPreview'],\n\tprops: {\n\t\tdate: {\n\t\t\ttype: Date,\n\t\t\trequired: true,\n\t\t},\n\t\tresources: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\trunAction: {\n\t\t\ttype: Function,\n\t\t\trequired: true,\n\t\t},\n\t\ttimezone: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['update:form', 'update:resourceId'],\n\tdata(): { fetching: boolean }\n\t{\n\t\treturn {\n\t\t\tfetching: false,\n\t\t\tselectedResourceId: null,\n\t\t\tvisibleResourcesCount: 3,\n\t\t\tresourceOccupancy: [],\n\t\t\tresourcesSlots: [],\n\t\t};\n\t},\n\tcomputed: {\n\t\tvisibleResources(): Array\n\t\t{\n\t\t\treturn this.resourcesSlots.slice(0, this.visibleResourcesCount);\n\t\t},\n\t},\n\twatch: {\n\t\tdate: {\n\t\t\thandler(date: Date | null): void\n\t\t\t{\n\t\t\t\tif (date instanceof Date && !this.isPreview)\n\t\t\t\t{\n\t\t\t\t\tvoid this.fetchAvailableSlots();\n\t\t\t\t}\n\t\t\t},\n\t\t\timmediate: true,\n\t\t},\n\t\tfetching: {\n\t\t\thandler(fetching: boolean): void\n\t\t\t{\n\t\t\t\tif (fetching)\n\t\t\t\t{\n\t\t\t\t\tthis.loader?.show(this.$refs.resources);\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.loader?.hide();\n\t\t\t},\n\t\t\timmediate: true,\n\t\t},\n\t},\n\tcreated(): void\n\t{\n\t\tthis.initOccupancy();\n\t},\n\tbeforeMount(): void\n\t{\n\t\tthis.loader = new Loader({\n\t\t\ttarget: this.$refs.resources,\n\t\t\tsize: 60,\n\t\t});\n\t},\n\tmethods: {\n\t\tinitOccupancy(): void\n\t\t{\n\t\t\tif (this.occupancy instanceof Occupancy)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.occupancy = createOccupancy(this.runAction);\n\t\t\tthis.occupancy.setResources(this.resources);\n\t\t\tthis.occupancy.setTimezone(this.timezone);\n\t\t},\n\t\tasync fetchAvailableSlots(): void\n\t\t{\n\t\t\tthis.fetching = true;\n\n\t\t\tif (!this.occupancy)\n\t\t\t{\n\t\t\t\tthis.initOccupancy();\n\t\t\t}\n\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst resourcesIds = this.resources.map((resource) => resource.id);\n\t\t\t\tconst response = await this.occupancy.getOccupancy(resourcesIds, this.date.getTime());\n\n\t\t\t\tthis.resourceOccupancy = response || [];\n\t\t\t\tthis.setResourcesSlots();\n\t\t\t}\n\t\t\tcatch (error)\n\t\t\t{\n\t\t\t\tconsole.error('Booking.CrmForms. GetOccupancy for resources error', error);\n\t\t\t}\n\t\t\tfinally\n\t\t\t{\n\t\t\t\tthis.fetching = false;\n\t\t\t}\n\t\t},\n\t\tsetResourcesSlots(): void\n\t\t{\n\t\t\tthis.resourcesSlots = this.resources\n\t\t\t\t.map((resource) => {\n\t\t\t\t\tconst resourceId = resource.id;\n\t\t\t\t\tconst resourceOccupancies = this.resourceOccupancy;\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tresourceId,\n\t\t\t\t\t\tresource,\n\t\t\t\t\t\tslots: Occupancy.calcResourceSlots({\n\t\t\t\t\t\t\tdate: this.date,\n\t\t\t\t\t\t\tslotRanges: resource.slotRanges,\n\t\t\t\t\t\t\tresourceOccupancy: resourceOccupancies,\n\t\t\t\t\t\t\tresourceId,\n\t\t\t\t\t\t\ttimezone: this.timezone,\n\t\t\t\t\t\t}),\n\t\t\t\t\t};\n\t\t\t\t})\n\t\t\t\t.sort((a, b) => b.slots.length - a.slots.length);\n\t\t},\n\t\tshowMore(): void\n\t\t{\n\t\t\tthis.visibleResourcesCount += 3;\n\t\t},\n\t\tchangeDate(resourceId: number): void\n\t\t{\n\t\t\tthis.selectedResourceId = resourceId;\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.$emit('update:form', { resourceId });\n\t\t\t}, DELAY);\n\t\t},\n\t\tselectSlot({ resource, slot }: ResourceSlotsUiBlockSelectEventPayload): void\n\t\t{\n\t\t\tthis.selectedResourceId = resource.id;\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.$emit('update:form', {\n\t\t\t\t\tresourceId: resource.id,\n\t\t\t\t\tslot,\n\t\t\t\t});\n\t\t\t}, DELAY);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div ref=\"resources\" class=\"booking--crm-forms--field-group\">\n\t\t\t<template v-show=\"!fetching\">\n\t\t\t\t<ResourceSlotsUiBlock\n\t\t\t\t\tv-for=\"resource in visibleResources\"\n\t\t\t\t\t:key=\"resource.resourceId\"\n\t\t\t\t\t:date=\"date\"\n\t\t\t\t\t:resource=\"resource.resource\"\n\t\t\t\t\t:resourceSlots=\"resource.slots\"\n\t\t\t\t\t:class=\"{\n\t\t\t\t\t\t'--fade': selectedResourceId !== null && selectedResourceId !== resource.resourceId,\n\t\t\t\t\t}\"\n\t\t\t\t\t@select=\"selectSlot\"\n\t\t\t\t>\n\t\t\t\t\t<template #changeDateBtn>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\tclass=\"booking--crm-forms--change-date-btn\"\n\t\t\t\t\t\t\t@click=\"changeDate(resource.resourceId)\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ loc('BOOKING_CRM_FORMS_CHANGE_DATE_BUTTON_CAPTION') }}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</template>\n\t\t\t\t</ResourceSlotsUiBlock>\n\t\t\t</template>\n\t\t\t<template v-if=\"resources.length > 0 && visibleResourcesCount < resources.length\">\n\t\t\t\t<div class=\"booking--crm-forms--field-group--available-slots-block__footer\">\n\t\t\t\t\t<button\n\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\tclass=\"booking--crm-forms--change-date-btn booking--crm-forms--field-group--available-slots-block__btn-show-more\"\n\t\t\t\t\t\t@click=\"showMore\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ loc('BOOKING_CRM_FORMS_SHOW_MORE_SLOTS') }}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\t`,\n};\n","import { Event, Type } from 'main.core';\n\nimport { locMixin } from 'booking.component.mixin.loc-mixin';\n\nimport { AllResource } from './const/const';\nimport { mapDtoToResource } from './lib/mappers';\nimport { Occupancy, createOccupancy } from './occupancy';\nimport { ResourceSelectBlock } from './components/resource-select-block/resource-select-block';\nimport { CalendarBlock } from './components/calendar-block/calendar-block';\nimport { TimeSelectorBlock } from './components/time-selector-block/time-selector-block';\nimport { AvailableSlotsBlock } from './components/available-slots-block/available-slots-block';\nimport type { Resource } from './types';\nimport './field.css';\n\ntype Slot = {\n\tid: string,\n\tfromTs: number,\n\ttoTs: number,\n};\n\n// @vue/component\nexport const Field = {\n\tname: 'CrmFormBookingField',\n\tcomponents: {\n\t\tAvailableSlotsBlock,\n\t\tCalendarBlock,\n\t\tResourceSelectBlock,\n\t\tTimeSelectorBlock,\n\t},\n\tmixins: [locMixin],\n\tprovide(): Object\n\t{\n\t\treturn {\n\t\t\tisPreview: this.isPreview,\n\t\t};\n\t},\n\tprops: {\n\t\tfield: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\trunAction: {\n\t\t\ttype: Function,\n\t\t\trequired: true,\n\t\t},\n\t\tdependencies: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['change'],\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tform: {\n\t\t\t\tresourceId: 0,\n\t\t\t\tdate: null,\n\t\t\t\tdateTs: 0,\n\t\t\t\tslot: null,\n\t\t\t},\n\t\t\tresources: [],\n\t\t\tfetchingResources: false,\n\t\t\tfetchingOccupancy: false,\n\t\t\tfetchingAutoSelectionResource: false,\n\t\t\tvisibleCalendar: false,\n\t\t\toccupancy: null,\n\t\t};\n\t},\n\tcomputed: {\n\t\ttimezone(): string\n\t\t{\n\t\t\treturn Intl.DateTimeFormat().resolvedOptions().timeZone;\n\t\t},\n\t\tisPreview(): boolean\n\t\t{\n\t\t\treturn this.$root.form.editMode || window.location.pathname.indexOf('/sites/site/') === 0;\n\t\t},\n\t\tisAutoSelectionOn(): boolean\n\t\t{\n\t\t\treturn Boolean(this.field?.options?.settingsData?.isAutoSelectionOn);\n\t\t},\n\t\tsettingsData(): Object\n\t\t{\n\t\t\tif (this.isPreview && Array.isArray(this.field?.options?.settingsData))\n\t\t\t{\n\t\t\t\treturn {\n\t\t\t\t\tlabel: this.loc('BOOKING_CRM_FORMS_DEFAULT_RESOURCE_FIELD_LABEL'),\n\t\t\t\t\ttextHeader: this.loc('BOOKING_CRM_FORMS_DEFAULT_RESOURCE_FIELD_PLACEHOLDER'),\n\t\t\t\t\thint: this.loc('BOOKING_CRM_FORMS_DEFAULT_RESOURCE_FIELD_HINT'),\n\t\t\t\t\tisVisibleHint: true,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn this.isAutoSelectionOn\n\t\t\t\t? this.field?.options?.settingsData?.autoSelection\n\t\t\t\t: this.field?.options?.settingsData?.default;\n\t\t},\n\t\thasSlotsAllAvailableResources(): boolean\n\t\t{\n\t\t\treturn !this.isAutoSelectionOn && this.settingsData?.hasSlotsAllAvailableResources;\n\t\t},\n\t\tfetching(): boolean\n\t\t{\n\t\t\treturn this.fetchingResources || this.fetchingOccupancy || this.fetchingAutoSelectionResource;\n\t\t},\n\t\tresource(): Object | null\n\t\t{\n\t\t\tif (!this.form.resourceId)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn this.resources.find((resource: Resource) => resource.id === this.form.resourceId) || null;\n\t\t},\n\t\trealResources(): Resource[]\n\t\t{\n\t\t\treturn this.hasSlotsAllAvailableResources\n\t\t\t\t? this.resources.filter(({ id }) => id !== AllResource.id)\n\t\t\t\t: this.resources;\n\t\t},\n\t\tvalue(): { resourcesIds: number[], fromTs: number, toTs: number } | null\n\t\t{\n\t\t\tif (!this.form.slot || !this.form.resourceId)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tresourcesIds: [this.form.resourceId],\n\t\t\t\tdateFromTs: this.form.slot.fromTs / 1000,\n\t\t\t\tdateToTs: this.form.slot.toTs / 1000,\n\t\t\t\ttimezone: this.timezone,\n\t\t\t};\n\t\t},\n\t\tresourcesIds(): number[] | null\n\t\t{\n\t\t\treturn this.settingsData?.resourceIds || [];\n\t\t},\n\t\terrorMessage(): string\n\t\t{\n\t\t\treturn this.field.messages.get('fieldErrorRequired');\n\t\t},\n\t\thasErrors(): boolean\n\t\t{\n\t\t\treturn this.field.validated && !this.field.focused && !this.field.valid();\n\t\t},\n\t\thasTitleOnlyInCalendar(): boolean\n\t\t{\n\t\t\treturn (\n\t\t\t\tthis.form.date\n\t\t\t\t&& !this.visibleCalendar\n\t\t\t\t&& (this.form.resourceId && this.isAutoSelectionOn)\n\t\t\t);\n\t\t},\n\t\tshowedCalendarBlock(): boolean\n\t\t{\n\t\t\treturn (\n\t\t\t\t(this.form.resourceId && !this.form.date)\n\t\t\t\t|| this.form.date !== null\n\t\t\t\t|| this.visibleCalendar\n\t\t\t);\n\t\t},\n\t\tshowedSlotsBlock(): boolean\n\t\t{\n\t\t\treturn (\n\t\t\t\t!this.isPreview\n\t\t\t\t&& this.hasSlotsAllAvailableResources\n\t\t\t\t&& this.form.resourceId === AllResource.id\n\t\t\t\t&& this.resources.length > 0\n\t\t\t\t&& this.form.date !== null\n\t\t\t);\n\t\t},\n\t\tshowedTimeSelectorBlock(): boolean\n\t\t{\n\t\t\treturn !this.isPreview && this.form.resourceId > 0 && this.realResources.length > 0 && this.form.date !== null;\n\t\t},\n\t},\n\tcreated(): void\n\t{\n\t\tthis.occupancyManager = createOccupancy(this.runAction);\n\t\tthis.occupancyManager.setTimezone(this.timezone);\n\n\t\tif (this.hasSlotsAllAvailableResources)\n\t\t{\n\t\t\tthis.form.resourceId = AllResource.id;\n\t\t\tthis.form.date = new Date();\n\t\t}\n\t},\n\tasync mounted(): Promise<void>\n\t{\n\t\tif (!this.isPreview)\n\t\t{\n\t\t\tawait this.loadData();\n\t\t}\n\n\t\tEvent.bind(window, 'click', this.handleFocus, true);\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tEvent.unbind(window, 'click', this.handleFocus, true);\n\t},\n\tmethods: {\n\t\tasync loadData(): Promise<void>\n\t\t{\n\t\t\tconst promises = [\n\t\t\t\tthis.loadResources(),\n\t\t\t];\n\n\t\t\tif (this.isAutoSelectionOn)\n\t\t\t{\n\t\t\t\tpromises.push(this.fetchAutoSelectionData());\n\t\t\t}\n\n\t\t\tawait Promise.all(promises);\n\t\t},\n\t\thandleFocus({ target }): void\n\t\t{\n\t\t\tthis.field.focused = this.$el.contains(target);\n\t\t},\n\t\tonSelectorChange(): void\n\t\t{\n\t\t\tthis.updateValue();\n\t\t},\n\t\tupdateValue(): void\n\t\t{\n\t\t\tif (this.form.resourceId || this.form.slot)\n\t\t\t{\n\t\t\t\tthis.field.validated = false;\n\t\t\t}\n\n\t\t\tthis.$emit('change', this.value);\n\t\t},\n\t\tasync fetchAutoSelectionData(): Promise<void>\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tthis.fetchingAutoSelectionResource = true;\n\n\t\t\t\tconst formData = new FormData();\n\t\t\t\tformData.append('timezone', this.timezone);\n\n\t\t\t\tconst resourceIds = this.settingsData?.resourceIds || [];\n\t\t\t\tresourceIds.forEach((resourceId: number) => {\n\t\t\t\t\tformData.append('resourceIds[]', resourceId);\n\t\t\t\t});\n\n\t\t\t\tconst response = await this.runAction('booking.api_v1.CrmForm.getAutoSelectionData', {\n\t\t\t\t\tdata: formData,\n\t\t\t\t});\n\n\t\t\t\tif (Type.isPlainObject(response?.data))\n\t\t\t\t{\n\t\t\t\t\tthis.form.resourceId = response.data.resourceId || 0;\n\t\t\t\t\tthis.form.date = response.data.date ? new Date(response.data.date) : null;\n\t\t\t\t}\n\t\t\t}\n\t\t\tcatch (error)\n\t\t\t{\n\t\t\t\tconsole.error('RunAction getAutoSelectionData error', error);\n\t\t\t}\n\t\t\tfinally\n\t\t\t{\n\t\t\t\tthis.fetchingAutoSelectionResource = false;\n\t\t\t}\n\t\t},\n\t\tasync loadResources(): Promise<void>\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tthis.fetchingResources = true;\n\t\t\t\tconst response = await this.runAction('booking.api_v1.CrmForm.getResources');\n\t\t\t\tthis.setResources(mapDtoToResource(response.data || []));\n\n\t\t\t\tif (this.occupancyManager instanceof Occupancy)\n\t\t\t\t{\n\t\t\t\t\tthis.occupancyManager.setResources(this.resources);\n\t\t\t\t}\n\t\t\t}\n\t\t\tcatch (error)\n\t\t\t{\n\t\t\t\tconsole.error('Load resource error', error);\n\t\t\t}\n\t\t\tfinally\n\t\t\t{\n\t\t\t\tthis.fetchingResources = false;\n\t\t\t}\n\t\t},\n\t\tchangeDate(): void\n\t\t{\n\t\t\tif (this.isPreview)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.visibleCalendar = true;\n\t\t},\n\t\tasync setResource(resourceId: number): void\n\t\t{\n\t\t\tthis.form.resourceId = resourceId;\n\t\t\tthis.form.slot = null;\n\t\t},\n\t\tsetResources(resources: Resource[]): void\n\t\t{\n\t\t\tconst resourcesIds: number[] = this.settingsData?.resourceIds || [];\n\t\t\tconst artificialResources: Resource[] = [];\n\n\t\t\tif (this.hasSlotsAllAvailableResources)\n\t\t\t{\n\t\t\t\tartificialResources.push({\n\t\t\t\t\t...AllResource,\n\t\t\t\t\tname: this.loc('BOOKING_CRM_FORMS_ALL_RESOURCES_LABEL'),\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.resources = [\n\t\t\t\t...artificialResources,\n\t\t\t\t...resources.filter(({ id }) => resourcesIds.includes(id)),\n\t\t\t];\n\t\t},\n\t\tsetDate(date: Date | null): void\n\t\t{\n\t\t\tthis.form.date = date;\n\t\t\tthis.form.slot = null;\n\t\t},\n\t\tsetSlot(selectedSlot: Slot): void\n\t\t{\n\t\t\tthis.form.slot = selectedSlot;\n\t\t\tthis.updateValue();\n\t\t},\n\t\tupdateForm(formPatch: Object): void\n\t\t{\n\t\t\tthis.form = {\n\t\t\t\t...this.form,\n\t\t\t\t...formPatch,\n\t\t\t};\n\t\t\tthis.updateValue();\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"booking-crm-forms-field-container\">\n\t\t\t<ResourceSelectBlock\n\t\t\t\t:resourceId=\"form.resourceId\"\n\t\t\t\t:resources=\"resources\"\n\t\t\t\t:settingsData=\"settingsData\"\n\t\t\t\t:errorMessage=\"errorMessage\"\n\t\t\t\t:hasErrors=\"hasErrors && form.resourceId <= 0\"\n\t\t\t\t:fetching=\"fetchingAutoSelectionResource || fetchingResources || fetchingOccupancy\"\n\t\t\t\t:dependencies=\"dependencies\"\n\t\t\t\t@update:resourceId=\"setResource\"\n\t\t\t/>\n\t\t\t<CalendarBlock\n\t\t\t\tv-if=\"!isPreview && showedCalendarBlock\"\n\t\t\t\t:resource=\"resource\"\n\t\t\t\t:date=\"form.date\"\n\t\t\t\t:titleOnly=\"hasTitleOnlyInCalendar\"\n\t\t\t\t:hasError=\"hasErrors && form.slot === null\"\n\t\t\t\t:errorMessage=\"errorMessage\"\n\t\t\t\t@updateDate=\"setDate\"\n\t\t\t/>\n\t\t\t<AvailableSlotsBlock\n\t\t\t\tv-if=\"showedSlotsBlock\"\n\t\t\t\t:date=\"form.date\"\n\t\t\t\t:resources=\"realResources\"\n\t\t\t\t:runAction=\"runAction\"\n\t\t\t\t:timezone=\"timezone\"\n\t\t\t\t@update:form=\"updateForm\"\n\t\t\t/>\n\t\t\t<TimeSelectorBlock\n\t\t\t\tv-if=\"showedTimeSelectorBlock\"\n\t\t\t\t:slot=\"form.slot\"\n\t\t\t\t:resource=\"resource\"\n\t\t\t\t:resources=\"realResources\"\n\t\t\t\t:date=\"form.date\"\n\t\t\t\t:runAction=\"runAction\"\n\t\t\t\t:fetching=\"fetchingOccupancy\"\n\t\t\t\t:timezone=\"timezone\"\n\t\t\t\t:showChangeDateButton=\"hasTitleOnlyInCalendar\"\n\t\t\t\t@update:fetching=\"fetchingOccupancy = $event\"\n\t\t\t\t@update:slot=\"setSlot\"\n\t\t\t\t@showCalendar=\"visibleCalendar = true\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n"],"names":["ALL_RESOURCES_ID","AllResource","id","name","typeName","slotRanges","DayIndexDict","Object","freeze","Sun","Mon","Tue","Wed","Thu","Fri","Sat","mapDtoToResource","resourcesDto","map","dto","slotRange","weekDays","weekDay","occupancyInstance","createOccupancy","runAction","Occupancy","constructor","setResources","resources","setTimezone","timezone","getOccupancy","ids","dateTs","requestedResourcesIds","unrequestedResourcesIds","filter","has","length","request","forEach","resourceId","Promise","all","calcResourceSlots","date","resourceOccupancy","slots","now","Date","SlotRanges","applyTimezone","getTime","includes","getDay","sort","a","b","from","slotSizeTs","slotSize","slotToTs","convertMinToTs","to","step","stepTs","occupancies","resourcesIds","fromTs","roundSlotStart","toTs","checkIsOccupiedSlot","push","label","DateTimeFormat","format","Set","add","data","occupancy","keys","Number","segments","Segments","setDate","getDate","resource","find","selectedWeekDay","DateFormat","WeekDays","subtract","setMinutes","flatMap","slotResourcesIds","slotStartTs","getMinutes","min","d","setHours","slot","some","ResourceSelector","props","type","Array","default","emits","template","ResourceSelectBlock","components","required","settingsData","fetching","Boolean","errorMessage","String","hasErrors","dependencies","dropdownOpened","computed","placeholder","textHeader","resourceName","hint","text","visible","isVisibleHint","fieldItemDropdownComponent","mixinDropdown","methods","toggleDropdown","closeDropdown","setTimeout","setResource","$emit","CalendarBlock","mixins","locMixin","titleOnly","hasError","viewDate","disabledPrevMonth","formattedViewDate","title","loc","created","selectedDates","datePicker","DatePicker","startDate","inline","hideHeader","subscribe","DatePickerEvent","SELECT","event","getData","selectedDate","toDateFromUtc","setViewDate","mounted","setTargetNode","$refs","show","beforeUnmount","destroy","setPreviousMonth","getViewDate","getMonth","updateDisabledPrevMonth","getNextDate","setNextMonth","getUTCFullYear","getUTCMonth","getUTCDate","ResourceSlotsUiBlock","resourceSlots","loading","formatDate","emptySlotsMessage","day","every","watch","handler","loader","slotsContainer","hide","immediate","beforeMount","Loader","target","size","selectSlot","payload","TimeSelectorBlock","inject","showChangeDateButton","Function","isPreview","fetchOccupancy","initOccupancy","response","error","console","changeSlot","changeDate","DELAY","AvailableSlotsBlock","selectedResourceId","visibleResourcesCount","resourcesSlots","visibleResources","slice","fetchAvailableSlots","setResourcesSlots","resourceOccupancies","showMore","Field","provide","field","form","fetchingResources","fetchingOccupancy","fetchingAutoSelectionResource","visibleCalendar","Intl","resolvedOptions","timeZone","$root","editMode","window","location","pathname","indexOf","isAutoSelectionOn","options","isArray","autoSelection","hasSlotsAllAvailableResources","realResources","value","dateFromTs","dateToTs","resourceIds","messages","get","validated","focused","valid","hasTitleOnlyInCalendar","showedCalendarBlock","showedSlotsBlock","showedTimeSelectorBlock","occupancyManager","loadData","Event","bind","handleFocus","unbind","promises","loadResources","fetchAutoSelectionData","$el","contains","onSelectorChange","updateValue","formData","FormData","append","Type","isPlainObject","artificialResources","setSlot","selectedSlot","updateForm","formPatch"],"mappings":"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"}