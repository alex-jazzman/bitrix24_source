this.BX=this.BX||{};this.BX.Booking=this.BX.Booking||{};this.BX.Booking.Provider=this.BX.Booking.Provider||{};(function(e,s,t,a,o,r,i,l,d,n,c,p,u,b){"use strict";class v{constructor(){if(new.target===v){throw new TypeError("BasePullHandler: An abstract class cannot be instantiated")}}getMap(){return{}}getDelayedMap(){return{}}}var h=babelHelpers.classPrivateFieldLooseKey("handleBookingAdded");var P=babelHelpers.classPrivateFieldLooseKey("handleBookingDeleted");var g=babelHelpers.classPrivateFieldLooseKey("updateCounters");class B extends v{constructor(...e){super(...e);Object.defineProperty(this,h,{writable:true,value:e=>{const s=e.booking;const t=r.BookingMappers.mapDtoToModel(s);const a=s.resources.map((e=>l.ResourceMappers.mapDtoToModel(e)));const o=s.clients.map((e=>p.ClientMappers.mapDtoToModel(e)));void Promise.all([n.Core.getStore().dispatch("resources/upsertMany",a),n.Core.getStore().dispatch("bookings/upsert",t),n.Core.getStore().dispatch("clients/upsertMany",o)])}});Object.defineProperty(this,P,{writable:true,value:e=>{void n.Core.getStore().dispatch(`${c.Model.Bookings}/delete`,e.id);void n.Core.getStore().dispatch(`${c.Model.Interface}/addDeletingBooking`,e.id)}});Object.defineProperty(this,g,{writable:true,value:async()=>{await u.mainPageService.fetchCounters()}})}getMap(){return{bookingAdded:babelHelpers.classPrivateFieldLooseBase(this,h)[h],bookingUpdated:babelHelpers.classPrivateFieldLooseBase(this,h)[h],bookingDeleted:babelHelpers.classPrivateFieldLooseBase(this,P)[P]}}getDelayedMap(){return{bookingAdded:babelHelpers.classPrivateFieldLooseBase(this,g)[g],bookingUpdated:babelHelpers.classPrivateFieldLooseBase(this,g)[g],bookingDeleted:babelHelpers.classPrivateFieldLooseBase(this,g)[g]}}}var y=babelHelpers.classPrivateFieldLooseKey("handleCountersUpdated");var L=babelHelpers.classPrivateFieldLooseKey("isFilterMode");var f=babelHelpers.classPrivateFieldLooseKey("getViewDateTs");class F extends v{constructor(...e){super(...e);Object.defineProperty(this,f,{value:m});Object.defineProperty(this,L,{value:H});Object.defineProperty(this,y,{value:M})}getDelayedMap(){return{countersUpdated:babelHelpers.classPrivateFieldLooseBase(this,y)[y].bind(this)}}}async function M(e){await o.countersService.fetchData();await r.bookingService.getById(e.entityId);const s=babelHelpers.classPrivateFieldLooseBase(this,L)[L]();if(!s){const e=babelHelpers.classPrivateFieldLooseBase(this,f)[f]();const s=true;await i.calendarService.loadCounterMarks(e,s)}}function H(){return n.Core.getStore().getters[`${c.Model.Filter}/isFilterMode`]}function m(){return n.Core.getStore().getters[`${c.Model.Interface}/viewDateTs`]}var k=babelHelpers.classPrivateFieldLooseKey("handleMessageSent");class S extends v{constructor(...e){super(...e);Object.defineProperty(this,k,{writable:true,value:({entityId:e,message:s})=>{var t;const a=this.$store.getters[`${c.Model.Bookings}/getById`](e);if(!a){return}void this.$store.dispatch(`${c.Model.Bookings}/update`,{id:a.id,booking:{...a,messages:[...(t=a.messages)!=null?t:[],s]}})}})}getMap(){return{messageSent:babelHelpers.classPrivateFieldLooseBase(this,k)[k]}}get $store(){return n.Core.getStore()}}var w=babelHelpers.classPrivateFieldLooseKey("handleResourceAdded");var D=babelHelpers.classPrivateFieldLooseKey("handleResourceUpdated");var C=babelHelpers.classPrivateFieldLooseKey("handleResourceDeleted");class I extends v{constructor(...e){super(...e);Object.defineProperty(this,C,{value:O});Object.defineProperty(this,D,{value:K});Object.defineProperty(this,w,{value:j})}getMap(){return{resourceAdded:babelHelpers.classPrivateFieldLooseBase(this,w)[w].bind(this),resourceUpdated:babelHelpers.classPrivateFieldLooseBase(this,D)[D].bind(this),resourceDeleted:babelHelpers.classPrivateFieldLooseBase(this,C)[C].bind(this)}}}async function j(e){const s=e.resource;const t=l.ResourceMappers.mapDtoToModel(s);await n.Core.getStore().dispatch(`${c.Model.Resources}/upsert`,t);if(t.isMain){await n.Core.getStore().dispatch(`${c.Model.Favorites}/addMany`,[t.id])}const a=n.Core.getStore().getters[`${c.Model.Filter}/isFilterMode`];if(a){return}const o=n.Core.getStore().getters[`${c.Model.Favorites}/get`];void n.Core.getStore().dispatch(`${c.Model.Interface}/setResourcesIds`,o)}function K(e){const s=e.resource;const t=l.ResourceMappers.mapDtoToModel(s);void n.Core.getStore().dispatch(`${c.Model.Resources}/upsert`,t)}function O(e){void Promise.all([n.Core.getStore().dispatch(`${c.Model.Resources}/delete`,e.id),n.Core.getStore().dispatch(`${c.Model.Favorites}/delete`,e.id),n.Core.getStore().dispatch(`${c.Model.Interface}/deleteResourceId`,e.id)])}var $=babelHelpers.classPrivateFieldLooseKey("handleResourceTypeAdded");class X extends v{constructor(...e){super(...e);Object.defineProperty(this,$,{value:T})}getMap(){return{resourceTypeAdded:babelHelpers.classPrivateFieldLooseBase(this,$)[$].bind(this)}}}function T(e){const s=e.resourceType;const t=d.ResourceTypeMappers.mapDtoToModel(s);void n.Core.getStore().dispatch(`${c.Model.ResourceTypes}/upsert`,t)}var R=babelHelpers.classPrivateFieldLooseKey("delayTimeout");var A=babelHelpers.classPrivateFieldLooseKey("handleWaitListItemAdded");var x=babelHelpers.classPrivateFieldLooseKey("handleWaitListItemDeleted");var W=babelHelpers.classPrivateFieldLooseKey("updateCounters");class E extends v{constructor(e){super(e);Object.defineProperty(this,W,{value:V});Object.defineProperty(this,x,{value:U});Object.defineProperty(this,A,{value:Q});Object.defineProperty(this,R,{writable:true,value:null});this.handleWaitListItemAdded=babelHelpers.classPrivateFieldLooseBase(this,A)[A].bind(this);this.handleWaitListItemDeleted=babelHelpers.classPrivateFieldLooseBase(this,x)[x].bind(this);this.updateCounters=babelHelpers.classPrivateFieldLooseBase(this,W)[W].bind(this)}getMap(){return{waitListItemAdded:this.handleWaitListItemAdded,waitListItemDeleted:this.handleWaitListItemDeleted}}getDelayedMap(){return{waitListItemAdded:this.updateCounters,waitListItemDeleted:this.updateCounters}}}function Q(e){const s=e.waitListItem;const t=b.WaitListMappers.mapDtoToModel(s);const a=s.clients.map((e=>p.ClientMappers.mapDtoToModel(e)));const o=n.Core.getStore();void Promise.all([o.dispatch(`${c.Model.WaitList}/upsert`,t),o.dispatch(`${c.Model.Clients}/upsertMany`,a)])}function U(e){const s=n.Core.getStore();void s.dispatch(`${c.Model.WaitList}/delete`,e.id);void s.commit(`${c.Model.Interface}/addDeletingWaitListItemId`,e.id)}async function V(){if(babelHelpers.classPrivateFieldLooseBase(this,R)[R]){return}babelHelpers.classPrivateFieldLooseBase(this,R)[R]=setTimeout((async()=>{try{await u.mainPageService.fetchCounters()}finally{babelHelpers.classPrivateFieldLooseBase(this,R)[R]=null}}),0)}var q=babelHelpers.classPrivateFieldLooseKey("params");var z=babelHelpers.classPrivateFieldLooseKey("loadItemsDelay");var G=babelHelpers.classPrivateFieldLooseKey("handlers");var J=babelHelpers.classPrivateFieldLooseKey("onBeforePull");var N=babelHelpers.classPrivateFieldLooseKey("onPull");var Y=babelHelpers.classPrivateFieldLooseKey("onBeforeQueueExecute");var Z=babelHelpers.classPrivateFieldLooseKey("onQueueExecute");var _=babelHelpers.classPrivateFieldLooseKey("onReload");var ee=babelHelpers.classPrivateFieldLooseKey("executeQueue");class se{constructor(e){Object.defineProperty(this,ee,{value:le});Object.defineProperty(this,_,{value:ie});Object.defineProperty(this,Z,{value:re});Object.defineProperty(this,Y,{value:oe});Object.defineProperty(this,N,{value:ae});Object.defineProperty(this,J,{value:te});Object.defineProperty(this,q,{writable:true,value:void 0});Object.defineProperty(this,z,{writable:true,value:500});Object.defineProperty(this,G,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,q)[q]=e;babelHelpers.classPrivateFieldLooseBase(this,G)[G]=new Set([new B,new I,new X,new F,new S,new E])}initQueueManager(){return new a.QueueManager({moduleId:c.Module.Booking,userId:babelHelpers.classPrivateFieldLooseBase(this,q)[q].currentUserId,config:{loadItemsDelay:babelHelpers.classPrivateFieldLooseBase(this,z)[z]},additionalData:{},events:{onBeforePull:e=>{babelHelpers.classPrivateFieldLooseBase(this,J)[J](e)},onPull:e=>{babelHelpers.classPrivateFieldLooseBase(this,N)[N](e)}},callbacks:{onBeforeQueueExecute:e=>babelHelpers.classPrivateFieldLooseBase(this,Y)[Y](e),onQueueExecute:e=>babelHelpers.classPrivateFieldLooseBase(this,Z)[Z](e),onReload:()=>{babelHelpers.classPrivateFieldLooseBase(this,_)[_]()}}})}}function te(e){const{pullData:{command:s,params:t}}=e.data;for(const e of babelHelpers.classPrivateFieldLooseBase(this,G)[G]){var a,o;(a=(o=e.getMap())[s])==null?void 0:a.call(o,t)}}function ae(e){const{pullData:{command:t,params:a},promises:o}=e.data;for(const e of babelHelpers.classPrivateFieldLooseBase(this,G)[G]){if(e.getDelayedMap()[t]){var r;o.push(Promise.resolve({data:{id:(r=a.entityId)!=null?r:s.Text.getRandom(),command:t,params:a}}))}}}function oe(e){return Promise.resolve()}async function re(e){await babelHelpers.classPrivateFieldLooseBase(this,ee)[ee](e)}function ie(e){}function le(e){return new Promise((s=>{e.forEach((e=>{const{data:{command:s,params:t}}=e;for(const e of babelHelpers.classPrivateFieldLooseBase(this,G)[G]){var a,o;(a=(o=e.getDelayedMap())[s])==null?void 0:a.call(o,t)}}));s()}))}e.BookingPullManager=se})(this.BX.Booking.Provider.Pull=this.BX.Booking.Provider.Pull||{},BX,BX.Event,BX.Pull,BX.Booking.Provider.Service,BX.Booking.Provider.Service,BX.Booking.Provider.Service,BX.Booking.Provider.Service,BX.Booking.Provider.Service,BX.Booking,BX.Booking.Const,BX.Booking.Provider.Service,BX.Booking.Provider.Service,BX.Booking.Provider.Service);
//# sourceMappingURL=booking-pull-manager.bundle.map.js