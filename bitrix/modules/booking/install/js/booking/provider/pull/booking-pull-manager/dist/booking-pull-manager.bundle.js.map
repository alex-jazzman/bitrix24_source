{"version":3,"file":"booking-pull-manager.bundle.js","sources":["../src/handler/base-pull-handler.js","../src/handler/booking-pull-handler.js","../src/handler/counters-pull-handler.js","../src/handler/message-pull-handler.js","../src/handler/resource-pull-handler.js","../src/handler/resource-type-pull-handler.js","../src/handler/wait-list-item-pull-handler.js","../src/booking-pull-manager.js"],"sourcesContent":["export class BasePullHandler\n{\n\tconstructor()\n\t{\n\t\tif (new.target === BasePullHandler)\n\t\t{\n\t\t\tthrow new TypeError('BasePullHandler: An abstract class cannot be instantiated');\n\t\t}\n\t}\n\n\tgetMap(): { [command: string]: Function }\n\t{\n\t\treturn {};\n\t}\n\n\tgetDelayedMap(): { [command: string]: Function }\n\t{\n\t\treturn {};\n\t}\n}\n","import { Core } from 'booking.core';\nimport { Model } from 'booking.const';\nimport { BookingMappers } from 'booking.provider.service.booking-service';\nimport { ClientMappers } from 'booking.provider.service.client-service';\nimport { ResourceMappers } from 'booking.provider.service.resources-service';\nimport { mainPageService } from 'booking.provider.service.main-page-service';\nimport type { BookingDto } from 'booking.provider.service.booking-service';\nimport type { ClientDto } from 'booking.provider.service.client-service';\nimport type { ClientModel } from 'booking.model.clients';\nimport type { ResourceDto } from 'booking.provider.service.resources-service';\n\nimport { BasePullHandler } from './base-pull-handler';\n\nexport class BookingPullHandler extends BasePullHandler\n{\n\tgetMap(): { [command: string]: Function }\n\t{\n\t\treturn {\n\t\t\tbookingAdded: this.#handleBookingAdded,\n\t\t\tbookingUpdated: this.#handleBookingAdded,\n\t\t\tbookingDeleted: this.#handleBookingDeleted,\n\t\t};\n\t}\n\n\tgetDelayedMap(): { [command: string]: Function }\n\t{\n\t\treturn {\n\t\t\tbookingAdded: this.#updateCounters,\n\t\t\tbookingUpdated: this.#updateCounters,\n\t\t\tbookingDeleted: this.#updateCounters,\n\t\t};\n\t}\n\n\t#handleBookingAdded = (params: { booking: BookingDto }): void => {\n\t\tconst bookingDto = params.booking;\n\n\t\tconst booking = BookingMappers.mapDtoToModel(bookingDto);\n\t\tconst resources = bookingDto.resources.map((resourceDto: ResourceDto) => {\n\t\t\treturn ResourceMappers.mapDtoToModel(resourceDto);\n\t\t});\n\t\tconst clients = bookingDto.clients.map((clientDto: ClientDto): ClientModel => {\n\t\t\treturn ClientMappers.mapDtoToModel(clientDto);\n\t\t});\n\n\t\tvoid Promise.all([\n\t\t\tCore.getStore().dispatch('resources/upsertMany', resources),\n\t\t\tCore.getStore().dispatch('bookings/upsert', booking),\n\t\t\tCore.getStore().dispatch('clients/upsertMany', clients),\n\t\t]);\n\t};\n\n\t#handleBookingDeleted = (params: { id: number }): void => {\n\t\tvoid Core.getStore().dispatch(`${Model.Bookings}/delete`, params.id);\n\t\tvoid Core.getStore().dispatch(`${Model.Interface}/addDeletingBooking`, params.id);\n\t};\n\n\t#updateCounters = async (): Promise<void> => {\n\t\tawait mainPageService.fetchCounters();\n\t};\n}\n","import { Core } from 'booking.core';\nimport { Model } from 'booking.const';\nimport { countersService } from 'booking.provider.service.counters-service';\nimport { bookingService } from 'booking.provider.service.booking-service';\nimport { calendarService } from 'booking.provider.service.calendar-service';\n\nimport { BasePullHandler } from './base-pull-handler';\n\nexport class CountersPullHandler extends BasePullHandler\n{\n\tgetDelayedMap(): { [command: string]: Function }\n\t{\n\t\treturn {\n\t\t\tcountersUpdated: this.#handleCountersUpdated.bind(this),\n\t\t};\n\t}\n\n\tasync #handleCountersUpdated(params: { entityId: number }): void\n\t{\n\t\tawait countersService.fetchData();\n\t\tawait bookingService.getById(params.entityId);\n\n\t\tconst isFilterMode = this.#isFilterMode();\n\n\t\tif (!isFilterMode)\n\t\t{\n\t\t\tconst viewDateTs = this.#getViewDateTs();\n\t\t\tconst forcePull = true;\n\t\t\tawait calendarService.loadCounterMarks(viewDateTs, forcePull);\n\t\t}\n\t}\n\n\t#isFilterMode(): boolean\n\t{\n\t\treturn Core.getStore().getters[`${Model.Interface}/isFilterMode`];\n\t}\n\n\t#getViewDateTs(): number\n\t{\n\t\treturn Core.getStore().getters[`${Model.Interface}/viewDateTs`];\n\t}\n}\n","import type { Store } from 'ui.vue3.vuex';\nimport { Core } from 'booking.core';\nimport { Model } from 'booking.const';\nimport type { MessageModel } from 'booking.model.bookings';\n\nimport { BasePullHandler } from './base-pull-handler';\n\nexport class MessagePullHandler extends BasePullHandler\n{\n\tgetMap(): { [command: string]: Function }\n\t{\n\t\treturn {\n\t\t\tmessageSent: this.#handleMessageSent,\n\t\t};\n\t}\n\n\t#handleMessageSent = ({ entityId: bookingId, message }: { entityId: number, message: MessageModel }): void => {\n\t\tconst booking = this.$store.getters[`${Model.Bookings}/getById`](bookingId);\n\t\tif (!booking)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.$store.dispatch(`${Model.Bookings}/update`, {\n\t\t\tid: booking.id,\n\t\t\tbooking: {\n\t\t\t\t...booking,\n\t\t\t\tmessages: [...(booking.messages ?? []), message],\n\t\t\t},\n\t\t});\n\t};\n\n\tget $store(): Store\n\t{\n\t\treturn Core.getStore();\n\t}\n}\n","import { Core } from 'booking.core';\nimport { Model } from 'booking.const';\nimport { ResourceMappers } from 'booking.provider.service.resources-service';\nimport type { ResourceDto } from 'booking.provider.service.resources-service';\n\nimport { BasePullHandler } from './base-pull-handler';\n\nexport class ResourcePullHandler extends BasePullHandler\n{\n\tgetMap(): { [command: string]: Function }\n\t{\n\t\treturn {\n\t\t\tresourceAdded: this.#handleResourceAdded.bind(this),\n\t\t\tresourceUpdated: this.#handleResourceUpdated.bind(this),\n\t\t\tresourceDeleted: this.#handleResourceDeleted.bind(this),\n\t\t};\n\t}\n\n\tasync #handleResourceAdded(params: { resource: ResourceDto }): Promise<void>\n\t{\n\t\tconst resourceDto = params.resource;\n\t\tconst resource = ResourceMappers.mapDtoToModel(resourceDto);\n\n\t\tawait Core.getStore().dispatch(`${Model.Resources}/upsert`, resource);\n\n\t\tif (resource.isMain)\n\t\t{\n\t\t\tawait Core.getStore().dispatch(`${Model.Favorites}/addMany`, [resource.id]);\n\t\t}\n\n\t\tconst isFilterMode = Core.getStore().getters[`${Model.Interface}/isFilterMode`];\n\t\tif (isFilterMode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst favorites = Core.getStore().getters[`${Model.Favorites}/get`];\n\n\t\tvoid Core.getStore().dispatch(`${Model.Interface}/setResourcesIds`, favorites);\n\t}\n\n\t#handleResourceUpdated(params: { resource: ResourceDto }): void\n\t{\n\t\tconst resourceDto = params.resource;\n\t\tconst resource = ResourceMappers.mapDtoToModel(resourceDto);\n\n\t\tvoid Core.getStore().dispatch(`${Model.Resources}/upsert`, resource);\n\t}\n\n\t#handleResourceDeleted(params: { id: number }): void\n\t{\n\t\tvoid Promise.all([\n\t\t\tCore.getStore().dispatch(`${Model.Resources}/delete`, params.id),\n\t\t\tCore.getStore().dispatch(`${Model.Favorites}/delete`, params.id),\n\t\t\tCore.getStore().dispatch(`${Model.Interface}/deleteResourceId`, params.id),\n\t\t]);\n\t}\n}\n","import { Core } from 'booking.core';\nimport { Model } from 'booking.const';\nimport { ResourceTypeMappers } from 'booking.provider.service.resources-type-service';\nimport type { ResourceTypeDto } from 'booking.provider.service.resources-type-service';\n\nimport { BasePullHandler } from './base-pull-handler';\n\nexport class ResourceTypePullHandler extends BasePullHandler\n{\n\tgetMap(): { [command: string]: Function }\n\t{\n\t\treturn {\n\t\t\tresourceTypeAdded: this.#handleResourceTypeAdded.bind(this),\n\t\t};\n\t}\n\n\t#handleResourceTypeAdded(params: { resourceType: ResourceTypeDto }): void\n\t{\n\t\tconst resourceTypeDto = params.resourceType;\n\t\tconst resourceType = ResourceTypeMappers.mapDtoToModel(resourceTypeDto);\n\n\t\tvoid Core.getStore().dispatch(`${Model.ResourceTypes}/upsert`, resourceType);\n\t}\n}\n","import { Core } from 'booking.core';\nimport { Model } from 'booking.const';\nimport { ClientMappers } from 'booking.provider.service.client-service';\nimport { mainPageService } from 'booking.provider.service.main-page-service';\nimport { WaitListMappers } from 'booking.provider.service.wait-list-service';\nimport type { ClientModel } from 'booking.model.clients';\nimport type { ClientDto } from 'booking.provider.service.client-service';\nimport type { WaitListItemDto } from 'booking.provider.service.wait-list-service';\n\nimport { BasePullHandler } from './base-pull-handler';\n\nexport class WaitListItemPullHandler extends BasePullHandler\n{\n\tconstructor(props)\n\t{\n\t\tsuper(props);\n\n\t\tthis.handleWaitListItemAdded = this.#handleWaitListItemAdded.bind(this);\n\t\tthis.handleWaitListItemDeleted = this.#handleWaitListItemDeleted.bind(this);\n\t\tthis.updateCounters = this.#updateCounters.bind(this);\n\t}\n\n\tgetMap(): { [command: string]: Function }\n\t{\n\t\treturn {\n\t\t\twaitListItemAdded: this.handleWaitListItemAdded,\n\t\t\twaitListItemDeleted: this.handleWaitListItemDeleted,\n\t\t};\n\t}\n\n\tgetDelayedMap(): { [command: string]: Function }\n\t{\n\t\treturn {\n\t\t\twaitListItemAdded: this.updateCounters,\n\t\t\twaitListItemDeleted: this.updateCounters,\n\t\t};\n\t}\n\n\t#handleWaitListItemAdded(params: { waitListItem: WaitListItemDto }): void\n\t{\n\t\tconst waitListItemDto = params.waitListItem;\n\n\t\tconst waitListItem = WaitListMappers.mapDtoToModel(waitListItemDto);\n\t\tconst clients = waitListItemDto.clients.map((clientDto: ClientDto): ClientModel => {\n\t\t\treturn ClientMappers.mapDtoToModel(clientDto);\n\t\t});\n\n\t\tconst $store = Core.getStore();\n\t\tvoid Promise.all([\n\t\t\t$store.dispatch(`${Model.WaitList}/upsert`, waitListItem),\n\t\t\t$store.dispatch(`${Model.Clients}/upsertMany`, clients),\n\t\t]);\n\t}\n\n\t#handleWaitListItemDeleted(params: { id: number }): void\n\t{\n\t\tconst $store = Core.getStore();\n\t\tvoid $store.dispatch(`${Model.WaitList}/delete`, params.id);\n\t\tvoid $store.commit(`${Model.Interface}/addDeletingWaitListItemId`, params.id);\n\t}\n\n\tasync #updateCounters(): Promise<void>\n\t{\n\t\tawait mainPageService.fetchCounters();\n\t}\n}\n","import { Text } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport { QueueManager, ActionItem } from 'pull.queuemanager';\nimport { Module } from 'booking.const';\n\nimport { BookingPullHandler } from './handler/booking-pull-handler';\nimport { BasePullHandler } from './handler/base-pull-handler';\nimport { CountersPullHandler } from './handler/counters-pull-handler';\nimport { MessagePullHandler } from './handler/message-pull-handler';\nimport { ResourcePullHandler } from './handler/resource-pull-handler';\nimport { ResourceTypePullHandler } from './handler/resource-type-pull-handler';\nimport { WaitListItemPullHandler } from './handler/wait-list-item-pull-handler';\n\ntype Params = {\n\tcurrentUserId: number,\n};\n\nexport class BookingPullManager\n{\n\t#params: Params;\n\t#loadItemsDelay: number = 500;\n\n\t#handlers: Set<BasePullHandler>;\n\n\tconstructor(params: Params)\n\t{\n\t\tthis.#params = params;\n\n\t\tthis.#handlers = new Set([\n\t\t\tnew BookingPullHandler(),\n\t\t\tnew ResourcePullHandler(),\n\t\t\tnew ResourceTypePullHandler(),\n\t\t\tnew CountersPullHandler(),\n\t\t\tnew MessagePullHandler(),\n\t\t\tnew WaitListItemPullHandler(),\n\t\t]);\n\t}\n\n\tinitQueueManager(): QueueManager\n\t{\n\t\treturn new QueueManager({\n\t\t\tmoduleId: Module.Booking,\n\t\t\tuserId: this.#params.currentUserId,\n\t\t\tconfig: {\n\t\t\t\tloadItemsDelay: this.#loadItemsDelay,\n\t\t\t},\n\t\t\tadditionalData: {},\n\t\t\tevents: {\n\t\t\t\tonBeforePull: (baseEvent: BaseEvent) => {\n\t\t\t\t\tthis.#onBeforePull(baseEvent);\n\t\t\t\t},\n\t\t\t\tonPull: (baseEvent: BaseEvent) => {\n\t\t\t\t\tthis.#onPull(baseEvent);\n\t\t\t\t},\n\t\t\t},\n\t\t\tcallbacks: {\n\t\t\t\tonBeforeQueueExecute: (items: Array<ActionItem>) => {\n\t\t\t\t\treturn this.#onBeforeQueueExecute(items);\n\t\t\t\t},\n\t\t\t\tonQueueExecute: (items: Array<ActionItem>) => {\n\t\t\t\t\treturn this.#onQueueExecute(items);\n\t\t\t\t},\n\t\t\t\tonReload: () => {\n\t\t\t\t\tthis.#onReload();\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\t#onBeforePull(baseEvent: BaseEvent): void\n\t{\n\t\tconst { pullData: { command, params } } = baseEvent.data;\n\n\t\tfor (const handler of this.#handlers)\n\t\t{\n\t\t\thandler.getMap()[command]?.(params);\n\t\t}\n\t}\n\n\t#onPull(baseEvent: BaseEvent): void\n\t{\n\t\tconst { pullData: { command, params }, promises } = baseEvent.data;\n\n\t\tfor (const handler of this.#handlers)\n\t\t{\n\t\t\tif (handler.getDelayedMap()[command])\n\t\t\t{\n\t\t\t\tpromises.push(\n\t\t\t\t\tPromise.resolve({\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tid: params.entityId ?? Text.getRandom(),\n\t\t\t\t\t\t\tcommand,\n\t\t\t\t\t\t\tparams,\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\t#onBeforeQueueExecute(items: Array<ActionItem>): Promise\n\t{\n\t\treturn Promise.resolve();\n\t}\n\n\tasync #onQueueExecute(items: Array<ActionItem>): Promise\n\t{\n\t\tawait this.#executeQueue(items);\n\t}\n\n\t#onReload(event) {}\n\n\t#executeQueue(items: Array<ActionItem>): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\titems.forEach((item: ActionItem) => {\n\t\t\t\tconst { data: { command, params } } = item;\n\n\t\t\t\tfor (const handler of this.#handlers)\n\t\t\t\t{\n\t\t\t\t\thandler.getDelayedMap()[command]?.(params);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tresolve();\n\t\t});\n\t}\n}\n"],"names":["BasePullHandler","constructor","new","target","TypeError","getMap","getDelayedMap","BookingPullHandler","params","bookingDto","booking","BookingMappers","mapDtoToModel","resources","map","resourceDto","ResourceMappers","clients","clientDto","ClientMappers","Promise","all","Core","getStore","dispatch","Model","Bookings","id","Interface","mainPageService","fetchCounters","bookingAdded","bookingUpdated","bookingDeleted","CountersPullHandler","countersUpdated","bind","countersService","fetchData","bookingService","getById","entityId","isFilterMode","viewDateTs","forcePull","calendarService","loadCounterMarks","getters","MessagePullHandler","bookingId","message","$store","messages","messageSent","ResourcePullHandler","resourceAdded","resourceUpdated","resourceDeleted","resource","Resources","isMain","Favorites","favorites","ResourceTypePullHandler","resourceTypeAdded","resourceTypeDto","resourceType","ResourceTypeMappers","ResourceTypes","WaitListItemPullHandler","props","handleWaitListItemAdded","handleWaitListItemDeleted","updateCounters","waitListItemAdded","waitListItemDeleted","waitListItemDto","waitListItem","WaitListMappers","WaitList","Clients","commit","BookingPullManager","Set","initQueueManager","QueueManager","moduleId","Module","Booking","userId","currentUserId","config","loadItemsDelay","additionalData","events","onBeforePull","baseEvent","onPull","callbacks","onBeforeQueueExecute","items","onQueueExecute","onReload","pullData","command","data","handler","promises","push","resolve","Text","getRandom","event","forEach","item"],"mappings":"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"}