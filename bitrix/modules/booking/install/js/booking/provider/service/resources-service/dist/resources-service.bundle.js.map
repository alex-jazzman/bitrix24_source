{"version":3,"file":"resources-service.bundle.js","sources":["../src/mappers.js","../src/resources-service.js","../src/index.js"],"sourcesContent":["import type { ResourceModel } from 'booking.model.resources';\nimport type { ResourceDto } from './types';\n\nexport function mapDtoToModel(resourceDto: ResourceDto): ResourceModel\n{\n\treturn {\n\t\tid: resourceDto.id,\n\t\ttypeId: resourceDto.type.id,\n\t\tname: resourceDto.name,\n\t\tdescription: resourceDto.description,\n\t\tslotRanges: resourceDto.slotRanges.map((slotRange) => ({\n\t\t\t...slotRange,\n\t\t\tweekDays: Object.values(slotRange.weekDays),\n\t\t})),\n\t\tcounter: resourceDto.counter,\n\t\tisMain: resourceDto.isMain,\n\t\tcreatedBy: resourceDto.createdBy,\n\t\tcreatedAt: resourceDto.createdAt,\n\t\tupdatedAt: resourceDto.updatedAt,\n\n\t\t// info\n\t\tisInfoNotificationOn: resourceDto.isInfoNotificationOn,\n\t\ttemplateTypeInfo: resourceDto.templateTypeInfo,\n\t\tinfoNotificationDelay: resourceDto.infoNotificationDelay,\n\n\t\t// confirmation\n\t\tisConfirmationNotificationOn: resourceDto.isConfirmationNotificationOn,\n\t\ttemplateTypeConfirmation: resourceDto.templateTypeConfirmation,\n\t\tconfirmationNotificationDelay: resourceDto.confirmationNotificationDelay,\n\t\tconfirmationNotificationRepetitions: resourceDto.confirmationNotificationRepetitions,\n\t\tconfirmationNotificationRepetitionsInterval: resourceDto.confirmationNotificationRepetitionsInterval,\n\t\tconfirmationCounterDelay: resourceDto.confirmationCounterDelay,\n\n\t\t// reminder\n\t\tisReminderNotificationOn: resourceDto.isReminderNotificationOn,\n\t\ttemplateTypeReminder: resourceDto.templateTypeReminder,\n\t\treminderNotificationDelay: resourceDto.reminderNotificationDelay,\n\n\t\t// delayed\n\t\tisDelayedNotificationOn: resourceDto.isDelayedNotificationOn,\n\t\ttemplateTypeDelayed: resourceDto.templateTypeDelayed,\n\t\tdelayedNotificationDelay: resourceDto.delayedNotificationDelay,\n\t\tdelayedCounterDelay: resourceDto.delayedCounterDelay,\n\n\t\t// feedback\n\t\tisFeedbackNotificationOn: resourceDto.isFeedbackNotificationOn,\n\t\ttemplateTypeFeedback: resourceDto.templateTypeFeedback,\n\t};\n}\n\nexport function mapModelToDto(resource: ResourceModel): ResourceDto\n{\n\treturn {\n\t\tid: resource.id,\n\t\ttype: {\n\t\t\tid: resource.typeId,\n\t\t},\n\t\tname: resource.name,\n\t\tdescription: resource.description,\n\t\tslotRanges: resource.slotRanges,\n\t\tcounter: null,\n\t\tisMain: resource.isMain,\n\t\tcreatedBy: null,\n\t\tcreatedAt: null,\n\t\tupdatedAt: null,\n\n\t\t// info\n\t\tisInfoNotificationOn: resource.isInfoNotificationOn,\n\t\ttemplateTypeInfo: resource.templateTypeInfo,\n\t\tinfoNotificationDelay: resource.infoNotificationDelay,\n\n\t\t// confirmation\n\t\tisConfirmationNotificationOn: resource.isConfirmationNotificationOn,\n\t\ttemplateTypeConfirmation: resource.templateTypeConfirmation,\n\t\tconfirmationNotificationDelay: resource.confirmationNotificationDelay,\n\t\tconfirmationNotificationRepetitions: resource.confirmationNotificationRepetitions,\n\t\tconfirmationNotificationRepetitionsInterval: resource.confirmationNotificationRepetitionsInterval,\n\t\tconfirmationCounterDelay: resource.confirmationCounterDelay,\n\n\t\t// reminder\n\t\tisReminderNotificationOn: resource.isReminderNotificationOn,\n\t\ttemplateTypeReminder: resource.templateTypeReminder,\n\t\treminderNotificationDelay: resource.reminderNotificationDelay,\n\n\t\t// delayed\n\t\tisDelayedNotificationOn: resource.isDelayedNotificationOn,\n\t\ttemplateTypeDelayed: resource.templateTypeDelayed,\n\t\tdelayedNotificationDelay: resource.delayedNotificationDelay,\n\t\tdelayedCounterDelay: resource.delayedCounterDelay,\n\n\t\t// feedback\n\t\tisFeedbackNotificationOn: resource.isFeedbackNotificationOn,\n\t\ttemplateTypeFeedback: resource.templateTypeFeedback,\n\t};\n}\n","import type { AjaxResponse } from 'main.core';\nimport { Core } from 'booking.core';\nimport { ApiClient } from 'booking.lib.api-client';\nimport { Model } from 'booking.const';\nimport type { ResourceModel } from 'booking.model.resources';\nimport { mapModelToDto, mapDtoToModel } from './mappers';\n\nclass ResourceService\n{\n\tasync add(resource: ResourceModel): Promise<AjaxResponse>\n\t{\n\t\ttry\n\t\t{\n\t\t\tconst resourceDto = mapModelToDto(resource);\n\t\t\tconst data = await (new ApiClient()).post('Resource.add', { resource: resourceDto });\n\t\t\tconst createdResource = mapDtoToModel(data);\n\n\t\t\tCore.getStore().commit('resources/upsert', createdResource);\n\n\t\t\tif (createdResource.isMain)\n\t\t\t{\n\t\t\t\tawait Core.getStore().dispatch(`${Model.Favorites}/add`, createdResource.id);\n\t\t\t}\n\n\t\t\tif (Core.getStore().getters[`${Model.Interface}/canTurnOnTrial`])\n\t\t\t{\n\t\t\t\tvoid this.#turnOnTrial();\n\t\t\t}\n\n\t\t\tthis.#updateResourcesFromFavorites();\n\n\t\t\treturn data;\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error('ResourceService: add error', error);\n\n\t\t\treturn error;\n\t\t}\n\t}\n\n\tasync update(resource: ResourceModel): Promise<AjaxResponse>\n\t{\n\t\tconst id = resource.id;\n\t\tconst resourceBeforeUpdate = { ...Core.getStore().getters['resources/getById'](id) };\n\n\t\ttry\n\t\t{\n\t\t\tconst resourceDto = mapModelToDto(resource);\n\t\t\tconst data = await (new ApiClient()).post('Resource.update', { resource: resourceDto });\n\t\t\tconst updatedResource = mapDtoToModel(data);\n\n\t\t\tCore.getStore().commit('resources/upsert', updatedResource);\n\n\t\t\tif (resourceBeforeUpdate.isMain && !updatedResource.isMain)\n\t\t\t{\n\t\t\t\tawait Core.getStore().dispatch(`${Model.Favorites}/delete`, id);\n\t\t\t}\n\n\t\t\tthis.#updateResourcesFromFavorites();\n\n\t\t\treturn data;\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error('ResourceService: update error', error);\n\n\t\t\treturn error;\n\t\t}\n\t}\n\n\t#updateResourcesFromFavorites(): void\n\t{\n\t\tconst isFilterMode = Core.getStore().getters[`${Model.Interface}/isFilterMode`];\n\t\tif (isFilterMode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst favorites = Core.getStore().getters[`${Model.Favorites}/get`];\n\n\t\tvoid Core.getStore().dispatch(`${Model.Interface}/setResourcesIds`, favorites);\n\t}\n\n\tasync delete(resourceId: number): Promise<void>\n\t{\n\t\ttry\n\t\t{\n\t\t\tawait (new ApiClient()).post('Resource.delete', { id: resourceId });\n\n\t\t\tawait Promise.all([\n\t\t\t\tCore.getStore().dispatch(`${Model.Resources}/delete`, resourceId),\n\t\t\t\tCore.getStore().dispatch(`${Model.Favorites}/delete`, resourceId),\n\t\t\t\tCore.getStore().dispatch(`${Model.Interface}/deleteResourceId`, resourceId),\n\t\t\t]);\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error('ResourceService: delete error', error);\n\t\t}\n\t}\n\n\tasync hasBookings(resourceId: number): Promise<?boolean>\n\t{\n\t\ttry\n\t\t{\n\t\t\treturn (new ApiClient()).post('Resource.hasBookings', { resourceId });\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error('ResourceService: hasBookings error', error);\n\t\t}\n\n\t\treturn Promise.resolve();\n\t}\n\n\tasync #turnOnTrial(): Promise<void>\n\t{\n\t\tawait Promise.all([\n\t\t\tCore.getStore().dispatch(`${Model.Interface}/setCanTurnOnTrial`, false),\n\t\t\tCore.getStore().dispatch(`${Model.Interface}/setIsFeatureEnabled`, true),\n\t\t]);\n\n\t\tawait new Promise((resolve) => setTimeout(resolve, 2000));\n\n\t\tawait Core.getStore().dispatch(`${Model.Interface}/setIsShownTrialPopup`, true);\n\t}\n}\n\nexport const resourceService = new ResourceService();\n","import { mapModelToDto, mapDtoToModel } from './mappers';\n\nexport { resourceService } from './resources-service';\nexport const ResourceMappers = { mapModelToDto, mapDtoToModel };\nexport type { ResourceDto } from './types';\n"],"names":["mapDtoToModel","resourceDto","id","typeId","type","name","description","slotRanges","map","slotRange","weekDays","Object","values","counter","isMain","createdBy","createdAt","updatedAt","isInfoNotificationOn","templateTypeInfo","infoNotificationDelay","isConfirmationNotificationOn","templateTypeConfirmation","confirmationNotificationDelay","confirmationNotificationRepetitions","confirmationNotificationRepetitionsInterval","confirmationCounterDelay","isReminderNotificationOn","templateTypeReminder","reminderNotificationDelay","isDelayedNotificationOn","templateTypeDelayed","delayedNotificationDelay","delayedCounterDelay","isFeedbackNotificationOn","templateTypeFeedback","mapModelToDto","resource","ResourceService","add","data","ApiClient","post","createdResource","Core","getStore","commit","dispatch","Model","Favorites","getters","Interface","error","console","update","resourceBeforeUpdate","updatedResource","delete","resourceId","Promise","all","Resources","hasBookings","resolve","isFilterMode","favorites","setTimeout","resourceService","ResourceMappers"],"mappings":"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"}