this.BX=this.BX||{};this.BX.Booking=this.BX.Booking||{};this.BX.Booking.Provider=this.BX.Booking.Provider||{};(function(e,t,i,o){"use strict";function n(e){return{id:e.id,typeId:e.type.id,name:e.name,description:e.description,slotRanges:e.slotRanges.map((e=>({...e,weekDays:Object.values(e.weekDays)}))),counter:e.counter,isMain:e.isMain,isDeleted:e.isDeleted,createdBy:e.createdBy,createdAt:e.createdAt,updatedAt:e.updatedAt,deletedAt:e.deletedAt,isInfoNotificationOn:e.isInfoNotificationOn,templateTypeInfo:e.templateTypeInfo,infoNotificationDelay:e.infoNotificationDelay,isConfirmationNotificationOn:e.isConfirmationNotificationOn,templateTypeConfirmation:e.templateTypeConfirmation,confirmationNotificationDelay:e.confirmationNotificationDelay,confirmationNotificationRepetitions:e.confirmationNotificationRepetitions,confirmationNotificationRepetitionsInterval:e.confirmationNotificationRepetitionsInterval,confirmationCounterDelay:e.confirmationCounterDelay,isReminderNotificationOn:e.isReminderNotificationOn,templateTypeReminder:e.templateTypeReminder,reminderNotificationDelay:e.reminderNotificationDelay,isDelayedNotificationOn:e.isDelayedNotificationOn,templateTypeDelayed:e.templateTypeDelayed,delayedNotificationDelay:e.delayedNotificationDelay,delayedCounterDelay:e.delayedCounterDelay,isFeedbackNotificationOn:e.isFeedbackNotificationOn,templateTypeFeedback:e.templateTypeFeedback,entities:e.entities||[]}}function a(e){return{id:e.id,type:{id:e.typeId},name:e.name,description:e.description,slotRanges:e.slotRanges,counter:null,isMain:e.isMain,isDeleted:e.isDeleted,createdBy:null,createdAt:null,updatedAt:null,isInfoNotificationOn:e.isInfoNotificationOn,templateTypeInfo:e.templateTypeInfo,infoNotificationDelay:e.infoNotificationDelay,isConfirmationNotificationOn:e.isConfirmationNotificationOn,templateTypeConfirmation:e.templateTypeConfirmation,confirmationNotificationDelay:e.confirmationNotificationDelay,confirmationNotificationRepetitions:e.confirmationNotificationRepetitions,confirmationNotificationRepetitionsInterval:e.confirmationNotificationRepetitionsInterval,confirmationCounterDelay:e.confirmationCounterDelay,isReminderNotificationOn:e.isReminderNotificationOn,templateTypeReminder:e.templateTypeReminder,reminderNotificationDelay:e.reminderNotificationDelay,isDelayedNotificationOn:e.isDelayedNotificationOn,templateTypeDelayed:e.templateTypeDelayed,delayedNotificationDelay:e.delayedNotificationDelay,delayedCounterDelay:e.delayedCounterDelay,isFeedbackNotificationOn:e.isFeedbackNotificationOn,templateTypeFeedback:e.templateTypeFeedback,entities:r(e.entities)}}function r(e){return s(e)}function s(e){return e.filter((e=>{var t;return!(e.entityType===i.ResourceEntityType.Calendar&&((t=e.data)==null?void 0:t.userIds.length)===0)}))}var c=babelHelpers.classPrivateFieldLooseKey("updateResourcesFromFavorites");var l=babelHelpers.classPrivateFieldLooseKey("turnOnTrial");class d{constructor(){Object.defineProperty(this,l,{value:p});Object.defineProperty(this,c,{value:f})}async add(e){try{const r=a(e);const s=await(new o.ApiClient).post("Resource.add",{resource:r});const d=n(s);t.Core.getStore().commit("resources/upsert",d);if(d.isMain){await t.Core.getStore().dispatch(`${i.Model.Favorites}/add`,d.id)}if(t.Core.getStore().getters[`${i.Model.Interface}/canTurnOnTrial`]){void babelHelpers.classPrivateFieldLooseBase(this,l)[l]()}babelHelpers.classPrivateFieldLooseBase(this,c)[c]();return s}catch(e){console.error("ResourceService: add error",e);return e}}async update(e){const r=e.id;const s={...t.Core.getStore().getters["resources/getById"](r)};try{const l=a(e);const d=await(new o.ApiClient).post("Resource.update",{resource:l});const f=n(d);t.Core.getStore().commit("resources/upsert",f);if(s.isMain&&!f.isMain){await t.Core.getStore().dispatch(`${i.Model.Favorites}/delete`,r)}babelHelpers.classPrivateFieldLooseBase(this,c)[c]();return d}catch(e){console.error("ResourceService: update error",e);return e}}async delete(e,n=false){try{const a=n?"Resource.forceDelete":"Resource.delete";const{removedBookingIds:r}=await(new o.ApiClient).post(a,{id:e});const s=t.Core.getStore();const c=[s.dispatch(`${i.Model.Resources}/delete`,e),s.dispatch(`${i.Model.Favorites}/delete`,e),s.dispatch(`${i.Model.Interface}/deleteResourceId`,e),s.dispatch(`${i.Model.Interface}/removeDeletingResource`,e)];if(r){c.push(s.dispatch(`${i.Model.Bookings}/deleteMany`,r))}await Promise.all(c)}catch(e){console.error("ResourceService: delete error",e)}}async hasFutureBookings(e){try{return(new o.ApiClient).post("Resource.hasFutureBookings",{resourceId:e})}catch(e){console.error("ResourceService: hasFutureBookings error",e)}return Promise.resolve()}}function f(){const e=t.Core.getStore().getters[`${i.Model.Filter}/isFilterMode`];if(e){return}const o=t.Core.getStore().getters[`${i.Model.Favorites}/get`];void t.Core.getStore().dispatch(`${i.Model.Interface}/setResourcesIds`,o)}async function p(){await Promise.all([t.Core.getStore().dispatch(`${i.Model.Interface}/setCanTurnOnTrial`,false),t.Core.getStore().dispatch(`${i.Model.Interface}/setIsFeatureEnabled`,true)]);await new Promise((e=>setTimeout(e,2e3)));await t.Core.getStore().dispatch(`${i.Model.Interface}/setIsShownTrialPopup`,true)}const u=new d;const y={mapModelToDto:a,mapDtoToModel:n};e.ResourceMappers=y;e.resourceService=u})(this.BX.Booking.Provider.Service=this.BX.Booking.Provider.Service||{},BX.Booking,BX.Booking.Const,BX.Booking.Lib);
//# sourceMappingURL=resources-service.bundle.map.js