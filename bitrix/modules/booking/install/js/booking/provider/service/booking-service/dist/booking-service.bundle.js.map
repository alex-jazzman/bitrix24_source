{"version":3,"file":"booking-service.bundle.js","sources":["../src/mappers.js","../src/booking-data-extractor.js","../src/booking-service.js","../src/index.js"],"sourcesContent":["import { Type } from 'main.core';\nimport type { BookingModel } from 'booking.model.bookings';\nimport type { BookingDto } from './types';\n\nexport function mapModelToDto(booking: BookingModel): BookingDto\n{\n\tconst mappings = {\n\t\tid: () => Number(booking.id) || 0,\n\t\tresources: () => booking.resourcesIds.map((id) => ({ id })),\n\t\tprimaryClient: () => booking.clients?.[0],\n\t\tclients: () => booking.clients,\n\t\tname: () => booking.name,\n\t\tdatePeriod: () => ({\n\t\t\tfrom: {\n\t\t\t\ttimestamp: booking.dateFromTs / 1000,\n\t\t\t\ttimezone: booking.timezoneFrom,\n\t\t\t},\n\t\t\tto: {\n\t\t\t\ttimestamp: booking.dateToTs / 1000,\n\t\t\t\ttimezone: booking.timezoneTo,\n\t\t\t},\n\t\t}),\n\t\tisConfirmed: () => booking.isConfirmed,\n\t\trrule: () => booking.rrule,\n\t\tnote: () => booking.note,\n\t\tvisitStatus: () => booking.visitStatus,\n\t\texternalData: () => booking.externalData,\n\t};\n\n\tconst dependentFields = new Map([\n\t\t['resources', ['resourcesIds']],\n\t\t['datePeriod', ['dateFromTs', 'dateToTs']],\n\t]);\n\n\treturn Object.keys(mappings).reduce((result, field) => {\n\t\tconst dependencies = dependentFields.get(field);\n\t\tconst hasDependencies = dependencies ? dependencies.every((dep) => dep in booking) : true;\n\n\t\tif (hasDependencies && (field in booking || dependencies))\n\t\t{\n\t\t\tconst value = mappings[field]();\n\t\t\tif (value !== undefined)\n\t\t\t{\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tresult[field] = value;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}, {});\n}\n\nexport function mapDtoToModel(bookingDto: BookingDto): BookingModel\n{\n\tconst clients = bookingDto.clients.filter((client) => Type.isArrayFilled(Object.values(client.data)));\n\n\treturn {\n\t\tid: bookingDto.id,\n\t\tupdatedAt: bookingDto.updatedAt,\n\t\tresourcesIds: bookingDto.resources.map(({ id }) => id),\n\t\tprimaryClient: clients?.[0],\n\t\tclients,\n\t\tcounter: bookingDto.counter,\n\t\tcounters: bookingDto.counters,\n\t\tcreatedAt: bookingDto.createdAt,\n\t\tname: bookingDto.name,\n\t\tdateFromTs: bookingDto.datePeriod.from.timestamp * 1000,\n\t\ttimezoneFrom: bookingDto.datePeriod.from.timezone,\n\t\tdateToTs: bookingDto.datePeriod.to.timestamp * 1000,\n\t\ttimezoneTo: bookingDto.datePeriod.to.timezone,\n\t\tisConfirmed: bookingDto.isConfirmed,\n\t\trrule: bookingDto.rrule,\n\t\tnote: bookingDto.note,\n\t\tvisitStatus: bookingDto.visitStatus,\n\t\texternalData: bookingDto.externalData,\n\t};\n}\n","import { ClientMappers } from 'booking.provider.service.client-service';\nimport { ResourceMappers } from 'booking.provider.service.resources-service';\nimport type { BookingModel } from 'booking.model.bookings';\nimport type { ClientModel } from 'booking.model.clients';\nimport type { ClientDto } from 'booking.provider.service.client-service';\nimport type { ResourceModel } from 'booking.model.resources';\nimport type { ResourceDto } from 'booking.provider.service.resources-service';\n\nimport { mapDtoToModel } from './mappers';\nimport type { BookingDto } from './types';\n\nexport class BookingDataExtractor\n{\n\t#response: BookingDto[];\n\n\tconstructor(response: BookingDto[])\n\t{\n\t\tthis.#response = response;\n\t}\n\n\tgetBookings(): BookingModel[]\n\t{\n\t\treturn this.#response.map((bookingDto: BookingDto): BookingModel => mapDtoToModel(bookingDto));\n\t}\n\n\tgetBookingsIds(): number[]\n\t{\n\t\treturn this.#response.map(({ id }) => id);\n\t}\n\n\tgetClients(): ClientModel[]\n\t{\n\t\treturn this.#response\n\t\t\t.flatMap(({ clients }) => clients)\n\t\t\t.map((clientDto: ClientDto): ClientModel => {\n\t\t\t\treturn ClientMappers.mapDtoToModel(clientDto);\n\t\t\t})\n\t\t;\n\t}\n\n\tgetResources(): ResourceModel[]\n\t{\n\t\treturn this.#response\n\t\t\t.flatMap(({ resources }) => resources)\n\t\t\t.map((resourceDto: ResourceDto): ResourceModel => {\n\t\t\t\treturn ResourceMappers.mapDtoToModel(resourceDto);\n\t\t\t})\n\t\t;\n\t}\n}\n","import { Core } from 'booking.core';\nimport { Model } from 'booking.const';\nimport { ApiClient } from 'booking.lib.api-client';\nimport { bookingFilter } from 'booking.lib.booking-filter';\nimport { mainPageService } from 'booking.provider.service.main-page-service';\nimport type { BookingModel } from 'booking.model.bookings';\nimport type { BookingUIFilter, BookingListFilter } from 'booking.lib.booking-filter';\n\nimport { BookingDataExtractor } from './booking-data-extractor';\nimport { mapModelToDto, mapDtoToModel } from './mappers';\nimport type { BookingDto } from './types';\n\nclass BookingService\n{\n\t#filterRequests: { [key: string]: Promise } = {};\n\t#lastFilterRequest: Promise;\n\n\tasync add(booking: BookingModel): Promise<{ success: boolean, booking: ?BookingModel }>\n\t{\n\t\tconst id = booking.id;\n\n\t\ttry\n\t\t{\n\t\t\tawait Core.getStore().dispatch(`${Model.Interface}/addQuickFilterIgnoredBookingId`, id);\n\t\t\tawait Core.getStore().dispatch(`${Model.Bookings}/add`, booking);\n\n\t\t\tconst bookingDto = mapModelToDto(booking);\n\t\t\tconst data = await (new ApiClient()).post('Booking.add', { booking: bookingDto });\n\t\t\tconst createdBooking = mapDtoToModel(data);\n\n\t\t\tconst clients = new BookingDataExtractor([data]).getClients();\n\t\t\tvoid Core.getStore().dispatch(`${Model.Clients}/upsertMany`, clients);\n\n\t\t\tawait Core.getStore().dispatch(`${Model.Interface}/addQuickFilterIgnoredBookingId`, createdBooking.id);\n\t\t\tvoid Core.getStore().dispatch(`${Model.Bookings}/update`, {\n\t\t\t\tid,\n\t\t\t\tbooking: createdBooking,\n\t\t\t});\n\n\t\t\tvoid mainPageService.fetchCounters();\n\n\t\t\treturn {\n\t\t\t\tsuccess: true,\n\t\t\t\tbooking: createdBooking,\n\t\t\t};\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tvoid Core.getStore().dispatch(`${Model.Bookings}/delete`, id);\n\n\t\t\tconsole.error('BookingService: add error', error);\n\n\t\t\treturn { success: false };\n\t\t}\n\t}\n\n\tasync addList(bookings: BookingModel[]): Promise<void>\n\t{\n\t\ttry\n\t\t{\n\t\t\tconst bookingList = bookings.map((booking) => mapModelToDto(booking));\n\n\t\t\tconst api = new ApiClient();\n\t\t\tconst data = await api.post('Booking.addList', { bookingList });\n\t\t\tconst createdBookings = data.map((d) => mapDtoToModel(d));\n\n\t\t\tawait Core.getStore().dispatch(`${Model.Bookings}/upsertMany`, createdBookings);\n\n\t\t\tvoid mainPageService.fetchCounters();\n\n\t\t\treturn createdBookings;\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error('BookingService: add list error', error);\n\n\t\t\treturn [];\n\t\t}\n\t}\n\n\tasync update(booking: BookingModel): Promise<void>\n\t{\n\t\tconst id = booking.id;\n\t\tconst bookingBeforeUpdate = { ...Core.getStore().getters[`${Model.Bookings}/getById`](id) };\n\n\t\ttry\n\t\t{\n\t\t\tif (booking.clients)\n\t\t\t{\n\t\t\t\tbooking.primaryClient ??= booking.clients[0];\n\t\t\t}\n\n\t\t\tawait Core.getStore().dispatch(`${Model.Bookings}/update`, { id, booking });\n\n\t\t\tconst bookingDto = mapModelToDto(booking);\n\t\t\tconst data = await (new ApiClient()).post('Booking.update', { booking: bookingDto });\n\t\t\tconst updatedBooking = mapDtoToModel(data);\n\n\t\t\tvoid Core.getStore().dispatch(`${Model.Bookings}/update`, {\n\t\t\t\tid,\n\t\t\t\tbooking: updatedBooking,\n\t\t\t});\n\n\t\t\tconst clients = new BookingDataExtractor([data]).getClients();\n\n\t\t\tvoid Core.getStore().dispatch(`${Model.Clients}/upsertMany`, clients);\n\n\t\t\tvoid mainPageService.fetchCounters();\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tvoid Core.getStore().dispatch(`${Model.Bookings}/update`, {\n\t\t\t\tid,\n\t\t\t\tbooking: bookingBeforeUpdate,\n\t\t\t});\n\n\t\t\tconsole.error('BookingService: update error', error);\n\t\t}\n\t}\n\n\tasync delete(id: number): Promise<void>\n\t{\n\t\tconst bookingBeforeDelete = { ...Core.getStore().getters[`${Model.Bookings}/getById`](id) };\n\n\t\ttry\n\t\t{\n\t\t\tvoid Core.getStore().dispatch(`${Model.Bookings}/delete`, id);\n\n\t\t\tawait (new ApiClient()).post('Booking.delete', { id });\n\n\t\t\tawait this.#onAfterDelete(id);\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tvoid Core.getStore().dispatch(`${Model.Bookings}/upsert`, bookingBeforeDelete);\n\n\t\t\tconsole.error('BookingService: delete error', error);\n\t\t}\n\t}\n\n\tasync deleteList(ids: number[]): Promise<void>\n\t{\n\t\ttry\n\t\t{\n\t\t\tvoid Core.getStore().dispatch(`${Model.Bookings}/deleteMany`, ids);\n\n\t\t\tawait (new ApiClient()).post('Booking.deleteList', { ids });\n\n\t\t\tawait Promise.all(ids.map((id: number) => this.#onAfterDelete(id)));\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error('BookingService: delete list error', error);\n\t\t}\n\t}\n\n\tasync #onAfterDelete(id: number): Promise<void>\n\t{\n\t\tconst editingBookingId = Core.getStore().getters[`${Model.Interface}/editingBookingId`];\n\t\tif (id === editingBookingId)\n\t\t{\n\t\t\tawait Core.getStore().dispatch(`${Model.Interface}/setEditingBookingId`, 0);\n\n\t\t\tconst selectedDateTs = Core.getStore().getters[`${Model.Interface}/selectedDateTs`];\n\n\t\t\tawait mainPageService.loadData(selectedDateTs / 1000);\n\n\t\t\tconst resourcesIds = Core.getStore().getters[`${Model.Interface}/resourcesIds`];\n\n\t\t\tmainPageService.clearCache(resourcesIds);\n\t\t}\n\n\t\tvoid Core.getStore().dispatch(`${Model.Interface}/addDeletingBooking`, id);\n\t}\n\n\tclearFilterCache(): void\n\t{\n\t\tthis.#filterRequests = {};\n\t}\n\n\tasync filter(fields: BookingUIFilter): Promise<void>\n\t{\n\t\ttry\n\t\t{\n\t\t\tconst filter = bookingFilter.prepareFilter(fields);\n\n\t\t\tconst key = JSON.stringify(filter);\n\t\t\tthis.#filterRequests[key] ??= this.#requestFilter(filter);\n\t\t\tthis.#lastFilterRequest = this.#filterRequests[key];\n\n\t\t\tconst data: BookingDto[] = await this.#filterRequests[key];\n\n\t\t\tvoid this.#extractFilterData({ data, key });\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error('BookingService: filter error', error);\n\t\t}\n\t}\n\n\tasync getById(id: number): Promise<void>\n\t{\n\t\ttry\n\t\t{\n\t\t\tconst data: BookingDto[] = await this.#requestFilter({ ID: [id] });\n\t\t\tconst extractor = new BookingDataExtractor(data);\n\t\t\tawait Promise.all([\n\t\t\t\tCore.getStore().dispatch(`${Model.Resources}/upsertMany`, extractor.getResources()),\n\t\t\t\tCore.getStore().dispatch(`${Model.Bookings}/upsertMany`, extractor.getBookings()),\n\t\t\t\tCore.getStore().dispatch(`${Model.Clients}/upsertMany`, extractor.getClients()),\n\t\t\t]);\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error('BookingService: getById error', error);\n\t\t}\n\t}\n\n\tasync #extractFilterData({ data, key }: { data: BookingDto[], key: string, date: Date }): Promise<void>\n\t{\n\t\tconst extractor = new BookingDataExtractor(data);\n\n\t\tawait Promise.all([\n\t\t\tCore.getStore().dispatch(`${Model.Resources}/insertMany`, extractor.getResources()),\n\t\t\tCore.getStore().dispatch(`${Model.Bookings}/insertMany`, extractor.getBookings()),\n\t\t\tCore.getStore().dispatch(`${Model.Clients}/insertMany`, extractor.getClients()),\n\t\t]);\n\n\t\tif (this.#filterRequests[key] !== this.#lastFilterRequest)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid Core.getStore().dispatch(`${Model.Interface}/setFilteredBookingsIds`, extractor.getBookingsIds());\n\t}\n\n\tasync #requestFilter(filter: BookingListFilter): Promise<BookingDto[]>\n\t{\n\t\treturn new ApiClient().post('Booking.list', {\n\t\t\tfilter,\n\t\t\tselect: [\n\t\t\t\t'RESOURCES',\n\t\t\t\t'CLIENTS',\n\t\t\t\t'EXTERNAL_DATA',\n\t\t\t\t'NOTE',\n\t\t\t],\n\t\t\twithCounters: true,\n\t\t\twithClientData: true,\n\t\t\twithExternalData: true,\n\t\t});\n\t}\n}\n\nexport const bookingService = new BookingService();\n","import { mapModelToDto, mapDtoToModel } from './mappers';\n\nexport { bookingService } from './booking-service';\nexport const BookingMappers = { mapModelToDto, mapDtoToModel };\nexport type { BookingDto } from './types';\n"],"names":["mapModelToDto","booking","mappings","id","Number","resources","resourcesIds","map","primaryClient","clients","name","datePeriod","from","timestamp","dateFromTs","timezone","timezoneFrom","to","dateToTs","timezoneTo","isConfirmed","rrule","note","visitStatus","externalData","dependentFields","Map","Object","keys","reduce","result","field","dependencies","get","hasDependencies","every","dep","value","undefined","mapDtoToModel","bookingDto","filter","client","Type","isArrayFilled","values","data","updatedAt","counter","counters","createdAt","BookingDataExtractor","constructor","response","getBookings","getBookingsIds","getClients","flatMap","clientDto","ClientMappers","getResources","resourceDto","ResourceMappers","BookingService","add","Core","getStore","dispatch","Model","Interface","Bookings","ApiClient","post","createdBooking","Clients","mainPageService","fetchCounters","success","error","console","addList","bookings","bookingList","api","createdBookings","d","update","bookingBeforeUpdate","getters","updatedBooking","delete","bookingBeforeDelete","deleteList","ids","Promise","all","clearFilterCache","fields","bookingFilter","prepareFilter","key","JSON","stringify","getById","ID","extractor","Resources","editingBookingId","selectedDateTs","loadData","clearCache","select","withCounters","withClientData","withExternalData","bookingService","BookingMappers"],"mappings":"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"}