{"version":3,"file":"note-popup.bundle.js","sources":["../src/note-popup.js"],"sourcesContent":["import { Event } from 'main.core';\nimport { PopupManager } from 'main.popup';\nimport { ref } from 'ui.vue3';\nimport type { Popup as IPopup, PopupOptions } from 'main.popup';\n\nimport { Resolvable } from 'booking.lib.resolvable';\nimport { Popup } from 'booking.component.popup';\nimport { Button, ButtonSize, ButtonColor } from 'booking.component.button';\n\nimport './note-popup.css';\n\ntype NotePopupSetupData = {\n\tbuttonColor: ButtonColor,\n\tbuttonSize: ButtonSize,\n\tnote: string,\n\tmountedPromise: Resolvable,\n};\n\nexport type NotePopupSavePayload = {\n\tid: number | string,\n\tnote: string,\n}\n\nexport const NotePopup = {\n\tname: 'NotePopup',\n\temits: ['save', 'close'],\n\tprops: {\n\t\tid: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\ttext: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tbindElement: {\n\t\t\ttype: Function,\n\t\t\trequired: true,\n\t\t},\n\t\tisEditMode: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tdataId: {\n\t\t\ttype: [String, Number],\n\t\t\tdefault: '',\n\t\t},\n\t\tdataElementPrefix: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\tsetup(): NotePopupSetupData\n\t{\n\t\tconst buttonSize = ButtonSize;\n\t\tconst buttonColor = ButtonColor;\n\t\tconst note = ref('');\n\t\tconst mountedPromise = new Resolvable();\n\n\t\treturn {\n\t\t\tbuttonColor,\n\t\t\tbuttonSize,\n\t\t\tmountedPromise,\n\t\t\tnote,\n\t\t};\n\t},\n\tbeforeCreate(): void\n\t{\n\t\tconst popupId = `booking-booking-note-popup-${this.id}`;\n\n\t\tPopupManager.getPopups()\n\t\t\t.filter((popup: IPopup) => popup.getId() === popupId)\n\t\t\t.forEach((popup: IPopup) => popup.destroy());\n\t},\n\tcreated(): void\n\t{\n\t\tthis.note = this.text;\n\t},\n\tmounted(): void\n\t{\n\t\tthis.mountedPromise.resolve();\n\t\tthis.adjustPosition();\n\t\tthis.focusOnTextarea();\n\t\tEvent.bind(document, 'scroll', this.adjustPosition, true);\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tEvent.unbind(document, 'scroll', this.adjustPosition, true);\n\t},\n\tcomputed: {\n\t\tpopupId(): string\n\t\t{\n\t\t\treturn `booking-booking-note-popup-${this.id}`;\n\t\t},\n\t\tconfig(): PopupOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tclassName: 'booking-booking-note-popup',\n\t\t\t\tbindElement: this.bindElement(),\n\t\t\t\tminWidth: this.bindElement().offsetWidth,\n\t\t\t\theight: 120,\n\t\t\t\toffsetTop: -10,\n\t\t\t\tbackground: 'var(--ui-color-background-note)',\n\t\t\t\tbindOptions: {\n\t\t\t\t\tforceBindPosition: true,\n\t\t\t\t\tposition: 'top',\n\t\t\t\t},\n\t\t\t\tautoHide: this.isEditMode,\n\t\t\t};\n\t\t},\n\t},\n\tmethods: {\n\t\tclosePopup(): void\n\t\t{\n\t\t\tthis.$emit('close');\n\t\t},\n\t\tsaveNote(): void\n\t\t{\n\t\t\tif (this.text !== this.note)\n\t\t\t{\n\t\t\t\tthis.$emit('save', {\n\t\t\t\t\tid: this.id,\n\t\t\t\t\tnote: this.note,\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.closePopup();\n\t\t},\n\t\tonMouseDown(): void\n\t\t{\n\t\t\tEvent.unbind(window, 'mouseup', this.onMouseUp);\n\t\t\tEvent.bind(window, 'mouseup', this.onMouseUp);\n\t\t\tthis.setAutoHide(false);\n\t\t},\n\t\tonMouseUp(): void\n\t\t{\n\t\t\tEvent.unbind(window, 'mouseup', this.onMouseUp);\n\t\t\tsetTimeout(() => this.setAutoHide(this.isEditMode), 0);\n\t\t},\n\t\tsetAutoHide(autoHide: boolean): void\n\t\t{\n\t\t\tthis.$refs.popup?.getPopupInstance()?.setAutoHide(autoHide);\n\t\t},\n\t\tadjustPosition(): void\n\t\t{\n\t\t\tthis.$refs.popup.adjustPosition();\n\t\t},\n\t\tfocusOnTextarea(): void\n\t\t{\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (this.isEditMode)\n\t\t\t\t{\n\t\t\t\t\tthis.$refs.textarea.focus();\n\t\t\t\t}\n\t\t\t}, 0);\n\t\t},\n\t},\n\twatch: {\n\t\tisEditMode(isEditMode: boolean): void\n\t\t{\n\t\t\tthis.setAutoHide(isEditMode);\n\t\t\tthis.focusOnTextarea();\n\t\t},\n\t\tasync note(): Promise<void>\n\t\t{\n\t\t\tawait this.mountedPromise;\n\n\t\t\tthis.$refs.popup.getPopupInstance().setHeight(0);\n\n\t\t\tconst minHeight = 120;\n\t\t\tconst maxHeight = 280;\n\t\t\tconst height = this.$refs.textarea.scrollHeight + 45;\n\t\t\tconst popupHeight = Math.min(maxHeight, Math.max(minHeight, height));\n\n\t\t\tthis.$refs.popup.getPopupInstance().setHeight(popupHeight);\n\t\t\tthis.adjustPosition();\n\t\t},\n\t},\n\tcomponents: {\n\t\tButton,\n\t\tPopup,\n\t},\n\ttemplate: `\n\t\t<Popup\n\t\t\t:id=\"popupId\"\n\t\t\t:config=\"config\"\n\t\t\tref=\"popup\"\n\t\t\t@close=\"closePopup\"\n\t\t>\n\t\t\t<div\n\t\t\t\tclass=\"booking-booking-note-popup-content\"\n\t\t\t\t:data-element=\"dataElementPrefix + '-note-popup'\"\n\t\t\t\t:data-id=\"dataId\"\n\t\t\t\t@mousedown=\"onMouseDown\"\n\t\t\t>\n\t\t\t\t<div\n\t\t\t\t\tclass=\"booking-booking-note-popup-title\"\n\t\t\t\t\t:data-element=\"dataElementPrefix + '-note-popup-title'\"\n\t\t\t\t\t:data-id=\"dataId\"\n\t\t\t\t>\n\t\t\t\t\t{{ loc('BOOKING_BOOKING_NOTE_TITLE') }}\n\t\t\t\t</div>\n\t\t\t\t<textarea\n\t\t\t\t\tv-model.trim=\"note\"\n\t\t\t\t\tclass=\"booking-booking-note-popup-textarea\"\n\t\t\t\t\t:placeholder=\"loc('BOOKING_BOOKING_NOTE_HINT')\"\n\t\t\t\t\t:disabled=\"!isEditMode\"\n\t\t\t\t\t:data-element=\"dataElementPrefix + '-note-popup-textarea'\"\n\t\t\t\t\t:data-id=\"dataId\"\n\t\t\t\t\t:data-disabled=\"!isEditMode\"\n\t\t\t\t\tref=\"textarea\"\n\t\t\t\t></textarea>\n\t\t\t\t<div v-if=\"isEditMode\" class=\"booking-booking-note-popup-buttons\">\n\t\t\t\t\t<slot name=\"buttons\">\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t:dataset=\"{id: dataId, element: dataElementPrefix + '-note-popup-save'}\"\n\t\t\t\t\t\t\t:text=\"loc('BOOKING_BOOKING_NOTE_SAVE')\"\n\t\t\t\t\t\t\t:size=\"buttonSize.EXTRA_SMALL\"\n\t\t\t\t\t\t\t:color=\"buttonColor.PRIMARY\"\n\t\t\t\t\t\t\t@click=\"saveNote\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t:dataset=\"{id: dataId, element: dataElementPrefix + '-note-popup-cancel'}\"\n\t\t\t\t\t\t\t:text=\"loc('BOOKING_BOOKING_NOTE_CANCEL')\"\n\t\t\t\t\t\t\t:size=\"buttonSize.EXTRA_SMALL\"\n\t\t\t\t\t\t\t:color=\"buttonColor.LINK\"\n\t\t\t\t\t\t\t@click=\"closePopup\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</slot>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</Popup>\n\t`,\n};\n"],"names":["NotePopup","name","emits","props","id","type","Number","String","required","text","default","bindElement","Function","isEditMode","Boolean","dataId","dataElementPrefix","setup","buttonSize","ButtonSize","buttonColor","ButtonColor","note","ref","mountedPromise","Resolvable","beforeCreate","popupId","PopupManager","getPopups","filter","popup","getId","forEach","destroy","created","mounted","resolve","adjustPosition","focusOnTextarea","Event","bind","document","beforeUnmount","unbind","computed","config","className","minWidth","offsetWidth","height","offsetTop","background","bindOptions","forceBindPosition","position","autoHide","methods","closePopup","$emit","saveNote","onMouseDown","window","onMouseUp","setAutoHide","setTimeout","$refs","getPopupInstance","textarea","focus","watch","setHeight","minHeight","maxHeight","scrollHeight","popupHeight","Math","min","max","components","Button","Popup","template"],"mappings":"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"}