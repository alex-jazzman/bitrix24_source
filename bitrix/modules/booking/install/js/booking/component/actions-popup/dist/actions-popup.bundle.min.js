this.BX=this.BX||{};this.BX.Booking=this.BX.Booking||{};(function(t,e,n,o,i,s,a,r,u,l,d,c,p,m,h,b,g,f,I,v,B,_,S,C,P,E,k,O,y){"use strict";const N={name:"ActionsPopup",emits:["close"],props:{bindElement:{type:HTMLElement,required:true},popupId:{type:[Number,String],required:true},contentStructure:{type:Array,required:true},popupOptions:{type:Object,default:null}},data(){return{soonTmp:false}},computed:{actionsPopupId(){return`booking-booking-actions-popup-${this.popupId}`},config(){return{className:"booking-booking-actions-popup",bindElement:this.bindElement,width:325,offsetLeft:this.bindElement.offsetWidth,offsetTop:-200,animation:"fading-slide",...this.popupOptions}}},beforeCreate(){C.PopupManager.getPopups().filter((t=>/booking-booking-actions-popup/.test(t.getId()))).forEach((t=>t.destroy()))},components:{StickyPopup:p.StickyPopup,PopupMaker:e.PopupMaker},template:`\n\t\t<StickyPopup\n\t\t\tv-slot="{freeze, unfreeze}"\n\t\t\t:id="actionsPopupId"\n\t\t\t:config="config"\n\t\t\t@close="$emit('close')"\n\t\t>\n\t\t\t<PopupMaker\n\t\t\t\t:contentStructure="contentStructure"\n\t\t\t\t@freeze="freeze"\n\t\t\t\t@unfreeze="unfreeze"\n\t\t\t/>\n\t\t\t<div class="booking-booking-actions-popup-footer">\n\t\t\t\t<slot name="footer" />\n\t\t\t</div>\n\t\t</StickyPopup>\n\t`};const T={props:{id:{type:[Number,String],required:true},note:{type:String,default:""},dataId:{type:[Number,String],default:""},dataElementPrefix:{type:String,default:""},dataAttributes:{type:Object,default:null}},emits:["popupShown","popupClosed","updateNote"],data(){return{IconSet:E.Set,isPopupShown:false,isEditMode:false}},computed:{...P.mapGetters({isFeatureEnabled:`${k.Model.Interface}/isFeatureEnabled`}),hasNote(){return Boolean(this.note)}},methods:{onMouseEnter(){this.showNoteTimeout=setTimeout((()=>this.showViewPopup()),100)},onMouseLeave(){clearTimeout(this.showNoteTimeout);this.closeViewPopup()},showViewPopup(){if(this.isPopupShown||!this.hasNote){return}this.isEditMode=false;this.showPopup()},closeViewPopup(){if(this.isEditMode){return}this.closePopup()},showEditPopup(){this.isEditMode=true;this.showPopup()},closeEditPopup(){if(!this.isEditMode){return}this.closePopup()},showPopup(){this.isPopupShown=true;this.$emit("popupShown")},closePopup(){this.isPopupShown=false;this.$emit("popupClosed")},saveBookingNote({note:t}){this.$emit("updateNote",{id:this.id,note:t})}},components:{NotePopup:i.NotePopup,Icon:E.BIcon},template:`\n\t\t<div\n\t\t\tclass="booking-actions-popup__item-client-note"\n\t\t\t:data-element="dataElementPrefix + '-menu-note'"\n\t\t\t:data-has-note="hasNote"\n\t\t\t:class="{'--empty': !hasNote}"\n\t\t\tv-bind="dataAttributes"\n\t\t\tref="note"\n\t\t>\n\t\t\t<div\n\t\t\t\tclass="booking-actions-popup__item-client-note-inner"\n\t\t\t\t:data-element="dataElementPrefix + '-menu-note-add'"\n\t\t\t\tv-bind="dataAttributes"\n\t\t\t\t@mouseenter="onMouseEnter"\n\t\t\t\t@mouseleave="onMouseLeave"\n\t\t\t\t@click="() => hasNote ? showViewPopup() : showEditPopup()"\n\t\t\t>\n\t\t\t\t<template v-if="hasNote">\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="booking-actions-popup__item-client-note-text"\n\t\t\t\t\t\t:data-element="dataElementPrefix + '-menu-note-text'"\n\t\t\t\t\t\tv-bind="dataAttributes"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ note }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="isFeatureEnabled"\n\t\t\t\t\t\tclass="booking-actions-popup__item-client-note-edit"\n\t\t\t\t\t\t:data-element="dataElementPrefix + '-menu-note-edit'"\n\t\t\t\t\t\tv-bind="dataAttributes"\n\t\t\t\t\t\t@click="showEditPopup"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Icon :name="IconSet.PENCIL_40"/>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<template v-else>\n\t\t\t\t\t<Icon :name="IconSet.PLUS_20"/>\n\t\t\t\t\t<div class="booking-actions-popup__item-client-note-text">\n\t\t\t\t\t\t{{ loc('BB_ACTIONS_POPUP_ADD_NOTE') }}\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t\t<NotePopup\n\t\t\tv-if="isPopupShown"\n\t\t\t:isEditMode="isEditMode && isFeatureEnabled"\n\t\t\t:id="id"\n\t\t\t:text="note"\n\t\t\t:bindElement="() => $refs.note"\n\t\t\t:dataId="dataId"\n\t\t\t:dataElementPrefix="dataElementPrefix"\n\t\t\t@close="closeEditPopup"\n\t\t\t@save="saveBookingNote"\n\t\t/>\n\t`};const A={emits:["popupShown","popupClosed","addClients"],props:{id:{type:[Number,String],required:true}},directives:{hint:h.hint},data(){return{ButtonSize:y.ButtonSize,ButtonColor:y.ButtonColor,ButtonIcon:y.ButtonIcon,isLoading:true,shownClientPopup:false}},computed:{...P.mapGetters({isFeatureEnabled:`${k.Model.Interface}/isFeatureEnabled`}),btnIcon(){return this.isFeatureEnabled?y.ButtonIcon.ADD:y.ButtonIcon.LOCK},userIcon(){return E.Set.PERSON},personSize(){return 26},callIcon(){return E.Set.TELEPHONY_HANDSET_1},messageIcon(){return E.Set.CHATS_1},iconSize(){return 20},iconColor(){return"var(--ui-color-palette-gray-20)"},soonHint(){return{text:this.loc("BOOKING_BOOKING_SOON_HINT"),popupOptions:{offsetLeft:-60}}}},methods:{showClientPopup(){if(!this.isFeatureEnabled){O.limit.show();return}this.shownClientPopup=true;this.$emit("popupShown")},hideClientPopup(){this.shownClientPopup=false;this.$emit("popupClosed")},addClientsToBook(t){this.$emit("addClients",{id:this.id,clients:t})}},components:{Button:y.Button,Icon:E.BIcon,ClientPopup:s.ClientPopup},template:`\n\t\t<div class="booking-actions-popup__item-client-icon-container">\n\t\t\t<div class="booking-actions-popup__item-client-icon">\n\t\t\t\t<Icon :name="userIcon" :size="personSize" :color="iconColor"/>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="booking-actions-popup__item-client-info --empty">\n\t\t\t<div class="booking-actions-popup__item-client-info-label --empty">\n\t\t\t\t{{ loc('BB_ACTIONS_POPUP_CLIENT_EMPTY_NAME_LABEL') }}\n\t\t\t</div>\n\t\t\t<div class="booking-actions-popup__item-client-info-empty">\n\t\t\t\t<div></div>\n\t\t\t\t<div></div>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tclass="booking-actions-popup-item-buttons booking-actions-popup__item-client-info-btn"\n\t\t\t\tref="clientButton"\n\t\t\t>\n\t\t\t\t<Button\n\t\t\t\t\t:text="loc('BB_ACTIONS_POPUP_CLIENT_BTN_EMPTY_LABEL')"\n\t\t\t\t\t:size="ButtonSize.EXTRA_SMALL"\n\t\t\t\t\t:color="ButtonColor.PRIMARY"\n\t\t\t\t\t:icon="btnIcon"\n\t\t\t\t\t:round="true"\n\t\t\t\t\t@click="showClientPopup"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<ClientPopup\n\t\t\t\tv-if="shownClientPopup"\n\t\t\t\t:bindElement="this.$refs.clientButton"\n\t\t\t\t@create="addClientsToBook"\n\t\t\t\t@close="hideClientPopup"\n\t\t\t/>\n\t\t</div>\n\t\t<div v-hint="soonHint" class="booking-actions-popup__item-client-action">\n\t\t\t<Icon :name="callIcon" :size="iconSize" :color="iconColor"/>\n\t\t\t<Icon :name="messageIcon" :size="iconSize" :color="iconColor"/>\n\t\t</div>\n\t`};const L={name:"EditClientButton",components:{ClientPopup:s.ClientPopup,Button:y.Button,Icon:E.BIcon},props:{id:{type:[Number,Array],required:true},clients:{type:Array,default:()=>[]},dataElementPrefix:{type:String,default:""},dataAttributes:{type:Object,default:null}},emits:["visible","invisible","updateClients"],setup(){const t=E.Set;const e=y.ButtonSize;const n=y.ButtonColor;const o=y.ButtonIcon;const i=I.ref(false);return{iconSet:t,buttonSize:e,buttonColor:n,buttonIcon:o,isClientPopupShowed:i}},computed:{getClientByClientData(){return this.$store.getters[`${k.Model.Clients}/getByClientData`]},currentClient(){const t=this.getClientByClientData;const e={contact:null,company:null};(this.clients||[]).map((e=>t(e))).forEach((t=>{if(t.type.code===k.CrmEntity.Contact){e.contact=t}else if(t.type.code===k.CrmEntity.Company){e.company=t}}));return e}},methods:{updateClient(t){this.$emit("updateClients",{id:this.id,clients:t})},showPopup(){this.isClientPopupShowed=true;this.$emit("visible")},closePopup(){this.isClientPopupShowed=false;this.$emit("invisible")}},template:`\n\t\t<Button\n\t\t\t:data-element="dataElementPrefix + '-menu-client-edit'"\n\t\t\tv-bind="dataAttributes"\n\t\t\t:size="buttonSize.EXTRA_SMALL"\n\t\t\t:color="buttonColor.LIGHT"\n\t\t\t:round="true"\n\t\t\tref="editClientButton"\n\t\t\t@click="showPopup"\n\t\t>\n\t\t\t<Icon :name="iconSet.MORE"/>\n\t\t</Button>\n\t\t<ClientPopup\n\t\t\tv-if="isClientPopupShowed"\n\t\t\t:bind-element="$refs.editClientButton.$el"\n\t\t\t:current-client="currentClient"\n\t\t\t@create="updateClient"\n\t\t\t@close="closePopup"\n\t\t/>\n\t`};const M=n.SidePanel||BX.SidePanel;const w={name:"ActionsPopupClient",directives:{lazyload:o.lazyload,hint:h.hint},components:{Button:y.Button,Icon:E.BIcon,Loader:_.Loader,Empty:A,Note:T,EditClientButton:L},props:{id:{type:[Number,String],required:true},primaryClientData:{type:Object,default:null},clients:{type:Array,default:()=>[]},note:{type:String,default:""},dataId:{type:[Number,String],default:""},dataElementPrefix:{type:String,default:""},dataAttributes:{type:Object,default:null}},emits:["freeze","unfreeze","addClients","updateClients","updateNote"],data(){return{ButtonSize:y.ButtonSize,ButtonColor:y.ButtonColor,ButtonIcon:y.ButtonIcon,isLoading:true}},computed:{client(){const t=this.primaryClientData;return t?this.$store.getters["clients/getByClientData"](t):null},clientPhone(){const t=this.client;return t.phones.length>0?t.phones[0]:this.loc("BB_ACTIONS_POPUP_CLIENT_PHONE_LABEL")},clientAvatar(){const t=this.client;return t.image},clientStatus(){if(!this.client.isReturning){return this.loc("BB_ACTIONS_POPUP_CLIENT_STATUS_FIRST")}return this.loc("BB_ACTIONS_POPUP_CLIENT_STATUS_RETURNING")},userIcon(){return E.Set.PERSON},personSize(){return 26},callIcon(){return E.Set.TELEPHONY_HANDSET_1},messageIcon(){return E.Set.CHATS_1},iconSize(){return 20},iconColor(){return"var(--ui-color-palette-gray-20)"},imageTypeClass(){return"--user"},soonHint(){return{text:this.loc("BOOKING_BOOKING_SOON_HINT"),popupOptions:{offsetLeft:-60}}}},async mounted(){this.isLoading=false},methods:{openClient(){const t=this.client.type.code.toLowerCase();M.Instance.open(`/crm/${t}/details/${this.client.id}/`)}},template:`\n\t\t<div class="booking-actions-popup__item booking-actions-popup__item-client">\n\t\t\t<div class="booking-actions-popup__item-client-client">\n\t\t\t\t<Loader v-if="isLoading" class="booking-actions-popup__item-client-loader"/>\n\t\t\t\t<template v-else-if="client">\n\t\t\t\t\t<div class="booking-actions-popup__item-client-icon-container">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-if="clientAvatar"\n\t\t\t\t\t\t\tclass="booking-actions-popup-user__avatar"\n\t\t\t\t\t\t\t:class="imageTypeClass"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\tv-lazyload\n\t\t\t\t\t\t\t\t:data-lazyload-src="clientAvatar"\n\t\t\t\t\t\t\t\tclass="booking-actions-popup-user__source"\n\t\t\t\t\t\t\t\talt="user avatar"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-else class="booking-actions-popup__item-client-icon">\n\t\t\t\t\t\t\t<Icon :name="userIcon" :size="personSize" :color="iconColor"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="booking-actions-popup__item-client-info">\n\t\t\t\t\t\t<div class="booking-actions-popup__item-client-info-label" :title="client.name">\n\t\t\t\t\t\t\t{{ client.name }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="booking-actions-popup-item-info">\n\t\t\t\t\t\t\t<div class="booking-actions-popup-item-subtitle">\n\t\t\t\t\t\t\t\t{{ clientStatus }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="booking-actions-popup-item-subtitle">\n\t\t\t\t\t\t\t\t{{ clientPhone }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="booking-actions-popup-item-buttons booking-actions-popup__item-client-info-btn">\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t:data-element="dataElementPrefix + '-menu-client-open'"\n\t\t\t\t\t\t\t\tv-bind="dataAttributes"\n\t\t\t\t\t\t\t\tclass="booking-actions-popup-item-client-open-button"\n\t\t\t\t\t\t\t\t:text="loc('BB_ACTIONS_POPUP_CLIENT_BTN_LABEL')"\n\t\t\t\t\t\t\t\t:size="ButtonSize.EXTRA_SMALL"\n\t\t\t\t\t\t\t\t:color="ButtonColor.LIGHT_BORDER"\n\t\t\t\t\t\t\t\t:round="true"\n\t\t\t\t\t\t\t\t@click="openClient"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<EditClientButton\n\t\t\t\t\t\t\t\t:id\n\t\t\t\t\t\t\t\t:clients\n\t\t\t\t\t\t\t\t:dataElementPrefix\n\t\t\t\t\t\t\t\t:dataAttributes\n\t\t\t\t\t\t\t\t@visible="$emit('freeze')"\n\t\t\t\t\t\t\t\t@invisible="$emit('unfreeze')"\n\t\t\t\t\t\t\t\t@updateClients="$emit('updateClients', $event)"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-hint="soonHint" class="booking-actions-popup__item-client-action">\n\t\t\t\t\t\t<Icon :name="callIcon" :size="iconSize" :color="iconColor"/>\n\t\t\t\t\t\t<Icon :name="messageIcon" :size="iconSize" :color="iconColor"/>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<template v-else>\n\t\t\t\t\t<Empty\n\t\t\t\t\t\t:id\n\t\t\t\t\t\t@popupShown="$emit('freeze')"\n\t\t\t\t\t\t@popupClosed="$emit('unfreeze')"\n\t\t\t\t\t\t@addClients="$emit('addClients', $event)"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t\t<Note\n\t\t\t\t:id\n\t\t\t\t:dataId\n\t\t\t\t:dataElementPrefix\n\t\t\t\t:note\n\t\t\t\t:dataAttributes\n\t\t\t\t@popupShown="$emit('freeze')"\n\t\t\t\t@popupClosed="$emit('unfreeze')"\n\t\t\t\t@updateNote="$emit('updateNote', $event)"\n\t\t\t/>\n\t\t</div>\n\t`};const D={name:"ConfirmationMenu",emits:["popupShown","popupClosed","updateConfirmationStatus"],props:{id:{type:[Number,String],required:true},isConfirmed:{type:Boolean,required:true},disabled:{type:Boolean,default:false},dataId:{type:[Number,String],default:""},dataElementPrefix:{type:String,default:""}},setup(){const t=E.Set;const e=y.ButtonSize;const n=y.ButtonColor;const o=y.ButtonIcon;const i=null;return{iconSet:t,buttonSize:e,buttonColor:n,buttonIcon:o,menuPopup:i}},computed:{...P.mapGetters({isFeatureEnabled:`${k.Model.Interface}/isFeatureEnabled`}),popupId(){return`booking-confirmation-menu-${this.id}`}},unmounted(){if(this.menuPopup){this.destroy()}},methods:{updateConfirmStatus(t){this.$emit("updateConfirmationStatus",{id:this.id,isConfirmed:t})},openMenu(){var t,e;if(!this.isFeatureEnabled){O.limit.show();return}if(this.disabled){return}if((t=this.menuPopup)!=null&&(e=t.popupWindow)!=null&&e.isShown()){this.destroy();return}const n=this.$refs.button.$el;this.menuPopup=C.MenuManager.create(this.popupId,n,this.getMenuItems(),{className:"booking-confirmation-menu-popup",closeByEsc:true,autoHide:true,offsetTop:0,offsetLeft:n.offsetWidth-n.offsetWidth/2,angle:true,cacheable:true,events:{onClose:()=>this.destroy(),onDestroy:()=>this.unbindScrollEvent()}});this.menuPopup.show();this.bindScrollEvent();this.$emit("popupShown")},getMenuItems(){const t=this.isConfirmed?this.loc("BB_ACTIONS_POPUP_CONFIRMATION_MENU_NOT_CONFIRMED"):this.loc("BB_ACTIONS_POPUP_CONFIRMATION_MENU_CONFIRMED");return[{text:t,onclick:()=>{this.updateConfirmStatus(!this.isConfirmed);this.destroy()}}]},destroy(){C.MenuManager.destroy(this.popupId);this.unbindScrollEvent();this.$emit("popupClosed")},bindScrollEvent(){S.Event.bind(document,"scroll",this.adjustPosition,{capture:true})},unbindScrollEvent(){S.Event.unbind(document,"scroll",this.adjustPosition,{capture:true})},adjustPosition(){var t,e;(t=this.menuPopup)==null?void 0:(e=t.popupWindow)==null?void 0:e.adjustPosition()}},components:{Icon:E.BIcon,Button:y.Button},template:`\n\t\t<Button\n\t\t\t:data-booking-id="dataId"\n\t\t\t:data-element="dataElementPrefix + '-menu-confirmation-button'"\n\t\t\tclass="booking-actions-popup-button-with-chevron"\n\t\t\t:class="{'--lock': !isFeatureEnabled || disabled}"\n\t\t\tbuttonClass="ui-btn-shadow"\n\t\t\t:disabled="disabled || !isFeatureEnabled"\n\t\t\t:text="loc('BB_ACTIONS_POPUP_CONFIRMATION_BTN_LABEL')"\n\t\t\t:size="buttonSize.EXTRA_SMALL"\n\t\t\t:color="buttonColor.LIGHT"\n\t\t\t:round="true"\n\t\t\tref="button"\n\t\t\t@click="openMenu"\n\t\t>\n\t\t\t<Icon v-if="isFeatureEnabled" :name="iconSet.CHEVRON_DOWN"/>\n\t\t\t<Icon v-else :name="iconSet.LOCK"/>\n\t\t</Button>\n\t`};const R={name:"ActionsPopupConfirmation",emits:["open","close","updateConfirmationStatus"],props:{id:{type:[Number,String],required:true},isConfirmed:{type:Boolean,required:true},counters:{type:Array,default:()=>[]},disabled:{type:Boolean,default:false},dataId:{type:[Number,String],default:""},dataElementPrefix:{type:String,default:""}},setup(){const t=E.Set;const e=I.ref(true);return{iconSet:t,isLoading:e}},async mounted(){this.isLoading=false},computed:{delayedCounter(){var t;return(t=this.counters.find((t=>t.type===k.BookingCounterType.Delayed)))==null?void 0:t.value},unconfirmedCounter(){var t;return(t=this.counters.find((t=>t.type===k.BookingCounterType.Unconfirmed)))==null?void 0:t.value},iconColor(){if(this.isConfirmed===false&&!this.unconfirmedCounter&&!this.delayedCounter){return"#BDC1C6"}return"#ffffff"},stateClass(){if(this.isConfirmed){return"--confirmed"}if(this.unconfirmedCounter){return"--not-confirmed"}if(this.delayedCounter){return"--delayed"}return"--awaiting"},stateText(){if(this.isConfirmed){return this.loc("BB_ACTIONS_POPUP_CONFIRMATION_CONFIRMED")}if(this.unconfirmedCounter){return this.loc("BB_ACTIONS_POPUP_CONFIRMATION_NOT_CONFIRMED")}if(this.delayedCounter){return this.loc("BB_ACTIONS_POPUP_CONFIRMATION_DELAYED")}return this.loc("BB_ACTIONS_POPUP_CONFIRMATION_AWAITING")},hasBtnCounter(){if(this.isConfirmed){return false}return Boolean(this.unconfirmedCounter||this.delayedCounter)}},methods:{showHelpDesk(){B.helpDesk.show(k.HelpDesk.BookingActionsConfirmation.code,k.HelpDesk.BookingActionsConfirmation.anchorCode)}},components:{Icon:E.BIcon,Loader:_.Loader,ConfirmationMenu:D},template:`\n\t\t<div\n\t\t\tclass="booking-actions-popup__item booking-actions-popup__item-confirmation-content"\n\t\t\t:class="{ '--disabled': disabled }"\n\t\t>\n\t\t\t<Loader v-if="isLoading" class="booking-actions-popup__item-confirmation-loader"/>\n\t\t\t<template v-else>\n\t\t\t\t<div :class="['booking-actions-popup-item-icon', stateClass]">\n\t\t\t\t\t<Icon :name="iconSet.CHECK" :color="iconColor"/>\n\t\t\t\t</div>\n\t\t\t\t<div class="booking-actions-popup-item-info">\n\t\t\t\t\t<div class="booking-actions-popup-item-title">\n\t\t\t\t\t\t<span>{{ loc('BB_ACTIONS_POPUP_CONFIRMATION_LABEL') }}</span>\n\t\t\t\t\t\t<Icon :name="iconSet.HELP" @click="showHelpDesk"/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\t:class="['booking-actions-popup-item-subtitle', stateClass]"\n\t\t\t\t\t\tdata-element="booking-menu-confirmation-status"\n\t\t\t\t\t\t:data-booking-id="dataId"\n\t\t\t\t\t\t:data-confirmed="isConfirmed"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ stateText }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="booking-actions-popup-item-buttons">\n\t\t\t\t\t<ConfirmationMenu\n\t\t\t\t\t\t:id\n\t\t\t\t\t\t:isConfirmed\n\t\t\t\t\t\t:disabled\n\t\t\t\t\t\t:dataId\n\t\t\t\t\t\t:dataElementPrefix\n\t\t\t\t\t\t@popupShown="$emit('open')"\n\t\t\t\t\t\t@popupClosed="$emit('close')"\n\t\t\t\t\t\t@updateConfirmationStatus="$emit('updateConfirmationStatus', $event)"\n\t\t\t\t\t/>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="hasBtnCounter"\n\t\t\t\t\t\tclass="booking-actions-popup-item-buttons-counter"\n\t\t\t\t\t></div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\t`};const x={name:"ActionsPopupDeal",components:{Button:y.Button,Icon:E.BIcon,Loader:_.Loader},props:{deal:{type:Object,default:null},dealHelper:{type:r.DealHelper,required:true},disabled:{type:Boolean,default:false},dataId:{type:[Number,String],default:""},dataElementPrefix:{type:String,default:""},dataAttributes:{type:Object,default:null}},emits:["freeze","unfreeze"],data(){return{IconSet:E.Set,ButtonSize:y.ButtonSize,ButtonColor:y.ButtonColor,ButtonIcon:y.ButtonIcon,isLoading:false,saveDealDebounce:S.Runtime.debounce(this.saveDeal,10,this)}},computed:{...P.mapGetters({isFeatureEnabled:`${k.Model.Interface}/isFeatureEnabled`}),menuId(){return`${this.dataElementPrefix}-actions-popup-deal-menu-${this.dataId}`},dateFormatted(){if(!this.deal.data.createdTimestamp){return""}const t=a.DateTimeFormat.getFormat("DAY_MONTH_FORMAT");return a.DateTimeFormat.format(t,this.deal.data.createdTimestamp)}},mounted(){this.dialog=new d.Dialog({context:"BOOKING",multiple:false,targetNode:this.getDialogButton(),width:340,height:340,enableSearch:true,dropdownMode:true,preselectedItems:this.deal?[[k.EntitySelectorEntity.Deal,this.deal.value]]:[],entities:[{id:k.EntitySelectorEntity.Deal,dynamicLoad:true,dynamicSearch:true}],events:{onShow:this.freeze,onHide:this.unfreeze,"Item:onSelect":this.itemChange,"Item:onDeselect":this.itemChange}});S.Event.bind(document,"scroll",this.adjustPosition,true)},beforeUnmount(){S.Event.unbind(document,"scroll",this.adjustPosition,true)},methods:{freeze(){this.$emit("freeze")},unfreeze(){var t,e;if((t=this.dialog)!=null&&t.isOpen()||(e=this.getMenu())!=null&&e.getPopupWindow().isShown()){return}this.$emit("unfreeze")},createDeal(){if(!this.isFeatureEnabled){void O.limit.show();return}this.dealHelper.createDeal()},showMenu(){if(!this.isFeatureEnabled){void O.limit.show();return}const t=this.$refs.moreButton.$el;C.MenuManager.destroy(this.menuId);C.MenuManager.show({id:this.menuId,bindElement:t,items:this.getMenuItems(),offsetLeft:t.offsetWidth/2,angle:true,events:{onShow:this.freeze,onAfterClose:this.unfreeze,onDestroy:this.unfreeze}})},getMenuItems(){return[{text:this.loc("BB_ACTIONS_POPUP_DEAL_CHANGE"),onclick:()=>{this.showDealDialog();this.getMenu().close()}},{text:this.loc("BB_ACTIONS_POPUP_DEAL_CLEAR"),onclick:()=>{var t;(t=this.dialog)==null?void 0:t.deselectAll();this.saveDealDebounce(null);this.getMenu().close()}}]},showDealDialog(){if(!this.isFeatureEnabled){void O.limit.show();return}this.dialog.setTargetNode(this.getDialogButton());this.dialog.show()},adjustPosition(){var t;this.dialog.setTargetNode(this.getDialogButton());this.dialog.adjustPosition();(t=this.getMenu())==null?void 0:t.getPopupWindow().adjustPosition()},getMenu(){return C.MenuManager.getMenuById(this.menuId)},openDeal(){this.dealHelper.openDeal()},itemChange(){const t=this.getDealData();this.saveDealDebounce(t);this.dialog.hide()},getDealData(){const t=this.dialog.getSelectedItems()[0];if(!t){return null}return this.dealHelper.mapEntityInfoToDeal(t.getCustomData().get("entityInfo"))},saveDeal(t){this.dealHelper.saveDeal(t)},getDialogButton(){return this.deal?this.$refs.moreButton.$el:this.$refs.addButton.$el},showHelpDesk(){B.helpDesk.show(k.HelpDesk.BookingActionsDeal.code,k.HelpDesk.BookingActionsDeal.anchorCode)}},template:`\n\t\t<div\n\t\t\tclass="booking-actions-popup__item booking-actions-popup__item-deal-content"\n\t\t\t:class="{ '--active': deal }"\n\t\t>\n\t\t\t<Loader v-if="isLoading" class="booking-actions-popup__item-deal-loader" />\n\t\t\t<template v-else>\n\t\t\t\t<div class="booking-actions-popup__item-deal">\n\t\t\t\t\t<div class="booking-actions-popup-item-icon">\n\t\t\t\t\t\t<Icon :name="IconSet.DEAL"/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="booking-actions-popup-item-info">\n\t\t\t\t\t\t<div class="booking-actions-popup-item-title">\n\t\t\t\t\t\t\t<span>{{ loc('BB_ACTIONS_POPUP_DEAL_LABEL') }}</span>\n\t\t\t\t\t\t\t<Icon :name="IconSet.HELP" @click="showHelpDesk" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<template v-if="deal">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass="booking-actions-popup__item-deal-profit"\n\t\t\t\t\t\t\t\t:data-element="dataElementPrefix + '-menu-deal-profit'"\n\t\t\t\t\t\t\t\t:data-profit="deal.data.opportunity"\n\t\t\t\t\t\t\t\tv-bind="dataAttributes"\n\t\t\t\t\t\t\t\tv-html="deal.data.formattedOpportunity"\n\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass="booking-actions-popup-item-subtitle"\n\t\t\t\t\t\t\t\t:data-element="dataElementPrefix + '-menu-deal-ts'"\n\t\t\t\t\t\t\t\t:data-ts="deal.data.createdTimestamp * 1000"\n\t\t\t\t\t\t\t\tv-bind="dataAttributes"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{{ dateFormatted }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t<div class="booking-actions-popup-item-subtitle">\n\t\t\t\t\t\t\t\t{{ loc('BB_ACTIONS_POPUP_DEAL_ADD_LABEL') }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="booking-actions-popup-item-buttons">\n\t\t\t\t\t<template v-if="deal">\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t:data-element="dataElementPrefix + '-menu-deal-open-button'"\n\t\t\t\t\t\t\tv-bind="dataAttributes"\n\t\t\t\t\t\t\tbuttonClass="ui-btn-shadow"\n\t\t\t\t\t\t\t:text="loc('BB_ACTIONS_POPUP_DEAL_OPEN')"\n\t\t\t\t\t\t\t:size="ButtonSize.EXTRA_SMALL"\n\t\t\t\t\t\t\t:color="ButtonColor.LIGHT"\n\t\t\t\t\t\t\t:round="true"\n\t\t\t\t\t\t\t@click="openDeal"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t:data-element="dataElementPrefix + '-menu-deal-more-button'"\n\t\t\t\t\t\t\tv-bind="dataAttributes"\n\t\t\t\t\t\t\tbuttonClass="ui-btn-shadow"\n\t\t\t\t\t\t\t:size="ButtonSize.EXTRA_SMALL"\n\t\t\t\t\t\t\t:color="ButtonColor.LIGHT"\n\t\t\t\t\t\t\t:round="true"\n\t\t\t\t\t\t\tref="moreButton"\n\t\t\t\t\t\t\t@click="showMenu"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Icon :name="IconSet.MORE"/>\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t:data-element="dataElementPrefix + '-menu-deal-create-button'"\n\t\t\t\t\t\t\tv-bind="dataAttributes"\n\t\t\t\t\t\t\tclass="booking-actions-popup-plus-button"\n\t\t\t\t\t\t\t:class="{'--lock': !isFeatureEnabled}"\n\t\t\t\t\t\t\tbuttonClass="ui-btn-shadow"\n\t\t\t\t\t\t\t:size="ButtonSize.EXTRA_SMALL"\n\t\t\t\t\t\t\t:color="ButtonColor.LIGHT"\n\t\t\t\t\t\t\t:round="true"\n\t\t\t\t\t\t\t@click="createDeal"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Icon v-if="isFeatureEnabled" :name="IconSet.PLUS_30"/>\n\t\t\t\t\t\t\t<Icon v-else :name="IconSet.LOCK"/>\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tclass="booking-menu-deal-add-button"\n\t\t\t\t\t\t\t:class="{'--lock': !isFeatureEnabled}"\n\t\t\t\t\t\t\t:data-element="dataElementPrefix + '-menu-deal-add-button'"\n\t\t\t\t\t\t\tv-bind="dataAttributes"\n\t\t\t\t\t\t\tbuttonClass="ui-btn-shadow"\n\t\t\t\t\t\t\t:text="loc('BB_ACTIONS_POPUP_DEAL_BTN_LABEL')"\n\t\t\t\t\t\t\t:size="ButtonSize.EXTRA_SMALL"\n\t\t\t\t\t\t\t:color="ButtonColor.LIGHT"\n\t\t\t\t\t\t\t:round="true"\n\t\t\t\t\t\t\tref="addButton"\n\t\t\t\t\t\t\t@click="showDealDialog"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Icon v-if="!isFeatureEnabled" :name="IconSet.LOCK"/>\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</template>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\t`};const z={name:"ActionsPopupDocument",emits:["link"],props:{id:{type:[Number,String],required:true},loading:{type:Boolean,default:false},disabled:{type:Boolean,default:false},dataId:{type:[Number,String],default:""},dataElementPrefix:{type:String,default:""}},setup(){const t=E.Set;const e=y.ButtonSize;const n=y.ButtonColor;const o=y.ButtonIcon;return{iconSet:t,buttonSize:e,buttonColor:n,buttonIcon:o}},async mounted(){await u.bookingActionsService.getDocData();this.isLoading=false},methods:{linkDoc(){this.$emit("link")}},components:{Button:y.Button,Icon:E.BIcon,Loader:_.Loader},template:`\n\t\t<div class="booking-actions-popup__item booking-actions-popup__item-doc-content --disabled">\n\t\t\t<Loader v-if="loading" class="booking-actions-popup__item-doc-loader"/>\n\t\t\t<template v-else>\n\t\t\t\t<div class="booking-actions-popup__item-doc">\n\t\t\t\t\t<div class="booking-actions-popup-item-icon">\n\t\t\t\t\t\t<Icon :name="iconSet.DOCUMENT"/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="booking-actions-popup-item-info">\n\t\t\t\t\t\t<div class="booking-actions-popup-item-title">\n\t\t\t\t\t\t\t<span>{{ loc('BB_ACTIONS_POPUP_DOC_LABEL') }}</span>\n\t\t\t\t\t\t\t<Icon :name="iconSet.HELP"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="booking-actions-popup-item-subtitle">\n\t\t\t\t\t\t\t{{ loc('BB_ACTIONS_POPUP_DOC_ADD_LABEL') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="booking-actions-popup-item-buttons">\n\t\t\t\t\t<Button\n\t\t\t\t\t\tclass="booking-actions-popup-plus-button"\n\t\t\t\t\t\tbuttonClass="ui-btn-shadow"\n\t\t\t\t\t\t:size="buttonSize.EXTRA_SMALL"\n\t\t\t\t\t\t:color="buttonColor.LIGHT"\n\t\t\t\t\t\t:disabled="disabled"\n\t\t\t\t\t\t:round="true"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Icon :name="iconSet.PLUS_30"/>\n\t\t\t\t\t</Button>\n\t\t\t\t\t<Button\n\t\t\t\t\t\tbuttonClass="ui-btn-shadow"\n\t\t\t\t\t\t:text="loc('BB_ACTIONS_POPUP_DOC_BTN_LABEL')"\n\t\t\t\t\t\t:size="buttonSize.EXTRA_SMALL"\n\t\t\t\t\t\t:color="buttonColor.LIGHT"\n\t\t\t\t\t\t:disabled="disabled"\n\t\t\t\t\t\t:round="true"\n\t\t\t\t\t\t@click="linkDoc"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<div class="booking-booking-actions-popup-label">\n\t\t\t\t{{ loc('BB_ACTIONS_POPUP_LABEL_SOON') }}\n\t\t\t</div>\n\t\t</div>\n\t`};const $={name:"ExtraResourcesDialog",props:{booking:{type:Object,required:true},resourceId:{type:Number,required:true}},emits:["save"],computed:{...P.mapGetters({resources:`${k.Model.Resources}/get`,selectedDateTs:`${k.Model.Interface}/selectedDateTs`,getByInterval:`${k.Model.Bookings}/getByInterval`}),extraResourcesIds(){return this.booking.resourcesIds.filter((t=>t!==this.resourceId))},bookings(){return this.getByInterval(this.booking.dateFromTs,this.booking.dateToTs)},resourceBookingsMap(){const t=new Map;const e=this.booking.id;this.bookings.filter((t=>t.id!==e)).forEach((e=>{e.resourcesIds.forEach((n=>{const o=t.get(n)||[];o.push(e.id);t.set(n,o)}))}));return t},excludedResourceIds(){return new Set([this.resourceId])}},watch:{resources(t){this.addItems(t)}},created(){void this.loadResources()},mounted(){this.dialog=new d.Dialog({id:`booking-booking-extra-resources-selector-${this.booking.id}`,targetNode:this.$refs.dialog,preselectedItems:this.extraResourcesIds.map((t=>[k.EntitySelectorEntity.Resource,t])),width:340,height:Math.min(window.innerHeight-380,400),dropdownMode:true,entities:[{id:k.EntitySelectorEntity.Resource,dynamicLoad:true,dynamicSearch:true}],popupOptions:{id:`booking-actions-popup-extra-resources-dialog-${this.booking.id}-${this.resourceId}`,className:"booking--booking--actions-popup--extra-resources-info--extra-resources-dialog"},enableSearch:true,searchOptions:{allowCreateItem:false},events:{onLoad:()=>{this.addItems(this.resources)},onHide:()=>{const t=this.dialog.getSelectedItems().map((t=>t.id));t.push(this.resourceId);this.$emit("save",t)},"Item:onBeforeSelect":t=>{const e=t.data.item;if((this.resourceBookingsMap.get(e.id)||[]).length>1){t.defaultPrevented=true}}}});this.dialog.show()},unmounted(){var t;(t=this.dialog)==null?void 0:t.destroy==null?void 0:t.destroy()},methods:{async loadResources(){await c.resourceDialogService.fillDialog(this.selectedDateTs/1e3)},getItemOptions(t){return{id:t.id,entityId:k.EntitySelectorEntity.Resource,title:t.name,subtitle:"",avatar:"/bitrix/js/booking/component/actions-popup/images/extra-resource-icon.svg",avatarOptions:{bgImage:"/bitrix/js/booking/component/actions-popup/images/extra-resource-icon.svg",bgColor:"rgba(230, 244, 255, 1)",borderRadius:"50%"},tabs:k.EntitySelectorTab.Recent,selected:this.isItemSelected(t.id),deselectable:!this.excludedResourceIds.has(t.id),nodeAttributes:{"data-id":`${this.booking.id}-${t.id}`,"data-element":"booking-extra-resources-dialog-item"},badges:[this.getItemBadge(t)],badgesOptions:{justifyContent:"right"}}},isItemSelected(t){return this.extraResourcesIds.includes(t)},getItemBadge(t){const e=(this.resourceBookingsMap.get(t.id)||[]).length;if(e>=2){return{title:this.loc("BOOKING_ACTIONS_POPUP_EXTRA_RESOURCES_INFO_RESOURCE_SELECTOR_BADGE_BUSY"),textColor:"rgba(255, 255, 255, 1)",bgColor:"#e92f2a"}}if(e>0){return{title:this.loc("BOOKING_ACTIONS_POPUP_EXTRA_RESOURCES_INFO_RESOURCE_SELECTOR_BADGE_OVERBOOKING"),textColor:"rgba(255, 255, 255, 1)",bgColor:"rgba(250, 167, 44, 1)"}}return{}},addItems(t){const e=t.filter((({id:t})=>!this.excludedResourceIds.has(t))).reduce(((t,e)=>({...t,[e.id]:this.getItemOptions(e)})),{});Object.values(e).forEach((t=>this.dialog.addItem(t)));const n=this.dialog.getItems().map((t=>t.getId())).filter((t=>e[t]));this.dialog.removeItems();n.forEach((t=>this.dialog.addItem(e[t])));const o=this.dialog.getActiveTab();if(o){o.getContainer().append(o.getRootNode().getChildrenContainer());o.render()}}},template:`\n\t\t<div ref="dialog"></div>\n\t`};const U={name:"ExtraResourcesInfoPopupItem",components:{Icon:E.BIcon},props:{title:{type:String,required:true},overbooking:{type:Boolean,required:true}},setup(){const t="var(--ui-color-accent-main-primary)";const e=16;return{Outline:E.Outline,iconColor:t,iconSize:e}},computed:{labelHTML(){const t=new m.Label({color:m.LabelColor.WARNING,size:m.LabelSize.SM,text:this.loc("BOOKING_ACTIONS_POPUP_EXTRA_RESOURCES_INFO_OVERBOOKING"),fill:true});return t.render().outerHTML}},template:`\n\t\t<div class="booking--extra-resources-info_element">\n\t\t\t<div class="booking--extra-resources-info_element-icon \u2014ui-context-content-light">\n\t\t\t\t<Icon :name="Outline.PRODUCT" :size="iconSize" :color="iconColor"/>\n\t\t\t</div>\n\n\t\t\t<div class="booking--extra-resources-info_element-text" :title="title">\n\t\t\t\t{{ title }}\n\t\t\t</div>\n\n\t\t\t<div \n\t\t\t\tv-if="overbooking"\n\t\t\t\tclass="booking--extra-resources-info_element-overbooking"\n\t\t\t\t v-html="labelHTML"\n\t\t\t></div>\n\t\t</div>\n\t`};const H={name:"ExtraResourcesInfoPopup",components:{Popup:p.Popup,ExtraResourcesInfoPopupItem:U},props:{visible:{type:Boolean,default:false},bindElement:{type:HTMLElement,required:true},resourceId:{type:Number,required:true},booking:{type:Object,required:true}},emits:["update:visible"],computed:{...P.mapGetters({getResourcesByIds:`${k.Model.Resources}/getByIds`,getByInterval:`${k.Model.Bookings}/getByInterval`}),config(){return{bindElement:this.bindElement,offsetTop:10,offsetLeft:-65,padding:14,contentPadding:30,height:300,width:340,minWidth:340,maxWidth:400,bindOptions:{forceBindPosition:true,position:"bottom"}}},resources(){const t=this.booking.resourcesIds.filter((t=>t!==this.resourceId));return this.getResourcesByIds(t)},bookings(){return this.getByInterval(this.booking.dateFromTs,this.booking.dateToTs)},resourceBookingsMap(){const t=new Map;this.bookings.forEach((e=>{e.resourcesIds.forEach((n=>{const o=t.get(n)||[];o.push(e.id);t.set(n,o)}))}));return t}},methods:{closePopup(){this.$emit("update:visible",false)},isOverbooking(t){const e=(this.resourceBookingsMap.get(t.id)||[]).length;return e>1}},template:`\n\t\t<Popup\n\t\t\tref="popup"\n\t\t\tid="booking--booking--extra-resources-info"\n\t\t\t:config\n\t\t\t@close="closePopup"\n\t\t>\n\t\t\t<div class="booking--extra-resources-info_container">\n\t\t\t\t<div class="booking--extra-resources-info_content">\n\t\t\t\t\t<template v-for="resource in resources" :key="resource.id">\n\t\t\t\t\t\t<ExtraResourcesInfoPopupItem\n\t\t\t\t\t\t\t:title="resource.name"\n\t\t\t\t\t\t\t:overbooking="isOverbooking(resource)"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</template>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</Popup>\n\t`};const F={name:"ExtraResourceInfo",components:{UiButton:y.Button,UiIcon:E.BIcon,ExtraResourcesDialog:$,ExtraResourcesInfoPopup:H},props:{id:{type:[Number,String],required:true},resourceId:{type:Number,required:true}},emits:["freeze","unfreeze"],setup(){const t=E.Outline.PRODUCT;const e=E.Outline.EDIT_M;const n=E.Set.HELP;return{iconProductName:t,iconEditName:e,iconHelpName:n,AirButtonStyle:y.AirButtonStyle,ButtonColor:y.ButtonColor,ButtonSize:y.ButtonSize,ButtonStyle:y.ButtonStyle}},data(){return{shownResourcesSelector:false,showDialogInfo:false}},computed:{...P.mapGetters({getBookingById:`${k.Model.Bookings}/getById`}),booking(){return this.getBookingById(this.id)},subtitle(){if(this.hasExtraResources){const t=this.extraResourcesIds.length;return S.Loc.getMessagePlural("BOOKING_ACTIONS_POPUP_EXTRA_RESOURCES_INFO_SUBTITLE",t,{"#COUNT#":t})}return this.loc("BOOKING_ACTIONS_POPUP_EXTRA_RESOURCES_INFO_SUBTITLE_EMPTY")},extraResourcesIds(){return this.booking.resourcesIds.slice(1)},hasExtraResources(){return this.extraResourcesIds.length>0},iconProductColor(){return this.hasExtraResources?"rgba(0, 117, 255, 1)":"rgba(201, 204, 208, 1)"}},methods:{toggleResourcesSelector(){this.shownResourcesSelector=true;this.$emit("freeze")},toggleResourcesInfo(){this.showDialogInfo=this.hasExtraResources?!this.showDialogInfo:this.showDialogInfo},hideResourcesSelector(){this.shownResourcesSelector=false;this.$emit("unfreeze")},saveBookingExtraResources(t){this.hideResourcesSelector();if(!this.hasExtraResourcesChanged(t)){return}const e=new Set([this.booking.resourcesIds[0],...t]);void l.bookingService.update({id:this.booking.id,resourcesIds:[...e]})},hasExtraResourcesChanged(t){const e=this.booking.resourcesIds.slice(1).sort();if(e.length!==t.length){return true}return[...e].sort().join(",")!==[...t].sort().join(",")}},template:`\n\t\t<div class="booking-actions-popup__item booking--actions-popup--extra-resources-info">\n\t\t\t<div class="booking--actions-popup--extra-resources-info__row">\n\t\t\t\t<div\n\t\t\t\t\t:class="[\n\t\t\t\t\t\t'booking-actions-popup-item-icon',\n\t\t\t\t\t\t'booking--actions-popup--extra-resources-info__icon-product-bg',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'--active': hasExtraResources\n\t\t\t\t\t\t}\n\t\t\t\t\t]"\n\t\t\t\t>\n\t\t\t\t\t<UiIcon\n\t\t\t\t\t\t:name="iconProductName"\n\t\t\t\t\t\t:color="iconProductColor"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class="booking--actions-popup--extra-resources-info__content">\n\t\t\t\t\t<div class="booking--actions-popup--extra-resources-info__title">\n\t\t\t\t\t\t<span>{{ loc('BOOKING_ACTIONS_POPUP_EXTRA_RESOURCES_INFO_TITLE') }}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="booking--actions-popup--extra-resources-info__subtitle">\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tref="button"\n\t\t\t\t\t\t\tdata-element="amount-additional-resources"\n\t\t\t\t\t\t\t:class="{ '--fill': hasExtraResources }"\n\t\t\t\t\t\t\t@click="toggleResourcesInfo"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ subtitle }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<ExtraResourcesInfoPopup\n\t\t\t\t\t\t\tv-if="showDialogInfo"\n\t\t\t\t\t\t\tv-model:visible="showDialogInfo"\n\t\t\t\t\t\t\t:bindElement="$refs.button"\n\t\t\t\t\t\t\t:booking\n\t\t\t\t\t\t\t:resourceId\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div ref="edit" class="booking--actions-popup--extra-resources-info__icon-edit">\n\t\t\t\t\t<UiButton\n\t\t\t\t\t\tdata-element="btn-toggle-resources-selector"\n\t\t\t\t\t\t:icon="iconEditName"\n\t\t\t\t\t\t:buttonClass="['--air', ButtonStyle.NO_CAPS, AirButtonStyle.OUTLINE_NO_ACCENT]"\n\t\t\t\t\t\t:color="ButtonColor.LIGHT_BORDER"\n\t\t\t\t\t\t:size="ButtonSize.SMALL"\n\t\t\t\t\t\t@click="toggleResourcesSelector"\n\t\t\t\t\t/>\n\t\t\t\t\t<ExtraResourcesDialog\n\t\t\t\t\t\tv-if="shownResourcesSelector"\n\t\t\t\t\t\t:booking\n\t\t\t\t\t\t:resourceId\n\t\t\t\t\t\t@save="saveBookingExtraResources"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const V={name:"ActionsPopupFullForm",directives:{hint:h.hint},computed:{arrowIcon(){return E.Set.CHEVRON_RIGHT},arrowIconSize(){return 12},arrowIconColor(){return"var(--ui-color-palette-gray-40)"},soonHint(){return{text:this.loc("BOOKING_BOOKING_SOON_HINT"),popupOptions:{offsetLeft:60}}}},components:{Icon:E.BIcon},template:`\n\t\t<div\n\t\t\tv-hint="soonHint"\n\t\t\tclass="booking-actions-popup__item booking-actions-popup__item-full-form-content --disabled"\n\t\t\trole="button"\n\t\t\ttabindex="0"\n\t\t>\n\t\t\t<div class="booking-actions-popup__item-full-form-label">\n\t\t\t\t{{ loc('BB_ACTIONS_POPUP_FULL_FORM_LABEL') }}\n\t\t\t</div>\n\t\t\t<div class="booking-actions-popup__item-full-form-icon">\n\t\t\t\t<Icon :name="arrowIcon" :size="arrowIconSize" :color="arrowIconColor"/>\n\t\t\t</div>\n\t\t</div>\n\t`};const X={components:{BIcon:E.BIcon,CyclePopup:g.CyclePopup},props:{bookingId:{type:[Number,String],default:0},waitListItemId:{type:[Number,String],default:0}},emits:["freeze","unfreeze"],setup(){return{Main:b.Main}},data(){return{nowTs:Date.now(),isPopupShown:false}},computed:{booking(){return this.$store.getters[`${k.Model.Bookings}/getById`](this.bookingId)},waitListItem(){return this.$store.getters[`${k.Model.WaitList}/getById`](this.waitListItemId)},scrollToCard(){return{[this.isUnconfirmed]:g.CardId.Unconfirmed,[this.isConfirmed]:g.CardId.Confirmed,[this.isLate]:g.CardId.Late,[this.isWaitListItem]:g.CardId.Waitlist,[this.isOverbooking]:g.CardId.Overbooking}.true},isUnconfirmed(){if(!this.booking||this.isConfirmed){return false}return this.booking.counter>0},isConfirmed(){if(!this.booking){return false}return this.booking.isConfirmed},isLate(){if(!this.booking){return false}const t=this.nowTs>this.booking.dateFromTs;const e=this.booking.visitStatus===k.VisitStatus.Unknown;const n=this.booking.visitStatus===k.VisitStatus.NotVisited;return t&&e||n},isWaitListItem(){return Boolean(this.waitListItem)},isOverbooking(){return this.$store.getters[`${k.Model.Bookings}/overbookingMap`].has(this.bookingId)}},mounted(){this.interval=setInterval((()=>{this.nowTs=Date.now()}),5*1e3);void this.tryShowAhaMoment()},beforeUnmount(){clearInterval(this.interval)},methods:{showPopup(){if(f.ahaMoments.shouldShow(k.AhaMoment.CyclePopup)){f.ahaMoments.setShown(k.AhaMoment.CyclePopup)}this.isPopupShown=true;this.$emit("freeze")},hidePopup(){this.isPopupShown=false;this.$emit("unfreeze")},async tryShowAhaMoment(){if(f.ahaMoments.shouldShow(k.AhaMoment.CyclePopup)){await f.ahaMoments.show({id:"booking-cycle-popup",ahaMoment:k.AhaMoment.CyclePopup,title:this.loc("BOOKING_ACTIONS_POPUP_INFO_AHA_TITLE"),text:this.loc("BOOKING_ACTIONS_POPUP_INFO_AHA_TEXT"),target:this.$refs.container,top:true,isPulsarTransparent:true});f.ahaMoments.setShown(k.AhaMoment.CyclePopup)}}},template:`\n\t\t<div class="booking-actions-popup-info" ref="container" @click="showPopup">\n\t\t\t<BIcon :name="Main.INFO_1"/>\n\t\t</div>\n\t\t<CyclePopup v-if="isPopupShown" :scrollToCard="scrollToCard" @close="hidePopup"/>\n\t`};const G={name:"ActionsPopupMessage",emits:["open","close","updateNotificationType"],props:{id:{type:[Number,String],required:true},clientData:{type:Object,default:null},loading:{type:Boolean,default:false},disabled:{type:Boolean,default:false},dataId:{type:[Number,String],default:""},dataElementPrefix:{type:String,default:""}},components:{Button:y.Button,Icon:E.BIcon,Loader:_.Loader},setup(){const t=E.Set;const e=y.ButtonSize;const n=y.ButtonColor;const o=y.ButtonIcon;return{iconSet:t,buttonSize:e,buttonColor:n,buttonIcon:o}},computed:{...P.mapGetters({dictionary:`${k.Model.Dictionary}/getNotifications`,isCurrentSenderAvailable:`${k.Model.Interface}/isCurrentSenderAvailable`,isFeatureEnabled:`${k.Model.Interface}/isFeatureEnabled`}),menuId(){return`booking-message-menu-${this.id}`},client(){const t=this.clientData;return t?this.$store.getters["clients/getByClientData"](t):null},status(){return this.$store.getters[`${k.Model.MessageStatus}/getById`](this.id)},semantic(){var t;return((t=this.status)==null?void 0:t.semantic)||""},iconColor(){const t={success:"#ffffff",primary:"#ffffff",failure:"#ffffff"};return t[this.semantic]||""},failure(){return this.semantic==="failure"}},methods:{openMenu(){var t,e;if(!this.isFeatureEnabled){O.limit.show();return}if(this.disabled||this.status.isDisabled&&this.isCurrentSenderAvailable){return}if((t=this.getMenu())!=null&&(e=t.getPopupWindow())!=null&&e.isShown()){this.destroyMenu();return}const n=this.$refs.button.$el;C.MenuManager.create(this.menuId,n,this.getMenuItems(),{autoHide:true,offsetTop:0,offsetLeft:n.offsetWidth-n.offsetWidth/2,angle:true,events:{onClose:this.destroyMenu,onDestroy:this.destroyMenu}}).show();this.$emit("freeze");S.Event.bind(document,"scroll",this.adjustPosition,{capture:true})},getMenuItems(){return Object.values(this.dictionary).map((({name:t,value:e})=>({text:t,onclick:()=>this.sendMessage(e),disabled:e===this.dictionary.Feedback.value})))},sendMessage(t){this.destroyMenu();this.$emit("updateNotificationType",{id:this.id,notificationType:t})},destroyMenu(){C.MenuManager.destroy(this.menuId);this.$emit("close");S.Event.unbind(document,"scroll",this.adjustPosition,{capture:true})},adjustPosition(){var t,e;(t=this.getMenu())==null?void 0:(e=t.getPopupWindow())==null?void 0:e.adjustPosition()},getMenu(){return C.MenuManager.getMenuById(this.menuId)},showHelpDesk(){B.helpDesk.show(k.HelpDesk.BookingActionsMessage.code,k.HelpDesk.BookingActionsMessage.anchorCode)}},template:`\n\t\t<div\n\t\t\tclass="booking-actions-popup__item booking-actions-popup__item-message-content"\n\t\t\t:class="{'--disabled': disabled || !isCurrentSenderAvailable}"\n\t\t>\n\t\t\t<Loader v-if="loading" class="booking-actions-popup__item-message-loader"/>\n\t\t\t<template v-else>\n\t\t\t\t<div\n\t\t\t\t\tclass="booking-actions-popup-item-icon"\n\t\t\t\t\t:class="'--' + semantic || 'none'"\n\t\t\t\t>\n\t\t\t\t\t<Icon\n\t\t\t\t\t\t:name="iconSet.SMS"\n\t\t\t\t\t\t:color="iconColor"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class="booking-actions-popup-item-info">\n\t\t\t\t\t<div class="booking-actions-popup-item-title">\n\t\t\t\t\t\t<span :title="status?.title">{{ status?.title || '\u0421\u041c\u0421 \u043a\u043b\u0438\u0435\u043d\u0442\u0443' }}</span>\n\t\t\t\t\t\t<Icon :name="iconSet.HELP" @click="showHelpDesk"/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="booking-actions-popup-item-subtitle"\n\t\t\t\t\t\t:class="'--' + semantic || 'none'"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ status?.description || '\u041d\u0435 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043e' }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="booking-actions-popup-item-buttons">\n\t\t\t\t\t<Button\n\t\t\t\t\t\t:data-element="dataElementPrefix + '-menu-message-button'"\n\t\t\t\t\t\t:data-booking-id="dataId"\n\t\t\t\t\t\t:disabled="disabled || (status?.isDisabled && isCurrentSenderAvailable)"\n\t\t\t\t\t\tclass="booking-actions-popup-button-with-chevron"\n\t\t\t\t\t\t:class="{\n\t\t\t\t\t\t\t'--lock': !isFeatureEnabled,\n\t\t\t\t\t\t\t'--disabled': disabled || (status?.isDisabled && isCurrentSenderAvailable)\n\t\t\t\t\t\t}"\n\t\t\t\t\t\tbuttonClass="ui-btn-shadow"\n\t\t\t\t\t\t:text="loc('BB_ACTIONS_POPUP_MESSAGE_BUTTON_SEND')"\n\t\t\t\t\t\t:size="buttonSize.EXTRA_SMALL"\n\t\t\t\t\t\t:color="buttonColor.LIGHT"\n\t\t\t\t\t\t:round="true"\n\t\t\t\t\t\tref="button"\n\t\t\t\t\t\t@click="openMenu"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Icon v-if="isFeatureEnabled" :name="iconSet.CHEVRON_DOWN"/>\n\t\t\t\t\t\t<Icon v-else :name="iconSet.LOCK"/>\n\t\t\t\t\t</Button>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="failure"\n\t\t\t\t\t\tclass="booking-actions-popup-item-buttons-counter"\n\t\t\t\t\t></div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<div\n\t\t\t\tv-if="!isCurrentSenderAvailable"\n\t\t\t\tclass="booking-booking-actions-popup-label"\n\t\t\t>\n\t\t\t\t{{ loc('BB_ACTIONS_POPUP_LABEL_SOON') }}\n\t\t\t</div>\n\t\t</div>\n\t`};const j={name:"RemoveButton",components:{Icon:E.BIcon},props:{showLabel:{type:Boolean,default:false},dataAttributes:{type:Object,default:()=>({})}},emits:["remove"],setup(){const t=E.Set;return{iconSet:t}},template:`\n\t\t<div\n\t\t\tclass="booking-actions-popup__item-remove-button"\n\t\t\t:title="loc('BB_ACTIONS_POPUP_OVERBOOKING_REMOVE')"\n\t\t\tv-bind="dataAttributes"\n\t\t\t@click="$emit('remove')"\n\t\t>\n\t\t\t<Icon :name="iconSet.TRASH_BIN"/>\n\t\t\t<div v-if="showLabel" class="booking-actions-popup__item-overbooking-label">\n\t\t\t\t{{ loc('BB_ACTIONS_POPUP_OVERBOOKING_REMOVE') }}\n\t\t\t</div>\n\t\t</div>\n\t`};const W={name:"VisitMenu",emits:["popupShown","popupClosed","update:status"],props:{id:{type:Number,required:true},disabled:{type:Boolean,default:false},dataId:{type:[Number,String],required:true},dataElementPrefix:{type:String,default:""}},data(){return{IconSet:E.Set,ButtonSize:y.ButtonSize,ButtonColor:y.ButtonColor,ButtonIcon:y.ButtonIcon,menuPopup:null}},computed:{...P.mapGetters({dictionary:`${k.Model.Dictionary}/getBookingVisitStatuses`,isFeatureEnabled:`${k.Model.Interface}/isFeatureEnabled`}),popupId(){return`booking-visit-menu-${this.id}`}},unmounted(){if(this.menuPopup){this.destroy()}},methods:{updateVisitStatus(t){this.$emit("update:status",{id:this.id,visitStatus:t})},openMenu(){var t,e;if(this.disabled){return}if(!this.isFeatureEnabled){O.limit.show();return}if((t=this.menuPopup)!=null&&(e=t.popupWindow)!=null&&e.isShown()){this.destroy();return}const n=this.$refs.button.$el;this.menuPopup=C.MenuManager.create(this.popupId,n,this.getMenuItems(),{autoHide:true,offsetTop:0,offsetLeft:n.offsetWidth-n.offsetWidth/2,angle:true,events:{onClose:()=>this.destroy(),onDestroy:()=>this.unbindScrollEvent()}});this.menuPopup.show();this.bindScrollEvent();this.$emit("popupShown")},getMenuItems(){return[{text:this.loc("BB_ACTIONS_POPUP_VISIT_BTN_LABEL_UNKNOWN"),onclick:()=>this.setVisitStatus(this.dictionary.Unknown)},{text:this.loc("BB_ACTIONS_POPUP_VISIT_BTN_LABEL_VISITED"),onclick:()=>this.setVisitStatus(this.dictionary.Visited)},{text:this.loc("BB_ACTIONS_POPUP_VISIT_BTN_LABEL_NOT_VISITED"),onclick:()=>this.setVisitStatus(this.dictionary.NotVisited)}]},setVisitStatus(t){this.updateVisitStatus(t);this.destroy()},destroy(){C.MenuManager.destroy(this.popupId);this.unbindScrollEvent();this.$emit("popupClosed")},bindScrollEvent(){S.Event.bind(document,"scroll",this.adjustPosition,{capture:true})},unbindScrollEvent(){S.Event.unbind(document,"scroll",this.adjustPosition,{capture:true})},adjustPosition(){var t,e;(t=this.menuPopup)==null?void 0:(e=t.popupWindow)==null?void 0:e.adjustPosition()}},components:{Icon:E.BIcon,Button:y.Button},template:`\n\t\t<Button\n\t\t\t:data-element="dataElementPrefix + '-menu-visit-button'"\n\t\t\t:data-booking-id="dataId"\n\t\t\t:disabled="disabled || !isFeatureEnabled"\n\t\t\tclass="booking-actions-popup-button-with-chevron"\n\t\t\t:class="{'--lock': !isFeatureEnabled || disabled}"\n\t\t\tbuttonClass="ui-btn-shadow"\n\t\t\t:text="loc('BB_ACTIONS_POPUP_VISIT_BTN_LABEL')"\n\t\t\t:size="ButtonSize.EXTRA_SMALL"\n\t\t\t:color="ButtonColor.LIGHT"\n\t\t\t:round="true"\n\t\t\tref="button"\n\t\t\t@click="openMenu"\n\t\t>\n\t\t\t<Icon v-if="isFeatureEnabled" :name="IconSet.CHEVRON_DOWN"/>\n\t\t\t<Icon v-else :name="IconSet.LOCK"/>\n\t\t</Button>\n\t`};const q={name:"ActionsPopupVisit",emits:["freeze","unfreeze","update:visitStatus"],props:{id:{type:[Number,String],required:true},visitStatus:{type:String,required:true},hasClients:{type:Boolean,default:false},disabled:{type:Boolean,default:false},dataId:{type:[Number,String],required:true},dataElementPrefix:{type:String,default:""}},setup(){const t=E.Set;const e=I.ref(true);return{iconSet:t,isLoading:e}},async mounted(){this.isLoading=false},methods:{showHelpDesk(){B.helpDesk.show(k.HelpDesk.BookingActionsVisit.code,k.HelpDesk.BookingActionsVisit.anchorCode)}},computed:{...P.mapGetters({dictionary:`${k.Model.Dictionary}/getBookingVisitStatuses`}),getLocVisitStatus(){switch(this.visitStatus){case this.dictionary.Visited:return this.loc("BB_ACTIONS_POPUP_VISIT_BTN_LABEL_VISITED");case this.dictionary.NotVisited:return this.loc("BB_ACTIONS_POPUP_VISIT_BTN_LABEL_NOT_VISITED");default:return this.hasClients?this.loc("BB_ACTIONS_POPUP_VISIT_BTN_LABEL_UNKNOWN"):this.loc("BB_ACTIONS_POPUP_VISIT_ADD_LABEL")}},getVisitInfoStyles(){switch(this.visitStatus){case this.dictionary.Visited:return"--visited";case this.dictionary.NotVisited:return"--not-visited";default:return"--unknown"}},cardIconColor(){switch(this.visitStatus){case this.dictionary.NotVisited:case this.dictionary.Visited:return"var(--ui-color-palette-white-base)";default:return"var(--ui-color-palette-gray-20)"}},iconClass(){switch(this.visitStatus){case this.dictionary.Visited:return"--visited";case this.dictionary.NotVisited:return"--not-visited";default:return""}}},components:{Icon:E.BIcon,Loader:_.Loader,VisitMenu:W},template:`\n\t\t<div\n\t\t\tclass="booking-actions-popup__item booking-actions-popup__item-visit-content"\n\t\t\t:class="{'--disabled': disabled}"\n\t\t>\n\t\t\t<Loader v-if="isLoading" class="booking-actions-popup__item-visit-loader"/>\n\t\t\t<template v-else>\n\t\t\t\t<div :class="['booking-actions-popup-item-icon', iconClass]">\n\t\t\t\t\t<Icon :name="iconSet.CUSTOMER_CARD" :color="cardIconColor"/>\n\t\t\t\t</div>\n\t\t\t\t<div class="booking-actions-popup-item-info">\n\t\t\t\t\t<div class="booking-actions-popup-item-title">\n\t\t\t\t\t\t<span>{{ loc('BB_ACTIONS_POPUP_VISIT_LABEL') }}</span>\n\t\t\t\t\t\t<Icon :name="iconSet.HELP" @click="showHelpDesk"/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\t:class="['booking-actions-popup-item-subtitle', getVisitInfoStyles]"\n\t\t\t\t\t\t:data-element="dataElementPrefix + '-menu-visit-status'"\n\t\t\t\t\t\t:data-booking-id="id"\n\t\t\t\t\t\t:data-visit-status="visitStatus"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ getLocVisitStatus }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="booking-actions-popup-item-buttons">\n\t\t\t\t\t<VisitMenu\n\t\t\t\t\t\t:id\n\t\t\t\t\t\t:dataId\n\t\t\t\t\t\t:dataElementPrefix\n\t\t\t\t\t\t:disabled\n\t\t\t\t\t\t@popupShown="$emit('freeze')"\n\t\t\t\t\t\t@popupClosed="$emit('unfreeze')"\n\t\t\t\t\t\t@update:status="$emit('update:visitStatus', $event)"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\t`};t.ActionsPopup=N;t.Client=w;t.Confirmation=R;t.Deal=x;t.Document=z;t.ExtraResourcesInfo=F;t.FullForm=V;t.Info=X;t.Message=G;t.RemoveButton=j;t.Visit=q})(this.BX.Booking.Component=this.BX.Booking.Component||{},BX.Booking.Component,BX.SidePanel,BX.Vue3.Directives,BX.Booking.Component,BX.Booking.Component,BX.Main,BX.Booking.Lib,BX.Booking.Provider.Service,BX.Booking.Provider.Service,BX.UI.EntitySelector,BX.Booking.Provider.Service,BX.Booking.Component,BX.UI,BX.Vue3.Directives,BX.UI.IconSet,BX.Booking.Component,BX.Booking.Lib,BX.Vue3,BX,BX.Booking.Lib,BX.Booking.Component,BX,BX.Main,BX.Vue3.Vuex,BX.UI.IconSet,BX.Booking.Const,BX.Booking.Lib,BX.Booking.Component);
//# sourceMappingURL=actions-popup.bundle.map.js