jn.define("disk/in-app-url/routes",((e,o,t)=>{const{showToast:s}=e("toast");const{URL:r}=e("utils/url");const{Loc:n}=e("loc");const{openFolder:i}=e("disk/opener/folder");const{fetchObjectWithRights:d}=e("disk/rights");const a=e("statemanager/redux/store");const{filesUpsertedFromServer:c}=e("disk/statemanager/redux/slices/files");const{selectById:u}=e("disk/statemanager/redux/slices/files/selector");const{dispatch:l}=a;const{boardOpener:p}=e("disk/opener/board");const{unifiedOpener:m}=e("disk/opener/unified-link/opener");const{openNativeViewer:h,getNativeViewerMediaType:g,getExtension:k,getMimeType:f}=e("utils/file");const O={COMMON:"common",USER:"user",GROUP:"group"};function v(e){h({fileType:g(f(k(e.name),e.name)),url:e.links.download,name:e.name})}async function y(e){const o=await d(e);if(!o){s({message:n.getMessage("M_DISK_IN_APP_URL_FILE_NOT_FOUND")})}if(o.isFolder){void i(o.id);return}v(o)}async function I(e,o,t){try{const s=await BX.ajax.runAction("diskmobile.Common.getFolderByPath",{data:{path:e,entityType:o,entityId:t}});if(s.errors.length>0){console.error(s.errors);return null}const r=s.data.diskObject;l(c([r]));return u(a.getState(),r.id)}catch(e){s({message:n.getMessage("M_DISK_IN_APP_URL_FOLDER_NOT_FOUND")});console.error(e)}return null}function _(e){return decodeURI(r(e).pathname).split("/path")[1]}t.exports=e=>{e.register("/bitrix/tools/disk/focus.php",((e,{queryParams:o,url:t})=>{const s=o?.objectId||o?.folderId;if(s){void y(s)}})).name("disk:entity");e.addRoute(`/company/personal/user/${env.userId}/disk/path/`).handler(((e,{url:o})=>{const t=_(o);void I(t,O.USER,env.userId).then((e=>{void y(e.id)}))})).name("disk:personal");e.register("/workgroups/group/:groupId/disk/path/",(({groupId:e},{url:o})=>{const t=_(o);void I(t,O.GROUP,e).then((e=>{void y(e.id)}))})).name("disk:group");e.register("/docs/path/",((e,{url:o})=>{const t=_(o);void I(t,O.COMMON,"shared_files_s1").then((e=>{void y(e.id)}))})).name("disk:common");e.addRoute("/disk/boards/:boardId/open").handler((({boardId:e},{context:o={},url:t})=>{void p({id:e,isAttached:t.includes("openAttached"),...o}).catch(console.error)})).name("disk:boardOpen");e.addRoute("/disk/file/:uniqueCode(?=\\?|$|/)").handler((({uniqueCode:e},{context:o={},url:t,queryParams:s})=>{void m({uniqueCode:e,url:t,queryParams:s,...o}).catch(console.error)})).name("disk:universalFileOpen")}}));
//# sourceMappingURL=extension.map.js